Interrupt Vectors
    00000 940C 03AC JMP	__text_start|__start
    0003C 940C 3CC0 JMP	_uart1_rx_isr

Program Code (text area)
__text_start|__start:
    003AC EFCF      LDI	R28,0xFF
    003AD E1D0      LDI	R29,0x10
    003AE BFCD      OUT	0x3D,R28
    003AF BFDE      OUT	0x3E,R29
    003B0 50C0      SUBI	R28,0
    003B1 40D1      SBCI	R29,1
    003B2 EA0A      LDI	R16,0xAA
    003B3 8308      ST	Y,R16
    003B4 2400      CLR	R0
    003B5 EEE7      LDI	R30,0xE7
    003B6 E0F5      LDI	R31,5
    003B7 E019      LDI	R17,0x9
    003B8 34EC      CPI	R30,0x4C
    003B9 07F1      CPC	R31,R17
    003BA F011      BEQ	0x03BD
    003BB 9201      ST	Z+,R0
    003BC CFFB      RJMP	0x03B8
    003BD 8300      ST	Z,R16
    003BE E7E0      LDI	R30,0x70
    003BF E0F2      LDI	R31,2
    003C0 E0A0      LDI	R26,0
    003C1 E0B1      LDI	R27,1
    003C2 E017      LDI	R17,7
    003C3 E000      LDI	R16,0
    003C4 BF0B      OUT	0x3B,R16
    003C5 35E7      CPI	R30,0x57
    003C6 07F1      CPC	R31,R17
    003C7 F021      BEQ	0x03CC
    003C8 95C8      LPM
    003C9 9631      ADIW	R30,1
    003CA 920D      ST	X+,R0
    003CB CFF9      RJMP	0x03C5
    003CC 940E 0413 CALL	_main
_exit:
    003CE CFFF      RJMP	_exit
FILE: D:\LQD\software\software_src\main.c
(0001) #include "config.h"
(0002) #define  N_per_Second  (2.72*60)
(0003) const char tab[]="\t\0";
(0004) const char enter[]="\n\0";
(0005) char buffer[512];
(0006) char TempChar[80]; //存放临时字串
(0007) struct DATA Result;
(0008) struct tm t;
(0009) unsigned long now =0; 
(0010) void debug(UINT8 *str,UINT8 val);
(0011) void WriteSDFile(void);
(0012) struct CONFIG config;
(0013) void initDevices(void){
(0014)      CLI();
_initDevices:
    003CF 94F8      BCLR	7
(0015) 	 DDRA=0XFF;
    003D0 EF8F      LDI	R24,0xFF
    003D1 BB8A      OUT	0x1A,R24
(0016) 	 PORTA=0XFF;
    003D2 BB8B      OUT	0x1B,R24
(0017) 	 DDRB=0XFF;
    003D3 BB87      OUT	0x17,R24
(0018) 	 PORTB=0XFF; 	 
    003D4 BB88      OUT	0x18,R24
(0019) 	 DDRC=0XFF;
    003D5 BB84      OUT	0x14,R24
(0020) 	 PORTC=0XFF;
    003D6 BB85      OUT	0x15,R24
(0021) 	 DDRG=0XFF;
    003D7 9380 0064 STS	0x64,R24
(0022) 	 PORTG=0XFF;	 
    003D9 9380 0065 STS	0x65,R24
(0023) 	 SPI_IO_Init(); 
    003DB 940E 3EB0 CALL	_SPI_IO_Init
(0024) 	 SD_Init();
    003DD 940E 2D9E CALL	_SD_Init
(0025) 	 uart1_init();
    003DF 940E 3CAF CALL	_uart1_init
(0026) 	 LCD_INT();delayms(50);LCD_INT();
    003E1 940E 3ECE CALL	_LCD_INT
    003E3 E302      LDI	R16,0x32
    003E4 E010      LDI	R17,0
    003E5 940E 2D55 CALL	_delayms
    003E7 940E 3ECE CALL	_LCD_INT
(0027) 	 LCD_SW(1);
    003E9 E001      LDI	R16,1
    003EA 940E 3EC4 CALL	_LCD_SW
(0028) 	 config.THRESHOLD_delta_sec=60; //一次检测用时
    003EC E38C      LDI	R24,0x3C
    003ED 9380 08AE STS	config+3,R24
    003EF E080      LDI	R24,0
    003F0 9380 08AF STS	config+4,R24
    003F2 9380 08B0 STS	config+5,R24
    003F4 9380 08B1 STS	config+6,R24
(0029) 	 config.heatThreshold = 5; //继电器开启温度 
    003F6 E085      LDI	R24,5
    003F7 9380 08BE STS	config+19,R24
(0030) 	 config.checkDeltaTime=20;  //自动检测模式 时间间隔	 
    003F9 E184      LDI	R24,0x14
    003FA E090      LDI	R25,0
    003FB 9390 08BC STS	config+17,R25
    003FD 9380 08BB STS	config+16,R24
(0031) 	 config.autocheck=1;        //自动检测开关
    003FF E081      LDI	R24,1
    00400 9380 08BA STS	config+15,R24
(0032) 	 config.readMode = 0;      //读数据模式
    00402 2422      CLR	R2
    00403 9220 08BD STS	config+18,R2
(0033) 	 config.autoSend = 1; //zigbee发送开关，不为0时，使能发送
    00405 9380 08BF STS	config+20,R24
(0034) 	 config.Sd = 1;      //Sd存储开关， 不为0时，使能存储
    00407 9380 08AB STS	config,R24
(0035) 	 #ifdef _FOR_FAST_TEST
(0036) 	 config.THRESHOLD_delta_sec=5; //一次检测用时
(0037) 	 config.heatThreshold = 20; //继电器开启温度 
(0038) 	 config.checkDeltaTime=5;  //自动检测模式 时间间隔	 
(0039) 	 #endif
(0040) 	 SEI();
    00409 9478      BSET	7
    0040A 9508      RET
(0041) }
(0042) void timer1_init(void)
(0043) {
(0044)  TCCR1B = 0x00; //stop
_timer1_init:
    0040B 2422      CLR	R2
    0040C BC2E      OUT	0x2E,R2
(0045)  TCNT1H = 0x00 /*INVALID SETTING*/; //setup
    0040D BC2D      OUT	0x2D,R2
(0046)  TCNT1L = 0x00 /*INVALID SETTING*/;
    0040E BC2C      OUT	0x2C,R2
(0047)  TCCR1A = 0x00;
    0040F BC2F      OUT	0x2F,R2
(0048)  TCCR1B = 0x46; //start Timer
    00410 E486      LDI	R24,0x46
    00411 BD8E      OUT	0x2E,R24
    00412 9508      RET
_main:
  keycode              --> Y,+1
  i                    --> R10
  filename             --> Y,+513
  buf512               --> Y,+0
  tmp                  --> R10
    00413 97EF      SBIW	R28,0x3F
    00414 97EF      SBIW	R28,0x3F
    00415 97EF      SBIW	R28,0x3F
    00416 97EF      SBIW	R28,0x3F
    00417 97EF      SBIW	R28,0x3F
    00418 97EF      SBIW	R28,0x3F
    00419 97EF      SBIW	R28,0x3F
    0041A 97EF      SBIW	R28,0x3F
    0041B 9767      SBIW	R28,0x17
(0049) }
(0050) ////////////////////////////////////////////////////////////////
(0051) void main(void){
(0052) 	 UINT8 tmp,keycode;
(0053) 	 UINT8 buf512[513];
(0054) 	 char filename[]="201301.xls\0\0\0";
    0041C E08A      LDI	R24,0xA
    0041D E091      LDI	R25,1
    0041E 01FE      MOVW	R30,R28
    0041F 5FEF      SUBI	R30,0xFF
    00420 4FFD      SBCI	R31,0xFD
    00421 E00E      LDI	R16,0xE
    00422 E010      LDI	R17,0
    00423 93FA      ST	-Y,R31
    00424 93EA      ST	-Y,R30
    00425 939A      ST	-Y,R25
    00426 938A      ST	-Y,R24
    00427 940E 4BCD CALL	asgnblk
(0055) 	 int i=0;
    00429 24AA      CLR	R10
    0042A 24BB      CLR	R11
(0056) 	 initDevices();
    0042B DFA3      RCALL	_initDevices
(0057) 	 dateRefresh(1);
    0042C E001      LDI	R16,1
    0042D 940E 3965 CALL	_dateRefresh
(0058) 	 WriteFileHead();
    0042F D16C      RCALL	_WriteFileHead
(0059)      Result.Index=findIndex(get_name(filename),buf512);
    00430 018E      MOVW	R16,R28
    00431 5F0F      SUBI	R16,0xFF
    00432 4F1D      SBCI	R17,0xFD
    00433 D6BC      RCALL	_get_name
    00434 019E      MOVW	R18,R28
    00435 D2E1      RCALL	_findIndex
    00436 0118      MOVW	R2,R16
    00437 2444      CLR	R4
    00438 2455      CLR	R5
    00439 9230 0644 STS	Result+11,R3
    0043B 9220 0643 STS	Result+10,R2
    0043D 9250 0646 STS	Result+13,R5
    0043F 9240 0645 STS	Result+12,R4
(0060) 	 #ifdef _DBG_RD_  
(0061) 	 	 while(1){
(0062) 		     GUI_readback(buf512);
(0063) 	     }
(0064) 	 #endif
(0065) 	 //selfTest();
(0066) 	 GUI_welcome();
    00441 940E 3948 CALL	_GUI_welcome
    00443 C025      RJMP	0x0469
(0067) 	 /*
(0068) 	 while(alwaysCheck())
(0069) 	 {
(0070) 	   delayms(100);dateRefresh(1);StructToChar();
(0071) 	   check();
(0072) 	   zigbee_send_date();
(0073) 	 }
(0074) 	  */
(0075) 	 while(alwaysCheck()){
(0076) 	    tmp=GUI_mainmeu();
    00444 940E 2F77 CALL	_GUI_mainmeu
    00446 2EA0      MOV	R10,R16
(0077) 		switch(tmp){
    00447 2D4A      MOV	R20,R10
    00448 2755      CLR	R21
    00449 3043      CPI	R20,3
    0044A E0E0      LDI	R30,0
    0044B 075E      CPC	R21,R30
    0044C F069      BEQ	0x045A
    0044D 3044      CPI	R20,4
    0044E E0E0      LDI	R30,0
    0044F 075E      CPC	R21,R30
    00450 F061      BEQ	0x045D
    00451 3045      CPI	R20,5
    00452 E0E0      LDI	R30,0
    00453 075E      CPC	R21,R30
    00454 F059      BEQ	0x0460
    00455 3047      CPI	R20,7
    00456 E0E0      LDI	R30,0
    00457 075E      CPC	R21,R30
    00458 F059      BEQ	0x0464
    00459 C00B      RJMP	0x0465
(0078) 		    case 3 : GUI_check(); break; 
    0045A 940E 306C CALL	_GUI_check
    0045C C008      RJMP	0x0465
(0079) 			case 4 : GUI_set_time(); break ;
    0045D 940E 3548 CALL	_GUI_set_time
    0045F C005      RJMP	0x0465
(0080) 			case 5 : GUI_readback(buf512); break;
    00460 018E      MOVW	R16,R28
    00461 940E 379D CALL	_GUI_readback
    00463 C001      RJMP	0x0465
(0081) 			//case 6 : GUI_send_date();
(0082) 			case 7 : selfTest(); break ;
    00464 D05A      RCALL	_selfTest
(0083) 			default : break;
(0084) 	   }
(0085) 	   delayms(100);
    00465 E604      LDI	R16,0x64
    00466 E010      LDI	R17,0
    00467 940E 2D55 CALL	_delayms
    00469 D00D      RCALL	_alwaysCheck
    0046A 2EA0      MOV	R10,R16
    0046B 2300      TST	R16
    0046C F6B9      BNE	0x0444
    0046D 96EF      ADIW	R28,0x3F
    0046E 96EF      ADIW	R28,0x3F
    0046F 96EF      ADIW	R28,0x3F
    00470 96EF      ADIW	R28,0x3F
    00471 96EF      ADIW	R28,0x3F
    00472 96EF      ADIW	R28,0x3F
    00473 96EF      ADIW	R28,0x3F
    00474 96EF      ADIW	R28,0x3F
    00475 9667      ADIW	R28,0x17
    00476 9508      RET
_alwaysCheck:
  temp                 --> Y,+0
    00477 940E 4B3C CALL	push_xgsetF00C
    00479 9724      SBIW	R28,4
(0086) 	 }
(0087) }
(0088) char alwaysCheck(void)
(0089) {
(0090)  static unsigned long last=0;
(0091)  float temp;
(0092)  RecDeal(); //zigbee data deal
    0047A 940E 3B31 CALL	_RecDeal
(0093)  //间隔5s 背温检测,发送本机ID
(0094)  if(config.now>last)
    0047C 9040 011A LDS	R4,main.c:last+2
    0047E 9050 011B LDS	R5,main.c:last+3
    00480 9020 0118 LDS	R2,main.c:last
    00482 9030 0119 LDS	R3,main.c:last+1
    00484 9080 08B8 LDS	R8,config+13
    00486 9090 08B9 LDS	R9,config+14
    00488 9060 08B6 LDS	R6,config+11
    0048A 9070 08B7 LDS	R7,config+12
    0048C 1426      CP	R2,R6
    0048D 0437      CPC	R3,R7
    0048E 0448      CPC	R4,R8
    0048F 0459      CPC	R5,R9
    00490 F550      BCC	0x04BB
(0095)  {   
(0096)  	 last=config.now+5;
    00491 E045      LDI	R20,5
    00492 E050      LDI	R21,0
    00493 E060      LDI	R22,0
    00494 E070      LDI	R23,0
    00495 0113      MOVW	R2,R6
    00496 0124      MOVW	R4,R8
    00497 0E24      ADD	R2,R20
    00498 1E35      ADC	R3,R21
    00499 1E46      ADC	R4,R22
    0049A 1E57      ADC	R5,R23
    0049B 9230 0119 STS	main.c:last+1,R3
    0049D 9220 0118 STS	main.c:last,R2
    0049F 9250 011B STS	main.c:last+3,R5
    004A1 9240 011A STS	main.c:last+2,R4
(0097) 	 zigbee_send_id(); //发送本机ID
    004A3 940E 3CA6 CALL	_zigbee_send_id
(0098)      temp= readWithoutDelay(INSIDE_SENSOR);
    004A5 2700      CLR	R16
    004A6 940E 444B CALL	_readWithoutDelay
    004A8 8308      ST	Y,R16
    004A9 8319      STD	Y+1,R17
    004AA 832A      STD	Y+2,R18
    004AB 833B      STD	Y+3,R19
(0099)      if (temp>config.heatThreshold) {
    004AC 01CE      MOVW	R24,R28
    004AD 9100 08BE LDS	R16,config+19
    004AF 2711      CLR	R17
    004B0 940E 4CC8 CALL	int2fp
    004B2 939A      ST	-Y,R25
    004B3 938A      ST	-Y,R24
    004B4 940E 4E92 CALL	fpcmp1
    004B6 F41C      BGE	0x04BA
(0100)  	     RELAY_OFF(); //debug("off=",(int)temp);
    004B7 98AD      CBI	0x15,5
(0101) 		 return 1;
    004B8 E001      LDI	R16,1
    004B9 C002      RJMP	0x04BC
(0102)  	  }
(0103)       else  {
(0104)    	     RELAY_ON();//debug("on=",(int)temp);
    004BA 9AAD      SBI	0x15,5
(0105) 	  } 
(0106)  }
(0107)  
(0108)  return 1;
    004BB E001      LDI	R16,1
    004BC 9624      ADIW	R28,4
    004BD 940C 4B43 JMP	pop_xgsetF00C
_selfTest:
  str2                 --> Y,+14
  str1                 --> Y,+8
  tmp                  --> Y,+4
    004BF 9764      SBIW	R28,0x14
(0109) }
(0110) void selfTest(void){
(0111) 	float tmp=0;                                                                
    004C0 ED08      LDI	R16,0xD8
    004C1 E010      LDI	R17,0
    004C2 940E 4AA5 CALL	elpm32
    004C4 830C      STD	Y+4,R16
    004C5 831D      STD	Y+5,R17
    004C6 832E      STD	Y+6,R18
    004C7 833F      STD	Y+7,R19
(0112) 	char str1[6],str2[6];
(0113) 	lp("┌──────┐");
    004C8 E606      LDI	R16,0x66
    004C9 E012      LDI	R17,2
    004CA 940E 41FD CALL	_lp
(0114) 	lp("│  自检程序  │");
    004CC E505      LDI	R16,0x55
    004CD E012      LDI	R17,2
    004CE 940E 41FD CALL	_lp
(0115) 	lp("│            │");
    004D0 E404      LDI	R16,0x44
    004D1 E012      LDI	R17,2
    004D2 940E 41FD CALL	_lp
(0116) 	lp("└──────┘");
    004D4 E303      LDI	R16,0x33
    004D5 E012      LDI	R17,2
    004D6 940E 41FD CALL	_lp
(0117) 	 //自检程序
(0118) 	delayms(500);
    004D8 EF04      LDI	R16,0xF4
    004D9 E011      LDI	R17,1
    004DA 940E 2D55 CALL	_delayms
(0119) 	lp("外部温度 ");
    004DC E209      LDI	R16,0x29
    004DD E012      LDI	R17,2
    004DE 940E 41FD CALL	_lp
(0120) 	tmp=read_T_NUM(OUTSIDE_SENSOR);
    004E0 E001      LDI	R16,1
    004E1 940E 442D CALL	_read_T_NUM
    004E3 830C      STD	Y+4,R16
    004E4 831D      STD	Y+5,R17
    004E5 832E      STD	Y+6,R18
    004E6 833F      STD	Y+7,R19
(0121) 	sprintf(str1,"%#0.1f",tmp);
    004E7 802C      LDD	R2,Y+4
    004E8 803D      LDD	R3,Y+5
    004E9 804E      LDD	R4,Y+6
    004EA 805F      LDD	R5,Y+7
    004EB 8228      ST	Y,R2
    004EC 8239      STD	Y+1,R3
    004ED 824A      STD	Y+2,R4
    004EE 825B      STD	Y+3,R5
    004EF E222      LDI	R18,0x22
    004F0 E032      LDI	R19,2
    004F1 018E      MOVW	R16,R28
    004F2 5F08      SUBI	R16,0xF8
    004F3 4F1F      SBCI	R17,0xFF
    004F4 940E 529A CALL	_sprintf
(0122) 	str1[6]=0;
    004F6 2422      CLR	R2
    004F7 862E      STD	Y+14,R2
(0123) 	lp(str1);
    004F8 018E      MOVW	R16,R28
    004F9 5F08      SUBI	R16,0xF8
    004FA 4F1F      SBCI	R17,0xFF
    004FB 940E 41FD CALL	_lp
(0124) 	delayms(500);
    004FD EF04      LDI	R16,0xF4
    004FE E011      LDI	R17,1
    004FF 940E 2D55 CALL	_delayms
(0125) 	lp("内部温度");
    00501 E109      LDI	R16,0x19
    00502 E012      LDI	R17,2
    00503 940E 41FD CALL	_lp
(0126) 	tmp=read_T_NUM(INSIDE_SENSOR);
    00505 2700      CLR	R16
    00506 940E 442D CALL	_read_T_NUM
    00508 830C      STD	Y+4,R16
    00509 831D      STD	Y+5,R17
    0050A 832E      STD	Y+6,R18
    0050B 833F      STD	Y+7,R19
(0127) 	sprintf(str2,"%#0.1f",tmp);
    0050C 802C      LDD	R2,Y+4
    0050D 803D      LDD	R3,Y+5
    0050E 804E      LDD	R4,Y+6
    0050F 805F      LDD	R5,Y+7
    00510 8228      ST	Y,R2
    00511 8239      STD	Y+1,R3
    00512 824A      STD	Y+2,R4
    00513 825B      STD	Y+3,R5
    00514 E222      LDI	R18,0x22
    00515 E032      LDI	R19,2
    00516 018E      MOVW	R16,R28
    00517 5F02      SUBI	R16,0xF2
    00518 4F1F      SBCI	R17,0xFF
    00519 940E 529A CALL	_sprintf
(0128) 	str2[6]=0;
    0051B 2422      CLR	R2
    0051C 8A2C      STD	Y+20,R2
(0129) 	lp(str2);
    0051D 018E      MOVW	R16,R28
    0051E 5F02      SUBI	R16,0xF2
    0051F 4F1F      SBCI	R17,0xFF
    00520 940E 41FD CALL	_lp
(0130) 	delayms(500);
    00522 EF04      LDI	R16,0xF4
    00523 E011      LDI	R17,1
    00524 940E 2D55 CALL	_delayms
(0131) 	lp("风速脉冲：");delayms(500);
    00526 E00E      LDI	R16,0xE
    00527 E012      LDI	R17,2
    00528 940E 41FD CALL	_lp
    0052A EF04      LDI	R16,0xF4
    0052B E011      LDI	R17,1
    0052C 940E 2D55 CALL	_delayms
(0132) 	lp("蜂鸣器"); beep(2,2);delayms(500);
    0052E E007      LDI	R16,7
    0052F E012      LDI	R17,2
    00530 940E 41FD CALL	_lp
    00532 E022      LDI	R18,2
    00533 E002      LDI	R16,2
    00534 940E 4275 CALL	_beep
    00536 EF04      LDI	R16,0xF4
    00537 E011      LDI	R17,1
    00538 940E 2D55 CALL	_delayms
(0133) 	lp("power 指示灯");
    0053A EF0A      LDI	R16,0xFA
    0053B E011      LDI	R17,1
    0053C 940E 41FD CALL	_lp
(0134) 	LED_OFF();delayms(100);LED_ON();delayms(100);
    0053E 9AA7      SBI	0x14,7
    0053F 98AF      CBI	0x15,7
    00540 E604      LDI	R16,0x64
    00541 E010      LDI	R17,0
    00542 940E 2D55 CALL	_delayms
    00544 9AA7      SBI	0x14,7
    00545 9AAF      SBI	0x15,7
    00546 E604      LDI	R16,0x64
    00547 E010      LDI	R17,0
    00548 940E 2D55 CALL	_delayms
(0135) 	LED_OFF();delayms(100);LED_ON();delayms(100);
    0054A 9AA7      SBI	0x14,7
    0054B 98AF      CBI	0x15,7
    0054C E604      LDI	R16,0x64
    0054D E010      LDI	R17,0
    0054E 940E 2D55 CALL	_delayms
    00550 9AA7      SBI	0x14,7
    00551 9AAF      SBI	0x15,7
    00552 E604      LDI	R16,0x64
    00553 E010      LDI	R17,0
    00554 940E 2D55 CALL	_delayms
(0136) 	LED_OFF();delayms(100);LED_ON();delayms(100);
    00556 9AA7      SBI	0x14,7
    00557 98AF      CBI	0x15,7
    00558 E604      LDI	R16,0x64
    00559 E010      LDI	R17,0
    0055A 940E 2D55 CALL	_delayms
    0055C 9AA7      SBI	0x14,7
    0055D 9AAF      SBI	0x15,7
    0055E E604      LDI	R16,0x64
    0055F E010      LDI	R17,0
    00560 940E 2D55 CALL	_delayms
(0137) 	delayms(500);
    00562 EF04      LDI	R16,0xF4
    00563 E011      LDI	R17,1
    00564 940E 2D55 CALL	_delayms
(0138) 	lp("加热开关");
    00566 EF01      LDI	R16,0xF1
    00567 E011      LDI	R17,1
    00568 940E 41FD CALL	_lp
(0139) 	RELAY_ON();delayms(100);  
    0056A 9AAD      SBI	0x15,5
    0056B E604      LDI	R16,0x64
    0056C E010      LDI	R17,0
    0056D 940E 2D55 CALL	_delayms
(0140) 	RELAY_OFF();delayms(100);
    0056F 98AD      CBI	0x15,5
    00570 E604      LDI	R16,0x64
    00571 E010      LDI	R17,0
    00572 940E 2D55 CALL	_delayms
(0141) 	RELAY_ON();delayms(100);
    00574 9AAD      SBI	0x15,5
    00575 E604      LDI	R16,0x64
    00576 E010      LDI	R17,0
    00577 940E 2D55 CALL	_delayms
(0142) 	RELAY_OFF();delayms(100);
    00579 98AD      CBI	0x15,5
    0057A E604      LDI	R16,0x64
    0057B E010      LDI	R17,0
    0057C 940E 2D55 CALL	_delayms
(0143) 	lp("  ");delayms(500);
    0057E EE0E      LDI	R16,0xEE
    0057F E011      LDI	R17,1
    00580 940E 41FD CALL	_lp
    00582 EF04      LDI	R16,0xF4
    00583 E011      LDI	R17,1
    00584 940E 2D55 CALL	_delayms
(0144) 	lp("                ");
    00586 ED0D      LDI	R16,0xDD
    00587 E011      LDI	R17,1
    00588 940E 41FD CALL	_lp
(0145) 	lp("                ");
    0058A ED0D      LDI	R16,0xDD
    0058B E011      LDI	R17,1
    0058C 940E 41FD CALL	_lp
(0146) 	lp("                ");
    0058E ED0D      LDI	R16,0xDD
    0058F E011      LDI	R17,1
    00590 940E 41FD CALL	_lp
(0147) 	lp("                ");
    00592 ED0D      LDI	R16,0xDD
    00593 E011      LDI	R17,1
    00594 940E 41FD CALL	_lp
(0148) 	delayms(100);
    00596 E604      LDI	R16,0x64
    00597 E010      LDI	R17,0
    00598 940E 2D55 CALL	_delayms
    0059A 9664      ADIW	R28,0x14
    0059B 9508      RET
_WriteFileHead:
  fs                   --> Y,+177
  bw                   --> Y,+175
  itam                 --> Y,+52
  fnamep               --> Y,+38
  file                 --> Y,+4
  res                  --> R10
    0059C 940E 4B23 CALL	push_xgset003C
    0059E 97EF      SBIW	R28,0x3F
    0059F 97EF      SBIW	R28,0x3F
    005A0 97EF      SBIW	R28,0x3F
    005A1 97EF      SBIW	R28,0x3F
    005A2 97EF      SBIW	R28,0x3F
    005A3 97EF      SBIW	R28,0x3F
    005A4 97EF      SBIW	R28,0x3F
    005A5 97EF      SBIW	R28,0x3F
    005A6 97EF      SBIW	R28,0x3F
    005A7 97EF      SBIW	R28,0x3F
    005A8 97EF      SBIW	R28,0x3F
    005A9 97AA      SBIW	R28,0x2A
(0149) 	  
(0150) }
(0151) 
(0152) void WriteFileHead(void)   
(0153) {
(0154)  	 unsigned int bw;
(0155) 	 FRESULT res;
(0156) 	 FATFS fs;
(0157) 	 FIL file;
(0158) 	 char fnamep[]="201201.xls\0\0\0"; 
    005AA E18C      LDI	R24,0x1C
    005AB E091      LDI	R25,1
    005AC 01FE      MOVW	R30,R28
    005AD 96B6      ADIW	R30,0x26
    005AE E00E      LDI	R16,0xE
    005AF E010      LDI	R17,0
    005B0 93FA      ST	-Y,R31
    005B1 93EA      ST	-Y,R30
    005B2 939A      ST	-Y,R25
    005B3 938A      ST	-Y,R24
    005B4 940E 4BCD CALL	asgnblk
(0159) 	 UINT8 itam[]="DEV000001\t\t\t\t\t\t\t\t\t\t\r\n序号\t日期\t时分\t温度\t风速\t风冷指数\t等价制冷温度\t相当温度\t冻伤危害性\t安静作业\t中等强度作业\t高强度作业\n\0";
    005B6 E28A      LDI	R24,0x2A
    005B7 E091      LDI	R25,1
    005B8 01FE      MOVW	R30,R28
    005B9 96F4      ADIW	R30,0x34
    005BA E70B      LDI	R16,0x7B
    005BB E010      LDI	R17,0
    005BC 93FA      ST	-Y,R31
    005BD 93EA      ST	-Y,R30
    005BE 939A      ST	-Y,R25
    005BF 938A      ST	-Y,R24
    005C0 940E 4BCD CALL	asgnblk
(0160) 	 res=disk_initialize(0);
    005C2 2700      CLR	R16
    005C3 940E 0BDB CALL	_disk_initialize
(0161) 	 res = f_mount(0, &fs);
    005C5 019E      MOVW	R18,R28
    005C6 542F      SUBI	R18,0x4F
    005C7 4F3F      SBCI	R19,0xFF
    005C8 2700      CLR	R16
    005C9 940E 1FC7 CALL	_f_mount
(0162) 	 //get_name(fnamep)
(0163) 	 res = f_open(&file, get_name(fnamep) , FA_OPEN_ALWAYS | FA_WRITE );  //创建一个新的文件
    005CB 018E      MOVW	R16,R28
    005CC 5D0A      SUBI	R16,0xDA
    005CD 4F1F      SBCI	R17,0xFF
    005CE D521      RCALL	_get_name
    005CF 0168      MOVW	R12,R16
    005D0 E182      LDI	R24,0x12
    005D1 8388      ST	Y,R24
    005D2 0196      MOVW	R18,R12
    005D3 018E      MOVW	R16,R28
    005D4 5F0C      SUBI	R16,0xFC
    005D5 4F1F      SBCI	R17,0xFF
    005D6 940E 1FF2 CALL	_f_open
(0164) 	 res = f_write(&file,itam,128,&bw);   //bw 已写入字节数
    005D8 01CE      MOVW	R24,R28
    005D9 5581      SUBI	R24,0x51
    005DA 4F9F      SBCI	R25,0xFF
    005DB 839B      STD	Y+3,R25
    005DC 838A      STD	Y+2,R24
    005DD E880      LDI	R24,0x80
    005DE E090      LDI	R25,0
    005DF 8399      STD	Y+1,R25
    005E0 8388      ST	Y,R24
    005E1 019E      MOVW	R18,R28
    005E2 5C2C      SUBI	R18,0xCC
    005E3 4F3F      SBCI	R19,0xFF
    005E4 018E      MOVW	R16,R28
    005E5 5F0C      SUBI	R16,0xFC
    005E6 4F1F      SBCI	R17,0xFF
    005E7 940E 23F9 CALL	_f_write
    005E9 2EC0      MOV	R12,R16
    005EA 2CAC      MOV	R10,R12
(0165) 	 f_close(&file);
    005EB 018E      MOVW	R16,R28
    005EC 5F0C      SUBI	R16,0xFC
    005ED 4F1F      SBCI	R17,0xFF
    005EE 940E 27C3 CALL	_f_close
(0166) 	 f_mount(0, NULL);
    005F0 2722      CLR	R18
    005F1 2733      CLR	R19
    005F2 2700      CLR	R16
    005F3 940E 1FC7 CALL	_f_mount
    005F5 96EF      ADIW	R28,0x3F
    005F6 96EF      ADIW	R28,0x3F
    005F7 96EF      ADIW	R28,0x3F
    005F8 96EF      ADIW	R28,0x3F
    005F9 96EF      ADIW	R28,0x3F
    005FA 96EF      ADIW	R28,0x3F
    005FB 96EF      ADIW	R28,0x3F
    005FC 96EF      ADIW	R28,0x3F
    005FD 96EF      ADIW	R28,0x3F
    005FE 96EF      ADIW	R28,0x3F
    005FF 96EF      ADIW	R28,0x3F
    00600 96AA      ADIW	R28,0x2A
    00601 940C 4AFD JMP	pop_xgset003C
_WriteSDFile:
  fnamep               --> Y,+602
  fs                   --> Y,+44
  bw                   --> Y,+42
  lenth                --> Y,+38
  res                  --> R10
  file                 --> Y,+4
    00603 92AA      ST	-Y,R10
    00604 92CA      ST	-Y,R12
    00605 97EF      SBIW	R28,0x3F
    00606 97EF      SBIW	R28,0x3F
    00607 97EF      SBIW	R28,0x3F
    00608 97EF      SBIW	R28,0x3F
    00609 97EF      SBIW	R28,0x3F
    0060A 97EF      SBIW	R28,0x3F
    0060B 97EF      SBIW	R28,0x3F
    0060C 97EF      SBIW	R28,0x3F
    0060D 97EF      SBIW	R28,0x3F
    0060E 97E0      SBIW	R28,0x30
(0167) } /////////////////////////////////////////////////
(0168) //       写入文件函数 
(0169) //(创建)打开文件 
(0170) // data 指向欲写入的的字符串 64byt 
(0171) //////////////////////////////////////////////// 
(0172) void WriteSDFile(void)   
(0173) {
(0174)     unsigned int bw;
(0175) 	FRESULT res;
(0176) 	FATFS fs;
(0177)     FIL file;
(0178) 	char fnamep[13];
(0179) 	long lenth=0;
    0060F E080      LDI	R24,0
    00610 A38E      STD	Y+38,R24
    00611 A38F      STD	Y+39,R24
    00612 A788      STD	Y+40,R24
    00613 A789      STD	Y+41,R24
(0180) 	disk_initialize(0);
    00614 2700      CLR	R16
    00615 940E 0BDB CALL	_disk_initialize
(0181) 	res = f_mount(0, &fs);
    00617 019E      MOVW	R18,R28
    00618 5D24      SUBI	R18,0xD4
    00619 4F3F      SBCI	R19,0xFF
    0061A 2700      CLR	R16
    0061B 940E 1FC7 CALL	_f_mount
(0182) 	res = f_open(&file,get_name(fnamep), FA_OPEN_ALWAYS | FA_WRITE );  //创建一个新的文件
    0061D 018E      MOVW	R16,R28
    0061E 5A06      SUBI	R16,0xA6
    0061F 4F1D      SBCI	R17,0xFD
    00620 D4CF      RCALL	_get_name
    00621 E182      LDI	R24,0x12
    00622 8388      ST	Y,R24
    00623 0198      MOVW	R18,R16
    00624 018E      MOVW	R16,R28
    00625 5F0C      SUBI	R16,0xFC
    00626 4F1F      SBCI	R17,0xFF
    00627 940E 1FF2 CALL	_f_open
(0183) 	lenth=file.fsize;   
    00629 842E      LDD	R2,Y+14
    0062A 843F      LDD	R3,Y+15
    0062B 8848      LDD	R4,Y+16
    0062C 8859      LDD	R5,Y+17
    0062D A22E      STD	Y+38,R2
    0062E A23F      STD	Y+39,R3
    0062F A648      STD	Y+40,R4
    00630 A659      STD	Y+41,R5
(0184) 	res = f_lseek (&file,lenth);	 
    00631 A02E      LDD	R2,Y+38
    00632 A03F      LDD	R3,Y+39
    00633 A448      LDD	R4,Y+40
    00634 A459      LDD	R5,Y+41
    00635 8248      ST	Y,R4
    00636 8259      STD	Y+1,R5
    00637 0191      MOVW	R18,R2
    00638 018E      MOVW	R16,R28
    00639 5F0C      SUBI	R16,0xFC
    0063A 4F1F      SBCI	R17,0xFF
    0063B 940E 27D3 CALL	_f_lseek
(0185) 	res = f_write(&file,TempChar,SINGLE_ITEM_SIZE,&bw);   //bw 已写入字节数
    0063D 01CE      MOVW	R24,R28
    0063E 968A      ADIW	R24,0x2A
    0063F 839B      STD	Y+3,R25
    00640 838A      STD	Y+2,R24
    00641 E480      LDI	R24,0x40
    00642 E090      LDI	R25,0
    00643 8399      STD	Y+1,R25
    00644 8388      ST	Y,R24
    00645 EE29      LDI	R18,0xE9
    00646 E035      LDI	R19,5
    00647 018E      MOVW	R16,R28
    00648 5F0C      SUBI	R16,0xFC
    00649 4F1F      SBCI	R17,0xFF
    0064A 940E 23F9 CALL	_f_write
    0064C 2EC0      MOV	R12,R16
    0064D 2CAC      MOV	R10,R12
(0186) 	f_close(&file);
    0064E 018E      MOVW	R16,R28
    0064F 5F0C      SUBI	R16,0xFC
    00650 4F1F      SBCI	R17,0xFF
    00651 940E 27C3 CALL	_f_close
(0187) 	f_mount(0, NULL);
    00653 2722      CLR	R18
    00654 2733      CLR	R19
    00655 2700      CLR	R16
    00656 940E 1FC7 CALL	_f_mount
    00658 96EF      ADIW	R28,0x3F
    00659 96EF      ADIW	R28,0x3F
    0065A 96EF      ADIW	R28,0x3F
    0065B 96EF      ADIW	R28,0x3F
    0065C 96EF      ADIW	R28,0x3F
    0065D 96EF      ADIW	R28,0x3F
    0065E 96EF      ADIW	R28,0x3F
    0065F 96EF      ADIW	R28,0x3F
    00660 96EF      ADIW	R28,0x3F
    00661 96E0      ADIW	R28,0x30
    00662 90C9      LD	R12,Y+
    00663 90A9      LD	R10,Y+
    00664 9508      RET
_ReadSDFile:
  fs                   --> Y,+40
  bw                   --> Y,+38
  max                  --> R12
  file                 --> Y,+4
  res                  --> R20
  mode                 --> R22
  data                 --> R10
  index                --> R14
  fnamep               --> R12
    00665 940E 4B1D CALL	push_xgsetF0FC
    00667 0179      MOVW	R14,R18
    00668 0168      MOVW	R12,R16
    00669 97EF      SBIW	R28,0x3F
    0066A 97EF      SBIW	R28,0x3F
    0066B 97EF      SBIW	R28,0x3F
    0066C 97EF      SBIW	R28,0x3F
    0066D 97EF      SBIW	R28,0x3F
    0066E 97EF      SBIW	R28,0x3F
    0066F 97EF      SBIW	R28,0x3F
    00670 97EF      SBIW	R28,0x3F
    00671 97EF      SBIW	R28,0x3F
    00672 976F      SBIW	R28,0x1F
    00673 01FE      MOVW	R30,R28
    00674 5AE0      SUBI	R30,0xA0
    00675 4FFD      SBCI	R31,0xFD
    00676 80A0      LD	R10,Z
    00677 80B1      LDD	R11,Z+1
    00678 01FE      MOVW	R30,R28
    00679 59EE      SUBI	R30,0x9E
    0067A 4FFD      SBCI	R31,0xFD
    0067B 8160      LD	R22,Z
(0188) }
(0189) /////////////////////////////////////////////////
(0190) //       读取文件函数
(0191) //以64byte为一块 读取
(0192) //index数据偏移量   data读出后存放地
(0193) //////////////////////////////////////////////// 
(0194) char ReadSDFile(char *fnamep,int index, char *data, char mode)
(0195) {
(0196)  	unsigned int bw;
(0197) 	char res;
(0198) 	FATFS fs;
(0199)     FIL file;
(0200) 	static int indexoffset;
(0201) 	unsigned int max;
(0202) 	disk_initialize(0);
    0067C 2700      CLR	R16
    0067D 940E 0BDB CALL	_disk_initialize
(0203)     res = f_mount(0, &fs);
    0067F 019E      MOVW	R18,R28
    00680 5D28      SUBI	R18,0xD8
    00681 4F3F      SBCI	R19,0xFF
    00682 2700      CLR	R16
    00683 940E 1FC7 CALL	_f_mount
(0204)     res = f_open(&file,fnamep,FA_READ);  
    00685 E081      LDI	R24,1
    00686 8388      ST	Y,R24
    00687 0196      MOVW	R18,R12
    00688 018E      MOVW	R16,R28
    00689 5F0C      SUBI	R16,0xFC
    0068A 4F1F      SBCI	R17,0xFF
    0068B 940E 1FF2 CALL	_f_open
    0068D 2F40      MOV	R20,R16
(0205)     if(res==FR_NO_FILE) {
    0068E 3004      CPI	R16,4
    0068F F419      BNE	0x0693
(0206) 	data=NULL;
    00690 24AA      CLR	R10
    00691 24BB      CLR	R11
(0207)     #if _debug >= 1 
(0208)     debug_out("now file",255);
(0209) 	debug_out(filename,res);
(0210) 	debug_out("file is no exist....",255);
(0211)     #endif 
(0212)     return res;
    00692 C078      RJMP	0x070B
(0213)     }   
(0214)     max = (file.fsize-128)/SINGLE_ITEM_SIZE;
    00693 E880      LDI	R24,0x80
    00694 E090      LDI	R25,0
    00695 E0A0      LDI	R26,0
    00696 E0B0      LDI	R27,0
    00697 850E      LDD	R16,Y+14
    00698 851F      LDD	R17,Y+15
    00699 8928      LDD	R18,Y+16
    0069A 8939      LDD	R19,Y+17
    0069B 1B08      SUB	R16,R24
    0069C 0B19      SBC	R17,R25
    0069D 0B2A      SBC	R18,R26
    0069E 0B3B      SBC	R19,R27
    0069F E086      LDI	R24,6
    006A0 E090      LDI	R25,0
    006A1 938A      ST	-Y,R24
    006A2 940E 4BC1 CALL	lsr32
    006A4 0168      MOVW	R12,R16
(0215) 	if(mode == 0){ //绝对位置模式
    006A5 2366      TST	R22
    006A6 F429      BNE	0x06AC
(0216) 		indexoffset = index;
    006A7 92F0 05E8 STS	main.c:indexoffset+1,R15
    006A9 92E0 05E7 STS	main.c:indexoffset,R14
(0217) 	}
    006AB C00C      RJMP	0x06B8
(0218) 	else if(mode == 1){ //位置偏移模式
    006AC 3061      CPI	R22,1
    006AD F451      BNE	0x06B8
(0219) 		indexoffset+=index;
    006AE 9020 05E7 LDS	R2,main.c:indexoffset
    006B0 9030 05E8 LDS	R3,main.c:indexoffset+1
    006B2 0C2E      ADD	R2,R14
    006B3 1C3F      ADC	R3,R15
    006B4 9230 05E8 STS	main.c:indexoffset+1,R3
    006B6 9220 05E7 STS	main.c:indexoffset,R2
(0220) 	}
(0221) 	if(indexoffset >max){
    006B8 9020 05E7 LDS	R2,main.c:indexoffset
    006BA 9030 05E8 LDS	R3,main.c:indexoffset+1
    006BC 14C2      CP	R12,R2
    006BD 04D3      CPC	R13,R3
    006BE F428      BCC	0x06C4
(0222) 	    indexoffset = max;
    006BF 92D0 05E8 STS	main.c:indexoffset+1,R13
    006C1 92C0 05E7 STS	main.c:indexoffset,R12
(0223) 	}
    006C3 C00F      RJMP	0x06D3
(0224) 	else if(indexoffset <=0){
    006C4 2422      CLR	R2
    006C5 2433      CLR	R3
    006C6 9040 05E7 LDS	R4,main.c:indexoffset
    006C8 9050 05E8 LDS	R5,main.c:indexoffset+1
    006CA 1424      CP	R2,R4
    006CB 0435      CPC	R3,R5
    006CC F034      BLT	0x06D3
(0225) 		indexoffset = 1;
    006CD E081      LDI	R24,1
    006CE E090      LDI	R25,0
    006CF 9390 05E8 STS	main.c:indexoffset+1,R25
    006D1 9380 05E7 STS	main.c:indexoffset,R24
(0226) 	}
(0227) 	res = f_lseek (&file,(indexoffset-1)*SINGLE_ITEM_SIZE+128);	 //前两个字节数据为文件头空间 所以从第三块读/写起
    006D3 9120 05E7 LDS	R18,main.c:indexoffset
    006D5 9130 05E8 LDS	R19,main.c:indexoffset+1
    006D7 E400      LDI	R16,0x40
    006D8 E010      LDI	R17,0
    006D9 940E 4AB9 CALL	empy16s
    006DB 01C8      MOVW	R24,R16
    006DC 5480      SUBI	R24,0x40
    006DD 4090      SBCI	R25,0
    006DE 5880      SUBI	R24,0x80
    006DF 4F9F      SBCI	R25,0xFF
    006E0 011C      MOVW	R2,R24
    006E1 2444      CLR	R4
    006E2 FC37      SBRC	R3,7
    006E3 9440      COM	R4
    006E4 2455      CLR	R5
    006E5 FC47      SBRC	R4,7
    006E6 9450      COM	R5
    006E7 8248      ST	Y,R4
    006E8 8259      STD	Y+1,R5
    006E9 0191      MOVW	R18,R2
    006EA 018E      MOVW	R16,R28
    006EB 5F0C      SUBI	R16,0xFC
    006EC 4F1F      SBCI	R17,0xFF
    006ED 940E 27D3 CALL	_f_lseek
    006EF 2EC0      MOV	R12,R16
(0228)     res = f_read(&file,data,SINGLE_ITEM_SIZE,&bw);
    006F0 01CE      MOVW	R24,R28
    006F1 9686      ADIW	R24,0x26
    006F2 839B      STD	Y+3,R25
    006F3 838A      STD	Y+2,R24
    006F4 E480      LDI	R24,0x40
    006F5 E090      LDI	R25,0
    006F6 8399      STD	Y+1,R25
    006F7 8388      ST	Y,R24
    006F8 0195      MOVW	R18,R10
    006F9 018E      MOVW	R16,R28
    006FA 5F0C      SUBI	R16,0xFC
    006FB 4F1F      SBCI	R17,0xFF
    006FC 940E 218E CALL	_f_read
    006FE 2EA0      MOV	R10,R16
    006FF 2D4A      MOV	R20,R10
(0229)     f_close(&file);
    00700 018E      MOVW	R16,R28
    00701 5F0C      SUBI	R16,0xFC
    00702 4F1F      SBCI	R17,0xFF
    00703 940E 27C3 CALL	_f_close
(0230) 	f_mount(0, NULL);
    00705 2722      CLR	R18
    00706 2733      CLR	R19
    00707 2700      CLR	R16
    00708 940E 1FC7 CALL	_f_mount
(0231) 	return res;
    0070A 2F04      MOV	R16,R20
    0070B 96EF      ADIW	R28,0x3F
    0070C 96EF      ADIW	R28,0x3F
    0070D 96EF      ADIW	R28,0x3F
    0070E 96EF      ADIW	R28,0x3F
    0070F 96EF      ADIW	R28,0x3F
    00710 96EF      ADIW	R28,0x3F
    00711 96EF      ADIW	R28,0x3F
    00712 96EF      ADIW	R28,0x3F
    00713 96EF      ADIW	R28,0x3F
    00714 966F      ADIW	R28,0x1F
    00715 940C 4B12 JMP	pop_xgsetF0FC
_findIndex:
  fs                   --> Y,+48
  bw                   --> Y,+46
  fnamep               --> R14
  readsize             --> R10
  res                  --> R12
  file                 --> Y,+12
  lenth                --> Y,+8
  index                --> Y,+4
  is_first_end         --> Y,+606
  tmp                  --> R10
  buf                  --> Y,+617
  filename             --> R10
    00717 933A      ST	-Y,R19
    00718 932A      ST	-Y,R18
    00719 940E 4B1D CALL	push_xgsetF0FC
    0071B 0158      MOVW	R10,R16
    0071C 97EF      SBIW	R28,0x3F
    0071D 97EF      SBIW	R28,0x3F
    0071E 97EF      SBIW	R28,0x3F
    0071F 97EF      SBIW	R28,0x3F
    00720 97EF      SBIW	R28,0x3F
    00721 97EF      SBIW	R28,0x3F
    00722 97EF      SBIW	R28,0x3F
    00723 97EF      SBIW	R28,0x3F
    00724 97EF      SBIW	R28,0x3F
    00725 97A8      SBIW	R28,0x28
(0232) } 
(0233) //////////////////////////////////
(0234) //   find index
(0235) // 检查当前文件尺寸，根据倒数第二个
(0236) //'\n'及其后面的index确定当前index值
(0237) //////////////////////////////////
(0238) unsigned int findIndex(char *filename,char *buf){
(0239)     unsigned int bw,tmp;
(0240) 	long index =0;
    00726 E080      LDI	R24,0
    00727 838C      STD	Y+4,R24
    00728 838D      STD	Y+5,R24
    00729 838E      STD	Y+6,R24
    0072A 838F      STD	Y+7,R24
(0241) 	unsigned char is_first_end=0;
    0072B 2400      CLR	R0
    0072C 01DE      MOVW	R26,R28
    0072D 5AA2      SUBI	R26,0xA2
    0072E 4FBD      SBCI	R27,0xFD
    0072F 920C      ST	X,R0
(0242) 	char *fnamep=filename;
    00730 0175      MOVW	R14,R10
(0243) 	FRESULT res;
(0244) 	FATFS fs;
(0245) 	FIL file;
(0246) 	long lenth=0;
    00731 E080      LDI	R24,0
    00732 8788      STD	Y+8,R24
    00733 8789      STD	Y+9,R24
    00734 878A      STD	Y+10,R24
    00735 878B      STD	Y+11,R24
(0247) 	int readsize=0;
    00736 24AA      CLR	R10
    00737 24BB      CLR	R11
(0248) 	//PrintString_n(fnamep);
(0249) 	res = f_mount(0, &fs);
    00738 019E      MOVW	R18,R28
    00739 5D20      SUBI	R18,0xD0
    0073A 4F3F      SBCI	R19,0xFF
    0073B 2700      CLR	R16
    0073C 940E 1FC7 CALL	_f_mount
(0250) 	res = f_open(&file,fnamep, FA_OPEN_ALWAYS | FA_READ );  //创建一个新的文件
    0073E E181      LDI	R24,0x11
    0073F 8388      ST	Y,R24
    00740 0197      MOVW	R18,R14
    00741 018E      MOVW	R16,R28
    00742 5F04      SUBI	R16,0xF4
    00743 4F1F      SBCI	R17,0xFF
    00744 940E 1FF2 CALL	_f_open
    00746 2EC0      MOV	R12,R16
(0251) 	if(res !=  FR_OK){ //openerror
    00747 2300      TST	R16
    00748 F011      BEQ	0x074B
(0252) 	    return res;}
    00749 2711      CLR	R17
    0074A C110      RJMP	0x085B
(0253) 	lenth=file.fsize;   //文件尾部为 file.size 
    0074B 882E      LDD	R2,Y+22
    0074C 883F      LDD	R3,Y+23
    0074D 8C48      LDD	R4,Y+24
    0074E 8C59      LDD	R5,Y+25
    0074F 8628      STD	Y+8,R2
    00750 8639      STD	Y+9,R3
    00751 864A      STD	Y+10,R4
    00752 865B      STD	Y+11,R5
(0254) 	//debug("size=",0xff);
(0255) 	//PrintLong(lenth);
(0256) 	if(lenth > 512) {
    00753 E040      LDI	R20,0
    00754 E052      LDI	R21,2
    00755 E060      LDI	R22,0
    00756 E070      LDI	R23,0
    00757 8428      LDD	R2,Y+8
    00758 8439      LDD	R3,Y+9
    00759 844A      LDD	R4,Y+10
    0075A 845B      LDD	R5,Y+11
    0075B 1542      CP	R20,R2
    0075C 0553      CPC	R21,R3
    0075D 0564      CPC	R22,R4
    0075E 0575      CPC	R23,R5
    0075F F464      BGE	0x076C
(0257) 	    readsize=512;
    00760 E080      LDI	R24,0
    00761 E092      LDI	R25,2
    00762 015C      MOVW	R10,R24
(0258) 		lenth=file.fsize;
    00763 882E      LDD	R2,Y+22
    00764 883F      LDD	R3,Y+23
    00765 8C48      LDD	R4,Y+24
    00766 8C59      LDD	R5,Y+25
    00767 8628      STD	Y+8,R2
    00768 8639      STD	Y+9,R3
    00769 864A      STD	Y+10,R4
    0076A 865B      STD	Y+11,R5
(0259) 	}
    0076B C007      RJMP	0x0773
(0260) 	else {
(0261) 	    readsize =file.fsize;
    0076C 88AE      LDD	R10,Y+22
    0076D 88BF      LDD	R11,Y+23
(0262) 		lenth=0;
    0076E E080      LDI	R24,0
    0076F 8788      STD	Y+8,R24
    00770 8789      STD	Y+9,R24
    00771 878A      STD	Y+10,R24
    00772 878B      STD	Y+11,R24
(0263) 	}
(0264) 	res = f_lseek (&file,file.fsize-readsize);
    00773 0115      MOVW	R2,R10
    00774 2444      CLR	R4
    00775 FC37      SBRC	R3,7
    00776 9440      COM	R4
    00777 2455      CLR	R5
    00778 FC47      SBRC	R4,7
    00779 9450      COM	R5
    0077A 886E      LDD	R6,Y+22
    0077B 887F      LDD	R7,Y+23
    0077C 8C88      LDD	R8,Y+24
    0077D 8C99      LDD	R9,Y+25
    0077E 1862      SUB	R6,R2
    0077F 0873      SBC	R7,R3
    00780 0884      SBC	R8,R4
    00781 0895      SBC	R9,R5
    00782 8288      ST	Y,R8
    00783 8299      STD	Y+1,R9
    00784 0193      MOVW	R18,R6
    00785 018E      MOVW	R16,R28
    00786 5F04      SUBI	R16,0xF4
    00787 4F1F      SBCI	R17,0xFF
    00788 940E 27D3 CALL	_f_lseek
(0265) 	//debug("readSIZE=",0x00);
(0266) 	//PrintLong((file.fsize-readsize));
(0267) 	res = f_read(&file,buf,readsize,&bw);
    0078A 01CE      MOVW	R24,R28
    0078B 968E      ADIW	R24,0x2E
    0078C 839B      STD	Y+3,R25
    0078D 838A      STD	Y+2,R24
    0078E 82B9      STD	Y+1,R11
    0078F 82A8      ST	Y,R10
    00790 01FE      MOVW	R30,R28
    00791 59E7      SUBI	R30,0x97
    00792 4FFD      SBCI	R31,0xFD
    00793 8120      LD	R18,Z
    00794 8131      LDD	R19,Z+1
    00795 018E      MOVW	R16,R28
    00796 5F04      SUBI	R16,0xF4
    00797 4F1F      SBCI	R17,0xFF
    00798 940E 218E CALL	_f_read
    0079A 2EE0      MOV	R14,R16
    0079B 2CCE      MOV	R12,R14
(0268) 	f_close(&file);
    0079C 018E      MOVW	R16,R28
    0079D 5F04      SUBI	R16,0xF4
    0079E 4F1F      SBCI	R17,0xFF
    0079F 940E 27C3 CALL	_f_close
(0269) 	//debug("readRES=",res);
(0270) 	//debug("readbw=",0X00);
(0271) 	//PrintLong(bw);
(0272) 	//PrintString_n(buf);
(0273) 	for(tmp=readsize;tmp>0;tmp--){
    007A1 C040      RJMP	0x07E2
(0274) 		//debug("buf index",buf[tmp]);
(0275) 		//PrintLong(tmp);
(0276) 		//if(buf[tmp] == '\n') Usart_Transmit('@');						  
(0277) 		if(buf[tmp] == '\n' && is_first_end== 0){
    007A2 01F5      MOVW	R30,R10
    007A3 01DE      MOVW	R26,R28
    007A4 59A7      SUBI	R26,0x97
    007A5 4FBD      SBCI	R27,0xFD
    007A6 900D      LD	R0,X+
    007A7 901C      LD	R1,X
    007A8 0DE0      ADD	R30,R0
    007A9 1DF1      ADC	R31,R1
    007AA 8180      LD	R24,Z
    007AB 308A      CPI	R24,0xA
    007AC F469      BNE	0x07BA
    007AD 01FE      MOVW	R30,R28
    007AE 5AE2      SUBI	R30,0xA2
    007AF 4FFD      SBCI	R31,0xFD
    007B0 8000      LD	R0,Z
    007B1 2000      TST	R0
    007B2 F439      BNE	0x07BA
(0278) 		    is_first_end=1; 	
    007B3 2400      CLR	R0
    007B4 9403      INC	R0
    007B5 01FE      MOVW	R30,R28
    007B6 5AE2      SUBI	R30,0xA2
    007B7 4FFD      SBCI	R31,0xFD
    007B8 8200      ST	Z,R0
(0279) 			//debug("first=",0xf0);					      
(0280) 		}
    007B9 C025      RJMP	0x07DF
(0281) 		else if(buf[tmp] == '\n' && is_first_end== 1){
    007BA 01F5      MOVW	R30,R10
    007BB 01DE      MOVW	R26,R28
    007BC 59A7      SUBI	R26,0x97
    007BD 4FBD      SBCI	R27,0xFD
    007BE 900D      LD	R0,X+
    007BF 901C      LD	R1,X
    007C0 0DE0      ADD	R30,R0
    007C1 1DF1      ADC	R31,R1
    007C2 8180      LD	R24,Z
    007C3 308A      CPI	R24,0xA
    007C4 F4D1      BNE	0x07DF
    007C5 01DE      MOVW	R26,R28
    007C6 5AA2      SUBI	R26,0xA2
    007C7 4FBD      SBCI	R27,0xFD
    007C8 918C      LD	R24,X
    007C9 3081      CPI	R24,1
    007CA F4A1      BNE	0x07DF
(0282) 		    lenth -= (512-tmp);
    007CB E080      LDI	R24,0
    007CC E092      LDI	R25,2
    007CD 011C      MOVW	R2,R24
    007CE 182A      SUB	R2,R10
    007CF 083B      SBC	R3,R11
    007D0 2444      CLR	R4
    007D1 2455      CLR	R5
    007D2 8468      LDD	R6,Y+8
    007D3 8479      LDD	R7,Y+9
    007D4 848A      LDD	R8,Y+10
    007D5 849B      LDD	R9,Y+11
    007D6 1862      SUB	R6,R2
    007D7 0873      SBC	R7,R3
    007D8 0884      SBC	R8,R4
    007D9 0895      SBC	R9,R5
    007DA 8668      STD	Y+8,R6
    007DB 8679      STD	Y+9,R7
    007DC 868A      STD	Y+10,R8
    007DD 869B      STD	Y+11,R9
(0283) 			break;
    007DE C009      RJMP	0x07E8
    007DF 01C5      MOVW	R24,R10
    007E0 9701      SBIW	R24,1
    007E1 015C      MOVW	R10,R24
    007E2 20AA      TST	R10
    007E3 F009      BEQ	0x07E5
    007E4 CFBD      RJMP	0x07A2
    007E5 20BB      TST	R11
    007E6 F009      BEQ	0x07E8
    007E7 CFBA      RJMP	0x07A2
(0284) 		} 						
(0285) 	}
(0286) 	//debug("start=",0X00); PrintLong(lenth);
(0287) 	if(lenth < 118 ){ 
    007E8 E746      LDI	R20,0x76
    007E9 E050      LDI	R21,0
    007EA E060      LDI	R22,0
    007EB E070      LDI	R23,0
    007EC 8428      LDD	R2,Y+8
    007ED 8439      LDD	R3,Y+9
    007EE 844A      LDD	R4,Y+10
    007EF 845B      LDD	R5,Y+11
    007F0 1624      CP	R2,R20
    007F1 0635      CPC	R3,R21
    007F2 0646      CPC	R4,R22
    007F3 0657      CPC	R5,R23
    007F4 F434      BGE	0x07FB
(0288)  		return 1;
    007F5 E001      LDI	R16,1
    007F6 E010      LDI	R17,0
    007F7 C063      RJMP	0x085B
(0289) 	}
(0290) 	else {
(0291) 		 //debug(">128 ",0X00);
(0292) 		 while(buf[tmp] <= '0' || buf[tmp] >= '9') tmp++;
    007F8 01C5      MOVW	R24,R10
    007F9 9601      ADIW	R24,1
    007FA 015C      MOVW	R10,R24
    007FB 01F5      MOVW	R30,R10
    007FC 01DE      MOVW	R26,R28
    007FD 59A7      SUBI	R26,0x97
    007FE 4FBD      SBCI	R27,0xFD
    007FF 900D      LD	R0,X+
    00800 901C      LD	R1,X
    00801 0DE0      ADD	R30,R0
    00802 1DF1      ADC	R31,R1
    00803 80E0      LD	R14,Z
    00804 24FF      CLR	R15
    00805 E380      LDI	R24,0x30
    00806 158E      CP	R24,R14
    00807 F780      BCC	0x07F8
    00808 2D8E      MOV	R24,R14
    00809 3389      CPI	R24,0x39
    0080A F768      BCC	0x07F8
    0080B C02F      RJMP	0x083B
(0293) 		 //debug("nozero ",bw); PrintLong(tmp);
(0294) 		 while(buf[tmp] != 't' && buf[tmp] >= '0' && buf[tmp] <= '9'){
(0295) 		     index=index*10+(buf[tmp]-'0');
    0080C 01F5      MOVW	R30,R10
    0080D 01DE      MOVW	R26,R28
    0080E 59A7      SUBI	R26,0x97
    0080F 4FBD      SBCI	R27,0xFD
    00810 900D      LD	R0,X+
    00811 901C      LD	R1,X
    00812 0DE0      ADD	R30,R0
    00813 1DF1      ADC	R31,R1
    00814 8180      LD	R24,Z
    00815 2799      CLR	R25
    00816 97C0      SBIW	R24,0x30
    00817 011C      MOVW	R2,R24
    00818 2444      CLR	R4
    00819 FC37      SBRC	R3,7
    0081A 9440      COM	R4
    0081B 2455      CLR	R5
    0081C FC47      SBRC	R4,7
    0081D 9450      COM	R5
    0081E 806C      LDD	R6,Y+4
    0081F 807D      LDD	R7,Y+5
    00820 808E      LDD	R8,Y+6
    00821 809F      LDD	R9,Y+7
    00822 E04A      LDI	R20,0xA
    00823 E050      LDI	R21,0
    00824 E060      LDI	R22,0
    00825 E070      LDI	R23,0
    00826 929A      ST	-Y,R9
    00827 928A      ST	-Y,R8
    00828 927A      ST	-Y,R7
    00829 926A      ST	-Y,R6
    0082A 018A      MOVW	R16,R20
    0082B 019B      MOVW	R18,R22
    0082C 940E 4AC9 CALL	empy32s|empy32u
    0082E 0138      MOVW	R6,R16
    0082F 0149      MOVW	R8,R18
    00830 0C62      ADD	R6,R2
    00831 1C73      ADC	R7,R3
    00832 1C84      ADC	R8,R4
    00833 1C95      ADC	R9,R5
    00834 826C      STD	Y+4,R6
    00835 827D      STD	Y+5,R7
    00836 828E      STD	Y+6,R8
    00837 829F      STD	Y+7,R9
(0296) 		 	 //Usart_Transmit(buf[tmp]);	
(0297) 		 	 tmp++;
    00838 01C5      MOVW	R24,R10
    00839 9601      ADIW	R24,1
    0083A 015C      MOVW	R10,R24
    0083B 01F5      MOVW	R30,R10
    0083C 01DE      MOVW	R26,R28
    0083D 59A7      SUBI	R26,0x97
    0083E 4FBD      SBCI	R27,0xFD
    0083F 900D      LD	R0,X+
    00840 901C      LD	R1,X
    00841 0DE0      ADD	R30,R0
    00842 1DF1      ADC	R31,R1
    00843 80E0      LD	R14,Z
    00844 24FF      CLR	R15
    00845 2D8E      MOV	R24,R14
    00846 3784      CPI	R24,0x74
    00847 F031      BEQ	0x084E
    00848 3380      CPI	R24,0x30
    00849 F020      BCS	0x084E
    0084A E389      LDI	R24,0x39
    0084B 158E      CP	R24,R14
    0084C F008      BCS	0x084E
    0084D CFBE      RJMP	0x080C
(0298) 		 }
(0299) 	}
(0300) 	//debug("index=",0X00);
(0301) 	//PrintLong(index+1);
(0302) 	return index+1;
    0084E E041      LDI	R20,1
    0084F E050      LDI	R21,0
    00850 E060      LDI	R22,0
    00851 E070      LDI	R23,0
    00852 802C      LDD	R2,Y+4
    00853 803D      LDD	R3,Y+5
    00854 804E      LDD	R4,Y+6
    00855 805F      LDD	R5,Y+7
    00856 0E24      ADD	R2,R20
    00857 1E35      ADC	R3,R21
    00858 1E46      ADC	R4,R22
    00859 1E57      ADC	R5,R23
    0085A 0181      MOVW	R16,R2
    0085B 96EF      ADIW	R28,0x3F
    0085C 96EF      ADIW	R28,0x3F
    0085D 96EF      ADIW	R28,0x3F
    0085E 96EF      ADIW	R28,0x3F
    0085F 96EF      ADIW	R28,0x3F
    00860 96EF      ADIW	R28,0x3F
    00861 96EF      ADIW	R28,0x3F
    00862 96EF      ADIW	R28,0x3F
    00863 96EF      ADIW	R28,0x3F
    00864 96A8      ADIW	R28,0x28
    00865 940E 4B12 CALL	pop_xgsetF0FC
    00867 9622      ADIW	R28,2
    00868 9508      RET
_Round:
  x                    --> Y,+0
    00869 940E 49D8 CALL	push_arg4
(0303) }
(0304) float Round(float x){
(0305)     x=x*10;
    0086B ED04      LDI	R16,0xD4
    0086C E010      LDI	R17,0
    0086D 940E 4AA5 CALL	elpm32
    0086F 01CE      MOVW	R24,R28
    00870 939A      ST	-Y,R25
    00871 938A      ST	-Y,R24
    00872 940E 4E63 CALL	fpmule1
    00874 8308      ST	Y,R16
    00875 8319      STD	Y+1,R17
    00876 832A      STD	Y+2,R18
    00877 833B      STD	Y+3,R19
(0306) 	if(x >=0) x+=0.5;
    00878 8028      LD	R2,Y
    00879 8039      LDD	R3,Y+1
    0087A 804A      LDD	R4,Y+2
    0087B 805B      LDD	R5,Y+3
    0087C ED08      LDI	R16,0xD8
    0087D E010      LDI	R17,0
    0087E 940E 4AA5 CALL	elpm32
    00880 933A      ST	-Y,R19
    00881 932A      ST	-Y,R18
    00882 931A      ST	-Y,R17
    00883 930A      ST	-Y,R16
    00884 0181      MOVW	R16,R2
    00885 0192      MOVW	R18,R4
    00886 940E 4E9D CALL	fpcmp2
    00888 F0AC      BLT	0x089E
    00889 8028      LD	R2,Y
    0088A 8039      LDD	R3,Y+1
    0088B 804A      LDD	R4,Y+2
    0088C 805B      LDD	R5,Y+3
    0088D ED00      LDI	R16,0xD0
    0088E E010      LDI	R17,0
    0088F 940E 4AA5 CALL	elpm32
    00891 933A      ST	-Y,R19
    00892 932A      ST	-Y,R18
    00893 931A      ST	-Y,R17
    00894 930A      ST	-Y,R16
    00895 0181      MOVW	R16,R2
    00896 0192      MOVW	R18,R4
    00897 940E 4C59 CALL	fpadd2
    00899 8308      ST	Y,R16
    0089A 8319      STD	Y+1,R17
    0089B 832A      STD	Y+2,R18
    0089C 833B      STD	Y+3,R19
    0089D C014      RJMP	0x08B2
(0307) 	else x-=0.5;
    0089E 8028      LD	R2,Y
    0089F 8039      LDD	R3,Y+1
    008A0 804A      LDD	R4,Y+2
    008A1 805B      LDD	R5,Y+3
    008A2 ED00      LDI	R16,0xD0
    008A3 E010      LDI	R17,0
    008A4 940E 4AA5 CALL	elpm32
    008A6 933A      ST	-Y,R19
    008A7 932A      ST	-Y,R18
    008A8 931A      ST	-Y,R17
    008A9 930A      ST	-Y,R16
    008AA 0181      MOVW	R16,R2
    008AB 0192      MOVW	R18,R4
    008AC 940E 4C6E CALL	fpsub2
    008AE 8308      ST	Y,R16
    008AF 8319      STD	Y+1,R17
    008B0 832A      STD	Y+2,R18
    008B1 833B      STD	Y+3,R19
(0308) 	x=(int)x;
    008B2 8108      LD	R16,Y
    008B3 8119      LDD	R17,Y+1
    008B4 812A      LDD	R18,Y+2
    008B5 813B      LDD	R19,Y+3
    008B6 940E 4C94 CALL	fpint
    008B8 940E 4CC8 CALL	int2fp
    008BA 8308      ST	Y,R16
    008BB 8319      STD	Y+1,R17
    008BC 832A      STD	Y+2,R18
    008BD 833B      STD	Y+3,R19
(0309) 	x=x/10.0;
    008BE 8028      LD	R2,Y
    008BF 8039      LDD	R3,Y+1
    008C0 804A      LDD	R4,Y+2
    008C1 805B      LDD	R5,Y+3
    008C2 EC0C      LDI	R16,0xCC
    008C3 E010      LDI	R17,0
    008C4 940E 4AA5 CALL	elpm32
    008C6 933A      ST	-Y,R19
    008C7 932A      ST	-Y,R18
    008C8 931A      ST	-Y,R17
    008C9 930A      ST	-Y,R16
    008CA 0181      MOVW	R16,R2
    008CB 0192      MOVW	R18,R4
    008CC 940E 4CF3 CALL	fpdiv2
    008CE 8308      ST	Y,R16
    008CF 8319      STD	Y+1,R17
    008D0 832A      STD	Y+2,R18
    008D1 833B      STD	Y+3,R19
(0310) 	return x;
    008D2 8108      LD	R16,Y
    008D3 8119      LDD	R17,Y+1
    008D4 812A      LDD	R18,Y+2
    008D5 813B      LDD	R19,Y+3
    008D6 9624      ADIW	R28,4
    008D7 9508      RET
_check:
  WScounter            --> R10
  tmp                  --> R12
    008D8 940E 4B23 CALL	push_xgset003C
    008DA 9724      SBIW	R28,4
(0311) }
(0312) 
(0313) void check( void )
(0314) {
(0315)  unsigned char tmp;
(0316)  unsigned int WScounter;
(0317)  //检测风速
(0318)  //读计数器1 此步需严格按手册进行。
(0319)  tmp=SREG;
    008DB B6CF      IN	R12,0x3F
(0320)  CLI();
    008DC 94F8      BCLR	7
(0321)  WScounter=TCNT1H*256+TCNT1L;
    008DD B52D      IN	R18,0x2D
    008DE 2733      CLR	R19
    008DF E000      LDI	R16,0
    008E0 E011      LDI	R17,1
    008E1 940E 4AB9 CALL	empy16s
    008E3 0158      MOVW	R10,R16
    008E4 B42C      IN	R2,0x2C
    008E5 2433      CLR	R3
    008E6 0CA2      ADD	R10,R2
    008E7 1CB3      ADC	R11,R3
(0322)  SREG=tmp;
    008E8 BECF      OUT	0x3F,R12
(0323)  SEI();
    008E9 9478      BSET	7
(0324)  //计算风速
(0325)  Result.WindSpeed=WScounter/N_per_Second;
    008EA 0185      MOVW	R16,R10
    008EB 940E 4CC6 CALL	uint2fp
    008ED 0118      MOVW	R2,R16
    008EE 0129      MOVW	R4,R18
    008EF EC08      LDI	R16,0xC8
    008F0 E010      LDI	R17,0
    008F1 940E 4AA5 CALL	elpm32
    008F3 933A      ST	-Y,R19
    008F4 932A      ST	-Y,R18
    008F5 931A      ST	-Y,R17
    008F6 930A      ST	-Y,R16
    008F7 0181      MOVW	R16,R2
    008F8 0192      MOVW	R18,R4
    008F9 940E 4CF3 CALL	fpdiv2
    008FB 9310 066D STS	Result+52,R17
    008FD 9300 066C STS	Result+51,R16
    008FF 9330 066F STS	Result+54,R19
    00901 9320 066E STS	Result+53,R18
(0326)  //四舍五入
(0327)  Result.WindSpeed=Round(Result.WindSpeed);
    00903 DF65      RCALL	_Round
    00904 9310 066D STS	Result+52,R17
    00906 9300 066C STS	Result+51,R16
    00908 9330 066F STS	Result+54,R19
    0090A 9320 066E STS	Result+53,R18
(0328)   //温度
(0329)  Result.Temperature=read_T_NUM(OUTSIDE_SENSOR); //读两次 避免出错
    0090C E001      LDI	R16,1
    0090D 940E 442D CALL	_read_T_NUM
    0090F 9310 0663 STS	Result+42,R17
    00911 9300 0662 STS	Result+41,R16
    00913 9330 0665 STS	Result+44,R19
    00915 9320 0664 STS	Result+43,R18
(0330)  Result.Temperature=read_T_NUM(OUTSIDE_SENSOR);
    00917 E001      LDI	R16,1
    00918 940E 442D CALL	_read_T_NUM
    0091A 9310 0663 STS	Result+42,R17
    0091C 9300 0662 STS	Result+41,R16
    0091E 9330 0665 STS	Result+44,R19
    00920 9320 0664 STS	Result+43,R18
(0331)  //四舍五入
(0332)  Result.Temperature=Round(Result.Temperature);
    00922 DF46      RCALL	_Round
    00923 9310 0663 STS	Result+42,R17
    00925 9300 0662 STS	Result+41,R16
    00927 9330 0665 STS	Result+44,R19
    00929 9320 0664 STS	Result+43,R18
(0333)  //WCI风冷指数
(0334)  Result.WCI = 4.18 *(10*SquareRootFloat(Result.WindSpeed) + 10.45 -  Result.WindSpeed  ) *( 33 - Result.Temperature );
    0092B 9120 066E LDS	R18,Result+53
    0092D 9130 066F LDS	R19,Result+54
    0092F 9100 066C LDS	R16,Result+51
    00931 9110 066D LDS	R17,Result+52
    00933 D1FB      RCALL	_SquareRootFloat
    00934 0118      MOVW	R2,R16
    00935 0129      MOVW	R4,R18
    00936 EC04      LDI	R16,0xC4
    00937 E010      LDI	R17,0
    00938 940E 4AA5 CALL	elpm32
    0093A 0138      MOVW	R6,R16
    0093B 0149      MOVW	R8,R18
    0093C ED04      LDI	R16,0xD4
    0093D E010      LDI	R17,0
    0093E 940E 4AA5 CALL	elpm32
    00940 925A      ST	-Y,R5
    00941 924A      ST	-Y,R4
    00942 923A      ST	-Y,R3
    00943 922A      ST	-Y,R2
    00944 940E 4E6D CALL	fpmule2
    00946 0118      MOVW	R2,R16
    00947 0129      MOVW	R4,R18
    00948 EC00      LDI	R16,0xC0
    00949 E010      LDI	R17,0
    0094A 940E 4AA5 CALL	elpm32
    0094C 933A      ST	-Y,R19
    0094D 932A      ST	-Y,R18
    0094E 931A      ST	-Y,R17
    0094F 930A      ST	-Y,R16
    00950 0181      MOVW	R16,R2
    00951 0192      MOVW	R18,R4
    00952 940E 4C59 CALL	fpadd2
    00954 E68C      LDI	R24,0x6C
    00955 E096      LDI	R25,6
    00956 939A      ST	-Y,R25
    00957 938A      ST	-Y,R24
    00958 940E 4C79 CALL	fpsub1x
    0095A 0183      MOVW	R16,R6
    0095B 0194      MOVW	R18,R8
    0095C 940E 4E6D CALL	fpmule2
    0095E 0118      MOVW	R2,R16
    0095F 0129      MOVW	R4,R18
    00960 EB0C      LDI	R16,0xBC
    00961 E010      LDI	R17,0
    00962 940E 4AA5 CALL	elpm32
    00964 E682      LDI	R24,0x62
    00965 E096      LDI	R25,6
    00966 939A      ST	-Y,R25
    00967 938A      ST	-Y,R24
    00968 940E 4C79 CALL	fpsub1x
    0096A 0181      MOVW	R16,R2
    0096B 0192      MOVW	R18,R4
    0096C 940E 4E6D CALL	fpmule2
    0096E 9310 0676 STS	Result+61,R17
    00970 9300 0675 STS	Result+60,R16
    00972 9330 0678 STS	Result+63,R19
    00974 9320 0677 STS	Result+62,R18
(0335)  //ECT等价制冷温度
(0336)  Result.ECT=33.0f - 0.01085f*Result.WCI;
    00976 EB0C      LDI	R16,0xBC
    00977 E010      LDI	R17,0
    00978 940E 4AA5 CALL	elpm32
    0097A 0118      MOVW	R2,R16
    0097B 0129      MOVW	R4,R18
    0097C EB08      LDI	R16,0xB8
    0097D E010      LDI	R17,0
    0097E 940E 4AA5 CALL	elpm32
    00980 E785      LDI	R24,0x75
    00981 E096      LDI	R25,6
    00982 939A      ST	-Y,R25
    00983 938A      ST	-Y,R24
    00984 940E 4E78 CALL	fpmule1x
    00986 0181      MOVW	R16,R2
    00987 0192      MOVW	R18,R4
    00988 940E 4C6E CALL	fpsub2
    0098A 9310 0682 STS	Result+73,R17
    0098C 9300 0681 STS	Result+72,R16
    0098E 9330 0684 STS	Result+75,R19
    00990 9320 0683 STS	Result+74,R18
(0337)  //TEQ 相当温度
(0338)  Result.Teq = Result.Temperature +( (Result.Temperature -36)/10 ) * Result.WindSpeed ;
    00992 9040 0664 LDS	R4,Result+43
    00994 9050 0665 LDS	R5,Result+44
    00996 9020 0662 LDS	R2,Result+41
    00998 9030 0663 LDS	R3,Result+42
    0099A 0131      MOVW	R6,R2
    0099B 0142      MOVW	R8,R4
    0099C EB04      LDI	R16,0xB4
    0099D E010      LDI	R17,0
    0099E 940E 4AA5 CALL	elpm32
    009A0 933A      ST	-Y,R19
    009A1 932A      ST	-Y,R18
    009A2 931A      ST	-Y,R17
    009A3 930A      ST	-Y,R16
    009A4 0183      MOVW	R16,R6
    009A5 0194      MOVW	R18,R8
    009A6 940E 4C6E CALL	fpsub2
    009A8 0138      MOVW	R6,R16
    009A9 0149      MOVW	R8,R18
    009AA ED04      LDI	R16,0xD4
    009AB E010      LDI	R17,0
    009AC 940E 4AA5 CALL	elpm32
    009AE 933A      ST	-Y,R19
    009AF 932A      ST	-Y,R18
    009B0 931A      ST	-Y,R17
    009B1 930A      ST	-Y,R16
    009B2 0183      MOVW	R16,R6
    009B3 0194      MOVW	R18,R8
    009B4 940E 4CF3 CALL	fpdiv2
    009B6 E68C      LDI	R24,0x6C
    009B7 E096      LDI	R25,6
    009B8 939A      ST	-Y,R25
    009B9 938A      ST	-Y,R24
    009BA 940E 4E78 CALL	fpmule1x
    009BC 0181      MOVW	R16,R2
    009BD 0192      MOVW	R18,R4
    009BE 940E 4C59 CALL	fpadd2
    009C0 9310 068C STS	Result+83,R17
    009C2 9300 068B STS	Result+82,R16
    009C4 9330 068E STS	Result+85,R19
    009C6 9320 068D STS	Result+84,R18
(0339) //将数据转换成字符串
(0340) sprintf(Result.WSChar, "%#.1lf", (float)Result.WindSpeed);
    009C8 9040 066E LDS	R4,Result+53
    009CA 9050 066F LDS	R5,Result+54
    009CC 9020 066C LDS	R2,Result+51
    009CE 9030 066D LDS	R3,Result+52
    009D0 8228      ST	Y,R2
    009D1 8239      STD	Y+1,R3
    009D2 824A      STD	Y+2,R4
    009D3 825B      STD	Y+3,R5
    009D4 ED26      LDI	R18,0xD6
    009D5 E031      LDI	R19,1
    009D6 E700      LDI	R16,0x70
    009D7 E016      LDI	R17,6
    009D8 940E 529A CALL	_sprintf
(0341) sprintf(Result.TempChar, "%#.1lf", (float)Result.Temperature); //PrintString_n(Result.TempChar);
    009DA 9040 0664 LDS	R4,Result+43
    009DC 9050 0665 LDS	R5,Result+44
    009DE 9020 0662 LDS	R2,Result+41
    009E0 9030 0663 LDS	R3,Result+42
    009E2 8228      ST	Y,R2
    009E3 8239      STD	Y+1,R3
    009E4 824A      STD	Y+2,R4
    009E5 825B      STD	Y+3,R5
    009E6 ED26      LDI	R18,0xD6
    009E7 E031      LDI	R19,1
    009E8 E606      LDI	R16,0x66
    009E9 E016      LDI	R17,6
    009EA 940E 529A CALL	_sprintf
(0342) sprintf(Result.WCIChar, "%#.1lf",  (float)Result.WCI); //PrintString_n(Result.WCIChar);
    009EC 9040 0677 LDS	R4,Result+62
    009EE 9050 0678 LDS	R5,Result+63
    009F0 9020 0675 LDS	R2,Result+60
    009F2 9030 0676 LDS	R3,Result+61
    009F4 8228      ST	Y,R2
    009F5 8239      STD	Y+1,R3
    009F6 824A      STD	Y+2,R4
    009F7 825B      STD	Y+3,R5
    009F8 ED26      LDI	R18,0xD6
    009F9 E031      LDI	R19,1
    009FA E709      LDI	R16,0x79
    009FB E016      LDI	R17,6
    009FC 940E 529A CALL	_sprintf
(0343) sprintf(Result.ECTChar, "%#.1lf", (float)Result.ECT);  //PrintString_n(Result.ECTChar);
    009FE 9040 0683 LDS	R4,Result+74
    00A00 9050 0684 LDS	R5,Result+75
    00A02 9020 0681 LDS	R2,Result+72
    00A04 9030 0682 LDS	R3,Result+73
    00A06 8228      ST	Y,R2
    00A07 8239      STD	Y+1,R3
    00A08 824A      STD	Y+2,R4
    00A09 825B      STD	Y+3,R5
    00A0A ED26      LDI	R18,0xD6
    00A0B E031      LDI	R19,1
    00A0C E805      LDI	R16,0x85
    00A0D E016      LDI	R17,6
    00A0E 940E 529A CALL	_sprintf
(0344) sprintf(Result.TeqChar, "%#.1lf", (float)Result.Teq);
    00A10 9040 068D LDS	R4,Result+84
    00A12 9050 068E LDS	R5,Result+85
    00A14 9020 068B LDS	R2,Result+82
    00A16 9030 068C LDS	R3,Result+83
    00A18 8228      ST	Y,R2
    00A19 8239      STD	Y+1,R3
    00A1A 824A      STD	Y+2,R4
    00A1B 825B      STD	Y+3,R5
    00A1C ED26      LDI	R18,0xD6
    00A1D E031      LDI	R19,1
    00A1E E80F      LDI	R16,0x8F
    00A1F E016      LDI	R17,6
    00A20 940E 529A CALL	_sprintf
(0345) sprintf(Result.IndexChar, "%d", Result.Index);
    00A22 9040 0645 LDS	R4,Result+12
    00A24 9050 0646 LDS	R5,Result+13
    00A26 9020 0643 LDS	R2,Result+10
    00A28 9030 0644 LDS	R3,Result+11
    00A2A 8228      ST	Y,R2
    00A2B 8239      STD	Y+1,R3
    00A2C 824A      STD	Y+2,R4
    00A2D 825B      STD	Y+3,R5
    00A2E ED23      LDI	R18,0xD3
    00A2F E031      LDI	R19,1
    00A30 E407      LDI	R16,0x47
    00A31 E016      LDI	R17,6
    00A32 940E 529A CALL	_sprintf
(0346) Result.TempChar[6]='\0';
    00A34 2422      CLR	R2
    00A35 9220 066C STS	Result+51,R2
(0347) Result.WSChar[5]='\0';
    00A37 9220 0675 STS	Result+60,R2
(0348) Result.WCIChar[7]='\0';
    00A39 9220 0680 STS	Result+71,R2
(0349) Result.ECTChar[6]='\0';
    00A3B 9220 068B STS	Result+82,R2
(0350) Result.TeqChar[6]='\0';
    00A3D 9220 0695 STS	Result+92,R2
(0351)  return ;
    00A3F 9624      ADIW	R28,4
    00A40 940C 4AFD JMP	pop_xgset003C
_StructToChar:
  otherbyte            --> Y,+16
  ary                  --> Y,+0
  i                    --> R10
    00A42 92AA      ST	-Y,R10
    00A43 9768      SBIW	R28,0x18
(0352) }
(0353) /*
(0354) ////////////////////////////////////////////
(0355) //				字符串转换函数
(0356) //   浮点 到  字符串
(0357) ////////////////////////////////////////////
(0358) void ftochr(float a,char * dest){//float
(0359) char i=0,j=0,lenth;
(0360) int status;
(0361) char *res;
(0362)  res=ftoa(a,&status);  //float to ascii
(0363) lenth=strlen(res);
(0364) 
(0365) for(i=0;i <lenth;i++) 
(0366)        {
(0367) 	   	dest[i]=res[i];
(0368) 
(0369) 		if( res[i]=='.'  ) 
(0370) 			{
(0371) 				dest[i+1]=res[i+1];
(0372) 					dest[i+2]='\0';
(0373) 						return ;    
(0374) 		    }
(0375)  
(0376)  		}
(0377) }
(0378) //////////////////////////////////////////////////////
(0379) //              整型数据变字符串
(0380) //    a  到  dest
(0381) ///////////////////////////////////////////////////////
(0382) void itochr(int a,char * dest){ //int to ascii
(0383) 	 itoa(dest,a,10); 
(0384) }
(0385) */
(0386) //////////////////////////////////////////////////////
(0387) //                  结构体 变字符串
(0388) // 将目前存于结构体的数据转换到Temp_Char中。
(0389) ///////////////////////////////////////////////////////
(0390) void  StructToChar(void)
(0391) { 
(0392)   unsigned char i;
(0393)   char otherbyte[]="0\t0\t0\t0";
    00A44 EA85      LDI	R24,0xA5
    00A45 E091      LDI	R25,1
    00A46 01FE      MOVW	R30,R28
    00A47 9670      ADIW	R30,0x10
    00A48 E008      LDI	R16,0x8
    00A49 E010      LDI	R17,0
    00A4A 93FA      ST	-Y,R31
    00A4B 93EA      ST	-Y,R30
    00A4C 939A      ST	-Y,R25
    00A4D 938A      ST	-Y,R24
    00A4E 940E 4BCD CALL	asgnblk
(0394)   char *(ary[])={Result.IndexChar,Result.Date,Result.Time,
    00A50 EA8D      LDI	R24,0xAD
    00A51 E091      LDI	R25,1
    00A52 01FE      MOVW	R30,R28
    00A53 E100      LDI	R16,0x10
    00A54 E010      LDI	R17,0
    00A55 93FA      ST	-Y,R31
    00A56 93EA      ST	-Y,R30
    00A57 939A      ST	-Y,R25
    00A58 938A      ST	-Y,R24
    00A59 940E 4BCD CALL	asgnblk
(0395)  	  			Result.TempChar,Result.WSChar,Result.WCIChar,Result.ECTChar,
(0396) 				Result.TeqChar
(0397) 			   };  //指向数组首地址的指针
(0398)   //strcat(Temp_Char,Result.Name);
(0399)   for(i=0;i<=80;i++) TempChar[i]='\0';  //清空数组
    00A5B 24AA      CLR	R10
    00A5C C009      RJMP	0x0A66
    00A5D EE89      LDI	R24,0xE9
    00A5E E095      LDI	R25,5
    00A5F 2DEA      MOV	R30,R10
    00A60 27FF      CLR	R31
    00A61 0FE8      ADD	R30,R24
    00A62 1FF9      ADC	R31,R25
    00A63 2422      CLR	R2
    00A64 8220      ST	Z,R2
    00A65 94A3      INC	R10
    00A66 E580      LDI	R24,0x50
    00A67 158A      CP	R24,R10
    00A68 F7A0      BCC	0x0A5D
(0400)     for(i=0;i<=7;i++){
    00A69 24AA      CLR	R10
    00A6A C014      RJMP	0x0A7F
(0401) 		strcat(TempChar,ary[i]);  // 按顺序复制字符串
    00A6B 01CE      MOVW	R24,R28
    00A6C 2DEA      MOV	R30,R10
    00A6D 27FF      CLR	R31
    00A6E 0FEE      LSL	R30
    00A6F 1FFF      ROL	R31
    00A70 0FE8      ADD	R30,R24
    00A71 1FF9      ADC	R31,R25
    00A72 8120      LD	R18,Z
    00A73 8131      LDD	R19,Z+1
    00A74 EE09      LDI	R16,0xE9
    00A75 E015      LDI	R17,5
    00A76 940E 49BF CALL	_strcat
(0402) 		strcat(TempChar,tab);     // 字串结尾加上制表符
    00A78 E020      LDI	R18,0
    00A79 E031      LDI	R19,1
    00A7A EE09      LDI	R16,0xE9
    00A7B E015      LDI	R17,5
    00A7C 940E 49BF CALL	_strcat
    00A7E 94A3      INC	R10
    00A7F E087      LDI	R24,7
    00A80 158A      CP	R24,R10
    00A81 F748      BCC	0x0A6B
(0403)     }
(0404) 				 
(0405) 				 otherbyte[0]=otherbyte[0]+Result.WeiHai;
    00A82 9020 0695 LDS	R2,Result+92
    00A84 8838      LDD	R3,Y+16
    00A85 0C32      ADD	R3,R2
    00A86 8A38      STD	Y+16,R3
(0406) 				 otherbyte[2]=otherbyte[0]+Result.LowLabor;
    00A87 9020 0696 LDS	R2,Result+93
    00A89 0C32      ADD	R3,R2
    00A8A 8A3A      STD	Y+18,R3
(0407) 				 otherbyte[4]=otherbyte[0]+Result.MidLabor;
    00A8B 9020 0697 LDS	R2,Result+94
    00A8D 8838      LDD	R3,Y+16
    00A8E 0C32      ADD	R3,R2
    00A8F 8A3C      STD	Y+20,R3
(0408) 				 otherbyte[6]=otherbyte[0]+Result.HighLabor;
    00A90 9020 0698 LDS	R2,Result+95
    00A92 8838      LDD	R3,Y+16
    00A93 0C32      ADD	R3,R2
    00A94 8A3E      STD	Y+22,R3
(0409)  
(0410)   strcat(TempChar,otherbyte);  
    00A95 019E      MOVW	R18,R28
    00A96 5F20      SUBI	R18,0xF0
    00A97 4F3F      SBCI	R19,0xFF
    00A98 EE09      LDI	R16,0xE9
    00A99 E015      LDI	R17,5
    00A9A 940E 49BF CALL	_strcat
(0411)   strcat(TempChar,enter);  
    00A9C E023      LDI	R18,3
    00A9D E031      LDI	R19,1
    00A9E EE09      LDI	R16,0xE9
    00A9F E015      LDI	R17,5
    00AA0 940E 49BF CALL	_strcat
(0412)   strcat(TempChar,"\0");
    00AA2 ED21      LDI	R18,0xD1
    00AA3 E031      LDI	R19,1
    00AA4 EE09      LDI	R16,0xE9
    00AA5 E015      LDI	R17,5
    00AA6 940E 49BF CALL	_strcat
    00AA8 9668      ADIW	R28,0x18
    00AA9 90A9      LD	R10,Y+
    00AAA 9508      RET
_CharToStruct:
  ary                  --> Y,+0
  j                    --> R12
  p                    --> R10
  q                    --> R20
  buf                  --> R14
    00AAB 940E 4B1F CALL	push_xgset30FC
    00AAD 0178      MOVW	R14,R16
    00AAE 9760      SBIW	R28,0x10
(0413) }
(0414) 
(0415) //////////////////////////////////////////////////////
(0416) //               字符串  变  结构体
(0417) // 
(0418) ///////////////////////////////////////////////////////
(0419) void CharToStruct(char *buf)
(0420) {
(0421)   unsigned char j=0;
    00AAF 24CC      CLR	R12
(0422)   unsigned char *p,*q;
(0423)   char *(ary[])={Result.IndexChar,Result.Date,Result.Time,
    00AB0 EB8D      LDI	R24,0xBD
    00AB1 E091      LDI	R25,1
    00AB2 01FE      MOVW	R30,R28
    00AB3 E100      LDI	R16,0x10
    00AB4 E010      LDI	R17,0
    00AB5 93FA      ST	-Y,R31
    00AB6 93EA      ST	-Y,R30
    00AB7 939A      ST	-Y,R25
    00AB8 938A      ST	-Y,R24
    00AB9 940E 4BCD CALL	asgnblk
(0424)  	  			Result.TempChar,Result.WSChar,Result.WCIChar,Result.ECTChar,
(0425) 				Result.TeqChar
(0426) 			   };  //指向数组首地址的指针
(0427)     p=ary[j];
    00ABB 01CE      MOVW	R24,R28
    00ABC 2DEC      MOV	R30,R12
    00ABD 27FF      CLR	R31
    00ABE 0FEE      LSL	R30
    00ABF 1FFF      ROL	R31
    00AC0 0FE8      ADD	R30,R24
    00AC1 1FF9      ADC	R31,R25
    00AC2 80A0      LD	R10,Z
    00AC3 80B1      LDD	R11,Z+1
(0428) 	q=buf;
    00AC4 01A7      MOVW	R20,R14
    00AC5 C026      RJMP	0x0AEC
(0429) 	
(0430) 	while(1){
(0431)     if(*q =='\n') {*p='\0'; return;} ;
    00AC6 01FA      MOVW	R30,R20
    00AC7 8180      LD	R24,Z
    00AC8 308A      CPI	R24,0xA
    00AC9 F421      BNE	0x0ACE
    00ACA 2422      CLR	R2
    00ACB 01F5      MOVW	R30,R10
    00ACC 8220      ST	Z,R2
    00ACD C01F      RJMP	0x0AED
(0432) 	if(*q =='\t') {
    00ACE 01FA      MOVW	R30,R20
    00ACF 8180      LD	R24,Z
    00AD0 3089      CPI	R24,0x9
    00AD1 F4A1      BNE	0x0AE6
(0433) 		*p='\0';
    00AD2 2422      CLR	R2
    00AD3 01F5      MOVW	R30,R10
    00AD4 8220      ST	Z,R2
(0434) 		q++;
    00AD5 5F4F      SUBI	R20,0xFF
    00AD6 4F5F      SBCI	R21,0xFF
(0435) 	    if(j>7) break ;
    00AD7 E087      LDI	R24,7
    00AD8 158C      CP	R24,R12
    00AD9 F408      BCC	0x0ADB
    00ADA C012      RJMP	0x0AED
(0436) 		j++;
    00ADB 94C3      INC	R12
(0437) 		p=ary[j];
    00ADC 01CE      MOVW	R24,R28
    00ADD 2DEC      MOV	R30,R12
    00ADE 27FF      CLR	R31
    00ADF 0FEE      LSL	R30
    00AE0 1FFF      ROL	R31
    00AE1 0FE8      ADD	R30,R24
    00AE2 1FF9      ADC	R31,R25
    00AE3 80A0      LD	R10,Z
    00AE4 80B1      LDD	R11,Z+1
(0438) 		continue ;
    00AE5 C006      RJMP	0x0AEC
(0439) 	}
(0440)     *p++=*q++;
    00AE6 01FA      MOVW	R30,R20
    00AE7 01D5      MOVW	R26,R10
    00AE8 9001      LD	R0,Z+
    00AE9 01AF      MOVW	R20,R30
    00AEA 920D      ST	X+,R0
    00AEB 015D      MOVW	R10,R26
    00AEC CFD9      RJMP	0x0AC6
    00AED 9660      ADIW	R28,0x10
    00AEE 940C 4B09 JMP	pop_xgset30FC
_get_name:
  i                    --> R20
  filenamep            --> R16
    00AF0 940E 4B32 CALL	push_xgsetF000
(0441) 	}
(0442) 	return ;
(0443) }
(0444)  
(0445)  ////////////////////////////////////////////
(0446) //				根据当前日期获取文件名
(0447) //   
(0448) ////////////////////////////////////////////
(0449) char *get_name( char filenamep[] ){     
(0450) 	  unsigned char i=0;
(0451)  	  for(i=0;i<6;i++) {
    00AF2 2744      CLR	R20
    00AF3 C00D      RJMP	0x0B01
(0452) 	  				    *(filenamep+i)=Result.Date[i];
    00AF4 E48F      LDI	R24,0x4F
    00AF5 E096      LDI	R25,6
    00AF6 2FE4      MOV	R30,R20
    00AF7 27FF      CLR	R31
    00AF8 0FE8      ADD	R30,R24
    00AF9 1FF9      ADC	R31,R25
    00AFA 8020      LD	R2,Z
    00AFB 2FE4      MOV	R30,R20
    00AFC 27FF      CLR	R31
    00AFD 0FE0      ADD	R30,R16
    00AFE 1FF1      ADC	R31,R17
    00AFF 8220      ST	Z,R2
    00B00 9543      INC	R20
    00B01 3046      CPI	R20,6
    00B02 F388      BCS	0x0AF4
(0453) 	  				   } 
(0454) 	 	*(filenamep+(i++))='.';
    00B03 2E24      MOV	R2,R20
    00B04 2433      CLR	R3
    00B05 5F4F      SUBI	R20,0xFF
    00B06 2DE2      MOV	R30,R2
    00B07 27FF      CLR	R31
    00B08 0FE0      ADD	R30,R16
    00B09 1FF1      ADC	R31,R17
    00B0A E28E      LDI	R24,0x2E
    00B0B 8380      ST	Z,R24
(0455) 		*(filenamep+(i++))='x';
    00B0C 2E24      MOV	R2,R20
    00B0D 2433      CLR	R3
    00B0E 5F4F      SUBI	R20,0xFF
    00B0F 2DE2      MOV	R30,R2
    00B10 27FF      CLR	R31
    00B11 0FE0      ADD	R30,R16
    00B12 1FF1      ADC	R31,R17
    00B13 E788      LDI	R24,0x78
    00B14 8380      ST	Z,R24
(0456) 		*(filenamep+(i++))='l';
    00B15 2F64      MOV	R22,R20
    00B16 2777      CLR	R23
    00B17 5F4F      SUBI	R20,0xFF
    00B18 2FE6      MOV	R30,R22
    00B19 27FF      CLR	R31
    00B1A 0FE0      ADD	R30,R16
    00B1B 1FF1      ADC	R31,R17
    00B1C E68C      LDI	R24,0x6C
    00B1D 8380      ST	Z,R24
(0457) 		*(filenamep+(i++))='s';
    00B1E 2F64      MOV	R22,R20
    00B1F 2777      CLR	R23
    00B20 5F4F      SUBI	R20,0xFF
    00B21 2FE6      MOV	R30,R22
    00B22 27FF      CLR	R31
    00B23 0FE0      ADD	R30,R16
    00B24 1FF1      ADC	R31,R17
    00B25 E783      LDI	R24,0x73
    00B26 8380      ST	Z,R24
(0458) 		*(filenamep+(i))='\0';
    00B27 2FE4      MOV	R30,R20
    00B28 27FF      CLR	R31
    00B29 0FE0      ADD	R30,R16
    00B2A 1FF1      ADC	R31,R17
    00B2B 2422      CLR	R2
    00B2C 8220      ST	Z,R2
(0459) 					   
(0460)       return filenamep;
    00B2D 940C 4B37 JMP	pop_xgsetF000
_SquareRootFloat:
  f                    --> Y,+12
  x                    --> Y,+8
  i                    --> Y,+4
  y                    --> Y,+0
  number               --> Y,+20
    00B2F 940E 49D8 CALL	push_arg4
    00B31 940E 4B32 CALL	push_xgsetF000
    00B33 9760      SBIW	R28,0x10
(0461) } 
(0462) float SquareRootFloat(float number)
(0463) {
(0464)     long i;
(0465)     float x, y;
(0466)     const float f = 1.5F;
    00B34 EB00      LDI	R16,0xB0
    00B35 E010      LDI	R17,0
    00B36 940E 4AA5 CALL	elpm32
    00B38 870C      STD	Y+12,R16
    00B39 871D      STD	Y+13,R17
    00B3A 872E      STD	Y+14,R18
    00B3B 873F      STD	Y+15,R19
(0467)     x = number * 0.5F;
    00B3C EA0C      LDI	R16,0xAC
    00B3D E010      LDI	R17,0
    00B3E 940E 4AA5 CALL	elpm32
    00B40 01CE      MOVW	R24,R28
    00B41 9644      ADIW	R24,0x14
    00B42 939A      ST	-Y,R25
    00B43 938A      ST	-Y,R24
    00B44 940E 4E63 CALL	fpmule1
    00B46 8708      STD	Y+8,R16
    00B47 8719      STD	Y+9,R17
    00B48 872A      STD	Y+10,R18
    00B49 873B      STD	Y+11,R19
(0468)     y  = number;
    00B4A 882C      LDD	R2,Y+20
    00B4B 883D      LDD	R3,Y+21
    00B4C 884E      LDD	R4,Y+22
    00B4D 885F      LDD	R5,Y+23
    00B4E 8228      ST	Y,R2
    00B4F 8239      STD	Y+1,R3
    00B50 824A      STD	Y+2,R4
    00B51 825B      STD	Y+3,R5
(0469)     i  = * ( long * ) &y;
    00B52 01FE      MOVW	R30,R28
    00B53 8020      LD	R2,Z
    00B54 8031      LDD	R3,Z+1
    00B55 8042      LDD	R4,Z+2
    00B56 8053      LDD	R5,Z+3
    00B57 822C      STD	Y+4,R2
    00B58 823D      STD	Y+5,R3
    00B59 824E      STD	Y+6,R4
    00B5A 825F      STD	Y+7,R5
(0470)     i  = 0x5f3759df - ( i >> 1 );  //卡马克
    00B5B 802C      LDD	R2,Y+4
    00B5C 803D      LDD	R3,Y+5
    00B5D 804E      LDD	R4,Y+6
    00B5E 805F      LDD	R5,Y+7
    00B5F 9455      ASR	R5
    00B60 9447      ROR	R4
    00B61 9437      ROR	R3
    00B62 9427      ROR	R2
    00B63 ED4F      LDI	R20,0xDF
    00B64 E559      LDI	R21,0x59
    00B65 E367      LDI	R22,0x37
    00B66 E57F      LDI	R23,0x5F
    00B67 1942      SUB	R20,R2
    00B68 0953      SBC	R21,R3
    00B69 0964      SBC	R22,R4
    00B6A 0975      SBC	R23,R5
    00B6B 834C      STD	Y+4,R20
    00B6C 835D      STD	Y+5,R21
    00B6D 836E      STD	Y+6,R22
    00B6E 837F      STD	Y+7,R23
(0471)   //i  = 0x5f375a86 - ( i >> 1 );  //Lomont
(0472)     y  = * ( float * ) &i;
    00B6F 01FE      MOVW	R30,R28
    00B70 9634      ADIW	R30,4
    00B71 8020      LD	R2,Z
    00B72 8031      LDD	R3,Z+1
    00B73 8042      LDD	R4,Z+2
    00B74 8053      LDD	R5,Z+3
    00B75 8228      ST	Y,R2
    00B76 8239      STD	Y+1,R3
    00B77 824A      STD	Y+2,R4
    00B78 825B      STD	Y+3,R5
(0473)     y  = y * ( f - ( x * y * y ) );
    00B79 8028      LD	R2,Y
    00B7A 8039      LDD	R3,Y+1
    00B7B 804A      LDD	R4,Y+2
    00B7C 805B      LDD	R5,Y+3
    00B7D 846C      LDD	R6,Y+12
    00B7E 847D      LDD	R7,Y+13
    00B7F 848E      LDD	R8,Y+14
    00B80 849F      LDD	R9,Y+15
    00B81 8508      LDD	R16,Y+8
    00B82 8519      LDD	R17,Y+9
    00B83 852A      LDD	R18,Y+10
    00B84 853B      LDD	R19,Y+11
    00B85 01CE      MOVW	R24,R28
    00B86 939A      ST	-Y,R25
    00B87 938A      ST	-Y,R24
    00B88 940E 4E63 CALL	fpmule1
    00B8A 01CE      MOVW	R24,R28
    00B8B 939A      ST	-Y,R25
    00B8C 938A      ST	-Y,R24
    00B8D 940E 4E78 CALL	fpmule1x
    00B8F 0183      MOVW	R16,R6
    00B90 0194      MOVW	R18,R8
    00B91 940E 4C86 CALL	fpsub2x
    00B93 0181      MOVW	R16,R2
    00B94 0192      MOVW	R18,R4
    00B95 940E 4E6D CALL	fpmule2
    00B97 8308      ST	Y,R16
    00B98 8319      STD	Y+1,R17
    00B99 832A      STD	Y+2,R18
    00B9A 833B      STD	Y+3,R19
(0474)     y  = y * ( f - ( x * y * y ) );
    00B9B 8028      LD	R2,Y
    00B9C 8039      LDD	R3,Y+1
    00B9D 804A      LDD	R4,Y+2
    00B9E 805B      LDD	R5,Y+3
    00B9F 846C      LDD	R6,Y+12
    00BA0 847D      LDD	R7,Y+13
    00BA1 848E      LDD	R8,Y+14
    00BA2 849F      LDD	R9,Y+15
    00BA3 8508      LDD	R16,Y+8
    00BA4 8519      LDD	R17,Y+9
    00BA5 852A      LDD	R18,Y+10
    00BA6 853B      LDD	R19,Y+11
    00BA7 01CE      MOVW	R24,R28
    00BA8 939A      ST	-Y,R25
    00BA9 938A      ST	-Y,R24
    00BAA 940E 4E63 CALL	fpmule1
    00BAC 01CE      MOVW	R24,R28
    00BAD 939A      ST	-Y,R25
    00BAE 938A      ST	-Y,R24
    00BAF 940E 4E78 CALL	fpmule1x
    00BB1 0183      MOVW	R16,R6
    00BB2 0194      MOVW	R18,R8
    00BB3 940E 4C86 CALL	fpsub2x
    00BB5 0181      MOVW	R16,R2
    00BB6 0192      MOVW	R18,R4
    00BB7 940E 4E6D CALL	fpmule2
    00BB9 8308      ST	Y,R16
    00BBA 8319      STD	Y+1,R17
    00BBB 832A      STD	Y+2,R18
    00BBC 833B      STD	Y+3,R19
(0475)     return number * y;
    00BBD 890C      LDD	R16,Y+20
    00BBE 891D      LDD	R17,Y+21
    00BBF 892E      LDD	R18,Y+22
    00BC0 893F      LDD	R19,Y+23
    00BC1 01CE      MOVW	R24,R28
    00BC2 939A      ST	-Y,R25
    00BC3 938A      ST	-Y,R24
    00BC4 940E 4E63 CALL	fpmule1
    00BC6 9660      ADIW	R28,0x10
    00BC7 940E 4B37 CALL	pop_xgsetF000
    00BC9 9624      ADIW	R28,4
    00BCA 9508      RET
_debug:
  str2                 --> Y,+0
  val                  --> Y,+6
  str                  --> Y,+4
    00BCB 940E 49D8 CALL	push_arg4
    00BCD 9724      SBIW	R28,4
(0476) } 
(0477) //
(0478) //###############################################################//
(0479) //debug
(0480) void debug(UINT8 *str,UINT8 val)
(0481) {
(0482)  UINT8 str2[4]={0,0,0,0};
    00BCE EC8D      LDI	R24,0xCD
    00BCF E091      LDI	R25,1
    00BD0 01FE      MOVW	R30,R28
    00BD1 E004      LDI	R16,4
    00BD2 E010      LDI	R17,0
    00BD3 93FA      ST	-Y,R31
    00BD4 93EA      ST	-Y,R30
    00BD5 939A      ST	-Y,R25
    00BD6 938A      ST	-Y,R24
    00BD7 940E 4BCD CALL	asgnblk
(0483)  str=str;
(0484)  val=val;
    00BD9 9628      ADIW	R28,0x8
    00BDA 9508      RET
_disk_initialize:
  state                --> R20
  drv                  --> R10
    00BDB 92AA      ST	-Y,R10
    00BDC 934A      ST	-Y,R20
    00BDD 2EA0      MOV	R10,R16
FILE: D:\LQD\software\software_src\diskio.c
(0001) 
(0002) 
(0003) /*-----------------------------------------------------------------------*/
(0004) /* Low level disk I/O module skeleton for FatFs     (C)ChaN, 2007        */
(0005) /*-----------------------------------------------------------------------*/
(0006) /* This is a stub disk I/O module that acts as front end of the existing */
(0007) /* disk I/O modules and attach it to FatFs module with common interface. */
(0008) /*-----------------------------------------------------------------------*/
(0009) 
(0010) #include "diskio.h"
(0011) #include "sd.h"
(0012) 
(0013) 
(0014) /*-----------------------------------------------------------------------*/
(0015) /* Correspondence between physical drive number and physical drive.      */
(0016) /* Note that Tiny-FatFs supports only single drive and always            */
(0017)                                       
(0018) 
(0019) ////////////////////////////
(0020) /*
(0021)    struct tm {
(0022)    	int tm_sec;   // 秒 seconds after the minute, 0 to 60
(0023)    	int tm_min;   // 分 minutes after the hour, 0 to 59
(0024) 	int tm_hour;  // 时 hours since midnight, 0 to 23*
(0025) 	int tm_mday;  // 日 day of the month, 1 to 31
(0026) 	int tm_mon;   // 月 months since January, 0 to 11
(0027) 	int tm_year;  // 年 years since 1900
(0028) 	int tm_wday;  // 星期 days since Sunday, 0 to 6
(0029) 	int tm_yday;  // 从元旦起的天数 days since January 1, 0 to 365
(0030)  	int tm_isdst; // 夏令时？？Daylight Savings Time flag
(0031)  	};
(0032) */
(0033) /*-----------------------------------------------------------------------*/
(0034) /* Inidialize a Drive                                                    */
(0035) 
(0036) DSTATUS disk_initialize ( 
(0037) BYTE drv				/* Physical drive nmuber (0..) */
(0038) )
(0039) {
(0040)     unsigned char state;
(0041) 
(0042)     if(drv)
    00BDE 20AA      TST	R10
    00BDF F011      BEQ	0x0BE2
(0043)     {
(0044)         return STA_NOINIT;  //仅支持磁盘0的操作
    00BE0 E001      LDI	R16,1
    00BE1 C00C      RJMP	0x0BEE
(0045)     }
(0046) 
(0047)     state = SD_Init();
    00BE2 940E 2D9E CALL	_SD_Init
    00BE4 2F40      MOV	R20,R16
(0048)     if(state == STA_NODISK)
    00BE5 3002      CPI	R16,2
    00BE6 F411      BNE	0x0BE9
(0049)     {
(0050)         return STA_NODISK;
    00BE7 E002      LDI	R16,2
    00BE8 C005      RJMP	0x0BEE
(0051)     }
(0052)     else if(state != 0)
    00BE9 2344      TST	R20
    00BEA F011      BEQ	0x0BED
(0053)     {
(0054)         return STA_NOINIT;  //其他错误：初始化失败
    00BEB E001      LDI	R16,1
    00BEC C001      RJMP	0x0BEE
(0055)     }
(0056)     else
(0057)     {
(0058)         return 0;           //初始化成功
    00BED 2700      CLR	R16
    00BEE 9149      LD	R20,Y+
    00BEF 90A9      LD	R10,Y+
    00BF0 9508      RET
(0059)     }
(0060) }
(0061) 
(0062) 
(0063) 
(0064) /*-----------------------------------------------------------------------*/
(0065) /* Return Disk Status                                                    */
(0066) 
(0067) DSTATUS disk_status (
(0068) 	BYTE drv		/* Physical drive nmuber (0..) */
(0069) )
(0070) {
(0071)     if(drv)
_disk_status:
  drv                  --> R16
    00BF1 2300      TST	R16
    00BF2 F011      BEQ	0x0BF5
(0072)     {
(0073)         return STA_NOINIT;  //仅支持磁盘0操作
    00BF3 E001      LDI	R16,1
    00BF4 C001      RJMP	0x0BF6
(0074)     }
(0075)     return 0;
    00BF5 2700      CLR	R16
    00BF6 9508      RET
_disk_read:
  res                  --> R10
  count                --> R20
  sector               --> Y,+10
  buff                 --> R12
  drv                  --> R14
    00BF7 940E 4B1F CALL	push_xgset30FC
    00BF9 0169      MOVW	R12,R18
    00BFA 2EE0      MOV	R14,R16
    00BFB 9722      SBIW	R28,2
    00BFC 854E      LDD	R20,Y+14
(0076) }
(0077) 
(0078) 
(0079) 
(0080) /*-----------------------------------------------------------------------*/
(0081) /* Read Sector(s)                                                        */
(0082) 
(0083) DRESULT disk_read (
(0084) 	BYTE drv,		/* Physical drive nmuber (0..) */
(0085) 	BYTE *buff,		/* Data buffer to store read data */
(0086) 	DWORD sector,	/* Sector address (LBA) */
(0087) 	BYTE count		/* Number of sectors to read (1..255) */
(0088) )
(0089) {
(0090) 	unsigned char res=0;
    00BFD 24AA      CLR	R10
(0091)     if (drv || !count)
    00BFE 20EE      TST	R14
    00BFF F411      BNE	0x0C02
    00C00 2344      TST	R20
    00C01 F411      BNE	0x0C04
(0092)     {    
(0093)         return RES_PARERR;  //仅支持单磁盘操作，count不能等于0，否则返回参数错误
    00C02 E004      LDI	R16,4
    00C03 C010      RJMP	0x0C14
(0094)     }
(0095) 
(0096)     if(count==1)            //1个sector的读操作      
    00C04 3041      CPI	R20,1
    00C05 F449      BNE	0x0C0F
(0097)     {                                                
(0098)         res = SD_Read_Sector(sector, buff);      
    00C06 82D9      STD	Y+1,R13
    00C07 82C8      ST	Y,R12
    00C08 850A      LDD	R16,Y+10
    00C09 851B      LDD	R17,Y+11
    00C0A 852C      LDD	R18,Y+12
    00C0B 853D      LDD	R19,Y+13
    00C0C 940E 2E84 CALL	_SD_Read_Sector
    00C0E 2EA0      MOV	R10,R16
(0099)     }                                                                                                 
(0100) 
(0101)     //处理返回值，将SD_driver.c的返回值转成ff.c的返回值
(0102)     if(res == 0x00)
    00C0F 20AA      TST	R10
    00C10 F411      BNE	0x0C13
(0103)     {
(0104)         return RES_OK;
    00C11 2700      CLR	R16
    00C12 C001      RJMP	0x0C14
(0105)     }
(0106)     else
(0107)     {
(0108)         return RES_ERROR;
    00C13 E001      LDI	R16,1
    00C14 9622      ADIW	R28,2
    00C15 940C 4B09 JMP	pop_xgset30FC
_disk_write:
  count                --> R12
  sector               --> Y,+8
  buff                 --> R10
  drv                  --> R14
    00C17 940E 4B21 CALL	push_xgset00FC
    00C19 0159      MOVW	R10,R18
    00C1A 2EE0      MOV	R14,R16
    00C1B 9722      SBIW	R28,2
    00C1C 84CC      LDD	R12,Y+12
(0109)     }
(0110) }
(0111) 
(0112) 
(0113) 
(0114) /*-----------------------------------------------------------------------*/
(0115) /* Write Sector(s)                                                       */
(0116) 
(0117) #if _READONLY == 0
(0118) DRESULT disk_write (
(0119) 	BYTE drv,			/* Physical drive nmuber (0..) */
(0120) 	BYTE *buff,	        /* Data to be written */
(0121) 	DWORD sector,		/* Sector address (LBA) */
(0122) 	BYTE count			/* Number of sectors to write (1..255) */
(0123) )
(0124) {
(0125)     if (drv || !count)
    00C1D 20EE      TST	R14
    00C1E F411      BNE	0x0C21
    00C1F 20CC      TST	R12
    00C20 F411      BNE	0x0C23
(0126)     {    
(0127)         return RES_PARERR;  //仅支持单磁盘操作，count不能等于0，否则返回参数错误
    00C21 E004      LDI	R16,4
    00C22 C009      RJMP	0x0C2C
(0128)     }   
(0129)    // 读写操作
(0130)     SD_Write_Sector(sector,buff);
    00C23 82B9      STD	Y+1,R11
    00C24 82A8      ST	Y,R10
    00C25 8508      LDD	R16,Y+8
    00C26 8519      LDD	R17,Y+9
    00C27 852A      LDD	R18,Y+10
    00C28 853B      LDD	R19,Y+11
    00C29 940E 2DFE CALL	_SD_Write_Sector
(0131) 	  
(0132)     return RES_OK;
    00C2B 2700      CLR	R16
    00C2C 9622      ADIW	R28,2
    00C2D 940C 4B02 JMP	pop_xgset00FC
_disk_ioctl:
  buff                 --> Y,+4
  ctrl                 --> Y,+2
  drv                  --> Y,+0
    00C2F 940E 49D8 CALL	push_arg4
(0133) }
(0134) #endif /* _READONLY */
(0135) 
(0136) 
(0137) 
(0138) /*-----------------------------------------------------------------------*/
(0139) /* Miscellaneous Functions                                               */
(0140) DRESULT disk_ioctl (
(0141) 	BYTE drv,		/* Physical drive nmuber (0..) */
(0142) 	BYTE ctrl,		/* Control code */
(0143) 	void *buff		/* Buffer to send/receive control data */
(0144) )
(0145) {
(0146)  	drv=drv;
(0147) 	ctrl=ctrl;
(0148) 	buff=buff;
(0149) 	return 0;
    00C31 2700      CLR	R16
    00C32 9624      ADIW	R28,4
    00C33 9508      RET
(0150) }
(0151) DWORD get_fattime (void)
(0152) {
(0153) 
(0154)   return 1950466005;
_get_fattime:
    00C34 ED05      LDI	R16,0xD5
    00C35 EB1F      LDI	R17,0xBF
    00C36 E421      LDI	R18,0x41
    00C37 E734      LDI	R19,0x74
    00C38 9508      RET
ff.c:mem_cpy:
  s                    --> R12
  d                    --> R10
  cnt                  --> R20
  src                  --> R18
  dst                  --> R16
    00C39 940E 4B4A CALL	push_xgset303C
    00C3B 814E      LDD	R20,Y+6
    00C3C 815F      LDD	R21,Y+7
FILE: D:\LQD\software\software_src\ff.c
(0001) /*----------------------------------------------------------------------------/
(0002) /  FatFs - FAT file system module  R0.09                  (C)ChaN, 2011
(0003) /-----------------------------------------------------------------------------/
(0004) / FatFs module is a generic FAT file system module for small embedded systems.
(0005) / This is a free software that opened for education, research and commercial
(0006) / developments under license policy of following terms.
(0007) /
(0008) /  Copyright (C) 2011, ChaN, all right reserved.
(0009) /
(0010) / * The FatFs module is a free software and there is NO WARRANTY.
(0011) / * No restriction on use. You can use, modify and redistribute it for
(0012) /   personal, non-profit or commercial products UNDER YOUR RESPONSIBILITY.
(0013) / * Redistributions of source code must retain the above copyright notice.
(0014) /
(0015) /-----------------------------------------------------------------------------/
(0016) / Feb 26,'06 R0.00  Prototype.
(0017) /
(0018) / Apr 29,'06 R0.01  First stable version.
(0019) /
(0020) / Jun 01,'06 R0.02  Added FAT12 support.
(0021) /                   Removed unbuffered mode.
(0022) /                   Fixed a problem on small (<32M) partition.
(0023) / Jun 10,'06 R0.02a Added a configuration option (_FS_MINIMUM).
(0024) /
(0025) / Sep 22,'06 R0.03  Added f_rename().
(0026) /                   Changed option _FS_MINIMUM to _FS_MINIMIZE.
(0027) / Dec 11,'06 R0.03a Improved cluster scan algorithm to write files fast.
(0028) /                   Fixed f_mkdir() creates incorrect directory on FAT32.
(0029) /
(0030) / Feb 04,'07 R0.04  Supported multiple drive system.
(0031) /                   Changed some interfaces for multiple drive system.
(0032) /                   Changed f_mountdrv() to f_mount().
(0033) /                   Added f_mkfs().
(0034) / Apr 01,'07 R0.04a Supported multiple partitions on a physical drive.
(0035) /                   Added a capability of extending file size to f_lseek().
(0036) /                   Added minimization level 3.
(0037) /                   Fixed an endian sensitive code in f_mkfs().
(0038) / May 05,'07 R0.04b Added a configuration option _USE_NTFLAG.
(0039) /                   Added FSInfo support.
(0040) /                   Fixed DBCS name can result FR_INVALID_NAME.
(0041) /                   Fixed short seek (<= csize) collapses the file object.
(0042) /
(0043) / Aug 25,'07 R0.05  Changed arguments of f_read(), f_write() and f_mkfs().
(0044) /                   Fixed f_mkfs() on FAT32 creates incorrect FSInfo.
(0045) /                   Fixed f_mkdir() on FAT32 creates incorrect directory.
(0046) / Feb 03,'08 R0.05a Added f_truncate() and f_utime().
(0047) /                   Fixed off by one error at FAT sub-type determination.
(0048) /                   Fixed btr in f_read() can be mistruncated.
(0049) /                   Fixed cached sector is not flushed when create and close without write.
(0050) /
(0051) / Apr 01,'08 R0.06  Added fputc(), fputs(), fprintf() and fgets().
(0052) /                   Improved performance of f_lseek() on moving to the same or following cluster.
(0053) /
(0054) / Apr 01,'09 R0.07  Merged Tiny-FatFs as a configuration option. (_FS_TINY)
(0055) /                   Added long file name feature.
(0056) /                   Added multiple code page feature.
(0057) /                   Added re-entrancy for multitask operation.
(0058) /                   Added auto cluster size selection to f_mkfs().
(0059) /                   Added rewind option to f_readdir().
(0060) /                   Changed result code of critical errors.
(0061) /                   Renamed string functions to avoid name collision.
(0062) / Apr 14,'09 R0.07a Separated out OS dependent code on reentrant cfg.
(0063) /                   Added multiple sector size feature.
(0064) / Jun 21,'09 R0.07c Fixed f_unlink() can return FR_OK on error.
(0065) /                   Fixed wrong cache control in f_lseek().
(0066) /                   Added relative path feature.
(0067) /                   Added f_chdir() and f_chdrive().
(0068) /                   Added proper case conversion to extended char.
(0069) / Nov 03,'09 R0.07e Separated out configuration options from ff.h to ffconf.h.
(0070) /                   Fixed f_unlink() fails to remove a sub-dir on _FS_RPATH.
(0071) /                   Fixed name matching error on the 13 char boundary.
(0072) /                   Added a configuration option, _LFN_UNICODE.
(0073) /                   Changed f_readdir() to return the SFN with always upper case on non-LFN cfg.
(0074) /
(0075) / May 15,'10 R0.08  Added a memory configuration option. (_USE_LFN = 3)
(0076) /                   Added file lock feature. (_FS_SHARE)
(0077) /                   Added fast seek feature. (_USE_FASTSEEK)
(0078) /                   Changed some types on the API, XCHAR->TCHAR.
(0079) /                   Changed fname member in the FILINFO structure on Unicode cfg.
(0080) /                   String functions support UTF-8 encoding files on Unicode cfg.
(0081) / Aug 16,'10 R0.08a Added f_getcwd(). (_FS_RPATH = 2)
(0082) /                   Added sector erase feature. (_USE_ERASE)
(0083) /                   Moved file lock semaphore table from fs object to the bss.
(0084) /                   Fixed a wrong directory entry is created on non-LFN cfg when the given name contains ';'.
(0085) /                   Fixed f_mkfs() creates wrong FAT32 volume.
(0086) / Jan 15,'11 R0.08b Fast seek feature is also applied to f_read() and f_write().
(0087) /                   f_lseek() reports required table size on creating CLMP.
(0088) /                   Extended format syntax of f_printf function.
(0089) /                   Ignores duplicated directory separators in given path names.
(0090) /
(0091) / Sep 06,'11 R0.09  f_mkfs() supports multiple partition to finish the multiple partition feature.
(0092) /                   Added f_fdisk(). (_MULTI_PARTITION = 2)
(0093) /---------------------------------------------------------------------------*/
(0094) 
(0095) #include "ff.h"			/* FatFs configurations and declarations */
(0096) #include "diskio.h"		/* Declarations of low level disk I/O functions */
(0097) #include <string.h>
(0098) 
(0099) /*--------------------------------------------------------------------------
(0100) 
(0101)    Module Private Definitions
(0102) 
(0103) ---------------------------------------------------------------------------*/
(0104) 
(0105) #if _FATFS != 6502	/* Revision ID */
(0106) #error Wrong include file (ff.h).
(0107) #endif
(0108) 
(0109) 
(0110) /* Definitions on sector size */
(0111) #if _MAX_SS != 512 && _MAX_SS != 1024 && _MAX_SS != 2048 && _MAX_SS != 4096
(0112) #error Wrong sector size.
(0113) #endif
(0114) #if _MAX_SS != 512
(0115) #define	SS(fs)	((fs)->ssize)	/* Variable sector size */
(0116) #else
(0117) #define	SS(fs)	512U			/* Fixed sector size */
(0118) #endif
(0119) 
(0120) 
(0121) /* Reentrancy related */
(0122) #if _FS_REENTRANT
(0123) #if _USE_LFN == 1
(0124) #error Static LFN work area must not be used in re-entrant configuration.
(0125) #endif
(0126) #define	ENTER_FF(fs)		{ if (!lock_fs(fs)) return FR_TIMEOUT; }
(0127) #define	LEAVE_FF(fs, res)	{ unlock_fs(fs, res); return res; }
(0128) #else
(0129) #define	ENTER_FF(fs)
(0130) #define LEAVE_FF(fs, res)	return res
(0131) #endif
(0132) 
(0133) #define	ABORT(fs, res)		{ fp->flag |= FA__ERROR; LEAVE_FF(fs, res); }
(0134) 
(0135) 
(0136) /* File shareing feature */
(0137) #if _FS_SHARE
(0138) #if _FS_READONLY
(0139) #error _FS_SHARE must be 0 on read-only cfg.
(0140) #endif
(0141) typedef struct {
(0142) 	FATFS *fs;				/* File ID 1, volume (NULL:blank entry) */
(0143) 	DWORD clu;				/* File ID 2, directory */
(0144) 	WORD idx;				/* File ID 3, directory index */
(0145) 	WORD ctr;				/* File open counter, 0:none, 0x01..0xFF:read open count, 0x100:write mode */
(0146) } FILESEM;
(0147) #endif
(0148) 
(0149) 
(0150) /* Misc definitions */
(0151) #define LD_CLUST(dir)	(((DWORD)LD_WORD(dir+DIR_FstClusHI)<<16) | LD_WORD(dir+DIR_FstClusLO))
(0152) #define ST_CLUST(dir,cl) {ST_WORD(dir+DIR_FstClusLO, cl); ST_WORD(dir+DIR_FstClusHI, (DWORD)cl>>16);}
(0153) 
(0154) 
(0155) /* DBCS code ranges and SBCS extend char conversion table */
(0156) 
(0157) #if _CODE_PAGE == 932	/* Japanese Shift-JIS */
(0158) #define _DF1S	0x81	/* DBC 1st byte range 1 start */
(0159) #define _DF1E	0x9F	/* DBC 1st byte range 1 end */
(0160) #define _DF2S	0xE0	/* DBC 1st byte range 2 start */
(0161) #define _DF2E	0xFC	/* DBC 1st byte range 2 end */
(0162) #define _DS1S	0x40	/* DBC 2nd byte range 1 start */
(0163) #define _DS1E	0x7E	/* DBC 2nd byte range 1 end */
(0164) #define _DS2S	0x80	/* DBC 2nd byte range 2 start */
(0165) #define _DS2E	0xFC	/* DBC 2nd byte range 2 end */
(0166) 
(0167) #elif _CODE_PAGE == 936	/* Simplified Chinese GBK */
(0168) #define _DF1S	0x81
(0169) #define _DF1E	0xFE
(0170) #define _DS1S	0x40
(0171) #define _DS1E	0x7E
(0172) #define _DS2S	0x80
(0173) #define _DS2E	0xFE
(0174) 
(0175) #elif _CODE_PAGE == 949	/* Korean */
(0176) #define _DF1S	0x81
(0177) #define _DF1E	0xFE
(0178) #define _DS1S	0x41
(0179) #define _DS1E	0x5A
(0180) #define _DS2S	0x61
(0181) #define _DS2E	0x7A
(0182) #define _DS3S	0x81
(0183) #define _DS3E	0xFE
(0184) 
(0185) #elif _CODE_PAGE == 950	/* Traditional Chinese Big5 */
(0186) #define _DF1S	0x81
(0187) #define _DF1E	0xFE
(0188) #define _DS1S	0x40
(0189) #define _DS1E	0x7E
(0190) #define _DS2S	0xA1
(0191) #define _DS2E	0xFE
(0192) 
(0193) #elif _CODE_PAGE == 437	/* U.S. (OEM) */
(0194) #define _DF1S	0
(0195) #define _EXCVT {0x80,0x9A,0x90,0x41,0x8E,0x41,0x8F,0x80,0x45,0x45,0x45,0x49,0x49,0x49,0x8E,0x8F,0x90,0x92,0x92,0x4F,0x99,0x4F,0x55,0x55,0x59,0x99,0x9A,0x9B,0x9C,0x9D,0x9E,0x9F, \
(0196) 				0x41,0x49,0x4F,0x55,0xA5,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0x21,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0197) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0198) 				0xE0,0xE1,0xE2,0xE3,0xE4,0xE5,0xE6,0xE7,0xE8,0xE9,0xEA,0xEB,0xEC,0xED,0xEE,0xEF,0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}
(0199) 
(0200) #elif _CODE_PAGE == 720	/* Arabic (OEM) */
(0201) #define _DF1S	0
(0202) #define _EXCVT {0x80,0x81,0x45,0x41,0x84,0x41,0x86,0x43,0x45,0x45,0x45,0x49,0x49,0x8D,0x8E,0x8F,0x90,0x92,0x92,0x93,0x94,0x95,0x49,0x49,0x98,0x99,0x9A,0x9B,0x9C,0x9D,0x9E,0x9F, \
(0203) 				0xA0,0xA1,0xA2,0xA3,0xA4,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0204) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0205) 				0xE0,0xE1,0xE2,0xE3,0xE4,0xE5,0xE6,0xE7,0xE8,0xE9,0xEA,0xEB,0xEC,0xED,0xEE,0xEF,0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}
(0206) 
(0207) #elif _CODE_PAGE == 737	/* Greek (OEM) */
(0208) #define _DF1S	0
(0209) #define _EXCVT {0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x92,0x92,0x93,0x94,0x95,0x96,0x97,0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87, \
(0210) 				0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x91,0xAA,0x92,0x93,0x94,0x95,0x96,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0211) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0212) 				0x97,0xEA,0xEB,0xEC,0xE4,0xED,0xEE,0xE7,0xE8,0xF1,0xEA,0xEB,0xEC,0xED,0xEE,0xEF,0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}
(0213) 
(0214) #elif _CODE_PAGE == 775	/* Baltic (OEM) */
(0215) #define _DF1S	0
(0216) #define _EXCVT {0x80,0x9A,0x91,0xA0,0x8E,0x95,0x8F,0x80,0xAD,0xED,0x8A,0x8A,0xA1,0x8D,0x8E,0x8F,0x90,0x92,0x92,0xE2,0x99,0x95,0x96,0x97,0x97,0x99,0x9A,0x9D,0x9C,0x9D,0x9E,0x9F, \
(0217) 				0xA0,0xA1,0xE0,0xA3,0xA3,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0218) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xB5,0xB6,0xB7,0xB8,0xBD,0xBE,0xC6,0xC7,0xA5,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0219) 				0xE0,0xE1,0xE2,0xE3,0xE5,0xE5,0xE6,0xE3,0xE8,0xE8,0xEA,0xEA,0xEE,0xED,0xEE,0xEF,0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}
(0220) 
(0221) #elif _CODE_PAGE == 850	/* Multilingual Latin 1 (OEM) */
(0222) #define _DF1S	0
(0223) #define _EXCVT {0x80,0x9A,0x90,0xB6,0x8E,0xB7,0x8F,0x80,0xD2,0xD3,0xD4,0xD8,0xD7,0xDE,0x8E,0x8F,0x90,0x92,0x92,0xE2,0x99,0xE3,0xEA,0xEB,0x59,0x99,0x9A,0x9D,0x9C,0x9D,0x9E,0x9F, \
(0224) 				0xB5,0xD6,0xE0,0xE9,0xA5,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0x21,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0225) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC7,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0226) 				0xE0,0xE1,0xE2,0xE3,0xE5,0xE5,0xE6,0xE7,0xE7,0xE9,0xEA,0xEB,0xED,0xED,0xEE,0xEF,0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}
(0227) 
(0228) #elif _CODE_PAGE == 852	/* Latin 2 (OEM) */
(0229) #define _DF1S	0
(0230) #define _EXCVT {0x80,0x9A,0x90,0xB6,0x8E,0xDE,0x8F,0x80,0x9D,0xD3,0x8A,0x8A,0xD7,0x8D,0x8E,0x8F,0x90,0x91,0x91,0xE2,0x99,0x95,0x95,0x97,0x97,0x99,0x9A,0x9B,0x9B,0x9D,0x9E,0x9F, \
(0231) 				0xB5,0xD6,0xE0,0xE9,0xA4,0xA4,0xA6,0xA6,0xA8,0xA8,0xAA,0x8D,0xAC,0xB8,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBD,0xBF, \
(0232) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC6,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD1,0xD1,0xD2,0xD3,0xD2,0xD5,0xD6,0xD7,0xB7,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0233) 				0xE0,0xE1,0xE2,0xE3,0xE3,0xD5,0xE6,0xE6,0xE8,0xE9,0xE8,0xEB,0xED,0xED,0xDD,0xEF,0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xEB,0xFC,0xFC,0xFE,0xFF}
(0234) 
(0235) #elif _CODE_PAGE == 855	/* Cyrillic (OEM) */
(0236) #define _DF1S	0
(0237) #define _EXCVT {0x81,0x81,0x83,0x83,0x85,0x85,0x87,0x87,0x89,0x89,0x8B,0x8B,0x8D,0x8D,0x8F,0x8F,0x91,0x91,0x93,0x93,0x95,0x95,0x97,0x97,0x99,0x99,0x9B,0x9B,0x9D,0x9D,0x9F,0x9F, \
(0238) 				0xA1,0xA1,0xA3,0xA3,0xA5,0xA5,0xA7,0xA7,0xA9,0xA9,0xAB,0xAB,0xAD,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB6,0xB6,0xB8,0xB8,0xB9,0xBA,0xBB,0xBC,0xBE,0xBE,0xBF, \
(0239) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC7,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD1,0xD1,0xD3,0xD3,0xD5,0xD5,0xD7,0xD7,0xDD,0xD9,0xDA,0xDB,0xDC,0xDD,0xE0,0xDF, \
(0240) 				0xE0,0xE2,0xE2,0xE4,0xE4,0xE6,0xE6,0xE8,0xE8,0xEA,0xEA,0xEC,0xEC,0xEE,0xEE,0xEF,0xF0,0xF2,0xF2,0xF4,0xF4,0xF6,0xF6,0xF8,0xF8,0xFA,0xFA,0xFC,0xFC,0xFD,0xFE,0xFF}
(0241) 
(0242) #elif _CODE_PAGE == 857	/* Turkish (OEM) */
(0243) #define _DF1S	0
(0244) #define _EXCVT {0x80,0x9A,0x90,0xB6,0x8E,0xB7,0x8F,0x80,0xD2,0xD3,0xD4,0xD8,0xD7,0x98,0x8E,0x8F,0x90,0x92,0x92,0xE2,0x99,0xE3,0xEA,0xEB,0x98,0x99,0x9A,0x9D,0x9C,0x9D,0x9E,0x9E, \
(0245) 				0xB5,0xD6,0xE0,0xE9,0xA5,0xA5,0xA6,0xA6,0xA8,0xA9,0xAA,0xAB,0xAC,0x21,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0246) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC7,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0247) 				0xE0,0xE1,0xE2,0xE3,0xE5,0xE5,0xE6,0xE7,0xE8,0xE9,0xEA,0xEB,0xDE,0x59,0xEE,0xEF,0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}
(0248) 
(0249) #elif _CODE_PAGE == 858	/* Multilingual Latin 1 + Euro (OEM) */
(0250) #define _DF1S	0
(0251) #define _EXCVT {0x80,0x9A,0x90,0xB6,0x8E,0xB7,0x8F,0x80,0xD2,0xD3,0xD4,0xD8,0xD7,0xDE,0x8E,0x8F,0x90,0x92,0x92,0xE2,0x99,0xE3,0xEA,0xEB,0x59,0x99,0x9A,0x9D,0x9C,0x9D,0x9E,0x9F, \
(0252) 				0xB5,0xD6,0xE0,0xE9,0xA5,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0x21,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0253) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC7,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD1,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0254) 				0xE0,0xE1,0xE2,0xE3,0xE5,0xE5,0xE6,0xE7,0xE7,0xE9,0xEA,0xEB,0xED,0xED,0xEE,0xEF,0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}
(0255) 
(0256) #elif _CODE_PAGE == 862	/* Hebrew (OEM) */
(0257) #define _DF1S	0
(0258) #define _EXCVT {0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x9A,0x9B,0x9C,0x9D,0x9E,0x9F, \
(0259) 				0x41,0x49,0x4F,0x55,0xA5,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0x21,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0260) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0261) 				0xE0,0xE1,0xE2,0xE3,0xE4,0xE5,0xE6,0xE7,0xE8,0xE9,0xEA,0xEB,0xEC,0xED,0xEE,0xEF,0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}
(0262) 
(0263) #elif _CODE_PAGE == 866	/* Russian (OEM) */
(0264) #define _DF1S	0
(0265) #define _EXCVT {0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x9A,0x9B,0x9C,0x9D,0x9E,0x9F, \
(0266) 				0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0267) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0268) 				0x90,0x91,0x92,0x93,0x9d,0x95,0x96,0x97,0x98,0x99,0x9A,0x9B,0x9C,0x9D,0x9E,0x9F,0xF0,0xF0,0xF2,0xF2,0xF4,0xF4,0xF6,0xF6,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}
(0269) 
(0270) #elif _CODE_PAGE == 874	/* Thai (OEM, Windows) */
(0271) #define _DF1S	0
(0272) #define _EXCVT {0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x9A,0x9B,0x9C,0x9D,0x9E,0x9F, \
(0273) 				0xA0,0xA1,0xA2,0xA3,0xA4,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0274) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0275) 				0xE0,0xE1,0xE2,0xE3,0xE4,0xE5,0xE6,0xE7,0xE8,0xE9,0xEA,0xEB,0xEC,0xED,0xEE,0xEF,0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}
(0276) 
(0277) #elif _CODE_PAGE == 1250 /* Central Europe (Windows) */
(0278) #define _DF1S	0
(0279) #define _EXCVT {0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x8A,0x9B,0x8C,0x8D,0x8E,0x8F, \
(0280) 				0xA0,0xA1,0xA2,0xA3,0xA4,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xA3,0xB4,0xB5,0xB6,0xB7,0xB8,0xA5,0xAA,0xBB,0xBC,0xBD,0xBC,0xAF, \
(0281) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0282) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xF7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xFF}
(0283) 
(0284) #elif _CODE_PAGE == 1251 /* Cyrillic (Windows) */
(0285) #define _DF1S	0
(0286) #define _EXCVT {0x80,0x81,0x82,0x82,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x80,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x8A,0x9B,0x8C,0x8D,0x8E,0x8F, \
(0287) 				0xA0,0xA2,0xA2,0xA3,0xA4,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xB2,0xA5,0xB5,0xB6,0xB7,0xA8,0xB9,0xAA,0xBB,0xA3,0xBD,0xBD,0xAF, \
(0288) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0289) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF}
(0290) 
(0291) #elif _CODE_PAGE == 1252 /* Latin 1 (Windows) */
(0292) #define _DF1S	0
(0293) #define _EXCVT {0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0xAd,0x9B,0x8C,0x9D,0xAE,0x9F, \
(0294) 				0xA0,0x21,0xA2,0xA3,0xA4,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0295) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0296) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xF7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0x9F}
(0297) 
(0298) #elif _CODE_PAGE == 1253 /* Greek (Windows) */
(0299) #define _DF1S	0
(0300) #define _EXCVT {0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x9A,0x9B,0x9C,0x9D,0x9E,0x9F, \
(0301) 				0xA0,0xA1,0xA2,0xA3,0xA4,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0302) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xA2,0xB8,0xB9,0xBA, \
(0303) 				0xE0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xF2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xFB,0xBC,0xFD,0xBF,0xFF}
(0304) 
(0305) #elif _CODE_PAGE == 1254 /* Turkish (Windows) */
(0306) #define _DF1S	0
(0307) #define _EXCVT {0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x8A,0x9B,0x8C,0x9D,0x9E,0x9F, \
(0308) 				0xA0,0x21,0xA2,0xA3,0xA4,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0309) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0310) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xF7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0x9F}
(0311) 
(0312) #elif _CODE_PAGE == 1255 /* Hebrew (Windows) */
(0313) #define _DF1S	0
(0314) #define _EXCVT {0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x9A,0x9B,0x9C,0x9D,0x9E,0x9F, \
(0315) 				0xA0,0x21,0xA2,0xA3,0xA4,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0316) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0317) 				0xE0,0xE1,0xE2,0xE3,0xE4,0xE5,0xE6,0xE7,0xE8,0xE9,0xEA,0xEB,0xEC,0xED,0xEE,0xEF,0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}
(0318) 
(0319) #elif _CODE_PAGE == 1256 /* Arabic (Windows) */
(0320) #define _DF1S	0
(0321) #define _EXCVT {0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x9A,0x9B,0x8C,0x9D,0x9E,0x9F, \
(0322) 				0xA0,0xA1,0xA2,0xA3,0xA4,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0323) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0324) 				0x41,0xE1,0x41,0xE3,0xE4,0xE5,0xE6,0x43,0x45,0x45,0x45,0x45,0xEC,0xED,0x49,0x49,0xF0,0xF1,0xF2,0xF3,0x4F,0xF5,0xF6,0xF7,0xF8,0x55,0xFA,0x55,0x55,0xFD,0xFE,0xFF}
(0325) 
(0326) #elif _CODE_PAGE == 1257 /* Baltic (Windows) */
(0327) #define _DF1S	0
(0328) #define _EXCVT {0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x9A,0x9B,0x9C,0x9D,0x9E,0x9F, \
(0329) 				0xA0,0xA1,0xA2,0xA3,0xA4,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xA8,0xB9,0xAA,0xBB,0xBC,0xBD,0xBE,0xAF, \
(0330) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0331) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xF7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xFF}
(0332) 
(0333) #elif _CODE_PAGE == 1258 /* Vietnam (OEM, Windows) */
(0334) #define _DF1S	0
(0335) #define _EXCVT {0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x9A,0x9B,0xAC,0x9D,0x9E,0x9F, \
(0336) 				0xA0,0x21,0xA2,0xA3,0xA4,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0337) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0338) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xEC,0xCD,0xCE,0xCF,0xD0,0xD1,0xF2,0xD3,0xD4,0xD5,0xD6,0xF7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xFE,0x9F}
(0339) 
(0340) #elif _CODE_PAGE == 1	/* ASCII (for only non-LFN cfg) */
(0341) #if _USE_LFN
(0342) #error Cannot use LFN feature without valid code page.
(0343) #endif
(0344) #define _DF1S	0
(0345) 
(0346) #else
(0347) #error Unknown code page
(0348) 
(0349) #endif
(0350) 
(0351) 
(0352) /* Character code support macros */
(0353) #define IsUpper(c)	(((c)>='A')&&((c)<='Z'))
(0354) #define IsLower(c)	(((c)>='a')&&((c)<='z'))
(0355) #define IsDigit(c)	(((c)>='0')&&((c)<='9'))
(0356) 
(0357) #if _DF1S		/* Code page is DBCS */
(0358) 
(0359) #ifdef _DF2S	/* Two 1st byte areas */
(0360) #define IsDBCS1(c)	(((BYTE)(c) >= _DF1S && (BYTE)(c) <= _DF1E) || ((BYTE)(c) >= _DF2S && (BYTE)(c) <= _DF2E))
(0361) #else			/* One 1st byte area */
(0362) #define IsDBCS1(c)	((BYTE)(c) >= _DF1S && (BYTE)(c) <= _DF1E)
(0363) #endif
(0364) 
(0365) #ifdef _DS3S	/* Three 2nd byte areas */
(0366) #define IsDBCS2(c)	(((BYTE)(c) >= _DS1S && (BYTE)(c) <= _DS1E) || ((BYTE)(c) >= _DS2S && (BYTE)(c) <= _DS2E) || ((BYTE)(c) >= _DS3S && (BYTE)(c) <= _DS3E))
(0367) #else			/* Two 2nd byte areas */
(0368) #define IsDBCS2(c)	(((BYTE)(c) >= _DS1S && (BYTE)(c) <= _DS1E) || ((BYTE)(c) >= _DS2S && (BYTE)(c) <= _DS2E))
(0369) #endif
(0370) 
(0371) #else			/* Code page is SBCS */
(0372) 
(0373) #define IsDBCS1(c)	0
(0374) #define IsDBCS2(c)	0
(0375) 
(0376) #endif /* _DF1S */
(0377) 
(0378) 
(0379) /* Name status flags */
(0380) #define NS			11		/* Index of name status byte in fn[] */
(0381) #define NS_LOSS		0x01	/* Out of 8.3 format */
(0382) #define NS_LFN		0x02	/* Force to create LFN entry */
(0383) #define NS_LAST		0x04	/* Last segment */
(0384) #define NS_BODY		0x08	/* Lower case flag (body) */
(0385) #define NS_EXT		0x10	/* Lower case flag (ext) */
(0386) #define NS_DOT		0x20	/* Dot entry */
(0387) 
(0388) 
(0389) /* FAT sub-type boundaries */
(0390) /* Note that the FAT spec by Microsoft says 4085 but Windows works with 4087! */
(0391) #define MIN_FAT16	4086	/* Minimum number of clusters for FAT16 */
(0392) #define	MIN_FAT32	65526	/* Minimum number of clusters for FAT32 */
(0393) 
(0394) 
(0395) /* FatFs refers the members in the FAT structures as byte array instead of
(0396) / structure member because the structure is not binary compatible between
(0397) / different platforms */
(0398) 
(0399) #define BS_jmpBoot			0	/* Jump instruction (3) */
(0400) #define BS_OEMName			3	/* OEM name (8) */
(0401) #define BPB_BytsPerSec		11	/* Sector size [byte] (2) */
(0402) #define BPB_SecPerClus		13	/* Cluster size [sector] (1) */
(0403) #define BPB_RsvdSecCnt		14	/* Size of reserved area [sector] (2) */
(0404) #define BPB_NumFATs			16	/* Number of FAT copies (1) */
(0405) #define BPB_RootEntCnt		17	/* Number of root dir entries for FAT12/16 (2) */
(0406) #define BPB_TotSec16		19	/* Volume size [sector] (2) */
(0407) #define BPB_Media			21	/* Media descriptor (1) */
(0408) #define BPB_FATSz16			22	/* FAT size [sector] (2) */
(0409) #define BPB_SecPerTrk		24	/* Track size [sector] (2) */
(0410) #define BPB_NumHeads		26	/* Number of heads (2) */
(0411) #define BPB_HiddSec			28	/* Number of special hidden sectors (4) */
(0412) #define BPB_TotSec32		32	/* Volume size [sector] (4) */
(0413) #define BS_DrvNum			36	/* Physical drive number (2) */
(0414) #define BS_BootSig			38	/* Extended boot signature (1) */
(0415) #define BS_VolID			39	/* Volume serial number (4) */
(0416) #define BS_VolLab			43	/* Volume label (8) */
(0417) #define BS_FilSysType		54	/* File system type (1) */
(0418) #define BPB_FATSz32			36	/* FAT size [sector] (4) */
(0419) #define BPB_ExtFlags		40	/* Extended flags (2) */
(0420) #define BPB_FSVer			42	/* File system version (2) */
(0421) #define BPB_RootClus		44	/* Root dir first cluster (4) */
(0422) #define BPB_FSInfo			48	/* Offset of FSInfo sector (2) */
(0423) #define BPB_BkBootSec		50	/* Offset of backup boot sectot (2) */
(0424) #define BS_DrvNum32			64	/* Physical drive number (2) */
(0425) #define BS_BootSig32		66	/* Extended boot signature (1) */
(0426) #define BS_VolID32			67	/* Volume serial number (4) */
(0427) #define BS_VolLab32			71	/* Volume label (8) */
(0428) #define BS_FilSysType32		82	/* File system type (1) */
(0429) #define	FSI_LeadSig			0	/* FSI: Leading signature (4) */
(0430) #define	FSI_StrucSig		484	/* FSI: Structure signature (4) */
(0431) #define	FSI_Free_Count		488	/* FSI: Number of free clusters (4) */
(0432) #define	FSI_Nxt_Free		492	/* FSI: Last allocated cluster (4) */
(0433) #define MBR_Table			446	/* MBR: Partition table offset (2) */
(0434) #define	SZ_PTE				16	/* MBR: Size of a partition table entry */
(0435) #define BS_55AA				510	/* Boot sector signature (2) */
(0436) 
(0437) #define	DIR_Name			0	/* Short file name (11) */
(0438) #define	DIR_Attr			11	/* Attribute (1) */
(0439) #define	DIR_NTres			12	/* NT flag (1) */
(0440) #define	DIR_CrtTime			14	/* Created time (2) */
(0441) #define	DIR_CrtDate			16	/* Created date (2) */
(0442) #define	DIR_FstClusHI		20	/* Higher 16-bit of first cluster (2) */
(0443) #define	DIR_WrtTime			22	/* Modified time (2) */
(0444) #define	DIR_WrtDate			24	/* Modified date (2) */
(0445) #define	DIR_FstClusLO		26	/* Lower 16-bit of first cluster (2) */
(0446) #define	DIR_FileSize		28	/* File size (4) */
(0447) #define	LDIR_Ord			0	/* LFN entry order and LLE flag (1) */
(0448) #define	LDIR_Attr			11	/* LFN attribute (1) */
(0449) #define	LDIR_Type			12	/* LFN type (1) */
(0450) #define	LDIR_Chksum			13	/* Sum of corresponding SFN entry */
(0451) #define	LDIR_FstClusLO		26	/* Filled by zero (0) */
(0452) #define	SZ_DIR				32		/* Size of a directory entry */
(0453) #define	LLE					0x40	/* Last long entry flag in LDIR_Ord */
(0454) #define	DDE					0xE5	/* Deleted directory enrty mark in DIR_Name[0] */
(0455) #define	NDDE				0x05	/* Replacement of a character collides with DDE */
(0456) 
(0457) 
(0458) /*------------------------------------------------------------*/
(0459) /* Module private work area                                   */
(0460) /*------------------------------------------------------------*/
(0461) /* Note that uninitialized variables with static duration are
(0462) /  zeroed/nulled at start-up. If not, the compiler or start-up
(0463) /  routine is out of ANSI-C standard.
(0464) */
(0465) 
(0466) #if _VOLUMES
(0467) static
(0468) FATFS *FatFs[_VOLUMES];	/* Pointer to the file system objects (logical drives) */
(0469) #else
(0470) #error Number of volumes must not be 0.
(0471) #endif
(0472) 
(0473) static
(0474) WORD Fsid;				/* File system mount ID */
(0475) 
(0476) #if _FS_RPATH
(0477) static
(0478) BYTE CurrVol;			/* Current drive */
(0479) #endif
(0480) 
(0481) #if _FS_SHARE
(0482) static
(0483) FILESEM	Files[_FS_SHARE];	/* File lock semaphores */
(0484) #endif
(0485) 
(0486) #if _USE_LFN == 0			/* No LFN feature */
(0487) #define	DEF_NAMEBUF			BYTE sfn[12]
(0488) #define INIT_BUF(dobj)		(dobj).fn = sfn
(0489) #define	FREE_BUF()
(0490) 
(0491) #elif _USE_LFN == 1			/* LFN feature with static working buffer */
(0492) static WCHAR LfnBuf[_MAX_LFN+1];
(0493) #define	DEF_NAMEBUF			BYTE sfn[12]
(0494) #define INIT_BUF(dobj)		{ (dobj).fn = sfn; (dobj).lfn = LfnBuf; }
(0495) #define	FREE_BUF()
(0496) 
(0497) #elif _USE_LFN == 2 		/* LFN feature with dynamic working buffer on the stack */
(0498) #define	DEF_NAMEBUF			BYTE sfn[12]; WCHAR lbuf[_MAX_LFN+1]
(0499) #define INIT_BUF(dobj)		{ (dobj).fn = sfn; (dobj).lfn = lbuf; }
(0500) #define	FREE_BUF()
(0501) 
(0502) #elif _USE_LFN == 3 		/* LFN feature with dynamic working buffer on the heap */
(0503) #define	DEF_NAMEBUF			BYTE sfn[12]; WCHAR *lfn
(0504) #define INIT_BUF(dobj)		{ lfn = ff_memalloc((_MAX_LFN + 1) * 2); \
(0505) 							  if (!lfn) LEAVE_FF((dobj).fs, FR_NOT_ENOUGH_CORE); \
(0506) 							  (dobj).lfn = lfn;	(dobj).fn = sfn; }
(0507) #define	FREE_BUF()			ff_memfree(lfn)
(0508) 
(0509) #else
(0510) #error Wrong LFN configuration.
(0511) #endif
(0512) 
(0513) 
(0514) 
(0515) 
(0516) /*--------------------------------------------------------------------------
(0517) 
(0518)    Module Private Functions
(0519) 
(0520) ---------------------------------------------------------------------------*/
(0521) 
(0522) 
(0523) /*-----------------------------------------------------------------------*/
(0524) /* String functions                                                      */
(0525) /*-----------------------------------------------------------------------*/
(0526) 
(0527) /* Copy memory to memory */
(0528) static
(0529) void mem_cpy (void* dst, const void* src, UINT cnt) {
(0530) 	BYTE *d = (BYTE*)dst;
    00C3D 0158      MOVW	R10,R16
(0531) 	const BYTE *s = (const BYTE*)src;
    00C3E 0169      MOVW	R12,R18
    00C3F C006      RJMP	0x0C46
(0532) 
(0533) #if _WORD_ACCESS == 1
(0534) 	while (cnt >= sizeof(int)) {
(0535) 		*(int*)d = *(int*)s;
(0536) 		d += sizeof(int); s += sizeof(int);
(0537) 		cnt -= sizeof(int);
(0538) 	}
(0539) #endif
(0540) 	while (cnt--)
(0541) 		*d++ = *s++;
    00C40 01F6      MOVW	R30,R12
    00C41 01D5      MOVW	R26,R10
    00C42 9001      LD	R0,Z+
    00C43 016F      MOVW	R12,R30
    00C44 920D      ST	X+,R0
    00C45 015D      MOVW	R10,R26
    00C46 011A      MOVW	R2,R20
    00C47 5041      SUBI	R20,1
    00C48 4050      SBCI	R21,0
    00C49 2022      TST	R2
    00C4A F7A9      BNE	0x0C40
    00C4B 2033      TST	R3
    00C4C F799      BNE	0x0C40
    00C4D 940C 4B51 JMP	pop_xgset303C
ff.c:mem_set:
  d                    --> R10
  cnt                  --> R20
  val                  --> R18
  dst                  --> R16
    00C4F 940E 4B28 CALL	push_xgset300C
    00C51 814C      LDD	R20,Y+4
    00C52 815D      LDD	R21,Y+5
(0542) }
(0543) 
(0544) /* Fill memory */
(0545) static
(0546) void mem_set (void* dst, int val, UINT cnt) {
(0547) 	BYTE *d = (BYTE*)dst;
    00C53 0158      MOVW	R10,R16
    00C54 C003      RJMP	0x0C58
(0548) 
(0549) 	while (cnt--)
(0550) 		*d++ = (BYTE)val;
    00C55 01F5      MOVW	R30,R10
    00C56 9321      ST	Z+,R18
    00C57 015F      MOVW	R10,R30
    00C58 011A      MOVW	R2,R20
    00C59 5041      SUBI	R20,1
    00C5A 4050      SBCI	R21,0
    00C5B 2022      TST	R2
    00C5C F7C1      BNE	0x0C55
    00C5D 2033      TST	R3
    00C5E F7B1      BNE	0x0C55
    00C5F 940C 4B2D JMP	pop_xgset300C
ff.c:mem_cmp:
  s                    --> R14
  d                    --> R12
  r                    --> R10
  cnt                  --> R20
  src                  --> R18
  dst                  --> R16
    00C61 940E 4B1F CALL	push_xgset30FC
    00C63 8548      LDD	R20,Y+8
    00C64 8559      LDD	R21,Y+9
(0551) }
(0552) 
(0553) /* Compare memory to memory */
(0554) static
(0555) int mem_cmp (const void* dst, const void* src, UINT cnt) {
(0556) 	const BYTE *d = (const BYTE *)dst, *s = (const BYTE *)src;
    00C65 0168      MOVW	R12,R16
    00C66 0179      MOVW	R14,R18
(0557) 	int r = 0;
    00C67 24AA      CLR	R10
    00C68 24BB      CLR	R11
(0558) 
(0559) 	while (cnt-- && (r = *d++ - *s++) == 0) ;
    00C69 011A      MOVW	R2,R20
    00C6A 5041      SUBI	R20,1
    00C6B 4050      SBCI	R21,0
    00C6C 2022      TST	R2
    00C6D F411      BNE	0x0C70
    00C6E 2033      TST	R3
    00C6F F079      BEQ	0x0C7F
    00C70 01F7      MOVW	R30,R14
    00C71 9021      LD	R2,Z+
    00C72 017F      MOVW	R14,R30
    00C73 2433      CLR	R3
    00C74 01F6      MOVW	R30,R12
    00C75 9041      LD	R4,Z+
    00C76 016F      MOVW	R12,R30
    00C77 2455      CLR	R5
    00C78 1842      SUB	R4,R2
    00C79 0853      SBC	R5,R3
    00C7A 0152      MOVW	R10,R4
    00C7B 20AA      TST	R10
    00C7C F411      BNE	0x0C7F
    00C7D 20BB      TST	R11
    00C7E F351      BEQ	0x0C69
(0560) 	return r;
    00C7F 0185      MOVW	R16,R10
    00C80 940C 4B09 JMP	pop_xgset30FC
(0561) }
(0562) 
(0563) /* Check if chr is contained in the string */
(0564) static
(0565) int chk_chr (const char* str, int chr) {
ff.c:chk_chr:
  chr                  --> R18
  str                  --> R16
    00C82 C002      RJMP	0x0C85
(0566) 	while (*str && *str != chr) str++;
    00C83 5F0F      SUBI	R16,0xFF
    00C84 4F1F      SBCI	R17,0xFF
    00C85 01F8      MOVW	R30,R16
    00C86 8020      LD	R2,Z
    00C87 2433      CLR	R3
    00C88 2022      TST	R2
    00C89 F021      BEQ	0x0C8E
    00C8A 2433      CLR	R3
    00C8B 1622      CP	R2,R18
    00C8C 0633      CPC	R3,R19
    00C8D F7A9      BNE	0x0C83
(0567) 	return *str;
    00C8E 01F8      MOVW	R30,R16
    00C8F 8100      LD	R16,Z
    00C90 2711      CLR	R17
    00C91 9508      RET
ff.c:move_window:
  nf                   --> R10
  wsect                --> Y,+5
  sector               --> Y,+13
  fs                   --> R20
    00C92 933A      ST	-Y,R19
    00C93 932A      ST	-Y,R18
    00C94 940E 4B28 CALL	push_xgset300C
    00C96 01A8      MOVW	R20,R16
    00C97 9729      SBIW	R28,0x9
(0568) }
(0569) 
(0570) 
(0571) 
(0572) /*-----------------------------------------------------------------------*/
(0573) /* Request/Release grant to access the volume                            */
(0574) /*-----------------------------------------------------------------------*/
(0575) #if _FS_REENTRANT
(0576) 
(0577) static
(0578) int lock_fs (
(0579) 	FATFS *fs		/* File system object */
(0580) )
(0581) {
(0582) 	return ff_req_grant(fs->sobj);
(0583) }
(0584) 
(0585) 
(0586) static
(0587) void unlock_fs (
(0588) 	FATFS *fs,		/* File system object */
(0589) 	FRESULT res		/* Result code to be returned */
(0590) )
(0591) {
(0592) 	if (res != FR_NOT_ENABLED &&
(0593) 		res != FR_INVALID_DRIVE &&
(0594) 		res != FR_INVALID_OBJECT &&
(0595) 		res != FR_TIMEOUT) {
(0596) 		ff_rel_grant(fs->sobj);
(0597) 	}
(0598) }
(0599) #endif
(0600) 
(0601) 
(0602) 
(0603) /*-----------------------------------------------------------------------*/
(0604) /* File shareing control functions                                       */
(0605) /*-----------------------------------------------------------------------*/
(0606) #if _FS_SHARE
(0607) 
(0608) static
(0609) FRESULT chk_lock (	/* Check if the file can be accessed */
(0610) 	DIR* dj,		/* Directory object pointing the file to be checked */
(0611) 	int acc			/* Desired access (0:Read, 1:Write, 2:Delete/Rename) */
(0612) )
(0613) {
(0614) 	UINT i, be;
(0615) 
(0616) 	/* Search file semaphore table */
(0617) 	for (i = be = 0; i < _FS_SHARE; i++) {
(0618) 		if (Files[i].fs) {	/* Existing entry */
(0619) 			if (Files[i].fs == dj->fs &&	 	/* Check if the file matched with an open file */
(0620) 				Files[i].clu == dj->sclust &&
(0621) 				Files[i].idx == dj->index) break;
(0622) 		} else {			/* Blank entry */
(0623) 			be++;
(0624) 		}
(0625) 	}
(0626) 	if (i == _FS_SHARE)	/* The file is not opened */
(0627) 		return (be || acc == 2) ? FR_OK : FR_TOO_MANY_OPEN_FILES;	/* Is there a blank entry for new file? */
(0628) 
(0629) 	/* The file has been opened. Reject any open against writing file and all write mode open */
(0630) 	return (acc || Files[i].ctr == 0x100) ? FR_LOCKED : FR_OK;
(0631) }
(0632) 
(0633) 
(0634) static
(0635) int enq_lock (void)	/* Check if an entry is available for a new file */
(0636) {
(0637) 	UINT i;
(0638) 
(0639) 	for (i = 0; i < _FS_SHARE && Files[i].fs; i++) ;
(0640) 	return (i == _FS_SHARE) ? 0 : 1;
(0641) }
(0642) 
(0643) 
(0644) static
(0645) UINT inc_lock (	/* Increment file open counter and returns its index (0:int error) */
(0646) 	DIR* dj,	/* Directory object pointing the file to register or increment */
(0647) 	int acc		/* Desired access mode (0:Read, !0:Write) */
(0648) )
(0649) {
(0650) 	UINT i;
(0651) 
(0652) 
(0653) 	for (i = 0; i < _FS_SHARE; i++) {	/* Find the file */
(0654) 		if (Files[i].fs == dj->fs &&
(0655) 			Files[i].clu == dj->sclust &&
(0656) 			Files[i].idx == dj->index) break;
(0657) 	}
(0658) 
(0659) 	if (i == _FS_SHARE) {				/* Not opened. Register it as new. */
(0660) 		for (i = 0; i < _FS_SHARE && Files[i].fs; i++) ;
(0661) 		if (i == _FS_SHARE) return 0;	/* No space to register (int err) */
(0662) 		Files[i].fs = dj->fs;
(0663) 		Files[i].clu = dj->sclust;
(0664) 		Files[i].idx = dj->index;
(0665) 		Files[i].ctr = 0;
(0666) 	}
(0667) 
(0668) 	if (acc && Files[i].ctr) return 0;	/* Access violation (int err) */
(0669) 
(0670) 	Files[i].ctr = acc ? 0x100 : Files[i].ctr + 1;	/* Set semaphore value */
(0671) 
(0672) 	return i + 1;
(0673) }
(0674) 
(0675) 
(0676) static
(0677) FRESULT dec_lock (	/* Decrement file open counter */
(0678) 	UINT i			/* Semaphore index */
(0679) )
(0680) {
(0681) 	WORD n;
(0682) 	FRESULT res;
(0683) 
(0684) 
(0685) 	if (--i < _FS_SHARE) {
(0686) 		n = Files[i].ctr;
(0687) 		if (n == 0x100) n = 0;
(0688) 		if (n) n--;
(0689) 		Files[i].ctr = n;
(0690) 		if (!n) Files[i].fs = 0;
(0691) 		res = FR_OK;
(0692) 	} else {
(0693) 		res = FR_INT_ERR;
(0694) 	}
(0695) 	return res;
(0696) }
(0697) 
(0698) 
(0699) static
(0700) void clear_lock (	/* Clear lock entries of the volume */
(0701) 	FATFS *fs
(0702) )
(0703) {
(0704) 	UINT i;
(0705) 
(0706) 	for (i = 0; i < _FS_SHARE; i++) {
(0707) 		if (Files[i].fs == fs) Files[i].fs = 0;
(0708) 	}
(0709) }
(0710) #endif
(0711) 
(0712) 
(0713) 
(0714) /*-----------------------------------------------------------------------*/
(0715) /* Change window offset                                                  */
(0716) /*-----------------------------------------------------------------------*/
(0717) 
(0718) static
(0719) FRESULT move_window (
(0720) 	FATFS *fs,		/* File system object */
(0721) 	DWORD sector	/* Sector number to make appearance in the fs->win[] */
(0722) )					/* Move to zero only writes back dirty window */
(0723) {
(0724) 	DWORD wsect;
(0725) 
(0726) 
(0727) 	wsect = fs->winsect;
    00C98 01FA      MOVW	R30,R20
    00C99 96BA      ADIW	R30,0x2A
    00C9A 8020      LD	R2,Z
    00C9B 8031      LDD	R3,Z+1
    00C9C 8042      LDD	R4,Z+2
    00C9D 8053      LDD	R5,Z+3
    00C9E 822D      STD	Y+5,R2
    00C9F 823E      STD	Y+6,R3
    00CA0 824F      STD	Y+7,R4
    00CA1 8658      STD	Y+8,R5
(0728) 	if (wsect != sector) {	/* Changed current window */
    00CA2 842D      LDD	R2,Y+13
    00CA3 843E      LDD	R3,Y+14
    00CA4 844F      LDD	R4,Y+15
    00CA5 8858      LDD	R5,Y+16
    00CA6 806D      LDD	R6,Y+5
    00CA7 807E      LDD	R7,Y+6
    00CA8 808F      LDD	R8,Y+7
    00CA9 8498      LDD	R9,Y+8
    00CAA 1462      CP	R6,R2
    00CAB 0473      CPC	R7,R3
    00CAC 0484      CPC	R8,R4
    00CAD 0495      CPC	R9,R5
    00CAE F409      BNE	0x0CB0
    00CAF C07E      RJMP	0x0D2E
(0729) #if !_FS_READONLY
(0730) 		if (fs->wflag) {	/* Write back dirty window if needed */
    00CB0 01FA      MOVW	R30,R20
    00CB1 8024      LDD	R2,Z+4
    00CB2 2022      TST	R2
    00CB3 F409      BNE	0x0CB5
    00CB4 C055      RJMP	0x0D0A
(0731) 			if (disk_write(fs->drv, fs->win, wsect, 1) != RES_OK)
    00CB5 E081      LDI	R24,1
    00CB6 838C      STD	Y+4,R24
    00CB7 0113      MOVW	R2,R6
    00CB8 0124      MOVW	R4,R8
    00CB9 8228      ST	Y,R2
    00CBA 8239      STD	Y+1,R3
    00CBB 824A      STD	Y+2,R4
    00CBC 825B      STD	Y+3,R5
    00CBD 019A      MOVW	R18,R20
    00CBE 5D22      SUBI	R18,0xD2
    00CBF 4F3F      SBCI	R19,0xFF
    00CC0 8101      LDD	R16,Z+1
    00CC1 940E 0C17 CALL	_disk_write
    00CC3 2300      TST	R16
    00CC4 F011      BEQ	0x0CC7
(0732) 				return FR_DISK_ERR;
    00CC5 E001      LDI	R16,1
    00CC6 C068      RJMP	0x0D2F
(0733) 			fs->wflag = 0;
    00CC7 2422      CLR	R2
    00CC8 01FA      MOVW	R30,R20
    00CC9 8224      STD	Z+4,R2
(0734) 			if (wsect < (fs->fatbase + fs->fsize)) {	/* In FAT area */
    00CCA 8C22      LDD	R2,Z+26
    00CCB 8C33      LDD	R3,Z+27
    00CCC 8C44      LDD	R4,Z+28
    00CCD 8C55      LDD	R5,Z+29
    00CCE 967E      ADIW	R30,0x1E
    00CCF 8060      LD	R6,Z
    00CD0 8071      LDD	R7,Z+1
    00CD1 8082      LDD	R8,Z+2
    00CD2 8093      LDD	R9,Z+3
    00CD3 0C62      ADD	R6,R2
    00CD4 1C73      ADC	R7,R3
    00CD5 1C84      ADC	R8,R4
    00CD6 1C95      ADC	R9,R5
    00CD7 802D      LDD	R2,Y+5
    00CD8 803E      LDD	R3,Y+6
    00CD9 804F      LDD	R4,Y+7
    00CDA 8458      LDD	R5,Y+8
    00CDB 1426      CP	R2,R6
    00CDC 0437      CPC	R3,R7
    00CDD 0448      CPC	R4,R8
    00CDE 0459      CPC	R5,R9
    00CDF F550      BCC	0x0D0A
(0735) 				BYTE nf;
(0736) 				for (nf = fs->n_fats; nf > 1; nf--) {	/* Reflect the change to all FAT copies */
    00CE0 01FA      MOVW	R30,R20
    00CE1 80A3      LDD	R10,Z+3
    00CE2 C024      RJMP	0x0D07
(0737) 					wsect += fs->fsize;
    00CE3 01FA      MOVW	R30,R20
    00CE4 967A      ADIW	R30,0x1A
    00CE5 8020      LD	R2,Z
    00CE6 8031      LDD	R3,Z+1
    00CE7 8042      LDD	R4,Z+2
    00CE8 8053      LDD	R5,Z+3
    00CE9 806D      LDD	R6,Y+5
    00CEA 807E      LDD	R7,Y+6
    00CEB 808F      LDD	R8,Y+7
    00CEC 8498      LDD	R9,Y+8
    00CED 0C62      ADD	R6,R2
    00CEE 1C73      ADC	R7,R3
    00CEF 1C84      ADC	R8,R4
    00CF0 1C95      ADC	R9,R5
    00CF1 826D      STD	Y+5,R6
    00CF2 827E      STD	Y+6,R7
    00CF3 828F      STD	Y+7,R8
    00CF4 8698      STD	Y+8,R9
(0738) 					disk_write(fs->drv, fs->win, wsect, 1);
    00CF5 E081      LDI	R24,1
    00CF6 838C      STD	Y+4,R24
    00CF7 802D      LDD	R2,Y+5
    00CF8 803E      LDD	R3,Y+6
    00CF9 804F      LDD	R4,Y+7
    00CFA 8458      LDD	R5,Y+8
    00CFB 8228      ST	Y,R2
    00CFC 8239      STD	Y+1,R3
    00CFD 824A      STD	Y+2,R4
    00CFE 825B      STD	Y+3,R5
    00CFF 019A      MOVW	R18,R20
    00D00 5D22      SUBI	R18,0xD2
    00D01 4F3F      SBCI	R19,0xFF
    00D02 01FA      MOVW	R30,R20
    00D03 8101      LDD	R16,Z+1
    00D04 940E 0C17 CALL	_disk_write
    00D06 94AA      DEC	R10
    00D07 E081      LDI	R24,1
    00D08 158A      CP	R24,R10
    00D09 F2C8      BCS	0x0CE3
(0739) 				}
(0740) 			}
(0741) 		}
(0742) #endif
(0743) 		if (sector) {
    00D0A 842D      LDD	R2,Y+13
    00D0B 843E      LDD	R3,Y+14
    00D0C 844F      LDD	R4,Y+15
    00D0D 8858      LDD	R5,Y+16
    00D0E 9488      BCLR	0
    00D0F 2022      TST	R2
    00D10 0432      CPC	R3,R2
    00D11 0442      CPC	R4,R2
    00D12 0452      CPC	R5,R2
    00D13 F0D1      BEQ	0x0D2E
(0744) 			if (disk_read(fs->drv, fs->win, sector, 1) != RES_OK)
    00D14 E081      LDI	R24,1
    00D15 838C      STD	Y+4,R24
    00D16 8228      ST	Y,R2
    00D17 8239      STD	Y+1,R3
    00D18 824A      STD	Y+2,R4
    00D19 825B      STD	Y+3,R5
    00D1A 019A      MOVW	R18,R20
    00D1B 5D22      SUBI	R18,0xD2
    00D1C 4F3F      SBCI	R19,0xFF
    00D1D 01FA      MOVW	R30,R20
    00D1E 8101      LDD	R16,Z+1
    00D1F 940E 0BF7 CALL	_disk_read
    00D21 2300      TST	R16
    00D22 F011      BEQ	0x0D25
(0745) 				return FR_DISK_ERR;
    00D23 E001      LDI	R16,1
    00D24 C00A      RJMP	0x0D2F
(0746) 			fs->winsect = sector;
    00D25 842D      LDD	R2,Y+13
    00D26 843E      LDD	R3,Y+14
    00D27 844F      LDD	R4,Y+15
    00D28 8858      LDD	R5,Y+16
    00D29 01FA      MOVW	R30,R20
    00D2A A622      STD	Z+42,R2
    00D2B A633      STD	Z+43,R3
    00D2C A644      STD	Z+44,R4
    00D2D A655      STD	Z+45,R5
(0747) 		}
(0748) 	}
(0749) 
(0750) 	return FR_OK;
    00D2E 2700      CLR	R16
    00D2F 9629      ADIW	R28,0x9
    00D30 940E 4B2D CALL	pop_xgset300C
    00D32 9622      ADIW	R28,2
    00D33 9508      RET
ff.c:sync:
  res                  --> R20
  fs                   --> R22
    00D34 940E 4B32 CALL	push_xgsetF000
    00D36 01B8      MOVW	R22,R16
    00D37 9725      SBIW	R28,5
(0751) }
(0752) 
(0753) 
(0754) 
(0755) 
(0756) /*-----------------------------------------------------------------------*/
(0757) /* Clean-up cached data                                                  */
(0758) /*-----------------------------------------------------------------------*/
(0759) #if !_FS_READONLY
(0760) static
(0761) FRESULT sync (	/* FR_OK: successful, FR_DISK_ERR: failed */
(0762) 	FATFS *fs	/* File system object */
(0763) )
(0764) {
(0765) 	FRESULT res;
(0766) 
(0767) 
(0768) 	res = move_window(fs, 0);
    00D38 E080      LDI	R24,0
    00D39 E090      LDI	R25,0
    00D3A E0A0      LDI	R26,0
    00D3B E0B0      LDI	R27,0
    00D3C 83A8      ST	Y,R26
    00D3D 83B9      STD	Y+1,R27
    00D3E 019C      MOVW	R18,R24
    00D3F 018B      MOVW	R16,R22
    00D40 DF51      RCALL	ff.c:move_window
    00D41 2F40      MOV	R20,R16
(0769) 	if (res == FR_OK) {
    00D42 2300      TST	R16
    00D43 F009      BEQ	0x0D45
    00D44 C0C0      RJMP	0x0E05
(0770) 		/* Update FSInfo sector if needed */
(0771) 		if (fs->fs_type == FS_FAT32 && fs->fsi_flag) {
    00D45 01FB      MOVW	R30,R22
    00D46 8180      LD	R24,Z
    00D47 3083      CPI	R24,3
    00D48 F009      BEQ	0x0D4A
    00D49 C0AC      RJMP	0x0DF6
    00D4A 8025      LDD	R2,Z+5
    00D4B 2022      TST	R2
    00D4C F409      BNE	0x0D4E
    00D4D C0A8      RJMP	0x0DF6
(0772) 			fs->winsect = 0;
    00D4E 96BA      ADIW	R30,0x2A
    00D4F E080      LDI	R24,0
    00D50 8380      ST	Z,R24
    00D51 8381      STD	Z+1,R24
    00D52 8382      STD	Z+2,R24
    00D53 8383      STD	Z+3,R24
(0773) 			/* Create FSInfo structure */
(0774) 			mem_set(fs->win, 0, 512);
    00D54 E080      LDI	R24,0
    00D55 E092      LDI	R25,2
    00D56 8399      STD	Y+1,R25
    00D57 8388      ST	Y,R24
    00D58 2722      CLR	R18
    00D59 2733      CLR	R19
    00D5A 018B      MOVW	R16,R22
    00D5B 5D02      SUBI	R16,0xD2
    00D5C 4F1F      SBCI	R17,0xFF
    00D5D DEF1      RCALL	ff.c:mem_set
(0775) 			ST_WORD(fs->win+BS_55AA, 0xAA55);
    00D5E E585      LDI	R24,0x55
    00D5F 01FB      MOVW	R30,R22
    00D60 5DE4      SUBI	R30,0xD4
    00D61 4FFD      SBCI	R31,0xFD
    00D62 8380      ST	Z,R24
    00D63 52EC      SUBI	R30,0x2C
    00D64 40F2      SBCI	R31,2
    00D65 EA8A      LDI	R24,0xAA
    00D66 5DE3      SUBI	R30,0xD3
    00D67 4FFD      SBCI	R31,0xFD
    00D68 8380      ST	Z,R24
    00D69 52ED      SUBI	R30,0x2D
    00D6A 40F2      SBCI	R31,2
(0776) 			ST_DWORD(fs->win+FSI_LeadSig, 0x41615252);
    00D6B E582      LDI	R24,0x52
    00D6C A786      STD	Z+46,R24
    00D6D A787      STD	Z+47,R24
    00D6E E681      LDI	R24,0x61
    00D6F AB80      STD	Z+48,R24
    00D70 E481      LDI	R24,0x41
    00D71 AB81      STD	Z+49,R24
(0777) 			ST_DWORD(fs->win+FSI_StrucSig, 0x61417272);
    00D72 E782      LDI	R24,0x72
    00D73 5EEE      SUBI	R30,0xEE
    00D74 4FFD      SBCI	R31,0xFD
    00D75 8380      ST	Z,R24
    00D76 51E2      SUBI	R30,0x12
    00D77 40F2      SBCI	R31,2
    00D78 5EED      SUBI	R30,0xED
    00D79 4FFD      SBCI	R31,0xFD
    00D7A 8380      ST	Z,R24
    00D7B 51E3      SUBI	R30,0x13
    00D7C 40F2      SBCI	R31,2
    00D7D E481      LDI	R24,0x41
    00D7E 5EEC      SUBI	R30,0xEC
    00D7F 4FFD      SBCI	R31,0xFD
    00D80 8380      ST	Z,R24
    00D81 51E4      SUBI	R30,0x14
    00D82 40F2      SBCI	R31,2
    00D83 E681      LDI	R24,0x61
    00D84 5EEB      SUBI	R30,0xEB
    00D85 4FFD      SBCI	R31,0xFD
    00D86 8380      ST	Z,R24
    00D87 51E5      SUBI	R30,0x15
    00D88 40F2      SBCI	R31,2
(0778) 			ST_DWORD(fs->win+FSI_Free_Count, fs->free_clust);
    00D89 8426      LDD	R2,Z+14
    00D8A 8437      LDD	R3,Z+15
    00D8B 8840      LDD	R4,Z+16
    00D8C 8851      LDD	R5,Z+17
    00D8D 5EEA      SUBI	R30,0xEA
    00D8E 4FFD      SBCI	R31,0xFD
    00D8F 8220      ST	Z,R2
    00D90 51E6      SUBI	R30,0x16
    00D91 40F2      SBCI	R31,2
    00D92 8426      LDD	R2,Z+14
    00D93 8437      LDD	R3,Z+15
    00D94 2C23      MOV	R2,R3
    00D95 2433      CLR	R3
    00D96 5EE9      SUBI	R30,0xE9
    00D97 4FFD      SBCI	R31,0xFD
    00D98 8220      ST	Z,R2
    00D99 51E7      SUBI	R30,0x17
    00D9A 40F2      SBCI	R31,2
    00D9B 8426      LDD	R2,Z+14
    00D9C 8437      LDD	R3,Z+15
    00D9D 8840      LDD	R4,Z+16
    00D9E 8851      LDD	R5,Z+17
    00D9F 0112      MOVW	R2,R4
    00DA0 2444      CLR	R4
    00DA1 2455      CLR	R5
    00DA2 5EE8      SUBI	R30,0xE8
    00DA3 4FFD      SBCI	R31,0xFD
    00DA4 8220      ST	Z,R2
    00DA5 51E8      SUBI	R30,0x18
    00DA6 40F2      SBCI	R31,2
    00DA7 E188      LDI	R24,0x18
    00DA8 E090      LDI	R25,0
    00DA9 8506      LDD	R16,Z+14
    00DAA 8517      LDD	R17,Z+15
    00DAB 8920      LDD	R18,Z+16
    00DAC 8931      LDD	R19,Z+17
    00DAD 938A      ST	-Y,R24
    00DAE 940E 4BC1 CALL	lsr32
    00DB0 01FB      MOVW	R30,R22
    00DB1 5EE7      SUBI	R30,0xE7
    00DB2 4FFD      SBCI	R31,0xFD
    00DB3 8300      ST	Z,R16
    00DB4 51E9      SUBI	R30,0x19
    00DB5 40F2      SBCI	R31,2
(0779) 			ST_DWORD(fs->win+FSI_Nxt_Free, fs->last_clust);
    00DB6 8422      LDD	R2,Z+10
    00DB7 8433      LDD	R3,Z+11
    00DB8 8444      LDD	R4,Z+12
    00DB9 8455      LDD	R5,Z+13
    00DBA 5EE6      SUBI	R30,0xE6
    00DBB 4FFD      SBCI	R31,0xFD
    00DBC 8220      ST	Z,R2
    00DBD 51EA      SUBI	R30,0x1A
    00DBE 40F2      SBCI	R31,2
    00DBF 8422      LDD	R2,Z+10
    00DC0 8433      LDD	R3,Z+11
    00DC1 2C23      MOV	R2,R3
    00DC2 2433      CLR	R3
    00DC3 5EE5      SUBI	R30,0xE5
    00DC4 4FFD      SBCI	R31,0xFD
    00DC5 8220      ST	Z,R2
    00DC6 51EB      SUBI	R30,0x1B
    00DC7 40F2      SBCI	R31,2
    00DC8 8422      LDD	R2,Z+10
    00DC9 8433      LDD	R3,Z+11
    00DCA 8444      LDD	R4,Z+12
    00DCB 8455      LDD	R5,Z+13
    00DCC 0112      MOVW	R2,R4
    00DCD 2444      CLR	R4
    00DCE 2455      CLR	R5
    00DCF 5EE4      SUBI	R30,0xE4
    00DD0 4FFD      SBCI	R31,0xFD
    00DD1 8220      ST	Z,R2
    00DD2 51EC      SUBI	R30,0x1C
    00DD3 40F2      SBCI	R31,2
    00DD4 E188      LDI	R24,0x18
    00DD5 E090      LDI	R25,0
    00DD6 8502      LDD	R16,Z+10
    00DD7 8513      LDD	R17,Z+11
    00DD8 8524      LDD	R18,Z+12
    00DD9 8535      LDD	R19,Z+13
    00DDA 938A      ST	-Y,R24
    00DDB 940E 4BC1 CALL	lsr32
    00DDD 01FB      MOVW	R30,R22
    00DDE 5EE3      SUBI	R30,0xE3
    00DDF 4FFD      SBCI	R31,0xFD
    00DE0 8300      ST	Z,R16
    00DE1 51ED      SUBI	R30,0x1D
    00DE2 40F2      SBCI	R31,2
(0780) 			/* Write it into the FSInfo sector */
(0781) 			disk_write(fs->drv, fs->win, fs->fsi_sector, 1);
    00DE3 E081      LDI	R24,1
    00DE4 838C      STD	Y+4,R24
    00DE5 8822      LDD	R2,Z+18
    00DE6 8833      LDD	R3,Z+19
    00DE7 8844      LDD	R4,Z+20
    00DE8 8855      LDD	R5,Z+21
    00DE9 8228      ST	Y,R2
    00DEA 8239      STD	Y+1,R3
    00DEB 824A      STD	Y+2,R4
    00DEC 825B      STD	Y+3,R5
    00DED 019F      MOVW	R18,R30
    00DEE 5D22      SUBI	R18,0xD2
    00DEF 4F3F      SBCI	R19,0xFF
    00DF0 8101      LDD	R16,Z+1
    00DF1 940E 0C17 CALL	_disk_write
(0782) 			fs->fsi_flag = 0;
    00DF3 2422      CLR	R2
    00DF4 01FB      MOVW	R30,R22
    00DF5 8225      STD	Z+5,R2
(0783) 		}
(0784) 		/* Make sure that no pending write process in the physical drive */
(0785) 		if (disk_ioctl(fs->drv, CTRL_SYNC, 0) != RES_OK)
    00DF6 2422      CLR	R2
    00DF7 2433      CLR	R3
    00DF8 8239      STD	Y+1,R3
    00DF9 8228      ST	Y,R2
    00DFA 2722      CLR	R18
    00DFB 2733      CLR	R19
    00DFC 01FB      MOVW	R30,R22
    00DFD 8101      LDD	R16,Z+1
    00DFE 2711      CLR	R17
    00DFF 940E 0C2F CALL	_disk_ioctl
    00E01 3000      CPI	R16,0
    00E02 0701      CPC	R16,R17
    00E03 F009      BEQ	0x0E05
(0786) 			res = FR_DISK_ERR;
    00E04 E041      LDI	R20,1
(0787) 	}
(0788) 
(0789) 	return res;
    00E05 2F04      MOV	R16,R20
    00E06 9625      ADIW	R28,5
    00E07 940C 4B37 JMP	pop_xgsetF000
_clust2sect:
  clst                 --> Y,+6
  fs                   --> R10
    00E09 933A      ST	-Y,R19
    00E0A 932A      ST	-Y,R18
    00E0B 940E 4B3C CALL	push_xgsetF00C
    00E0D 0158      MOVW	R10,R16
(0790) }
(0791) #endif
(0792) 
(0793) 
(0794) 
(0795) 
(0796) /*-----------------------------------------------------------------------*/
(0797) /* Get sector# from cluster#                                             */
(0798) /*-----------------------------------------------------------------------*/
(0799) 
(0800) 
(0801) DWORD clust2sect (	/* !=0: Sector number, 0: Failed - invalid cluster# */
(0802) 	FATFS *fs,		/* File system object */
(0803) 	DWORD clst		/* Cluster# to be converted */
(0804) )
(0805) {
(0806) 	clst -= 2;
    00E0E E042      LDI	R20,2
    00E0F E050      LDI	R21,0
    00E10 E060      LDI	R22,0
    00E11 E070      LDI	R23,0
    00E12 802E      LDD	R2,Y+6
    00E13 803F      LDD	R3,Y+7
    00E14 8448      LDD	R4,Y+8
    00E15 8459      LDD	R5,Y+9
    00E16 1A24      SUB	R2,R20
    00E17 0A35      SBC	R3,R21
    00E18 0A46      SBC	R4,R22
    00E19 0A57      SBC	R5,R23
    00E1A 822E      STD	Y+6,R2
    00E1B 823F      STD	Y+7,R3
    00E1C 8648      STD	Y+8,R4
    00E1D 8659      STD	Y+9,R5
(0807) 	if (clst >= (fs->n_fatent - 2)) return 0;		/* Invalid cluster# */
    00E1E E042      LDI	R20,2
    00E1F E050      LDI	R21,0
    00E20 E060      LDI	R22,0
    00E21 E070      LDI	R23,0
    00E22 01F5      MOVW	R30,R10
    00E23 9676      ADIW	R30,0x16
    00E24 8020      LD	R2,Z
    00E25 8031      LDD	R3,Z+1
    00E26 8042      LDD	R4,Z+2
    00E27 8053      LDD	R5,Z+3
    00E28 1A24      SUB	R2,R20
    00E29 0A35      SBC	R3,R21
    00E2A 0A46      SBC	R4,R22
    00E2B 0A57      SBC	R5,R23
    00E2C 806E      LDD	R6,Y+6
    00E2D 807F      LDD	R7,Y+7
    00E2E 8488      LDD	R8,Y+8
    00E2F 8499      LDD	R9,Y+9
    00E30 1462      CP	R6,R2
    00E31 0473      CPC	R7,R3
    00E32 0484      CPC	R8,R4
    00E33 0495      CPC	R9,R5
    00E34 F028      BCS	0x0E3A
    00E35 E000      LDI	R16,0
    00E36 E010      LDI	R17,0
    00E37 E020      LDI	R18,0
    00E38 E030      LDI	R19,0
    00E39 C01D      RJMP	0x0E57
(0808) 	return clst * fs->csize + fs->database;
    00E3A 01F5      MOVW	R30,R10
    00E3B 9632      ADIW	R30,2
    00E3C 8020      LD	R2,Z
    00E3D 2433      CLR	R3
    00E3E 2444      CLR	R4
    00E3F 2455      CLR	R5
    00E40 810E      LDD	R16,Y+6
    00E41 811F      LDD	R17,Y+7
    00E42 8528      LDD	R18,Y+8
    00E43 8539      LDD	R19,Y+9
    00E44 925A      ST	-Y,R5
    00E45 924A      ST	-Y,R4
    00E46 923A      ST	-Y,R3
    00E47 922A      ST	-Y,R2
    00E48 940E 4AC9 CALL	empy32s|empy32u
    00E4A 0118      MOVW	R2,R16
    00E4B 0129      MOVW	R4,R18
    00E4C 01F5      MOVW	R30,R10
    00E4D A066      LDD	R6,Z+38
    00E4E A077      LDD	R7,Z+39
    00E4F A480      LDD	R8,Z+40
    00E50 A491      LDD	R9,Z+41
    00E51 0C26      ADD	R2,R6
    00E52 1C37      ADC	R3,R7
    00E53 1C48      ADC	R4,R8
    00E54 1C59      ADC	R5,R9
    00E55 0181      MOVW	R16,R2
    00E56 0192      MOVW	R18,R4
    00E57 940E 4B43 CALL	pop_xgsetF00C
    00E59 9622      ADIW	R28,2
    00E5A 9508      RET
_get_fat:
  wc                   --> R14
  p                    --> R10
  bc                   --> R10
  clst                 --> Y,+12
  fs                   --> R12
    00E5B 933A      ST	-Y,R19
    00E5C 932A      ST	-Y,R18
    00E5D 940E 4B1D CALL	push_xgsetF0FC
    00E5F 0168      MOVW	R12,R16
    00E60 9722      SBIW	R28,2
(0809) }
(0810) 
(0811) 
(0812) 
(0813) 
(0814) /*-----------------------------------------------------------------------*/
(0815) /* FAT access - Read value of a FAT entry                                */
(0816) /*-----------------------------------------------------------------------*/
(0817) 
(0818) 
(0819) DWORD get_fat (	/* 0xFFFFFFFF:Disk error, 1:Internal error, Else:Cluster status */
(0820) 	FATFS *fs,	/* File system object */
(0821) 	DWORD clst	/* Cluster# to get the link information */
(0822) )
(0823) {
(0824) 	UINT wc, bc;
(0825) 	BYTE *p;
(0826) 
(0827) 
(0828) 	if (clst < 2 || clst >= fs->n_fatent)	/* Chack range */
    00E61 E042      LDI	R20,2
    00E62 E050      LDI	R21,0
    00E63 E060      LDI	R22,0
    00E64 E070      LDI	R23,0
    00E65 842C      LDD	R2,Y+12
    00E66 843D      LDD	R3,Y+13
    00E67 844E      LDD	R4,Y+14
    00E68 845F      LDD	R5,Y+15
    00E69 1624      CP	R2,R20
    00E6A 0635      CPC	R3,R21
    00E6B 0646      CPC	R4,R22
    00E6C 0657      CPC	R5,R23
    00E6D F078      BCS	0x0E7D
    00E6E 01F6      MOVW	R30,R12
    00E6F 9676      ADIW	R30,0x16
    00E70 8020      LD	R2,Z
    00E71 8031      LDD	R3,Z+1
    00E72 8042      LDD	R4,Z+2
    00E73 8053      LDD	R5,Z+3
    00E74 846C      LDD	R6,Y+12
    00E75 847D      LDD	R7,Y+13
    00E76 848E      LDD	R8,Y+14
    00E77 849F      LDD	R9,Y+15
    00E78 1462      CP	R6,R2
    00E79 0473      CPC	R7,R3
    00E7A 0484      CPC	R8,R4
    00E7B 0495      CPC	R9,R5
    00E7C F028      BCS	0x0E82
(0829) 		return 1;
    00E7D E001      LDI	R16,1
    00E7E E010      LDI	R17,0
    00E7F E020      LDI	R18,0
    00E80 E030      LDI	R19,0
    00E81 C124      RJMP	0x0FA6
(0830) 
(0831) 	switch (fs->fs_type) {
    00E82 01F6      MOVW	R30,R12
    00E83 80A0      LD	R10,Z
    00E84 24BB      CLR	R11
    00E85 01C5      MOVW	R24,R10
    00E86 3081      CPI	R24,1
    00E87 E0E0      LDI	R30,0
    00E88 079E      CPC	R25,R30
    00E89 F059      BEQ	0x0E95
    00E8A 3082      CPI	R24,2
    00E8B E0E0      LDI	R30,0
    00E8C 079E      CPC	R25,R30
    00E8D F409      BNE	0x0E8F
    00E8E C06F      RJMP	0x0EFE
    00E8F 3083      CPI	R24,3
    00E90 E0E0      LDI	R30,0
    00E91 079E      CPC	R25,R30
    00E92 F409      BNE	0x0E94
    00E93 C0A6      RJMP	0x0F3A
    00E94 C10D      RJMP	0x0FA2
(0832) 	case FS_FAT12 :
(0833) 		bc = (UINT)clst; bc += bc / 2;
    00E95 84AC      LDD	R10,Y+12
    00E96 84BD      LDD	R11,Y+13
    00E97 0115      MOVW	R2,R10
    00E98 9436      LSR	R3
    00E99 9427      ROR	R2
    00E9A 0CA2      ADD	R10,R2
    00E9B 1CB3      ADC	R11,R3
(0834) 		if (move_window(fs, fs->fatbase + (bc / SS(fs)))) break;
    00E9C E029      LDI	R18,0x9
    00E9D E030      LDI	R19,0
    00E9E 0185      MOVW	R16,R10
    00E9F 940E 4BBA CALL	lsr16
    00EA1 0118      MOVW	R2,R16
    00EA2 2444      CLR	R4
    00EA3 2455      CLR	R5
    00EA4 01F6      MOVW	R30,R12
    00EA5 8C66      LDD	R6,Z+30
    00EA6 8C77      LDD	R7,Z+31
    00EA7 A080      LDD	R8,Z+32
    00EA8 A091      LDD	R9,Z+33
    00EA9 0C62      ADD	R6,R2
    00EAA 1C73      ADC	R7,R3
    00EAB 1C84      ADC	R8,R4
    00EAC 1C95      ADC	R9,R5
    00EAD 8288      ST	Y,R8
    00EAE 8299      STD	Y+1,R9
    00EAF 0193      MOVW	R18,R6
    00EB0 018F      MOVW	R16,R30
    00EB1 DDE0      RCALL	ff.c:move_window
    00EB2 2300      TST	R16
    00EB3 F009      BEQ	0x0EB5
    00EB4 C0ED      RJMP	0x0FA2
(0835) 		wc = fs->win[bc % SS(fs)]; bc++;
    00EB5 01C6      MOVW	R24,R12
    00EB6 968E      ADIW	R24,0x2E
    00EB7 01F5      MOVW	R30,R10
    00EB8 70F1      ANDI	R31,1
    00EB9 0FE8      ADD	R30,R24
    00EBA 1FF9      ADC	R31,R25
    00EBB 80E0      LD	R14,Z
    00EBC 24FF      CLR	R15
    00EBD 01C5      MOVW	R24,R10
    00EBE 9601      ADIW	R24,1
    00EBF 015C      MOVW	R10,R24
(0836) 		if (move_window(fs, fs->fatbase + (bc / SS(fs)))) break;
    00EC0 E029      LDI	R18,0x9
    00EC1 E030      LDI	R19,0
    00EC2 018C      MOVW	R16,R24
    00EC3 940E 4BBA CALL	lsr16
    00EC5 0118      MOVW	R2,R16
    00EC6 2444      CLR	R4
    00EC7 2455      CLR	R5
    00EC8 01F6      MOVW	R30,R12
    00EC9 8C66      LDD	R6,Z+30
    00ECA 8C77      LDD	R7,Z+31
    00ECB A080      LDD	R8,Z+32
    00ECC A091      LDD	R9,Z+33
    00ECD 0C62      ADD	R6,R2
    00ECE 1C73      ADC	R7,R3
    00ECF 1C84      ADC	R8,R4
    00ED0 1C95      ADC	R9,R5
    00ED1 8288      ST	Y,R8
    00ED2 8299      STD	Y+1,R9
    00ED3 0193      MOVW	R18,R6
    00ED4 018F      MOVW	R16,R30
    00ED5 DDBC      RCALL	ff.c:move_window
    00ED6 2300      TST	R16
    00ED7 F009      BEQ	0x0ED9
    00ED8 C0C9      RJMP	0x0FA2
(0837) 		wc |= fs->win[bc % SS(fs)] << 8;
    00ED9 01C6      MOVW	R24,R12
    00EDA 968E      ADIW	R24,0x2E
    00EDB 01F5      MOVW	R30,R10
    00EDC 70F1      ANDI	R31,1
    00EDD 0FE8      ADD	R30,R24
    00EDE 1FF9      ADC	R31,R25
    00EDF 8020      LD	R2,Z
    00EE0 2433      CLR	R3
    00EE1 2C32      MOV	R3,R2
    00EE2 2422      CLR	R2
    00EE3 28E2      OR	R14,R2
    00EE4 28F3      OR	R15,R3
(0838) 		return (clst & 1) ? (wc >> 4) : (wc & 0xFFF);
    00EE5 842C      LDD	R2,Y+12
    00EE6 843D      LDD	R3,Y+13
    00EE7 844E      LDD	R4,Y+14
    00EE8 845F      LDD	R5,Y+15
    00EE9 2DE2      MOV	R30,R2
    00EEA 70E1      ANDI	R30,1
    00EEB F051      BEQ	0x0EF6
    00EEC 0157      MOVW	R10,R14
    00EED 94B6      LSR	R11
    00EEE 94A7      ROR	R10
    00EEF 94B6      LSR	R11
    00EF0 94A7      ROR	R10
    00EF1 94B6      LSR	R11
    00EF2 94A7      ROR	R10
    00EF3 94B6      LSR	R11
    00EF4 94A7      ROR	R10
    00EF5 C003      RJMP	0x0EF9
    00EF6 01C7      MOVW	R24,R14
    00EF7 709F      ANDI	R25,0xF
    00EF8 015C      MOVW	R10,R24
    00EF9 0185      MOVW	R16,R10
    00EFA 0196      MOVW	R18,R12
    00EFB 2722      CLR	R18
    00EFC 2733      CLR	R19
    00EFD C0A8      RJMP	0x0FA6
(0839) 
(0840) 	case FS_FAT16 :
(0841) 		if (move_window(fs, fs->fatbase + (clst / (SS(fs) / 2)))) break;
    00EFE E088      LDI	R24,0x8
    00EFF E090      LDI	R25,0
    00F00 850C      LDD	R16,Y+12
    00F01 851D      LDD	R17,Y+13
    00F02 852E      LDD	R18,Y+14
    00F03 853F      LDD	R19,Y+15
    00F04 938A      ST	-Y,R24
    00F05 940E 4BC1 CALL	lsr32
    00F07 01F6      MOVW	R30,R12
    00F08 8C26      LDD	R2,Z+30
    00F09 8C37      LDD	R3,Z+31
    00F0A A040      LDD	R4,Z+32
    00F0B A051      LDD	R5,Z+33
    00F0C 0E20      ADD	R2,R16
    00F0D 1E31      ADC	R3,R17
    00F0E 1E42      ADC	R4,R18
    00F0F 1E53      ADC	R5,R19
    00F10 8248      ST	Y,R4
    00F11 8259      STD	Y+1,R5
    00F12 0191      MOVW	R18,R2
    00F13 018F      MOVW	R16,R30
    00F14 DD7D      RCALL	ff.c:move_window
    00F15 2EA0      MOV	R10,R16
    00F16 2300      TST	R16
    00F17 F009      BEQ	0x0F19
    00F18 C089      RJMP	0x0FA2
(0842) 		p = &fs->win[clst * 2 % SS(fs)];
    00F19 EF4F      LDI	R20,0xFF
    00F1A E051      LDI	R21,1
    00F1B E060      LDI	R22,0
    00F1C E070      LDI	R23,0
    00F1D 842C      LDD	R2,Y+12
    00F1E 843D      LDD	R3,Y+13
    00F1F 844E      LDD	R4,Y+14
    00F20 845F      LDD	R5,Y+15
    00F21 0C22      LSL	R2
    00F22 1C33      ROL	R3
    00F23 1C44      ROL	R4
    00F24 1C55      ROL	R5
    00F25 2224      AND	R2,R20
    00F26 2235      AND	R3,R21
    00F27 2246      AND	R4,R22
    00F28 2257      AND	R5,R23
    00F29 0151      MOVW	R10,R2
    00F2A 01C6      MOVW	R24,R12
    00F2B 968E      ADIW	R24,0x2E
    00F2C 0EA8      ADD	R10,R24
    00F2D 1EB9      ADC	R11,R25
(0843) 		return LD_WORD(p);
    00F2E 01F5      MOVW	R30,R10
    00F2F 8020      LD	R2,Z
    00F30 2433      CLR	R3
    00F31 8101      LDD	R16,Z+1
    00F32 2711      CLR	R17
    00F33 2F10      MOV	R17,R16
    00F34 2700      CLR	R16
    00F35 2902      OR	R16,R2
    00F36 2913      OR	R17,R3
    00F37 2722      CLR	R18
    00F38 2733      CLR	R19
    00F39 C06C      RJMP	0x0FA6
(0844) 
(0845) 	case FS_FAT32 :
(0846) 		if (move_window(fs, fs->fatbase + (clst / (SS(fs) / 4)))) break;
    00F3A E087      LDI	R24,7
    00F3B E090      LDI	R25,0
    00F3C 850C      LDD	R16,Y+12
    00F3D 851D      LDD	R17,Y+13
    00F3E 852E      LDD	R18,Y+14
    00F3F 853F      LDD	R19,Y+15
    00F40 938A      ST	-Y,R24
    00F41 940E 4BC1 CALL	lsr32
    00F43 01F6      MOVW	R30,R12
    00F44 8C26      LDD	R2,Z+30
    00F45 8C37      LDD	R3,Z+31
    00F46 A040      LDD	R4,Z+32
    00F47 A051      LDD	R5,Z+33
    00F48 0E20      ADD	R2,R16
    00F49 1E31      ADC	R3,R17
    00F4A 1E42      ADC	R4,R18
    00F4B 1E53      ADC	R5,R19
    00F4C 8248      ST	Y,R4
    00F4D 8259      STD	Y+1,R5
    00F4E 0191      MOVW	R18,R2
    00F4F 018F      MOVW	R16,R30
    00F50 DD41      RCALL	ff.c:move_window
    00F51 2EE0      MOV	R14,R16
    00F52 2300      TST	R16
    00F53 F009      BEQ	0x0F55
    00F54 C04D      RJMP	0x0FA2
(0847) 		p = &fs->win[clst * 4 % SS(fs)];
    00F55 E082      LDI	R24,2
    00F56 E090      LDI	R25,0
    00F57 850C      LDD	R16,Y+12
    00F58 851D      LDD	R17,Y+13
    00F59 852E      LDD	R18,Y+14
    00F5A 853F      LDD	R19,Y+15
    00F5B 938A      ST	-Y,R24
    00F5C 940E 4BA8 CALL	lsl32
    00F5E 0118      MOVW	R2,R16
    00F5F 0129      MOVW	R4,R18
    00F60 EF4F      LDI	R20,0xFF
    00F61 E051      LDI	R21,1
    00F62 E060      LDI	R22,0
    00F63 E070      LDI	R23,0
    00F64 2224      AND	R2,R20
    00F65 2235      AND	R3,R21
    00F66 2246      AND	R4,R22
    00F67 2257      AND	R5,R23
    00F68 0151      MOVW	R10,R2
    00F69 01C6      MOVW	R24,R12
    00F6A 968E      ADIW	R24,0x2E
    00F6B 0EA8      ADD	R10,R24
    00F6C 1EB9      ADC	R11,R25
(0848) 		return LD_DWORD(p) & 0x0FFFFFFF;
    00F6D E188      LDI	R24,0x18
    00F6E E090      LDI	R25,0
    00F6F 01F5      MOVW	R30,R10
    00F70 8103      LDD	R16,Z+3
    00F71 2711      CLR	R17
    00F72 2722      CLR	R18
    00F73 2733      CLR	R19
    00F74 938A      ST	-Y,R24
    00F75 940E 4BA8 CALL	lsl32
    00F77 0118      MOVW	R2,R16
    00F78 0129      MOVW	R4,R18
    00F79 01F5      MOVW	R30,R10
    00F7A 8062      LDD	R6,Z+2
    00F7B 2477      CLR	R7
    00F7C 2488      CLR	R8
    00F7D 2499      CLR	R9
    00F7E 0143      MOVW	R8,R6
    00F7F 2466      CLR	R6
    00F80 2477      CLR	R7
    00F81 2826      OR	R2,R6
    00F82 2837      OR	R3,R7
    00F83 2848      OR	R4,R8
    00F84 2859      OR	R5,R9
    00F85 8061      LDD	R6,Z+1
    00F86 2477      CLR	R7
    00F87 2C76      MOV	R7,R6
    00F88 2466      CLR	R6
    00F89 2488      CLR	R8
    00F8A 2499      CLR	R9
    00F8B 2826      OR	R2,R6
    00F8C 2837      OR	R3,R7
    00F8D 2848      OR	R4,R8
    00F8E 2859      OR	R5,R9
    00F8F 8060      LD	R6,Z
    00F90 2477      CLR	R7
    00F91 2488      CLR	R8
    00F92 2499      CLR	R9
    00F93 2826      OR	R2,R6
    00F94 2837      OR	R3,R7
    00F95 2848      OR	R4,R8
    00F96 2859      OR	R5,R9
    00F97 EF4F      LDI	R20,0xFF
    00F98 EF5F      LDI	R21,0xFF
    00F99 EF6F      LDI	R22,0xFF
    00F9A E07F      LDI	R23,0xF
    00F9B 2224      AND	R2,R20
    00F9C 2235      AND	R3,R21
    00F9D 2246      AND	R4,R22
    00F9E 2257      AND	R5,R23
    00F9F 0181      MOVW	R16,R2
    00FA0 0192      MOVW	R18,R4
    00FA1 C004      RJMP	0x0FA6
(0849) 	}
(0850) 
(0851) 	return 0xFFFFFFFF;	/* An error occurred at the disk I/O layer */
    00FA2 EF0F      LDI	R16,0xFF
    00FA3 EF1F      LDI	R17,0xFF
    00FA4 EF2F      LDI	R18,0xFF
    00FA5 EF3F      LDI	R19,0xFF
    00FA6 9622      ADIW	R28,2
    00FA7 940E 4B12 CALL	pop_xgsetF0FC
    00FA9 9622      ADIW	R28,2
    00FAA 9508      RET
_put_fat:
  bc                   --> R12
  p                    --> R14
  res                  --> Y,+2
  val                  --> Y,+19
  clst                 --> Y,+15
  fs                   --> Y,+13
    00FAB 940E 49D8 CALL	push_arg4
    00FAD 940E 4B1D CALL	push_xgsetF0FC
    00FAF 9723      SBIW	R28,3
(0852) }
(0853) 
(0854) 
(0855) 
(0856) 
(0857) /*-----------------------------------------------------------------------*/
(0858) /* FAT access - Change value of a FAT entry                              */
(0859) /*-----------------------------------------------------------------------*/
(0860) #if !_FS_READONLY
(0861) 
(0862) FRESULT put_fat (
(0863) 	FATFS *fs,	/* File system object */
(0864) 	DWORD clst,	/* Cluster# to be changed in range of 2 to fs->n_fatent - 1 */
(0865) 	DWORD val	/* New value to mark the cluster */
(0866) )
(0867) {
(0868) 	UINT bc;
(0869) 	BYTE *p;
(0870) 	FRESULT res;
(0871) 
(0872) 
(0873) 	if (clst < 2 || clst >= fs->n_fatent) {	/* Check range */
    00FB0 E042      LDI	R20,2
    00FB1 E050      LDI	R21,0
    00FB2 E060      LDI	R22,0
    00FB3 E070      LDI	R23,0
    00FB4 842F      LDD	R2,Y+15
    00FB5 8838      LDD	R3,Y+16
    00FB6 8849      LDD	R4,Y+17
    00FB7 885A      LDD	R5,Y+18
    00FB8 1624      CP	R2,R20
    00FB9 0635      CPC	R3,R21
    00FBA 0646      CPC	R4,R22
    00FBB 0657      CPC	R5,R23
    00FBC F080      BCS	0x0FCD
    00FBD 85ED      LDD	R30,Y+13
    00FBE 85FE      LDD	R31,Y+14
    00FBF 9676      ADIW	R30,0x16
    00FC0 8020      LD	R2,Z
    00FC1 8031      LDD	R3,Z+1
    00FC2 8042      LDD	R4,Z+2
    00FC3 8053      LDD	R5,Z+3
    00FC4 846F      LDD	R6,Y+15
    00FC5 8878      LDD	R7,Y+16
    00FC6 8889      LDD	R8,Y+17
    00FC7 889A      LDD	R9,Y+18
    00FC8 1462      CP	R6,R2
    00FC9 0473      CPC	R7,R3
    00FCA 0484      CPC	R8,R4
    00FCB 0495      CPC	R9,R5
    00FCC F018      BCS	0x0FD0
(0874) 		res = FR_INT_ERR;
    00FCD E082      LDI	R24,2
    00FCE 838A      STD	Y+2,R24
(0875) 
(0876) 	} else {
    00FCF C194      RJMP	0x1164
(0877) 		switch (fs->fs_type) {
    00FD0 85ED      LDD	R30,Y+13
    00FD1 85FE      LDD	R31,Y+14
    00FD2 80A0      LD	R10,Z
    00FD3 24BB      CLR	R11
    00FD4 01C5      MOVW	R24,R10
    00FD5 3081      CPI	R24,1
    00FD6 E0E0      LDI	R30,0
    00FD7 079E      CPC	R25,R30
    00FD8 F059      BEQ	0x0FE4
    00FD9 3082      CPI	R24,2
    00FDA E0E0      LDI	R30,0
    00FDB 079E      CPC	R25,R30
    00FDC F409      BNE	0x0FDE
    00FDD C0B0      RJMP	0x108E
    00FDE 3083      CPI	R24,3
    00FDF E0E0      LDI	R30,0
    00FE0 079E      CPC	R25,R30
    00FE1 F409      BNE	0x0FE3
    00FE2 C0E7      RJMP	0x10CA
    00FE3 C17A      RJMP	0x115E
(0878) 		case FS_FAT12 :
(0879) 			bc = clst; bc += bc / 2;
    00FE4 84CF      LDD	R12,Y+15
    00FE5 88D8      LDD	R13,Y+16
    00FE6 0116      MOVW	R2,R12
    00FE7 9436      LSR	R3
    00FE8 9427      ROR	R2
    00FE9 0CC2      ADD	R12,R2
    00FEA 1CD3      ADC	R13,R3
(0880) 			res = move_window(fs, fs->fatbase + (bc / SS(fs)));
    00FEB E029      LDI	R18,0x9
    00FEC E030      LDI	R19,0
    00FED 0186      MOVW	R16,R12
    00FEE 940E 4BBA CALL	lsr16
    00FF0 0118      MOVW	R2,R16
    00FF1 2444      CLR	R4
    00FF2 2455      CLR	R5
    00FF3 85ED      LDD	R30,Y+13
    00FF4 85FE      LDD	R31,Y+14
    00FF5 8C66      LDD	R6,Z+30
    00FF6 8C77      LDD	R7,Z+31
    00FF7 A080      LDD	R8,Z+32
    00FF8 A091      LDD	R9,Z+33
    00FF9 0C62      ADD	R6,R2
    00FFA 1C73      ADC	R7,R3
    00FFB 1C84      ADC	R8,R4
    00FFC 1C95      ADC	R9,R5
    00FFD 8288      ST	Y,R8
    00FFE 8299      STD	Y+1,R9
    00FFF 0193      MOVW	R18,R6
    01000 018F      MOVW	R16,R30
    01001 DC90      RCALL	ff.c:move_window
    01002 830A      STD	Y+2,R16
(0881) 			if (res != FR_OK) break;
    01003 2E00      MOV	R0,R16
    01004 2300      TST	R16
    01005 F009      BEQ	0x1007
    01006 C159      RJMP	0x1160
(0882) 			p = &fs->win[bc % SS(fs)];
    01007 858D      LDD	R24,Y+13
    01008 859E      LDD	R25,Y+14
    01009 968E      ADIW	R24,0x2E
    0100A 01F6      MOVW	R30,R12
    0100B 70F1      ANDI	R31,1
    0100C 017F      MOVW	R14,R30
    0100D 0EE8      ADD	R14,R24
    0100E 1EF9      ADC	R15,R25
(0883) 			*p = (clst & 1) ? ((*p & 0x0F) | ((BYTE)val << 4)) : (BYTE)val;
    0100F 842F      LDD	R2,Y+15
    01010 8838      LDD	R3,Y+16
    01011 8849      LDD	R4,Y+17
    01012 885A      LDD	R5,Y+18
    01013 93EF      PUSH	R30
    01014 2DE2      MOV	R30,R2
    01015 70E1      ANDI	R30,1
    01016 91EF      POP	R30
    01017 F0B1      BEQ	0x102E
    01018 882B      LDD	R2,Y+19
    01019 883C      LDD	R3,Y+20
    0101A 884D      LDD	R4,Y+21
    0101B 885E      LDD	R5,Y+22
    0101C 2433      CLR	R3
    0101D 0C22      LSL	R2
    0101E 1C33      ROL	R3
    0101F 0C22      LSL	R2
    01020 1C33      ROL	R3
    01021 0C22      LSL	R2
    01022 1C33      ROL	R3
    01023 0C22      LSL	R2
    01024 1C33      ROL	R3
    01025 01F7      MOVW	R30,R14
    01026 8180      LD	R24,Z
    01027 2799      CLR	R25
    01028 708F      ANDI	R24,0xF
    01029 7090      ANDI	R25,0
    0102A 015C      MOVW	R10,R24
    0102B 28A2      OR	R10,R2
    0102C 28B3      OR	R11,R3
    0102D C006      RJMP	0x1034
    0102E 882B      LDD	R2,Y+19
    0102F 883C      LDD	R3,Y+20
    01030 884D      LDD	R4,Y+21
    01031 885E      LDD	R5,Y+22
    01032 2CA2      MOV	R10,R2
    01033 24BB      CLR	R11
    01034 01F7      MOVW	R30,R14
    01035 82A0      ST	Z,R10
(0884) 			bc++;
    01036 01C6      MOVW	R24,R12
    01037 9601      ADIW	R24,1
    01038 016C      MOVW	R12,R24
(0885) 			fs->wflag = 1;
    01039 E081      LDI	R24,1
    0103A 85ED      LDD	R30,Y+13
    0103B 85FE      LDD	R31,Y+14
    0103C 8384      STD	Z+4,R24
(0886) 			res = move_window(fs, fs->fatbase + (bc / SS(fs)));
    0103D E029      LDI	R18,0x9
    0103E E030      LDI	R19,0
    0103F 0186      MOVW	R16,R12
    01040 940E 4BBA CALL	lsr16
    01042 0118      MOVW	R2,R16
    01043 2444      CLR	R4
    01044 2455      CLR	R5
    01045 85ED      LDD	R30,Y+13
    01046 85FE      LDD	R31,Y+14
    01047 8C66      LDD	R6,Z+30
    01048 8C77      LDD	R7,Z+31
    01049 A080      LDD	R8,Z+32
    0104A A091      LDD	R9,Z+33
    0104B 0C62      ADD	R6,R2
    0104C 1C73      ADC	R7,R3
    0104D 1C84      ADC	R8,R4
    0104E 1C95      ADC	R9,R5
    0104F 8288      ST	Y,R8
    01050 8299      STD	Y+1,R9
    01051 0193      MOVW	R18,R6
    01052 018F      MOVW	R16,R30
    01053 DC3E      RCALL	ff.c:move_window
    01054 830A      STD	Y+2,R16
(0887) 			if (res != FR_OK) break;
    01055 2E00      MOV	R0,R16
    01056 2300      TST	R16
    01057 F009      BEQ	0x1059
    01058 C107      RJMP	0x1160
(0888) 			p = &fs->win[bc % SS(fs)];
    01059 858D      LDD	R24,Y+13
    0105A 859E      LDD	R25,Y+14
    0105B 968E      ADIW	R24,0x2E
    0105C 01F6      MOVW	R30,R12
    0105D 70F1      ANDI	R31,1
    0105E 017F      MOVW	R14,R30
    0105F 0EE8      ADD	R14,R24
    01060 1EF9      ADC	R15,R25
(0889) 			*p = (clst & 1) ? (BYTE)(val >> 4) : ((*p & 0xF0) | ((BYTE)(val >> 8) & 0x0F));
    01061 842F      LDD	R2,Y+15
    01062 8838      LDD	R3,Y+16
    01063 8849      LDD	R4,Y+17
    01064 885A      LDD	R5,Y+18
    01065 93EF      PUSH	R30
    01066 2DE2      MOV	R30,R2
    01067 70E1      ANDI	R30,1
    01068 91EF      POP	R30
    01069 F061      BEQ	0x1076
    0106A E084      LDI	R24,4
    0106B E090      LDI	R25,0
    0106C 890B      LDD	R16,Y+19
    0106D 891C      LDD	R17,Y+20
    0106E 892D      LDD	R18,Y+21
    0106F 893E      LDD	R19,Y+22
    01070 938A      ST	-Y,R24
    01071 940E 4BC1 CALL	lsr32
    01073 2EC0      MOV	R12,R16
    01074 24DD      CLR	R13
    01075 C015      RJMP	0x108B
    01076 E088      LDI	R24,0x8
    01077 E090      LDI	R25,0
    01078 890B      LDD	R16,Y+19
    01079 891C      LDD	R17,Y+20
    0107A 892D      LDD	R18,Y+21
    0107B 893E      LDD	R19,Y+22
    0107C 938A      ST	-Y,R24
    0107D 940E 4BC1 CALL	lsr32
    0107F 2F80      MOV	R24,R16
    01080 2799      CLR	R25
    01081 708F      ANDI	R24,0xF
    01082 7090      ANDI	R25,0
    01083 01F7      MOVW	R30,R14
    01084 81E0      LD	R30,Z
    01085 27FF      CLR	R31
    01086 7FE0      ANDI	R30,0xF0
    01087 70F0      ANDI	R31,0
    01088 016F      MOVW	R12,R30
    01089 2AC8      OR	R12,R24
    0108A 2AD9      OR	R13,R25
    0108B 01F7      MOVW	R30,R14
    0108C 82C0      ST	Z,R12
(0890) 			break;
    0108D C0D2      RJMP	0x1160
(0891) 
(0892) 		case FS_FAT16 :
(0893) 			res = move_window(fs, fs->fatbase + (clst / (SS(fs) / 2)));
    0108E E088      LDI	R24,0x8
    0108F E090      LDI	R25,0
    01090 850F      LDD	R16,Y+15
    01091 8918      LDD	R17,Y+16
    01092 8929      LDD	R18,Y+17
    01093 893A      LDD	R19,Y+18
    01094 938A      ST	-Y,R24
    01095 940E 4BC1 CALL	lsr32
    01097 85ED      LDD	R30,Y+13
    01098 85FE      LDD	R31,Y+14
    01099 8C26      LDD	R2,Z+30
    0109A 8C37      LDD	R3,Z+31
    0109B A040      LDD	R4,Z+32
    0109C A051      LDD	R5,Z+33
    0109D 0E20      ADD	R2,R16
    0109E 1E31      ADC	R3,R17
    0109F 1E42      ADC	R4,R18
    010A0 1E53      ADC	R5,R19
    010A1 8248      ST	Y,R4
    010A2 8259      STD	Y+1,R5
    010A3 0191      MOVW	R18,R2
    010A4 018F      MOVW	R16,R30
    010A5 DBEC      RCALL	ff.c:move_window
    010A6 2EC0      MOV	R12,R16
    010A7 82CA      STD	Y+2,R12
(0894) 			if (res != FR_OK) break;
    010A8 2C0C      MOV	R0,R12
    010A9 2300      TST	R16
    010AA F009      BEQ	0x10AC
    010AB C0B4      RJMP	0x1160
(0895) 			p = &fs->win[clst * 2 % SS(fs)];
    010AC EF4F      LDI	R20,0xFF
    010AD E051      LDI	R21,1
    010AE E060      LDI	R22,0
    010AF E070      LDI	R23,0
    010B0 842F      LDD	R2,Y+15
    010B1 8838      LDD	R3,Y+16
    010B2 8849      LDD	R4,Y+17
    010B3 885A      LDD	R5,Y+18
    010B4 0C22      LSL	R2
    010B5 1C33      ROL	R3
    010B6 1C44      ROL	R4
    010B7 1C55      ROL	R5
    010B8 2224      AND	R2,R20
    010B9 2235      AND	R3,R21
    010BA 2246      AND	R4,R22
    010BB 2257      AND	R5,R23
    010BC 0171      MOVW	R14,R2
    010BD 858D      LDD	R24,Y+13
    010BE 859E      LDD	R25,Y+14
    010BF 968E      ADIW	R24,0x2E
    010C0 0EE8      ADD	R14,R24
    010C1 1EF9      ADC	R15,R25
(0896) 			ST_WORD(p, (WORD)val);
    010C2 882B      LDD	R2,Y+19
    010C3 883C      LDD	R3,Y+20
    010C4 01F7      MOVW	R30,R14
    010C5 8220      ST	Z,R2
    010C6 2C23      MOV	R2,R3
    010C7 2433      CLR	R3
    010C8 8221      STD	Z+1,R2
(0897) 			break;
    010C9 C096      RJMP	0x1160
(0898) 
(0899) 		case FS_FAT32 :
(0900) 			res = move_window(fs, fs->fatbase + (clst / (SS(fs) / 4)));
    010CA E087      LDI	R24,7
    010CB E090      LDI	R25,0
    010CC 850F      LDD	R16,Y+15
    010CD 8918      LDD	R17,Y+16
    010CE 8929      LDD	R18,Y+17
    010CF 893A      LDD	R19,Y+18
    010D0 938A      ST	-Y,R24
    010D1 940E 4BC1 CALL	lsr32
    010D3 85ED      LDD	R30,Y+13
    010D4 85FE      LDD	R31,Y+14
    010D5 8C26      LDD	R2,Z+30
    010D6 8C37      LDD	R3,Z+31
    010D7 A040      LDD	R4,Z+32
    010D8 A051      LDD	R5,Z+33
    010D9 0E20      ADD	R2,R16
    010DA 1E31      ADC	R3,R17
    010DB 1E42      ADC	R4,R18
    010DC 1E53      ADC	R5,R19
    010DD 8248      ST	Y,R4
    010DE 8259      STD	Y+1,R5
    010DF 0191      MOVW	R18,R2
    010E0 018F      MOVW	R16,R30
    010E1 DBB0      RCALL	ff.c:move_window
    010E2 2EC0      MOV	R12,R16
    010E3 82CA      STD	Y+2,R12
(0901) 			if (res != FR_OK) break;
    010E4 2C0C      MOV	R0,R12
    010E5 2300      TST	R16
    010E6 F009      BEQ	0x10E8
    010E7 C078      RJMP	0x1160
(0902) 			p = &fs->win[clst * 4 % SS(fs)];
    010E8 E082      LDI	R24,2
    010E9 E090      LDI	R25,0
    010EA 850F      LDD	R16,Y+15
    010EB 8918      LDD	R17,Y+16
    010EC 8929      LDD	R18,Y+17
    010ED 893A      LDD	R19,Y+18
    010EE 938A      ST	-Y,R24
    010EF 940E 4BA8 CALL	lsl32
    010F1 0118      MOVW	R2,R16
    010F2 0129      MOVW	R4,R18
    010F3 EF4F      LDI	R20,0xFF
    010F4 E051      LDI	R21,1
    010F5 E060      LDI	R22,0
    010F6 E070      LDI	R23,0
    010F7 2224      AND	R2,R20
    010F8 2235      AND	R3,R21
    010F9 2246      AND	R4,R22
    010FA 2257      AND	R5,R23
    010FB 0171      MOVW	R14,R2
    010FC 858D      LDD	R24,Y+13
    010FD 859E      LDD	R25,Y+14
    010FE 968E      ADIW	R24,0x2E
    010FF 0EE8      ADD	R14,R24
    01100 1EF9      ADC	R15,R25
(0903) 			val |= LD_DWORD(p) & 0xF0000000;
    01101 E188      LDI	R24,0x18
    01102 E090      LDI	R25,0
    01103 01F7      MOVW	R30,R14
    01104 8103      LDD	R16,Z+3
    01105 2711      CLR	R17
    01106 2722      CLR	R18
    01107 2733      CLR	R19
    01108 938A      ST	-Y,R24
    01109 940E 4BA8 CALL	lsl32
    0110B 0118      MOVW	R2,R16
    0110C 0129      MOVW	R4,R18
    0110D 01F7      MOVW	R30,R14
    0110E 8062      LDD	R6,Z+2
    0110F 2477      CLR	R7
    01110 2488      CLR	R8
    01111 2499      CLR	R9
    01112 0143      MOVW	R8,R6
    01113 2466      CLR	R6
    01114 2477      CLR	R7
    01115 2826      OR	R2,R6
    01116 2837      OR	R3,R7
    01117 2848      OR	R4,R8
    01118 2859      OR	R5,R9
    01119 8061      LDD	R6,Z+1
    0111A 2477      CLR	R7
    0111B 2C76      MOV	R7,R6
    0111C 2466      CLR	R6
    0111D 2488      CLR	R8
    0111E 2499      CLR	R9
    0111F 2826      OR	R2,R6
    01120 2837      OR	R3,R7
    01121 2848      OR	R4,R8
    01122 2859      OR	R5,R9
    01123 8060      LD	R6,Z
    01124 2477      CLR	R7
    01125 2488      CLR	R8
    01126 2499      CLR	R9
    01127 2826      OR	R2,R6
    01128 2837      OR	R3,R7
    01129 2848      OR	R4,R8
    0112A 2859      OR	R5,R9
    0112B E040      LDI	R20,0
    0112C E050      LDI	R21,0
    0112D E060      LDI	R22,0
    0112E EF70      LDI	R23,0xF0
    0112F 2224      AND	R2,R20
    01130 2235      AND	R3,R21
    01131 2246      AND	R4,R22
    01132 2257      AND	R5,R23
    01133 886B      LDD	R6,Y+19
    01134 887C      LDD	R7,Y+20
    01135 888D      LDD	R8,Y+21
    01136 889E      LDD	R9,Y+22
    01137 2862      OR	R6,R2
    01138 2873      OR	R7,R3
    01139 2884      OR	R8,R4
    0113A 2895      OR	R9,R5
    0113B 8A6B      STD	Y+19,R6
    0113C 8A7C      STD	Y+20,R7
    0113D 8A8D      STD	Y+21,R8
    0113E 8A9E      STD	Y+22,R9
(0904) 			ST_DWORD(p, val);
    0113F 882B      LDD	R2,Y+19
    01140 883C      LDD	R3,Y+20
    01141 884D      LDD	R4,Y+21
    01142 885E      LDD	R5,Y+22
    01143 8220      ST	Z,R2
    01144 2C23      MOV	R2,R3
    01145 2433      CLR	R3
    01146 9631      ADIW	R30,1
    01147 8220      ST	Z,R2
    01148 882B      LDD	R2,Y+19
    01149 883C      LDD	R3,Y+20
    0114A 884D      LDD	R4,Y+21
    0114B 885E      LDD	R5,Y+22
    0114C 0112      MOVW	R2,R4
    0114D 2444      CLR	R4
    0114E 2455      CLR	R5
    0114F 01F7      MOVW	R30,R14
    01150 9632      ADIW	R30,2
    01151 8220      ST	Z,R2
    01152 E188      LDI	R24,0x18
    01153 E090      LDI	R25,0
    01154 890B      LDD	R16,Y+19
    01155 891C      LDD	R17,Y+20
    01156 892D      LDD	R18,Y+21
    01157 893E      LDD	R19,Y+22
    01158 938A      ST	-Y,R24
    01159 940E 4BC1 CALL	lsr32
    0115B 01F7      MOVW	R30,R14
    0115C 8303      STD	Z+3,R16
(0905) 			break;
    0115D C002      RJMP	0x1160
(0906) 
(0907) 		default :
(0908) 			res = FR_INT_ERR;
    0115E E082      LDI	R24,2
    0115F 838A      STD	Y+2,R24
(0909) 		}
(0910) 		fs->wflag = 1;
    01160 E081      LDI	R24,1
    01161 85ED      LDD	R30,Y+13
    01162 85FE      LDD	R31,Y+14
    01163 8384      STD	Z+4,R24
(0911) 	}
(0912) 
(0913) 	return res;
    01164 810A      LDD	R16,Y+2
    01165 9623      ADIW	R28,3
    01166 940E 4B12 CALL	pop_xgsetF0FC
    01168 9624      ADIW	R28,4
    01169 9508      RET
ff.c:remove_chain:
  res                  --> R10
  nxt                  --> Y,+6
  clst                 --> Y,+18
  fs                   --> R12
    0116A 933A      ST	-Y,R19
    0116B 932A      ST	-Y,R18
    0116C 940E 4B58 CALL	push_xgsetF03C
    0116E 0168      MOVW	R12,R16
    0116F 972A      SBIW	R28,0xA
(0914) }
(0915) #endif /* !_FS_READONLY */
(0916) 
(0917) 
(0918) 
(0919) 
(0920) /*-----------------------------------------------------------------------*/
(0921) /* FAT handling - Remove a cluster chain                                 */
(0922) /*-----------------------------------------------------------------------*/
(0923) #if !_FS_READONLY
(0924) static
(0925) FRESULT remove_chain (
(0926) 	FATFS *fs,			/* File system object */
(0927) 	DWORD clst			/* Cluster# to remove a chain from */
(0928) )
(0929) {
(0930) 	FRESULT res;
(0931) 	DWORD nxt;
(0932) #if _USE_ERASE
(0933) 	DWORD scl = clst, ecl = clst, resion[2];
(0934) #endif
(0935) 
(0936) 	if (clst < 2 || clst >= fs->n_fatent) {	/* Check range */
    01170 E042      LDI	R20,2
    01171 E050      LDI	R21,0
    01172 E060      LDI	R22,0
    01173 E070      LDI	R23,0
    01174 882A      LDD	R2,Y+18
    01175 883B      LDD	R3,Y+19
    01176 884C      LDD	R4,Y+20
    01177 885D      LDD	R5,Y+21
    01178 1624      CP	R2,R20
    01179 0635      CPC	R3,R21
    0117A 0646      CPC	R4,R22
    0117B 0657      CPC	R5,R23
    0117C F078      BCS	0x118C
    0117D 01F6      MOVW	R30,R12
    0117E 9676      ADIW	R30,0x16
    0117F 8020      LD	R2,Z
    01180 8031      LDD	R3,Z+1
    01181 8042      LDD	R4,Z+2
    01182 8053      LDD	R5,Z+3
    01183 886A      LDD	R6,Y+18
    01184 887B      LDD	R7,Y+19
    01185 888C      LDD	R8,Y+20
    01186 889D      LDD	R9,Y+21
    01187 1462      CP	R6,R2
    01188 0473      CPC	R7,R3
    01189 0484      CPC	R8,R4
    0118A 0495      CPC	R9,R5
    0118B F018      BCS	0x118F
(0937) 		res = FR_INT_ERR;
    0118C E082      LDI	R24,2
    0118D 2EA8      MOV	R10,R24
(0938) 
(0939) 	} else {
    0118E C088      RJMP	0x1217
(0940) 		res = FR_OK;
    0118F 24AA      CLR	R10
    01190 C076      RJMP	0x1207
(0941) 		while (clst < fs->n_fatent) {			/* Not a last link? */
(0942) 			nxt = get_fat(fs, clst);			/* Get cluster status */
    01191 882A      LDD	R2,Y+18
    01192 883B      LDD	R3,Y+19
    01193 884C      LDD	R4,Y+20
    01194 885D      LDD	R5,Y+21
    01195 8248      ST	Y,R4
    01196 8259      STD	Y+1,R5
    01197 0191      MOVW	R18,R2
    01198 0186      MOVW	R16,R12
    01199 DCC1      RCALL	_get_fat
    0119A 830E      STD	Y+6,R16
    0119B 831F      STD	Y+7,R17
    0119C 8728      STD	Y+8,R18
    0119D 8739      STD	Y+9,R19
(0943) 			if (nxt == 0) break;				/* Empty cluster? */
    0119E 802E      LDD	R2,Y+6
    0119F 803F      LDD	R3,Y+7
    011A0 8448      LDD	R4,Y+8
    011A1 8459      LDD	R5,Y+9
    011A2 9488      BCLR	0
    011A3 2022      TST	R2
    011A4 0432      CPC	R3,R2
    011A5 0442      CPC	R4,R2
    011A6 0452      CPC	R5,R2
    011A7 F409      BNE	0x11A9
    011A8 C06E      RJMP	0x1217
(0944) 			if (nxt == 1) { res = FR_INT_ERR; break; }	/* Internal error? */
    011A9 E041      LDI	R20,1
    011AA E050      LDI	R21,0
    011AB E060      LDI	R22,0
    011AC E070      LDI	R23,0
    011AD 802E      LDD	R2,Y+6
    011AE 803F      LDD	R3,Y+7
    011AF 8448      LDD	R4,Y+8
    011B0 8459      LDD	R5,Y+9
    011B1 1624      CP	R2,R20
    011B2 0635      CPC	R3,R21
    011B3 0646      CPC	R4,R22
    011B4 0657      CPC	R5,R23
    011B5 F419      BNE	0x11B9
    011B6 E082      LDI	R24,2
    011B7 2EA8      MOV	R10,R24
    011B8 C05E      RJMP	0x1217
(0945) 			if (nxt == 0xFFFFFFFF) { res = FR_DISK_ERR; break; }	/* Disk error? */
    011B9 EF4F      LDI	R20,0xFF
    011BA EF5F      LDI	R21,0xFF
    011BB EF6F      LDI	R22,0xFF
    011BC EF7F      LDI	R23,0xFF
    011BD 802E      LDD	R2,Y+6
    011BE 803F      LDD	R3,Y+7
    011BF 8448      LDD	R4,Y+8
    011C0 8459      LDD	R5,Y+9
    011C1 1624      CP	R2,R20
    011C2 0635      CPC	R3,R21
    011C3 0646      CPC	R4,R22
    011C4 0657      CPC	R5,R23
    011C5 F419      BNE	0x11C9
    011C6 24AA      CLR	R10
    011C7 94A3      INC	R10
    011C8 C04E      RJMP	0x1217
(0946) 			res = put_fat(fs, clst, 0);			/* Mark the cluster "empty" */
    011C9 E080      LDI	R24,0
    011CA 838A      STD	Y+2,R24
    011CB 838B      STD	Y+3,R24
    011CC 838C      STD	Y+4,R24
    011CD 838D      STD	Y+5,R24
    011CE 882A      LDD	R2,Y+18
    011CF 883B      LDD	R3,Y+19
    011D0 884C      LDD	R4,Y+20
    011D1 885D      LDD	R5,Y+21
    011D2 8248      ST	Y,R4
    011D3 8259      STD	Y+1,R5
    011D4 0191      MOVW	R18,R2
    011D5 0186      MOVW	R16,R12
    011D6 DDD4      RCALL	_put_fat
    011D7 2EA0      MOV	R10,R16
(0947) 			if (res != FR_OK) break;
    011D8 2300      TST	R16
    011D9 F009      BEQ	0x11DB
    011DA C03C      RJMP	0x1217
(0948) 			if (fs->free_clust != 0xFFFFFFFF) {	/* Update FSInfo */
    011DB EF4F      LDI	R20,0xFF
    011DC EF5F      LDI	R21,0xFF
    011DD EF6F      LDI	R22,0xFF
    011DE EF7F      LDI	R23,0xFF
    011DF 01F6      MOVW	R30,R12
    011E0 8426      LDD	R2,Z+14
    011E1 8437      LDD	R3,Z+15
    011E2 8840      LDD	R4,Z+16
    011E3 8851      LDD	R5,Z+17
    011E4 1624      CP	R2,R20
    011E5 0635      CPC	R3,R21
    011E6 0646      CPC	R4,R22
    011E7 0657      CPC	R5,R23
    011E8 F0B1      BEQ	0x11FF
(0949) 				fs->free_clust++;
    011E9 01CF      MOVW	R24,R30
    011EA 960E      ADIW	R24,0xE
    011EB E041      LDI	R20,1
    011EC E050      LDI	R21,0
    011ED E060      LDI	R22,0
    011EE E070      LDI	R23,0
    011EF 01FC      MOVW	R30,R24
    011F0 8020      LD	R2,Z
    011F1 8031      LDD	R3,Z+1
    011F2 8042      LDD	R4,Z+2
    011F3 8053      LDD	R5,Z+3
    011F4 0E24      ADD	R2,R20
    011F5 1E35      ADC	R3,R21
    011F6 1E46      ADC	R4,R22
    011F7 1E57      ADC	R5,R23
    011F8 8220      ST	Z,R2
    011F9 8231      STD	Z+1,R3
    011FA 8242      STD	Z+2,R4
    011FB 8253      STD	Z+3,R5
(0950) 				fs->fsi_flag = 1;
    011FC E081      LDI	R24,1
    011FD 01F6      MOVW	R30,R12
    011FE 8385      STD	Z+5,R24
(0951) 			}
(0952) #if _USE_ERASE
(0953) 			if (ecl + 1 == nxt) {	/* Next cluster is contiguous */
(0954) 				ecl = nxt;
(0955) 			} else {				/* End of contiguous clusters */ 
(0956) 				resion[0] = clust2sect(fs, scl);					/* Start sector */
(0957) 				resion[1] = clust2sect(fs, ecl) + fs->csize - 1;	/* End sector */
(0958) 				disk_ioctl(fs->drv, CTRL_ERASE_SECTOR, resion);		/* Erase the block */
(0959) 				scl = ecl = nxt;
(0960) 			}
(0961) #endif
(0962) 			clst = nxt;	/* Next cluster */
    011FF 802E      LDD	R2,Y+6
    01200 803F      LDD	R3,Y+7
    01201 8448      LDD	R4,Y+8
    01202 8459      LDD	R5,Y+9
    01203 8A2A      STD	Y+18,R2
    01204 8A3B      STD	Y+19,R3
    01205 8A4C      STD	Y+20,R4
    01206 8A5D      STD	Y+21,R5
    01207 01F6      MOVW	R30,R12
    01208 9676      ADIW	R30,0x16
    01209 8020      LD	R2,Z
    0120A 8031      LDD	R3,Z+1
    0120B 8042      LDD	R4,Z+2
    0120C 8053      LDD	R5,Z+3
    0120D 886A      LDD	R6,Y+18
    0120E 887B      LDD	R7,Y+19
    0120F 888C      LDD	R8,Y+20
    01210 889D      LDD	R9,Y+21
    01211 1462      CP	R6,R2
    01212 0473      CPC	R7,R3
    01213 0484      CPC	R8,R4
    01214 0495      CPC	R9,R5
    01215 F408      BCC	0x1217
    01216 CF7A      RJMP	0x1191
(0963) 		}
(0964) 	}
(0965) 
(0966) 	return res;
    01217 2D0A      MOV	R16,R10
    01218 962A      ADIW	R28,0xA
    01219 940E 4B61 CALL	pop_xgsetF03C
    0121B 9622      ADIW	R28,2
    0121C 9508      RET
ff.c:create_chain:
  res                  --> R10
  scl                  --> Y,+14
  cs                   --> Y,+10
  ncl                  --> Y,+6
  clst                 --> Y,+32
  fs                   --> R12
    0121D 933A      ST	-Y,R19
    0121E 932A      ST	-Y,R18
    0121F 940E 4B1D CALL	push_xgsetF0FC
    01221 0168      MOVW	R12,R16
    01222 9766      SBIW	R28,0x16
(0967) }
(0968) #endif
(0969) 
(0970) 
(0971) 
(0972) 
(0973) /*-----------------------------------------------------------------------*/
(0974) /* FAT handling - Stretch or Create a cluster chain                      */
(0975) /*-----------------------------------------------------------------------*/
(0976) #if !_FS_READONLY
(0977) static
(0978) DWORD create_chain (	/* 0:No free cluster, 1:Internal error, 0xFFFFFFFF:Disk error, >=2:New cluster# */
(0979) 	FATFS *fs,			/* File system object */
(0980) 	DWORD clst			/* Cluster# to stretch. 0 means create a new chain. */
(0981) )
(0982) {
(0983) 	DWORD cs, ncl, scl;
(0984) 	FRESULT res;
(0985) 
(0986) 
(0987) 	if (clst == 0) {		/* Create a new chain */
    01223 A028      LDD	R2,Y+32
    01224 A039      LDD	R3,Y+33
    01225 A04A      LDD	R4,Y+34
    01226 A05B      LDD	R5,Y+35
    01227 9488      BCLR	0
    01228 2022      TST	R2
    01229 0432      CPC	R3,R2
    0122A 0442      CPC	R4,R2
    0122B 0452      CPC	R5,R2
    0122C F559      BNE	0x1258
(0988) 		scl = fs->last_clust;			/* Get suggested start point */
    0122D 01F6      MOVW	R30,R12
    0122E 963A      ADIW	R30,0xA
    0122F 8020      LD	R2,Z
    01230 8031      LDD	R3,Z+1
    01231 8042      LDD	R4,Z+2
    01232 8053      LDD	R5,Z+3
    01233 862E      STD	Y+14,R2
    01234 863F      STD	Y+15,R3
    01235 8A48      STD	Y+16,R4
    01236 8A59      STD	Y+17,R5
(0989) 		if (!scl || scl >= fs->n_fatent) scl = 1;
    01237 842E      LDD	R2,Y+14
    01238 843F      LDD	R3,Y+15
    01239 8848      LDD	R4,Y+16
    0123A 8859      LDD	R5,Y+17
    0123B 9488      BCLR	0
    0123C 2022      TST	R2
    0123D 0432      CPC	R3,R2
    0123E 0442      CPC	R4,R2
    0123F 0452      CPC	R5,R2
    01240 F081      BEQ	0x1251
    01241 01F6      MOVW	R30,R12
    01242 9676      ADIW	R30,0x16
    01243 8020      LD	R2,Z
    01244 8031      LDD	R3,Z+1
    01245 8042      LDD	R4,Z+2
    01246 8053      LDD	R5,Z+3
    01247 846E      LDD	R6,Y+14
    01248 847F      LDD	R7,Y+15
    01249 8888      LDD	R8,Y+16
    0124A 8899      LDD	R9,Y+17
    0124B 1462      CP	R6,R2
    0124C 0473      CPC	R7,R3
    0124D 0484      CPC	R8,R4
    0124E 0495      CPC	R9,R5
    0124F F408      BCC	0x1251
    01250 C040      RJMP	0x1291
    01251 E081      LDI	R24,1
    01252 878E      STD	Y+14,R24
    01253 E080      LDI	R24,0
    01254 878F      STD	Y+15,R24
    01255 8B88      STD	Y+16,R24
    01256 8B89      STD	Y+17,R24
(0990) 	}
    01257 C039      RJMP	0x1291
(0991) 	else {					/* Stretch the current chain */
(0992) 		cs = get_fat(fs, clst);			/* Check the cluster status */
    01258 A028      LDD	R2,Y+32
    01259 A039      LDD	R3,Y+33
    0125A A04A      LDD	R4,Y+34
    0125B A05B      LDD	R5,Y+35
    0125C 8248      ST	Y,R4
    0125D 8259      STD	Y+1,R5
    0125E 0191      MOVW	R18,R2
    0125F 0186      MOVW	R16,R12
    01260 DBFA      RCALL	_get_fat
    01261 870A      STD	Y+10,R16
    01262 871B      STD	Y+11,R17
    01263 872C      STD	Y+12,R18
    01264 873D      STD	Y+13,R19
(0993) 		if (cs < 2) return 1;			/* It is an invalid cluster */
    01265 E042      LDI	R20,2
    01266 E050      LDI	R21,0
    01267 E060      LDI	R22,0
    01268 E070      LDI	R23,0
    01269 842A      LDD	R2,Y+10
    0126A 843B      LDD	R3,Y+11
    0126B 844C      LDD	R4,Y+12
    0126C 845D      LDD	R5,Y+13
    0126D 1624      CP	R2,R20
    0126E 0635      CPC	R3,R21
    0126F 0646      CPC	R4,R22
    01270 0657      CPC	R5,R23
    01271 F428      BCC	0x1277
    01272 E001      LDI	R16,1
    01273 E010      LDI	R17,0
    01274 E020      LDI	R18,0
    01275 E030      LDI	R19,0
    01276 C119      RJMP	0x1390
(0994) 		if (cs < fs->n_fatent) return cs;	/* It is already followed by next cluster */
    01277 01F6      MOVW	R30,R12
    01278 9676      ADIW	R30,0x16
    01279 8020      LD	R2,Z
    0127A 8031      LDD	R3,Z+1
    0127B 8042      LDD	R4,Z+2
    0127C 8053      LDD	R5,Z+3
    0127D 846A      LDD	R6,Y+10
    0127E 847B      LDD	R7,Y+11
    0127F 848C      LDD	R8,Y+12
    01280 849D      LDD	R9,Y+13
    01281 1462      CP	R6,R2
    01282 0473      CPC	R7,R3
    01283 0484      CPC	R8,R4
    01284 0495      CPC	R9,R5
    01285 F418      BCC	0x1289
    01286 0183      MOVW	R16,R6
    01287 0194      MOVW	R18,R8
    01288 C107      RJMP	0x1390
(0995) 		scl = clst;
    01289 A028      LDD	R2,Y+32
    0128A A039      LDD	R3,Y+33
    0128B A04A      LDD	R4,Y+34
    0128C A05B      LDD	R5,Y+35
    0128D 862E      STD	Y+14,R2
    0128E 863F      STD	Y+15,R3
    0128F 8A48      STD	Y+16,R4
    01290 8A59      STD	Y+17,R5
(0996) 	}
(0997) 
(0998) 	ncl = scl;				/* Start cluster */
    01291 842E      LDD	R2,Y+14
    01292 843F      LDD	R3,Y+15
    01293 8848      LDD	R4,Y+16
    01294 8859      LDD	R5,Y+17
    01295 822E      STD	Y+6,R2
    01296 823F      STD	Y+7,R3
    01297 8648      STD	Y+8,R4
    01298 8659      STD	Y+9,R5
(0999) 	for (;;) {
(1000) 		ncl++;							/* Next cluster */
    01299 E041      LDI	R20,1
    0129A E050      LDI	R21,0
    0129B E060      LDI	R22,0
    0129C E070      LDI	R23,0
    0129D 802E      LDD	R2,Y+6
    0129E 803F      LDD	R3,Y+7
    0129F 8448      LDD	R4,Y+8
    012A0 8459      LDD	R5,Y+9
    012A1 0E24      ADD	R2,R20
    012A2 1E35      ADC	R3,R21
    012A3 1E46      ADC	R4,R22
    012A4 1E57      ADC	R5,R23
    012A5 822E      STD	Y+6,R2
    012A6 823F      STD	Y+7,R3
    012A7 8648      STD	Y+8,R4
    012A8 8659      STD	Y+9,R5
(1001) 		if (ncl >= fs->n_fatent) {		/* Wrap around */
    012A9 01F6      MOVW	R30,R12
    012AA 9676      ADIW	R30,0x16
    012AB 8020      LD	R2,Z
    012AC 8031      LDD	R3,Z+1
    012AD 8042      LDD	R4,Z+2
    012AE 8053      LDD	R5,Z+3
    012AF 806E      LDD	R6,Y+6
    012B0 807F      LDD	R7,Y+7
    012B1 8488      LDD	R8,Y+8
    012B2 8499      LDD	R9,Y+9
    012B3 1462      CP	R6,R2
    012B4 0473      CPC	R7,R3
    012B5 0484      CPC	R8,R4
    012B6 0495      CPC	R9,R5
    012B7 F0C0      BCS	0x12D0
(1002) 			ncl = 2;
    012B8 E082      LDI	R24,2
    012B9 838E      STD	Y+6,R24
    012BA E080      LDI	R24,0
    012BB 838F      STD	Y+7,R24
    012BC 8788      STD	Y+8,R24
    012BD 8789      STD	Y+9,R24
(1003) 			if (ncl > scl) return 0;	/* No free cluster */
    012BE 842E      LDD	R2,Y+14
    012BF 843F      LDD	R3,Y+15
    012C0 8848      LDD	R4,Y+16
    012C1 8859      LDD	R5,Y+17
    012C2 806E      LDD	R6,Y+6
    012C3 807F      LDD	R7,Y+7
    012C4 8488      LDD	R8,Y+8
    012C5 8499      LDD	R9,Y+9
    012C6 1426      CP	R2,R6
    012C7 0437      CPC	R3,R7
    012C8 0448      CPC	R4,R8
    012C9 0459      CPC	R5,R9
    012CA F428      BCC	0x12D0
    012CB E000      LDI	R16,0
    012CC E010      LDI	R17,0
    012CD E020      LDI	R18,0
    012CE E030      LDI	R19,0
    012CF C0C0      RJMP	0x1390
(1004) 		}
(1005) 		cs = get_fat(fs, ncl);			/* Get the cluster status */
    012D0 802E      LDD	R2,Y+6
    012D1 803F      LDD	R3,Y+7
    012D2 8448      LDD	R4,Y+8
    012D3 8459      LDD	R5,Y+9
    012D4 8248      ST	Y,R4
    012D5 8259      STD	Y+1,R5
    012D6 0191      MOVW	R18,R2
    012D7 0186      MOVW	R16,R12
    012D8 DB82      RCALL	_get_fat
    012D9 870A      STD	Y+10,R16
    012DA 871B      STD	Y+11,R17
    012DB 872C      STD	Y+12,R18
    012DC 873D      STD	Y+13,R19
(1006) 		if (cs == 0) break;				/* Found a free cluster */
    012DD 842A      LDD	R2,Y+10
    012DE 843B      LDD	R3,Y+11
    012DF 844C      LDD	R4,Y+12
    012E0 845D      LDD	R5,Y+13
    012E1 9488      BCLR	0
    012E2 2022      TST	R2
    012E3 0432      CPC	R3,R2
    012E4 0442      CPC	R4,R2
    012E5 0452      CPC	R5,R2
    012E6 F409      BNE	0x12E8
    012E7 C02E      RJMP	0x1316
(1007) 		if (cs == 0xFFFFFFFF || cs == 1)/* An error occurred */
    012E8 EF4F      LDI	R20,0xFF
    012E9 EF5F      LDI	R21,0xFF
    012EA EF6F      LDI	R22,0xFF
    012EB EF7F      LDI	R23,0xFF
    012EC 842A      LDD	R2,Y+10
    012ED 843B      LDD	R3,Y+11
    012EE 844C      LDD	R4,Y+12
    012EF 845D      LDD	R5,Y+13
    012F0 1624      CP	R2,R20
    012F1 0635      CPC	R3,R21
    012F2 0646      CPC	R4,R22
    012F3 0657      CPC	R5,R23
    012F4 F049      BEQ	0x12FE
    012F5 E041      LDI	R20,1
    012F6 E050      LDI	R21,0
    012F7 E060      LDI	R22,0
    012F8 E070      LDI	R23,0
    012F9 1624      CP	R2,R20
    012FA 0635      CPC	R3,R21
    012FB 0646      CPC	R4,R22
    012FC 0657      CPC	R5,R23
    012FD F429      BNE	0x1303
(1008) 			return cs;
    012FE 850A      LDD	R16,Y+10
    012FF 851B      LDD	R17,Y+11
    01300 852C      LDD	R18,Y+12
    01301 853D      LDD	R19,Y+13
    01302 C08D      RJMP	0x1390
(1009) 		if (ncl == scl) return 0;		/* No free cluster */
    01303 842E      LDD	R2,Y+14
    01304 843F      LDD	R3,Y+15
    01305 8848      LDD	R4,Y+16
    01306 8859      LDD	R5,Y+17
    01307 806E      LDD	R6,Y+6
    01308 807F      LDD	R7,Y+7
    01309 8488      LDD	R8,Y+8
    0130A 8499      LDD	R9,Y+9
    0130B 1462      CP	R6,R2
    0130C 0473      CPC	R7,R3
    0130D 0484      CPC	R8,R4
    0130E 0495      CPC	R9,R5
    0130F F009      BEQ	0x1311
    01310 CF88      RJMP	0x1299
    01311 E000      LDI	R16,0
    01312 E010      LDI	R17,0
    01313 E020      LDI	R18,0
    01314 E030      LDI	R19,0
    01315 C07A      RJMP	0x1390
(1010) 	}
(1011) 
(1012) 	res = put_fat(fs, ncl, 0x0FFFFFFF);	/* Mark the new cluster "last link" */
    01316 EF8F      LDI	R24,0xFF
    01317 838A      STD	Y+2,R24
    01318 838B      STD	Y+3,R24
    01319 838C      STD	Y+4,R24
    0131A E08F      LDI	R24,0xF
    0131B 838D      STD	Y+5,R24
    0131C 802E      LDD	R2,Y+6
    0131D 803F      LDD	R3,Y+7
    0131E 8448      LDD	R4,Y+8
    0131F 8459      LDD	R5,Y+9
    01320 8248      ST	Y,R4
    01321 8259      STD	Y+1,R5
    01322 0191      MOVW	R18,R2
    01323 0186      MOVW	R16,R12
    01324 DC86      RCALL	_put_fat
    01325 2EA0      MOV	R10,R16
(1013) 	if (res == FR_OK && clst != 0) {
    01326 2300      TST	R16
    01327 F4E1      BNE	0x1344
    01328 A028      LDD	R2,Y+32
    01329 A039      LDD	R3,Y+33
    0132A A04A      LDD	R4,Y+34
    0132B A05B      LDD	R5,Y+35
    0132C 9488      BCLR	0
    0132D 2022      TST	R2
    0132E 0432      CPC	R3,R2
    0132F 0442      CPC	R4,R2
    01330 0452      CPC	R5,R2
    01331 F091      BEQ	0x1344
(1014) 		res = put_fat(fs, clst, ncl);	/* Link it to the previous one if needed */
    01332 802E      LDD	R2,Y+6
    01333 803F      LDD	R3,Y+7
    01334 8448      LDD	R4,Y+8
    01335 8459      LDD	R5,Y+9
    01336 822A      STD	Y+2,R2
    01337 823B      STD	Y+3,R3
    01338 824C      STD	Y+4,R4
    01339 825D      STD	Y+5,R5
    0133A A028      LDD	R2,Y+32
    0133B A039      LDD	R3,Y+33
    0133C A04A      LDD	R4,Y+34
    0133D A05B      LDD	R5,Y+35
    0133E 8248      ST	Y,R4
    0133F 8259      STD	Y+1,R5
    01340 0191      MOVW	R18,R2
    01341 0186      MOVW	R16,R12
    01342 DC68      RCALL	_put_fat
    01343 2EA0      MOV	R10,R16
(1015) 	}
(1016) 	if (res == FR_OK) {
    01344 20AA      TST	R10
    01345 F009      BEQ	0x1347
    01346 C02E      RJMP	0x1375
(1017) 		fs->last_clust = ncl;			/* Update FSINFO */
    01347 802E      LDD	R2,Y+6
    01348 803F      LDD	R3,Y+7
    01349 8448      LDD	R4,Y+8
    0134A 8459      LDD	R5,Y+9
    0134B 01F6      MOVW	R30,R12
    0134C 8622      STD	Z+10,R2
    0134D 8633      STD	Z+11,R3
    0134E 8644      STD	Z+12,R4
    0134F 8655      STD	Z+13,R5
(1018) 		if (fs->free_clust != 0xFFFFFFFF) {
    01350 EF4F      LDI	R20,0xFF
    01351 EF5F      LDI	R21,0xFF
    01352 EF6F      LDI	R22,0xFF
    01353 EF7F      LDI	R23,0xFF
    01354 8426      LDD	R2,Z+14
    01355 8437      LDD	R3,Z+15
    01356 8840      LDD	R4,Z+16
    01357 8851      LDD	R5,Z+17
    01358 1624      CP	R2,R20
    01359 0635      CPC	R3,R21
    0135A 0646      CPC	R4,R22
    0135B 0657      CPC	R5,R23
    0135C F179      BEQ	0x138C
(1019) 			fs->free_clust--;
    0135D 01CF      MOVW	R24,R30
    0135E 960E      ADIW	R24,0xE
    0135F 017C      MOVW	R14,R24
    01360 E041      LDI	R20,1
    01361 E050      LDI	R21,0
    01362 E060      LDI	R22,0
    01363 E070      LDI	R23,0
    01364 01FC      MOVW	R30,R24
    01365 8020      LD	R2,Z
    01366 8031      LDD	R3,Z+1
    01367 8042      LDD	R4,Z+2
    01368 8053      LDD	R5,Z+3
    01369 1A24      SUB	R2,R20
    0136A 0A35      SBC	R3,R21
    0136B 0A46      SBC	R4,R22
    0136C 0A57      SBC	R5,R23
    0136D 8220      ST	Z,R2
    0136E 8231      STD	Z+1,R3
    0136F 8242      STD	Z+2,R4
    01370 8253      STD	Z+3,R5
(1020) 			fs->fsi_flag = 1;
    01371 E081      LDI	R24,1
    01372 01F6      MOVW	R30,R12
    01373 8385      STD	Z+5,R24
(1021) 		}
(1022) 	} else {
    01374 C017      RJMP	0x138C
(1023) 		ncl = (res == FR_DISK_ERR) ? 0xFFFFFFFF : 1;
    01375 2D8A      MOV	R24,R10
    01376 3081      CPI	R24,1
    01377 F431      BNE	0x137E
    01378 EF8F      LDI	R24,0xFF
    01379 8B8A      STD	Y+18,R24
    0137A 8B8B      STD	Y+19,R24
    0137B 8B8C      STD	Y+20,R24
    0137C 8B8D      STD	Y+21,R24
    0137D C006      RJMP	0x1384
    0137E E081      LDI	R24,1
    0137F 8B8A      STD	Y+18,R24
    01380 E080      LDI	R24,0
    01381 8B8B      STD	Y+19,R24
    01382 8B8C      STD	Y+20,R24
    01383 8B8D      STD	Y+21,R24
    01384 882A      LDD	R2,Y+18
    01385 883B      LDD	R3,Y+19
    01386 884C      LDD	R4,Y+20
    01387 885D      LDD	R5,Y+21
    01388 822E      STD	Y+6,R2
    01389 823F      STD	Y+7,R3
    0138A 8648      STD	Y+8,R4
    0138B 8659      STD	Y+9,R5
(1024) 	}
(1025) 
(1026) 	return ncl;		/* Return new cluster number or error code */
    0138C 810E      LDD	R16,Y+6
    0138D 811F      LDD	R17,Y+7
    0138E 8528      LDD	R18,Y+8
    0138F 8539      LDD	R19,Y+9
    01390 9666      ADIW	R28,0x16
    01391 940E 4B12 CALL	pop_xgsetF0FC
    01393 9622      ADIW	R28,2
    01394 9508      RET
ff.c:clmt_clust:
  tbl                  --> R10
  cl                   --> Y,+4
  ncl                  --> Y,+0
  ofs                  --> Y,+12
  fp                   --> R12
    01395 933A      ST	-Y,R19
    01396 932A      ST	-Y,R18
    01397 940E 4B23 CALL	push_xgset003C
    01399 0168      MOVW	R12,R16
    0139A 9728      SBIW	R28,0x8
(1027) }
(1028) #endif /* !_FS_READONLY */
(1029) 
(1030) 
(1031) 
(1032) /*-----------------------------------------------------------------------*/
(1033) /* FAT handling - Convert offset into cluster with link map table        */
(1034) /*-----------------------------------------------------------------------*/
(1035) 
(1036) #if _USE_FASTSEEK
(1037) static
(1038) DWORD clmt_clust (	/* <2:Error, >=2:Cluster number */
(1039) 	FIL* fp,		/* Pointer to the file object */
(1040) 	DWORD ofs		/* File offset to be converted to cluster# */
(1041) )
(1042) {
(1043) 	DWORD cl, ncl, *tbl;
(1044) 
(1045) 
(1046) 	tbl = fp->cltbl + 1;	/* Top of CLMT */
    0139B 01F6      MOVW	R30,R12
    0139C 96B0      ADIW	R30,0x20
    0139D 8180      LD	R24,Z
    0139E 8191      LDD	R25,Z+1
    0139F 9604      ADIW	R24,4
    013A0 015C      MOVW	R10,R24
(1047) 	cl = ofs / SS(fp->fs) / fp->fs->csize;	/* Cluster order from top of the file */
    013A1 E089      LDI	R24,0x9
    013A2 E090      LDI	R25,0
    013A3 850C      LDD	R16,Y+12
    013A4 851D      LDD	R17,Y+13
    013A5 852E      LDD	R18,Y+14
    013A6 853F      LDD	R19,Y+15
    013A7 938A      ST	-Y,R24
    013A8 940E 4BC1 CALL	lsr32
    013AA 01F6      MOVW	R30,R12
    013AB 93AF      PUSH	R26
    013AC 93BF      PUSH	R27
    013AD 81A0      LD	R26,Z
    013AE 81B1      LDD	R27,Z+1
    013AF 01FD      MOVW	R30,R26
    013B0 91BF      POP	R27
    013B1 91AF      POP	R26
    013B2 9632      ADIW	R30,2
    013B3 8020      LD	R2,Z
    013B4 2433      CLR	R3
    013B5 2444      CLR	R4
    013B6 2455      CLR	R5
    013B7 925A      ST	-Y,R5
    013B8 924A      ST	-Y,R4
    013B9 923A      ST	-Y,R3
    013BA 922A      ST	-Y,R2
    013BB 940E 4A23 CALL	div32u
    013BD 830C      STD	Y+4,R16
    013BE 831D      STD	Y+5,R17
    013BF 832E      STD	Y+6,R18
    013C0 833F      STD	Y+7,R19
(1048) 	for (;;) {
(1049) 		ncl = *tbl++;			/* Number of cluters in the fragment */
    013C1 01F5      MOVW	R30,R10
    013C2 9021      LD	R2,Z+
    013C3 9031      LD	R3,Z+
    013C4 9041      LD	R4,Z+
    013C5 9051      LD	R5,Z+
    013C6 015F      MOVW	R10,R30
    013C7 8228      ST	Y,R2
    013C8 8239      STD	Y+1,R3
    013C9 824A      STD	Y+2,R4
    013CA 825B      STD	Y+3,R5
(1050) 		if (!ncl) return 0;		/* End of table? (error) */
    013CB 8028      LD	R2,Y
    013CC 8039      LDD	R3,Y+1
    013CD 804A      LDD	R4,Y+2
    013CE 805B      LDD	R5,Y+3
    013CF 9488      BCLR	0
    013D0 2022      TST	R2
    013D1 0432      CPC	R3,R2
    013D2 0442      CPC	R4,R2
    013D3 0452      CPC	R5,R2
    013D4 F429      BNE	0x13DA
    013D5 E000      LDI	R16,0
    013D6 E010      LDI	R17,0
    013D7 E020      LDI	R18,0
    013D8 E030      LDI	R19,0
    013D9 C02F      RJMP	0x1409
(1051) 		if (cl < ncl) break;	/* In this fragment? */
    013DA 8028      LD	R2,Y
    013DB 8039      LDD	R3,Y+1
    013DC 804A      LDD	R4,Y+2
    013DD 805B      LDD	R5,Y+3
    013DE 806C      LDD	R6,Y+4
    013DF 807D      LDD	R7,Y+5
    013E0 808E      LDD	R8,Y+6
    013E1 809F      LDD	R9,Y+7
    013E2 1462      CP	R6,R2
    013E3 0473      CPC	R7,R3
    013E4 0484      CPC	R8,R4
    013E5 0495      CPC	R9,R5
    013E6 F408      BCC	0x13E8
    013E7 C014      RJMP	0x13FC
(1052) 		cl -= ncl; tbl++;		/* Next fragment */
    013E8 8028      LD	R2,Y
    013E9 8039      LDD	R3,Y+1
    013EA 804A      LDD	R4,Y+2
    013EB 805B      LDD	R5,Y+3
    013EC 806C      LDD	R6,Y+4
    013ED 807D      LDD	R7,Y+5
    013EE 808E      LDD	R8,Y+6
    013EF 809F      LDD	R9,Y+7
    013F0 1862      SUB	R6,R2
    013F1 0873      SBC	R7,R3
    013F2 0884      SBC	R8,R4
    013F3 0895      SBC	R9,R5
    013F4 826C      STD	Y+4,R6
    013F5 827D      STD	Y+5,R7
    013F6 828E      STD	Y+6,R8
    013F7 829F      STD	Y+7,R9
    013F8 01C5      MOVW	R24,R10
    013F9 9604      ADIW	R24,4
    013FA 015C      MOVW	R10,R24
    013FB CFC5      RJMP	0x13C1
(1053) 	}
(1054) 	return cl + *tbl;	/* Return the cluster number */
    013FC 01F5      MOVW	R30,R10
    013FD 8020      LD	R2,Z
    013FE 8031      LDD	R3,Z+1
    013FF 8042      LDD	R4,Z+2
    01400 8053      LDD	R5,Z+3
    01401 810C      LDD	R16,Y+4
    01402 811D      LDD	R17,Y+5
    01403 812E      LDD	R18,Y+6
    01404 813F      LDD	R19,Y+7
    01405 0D02      ADD	R16,R2
    01406 1D13      ADC	R17,R3
    01407 1D24      ADC	R18,R4
    01408 1D35      ADC	R19,R5
    01409 9628      ADIW	R28,0x8
    0140A 940E 4AFD CALL	pop_xgset003C
    0140C 9622      ADIW	R28,2
    0140D 9508      RET
ff.c:dir_sdi:
  ic                   --> R14
  clst                 --> Y,+2
  idx                  --> R12
  dj                   --> R10
    0140E 940E 4B1D CALL	push_xgsetF0FC
    01410 0169      MOVW	R12,R18
    01411 0158      MOVW	R10,R16
    01412 9726      SBIW	R28,6
(1055) }
(1056) #endif	/* _USE_FASTSEEK */
(1057) 
(1058) 
(1059) 
(1060) /*-----------------------------------------------------------------------*/
(1061) /* Directory handling - Set directory index                              */
(1062) /*-----------------------------------------------------------------------*/
(1063) 
(1064) static
(1065) FRESULT dir_sdi (
(1066) 	DIR *dj,		/* Pointer to directory object */
(1067) 	WORD idx		/* Directory index number */
(1068) )
(1069) {
(1070) 	DWORD clst;
(1071) 	WORD ic;
(1072) 
(1073) 
(1074) 	dj->index = idx;
    01413 01F5      MOVW	R30,R10
    01414 82D5      STD	Z+5,R13
    01415 82C4      STD	Z+4,R12
(1075) 	clst = dj->sclust;
    01416 9636      ADIW	R30,6
    01417 8020      LD	R2,Z
    01418 8031      LDD	R3,Z+1
    01419 8042      LDD	R4,Z+2
    0141A 8053      LDD	R5,Z+3
    0141B 822A      STD	Y+2,R2
    0141C 823B      STD	Y+3,R3
    0141D 824C      STD	Y+4,R4
    0141E 825D      STD	Y+5,R5
(1076) 	if (clst == 1 || clst >= dj->fs->n_fatent)	/* Check start cluster range */
    0141F E041      LDI	R20,1
    01420 E050      LDI	R21,0
    01421 E060      LDI	R22,0
    01422 E070      LDI	R23,0
    01423 802A      LDD	R2,Y+2
    01424 803B      LDD	R3,Y+3
    01425 804C      LDD	R4,Y+4
    01426 805D      LDD	R5,Y+5
    01427 1624      CP	R2,R20
    01428 0635      CPC	R3,R21
    01429 0646      CPC	R4,R22
    0142A 0657      CPC	R5,R23
    0142B F089      BEQ	0x143D
    0142C 01F5      MOVW	R30,R10
    0142D 81A0      LD	R26,Z
    0142E 81B1      LDD	R27,Z+1
    0142F 9656      ADIW	R26,0x16
    01430 902D      LD	R2,X+
    01431 903D      LD	R3,X+
    01432 904D      LD	R4,X+
    01433 905C      LD	R5,X
    01434 806A      LDD	R6,Y+2
    01435 807B      LDD	R7,Y+3
    01436 808C      LDD	R8,Y+4
    01437 809D      LDD	R9,Y+5
    01438 1462      CP	R6,R2
    01439 0473      CPC	R7,R3
    0143A 0484      CPC	R8,R4
    0143B 0495      CPC	R9,R5
    0143C F010      BCS	0x143F
(1077) 		return FR_INT_ERR;
    0143D E002      LDI	R16,2
    0143E C0D6      RJMP	0x1515
(1078) 	if (!clst && dj->fs->fs_type == FS_FAT32)	/* Replace cluster# 0 with root cluster# if in FAT32 */
    0143F 802A      LDD	R2,Y+2
    01440 803B      LDD	R3,Y+3
    01441 804C      LDD	R4,Y+4
    01442 805D      LDD	R5,Y+5
    01443 9488      BCLR	0
    01444 2022      TST	R2
    01445 0432      CPC	R3,R2
    01446 0442      CPC	R4,R2
    01447 0452      CPC	R5,R2
    01448 F479      BNE	0x1458
    01449 01F5      MOVW	R30,R10
    0144A 81A0      LD	R26,Z
    0144B 81B1      LDD	R27,Z+1
    0144C 918C      LD	R24,X
    0144D 3083      CPI	R24,3
    0144E F449      BNE	0x1458
(1079) 		clst = dj->fs->dirbase;
    0144F 9692      ADIW	R26,0x22
    01450 902D      LD	R2,X+
    01451 903D      LD	R3,X+
    01452 904D      LD	R4,X+
    01453 905C      LD	R5,X
    01454 822A      STD	Y+2,R2
    01455 823B      STD	Y+3,R3
    01456 824C      STD	Y+4,R4
    01457 825D      STD	Y+5,R5
(1080) 
(1081) 	if (clst == 0) {	/* Static table (root-dir in FAT12/16) */
    01458 802A      LDD	R2,Y+2
    01459 803B      LDD	R3,Y+3
    0145A 804C      LDD	R4,Y+4
    0145B 805D      LDD	R5,Y+5
    0145C 9488      BCLR	0
    0145D 2022      TST	R2
    0145E 0432      CPC	R3,R2
    0145F 0442      CPC	R4,R2
    01460 0452      CPC	R5,R2
    01461 F009      BEQ	0x1463
    01462 C02B      RJMP	0x148E
(1082) 		dj->clust = clst;
    01463 01F5      MOVW	R30,R10
    01464 8622      STD	Z+10,R2
    01465 8633      STD	Z+11,R3
    01466 8644      STD	Z+12,R4
    01467 8655      STD	Z+13,R5
(1083) 		if (idx >= dj->fs->n_rootdir)		/* Index is out of range */
    01468 81A0      LD	R26,Z
    01469 81B1      LDD	R27,Z+1
    0146A 9618      ADIW	R26,0x8
    0146B 902D      LD	R2,X+
    0146C 903C      LD	R3,X
    0146D 14C2      CP	R12,R2
    0146E 04D3      CPC	R13,R3
    0146F F010      BCS	0x1472
(1084) 			return FR_INT_ERR;
    01470 E002      LDI	R16,2
    01471 C0A3      RJMP	0x1515
(1085) 		dj->sect = dj->fs->dirbase + idx / (SS(dj->fs) / SZ_DIR);	/* Sector# */
    01472 0116      MOVW	R2,R12
    01473 9436      LSR	R3
    01474 9427      ROR	R2
    01475 9436      LSR	R3
    01476 9427      ROR	R2
    01477 9436      LSR	R3
    01478 9427      ROR	R2
    01479 9436      LSR	R3
    0147A 9427      ROR	R2
    0147B 2444      CLR	R4
    0147C 2455      CLR	R5
    0147D 01F5      MOVW	R30,R10
    0147E 81A0      LD	R26,Z
    0147F 81B1      LDD	R27,Z+1
    01480 9692      ADIW	R26,0x22
    01481 906D      LD	R6,X+
    01482 907D      LD	R7,X+
    01483 908D      LD	R8,X+
    01484 909C      LD	R9,X
    01485 0C62      ADD	R6,R2
    01486 1C73      ADC	R7,R3
    01487 1C84      ADC	R8,R4
    01488 1C95      ADC	R9,R5
    01489 8666      STD	Z+14,R6
    0148A 8677      STD	Z+15,R7
    0148B 8A80      STD	Z+16,R8
    0148C 8A91      STD	Z+17,R9
(1086) 	}
    0148D C076      RJMP	0x1504
(1087) 	else {				/* Dynamic table (sub-dirs or root-dir in FAT32) */
(1088) 		ic = SS(dj->fs) / SZ_DIR * dj->fs->csize;	/* Entries per cluster */
    0148E 01F5      MOVW	R30,R10
    0148F 93AF      PUSH	R26
    01490 93BF      PUSH	R27
    01491 81A0      LD	R26,Z
    01492 81B1      LDD	R27,Z+1
    01493 01FD      MOVW	R30,R26
    01494 91BF      POP	R27
    01495 91AF      POP	R26
    01496 8022      LDD	R2,Z+2
    01497 E180      LDI	R24,0x10
    01498 9D82      MUL	R24,R2
    01499 0170      MOVW	R14,R0
    0149A C040      RJMP	0x14DB
(1089) 		while (idx >= ic) {	/* Follow cluster chain */
(1090) 			clst = get_fat(dj->fs, clst);				/* Get next cluster */
    0149B 802A      LDD	R2,Y+2
    0149C 803B      LDD	R3,Y+3
    0149D 804C      LDD	R4,Y+4
    0149E 805D      LDD	R5,Y+5
    0149F 8248      ST	Y,R4
    014A0 8259      STD	Y+1,R5
    014A1 0191      MOVW	R18,R2
    014A2 01F5      MOVW	R30,R10
    014A3 8100      LD	R16,Z
    014A4 8111      LDD	R17,Z+1
    014A5 D9B5      RCALL	_get_fat
    014A6 830A      STD	Y+2,R16
    014A7 831B      STD	Y+3,R17
    014A8 832C      STD	Y+4,R18
    014A9 833D      STD	Y+5,R19
(1091) 			if (clst == 0xFFFFFFFF) return FR_DISK_ERR;	/* Disk error */
    014AA EF4F      LDI	R20,0xFF
    014AB EF5F      LDI	R21,0xFF
    014AC EF6F      LDI	R22,0xFF
    014AD EF7F      LDI	R23,0xFF
    014AE 802A      LDD	R2,Y+2
    014AF 803B      LDD	R3,Y+3
    014B0 804C      LDD	R4,Y+4
    014B1 805D      LDD	R5,Y+5
    014B2 1624      CP	R2,R20
    014B3 0635      CPC	R3,R21
    014B4 0646      CPC	R4,R22
    014B5 0657      CPC	R5,R23
    014B6 F411      BNE	0x14B9
    014B7 E001      LDI	R16,1
    014B8 C05C      RJMP	0x1515
(1092) 			if (clst < 2 || clst >= dj->fs->n_fatent)	/* Reached to end of table or int error */
    014B9 E042      LDI	R20,2
    014BA E050      LDI	R21,0
    014BB E060      LDI	R22,0
    014BC E070      LDI	R23,0
    014BD 802A      LDD	R2,Y+2
    014BE 803B      LDD	R3,Y+3
    014BF 804C      LDD	R4,Y+4
    014C0 805D      LDD	R5,Y+5
    014C1 1624      CP	R2,R20
    014C2 0635      CPC	R3,R21
    014C3 0646      CPC	R4,R22
    014C4 0657      CPC	R5,R23
    014C5 F088      BCS	0x14D7
    014C6 01F5      MOVW	R30,R10
    014C7 81A0      LD	R26,Z
    014C8 81B1      LDD	R27,Z+1
    014C9 9656      ADIW	R26,0x16
    014CA 902D      LD	R2,X+
    014CB 903D      LD	R3,X+
    014CC 904D      LD	R4,X+
    014CD 905C      LD	R5,X
    014CE 806A      LDD	R6,Y+2
    014CF 807B      LDD	R7,Y+3
    014D0 808C      LDD	R8,Y+4
    014D1 809D      LDD	R9,Y+5
    014D2 1462      CP	R6,R2
    014D3 0473      CPC	R7,R3
    014D4 0484      CPC	R8,R4
    014D5 0495      CPC	R9,R5
    014D6 F010      BCS	0x14D9
(1093) 				return FR_INT_ERR;
    014D7 E002      LDI	R16,2
    014D8 C03C      RJMP	0x1515
(1094) 			idx -= ic;
    014D9 18CE      SUB	R12,R14
    014DA 08DF      SBC	R13,R15
    014DB 14CE      CP	R12,R14
    014DC 04DF      CPC	R13,R15
    014DD F008      BCS	0x14DF
    014DE CFBC      RJMP	0x149B
(1095) 		}
(1096) 		dj->clust = clst;
    014DF 802A      LDD	R2,Y+2
    014E0 803B      LDD	R3,Y+3
    014E1 804C      LDD	R4,Y+4
    014E2 805D      LDD	R5,Y+5
    014E3 01F5      MOVW	R30,R10
    014E4 8622      STD	Z+10,R2
    014E5 8633      STD	Z+11,R3
    014E6 8644      STD	Z+12,R4
    014E7 8655      STD	Z+13,R5
(1097) 		dj->sect = clust2sect(dj->fs, clst) + idx / (SS(dj->fs) / SZ_DIR);	/* Sector# */
    014E8 8248      ST	Y,R4
    014E9 8259      STD	Y+1,R5
    014EA 0191      MOVW	R18,R2
    014EB 8100      LD	R16,Z
    014EC 8111      LDD	R17,Z+1
    014ED D91B      RCALL	_clust2sect
    014EE 0116      MOVW	R2,R12
    014EF 9436      LSR	R3
    014F0 9427      ROR	R2
    014F1 9436      LSR	R3
    014F2 9427      ROR	R2
    014F3 9436      LSR	R3
    014F4 9427      ROR	R2
    014F5 9436      LSR	R3
    014F6 9427      ROR	R2
    014F7 2444      CLR	R4
    014F8 2455      CLR	R5
    014F9 0138      MOVW	R6,R16
    014FA 0149      MOVW	R8,R18
    014FB 0C62      ADD	R6,R2
    014FC 1C73      ADC	R7,R3
    014FD 1C84      ADC	R8,R4
    014FE 1C95      ADC	R9,R5
    014FF 01F5      MOVW	R30,R10
    01500 8666      STD	Z+14,R6
    01501 8677      STD	Z+15,R7
    01502 8A80      STD	Z+16,R8
    01503 8A91      STD	Z+17,R9
(1098) 	}
(1099) 
(1100) 	dj->dir = dj->fs->win + (idx % (SS(dj->fs) / SZ_DIR)) * SZ_DIR;	/* Ptr to the entry in the sector */
    01504 0196      MOVW	R18,R12
    01505 702F      ANDI	R18,0xF
    01506 7030      ANDI	R19,0
    01507 E200      LDI	R16,0x20
    01508 E010      LDI	R17,0
    01509 940E 4AB9 CALL	empy16s
    0150B 0118      MOVW	R2,R16
    0150C 01F5      MOVW	R30,R10
    0150D 8180      LD	R24,Z
    0150E 8191      LDD	R25,Z+1
    0150F 968E      ADIW	R24,0x2E
    01510 0E28      ADD	R2,R24
    01511 1E39      ADC	R3,R25
    01512 8A33      STD	Z+19,R3
    01513 8A22      STD	Z+18,R2
(1101) 
(1102) 	return FR_OK;	/* Seek succeeded */
    01514 2700      CLR	R16
    01515 9626      ADIW	R28,6
    01516 940C 4B12 JMP	pop_xgsetF0FC
ff.c:dir_next:
  c                    --> R10
  clst                 --> Y,+2
  i                    --> R12
  stretch              --> R10
  dj                   --> Y,+16
    01518 940E 49D8 CALL	push_arg4
    0151A 940E 4B1D CALL	push_xgsetF0FC
    0151C 0159      MOVW	R10,R18
    0151D 9726      SBIW	R28,6
(1103) }
(1104) 
(1105) 
(1106) 
(1107) 
(1108) /*-----------------------------------------------------------------------*/
(1109) /* Directory handling - Move directory index next                        */
(1110) /*-----------------------------------------------------------------------*/
(1111) 
(1112) static
(1113) FRESULT dir_next (	/* FR_OK:Succeeded, FR_NO_FILE:End of table, FR_DENIED:EOT and could not stretch */
(1114) 	DIR *dj,		/* Pointer to directory object */
(1115) 	int stretch		/* 0: Do not stretch table, 1: Stretch table if needed */
(1116) )
(1117) {
(1118) 	DWORD clst;
(1119) 	WORD i;
(1120) 
(1121) 
(1122) 	stretch = stretch;		/* To suppress warning on read-only cfg. */
(1123) 	i = dj->index + 1;
    0151E 89E8      LDD	R30,Y+16
    0151F 89F9      LDD	R31,Y+17
    01520 8184      LDD	R24,Z+4
    01521 8195      LDD	R25,Z+5
    01522 9601      ADIW	R24,1
    01523 016C      MOVW	R12,R24
(1124) 	if (!i || !dj->sect)	/* Report EOT when index has reached 65535 */
    01524 3080      CPI	R24,0
    01525 0789      CPC	R24,R25
    01526 F059      BEQ	0x1532
    01527 963E      ADIW	R30,0xE
    01528 8020      LD	R2,Z
    01529 8031      LDD	R3,Z+1
    0152A 8042      LDD	R4,Z+2
    0152B 8053      LDD	R5,Z+3
    0152C 9488      BCLR	0
    0152D 2022      TST	R2
    0152E 0432      CPC	R3,R2
    0152F 0442      CPC	R4,R2
    01530 0452      CPC	R5,R2
    01531 F411      BNE	0x1534
(1125) 		return FR_NO_FILE;
    01532 E004      LDI	R16,4
    01533 C18D      RJMP	0x16C1
(1126) 
(1127) 	if (!(i % (SS(dj->fs) / SZ_DIR))) {	/* Sector changed? */
    01534 01C6      MOVW	R24,R12
    01535 708F      ANDI	R24,0xF
    01536 7090      ANDI	R25,0
    01537 3080      CPI	R24,0
    01538 0789      CPC	R24,R25
    01539 F009      BEQ	0x153B
    0153A C170      RJMP	0x16AB
(1128) 		dj->sect++;					/* Next sector */
    0153B 8988      LDD	R24,Y+16
    0153C 8999      LDD	R25,Y+17
    0153D 960E      ADIW	R24,0xE
    0153E E041      LDI	R20,1
    0153F E050      LDI	R21,0
    01540 E060      LDI	R22,0
    01541 E070      LDI	R23,0
    01542 01FC      MOVW	R30,R24
    01543 8020      LD	R2,Z
    01544 8031      LDD	R3,Z+1
    01545 8042      LDD	R4,Z+2
    01546 8053      LDD	R5,Z+3
    01547 0E24      ADD	R2,R20
    01548 1E35      ADC	R3,R21
    01549 1E46      ADC	R4,R22
    0154A 1E57      ADC	R5,R23
    0154B 8220      ST	Z,R2
    0154C 8231      STD	Z+1,R3
    0154D 8242      STD	Z+2,R4
    0154E 8253      STD	Z+3,R5
(1129) 
(1130) 		if (dj->clust == 0) {	/* Static table */
    0154F 89E8      LDD	R30,Y+16
    01550 89F9      LDD	R31,Y+17
    01551 963A      ADIW	R30,0xA
    01552 8020      LD	R2,Z
    01553 8031      LDD	R3,Z+1
    01554 8042      LDD	R4,Z+2
    01555 8053      LDD	R5,Z+3
    01556 9488      BCLR	0
    01557 2022      TST	R2
    01558 0432      CPC	R3,R2
    01559 0442      CPC	R4,R2
    0155A 0452      CPC	R5,R2
    0155B F469      BNE	0x1569
(1131) 			if (i >= dj->fs->n_rootdir)	/* Report EOT when end of table */
    0155C 89E8      LDD	R30,Y+16
    0155D 89F9      LDD	R31,Y+17
    0155E 81A0      LD	R26,Z
    0155F 81B1      LDD	R27,Z+1
    01560 9618      ADIW	R26,0x8
    01561 902D      LD	R2,X+
    01562 903C      LD	R3,X
    01563 14C2      CP	R12,R2
    01564 04D3      CPC	R13,R3
    01565 F408      BCC	0x1567
    01566 C144      RJMP	0x16AB
(1132) 				return FR_NO_FILE;
    01567 E004      LDI	R16,4
    01568 C158      RJMP	0x16C1
(1133) 		}
(1134) 		else {					/* Dynamic table */
(1135) 			if (((i / (SS(dj->fs) / SZ_DIR)) & (dj->fs->csize - 1)) == 0) {	/* Cluster changed? */
    01569 89E8      LDD	R30,Y+16
    0156A 89F9      LDD	R31,Y+17
    0156B 93AF      PUSH	R26
    0156C 93BF      PUSH	R27
    0156D 81A0      LD	R26,Z
    0156E 81B1      LDD	R27,Z+1
    0156F 01FD      MOVW	R30,R26
    01570 91BF      POP	R27
    01571 91AF      POP	R26
    01572 8182      LDD	R24,Z+2
    01573 2799      CLR	R25
    01574 9701      SBIW	R24,1
    01575 0116      MOVW	R2,R12
    01576 9436      LSR	R3
    01577 9427      ROR	R2
    01578 9436      LSR	R3
    01579 9427      ROR	R2
    0157A 9436      LSR	R3
    0157B 9427      ROR	R2
    0157C 9436      LSR	R3
    0157D 9427      ROR	R2
    0157E 2228      AND	R2,R24
    0157F 2239      AND	R3,R25
    01580 2022      TST	R2
    01581 F009      BEQ	0x1583
    01582 C128      RJMP	0x16AB
    01583 2033      TST	R3
    01584 F009      BEQ	0x1586
    01585 C125      RJMP	0x16AB
(1136) 				clst = get_fat(dj->fs, dj->clust);				/* Get next cluster */
    01586 89E8      LDD	R30,Y+16
    01587 89F9      LDD	R31,Y+17
    01588 8422      LDD	R2,Z+10
    01589 8433      LDD	R3,Z+11
    0158A 8444      LDD	R4,Z+12
    0158B 8455      LDD	R5,Z+13
    0158C 8248      ST	Y,R4
    0158D 8259      STD	Y+1,R5
    0158E 0191      MOVW	R18,R2
    0158F 8100      LD	R16,Z
    01590 8111      LDD	R17,Z+1
    01591 D8C9      RCALL	_get_fat
    01592 830A      STD	Y+2,R16
    01593 831B      STD	Y+3,R17
    01594 832C      STD	Y+4,R18
    01595 833D      STD	Y+5,R19
(1137) 				if (clst <= 1) return FR_INT_ERR;
    01596 E041      LDI	R20,1
    01597 E050      LDI	R21,0
    01598 E060      LDI	R22,0
    01599 E070      LDI	R23,0
    0159A 802A      LDD	R2,Y+2
    0159B 803B      LDD	R3,Y+3
    0159C 804C      LDD	R4,Y+4
    0159D 805D      LDD	R5,Y+5
    0159E 1542      CP	R20,R2
    0159F 0553      CPC	R21,R3
    015A0 0564      CPC	R22,R4
    015A1 0575      CPC	R23,R5
    015A2 F010      BCS	0x15A5
    015A3 E002      LDI	R16,2
    015A4 C11C      RJMP	0x16C1
(1138) 				if (clst == 0xFFFFFFFF) return FR_DISK_ERR;
    015A5 EF4F      LDI	R20,0xFF
    015A6 EF5F      LDI	R21,0xFF
    015A7 EF6F      LDI	R22,0xFF
    015A8 EF7F      LDI	R23,0xFF
    015A9 802A      LDD	R2,Y+2
    015AA 803B      LDD	R3,Y+3
    015AB 804C      LDD	R4,Y+4
    015AC 805D      LDD	R5,Y+5
    015AD 1624      CP	R2,R20
    015AE 0635      CPC	R3,R21
    015AF 0646      CPC	R4,R22
    015B0 0657      CPC	R5,R23
    015B1 F411      BNE	0x15B4
    015B2 E001      LDI	R16,1
    015B3 C10D      RJMP	0x16C1
(1139) 				if (clst >= dj->fs->n_fatent) {					/* When it reached end of dynamic table */
    015B4 89E8      LDD	R30,Y+16
    015B5 89F9      LDD	R31,Y+17
    015B6 81A0      LD	R26,Z
    015B7 81B1      LDD	R27,Z+1
    015B8 9656      ADIW	R26,0x16
    015B9 902D      LD	R2,X+
    015BA 903D      LD	R3,X+
    015BB 904D      LD	R4,X+
    015BC 905C      LD	R5,X
    015BD 806A      LDD	R6,Y+2
    015BE 807B      LDD	R7,Y+3
    015BF 808C      LDD	R8,Y+4
    015C0 809D      LDD	R9,Y+5
    015C1 1462      CP	R6,R2
    015C2 0473      CPC	R7,R3
    015C3 0484      CPC	R8,R4
    015C4 0495      CPC	R9,R5
    015C5 F408      BCC	0x15C7
    015C6 C0CD      RJMP	0x1694
(1140) #if !_FS_READONLY
(1141) 					BYTE c;
(1142) 					if (!stretch) return FR_NO_FILE;			/* When do not stretch, report EOT */
    015C7 20AA      TST	R10
    015C8 F421      BNE	0x15CD
    015C9 20BB      TST	R11
    015CA F411      BNE	0x15CD
    015CB E004      LDI	R16,4
    015CC C0F4      RJMP	0x16C1
(1143) 					clst = create_chain(dj->fs, dj->clust);		/* Stretch cluster chain */
    015CD 89E8      LDD	R30,Y+16
    015CE 89F9      LDD	R31,Y+17
    015CF 8422      LDD	R2,Z+10
    015D0 8433      LDD	R3,Z+11
    015D1 8444      LDD	R4,Z+12
    015D2 8455      LDD	R5,Z+13
    015D3 8248      ST	Y,R4
    015D4 8259      STD	Y+1,R5
    015D5 0191      MOVW	R18,R2
    015D6 8100      LD	R16,Z
    015D7 8111      LDD	R17,Z+1
    015D8 DC44      RCALL	ff.c:create_chain
    015D9 830A      STD	Y+2,R16
    015DA 831B      STD	Y+3,R17
    015DB 832C      STD	Y+4,R18
    015DC 833D      STD	Y+5,R19
(1144) 					if (clst == 0) return FR_DENIED;			/* No free cluster */
    015DD 802A      LDD	R2,Y+2
    015DE 803B      LDD	R3,Y+3
    015DF 804C      LDD	R4,Y+4
    015E0 805D      LDD	R5,Y+5
    015E1 9488      BCLR	0
    015E2 2022      TST	R2
    015E3 0432      CPC	R3,R2
    015E4 0442      CPC	R4,R2
    015E5 0452      CPC	R5,R2
    015E6 F411      BNE	0x15E9
    015E7 E007      LDI	R16,7
    015E8 C0D8      RJMP	0x16C1
(1145) 					if (clst == 1) return FR_INT_ERR;
    015E9 E041      LDI	R20,1
    015EA E050      LDI	R21,0
    015EB E060      LDI	R22,0
    015EC E070      LDI	R23,0
    015ED 802A      LDD	R2,Y+2
    015EE 803B      LDD	R3,Y+3
    015EF 804C      LDD	R4,Y+4
    015F0 805D      LDD	R5,Y+5
    015F1 1624      CP	R2,R20
    015F2 0635      CPC	R3,R21
    015F3 0646      CPC	R4,R22
    015F4 0657      CPC	R5,R23
    015F5 F411      BNE	0x15F8
    015F6 E002      LDI	R16,2
    015F7 C0C9      RJMP	0x16C1
(1146) 					if (clst == 0xFFFFFFFF) return FR_DISK_ERR;
    015F8 EF4F      LDI	R20,0xFF
    015F9 EF5F      LDI	R21,0xFF
    015FA EF6F      LDI	R22,0xFF
    015FB EF7F      LDI	R23,0xFF
    015FC 802A      LDD	R2,Y+2
    015FD 803B      LDD	R3,Y+3
    015FE 804C      LDD	R4,Y+4
    015FF 805D      LDD	R5,Y+5
    01600 1624      CP	R2,R20
    01601 0635      CPC	R3,R21
    01602 0646      CPC	R4,R22
    01603 0657      CPC	R5,R23
    01604 F411      BNE	0x1607
    01605 E001      LDI	R16,1
    01606 C0BA      RJMP	0x16C1
(1147) 					/* Clean-up stretched table */
(1148) 					if (move_window(dj->fs, 0)) return FR_DISK_ERR;	/* Flush active window */
    01607 E040      LDI	R20,0
    01608 E050      LDI	R21,0
    01609 E060      LDI	R22,0
    0160A E070      LDI	R23,0
    0160B 8368      ST	Y,R22
    0160C 8379      STD	Y+1,R23
    0160D 019A      MOVW	R18,R20
    0160E 89E8      LDD	R30,Y+16
    0160F 89F9      LDD	R31,Y+17
    01610 8100      LD	R16,Z
    01611 8111      LDD	R17,Z+1
    01612 940E 0C92 CALL	ff.c:move_window
    01614 2300      TST	R16
    01615 F011      BEQ	0x1618
    01616 E001      LDI	R16,1
    01617 C0A9      RJMP	0x16C1
(1149) 					mem_set(dj->fs->win, 0, SS(dj->fs));			/* Clear window buffer */
    01618 E080      LDI	R24,0
    01619 E092      LDI	R25,2
    0161A 8399      STD	Y+1,R25
    0161B 8388      ST	Y,R24
    0161C 2722      CLR	R18
    0161D 2733      CLR	R19
    0161E 89E8      LDD	R30,Y+16
    0161F 89F9      LDD	R31,Y+17
    01620 8100      LD	R16,Z
    01621 8111      LDD	R17,Z+1
    01622 5D02      SUBI	R16,0xD2
    01623 4F1F      SBCI	R17,0xFF
    01624 940E 0C4F CALL	ff.c:mem_set
(1150) 					dj->fs->winsect = clust2sect(dj->fs, clst);	/* Cluster start sector */
    01626 802A      LDD	R2,Y+2
    01627 803B      LDD	R3,Y+3
    01628 804C      LDD	R4,Y+4
    01629 805D      LDD	R5,Y+5
    0162A 8248      ST	Y,R4
    0162B 8259      STD	Y+1,R5
    0162C 0191      MOVW	R18,R2
    0162D 89E8      LDD	R30,Y+16
    0162E 89F9      LDD	R31,Y+17
    0162F 80A0      LD	R10,Z
    01630 80B1      LDD	R11,Z+1
    01631 0185      MOVW	R16,R10
    01632 940E 0E09 CALL	_clust2sect
    01634 01F5      MOVW	R30,R10
    01635 A702      STD	Z+42,R16
    01636 A713      STD	Z+43,R17
    01637 A724      STD	Z+44,R18
    01638 A735      STD	Z+45,R19
(1151) 					for (c = 0; c < dj->fs->csize; c++) {		/* Fill the new cluster with 0 */
    01639 24AA      CLR	R10
    0163A C035      RJMP	0x1670
(1152) 						dj->fs->wflag = 1;
    0163B E081      LDI	R24,1
    0163C 89E8      LDD	R30,Y+16
    0163D 89F9      LDD	R31,Y+17
    0163E 93AF      PUSH	R26
    0163F 93BF      PUSH	R27
    01640 81A0      LD	R26,Z
    01641 81B1      LDD	R27,Z+1
    01642 01FD      MOVW	R30,R26
    01643 91BF      POP	R27
    01644 91AF      POP	R26
    01645 8384      STD	Z+4,R24
(1153) 						if (move_window(dj->fs, 0)) return FR_DISK_ERR;
    01646 E040      LDI	R20,0
    01647 E050      LDI	R21,0
    01648 E060      LDI	R22,0
    01649 E070      LDI	R23,0
    0164A 8368      ST	Y,R22
    0164B 8379      STD	Y+1,R23
    0164C 019A      MOVW	R18,R20
    0164D 89E8      LDD	R30,Y+16
    0164E 89F9      LDD	R31,Y+17
    0164F 8100      LD	R16,Z
    01650 8111      LDD	R17,Z+1
    01651 940E 0C92 CALL	ff.c:move_window
    01653 2EE0      MOV	R14,R16
    01654 2300      TST	R16
    01655 F011      BEQ	0x1658
    01656 E001      LDI	R16,1
    01657 C069      RJMP	0x16C1
(1154) 						dj->fs->winsect++;
    01658 89E8      LDD	R30,Y+16
    01659 89F9      LDD	R31,Y+17
    0165A 8180      LD	R24,Z
    0165B 8191      LDD	R25,Z+1
    0165C 968A      ADIW	R24,0x2A
    0165D 017C      MOVW	R14,R24
    0165E E041      LDI	R20,1
    0165F E050      LDI	R21,0
    01660 E060      LDI	R22,0
    01661 E070      LDI	R23,0
    01662 01FC      MOVW	R30,R24
    01663 8020      LD	R2,Z
    01664 8031      LDD	R3,Z+1
    01665 8042      LDD	R4,Z+2
    01666 8053      LDD	R5,Z+3
    01667 0E24      ADD	R2,R20
    01668 1E35      ADC	R3,R21
    01669 1E46      ADC	R4,R22
    0166A 1E57      ADC	R5,R23
    0166B 8220      ST	Z,R2
    0166C 8231      STD	Z+1,R3
    0166D 8242      STD	Z+2,R4
    0166E 8253      STD	Z+3,R5
    0166F 94A3      INC	R10
    01670 89E8      LDD	R30,Y+16
    01671 89F9      LDD	R31,Y+17
    01672 93AF      PUSH	R26
    01673 93BF      PUSH	R27
    01674 81A0      LD	R26,Z
    01675 81B1      LDD	R27,Z+1
    01676 01FD      MOVW	R30,R26
    01677 91BF      POP	R27
    01678 91AF      POP	R26
    01679 8022      LDD	R2,Z+2
    0167A 14A2      CP	R10,R2
    0167B F408      BCC	0x167D
    0167C CFBE      RJMP	0x163B
(1155) 					}
(1156) 					dj->fs->winsect -= c;						/* Rewind window address */
    0167D 89E8      LDD	R30,Y+16
    0167E 89F9      LDD	R31,Y+17
    0167F 8180      LD	R24,Z
    01680 8191      LDD	R25,Z+1
    01681 968A      ADIW	R24,0x2A
    01682 017C      MOVW	R14,R24
    01683 2C2A      MOV	R2,R10
    01684 2433      CLR	R3
    01685 2444      CLR	R4
    01686 2455      CLR	R5
    01687 01FC      MOVW	R30,R24
    01688 8060      LD	R6,Z
    01689 8071      LDD	R7,Z+1
    0168A 8082      LDD	R8,Z+2
    0168B 8093      LDD	R9,Z+3
    0168C 1862      SUB	R6,R2
    0168D 0873      SBC	R7,R3
    0168E 0884      SBC	R8,R4
    0168F 0895      SBC	R9,R5
    01690 8260      ST	Z,R6
    01691 8271      STD	Z+1,R7
    01692 8282      STD	Z+2,R8
    01693 8293      STD	Z+3,R9
(1157) #else
(1158) 					return FR_NO_FILE;			/* Report EOT */
(1159) #endif
(1160) 				}
(1161) 				dj->clust = clst;				/* Initialize data for new cluster */
    01694 802A      LDD	R2,Y+2
    01695 803B      LDD	R3,Y+3
    01696 804C      LDD	R4,Y+4
    01697 805D      LDD	R5,Y+5
    01698 89E8      LDD	R30,Y+16
    01699 89F9      LDD	R31,Y+17
    0169A 8622      STD	Z+10,R2
    0169B 8633      STD	Z+11,R3
    0169C 8644      STD	Z+12,R4
    0169D 8655      STD	Z+13,R5
(1162) 				dj->sect = clust2sect(dj->fs, clst);
    0169E 8248      ST	Y,R4
    0169F 8259      STD	Y+1,R5
    016A0 0191      MOVW	R18,R2
    016A1 8100      LD	R16,Z
    016A2 8111      LDD	R17,Z+1
    016A3 940E 0E09 CALL	_clust2sect
    016A5 89E8      LDD	R30,Y+16
    016A6 89F9      LDD	R31,Y+17
    016A7 8706      STD	Z+14,R16
    016A8 8717      STD	Z+15,R17
    016A9 8B20      STD	Z+16,R18
    016AA 8B31      STD	Z+17,R19
(1163) 			}
(1164) 		}
(1165) 	}
(1166) 
(1167) 	dj->index = i;
    016AB 89E8      LDD	R30,Y+16
    016AC 89F9      LDD	R31,Y+17
    016AD 82D5      STD	Z+5,R13
    016AE 82C4      STD	Z+4,R12
(1168) 	dj->dir = dj->fs->win + (i % (SS(dj->fs) / SZ_DIR)) * SZ_DIR;
    016AF 0196      MOVW	R18,R12
    016B0 702F      ANDI	R18,0xF
    016B1 7030      ANDI	R19,0
    016B2 E200      LDI	R16,0x20
    016B3 E010      LDI	R17,0
    016B4 940E 4AB9 CALL	empy16s
    016B6 0118      MOVW	R2,R16
    016B7 89E8      LDD	R30,Y+16
    016B8 89F9      LDD	R31,Y+17
    016B9 8180      LD	R24,Z
    016BA 8191      LDD	R25,Z+1
    016BB 968E      ADIW	R24,0x2E
    016BC 0E28      ADD	R2,R24
    016BD 1E39      ADC	R3,R25
    016BE 8A33      STD	Z+19,R3
    016BF 8A22      STD	Z+18,R2
(1169) 
(1170) 	return FR_OK;
    016C0 2700      CLR	R16
    016C1 9626      ADIW	R28,6
    016C2 940E 4B12 CALL	pop_xgsetF0FC
    016C4 9624      ADIW	R28,4
    016C5 9508      RET
ff.c:dir_find:
  c                    --> R12
  dir                  --> R10
  res                  --> R20
  dj                   --> R22
    016C6 940E 4B58 CALL	push_xgsetF03C
    016C8 01B8      MOVW	R22,R16
    016C9 9722      SBIW	R28,2
(1171) }
(1172) 
(1173) 
(1174) 
(1175) 
(1176) /*-----------------------------------------------------------------------*/
(1177) /* LFN handling - Test/Pick/Fit an LFN segment from/to directory entry   */
(1178) /*-----------------------------------------------------------------------*/
(1179) #if _USE_LFN
(1180) static
(1181) const BYTE LfnOfs[] = {1,3,5,7,9,14,16,18,20,22,24,28,30};	/* Offset of LFN chars in the directory entry */
(1182) 
(1183) 
(1184) static
(1185) int cmp_lfn (			/* 1:Matched, 0:Not matched */
(1186) 	WCHAR *lfnbuf,		/* Pointer to the LFN to be compared */
(1187) 	BYTE *dir			/* Pointer to the directory entry containing a part of LFN */
(1188) )
(1189) {
(1190) 	UINT i, s;
(1191) 	WCHAR wc, uc;
(1192) 
(1193) 
(1194) 	i = ((dir[LDIR_Ord] & ~LLE) - 1) * 13;	/* Get offset in the LFN buffer */
(1195) 	s = 0; wc = 1;
(1196) 	do {
(1197) 		uc = LD_WORD(dir+LfnOfs[s]);	/* Pick an LFN character from the entry */
(1198) 		if (wc) {	/* Last char has not been processed */
(1199) 			wc = ff_wtoupper(uc);		/* Convert it to upper case */
(1200) 			if (i >= _MAX_LFN || wc != ff_wtoupper(lfnbuf[i++]))	/* Compare it */
(1201) 				return 0;				/* Not matched */
(1202) 		} else {
(1203) 			if (uc != 0xFFFF) return 0;	/* Check filler */
(1204) 		}
(1205) 	} while (++s < 13);				/* Repeat until all chars in the entry are checked */
(1206) 
(1207) 	if ((dir[LDIR_Ord] & LLE) && wc && lfnbuf[i])	/* Last segment matched but different length */
(1208) 		return 0;
(1209) 
(1210) 	return 1;						/* The part of LFN matched */
(1211) }
(1212) 
(1213) 
(1214) 
(1215) static
(1216) int pick_lfn (			/* 1:Succeeded, 0:Buffer overflow */
(1217) 	WCHAR *lfnbuf,		/* Pointer to the Unicode-LFN buffer */
(1218) 	BYTE *dir			/* Pointer to the directory entry */
(1219) )
(1220) {
(1221) 	UINT i, s;
(1222) 	WCHAR wc, uc;
(1223) 
(1224) 
(1225) 	i = ((dir[LDIR_Ord] & 0x3F) - 1) * 13;	/* Offset in the LFN buffer */
(1226) 
(1227) 	s = 0; wc = 1;
(1228) 	do {
(1229) 		uc = LD_WORD(dir+LfnOfs[s]);		/* Pick an LFN character from the entry */
(1230) 		if (wc) {	/* Last char has not been processed */
(1231) 			if (i >= _MAX_LFN) return 0;	/* Buffer overflow? */
(1232) 			lfnbuf[i++] = wc = uc;			/* Store it */
(1233) 		} else {
(1234) 			if (uc != 0xFFFF) return 0;		/* Check filler */
(1235) 		}
(1236) 	} while (++s < 13);						/* Read all character in the entry */
(1237) 
(1238) 	if (dir[LDIR_Ord] & LLE) {				/* Put terminator if it is the last LFN part */
(1239) 		if (i >= _MAX_LFN) return 0;		/* Buffer overflow? */
(1240) 		lfnbuf[i] = 0;
(1241) 	}
(1242) 
(1243) 	return 1;
(1244) }
(1245) 
(1246) 
(1247) #if !_FS_READONLY
(1248) static
(1249) void fit_lfn (
(1250) 	const WCHAR *lfnbuf,	/* Pointer to the LFN buffer */
(1251) 	BYTE *dir,				/* Pointer to the directory entry */
(1252) 	BYTE ord,				/* LFN order (1-20) */
(1253) 	BYTE sum				/* SFN sum */
(1254) )
(1255) {
(1256) 	UINT i, s;
(1257) 	WCHAR wc;
(1258) 
(1259) 
(1260) 	dir[LDIR_Chksum] = sum;			/* Set check sum */
(1261) 	dir[LDIR_Attr] = AM_LFN;		/* Set attribute. LFN entry */
(1262) 	dir[LDIR_Type] = 0;
(1263) 	ST_WORD(dir+LDIR_FstClusLO, 0);
(1264) 
(1265) 	i = (ord - 1) * 13;				/* Get offset in the LFN buffer */
(1266) 	s = wc = 0;
(1267) 	do {
(1268) 		if (wc != 0xFFFF) wc = lfnbuf[i++];	/* Get an effective char */
(1269) 		ST_WORD(dir+LfnOfs[s], wc);	/* Put it */
(1270) 		if (!wc) wc = 0xFFFF;		/* Padding chars following last char */
(1271) 	} while (++s < 13);
(1272) 	if (wc == 0xFFFF || !lfnbuf[i]) ord |= LLE;	/* Bottom LFN part is the start of LFN sequence */
(1273) 	dir[LDIR_Ord] = ord;			/* Set the LFN order */
(1274) }
(1275) 
(1276) #endif
(1277) #endif
(1278) 
(1279) 
(1280) 
(1281) /*-----------------------------------------------------------------------*/
(1282) /* Create numbered name                                                  */
(1283) /*-----------------------------------------------------------------------*/
(1284) #if _USE_LFN
(1285) void gen_numname (
(1286) 	BYTE *dst,			/* Pointer to generated SFN */
(1287) 	const BYTE *src,	/* Pointer to source SFN to be modified */
(1288) 	const WCHAR *lfn,	/* Pointer to LFN */
(1289) 	WORD seq			/* Sequence number */
(1290) )
(1291) {
(1292) 	BYTE ns[8], c;
(1293) 	UINT i, j;
(1294) 
(1295) 
(1296) 	mem_cpy(dst, src, 11);
(1297) 
(1298) 	if (seq > 5) {	/* On many collisions, generate a hash number instead of sequential number */
(1299) 		do seq = (seq >> 1) + (seq << 15) + (WORD)*lfn++; while (*lfn);
(1300) 	}
(1301) 
(1302) 	/* itoa (hexdecimal) */
(1303) 	i = 7;
(1304) 	do {
(1305) 		c = (seq % 16) + '0';
(1306) 		if (c > '9') c += 7;
(1307) 		ns[i--] = c;
(1308) 		seq /= 16;
(1309) 	} while (seq);
(1310) 	ns[i] = '~';
(1311) 
(1312) 	/* Append the number */
(1313) 	for (j = 0; j < i && dst[j] != ' '; j++) {
(1314) 		if (IsDBCS1(dst[j])) {
(1315) 			if (j == i - 1) break;
(1316) 			j++;
(1317) 		}
(1318) 	}
(1319) 	do {
(1320) 		dst[j++] = (i < 8) ? ns[i++] : ' ';
(1321) 	} while (j < 8);
(1322) }
(1323) #endif
(1324) 
(1325) 
(1326) 
(1327) 
(1328) /*-----------------------------------------------------------------------*/
(1329) /* Calculate sum of an SFN                                               */
(1330) /*-----------------------------------------------------------------------*/
(1331) #if _USE_LFN
(1332) static
(1333) BYTE sum_sfn (
(1334) 	const BYTE *dir		/* Ptr to directory entry */
(1335) )
(1336) {
(1337) 	BYTE sum = 0;
(1338) 	UINT n = 11;
(1339) 
(1340) 	do sum = (sum >> 1) + (sum << 7) + *dir++; while (--n);
(1341) 	return sum;
(1342) }
(1343) #endif
(1344) 
(1345) 
(1346) 
(1347) 
(1348) /*-----------------------------------------------------------------------*/
(1349) /* Directory handling - Find an object in the directory                  */
(1350) /*-----------------------------------------------------------------------*/
(1351) 
(1352) static
(1353) FRESULT dir_find (
(1354) 	DIR *dj			/* Pointer to the directory object linked to the file name */
(1355) )
(1356) {
(1357) 	FRESULT res;
(1358) 	BYTE c, *dir;
(1359) #if _USE_LFN
(1360) 	BYTE a, ord, sum;
(1361) #endif
(1362) 
(1363) 	res = dir_sdi(dj, 0);			/* Rewind directory object */
    016CA 2722      CLR	R18
    016CB 2733      CLR	R19
    016CC 018B      MOVW	R16,R22
    016CD DD40      RCALL	ff.c:dir_sdi
    016CE 2F40      MOV	R20,R16
(1364) 	if (res != FR_OK) return res;
    016CF 2300      TST	R16
    016D0 F009      BEQ	0x16D2
    016D1 C036      RJMP	0x1708
(1365) 
(1366) #if _USE_LFN
(1367) 	ord = sum = 0xFF;
(1368) #endif
(1369) 	do {
(1370) 		res = move_window(dj->fs, dj->sect);
    016D2 01FB      MOVW	R30,R22
    016D3 8426      LDD	R2,Z+14
    016D4 8437      LDD	R3,Z+15
    016D5 8840      LDD	R4,Z+16
    016D6 8851      LDD	R5,Z+17
    016D7 8248      ST	Y,R4
    016D8 8259      STD	Y+1,R5
    016D9 0191      MOVW	R18,R2
    016DA 8100      LD	R16,Z
    016DB 8111      LDD	R17,Z+1
    016DC 940E 0C92 CALL	ff.c:move_window
    016DE 2F40      MOV	R20,R16
(1371) 		if (res != FR_OK) break;
    016DF 2300      TST	R16
    016E0 F009      BEQ	0x16E2
    016E1 C025      RJMP	0x1707
(1372) 		dir = dj->dir;					/* Ptr to the directory entry of current index */
    016E2 01FB      MOVW	R30,R22
    016E3 88A2      LDD	R10,Z+18
    016E4 88B3      LDD	R11,Z+19
(1373) 		c = dir[DIR_Name];
    016E5 01F5      MOVW	R30,R10
    016E6 80C0      LD	R12,Z
(1374) 		if (c == 0) { res = FR_NO_FILE; break; }	/* Reached to end of table */
    016E7 20CC      TST	R12
    016E8 F411      BNE	0x16EB
    016E9 E044      LDI	R20,4
    016EA C01C      RJMP	0x1707
(1375) #if _USE_LFN	/* LFN configuration */
(1376) 		a = dir[DIR_Attr] & AM_MASK;
(1377) 		if (c == DDE || ((a & AM_VOL) && a != AM_LFN)) {	/* An entry without valid data */
(1378) 			ord = 0xFF;
(1379) 		} else {
(1380) 			if (a == AM_LFN) {			/* An LFN entry is found */
(1381) 				if (dj->lfn) {
(1382) 					if (c & LLE) {		/* Is it start of LFN sequence? */
(1383) 						sum = dir[LDIR_Chksum];
(1384) 						c &= ~LLE; ord = c;	/* LFN start order */
(1385) 						dj->lfn_idx = dj->index;
(1386) 					}
(1387) 					/* Check validity of the LFN entry and compare it with given name */
(1388) 					ord = (c == ord && sum == dir[LDIR_Chksum] && cmp_lfn(dj->lfn, dir)) ? ord - 1 : 0xFF;
(1389) 				}
(1390) 			} else {					/* An SFN entry is found */
(1391) 				if (!ord && sum == sum_sfn(dir)) break;	/* LFN matched? */
(1392) 				ord = 0xFF; dj->lfn_idx = 0xFFFF;	/* Reset LFN sequence */
(1393) 				if (!(dj->fn[NS] & NS_LOSS) && !mem_cmp(dir, dj->fn, 11)) break;	/* SFN matched? */
(1394) 			}
(1395) 		}
(1396) #else		/* Non LFN configuration */
(1397) 		if (!(dir[DIR_Attr] & AM_VOL) && !mem_cmp(dir, dj->fn, 11)) /* Is it a valid entry? */
    016EB 01F5      MOVW	R30,R10
    016EC 8423      LDD	R2,Z+11
    016ED FC23      SBRC	R2,3
    016EE C00F      RJMP	0x16FE
    016EF E08B      LDI	R24,0xB
    016F0 E090      LDI	R25,0
    016F1 8399      STD	Y+1,R25
    016F2 8388      ST	Y,R24
    016F3 01FB      MOVW	R30,R22
    016F4 8924      LDD	R18,Z+20
    016F5 8935      LDD	R19,Z+21
    016F6 0185      MOVW	R16,R10
    016F7 940E 0C61 CALL	ff.c:mem_cmp
    016F9 0158      MOVW	R10,R16
    016FA 3000      CPI	R16,0
    016FB 0701      CPC	R16,R17
    016FC F409      BNE	0x16FE
(1398) 			break;
    016FD C009      RJMP	0x1707
(1399) #endif
(1400) 		res = dir_next(dj, 0);		/* Next entry */
    016FE 2722      CLR	R18
    016FF 2733      CLR	R19
    01700 018B      MOVW	R16,R22
    01701 DE16      RCALL	ff.c:dir_next
    01702 2EA0      MOV	R10,R16
    01703 2D4A      MOV	R20,R10
(1401) 	} while (res == FR_OK);
    01704 2344      TST	R20
    01705 F409      BNE	0x1707
    01706 CFCB      RJMP	0x16D2
(1402) 
(1403) 	return res;
    01707 2F04      MOV	R16,R20
    01708 9622      ADIW	R28,2
    01709 940C 4B61 JMP	pop_xgsetF03C
ff.c:dir_read:
  dir                  --> R10
  c                    --> R12
  res                  --> R20
  dj                   --> R22
    0170B 940E 4B58 CALL	push_xgsetF03C
    0170D 01B8      MOVW	R22,R16
    0170E 9722      SBIW	R28,2
(1404) }
(1405) 
(1406) 
(1407) 
(1408) 
(1409) /*-----------------------------------------------------------------------*/
(1410) /* Read an object from the directory                                     */
(1411) /*-----------------------------------------------------------------------*/
(1412) #if _FS_MINIMIZE <= 1
(1413) static
(1414) FRESULT dir_read (
(1415) 	DIR *dj			/* Pointer to the directory object that pointing the entry to be read */
(1416) )
(1417) {
(1418) 	FRESULT res;
(1419) 	BYTE c, *dir;
(1420) #if _USE_LFN
(1421) 	BYTE a, ord = 0xFF, sum = 0xFF;
(1422) #endif
(1423) 
(1424) 	res = FR_NO_FILE;
    0170F E044      LDI	R20,4
    01710 C02B      RJMP	0x173C
(1425) 	while (dj->sect) {
(1426) 		res = move_window(dj->fs, dj->sect);
    01711 01FB      MOVW	R30,R22
    01712 8426      LDD	R2,Z+14
    01713 8437      LDD	R3,Z+15
    01714 8840      LDD	R4,Z+16
    01715 8851      LDD	R5,Z+17
    01716 8248      ST	Y,R4
    01717 8259      STD	Y+1,R5
    01718 0191      MOVW	R18,R2
    01719 8100      LD	R16,Z
    0171A 8111      LDD	R17,Z+1
    0171B 940E 0C92 CALL	ff.c:move_window
    0171D 2F40      MOV	R20,R16
(1427) 		if (res != FR_OK) break;
    0171E 2300      TST	R16
    0171F F009      BEQ	0x1721
    01720 C028      RJMP	0x1749
(1428) 		dir = dj->dir;					/* Ptr to the directory entry of current index */
    01721 01FB      MOVW	R30,R22
    01722 88A2      LDD	R10,Z+18
    01723 88B3      LDD	R11,Z+19
(1429) 		c = dir[DIR_Name];
    01724 01F5      MOVW	R30,R10
    01725 80C0      LD	R12,Z
(1430) 		if (c == 0) { res = FR_NO_FILE; break; }	/* Reached to end of table */
    01726 20CC      TST	R12
    01727 F411      BNE	0x172A
    01728 E044      LDI	R20,4
    01729 C01F      RJMP	0x1749
(1431) #if _USE_LFN	/* LFN configuration */
(1432) 		a = dir[DIR_Attr] & AM_MASK;
(1433) 		if (c == DDE || (!_FS_RPATH && c == '.') || ((a & AM_VOL) && a != AM_LFN)) {	/* An entry without valid data */
(1434) 			ord = 0xFF;
(1435) 		} else {
(1436) 			if (a == AM_LFN) {			/* An LFN entry is found */
(1437) 				if (c & LLE) {			/* Is it start of LFN sequence? */
(1438) 					sum = dir[LDIR_Chksum];
(1439) 					c &= ~LLE; ord = c;
(1440) 					dj->lfn_idx = dj->index;
(1441) 				}
(1442) 				/* Check LFN validity and capture it */
(1443) 				ord = (c == ord && sum == dir[LDIR_Chksum] && pick_lfn(dj->lfn, dir)) ? ord - 1 : 0xFF;
(1444) 			} else {					/* An SFN entry is found */
(1445) 				if (ord || sum != sum_sfn(dir))	/* Is there a valid LFN? */
(1446) 					dj->lfn_idx = 0xFFFF;		/* It has no LFN. */
(1447) 				break;
(1448) 			}
(1449) 		}
(1450) #else		/* Non LFN configuration */
(1451) 		if (c != DDE && (_FS_RPATH || c != '.') && !(dir[DIR_Attr] & AM_VOL))	/* Is it a valid entry? */
    0172A 2D8C      MOV	R24,R12
    0172B 3E85      CPI	R24,0xE5
    0172C F039      BEQ	0x1734
    0172D 328E      CPI	R24,0x2E
    0172E F029      BEQ	0x1734
    0172F 01F5      MOVW	R30,R10
    01730 8423      LDD	R2,Z+11
    01731 FC23      SBRC	R2,3
    01732 C001      RJMP	0x1734
(1452) 			break;
    01733 C015      RJMP	0x1749
(1453) #endif
(1454) 		res = dir_next(dj, 0);				/* Next entry */
    01734 2722      CLR	R18
    01735 2733      CLR	R19
    01736 018B      MOVW	R16,R22
    01737 DDE0      RCALL	ff.c:dir_next
    01738 2F40      MOV	R20,R16
(1455) 		if (res != FR_OK) break;
    01739 2300      TST	R16
    0173A F009      BEQ	0x173C
    0173B C00D      RJMP	0x1749
    0173C 01FB      MOVW	R30,R22
    0173D 963E      ADIW	R30,0xE
    0173E 8020      LD	R2,Z
    0173F 8031      LDD	R3,Z+1
    01740 8042      LDD	R4,Z+2
    01741 8053      LDD	R5,Z+3
    01742 9488      BCLR	0
    01743 2022      TST	R2
    01744 0432      CPC	R3,R2
    01745 0442      CPC	R4,R2
    01746 0452      CPC	R5,R2
    01747 F009      BEQ	0x1749
    01748 CFC8      RJMP	0x1711
(1456) 	}
(1457) 
(1458) 	if (res != FR_OK) dj->sect = 0;
    01749 2344      TST	R20
    0174A F039      BEQ	0x1752
    0174B 01FB      MOVW	R30,R22
    0174C 963E      ADIW	R30,0xE
    0174D E080      LDI	R24,0
    0174E 8380      ST	Z,R24
    0174F 8381      STD	Z+1,R24
    01750 8382      STD	Z+2,R24
    01751 8383      STD	Z+3,R24
(1459) 
(1460) 	return res;
    01752 2F04      MOV	R16,R20
    01753 9622      ADIW	R28,2
    01754 940C 4B61 JMP	pop_xgsetF03C
ff.c:dir_register:
  dir                  --> R12
  c                    --> R22
  res                  --> R10
  dj                   --> R20
    01756 940E 4B58 CALL	push_xgsetF03C
    01758 01A8      MOVW	R20,R16
    01759 9722      SBIW	R28,2
(1461) }
(1462) #endif
(1463) 
(1464) 
(1465) 
(1466) /*-----------------------------------------------------------------------*/
(1467) /* Register an object to the directory                                   */
(1468) /*-----------------------------------------------------------------------*/
(1469) #if !_FS_READONLY
(1470) static
(1471) FRESULT dir_register (	/* FR_OK:Successful, FR_DENIED:No free entry or too many SFN collision, FR_DISK_ERR:Disk error */
(1472) 	DIR *dj				/* Target directory with object name to be created */
(1473) )
(1474) {
(1475) 	FRESULT res;
(1476) 	BYTE c, *dir;
(1477) #if _USE_LFN	/* LFN configuration */
(1478) 	WORD n, ne, is;
(1479) 	BYTE sn[12], *fn, sum;
(1480) 	WCHAR *lfn;
(1481) 
(1482) 
(1483) 	fn = dj->fn; lfn = dj->lfn;
(1484) 	mem_cpy(sn, fn, 12);
(1485) 
(1486) 	if (_FS_RPATH && (sn[NS] & NS_DOT))		/* Cannot create dot entry */
(1487) 		return FR_INVALID_NAME;
(1488) 
(1489) 	if (sn[NS] & NS_LOSS) {			/* When LFN is out of 8.3 format, generate a numbered name */
(1490) 		fn[NS] = 0; dj->lfn = 0;			/* Find only SFN */
(1491) 		for (n = 1; n < 100; n++) {
(1492) 			gen_numname(fn, sn, lfn, n);	/* Generate a numbered name */
(1493) 			res = dir_find(dj);				/* Check if the name collides with existing SFN */
(1494) 			if (res != FR_OK) break;
(1495) 		}
(1496) 		if (n == 100) return FR_DENIED;		/* Abort if too many collisions */
(1497) 		if (res != FR_NO_FILE) return res;	/* Abort if the result is other than 'not collided' */
(1498) 		fn[NS] = sn[NS]; dj->lfn = lfn;
(1499) 	}
(1500) 
(1501) 	if (sn[NS] & NS_LFN) {			/* When LFN is to be created, reserve an SFN + LFN entries. */
(1502) 		for (ne = 0; lfn[ne]; ne++) ;
(1503) 		ne = (ne + 25) / 13;
(1504) 	} else {						/* Otherwise reserve only an SFN entry. */
(1505) 		ne = 1;
(1506) 	}
(1507) 
(1508) 	/* Reserve contiguous entries */
(1509) 	res = dir_sdi(dj, 0);
(1510) 	if (res != FR_OK) return res;
(1511) 	n = is = 0;
(1512) 	do {
(1513) 		res = move_window(dj->fs, dj->sect);
(1514) 		if (res != FR_OK) break;
(1515) 		c = *dj->dir;				/* Check the entry status */
(1516) 		if (c == DDE || c == 0) {	/* Is it a blank entry? */
(1517) 			if (n == 0) is = dj->index;	/* First index of the contiguous entry */
(1518) 			if (++n == ne) break;	/* A contiguous entry that required count is found */
(1519) 		} else {
(1520) 			n = 0;					/* Not a blank entry. Restart to search */
(1521) 		}
(1522) 		res = dir_next(dj, 1);		/* Next entry with table stretch */
(1523) 	} while (res == FR_OK);
(1524) 
(1525) 	if (res == FR_OK && ne > 1) {	/* Initialize LFN entry if needed */
(1526) 		res = dir_sdi(dj, is);
(1527) 		if (res == FR_OK) {
(1528) 			sum = sum_sfn(dj->fn);	/* Sum of the SFN tied to the LFN */
(1529) 			ne--;
(1530) 			do {					/* Store LFN entries in bottom first */
(1531) 				res = move_window(dj->fs, dj->sect);
(1532) 				if (res != FR_OK) break;
(1533) 				fit_lfn(dj->lfn, dj->dir, (BYTE)ne, sum);
(1534) 				dj->fs->wflag = 1;
(1535) 				res = dir_next(dj, 0);	/* Next entry */
(1536) 			} while (res == FR_OK && --ne);
(1537) 		}
(1538) 	}
(1539) 
(1540) #else	/* Non LFN configuration */
(1541) 	res = dir_sdi(dj, 0);
    0175A 2722      CLR	R18
    0175B 2733      CLR	R19
    0175C 018A      MOVW	R16,R20
    0175D DCB0      RCALL	ff.c:dir_sdi
    0175E 2EA0      MOV	R10,R16
(1542) 	if (res == FR_OK) {
    0175F 2300      TST	R16
    01760 F509      BNE	0x1782
(1543) 		do {	/* Find a blank entry for the SFN */
(1544) 			res = move_window(dj->fs, dj->sect);
    01761 01FA      MOVW	R30,R20
    01762 8426      LDD	R2,Z+14
    01763 8437      LDD	R3,Z+15
    01764 8840      LDD	R4,Z+16
    01765 8851      LDD	R5,Z+17
    01766 8248      ST	Y,R4
    01767 8259      STD	Y+1,R5
    01768 0191      MOVW	R18,R2
    01769 8100      LD	R16,Z
    0176A 8111      LDD	R17,Z+1
    0176B 940E 0C92 CALL	ff.c:move_window
    0176D 2EA0      MOV	R10,R16
(1545) 			if (res != FR_OK) break;
    0176E 2300      TST	R16
    0176F F009      BEQ	0x1771
    01770 C011      RJMP	0x1782
(1546) 			c = *dj->dir;
    01771 01FA      MOVW	R30,R20
    01772 89A2      LDD	R26,Z+18
    01773 89B3      LDD	R27,Z+19
    01774 916C      LD	R22,X
(1547) 			if (c == DDE || c == 0) break;	/* Is it a blank entry? */
    01775 3E65      CPI	R22,0xE5
    01776 F011      BEQ	0x1779
    01777 2366      TST	R22
    01778 F409      BNE	0x177A
    01779 C008      RJMP	0x1782
(1548) 			res = dir_next(dj, 1);			/* Next entry with table stretch */
    0177A E021      LDI	R18,1
    0177B E030      LDI	R19,0
    0177C 018A      MOVW	R16,R20
    0177D DD9A      RCALL	ff.c:dir_next
    0177E 2EC0      MOV	R12,R16
    0177F 2CAC      MOV	R10,R12
(1549) 		} while (res == FR_OK);
    01780 20AA      TST	R10
    01781 F2F9      BEQ	0x1761
(1550) 	}
(1551) #endif
(1552) 
(1553) 	if (res == FR_OK) {		/* Initialize the SFN entry */
    01782 20AA      TST	R10
    01783 F009      BEQ	0x1785
    01784 C030      RJMP	0x17B5
(1554) 		res = move_window(dj->fs, dj->sect);
    01785 01FA      MOVW	R30,R20
    01786 8426      LDD	R2,Z+14
    01787 8437      LDD	R3,Z+15
    01788 8840      LDD	R4,Z+16
    01789 8851      LDD	R5,Z+17
    0178A 8248      ST	Y,R4
    0178B 8259      STD	Y+1,R5
    0178C 0191      MOVW	R18,R2
    0178D 8100      LD	R16,Z
    0178E 8111      LDD	R17,Z+1
    0178F 940E 0C92 CALL	ff.c:move_window
    01791 2EC0      MOV	R12,R16
    01792 2CAC      MOV	R10,R12
(1555) 		if (res == FR_OK) {
    01793 2300      TST	R16
    01794 F501      BNE	0x17B5
(1556) 			dir = dj->dir;
    01795 01FA      MOVW	R30,R20
    01796 88C2      LDD	R12,Z+18
    01797 88D3      LDD	R13,Z+19
(1557) 			mem_set(dir, 0, SZ_DIR);	/* Clean the entry */
    01798 E280      LDI	R24,0x20
    01799 E090      LDI	R25,0
    0179A 8399      STD	Y+1,R25
    0179B 8388      ST	Y,R24
    0179C 2722      CLR	R18
    0179D 2733      CLR	R19
    0179E 0186      MOVW	R16,R12
    0179F 940E 0C4F CALL	ff.c:mem_set
(1558) 			mem_cpy(dir, dj->fn, 11);	/* Put SFN */
    017A1 E08B      LDI	R24,0xB
    017A2 E090      LDI	R25,0
    017A3 8399      STD	Y+1,R25
    017A4 8388      ST	Y,R24
    017A5 01FA      MOVW	R30,R20
    017A6 8924      LDD	R18,Z+20
    017A7 8935      LDD	R19,Z+21
    017A8 0186      MOVW	R16,R12
    017A9 940E 0C39 CALL	ff.c:mem_cpy
(1559) #if _USE_LFN
(1560) 			dir[DIR_NTres] = *(dj->fn+NS) & (NS_BODY | NS_EXT);	/* Put NT flag */
(1561) #endif
(1562) 			dj->fs->wflag = 1;
    017AB E081      LDI	R24,1
    017AC 01FA      MOVW	R30,R20
    017AD 93AF      PUSH	R26
    017AE 93BF      PUSH	R27
    017AF 81A0      LD	R26,Z
    017B0 81B1      LDD	R27,Z+1
    017B1 01FD      MOVW	R30,R26
    017B2 91BF      POP	R27
    017B3 91AF      POP	R26
    017B4 8384      STD	Z+4,R24
(1563) 		}
(1564) 	}
(1565) 
(1566) 	return res;
    017B5 2D0A      MOV	R16,R10
    017B6 9622      ADIW	R28,2
    017B7 940C 4B61 JMP	pop_xgsetF03C
ff.c:create_name:
  si                   --> R22
  b                    --> Y,+8
  sfn                  --> Y,+6
  ni                   --> R12
  d                    --> R10
  i                    --> Y,+4
  p                    --> Y,+2
  c                    --> R20
  path                 --> Y,+19
  dj                   --> R20
    017B9 933A      ST	-Y,R19
    017BA 932A      ST	-Y,R18
    017BB 940E 4B1D CALL	push_xgsetF0FC
    017BD 01A8      MOVW	R20,R16
    017BE 9729      SBIW	R28,0x9
(1567) }
(1568) #endif /* !_FS_READONLY */
(1569) 
(1570) 
(1571) 
(1572) 
(1573) /*-----------------------------------------------------------------------*/
(1574) /* Remove an object from the directory                                   */
(1575) /*-----------------------------------------------------------------------*/
(1576) #if !_FS_READONLY && !_FS_MINIMIZE
(1577) static
(1578) FRESULT dir_remove (	/* FR_OK: Successful, FR_DISK_ERR: A disk error */
(1579) 	DIR *dj				/* Directory object pointing the entry to be removed */
(1580) )
(1581) {
(1582) 	FRESULT res;
(1583) #if _USE_LFN	/* LFN configuration */
(1584) 	WORD i;
(1585) 
(1586) 	i = dj->index;	/* SFN index */
(1587) 	res = dir_sdi(dj, (WORD)((dj->lfn_idx == 0xFFFF) ? i : dj->lfn_idx));	/* Goto the SFN or top of the LFN entries */
(1588) 	if (res == FR_OK) {
(1589) 		do {
(1590) 			res = move_window(dj->fs, dj->sect);
(1591) 			if (res != FR_OK) break;
(1592) 			*dj->dir = DDE;			/* Mark the entry "deleted" */
(1593) 			dj->fs->wflag = 1;
(1594) 			if (dj->index >= i) break;	/* When reached SFN, all entries of the object has been deleted. */
(1595) 			res = dir_next(dj, 0);		/* Next entry */
(1596) 		} while (res == FR_OK);
(1597) 		if (res == FR_NO_FILE) res = FR_INT_ERR;
(1598) 	}
(1599) 
(1600) #else			/* Non LFN configuration */
(1601) 	res = dir_sdi(dj, dj->index);
(1602) 	if (res == FR_OK) {
(1603) 		res = move_window(dj->fs, dj->sect);
(1604) 		if (res == FR_OK) {
(1605) 			*dj->dir = DDE;			/* Mark the entry "deleted" */
(1606) 			dj->fs->wflag = 1;
(1607) 		}
(1608) 	}
(1609) #endif
(1610) 
(1611) 	return res;
(1612) }
(1613) #endif /* !_FS_READONLY */
(1614) 
(1615) 
(1616) 
(1617) 
(1618) /*-----------------------------------------------------------------------*/
(1619) /* Pick a segment and create the object name in directory form           */
(1620) /*-----------------------------------------------------------------------*/
(1621) 
(1622) static
(1623) FRESULT create_name (
(1624) 	DIR *dj,			/* Pointer to the directory object */
(1625) 	const TCHAR **path	/* Pointer to pointer to the segment in the path string */
(1626) )
(1627) {
(1628) #ifdef _EXCVT
(1629) 	static const BYTE excvt[] = _EXCVT;	/* Upper conversion table for extended chars */
(1630) #endif
(1631) 
(1632) #if _USE_LFN	/* LFN configuration */
(1633) 	BYTE b, cf;
(1634) 	WCHAR w, *lfn;
(1635) 	UINT i, ni, si, di;
(1636) 	const TCHAR *p;
(1637) 
(1638) 	/* Create LFN in Unicode */
(1639) 	for (p = *path; *p == '/' || *p == '\\'; p++) ;	/* Strip duplicated separator */
(1640) 	lfn = dj->lfn;
(1641) 	si = di = 0;
(1642) 	for (;;) {
(1643) 		w = p[si++];					/* Get a character */
(1644) 		if (w < ' ' || w == '/' || w == '\\') break;	/* Break on end of segment */
(1645) 		if (di >= _MAX_LFN)				/* Reject too long name */
(1646) 			return FR_INVALID_NAME;
(1647) #if !_LFN_UNICODE
(1648) 		w &= 0xFF;
(1649) 		if (IsDBCS1(w)) {				/* Check if it is a DBC 1st byte (always false on SBCS cfg) */
(1650) 			b = (BYTE)p[si++];			/* Get 2nd byte */
(1651) 			if (!IsDBCS2(b))
(1652) 				return FR_INVALID_NAME;	/* Reject invalid sequence */
(1653) 			w = (w << 8) + b;			/* Create a DBC */
(1654) 		}
(1655) 		w = ff_convert(w, 1);			/* Convert ANSI/OEM to Unicode */
(1656) 		if (!w) return FR_INVALID_NAME;	/* Reject invalid code */
(1657) #endif
(1658) 		if (w < 0x80 && chk_chr("\"*:<>\?|\x7F", w)) /* Reject illegal chars for LFN */
(1659) 			return FR_INVALID_NAME;
(1660) 		lfn[di++] = w;					/* Store the Unicode char */
(1661) 	}
(1662) 	*path = &p[si];						/* Return pointer to the next segment */
(1663) 	cf = (w < ' ') ? NS_LAST : 0;		/* Set last segment flag if end of path */
(1664) #if _FS_RPATH
(1665) 	if ((di == 1 && lfn[di-1] == '.') || /* Is this a dot entry? */
(1666) 		(di == 2 && lfn[di-1] == '.' && lfn[di-2] == '.')) {
(1667) 		lfn[di] = 0;
(1668) 		for (i = 0; i < 11; i++)
(1669) 			dj->fn[i] = (i < di) ? '.' : ' ';
(1670) 		dj->fn[i] = cf | NS_DOT;		/* This is a dot entry */
(1671) 		return FR_OK;
(1672) 	}
(1673) #endif
(1674) 	while (di) {						/* Strip trailing spaces and dots */
(1675) 		w = lfn[di-1];
(1676) 		if (w != ' ' && w != '.') break;
(1677) 		di--;
(1678) 	}
(1679) 	if (!di) return FR_INVALID_NAME;	/* Reject nul string */
(1680) 
(1681) 	lfn[di] = 0;						/* LFN is created */
(1682) 
(1683) 	/* Create SFN in directory form */
(1684) 	mem_set(dj->fn, ' ', 11);
(1685) 	for (si = 0; lfn[si] == ' ' || lfn[si] == '.'; si++) ;	/* Strip leading spaces and dots */
(1686) 	if (si) cf |= NS_LOSS | NS_LFN;
(1687) 	while (di && lfn[di - 1] != '.') di--;	/* Find extension (di<=si: no extension) */
(1688) 
(1689) 	b = i = 0; ni = 8;
(1690) 	for (;;) {
(1691) 		w = lfn[si++];					/* Get an LFN char */
(1692) 		if (!w) break;					/* Break on end of the LFN */
(1693) 		if (w == ' ' || (w == '.' && si != di)) {	/* Remove spaces and dots */
(1694) 			cf |= NS_LOSS | NS_LFN; continue;
(1695) 		}
(1696) 
(1697) 		if (i >= ni || si == di) {		/* Extension or end of SFN */
(1698) 			if (ni == 11) {				/* Long extension */
(1699) 				cf |= NS_LOSS | NS_LFN; break;
(1700) 			}
(1701) 			if (si != di) cf |= NS_LOSS | NS_LFN;	/* Out of 8.3 format */
(1702) 			if (si > di) break;			/* No extension */
(1703) 			si = di; i = 8; ni = 11;	/* Enter extension section */
(1704) 			b <<= 2; continue;
(1705) 		}
(1706) 
(1707) 		if (w >= 0x80) {				/* Non ASCII char */
(1708) #ifdef _EXCVT
(1709) 			w = ff_convert(w, 0);		/* Unicode -> OEM code */
(1710) 			if (w) w = excvt[w - 0x80];	/* Convert extended char to upper (SBCS) */
(1711) #else
(1712) 			w = ff_convert(ff_wtoupper(w), 0);	/* Upper converted Unicode -> OEM code */
(1713) #endif
(1714) 			cf |= NS_LFN;				/* Force create LFN entry */
(1715) 		}
(1716) 
(1717) 		if (_DF1S && w >= 0x100) {		/* Double byte char (always false on SBCS cfg) */
(1718) 			if (i >= ni - 1) {
(1719) 				cf |= NS_LOSS | NS_LFN; i = ni; continue;
(1720) 			}
(1721) 			dj->fn[i++] = (BYTE)(w >> 8);
(1722) 		} else {						/* Single byte char */
(1723) 			if (!w || chk_chr("+,;=[]", w)) {	/* Replace illegal chars for SFN */
(1724) 				w = '_'; cf |= NS_LOSS | NS_LFN;/* Lossy conversion */
(1725) 			} else {
(1726) 				if (IsUpper(w)) {		/* ASCII large capital */
(1727) 					b |= 2;
(1728) 				} else {
(1729) 					if (IsLower(w)) {	/* ASCII small capital */
(1730) 						b |= 1; w -= 0x20;
(1731) 					}
(1732) 				}
(1733) 			}
(1734) 		}
(1735) 		dj->fn[i++] = (BYTE)w;
(1736) 	}
(1737) 
(1738) 	if (dj->fn[0] == DDE) dj->fn[0] = NDDE;	/* If the first char collides with deleted mark, replace it with 0x05 */
(1739) 
(1740) 	if (ni == 8) b <<= 2;
(1741) 	if ((b & 0x0C) == 0x0C || (b & 0x03) == 0x03)	/* Create LFN entry when there are composite capitals */
(1742) 		cf |= NS_LFN;
(1743) 	if (!(cf & NS_LFN)) {						/* When LFN is in 8.3 format without extended char, NT flags are created */
(1744) 		if ((b & 0x03) == 0x01) cf |= NS_EXT;	/* NT flag (Extension has only small capital) */
(1745) 		if ((b & 0x0C) == 0x04) cf |= NS_BODY;	/* NT flag (Filename has only small capital) */
(1746) 	}
(1747) 
(1748) 	dj->fn[NS] = cf;	/* SFN is created */
(1749) 
(1750) 	return FR_OK;
(1751) 
(1752) 
(1753) #else	/* Non-LFN configuration */
(1754) 	BYTE b, c, d, *sfn;
(1755) 	UINT ni, si, i;
(1756) 	const char *p;
(1757) 
(1758) 	/* Create file name in directory form */
(1759) 	for (p = *path; *p == '/' || *p == '\\'; p++) ;	/* Strip duplicated separator */
    017BF 89EB      LDD	R30,Y+19
    017C0 89FC      LDD	R31,Y+20
    017C1 8020      LD	R2,Z
    017C2 8031      LDD	R3,Z+1
    017C3 823B      STD	Y+3,R3
    017C4 822A      STD	Y+2,R2
    017C5 C005      RJMP	0x17CB
    017C6 818A      LDD	R24,Y+2
    017C7 819B      LDD	R25,Y+3
    017C8 9601      ADIW	R24,1
    017C9 839B      STD	Y+3,R25
    017CA 838A      STD	Y+2,R24
    017CB 81EA      LDD	R30,Y+2
    017CC 81FB      LDD	R31,Y+3
    017CD 8020      LD	R2,Z
    017CE 2433      CLR	R3
    017CF 2D82      MOV	R24,R2
    017D0 328F      CPI	R24,0x2F
    017D1 F3A1      BEQ	0x17C6
    017D2 358C      CPI	R24,0x5C
    017D3 F391      BEQ	0x17C6
(1760) 	sfn = dj->fn;
    017D4 01FA      MOVW	R30,R20
    017D5 8824      LDD	R2,Z+20
    017D6 8835      LDD	R3,Z+21
    017D7 823F      STD	Y+7,R3
    017D8 822E      STD	Y+6,R2
(1761) 	mem_set(sfn, ' ', 11);
    017D9 E08B      LDI	R24,0xB
    017DA E090      LDI	R25,0
    017DB 8399      STD	Y+1,R25
    017DC 8388      ST	Y,R24
    017DD E220      LDI	R18,0x20
    017DE E030      LDI	R19,0
    017DF 0181      MOVW	R16,R2
    017E0 940E 0C4F CALL	ff.c:mem_set
(1762) 	si = i = b = 0; ni = 8;
    017E2 2400      CLR	R0
    017E3 8608      STD	Y+8,R0
    017E4 2422      CLR	R2
    017E5 2433      CLR	R3
    017E6 823D      STD	Y+5,R3
    017E7 822C      STD	Y+4,R2
    017E8 01B1      MOVW	R22,R2
    017E9 E088      LDI	R24,0x8
    017EA E090      LDI	R25,0
    017EB 016C      MOVW	R12,R24
(1763) #if _FS_RPATH
(1764) 	if (p[si] == '.') { /* Is this a dot entry? */
(1765) 		for (;;) {
(1766) 			c = (BYTE)p[si++];
(1767) 			if (c != '.' || si >= 3) break;
(1768) 			sfn[i++] = c;
(1769) 		}
(1770) 		if (c != '/' && c != '\\' && c > ' ') return FR_INVALID_NAME;
(1771) 		*path = &p[si];									/* Return pointer to the next segment */
(1772) 		sfn[NS] = (c <= ' ') ? NS_LAST | NS_DOT : NS_DOT;	/* Set last segment flag if end of path */
(1773) 		return FR_OK;
(1774) 	}
(1775) #endif
(1776) 	for (;;) {
(1777) 		c = (BYTE)p[si++];
    017EC 01AB      MOVW	R20,R22
    017ED 5F6F      SUBI	R22,0xFF
    017EE 4F7F      SBCI	R23,0xFF
    017EF 01FA      MOVW	R30,R20
    017F0 800A      LDD	R0,Y+2
    017F1 801B      LDD	R1,Y+3
    017F2 0DE0      ADD	R30,R0
    017F3 1DF1      ADC	R31,R1
    017F4 8140      LD	R20,Z
(1778) 		if (c <= ' ' || c == '/' || c == '\\') break;	/* Break on end of segment */
    017F5 E280      LDI	R24,0x20
    017F6 1784      CP	R24,R20
    017F7 F420      BCC	0x17FC
    017F8 324F      CPI	R20,0x2F
    017F9 F011      BEQ	0x17FC
    017FA 354C      CPI	R20,0x5C
    017FB F409      BNE	0x17FD
    017FC C087      RJMP	0x1884
(1779) 		if (c == '.' || i >= ni) {
    017FD 324E      CPI	R20,0x2E
    017FE F029      BEQ	0x1804
    017FF 800C      LDD	R0,Y+4
    01800 801D      LDD	R1,Y+5
    01801 140C      CP	R0,R12
    01802 041D      CPC	R1,R13
    01803 F0A0      BCS	0x1818
(1780) 			if (ni != 8 || c != '.') return FR_INVALID_NAME;
    01804 01C6      MOVW	R24,R12
    01805 3088      CPI	R24,0x8
    01806 E0E0      LDI	R30,0
    01807 079E      CPC	R25,R30
    01808 F411      BNE	0x180B
    01809 324E      CPI	R20,0x2E
    0180A F011      BEQ	0x180D
    0180B E006      LDI	R16,6
    0180C C0AF      RJMP	0x18BC
(1781) 			i = 8; ni = 11;
    0180D E088      LDI	R24,0x8
    0180E E090      LDI	R25,0
    0180F 839D      STD	Y+5,R25
    01810 838C      STD	Y+4,R24
    01811 E08B      LDI	R24,0xB
    01812 016C      MOVW	R12,R24
(1782) 			b <<= 2; continue;
    01813 8408      LDD	R0,Y+8
    01814 0C00      LSL	R0
    01815 0C00      LSL	R0
    01816 8608      STD	Y+8,R0
    01817 CFD4      RJMP	0x17EC
(1783) 		}
(1784) 		if (c >= 0x80) {				/* Extended char? */
    01818 3840      CPI	R20,0x80
    01819 F018      BCS	0x181D
(1785) 			b |= 3;						/* Eliminate NT flag */
    0181A 8588      LDD	R24,Y+8
    0181B 6083      ORI	R24,3
    0181C 8788      STD	Y+8,R24
(1786) #ifdef _EXCVT
(1787) 			c = excvt[c-0x80];			/* Upper conversion (SBCS) */
(1788) #else
(1789) #if !_DF1S	/* ASCII only cfg */
(1790) 			return FR_INVALID_NAME;
(1791) #endif
(1792) #endif
(1793) 		}
(1794) 		if (IsDBCS1(c)) {				/* Check if it is a DBC 1st byte (always false on SBCS cfg) */
    0181D 3841      CPI	R20,0x81
    0181E F408      BCC	0x1820
    0181F C039      RJMP	0x1859
    01820 EF8E      LDI	R24,0xFE
    01821 1784      CP	R24,R20
    01822 F408      BCC	0x1824
    01823 C035      RJMP	0x1859
(1795) 			d = (BYTE)p[si++];			/* Get 2nd byte */
    01824 015B      MOVW	R10,R22
    01825 5F6F      SUBI	R22,0xFF
    01826 4F7F      SBCI	R23,0xFF
    01827 01F5      MOVW	R30,R10
    01828 800A      LDD	R0,Y+2
    01829 801B      LDD	R1,Y+3
    0182A 0DE0      ADD	R30,R0
    0182B 1DF1      ADC	R31,R1
    0182C 80A0      LD	R10,Z
(1796) 			if (!IsDBCS2(d) || i >= ni - 1)	/* Reject invalid DBC */
    0182D 2D8A      MOV	R24,R10
    0182E 3480      CPI	R24,0x40
    0182F F018      BCS	0x1833
    01830 E78E      LDI	R24,0x7E
    01831 158A      CP	R24,R10
    01832 F430      BCC	0x1839
    01833 2D8A      MOV	R24,R10
    01834 3880      CPI	R24,0x80
    01835 F050      BCS	0x1840
    01836 EF8E      LDI	R24,0xFE
    01837 158A      CP	R24,R10
    01838 F038      BCS	0x1840
    01839 01C6      MOVW	R24,R12
    0183A 9701      SBIW	R24,1
    0183B 800C      LDD	R0,Y+4
    0183C 801D      LDD	R1,Y+5
    0183D 1608      CP	R0,R24
    0183E 0619      CPC	R1,R25
    0183F F010      BCS	0x1842
(1797) 				return FR_INVALID_NAME;
    01840 E006      LDI	R16,6
    01841 C07A      RJMP	0x18BC
(1798) 			sfn[i++] = c;
    01842 80EC      LDD	R14,Y+4
    01843 80FD      LDD	R15,Y+5
    01844 01C7      MOVW	R24,R14
    01845 9601      ADIW	R24,1
    01846 839D      STD	Y+5,R25
    01847 838C      STD	Y+4,R24
    01848 01F7      MOVW	R30,R14
    01849 800E      LDD	R0,Y+6
    0184A 801F      LDD	R1,Y+7
    0184B 0DE0      ADD	R30,R0
    0184C 1DF1      ADC	R31,R1
    0184D 8340      ST	Z,R20
(1799) 			sfn[i++] = d;
    0184E 017C      MOVW	R14,R24
    0184F 9601      ADIW	R24,1
    01850 839D      STD	Y+5,R25
    01851 838C      STD	Y+4,R24
    01852 01F7      MOVW	R30,R14
    01853 800E      LDD	R0,Y+6
    01854 801F      LDD	R1,Y+7
    01855 0DE0      ADD	R30,R0
    01856 1DF1      ADC	R31,R1
    01857 82A0      ST	Z,R10
(1800) 		} else {						/* Single byte code */
    01858 CF93      RJMP	0x17EC
(1801) 			if (chk_chr("\"*+,:;<=>\?[]|\x7F", c))	/* Reject illegal chrs for SFN */
    01859 2F24      MOV	R18,R20
    0185A 2733      CLR	R19
    0185B E707      LDI	R16,0x77
    0185C E012      LDI	R17,2
    0185D 940E 0C82 CALL	ff.c:chk_chr
    0185F 0158      MOVW	R10,R16
    01860 3000      CPI	R16,0
    01861 0701      CPC	R16,R17
    01862 F011      BEQ	0x1865
(1802) 				return FR_INVALID_NAME;
    01863 E006      LDI	R16,6
    01864 C057      RJMP	0x18BC
(1803) 			if (IsUpper(c)) {			/* ASCII large capital? */
    01865 3441      CPI	R20,0x41
    01866 F038      BCS	0x186E
    01867 E58A      LDI	R24,0x5A
    01868 1784      CP	R24,R20
    01869 F020      BCS	0x186E
(1804) 				b |= 2;
    0186A 8588      LDD	R24,Y+8
    0186B 6082      ORI	R24,2
    0186C 8788      STD	Y+8,R24
(1805) 			} else {
    0186D C009      RJMP	0x1877
(1806) 				if (IsLower(c)) {		/* ASCII small capital? */
    0186E 3641      CPI	R20,0x61
    0186F F038      BCS	0x1877
    01870 E78A      LDI	R24,0x7A
    01871 1784      CP	R24,R20
    01872 F020      BCS	0x1877
(1807) 					b |= 1; c -= 0x20;
    01873 8588      LDD	R24,Y+8
    01874 6081      ORI	R24,1
    01875 8788      STD	Y+8,R24
    01876 5240      SUBI	R20,0x20
(1808) 				}
(1809) 			}
(1810) 			sfn[i++] = c;
    01877 80AC      LDD	R10,Y+4
    01878 80BD      LDD	R11,Y+5
    01879 01C5      MOVW	R24,R10
    0187A 9601      ADIW	R24,1
    0187B 839D      STD	Y+5,R25
    0187C 838C      STD	Y+4,R24
    0187D 01F5      MOVW	R30,R10
    0187E 800E      LDD	R0,Y+6
    0187F 801F      LDD	R1,Y+7
    01880 0DE0      ADD	R30,R0
    01881 1DF1      ADC	R31,R1
    01882 8340      ST	Z,R20
    01883 CF68      RJMP	0x17EC
(1811) 		}
(1812) 	}
(1813) 	*path = &p[si];						/* Return pointer to the next segment */
    01884 011B      MOVW	R2,R22
    01885 800A      LDD	R0,Y+2
    01886 801B      LDD	R1,Y+3
    01887 0C20      ADD	R2,R0
    01888 1C31      ADC	R3,R1
    01889 89EB      LDD	R30,Y+19
    0188A 89FC      LDD	R31,Y+20
    0188B 8231      STD	Z+1,R3
    0188C 8220      ST	Z,R2
(1814) 	c = (c <= ' ') ? NS_LAST : 0;		/* Set last segment flag if end of path */
    0188D E280      LDI	R24,0x20
    0188E 1784      CP	R24,R20
    0188F F018      BCS	0x1893
    01890 E064      LDI	R22,4
    01891 E070      LDI	R23,0
    01892 C002      RJMP	0x1895
    01893 2766      CLR	R22
    01894 2777      CLR	R23
    01895 2F46      MOV	R20,R22
(1815) 
(1816) 	if (!i) return FR_INVALID_NAME;		/* Reject nul string */
    01896 800C      LDD	R0,Y+4
    01897 801D      LDD	R1,Y+5
    01898 2000      TST	R0
    01899 F421      BNE	0x189E
    0189A 2011      TST	R1
    0189B F411      BNE	0x189E
    0189C E006      LDI	R16,6
    0189D C01E      RJMP	0x18BC
(1817) 	if (sfn[0] == DDE) sfn[0] = NDDE;	/* When first char collides with DDE, replace it with 0x05 */
    0189E 81EE      LDD	R30,Y+6
    0189F 81FF      LDD	R31,Y+7
    018A0 8180      LD	R24,Z
    018A1 3E85      CPI	R24,0xE5
    018A2 F411      BNE	0x18A5
    018A3 E085      LDI	R24,5
    018A4 8380      ST	Z,R24
(1818) 
(1819) 	if (ni == 8) b <<= 2;
    018A5 01C6      MOVW	R24,R12
    018A6 3088      CPI	R24,0x8
    018A7 E0E0      LDI	R30,0
    018A8 079E      CPC	R25,R30
    018A9 F421      BNE	0x18AE
    018AA 8408      LDD	R0,Y+8
    018AB 0C00      LSL	R0
    018AC 0C00      LSL	R0
    018AD 8608      STD	Y+8,R0
(1820) 	if ((b & 0x03) == 0x01) c |= NS_EXT;	/* NT flag (Name extension has only small capital) */
    018AE 8588      LDD	R24,Y+8
    018AF 7083      ANDI	R24,3
    018B0 3081      CPI	R24,1
    018B1 F409      BNE	0x18B3
    018B2 6140      ORI	R20,0x10
(1821) 	if ((b & 0x0C) == 0x04) c |= NS_BODY;	/* NT flag (Name body has only small capital) */
    018B3 8588      LDD	R24,Y+8
    018B4 708C      ANDI	R24,0xC
    018B5 3084      CPI	R24,4
    018B6 F409      BNE	0x18B8
    018B7 6048      ORI	R20,0x8
(1822) 
(1823) 	sfn[NS] = c;		/* Store NT flag, File name is created */
    018B8 81EE      LDD	R30,Y+6
    018B9 81FF      LDD	R31,Y+7
    018BA 8743      STD	Z+11,R20
(1824) 
(1825) 	return FR_OK;
    018BB 2700      CLR	R16
    018BC 9629      ADIW	R28,0x9
    018BD 940E 4B12 CALL	pop_xgsetF0FC
    018BF 9622      ADIW	R28,2
    018C0 9508      RET
ff.c:get_fileinfo:
  nt                   --> R12
  p                    --> R20
  dir                  --> R10
  i                    --> R12
  c                    --> R14
  fno                  --> R22
  dj                   --> R10
    018C1 940E 4B1D CALL	push_xgsetF0FC
    018C3 01B9      MOVW	R22,R18
    018C4 0158      MOVW	R10,R16
(1826) #endif
(1827) }
(1828) 
(1829) 
(1830) 
(1831) 
(1832) /*-----------------------------------------------------------------------*/
(1833) /* Get file information from directory entry                             */
(1834) /*-----------------------------------------------------------------------*/
(1835) #if _FS_MINIMIZE <= 1
(1836) static
(1837) void get_fileinfo (		/* No return code */
(1838) 	DIR *dj,			/* Pointer to the directory object */
(1839) 	FILINFO *fno	 	/* Pointer to the file information to be filled */
(1840) )
(1841) {
(1842) 	UINT i;
(1843) 	BYTE nt, *dir;
(1844) 	TCHAR *p, c;
(1845) 
(1846) 
(1847) 	p = fno->fname;
    018C5 01AB      MOVW	R20,R22
    018C6 5F47      SUBI	R20,0xF7
    018C7 4F5F      SBCI	R21,0xFF
(1848) 	if (dj->sect) {
    018C8 01F5      MOVW	R30,R10
    018C9 963E      ADIW	R30,0xE
    018CA 8020      LD	R2,Z
    018CB 8031      LDD	R3,Z+1
    018CC 8042      LDD	R4,Z+2
    018CD 8053      LDD	R5,Z+3
    018CE 9488      BCLR	0
    018CF 2022      TST	R2
    018D0 0432      CPC	R3,R2
    018D1 0442      CPC	R4,R2
    018D2 0452      CPC	R5,R2
    018D3 F409      BNE	0x18D5
    018D4 C08A      RJMP	0x195F
(1849) 		dir = dj->dir;
    018D5 01F5      MOVW	R30,R10
    018D6 88A2      LDD	R10,Z+18
    018D7 88B3      LDD	R11,Z+19
(1850) 		nt = dir[DIR_NTres];		/* NT flag */
(1851) 		for (i = 0; i < 8; i++) {	/* Copy name body */
    018D8 24CC      CLR	R12
    018D9 24DD      CLR	R13
    018DA C014      RJMP	0x18EF
(1852) 			c = dir[i];
    018DB 01F6      MOVW	R30,R12
    018DC 0DEA      ADD	R30,R10
    018DD 1DFB      ADC	R31,R11
    018DE 80E0      LD	R14,Z
(1853) 			if (c == ' ') break;
    018DF 2D8E      MOV	R24,R14
    018E0 3280      CPI	R24,0x20
    018E1 F409      BNE	0x18E3
    018E2 C011      RJMP	0x18F4
(1854) 			if (c == NDDE) c = (TCHAR)DDE;
    018E3 2D8E      MOV	R24,R14
    018E4 3085      CPI	R24,5
    018E5 F411      BNE	0x18E8
    018E6 EE85      LDI	R24,0xE5
    018E7 2EE8      MOV	R14,R24
(1855) 			if (_USE_LFN && (nt & NS_BODY) && IsUpper(c)) c += 0x20;
    018E8 C000      RJMP	0x18E9
(1856) #if _LFN_UNICODE
(1857) 			if (IsDBCS1(c) && i < 7 && IsDBCS2(dir[i+1]))
(1858) 				c = (c << 8) | dir[++i];
(1859) 			c = ff_convert(c, 1);
(1860) 			if (!c) c = '?';
(1861) #endif
(1862) 			*p++ = c;
    018E9 01FA      MOVW	R30,R20
    018EA 92E1      ST	Z+,R14
    018EB 01AF      MOVW	R20,R30
    018EC 01C6      MOVW	R24,R12
    018ED 9601      ADIW	R24,1
    018EE 016C      MOVW	R12,R24
    018EF 01C6      MOVW	R24,R12
    018F0 3088      CPI	R24,0x8
    018F1 E0E0      LDI	R30,0
    018F2 079E      CPC	R25,R30
    018F3 F338      BCS	0x18DB
(1863) 		}
(1864) 		if (dir[8] != ' ') {		/* Copy name extension */
    018F4 01F5      MOVW	R30,R10
    018F5 8580      LDD	R24,Z+8
    018F6 3280      CPI	R24,0x20
    018F7 F0E1      BEQ	0x1914
(1865) 			*p++ = '.';
    018F8 E28E      LDI	R24,0x2E
    018F9 01FA      MOVW	R30,R20
    018FA 9381      ST	Z+,R24
    018FB 01AF      MOVW	R20,R30
(1866) 			for (i = 8; i < 11; i++) {
    018FC E088      LDI	R24,0x8
    018FD E090      LDI	R25,0
    018FE 016C      MOVW	R12,R24
    018FF C00F      RJMP	0x190F
(1867) 				c = dir[i];
    01900 01F6      MOVW	R30,R12
    01901 0DEA      ADD	R30,R10
    01902 1DFB      ADC	R31,R11
    01903 80E0      LD	R14,Z
(1868) 				if (c == ' ') break;
    01904 2D8E      MOV	R24,R14
    01905 3280      CPI	R24,0x20
    01906 F409      BNE	0x1908
    01907 C00C      RJMP	0x1914
(1869) 				if (_USE_LFN && (nt & NS_EXT) && IsUpper(c)) c += 0x20;
    01908 C000      RJMP	0x1909
(1870) #if _LFN_UNICODE
(1871) 				if (IsDBCS1(c) && i < 10 && IsDBCS2(dir[i+1]))
(1872) 					c = (c << 8) | dir[++i];
(1873) 				c = ff_convert(c, 1);
(1874) 				if (!c) c = '?';
(1875) #endif
(1876) 				*p++ = c;
    01909 01FA      MOVW	R30,R20
    0190A 92E1      ST	Z+,R14
    0190B 01AF      MOVW	R20,R30
    0190C 01C6      MOVW	R24,R12
    0190D 9601      ADIW	R24,1
    0190E 016C      MOVW	R12,R24
    0190F 01C6      MOVW	R24,R12
    01910 308B      CPI	R24,0xB
    01911 E0E0      LDI	R30,0
    01912 079E      CPC	R25,R30
    01913 F360      BCS	0x1900
(1877) 			}
(1878) 		}
(1879) 		fno->fattrib = dir[DIR_Attr];				/* Attribute */
    01914 01F5      MOVW	R30,R10
    01915 8423      LDD	R2,Z+11
    01916 01FB      MOVW	R30,R22
    01917 8620      STD	Z+8,R2
(1880) 		fno->fsize = LD_DWORD(dir+DIR_FileSize);	/* Size */
    01918 E188      LDI	R24,0x18
    01919 E090      LDI	R25,0
    0191A 01F5      MOVW	R30,R10
    0191B 8D07      LDD	R16,Z+31
    0191C 2711      CLR	R17
    0191D 2722      CLR	R18
    0191E 2733      CLR	R19
    0191F 938A      ST	-Y,R24
    01920 940E 4BA8 CALL	lsl32
    01922 0118      MOVW	R2,R16
    01923 0129      MOVW	R4,R18
    01924 01F5      MOVW	R30,R10
    01925 8C66      LDD	R6,Z+30
    01926 2477      CLR	R7
    01927 2488      CLR	R8
    01928 2499      CLR	R9
    01929 0143      MOVW	R8,R6
    0192A 2466      CLR	R6
    0192B 2477      CLR	R7
    0192C 2826      OR	R2,R6
    0192D 2837      OR	R3,R7
    0192E 2848      OR	R4,R8
    0192F 2859      OR	R5,R9
    01930 8C65      LDD	R6,Z+29
    01931 2477      CLR	R7
    01932 2C76      MOV	R7,R6
    01933 2466      CLR	R6
    01934 2488      CLR	R8
    01935 2499      CLR	R9
    01936 2826      OR	R2,R6
    01937 2837      OR	R3,R7
    01938 2848      OR	R4,R8
    01939 2859      OR	R5,R9
    0193A 8C64      LDD	R6,Z+28
    0193B 2477      CLR	R7
    0193C 2488      CLR	R8
    0193D 2499      CLR	R9
    0193E 2826      OR	R2,R6
    0193F 2837      OR	R3,R7
    01940 2848      OR	R4,R8
    01941 2859      OR	R5,R9
    01942 01FB      MOVW	R30,R22
    01943 8220      ST	Z,R2
    01944 8231      STD	Z+1,R3
    01945 8242      STD	Z+2,R4
    01946 8253      STD	Z+3,R5
(1881) 		fno->fdate = LD_WORD(dir+DIR_WrtDate);		/* Date */
    01947 01F5      MOVW	R30,R10
    01948 8C20      LDD	R2,Z+24
    01949 2433      CLR	R3
    0194A 8C41      LDD	R4,Z+25
    0194B 2455      CLR	R5
    0194C 2C54      MOV	R5,R4
    0194D 2444      CLR	R4
    0194E 2842      OR	R4,R2
    0194F 2853      OR	R5,R3
    01950 01FB      MOVW	R30,R22
    01951 8255      STD	Z+5,R5
    01952 8244      STD	Z+4,R4
(1882) 		fno->ftime = LD_WORD(dir+DIR_WrtTime);		/* Time */
    01953 01F5      MOVW	R30,R10
    01954 8826      LDD	R2,Z+22
    01955 2433      CLR	R3
    01956 8847      LDD	R4,Z+23
    01957 2455      CLR	R5
    01958 2C54      MOV	R5,R4
    01959 2444      CLR	R4
    0195A 2842      OR	R4,R2
    0195B 2853      OR	R5,R3
    0195C 01FB      MOVW	R30,R22
    0195D 8257      STD	Z+7,R5
    0195E 8246      STD	Z+6,R4
(1883) 	}
(1884) 	*p = 0;		/* Terminate SFN str by a \0 */
    0195F 2422      CLR	R2
    01960 01FA      MOVW	R30,R20
    01961 8220      ST	Z,R2
    01962 940C 4B12 JMP	pop_xgsetF0FC
ff.c:follow_path:
  ns                   --> R10
  res                  --> R20
  dir                  --> R10
  path                 --> Y,+6
  dj                   --> R22
    01964 933A      ST	-Y,R19
    01965 932A      ST	-Y,R18
    01966 940E 4B3C CALL	push_xgsetF00C
    01968 01B8      MOVW	R22,R16
(1885) 
(1886) #if _USE_LFN
(1887) 	if (fno->lfname && fno->lfsize) {
(1888) 		TCHAR *tp = fno->lfname;
(1889) 		WCHAR w, *lfn;
(1890) 
(1891) 		i = 0;
(1892) 		if (dj->sect && dj->lfn_idx != 0xFFFF) {/* Get LFN if available */
(1893) 			lfn = dj->lfn;
(1894) 			while ((w = *lfn++) != 0) {			/* Get an LFN char */
(1895) #if !_LFN_UNICODE
(1896) 				w = ff_convert(w, 0);			/* Unicode -> OEM conversion */
(1897) 				if (!w) { i = 0; break; }		/* Could not convert, no LFN */
(1898) 				if (_DF1S && w >= 0x100)		/* Put 1st byte if it is a DBC (always false on SBCS cfg) */
(1899) 					tp[i++] = (TCHAR)(w >> 8);
(1900) #endif
(1901) 				if (i >= fno->lfsize - 1) { i = 0; break; }	/* Buffer overflow, no LFN */
(1902) 				tp[i++] = (TCHAR)w;
(1903) 			}
(1904) 		}
(1905) 		tp[i] = 0;	/* Terminate the LFN str by a \0 */
(1906) 	}
(1907) #endif
(1908) }
(1909) #endif /* _FS_MINIMIZE <= 1 */
(1910) 
(1911) 
(1912) 
(1913) 
(1914) /*-----------------------------------------------------------------------*/
(1915) /* Follow a file path                                                    */
(1916) /*-----------------------------------------------------------------------*/
(1917) 
(1918) static
(1919) FRESULT follow_path (	/* FR_OK(0): successful, !=0: error code */
(1920) 	DIR *dj,			/* Directory object to return last directory and found object */
(1921) 	const TCHAR *path	/* Full-path string to find a file or directory */
(1922) )
(1923) {
(1924) 	FRESULT res;
(1925) 	BYTE *dir, ns;
(1926) 
(1927) 
(1928) #if _FS_RPATH
(1929) 	if (*path == '/' || *path == '\\') { /* There is a heading separator */
(1930) 		path++;	dj->sclust = 0;		/* Strip it and start from the root dir */
(1931) 	} else {							/* No heading separator */
(1932) 		dj->sclust = dj->fs->cdir;	/* Start from the current dir */
(1933) 	}
(1934) #else
(1935) 	if (*path == '/' || *path == '\\')	/* Strip heading separator if exist */
    01969 81EE      LDD	R30,Y+6
    0196A 81FF      LDD	R31,Y+7
    0196B 8020      LD	R2,Z
    0196C 2433      CLR	R3
    0196D 2D82      MOV	R24,R2
    0196E 328F      CPI	R24,0x2F
    0196F F011      BEQ	0x1972
    01970 358C      CPI	R24,0x5C
    01971 F429      BNE	0x1977
(1936) 		path++;
    01972 818E      LDD	R24,Y+6
    01973 819F      LDD	R25,Y+7
    01974 9601      ADIW	R24,1
    01975 839F      STD	Y+7,R25
    01976 838E      STD	Y+6,R24
(1937) 	dj->sclust = 0;						/* Start from the root dir */
    01977 01FB      MOVW	R30,R22
    01978 9636      ADIW	R30,6
    01979 E080      LDI	R24,0
    0197A 8380      ST	Z,R24
    0197B 8381      STD	Z+1,R24
    0197C 8382      STD	Z+2,R24
    0197D 8383      STD	Z+3,R24
(1938) #endif
(1939) 
(1940) 	if ((UINT)*path < ' ') {			/* Nul path means the start directory itself */
    0197E 81EE      LDD	R30,Y+6
    0197F 81FF      LDD	R31,Y+7
    01980 8180      LD	R24,Z
    01981 2799      CLR	R25
    01982 3280      CPI	R24,0x20
    01983 E0E0      LDI	R30,0
    01984 079E      CPC	R25,R30
    01985 F458      BCC	0x1991
(1941) 		res = dir_sdi(dj, 0);
    01986 2722      CLR	R18
    01987 2733      CLR	R19
    01988 018B      MOVW	R16,R22
    01989 DA84      RCALL	ff.c:dir_sdi
    0198A 2F40      MOV	R20,R16
(1942) 		dj->dir = 0;
    0198B 2422      CLR	R2
    0198C 2433      CLR	R3
    0198D 01FB      MOVW	R30,R22
    0198E 8A33      STD	Z+19,R3
    0198F 8A22      STD	Z+18,R2
(1943) 
(1944) 	} else {							/* Follow path */
    01990 C052      RJMP	0x19E3
(1945) 		for (;;) {
(1946) 			res = create_name(dj, &path);	/* Get a segment */
    01991 019E      MOVW	R18,R28
    01992 5F2A      SUBI	R18,0xFA
    01993 4F3F      SBCI	R19,0xFF
    01994 018B      MOVW	R16,R22
    01995 DE23      RCALL	ff.c:create_name
    01996 2EA0      MOV	R10,R16
    01997 2D4A      MOV	R20,R10
(1947) 			if (res != FR_OK) break;
    01998 2300      TST	R16
    01999 F009      BEQ	0x199B
    0199A C048      RJMP	0x19E3
(1948) 			res = dir_find(dj);				/* Find it */
    0199B 018B      MOVW	R16,R22
    0199C DD29      RCALL	ff.c:dir_find
    0199D 2EA0      MOV	R10,R16
    0199E 2D4A      MOV	R20,R10
(1949) 			ns = *(dj->fn+NS);
    0199F 01FB      MOVW	R30,R22
    019A0 93AF      PUSH	R26
    019A1 93BF      PUSH	R27
    019A2 89A4      LDD	R26,Z+20
    019A3 89B5      LDD	R27,Z+21
    019A4 01FD      MOVW	R30,R26
    019A5 91BF      POP	R27
    019A6 91AF      POP	R26
    019A7 84A3      LDD	R10,Z+11
(1950) 			if (res != FR_OK) {				/* Failed to find the object */
    019A8 2300      TST	R16
    019A9 F049      BEQ	0x19B3
(1951) 				if (res != FR_NO_FILE) break;	/* Abort if any hard error occured */
    019AA 3004      CPI	R16,4
    019AB F009      BEQ	0x19AD
    019AC C036      RJMP	0x19E3
(1952) 				/* Object not found */
(1953) 				if (_FS_RPATH && (ns & NS_DOT)) {	/* If dot entry is not exit */
    019AD C001      RJMP	0x19AF
(1954) 					dj->sclust = 0; dj->dir = 0;	/* It is the root dir */
(1955) 					res = FR_OK;
(1956) 					if (!(ns & NS_LAST)) continue;
    019AE CFE2      RJMP	0x1991
(1957) 				} else {							/* Could not find the object */
(1958) 					if (!(ns & NS_LAST)) res = FR_NO_PATH;
    019AF FCA2      SBRC	R10,2
    019B0 C032      RJMP	0x19E3
    019B1 E045      LDI	R20,5
(1959) 				}
(1960) 				break;
    019B2 C030      RJMP	0x19E3
(1961) 			}
(1962) 			if (ns & NS_LAST) break;			/* Last segment match. Function completed. */
    019B3 FEA2      SBRS	R10,2
    019B4 C001      RJMP	0x19B6
    019B5 C02D      RJMP	0x19E3
(1963) 			dir = dj->dir;						/* There is next segment. Follow the sub directory */
    019B6 01FB      MOVW	R30,R22
    019B7 88A2      LDD	R10,Z+18
    019B8 88B3      LDD	R11,Z+19
(1964) 			if (!(dir[DIR_Attr] & AM_DIR)) {	/* Cannot follow because it is a file */
    019B9 01F5      MOVW	R30,R10
    019BA 8423      LDD	R2,Z+11
    019BB FC24      SBRC	R2,4
    019BC C002      RJMP	0x19BF
(1965) 				res = FR_NO_PATH; break;
    019BD E045      LDI	R20,5
    019BE C024      RJMP	0x19E3
(1966) 			}
(1967) 			dj->sclust = LD_CLUST(dir);
    019BF 01F5      MOVW	R30,R10
    019C0 8C22      LDD	R2,Z+26
    019C1 2433      CLR	R3
    019C2 8C43      LDD	R4,Z+27
    019C3 2455      CLR	R5
    019C4 2C54      MOV	R5,R4
    019C5 2444      CLR	R4
    019C6 2842      OR	R4,R2
    019C7 2853      OR	R5,R3
    019C8 0112      MOVW	R2,R4
    019C9 2444      CLR	R4
    019CA 2455      CLR	R5
    019CB 8864      LDD	R6,Z+20
    019CC 2477      CLR	R7
    019CD 8885      LDD	R8,Z+21
    019CE 2499      CLR	R9
    019CF 2C98      MOV	R9,R8
    019D0 2488      CLR	R8
    019D1 2886      OR	R8,R6
    019D2 2897      OR	R9,R7
    019D3 0134      MOVW	R6,R8
    019D4 2488      CLR	R8
    019D5 2499      CLR	R9
    019D6 0143      MOVW	R8,R6
    019D7 2466      CLR	R6
    019D8 2477      CLR	R7
    019D9 2862      OR	R6,R2
    019DA 2873      OR	R7,R3
    019DB 2884      OR	R8,R4
    019DC 2895      OR	R9,R5
    019DD 01FB      MOVW	R30,R22
    019DE 8266      STD	Z+6,R6
    019DF 8277      STD	Z+7,R7
    019E0 8680      STD	Z+8,R8
    019E1 8691      STD	Z+9,R9
    019E2 CFAE      RJMP	0x1991
(1968) 		}
(1969) 	}
(1970) 
(1971) 	return res;
    019E3 2F04      MOV	R16,R20
    019E4 940E 4B43 CALL	pop_xgsetF00C
    019E6 9622      ADIW	R28,2
    019E7 9508      RET
ff.c:check_fs:
  sect                 --> Y,+11
  fs                   --> R10
    019E8 933A      ST	-Y,R19
    019E9 932A      ST	-Y,R18
    019EA 940E 4B3C CALL	push_xgsetF00C
    019EC 0158      MOVW	R10,R16
    019ED 9725      SBIW	R28,5
(1972) }
(1973) 
(1974) 
(1975) 
(1976) 
(1977) /*-----------------------------------------------------------------------*/
(1978) /* Load a sector and check if it is an FAT Volume Boot Record            */
(1979) /*-----------------------------------------------------------------------*/
(1980) 
(1981) static
(1982) BYTE check_fs (	/* 0:FAT-VBR, 1:Valid BR but not FAT, 2:Not a BR, 3:Disk error */
(1983) 	FATFS *fs,	/* File system object */
(1984) 	DWORD sect	/* Sector# (lba) to check if it is an FAT boot record or not */
(1985) )
(1986) {
(1987) 	if (disk_read(fs->drv, fs->win, sect, 1) != RES_OK)	/* Load boot record */
    019EE E081      LDI	R24,1
    019EF 838C      STD	Y+4,R24
    019F0 842B      LDD	R2,Y+11
    019F1 843C      LDD	R3,Y+12
    019F2 844D      LDD	R4,Y+13
    019F3 845E      LDD	R5,Y+14
    019F4 8228      ST	Y,R2
    019F5 8239      STD	Y+1,R3
    019F6 824A      STD	Y+2,R4
    019F7 825B      STD	Y+3,R5
    019F8 0195      MOVW	R18,R10
    019F9 5D22      SUBI	R18,0xD2
    019FA 4F3F      SBCI	R19,0xFF
    019FB 01F5      MOVW	R30,R10
    019FC 8101      LDD	R16,Z+1
    019FD 940E 0BF7 CALL	_disk_read
    019FF 2300      TST	R16
    01A00 F011      BEQ	0x1A03
(1988) 		return 3;
    01A01 E003      LDI	R16,3
    01A02 C0A8      RJMP	0x1AAB
(1989) 	if (LD_WORD(&fs->win[BS_55AA]) != 0xAA55)		/* Check record signature (always placed at offset 510 even if the sector size is >512) */
    01A03 01F5      MOVW	R30,R10
    01A04 5DE4      SUBI	R30,0xD4
    01A05 4FFD      SBCI	R31,0xFD
    01A06 8020      LD	R2,Z
    01A07 52EC      SUBI	R30,0x2C
    01A08 40F2      SBCI	R31,2
    01A09 2433      CLR	R3
    01A0A 5DE3      SUBI	R30,0xD3
    01A0B 4FFD      SBCI	R31,0xFD
    01A0C 8180      LD	R24,Z
    01A0D 2799      CLR	R25
    01A0E 2F98      MOV	R25,R24
    01A0F 2788      CLR	R24
    01A10 2982      OR	R24,R2
    01A11 2993      OR	R25,R3
    01A12 3585      CPI	R24,0x55
    01A13 EAEA      LDI	R30,0xAA
    01A14 079E      CPC	R25,R30
    01A15 F011      BEQ	0x1A18
(1990) 		return 2;
    01A16 E002      LDI	R16,2
    01A17 C093      RJMP	0x1AAB
(1991) 
(1992) 	if ((LD_DWORD(&fs->win[BS_FilSysType]) & 0xFFFFFF) == 0x544146)	/* Check "FAT" string */
    01A18 E188      LDI	R24,0x18
    01A19 E090      LDI	R25,0
    01A1A 01F5      MOVW	R30,R10
    01A1B 59E9      SUBI	R30,0x99
    01A1C 4FFF      SBCI	R31,0xFF
    01A1D 8100      LD	R16,Z
    01A1E 2711      CLR	R17
    01A1F 2722      CLR	R18
    01A20 2733      CLR	R19
    01A21 938A      ST	-Y,R24
    01A22 940E 4BA8 CALL	lsl32
    01A24 0118      MOVW	R2,R16
    01A25 0129      MOVW	R4,R18
    01A26 01F5      MOVW	R30,R10
    01A27 59EA      SUBI	R30,0x9A
    01A28 4FFF      SBCI	R31,0xFF
    01A29 8060      LD	R6,Z
    01A2A 56E6      SUBI	R30,0x66
    01A2B 40F0      SBCI	R31,0
    01A2C 2477      CLR	R7
    01A2D 2488      CLR	R8
    01A2E 2499      CLR	R9
    01A2F 0143      MOVW	R8,R6
    01A30 2466      CLR	R6
    01A31 2477      CLR	R7
    01A32 2826      OR	R2,R6
    01A33 2837      OR	R3,R7
    01A34 2848      OR	R4,R8
    01A35 2859      OR	R5,R9
    01A36 59EB      SUBI	R30,0x9B
    01A37 4FFF      SBCI	R31,0xFF
    01A38 8060      LD	R6,Z
    01A39 56E5      SUBI	R30,0x65
    01A3A 40F0      SBCI	R31,0
    01A3B 2477      CLR	R7
    01A3C 2C76      MOV	R7,R6
    01A3D 2466      CLR	R6
    01A3E 2488      CLR	R8
    01A3F 2499      CLR	R9
    01A40 2826      OR	R2,R6
    01A41 2837      OR	R3,R7
    01A42 2848      OR	R4,R8
    01A43 2859      OR	R5,R9
    01A44 59EC      SUBI	R30,0x9C
    01A45 4FFF      SBCI	R31,0xFF
    01A46 8060      LD	R6,Z
    01A47 2477      CLR	R7
    01A48 2488      CLR	R8
    01A49 2499      CLR	R9
    01A4A 2826      OR	R2,R6
    01A4B 2837      OR	R3,R7
    01A4C 2848      OR	R4,R8
    01A4D 2859      OR	R5,R9
    01A4E EF4F      LDI	R20,0xFF
    01A4F EF5F      LDI	R21,0xFF
    01A50 EF6F      LDI	R22,0xFF
    01A51 E070      LDI	R23,0
    01A52 2224      AND	R2,R20
    01A53 2235      AND	R3,R21
    01A54 2246      AND	R4,R22
    01A55 2257      AND	R5,R23
    01A56 E446      LDI	R20,0x46
    01A57 E451      LDI	R21,0x41
    01A58 E564      LDI	R22,0x54
    01A59 E070      LDI	R23,0
    01A5A 1624      CP	R2,R20
    01A5B 0635      CPC	R3,R21
    01A5C 0646      CPC	R4,R22
    01A5D 0657      CPC	R5,R23
    01A5E F411      BNE	0x1A61
(1993) 		return 0;
    01A5F 2700      CLR	R16
    01A60 C04A      RJMP	0x1AAB
(1994) 	if ((LD_DWORD(&fs->win[BS_FilSysType32]) & 0xFFFFFF) == 0x544146)
    01A61 E188      LDI	R24,0x18
    01A62 E090      LDI	R25,0
    01A63 01F5      MOVW	R30,R10
    01A64 57ED      SUBI	R30,0x7D
    01A65 4FFF      SBCI	R31,0xFF
    01A66 8100      LD	R16,Z
    01A67 2711      CLR	R17
    01A68 2722      CLR	R18
    01A69 2733      CLR	R19
    01A6A 938A      ST	-Y,R24
    01A6B 940E 4BA8 CALL	lsl32
    01A6D 0118      MOVW	R2,R16
    01A6E 0129      MOVW	R4,R18
    01A6F 01F5      MOVW	R30,R10
    01A70 57EE      SUBI	R30,0x7E
    01A71 4FFF      SBCI	R31,0xFF
    01A72 8060      LD	R6,Z
    01A73 58E2      SUBI	R30,0x82
    01A74 40F0      SBCI	R31,0
    01A75 2477      CLR	R7
    01A76 2488      CLR	R8
    01A77 2499      CLR	R9
    01A78 0143      MOVW	R8,R6
    01A79 2466      CLR	R6
    01A7A 2477      CLR	R7
    01A7B 2826      OR	R2,R6
    01A7C 2837      OR	R3,R7
    01A7D 2848      OR	R4,R8
    01A7E 2859      OR	R5,R9
    01A7F 57EF      SUBI	R30,0x7F
    01A80 4FFF      SBCI	R31,0xFF
    01A81 8060      LD	R6,Z
    01A82 58E1      SUBI	R30,0x81
    01A83 40F0      SBCI	R31,0
    01A84 2477      CLR	R7
    01A85 2C76      MOV	R7,R6
    01A86 2466      CLR	R6
    01A87 2488      CLR	R8
    01A88 2499      CLR	R9
    01A89 2826      OR	R2,R6
    01A8A 2837      OR	R3,R7
    01A8B 2848      OR	R4,R8
    01A8C 2859      OR	R5,R9
    01A8D 58E0      SUBI	R30,0x80
    01A8E 4FFF      SBCI	R31,0xFF
    01A8F 8060      LD	R6,Z
    01A90 2477      CLR	R7
    01A91 2488      CLR	R8
    01A92 2499      CLR	R9
    01A93 2826      OR	R2,R6
    01A94 2837      OR	R3,R7
    01A95 2848      OR	R4,R8
    01A96 2859      OR	R5,R9
    01A97 EF4F      LDI	R20,0xFF
    01A98 EF5F      LDI	R21,0xFF
    01A99 EF6F      LDI	R22,0xFF
    01A9A E070      LDI	R23,0
    01A9B 2224      AND	R2,R20
    01A9C 2235      AND	R3,R21
    01A9D 2246      AND	R4,R22
    01A9E 2257      AND	R5,R23
    01A9F E446      LDI	R20,0x46
    01AA0 E451      LDI	R21,0x41
    01AA1 E564      LDI	R22,0x54
    01AA2 E070      LDI	R23,0
    01AA3 1624      CP	R2,R20
    01AA4 0635      CPC	R3,R21
    01AA5 0646      CPC	R4,R22
    01AA6 0657      CPC	R5,R23
    01AA7 F411      BNE	0x1AAA
(1995) 		return 0;
    01AA8 2700      CLR	R16
    01AA9 C001      RJMP	0x1AAB
(1996) 
(1997) 	return 1;
    01AAA E001      LDI	R16,1
    01AAB 9625      ADIW	R28,5
    01AAC 940E 4B43 CALL	pop_xgsetF00C
    01AAE 9622      ADIW	R28,2
    01AAF 9508      RET
ff.c:chk_mounted:
  pi                   --> R10
  szbfat               --> Y,+25
  tbl                  --> R10
  p                    --> R10
  nrsv                 --> R14
  sysect               --> Y,+21
  bsect                --> Y,+17
  stat                 --> R10
  tsect                --> Y,+13
  nclst                --> Y,+9
  vol                  --> R14
  fasize               --> Y,+5
  b                    --> R14
  fmt                  --> R12
  fs                   --> Y,+37
  chk_wp               --> Y,+51
  rfs                  --> Y,+49
  path                 --> R12
    01AB0 933A      ST	-Y,R19
    01AB1 932A      ST	-Y,R18
    01AB2 940E 4B1D CALL	push_xgsetF0FC
    01AB4 0168      MOVW	R12,R16
    01AB5 97A7      SBIW	R28,0x27
(1998) }
(1999) 
(2000) 
(2001) 
(2002) 
(2003) /*-----------------------------------------------------------------------*/
(2004) /* Check if the file system object is valid or not                       */
(2005) /*-----------------------------------------------------------------------*/
(2006) 
(2007) static
(2008) FRESULT chk_mounted (	/* FR_OK(0): successful, !=0: any error occurred */
(2009) 	const TCHAR **path,	/* Pointer to pointer to the path name (drive number) */
(2010) 	FATFS **rfs,		/* Pointer to pointer to the found file system object */
(2011) 	BYTE chk_wp			/* !=0: Check media write protection for write access */
(2012) )
(2013) {
(2014) 	BYTE fmt, b, pi, *tbl;
(2015) 	UINT vol;
(2016) 	DSTATUS stat;
(2017) 	DWORD bsect, fasize, tsect, sysect, nclst, szbfat;
(2018) 	WORD nrsv;
(2019) 	const TCHAR *p = *path;
    01AB6 01F6      MOVW	R30,R12
    01AB7 80A0      LD	R10,Z
    01AB8 80B1      LDD	R11,Z+1
(2020) 	FATFS *fs;
(2021) 
(2022) 	/* Get logical drive number from the path name */
(2023) 	vol = p[0] - '0';					/* Is there a drive number? */
    01AB9 01F5      MOVW	R30,R10
    01ABA 8180      LD	R24,Z
    01ABB 2799      CLR	R25
    01ABC 97C0      SBIW	R24,0x30
    01ABD 017C      MOVW	R14,R24
(2024) 	if (vol <= 9 && p[1] == ':') {		/* Found a drive number, get and strip it */
    01ABE E089      LDI	R24,0x9
    01ABF E090      LDI	R25,0
    01AC0 158E      CP	R24,R14
    01AC1 059F      CPC	R25,R15
    01AC2 F050      BCS	0x1ACD
    01AC3 8181      LDD	R24,Z+1
    01AC4 338A      CPI	R24,0x3A
    01AC5 F439      BNE	0x1ACD
(2025) 		p += 2; *path = p;				/* Return pointer to the path name */
    01AC6 01CF      MOVW	R24,R30
    01AC7 9602      ADIW	R24,2
    01AC8 015C      MOVW	R10,R24
    01AC9 01F6      MOVW	R30,R12
    01ACA 82B1      STD	Z+1,R11
    01ACB 82A0      ST	Z,R10
(2026) 	} else {							/* No drive number is given */
    01ACC C002      RJMP	0x1ACF
(2027) #if _FS_RPATH
(2028) 		vol = CurrVol;					/* Use current drive */
(2029) #else
(2030) 		vol = 0;						/* Use drive 0 */
    01ACD 24EE      CLR	R14
    01ACE 24FF      CLR	R15
(2031) #endif
(2032) 	}
(2033) 
(2034) 	/* Check if the file system object is valid or not */
(2035) 	if (vol >= _VOLUMES) 				/* Is the drive number valid? */
    01ACF 01C7      MOVW	R24,R14
    01AD0 3081      CPI	R24,1
    01AD1 E0E0      LDI	R30,0
    01AD2 079E      CPC	R25,R30
    01AD3 F010      BCS	0x1AD6
(2036) 		return FR_INVALID_DRIVE;
    01AD4 E00B      LDI	R16,0xB
    01AD5 C4CF      RJMP	0x1FA5
(2037) 	*rfs = fs = FatFs[vol];				/* Return pointer to the corresponding file system object */
    01AD6 EC83      LDI	R24,0xC3
    01AD7 E098      LDI	R25,0x8
    01AD8 01F7      MOVW	R30,R14
    01AD9 0FEE      LSL	R30
    01ADA 1FFF      ROL	R31
    01ADB 0FE8      ADD	R30,R24
    01ADC 1FF9      ADC	R31,R25
    01ADD 8020      LD	R2,Z
    01ADE 8031      LDD	R3,Z+1
    01ADF A23E      STD	Y+38,R3
    01AE0 A22D      STD	Y+37,R2
    01AE1 A9E9      LDD	R30,Y+49
    01AE2 A9FA      LDD	R31,Y+50
    01AE3 8231      STD	Z+1,R3
    01AE4 8220      ST	Z,R2
(2038) 	if (!fs) return FR_NOT_ENABLED;		/* Is the file system object available? */
    01AE5 0101      MOVW	R0,R2
    01AE6 2022      TST	R2
    01AE7 F421      BNE	0x1AEC
    01AE8 2033      TST	R3
    01AE9 F411      BNE	0x1AEC
    01AEA E00C      LDI	R16,0xC
    01AEB C4B9      RJMP	0x1FA5
(2039) 
(2040) 	ENTER_FF(fs);						/* Lock file system */
(2041) 
(2042) 	if (fs->fs_type) {					/* If the logical drive has been mounted */
    01AEC A1ED      LDD	R30,Y+37
    01AED A1FE      LDD	R31,Y+38
    01AEE 8020      LD	R2,Z
    01AEF 2022      TST	R2
    01AF0 F079      BEQ	0x1B00
(2043) 		stat = disk_status(fs->drv);
    01AF1 8101      LDD	R16,Z+1
    01AF2 940E 0BF1 CALL	_disk_status
    01AF4 2EA0      MOV	R10,R16
(2044) 		if (!(stat & STA_NOINIT)) {		/* and the physical drive is kept initialized (has not been changed), */
    01AF5 FD00      SBRC	R16,0
    01AF6 C009      RJMP	0x1B00
(2045) 			if (!_FS_READONLY && chk_wp && (stat & STA_PROTECT))	/* Check write protection if needed */
    01AF7 A80B      LDD	R0,Y+51
    01AF8 2000      TST	R0
    01AF9 F021      BEQ	0x1AFE
    01AFA FF02      SBRS	R16,2
    01AFB C002      RJMP	0x1AFE
(2046) 				return FR_WRITE_PROTECTED;
    01AFC E00A      LDI	R16,0xA
    01AFD C4A7      RJMP	0x1FA5
(2047) 			return FR_OK;				/* The file system object is valid */
    01AFE 2700      CLR	R16
    01AFF C4A5      RJMP	0x1FA5
(2048) 		}
(2049) 	}
(2050) 
(2051) 	/* The file system object is not valid. */
(2052) 	/* Following code attempts to mount the volume. (analyze BPB and initialize the fs object) */
(2053) 
(2054) 	fs->fs_type = 0;					/* Clear the file system object */
    01B00 2422      CLR	R2
    01B01 A1ED      LDD	R30,Y+37
    01B02 A1FE      LDD	R31,Y+38
    01B03 8220      ST	Z,R2
(2055) 	fs->drv = LD2PD(vol);				/* Bind the logical drive and a physical drive */
    01B04 82E1      STD	Z+1,R14
(2056) 	stat = disk_initialize(fs->drv);	/* Initialize low level disk I/O layer */
    01B05 8101      LDD	R16,Z+1
    01B06 940E 0BDB CALL	_disk_initialize
    01B08 2EE0      MOV	R14,R16
    01B09 2CAE      MOV	R10,R14
(2057) 	if (stat & STA_NOINIT)				/* Check if the initialization succeeded */
    01B0A FF00      SBRS	R16,0
    01B0B C002      RJMP	0x1B0E
(2058) 		return FR_NOT_READY;			/* Failed to initialize due to no media or hard error */
    01B0C E003      LDI	R16,3
    01B0D C497      RJMP	0x1FA5
(2059) 	if (!_FS_READONLY && chk_wp && (stat & STA_PROTECT))	/* Check disk write protection if needed */
    01B0E A80B      LDD	R0,Y+51
    01B0F 2000      TST	R0
    01B10 F021      BEQ	0x1B15
    01B11 FEA2      SBRS	R10,2
    01B12 C002      RJMP	0x1B15
(2060) 		return FR_WRITE_PROTECTED;
    01B13 E00A      LDI	R16,0xA
    01B14 C490      RJMP	0x1FA5
(2061) #if _MAX_SS != 512						/* Get disk sector size (variable sector size cfg only) */
(2062) 	if (disk_ioctl(fs->drv, GET_SECTOR_SIZE, &fs->ssize) != RES_OK)
(2063) 		return FR_DISK_ERR;
(2064) #endif
(2065) 	/* Search FAT partition on the drive. Supports only generic partitionings, FDISK and SFD. */
(2066) 	fmt = check_fs(fs, bsect = 0);		/* Load sector 0 and check if it is an FAT-VBR (in SFD) */
    01B15 E080      LDI	R24,0
    01B16 8B89      STD	Y+17,R24
    01B17 8B8A      STD	Y+18,R24
    01B18 8B8B      STD	Y+19,R24
    01B19 8B8C      STD	Y+20,R24
    01B1A E040      LDI	R20,0
    01B1B E050      LDI	R21,0
    01B1C E060      LDI	R22,0
    01B1D E070      LDI	R23,0
    01B1E 8368      ST	Y,R22
    01B1F 8379      STD	Y+1,R23
    01B20 019A      MOVW	R18,R20
    01B21 A10D      LDD	R16,Y+37
    01B22 A11E      LDD	R17,Y+38
    01B23 DEC4      RCALL	ff.c:check_fs
    01B24 2EA0      MOV	R10,R16
    01B25 2CCA      MOV	R12,R10
(2067) 	if (LD2PT(vol) && !fmt) fmt = 1;	/* Force non-SFD if the volume is forced partition */
    01B26 C000      RJMP	0x1B27
(2068) 	if (fmt == 1) {						/* Not an FAT-VBR, the physical drive can be partitioned */
    01B27 2D8C      MOV	R24,R12
    01B28 3081      CPI	R24,1
    01B29 F009      BEQ	0x1B2B
    01B2A C04C      RJMP	0x1B77
(2069) 		/* Check the partition listed in the partition table */
(2070) 		pi = LD2PT(vol);
    01B2B 24AA      CLR	R10
(2071) 		if (pi) pi--;
    01B2C F009      BEQ	0x1B2E
    01B2D 94AA      DEC	R10
(2072) 		tbl = &fs->win[MBR_Table + pi * SZ_PTE];/* Partition table */
    01B2E E100      LDI	R16,0x10
    01B2F 2D1A      MOV	R17,R10
    01B30 0301      MULSU	R16,R17
    01B31 0150      MOVW	R10,R0
    01B32 A18D      LDD	R24,Y+37
    01B33 A19E      LDD	R25,Y+38
    01B34 5184      SUBI	R24,0x14
    01B35 4F9E      SBCI	R25,0xFE
    01B36 0EA8      ADD	R10,R24
    01B37 1EB9      ADC	R11,R25
(2073) 		if (tbl[4]) {						/* Is the partition existing? */
    01B38 01F5      MOVW	R30,R10
    01B39 8024      LDD	R2,Z+4
    01B3A 2022      TST	R2
    01B3B F409      BNE	0x1B3D
    01B3C C03A      RJMP	0x1B77
(2074) 			bsect = LD_DWORD(&tbl[8]);		/* Partition offset in LBA */
    01B3D E188      LDI	R24,0x18
    01B3E E090      LDI	R25,0
    01B3F 8503      LDD	R16,Z+11
    01B40 2711      CLR	R17
    01B41 2722      CLR	R18
    01B42 2733      CLR	R19
    01B43 938A      ST	-Y,R24
    01B44 940E 4BA8 CALL	lsl32
    01B46 0118      MOVW	R2,R16
    01B47 0129      MOVW	R4,R18
    01B48 01F5      MOVW	R30,R10
    01B49 8462      LDD	R6,Z+10
    01B4A 2477      CLR	R7
    01B4B 2488      CLR	R8
    01B4C 2499      CLR	R9
    01B4D 0143      MOVW	R8,R6
    01B4E 2466      CLR	R6
    01B4F 2477      CLR	R7
    01B50 2826      OR	R2,R6
    01B51 2837      OR	R3,R7
    01B52 2848      OR	R4,R8
    01B53 2859      OR	R5,R9
    01B54 8461      LDD	R6,Z+9
    01B55 2477      CLR	R7
    01B56 2C76      MOV	R7,R6
    01B57 2466      CLR	R6
    01B58 2488      CLR	R8
    01B59 2499      CLR	R9
    01B5A 2826      OR	R2,R6
    01B5B 2837      OR	R3,R7
    01B5C 2848      OR	R4,R8
    01B5D 2859      OR	R5,R9
    01B5E 9638      ADIW	R30,0x8
    01B5F 8060      LD	R6,Z
    01B60 2477      CLR	R7
    01B61 2488      CLR	R8
    01B62 2499      CLR	R9
    01B63 2826      OR	R2,R6
    01B64 2837      OR	R3,R7
    01B65 2848      OR	R4,R8
    01B66 2859      OR	R5,R9
    01B67 8A29      STD	Y+17,R2
    01B68 8A3A      STD	Y+18,R3
    01B69 8A4B      STD	Y+19,R4
    01B6A 8A5C      STD	Y+20,R5
(2075) 			fmt = check_fs(fs, bsect);		/* Check the partition */
    01B6B 8829      LDD	R2,Y+17
    01B6C 883A      LDD	R3,Y+18
    01B6D 884B      LDD	R4,Y+19
    01B6E 885C      LDD	R5,Y+20
    01B6F 8248      ST	Y,R4
    01B70 8259      STD	Y+1,R5
    01B71 0191      MOVW	R18,R2
    01B72 A10D      LDD	R16,Y+37
    01B73 A11E      LDD	R17,Y+38
    01B74 DE73      RCALL	ff.c:check_fs
    01B75 2EA0      MOV	R10,R16
    01B76 2CCA      MOV	R12,R10
(2076) 		}
(2077) 	}
(2078) 	if (fmt == 3) return FR_DISK_ERR;
    01B77 2D8C      MOV	R24,R12
    01B78 3083      CPI	R24,3
    01B79 F411      BNE	0x1B7C
    01B7A E001      LDI	R16,1
    01B7B C429      RJMP	0x1FA5
(2079) 	if (fmt) return FR_NO_FILESYSTEM;		/* No FAT volume is found */
    01B7C 20CC      TST	R12
    01B7D F011      BEQ	0x1B80
    01B7E E00D      LDI	R16,0xD
    01B7F C425      RJMP	0x1FA5
(2080) 
(2081) 	/* An FAT volume is found. Following code initializes the file system object */
(2082) 
(2083) 	if (LD_WORD(fs->win+BPB_BytsPerSec) != SS(fs))		/* (BPB_BytsPerSec must be equal to the physical sector size) */
    01B80 A1ED      LDD	R30,Y+37
    01B81 A1FE      LDD	R31,Y+38
    01B82 AC21      LDD	R2,Z+57
    01B83 2433      CLR	R3
    01B84 AD82      LDD	R24,Z+58
    01B85 2799      CLR	R25
    01B86 2F98      MOV	R25,R24
    01B87 2788      CLR	R24
    01B88 2982      OR	R24,R2
    01B89 2993      OR	R25,R3
    01B8A 3080      CPI	R24,0
    01B8B E0E2      LDI	R30,2
    01B8C 079E      CPC	R25,R30
    01B8D F011      BEQ	0x1B90
(2084) 		return FR_NO_FILESYSTEM;
    01B8E E00D      LDI	R16,0xD
    01B8F C415      RJMP	0x1FA5
(2085) 
(2086) 	fasize = LD_WORD(fs->win+BPB_FATSz16);				/* Number of sectors per FAT */
    01B90 A1ED      LDD	R30,Y+37
    01B91 A1FE      LDD	R31,Y+38
    01B92 5BEC      SUBI	R30,0xBC
    01B93 4FFF      SBCI	R31,0xFF
    01B94 8020      LD	R2,Z
    01B95 54E4      SUBI	R30,0x44
    01B96 40F0      SBCI	R31,0
    01B97 2433      CLR	R3
    01B98 5BEB      SUBI	R30,0xBB
    01B99 4FFF      SBCI	R31,0xFF
    01B9A 8040      LD	R4,Z
    01B9B 2455      CLR	R5
    01B9C 2C54      MOV	R5,R4
    01B9D 2444      CLR	R4
    01B9E 2842      OR	R4,R2
    01B9F 2853      OR	R5,R3
    01BA0 0112      MOVW	R2,R4
    01BA1 2444      CLR	R4
    01BA2 2455      CLR	R5
    01BA3 822D      STD	Y+5,R2
    01BA4 823E      STD	Y+6,R3
    01BA5 824F      STD	Y+7,R4
    01BA6 8658      STD	Y+8,R5
(2087) 	if (!fasize) fasize = LD_DWORD(fs->win+BPB_FATSz32);
    01BA7 802D      LDD	R2,Y+5
    01BA8 803E      LDD	R3,Y+6
    01BA9 804F      LDD	R4,Y+7
    01BAA 8458      LDD	R5,Y+8
    01BAB 9488      BCLR	0
    01BAC 2022      TST	R2
    01BAD 0432      CPC	R3,R2
    01BAE 0442      CPC	R4,R2
    01BAF 0452      CPC	R5,R2
    01BB0 F009      BEQ	0x1BB2
    01BB1 C03C      RJMP	0x1BEE
    01BB2 E188      LDI	R24,0x18
    01BB3 E090      LDI	R25,0
    01BB4 A1ED      LDD	R30,Y+37
    01BB5 A1FE      LDD	R31,Y+38
    01BB6 5AEB      SUBI	R30,0xAB
    01BB7 4FFF      SBCI	R31,0xFF
    01BB8 8100      LD	R16,Z
    01BB9 2711      CLR	R17
    01BBA 2722      CLR	R18
    01BBB 2733      CLR	R19
    01BBC 938A      ST	-Y,R24
    01BBD 940E 4BA8 CALL	lsl32
    01BBF 0118      MOVW	R2,R16
    01BC0 0129      MOVW	R4,R18
    01BC1 A1ED      LDD	R30,Y+37
    01BC2 A1FE      LDD	R31,Y+38
    01BC3 5AEC      SUBI	R30,0xAC
    01BC4 4FFF      SBCI	R31,0xFF
    01BC5 8060      LD	R6,Z
    01BC6 55E4      SUBI	R30,0x54
    01BC7 40F0      SBCI	R31,0
    01BC8 2477      CLR	R7
    01BC9 2488      CLR	R8
    01BCA 2499      CLR	R9
    01BCB 0143      MOVW	R8,R6
    01BCC 2466      CLR	R6
    01BCD 2477      CLR	R7
    01BCE 2826      OR	R2,R6
    01BCF 2837      OR	R3,R7
    01BD0 2848      OR	R4,R8
    01BD1 2859      OR	R5,R9
    01BD2 5AED      SUBI	R30,0xAD
    01BD3 4FFF      SBCI	R31,0xFF
    01BD4 8060      LD	R6,Z
    01BD5 55E3      SUBI	R30,0x53
    01BD6 40F0      SBCI	R31,0
    01BD7 2477      CLR	R7
    01BD8 2C76      MOV	R7,R6
    01BD9 2466      CLR	R6
    01BDA 2488      CLR	R8
    01BDB 2499      CLR	R9
    01BDC 2826      OR	R2,R6
    01BDD 2837      OR	R3,R7
    01BDE 2848      OR	R4,R8
    01BDF 2859      OR	R5,R9
    01BE0 5AEE      SUBI	R30,0xAE
    01BE1 4FFF      SBCI	R31,0xFF
    01BE2 8060      LD	R6,Z
    01BE3 2477      CLR	R7
    01BE4 2488      CLR	R8
    01BE5 2499      CLR	R9
    01BE6 2826      OR	R2,R6
    01BE7 2837      OR	R3,R7
    01BE8 2848      OR	R4,R8
    01BE9 2859      OR	R5,R9
    01BEA 822D      STD	Y+5,R2
    01BEB 823E      STD	Y+6,R3
    01BEC 824F      STD	Y+7,R4
    01BED 8658      STD	Y+8,R5
(2088) 	fs->fsize = fasize;
    01BEE 802D      LDD	R2,Y+5
    01BEF 803E      LDD	R3,Y+6
    01BF0 804F      LDD	R4,Y+7
    01BF1 8458      LDD	R5,Y+8
    01BF2 A1ED      LDD	R30,Y+37
    01BF3 A1FE      LDD	R31,Y+38
    01BF4 8E22      STD	Z+26,R2
    01BF5 8E33      STD	Z+27,R3
    01BF6 8E44      STD	Z+28,R4
    01BF7 8E55      STD	Z+29,R5
(2089) 
(2090) 	fs->n_fats = b = fs->win[BPB_NumFATs];				/* Number of FAT copies */
    01BF8 ACA6      LDD	R10,Z+62
    01BF9 2CEA      MOV	R14,R10
    01BFA 82A3      STD	Z+3,R10
(2091) 	if (b != 1 && b != 2) return FR_NO_FILESYSTEM;		/* (Must be 1 or 2) */
    01BFB 2D8E      MOV	R24,R14
    01BFC 3081      CPI	R24,1
    01BFD F021      BEQ	0x1C02
    01BFE 3082      CPI	R24,2
    01BFF F011      BEQ	0x1C02
    01C00 E00D      LDI	R16,0xD
    01C01 C3A3      RJMP	0x1FA5
(2092) 	fasize *= b;										/* Number of sectors for FAT area */
    01C02 2C2E      MOV	R2,R14
    01C03 2433      CLR	R3
    01C04 2444      CLR	R4
    01C05 2455      CLR	R5
    01C06 810D      LDD	R16,Y+5
    01C07 811E      LDD	R17,Y+6
    01C08 812F      LDD	R18,Y+7
    01C09 8538      LDD	R19,Y+8
    01C0A 925A      ST	-Y,R5
    01C0B 924A      ST	-Y,R4
    01C0C 923A      ST	-Y,R3
    01C0D 922A      ST	-Y,R2
    01C0E 940E 4AC9 CALL	empy32s|empy32u
    01C10 830D      STD	Y+5,R16
    01C11 831E      STD	Y+6,R17
    01C12 832F      STD	Y+7,R18
    01C13 8738      STD	Y+8,R19
(2093) 
(2094) 	fs->csize = b = fs->win[BPB_SecPerClus];			/* Number of sectors per cluster */
    01C14 A1ED      LDD	R30,Y+37
    01C15 A1FE      LDD	R31,Y+38
    01C16 ACA3      LDD	R10,Z+59
    01C17 2CEA      MOV	R14,R10
    01C18 82A2      STD	Z+2,R10
(2095) 	if (!b || (b & (b - 1))) return FR_NO_FILESYSTEM;	/* (Must be power of 2) */
    01C19 20AA      TST	R10
    01C1A F029      BEQ	0x1C20
    01C1B 2D8E      MOV	R24,R14
    01C1C 5081      SUBI	R24,1
    01C1D 2C2E      MOV	R2,R14
    01C1E 2228      AND	R2,R24
    01C1F F011      BEQ	0x1C22
    01C20 E00D      LDI	R16,0xD
    01C21 C383      RJMP	0x1FA5
(2096) 
(2097) 	fs->n_rootdir = LD_WORD(fs->win+BPB_RootEntCnt);	/* Number of root directory entries */
    01C22 A1ED      LDD	R30,Y+37
    01C23 A1FE      LDD	R31,Y+38
    01C24 AC27      LDD	R2,Z+63
    01C25 2433      CLR	R3
    01C26 5CE0      SUBI	R30,0xC0
    01C27 4FFF      SBCI	R31,0xFF
    01C28 8040      LD	R4,Z
    01C29 54E0      SUBI	R30,0x40
    01C2A 40F0      SBCI	R31,0
    01C2B 2455      CLR	R5
    01C2C 2C54      MOV	R5,R4
    01C2D 2444      CLR	R4
    01C2E 2842      OR	R4,R2
    01C2F 2853      OR	R5,R3
    01C30 8651      STD	Z+9,R5
    01C31 8640      STD	Z+8,R4
(2098) 	if (fs->n_rootdir % (SS(fs) / SZ_DIR)) return FR_NO_FILESYSTEM;	/* (BPB_RootEntCnt must be sector aligned) */
    01C32 8580      LDD	R24,Z+8
    01C33 8591      LDD	R25,Z+9
    01C34 708F      ANDI	R24,0xF
    01C35 7090      ANDI	R25,0
    01C36 3080      CPI	R24,0
    01C37 0789      CPC	R24,R25
    01C38 F011      BEQ	0x1C3B
    01C39 E00D      LDI	R16,0xD
    01C3A C36A      RJMP	0x1FA5
(2099) 
(2100) 	tsect = LD_WORD(fs->win+BPB_TotSec16);				/* Number of sectors on the volume */
    01C3B A1ED      LDD	R30,Y+37
    01C3C A1FE      LDD	R31,Y+38
    01C3D 5BEF      SUBI	R30,0xBF
    01C3E 4FFF      SBCI	R31,0xFF
    01C3F 8020      LD	R2,Z
    01C40 54E1      SUBI	R30,0x41
    01C41 40F0      SBCI	R31,0
    01C42 2433      CLR	R3
    01C43 5BEE      SUBI	R30,0xBE
    01C44 4FFF      SBCI	R31,0xFF
    01C45 8040      LD	R4,Z
    01C46 2455      CLR	R5
    01C47 2C54      MOV	R5,R4
    01C48 2444      CLR	R4
    01C49 2842      OR	R4,R2
    01C4A 2853      OR	R5,R3
    01C4B 0112      MOVW	R2,R4
    01C4C 2444      CLR	R4
    01C4D 2455      CLR	R5
    01C4E 862D      STD	Y+13,R2
    01C4F 863E      STD	Y+14,R3
    01C50 864F      STD	Y+15,R4
    01C51 8A58      STD	Y+16,R5
(2101) 	if (!tsect) tsect = LD_DWORD(fs->win+BPB_TotSec32);
    01C52 842D      LDD	R2,Y+13
    01C53 843E      LDD	R3,Y+14
    01C54 844F      LDD	R4,Y+15
    01C55 8858      LDD	R5,Y+16
    01C56 9488      BCLR	0
    01C57 2022      TST	R2
    01C58 0432      CPC	R3,R2
    01C59 0442      CPC	R4,R2
    01C5A 0452      CPC	R5,R2
    01C5B F009      BEQ	0x1C5D
    01C5C C03C      RJMP	0x1C99
    01C5D E188      LDI	R24,0x18
    01C5E E090      LDI	R25,0
    01C5F A1ED      LDD	R30,Y+37
    01C60 A1FE      LDD	R31,Y+38
    01C61 5AEF      SUBI	R30,0xAF
    01C62 4FFF      SBCI	R31,0xFF
    01C63 8100      LD	R16,Z
    01C64 2711      CLR	R17
    01C65 2722      CLR	R18
    01C66 2733      CLR	R19
    01C67 938A      ST	-Y,R24
    01C68 940E 4BA8 CALL	lsl32
    01C6A 0118      MOVW	R2,R16
    01C6B 0129      MOVW	R4,R18
    01C6C A1ED      LDD	R30,Y+37
    01C6D A1FE      LDD	R31,Y+38
    01C6E 5BE0      SUBI	R30,0xB0
    01C6F 4FFF      SBCI	R31,0xFF
    01C70 8060      LD	R6,Z
    01C71 55E0      SUBI	R30,0x50
    01C72 40F0      SBCI	R31,0
    01C73 2477      CLR	R7
    01C74 2488      CLR	R8
    01C75 2499      CLR	R9
    01C76 0143      MOVW	R8,R6
    01C77 2466      CLR	R6
    01C78 2477      CLR	R7
    01C79 2826      OR	R2,R6
    01C7A 2837      OR	R3,R7
    01C7B 2848      OR	R4,R8
    01C7C 2859      OR	R5,R9
    01C7D 5BE1      SUBI	R30,0xB1
    01C7E 4FFF      SBCI	R31,0xFF
    01C7F 8060      LD	R6,Z
    01C80 54EF      SUBI	R30,0x4F
    01C81 40F0      SBCI	R31,0
    01C82 2477      CLR	R7
    01C83 2C76      MOV	R7,R6
    01C84 2466      CLR	R6
    01C85 2488      CLR	R8
    01C86 2499      CLR	R9
    01C87 2826      OR	R2,R6
    01C88 2837      OR	R3,R7
    01C89 2848      OR	R4,R8
    01C8A 2859      OR	R5,R9
    01C8B 5BE2      SUBI	R30,0xB2
    01C8C 4FFF      SBCI	R31,0xFF
    01C8D 8060      LD	R6,Z
    01C8E 2477      CLR	R7
    01C8F 2488      CLR	R8
    01C90 2499      CLR	R9
    01C91 2826      OR	R2,R6
    01C92 2837      OR	R3,R7
    01C93 2848      OR	R4,R8
    01C94 2859      OR	R5,R9
    01C95 862D      STD	Y+13,R2
    01C96 863E      STD	Y+14,R3
    01C97 864F      STD	Y+15,R4
    01C98 8A58      STD	Y+16,R5
(2102) 
(2103) 	nrsv = LD_WORD(fs->win+BPB_RsvdSecCnt);				/* Number of reserved sectors */
    01C99 A1ED      LDD	R30,Y+37
    01C9A A1FE      LDD	R31,Y+38
    01C9B AC24      LDD	R2,Z+60
    01C9C 2433      CLR	R3
    01C9D ACE5      LDD	R14,Z+61
    01C9E 24FF      CLR	R15
    01C9F 2CFE      MOV	R15,R14
    01CA0 24EE      CLR	R14
    01CA1 28E2      OR	R14,R2
    01CA2 28F3      OR	R15,R3
(2104) 	if (!nrsv) return FR_NO_FILESYSTEM;					/* (BPB_RsvdSecCnt must not be 0) */
    01CA3 20EE      TST	R14
    01CA4 F421      BNE	0x1CA9
    01CA5 20FF      TST	R15
    01CA6 F411      BNE	0x1CA9
    01CA7 E00D      LDI	R16,0xD
    01CA8 C2FC      RJMP	0x1FA5
(2105) 
(2106) 	/* Determine the FAT sub type */
(2107) 	sysect = nrsv + fasize + fs->n_rootdir / (SS(fs) / SZ_DIR);	/* RSV+FAT+DIR */
    01CA9 802D      LDD	R2,Y+5
    01CAA 803E      LDD	R3,Y+6
    01CAB 804F      LDD	R4,Y+7
    01CAC 8458      LDD	R5,Y+8
    01CAD 0137      MOVW	R6,R14
    01CAE 2488      CLR	R8
    01CAF 2499      CLR	R9
    01CB0 0C62      ADD	R6,R2
    01CB1 1C73      ADC	R7,R3
    01CB2 1C84      ADC	R8,R4
    01CB3 1C95      ADC	R9,R5
    01CB4 A1ED      LDD	R30,Y+37
    01CB5 A1FE      LDD	R31,Y+38
    01CB6 9638      ADIW	R30,0x8
    01CB7 8020      LD	R2,Z
    01CB8 8031      LDD	R3,Z+1
    01CB9 9436      LSR	R3
    01CBA 9427      ROR	R2
    01CBB 9436      LSR	R3
    01CBC 9427      ROR	R2
    01CBD 9436      LSR	R3
    01CBE 9427      ROR	R2
    01CBF 9436      LSR	R3
    01CC0 9427      ROR	R2
    01CC1 2444      CLR	R4
    01CC2 2455      CLR	R5
    01CC3 0C62      ADD	R6,R2
    01CC4 1C73      ADC	R7,R3
    01CC5 1C84      ADC	R8,R4
    01CC6 1C95      ADC	R9,R5
    01CC7 8A6D      STD	Y+21,R6
    01CC8 8A7E      STD	Y+22,R7
    01CC9 8A8F      STD	Y+23,R8
    01CCA 8E98      STD	Y+24,R9
(2108) 	if (tsect < sysect) return FR_NO_FILESYSTEM;		/* (Invalid volume size) */
    01CCB 882D      LDD	R2,Y+21
    01CCC 883E      LDD	R3,Y+22
    01CCD 884F      LDD	R4,Y+23
    01CCE 8C58      LDD	R5,Y+24
    01CCF 846D      LDD	R6,Y+13
    01CD0 847E      LDD	R7,Y+14
    01CD1 848F      LDD	R8,Y+15
    01CD2 8898      LDD	R9,Y+16
    01CD3 1462      CP	R6,R2
    01CD4 0473      CPC	R7,R3
    01CD5 0484      CPC	R8,R4
    01CD6 0495      CPC	R9,R5
    01CD7 F410      BCC	0x1CDA
    01CD8 E00D      LDI	R16,0xD
    01CD9 C2CB      RJMP	0x1FA5
(2109) 	nclst = (tsect - sysect) / fs->csize;				/* Number of clusters */
    01CDA 882D      LDD	R2,Y+21
    01CDB 883E      LDD	R3,Y+22
    01CDC 884F      LDD	R4,Y+23
    01CDD 8C58      LDD	R5,Y+24
    01CDE 850D      LDD	R16,Y+13
    01CDF 851E      LDD	R17,Y+14
    01CE0 852F      LDD	R18,Y+15
    01CE1 8938      LDD	R19,Y+16
    01CE2 1902      SUB	R16,R2
    01CE3 0913      SBC	R17,R3
    01CE4 0924      SBC	R18,R4
    01CE5 0935      SBC	R19,R5
    01CE6 A1ED      LDD	R30,Y+37
    01CE7 A1FE      LDD	R31,Y+38
    01CE8 9632      ADIW	R30,2
    01CE9 8020      LD	R2,Z
    01CEA 2433      CLR	R3
    01CEB 2444      CLR	R4
    01CEC 2455      CLR	R5
    01CED 925A      ST	-Y,R5
    01CEE 924A      ST	-Y,R4
    01CEF 923A      ST	-Y,R3
    01CF0 922A      ST	-Y,R2
    01CF1 940E 4A23 CALL	div32u
    01CF3 8709      STD	Y+9,R16
    01CF4 871A      STD	Y+10,R17
    01CF5 872B      STD	Y+11,R18
    01CF6 873C      STD	Y+12,R19
(2110) 	if (!nclst) return FR_NO_FILESYSTEM;				/* (Invalid volume size) */
    01CF7 8429      LDD	R2,Y+9
    01CF8 843A      LDD	R3,Y+10
    01CF9 844B      LDD	R4,Y+11
    01CFA 845C      LDD	R5,Y+12
    01CFB 9488      BCLR	0
    01CFC 2022      TST	R2
    01CFD 0432      CPC	R3,R2
    01CFE 0442      CPC	R4,R2
    01CFF 0452      CPC	R5,R2
    01D00 F411      BNE	0x1D03
    01D01 E00D      LDI	R16,0xD
    01D02 C2A2      RJMP	0x1FA5
(2111) 	fmt = FS_FAT12;
    01D03 24CC      CLR	R12
    01D04 94C3      INC	R12
(2112) 	if (nclst >= MIN_FAT16) fmt = FS_FAT16;
    01D05 EF46      LDI	R20,0xF6
    01D06 E05F      LDI	R21,0xF
    01D07 E060      LDI	R22,0
    01D08 E070      LDI	R23,0
    01D09 8429      LDD	R2,Y+9
    01D0A 843A      LDD	R3,Y+10
    01D0B 844B      LDD	R4,Y+11
    01D0C 845C      LDD	R5,Y+12
    01D0D 1624      CP	R2,R20
    01D0E 0635      CPC	R3,R21
    01D0F 0646      CPC	R4,R22
    01D10 0657      CPC	R5,R23
    01D11 F010      BCS	0x1D14
    01D12 E082      LDI	R24,2
    01D13 2EC8      MOV	R12,R24
(2113) 	if (nclst >= MIN_FAT32) fmt = FS_FAT32;
    01D14 EF46      LDI	R20,0xF6
    01D15 EF5F      LDI	R21,0xFF
    01D16 E060      LDI	R22,0
    01D17 E070      LDI	R23,0
    01D18 8429      LDD	R2,Y+9
    01D19 843A      LDD	R3,Y+10
    01D1A 844B      LDD	R4,Y+11
    01D1B 845C      LDD	R5,Y+12
    01D1C 1624      CP	R2,R20
    01D1D 0635      CPC	R3,R21
    01D1E 0646      CPC	R4,R22
    01D1F 0657      CPC	R5,R23
    01D20 F010      BCS	0x1D23
    01D21 E083      LDI	R24,3
    01D22 2EC8      MOV	R12,R24
(2114) 
(2115) 	/* Boundaries and Limits */
(2116) 	fs->n_fatent = nclst + 2;							/* Number of FAT entries */
    01D23 E042      LDI	R20,2
    01D24 E050      LDI	R21,0
    01D25 E060      LDI	R22,0
    01D26 E070      LDI	R23,0
    01D27 8429      LDD	R2,Y+9
    01D28 843A      LDD	R3,Y+10
    01D29 844B      LDD	R4,Y+11
    01D2A 845C      LDD	R5,Y+12
    01D2B 0E24      ADD	R2,R20
    01D2C 1E35      ADC	R3,R21
    01D2D 1E46      ADC	R4,R22
    01D2E 1E57      ADC	R5,R23
    01D2F A1ED      LDD	R30,Y+37
    01D30 A1FE      LDD	R31,Y+38
    01D31 9676      ADIW	R30,0x16
    01D32 8220      ST	Z,R2
    01D33 8231      STD	Z+1,R3
    01D34 8242      STD	Z+2,R4
    01D35 8253      STD	Z+3,R5
(2117) 	fs->database = bsect + sysect;						/* Data start sector */
    01D36 882D      LDD	R2,Y+21
    01D37 883E      LDD	R3,Y+22
    01D38 884F      LDD	R4,Y+23
    01D39 8C58      LDD	R5,Y+24
    01D3A 8869      LDD	R6,Y+17
    01D3B 887A      LDD	R7,Y+18
    01D3C 888B      LDD	R8,Y+19
    01D3D 889C      LDD	R9,Y+20
    01D3E 0C62      ADD	R6,R2
    01D3F 1C73      ADC	R7,R3
    01D40 1C84      ADC	R8,R4
    01D41 1C95      ADC	R9,R5
    01D42 A1ED      LDD	R30,Y+37
    01D43 A1FE      LDD	R31,Y+38
    01D44 96B6      ADIW	R30,0x26
    01D45 8260      ST	Z,R6
    01D46 8271      STD	Z+1,R7
    01D47 8282      STD	Z+2,R8
    01D48 8293      STD	Z+3,R9
(2118) 	fs->fatbase = bsect + nrsv; 						/* FAT start sector */
    01D49 0117      MOVW	R2,R14
    01D4A 2444      CLR	R4
    01D4B 2455      CLR	R5
    01D4C 8869      LDD	R6,Y+17
    01D4D 887A      LDD	R7,Y+18
    01D4E 888B      LDD	R8,Y+19
    01D4F 889C      LDD	R9,Y+20
    01D50 0C62      ADD	R6,R2
    01D51 1C73      ADC	R7,R3
    01D52 1C84      ADC	R8,R4
    01D53 1C95      ADC	R9,R5
    01D54 A1ED      LDD	R30,Y+37
    01D55 A1FE      LDD	R31,Y+38
    01D56 8E66      STD	Z+30,R6
    01D57 8E77      STD	Z+31,R7
    01D58 A280      STD	Z+32,R8
    01D59 A291      STD	Z+33,R9
(2119) 	if (fmt == FS_FAT32) {
    01D5A 2D8C      MOV	R24,R12
    01D5B 3083      CPI	R24,3
    01D5C F009      BEQ	0x1D5E
    01D5D C055      RJMP	0x1DB3
(2120) 		if (fs->n_rootdir) return FR_NO_FILESYSTEM;		/* (BPB_RootEntCnt must be 0) */
    01D5E 8420      LDD	R2,Z+8
    01D5F 8431      LDD	R3,Z+9
    01D60 2022      TST	R2
    01D61 F411      BNE	0x1D64
    01D62 2033      TST	R3
    01D63 F011      BEQ	0x1D66
    01D64 E00D      LDI	R16,0xD
    01D65 C23F      RJMP	0x1FA5
(2121) 		fs->dirbase = LD_DWORD(fs->win+BPB_RootClus);	/* Root directory start cluster */
    01D66 E188      LDI	R24,0x18
    01D67 E090      LDI	R25,0
    01D68 A1ED      LDD	R30,Y+37
    01D69 A1FE      LDD	R31,Y+38
    01D6A 5AE3      SUBI	R30,0xA3
    01D6B 4FFF      SBCI	R31,0xFF
    01D6C 8100      LD	R16,Z
    01D6D 2711      CLR	R17
    01D6E 2722      CLR	R18
    01D6F 2733      CLR	R19
    01D70 938A      ST	-Y,R24
    01D71 940E 4BA8 CALL	lsl32
    01D73 0118      MOVW	R2,R16
    01D74 0129      MOVW	R4,R18
    01D75 A1ED      LDD	R30,Y+37
    01D76 A1FE      LDD	R31,Y+38
    01D77 5AE4      SUBI	R30,0xA4
    01D78 4FFF      SBCI	R31,0xFF
    01D79 8060      LD	R6,Z
    01D7A 55EC      SUBI	R30,0x5C
    01D7B 40F0      SBCI	R31,0
    01D7C 2477      CLR	R7
    01D7D 2488      CLR	R8
    01D7E 2499      CLR	R9
    01D7F 0143      MOVW	R8,R6
    01D80 2466      CLR	R6
    01D81 2477      CLR	R7
    01D82 2826      OR	R2,R6
    01D83 2837      OR	R3,R7
    01D84 2848      OR	R4,R8
    01D85 2859      OR	R5,R9
    01D86 5AE5      SUBI	R30,0xA5
    01D87 4FFF      SBCI	R31,0xFF
    01D88 8060      LD	R6,Z
    01D89 55EB      SUBI	R30,0x5B
    01D8A 40F0      SBCI	R31,0
    01D8B 2477      CLR	R7
    01D8C 2C76      MOV	R7,R6
    01D8D 2466      CLR	R6
    01D8E 2488      CLR	R8
    01D8F 2499      CLR	R9
    01D90 2826      OR	R2,R6
    01D91 2837      OR	R3,R7
    01D92 2848      OR	R4,R8
    01D93 2859      OR	R5,R9
    01D94 5AE6      SUBI	R30,0xA6
    01D95 4FFF      SBCI	R31,0xFF
    01D96 8060      LD	R6,Z
    01D97 55EA      SUBI	R30,0x5A
    01D98 40F0      SBCI	R31,0
    01D99 2477      CLR	R7
    01D9A 2488      CLR	R8
    01D9B 2499      CLR	R9
    01D9C 2826      OR	R2,R6
    01D9D 2837      OR	R3,R7
    01D9E 2848      OR	R4,R8
    01D9F 2859      OR	R5,R9
    01DA0 A222      STD	Z+34,R2
    01DA1 A233      STD	Z+35,R3
    01DA2 A244      STD	Z+36,R4
    01DA3 A255      STD	Z+37,R5
(2122) 		szbfat = fs->n_fatent * 4;						/* (Required FAT size) */
    01DA4 E082      LDI	R24,2
    01DA5 E090      LDI	R25,0
    01DA6 9676      ADIW	R30,0x16
    01DA7 8100      LD	R16,Z
    01DA8 8111      LDD	R17,Z+1
    01DA9 8122      LDD	R18,Z+2
    01DAA 8133      LDD	R19,Z+3
    01DAB 938A      ST	-Y,R24
    01DAC 940E 4BA8 CALL	lsl32
    01DAE 8F09      STD	Y+25,R16
    01DAF 8F1A      STD	Y+26,R17
    01DB0 8F2B      STD	Y+27,R18
    01DB1 8F3C      STD	Y+28,R19
(2123) 	} else {
    01DB2 C06A      RJMP	0x1E1D
(2124) 		if (!fs->n_rootdir)	return FR_NO_FILESYSTEM;	/* (BPB_RootEntCnt must not be 0) */
    01DB3 A1ED      LDD	R30,Y+37
    01DB4 A1FE      LDD	R31,Y+38
    01DB5 8420      LDD	R2,Z+8
    01DB6 8431      LDD	R3,Z+9
    01DB7 2022      TST	R2
    01DB8 F421      BNE	0x1DBD
    01DB9 2033      TST	R3
    01DBA F411      BNE	0x1DBD
    01DBB E00D      LDI	R16,0xD
    01DBC C1E8      RJMP	0x1FA5
(2125) 		fs->dirbase = fs->fatbase + fasize;				/* Root directory start sector */
    01DBD 802D      LDD	R2,Y+5
    01DBE 803E      LDD	R3,Y+6
    01DBF 804F      LDD	R4,Y+7
    01DC0 8458      LDD	R5,Y+8
    01DC1 A1ED      LDD	R30,Y+37
    01DC2 A1FE      LDD	R31,Y+38
    01DC3 8C66      LDD	R6,Z+30
    01DC4 8C77      LDD	R7,Z+31
    01DC5 A080      LDD	R8,Z+32
    01DC6 A091      LDD	R9,Z+33
    01DC7 0C62      ADD	R6,R2
    01DC8 1C73      ADC	R7,R3
    01DC9 1C84      ADC	R8,R4
    01DCA 1C95      ADC	R9,R5
    01DCB A262      STD	Z+34,R6
    01DCC A273      STD	Z+35,R7
    01DCD A284      STD	Z+36,R8
    01DCE A295      STD	Z+37,R9
(2126) 		szbfat = (fmt == FS_FAT16) ?					/* (Required FAT size) */
    01DCF 2D8C      MOV	R24,R12
    01DD0 3082      CPI	R24,2
    01DD1 F471      BNE	0x1DE0
    01DD2 9676      ADIW	R30,0x16
    01DD3 8020      LD	R2,Z
    01DD4 8031      LDD	R3,Z+1
    01DD5 8042      LDD	R4,Z+2
    01DD6 8053      LDD	R5,Z+3
    01DD7 0C22      LSL	R2
    01DD8 1C33      ROL	R3
    01DD9 1C44      ROL	R4
    01DDA 1C55      ROL	R5
    01DDB 8E2D      STD	Y+29,R2
    01DDC 8E3E      STD	Y+30,R3
    01DDD 8E4F      STD	Y+31,R4
    01DDE A258      STD	Y+32,R5
    01DDF C035      RJMP	0x1E15
    01DE0 A1ED      LDD	R30,Y+37
    01DE1 A1FE      LDD	R31,Y+38
    01DE2 9676      ADIW	R30,0x16
    01DE3 8020      LD	R2,Z
    01DE4 8031      LDD	R3,Z+1
    01DE5 8042      LDD	R4,Z+2
    01DE6 8053      LDD	R5,Z+3
    01DE7 A229      STD	Y+33,R2
    01DE8 A23A      STD	Y+34,R3
    01DE9 A24B      STD	Y+35,R4
    01DEA A25C      STD	Y+36,R5
    01DEB E041      LDI	R20,1
    01DEC E050      LDI	R21,0
    01DED E060      LDI	R22,0
    01DEE E070      LDI	R23,0
    01DEF A029      LDD	R2,Y+33
    01DF0 A03A      LDD	R3,Y+34
    01DF1 A04B      LDD	R4,Y+35
    01DF2 A05C      LDD	R5,Y+36
    01DF3 2224      AND	R2,R20
    01DF4 2235      AND	R3,R21
    01DF5 2246      AND	R4,R22
    01DF6 2257      AND	R5,R23
    01DF7 A069      LDD	R6,Y+33
    01DF8 A07A      LDD	R7,Y+34
    01DF9 A08B      LDD	R8,Y+35
    01DFA A09C      LDD	R9,Y+36
    01DFB E043      LDI	R20,3
    01DFC E050      LDI	R21,0
    01DFD E060      LDI	R22,0
    01DFE E070      LDI	R23,0
    01DFF 929A      ST	-Y,R9
    01E00 928A      ST	-Y,R8
    01E01 927A      ST	-Y,R7
    01E02 926A      ST	-Y,R6
    01E03 018A      MOVW	R16,R20
    01E04 019B      MOVW	R18,R22
    01E05 940E 4AC9 CALL	empy32s|empy32u
    01E07 0138      MOVW	R6,R16
    01E08 0149      MOVW	R8,R18
    01E09 9496      LSR	R9
    01E0A 9487      ROR	R8
    01E0B 9477      ROR	R7
    01E0C 9467      ROR	R6
    01E0D 0C62      ADD	R6,R2
    01E0E 1C73      ADC	R7,R3
    01E0F 1C84      ADC	R8,R4
    01E10 1C95      ADC	R9,R5
    01E11 8E6D      STD	Y+29,R6
    01E12 8E7E      STD	Y+30,R7
    01E13 8E8F      STD	Y+31,R8
    01E14 A298      STD	Y+32,R9
    01E15 8C2D      LDD	R2,Y+29
    01E16 8C3E      LDD	R3,Y+30
    01E17 8C4F      LDD	R4,Y+31
    01E18 A058      LDD	R5,Y+32
    01E19 8E29      STD	Y+25,R2
    01E1A 8E3A      STD	Y+26,R3
    01E1B 8E4B      STD	Y+27,R4
    01E1C 8E5C      STD	Y+28,R5
(2127) 			fs->n_fatent * 2 : fs->n_fatent * 3 / 2 + (fs->n_fatent & 1);
(2128) 	}
(2129) 	if (fs->fsize < (szbfat + (SS(fs) - 1)) / SS(fs))	/* (BPB_FATSz must not be less than required) */
    01E1D EF4F      LDI	R20,0xFF
    01E1E E051      LDI	R21,1
    01E1F E060      LDI	R22,0
    01E20 E070      LDI	R23,0
    01E21 8D09      LDD	R16,Y+25
    01E22 8D1A      LDD	R17,Y+26
    01E23 8D2B      LDD	R18,Y+27
    01E24 8D3C      LDD	R19,Y+28
    01E25 0F04      ADD	R16,R20
    01E26 1F15      ADC	R17,R21
    01E27 1F26      ADC	R18,R22
    01E28 1F37      ADC	R19,R23
    01E29 E089      LDI	R24,0x9
    01E2A E090      LDI	R25,0
    01E2B 938A      ST	-Y,R24
    01E2C 940E 4BC1 CALL	lsr32
    01E2E A1ED      LDD	R30,Y+37
    01E2F A1FE      LDD	R31,Y+38
    01E30 8C22      LDD	R2,Z+26
    01E31 8C33      LDD	R3,Z+27
    01E32 8C44      LDD	R4,Z+28
    01E33 8C55      LDD	R5,Z+29
    01E34 1620      CP	R2,R16
    01E35 0631      CPC	R3,R17
    01E36 0642      CPC	R4,R18
    01E37 0653      CPC	R5,R19
    01E38 F410      BCC	0x1E3B
(2130) 		return FR_NO_FILESYSTEM;
    01E39 E00D      LDI	R16,0xD
    01E3A C16A      RJMP	0x1FA5
(2131) 
(2132) #if !_FS_READONLY
(2133) 	/* Initialize cluster allocation information */
(2134) 	fs->free_clust = 0xFFFFFFFF;
    01E3B A1ED      LDD	R30,Y+37
    01E3C A1FE      LDD	R31,Y+38
    01E3D 963E      ADIW	R30,0xE
    01E3E EF8F      LDI	R24,0xFF
    01E3F 8380      ST	Z,R24
    01E40 8381      STD	Z+1,R24
    01E41 8382      STD	Z+2,R24
    01E42 8383      STD	Z+3,R24
(2135) 	fs->last_clust = 0;
    01E43 A1ED      LDD	R30,Y+37
    01E44 A1FE      LDD	R31,Y+38
    01E45 963A      ADIW	R30,0xA
    01E46 E080      LDI	R24,0
    01E47 8380      ST	Z,R24
    01E48 8381      STD	Z+1,R24
    01E49 8382      STD	Z+2,R24
    01E4A 8383      STD	Z+3,R24
(2136) 
(2137) 	/* Get fsinfo if available */
(2138) 	if (fmt == FS_FAT32) {
    01E4B 2D8C      MOV	R24,R12
    01E4C 3083      CPI	R24,3
    01E4D F009      BEQ	0x1E4F
    01E4E C13C      RJMP	0x1F8B
(2139) 	 	fs->fsi_flag = 0;
    01E4F 2422      CLR	R2
    01E50 A1ED      LDD	R30,Y+37
    01E51 A1FE      LDD	R31,Y+38
    01E52 8225      STD	Z+5,R2
(2140) 		fs->fsi_sector = bsect + LD_WORD(fs->win+BPB_FSInfo);
    01E53 5AE2      SUBI	R30,0xA2
    01E54 4FFF      SBCI	R31,0xFF
    01E55 8020      LD	R2,Z
    01E56 55EE      SUBI	R30,0x5E
    01E57 40F0      SBCI	R31,0
    01E58 2433      CLR	R3
    01E59 5AE1      SUBI	R30,0xA1
    01E5A 4FFF      SBCI	R31,0xFF
    01E5B 8040      LD	R4,Z
    01E5C 2455      CLR	R5
    01E5D 2C54      MOV	R5,R4
    01E5E 2444      CLR	R4
    01E5F 2842      OR	R4,R2
    01E60 2853      OR	R5,R3
    01E61 0112      MOVW	R2,R4
    01E62 2444      CLR	R4
    01E63 2455      CLR	R5
    01E64 8869      LDD	R6,Y+17
    01E65 887A      LDD	R7,Y+18
    01E66 888B      LDD	R8,Y+19
    01E67 889C      LDD	R9,Y+20
    01E68 0C62      ADD	R6,R2
    01E69 1C73      ADC	R7,R3
    01E6A 1C84      ADC	R8,R4
    01E6B 1C95      ADC	R9,R5
    01E6C A1ED      LDD	R30,Y+37
    01E6D A1FE      LDD	R31,Y+38
    01E6E 8A62      STD	Z+18,R6
    01E6F 8A73      STD	Z+19,R7
    01E70 8A84      STD	Z+20,R8
    01E71 8A95      STD	Z+21,R9
(2141) 		if (disk_read(fs->drv, fs->win, fs->fsi_sector, 1) == RES_OK &&
    01E72 E081      LDI	R24,1
    01E73 838C      STD	Y+4,R24
    01E74 8822      LDD	R2,Z+18
    01E75 8833      LDD	R3,Z+19
    01E76 8844      LDD	R4,Z+20
    01E77 8855      LDD	R5,Z+21
    01E78 8228      ST	Y,R2
    01E79 8239      STD	Y+1,R3
    01E7A 824A      STD	Y+2,R4
    01E7B 825B      STD	Y+3,R5
    01E7C 019F      MOVW	R18,R30
    01E7D 5D22      SUBI	R18,0xD2
    01E7E 4F3F      SBCI	R19,0xFF
    01E7F 8101      LDD	R16,Z+1
    01E80 940E 0BF7 CALL	_disk_read
    01E82 2EE0      MOV	R14,R16
    01E83 2300      TST	R16
    01E84 F009      BEQ	0x1E86
    01E85 C105      RJMP	0x1F8B
    01E86 A1ED      LDD	R30,Y+37
    01E87 A1FE      LDD	R31,Y+38
    01E88 5DE4      SUBI	R30,0xD4
    01E89 4FFD      SBCI	R31,0xFD
    01E8A 8020      LD	R2,Z
    01E8B 52EC      SUBI	R30,0x2C
    01E8C 40F2      SBCI	R31,2
    01E8D 2433      CLR	R3
    01E8E 5DE3      SUBI	R30,0xD3
    01E8F 4FFD      SBCI	R31,0xFD
    01E90 8180      LD	R24,Z
    01E91 52ED      SUBI	R30,0x2D
    01E92 40F2      SBCI	R31,2
    01E93 2799      CLR	R25
    01E94 2F98      MOV	R25,R24
    01E95 2788      CLR	R24
    01E96 2982      OR	R24,R2
    01E97 2993      OR	R25,R3
    01E98 3585      CPI	R24,0x55
    01E99 EAAA      LDI	R26,0xAA
    01E9A 079A      CPC	R25,R26
    01E9B F009      BEQ	0x1E9D
    01E9C C0EE      RJMP	0x1F8B
    01E9D E188      LDI	R24,0x18
    01E9E E090      LDI	R25,0
    01E9F A901      LDD	R16,Z+49
    01EA0 2711      CLR	R17
    01EA1 2722      CLR	R18
    01EA2 2733      CLR	R19
    01EA3 938A      ST	-Y,R24
    01EA4 940E 4BA8 CALL	lsl32
    01EA6 0118      MOVW	R2,R16
    01EA7 0129      MOVW	R4,R18
    01EA8 A1ED      LDD	R30,Y+37
    01EA9 A1FE      LDD	R31,Y+38
    01EAA A860      LDD	R6,Z+48
    01EAB 2477      CLR	R7
    01EAC 2488      CLR	R8
    01EAD 2499      CLR	R9
    01EAE 0143      MOVW	R8,R6
    01EAF 2466      CLR	R6
    01EB0 2477      CLR	R7
    01EB1 2826      OR	R2,R6
    01EB2 2837      OR	R3,R7
    01EB3 2848      OR	R4,R8
    01EB4 2859      OR	R5,R9
    01EB5 A467      LDD	R6,Z+47
    01EB6 2477      CLR	R7
    01EB7 2C76      MOV	R7,R6
    01EB8 2466      CLR	R6
    01EB9 2488      CLR	R8
    01EBA 2499      CLR	R9
    01EBB 2826      OR	R2,R6
    01EBC 2837      OR	R3,R7
    01EBD 2848      OR	R4,R8
    01EBE 2859      OR	R5,R9
    01EBF A466      LDD	R6,Z+46
    01EC0 2477      CLR	R7
    01EC1 2488      CLR	R8
    01EC2 2499      CLR	R9
    01EC3 2826      OR	R2,R6
    01EC4 2837      OR	R3,R7
    01EC5 2848      OR	R4,R8
    01EC6 2859      OR	R5,R9
    01EC7 E542      LDI	R20,0x52
    01EC8 E552      LDI	R21,0x52
    01EC9 E661      LDI	R22,0x61
    01ECA E471      LDI	R23,0x41
    01ECB 1624      CP	R2,R20
    01ECC 0635      CPC	R3,R21
    01ECD 0646      CPC	R4,R22
    01ECE 0657      CPC	R5,R23
    01ECF F009      BEQ	0x1ED1
    01ED0 C0BA      RJMP	0x1F8B
    01ED1 E188      LDI	R24,0x18
    01ED2 E090      LDI	R25,0
    01ED3 5EEB      SUBI	R30,0xEB
    01ED4 4FFD      SBCI	R31,0xFD
    01ED5 8100      LD	R16,Z
    01ED6 2711      CLR	R17
    01ED7 2722      CLR	R18
    01ED8 2733      CLR	R19
    01ED9 938A      ST	-Y,R24
    01EDA 940E 4BA8 CALL	lsl32
    01EDC 0118      MOVW	R2,R16
    01EDD 0129      MOVW	R4,R18
    01EDE A1ED      LDD	R30,Y+37
    01EDF A1FE      LDD	R31,Y+38
    01EE0 5EEC      SUBI	R30,0xEC
    01EE1 4FFD      SBCI	R31,0xFD
    01EE2 8060      LD	R6,Z
    01EE3 51E4      SUBI	R30,0x14
    01EE4 40F2      SBCI	R31,2
    01EE5 2477      CLR	R7
    01EE6 2488      CLR	R8
    01EE7 2499      CLR	R9
    01EE8 0143      MOVW	R8,R6
    01EE9 2466      CLR	R6
    01EEA 2477      CLR	R7
    01EEB 2826      OR	R2,R6
    01EEC 2837      OR	R3,R7
    01EED 2848      OR	R4,R8
    01EEE 2859      OR	R5,R9
    01EEF 5EED      SUBI	R30,0xED
    01EF0 4FFD      SBCI	R31,0xFD
    01EF1 8060      LD	R6,Z
    01EF2 51E3      SUBI	R30,0x13
    01EF3 40F2      SBCI	R31,2
    01EF4 2477      CLR	R7
    01EF5 2C76      MOV	R7,R6
    01EF6 2466      CLR	R6
    01EF7 2488      CLR	R8
    01EF8 2499      CLR	R9
    01EF9 2826      OR	R2,R6
    01EFA 2837      OR	R3,R7
    01EFB 2848      OR	R4,R8
    01EFC 2859      OR	R5,R9
    01EFD 5EEE      SUBI	R30,0xEE
    01EFE 4FFD      SBCI	R31,0xFD
    01EFF 8060      LD	R6,Z
    01F00 51E2      SUBI	R30,0x12
    01F01 40F2      SBCI	R31,2
    01F02 2477      CLR	R7
    01F03 2488      CLR	R8
    01F04 2499      CLR	R9
    01F05 2826      OR	R2,R6
    01F06 2837      OR	R3,R7
    01F07 2848      OR	R4,R8
    01F08 2859      OR	R5,R9
    01F09 E742      LDI	R20,0x72
    01F0A E752      LDI	R21,0x72
    01F0B E461      LDI	R22,0x41
    01F0C E671      LDI	R23,0x61
    01F0D 1624      CP	R2,R20
    01F0E 0635      CPC	R3,R21
    01F0F 0646      CPC	R4,R22
    01F10 0657      CPC	R5,R23
    01F11 F009      BEQ	0x1F13
    01F12 C078      RJMP	0x1F8B
(2142) 			LD_WORD(fs->win+BS_55AA) == 0xAA55 &&
(2143) 			LD_DWORD(fs->win+FSI_LeadSig) == 0x41615252 &&
(2144) 			LD_DWORD(fs->win+FSI_StrucSig) == 0x61417272) {
(2145) 				fs->last_clust = LD_DWORD(fs->win+FSI_Nxt_Free);
    01F13 E188      LDI	R24,0x18
    01F14 E090      LDI	R25,0
    01F15 5EE3      SUBI	R30,0xE3
    01F16 4FFD      SBCI	R31,0xFD
    01F17 8100      LD	R16,Z
    01F18 2711      CLR	R17
    01F19 2722      CLR	R18
    01F1A 2733      CLR	R19
    01F1B 938A      ST	-Y,R24
    01F1C 940E 4BA8 CALL	lsl32
    01F1E 0118      MOVW	R2,R16
    01F1F 0129      MOVW	R4,R18
    01F20 A1ED      LDD	R30,Y+37
    01F21 A1FE      LDD	R31,Y+38
    01F22 5EE4      SUBI	R30,0xE4
    01F23 4FFD      SBCI	R31,0xFD
    01F24 8060      LD	R6,Z
    01F25 51EC      SUBI	R30,0x1C
    01F26 40F2      SBCI	R31,2
    01F27 2477      CLR	R7
    01F28 2488      CLR	R8
    01F29 2499      CLR	R9
    01F2A 0143      MOVW	R8,R6
    01F2B 2466      CLR	R6
    01F2C 2477      CLR	R7
    01F2D 2826      OR	R2,R6
    01F2E 2837      OR	R3,R7
    01F2F 2848      OR	R4,R8
    01F30 2859      OR	R5,R9
    01F31 5EE5      SUBI	R30,0xE5
    01F32 4FFD      SBCI	R31,0xFD
    01F33 8060      LD	R6,Z
    01F34 51EB      SUBI	R30,0x1B
    01F35 40F2      SBCI	R31,2
    01F36 2477      CLR	R7
    01F37 2C76      MOV	R7,R6
    01F38 2466      CLR	R6
    01F39 2488      CLR	R8
    01F3A 2499      CLR	R9
    01F3B 2826      OR	R2,R6
    01F3C 2837      OR	R3,R7
    01F3D 2848      OR	R4,R8
    01F3E 2859      OR	R5,R9
    01F3F 5EE6      SUBI	R30,0xE6
    01F40 4FFD      SBCI	R31,0xFD
    01F41 8060      LD	R6,Z
    01F42 51EA      SUBI	R30,0x1A
    01F43 40F2      SBCI	R31,2
    01F44 2477      CLR	R7
    01F45 2488      CLR	R8
    01F46 2499      CLR	R9
    01F47 2826      OR	R2,R6
    01F48 2837      OR	R3,R7
    01F49 2848      OR	R4,R8
    01F4A 2859      OR	R5,R9
    01F4B 8622      STD	Z+10,R2
    01F4C 8633      STD	Z+11,R3
    01F4D 8644      STD	Z+12,R4
    01F4E 8655      STD	Z+13,R5
(2146) 				fs->free_clust = LD_DWORD(fs->win+FSI_Free_Count);
    01F4F E188      LDI	R24,0x18
    01F50 E090      LDI	R25,0
    01F51 5EE7      SUBI	R30,0xE7
    01F52 4FFD      SBCI	R31,0xFD
    01F53 8100      LD	R16,Z
    01F54 2711      CLR	R17
    01F55 2722      CLR	R18
    01F56 2733      CLR	R19
    01F57 938A      ST	-Y,R24
    01F58 940E 4BA8 CALL	lsl32
    01F5A 0118      MOVW	R2,R16
    01F5B 0129      MOVW	R4,R18
    01F5C A1ED      LDD	R30,Y+37
    01F5D A1FE      LDD	R31,Y+38
    01F5E 5EE8      SUBI	R30,0xE8
    01F5F 4FFD      SBCI	R31,0xFD
    01F60 8060      LD	R6,Z
    01F61 51E8      SUBI	R30,0x18
    01F62 40F2      SBCI	R31,2
    01F63 2477      CLR	R7
    01F64 2488      CLR	R8
    01F65 2499      CLR	R9
    01F66 0143      MOVW	R8,R6
    01F67 2466      CLR	R6
    01F68 2477      CLR	R7
    01F69 2826      OR	R2,R6
    01F6A 2837      OR	R3,R7
    01F6B 2848      OR	R4,R8
    01F6C 2859      OR	R5,R9
    01F6D 5EE9      SUBI	R30,0xE9
    01F6E 4FFD      SBCI	R31,0xFD
    01F6F 8060      LD	R6,Z
    01F70 51E7      SUBI	R30,0x17
    01F71 40F2      SBCI	R31,2
    01F72 2477      CLR	R7
    01F73 2C76      MOV	R7,R6
    01F74 2466      CLR	R6
    01F75 2488      CLR	R8
    01F76 2499      CLR	R9
    01F77 2826      OR	R2,R6
    01F78 2837      OR	R3,R7
    01F79 2848      OR	R4,R8
    01F7A 2859      OR	R5,R9
    01F7B 5EEA      SUBI	R30,0xEA
    01F7C 4FFD      SBCI	R31,0xFD
    01F7D 8060      LD	R6,Z
    01F7E 51E6      SUBI	R30,0x16
    01F7F 40F2      SBCI	R31,2
    01F80 2477      CLR	R7
    01F81 2488      CLR	R8
    01F82 2499      CLR	R9
    01F83 2826      OR	R2,R6
    01F84 2837      OR	R3,R7
    01F85 2848      OR	R4,R8
    01F86 2859      OR	R5,R9
    01F87 8626      STD	Z+14,R2
    01F88 8637      STD	Z+15,R3
    01F89 8A40      STD	Z+16,R4
    01F8A 8A51      STD	Z+17,R5
(2147) 		}
(2148) 	}
(2149) #endif
(2150) 	fs->fs_type = fmt;		/* FAT sub-type */
    01F8B A1ED      LDD	R30,Y+37
    01F8C A1FE      LDD	R31,Y+38
    01F8D 82C0      ST	Z,R12
(2151) 	fs->id = ++Fsid;		/* File system mount ID */
    01F8E 9180 08C1 LDS	R24,ff.c:Fsid
    01F90 9190 08C2 LDS	R25,ff.c:Fsid+1
    01F92 9601      ADIW	R24,1
    01F93 016C      MOVW	R12,R24
    01F94 92D0 08C2 STS	ff.c:Fsid+1,R13
    01F96 92C0 08C1 STS	ff.c:Fsid,R12
    01F98 82D7      STD	Z+7,R13
    01F99 82C6      STD	Z+6,R12
(2152) 	fs->winsect = 0;		/* Invalidate sector cache */
    01F9A 96BA      ADIW	R30,0x2A
    01F9B E080      LDI	R24,0
    01F9C 8380      ST	Z,R24
    01F9D 8381      STD	Z+1,R24
    01F9E 8382      STD	Z+2,R24
    01F9F 8383      STD	Z+3,R24
(2153) 	fs->wflag = 0;
    01FA0 2422      CLR	R2
    01FA1 A1ED      LDD	R30,Y+37
    01FA2 A1FE      LDD	R31,Y+38
    01FA3 8224      STD	Z+4,R2
(2154) #if _FS_RPATH
(2155) 	fs->cdir = 0;			/* Current directory (root dir) */
(2156) #endif
(2157) #if _FS_SHARE				/* Clear file lock semaphores */
(2158) 	clear_lock(fs);
(2159) #endif
(2160) 
(2161) 	return FR_OK;
    01FA4 2700      CLR	R16
    01FA5 96A7      ADIW	R28,0x27
    01FA6 940E 4B12 CALL	pop_xgsetF0FC
    01FA8 9622      ADIW	R28,2
    01FA9 9508      RET
ff.c:validate:
  id                   --> R10
  fs                   --> R20
    01FAA 940E 4B28 CALL	push_xgset300C
    01FAC 0159      MOVW	R10,R18
    01FAD 01A8      MOVW	R20,R16
(2162) }
(2163) 
(2164) 
(2165) 
(2166) 
(2167) /*-----------------------------------------------------------------------*/
(2168) /* Check if the file/dir object is valid or not                          */
(2169) /*-----------------------------------------------------------------------*/
(2170) 
(2171) static
(2172) FRESULT validate (	/* FR_OK(0): The object is valid, !=0: Invalid */
(2173) 	FATFS *fs,		/* Pointer to the file system object */
(2174) 	WORD id			/* Member id of the target object to be checked */
(2175) )
(2176) {
(2177) 	if (!fs || !fs->fs_type || fs->id != id)
    01FAE 3040      CPI	R20,0
    01FAF 0745      CPC	R20,R21
    01FB0 F049      BEQ	0x1FBA
    01FB1 01FA      MOVW	R30,R20
    01FB2 8020      LD	R2,Z
    01FB3 2022      TST	R2
    01FB4 F029      BEQ	0x1FBA
    01FB5 8026      LDD	R2,Z+6
    01FB6 8037      LDD	R3,Z+7
    01FB7 142A      CP	R2,R10
    01FB8 043B      CPC	R3,R11
    01FB9 F011      BEQ	0x1FBC
(2178) 		return FR_INVALID_OBJECT;
    01FBA E009      LDI	R16,0x9
    01FBB C009      RJMP	0x1FC5
(2179) 
(2180) 	ENTER_FF(fs);		/* Lock file system */
(2181) 
(2182) 	if (disk_status(fs->drv) & STA_NOINIT)
    01FBC 01FA      MOVW	R30,R20
    01FBD 8101      LDD	R16,Z+1
    01FBE 940E 0BF1 CALL	_disk_status
    01FC0 FF00      SBRS	R16,0
    01FC1 C002      RJMP	0x1FC4
(2183) 		return FR_NOT_READY;
    01FC2 E003      LDI	R16,3
    01FC3 C001      RJMP	0x1FC5
(2184) 
(2185) 	return FR_OK;
    01FC4 2700      CLR	R16
    01FC5 940C 4B2D JMP	pop_xgset300C
_f_mount:
  rfs                  --> R10
  fs                   --> R18
  vol                  --> R16
    01FC7 92AA      ST	-Y,R10
    01FC8 92BA      ST	-Y,R11
(2186) }
(2187) 
(2188) 
(2189) 
(2190) 
(2191) /*--------------------------------------------------------------------------
(2192) 
(2193)    Public Functions
(2194) 
(2195) --------------------------------------------------------------------------*/
(2196) 
(2197) 
(2198) 
(2199) /*-----------------------------------------------------------------------*/
(2200) /* Mount/Unmount a Logical Drive                                         */
(2201) /*-----------------------------------------------------------------------*/
(2202) 
(2203) FRESULT f_mount (
(2204) 	BYTE vol,		/* Logical drive number to be mounted/unmounted */
(2205) 	FATFS *fs		/* Pointer to new file system object (NULL for unmount)*/
(2206) )
(2207) {
(2208) 	FATFS *rfs;
(2209) 
(2210) 
(2211) 	if (vol >= _VOLUMES)		/* Check if the drive number is valid */
    01FC9 3001      CPI	R16,1
    01FCA F010      BCS	0x1FCD
(2212) 		return FR_INVALID_DRIVE;
    01FCB E00B      LDI	R16,0xB
    01FCC C022      RJMP	0x1FEF
(2213) 	rfs = FatFs[vol];			/* Get current fs object */
    01FCD EC83      LDI	R24,0xC3
    01FCE E098      LDI	R25,0x8
    01FCF 2FE0      MOV	R30,R16
    01FD0 27FF      CLR	R31
    01FD1 0FEE      LSL	R30
    01FD2 1FFF      ROL	R31
    01FD3 0FE8      ADD	R30,R24
    01FD4 1FF9      ADC	R31,R25
    01FD5 80A0      LD	R10,Z
    01FD6 80B1      LDD	R11,Z+1
(2214) 
(2215) 	if (rfs) {
    01FD7 20AA      TST	R10
    01FD8 F411      BNE	0x1FDB
    01FD9 20BB      TST	R11
    01FDA F019      BEQ	0x1FDE
(2216) #if _FS_SHARE
(2217) 		clear_lock(rfs);
(2218) #endif
(2219) #if _FS_REENTRANT				/* Discard sync object of the current volume */
(2220) 		if (!ff_del_syncobj(rfs->sobj)) return FR_INT_ERR;
(2221) #endif
(2222) 		rfs->fs_type = 0;		/* Clear old fs object */
    01FDB 2422      CLR	R2
    01FDC 01F5      MOVW	R30,R10
    01FDD 8220      ST	Z,R2
(2223) 	}
(2224) 
(2225) 	if (fs) {
    01FDE 3020      CPI	R18,0
    01FDF 0723      CPC	R18,R19
    01FE0 F019      BEQ	0x1FE4
(2226) 		fs->fs_type = 0;		/* Clear new fs object */
    01FE1 2422      CLR	R2
    01FE2 01F9      MOVW	R30,R18
    01FE3 8220      ST	Z,R2
(2227) #if _FS_REENTRANT				/* Create sync object for the new volume */
(2228) 		if (!ff_cre_syncobj(vol, &fs->sobj)) return FR_INT_ERR;
(2229) #endif
(2230) 	}
(2231) 	FatFs[vol] = fs;			/* Register new fs object */
    01FE4 EC83      LDI	R24,0xC3
    01FE5 E098      LDI	R25,0x8
    01FE6 2FE0      MOV	R30,R16
    01FE7 27FF      CLR	R31
    01FE8 0FEE      LSL	R30
    01FE9 1FFF      ROL	R31
    01FEA 0FE8      ADD	R30,R24
    01FEB 1FF9      ADC	R31,R25
    01FEC 8331      STD	Z+1,R19
    01FED 8320      ST	Z,R18
(2232) 
(2233) 	return FR_OK;
    01FEE 2700      CLR	R16
    01FEF 90B9      LD	R11,Y+
    01FF0 90A9      LD	R10,Y+
    01FF1 9508      RET
_f_open:
  cl                   --> Y,+40
  dw                   --> Y,+36
  sfn                  --> Y,+24
  dj                   --> Y,+2
  res                  --> R10
  dir                  --> R14
  mode                 --> Y,+58
  path                 --> Y,+56
  fp                   --> Y,+54
    01FF2 940E 49D8 CALL	push_arg4
    01FF4 940E 4B1D CALL	push_xgsetF0FC
    01FF6 97AC      SBIW	R28,0x2C
(2234) }
(2235) 
(2236) 
(2237) 
(2238) 
(2239) /*-----------------------------------------------------------------------*/
(2240) /* Open or Create a File                                                 */
(2241) /*-----------------------------------------------------------------------*/
(2242) 
(2243) FRESULT f_open (
(2244) 	FIL *fp,			/* Pointer to the blank file object */
(2245) 	const TCHAR *path,	/* Pointer to the file name */
(2246) 	BYTE mode			/* Access mode and file open mode flags */
(2247) )
(2248) {
(2249) 	FRESULT res;
(2250) 	DIR dj;
(2251) 	BYTE *dir;
(2252) 	DEF_NAMEBUF;
(2253) 
(2254) 
(2255) 	fp->fs = 0;			/* Clear file object */
    01FF7 2422      CLR	R2
    01FF8 2433      CLR	R3
    01FF9 A9EE      LDD	R30,Y+54
    01FFA A9FF      LDD	R31,Y+55
    01FFB 8231      STD	Z+1,R3
    01FFC 8220      ST	Z,R2
(2256) 
(2257) #if !_FS_READONLY
(2258) 	mode &= FA_READ | FA_WRITE | FA_CREATE_ALWAYS | FA_OPEN_ALWAYS | FA_CREATE_NEW;
    01FFD AD8A      LDD	R24,Y+58
    01FFE 718F      ANDI	R24,0x1F
    01FFF AF8A      STD	Y+58,R24
(2259) 	res = chk_mounted(&path, &dj.fs, (BYTE)(mode & ~FA_READ));
    02000 2799      CLR	R25
    02001 7F8E      ANDI	R24,0xFE
    02002 8388      ST	Y,R24
    02003 019E      MOVW	R18,R28
    02004 5F2E      SUBI	R18,0xFE
    02005 4F3F      SBCI	R19,0xFF
    02006 018E      MOVW	R16,R28
    02007 5C08      SUBI	R16,0xC8
    02008 4F1F      SBCI	R17,0xFF
    02009 DAA6      RCALL	ff.c:chk_mounted
    0200A 2EA0      MOV	R10,R16
(2260) #else
(2261) 	mode &= FA_READ;
(2262) 	res = chk_mounted(&path, &dj.fs, 0);
(2263) #endif
(2264) 	INIT_BUF(dj);
    0200B 01CE      MOVW	R24,R28
    0200C 9648      ADIW	R24,0x18
    0200D 8B9F      STD	Y+23,R25
    0200E 8B8E      STD	Y+22,R24
(2265) 	if (res == FR_OK)
    0200F 2300      TST	R16
    02010 F439      BNE	0x2018
(2266) 		res = follow_path(&dj, path);	/* Follow the file path */
    02011 AD28      LDD	R18,Y+56
    02012 AD39      LDD	R19,Y+57
    02013 018E      MOVW	R16,R28
    02014 5F0E      SUBI	R16,0xFE
    02015 4F1F      SBCI	R17,0xFF
    02016 D94D      RCALL	ff.c:follow_path
    02017 2EA0      MOV	R10,R16
(2267) 	dir = dj.dir;
    02018 88EC      LDD	R14,Y+20
    02019 88FD      LDD	R15,Y+21
(2268) 
(2269) #if !_FS_READONLY	/* R/W configuration */
(2270) 	if (res == FR_OK) {
    0201A 20AA      TST	R10
    0201B F431      BNE	0x2022
(2271) 		if (!dir)	/* Current dir itself */
    0201C 20EE      TST	R14
    0201D F421      BNE	0x2022
    0201E 20FF      TST	R15
    0201F F411      BNE	0x2022
(2272) 			res = FR_INVALID_NAME;
    02020 E086      LDI	R24,6
    02021 2EA8      MOV	R10,R24
(2273) #if _FS_SHARE
(2274) 		else
(2275) 			res = chk_lock(&dj, (mode & ~FA_READ) ? 1 : 0);
(2276) #endif
(2277) 	}
(2278) 	/* Create or Open a file */
(2279) 	if (mode & (FA_CREATE_ALWAYS | FA_OPEN_ALWAYS | FA_CREATE_NEW)) {
    02022 AD8A      LDD	R24,Y+58
    02023 718C      ANDI	R24,0x1C
    02024 F409      BNE	0x2026
    02025 C0C0      RJMP	0x20E6
(2280) 		DWORD dw, cl;
(2281) 
(2282) 		if (res != FR_OK) {					/* No file, create new */
    02026 20AA      TST	R10
    02027 F081      BEQ	0x2038
(2283) 			if (res == FR_NO_FILE)			/* There is no file to open, create a new entry */
    02028 2D8A      MOV	R24,R10
    02029 3084      CPI	R24,4
    0202A F439      BNE	0x2032
(2284) #if _FS_SHARE
(2285) 				res = enq_lock() ? dir_register(&dj) : FR_TOO_MANY_OPEN_FILES;
(2286) #else
(2287) 				res = dir_register(&dj);
    0202B 018E      MOVW	R16,R28
    0202C 5F0E      SUBI	R16,0xFE
    0202D 4F1F      SBCI	R17,0xFF
    0202E 940E 1756 CALL	ff.c:dir_register
    02030 2EC0      MOV	R12,R16
    02031 2CAC      MOV	R10,R12
(2288) #endif
(2289) 			mode |= FA_CREATE_ALWAYS;		/* File is created */
    02032 AD8A      LDD	R24,Y+58
    02033 6088      ORI	R24,0x8
    02034 AF8A      STD	Y+58,R24
(2290) 			dir = dj.dir;					/* New entry */
    02035 88EC      LDD	R14,Y+20
    02036 88FD      LDD	R15,Y+21
(2291) 		}
    02037 C00C      RJMP	0x2044
(2292) 		else {								/* Any object is already existing */
(2293) 			if (dir[DIR_Attr] & (AM_RDO | AM_DIR)) {	/* Cannot overwrite it (R/O or DIR) */
    02038 01F7      MOVW	R30,R14
    02039 8583      LDD	R24,Z+11
    0203A 7181      ANDI	R24,0x11
    0203B F019      BEQ	0x203F
(2294) 				res = FR_DENIED;
    0203C E087      LDI	R24,7
    0203D 2EA8      MOV	R10,R24
(2295) 			} else {
    0203E C005      RJMP	0x2044
(2296) 				if (mode & FA_CREATE_NEW)	/* Cannot create as new file */
    0203F AC0A      LDD	R0,Y+58
    02040 FE02      SBRS	R0,2
    02041 C002      RJMP	0x2044
(2297) 					res = FR_EXIST;
    02042 E088      LDI	R24,0x8
    02043 2EA8      MOV	R10,R24
(2298) 			}
(2299) 		}
(2300) 		if (res == FR_OK && (mode & FA_CREATE_ALWAYS)) {	/* Truncate it if overwrite mode */
    02044 20AA      TST	R10
    02045 F009      BEQ	0x2047
    02046 C0B1      RJMP	0x20F8
    02047 AC0A      LDD	R0,Y+58
    02048 FE03      SBRS	R0,3
    02049 C0AE      RJMP	0x20F8
(2301) 			dw = get_fattime();					/* Created time */
    0204A 940E 0C34 CALL	_get_fattime
    0204C A30C      STD	Y+36,R16
    0204D A31D      STD	Y+37,R17
    0204E A32E      STD	Y+38,R18
    0204F A33F      STD	Y+39,R19
(2302) 			ST_DWORD(dir+DIR_CrtTime, dw);
    02050 A02C      LDD	R2,Y+36
    02051 A03D      LDD	R3,Y+37
    02052 A04E      LDD	R4,Y+38
    02053 A05F      LDD	R5,Y+39
    02054 01F7      MOVW	R30,R14
    02055 8626      STD	Z+14,R2
    02056 2C23      MOV	R2,R3
    02057 2433      CLR	R3
    02058 963F      ADIW	R30,0xF
    02059 8220      ST	Z,R2
    0205A A02C      LDD	R2,Y+36
    0205B A03D      LDD	R3,Y+37
    0205C A04E      LDD	R4,Y+38
    0205D A05F      LDD	R5,Y+39
    0205E 0112      MOVW	R2,R4
    0205F 2444      CLR	R4
    02060 2455      CLR	R5
    02061 01F7      MOVW	R30,R14
    02062 9670      ADIW	R30,0x10
    02063 8220      ST	Z,R2
    02064 E188      LDI	R24,0x18
    02065 E090      LDI	R25,0
    02066 A10C      LDD	R16,Y+36
    02067 A11D      LDD	R17,Y+37
    02068 A12E      LDD	R18,Y+38
    02069 A13F      LDD	R19,Y+39
    0206A 938A      ST	-Y,R24
    0206B 940E 4BC1 CALL	lsr32
    0206D 01F7      MOVW	R30,R14
    0206E 8B01      STD	Z+17,R16
(2303) 			dir[DIR_Attr] = 0;					/* Reset attribute */
    0206F 2422      CLR	R2
    02070 8623      STD	Z+11,R2
(2304) 			ST_DWORD(dir+DIR_FileSize, 0);		/* size = 0 */
    02071 8E24      STD	Z+28,R2
    02072 8E25      STD	Z+29,R2
    02073 8E26      STD	Z+30,R2
    02074 8E27      STD	Z+31,R2
(2305) 			cl = LD_CLUST(dir);					/* Get start cluster */
    02075 8C22      LDD	R2,Z+26
    02076 2433      CLR	R3
    02077 8C43      LDD	R4,Z+27
    02078 2455      CLR	R5
    02079 2C54      MOV	R5,R4
    0207A 2444      CLR	R4
    0207B 2842      OR	R4,R2
    0207C 2853      OR	R5,R3
    0207D 0112      MOVW	R2,R4
    0207E 2444      CLR	R4
    0207F 2455      CLR	R5
    02080 8864      LDD	R6,Z+20
    02081 2477      CLR	R7
    02082 9675      ADIW	R30,0x15
    02083 8080      LD	R8,Z
    02084 2499      CLR	R9
    02085 2C98      MOV	R9,R8
    02086 2488      CLR	R8
    02087 2886      OR	R8,R6
    02088 2897      OR	R9,R7
    02089 0134      MOVW	R6,R8
    0208A 2488      CLR	R8
    0208B 2499      CLR	R9
    0208C 0143      MOVW	R8,R6
    0208D 2466      CLR	R6
    0208E 2477      CLR	R7
    0208F 2862      OR	R6,R2
    02090 2873      OR	R7,R3
    02091 2884      OR	R8,R4
    02092 2895      OR	R9,R5
    02093 A668      STD	Y+40,R6
    02094 A679      STD	Y+41,R7
    02095 A68A      STD	Y+42,R8
    02096 A69B      STD	Y+43,R9
(2306) 			ST_CLUST(dir, 0);					/* cluster = 0 */
    02097 2422      CLR	R2
    02098 01F7      MOVW	R30,R14
    02099 8E22      STD	Z+26,R2
    0209A 8E23      STD	Z+27,R2
    0209B 8A24      STD	Z+20,R2
    0209C 8A25      STD	Z+21,R2
(2307) 			dj.fs->wflag = 1;
    0209D E081      LDI	R24,1
    0209E 81EA      LDD	R30,Y+2
    0209F 81FB      LDD	R31,Y+3
    020A0 9634      ADIW	R30,4
    020A1 8380      ST	Z,R24
(2308) 			if (cl) {							/* Remove the cluster chain if exist */
    020A2 A428      LDD	R2,Y+40
    020A3 A439      LDD	R3,Y+41
    020A4 A44A      LDD	R4,Y+42
    020A5 A45B      LDD	R5,Y+43
    020A6 9488      BCLR	0
    020A7 2022      TST	R2
    020A8 0432      CPC	R3,R2
    020A9 0442      CPC	R4,R2
    020AA 0452      CPC	R5,R2
    020AB F409      BNE	0x20AD
    020AC C04B      RJMP	0x20F8
(2309) 				dw = dj.fs->winsect;
    020AD 81EA      LDD	R30,Y+2
    020AE 81FB      LDD	R31,Y+3
    020AF A422      LDD	R2,Z+42
    020B0 A433      LDD	R3,Z+43
    020B1 A444      LDD	R4,Z+44
    020B2 A455      LDD	R5,Z+45
    020B3 A22C      STD	Y+36,R2
    020B4 A23D      STD	Y+37,R3
    020B5 A24E      STD	Y+38,R4
    020B6 A25F      STD	Y+39,R5
(2310) 				res = remove_chain(dj.fs, cl);
    020B7 A428      LDD	R2,Y+40
    020B8 A439      LDD	R3,Y+41
    020B9 A44A      LDD	R4,Y+42
    020BA A45B      LDD	R5,Y+43
    020BB 8248      ST	Y,R4
    020BC 8259      STD	Y+1,R5
    020BD 0191      MOVW	R18,R2
    020BE 810A      LDD	R16,Y+2
    020BF 811B      LDD	R17,Y+3
    020C0 940E 116A CALL	ff.c:remove_chain
    020C2 2EC0      MOV	R12,R16
    020C3 2CAC      MOV	R10,R12
(2311) 				if (res == FR_OK) {
    020C4 2300      TST	R16
    020C5 F591      BNE	0x20F8
(2312) 					dj.fs->last_clust = cl - 1;	/* Reuse the cluster hole */
    020C6 E041      LDI	R20,1
    020C7 E050      LDI	R21,0
    020C8 E060      LDI	R22,0
    020C9 E070      LDI	R23,0
    020CA A428      LDD	R2,Y+40
    020CB A439      LDD	R3,Y+41
    020CC A44A      LDD	R4,Y+42
    020CD A45B      LDD	R5,Y+43
    020CE 1A24      SUB	R2,R20
    020CF 0A35      SBC	R3,R21
    020D0 0A46      SBC	R4,R22
    020D1 0A57      SBC	R5,R23
    020D2 81EA      LDD	R30,Y+2
    020D3 81FB      LDD	R31,Y+3
    020D4 8622      STD	Z+10,R2
    020D5 8633      STD	Z+11,R3
    020D6 8644      STD	Z+12,R4
    020D7 8655      STD	Z+13,R5
(2313) 					res = move_window(dj.fs, dw);
    020D8 A02C      LDD	R2,Y+36
    020D9 A03D      LDD	R3,Y+37
    020DA A04E      LDD	R4,Y+38
    020DB A05F      LDD	R5,Y+39
    020DC 8248      ST	Y,R4
    020DD 8259      STD	Y+1,R5
    020DE 0191      MOVW	R18,R2
    020DF 810A      LDD	R16,Y+2
    020E0 811B      LDD	R17,Y+3
    020E1 940E 0C92 CALL	ff.c:move_window
    020E3 2EC0      MOV	R12,R16
    020E4 2CAC      MOV	R10,R12
(2314) 				}
(2315) 			}
(2316) 		}
(2317) 	}
    020E5 C012      RJMP	0x20F8
(2318) 	else {	/* Open an existing file */
(2319) 		if (res == FR_OK) {						/* Follow succeeded */
    020E6 20AA      TST	R10
    020E7 F481      BNE	0x20F8
(2320) 			if (dir[DIR_Attr] & AM_DIR) {		/* It is a directory */
    020E8 01F7      MOVW	R30,R14
    020E9 8423      LDD	R2,Z+11
    020EA FE24      SBRS	R2,4
    020EB C003      RJMP	0x20EF
(2321) 				res = FR_NO_FILE;
    020EC E084      LDI	R24,4
    020ED 2EA8      MOV	R10,R24
(2322) 			} else {
    020EE C009      RJMP	0x20F8
(2323) 				if ((mode & FA_WRITE) && (dir[DIR_Attr] & AM_RDO)) /* R/O violation */
    020EF AC0A      LDD	R0,Y+58
    020F0 FE01      SBRS	R0,1
    020F1 C006      RJMP	0x20F8
    020F2 01F7      MOVW	R30,R14
    020F3 8423      LDD	R2,Z+11
    020F4 FE20      SBRS	R2,0
    020F5 C002      RJMP	0x20F8
(2324) 					res = FR_DENIED;
    020F6 E087      LDI	R24,7
    020F7 2EA8      MOV	R10,R24
(2325) 			}
(2326) 		}
(2327) 	}
(2328) 	if (res == FR_OK) {
    020F8 20AA      TST	R10
    020F9 F4A1      BNE	0x210E
(2329) 		if (mode & FA_CREATE_ALWAYS)			/* Set file change flag if created or overwritten */
    020FA AC0A      LDD	R0,Y+58
    020FB FE03      SBRS	R0,3
    020FC C003      RJMP	0x2100
(2330) 			mode |= FA__WRITTEN;
    020FD 2D80      MOV	R24,R0
    020FE 6280      ORI	R24,0x20
    020FF AF8A      STD	Y+58,R24
(2331) 		fp->dir_sect = dj.fs->winsect;			/* Pointer to the directory entry */
    02100 81EA      LDD	R30,Y+2
    02101 81FB      LDD	R31,Y+3
    02102 A422      LDD	R2,Z+42
    02103 A433      LDD	R3,Z+43
    02104 A444      LDD	R4,Z+44
    02105 A455      LDD	R5,Z+45
    02106 A9EE      LDD	R30,Y+54
    02107 A9FF      LDD	R31,Y+55
    02108 8E22      STD	Z+26,R2
    02109 8E33      STD	Z+27,R3
    0210A 8E44      STD	Z+28,R4
    0210B 8E55      STD	Z+29,R5
(2332) 		fp->dir_ptr = dir;
    0210C 8EF7      STD	Z+31,R15
    0210D 8EE6      STD	Z+30,R14
(2333) #if _FS_SHARE
(2334) 		fp->lockid = inc_lock(&dj, (mode & ~FA_READ) ? 1 : 0);
(2335) 		if (!fp->lockid) res = FR_INT_ERR;
(2336) #endif
(2337) 	}
(2338) 
(2339) #else				/* R/O configuration */
(2340) 	if (res == FR_OK) {					/* Follow succeeded */
(2341) 		if (!dir) {						/* Current dir itself */
(2342) 			res = FR_INVALID_NAME;
(2343) 		} else {
(2344) 			if (dir[DIR_Attr] & AM_DIR)	/* It is a directory */
(2345) 				res = FR_NO_FILE;
(2346) 		}
(2347) 	}
(2348) #endif
(2349) 	FREE_BUF();
(2350) 
(2351) 	if (res == FR_OK) {
    0210E 20AA      TST	R10
    0210F F009      BEQ	0x2111
    02110 C077      RJMP	0x2188
(2352) 		fp->flag = mode;					/* File access mode */
    02111 A9EE      LDD	R30,Y+54
    02112 A9FF      LDD	R31,Y+55
    02113 AC0A      LDD	R0,Y+58
    02114 8204      STD	Z+4,R0
(2353) 		fp->sclust = LD_CLUST(dir);			/* File start cluster */
    02115 01F7      MOVW	R30,R14
    02116 8C22      LDD	R2,Z+26
    02117 2433      CLR	R3
    02118 8C43      LDD	R4,Z+27
    02119 2455      CLR	R5
    0211A 2C54      MOV	R5,R4
    0211B 2444      CLR	R4
    0211C 2842      OR	R4,R2
    0211D 2853      OR	R5,R3
    0211E 0112      MOVW	R2,R4
    0211F 2444      CLR	R4
    02120 2455      CLR	R5
    02121 8864      LDD	R6,Z+20
    02122 2477      CLR	R7
    02123 8885      LDD	R8,Z+21
    02124 2499      CLR	R9
    02125 2C98      MOV	R9,R8
    02126 2488      CLR	R8
    02127 2886      OR	R8,R6
    02128 2897      OR	R9,R7
    02129 0134      MOVW	R6,R8
    0212A 2488      CLR	R8
    0212B 2499      CLR	R9
    0212C 0143      MOVW	R8,R6
    0212D 2466      CLR	R6
    0212E 2477      CLR	R7
    0212F 2862      OR	R6,R2
    02130 2873      OR	R7,R3
    02131 2884      OR	R8,R4
    02132 2895      OR	R9,R5
    02133 A9EE      LDD	R30,Y+54
    02134 A9FF      LDD	R31,Y+55
    02135 8666      STD	Z+14,R6
    02136 8677      STD	Z+15,R7
    02137 8A80      STD	Z+16,R8
    02138 8A91      STD	Z+17,R9
(2354) 		fp->fsize = LD_DWORD(dir+DIR_FileSize);	/* File size */
    02139 E188      LDI	R24,0x18
    0213A E090      LDI	R25,0
    0213B 01F7      MOVW	R30,R14
    0213C 8D07      LDD	R16,Z+31
    0213D 2711      CLR	R17
    0213E 2722      CLR	R18
    0213F 2733      CLR	R19
    02140 938A      ST	-Y,R24
    02141 940E 4BA8 CALL	lsl32
    02143 0118      MOVW	R2,R16
    02144 0129      MOVW	R4,R18
    02145 01F7      MOVW	R30,R14
    02146 8C66      LDD	R6,Z+30
    02147 2477      CLR	R7
    02148 2488      CLR	R8
    02149 2499      CLR	R9
    0214A 0143      MOVW	R8,R6
    0214B 2466      CLR	R6
    0214C 2477      CLR	R7
    0214D 2826      OR	R2,R6
    0214E 2837      OR	R3,R7
    0214F 2848      OR	R4,R8
    02150 2859      OR	R5,R9
    02151 8C65      LDD	R6,Z+29
    02152 2477      CLR	R7
    02153 2C76      MOV	R7,R6
    02154 2466      CLR	R6
    02155 2488      CLR	R8
    02156 2499      CLR	R9
    02157 2826      OR	R2,R6
    02158 2837      OR	R3,R7
    02159 2848      OR	R4,R8
    0215A 2859      OR	R5,R9
    0215B 8C64      LDD	R6,Z+28
    0215C 2477      CLR	R7
    0215D 2488      CLR	R8
    0215E 2499      CLR	R9
    0215F 2826      OR	R2,R6
    02160 2837      OR	R3,R7
    02161 2848      OR	R4,R8
    02162 2859      OR	R5,R9
    02163 A9EE      LDD	R30,Y+54
    02164 A9FF      LDD	R31,Y+55
    02165 8622      STD	Z+10,R2
    02166 8633      STD	Z+11,R3
    02167 8644      STD	Z+12,R4
    02168 8655      STD	Z+13,R5
(2355) 		fp->fptr = 0;						/* File pointer */
    02169 9636      ADIW	R30,6
    0216A E080      LDI	R24,0
    0216B 8380      ST	Z,R24
    0216C 8381      STD	Z+1,R24
    0216D 8382      STD	Z+2,R24
    0216E 8383      STD	Z+3,R24
(2356) 		fp->dsect = 0;
    0216F A9EE      LDD	R30,Y+54
    02170 A9FF      LDD	R31,Y+55
    02171 9676      ADIW	R30,0x16
    02172 E080      LDI	R24,0
    02173 8380      ST	Z,R24
    02174 8381      STD	Z+1,R24
    02175 8382      STD	Z+2,R24
    02176 8383      STD	Z+3,R24
(2357) #if _USE_FASTSEEK
(2358) 		fp->cltbl = 0;						/* Normal seek mode */
    02177 2422      CLR	R2
    02178 2433      CLR	R3
    02179 A9EE      LDD	R30,Y+54
    0217A A9FF      LDD	R31,Y+55
    0217B A231      STD	Z+33,R3
    0217C A220      STD	Z+32,R2
(2359) #endif
(2360) 		fp->fs = dj.fs; fp->id = dj.fs->id;	/* Validate file object */
    0217D 802A      LDD	R2,Y+2
    0217E 803B      LDD	R3,Y+3
    0217F 8231      STD	Z+1,R3
    02180 8220      ST	Z,R2
    02181 01F1      MOVW	R30,R2
    02182 8026      LDD	R2,Z+6
    02183 8037      LDD	R3,Z+7
    02184 A9EE      LDD	R30,Y+54
    02185 A9FF      LDD	R31,Y+55
    02186 8233      STD	Z+3,R3
    02187 8222      STD	Z+2,R2
(2361) 	}
(2362) 
(2363) 	LEAVE_FF(dj.fs, res);
    02188 2D0A      MOV	R16,R10
    02189 96AC      ADIW	R28,0x2C
    0218A 940E 4B12 CALL	pop_xgsetF0FC
    0218C 9624      ADIW	R28,4
    0218D 9508      RET
_f_read:
  remain               --> Y,+13
  res                  --> R10
  clst                 --> Y,+9
  csect                --> R12
  cc                   --> R10
  rbuff                --> R14
  sect                 --> Y,+5
  rcnt                 --> R12
  br                   --> Y,+33
  btr                  --> Y,+31
  buff                 --> R10
  fp                   --> Y,+27
    0218E 940E 49D8 CALL	push_arg4
    02190 940E 4B1D CALL	push_xgsetF0FC
    02192 0159      MOVW	R10,R18
    02193 9761      SBIW	R28,0x11
(2364) }
(2365) 
(2366) 
(2367) 
(2368) 
(2369) /*-----------------------------------------------------------------------*/
(2370) /* Read File                                                             */
(2371) /*-----------------------------------------------------------------------*/
(2372) 
(2373) FRESULT f_read (
(2374) 	FIL *fp, 		/* Pointer to the file object */
(2375) 	void *buff,		/* Pointer to data buffer */
(2376) 	UINT btr,		/* Number of bytes to read */
(2377) 	UINT *br		/* Pointer to number of bytes read */
(2378) )
(2379) {
(2380) 	FRESULT res;
(2381) 	DWORD clst, sect, remain;
(2382) 	UINT rcnt, cc;
(2383) 	BYTE csect, *rbuff = buff;
    02194 0175      MOVW	R14,R10
(2384) 
(2385) 	memset(buff,0,512);
    02195 E080      LDI	R24,0
    02196 E092      LDI	R25,2
    02197 8399      STD	Y+1,R25
    02198 8388      ST	Y,R24
    02199 2722      CLR	R18
    0219A 2733      CLR	R19
    0219B 0185      MOVW	R16,R10
    0219C 940E 49B4 CALL	_memset
(2386) 
(2387) 	*br = 0;	/* Initialize byte counter */
    0219E 2422      CLR	R2
    0219F 2433      CLR	R3
    021A0 A1E9      LDD	R30,Y+33
    021A1 A1FA      LDD	R31,Y+34
    021A2 8231      STD	Z+1,R3
    021A3 8220      ST	Z,R2
(2388) 
(2389) 	res = validate(fp->fs, fp->id);				/* Check validity */
    021A4 8DEB      LDD	R30,Y+27
    021A5 8DFC      LDD	R31,Y+28
    021A6 8122      LDD	R18,Z+2
    021A7 8133      LDD	R19,Z+3
    021A8 8100      LD	R16,Z
    021A9 8111      LDD	R17,Z+1
    021AA DDFF      RCALL	ff.c:validate
    021AB 2EA0      MOV	R10,R16
(2390) 	if (res != FR_OK) LEAVE_FF(fp->fs, res);
    021AC 2300      TST	R16
    021AD F009      BEQ	0x21AF
    021AE C245      RJMP	0x23F4
(2391) 	if (fp->flag & FA__ERROR)					/* Aborted file? */
    021AF 8DEB      LDD	R30,Y+27
    021B0 8DFC      LDD	R31,Y+28
    021B1 8024      LDD	R2,Z+4
    021B2 FE27      SBRS	R2,7
    021B3 C002      RJMP	0x21B6
(2392) 		LEAVE_FF(fp->fs, FR_INT_ERR);
    021B4 E002      LDI	R16,2
    021B5 C23E      RJMP	0x23F4
(2393) 	if (!(fp->flag & FA_READ)) 					/* Check access mode */
    021B6 8DEB      LDD	R30,Y+27
    021B7 8DFC      LDD	R31,Y+28
    021B8 8024      LDD	R2,Z+4
    021B9 FC20      SBRC	R2,0
    021BA C002      RJMP	0x21BD
(2394) 		LEAVE_FF(fp->fs, FR_DENIED);
    021BB E007      LDI	R16,7
    021BC C237      RJMP	0x23F4
(2395) 	remain = fp->fsize - fp->fptr;
    021BD 8DEB      LDD	R30,Y+27
    021BE 8DFC      LDD	R31,Y+28
    021BF 8026      LDD	R2,Z+6
    021C0 8037      LDD	R3,Z+7
    021C1 8440      LDD	R4,Z+8
    021C2 8451      LDD	R5,Z+9
    021C3 963A      ADIW	R30,0xA
    021C4 8060      LD	R6,Z
    021C5 8071      LDD	R7,Z+1
    021C6 8082      LDD	R8,Z+2
    021C7 8093      LDD	R9,Z+3
    021C8 1862      SUB	R6,R2
    021C9 0873      SBC	R7,R3
    021CA 0884      SBC	R8,R4
    021CB 0895      SBC	R9,R5
    021CC 866D      STD	Y+13,R6
    021CD 867E      STD	Y+14,R7
    021CE 868F      STD	Y+15,R8
    021CF 8A98      STD	Y+16,R9
(2396) 	if (btr > remain) btr = (UINT)remain;		/* Truncate btr by remaining bytes */
    021D0 842D      LDD	R2,Y+13
    021D1 843E      LDD	R3,Y+14
    021D2 844F      LDD	R4,Y+15
    021D3 8858      LDD	R5,Y+16
    021D4 8C6F      LDD	R6,Y+31
    021D5 A078      LDD	R7,Y+32
    021D6 2488      CLR	R8
    021D7 2499      CLR	R9
    021D8 1426      CP	R2,R6
    021D9 0437      CPC	R3,R7
    021DA 0448      CPC	R4,R8
    021DB 0459      CPC	R5,R9
    021DC F008      BCS	0x21DE
    021DD C20D      RJMP	0x23EB
    021DE A238      STD	Y+32,R3
    021DF 8E2F      STD	Y+31,R2
(2397) 
(2398) 	for ( ;  btr;								/* Repeat until all data read */
    021E0 C20A      RJMP	0x23EB
(2399) 		rbuff += rcnt, fp->fptr += rcnt, *br += rcnt, btr -= rcnt) {
(2400) 		if ((fp->fptr % SS(fp->fs)) == 0) {		/* On the sector boundary? */
    021E1 EF4F      LDI	R20,0xFF
    021E2 E051      LDI	R21,1
    021E3 E060      LDI	R22,0
    021E4 E070      LDI	R23,0
    021E5 8DEB      LDD	R30,Y+27
    021E6 8DFC      LDD	R31,Y+28
    021E7 9636      ADIW	R30,6
    021E8 8020      LD	R2,Z
    021E9 8031      LDD	R3,Z+1
    021EA 8042      LDD	R4,Z+2
    021EB 8053      LDD	R5,Z+3
    021EC 2224      AND	R2,R20
    021ED 2235      AND	R3,R21
    021EE 2246      AND	R4,R22
    021EF 2257      AND	R5,R23
    021F0 9488      BCLR	0
    021F1 2022      TST	R2
    021F2 0432      CPC	R3,R2
    021F3 0442      CPC	R4,R2
    021F4 0452      CPC	R5,R2
    021F5 F009      BEQ	0x21F7
    021F6 C180      RJMP	0x2377
(2401) 			csect = (BYTE)(fp->fptr / SS(fp->fs) & (fp->fs->csize - 1));	/* Sector offset in the cluster */
    021F7 E089      LDI	R24,0x9
    021F8 E090      LDI	R25,0
    021F9 8DEB      LDD	R30,Y+27
    021FA 8DFC      LDD	R31,Y+28
    021FB 8106      LDD	R16,Z+6
    021FC 8117      LDD	R17,Z+7
    021FD 8520      LDD	R18,Z+8
    021FE 8531      LDD	R19,Z+9
    021FF 938A      ST	-Y,R24
    02200 940E 4BC1 CALL	lsr32
    02202 0118      MOVW	R2,R16
    02203 0129      MOVW	R4,R18
    02204 8DEB      LDD	R30,Y+27
    02205 8DFC      LDD	R31,Y+28
    02206 93AF      PUSH	R26
    02207 93BF      PUSH	R27
    02208 81A0      LD	R26,Z
    02209 81B1      LDD	R27,Z+1
    0220A 01FD      MOVW	R30,R26
    0220B 91BF      POP	R27
    0220C 91AF      POP	R26
    0220D 8182      LDD	R24,Z+2
    0220E 2799      CLR	R25
    0220F 9701      SBIW	R24,1
    02210 013C      MOVW	R6,R24
    02211 2488      CLR	R8
    02212 FC77      SBRC	R7,7
    02213 9480      COM	R8
    02214 2499      CLR	R9
    02215 FC87      SBRC	R8,7
    02216 9490      COM	R9
    02217 2026      AND	R2,R6
    02218 2037      AND	R3,R7
    02219 2048      AND	R4,R8
    0221A 2059      AND	R5,R9
    0221B 2CC2      MOV	R12,R2
(2402) 			if (!csect) {						/* On the cluster boundary? */
    0221C 2022      TST	R2
    0221D F009      BEQ	0x221F
    0221E C078      RJMP	0x2297
(2403) 				if (fp->fptr == 0) {			/* On the top of the file? */
    0221F 8DEB      LDD	R30,Y+27
    02220 8DFC      LDD	R31,Y+28
    02221 9636      ADIW	R30,6
    02222 8020      LD	R2,Z
    02223 8031      LDD	R3,Z+1
    02224 8042      LDD	R4,Z+2
    02225 8053      LDD	R5,Z+3
    02226 9488      BCLR	0
    02227 2022      TST	R2
    02228 0432      CPC	R3,R2
    02229 0442      CPC	R4,R2
    0222A 0452      CPC	R5,R2
    0222B F461      BNE	0x2238
(2404) 					clst = fp->sclust;			/* Follow from the origin */
    0222C 8DEB      LDD	R30,Y+27
    0222D 8DFC      LDD	R31,Y+28
    0222E 963E      ADIW	R30,0xE
    0222F 8020      LD	R2,Z
    02230 8031      LDD	R3,Z+1
    02231 8042      LDD	R4,Z+2
    02232 8053      LDD	R5,Z+3
    02233 8629      STD	Y+9,R2
    02234 863A      STD	Y+10,R3
    02235 864B      STD	Y+11,R4
    02236 865C      STD	Y+12,R5
(2405) 				} else {						/* Middle or end of the file */
    02237 C028      RJMP	0x2260
(2406) #if _USE_FASTSEEK
(2407) 					if (fp->cltbl)
    02238 8DEB      LDD	R30,Y+27
    02239 8DFC      LDD	R31,Y+28
    0223A A020      LDD	R2,Z+32
    0223B A031      LDD	R3,Z+33
    0223C 2022      TST	R2
    0223D F411      BNE	0x2240
    0223E 2033      TST	R3
    0223F F079      BEQ	0x224F
(2408) 						clst = clmt_clust(fp, fp->fptr);	/* Get cluster# from the CLMT */
    02240 8026      LDD	R2,Z+6
    02241 8037      LDD	R3,Z+7
    02242 8440      LDD	R4,Z+8
    02243 8451      LDD	R5,Z+9
    02244 8248      ST	Y,R4
    02245 8259      STD	Y+1,R5
    02246 0191      MOVW	R18,R2
    02247 018F      MOVW	R16,R30
    02248 940E 1395 CALL	ff.c:clmt_clust
    0224A 8709      STD	Y+9,R16
    0224B 871A      STD	Y+10,R17
    0224C 872B      STD	Y+11,R18
    0224D 873C      STD	Y+12,R19
    0224E C011      RJMP	0x2260
(2409) 					else
(2410) #endif
(2411) 						clst = get_fat(fp->fs, fp->clust);	/* Follow cluster chain on the FAT */
    0224F 8DEB      LDD	R30,Y+27
    02250 8DFC      LDD	R31,Y+28
    02251 8822      LDD	R2,Z+18
    02252 8833      LDD	R3,Z+19
    02253 8844      LDD	R4,Z+20
    02254 8855      LDD	R5,Z+21
    02255 8248      ST	Y,R4
    02256 8259      STD	Y+1,R5
    02257 0191      MOVW	R18,R2
    02258 8100      LD	R16,Z
    02259 8111      LDD	R17,Z+1
    0225A 940E 0E5B CALL	_get_fat
    0225C 8709      STD	Y+9,R16
    0225D 871A      STD	Y+10,R17
    0225E 872B      STD	Y+11,R18
    0225F 873C      STD	Y+12,R19
(2412) 				}
(2413) 				if (clst < 2) ABORT(fp->fs, FR_INT_ERR);
    02260 E042      LDI	R20,2
    02261 E050      LDI	R21,0
    02262 E060      LDI	R22,0
    02263 E070      LDI	R23,0
    02264 8429      LDD	R2,Y+9
    02265 843A      LDD	R3,Y+10
    02266 844B      LDD	R4,Y+11
    02267 845C      LDD	R5,Y+12
    02268 1624      CP	R2,R20
    02269 0635      CPC	R3,R21
    0226A 0646      CPC	R4,R22
    0226B 0657      CPC	R5,R23
    0226C F448      BCC	0x2276
    0226D 8D8B      LDD	R24,Y+27
    0226E 8D9C      LDD	R25,Y+28
    0226F 9604      ADIW	R24,4
    02270 01FC      MOVW	R30,R24
    02271 8180      LD	R24,Z
    02272 6880      ORI	R24,0x80
    02273 8380      ST	Z,R24
    02274 E002      LDI	R16,2
    02275 C17E      RJMP	0x23F4
(2414) 				if (clst == 0xFFFFFFFF) ABORT(fp->fs, FR_DISK_ERR);
    02276 EF4F      LDI	R20,0xFF
    02277 EF5F      LDI	R21,0xFF
    02278 EF6F      LDI	R22,0xFF
    02279 EF7F      LDI	R23,0xFF
    0227A 8429      LDD	R2,Y+9
    0227B 843A      LDD	R3,Y+10
    0227C 844B      LDD	R4,Y+11
    0227D 845C      LDD	R5,Y+12
    0227E 1624      CP	R2,R20
    0227F 0635      CPC	R3,R21
    02280 0646      CPC	R4,R22
    02281 0657      CPC	R5,R23
    02282 F451      BNE	0x228D
    02283 8D8B      LDD	R24,Y+27
    02284 8D9C      LDD	R25,Y+28
    02285 9604      ADIW	R24,4
    02286 015C      MOVW	R10,R24
    02287 01FC      MOVW	R30,R24
    02288 8180      LD	R24,Z
    02289 6880      ORI	R24,0x80
    0228A 8380      ST	Z,R24
    0228B E001      LDI	R16,1
    0228C C167      RJMP	0x23F4
(2415) 				fp->clust = clst;				/* Update current cluster */
    0228D 8429      LDD	R2,Y+9
    0228E 843A      LDD	R3,Y+10
    0228F 844B      LDD	R4,Y+11
    02290 845C      LDD	R5,Y+12
    02291 8DEB      LDD	R30,Y+27
    02292 8DFC      LDD	R31,Y+28
    02293 8A22      STD	Z+18,R2
    02294 8A33      STD	Z+19,R3
    02295 8A44      STD	Z+20,R4
    02296 8A55      STD	Z+21,R5
(2416) 			}
(2417) 			sect = clust2sect(fp->fs, fp->clust);	/* Get current sector */
    02297 8DEB      LDD	R30,Y+27
    02298 8DFC      LDD	R31,Y+28
    02299 8822      LDD	R2,Z+18
    0229A 8833      LDD	R3,Z+19
    0229B 8844      LDD	R4,Z+20
    0229C 8855      LDD	R5,Z+21
    0229D 8248      ST	Y,R4
    0229E 8259      STD	Y+1,R5
    0229F 0191      MOVW	R18,R2
    022A0 8100      LD	R16,Z
    022A1 8111      LDD	R17,Z+1
    022A2 940E 0E09 CALL	_clust2sect
    022A4 830D      STD	Y+5,R16
    022A5 831E      STD	Y+6,R17
    022A6 832F      STD	Y+7,R18
    022A7 8738      STD	Y+8,R19
(2418) 			if (!sect) ABORT(fp->fs, FR_INT_ERR);
    022A8 802D      LDD	R2,Y+5
    022A9 803E      LDD	R3,Y+6
    022AA 804F      LDD	R4,Y+7
    022AB 8458      LDD	R5,Y+8
    022AC 9488      BCLR	0
    022AD 2022      TST	R2
    022AE 0432      CPC	R3,R2
    022AF 0442      CPC	R4,R2
    022B0 0452      CPC	R5,R2
    022B1 F451      BNE	0x22BC
    022B2 8D8B      LDD	R24,Y+27
    022B3 8D9C      LDD	R25,Y+28
    022B4 9604      ADIW	R24,4
    022B5 015C      MOVW	R10,R24
    022B6 01FC      MOVW	R30,R24
    022B7 8180      LD	R24,Z
    022B8 6880      ORI	R24,0x80
    022B9 8380      ST	Z,R24
    022BA E002      LDI	R16,2
    022BB C138      RJMP	0x23F4
(2419) 			sect += csect;
    022BC 2C2C      MOV	R2,R12
    022BD 2433      CLR	R3
    022BE 2444      CLR	R4
    022BF 2455      CLR	R5
    022C0 806D      LDD	R6,Y+5
    022C1 807E      LDD	R7,Y+6
    022C2 808F      LDD	R8,Y+7
    022C3 8498      LDD	R9,Y+8
    022C4 0C62      ADD	R6,R2
    022C5 1C73      ADC	R7,R3
    022C6 1C84      ADC	R8,R4
    022C7 1C95      ADC	R9,R5
    022C8 826D      STD	Y+5,R6
    022C9 827E      STD	Y+6,R7
    022CA 828F      STD	Y+7,R8
    022CB 8698      STD	Y+8,R9
(2420) 			cc = btr / SS(fp->fs);				/* When remaining bytes >= sector size, */
    022CC E029      LDI	R18,0x9
    022CD E030      LDI	R19,0
    022CE 8D0F      LDD	R16,Y+31
    022CF A118      LDD	R17,Y+32
    022D0 940E 4BBA CALL	lsr16
    022D2 0158      MOVW	R10,R16
(2421) 			if (cc) {							/* Read maximum contiguous sectors directly */
    022D3 3000      CPI	R16,0
    022D4 0701      CPC	R16,R17
    022D5 F409      BNE	0x22D7
    022D6 C096      RJMP	0x236D
(2422) 				if (csect + cc > fp->fs->csize)	/* Clip at cluster boundary */
    022D7 2C2C      MOV	R2,R12
    022D8 2433      CLR	R3
    022D9 0E20      ADD	R2,R16
    022DA 1E31      ADC	R3,R17
    022DB 8DEB      LDD	R30,Y+27
    022DC 8DFC      LDD	R31,Y+28
    022DD 93AF      PUSH	R26
    022DE 93BF      PUSH	R27
    022DF 81A0      LD	R26,Z
    022E0 81B1      LDD	R27,Z+1
    022E1 01FD      MOVW	R30,R26
    022E2 91BF      POP	R27
    022E3 91AF      POP	R26
    022E4 8042      LDD	R4,Z+2
    022E5 2455      CLR	R5
    022E6 1442      CP	R4,R2
    022E7 0453      CPC	R5,R3
    022E8 F478      BCC	0x22F8
(2423) 					cc = fp->fs->csize - csect;
    022E9 2C2C      MOV	R2,R12
    022EA 2433      CLR	R3
    022EB 8DEB      LDD	R30,Y+27
    022EC 8DFC      LDD	R31,Y+28
    022ED 93AF      PUSH	R26
    022EE 93BF      PUSH	R27
    022EF 81A0      LD	R26,Z
    022F0 81B1      LDD	R27,Z+1
    022F1 01FD      MOVW	R30,R26
    022F2 91BF      POP	R27
    022F3 91AF      POP	R26
    022F4 80A2      LDD	R10,Z+2
    022F5 24BB      CLR	R11
    022F6 18A2      SUB	R10,R2
    022F7 08B3      SBC	R11,R3
(2424) 				if (disk_read(fp->fs->drv, rbuff, sect, (BYTE)cc) != RES_OK)
    022F8 82AC      STD	Y+4,R10
    022F9 802D      LDD	R2,Y+5
    022FA 803E      LDD	R3,Y+6
    022FB 804F      LDD	R4,Y+7
    022FC 8458      LDD	R5,Y+8
    022FD 8228      ST	Y,R2
    022FE 8239      STD	Y+1,R3
    022FF 824A      STD	Y+2,R4
    02300 825B      STD	Y+3,R5
    02301 0197      MOVW	R18,R14
    02302 8DEB      LDD	R30,Y+27
    02303 8DFC      LDD	R31,Y+28
    02304 93AF      PUSH	R26
    02305 93BF      PUSH	R27
    02306 81A0      LD	R26,Z
    02307 81B1      LDD	R27,Z+1
    02308 01FD      MOVW	R30,R26
    02309 91BF      POP	R27
    0230A 91AF      POP	R26
    0230B 8101      LDD	R16,Z+1
    0230C 940E 0BF7 CALL	_disk_read
    0230E 2EC0      MOV	R12,R16
    0230F 2300      TST	R16
    02310 F051      BEQ	0x231B
(2425) 					ABORT(fp->fs, FR_DISK_ERR);
    02311 8D8B      LDD	R24,Y+27
    02312 8D9C      LDD	R25,Y+28
    02313 9604      ADIW	R24,4
    02314 016C      MOVW	R12,R24
    02315 01FC      MOVW	R30,R24
    02316 8180      LD	R24,Z
    02317 6880      ORI	R24,0x80
    02318 8380      ST	Z,R24
    02319 E001      LDI	R16,1
    0231A C0D9      RJMP	0x23F4
(2426) #if !_FS_READONLY && _FS_MINIMIZE <= 2			/* Replace one of the read sectors with cached data if it contains a dirty sector */
(2427) #if _FS_TINY
(2428) 				if (fp->fs->wflag && fp->fs->winsect - sect < cc)
    0231B 8DEB      LDD	R30,Y+27
    0231C 8DFC      LDD	R31,Y+28
    0231D 80C0      LD	R12,Z
    0231E 80D1      LDD	R13,Z+1
    0231F 01F6      MOVW	R30,R12
    02320 9634      ADIW	R30,4
    02321 8020      LD	R2,Z
    02322 2022      TST	R2
    02323 F409      BNE	0x2325
    02324 C041      RJMP	0x2366
    02325 802D      LDD	R2,Y+5
    02326 803E      LDD	R3,Y+6
    02327 804F      LDD	R4,Y+7
    02328 8458      LDD	R5,Y+8
    02329 01F6      MOVW	R30,R12
    0232A A462      LDD	R6,Z+42
    0232B A473      LDD	R7,Z+43
    0232C A484      LDD	R8,Z+44
    0232D A495      LDD	R9,Z+45
    0232E 1862      SUB	R6,R2
    0232F 0873      SBC	R7,R3
    02330 0884      SBC	R8,R4
    02331 0895      SBC	R9,R5
    02332 0115      MOVW	R2,R10
    02333 2444      CLR	R4
    02334 2455      CLR	R5
    02335 1462      CP	R6,R2
    02336 0473      CPC	R7,R3
    02337 0484      CPC	R8,R4
    02338 0495      CPC	R9,R5
    02339 F560      BCC	0x2366
(2429) 					mem_cpy(rbuff + ((fp->fs->winsect - sect) * SS(fp->fs)), fp->fs->win, SS(fp->fs));
    0233A E080      LDI	R24,0
    0233B E092      LDI	R25,2
    0233C 8399      STD	Y+1,R25
    0233D 8388      ST	Y,R24
    0233E 8DEB      LDD	R30,Y+27
    0233F 8DFC      LDD	R31,Y+28
    02340 80C0      LD	R12,Z
    02341 80D1      LDD	R13,Z+1
    02342 0196      MOVW	R18,R12
    02343 5D22      SUBI	R18,0xD2
    02344 4F3F      SBCI	R19,0xFF
    02345 802D      LDD	R2,Y+5
    02346 803E      LDD	R3,Y+6
    02347 804F      LDD	R4,Y+7
    02348 8458      LDD	R5,Y+8
    02349 01F6      MOVW	R30,R12
    0234A A462      LDD	R6,Z+42
    0234B A473      LDD	R7,Z+43
    0234C A484      LDD	R8,Z+44
    0234D A495      LDD	R9,Z+45
    0234E 1862      SUB	R6,R2
    0234F 0873      SBC	R7,R3
    02350 0884      SBC	R8,R4
    02351 0895      SBC	R9,R5
    02352 E040      LDI	R20,0
    02353 E052      LDI	R21,2
    02354 E060      LDI	R22,0
    02355 E070      LDI	R23,0
    02356 932F      PUSH	R18
    02357 933F      PUSH	R19
    02358 929A      ST	-Y,R9
    02359 928A      ST	-Y,R8
    0235A 927A      ST	-Y,R7
    0235B 926A      ST	-Y,R6
    0235C 018A      MOVW	R16,R20
    0235D 019B      MOVW	R18,R22
    0235E 940E 4AC9 CALL	empy32s|empy32u
    02360 913F      POP	R19
    02361 912F      POP	R18
    02362 0D0E      ADD	R16,R14
    02363 1D1F      ADC	R17,R15
    02364 940E 0C39 CALL	ff.c:mem_cpy
(2430) #else
(2431) 				if ((fp->flag & FA__DIRTY) && fp->dsect - sect < cc)
(2432) 					mem_cpy(rbuff + ((fp->dsect - sect) * SS(fp->fs)), fp->buf, SS(fp->fs));
(2433) #endif
(2434) #endif
(2435) 				rcnt = SS(fp->fs) * cc;			/* Number of bytes transferred */
    02366 E000      LDI	R16,0
    02367 E012      LDI	R17,2
    02368 0195      MOVW	R18,R10
    02369 940E 4AB9 CALL	empy16s
    0236B 0168      MOVW	R12,R16
(2436) 				continue;
    0236C C05A      RJMP	0x23C7
(2437) 			}
(2438) #if !_FS_TINY
(2439) 			if (fp->dsect != sect) {			/* Load data sector if not in cache */
(2440) #if !_FS_READONLY
(2441) 				if (fp->flag & FA__DIRTY) {		/* Write-back dirty sector cache */
(2442) 					if (disk_write(fp->fs->drv, fp->buf, fp->dsect, 1) != RES_OK)
(2443) 						ABORT(fp->fs, FR_DISK_ERR);
(2444) 					fp->flag &= ~FA__DIRTY;
(2445) 				}
(2446) #endif
(2447) 				if (disk_read(fp->fs->drv, fp->buf, sect, 1) != RES_OK)	/* Fill sector cache */
(2448) 					ABORT(fp->fs, FR_DISK_ERR);
(2449) 			}
(2450) #endif
(2451) 			fp->dsect = sect;
    0236D 802D      LDD	R2,Y+5
    0236E 803E      LDD	R3,Y+6
    0236F 804F      LDD	R4,Y+7
    02370 8458      LDD	R5,Y+8
    02371 8DEB      LDD	R30,Y+27
    02372 8DFC      LDD	R31,Y+28
    02373 8A26      STD	Z+22,R2
    02374 8A37      STD	Z+23,R3
    02375 8E40      STD	Z+24,R4
    02376 8E51      STD	Z+25,R5
(2452) 		}
(2453) 		rcnt = SS(fp->fs) - (fp->fptr % SS(fp->fs));	/* Get partial sector data from sector buffer */
    02377 EF4F      LDI	R20,0xFF
    02378 E051      LDI	R21,1
    02379 E060      LDI	R22,0
    0237A E070      LDI	R23,0
    0237B 8DEB      LDD	R30,Y+27
    0237C 8DFC      LDD	R31,Y+28
    0237D 8026      LDD	R2,Z+6
    0237E 8037      LDD	R3,Z+7
    0237F 8440      LDD	R4,Z+8
    02380 8451      LDD	R5,Z+9
    02381 2224      AND	R2,R20
    02382 2235      AND	R3,R21
    02383 2246      AND	R4,R22
    02384 2257      AND	R5,R23
    02385 E040      LDI	R20,0
    02386 E052      LDI	R21,2
    02387 E060      LDI	R22,0
    02388 E070      LDI	R23,0
    02389 1942      SUB	R20,R2
    0238A 0953      SBC	R21,R3
    0238B 0964      SBC	R22,R4
    0238C 0975      SBC	R23,R5
    0238D 016A      MOVW	R12,R20
(2454) 		if (rcnt > btr) rcnt = btr;
    0238E 8C0F      LDD	R0,Y+31
    0238F A018      LDD	R1,Y+32
    02390 1604      CP	R0,R20
    02391 0615      CPC	R1,R21
    02392 F408      BCC	0x2394
    02393 0160      MOVW	R12,R0
(2455) #if _FS_TINY
(2456) 		if (move_window(fp->fs, fp->dsect))		/* Move sector window */
    02394 8DEB      LDD	R30,Y+27
    02395 8DFC      LDD	R31,Y+28
    02396 8826      LDD	R2,Z+22
    02397 8837      LDD	R3,Z+23
    02398 8C40      LDD	R4,Z+24
    02399 8C51      LDD	R5,Z+25
    0239A 8248      ST	Y,R4
    0239B 8259      STD	Y+1,R5
    0239C 0191      MOVW	R18,R2
    0239D 8100      LD	R16,Z
    0239E 8111      LDD	R17,Z+1
    0239F 940E 0C92 CALL	ff.c:move_window
    023A1 2EA0      MOV	R10,R16
    023A2 2300      TST	R16
    023A3 F051      BEQ	0x23AE
(2457) 			ABORT(fp->fs, FR_DISK_ERR);
    023A4 8D8B      LDD	R24,Y+27
    023A5 8D9C      LDD	R25,Y+28
    023A6 9604      ADIW	R24,4
    023A7 015C      MOVW	R10,R24
    023A8 01FC      MOVW	R30,R24
    023A9 8180      LD	R24,Z
    023AA 6880      ORI	R24,0x80
    023AB 8380      ST	Z,R24
    023AC E001      LDI	R16,1
    023AD C046      RJMP	0x23F4
(2458) 		mem_cpy(rbuff, &fp->fs->win[fp->fptr % SS(fp->fs)], rcnt);	/* Pick partial sector */
    023AE 82D9      STD	Y+1,R13
    023AF 82C8      ST	Y,R12
    023B0 EF4F      LDI	R20,0xFF
    023B1 E051      LDI	R21,1
    023B2 E060      LDI	R22,0
    023B3 E070      LDI	R23,0
    023B4 8DEB      LDD	R30,Y+27
    023B5 8DFC      LDD	R31,Y+28
    023B6 8026      LDD	R2,Z+6
    023B7 8037      LDD	R3,Z+7
    023B8 8440      LDD	R4,Z+8
    023B9 8451      LDD	R5,Z+9
    023BA 2224      AND	R2,R20
    023BB 2235      AND	R3,R21
    023BC 2246      AND	R4,R22
    023BD 2257      AND	R5,R23
    023BE 0191      MOVW	R18,R2
    023BF 8180      LD	R24,Z
    023C0 8191      LDD	R25,Z+1
    023C1 968E      ADIW	R24,0x2E
    023C2 0F28      ADD	R18,R24
    023C3 1F39      ADC	R19,R25
    023C4 0187      MOVW	R16,R14
    023C5 940E 0C39 CALL	ff.c:mem_cpy
    023C7 0CEC      ADD	R14,R12
    023C8 1CFD      ADC	R15,R13
    023C9 8D8B      LDD	R24,Y+27
    023CA 8D9C      LDD	R25,Y+28
    023CB 9606      ADIW	R24,6
    023CC 015C      MOVW	R10,R24
    023CD 0116      MOVW	R2,R12
    023CE 2444      CLR	R4
    023CF 2455      CLR	R5
    023D0 01FC      MOVW	R30,R24
    023D1 8060      LD	R6,Z
    023D2 8071      LDD	R7,Z+1
    023D3 8082      LDD	R8,Z+2
    023D4 8093      LDD	R9,Z+3
    023D5 0C62      ADD	R6,R2
    023D6 1C73      ADC	R7,R3
    023D7 1C84      ADC	R8,R4
    023D8 1C95      ADC	R9,R5
    023D9 8260      ST	Z,R6
    023DA 8271      STD	Z+1,R7
    023DB 8282      STD	Z+2,R8
    023DC 8293      STD	Z+3,R9
    023DD A1E9      LDD	R30,Y+33
    023DE A1FA      LDD	R31,Y+34
    023DF 8020      LD	R2,Z
    023E0 8031      LDD	R3,Z+1
    023E1 0C2C      ADD	R2,R12
    023E2 1C3D      ADC	R3,R13
    023E3 8231      STD	Z+1,R3
    023E4 8220      ST	Z,R2
    023E5 8C0F      LDD	R0,Y+31
    023E6 A018      LDD	R1,Y+32
    023E7 180C      SUB	R0,R12
    023E8 081D      SBC	R1,R13
    023E9 A218      STD	Y+32,R1
    023EA 8E0F      STD	Y+31,R0
    023EB 8C0F      LDD	R0,Y+31
    023EC A018      LDD	R1,Y+32
    023ED 2000      TST	R0
    023EE F009      BEQ	0x23F0
    023EF CDF1      RJMP	0x21E1
    023F0 2011      TST	R1
    023F1 F009      BEQ	0x23F3
    023F2 CDEE      RJMP	0x21E1
(2459) #else
(2460) 		mem_cpy(rbuff, &fp->buf[fp->fptr % SS(fp->fs)], rcnt);	/* Pick partial sector */
(2461) #endif
(2462) 	}
(2463) 
(2464) 	LEAVE_FF(fp->fs, FR_OK);
    023F3 2700      CLR	R16
    023F4 9661      ADIW	R28,0x11
    023F5 940E 4B12 CALL	pop_xgsetF0FC
    023F7 9624      ADIW	R28,4
    023F8 9508      RET
_f_write:
  res                  --> R10
  clst                 --> Y,+9
  csect                --> R12
  cc                   --> R10
  wbuff                --> R14
  sect                 --> Y,+5
  wcnt                 --> R12
  bw                   --> Y,+33
  btw                  --> Y,+31
  buff                 --> R10
  fp                   --> Y,+27
    023F9 940E 49D8 CALL	push_arg4
    023FB 940E 4B1D CALL	push_xgsetF0FC
    023FD 0159      MOVW	R10,R18
    023FE 9761      SBIW	R28,0x11
(2465) }
(2466) 
(2467) 
(2468) 
(2469) 
(2470) #if !_FS_READONLY
(2471) /*-----------------------------------------------------------------------*/
(2472) /* Write File                                                            */
(2473) /*-----------------------------------------------------------------------*/
(2474) 
(2475) FRESULT f_write (
(2476) 	FIL *fp,			/* Pointer to the file object */
(2477) 	const void *buff,	/* Pointer to the data to be written */
(2478) 	UINT btw,			/* Number of bytes to write */
(2479) 	UINT *bw			/* Pointer to number of bytes written */
(2480) )
(2481) {
(2482) 	FRESULT res;
(2483) 	DWORD clst, sect;
(2484) 	UINT wcnt, cc;
(2485) 	const BYTE *wbuff = buff;
    023FF 0175      MOVW	R14,R10
(2486) 	BYTE csect;
(2487) 
(2488) 
(2489) 	*bw = 0;	/* Initialize byte counter */
    02400 2422      CLR	R2
    02401 2433      CLR	R3
    02402 A1E9      LDD	R30,Y+33
    02403 A1FA      LDD	R31,Y+34
    02404 8231      STD	Z+1,R3
    02405 8220      ST	Z,R2
(2490) 
(2491) 	res = validate(fp->fs, fp->id);			/* Check validity */
    02406 8DEB      LDD	R30,Y+27
    02407 8DFC      LDD	R31,Y+28
    02408 8122      LDD	R18,Z+2
    02409 8133      LDD	R19,Z+3
    0240A 8100      LD	R16,Z
    0240B 8111      LDD	R17,Z+1
    0240C DB9D      RCALL	ff.c:validate
    0240D 2EA0      MOV	R10,R16
(2492) 	if (res != FR_OK) LEAVE_FF(fp->fs, res);
    0240E 2300      TST	R16
    0240F F009      BEQ	0x2411
    02410 C2FC      RJMP	0x270D
(2493) 	if (fp->flag & FA__ERROR)				/* Aborted file? */
    02411 8DEB      LDD	R30,Y+27
    02412 8DFC      LDD	R31,Y+28
    02413 8024      LDD	R2,Z+4
    02414 FE27      SBRS	R2,7
    02415 C002      RJMP	0x2418
(2494) 		LEAVE_FF(fp->fs, FR_INT_ERR);
    02416 E002      LDI	R16,2
    02417 C2F5      RJMP	0x270D
(2495) 	if (!(fp->flag & FA_WRITE))				/* Check access mode */
    02418 8DEB      LDD	R30,Y+27
    02419 8DFC      LDD	R31,Y+28
    0241A 8024      LDD	R2,Z+4
    0241B FC21      SBRC	R2,1
    0241C C002      RJMP	0x241F
(2496) 		LEAVE_FF(fp->fs, FR_DENIED);
    0241D E007      LDI	R16,7
    0241E C2EE      RJMP	0x270D
(2497) 	if ((DWORD)(fp->fsize + btw) < fp->fsize) btw = 0;	/* File size cannot reach 4GB */
    0241F 8DEB      LDD	R30,Y+27
    02420 8DFC      LDD	R31,Y+28
    02421 963A      ADIW	R30,0xA
    02422 8020      LD	R2,Z
    02423 8031      LDD	R3,Z+1
    02424 8042      LDD	R4,Z+2
    02425 8053      LDD	R5,Z+3
    02426 862D      STD	Y+13,R2
    02427 863E      STD	Y+14,R3
    02428 864F      STD	Y+15,R4
    02429 8A58      STD	Y+16,R5
    0242A 8C2F      LDD	R2,Y+31
    0242B A038      LDD	R3,Y+32
    0242C 2444      CLR	R4
    0242D 2455      CLR	R5
    0242E 846D      LDD	R6,Y+13
    0242F 847E      LDD	R7,Y+14
    02430 848F      LDD	R8,Y+15
    02431 8898      LDD	R9,Y+16
    02432 0C62      ADD	R6,R2
    02433 1C73      ADC	R7,R3
    02434 1C84      ADC	R8,R4
    02435 1C95      ADC	R9,R5
    02436 842D      LDD	R2,Y+13
    02437 843E      LDD	R3,Y+14
    02438 844F      LDD	R4,Y+15
    02439 8858      LDD	R5,Y+16
    0243A 1462      CP	R6,R2
    0243B 0473      CPC	R7,R3
    0243C 0484      CPC	R8,R4
    0243D 0495      CPC	R9,R5
    0243E F008      BCS	0x2440
    0243F C2A5      RJMP	0x26E5
    02440 2400      CLR	R0
    02441 2411      CLR	R1
    02442 A218      STD	Y+32,R1
    02443 8E0F      STD	Y+31,R0
(2498) 
(2499) 	for ( ;  btw;							/* Repeat until all data written */
    02444 C2A0      RJMP	0x26E5
(2500) 		wbuff += wcnt, fp->fptr += wcnt, *bw += wcnt, btw -= wcnt) {
(2501) 		if ((fp->fptr % SS(fp->fs)) == 0) {	/* On the sector boundary? */
    02445 EF4F      LDI	R20,0xFF
    02446 E051      LDI	R21,1
    02447 E060      LDI	R22,0
    02448 E070      LDI	R23,0
    02449 8DEB      LDD	R30,Y+27
    0244A 8DFC      LDD	R31,Y+28
    0244B 9636      ADIW	R30,6
    0244C 8020      LD	R2,Z
    0244D 8031      LDD	R3,Z+1
    0244E 8042      LDD	R4,Z+2
    0244F 8053      LDD	R5,Z+3
    02450 2224      AND	R2,R20
    02451 2235      AND	R3,R21
    02452 2246      AND	R4,R22
    02453 2257      AND	R5,R23
    02454 9488      BCLR	0
    02455 2022      TST	R2
    02456 0432      CPC	R3,R2
    02457 0442      CPC	R4,R2
    02458 0452      CPC	R5,R2
    02459 F009      BEQ	0x245B
    0245A C20B      RJMP	0x2666
(2502) 			csect = (BYTE)(fp->fptr / SS(fp->fs) & (fp->fs->csize - 1));	/* Sector offset in the cluster */
    0245B E089      LDI	R24,0x9
    0245C E090      LDI	R25,0
    0245D 8DEB      LDD	R30,Y+27
    0245E 8DFC      LDD	R31,Y+28
    0245F 8106      LDD	R16,Z+6
    02460 8117      LDD	R17,Z+7
    02461 8520      LDD	R18,Z+8
    02462 8531      LDD	R19,Z+9
    02463 938A      ST	-Y,R24
    02464 940E 4BC1 CALL	lsr32
    02466 0118      MOVW	R2,R16
    02467 0129      MOVW	R4,R18
    02468 8DEB      LDD	R30,Y+27
    02469 8DFC      LDD	R31,Y+28
    0246A 93AF      PUSH	R26
    0246B 93BF      PUSH	R27
    0246C 81A0      LD	R26,Z
    0246D 81B1      LDD	R27,Z+1
    0246E 01FD      MOVW	R30,R26
    0246F 91BF      POP	R27
    02470 91AF      POP	R26
    02471 8182      LDD	R24,Z+2
    02472 2799      CLR	R25
    02473 9701      SBIW	R24,1
    02474 013C      MOVW	R6,R24
    02475 2488      CLR	R8
    02476 FC77      SBRC	R7,7
    02477 9480      COM	R8
    02478 2499      CLR	R9
    02479 FC87      SBRC	R8,7
    0247A 9490      COM	R9
    0247B 2026      AND	R2,R6
    0247C 2037      AND	R3,R7
    0247D 2048      AND	R4,R8
    0247E 2059      AND	R5,R9
    0247F 2CC2      MOV	R12,R2
(2503) 			if (!csect) {					/* On the cluster boundary? */
    02480 2022      TST	R2
    02481 F009      BEQ	0x2483
    02482 C0A5      RJMP	0x2528
(2504) 				if (fp->fptr == 0) {		/* On the top of the file? */
    02483 8DEB      LDD	R30,Y+27
    02484 8DFC      LDD	R31,Y+28
    02485 9636      ADIW	R30,6
    02486 8020      LD	R2,Z
    02487 8031      LDD	R3,Z+1
    02488 8042      LDD	R4,Z+2
    02489 8053      LDD	R5,Z+3
    0248A 9488      BCLR	0
    0248B 2022      TST	R2
    0248C 0432      CPC	R3,R2
    0248D 0442      CPC	R4,R2
    0248E 0452      CPC	R5,R2
    0248F F571      BNE	0x24BE
(2505) 					clst = fp->sclust;		/* Follow from the origin */
    02490 8DEB      LDD	R30,Y+27
    02491 8DFC      LDD	R31,Y+28
    02492 963E      ADIW	R30,0xE
    02493 8020      LD	R2,Z
    02494 8031      LDD	R3,Z+1
    02495 8042      LDD	R4,Z+2
    02496 8053      LDD	R5,Z+3
    02497 8629      STD	Y+9,R2
    02498 863A      STD	Y+10,R3
    02499 864B      STD	Y+11,R4
    0249A 865C      STD	Y+12,R5
(2506) 					if (clst == 0)			/* When no cluster is allocated, */
    0249B 8429      LDD	R2,Y+9
    0249C 843A      LDD	R3,Y+10
    0249D 844B      LDD	R4,Y+11
    0249E 845C      LDD	R5,Y+12
    0249F 9488      BCLR	0
    024A0 2022      TST	R2
    024A1 0432      CPC	R3,R2
    024A2 0442      CPC	R4,R2
    024A3 0452      CPC	R5,R2
    024A4 F009      BEQ	0x24A6
    024A5 C040      RJMP	0x24E6
(2507) 						fp->sclust = clst = create_chain(fp->fs, 0);	/* Create a new cluster chain */
    024A6 E040      LDI	R20,0
    024A7 E050      LDI	R21,0
    024A8 E060      LDI	R22,0
    024A9 E070      LDI	R23,0
    024AA 8368      ST	Y,R22
    024AB 8379      STD	Y+1,R23
    024AC 019A      MOVW	R18,R20
    024AD 8DEB      LDD	R30,Y+27
    024AE 8DFC      LDD	R31,Y+28
    024AF 8100      LD	R16,Z
    024B0 8111      LDD	R17,Z+1
    024B1 940E 121D CALL	ff.c:create_chain
    024B3 8709      STD	Y+9,R16
    024B4 871A      STD	Y+10,R17
    024B5 872B      STD	Y+11,R18
    024B6 873C      STD	Y+12,R19
    024B7 8DEB      LDD	R30,Y+27
    024B8 8DFC      LDD	R31,Y+28
    024B9 8706      STD	Z+14,R16
    024BA 8717      STD	Z+15,R17
    024BB 8B20      STD	Z+16,R18
    024BC 8B31      STD	Z+17,R19
(2508) 				} else {					/* Middle or end of the file */
    024BD C028      RJMP	0x24E6
(2509) #if _USE_FASTSEEK
(2510) 					if (fp->cltbl)
    024BE 8DEB      LDD	R30,Y+27
    024BF 8DFC      LDD	R31,Y+28
    024C0 A020      LDD	R2,Z+32
    024C1 A031      LDD	R3,Z+33
    024C2 2022      TST	R2
    024C3 F411      BNE	0x24C6
    024C4 2033      TST	R3
    024C5 F079      BEQ	0x24D5
(2511) 						clst = clmt_clust(fp, fp->fptr);	/* Get cluster# from the CLMT */
    024C6 8026      LDD	R2,Z+6
    024C7 8037      LDD	R3,Z+7
    024C8 8440      LDD	R4,Z+8
    024C9 8451      LDD	R5,Z+9
    024CA 8248      ST	Y,R4
    024CB 8259      STD	Y+1,R5
    024CC 0191      MOVW	R18,R2
    024CD 018F      MOVW	R16,R30
    024CE 940E 1395 CALL	ff.c:clmt_clust
    024D0 8709      STD	Y+9,R16
    024D1 871A      STD	Y+10,R17
    024D2 872B      STD	Y+11,R18
    024D3 873C      STD	Y+12,R19
    024D4 C011      RJMP	0x24E6
(2512) 					else
(2513) #endif
(2514) 						clst = create_chain(fp->fs, fp->clust);	/* Follow or stretch cluster chain on the FAT */
    024D5 8DEB      LDD	R30,Y+27
    024D6 8DFC      LDD	R31,Y+28
    024D7 8822      LDD	R2,Z+18
    024D8 8833      LDD	R3,Z+19
    024D9 8844      LDD	R4,Z+20
    024DA 8855      LDD	R5,Z+21
    024DB 8248      ST	Y,R4
    024DC 8259      STD	Y+1,R5
    024DD 0191      MOVW	R18,R2
    024DE 8100      LD	R16,Z
    024DF 8111      LDD	R17,Z+1
    024E0 940E 121D CALL	ff.c:create_chain
    024E2 8709      STD	Y+9,R16
    024E3 871A      STD	Y+10,R17
    024E4 872B      STD	Y+11,R18
    024E5 873C      STD	Y+12,R19
(2515) 				}
(2516) 				if (clst == 0) break;		/* Could not allocate a new cluster (disk full) */
    024E6 8429      LDD	R2,Y+9
    024E7 843A      LDD	R3,Y+10
    024E8 844B      LDD	R4,Y+11
    024E9 845C      LDD	R5,Y+12
    024EA 9488      BCLR	0
    024EB 2022      TST	R2
    024EC 0432      CPC	R3,R2
    024ED 0442      CPC	R4,R2
    024EE 0452      CPC	R5,R2
    024EF F409      BNE	0x24F1
    024F0 C1FC      RJMP	0x26ED
(2517) 				if (clst == 1) ABORT(fp->fs, FR_INT_ERR);
    024F1 E041      LDI	R20,1
    024F2 E050      LDI	R21,0
    024F3 E060      LDI	R22,0
    024F4 E070      LDI	R23,0
    024F5 8429      LDD	R2,Y+9
    024F6 843A      LDD	R3,Y+10
    024F7 844B      LDD	R4,Y+11
    024F8 845C      LDD	R5,Y+12
    024F9 1624      CP	R2,R20
    024FA 0635      CPC	R3,R21
    024FB 0646      CPC	R4,R22
    024FC 0657      CPC	R5,R23
    024FD F449      BNE	0x2507
    024FE 8D8B      LDD	R24,Y+27
    024FF 8D9C      LDD	R25,Y+28
    02500 9604      ADIW	R24,4
    02501 01FC      MOVW	R30,R24
    02502 8180      LD	R24,Z
    02503 6880      ORI	R24,0x80
    02504 8380      ST	Z,R24
    02505 E002      LDI	R16,2
    02506 C206      RJMP	0x270D
(2518) 				if (clst == 0xFFFFFFFF) ABORT(fp->fs, FR_DISK_ERR);
    02507 EF4F      LDI	R20,0xFF
    02508 EF5F      LDI	R21,0xFF
    02509 EF6F      LDI	R22,0xFF
    0250A EF7F      LDI	R23,0xFF
    0250B 8429      LDD	R2,Y+9
    0250C 843A      LDD	R3,Y+10
    0250D 844B      LDD	R4,Y+11
    0250E 845C      LDD	R5,Y+12
    0250F 1624      CP	R2,R20
    02510 0635      CPC	R3,R21
    02511 0646      CPC	R4,R22
    02512 0657      CPC	R5,R23
    02513 F451      BNE	0x251E
    02514 8D8B      LDD	R24,Y+27
    02515 8D9C      LDD	R25,Y+28
    02516 9604      ADIW	R24,4
    02517 015C      MOVW	R10,R24
    02518 01FC      MOVW	R30,R24
    02519 8180      LD	R24,Z
    0251A 6880      ORI	R24,0x80
    0251B 8380      ST	Z,R24
    0251C E001      LDI	R16,1
    0251D C1EF      RJMP	0x270D
(2519) 				fp->clust = clst;			/* Update current cluster */
    0251E 8429      LDD	R2,Y+9
    0251F 843A      LDD	R3,Y+10
    02520 844B      LDD	R4,Y+11
    02521 845C      LDD	R5,Y+12
    02522 8DEB      LDD	R30,Y+27
    02523 8DFC      LDD	R31,Y+28
    02524 8A22      STD	Z+18,R2
    02525 8A33      STD	Z+19,R3
    02526 8A44      STD	Z+20,R4
    02527 8A55      STD	Z+21,R5
(2520) 			}
(2521) #if _FS_TINY
(2522) 			if (fp->fs->winsect == fp->dsect && move_window(fp->fs, 0))	/* Write-back sector cache */
    02528 8DEB      LDD	R30,Y+27
    02529 8DFC      LDD	R31,Y+28
    0252A 80A0      LD	R10,Z
    0252B 80B1      LDD	R11,Z+1
    0252C 8826      LDD	R2,Z+22
    0252D 8837      LDD	R3,Z+23
    0252E 8C40      LDD	R4,Z+24
    0252F 8C51      LDD	R5,Z+25
    02530 01F5      MOVW	R30,R10
    02531 A462      LDD	R6,Z+42
    02532 A473      LDD	R7,Z+43
    02533 A484      LDD	R8,Z+44
    02534 A495      LDD	R9,Z+45
    02535 1462      CP	R6,R2
    02536 0473      CPC	R7,R3
    02537 0484      CPC	R8,R4
    02538 0495      CPC	R9,R5
    02539 F4B9      BNE	0x2551
    0253A E040      LDI	R20,0
    0253B E050      LDI	R21,0
    0253C E060      LDI	R22,0
    0253D E070      LDI	R23,0
    0253E 8368      ST	Y,R22
    0253F 8379      STD	Y+1,R23
    02540 019A      MOVW	R18,R20
    02541 018F      MOVW	R16,R30
    02542 940E 0C92 CALL	ff.c:move_window
    02544 2EA0      MOV	R10,R16
    02545 2300      TST	R16
    02546 F051      BEQ	0x2551
(2523) 				ABORT(fp->fs, FR_DISK_ERR);
    02547 8D8B      LDD	R24,Y+27
    02548 8D9C      LDD	R25,Y+28
    02549 9604      ADIW	R24,4
    0254A 015C      MOVW	R10,R24
    0254B 01FC      MOVW	R30,R24
    0254C 8180      LD	R24,Z
    0254D 6880      ORI	R24,0x80
    0254E 8380      ST	Z,R24
    0254F E001      LDI	R16,1
    02550 C1BC      RJMP	0x270D
(2524) #else
(2525) 			if (fp->flag & FA__DIRTY) {		/* Write-back sector cache */
(2526) 				if (disk_write(fp->fs->drv, fp->buf, fp->dsect, 1) != RES_OK)
(2527) 					ABORT(fp->fs, FR_DISK_ERR);
(2528) 				fp->flag &= ~FA__DIRTY;
(2529) 			}
(2530) #endif
(2531) 			sect = clust2sect(fp->fs, fp->clust);	/* Get current sector */
    02551 8DEB      LDD	R30,Y+27
    02552 8DFC      LDD	R31,Y+28
    02553 8822      LDD	R2,Z+18
    02554 8833      LDD	R3,Z+19
    02555 8844      LDD	R4,Z+20
    02556 8855      LDD	R5,Z+21
    02557 8248      ST	Y,R4
    02558 8259      STD	Y+1,R5
    02559 0191      MOVW	R18,R2
    0255A 8100      LD	R16,Z
    0255B 8111      LDD	R17,Z+1
    0255C 940E 0E09 CALL	_clust2sect
    0255E 830D      STD	Y+5,R16
    0255F 831E      STD	Y+6,R17
    02560 832F      STD	Y+7,R18
    02561 8738      STD	Y+8,R19
(2532) 			if (!sect) ABORT(fp->fs, FR_INT_ERR);
    02562 802D      LDD	R2,Y+5
    02563 803E      LDD	R3,Y+6
    02564 804F      LDD	R4,Y+7
    02565 8458      LDD	R5,Y+8
    02566 9488      BCLR	0
    02567 2022      TST	R2
    02568 0432      CPC	R3,R2
    02569 0442      CPC	R4,R2
    0256A 0452      CPC	R5,R2
    0256B F451      BNE	0x2576
    0256C 8D8B      LDD	R24,Y+27
    0256D 8D9C      LDD	R25,Y+28
    0256E 9604      ADIW	R24,4
    0256F 015C      MOVW	R10,R24
    02570 01FC      MOVW	R30,R24
    02571 8180      LD	R24,Z
    02572 6880      ORI	R24,0x80
    02573 8380      ST	Z,R24
    02574 E002      LDI	R16,2
    02575 C197      RJMP	0x270D
(2533) 			sect += csect;
    02576 2C2C      MOV	R2,R12
    02577 2433      CLR	R3
    02578 2444      CLR	R4
    02579 2455      CLR	R5
    0257A 806D      LDD	R6,Y+5
    0257B 807E      LDD	R7,Y+6
    0257C 808F      LDD	R8,Y+7
    0257D 8498      LDD	R9,Y+8
    0257E 0C62      ADD	R6,R2
    0257F 1C73      ADC	R7,R3
    02580 1C84      ADC	R8,R4
    02581 1C95      ADC	R9,R5
    02582 826D      STD	Y+5,R6
    02583 827E      STD	Y+6,R7
    02584 828F      STD	Y+7,R8
    02585 8698      STD	Y+8,R9
(2534) 			cc = btw / SS(fp->fs);			/* When remaining bytes >= sector size, */
    02586 E029      LDI	R18,0x9
    02587 E030      LDI	R19,0
    02588 8D0F      LDD	R16,Y+31
    02589 A118      LDD	R17,Y+32
    0258A 940E 4BBA CALL	lsr16
    0258C 0158      MOVW	R10,R16
(2535) 			if (cc) {						/* Write maximum contiguous sectors directly */
    0258D 3000      CPI	R16,0
    0258E 0701      CPC	R16,R17
    0258F F409      BNE	0x2591
    02590 C097      RJMP	0x2628
(2536) 				if (csect + cc > fp->fs->csize)	/* Clip at cluster boundary */
    02591 2C2C      MOV	R2,R12
    02592 2433      CLR	R3
    02593 0E20      ADD	R2,R16
    02594 1E31      ADC	R3,R17
    02595 8DEB      LDD	R30,Y+27
    02596 8DFC      LDD	R31,Y+28
    02597 93AF      PUSH	R26
    02598 93BF      PUSH	R27
    02599 81A0      LD	R26,Z
    0259A 81B1      LDD	R27,Z+1
    0259B 01FD      MOVW	R30,R26
    0259C 91BF      POP	R27
    0259D 91AF      POP	R26
    0259E 8042      LDD	R4,Z+2
    0259F 2455      CLR	R5
    025A0 1442      CP	R4,R2
    025A1 0453      CPC	R5,R3
    025A2 F478      BCC	0x25B2
(2537) 					cc = fp->fs->csize - csect;
    025A3 2C2C      MOV	R2,R12
    025A4 2433      CLR	R3
    025A5 8DEB      LDD	R30,Y+27
    025A6 8DFC      LDD	R31,Y+28
    025A7 93AF      PUSH	R26
    025A8 93BF      PUSH	R27
    025A9 81A0      LD	R26,Z
    025AA 81B1      LDD	R27,Z+1
    025AB 01FD      MOVW	R30,R26
    025AC 91BF      POP	R27
    025AD 91AF      POP	R26
    025AE 80A2      LDD	R10,Z+2
    025AF 24BB      CLR	R11
    025B0 18A2      SUB	R10,R2
    025B1 08B3      SBC	R11,R3
(2538) 				if (disk_write(fp->fs->drv,(char*)wbuff, sect, (BYTE)cc) != RES_OK)
    025B2 82AC      STD	Y+4,R10
    025B3 802D      LDD	R2,Y+5
    025B4 803E      LDD	R3,Y+6
    025B5 804F      LDD	R4,Y+7
    025B6 8458      LDD	R5,Y+8
    025B7 8228      ST	Y,R2
    025B8 8239      STD	Y+1,R3
    025B9 824A      STD	Y+2,R4
    025BA 825B      STD	Y+3,R5
    025BB 0197      MOVW	R18,R14
    025BC 8DEB      LDD	R30,Y+27
    025BD 8DFC      LDD	R31,Y+28
    025BE 93AF      PUSH	R26
    025BF 93BF      PUSH	R27
    025C0 81A0      LD	R26,Z
    025C1 81B1      LDD	R27,Z+1
    025C2 01FD      MOVW	R30,R26
    025C3 91BF      POP	R27
    025C4 91AF      POP	R26
    025C5 8101      LDD	R16,Z+1
    025C6 940E 0C17 CALL	_disk_write
    025C8 2EC0      MOV	R12,R16
    025C9 2300      TST	R16
    025CA F051      BEQ	0x25D5
(2539) 					ABORT(fp->fs, FR_DISK_ERR);
    025CB 8D8B      LDD	R24,Y+27
    025CC 8D9C      LDD	R25,Y+28
    025CD 9604      ADIW	R24,4
    025CE 016C      MOVW	R12,R24
    025CF 01FC      MOVW	R30,R24
    025D0 8180      LD	R24,Z
    025D1 6880      ORI	R24,0x80
    025D2 8380      ST	Z,R24
    025D3 E001      LDI	R16,1
    025D4 C138      RJMP	0x270D
(2540) #if _FS_TINY
(2541) 				if (fp->fs->winsect - sect < cc) {	/* Refill sector cache if it gets invalidated by the direct write */
    025D5 802D      LDD	R2,Y+5
    025D6 803E      LDD	R3,Y+6
    025D7 804F      LDD	R4,Y+7
    025D8 8458      LDD	R5,Y+8
    025D9 8DEB      LDD	R30,Y+27
    025DA 8DFC      LDD	R31,Y+28
    025DB 81A0      LD	R26,Z
    025DC 81B1      LDD	R27,Z+1
    025DD 969A      ADIW	R26,0x2A
    025DE 906D      LD	R6,X+
    025DF 907D      LD	R7,X+
    025E0 908D      LD	R8,X+
    025E1 909C      LD	R9,X
    025E2 1862      SUB	R6,R2
    025E3 0873      SBC	R7,R3
    025E4 0884      SBC	R8,R4
    025E5 0895      SBC	R9,R5
    025E6 0115      MOVW	R2,R10
    025E7 2444      CLR	R4
    025E8 2455      CLR	R5
    025E9 1462      CP	R6,R2
    025EA 0473      CPC	R7,R3
    025EB 0484      CPC	R8,R4
    025EC 0495      CPC	R9,R5
    025ED F008      BCS	0x25EF
    025EE C032      RJMP	0x2621
(2542) 					mem_cpy(fp->fs->win, wbuff + ((fp->fs->winsect - sect) * SS(fp->fs)), SS(fp->fs));
    025EF E080      LDI	R24,0
    025F0 E092      LDI	R25,2
    025F1 8399      STD	Y+1,R25
    025F2 8388      ST	Y,R24
    025F3 80C0      LD	R12,Z
    025F4 80D1      LDD	R13,Z+1
    025F5 802D      LDD	R2,Y+5
    025F6 803E      LDD	R3,Y+6
    025F7 804F      LDD	R4,Y+7
    025F8 8458      LDD	R5,Y+8
    025F9 01F6      MOVW	R30,R12
    025FA A462      LDD	R6,Z+42
    025FB A473      LDD	R7,Z+43
    025FC A484      LDD	R8,Z+44
    025FD A495      LDD	R9,Z+45
    025FE 1862      SUB	R6,R2
    025FF 0873      SBC	R7,R3
    02600 0884      SBC	R8,R4
    02601 0895      SBC	R9,R5
    02602 E040      LDI	R20,0
    02603 E052      LDI	R21,2
    02604 E060      LDI	R22,0
    02605 E070      LDI	R23,0
    02606 929A      ST	-Y,R9
    02607 928A      ST	-Y,R8
    02608 927A      ST	-Y,R7
    02609 926A      ST	-Y,R6
    0260A 018A      MOVW	R16,R20
    0260B 019B      MOVW	R18,R22
    0260C 940E 4AC9 CALL	empy32s|empy32u
    0260E 0198      MOVW	R18,R16
    0260F 0D2E      ADD	R18,R14
    02610 1D3F      ADC	R19,R15
    02611 0186      MOVW	R16,R12
    02612 5D02      SUBI	R16,0xD2
    02613 4F1F      SBCI	R17,0xFF
    02614 940E 0C39 CALL	ff.c:mem_cpy
(2543) 					fp->fs->wflag = 0;
    02616 2422      CLR	R2
    02617 8DEB      LDD	R30,Y+27
    02618 8DFC      LDD	R31,Y+28
    02619 93AF      PUSH	R26
    0261A 93BF      PUSH	R27
    0261B 81A0      LD	R26,Z
    0261C 81B1      LDD	R27,Z+1
    0261D 01FD      MOVW	R30,R26
    0261E 91BF      POP	R27
    0261F 91AF      POP	R26
    02620 8224      STD	Z+4,R2
(2544) 				}
(2545) #else
(2546) 				if (fp->dsect - sect < cc) { /* Refill sector cache if it gets invalidated by the direct write */
(2547) 					mem_cpy(fp->buf, wbuff + ((fp->dsect - sect) * SS(fp->fs)), SS(fp->fs));
(2548) 					fp->flag &= ~FA__DIRTY;
(2549) 				}
(2550) #endif
(2551) 				wcnt = SS(fp->fs) * cc;		/* Number of bytes transferred */
    02621 E000      LDI	R16,0
    02622 E012      LDI	R17,2
    02623 0195      MOVW	R18,R10
    02624 940E 4AB9 CALL	empy16s
    02626 0168      MOVW	R12,R16
(2552) 				continue;
    02627 C099      RJMP	0x26C1
(2553) 			}
(2554) #if _FS_TINY
(2555) 			if (fp->fptr >= fp->fsize) {	/* Avoid silly cache filling at growing edge */
    02628 8DEB      LDD	R30,Y+27
    02629 8DFC      LDD	R31,Y+28
    0262A 8422      LDD	R2,Z+10
    0262B 8433      LDD	R3,Z+11
    0262C 8444      LDD	R4,Z+12
    0262D 8455      LDD	R5,Z+13
    0262E 8066      LDD	R6,Z+6
    0262F 8077      LDD	R7,Z+7
    02630 8480      LDD	R8,Z+8
    02631 8491      LDD	R9,Z+9
    02632 1462      CP	R6,R2
    02633 0473      CPC	R7,R3
    02634 0484      CPC	R8,R4
    02635 0495      CPC	R9,R5
    02636 F128      BCS	0x265C
(2556) 				if (move_window(fp->fs, 0)) ABORT(fp->fs, FR_DISK_ERR);
    02637 E040      LDI	R20,0
    02638 E050      LDI	R21,0
    02639 E060      LDI	R22,0
    0263A E070      LDI	R23,0
    0263B 8368      ST	Y,R22
    0263C 8379      STD	Y+1,R23
    0263D 019A      MOVW	R18,R20
    0263E 8100      LD	R16,Z
    0263F 8111      LDD	R17,Z+1
    02640 940E 0C92 CALL	ff.c:move_window
    02642 2EA0      MOV	R10,R16
    02643 2300      TST	R16
    02644 F051      BEQ	0x264F
    02645 8D8B      LDD	R24,Y+27
    02646 8D9C      LDD	R25,Y+28
    02647 9604      ADIW	R24,4
    02648 015C      MOVW	R10,R24
    02649 01FC      MOVW	R30,R24
    0264A 8180      LD	R24,Z
    0264B 6880      ORI	R24,0x80
    0264C 8380      ST	Z,R24
    0264D E001      LDI	R16,1
    0264E C0BE      RJMP	0x270D
(2557) 				fp->fs->winsect = sect;
    0264F 802D      LDD	R2,Y+5
    02650 803E      LDD	R3,Y+6
    02651 804F      LDD	R4,Y+7
    02652 8458      LDD	R5,Y+8
    02653 8DEB      LDD	R30,Y+27
    02654 8DFC      LDD	R31,Y+28
    02655 81A0      LD	R26,Z
    02656 81B1      LDD	R27,Z+1
    02657 969A      ADIW	R26,0x2A
    02658 922D      ST	X+,R2
    02659 923D      ST	X+,R3
    0265A 924D      ST	X+,R4
    0265B 925C      ST	X,R5
(2558) 			}
(2559) #else
(2560) 			if (fp->dsect != sect) {		/* Fill sector cache with file data */
(2561) 				if (fp->fptr < fp->fsize &&
(2562) 					disk_read(fp->fs->drv, fp->buf, sect, 1) != RES_OK)
(2563) 						ABORT(fp->fs, FR_DISK_ERR);
(2564) 			}
(2565) #endif
(2566) 			fp->dsect = sect;
    0265C 802D      LDD	R2,Y+5
    0265D 803E      LDD	R3,Y+6
    0265E 804F      LDD	R4,Y+7
    0265F 8458      LDD	R5,Y+8
    02660 8DEB      LDD	R30,Y+27
    02661 8DFC      LDD	R31,Y+28
    02662 8A26      STD	Z+22,R2
    02663 8A37      STD	Z+23,R3
    02664 8E40      STD	Z+24,R4
    02665 8E51      STD	Z+25,R5
(2567) 		}
(2568) 		wcnt = SS(fp->fs) - (fp->fptr % SS(fp->fs));/* Put partial sector into file I/O buffer */
    02666 EF4F      LDI	R20,0xFF
    02667 E051      LDI	R21,1
    02668 E060      LDI	R22,0
    02669 E070      LDI	R23,0
    0266A 8DEB      LDD	R30,Y+27
    0266B 8DFC      LDD	R31,Y+28
    0266C 8026      LDD	R2,Z+6
    0266D 8037      LDD	R3,Z+7
    0266E 8440      LDD	R4,Z+8
    0266F 8451      LDD	R5,Z+9
    02670 2224      AND	R2,R20
    02671 2235      AND	R3,R21
    02672 2246      AND	R4,R22
    02673 2257      AND	R5,R23
    02674 E040      LDI	R20,0
    02675 E052      LDI	R21,2
    02676 E060      LDI	R22,0
    02677 E070      LDI	R23,0
    02678 1942      SUB	R20,R2
    02679 0953      SBC	R21,R3
    0267A 0964      SBC	R22,R4
    0267B 0975      SBC	R23,R5
    0267C 016A      MOVW	R12,R20
(2569) 		if (wcnt > btw) wcnt = btw;
    0267D 8C0F      LDD	R0,Y+31
    0267E A018      LDD	R1,Y+32
    0267F 1604      CP	R0,R20
    02680 0615      CPC	R1,R21
    02681 F408      BCC	0x2683
    02682 0160      MOVW	R12,R0
(2570) #if _FS_TINY
(2571) 		if (move_window(fp->fs, fp->dsect))	/* Move sector window */
    02683 8DEB      LDD	R30,Y+27
    02684 8DFC      LDD	R31,Y+28
    02685 8826      LDD	R2,Z+22
    02686 8837      LDD	R3,Z+23
    02687 8C40      LDD	R4,Z+24
    02688 8C51      LDD	R5,Z+25
    02689 8248      ST	Y,R4
    0268A 8259      STD	Y+1,R5
    0268B 0191      MOVW	R18,R2
    0268C 8100      LD	R16,Z
    0268D 8111      LDD	R17,Z+1
    0268E 940E 0C92 CALL	ff.c:move_window
    02690 2EA0      MOV	R10,R16
    02691 2300      TST	R16
    02692 F051      BEQ	0x269D
(2572) 			ABORT(fp->fs, FR_DISK_ERR);
    02693 8D8B      LDD	R24,Y+27
    02694 8D9C      LDD	R25,Y+28
    02695 9604      ADIW	R24,4
    02696 015C      MOVW	R10,R24
    02697 01FC      MOVW	R30,R24
    02698 8180      LD	R24,Z
    02699 6880      ORI	R24,0x80
    0269A 8380      ST	Z,R24
    0269B E001      LDI	R16,1
    0269C C070      RJMP	0x270D
(2573) 		mem_cpy(&fp->fs->win[fp->fptr % SS(fp->fs)], wbuff, wcnt);	/* Fit partial sector */
    0269D 82D9      STD	Y+1,R13
    0269E 82C8      ST	Y,R12
    0269F 0197      MOVW	R18,R14
    026A0 EF4F      LDI	R20,0xFF
    026A1 E051      LDI	R21,1
    026A2 E060      LDI	R22,0
    026A3 E070      LDI	R23,0
    026A4 8DEB      LDD	R30,Y+27
    026A5 8DFC      LDD	R31,Y+28
    026A6 8026      LDD	R2,Z+6
    026A7 8037      LDD	R3,Z+7
    026A8 8440      LDD	R4,Z+8
    026A9 8451      LDD	R5,Z+9
    026AA 2224      AND	R2,R20
    026AB 2235      AND	R3,R21
    026AC 2246      AND	R4,R22
    026AD 2257      AND	R5,R23
    026AE 0181      MOVW	R16,R2
    026AF 8180      LD	R24,Z
    026B0 8191      LDD	R25,Z+1
    026B1 968E      ADIW	R24,0x2E
    026B2 0F08      ADD	R16,R24
    026B3 1F19      ADC	R17,R25
    026B4 940E 0C39 CALL	ff.c:mem_cpy
(2574) 		fp->fs->wflag = 1;
    026B6 E081      LDI	R24,1
    026B7 8DEB      LDD	R30,Y+27
    026B8 8DFC      LDD	R31,Y+28
    026B9 93AF      PUSH	R26
    026BA 93BF      PUSH	R27
    026BB 81A0      LD	R26,Z
    026BC 81B1      LDD	R27,Z+1
    026BD 01FD      MOVW	R30,R26
    026BE 91BF      POP	R27
    026BF 91AF      POP	R26
    026C0 8384      STD	Z+4,R24
    026C1 0CEC      ADD	R14,R12
    026C2 1CFD      ADC	R15,R13
    026C3 8D8B      LDD	R24,Y+27
    026C4 8D9C      LDD	R25,Y+28
    026C5 9606      ADIW	R24,6
    026C6 015C      MOVW	R10,R24
    026C7 0116      MOVW	R2,R12
    026C8 2444      CLR	R4
    026C9 2455      CLR	R5
    026CA 01FC      MOVW	R30,R24
    026CB 8060      LD	R6,Z
    026CC 8071      LDD	R7,Z+1
    026CD 8082      LDD	R8,Z+2
    026CE 8093      LDD	R9,Z+3
    026CF 0C62      ADD	R6,R2
    026D0 1C73      ADC	R7,R3
    026D1 1C84      ADC	R8,R4
    026D2 1C95      ADC	R9,R5
    026D3 8260      ST	Z,R6
    026D4 8271      STD	Z+1,R7
    026D5 8282      STD	Z+2,R8
    026D6 8293      STD	Z+3,R9
    026D7 A1E9      LDD	R30,Y+33
    026D8 A1FA      LDD	R31,Y+34
    026D9 8020      LD	R2,Z
    026DA 8031      LDD	R3,Z+1
    026DB 0C2C      ADD	R2,R12
    026DC 1C3D      ADC	R3,R13
    026DD 8231      STD	Z+1,R3
    026DE 8220      ST	Z,R2
    026DF 8C0F      LDD	R0,Y+31
    026E0 A018      LDD	R1,Y+32
    026E1 180C      SUB	R0,R12
    026E2 081D      SBC	R1,R13
    026E3 A218      STD	Y+32,R1
    026E4 8E0F      STD	Y+31,R0
    026E5 8C0F      LDD	R0,Y+31
    026E6 A018      LDD	R1,Y+32
    026E7 2000      TST	R0
    026E8 F009      BEQ	0x26EA
    026E9 CD5B      RJMP	0x2445
    026EA 2011      TST	R1
    026EB F009      BEQ	0x26ED
    026EC CD58      RJMP	0x2445
(2575) #else
(2576) 		mem_cpy(&fp->buf[fp->fptr % SS(fp->fs)], wbuff, wcnt);	/* Fit partial sector */
(2577) 		fp->flag |= FA__DIRTY;
(2578) #endif
(2579) 	}
(2580) 
(2581) 	if (fp->fptr > fp->fsize) fp->fsize = fp->fptr;	/* Update file size if needed */
    026ED 8DEB      LDD	R30,Y+27
    026EE 8DFC      LDD	R31,Y+28
    026EF 8422      LDD	R2,Z+10
    026F0 8433      LDD	R3,Z+11
    026F1 8444      LDD	R4,Z+12
    026F2 8455      LDD	R5,Z+13
    026F3 8066      LDD	R6,Z+6
    026F4 8077      LDD	R7,Z+7
    026F5 8480      LDD	R8,Z+8
    026F6 8491      LDD	R9,Z+9
    026F7 1426      CP	R2,R6
    026F8 0437      CPC	R3,R7
    026F9 0448      CPC	R4,R8
    026FA 0459      CPC	R5,R9
    026FB F440      BCC	0x2704
    026FC 8026      LDD	R2,Z+6
    026FD 8037      LDD	R3,Z+7
    026FE 8440      LDD	R4,Z+8
    026FF 8451      LDD	R5,Z+9
    02700 8622      STD	Z+10,R2
    02701 8633      STD	Z+11,R3
    02702 8644      STD	Z+12,R4
    02703 8655      STD	Z+13,R5
(2582) 	fp->flag |= FA__WRITTEN;						/* Set file change flag */
    02704 8D8B      LDD	R24,Y+27
    02705 8D9C      LDD	R25,Y+28
    02706 9604      ADIW	R24,4
    02707 015C      MOVW	R10,R24
    02708 01FC      MOVW	R30,R24
    02709 8180      LD	R24,Z
    0270A 6280      ORI	R24,0x20
    0270B 8380      ST	Z,R24
(2583) 
(2584) 	LEAVE_FF(fp->fs, FR_OK);
    0270C 2700      CLR	R16
    0270D 9661      ADIW	R28,0x11
    0270E 940E 4B12 CALL	pop_xgsetF0FC
    02710 9624      ADIW	R28,4
    02711 9508      RET
_f_sync:
  tim                  --> Y,+2
  dir                  --> R22
  res                  --> R10
  fp                   --> R20
    02712 940E 4B58 CALL	push_xgsetF03C
    02714 01A8      MOVW	R20,R16
    02715 9726      SBIW	R28,6
(2585) }
(2586) 
(2587) 
(2588) 
(2589) 
(2590) /*-----------------------------------------------------------------------*/
(2591) /* Synchronize the File Object                                           */
(2592) /*-----------------------------------------------------------------------*/
(2593) 
(2594) FRESULT f_sync (
(2595) 	FIL *fp		/* Pointer to the file object */
(2596) )
(2597) {
(2598) 	FRESULT res;
(2599) 	DWORD tim;
(2600) 	BYTE *dir;
(2601) 
(2602) 
(2603) 	res = validate(fp->fs, fp->id);		/* Check validity of the object */
    02716 01FA      MOVW	R30,R20
    02717 8122      LDD	R18,Z+2
    02718 8133      LDD	R19,Z+3
    02719 8100      LD	R16,Z
    0271A 8111      LDD	R17,Z+1
    0271B D88E      RCALL	ff.c:validate
    0271C 2EA0      MOV	R10,R16
(2604) 	if (res == FR_OK) {
    0271D 2300      TST	R16
    0271E F009      BEQ	0x2720
    0271F C09F      RJMP	0x27BF
(2605) 		if (fp->flag & FA__WRITTEN) {	/* Has the file been written? */
    02720 01FA      MOVW	R30,R20
    02721 8024      LDD	R2,Z+4
    02722 FE25      SBRS	R2,5
    02723 C09B      RJMP	0x27BF
(2606) #if !_FS_TINY	/* Write-back dirty buffer */
(2607) 			if (fp->flag & FA__DIRTY) {
(2608) 				if (disk_write(fp->fs->drv, fp->buf, fp->dsect, 1) != RES_OK)
(2609) 					LEAVE_FF(fp->fs, FR_DISK_ERR);
(2610) 				fp->flag &= ~FA__DIRTY;
(2611) 			}
(2612) #endif
(2613) 			/* Update the directory entry */
(2614) 			res = move_window(fp->fs, fp->dir_sect);
    02724 8C22      LDD	R2,Z+26
    02725 8C33      LDD	R3,Z+27
    02726 8C44      LDD	R4,Z+28
    02727 8C55      LDD	R5,Z+29
    02728 8248      ST	Y,R4
    02729 8259      STD	Y+1,R5
    0272A 0191      MOVW	R18,R2
    0272B 8100      LD	R16,Z
    0272C 8111      LDD	R17,Z+1
    0272D 940E 0C92 CALL	ff.c:move_window
    0272F 2EA0      MOV	R10,R16
(2615) 			if (res == FR_OK) {
    02730 2300      TST	R16
    02731 F009      BEQ	0x2733
    02732 C08C      RJMP	0x27BF
(2616) 				dir = fp->dir_ptr;
    02733 01FA      MOVW	R30,R20
    02734 8D66      LDD	R22,Z+30
    02735 8D77      LDD	R23,Z+31
(2617) 				dir[DIR_Attr] |= AM_ARC;					/* Set archive bit */
    02736 01CB      MOVW	R24,R22
    02737 960B      ADIW	R24,0xB
    02738 01FC      MOVW	R30,R24
    02739 8180      LD	R24,Z
    0273A 6280      ORI	R24,0x20
    0273B 8380      ST	Z,R24
(2618) 				ST_DWORD(dir+DIR_FileSize, fp->fsize);		/* Update file size */
    0273C 01FA      MOVW	R30,R20
    0273D 8422      LDD	R2,Z+10
    0273E 8433      LDD	R3,Z+11
    0273F 8444      LDD	R4,Z+12
    02740 8455      LDD	R5,Z+13
    02741 01FB      MOVW	R30,R22
    02742 8E24      STD	Z+28,R2
    02743 01FA      MOVW	R30,R20
    02744 8422      LDD	R2,Z+10
    02745 8433      LDD	R3,Z+11
    02746 2C23      MOV	R2,R3
    02747 2433      CLR	R3
    02748 01FB      MOVW	R30,R22
    02749 8E25      STD	Z+29,R2
    0274A 01FA      MOVW	R30,R20
    0274B 8422      LDD	R2,Z+10
    0274C 8433      LDD	R3,Z+11
    0274D 8444      LDD	R4,Z+12
    0274E 8455      LDD	R5,Z+13
    0274F 0112      MOVW	R2,R4
    02750 2444      CLR	R4
    02751 2455      CLR	R5
    02752 01FB      MOVW	R30,R22
    02753 8E26      STD	Z+30,R2
    02754 E188      LDI	R24,0x18
    02755 E090      LDI	R25,0
    02756 01FA      MOVW	R30,R20
    02757 8502      LDD	R16,Z+10
    02758 8513      LDD	R17,Z+11
    02759 8524      LDD	R18,Z+12
    0275A 8535      LDD	R19,Z+13
    0275B 938A      ST	-Y,R24
    0275C 940E 4BC1 CALL	lsr32
    0275E 01FB      MOVW	R30,R22
    0275F 8F07      STD	Z+31,R16
(2619) 				ST_CLUST(dir, fp->sclust);					/* Update start cluster */
    02760 01FA      MOVW	R30,R20
    02761 8426      LDD	R2,Z+14
    02762 8437      LDD	R3,Z+15
    02763 8840      LDD	R4,Z+16
    02764 8851      LDD	R5,Z+17
    02765 01FB      MOVW	R30,R22
    02766 8E22      STD	Z+26,R2
    02767 01FA      MOVW	R30,R20
    02768 8426      LDD	R2,Z+14
    02769 8437      LDD	R3,Z+15
    0276A 2C23      MOV	R2,R3
    0276B 2433      CLR	R3
    0276C 01FB      MOVW	R30,R22
    0276D 8E23      STD	Z+27,R2
    0276E 01FA      MOVW	R30,R20
    0276F 8426      LDD	R2,Z+14
    02770 8437      LDD	R3,Z+15
    02771 8840      LDD	R4,Z+16
    02772 8851      LDD	R5,Z+17
    02773 0112      MOVW	R2,R4
    02774 2444      CLR	R4
    02775 2455      CLR	R5
    02776 01FB      MOVW	R30,R22
    02777 8A24      STD	Z+20,R2
    02778 01FA      MOVW	R30,R20
    02779 8426      LDD	R2,Z+14
    0277A 8437      LDD	R3,Z+15
    0277B 8840      LDD	R4,Z+16
    0277C 8851      LDD	R5,Z+17
    0277D 0112      MOVW	R2,R4
    0277E 2C23      MOV	R2,R3
    0277F 2433      CLR	R3
    02780 01FB      MOVW	R30,R22
    02781 8A25      STD	Z+21,R2
(2620) 				tim = get_fattime();						/* Update updated time */
    02782 940E 0C34 CALL	_get_fattime
    02784 830A      STD	Y+2,R16
    02785 831B      STD	Y+3,R17
    02786 832C      STD	Y+4,R18
    02787 833D      STD	Y+5,R19
(2621) 				ST_DWORD(dir+DIR_WrtTime, tim);
    02788 802A      LDD	R2,Y+2
    02789 803B      LDD	R3,Y+3
    0278A 804C      LDD	R4,Y+4
    0278B 805D      LDD	R5,Y+5
    0278C 01FB      MOVW	R30,R22
    0278D 8A26      STD	Z+22,R2
    0278E 2C23      MOV	R2,R3
    0278F 2433      CLR	R3
    02790 9677      ADIW	R30,0x17
    02791 8220      ST	Z,R2
    02792 802A      LDD	R2,Y+2
    02793 803B      LDD	R3,Y+3
    02794 804C      LDD	R4,Y+4
    02795 805D      LDD	R5,Y+5
    02796 0112      MOVW	R2,R4
    02797 2444      CLR	R4
    02798 2455      CLR	R5
    02799 01FB      MOVW	R30,R22
    0279A 9678      ADIW	R30,0x18
    0279B 8220      ST	Z,R2
    0279C E188      LDI	R24,0x18
    0279D E090      LDI	R25,0
    0279E 810A      LDD	R16,Y+2
    0279F 811B      LDD	R17,Y+3
    027A0 812C      LDD	R18,Y+4
    027A1 813D      LDD	R19,Y+5
    027A2 938A      ST	-Y,R24
    027A3 940E 4BC1 CALL	lsr32
    027A5 01FB      MOVW	R30,R22
    027A6 8F01      STD	Z+25,R16
(2622) 				fp->flag &= ~FA__WRITTEN;
    027A7 01BA      MOVW	R22,R20
    027A8 5F6C      SUBI	R22,0xFC
    027A9 4F7F      SBCI	R23,0xFF
    027AA 01FB      MOVW	R30,R22
    027AB 8180      LD	R24,Z
    027AC 7D8F      ANDI	R24,0xDF
    027AD 8380      ST	Z,R24
(2623) 				fp->fs->wflag = 1;
    027AE E081      LDI	R24,1
    027AF 01FA      MOVW	R30,R20
    027B0 93AF      PUSH	R26
    027B1 93BF      PUSH	R27
    027B2 81A0      LD	R26,Z
    027B3 81B1      LDD	R27,Z+1
    027B4 01FD      MOVW	R30,R26
    027B5 91BF      POP	R27
    027B6 91AF      POP	R26
    027B7 8384      STD	Z+4,R24
(2624) 				res = sync(fp->fs);
    027B8 01FA      MOVW	R30,R20
    027B9 8100      LD	R16,Z
    027BA 8111      LDD	R17,Z+1
    027BB 940E 0D34 CALL	ff.c:sync
    027BD 2EC0      MOV	R12,R16
    027BE 2CAC      MOV	R10,R12
(2625) 			}
(2626) 		}
(2627) 	}
(2628) 
(2629) 	LEAVE_FF(fp->fs, res);
    027BF 2D0A      MOV	R16,R10
    027C0 9626      ADIW	R28,6
    027C1 940C 4B61 JMP	pop_xgsetF03C
_f_close:
  res                  --> R10
  fp                   --> R12
    027C3 940E 4B23 CALL	push_xgset003C
    027C5 0168      MOVW	R12,R16
(2630) }
(2631) 
(2632) #endif /* !_FS_READONLY */
(2633) 
(2634) 
(2635) 
(2636) 
(2637) /*-----------------------------------------------------------------------*/
(2638) /* Close File                                                            */
(2639) /*-----------------------------------------------------------------------*/
(2640) 
(2641) FRESULT f_close (
(2642) 	FIL *fp		/* Pointer to the file object to be closed */
(2643) )
(2644) {
(2645) 	FRESULT res;
(2646) 
(2647) #if _FS_READONLY
(2648) 	FATFS *fs = fp->fs;
(2649) 	res = validate(fs, fp->id);
(2650) 	if (res == FR_OK) fp->fs = 0;	/* Discard file object */
(2651) 	LEAVE_FF(fs, res);
(2652) 
(2653) #else
(2654) 	res = f_sync(fp);		/* Flush cached data */
    027C6 0186      MOVW	R16,R12
    027C7 DF4A      RCALL	_f_sync
    027C8 2EA0      MOV	R10,R16
(2655) #if _FS_SHARE
(2656) 	if (res == FR_OK) {		/* Decrement open counter */
(2657) #if _FS_REENTRANT
(2658) 		res = validate(fp->fs, fp->id);
(2659) 		if (res == FR_OK) {
(2660) 			res = dec_lock(fp->lockid);	
(2661) 			unlock_fs(fp->fs, FR_OK);
(2662) 		}
(2663) #else
(2664) 		res = dec_lock(fp->lockid);
(2665) #endif
(2666) 	}
(2667) #endif
(2668) 	if (res == FR_OK) fp->fs = 0;	/* Discard file object */
    027C9 2300      TST	R16
    027CA F429      BNE	0x27D0
    027CB 2422      CLR	R2
    027CC 2433      CLR	R3
    027CD 01F6      MOVW	R30,R12
    027CE 8231      STD	Z+1,R3
    027CF 8220      ST	Z,R2
(2669) 	return res;
    027D0 2D0A      MOV	R16,R10
    027D1 940C 4AFD JMP	pop_xgset003C
_f_lseek:
  ifptr                --> Y,+14
  nsect                --> Y,+10
  bcs                  --> Y,+6
  clst                 --> Y,+2
  dsc                  --> Y,+26
  tlen                 --> Y,+22
  tbl                  --> R14
  tcl                  --> Y,+18
  ulen                 --> Y,+14
  ncl                  --> Y,+10
  pcl                  --> Y,+6
  cl                   --> Y,+2
  res                  --> R10
  ofs                  --> Y,+42
  fp                   --> Y,+40
    027D3 940E 49D8 CALL	push_arg4
    027D5 940E 4B1D CALL	push_xgsetF0FC
    027D7 976E      SBIW	R28,0x1E
(2670) #endif
(2671) }
(2672) 
(2673) 
(2674) 
(2675) 
(2676) /*-----------------------------------------------------------------------*/
(2677) /* Current Drive/Directory Handlings                                     */
(2678) /*-----------------------------------------------------------------------*/
(2679) 
(2680) #if _FS_RPATH >= 1
(2681) 
(2682) FRESULT f_chdrive (
(2683) 	BYTE drv		/* Drive number */
(2684) )
(2685) {
(2686) 	if (drv >= _VOLUMES) return FR_INVALID_DRIVE;
(2687) 
(2688) 	CurrVol = drv;
(2689) 
(2690) 	return FR_OK;
(2691) }
(2692) 
(2693) 
(2694) 
(2695) FRESULT f_chdir (
(2696) 	const TCHAR *path	/* Pointer to the directory path */
(2697) )
(2698) {
(2699) 	FRESULT res;
(2700) 	DIR dj;
(2701) 	DEF_NAMEBUF;
(2702) 
(2703) 
(2704) 	res = chk_mounted(&path, &dj.fs, 0);
(2705) 	if (res == FR_OK) {
(2706) 		INIT_BUF(dj);
(2707) 		res = follow_path(&dj, path);		/* Follow the path */
(2708) 		FREE_BUF();
(2709) 		if (res == FR_OK) {					/* Follow completed */
(2710) 			if (!dj.dir) {
(2711) 				dj.fs->cdir = dj.sclust;	/* Start directory itself */
(2712) 			} else {
(2713) 				if (dj.dir[DIR_Attr] & AM_DIR)	/* Reached to the directory */
(2714) 					dj.fs->cdir = LD_CLUST(dj.dir);
(2715) 				else
(2716) 					res = FR_NO_PATH;		/* Reached but a file */
(2717) 			}
(2718) 		}
(2719) 		if (res == FR_NO_FILE) res = FR_NO_PATH;
(2720) 	}
(2721) 
(2722) 	LEAVE_FF(dj.fs, res);
(2723) }
(2724) 
(2725) 
(2726) #if _FS_RPATH >= 2
(2727) FRESULT f_getcwd (
(2728) 	TCHAR *path,	/* Pointer to the directory path */
(2729) 	UINT sz_path	/* Size of path */
(2730) )
(2731) {
(2732) 	FRESULT res;
(2733) 	DIR dj;
(2734) 	UINT i, n;
(2735) 	DWORD ccl;
(2736) 	TCHAR *tp;
(2737) 	FILINFO fno;
(2738) 	DEF_NAMEBUF;
(2739) 
(2740) 
(2741) 	*path = 0;
(2742) 	res = chk_mounted((const TCHAR**)&path, &dj.fs, 0);	/* Get current volume */
(2743) 	if (res == FR_OK) {
(2744) 		INIT_BUF(dj);
(2745) 		i = sz_path;		/* Bottom of buffer (dir stack base) */
(2746) 		dj.sclust = dj.fs->cdir;			/* Start to follow upper dir from current dir */
(2747) 		while ((ccl = dj.sclust) != 0) {	/* Repeat while current dir is a sub-dir */
(2748) 			res = dir_sdi(&dj, 1);			/* Get parent dir */
(2749) 			if (res != FR_OK) break;
(2750) 			res = dir_read(&dj);
(2751) 			if (res != FR_OK) break;
(2752) 			dj.sclust = LD_CLUST(dj.dir);	/* Goto parent dir */
(2753) 			res = dir_sdi(&dj, 0);
(2754) 			if (res != FR_OK) break;
(2755) 			do {							/* Find the entry links to the child dir */
(2756) 				res = dir_read(&dj);
(2757) 				if (res != FR_OK) break;
(2758) 				if (ccl == LD_CLUST(dj.dir)) break;	/* Found the entry */
(2759) 				res = dir_next(&dj, 0);	
(2760) 			} while (res == FR_OK);
(2761) 			if (res == FR_NO_FILE) res = FR_INT_ERR;/* It cannot be 'not found'. */
(2762) 			if (res != FR_OK) break;
(2763) #if _USE_LFN
(2764) 			fno.lfname = path;
(2765) 			fno.lfsize = i;
(2766) #endif
(2767) 			get_fileinfo(&dj, &fno);		/* Get the dir name and push it to the buffer */
(2768) 			tp = fno.fname;
(2769) 			if (_USE_LFN && *path) tp = path;
(2770) 			for (n = 0; tp[n]; n++) ;
(2771) 			if (i < n + 3) {
(2772) 				res = FR_NOT_ENOUGH_CORE; break;
(2773) 			}
(2774) 			while (n) path[--i] = tp[--n];
(2775) 			path[--i] = '/';
(2776) 		}
(2777) 		tp = path;
(2778) 		if (res == FR_OK) {
(2779) 			*tp++ = '0' + CurrVol;			/* Put drive number */
(2780) 			*tp++ = ':';
(2781) 			if (i == sz_path) {				/* Root-dir */
(2782) 				*tp++ = '/';
(2783) 			} else {						/* Sub-dir */
(2784) 				do		/* Add stacked path str */
(2785) 					*tp++ = path[i++];
(2786) 				while (i < sz_path);
(2787) 			}
(2788) 		}
(2789) 		*tp = 0;
(2790) 		FREE_BUF();
(2791) 	}
(2792) 
(2793) 	LEAVE_FF(dj.fs, res);
(2794) }
(2795) #endif /* _FS_RPATH >= 2 */
(2796) #endif /* _FS_RPATH >= 1 */
(2797) 
(2798) 
(2799) 
(2800) #if _FS_MINIMIZE <= 2
(2801) /*-----------------------------------------------------------------------*/
(2802) /* Seek File R/W Pointer                                                 */
(2803) /*-----------------------------------------------------------------------*/
(2804) 
(2805) FRESULT f_lseek (
(2806) 	FIL *fp,		/* Pointer to the file object */
(2807) 	DWORD ofs		/* File pointer from top of file */
(2808) )
(2809) {
(2810) 	FRESULT res;
(2811) 
(2812) 
(2813) 	res = validate(fp->fs, fp->id);		/* Check validity of the object */
    027D8 A5E8      LDD	R30,Y+40
    027D9 A5F9      LDD	R31,Y+41
    027DA 8122      LDD	R18,Z+2
    027DB 8133      LDD	R19,Z+3
    027DC 8100      LD	R16,Z
    027DD 8111      LDD	R17,Z+1
    027DE 940E 1FAA CALL	ff.c:validate
    027E0 2EA0      MOV	R10,R16
(2814) 	if (res != FR_OK) LEAVE_FF(fp->fs, res);
    027E1 2300      TST	R16
    027E2 F009      BEQ	0x27E4
    027E3 C4A7      RJMP	0x2C8B
(2815) 	if (fp->flag & FA__ERROR)			/* Check abort flag */
    027E4 A5E8      LDD	R30,Y+40
    027E5 A5F9      LDD	R31,Y+41
    027E6 8024      LDD	R2,Z+4
    027E7 FE27      SBRS	R2,7
    027E8 C002      RJMP	0x27EB
(2816) 		LEAVE_FF(fp->fs, FR_INT_ERR);
    027E9 E002      LDI	R16,2
    027EA C4A0      RJMP	0x2C8B
(2817) 
(2818) #if _USE_FASTSEEK
(2819) 	if (fp->cltbl) {	/* Fast seek */
    027EB A5E8      LDD	R30,Y+40
    027EC A5F9      LDD	R31,Y+41
    027ED 96B0      ADIW	R30,0x20
    027EE 8020      LD	R2,Z
    027EF 8031      LDD	R3,Z+1
    027F0 2022      TST	R2
    027F1 F419      BNE	0x27F5
    027F2 2033      TST	R3
    027F3 F409      BNE	0x27F5
    027F4 C1E3      RJMP	0x29D8
(2820) 		DWORD cl, pcl, ncl, tcl, dsc, tlen, ulen, *tbl;
(2821) 
(2822) 		if (ofs == CREATE_LINKMAP) {	/* Create CLMT */
    027F5 EF4F      LDI	R20,0xFF
    027F6 EF5F      LDI	R21,0xFF
    027F7 EF6F      LDI	R22,0xFF
    027F8 EF7F      LDI	R23,0xFF
    027F9 A42A      LDD	R2,Y+42
    027FA A43B      LDD	R3,Y+43
    027FB A44C      LDD	R4,Y+44
    027FC A45D      LDD	R5,Y+45
    027FD 1624      CP	R2,R20
    027FE 0635      CPC	R3,R21
    027FF 0646      CPC	R4,R22
    02800 0657      CPC	R5,R23
    02801 F009      BEQ	0x2803
    02802 C109      RJMP	0x290C
(2823) 			tbl = fp->cltbl;
    02803 A5E8      LDD	R30,Y+40
    02804 A5F9      LDD	R31,Y+41
    02805 A0E0      LDD	R14,Z+32
    02806 A0F1      LDD	R15,Z+33
(2824) 			tlen = *tbl++; ulen = 2;	/* Given table size and required table size */
    02807 01F7      MOVW	R30,R14
    02808 9021      LD	R2,Z+
    02809 9031      LD	R3,Z+
    0280A 9041      LD	R4,Z+
    0280B 9051      LD	R5,Z+
    0280C 017F      MOVW	R14,R30
    0280D 8A2E      STD	Y+22,R2
    0280E 8A3F      STD	Y+23,R3
    0280F 8E48      STD	Y+24,R4
    02810 8E59      STD	Y+25,R5
    02811 E082      LDI	R24,2
    02812 878E      STD	Y+14,R24
    02813 E080      LDI	R24,0
    02814 878F      STD	Y+15,R24
    02815 8B88      STD	Y+16,R24
    02816 8B89      STD	Y+17,R24
(2825) 			cl = fp->sclust;			/* Top of the chain */
    02817 A5E8      LDD	R30,Y+40
    02818 A5F9      LDD	R31,Y+41
    02819 963E      ADIW	R30,0xE
    0281A 8020      LD	R2,Z
    0281B 8031      LDD	R3,Z+1
    0281C 8042      LDD	R4,Z+2
    0281D 8053      LDD	R5,Z+3
    0281E 822A      STD	Y+2,R2
    0281F 823B      STD	Y+3,R3
    02820 824C      STD	Y+4,R4
    02821 825D      STD	Y+5,R5
(2826) 			if (cl) {
    02822 802A      LDD	R2,Y+2
    02823 803B      LDD	R3,Y+3
    02824 804C      LDD	R4,Y+4
    02825 805D      LDD	R5,Y+5
    02826 9488      BCLR	0
    02827 2022      TST	R2
    02828 0432      CPC	R3,R2
    02829 0442      CPC	R4,R2
    0282A 0452      CPC	R5,R2
    0282B F409      BNE	0x282D
    0282C C0BB      RJMP	0x28E8
(2827) 				do {
(2828) 					/* Get a fragment */
(2829) 					tcl = cl; ncl = 0; ulen += 2;	/* Top, length and used items */
    0282D 802A      LDD	R2,Y+2
    0282E 803B      LDD	R3,Y+3
    0282F 804C      LDD	R4,Y+4
    02830 805D      LDD	R5,Y+5
    02831 8A2A      STD	Y+18,R2
    02832 8A3B      STD	Y+19,R3
    02833 8A4C      STD	Y+20,R4
    02834 8A5D      STD	Y+21,R5
    02835 E080      LDI	R24,0
    02836 878A      STD	Y+10,R24
    02837 878B      STD	Y+11,R24
    02838 878C      STD	Y+12,R24
    02839 878D      STD	Y+13,R24
    0283A E042      LDI	R20,2
    0283B E050      LDI	R21,0
    0283C E060      LDI	R22,0
    0283D E070      LDI	R23,0
    0283E 842E      LDD	R2,Y+14
    0283F 843F      LDD	R3,Y+15
    02840 8848      LDD	R4,Y+16
    02841 8859      LDD	R5,Y+17
    02842 0E24      ADD	R2,R20
    02843 1E35      ADC	R3,R21
    02844 1E46      ADC	R4,R22
    02845 1E57      ADC	R5,R23
    02846 862E      STD	Y+14,R2
    02847 863F      STD	Y+15,R3
    02848 8A48      STD	Y+16,R4
    02849 8A59      STD	Y+17,R5
(2830) 					do {
(2831) 						pcl = cl; ncl++;
    0284A 802A      LDD	R2,Y+2
    0284B 803B      LDD	R3,Y+3
    0284C 804C      LDD	R4,Y+4
    0284D 805D      LDD	R5,Y+5
    0284E 822E      STD	Y+6,R2
    0284F 823F      STD	Y+7,R3
    02850 8648      STD	Y+8,R4
    02851 8659      STD	Y+9,R5
    02852 E041      LDI	R20,1
    02853 E050      LDI	R21,0
    02854 E060      LDI	R22,0
    02855 E070      LDI	R23,0
    02856 842A      LDD	R2,Y+10
    02857 843B      LDD	R3,Y+11
    02858 844C      LDD	R4,Y+12
    02859 845D      LDD	R5,Y+13
    0285A 0E24      ADD	R2,R20
    0285B 1E35      ADC	R3,R21
    0285C 1E46      ADC	R4,R22
    0285D 1E57      ADC	R5,R23
    0285E 862A      STD	Y+10,R2
    0285F 863B      STD	Y+11,R3
    02860 864C      STD	Y+12,R4
    02861 865D      STD	Y+13,R5
(2832) 						cl = get_fat(fp->fs, cl);
    02862 802A      LDD	R2,Y+2
    02863 803B      LDD	R3,Y+3
    02864 804C      LDD	R4,Y+4
    02865 805D      LDD	R5,Y+5
    02866 8248      ST	Y,R4
    02867 8259      STD	Y+1,R5
    02868 0191      MOVW	R18,R2
    02869 A5E8      LDD	R30,Y+40
    0286A A5F9      LDD	R31,Y+41
    0286B 8100      LD	R16,Z
    0286C 8111      LDD	R17,Z+1
    0286D 940E 0E5B CALL	_get_fat
    0286F 830A      STD	Y+2,R16
    02870 831B      STD	Y+3,R17
    02871 832C      STD	Y+4,R18
    02872 833D      STD	Y+5,R19
(2833) 						if (cl <= 1) ABORT(fp->fs, FR_INT_ERR);
    02873 E041      LDI	R20,1
    02874 E050      LDI	R21,0
    02875 E060      LDI	R22,0
    02876 E070      LDI	R23,0
    02877 802A      LDD	R2,Y+2
    02878 803B      LDD	R3,Y+3
    02879 804C      LDD	R4,Y+4
    0287A 805D      LDD	R5,Y+5
    0287B 1542      CP	R20,R2
    0287C 0553      CPC	R21,R3
    0287D 0564      CPC	R22,R4
    0287E 0575      CPC	R23,R5
    0287F F048      BCS	0x2889
    02880 A588      LDD	R24,Y+40
    02881 A599      LDD	R25,Y+41
    02882 9604      ADIW	R24,4
    02883 01FC      MOVW	R30,R24
    02884 8180      LD	R24,Z
    02885 6880      ORI	R24,0x80
    02886 8380      ST	Z,R24
    02887 E002      LDI	R16,2
    02888 C402      RJMP	0x2C8B
(2834) 						if (cl == 0xFFFFFFFF) ABORT(fp->fs, FR_DISK_ERR);
    02889 EF4F      LDI	R20,0xFF
    0288A EF5F      LDI	R21,0xFF
    0288B EF6F      LDI	R22,0xFF
    0288C EF7F      LDI	R23,0xFF
    0288D 802A      LDD	R2,Y+2
    0288E 803B      LDD	R3,Y+3
    0288F 804C      LDD	R4,Y+4
    02890 805D      LDD	R5,Y+5
    02891 1624      CP	R2,R20
    02892 0635      CPC	R3,R21
    02893 0646      CPC	R4,R22
    02894 0657      CPC	R5,R23
    02895 F451      BNE	0x28A0
    02896 A588      LDD	R24,Y+40
    02897 A599      LDD	R25,Y+41
    02898 9604      ADIW	R24,4
    02899 016C      MOVW	R12,R24
    0289A 01FC      MOVW	R30,R24
    0289B 8180      LD	R24,Z
    0289C 6880      ORI	R24,0x80
    0289D 8380      ST	Z,R24
    0289E E001      LDI	R16,1
    0289F C3EB      RJMP	0x2C8B
(2835) 					} while (cl == pcl + 1);
    028A0 E041      LDI	R20,1
    028A1 E050      LDI	R21,0
    028A2 E060      LDI	R22,0
    028A3 E070      LDI	R23,0
    028A4 802E      LDD	R2,Y+6
    028A5 803F      LDD	R3,Y+7
    028A6 8448      LDD	R4,Y+8
    028A7 8459      LDD	R5,Y+9
    028A8 0E24      ADD	R2,R20
    028A9 1E35      ADC	R3,R21
    028AA 1E46      ADC	R4,R22
    028AB 1E57      ADC	R5,R23
    028AC 806A      LDD	R6,Y+2
    028AD 807B      LDD	R7,Y+3
    028AE 808C      LDD	R8,Y+4
    028AF 809D      LDD	R9,Y+5
    028B0 1462      CP	R6,R2
    028B1 0473      CPC	R7,R3
    028B2 0484      CPC	R8,R4
    028B3 0495      CPC	R9,R5
    028B4 F409      BNE	0x28B6
    028B5 CF94      RJMP	0x284A
(2836) 					if (ulen <= tlen) {		/* Store the length and top of the fragment */
    028B6 882E      LDD	R2,Y+22
    028B7 883F      LDD	R3,Y+23
    028B8 8C48      LDD	R4,Y+24
    028B9 8C59      LDD	R5,Y+25
    028BA 846E      LDD	R6,Y+14
    028BB 847F      LDD	R7,Y+15
    028BC 8888      LDD	R8,Y+16
    028BD 8899      LDD	R9,Y+17
    028BE 1426      CP	R2,R6
    028BF 0437      CPC	R3,R7
    028C0 0448      CPC	R4,R8
    028C1 0459      CPC	R5,R9
    028C2 F090      BCS	0x28D5
(2837) 						*tbl++ = ncl; *tbl++ = tcl;
    028C3 842A      LDD	R2,Y+10
    028C4 843B      LDD	R3,Y+11
    028C5 844C      LDD	R4,Y+12
    028C6 845D      LDD	R5,Y+13
    028C7 01F7      MOVW	R30,R14
    028C8 9221      ST	Z+,R2
    028C9 9231      ST	Z+,R3
    028CA 9241      ST	Z+,R4
    028CB 9251      ST	Z+,R5
    028CC 882A      LDD	R2,Y+18
    028CD 883B      LDD	R3,Y+19
    028CE 884C      LDD	R4,Y+20
    028CF 885D      LDD	R5,Y+21
    028D0 9221      ST	Z+,R2
    028D1 9231      ST	Z+,R3
    028D2 9241      ST	Z+,R4
    028D3 9251      ST	Z+,R5
    028D4 017F      MOVW	R14,R30
(2838) 					}
(2839) 				} while (cl < fp->fs->n_fatent);	/* Repeat until end of chain */
    028D5 A5E8      LDD	R30,Y+40
    028D6 A5F9      LDD	R31,Y+41
    028D7 81A0      LD	R26,Z
    028D8 81B1      LDD	R27,Z+1
    028D9 9656      ADIW	R26,0x16
    028DA 902D      LD	R2,X+
    028DB 903D      LD	R3,X+
    028DC 904D      LD	R4,X+
    028DD 905C      LD	R5,X
    028DE 806A      LDD	R6,Y+2
    028DF 807B      LDD	R7,Y+3
    028E0 808C      LDD	R8,Y+4
    028E1 809D      LDD	R9,Y+5
    028E2 1462      CP	R6,R2
    028E3 0473      CPC	R7,R3
    028E4 0484      CPC	R8,R4
    028E5 0495      CPC	R9,R5
    028E6 F408      BCC	0x28E8
    028E7 CF45      RJMP	0x282D
(2840) 			}
(2841) 			*fp->cltbl = ulen;	/* Number of items used */
    028E8 842E      LDD	R2,Y+14
    028E9 843F      LDD	R3,Y+15
    028EA 8848      LDD	R4,Y+16
    028EB 8859      LDD	R5,Y+17
    028EC A5E8      LDD	R30,Y+40
    028ED A5F9      LDD	R31,Y+41
    028EE 96B0      ADIW	R30,0x20
    028EF 81A0      LD	R26,Z
    028F0 81B1      LDD	R27,Z+1
    028F1 922D      ST	X+,R2
    028F2 923D      ST	X+,R3
    028F3 924D      ST	X+,R4
    028F4 925C      ST	X,R5
(2842) 			if (ulen <= tlen)
    028F5 882E      LDD	R2,Y+22
    028F6 883F      LDD	R3,Y+23
    028F7 8C48      LDD	R4,Y+24
    028F8 8C59      LDD	R5,Y+25
    028F9 846E      LDD	R6,Y+14
    028FA 847F      LDD	R7,Y+15
    028FB 8888      LDD	R8,Y+16
    028FC 8899      LDD	R9,Y+17
    028FD 1426      CP	R2,R6
    028FE 0437      CPC	R3,R7
    028FF 0448      CPC	R4,R8
    02900 0459      CPC	R5,R9
    02901 F038      BCS	0x2909
(2843) 				*tbl = 0;		/* Terminate table */
    02902 01F7      MOVW	R30,R14
    02903 E080      LDI	R24,0
    02904 8380      ST	Z,R24
    02905 8381      STD	Z+1,R24
    02906 8382      STD	Z+2,R24
    02907 8383      STD	Z+3,R24
    02908 C381      RJMP	0x2C8A
(2844) 			else
(2845) 				res = FR_NOT_ENOUGH_CORE;	/* Given table size is smaller than required */
    02909 E181      LDI	R24,0x11
    0290A 2EA8      MOV	R10,R24
(2846) 
(2847) 		} else {						/* Fast seek */
    0290B C37E      RJMP	0x2C8A
(2848) 			if (ofs > fp->fsize)		/* Clip offset at the file size */
    0290C A5E8      LDD	R30,Y+40
    0290D A5F9      LDD	R31,Y+41
    0290E 963A      ADIW	R30,0xA
    0290F 8020      LD	R2,Z
    02910 8031      LDD	R3,Z+1
    02911 8042      LDD	R4,Z+2
    02912 8053      LDD	R5,Z+3
    02913 A46A      LDD	R6,Y+42
    02914 A47B      LDD	R7,Y+43
    02915 A48C      LDD	R8,Y+44
    02916 A49D      LDD	R9,Y+45
    02917 1426      CP	R2,R6
    02918 0437      CPC	R3,R7
    02919 0448      CPC	R4,R8
    0291A 0459      CPC	R5,R9
    0291B F458      BCC	0x2927
(2849) 				ofs = fp->fsize;
    0291C A5E8      LDD	R30,Y+40
    0291D A5F9      LDD	R31,Y+41
    0291E 963A      ADIW	R30,0xA
    0291F 8020      LD	R2,Z
    02920 8031      LDD	R3,Z+1
    02921 8042      LDD	R4,Z+2
    02922 8053      LDD	R5,Z+3
    02923 A62A      STD	Y+42,R2
    02924 A63B      STD	Y+43,R3
    02925 A64C      STD	Y+44,R4
    02926 A65D      STD	Y+45,R5
(2850) 			fp->fptr = ofs;				/* Set file pointer */
    02927 A42A      LDD	R2,Y+42
    02928 A43B      LDD	R3,Y+43
    02929 A44C      LDD	R4,Y+44
    0292A A45D      LDD	R5,Y+45
    0292B A5E8      LDD	R30,Y+40
    0292C A5F9      LDD	R31,Y+41
    0292D 9636      ADIW	R30,6
    0292E 8220      ST	Z,R2
    0292F 8231      STD	Z+1,R3
    02930 8242      STD	Z+2,R4
    02931 8253      STD	Z+3,R5
(2851) 			if (ofs) {
    02932 9488      BCLR	0
    02933 2022      TST	R2
    02934 0432      CPC	R3,R2
    02935 0442      CPC	R4,R2
    02936 0452      CPC	R5,R2
    02937 F409      BNE	0x2939
    02938 C351      RJMP	0x2C8A
(2852) 				fp->clust = clmt_clust(fp, ofs - 1);
    02939 E041      LDI	R20,1
    0293A E050      LDI	R21,0
    0293B E060      LDI	R22,0
    0293C E070      LDI	R23,0
    0293D 1A24      SUB	R2,R20
    0293E 0A35      SBC	R3,R21
    0293F 0A46      SBC	R4,R22
    02940 0A57      SBC	R5,R23
    02941 8248      ST	Y,R4
    02942 8259      STD	Y+1,R5
    02943 0191      MOVW	R18,R2
    02944 A508      LDD	R16,Y+40
    02945 A519      LDD	R17,Y+41
    02946 940E 1395 CALL	ff.c:clmt_clust
    02948 A5E8      LDD	R30,Y+40
    02949 A5F9      LDD	R31,Y+41
    0294A 8B02      STD	Z+18,R16
    0294B 8B13      STD	Z+19,R17
    0294C 8B24      STD	Z+20,R18
    0294D 8B35      STD	Z+21,R19
(2853) 				dsc = clust2sect(fp->fs, fp->clust);
    0294E 8822      LDD	R2,Z+18
    0294F 8833      LDD	R3,Z+19
    02950 8844      LDD	R4,Z+20
    02951 8855      LDD	R5,Z+21
    02952 8248      ST	Y,R4
    02953 8259      STD	Y+1,R5
    02954 0191      MOVW	R18,R2
    02955 8100      LD	R16,Z
    02956 8111      LDD	R17,Z+1
    02957 940E 0E09 CALL	_clust2sect
    02959 8F0A      STD	Y+26,R16
    0295A 8F1B      STD	Y+27,R17
    0295B 8F2C      STD	Y+28,R18
    0295C 8F3D      STD	Y+29,R19
(2854) 				if (!dsc) ABORT(fp->fs, FR_INT_ERR);
    0295D 8C2A      LDD	R2,Y+26
    0295E 8C3B      LDD	R3,Y+27
    0295F 8C4C      LDD	R4,Y+28
    02960 8C5D      LDD	R5,Y+29
    02961 9488      BCLR	0
    02962 2022      TST	R2
    02963 0432      CPC	R3,R2
    02964 0442      CPC	R4,R2
    02965 0452      CPC	R5,R2
    02966 F451      BNE	0x2971
    02967 A588      LDD	R24,Y+40
    02968 A599      LDD	R25,Y+41
    02969 9604      ADIW	R24,4
    0296A 017C      MOVW	R14,R24
    0296B 01FC      MOVW	R30,R24
    0296C 8180      LD	R24,Z
    0296D 6880      ORI	R24,0x80
    0296E 8380      ST	Z,R24
    0296F E002      LDI	R16,2
    02970 C31A      RJMP	0x2C8B
(2855) 				dsc += (ofs - 1) / SS(fp->fs) & (fp->fs->csize - 1);
    02971 E041      LDI	R20,1
    02972 E050      LDI	R21,0
    02973 E060      LDI	R22,0
    02974 E070      LDI	R23,0
    02975 A50A      LDD	R16,Y+42
    02976 A51B      LDD	R17,Y+43
    02977 A52C      LDD	R18,Y+44
    02978 A53D      LDD	R19,Y+45
    02979 1B04      SUB	R16,R20
    0297A 0B15      SBC	R17,R21
    0297B 0B26      SBC	R18,R22
    0297C 0B37      SBC	R19,R23
    0297D E089      LDI	R24,0x9
    0297E E090      LDI	R25,0
    0297F 938A      ST	-Y,R24
    02980 940E 4BC1 CALL	lsr32
    02982 0118      MOVW	R2,R16
    02983 0129      MOVW	R4,R18
    02984 A5E8      LDD	R30,Y+40
    02985 A5F9      LDD	R31,Y+41
    02986 93AF      PUSH	R26
    02987 93BF      PUSH	R27
    02988 81A0      LD	R26,Z
    02989 81B1      LDD	R27,Z+1
    0298A 01FD      MOVW	R30,R26
    0298B 91BF      POP	R27
    0298C 91AF      POP	R26
    0298D 9632      ADIW	R30,2
    0298E 8180      LD	R24,Z
    0298F 2799      CLR	R25
    02990 9701      SBIW	R24,1
    02991 013C      MOVW	R6,R24
    02992 2488      CLR	R8
    02993 FC77      SBRC	R7,7
    02994 9480      COM	R8
    02995 2499      CLR	R9
    02996 FC87      SBRC	R8,7
    02997 9490      COM	R9
    02998 2026      AND	R2,R6
    02999 2037      AND	R3,R7
    0299A 2048      AND	R4,R8
    0299B 2059      AND	R5,R9
    0299C 8C6A      LDD	R6,Y+26
    0299D 8C7B      LDD	R7,Y+27
    0299E 8C8C      LDD	R8,Y+28
    0299F 8C9D      LDD	R9,Y+29
    029A0 0C62      ADD	R6,R2
    029A1 1C73      ADC	R7,R3
    029A2 1C84      ADC	R8,R4
    029A3 1C95      ADC	R9,R5
    029A4 8E6A      STD	Y+26,R6
    029A5 8E7B      STD	Y+27,R7
    029A6 8E8C      STD	Y+28,R8
    029A7 8E9D      STD	Y+29,R9
(2856) 				if (fp->fptr % SS(fp->fs) && dsc != fp->dsect) {	/* Refill sector cache if needed */
    029A8 EF4F      LDI	R20,0xFF
    029A9 E051      LDI	R21,1
    029AA E060      LDI	R22,0
    029AB E070      LDI	R23,0
    029AC A5E8      LDD	R30,Y+40
    029AD A5F9      LDD	R31,Y+41
    029AE 9636      ADIW	R30,6
    029AF 8020      LD	R2,Z
    029B0 8031      LDD	R3,Z+1
    029B1 8042      LDD	R4,Z+2
    029B2 8053      LDD	R5,Z+3
    029B3 2224      AND	R2,R20
    029B4 2235      AND	R3,R21
    029B5 2246      AND	R4,R22
    029B6 2257      AND	R5,R23
    029B7 9488      BCLR	0
    029B8 2022      TST	R2
    029B9 0432      CPC	R3,R2
    029BA 0442      CPC	R4,R2
    029BB 0452      CPC	R5,R2
    029BC F409      BNE	0x29BE
    029BD C2CC      RJMP	0x2C8A
    029BE A5E8      LDD	R30,Y+40
    029BF A5F9      LDD	R31,Y+41
    029C0 9676      ADIW	R30,0x16
    029C1 8020      LD	R2,Z
    029C2 8031      LDD	R3,Z+1
    029C3 8042      LDD	R4,Z+2
    029C4 8053      LDD	R5,Z+3
    029C5 8C6A      LDD	R6,Y+26
    029C6 8C7B      LDD	R7,Y+27
    029C7 8C8C      LDD	R8,Y+28
    029C8 8C9D      LDD	R9,Y+29
    029C9 1462      CP	R6,R2
    029CA 0473      CPC	R7,R3
    029CB 0484      CPC	R8,R4
    029CC 0495      CPC	R9,R5
    029CD F409      BNE	0x29CF
    029CE C2BB      RJMP	0x2C8A
(2857) #if !_FS_TINY
(2858) #if !_FS_READONLY
(2859) 					if (fp->flag & FA__DIRTY) {		/* Write-back dirty sector cache */
(2860) 						if (disk_write(fp->fs->drv, fp->buf, fp->dsect, 1) != RES_OK)
(2861) 							ABORT(fp->fs, FR_DISK_ERR);
(2862) 						fp->flag &= ~FA__DIRTY;
(2863) 					}
(2864) #endif
(2865) 					if (disk_read(fp->fs->drv, fp->buf, dsc, 1) != RES_OK)	/* Load current sector */
(2866) 						ABORT(fp->fs, FR_DISK_ERR);
(2867) #endif
(2868) 					fp->dsect = dsc;
    029CF 0113      MOVW	R2,R6
    029D0 0124      MOVW	R4,R8
    029D1 A5E8      LDD	R30,Y+40
    029D2 A5F9      LDD	R31,Y+41
    029D3 8A26      STD	Z+22,R2
    029D4 8A37      STD	Z+23,R3
    029D5 8E40      STD	Z+24,R4
    029D6 8E51      STD	Z+25,R5
(2869) 				}
(2870) 			}
(2871) 		}
(2872) 	} else
    029D7 C2B2      RJMP	0x2C8A
(2873) #endif
(2874) 
(2875) 	/* Normal Seek */
(2876) 	{
(2877) 		DWORD clst, bcs, nsect, ifptr;
(2878) 
(2879) 		if (ofs > fp->fsize					/* In read-only mode, clip offset with the file size */
    029D8 A5E8      LDD	R30,Y+40
    029D9 A5F9      LDD	R31,Y+41
    029DA 963A      ADIW	R30,0xA
    029DB 8020      LD	R2,Z
    029DC 8031      LDD	R3,Z+1
    029DD 8042      LDD	R4,Z+2
    029DE 8053      LDD	R5,Z+3
    029DF A46A      LDD	R6,Y+42
    029E0 A47B      LDD	R7,Y+43
    029E1 A48C      LDD	R8,Y+44
    029E2 A49D      LDD	R9,Y+45
    029E3 1426      CP	R2,R6
    029E4 0437      CPC	R3,R7
    029E5 0448      CPC	R4,R8
    029E6 0459      CPC	R5,R9
    029E7 F470      BCC	0x29F6
    029E8 A5E8      LDD	R30,Y+40
    029E9 A5F9      LDD	R31,Y+41
    029EA 8024      LDD	R2,Z+4
    029EB FC21      SBRC	R2,1
    029EC C009      RJMP	0x29F6
(2880) #if !_FS_READONLY
(2881) 			 && !(fp->flag & FA_WRITE)
(2882) #endif
(2883) 			) ofs = fp->fsize;
    029ED 963A      ADIW	R30,0xA
    029EE 8020      LD	R2,Z
    029EF 8031      LDD	R3,Z+1
    029F0 8042      LDD	R4,Z+2
    029F1 8053      LDD	R5,Z+3
    029F2 A62A      STD	Y+42,R2
    029F3 A63B      STD	Y+43,R3
    029F4 A64C      STD	Y+44,R4
    029F5 A65D      STD	Y+45,R5
(2884) 
(2885) 		ifptr = fp->fptr;
    029F6 A5E8      LDD	R30,Y+40
    029F7 A5F9      LDD	R31,Y+41
    029F8 9636      ADIW	R30,6
    029F9 8020      LD	R2,Z
    029FA 8031      LDD	R3,Z+1
    029FB 8042      LDD	R4,Z+2
    029FC 8053      LDD	R5,Z+3
    029FD 862E      STD	Y+14,R2
    029FE 863F      STD	Y+15,R3
    029FF 8A48      STD	Y+16,R4
    02A00 8A59      STD	Y+17,R5
(2886) 		fp->fptr = nsect = 0;
    02A01 E080      LDI	R24,0
    02A02 878A      STD	Y+10,R24
    02A03 878B      STD	Y+11,R24
    02A04 878C      STD	Y+12,R24
    02A05 878D      STD	Y+13,R24
    02A06 A5E8      LDD	R30,Y+40
    02A07 A5F9      LDD	R31,Y+41
    02A08 9636      ADIW	R30,6
    02A09 E080      LDI	R24,0
    02A0A 8380      ST	Z,R24
    02A0B 8381      STD	Z+1,R24
    02A0C 8382      STD	Z+2,R24
    02A0D 8383      STD	Z+3,R24
(2887) 		if (ofs) {
    02A0E A42A      LDD	R2,Y+42
    02A0F A43B      LDD	R3,Y+43
    02A10 A44C      LDD	R4,Y+44
    02A11 A45D      LDD	R5,Y+45
    02A12 9488      BCLR	0
    02A13 2022      TST	R2
    02A14 0432      CPC	R3,R2
    02A15 0442      CPC	R4,R2
    02A16 0452      CPC	R5,R2
    02A17 F409      BNE	0x2A19
    02A18 C226      RJMP	0x2C3F
(2888) 			bcs = (DWORD)fp->fs->csize * SS(fp->fs);	/* Cluster size (byte) */
    02A19 A5E8      LDD	R30,Y+40
    02A1A A5F9      LDD	R31,Y+41
    02A1B 93AF      PUSH	R26
    02A1C 93BF      PUSH	R27
    02A1D 81A0      LD	R26,Z
    02A1E 81B1      LDD	R27,Z+1
    02A1F 01FD      MOVW	R30,R26
    02A20 91BF      POP	R27
    02A21 91AF      POP	R26
    02A22 9632      ADIW	R30,2
    02A23 8020      LD	R2,Z
    02A24 2433      CLR	R3
    02A25 2444      CLR	R4
    02A26 2455      CLR	R5
    02A27 E040      LDI	R20,0
    02A28 E052      LDI	R21,2
    02A29 E060      LDI	R22,0
    02A2A E070      LDI	R23,0
    02A2B 925A      ST	-Y,R5
    02A2C 924A      ST	-Y,R4
    02A2D 923A      ST	-Y,R3
    02A2E 922A      ST	-Y,R2
    02A2F 018A      MOVW	R16,R20
    02A30 019B      MOVW	R18,R22
    02A31 940E 4AC9 CALL	empy32s|empy32u
    02A33 830E      STD	Y+6,R16
    02A34 831F      STD	Y+7,R17
    02A35 8728      STD	Y+8,R18
    02A36 8739      STD	Y+9,R19
(2889) 			if (ifptr > 0 &&
    02A37 842E      LDD	R2,Y+14
    02A38 843F      LDD	R3,Y+15
    02A39 8848      LDD	R4,Y+16
    02A3A 8859      LDD	R5,Y+17
    02A3B 9488      BCLR	0
    02A3C 2022      TST	R2
    02A3D 0432      CPC	R3,R2
    02A3E 0442      CPC	R4,R2
    02A3F 0452      CPC	R5,R2
    02A40 F409      BNE	0x2A42
    02A41 C075      RJMP	0x2AB7
    02A42 E041      LDI	R20,1
    02A43 E050      LDI	R21,0
    02A44 E060      LDI	R22,0
    02A45 E070      LDI	R23,0
    02A46 0181      MOVW	R16,R2
    02A47 0192      MOVW	R18,R4
    02A48 1B04      SUB	R16,R20
    02A49 0B15      SBC	R17,R21
    02A4A 0B26      SBC	R18,R22
    02A4B 0B37      SBC	R19,R23
    02A4C 802E      LDD	R2,Y+6
    02A4D 803F      LDD	R3,Y+7
    02A4E 8448      LDD	R4,Y+8
    02A4F 8459      LDD	R5,Y+9
    02A50 925A      ST	-Y,R5
    02A51 924A      ST	-Y,R4
    02A52 923A      ST	-Y,R3
    02A53 922A      ST	-Y,R2
    02A54 940E 4A23 CALL	div32u
    02A56 0118      MOVW	R2,R16
    02A57 0129      MOVW	R4,R18
    02A58 E041      LDI	R20,1
    02A59 E050      LDI	R21,0
    02A5A E060      LDI	R22,0
    02A5B E070      LDI	R23,0
    02A5C A50A      LDD	R16,Y+42
    02A5D A51B      LDD	R17,Y+43
    02A5E A52C      LDD	R18,Y+44
    02A5F A53D      LDD	R19,Y+45
    02A60 1B04      SUB	R16,R20
    02A61 0B15      SBC	R17,R21
    02A62 0B26      SBC	R18,R22
    02A63 0B37      SBC	R19,R23
    02A64 806E      LDD	R6,Y+6
    02A65 807F      LDD	R7,Y+7
    02A66 8488      LDD	R8,Y+8
    02A67 8499      LDD	R9,Y+9
    02A68 929A      ST	-Y,R9
    02A69 928A      ST	-Y,R8
    02A6A 927A      ST	-Y,R7
    02A6B 926A      ST	-Y,R6
    02A6C 940E 4A23 CALL	div32u
    02A6E 1502      CP	R16,R2
    02A6F 0513      CPC	R17,R3
    02A70 0524      CPC	R18,R4
    02A71 0535      CPC	R19,R5
    02A72 F408      BCC	0x2A74
    02A73 C043      RJMP	0x2AB7
(2890) 				(ofs - 1) / bcs >= (ifptr - 1) / bcs) {	/* When seek to same or following cluster, */
(2891) 				fp->fptr = (ifptr - 1) & ~(bcs - 1);	/* start from the current cluster */
    02A74 E041      LDI	R20,1
    02A75 E050      LDI	R21,0
    02A76 E060      LDI	R22,0
    02A77 E070      LDI	R23,0
    02A78 802E      LDD	R2,Y+6
    02A79 803F      LDD	R3,Y+7
    02A7A 8448      LDD	R4,Y+8
    02A7B 8459      LDD	R5,Y+9
    02A7C 1A24      SUB	R2,R20
    02A7D 0A35      SBC	R3,R21
    02A7E 0A46      SBC	R4,R22
    02A7F 0A57      SBC	R5,R23
    02A80 9420      COM	R2
    02A81 9430      COM	R3
    02A82 9440      COM	R4
    02A83 9450      COM	R5
    02A84 E041      LDI	R20,1
    02A85 E050      LDI	R21,0
    02A86 E060      LDI	R22,0
    02A87 E070      LDI	R23,0
    02A88 846E      LDD	R6,Y+14
    02A89 847F      LDD	R7,Y+15
    02A8A 8888      LDD	R8,Y+16
    02A8B 8899      LDD	R9,Y+17
    02A8C 1A64      SUB	R6,R20
    02A8D 0A75      SBC	R7,R21
    02A8E 0A86      SBC	R8,R22
    02A8F 0A97      SBC	R9,R23
    02A90 2062      AND	R6,R2
    02A91 2073      AND	R7,R3
    02A92 2084      AND	R8,R4
    02A93 2095      AND	R9,R5
    02A94 A5E8      LDD	R30,Y+40
    02A95 A5F9      LDD	R31,Y+41
    02A96 8266      STD	Z+6,R6
    02A97 8277      STD	Z+7,R7
    02A98 8680      STD	Z+8,R8
    02A99 8691      STD	Z+9,R9
(2892) 				ofs -= fp->fptr;
    02A9A 9636      ADIW	R30,6
    02A9B 8020      LD	R2,Z
    02A9C 8031      LDD	R3,Z+1
    02A9D 8042      LDD	R4,Z+2
    02A9E 8053      LDD	R5,Z+3
    02A9F A46A      LDD	R6,Y+42
    02AA0 A47B      LDD	R7,Y+43
    02AA1 A48C      LDD	R8,Y+44
    02AA2 A49D      LDD	R9,Y+45
    02AA3 1862      SUB	R6,R2
    02AA4 0873      SBC	R7,R3
    02AA5 0884      SBC	R8,R4
    02AA6 0895      SBC	R9,R5
    02AA7 A66A      STD	Y+42,R6
    02AA8 A67B      STD	Y+43,R7
    02AA9 A68C      STD	Y+44,R8
    02AAA A69D      STD	Y+45,R9
(2893) 				clst = fp->clust;
    02AAB A5E8      LDD	R30,Y+40
    02AAC A5F9      LDD	R31,Y+41
    02AAD 9672      ADIW	R30,0x12
    02AAE 8020      LD	R2,Z
    02AAF 8031      LDD	R3,Z+1
    02AB0 8042      LDD	R4,Z+2
    02AB1 8053      LDD	R5,Z+3
    02AB2 822A      STD	Y+2,R2
    02AB3 823B      STD	Y+3,R3
    02AB4 824C      STD	Y+4,R4
    02AB5 825D      STD	Y+5,R5
(2894) 			} else {									/* When seek to back cluster, */
    02AB6 C069      RJMP	0x2B20
(2895) 				clst = fp->sclust;						/* start from the first cluster */
    02AB7 A5E8      LDD	R30,Y+40
    02AB8 A5F9      LDD	R31,Y+41
    02AB9 963E      ADIW	R30,0xE
    02ABA 8020      LD	R2,Z
    02ABB 8031      LDD	R3,Z+1
    02ABC 8042      LDD	R4,Z+2
    02ABD 8053      LDD	R5,Z+3
    02ABE 822A      STD	Y+2,R2
    02ABF 823B      STD	Y+3,R3
    02AC0 824C      STD	Y+4,R4
    02AC1 825D      STD	Y+5,R5
(2896) #if !_FS_READONLY
(2897) 				if (clst == 0) {						/* If no cluster chain, create a new chain */
    02AC2 802A      LDD	R2,Y+2
    02AC3 803B      LDD	R3,Y+3
    02AC4 804C      LDD	R4,Y+4
    02AC5 805D      LDD	R5,Y+5
    02AC6 9488      BCLR	0
    02AC7 2022      TST	R2
    02AC8 0432      CPC	R3,R2
    02AC9 0442      CPC	R4,R2
    02ACA 0452      CPC	R5,R2
    02ACB F009      BEQ	0x2ACD
    02ACC C049      RJMP	0x2B16
(2898) 					clst = create_chain(fp->fs, 0);
    02ACD E040      LDI	R20,0
    02ACE E050      LDI	R21,0
    02ACF E060      LDI	R22,0
    02AD0 E070      LDI	R23,0
    02AD1 8368      ST	Y,R22
    02AD2 8379      STD	Y+1,R23
    02AD3 019A      MOVW	R18,R20
    02AD4 A5E8      LDD	R30,Y+40
    02AD5 A5F9      LDD	R31,Y+41
    02AD6 8100      LD	R16,Z
    02AD7 8111      LDD	R17,Z+1
    02AD8 940E 121D CALL	ff.c:create_chain
    02ADA 830A      STD	Y+2,R16
    02ADB 831B      STD	Y+3,R17
    02ADC 832C      STD	Y+4,R18
    02ADD 833D      STD	Y+5,R19
(2899) 					if (clst == 1) ABORT(fp->fs, FR_INT_ERR);
    02ADE E041      LDI	R20,1
    02ADF E050      LDI	R21,0
    02AE0 E060      LDI	R22,0
    02AE1 E070      LDI	R23,0
    02AE2 802A      LDD	R2,Y+2
    02AE3 803B      LDD	R3,Y+3
    02AE4 804C      LDD	R4,Y+4
    02AE5 805D      LDD	R5,Y+5
    02AE6 1624      CP	R2,R20
    02AE7 0635      CPC	R3,R21
    02AE8 0646      CPC	R4,R22
    02AE9 0657      CPC	R5,R23
    02AEA F451      BNE	0x2AF5
    02AEB A588      LDD	R24,Y+40
    02AEC A599      LDD	R25,Y+41
    02AED 9604      ADIW	R24,4
    02AEE 017C      MOVW	R14,R24
    02AEF 01FC      MOVW	R30,R24
    02AF0 8180      LD	R24,Z
    02AF1 6880      ORI	R24,0x80
    02AF2 8380      ST	Z,R24
    02AF3 E002      LDI	R16,2
    02AF4 C196      RJMP	0x2C8B
(2900) 					if (clst == 0xFFFFFFFF) ABORT(fp->fs, FR_DISK_ERR);
    02AF5 EF4F      LDI	R20,0xFF
    02AF6 EF5F      LDI	R21,0xFF
    02AF7 EF6F      LDI	R22,0xFF
    02AF8 EF7F      LDI	R23,0xFF
    02AF9 802A      LDD	R2,Y+2
    02AFA 803B      LDD	R3,Y+3
    02AFB 804C      LDD	R4,Y+4
    02AFC 805D      LDD	R5,Y+5
    02AFD 1624      CP	R2,R20
    02AFE 0635      CPC	R3,R21
    02AFF 0646      CPC	R4,R22
    02B00 0657      CPC	R5,R23
    02B01 F451      BNE	0x2B0C
    02B02 A588      LDD	R24,Y+40
    02B03 A599      LDD	R25,Y+41
    02B04 9604      ADIW	R24,4
    02B05 017C      MOVW	R14,R24
    02B06 01FC      MOVW	R30,R24
    02B07 8180      LD	R24,Z
    02B08 6880      ORI	R24,0x80
    02B09 8380      ST	Z,R24
    02B0A E001      LDI	R16,1
    02B0B C17F      RJMP	0x2C8B
(2901) 					fp->sclust = clst;
    02B0C 802A      LDD	R2,Y+2
    02B0D 803B      LDD	R3,Y+3
    02B0E 804C      LDD	R4,Y+4
    02B0F 805D      LDD	R5,Y+5
    02B10 A5E8      LDD	R30,Y+40
    02B11 A5F9      LDD	R31,Y+41
    02B12 8626      STD	Z+14,R2
    02B13 8637      STD	Z+15,R3
    02B14 8A40      STD	Z+16,R4
    02B15 8A51      STD	Z+17,R5
(2902) 				}
(2903) #endif
(2904) 				fp->clust = clst;
    02B16 802A      LDD	R2,Y+2
    02B17 803B      LDD	R3,Y+3
    02B18 804C      LDD	R4,Y+4
    02B19 805D      LDD	R5,Y+5
    02B1A A5E8      LDD	R30,Y+40
    02B1B A5F9      LDD	R31,Y+41
    02B1C 8A22      STD	Z+18,R2
    02B1D 8A33      STD	Z+19,R3
    02B1E 8A44      STD	Z+20,R4
    02B1F 8A55      STD	Z+21,R5
(2905) 			}
(2906) 			if (clst != 0) {
    02B20 802A      LDD	R2,Y+2
    02B21 803B      LDD	R3,Y+3
    02B22 804C      LDD	R4,Y+4
    02B23 805D      LDD	R5,Y+5
    02B24 9488      BCLR	0
    02B25 2022      TST	R2
    02B26 0432      CPC	R3,R2
    02B27 0442      CPC	R4,R2
    02B28 0452      CPC	R5,R2
    02B29 F409      BNE	0x2B2B
    02B2A C114      RJMP	0x2C3F
    02B2B C0A7      RJMP	0x2BD3
(2907) 				while (ofs > bcs) {						/* Cluster following loop */
(2908) #if !_FS_READONLY
(2909) 					if (fp->flag & FA_WRITE) {			/* Check if in write mode or not */
    02B2C A5E8      LDD	R30,Y+40
    02B2D A5F9      LDD	R31,Y+41
    02B2E 9634      ADIW	R30,4
    02B2F 8020      LD	R2,Z
    02B30 FE21      SBRS	R2,1
    02B31 C024      RJMP	0x2B56
(2910) 						clst = create_chain(fp->fs, clst);	/* Force stretch if in write mode */
    02B32 802A      LDD	R2,Y+2
    02B33 803B      LDD	R3,Y+3
    02B34 804C      LDD	R4,Y+4
    02B35 805D      LDD	R5,Y+5
    02B36 8248      ST	Y,R4
    02B37 8259      STD	Y+1,R5
    02B38 0191      MOVW	R18,R2
    02B39 A5E8      LDD	R30,Y+40
    02B3A A5F9      LDD	R31,Y+41
    02B3B 8100      LD	R16,Z
    02B3C 8111      LDD	R17,Z+1
    02B3D 940E 121D CALL	ff.c:create_chain
    02B3F 830A      STD	Y+2,R16
    02B40 831B      STD	Y+3,R17
    02B41 832C      STD	Y+4,R18
    02B42 833D      STD	Y+5,R19
(2911) 						if (clst == 0) {				/* When disk gets full, clip file size */
    02B43 802A      LDD	R2,Y+2
    02B44 803B      LDD	R3,Y+3
    02B45 804C      LDD	R4,Y+4
    02B46 805D      LDD	R5,Y+5
    02B47 9488      BCLR	0
    02B48 2022      TST	R2
    02B49 0432      CPC	R3,R2
    02B4A 0442      CPC	R4,R2
    02B4B 0452      CPC	R5,R2
    02B4C F4D1      BNE	0x2B67
(2912) 							ofs = bcs; break;
    02B4D 802E      LDD	R2,Y+6
    02B4E 803F      LDD	R3,Y+7
    02B4F 8448      LDD	R4,Y+8
    02B50 8459      LDD	R5,Y+9
    02B51 A62A      STD	Y+42,R2
    02B52 A63B      STD	Y+43,R3
    02B53 A64C      STD	Y+44,R4
    02B54 A65D      STD	Y+45,R5
    02B55 C08B      RJMP	0x2BE1
(2913) 						}
(2914) 					} else
(2915) #endif
(2916) 						clst = get_fat(fp->fs, clst);	/* Follow cluster chain if not in write mode */
    02B56 802A      LDD	R2,Y+2
    02B57 803B      LDD	R3,Y+3
    02B58 804C      LDD	R4,Y+4
    02B59 805D      LDD	R5,Y+5
    02B5A 8248      ST	Y,R4
    02B5B 8259      STD	Y+1,R5
    02B5C 0191      MOVW	R18,R2
    02B5D A5E8      LDD	R30,Y+40
    02B5E A5F9      LDD	R31,Y+41
    02B5F 8100      LD	R16,Z
    02B60 8111      LDD	R17,Z+1
    02B61 940E 0E5B CALL	_get_fat
    02B63 830A      STD	Y+2,R16
    02B64 831B      STD	Y+3,R17
    02B65 832C      STD	Y+4,R18
    02B66 833D      STD	Y+5,R19
(2917) 					if (clst == 0xFFFFFFFF) ABORT(fp->fs, FR_DISK_ERR);
    02B67 EF4F      LDI	R20,0xFF
    02B68 EF5F      LDI	R21,0xFF
    02B69 EF6F      LDI	R22,0xFF
    02B6A EF7F      LDI	R23,0xFF
    02B6B 802A      LDD	R2,Y+2
    02B6C 803B      LDD	R3,Y+3
    02B6D 804C      LDD	R4,Y+4
    02B6E 805D      LDD	R5,Y+5
    02B6F 1624      CP	R2,R20
    02B70 0635      CPC	R3,R21
    02B71 0646      CPC	R4,R22
    02B72 0657      CPC	R5,R23
    02B73 F451      BNE	0x2B7E
    02B74 A588      LDD	R24,Y+40
    02B75 A599      LDD	R25,Y+41
    02B76 9604      ADIW	R24,4
    02B77 017C      MOVW	R14,R24
    02B78 01FC      MOVW	R30,R24
    02B79 8180      LD	R24,Z
    02B7A 6880      ORI	R24,0x80
    02B7B 8380      ST	Z,R24
    02B7C E001      LDI	R16,1
    02B7D C10D      RJMP	0x2C8B
(2918) 					if (clst <= 1 || clst >= fp->fs->n_fatent) ABORT(fp->fs, FR_INT_ERR);
    02B7E E041      LDI	R20,1
    02B7F E050      LDI	R21,0
    02B80 E060      LDI	R22,0
    02B81 E070      LDI	R23,0
    02B82 802A      LDD	R2,Y+2
    02B83 803B      LDD	R3,Y+3
    02B84 804C      LDD	R4,Y+4
    02B85 805D      LDD	R5,Y+5
    02B86 1542      CP	R20,R2
    02B87 0553      CPC	R21,R3
    02B88 0564      CPC	R22,R4
    02B89 0575      CPC	R23,R5
    02B8A F490      BCC	0x2B9D
    02B8B A5E8      LDD	R30,Y+40
    02B8C A5F9      LDD	R31,Y+41
    02B8D 81A0      LD	R26,Z
    02B8E 81B1      LDD	R27,Z+1
    02B8F 9656      ADIW	R26,0x16
    02B90 902D      LD	R2,X+
    02B91 903D      LD	R3,X+
    02B92 904D      LD	R4,X+
    02B93 905C      LD	R5,X
    02B94 806A      LDD	R6,Y+2
    02B95 807B      LDD	R7,Y+3
    02B96 808C      LDD	R8,Y+4
    02B97 809D      LDD	R9,Y+5
    02B98 1462      CP	R6,R2
    02B99 0473      CPC	R7,R3
    02B9A 0484      CPC	R8,R4
    02B9B 0495      CPC	R9,R5
    02B9C F050      BCS	0x2BA7
    02B9D A588      LDD	R24,Y+40
    02B9E A599      LDD	R25,Y+41
    02B9F 9604      ADIW	R24,4
    02BA0 017C      MOVW	R14,R24
    02BA1 01FC      MOVW	R30,R24
    02BA2 8180      LD	R24,Z
    02BA3 6880      ORI	R24,0x80
    02BA4 8380      ST	Z,R24
    02BA5 E002      LDI	R16,2
    02BA6 C0E4      RJMP	0x2C8B
(2919) 					fp->clust = clst;
    02BA7 802A      LDD	R2,Y+2
    02BA8 803B      LDD	R3,Y+3
    02BA9 804C      LDD	R4,Y+4
    02BAA 805D      LDD	R5,Y+5
    02BAB A5E8      LDD	R30,Y+40
    02BAC A5F9      LDD	R31,Y+41
    02BAD 9672      ADIW	R30,0x12
    02BAE 8220      ST	Z,R2
    02BAF 8231      STD	Z+1,R3
    02BB0 8242      STD	Z+2,R4
    02BB1 8253      STD	Z+3,R5
(2920) 					fp->fptr += bcs;
    02BB2 A588      LDD	R24,Y+40
    02BB3 A599      LDD	R25,Y+41
    02BB4 9606      ADIW	R24,6
    02BB5 017C      MOVW	R14,R24
    02BB6 802E      LDD	R2,Y+6
    02BB7 803F      LDD	R3,Y+7
    02BB8 8448      LDD	R4,Y+8
    02BB9 8459      LDD	R5,Y+9
    02BBA 01FC      MOVW	R30,R24
    02BBB 8060      LD	R6,Z
    02BBC 8071      LDD	R7,Z+1
    02BBD 8082      LDD	R8,Z+2
    02BBE 8093      LDD	R9,Z+3
    02BBF 0C62      ADD	R6,R2
    02BC0 1C73      ADC	R7,R3
    02BC1 1C84      ADC	R8,R4
    02BC2 1C95      ADC	R9,R5
    02BC3 8260      ST	Z,R6
    02BC4 8271      STD	Z+1,R7
    02BC5 8282      STD	Z+2,R8
    02BC6 8293      STD	Z+3,R9
(2921) 					ofs -= bcs;
    02BC7 A46A      LDD	R6,Y+42
    02BC8 A47B      LDD	R7,Y+43
    02BC9 A48C      LDD	R8,Y+44
    02BCA A49D      LDD	R9,Y+45
    02BCB 1862      SUB	R6,R2
    02BCC 0873      SBC	R7,R3
    02BCD 0884      SBC	R8,R4
    02BCE 0895      SBC	R9,R5
    02BCF A66A      STD	Y+42,R6
    02BD0 A67B      STD	Y+43,R7
    02BD1 A68C      STD	Y+44,R8
    02BD2 A69D      STD	Y+45,R9
    02BD3 802E      LDD	R2,Y+6
    02BD4 803F      LDD	R3,Y+7
    02BD5 8448      LDD	R4,Y+8
    02BD6 8459      LDD	R5,Y+9
    02BD7 A46A      LDD	R6,Y+42
    02BD8 A47B      LDD	R7,Y+43
    02BD9 A48C      LDD	R8,Y+44
    02BDA A49D      LDD	R9,Y+45
    02BDB 1426      CP	R2,R6
    02BDC 0437      CPC	R3,R7
    02BDD 0448      CPC	R4,R8
    02BDE 0459      CPC	R5,R9
    02BDF F408      BCC	0x2BE1
    02BE0 CF4B      RJMP	0x2B2C
(2922) 				}
(2923) 				fp->fptr += ofs;
    02BE1 A588      LDD	R24,Y+40
    02BE2 A599      LDD	R25,Y+41
    02BE3 9606      ADIW	R24,6
    02BE4 017C      MOVW	R14,R24
    02BE5 A42A      LDD	R2,Y+42
    02BE6 A43B      LDD	R3,Y+43
    02BE7 A44C      LDD	R4,Y+44
    02BE8 A45D      LDD	R5,Y+45
    02BE9 01FC      MOVW	R30,R24
    02BEA 8060      LD	R6,Z
    02BEB 8071      LDD	R7,Z+1
    02BEC 8082      LDD	R8,Z+2
    02BED 8093      LDD	R9,Z+3
    02BEE 0C62      ADD	R6,R2
    02BEF 1C73      ADC	R7,R3
    02BF0 1C84      ADC	R8,R4
    02BF1 1C95      ADC	R9,R5
    02BF2 8260      ST	Z,R6
    02BF3 8271      STD	Z+1,R7
    02BF4 8282      STD	Z+2,R8
    02BF5 8293      STD	Z+3,R9
(2924) 				if (ofs % SS(fp->fs)) {
    02BF6 EF4F      LDI	R20,0xFF
    02BF7 E051      LDI	R21,1
    02BF8 E060      LDI	R22,0
    02BF9 E070      LDI	R23,0
    02BFA 2224      AND	R2,R20
    02BFB 2235      AND	R3,R21
    02BFC 2246      AND	R4,R22
    02BFD 2257      AND	R5,R23
    02BFE 9488      BCLR	0
    02BFF 2022      TST	R2
    02C00 0432      CPC	R3,R2
    02C01 0442      CPC	R4,R2
    02C02 0452      CPC	R5,R2
    02C03 F409      BNE	0x2C05
    02C04 C03A      RJMP	0x2C3F
(2925) 					nsect = clust2sect(fp->fs, clst);	/* Current sector */
    02C05 802A      LDD	R2,Y+2
    02C06 803B      LDD	R3,Y+3
    02C07 804C      LDD	R4,Y+4
    02C08 805D      LDD	R5,Y+5
    02C09 8248      ST	Y,R4
    02C0A 8259      STD	Y+1,R5
    02C0B 0191      MOVW	R18,R2
    02C0C A5E8      LDD	R30,Y+40
    02C0D A5F9      LDD	R31,Y+41
    02C0E 8100      LD	R16,Z
    02C0F 8111      LDD	R17,Z+1
    02C10 940E 0E09 CALL	_clust2sect
    02C12 870A      STD	Y+10,R16
    02C13 871B      STD	Y+11,R17
    02C14 872C      STD	Y+12,R18
    02C15 873D      STD	Y+13,R19
(2926) 					if (!nsect) ABORT(fp->fs, FR_INT_ERR);
    02C16 842A      LDD	R2,Y+10
    02C17 843B      LDD	R3,Y+11
    02C18 844C      LDD	R4,Y+12
    02C19 845D      LDD	R5,Y+13
    02C1A 9488      BCLR	0
    02C1B 2022      TST	R2
    02C1C 0432      CPC	R3,R2
    02C1D 0442      CPC	R4,R2
    02C1E 0452      CPC	R5,R2
    02C1F F451      BNE	0x2C2A
    02C20 A588      LDD	R24,Y+40
    02C21 A599      LDD	R25,Y+41
    02C22 9604      ADIW	R24,4
    02C23 017C      MOVW	R14,R24
    02C24 01FC      MOVW	R30,R24
    02C25 8180      LD	R24,Z
    02C26 6880      ORI	R24,0x80
    02C27 8380      ST	Z,R24
    02C28 E002      LDI	R16,2
    02C29 C061      RJMP	0x2C8B
(2927) 					nsect += ofs / SS(fp->fs);
    02C2A E089      LDI	R24,0x9
    02C2B E090      LDI	R25,0
    02C2C A50A      LDD	R16,Y+42
    02C2D A51B      LDD	R17,Y+43
    02C2E A52C      LDD	R18,Y+44
    02C2F A53D      LDD	R19,Y+45
    02C30 938A      ST	-Y,R24
    02C31 940E 4BC1 CALL	lsr32
    02C33 842A      LDD	R2,Y+10
    02C34 843B      LDD	R3,Y+11
    02C35 844C      LDD	R4,Y+12
    02C36 845D      LDD	R5,Y+13
    02C37 0E20      ADD	R2,R16
    02C38 1E31      ADC	R3,R17
    02C39 1E42      ADC	R4,R18
    02C3A 1E53      ADC	R5,R19
    02C3B 862A      STD	Y+10,R2
    02C3C 863B      STD	Y+11,R3
    02C3D 864C      STD	Y+12,R4
    02C3E 865D      STD	Y+13,R5
(2928) 				}
(2929) 			}
(2930) 		}
(2931) 		if (fp->fptr % SS(fp->fs) && nsect != fp->dsect) {	/* Fill sector cache if needed */
    02C3F EF4F      LDI	R20,0xFF
    02C40 E051      LDI	R21,1
    02C41 E060      LDI	R22,0
    02C42 E070      LDI	R23,0
    02C43 A5E8      LDD	R30,Y+40
    02C44 A5F9      LDD	R31,Y+41
    02C45 9636      ADIW	R30,6
    02C46 8020      LD	R2,Z
    02C47 8031      LDD	R3,Z+1
    02C48 8042      LDD	R4,Z+2
    02C49 8053      LDD	R5,Z+3
    02C4A 2224      AND	R2,R20
    02C4B 2235      AND	R3,R21
    02C4C 2246      AND	R4,R22
    02C4D 2257      AND	R5,R23
    02C4E 9488      BCLR	0
    02C4F 2022      TST	R2
    02C50 0432      CPC	R3,R2
    02C51 0442      CPC	R4,R2
    02C52 0452      CPC	R5,R2
    02C53 F0C1      BEQ	0x2C6C
    02C54 A5E8      LDD	R30,Y+40
    02C55 A5F9      LDD	R31,Y+41
    02C56 9676      ADIW	R30,0x16
    02C57 8020      LD	R2,Z
    02C58 8031      LDD	R3,Z+1
    02C59 8042      LDD	R4,Z+2
    02C5A 8053      LDD	R5,Z+3
    02C5B 846A      LDD	R6,Y+10
    02C5C 847B      LDD	R7,Y+11
    02C5D 848C      LDD	R8,Y+12
    02C5E 849D      LDD	R9,Y+13
    02C5F 1462      CP	R6,R2
    02C60 0473      CPC	R7,R3
    02C61 0484      CPC	R8,R4
    02C62 0495      CPC	R9,R5
    02C63 F041      BEQ	0x2C6C
(2932) #if !_FS_TINY
(2933) #if !_FS_READONLY
(2934) 			if (fp->flag & FA__DIRTY) {			/* Write-back dirty sector cache */
(2935) 				if (disk_write(fp->fs->drv, fp->buf, fp->dsect, 1) != RES_OK)
(2936) 					ABORT(fp->fs, FR_DISK_ERR);
(2937) 				fp->flag &= ~FA__DIRTY;
(2938) 			}
(2939) #endif
(2940) 			if (disk_read(fp->fs->drv, fp->buf, nsect, 1) != RES_OK)	/* Fill sector cache */
(2941) 				ABORT(fp->fs, FR_DISK_ERR);
(2942) #endif
(2943) 			fp->dsect = nsect;
    02C64 0113      MOVW	R2,R6
    02C65 0124      MOVW	R4,R8
    02C66 A5E8      LDD	R30,Y+40
    02C67 A5F9      LDD	R31,Y+41
    02C68 8A26      STD	Z+22,R2
    02C69 8A37      STD	Z+23,R3
    02C6A 8E40      STD	Z+24,R4
    02C6B 8E51      STD	Z+25,R5
(2944) 		}
(2945) #if !_FS_READONLY
(2946) 		if (fp->fptr > fp->fsize) {			/* Set file change flag if the file size is extended */
    02C6C A5E8      LDD	R30,Y+40
    02C6D A5F9      LDD	R31,Y+41
    02C6E 8422      LDD	R2,Z+10
    02C6F 8433      LDD	R3,Z+11
    02C70 8444      LDD	R4,Z+12
    02C71 8455      LDD	R5,Z+13
    02C72 8066      LDD	R6,Z+6
    02C73 8077      LDD	R7,Z+7
    02C74 8480      LDD	R8,Z+8
    02C75 8491      LDD	R9,Z+9
    02C76 1426      CP	R2,R6
    02C77 0437      CPC	R3,R7
    02C78 0448      CPC	R4,R8
    02C79 0459      CPC	R5,R9
    02C7A F478      BCC	0x2C8A
(2947) 			fp->fsize = fp->fptr;
    02C7B 8026      LDD	R2,Z+6
    02C7C 8037      LDD	R3,Z+7
    02C7D 8440      LDD	R4,Z+8
    02C7E 8451      LDD	R5,Z+9
    02C7F 8622      STD	Z+10,R2
    02C80 8633      STD	Z+11,R3
    02C81 8644      STD	Z+12,R4
    02C82 8655      STD	Z+13,R5
(2948) 			fp->flag |= FA__WRITTEN;
    02C83 01CF      MOVW	R24,R30
    02C84 9604      ADIW	R24,4
    02C85 016C      MOVW	R12,R24
    02C86 01FC      MOVW	R30,R24
    02C87 8180      LD	R24,Z
    02C88 6280      ORI	R24,0x20
    02C89 8380      ST	Z,R24
(2949) 		}
(2950) #endif
(2951) 	}
(2952) 
(2953) 	LEAVE_FF(fp->fs, res);
    02C8A 2D0A      MOV	R16,R10
    02C8B 966E      ADIW	R28,0x1E
    02C8C 940E 4B12 CALL	pop_xgsetF0FC
    02C8E 9624      ADIW	R28,4
    02C8F 9508      RET
_f_opendir:
  sfn                  --> Y,+1
  res                  --> R20
  path                 --> Y,+19
  dj                   --> R22
    02C90 933A      ST	-Y,R19
    02C91 932A      ST	-Y,R18
    02C92 940E 4B3C CALL	push_xgsetF00C
    02C94 01B8      MOVW	R22,R16
    02C95 972D      SBIW	R28,0xD
(2954) }
(2955) 
(2956) 
(2957) 
(2958) #if _FS_MINIMIZE <= 1
(2959) /*-----------------------------------------------------------------------*/
(2960) /* Create a Directroy Object                                             */
(2961) /*-----------------------------------------------------------------------*/
(2962) 
(2963) FRESULT f_opendir (
(2964) 	DIR *dj,			/* Pointer to directory object to create */
(2965) 	const TCHAR *path	/* Pointer to the directory path */
(2966) )
(2967) {
(2968) 	FRESULT res;
(2969) 	DEF_NAMEBUF;
(2970) 
(2971) 
(2972) 	res = chk_mounted(&path, &dj->fs, 0);
    02C96 2422      CLR	R2
    02C97 8228      ST	Y,R2
    02C98 019B      MOVW	R18,R22
    02C99 018E      MOVW	R16,R28
    02C9A 5E0D      SUBI	R16,0xED
    02C9B 4F1F      SBCI	R17,0xFF
    02C9C 940E 1AB0 CALL	ff.c:chk_mounted
    02C9E 2F40      MOV	R20,R16
(2973) 	if (res == FR_OK) {
    02C9F 2300      TST	R16
    02CA0 F009      BEQ	0x2CA2
    02CA1 C05C      RJMP	0x2CFE
(2974) 		INIT_BUF(*dj);
    02CA2 01CE      MOVW	R24,R28
    02CA3 9601      ADIW	R24,1
    02CA4 01FB      MOVW	R30,R22
    02CA5 8B95      STD	Z+21,R25
    02CA6 8B84      STD	Z+20,R24
(2975) 		res = follow_path(dj, path);			/* Follow the path to the directory */
    02CA7 892B      LDD	R18,Y+19
    02CA8 893C      LDD	R19,Y+20
    02CA9 018F      MOVW	R16,R30
    02CAA 940E 1964 CALL	ff.c:follow_path
    02CAC 2F40      MOV	R20,R16
(2976) 		FREE_BUF();
(2977) 		if (res == FR_OK) {						/* Follow completed */
    02CAD 2300      TST	R16
    02CAE F009      BEQ	0x2CB0
    02CAF C04B      RJMP	0x2CFB
(2978) 			if (dj->dir) {						/* It is not the root dir */
    02CB0 01FB      MOVW	R30,R22
    02CB1 8822      LDD	R2,Z+18
    02CB2 8833      LDD	R3,Z+19
    02CB3 2022      TST	R2
    02CB4 F419      BNE	0x2CB8
    02CB5 2033      TST	R3
    02CB6 F409      BNE	0x2CB8
    02CB7 C032      RJMP	0x2CEA
(2979) 				if (dj->dir[DIR_Attr] & AM_DIR) {	/* The object is a directory */
    02CB8 93AF      PUSH	R26
    02CB9 93BF      PUSH	R27
    02CBA 89A2      LDD	R26,Z+18
    02CBB 89B3      LDD	R27,Z+19
    02CBC 01FD      MOVW	R30,R26
    02CBD 91BF      POP	R27
    02CBE 91AF      POP	R26
    02CBF 8423      LDD	R2,Z+11
    02CC0 FE24      SBRS	R2,4
    02CC1 C027      RJMP	0x2CE9
(2980) 					dj->sclust = LD_CLUST(dj->dir);
    02CC2 01FB      MOVW	R30,R22
    02CC3 88A2      LDD	R10,Z+18
    02CC4 88B3      LDD	R11,Z+19
    02CC5 01F5      MOVW	R30,R10
    02CC6 8C22      LDD	R2,Z+26
    02CC7 2433      CLR	R3
    02CC8 8C43      LDD	R4,Z+27
    02CC9 2455      CLR	R5
    02CCA 2C54      MOV	R5,R4
    02CCB 2444      CLR	R4
    02CCC 2842      OR	R4,R2
    02CCD 2853      OR	R5,R3
    02CCE 0112      MOVW	R2,R4
    02CCF 2444      CLR	R4
    02CD0 2455      CLR	R5
    02CD1 8864      LDD	R6,Z+20
    02CD2 2477      CLR	R7
    02CD3 8885      LDD	R8,Z+21
    02CD4 2499      CLR	R9
    02CD5 2C98      MOV	R9,R8
    02CD6 2488      CLR	R8
    02CD7 2886      OR	R8,R6
    02CD8 2897      OR	R9,R7
    02CD9 0134      MOVW	R6,R8
    02CDA 2488      CLR	R8
    02CDB 2499      CLR	R9
    02CDC 0143      MOVW	R8,R6
    02CDD 2466      CLR	R6
    02CDE 2477      CLR	R7
    02CDF 2862      OR	R6,R2
    02CE0 2873      OR	R7,R3
    02CE1 2884      OR	R8,R4
    02CE2 2895      OR	R9,R5
    02CE3 01FB      MOVW	R30,R22
    02CE4 8266      STD	Z+6,R6
    02CE5 8277      STD	Z+7,R7
    02CE6 8680      STD	Z+8,R8
    02CE7 8691      STD	Z+9,R9
(2981) 				} else {						/* The object is not a directory */
    02CE8 C001      RJMP	0x2CEA
(2982) 					res = FR_NO_PATH;
    02CE9 E045      LDI	R20,5
(2983) 				}
(2984) 			}
(2985) 			if (res == FR_OK) {
    02CEA 2344      TST	R20
    02CEB F479      BNE	0x2CFB
(2986) 				dj->id = dj->fs->id;
    02CEC 01FB      MOVW	R30,R22
    02CED 81A0      LD	R26,Z
    02CEE 81B1      LDD	R27,Z+1
    02CEF 9616      ADIW	R26,6
    02CF0 902D      LD	R2,X+
    02CF1 903C      LD	R3,X
    02CF2 8233      STD	Z+3,R3
    02CF3 8222      STD	Z+2,R2
(2987) 				res = dir_sdi(dj, 0);			/* Rewind dir */
    02CF4 2722      CLR	R18
    02CF5 2733      CLR	R19
    02CF6 018F      MOVW	R16,R30
    02CF7 940E 140E CALL	ff.c:dir_sdi
    02CF9 2EA0      MOV	R10,R16
    02CFA 2D4A      MOV	R20,R10
(2988) 			}
(2989) 		}
(2990) 		if (res == FR_NO_FILE) res = FR_NO_PATH;
    02CFB 3044      CPI	R20,4
    02CFC F409      BNE	0x2CFE
    02CFD E045      LDI	R20,5
(2991) 	}
(2992) 
(2993) 	LEAVE_FF(dj->fs, res);
    02CFE 2F04      MOV	R16,R20
    02CFF 962D      ADIW	R28,0xD
    02D00 940E 4B43 CALL	pop_xgsetF00C
    02D02 9622      ADIW	R28,2
    02D03 9508      RET
_f_readdir:
  sfn                  --> Y,+0
  res                  --> R20
  fno                  --> R10
  dj                   --> R22
    02D04 940E 4B58 CALL	push_xgsetF03C
    02D06 0159      MOVW	R10,R18
    02D07 01B8      MOVW	R22,R16
    02D08 972C      SBIW	R28,0xC
(2994) }
(2995) 
(2996) 
(2997) 
(2998) 
(2999) /*-----------------------------------------------------------------------*/
(3000) /* Read Directory Entry in Sequense                                      */
(3001) /*-----------------------------------------------------------------------*/
(3002) 
(3003) FRESULT f_readdir (
(3004) 	DIR *dj,			/* Pointer to the open directory object */
(3005) 	FILINFO *fno		/* Pointer to file information to return */
(3006) )
(3007) {
(3008) 	FRESULT res;
(3009) 	DEF_NAMEBUF;
(3010) 
(3011) 
(3012) 	res = validate(dj->fs, dj->id);			/* Check validity of the object */
    02D09 01FB      MOVW	R30,R22
    02D0A 8122      LDD	R18,Z+2
    02D0B 8133      LDD	R19,Z+3
    02D0C 8100      LD	R16,Z
    02D0D 8111      LDD	R17,Z+1
    02D0E 940E 1FAA CALL	ff.c:validate
    02D10 2F40      MOV	R20,R16
(3013) 	if (res == FR_OK) {
    02D11 2300      TST	R16
    02D12 F009      BEQ	0x2D14
    02D13 C035      RJMP	0x2D49
(3014) 		if (!fno) {
    02D14 20AA      TST	R10
    02D15 F449      BNE	0x2D1F
    02D16 20BB      TST	R11
    02D17 F439      BNE	0x2D1F
(3015) 			res = dir_sdi(dj, 0);			/* Rewind the directory object */
    02D18 2722      CLR	R18
    02D19 2733      CLR	R19
    02D1A 018B      MOVW	R16,R22
    02D1B 940E 140E CALL	ff.c:dir_sdi
    02D1D 2F40      MOV	R20,R16
(3016) 		} else {
    02D1E C02A      RJMP	0x2D49
(3017) 			INIT_BUF(*dj);
    02D1F 01CE      MOVW	R24,R28
    02D20 01FB      MOVW	R30,R22
    02D21 8B95      STD	Z+21,R25
    02D22 8B84      STD	Z+20,R24
(3018) 			res = dir_read(dj);				/* Read an directory item */
    02D23 018F      MOVW	R16,R30
    02D24 940E 170B CALL	ff.c:dir_read
    02D26 2EC0      MOV	R12,R16
    02D27 2D4C      MOV	R20,R12
(3019) 			if (res == FR_NO_FILE) {		/* Reached end of dir */
    02D28 3004      CPI	R16,4
    02D29 F441      BNE	0x2D32
(3020) 				dj->sect = 0;
    02D2A 01FB      MOVW	R30,R22
    02D2B 963E      ADIW	R30,0xE
    02D2C E080      LDI	R24,0
    02D2D 8380      ST	Z,R24
    02D2E 8381      STD	Z+1,R24
    02D2F 8382      STD	Z+2,R24
    02D30 8383      STD	Z+3,R24
(3021) 				res = FR_OK;
    02D31 2744      CLR	R20
(3022) 			}
(3023) 			if (res == FR_OK) {				/* A valid entry is found */
    02D32 2344      TST	R20
    02D33 F4A9      BNE	0x2D49
(3024) 				get_fileinfo(dj, fno);		/* Get the object information */
    02D34 0195      MOVW	R18,R10
    02D35 018B      MOVW	R16,R22
    02D36 940E 18C1 CALL	ff.c:get_fileinfo
(3025) 				res = dir_next(dj, 0);		/* Increment index for next */
    02D38 2722      CLR	R18
    02D39 2733      CLR	R19
    02D3A 018B      MOVW	R16,R22
    02D3B 940E 1518 CALL	ff.c:dir_next
    02D3D 2EA0      MOV	R10,R16
    02D3E 2D4A      MOV	R20,R10
(3026) 				if (res == FR_NO_FILE) {
    02D3F 3004      CPI	R16,4
    02D40 F441      BNE	0x2D49
(3027) 					dj->sect = 0;
    02D41 01FB      MOVW	R30,R22
    02D42 963E      ADIW	R30,0xE
    02D43 E080      LDI	R24,0
    02D44 8380      ST	Z,R24
    02D45 8381      STD	Z+1,R24
    02D46 8382      STD	Z+2,R24
    02D47 8383      STD	Z+3,R24
(3028) 					res = FR_OK;
    02D48 2744      CLR	R20
(3029) 				}
(3030) 			}
(3031) 			FREE_BUF();
(3032) 		}
(3033) 	}
(3034) 
(3035) 	LEAVE_FF(dj->fs, res);
    02D49 2F04      MOV	R16,R20
    02D4A 962C      ADIW	R28,0xC
    02D4B 940C 4B61 JMP	pop_xgsetF03C
FILE: D:\LQD\software\software_src\delay.c
(0001) /*******************************
(0002)  function ：延时函数
(0003) Clock F  :7.3728M 
(0004) Software : ICCAVR7.14C
(0005) ********************************/
(0006) /*---------------------------------------------------------------------------------
(0007)      延时程序计算方法
(0008)      计数个数j = 延时时间/6*晶振频率 - 1
(0009) ---------------------------------------------------------------------------------*/
(0010) void delayus(unsigned int tttt)   // 1.2us 延时子函数   
(0011) { 
(0012)    do
(0013)    {
(0014)        tttt--;
_delayus:
  tttt                 --> R16
    02D4D 5001      SUBI	R16,1
    02D4E 4010      SBCI	R17,0
(0015)    }
(0016)    while(tttt>1);
    02D4F E081      LDI	R24,1
    02D50 E090      LDI	R25,0
    02D51 1780      CP	R24,R16
    02D52 0791      CPC	R25,R17
    02D53 F3C8      BCS	0x2D4D
    02D54 9508      RET
_delayms:
  j                    --> R20
  i                    --> R16
    02D55 934A      ST	-Y,R20
    02D56 935A      ST	-Y,R21
(0017) }
(0018) void delayms(unsigned int i)                 //1ms延时
(0019)    {
    02D57 C00A      RJMP	0x2D62
(0020)     while(i--)
(0021)     {                          
(0022) 	    unsigned int j;                
(0023)         for(j=1;j<=1227;j++)   
    02D58 E041      LDI	R20,1
    02D59 E050      LDI	R21,0
    02D5A C002      RJMP	0x2D5D
    02D5B 5F4F      SUBI	R20,0xFF
    02D5C 4F5F      SBCI	R21,0xFF
    02D5D EC8B      LDI	R24,0xCB
    02D5E E094      LDI	R25,4
    02D5F 1784      CP	R24,R20
    02D60 0795      CPC	R25,R21
    02D61 F7C8      BCC	0x2D5B
    02D62 0118      MOVW	R2,R16
    02D63 5001      SUBI	R16,1
    02D64 4010      SBCI	R17,0
    02D65 2022      TST	R2
    02D66 F789      BNE	0x2D58
    02D67 2033      TST	R3
    02D68 F779      BNE	0x2D58
    02D69 9159      LD	R21,Y+
    02D6A 9149      LD	R20,Y+
    02D6B 9508      RET
_SD_Write_cmd:
  k                    --> R22
  temp                 --> R20
  p                    --> R20
    02D6C 940E 4B32 CALL	push_xgsetF000
    02D6E 01A8      MOVW	R20,R16
FILE: D:\LQD\software\software_src\sd.c
(0001) //*****************************************************************************//
(0002) //*								数码相框
(0003) //*控制芯片：ATmgea128
(0004) //*开发环境：AVR Studio+GCC
(0005) //*隶属模块：SD卡控制
(0006) //*修改者：  桃子
(0007) //*****************************************************************************//
(0008) #include "sd.h"
(0009) 
(0010) //****************************************************************
(0011) //*隶属模块：SD卡控制
(0012) //*函数功能：写6字节数据
(0013) //****************************************************************
(0014) UINT8 SD_Write_cmd(UINT8 *p)
(0015) {	
(0016) 	UINT16 temp,k=0;
    02D6F 2766      CLR	R22
    02D70 2777      CLR	R23
(0017) 	SD_CS_DIS();//禁止SPI
    02D71 9AC0      SBI	0x18,0
(0018) 	SPI_Read();//空读一字节
    02D72 940E 3EBE CALL	_SPI_Read
(0019) 	SD_CS_EN();//使能SPI
    02D74 98C0      CBI	0x18,0
(0020) 
(0021) 	SPI_Write(p[0]);
    02D75 01FA      MOVW	R30,R20
    02D76 8100      LD	R16,Z
    02D77 940E 3EBA CALL	_SPI_Write
(0022) 	SPI_Write(p[1]);
    02D79 01FA      MOVW	R30,R20
    02D7A 8101      LDD	R16,Z+1
    02D7B 940E 3EBA CALL	_SPI_Write
(0023) 	SPI_Write(p[2]);
    02D7D 01FA      MOVW	R30,R20
    02D7E 8102      LDD	R16,Z+2
    02D7F 940E 3EBA CALL	_SPI_Write
(0024) 	SPI_Write(p[3]);
    02D81 01FA      MOVW	R30,R20
    02D82 8103      LDD	R16,Z+3
    02D83 940E 3EBA CALL	_SPI_Write
(0025) 	SPI_Write(p[4]);
    02D85 01FA      MOVW	R30,R20
    02D86 8104      LDD	R16,Z+4
    02D87 940E 3EBA CALL	_SPI_Write
(0026) 	SPI_Write(p[5]);
    02D89 01FA      MOVW	R30,R20
    02D8A 8105      LDD	R16,Z+5
    02D8B 940E 3EBA CALL	_SPI_Write
(0027) 
(0028) 	do 
(0029)  	{  
(0030)   		temp = SPI_Read();//一直读，直到读到的不是0xff或超时
    02D8D 940E 3EBE CALL	_SPI_Read
    02D8F 2F40      MOV	R20,R16
    02D90 2755      CLR	R21
(0031)  		k++;
    02D91 5F6F      SUBI	R22,0xFF
    02D92 4F7F      SBCI	R23,0xFF
(0032)  	}while((temp==0xff)&&(k<TRY_TIME)); 
    02D93 3F4F      CPI	R20,0xFF
    02D94 E0E0      LDI	R30,0
    02D95 075E      CPC	R21,R30
    02D96 F421      BNE	0x2D9B
    02D97 3164      CPI	R22,0x14
    02D98 E0E0      LDI	R30,0
    02D99 077E      CPC	R23,R30
    02D9A F390      BCS	0x2D8D
(0033) 
(0034) 	return temp;
    02D9B 2F04      MOV	R16,R20
    02D9C 940C 4B37 JMP	pop_xgsetF000
_SD_Init:
  pcmd                 --> Y,+0
  temp                 --> R22
  time                 --> R20
    02D9E 940E 4B3C CALL	push_xgsetF00C
    02DA0 9726      SBIW	R28,6
(0035) }
(0036) //****************************************************************
(0037) //*隶属模块：SD卡控制
(0038) //*函数功能：初始化
(0039) //****************************************************************
(0040) UINT8 SD_Init(void)	
(0041) {  
(0042) 	UINT8 time=0,temp=0;
    02DA1 2744      CLR	R20
    02DA2 2766      CLR	R22
(0043) 	UINT8 pcmd[] = {0x40,0x00,0x00,0x00,0x00,0x95}; //命令0的字节序列
    02DA3 E886      LDI	R24,0x86
    02DA4 E092      LDI	R25,2
    02DA5 01FE      MOVW	R30,R28
    02DA6 E006      LDI	R16,6
    02DA7 E010      LDI	R17,0
    02DA8 93FA      ST	-Y,R31
    02DA9 93EA      ST	-Y,R30
    02DAA 939A      ST	-Y,R25
    02DAB 938A      ST	-Y,R24
    02DAC 940E 4BCD CALL	asgnblk
(0044) 	if(SD_DET()==0) return 0x02; //no disk
    02DAE B181      IN	R24,0x01
    02DAF 9586      LSR	R24
    02DB0 9586      LSR	R24
    02DB1 9586      LSR	R24
    02DB2 9586      LSR	R24
    02DB3 9586      LSR	R24
    02DB4 7081      ANDI	R24,1
    02DB5 F421      BNE	0x2DBA
    02DB6 E081      LDI	R24,1
    02DB7 E090      LDI	R25,0
    02DB8 015C      MOVW	R10,R24
    02DB9 C002      RJMP	0x2DBC
    02DBA 24AA      CLR	R10
    02DBB 24BB      CLR	R11
    02DBC 20AA      TST	R10
    02DBD F421      BNE	0x2DC2
    02DBE 20BB      TST	R11
    02DBF F411      BNE	0x2DC2
    02DC0 E002      LDI	R16,2
    02DC1 C039      RJMP	0x2DFB
(0045) 	SD_PORT |= (1<<SD_CS);
    02DC2 9AC0      SBI	0x18,0
(0046) 	SD_DDR |= (1<<SD_CS);
    02DC3 9AB8      SBI	0x17,0
(0047) 
(0048) 	SPI_IO_Init();
    02DC4 940E 3EB0 CALL	_SPI_IO_Init
(0049) 	SPI_Low();
    02DC6 E582      LDI	R24,0x52
    02DC7 B98D      OUT	0x0D,R24
    02DC8 B18E      IN	R24,0x0E
    02DC9 7F8F      ANDI	R24,0xFF
    02DCA B98E      OUT	0x0E,R24
(0050) 
(0051) 	SD_CS_DIS();  //关闭片选 
    02DCB 9AC0      SBI	0x18,0
(0052) 	for(time=0;time<10;time++) //初始时，首先要发送最少74个时钟信号，这是必须的！！！
    02DCC 2744      CLR	R20
    02DCD C003      RJMP	0x2DD1
(0053) 	{
(0054)   		SPI_Read(); 
    02DCE 940E 3EBE CALL	_SPI_Read
    02DD0 9543      INC	R20
    02DD1 304A      CPI	R20,0xA
    02DD2 F3D8      BCS	0x2DCE
(0055) 	}
(0056) 	SD_CS_EN(); //打开片选
    02DD3 98C0      CBI	0x18,0
(0057) 	time = 0;
    02DD4 2744      CLR	R20
(0058) 	do
(0059) 	{ 
(0060) 		temp=SD_Write_cmd(pcmd);//写入CMD0
    02DD5 018E      MOVW	R16,R28
    02DD6 DF95      RCALL	_SD_Write_cmd
    02DD7 2F60      MOV	R22,R16
(0061) 	 	time++;
    02DD8 9543      INC	R20
(0062) 	 	if(time==TRY_TIME) 
    02DD9 3144      CPI	R20,0x14
    02DDA F419      BNE	0x2DDE
(0063) 	 	{ 
(0064) 	  		SD_CS_DIS(); //关闭片选
    02DDB 9AC0      SBI	0x18,0
(0065) 	  		return(INIT_CMD0_ERROR);//CMD0写入失败
    02DDC E001      LDI	R16,1
    02DDD C01D      RJMP	0x2DFB
(0066) 	 	}
(0067) 	 }while(temp!=0x01);
    02DDE 3061      CPI	R22,1
    02DDF F7A9      BNE	0x2DD5
(0068) 
(0069) 	SD_CS_DIS(); //关闭片选
    02DE0 9AC0      SBI	0x18,0
(0070) 	SPI_Read(); //按照SD卡的操作时序在这里补8个时钟 
    02DE1 940E 3EBE CALL	_SPI_Read
(0071) 	SD_CS_EN(); //打开片选
    02DE3 98C0      CBI	0x18,0
(0072) 
(0073) 	pcmd[0]=0x41,pcmd[5]=0xff;
    02DE4 E481      LDI	R24,0x41
    02DE5 8388      ST	Y,R24
    02DE6 EF8F      LDI	R24,0xFF
    02DE7 838D      STD	Y+5,R24
(0074) 	time = 0;
    02DE8 2744      CLR	R20
(0075) 	do
(0076) 	{ 
(0077) 		temp=SD_Write_cmd(pcmd);
    02DE9 018E      MOVW	R16,R28
    02DEA DF81      RCALL	_SD_Write_cmd
    02DEB 2F60      MOV	R22,R16
(0078) 		time++;
    02DEC 9543      INC	R20
(0079) 		if(time==TRY_TIME) 
    02DED 3144      CPI	R20,0x14
    02DEE F419      BNE	0x2DF2
(0080) 		{ 
(0081) 		 	SD_CS_DIS(); //关闭片选
    02DEF 9AC0      SBI	0x18,0
(0082) 			 return(INIT_CMD1_ERROR);//CMD1写入失败
    02DF0 E002      LDI	R16,2
    02DF1 C009      RJMP	0x2DFB
(0083) 		 }
(0084) 	 }while(temp!=0);
    02DF2 2366      TST	R22
    02DF3 F7A9      BNE	0x2DE9
(0085)   
(0086) 	 SPI_High();  
    02DF4 E580      LDI	R24,0x50
    02DF5 B98D      OUT	0x0D,R24
    02DF6 9A70      SBI	0x0E,0
(0087) 	 SD_CS_DIS();  //关闭片选 
    02DF7 9AC0      SBI	0x18,0
(0088) 	 SPI_Read(); //按照SD卡的操作时序在这里补8个时钟
    02DF8 940E 3EBE CALL	_SPI_Read
(0089) 	 return SD_TURE; //返回0,说明初始化操作成功
    02DFA 2700      CLR	R16
    02DFB 9626      ADIW	R28,6
    02DFC 940C 4B43 JMP	pop_xgsetF00C
_SD_Write_Sector:
  pcmd                 --> Y,+0
  time                 --> R12
  temp                 --> R20
  i                    --> R22
  buffer               --> R10
  addr                 --> Y,+14
    02DFE 940E 49D8 CALL	push_arg4
    02E00 940E 4B58 CALL	push_xgsetF03C
    02E02 9726      SBIW	R28,6
    02E03 88AA      LDD	R10,Y+18
    02E04 88BB      LDD	R11,Y+19
(0090) } 
(0091) //****************************************************************
(0092) //*隶属模块：SD卡控制
(0093) //*函数功能：写512字节数据（一扇区字节）
(0094) //****************************************************************
(0095) UINT16 SD_Write_Sector(UINT32 addr,UINT8 *buffer)
(0096) {  
(0097) 	UINT8 temp=0,time=0;
    02E05 2744      CLR	R20
    02E06 24CC      CLR	R12
(0098) 	UINT16 i=0;
    02E07 2766      CLR	R22
    02E08 2777      CLR	R23
(0099) 	UINT8 pcmd[] = {0x58,0x00,0x00,0x00,0x00,0xff}; //向SD卡中单个块（512字节，一个扇区）写入数据，用CMD24
    02E09 E88C      LDI	R24,0x8C
    02E0A E092      LDI	R25,2
    02E0B 01FE      MOVW	R30,R28
    02E0C E006      LDI	R16,6
    02E0D E010      LDI	R17,0
    02E0E 93FA      ST	-Y,R31
    02E0F 93EA      ST	-Y,R30
    02E10 939A      ST	-Y,R25
    02E11 938A      ST	-Y,R24
    02E12 940E 4BCD CALL	asgnblk
(0100) 
(0101) 	 addr<<=9; //将块地址（扇区地址）转为字节地址 ［这里就限制了SD卡的最大容量为4G］
    02E14 E089      LDI	R24,0x9
    02E15 E090      LDI	R25,0
    02E16 850E      LDD	R16,Y+14
    02E17 851F      LDD	R17,Y+15
    02E18 8928      LDD	R18,Y+16
    02E19 8939      LDD	R19,Y+17
    02E1A 938A      ST	-Y,R24
    02E1B 940E 4BA8 CALL	lsl32
    02E1D 870E      STD	Y+14,R16
    02E1E 871F      STD	Y+15,R17
    02E1F 8B28      STD	Y+16,R18
    02E20 8B39      STD	Y+17,R19
(0102) 
(0103) 	 pcmd[1]=(addr>>24); //将字节地址写入到CMD24字节序列中
    02E21 E188      LDI	R24,0x18
    02E22 E090      LDI	R25,0
    02E23 850E      LDD	R16,Y+14
    02E24 851F      LDD	R17,Y+15
    02E25 8928      LDD	R18,Y+16
    02E26 8939      LDD	R19,Y+17
    02E27 938A      ST	-Y,R24
    02E28 940E 4BC1 CALL	lsr32
    02E2A 8309      STD	Y+1,R16
(0104) 	 pcmd[2]=(addr>>16);
    02E2B 842E      LDD	R2,Y+14
    02E2C 843F      LDD	R3,Y+15
    02E2D 8848      LDD	R4,Y+16
    02E2E 8859      LDD	R5,Y+17
    02E2F 0112      MOVW	R2,R4
    02E30 2444      CLR	R4
    02E31 2455      CLR	R5
    02E32 822A      STD	Y+2,R2
(0105) 	 pcmd[3]=(addr>>8);
    02E33 E088      LDI	R24,0x8
    02E34 E090      LDI	R25,0
    02E35 850E      LDD	R16,Y+14
    02E36 851F      LDD	R17,Y+15
    02E37 8928      LDD	R18,Y+16
    02E38 8939      LDD	R19,Y+17
    02E39 938A      ST	-Y,R24
    02E3A 940E 4BC1 CALL	lsr32
    02E3C 830B      STD	Y+3,R16
(0106) 	// pcmd[4]=offset;	
(0107) 	 SD_CS_EN();//打开SD卡片选
    02E3D 98C0      CBI	0x18,0
(0108) 
(0109) 	 do
(0110) 	 {  
(0111) 		temp=SD_Write_cmd(pcmd);
    02E3E 018E      MOVW	R16,R28
    02E3F DF2C      RCALL	_SD_Write_cmd
    02E40 2F40      MOV	R20,R16
(0112)   		time++;
    02E41 94C3      INC	R12
(0113)   		if(time==TRY_TIME) 
    02E42 2D8C      MOV	R24,R12
    02E43 3184      CPI	R24,0x14
    02E44 F419      BNE	0x2E48
(0114)   		{ 
(0115)    			SD_CS_DIS(); //关闭片选
    02E45 9AC0      SBI	0x18,0
(0116)    			return(temp); //命令写入失败
    02E46 2711      CLR	R17
    02E47 C037      RJMP	0x2E7F
(0117)   		}
(0118) 	}while(temp!=0); 
    02E48 2344      TST	R20
    02E49 F7A1      BNE	0x2E3E
(0119) 
(0120) 	for(i=0;i<100;i++) //这里要插入若干时钟信号
    02E4A 2766      CLR	R22
    02E4B 2777      CLR	R23
    02E4C C004      RJMP	0x2E51
(0121)   		SPI_Read();
    02E4D 940E 3EBE CALL	_SPI_Read
    02E4F 5F6F      SUBI	R22,0xFF
    02E50 4F7F      SBCI	R23,0xFF
    02E51 3664      CPI	R22,0x64
    02E52 E0E0      LDI	R30,0
    02E53 077E      CPC	R23,R30
    02E54 F3C0      BCS	0x2E4D
(0122) 	
(0123) 	SPI_Write(0xfe);//写入开始字节 0xfe，后面就是要写入的512个字节的数据	
    02E55 EF0E      LDI	R16,0xFE
    02E56 940E 3EBA CALL	_SPI_Write
(0124) 	
(0125) 	for(i=0;i<512;i++) //将缓冲区中要写入的512个字节写入SD卡
    02E58 2766      CLR	R22
    02E59 2777      CLR	R23
    02E5A C007      RJMP	0x2E62
(0126) 		SPI_Write(*buffer++);
    02E5B 01F5      MOVW	R30,R10
    02E5C 9101      LD	R16,Z+
    02E5D 015F      MOVW	R10,R30
    02E5E 940E 3EBA CALL	_SPI_Write
    02E60 5F6F      SUBI	R22,0xFF
    02E61 4F7F      SBCI	R23,0xFF
    02E62 3060      CPI	R22,0
    02E63 E0E2      LDI	R30,2
    02E64 077E      CPC	R23,R30
    02E65 F3A8      BCS	0x2E5B
(0127)   
(0128) 	SPI_Read(); 
    02E66 940E 3EBE CALL	_SPI_Read
(0129) 	SPI_Read(); //两个字节的CRC校验码，不用关心
    02E68 940E 3EBE CALL	_SPI_Read
(0130)    
(0131)     
(0132) 	temp=SPI_Read();   //读取返回值
    02E6A 940E 3EBE CALL	_SPI_Read
    02E6C 2F40      MOV	R20,R16
(0133) 	if((temp&0x1F)!=0x05) //如果返回值是 XXX00101说明数据已经被SD卡接受了
    02E6D 2F84      MOV	R24,R20
    02E6E 718F      ANDI	R24,0x1F
    02E6F 3085      CPI	R24,5
    02E70 F021      BEQ	0x2E75
(0134) 	{
(0135)  		SD_CS_DIS();
    02E71 9AC0      SBI	0x18,0
(0136)  		return(WRITE_BLOCK_ERROR); //写块数据失败
    02E72 E003      LDI	R16,3
    02E73 E010      LDI	R17,0
    02E74 C00A      RJMP	0x2E7F
(0137) 	}
(0138)  
(0139) 	while(SPI_Read()!=0xff);//等到SD卡不忙（数据被接受以后，SD卡要将这些数据写入到自身的FLASH中，需要一个时间）
    02E75 940E 3EBE CALL	_SPI_Read
    02E77 2F40      MOV	R20,R16
    02E78 3F0F      CPI	R16,0xFF
    02E79 F7D9      BNE	0x2E75
(0140) 						    //忙时，读回来的值为0x00,不忙时，为0xff
(0141) 
(0142) 	SD_CS_DIS(); //关闭片选
    02E7A 9AC0      SBI	0x18,0
(0143) 
(0144) 	SPI_Read();//按照SD卡的操作时序在这里补8个时钟
    02E7B 940E 3EBE CALL	_SPI_Read
(0145) 	return SD_TURE;		 //返回0,说明写扇区操作成功
    02E7D 2700      CLR	R16
    02E7E 2711      CLR	R17
    02E7F 9626      ADIW	R28,6
    02E80 940E 4B61 CALL	pop_xgsetF03C
    02E82 9624      ADIW	R28,4
    02E83 9508      RET
_SD_Read_Sector:
  pcmd                 --> Y,+0
  temp                 --> R12
  time                 --> R22
  j                    --> R20
  buffer               --> R10
  addr                 --> Y,+14
    02E84 940E 49D8 CALL	push_arg4
    02E86 940E 4B58 CALL	push_xgsetF03C
    02E88 9726      SBIW	R28,6
    02E89 88AA      LDD	R10,Y+18
    02E8A 88BB      LDD	R11,Y+19
(0146) } 
(0147) //****************************************************************
(0148) //*隶属模块：SD卡控制
(0149) //*函数功能：读512字节数据（一扇区字节）
(0150) //****************************************************************
(0151) UINT16 SD_Read_Sector(UINT32 addr,UINT8 *buffer)//从SD卡的指定扇区中读出512个字节，使用CMD17（17号命令）
(0152) {
(0153) 
(0154) 	 UINT16 j=0;
    02E8B 2744      CLR	R20
    02E8C 2755      CLR	R21
(0155) 	 UINT8 time=0,temp=0;
    02E8D 2766      CLR	R22
    02E8E 24CC      CLR	R12
(0156) 	 UINT8 pcmd[]={0x51,0x00,0x00,0x00,0x00,0xff}; //CMD17的字节序列
    02E8F E982      LDI	R24,0x92
    02E90 E092      LDI	R25,2
    02E91 01FE      MOVW	R30,R28
    02E92 E006      LDI	R16,6
    02E93 E010      LDI	R17,0
    02E94 93FA      ST	-Y,R31
    02E95 93EA      ST	-Y,R30
    02E96 939A      ST	-Y,R25
    02E97 938A      ST	-Y,R24
    02E98 940E 4BCD CALL	asgnblk
(0157) 
(0158) 	 addr <<= 9; //将块地址（扇区地址）转为字节地址
    02E9A E089      LDI	R24,0x9
    02E9B E090      LDI	R25,0
    02E9C 850E      LDD	R16,Y+14
    02E9D 851F      LDD	R17,Y+15
    02E9E 8928      LDD	R18,Y+16
    02E9F 8939      LDD	R19,Y+17
    02EA0 938A      ST	-Y,R24
    02EA1 940E 4BA8 CALL	lsl32
    02EA3 870E      STD	Y+14,R16
    02EA4 871F      STD	Y+15,R17
    02EA5 8B28      STD	Y+16,R18
    02EA6 8B39      STD	Y+17,R19
(0159) 
(0160) 	 pcmd[1] = (addr>>24);//将字节地址写入到CMD17字节序列中
    02EA7 E188      LDI	R24,0x18
    02EA8 E090      LDI	R25,0
    02EA9 850E      LDD	R16,Y+14
    02EAA 851F      LDD	R17,Y+15
    02EAB 8928      LDD	R18,Y+16
    02EAC 8939      LDD	R19,Y+17
    02EAD 938A      ST	-Y,R24
    02EAE 940E 4BC1 CALL	lsr32
    02EB0 8309      STD	Y+1,R16
(0161) 	 pcmd[2] = (addr>>16);
    02EB1 842E      LDD	R2,Y+14
    02EB2 843F      LDD	R3,Y+15
    02EB3 8848      LDD	R4,Y+16
    02EB4 8859      LDD	R5,Y+17
    02EB5 0112      MOVW	R2,R4
    02EB6 2444      CLR	R4
    02EB7 2455      CLR	R5
    02EB8 822A      STD	Y+2,R2
(0162) 	 pcmd[3] =(addr>>8);
    02EB9 E088      LDI	R24,0x8
    02EBA E090      LDI	R25,0
    02EBB 850E      LDD	R16,Y+14
    02EBC 851F      LDD	R17,Y+15
    02EBD 8928      LDD	R18,Y+16
    02EBE 8939      LDD	R19,Y+17
    02EBF 938A      ST	-Y,R24
    02EC0 940E 4BC1 CALL	lsr32
    02EC2 830B      STD	Y+3,R16
(0163) 	// pcmd[4] = offset;
(0164) 
(0165) 	 SD_CS_EN();//打开片选 
    02EC3 98C0      CBI	0x18,0
(0166) 
(0167) 	 do
(0168) 	 {  
(0169) 		  temp=SD_Write_cmd(pcmd); //写入CMD17
    02EC4 018E      MOVW	R16,R28
    02EC5 DEA6      RCALL	_SD_Write_cmd
    02EC6 2EC0      MOV	R12,R16
(0170) 		  time++;
    02EC7 9563      INC	R22
(0171) 		  if(time==TRY_TIME) 
    02EC8 3164      CPI	R22,0x14
    02EC9 F421      BNE	0x2ECE
(0172) 		  {
(0173) 		   SD_CS_DIS();
    02ECA 9AC0      SBI	0x18,0
(0174) 		   return(READ_BLOCK_ERROR); //读块失败
    02ECB E004      LDI	R16,4
    02ECC E010      LDI	R17,0
    02ECD C01F      RJMP	0x2EED
(0175) 		  }
(0176) 	 }while(temp!=0); 
    02ECE 20CC      TST	R12
    02ECF F7A1      BNE	0x2EC4
(0177)    			
(0178) 	 while(SPI_Read()!= 0xfe); //一直读，当读到0xfe时，说明后面的是512字节的数据了
    02ED0 940E 3EBE CALL	_SPI_Read
    02ED2 3F0E      CPI	R16,0xFE
    02ED3 F7E1      BNE	0x2ED0
(0179)  		   	   	
(0180) 	 for(j=0;j<512;j++)	 //将数据写入到数据缓冲区中
    02ED4 2744      CLR	R20
    02ED5 2755      CLR	R21
    02ED6 C009      RJMP	0x2EE0
(0181) 	 {	
(0182) 	    buffer[j]=SPI_Read();
    02ED7 940E 3EBE CALL	_SPI_Read
    02ED9 2EC0      MOV	R12,R16
    02EDA 01FA      MOVW	R30,R20
    02EDB 0DEA      ADD	R30,R10
    02EDC 1DFB      ADC	R31,R11
    02EDD 82C0      ST	Z,R12
    02EDE 5F4F      SUBI	R20,0xFF
    02EDF 4F5F      SBCI	R21,0xFF
    02EE0 3040      CPI	R20,0
    02EE1 E0E2      LDI	R30,2
    02EE2 075E      CPC	R21,R30
    02EE3 F398      BCS	0x2ED7
(0183) 	 }
(0184) 
(0185) 	 SPI_Read();//读取两个字节的CRC校验码，不用关心它们
    02EE4 940E 3EBE CALL	_SPI_Read
(0186) 	 SPI_Read();
    02EE6 940E 3EBE CALL	_SPI_Read
(0187) 
(0188) 	 SD_CS_DIS();  //SD卡关闭片选 
    02EE8 9AC0      SBI	0x18,0
(0189) 
(0190) 	 SPI_Read();//按照SD卡的操作时序在这里补8个时钟
    02EE9 940E 3EBE CALL	_SPI_Read
(0191) 
(0192) 	 return SD_TURE;
    02EEB 2700      CLR	R16
    02EEC 2711      CLR	R17
    02EED 9626      ADIW	R28,6
    02EEE 940E 4B61 CALL	pop_xgsetF03C
    02EF0 9624      ADIW	R28,4
    02EF1 9508      RET
_SD_Read_Sector_ndata:
  pcmd                 --> Y,+0
  temp                 --> R12
  time                 --> R22
  j                    --> R20
  len                  --> R14
  offset               --> R10
  buffer               --> Y,+20
  addr                 --> Y,+16
    02EF2 940E 49D8 CALL	push_arg4
    02EF4 940E 4B1D CALL	push_xgsetF0FC
    02EF6 9726      SBIW	R28,6
    02EF7 88AE      LDD	R10,Y+22
    02EF8 88BF      LDD	R11,Y+23
    02EF9 8CE8      LDD	R14,Y+24
    02EFA 8CF9      LDD	R15,Y+25
(0193) }
(0194) //****************************************************************
(0195) //*隶属模块：SD卡控制
(0196) //*函数功能：写多扇区数据（多扇区字节）
(0197) //****************************************************************
(0198) UINT16 SD_Read_Sector_ndata(UINT32 addr,UINT8 *buffer,UINT16 offset,UINT16 len)//从SD卡的指定扇区中读出512个字节，使用CMD17（17号命令）
(0199) {
(0200) 
(0201) 	 UINT16 j=0;
    02EFB 2744      CLR	R20
    02EFC 2755      CLR	R21
(0202) 	 UINT8 time=0,temp=0;
    02EFD 2766      CLR	R22
    02EFE 24CC      CLR	R12
(0203) 	 UINT8 pcmd[]={0x51,0x00,0x00,0x00,0x00,0xff}; //CMD17的字节序列
    02EFF E988      LDI	R24,0x98
    02F00 E092      LDI	R25,2
    02F01 01FE      MOVW	R30,R28
    02F02 E006      LDI	R16,6
    02F03 E010      LDI	R17,0
    02F04 93FA      ST	-Y,R31
    02F05 93EA      ST	-Y,R30
    02F06 939A      ST	-Y,R25
    02F07 938A      ST	-Y,R24
    02F08 940E 4BCD CALL	asgnblk
(0204) 
(0205) 	 addr <<= 9; //将块地址（扇区地址）转为字节地址
    02F0A E089      LDI	R24,0x9
    02F0B E090      LDI	R25,0
    02F0C 8908      LDD	R16,Y+16
    02F0D 8919      LDD	R17,Y+17
    02F0E 892A      LDD	R18,Y+18
    02F0F 893B      LDD	R19,Y+19
    02F10 938A      ST	-Y,R24
    02F11 940E 4BA8 CALL	lsl32
    02F13 8B08      STD	Y+16,R16
    02F14 8B19      STD	Y+17,R17
    02F15 8B2A      STD	Y+18,R18
    02F16 8B3B      STD	Y+19,R19
(0206) 
(0207) 	 pcmd[1] = (addr>>24);//将字节地址写入到CMD17字节序列中
    02F17 E188      LDI	R24,0x18
    02F18 E090      LDI	R25,0
    02F19 8908      LDD	R16,Y+16
    02F1A 8919      LDD	R17,Y+17
    02F1B 892A      LDD	R18,Y+18
    02F1C 893B      LDD	R19,Y+19
    02F1D 938A      ST	-Y,R24
    02F1E 940E 4BC1 CALL	lsr32
    02F20 8309      STD	Y+1,R16
(0208) 	 pcmd[2] = (addr>>16);
    02F21 8828      LDD	R2,Y+16
    02F22 8839      LDD	R3,Y+17
    02F23 884A      LDD	R4,Y+18
    02F24 885B      LDD	R5,Y+19
    02F25 0112      MOVW	R2,R4
    02F26 2444      CLR	R4
    02F27 2455      CLR	R5
    02F28 822A      STD	Y+2,R2
(0209) 	 pcmd[3] =(addr>>8);
    02F29 E088      LDI	R24,0x8
    02F2A E090      LDI	R25,0
    02F2B 8908      LDD	R16,Y+16
    02F2C 8919      LDD	R17,Y+17
    02F2D 892A      LDD	R18,Y+18
    02F2E 893B      LDD	R19,Y+19
    02F2F 938A      ST	-Y,R24
    02F30 940E 4BC1 CALL	lsr32
    02F32 830B      STD	Y+3,R16
(0210) 	// pcmd[4] = offset;
(0211) 
(0212) 	 SD_CS_EN();//打开片选 
    02F33 98C0      CBI	0x18,0
(0213) 
(0214) 	 do
(0215) 	 {  
(0216) 		  temp=SD_Write_cmd(pcmd); //写入CMD17
    02F34 018E      MOVW	R16,R28
    02F35 DE36      RCALL	_SD_Write_cmd
    02F36 2EC0      MOV	R12,R16
(0217) 		  time++;
    02F37 9563      INC	R22
(0218) 		  if(time==TRY_TIME) 
    02F38 3164      CPI	R22,0x14
    02F39 F421      BNE	0x2F3E
(0219) 		  {
(0220) 		   SD_CS_DIS();
    02F3A 9AC0      SBI	0x18,0
(0221) 		   return(READ_BLOCK_ERROR); //读块失败
    02F3B E004      LDI	R16,4
    02F3C E010      LDI	R17,0
    02F3D C034      RJMP	0x2F72
(0222) 		  }
(0223) 	 }while(temp!=0); 
    02F3E 20CC      TST	R12
    02F3F F7A1      BNE	0x2F34
(0224)    			
(0225) 	 while(SPI_Read()!= 0xfe); //一直读，当读到0xfe时，说明后面的是512字节的数据了
    02F40 940E 3EBE CALL	_SPI_Read
    02F42 3F0E      CPI	R16,0xFE
    02F43 F7E1      BNE	0x2F40
(0226)  		   	   	
(0227) 	 for(j=0;j<offset;j++)	 //将数据写入到数据缓冲区中
    02F44 2744      CLR	R20
    02F45 2755      CLR	R21
    02F46 C004      RJMP	0x2F4B
(0228) 	    SPI_Read();
    02F47 940E 3EBE CALL	_SPI_Read
    02F49 5F4F      SUBI	R20,0xFF
    02F4A 4F5F      SBCI	R21,0xFF
    02F4B 154A      CP	R20,R10
    02F4C 055B      CPC	R21,R11
    02F4D F3C8      BCS	0x2F47
(0229) 	 for(;j<offset+len;j++)	 
    02F4E C00B      RJMP	0x2F5A
(0230) 		buffer[j]=SPI_Read();
    02F4F 940E 3EBE CALL	_SPI_Read
    02F51 2F60      MOV	R22,R16
    02F52 01FA      MOVW	R30,R20
    02F53 880C      LDD	R0,Y+20
    02F54 881D      LDD	R1,Y+21
    02F55 0DE0      ADD	R30,R0
    02F56 1DF1      ADC	R31,R1
    02F57 8360      ST	Z,R22
    02F58 5F4F      SUBI	R20,0xFF
    02F59 4F5F      SBCI	R21,0xFF
    02F5A 0115      MOVW	R2,R10
    02F5B 0C2E      ADD	R2,R14
    02F5C 1C3F      ADC	R3,R15
    02F5D 1542      CP	R20,R2
    02F5E 0553      CPC	R21,R3
    02F5F F378      BCS	0x2F4F
(0231) 	 for(;j<512;j++)	 
    02F60 C004      RJMP	0x2F65
(0232) 		SPI_Read();
    02F61 940E 3EBE CALL	_SPI_Read
    02F63 5F4F      SUBI	R20,0xFF
    02F64 4F5F      SBCI	R21,0xFF
    02F65 3040      CPI	R20,0
    02F66 E0E2      LDI	R30,2
    02F67 075E      CPC	R21,R30
    02F68 F3C0      BCS	0x2F61
(0233) 
(0234) 	 SPI_Read();//读取两个字节的CRC校验码，不用关心它们
    02F69 940E 3EBE CALL	_SPI_Read
(0235) 	 SPI_Read();
    02F6B 940E 3EBE CALL	_SPI_Read
(0236) 
(0237) 	 SD_CS_DIS();  //SD卡关闭片选 
    02F6D 9AC0      SBI	0x18,0
(0238) 
(0239) 	 SPI_Read();//按照SD卡的操作时序在这里补8个时钟
    02F6E 940E 3EBE CALL	_SPI_Read
(0240) 
(0241) 	 return SD_TURE;
    02F70 2700      CLR	R16
    02F71 2711      CLR	R17
    02F72 9626      ADIW	R28,6
    02F73 940E 4B12 CALL	pop_xgsetF0FC
    02F75 9624      ADIW	R28,4
    02F76 9508      RET
_GUI_mainmeu:
  key                  --> R22
  select               --> R20
    02F77 940E 4B3C CALL	push_xgsetF00C
    02F79 9723      SBIW	R28,3
FILE: D:\LQD\software\software_src\gui.c
(0001) #include "config.h"
(0002) const char labelH[]="高强度作业：\0";
(0003) const char labelM[]="中等强度作业：\0";
(0004) const char labelL[]="低强度作业：\0";
(0005) const char H01[]="加强劳动监督；\0";
(0006) const char H02[]="增加饮水;\0" ;
(0007) const char H03[]="保持干燥禁裸露。\0";
(0008) #define M01 H01
(0009) #define M02 H03
(0010) const char M03[]="戴面罩。\0";
(0011) const char M04[]="禁油彩。\0";
(0012) #define L01 M03
(0013) #define L02 M04
(0014) const char L03[]="缩短作业时间。";
(0015) //-----//
(0016) #define H11 M04
(0017) #define H12 H03
(0018) const char H13[]="休息注意保暖。\0";
(0019) #define M11 H01
(0020) const char M12[]="减少非必须作业；\0";
(0021) const char M13[]="劳动时间<30min。\0";
(0022) const char L11[]="取消非必须的作业\0";
(0023) const char L12[]="劳动时间<15min；\0";
(0024) #define L13 H03
(0025) //-----//
(0026) #define H21 L11
(0027) #define H22 L12
(0028) #define H23 H03
(0029) const char M21[]="取消户外作业。"; 
(0030) #define L21 M21
(0031) const char str_blank[]="----------------"; 
(0032) //#define LEDON   PORTC&=~(1<<7)					   
(0033) //#define LEDOFF  PINC|=(1<<7)
(0034) char GUI_date[17]="09月19日18:00:00\0";
(0035) 
(0036) // 主菜单
(0037) unsigned char GUI_mainmeu( void ){
(0038)  	unsigned char key=0; //init= nokey
    02F7A 2766      CLR	R22
(0039) 	unsigned char select=3;
    02F7B E043      LDI	R20,3
(0040) 	LCD_CLR();
    02F7C 940E 3F9E CALL	_LCD_CLR
(0041) 	
(0042)  	Set_White(1,1,8,1);
    02F7E E081      LDI	R24,1
    02F7F 838A      STD	Y+2,R24
    02F80 E088      LDI	R24,0x8
    02F81 8388      ST	Y,R24
    02F82 E021      LDI	R18,1
    02F83 E001      LDI	R16,1
    02F84 940E 4028 CALL	_Set_White
(0043) 	Set_White(1,2,8,1);
    02F86 E081      LDI	R24,1
    02F87 838A      STD	Y+2,R24
    02F88 E088      LDI	R24,0x8
    02F89 8388      ST	Y,R24
    02F8A E022      LDI	R18,2
    02F8B E001      LDI	R16,1
    02F8C 940E 4028 CALL	_Set_White
(0044) 	Set_White(1,3,8,1);
    02F8E E081      LDI	R24,1
    02F8F 838A      STD	Y+2,R24
    02F90 E088      LDI	R24,0x8
    02F91 8388      ST	Y,R24
    02F92 E023      LDI	R18,3
    02F93 E001      LDI	R16,1
    02F94 940E 4028 CALL	_Set_White
(0045) 	Set_White(1,4,8,1);
    02F96 E081      LDI	R24,1
    02F97 838A      STD	Y+2,R24
    02F98 E088      LDI	R24,0x8
    02F99 8388      ST	Y,R24
    02F9A E024      LDI	R18,4
    02F9B E001      LDI	R16,1
    02F9C 940E 4028 CALL	_Set_White
(0046) 	dateRefresh(1); //更新系统时间
    02F9E E001      LDI	R16,1
    02F9F 940E 3965 CALL	_dateRefresh
(0047) 	LCD_const_disp(1,1,GUI_get_date()); //显示时间
    02FA1 D578      RCALL	_GUI_get_date
    02FA2 8319      STD	Y+1,R17
    02FA3 8308      ST	Y,R16
    02FA4 E021      LDI	R18,1
    02FA5 E001      LDI	R16,1
    02FA6 940E 3EF8 CALL	_LCD_const_disp
(0048) 	LCD_const_disp(2,1,"  检测  时钟调整");
    02FA8 EA83      LDI	R24,0xA3
    02FA9 E095      LDI	R25,5
    02FAA 8399      STD	Y+1,R25
    02FAB 8388      ST	Y,R24
    02FAC E021      LDI	R18,1
    02FAD E002      LDI	R16,2
    02FAE 940E 3EF8 CALL	_LCD_const_disp
(0049) 	LCD_const_disp(3,1,"  查询  数据传输");
    02FB0 E982      LDI	R24,0x92
    02FB1 E095      LDI	R25,5
    02FB2 8399      STD	Y+1,R25
    02FB3 8388      ST	Y,R24
    02FB4 E021      LDI	R18,1
    02FB5 E003      LDI	R16,3
    02FB6 940E 3EF8 CALL	_LCD_const_disp
(0050) 	LCD_const_disp(4,1,"  初始化");
    02FB8 E889      LDI	R24,0x89
    02FB9 E095      LDI	R25,5
    02FBA 8399      STD	Y+1,R25
    02FBB 8388      ST	Y,R24
    02FBC E021      LDI	R18,1
    02FBD E004      LDI	R16,4
    02FBE 940E 3EF8 CALL	_LCD_const_disp
(0051) 	Set_White(1,1,8,1);
    02FC0 E081      LDI	R24,1
    02FC1 838A      STD	Y+2,R24
    02FC2 E088      LDI	R24,0x8
    02FC3 8388      ST	Y,R24
    02FC4 E021      LDI	R18,1
    02FC5 E001      LDI	R16,1
    02FC6 940E 4028 CALL	_Set_White
(0052) 	Set_White(1,2,8,1);
    02FC8 E081      LDI	R24,1
    02FC9 838A      STD	Y+2,R24
    02FCA E088      LDI	R24,0x8
    02FCB 8388      ST	Y,R24
    02FCC E022      LDI	R18,2
    02FCD E001      LDI	R16,1
    02FCE 940E 4028 CALL	_Set_White
(0053) 	Set_White(1,3,8,1);
    02FD0 E081      LDI	R24,1
    02FD1 838A      STD	Y+2,R24
    02FD2 E088      LDI	R24,0x8
    02FD3 8388      ST	Y,R24
    02FD4 E023      LDI	R18,3
    02FD5 E001      LDI	R16,1
    02FD6 940E 4028 CALL	_Set_White
(0054) 	Set_White(1,4,8,1);
    02FD8 E081      LDI	R24,1
    02FD9 838A      STD	Y+2,R24
    02FDA E088      LDI	R24,0x8
    02FDB 8388      ST	Y,R24
    02FDC E024      LDI	R18,4
    02FDD E001      LDI	R16,1
    02FDE 940E 4028 CALL	_Set_White
(0055) 	set_white_n(select,0);
    02FE0 2722      CLR	R18
    02FE1 2F04      MOV	R16,R20
    02FE2 940E 40BA CALL	_set_white_n
    02FE4 C07D      RJMP	0x3062
(0056) 	while(alwaysCheck())
(0057) 	{
(0058) 	 	key=kbscan();
    02FE5 940E 44FE CALL	_kbscan
    02FE7 2F60      MOV	R22,R16
(0059) 		dateRefresh(1); //更新系统时间
    02FE8 E001      LDI	R16,1
    02FE9 940E 3965 CALL	_dateRefresh
(0060) 		LCD_const_disp(1,1,GUI_get_date()); //显示时间
    02FEB D52E      RCALL	_GUI_get_date
    02FEC 0158      MOVW	R10,R16
    02FED 82B9      STD	Y+1,R11
    02FEE 82A8      ST	Y,R10
    02FEF E021      LDI	R18,1
    02FF0 E001      LDI	R16,1
    02FF1 940E 3EF8 CALL	_LCD_const_disp
(0061) 		if((select>3) && ( key==up ) ){
    02FF3 E083      LDI	R24,3
    02FF4 1784      CP	R24,R20
    02FF5 F4F8      BCC	0x3015
    02FF6 316E      CPI	R22,0x1E
    02FF7 F4E9      BNE	0x3015
(0062) 		 Set_White(1,2,8,1);
    02FF8 E081      LDI	R24,1
    02FF9 838A      STD	Y+2,R24
    02FFA E088      LDI	R24,0x8
    02FFB 8388      ST	Y,R24
    02FFC E022      LDI	R18,2
    02FFD E001      LDI	R16,1
    02FFE 940E 4028 CALL	_Set_White
(0063) 		 Set_White(1,3,8,1);
    03000 E081      LDI	R24,1
    03001 838A      STD	Y+2,R24
    03002 E088      LDI	R24,0x8
    03003 8388      ST	Y,R24
    03004 E023      LDI	R18,3
    03005 E001      LDI	R16,1
    03006 940E 4028 CALL	_Set_White
(0064) 		 Set_White(1,4,8,1);
    03008 E081      LDI	R24,1
    03009 838A      STD	Y+2,R24
    0300A E088      LDI	R24,0x8
    0300B 8388      ST	Y,R24
    0300C E024      LDI	R18,4
    0300D E001      LDI	R16,1
    0300E 940E 4028 CALL	_Set_White
(0065) 		 select--;
    03010 954A      DEC	R20
(0066) 		 set_white_n(select,0);
    03011 2722      CLR	R18
    03012 2F04      MOV	R16,R20
    03013 940E 40BA CALL	_set_white_n
(0067) 		}
(0068) 		if((select<7) && ( key==down ) ){
    03015 3047      CPI	R20,7
    03016 F538      BCC	0x303E
    03017 316D      CPI	R22,0x1D
    03018 F529      BNE	0x303E
(0069) 		 Set_White(1,1,8,1);
    03019 E081      LDI	R24,1
    0301A 838A      STD	Y+2,R24
    0301B E088      LDI	R24,0x8
    0301C 8388      ST	Y,R24
    0301D E021      LDI	R18,1
    0301E E001      LDI	R16,1
    0301F 940E 4028 CALL	_Set_White
(0070) 		 Set_White(1,2,8,1);
    03021 E081      LDI	R24,1
    03022 838A      STD	Y+2,R24
    03023 E088      LDI	R24,0x8
    03024 8388      ST	Y,R24
    03025 E022      LDI	R18,2
    03026 E001      LDI	R16,1
    03027 940E 4028 CALL	_Set_White
(0071) 		 Set_White(1,3,8,1);
    03029 E081      LDI	R24,1
    0302A 838A      STD	Y+2,R24
    0302B E088      LDI	R24,0x8
    0302C 8388      ST	Y,R24
    0302D E023      LDI	R18,3
    0302E E001      LDI	R16,1
    0302F 940E 4028 CALL	_Set_White
(0072) 		 Set_White(1,4,8,1);
    03031 E081      LDI	R24,1
    03032 838A      STD	Y+2,R24
    03033 E088      LDI	R24,0x8
    03034 8388      ST	Y,R24
    03035 E024      LDI	R18,4
    03036 E001      LDI	R16,1
    03037 940E 4028 CALL	_Set_White
(0073) 		 select++;
    03039 9543      INC	R20
(0074) 		 set_white_n(select,0);
    0303A 2722      CLR	R18
    0303B 2F04      MOV	R16,R20
    0303C 940E 40BA CALL	_set_white_n
(0075) 		}
(0076) 		if(key == left ){
    0303E 316B      CPI	R22,0x1B
    0303F F511      BNE	0x3062
(0077) 		 Set_White(1,1,8,1);
    03040 E081      LDI	R24,1
    03041 838A      STD	Y+2,R24
    03042 E088      LDI	R24,0x8
    03043 8388      ST	Y,R24
    03044 E021      LDI	R18,1
    03045 E001      LDI	R16,1
    03046 940E 4028 CALL	_Set_White
(0078) 		 Set_White(1,2,8,1);
    03048 E081      LDI	R24,1
    03049 838A      STD	Y+2,R24
    0304A E088      LDI	R24,0x8
    0304B 8388      ST	Y,R24
    0304C E022      LDI	R18,2
    0304D E001      LDI	R16,1
    0304E 940E 4028 CALL	_Set_White
(0079) 		 Set_White(1,3,8,1);
    03050 E081      LDI	R24,1
    03051 838A      STD	Y+2,R24
    03052 E088      LDI	R24,0x8
    03053 8388      ST	Y,R24
    03054 E023      LDI	R18,3
    03055 E001      LDI	R16,1
    03056 940E 4028 CALL	_Set_White
(0080) 		 Set_White(1,4,8,1);
    03058 E081      LDI	R24,1
    03059 838A      STD	Y+2,R24
    0305A E088      LDI	R24,0x8
    0305B 8388      ST	Y,R24
    0305C E024      LDI	R18,4
    0305D E001      LDI	R16,1
    0305E 940E 4028 CALL	_Set_White
(0081) 		 //beep(3,select);
(0082) 		 return select;
    03060 2F04      MOV	R16,R20
    03061 C007      RJMP	0x3069
    03062 940E 0477 CALL	_alwaysCheck
    03064 2EA0      MOV	R10,R16
    03065 2300      TST	R16
    03066 F009      BEQ	0x3068
    03067 CF7D      RJMP	0x2FE5
(0083) 		}
(0084)     }
(0085) 	return 0xff; //error
    03068 EF0F      LDI	R16,0xFF
    03069 9623      ADIW	R28,3
    0306A 940C 4B43 JMP	pop_xgsetF00C
_GUI_check:
  windcounter          --> Y,+9
  next_step_time       --> Y,+3
  selectCheckMode      --> R14
  is_on                --> Y,+8
  page                 --> Y,+7
  key                  --> R12
    0306C 940E 4B1D CALL	push_xgsetF0FC
    0306E 972A      SBIW	R28,0xA
(0086) 	
(0087) }
(0088) 
(0089) //”检测 “菜单
(0090) void GUI_check(void){
(0091)     char key;
(0092) 	char page=0,is_on=0;
    0306F 2400      CLR	R0
    03070 820F      STD	Y+7,R0
    03071 8608      STD	Y+8,R0
(0093) 	char windcounter=0;
    03072 8609      STD	Y+9,R0
(0094) 	unsigned long next_step_time=0;
    03073 E080      LDI	R24,0
    03074 838B      STD	Y+3,R24
    03075 838C      STD	Y+4,R24
    03076 838D      STD	Y+5,R24
    03077 838E      STD	Y+6,R24
(0095) 	char selectCheckMode=config.autocheck; //自动检测开关
    03078 90E0 08BA LDS	R14,config+15
(0096) RE_IN:
(0097) 	key=0;
    0307A 24CC      CLR	R12
(0098) 	page=0;
    0307B 2400      CLR	R0
    0307C 820F      STD	Y+7,R0
(0099) 	is_on=0;
    0307D 8608      STD	Y+8,R0
(0100) 	windcounter=0;
    0307E 8609      STD	Y+9,R0
(0101) 	next_step_time=0;
    0307F E080      LDI	R24,0
    03080 838B      STD	Y+3,R24
    03081 838C      STD	Y+4,R24
    03082 838D      STD	Y+5,R24
    03083 838E      STD	Y+6,R24
(0102) 	
(0103) 	dateRefresh(1);
    03084 E001      LDI	R16,1
    03085 940E 3965 CALL	_dateRefresh
(0104) 	LCD_CLR();
    03087 940E 3F9E CALL	_LCD_CLR
(0105) 	LCD_const_disp(1,1,"菜单/ 检测");
    03089 E78E      LDI	R24,0x7E
    0308A E095      LDI	R25,5
    0308B 8399      STD	Y+1,R25
    0308C 8388      ST	Y,R24
    0308D E021      LDI	R18,1
    0308E E001      LDI	R16,1
    0308F 940E 3EF8 CALL	_LCD_const_disp
(0106) 	LCD_const_disp(2,3,"自动");		 
    03091 E789      LDI	R24,0x79
    03092 E095      LDI	R25,5
    03093 8399      STD	Y+1,R25
    03094 8388      ST	Y,R24
    03095 E023      LDI	R18,3
    03096 E002      LDI	R16,2
    03097 940E 3EF8 CALL	_LCD_const_disp
(0107) 	LCD_const_disp(3,3,"手动");
    03099 E784      LDI	R24,0x74
    0309A E095      LDI	R25,5
    0309B 8399      STD	Y+1,R25
    0309C 8388      ST	Y,R24
    0309D E023      LDI	R18,3
    0309E E003      LDI	R16,3
    0309F 940E 3EF8 CALL	_LCD_const_disp
(0108) 	if(selectCheckMode==1) {
    030A1 2D8E      MOV	R24,R14
    030A2 3081      CPI	R24,1
    030A3 F489      BNE	0x30B5
(0109) 	    Set_White(1,2,8,0);
    030A4 2422      CLR	R2
    030A5 822A      STD	Y+2,R2
    030A6 E088      LDI	R24,0x8
    030A7 8388      ST	Y,R24
    030A8 E022      LDI	R18,2
    030A9 E001      LDI	R16,1
    030AA 940E 4028 CALL	_Set_White
(0110) 		Set_White(1,3,8,1);
    030AC E081      LDI	R24,1
    030AD 838A      STD	Y+2,R24
    030AE E088      LDI	R24,0x8
    030AF 8388      ST	Y,R24
    030B0 E023      LDI	R18,3
    030B1 E001      LDI	R16,1
    030B2 940E 4028 CALL	_Set_White
(0111) 	}
    030B4 C05E      RJMP	0x3113
(0112) 	else {
(0113) 		 Set_White(1,2,8,1);
    030B5 E081      LDI	R24,1
    030B6 838A      STD	Y+2,R24
    030B7 E088      LDI	R24,0x8
    030B8 8388      ST	Y,R24
    030B9 E022      LDI	R18,2
    030BA E001      LDI	R16,1
    030BB 940E 4028 CALL	_Set_White
(0114) 		 Set_White(1,3,8,0);
    030BD 2422      CLR	R2
    030BE 822A      STD	Y+2,R2
    030BF E088      LDI	R24,0x8
    030C0 8388      ST	Y,R24
    030C1 E023      LDI	R18,3
    030C2 E001      LDI	R16,1
    030C3 940E 4028 CALL	_Set_White
(0115) 	}
    030C5 C04D      RJMP	0x3113
(0116) 	
(0117) //<<菜单/检测/手（自）动>>
(0118) 	while(alwaysCheck()){
(0119) 	 	key=kbscan();
    030C6 940E 44FE CALL	_kbscan
    030C8 2EC0      MOV	R12,R16
(0120) 		dateRefresh(0); //只刷新后台时间
    030C9 2700      CLR	R16
    030CA 940E 3965 CALL	_dateRefresh
(0121) 		//上键短按 选择
(0122) 		if(key==up || key ==down){
    030CC 2D8C      MOV	R24,R12
    030CD 318E      CPI	R24,0x1E
    030CE F011      BEQ	0x30D1
    030CF 318D      CPI	R24,0x1D
    030D0 F539      BNE	0x30F8
(0123) 		    if(selectCheckMode >0){
    030D1 E080      LDI	R24,0
    030D2 158E      CP	R24,R14
    030D3 F490      BCC	0x30E6
(0124) 			    selectCheckMode=0;
    030D4 24EE      CLR	R14
(0125) 				Set_White(1,2,8,1);
    030D5 E081      LDI	R24,1
    030D6 838A      STD	Y+2,R24
    030D7 E088      LDI	R24,0x8
    030D8 8388      ST	Y,R24
    030D9 E022      LDI	R18,2
    030DA E001      LDI	R16,1
    030DB 940E 4028 CALL	_Set_White
(0126) 	 			Set_White(1,3,8,0);
    030DD 2422      CLR	R2
    030DE 822A      STD	Y+2,R2
    030DF E088      LDI	R24,0x8
    030E0 8388      ST	Y,R24
    030E1 E023      LDI	R18,3
    030E2 E001      LDI	R16,1
    030E3 940E 4028 CALL	_Set_White
(0127) 			}
    030E5 C012      RJMP	0x30F8
(0128) 			else {
(0129) 			    selectCheckMode=1;
    030E6 24EE      CLR	R14
    030E7 94E3      INC	R14
(0130) 				Set_White(1,2,8,0);
    030E8 2422      CLR	R2
    030E9 822A      STD	Y+2,R2
    030EA E088      LDI	R24,0x8
    030EB 8388      ST	Y,R24
    030EC E022      LDI	R18,2
    030ED E001      LDI	R16,1
    030EE 940E 4028 CALL	_Set_White
(0131) 	 			Set_White(1,3,8,1);
    030F0 E081      LDI	R24,1
    030F1 838A      STD	Y+2,R24
    030F2 E088      LDI	R24,0x8
    030F3 8388      ST	Y,R24
    030F4 E023      LDI	R18,3
    030F5 E001      LDI	R16,1
    030F6 940E 4028 CALL	_Set_White
(0132) 			}
(0133) 			
(0134) 		}
(0135) 		//左键短按  进入
(0136) 		if(key == left) {
    030F8 2D8C      MOV	R24,R12
    030F9 318B      CPI	R24,0x1B
    030FA F499      BNE	0x310E
(0137) 			config.autocheck=selectCheckMode; 
    030FB 92E0 08BA STS	config+15,R14
(0138) 			Set_White(1,2,8,1);
    030FD E081      LDI	R24,1
    030FE 838A      STD	Y+2,R24
    030FF E088      LDI	R24,0x8
    03100 8388      ST	Y,R24
    03101 E022      LDI	R18,2
    03102 E001      LDI	R16,1
    03103 940E 4028 CALL	_Set_White
(0139) 	 		Set_White(1,3,8,1); 
    03105 E081      LDI	R24,1
    03106 838A      STD	Y+2,R24
    03107 E088      LDI	R24,0x8
    03108 8388      ST	Y,R24
    03109 E023      LDI	R18,3
    0310A E001      LDI	R16,1
    0310B 940E 4028 CALL	_Set_White
(0140) 			break ;		
    0310D C00A      RJMP	0x3118
(0141) 		}
(0142) 		//右键短按  返回
(0143) 		if(key == right) {
    0310E 2D8C      MOV	R24,R12
    0310F 3187      CPI	R24,0x17
    03110 F409      BNE	0x3112
(0144) 			return ;		
    03111 C1F9      RJMP	0x330B
(0145) 		}
(0146) 		key=0;
    03112 24CC      CLR	R12
    03113 940E 0477 CALL	_alwaysCheck
    03115 2300      TST	R16
    03116 F009      BEQ	0x3118
    03117 CFAE      RJMP	0x30C6
(0147) 	} //end of while
(0148)     //自动开启检测
(0149) 	dateRefresh(0);
    03118 2700      CLR	R16
    03119 940E 3965 CALL	_dateRefresh
(0150) 	is_on =1 ;
    0311B 2400      CLR	R0
    0311C 9403      INC	R0
    0311D 8608      STD	Y+8,R0
(0151) 	config.time1=config.now+config.THRESHOLD_delta_sec;
    0311E 9040 08B0 LDS	R4,config+5
    03120 9050 08B1 LDS	R5,config+6
    03122 9020 08AE LDS	R2,config+3
    03124 9030 08AF LDS	R3,config+4
    03126 9080 08B8 LDS	R8,config+13
    03128 9090 08B9 LDS	R9,config+14
    0312A 9060 08B6 LDS	R6,config+11
    0312C 9070 08B7 LDS	R7,config+12
    0312E 0C62      ADD	R6,R2
    0312F 1C73      ADC	R7,R3
    03130 1C84      ADC	R8,R4
    03131 1C95      ADC	R9,R5
    03132 9270 08B3 STS	config+8,R7
    03134 9260 08B2 STS	config+7,R6
    03136 9290 08B5 STS	config+10,R9
    03138 9280 08B4 STS	config+9,R8
(0152) 	Result.TempChar[0]=0; //清除上次结果
    0313A 2422      CLR	R2
    0313B 9220 0666 STS	Result+45,R2
(0153) 	Result.WSChar[0]=0;
    0313D 9220 0670 STS	Result+55,R2
    0313F C1C5      RJMP	0x3305
(0154) 	while(alwaysCheck()){
(0155) 		key=kbscan();
    03140 940E 44FE CALL	_kbscan
    03142 2EA0      MOV	R10,R16
    03143 2CCA      MOV	R12,R10
(0156) 		dateRefresh(0); //只刷新后台时间
    03144 2700      CLR	R16
    03145 940E 3965 CALL	_dateRefresh
(0157) 		if(key != 0) beep(0,1);
    03147 20AA      TST	R10
    03148 F021      BEQ	0x314D
    03149 E021      LDI	R18,1
    0314A 2700      CLR	R16
    0314B 940E 4275 CALL	_beep
(0158) 		if(key==right){	//右键 退出
    0314D 2D8C      MOV	R24,R12
    0314E 3187      CPI	R24,0x17
    0314F F569      BNE	0x317D
(0159) 		    is_on=0;
    03150 2400      CLR	R0
    03151 8608      STD	Y+8,R0
(0160) 			LCD_CLR();
    03152 940E 3F9E CALL	_LCD_CLR
(0161) 		 	LCD_Init();	  
    03154 940E 3F6C CALL	_LCD_Init
(0162) 	 	 	LCD_const_disp(4,5,"退出    "); 
    03156 E68B      LDI	R24,0x6B
    03157 E095      LDI	R25,5
    03158 8399      STD	Y+1,R25
    03159 8388      ST	Y,R24
    0315A E025      LDI	R18,5
    0315B E004      LDI	R16,4
    0315C 940E 3EF8 CALL	_LCD_const_disp
(0163) 		 	delayms(200);
    0315E EC08      LDI	R16,0xC8
    0315F E010      LDI	R17,0
    03160 940E 2D55 CALL	_delayms
(0164) 		 	LCD_const_disp(4,7,".."); 
    03162 E688      LDI	R24,0x68
    03163 E095      LDI	R25,5
    03164 8399      STD	Y+1,R25
    03165 8388      ST	Y,R24
    03166 E027      LDI	R18,7
    03167 E004      LDI	R16,4
    03168 940E 3EF8 CALL	_LCD_const_disp
(0165) 		 	delayms(200);
    0316A EC08      LDI	R16,0xC8
    0316B E010      LDI	R17,0
    0316C 940E 2D55 CALL	_delayms
(0166) 		 	LCD_const_disp(4,8,".."); 	
    0316E E688      LDI	R24,0x68
    0316F E095      LDI	R25,5
    03170 8399      STD	Y+1,R25
    03171 8388      ST	Y,R24
    03172 E028      LDI	R18,0x8
    03173 E004      LDI	R16,4
    03174 940E 3EF8 CALL	_LCD_const_disp
(0167) 		 	delayms(500);
    03176 EF04      LDI	R16,0xF4
    03177 E011      LDI	R17,1
    03178 940E 2D55 CALL	_delayms
(0168) 		 	LCD_CLR();
    0317A 940E 3F9E CALL	_LCD_CLR
(0169) 		 	goto RE_IN;
    0317C CEFD      RJMP	0x307A
(0170) 		}
(0171) 		if(is_on==1){ 
    0317D 8588      LDD	R24,Y+8
    0317E 3081      CPI	R24,1
    0317F F009      BEQ	0x3181
    03180 C0A0      RJMP	0x3221
(0172) 			dateRefresh(1); //更新时间
    03181 E001      LDI	R16,1
    03182 D7E2      RCALL	_dateRefresh
(0173) 		    _GUI_datashow(page); 
    03183 810F      LDD	R16,Y+7
    03184 D189      RCALL	__GUI_datashow
(0174) 		    if(config.now < config.time1) {
    03185 9040 08B4 LDS	R4,config+9
    03187 9050 08B5 LDS	R5,config+10
    03189 9020 08B2 LDS	R2,config+7
    0318B 9030 08B3 LDS	R3,config+8
    0318D 9080 08B8 LDS	R8,config+13
    0318F 9090 08B9 LDS	R9,config+14
    03191 9060 08B6 LDS	R6,config+11
    03193 9070 08B7 LDS	R7,config+12
    03195 1462      CP	R6,R2
    03196 0473      CPC	R7,R3
    03197 0484      CPC	R8,R4
    03198 0495      CPC	R9,R5
    03199 F5A8      BCC	0x31CF
(0175) 				//时间更新 开启风速检测 等待检测 不支持翻页
(0176) 				if(windcounter==0){
    0319A 8409      LDD	R0,Y+9
    0319B 2000      TST	R0
    0319C F429      BNE	0x31A2
(0177) 				    windcounter=1; //清零开启风速计数器
    0319D 2400      CLR	R0
    0319E 9403      INC	R0
    0319F 8609      STD	Y+9,R0
(0178) 					timer1_init(); //开启风速传感器技术
    031A0 940E 040B CALL	_timer1_init
(0179) 				}
(0180) 				if(page == 0 ){
    031A2 800F      LDD	R0,Y+7
    031A3 2000      TST	R0
    031A4 F009      BEQ	0x31A6
    031A5 C15B      RJMP	0x3301
(0181) 				
(0182) 				    LCD_const_disp(4,1,"正在检测");
    031A6 E58F      LDI	R24,0x5F
    031A7 E095      LDI	R25,5
    031A8 8399      STD	Y+1,R25
    031A9 8388      ST	Y,R24
    031AA E021      LDI	R18,1
    031AB E004      LDI	R16,4
    031AC 940E 3EF8 CALL	_LCD_const_disp
(0183) 					LCD_print4num(4,5,config.time1-config.now);
    031AE 9020 08B6 LDS	R2,config+11
    031B0 9030 08B7 LDS	R3,config+12
    031B2 9040 08B2 LDS	R4,config+7
    031B4 9050 08B3 LDS	R5,config+8
    031B6 1842      SUB	R4,R2
    031B7 0853      SBC	R5,R3
    031B8 8259      STD	Y+1,R5
    031B9 8248      ST	Y,R4
    031BA E025      LDI	R18,5
    031BB E004      LDI	R16,4
    031BC 940E 41BA CALL	_LCD_print4num
(0184) 					LCD_const_disp(2,6,"      ");
    031BE E588      LDI	R24,0x58
    031BF E095      LDI	R25,5
    031C0 8399      STD	Y+1,R25
    031C1 8388      ST	Y,R24
    031C2 E026      LDI	R18,6
    031C3 E002      LDI	R16,2
    031C4 940E 3EF8 CALL	_LCD_const_disp
(0185) 					LCD_const_disp(3,6,"      ");
    031C6 E588      LDI	R24,0x58
    031C7 E095      LDI	R25,5
    031C8 8399      STD	Y+1,R25
    031C9 8388      ST	Y,R24
    031CA E026      LDI	R18,6
    031CB E003      LDI	R16,3
    031CC 940E 3EF8 CALL	_LCD_const_disp
(0186) 				}
(0187) 			} 
    031CE C132      RJMP	0x3301
(0188) 			else {
(0189) 			   //检测完成 获得数据 转换数据 存储数据 切换到非检测状态
(0190) 			    windcounter =0 ; //关闭风速传感器计数器
    031CF 2400      CLR	R0
    031D0 8609      STD	Y+9,R0
(0191) 				beep(1,1);
    031D1 E021      LDI	R18,1
    031D2 E001      LDI	R16,1
    031D3 940E 4275 CALL	_beep
(0192) 				LCD_const_disp(4,1,"--计算并存储--       ");
    031D5 E482      LDI	R24,0x42
    031D6 E095      LDI	R25,5
    031D7 8399      STD	Y+1,R25
    031D8 8388      ST	Y,R24
    031D9 E021      LDI	R18,1
    031DA E004      LDI	R16,4
    031DB 940E 3EF8 CALL	_LCD_const_disp
(0193) 				check();
    031DD 940E 08D8 CALL	_check
(0194) 				StructToChar(); //转成字符串
    031DF 940E 0A42 CALL	_StructToChar
(0195) 				WriteFileHead();//重写文件头
    031E1 940E 059C CALL	_WriteFileHead
(0196) 				WriteSDFile();  //写入sd卡
    031E3 940E 0603 CALL	_WriteSDFile
(0197) 				if(config.autoSend>=1) {
    031E5 9180 08BF LDS	R24,config+20
    031E7 3081      CPI	R24,1
    031E8 F010      BCS	0x31EB
(0198) 					 zigbee_send_date(); //zigbee发送
    031E9 940E 3C60 CALL	_zigbee_send_date
(0199) 				}
(0200) 				Result.Index++; //索引自增一
    031EB E041      LDI	R20,1
    031EC E050      LDI	R21,0
    031ED E060      LDI	R22,0
    031EE E070      LDI	R23,0
    031EF 9040 0645 LDS	R4,Result+12
    031F1 9050 0646 LDS	R5,Result+13
    031F3 9020 0643 LDS	R2,Result+10
    031F5 9030 0644 LDS	R3,Result+11
    031F7 0E24      ADD	R2,R20
    031F8 1E35      ADC	R3,R21
    031F9 1E46      ADC	R4,R22
    031FA 1E57      ADC	R5,R23
    031FB 9230 0644 STS	Result+11,R3
    031FD 9220 0643 STS	Result+10,R2
    031FF 9250 0646 STS	Result+13,R5
    03201 9240 0645 STS	Result+12,R4
(0201) 				is_on=0; //切换到非检测状态
    03203 2400      CLR	R0
    03204 8608      STD	Y+8,R0
(0202) 				next_step_time=config.now+config.checkDeltaTime;//自动翻页时间更新
    03205 9020 08BB LDS	R2,config+16
    03207 9030 08BC LDS	R3,config+17
    03209 2444      CLR	R4
    0320A FC37      SBRC	R3,7
    0320B 9440      COM	R4
    0320C 2455      CLR	R5
    0320D FC47      SBRC	R4,7
    0320E 9450      COM	R5
    0320F 9080 08B8 LDS	R8,config+13
    03211 9090 08B9 LDS	R9,config+14
    03213 9060 08B6 LDS	R6,config+11
    03215 9070 08B7 LDS	R7,config+12
    03217 0C62      ADD	R6,R2
    03218 1C73      ADC	R7,R3
    03219 1C84      ADC	R8,R4
    0321A 1C95      ADC	R9,R5
    0321B 826B      STD	Y+3,R6
    0321C 827C      STD	Y+4,R7
    0321D 828D      STD	Y+5,R8
    0321E 829E      STD	Y+6,R9
(0203) 				page=0;
    0321F 820F      STD	Y+7,R0
(0204) 		   }
(0205) 		}
    03220 C0E0      RJMP	0x3301
(0206) 		else { //is_on == 0 非检测状态 手动翻页/自动翻页
(0207) 		    dateRefresh(0);//不更新时间
    03221 2700      CLR	R16
    03222 D742      RCALL	_dateRefresh
(0208) 			_GUI_datashow(page); 
    03223 810F      LDD	R16,Y+7
    03224 D0E9      RCALL	__GUI_datashow
(0209) 			if(page == 0 ){
    03225 800F      LDD	R0,Y+7
    03226 2000      TST	R0
    03227 F4E9      BNE	0x3245
(0210) 				
(0211) 				    LCD_const_disp(4,1,"完成检测        ");
    03228 E381      LDI	R24,0x31
    03229 E095      LDI	R25,5
    0322A 8399      STD	Y+1,R25
    0322B 8388      ST	Y,R24
    0322C E021      LDI	R18,1
    0322D E004      LDI	R16,4
    0322E 940E 3EF8 CALL	_LCD_const_disp
(0212) 					if(config.autocheck == 1){
    03230 9180 08BA LDS	R24,config+15
    03232 3081      CPI	R24,1
    03233 F449      BNE	0x323D
(0213) 					    LCD_const_disp(4,7,"自动");
    03234 E789      LDI	R24,0x79
    03235 E095      LDI	R25,5
    03236 8399      STD	Y+1,R25
    03237 8388      ST	Y,R24
    03238 E027      LDI	R18,7
    03239 E004      LDI	R16,4
    0323A 940E 3EF8 CALL	_LCD_const_disp
(0214) 					}
    0323C C008      RJMP	0x3245
(0215) 					else {
(0216) 					    LCD_const_disp(4,7,"手动");
    0323D E784      LDI	R24,0x74
    0323E E095      LDI	R25,5
    0323F 8399      STD	Y+1,R25
    03240 8388      ST	Y,R24
    03241 E027      LDI	R18,7
    03242 E004      LDI	R16,4
    03243 940E 3EF8 CALL	_LCD_const_disp
(0217) 					}
(0218) 					
(0219) 				}
(0220) 						//手动翻页 
(0221) 			if(key==up){ //上键 : 页面减 
    03245 2D8C      MOV	R24,R12
    03246 318E      CPI	R24,0x1E
    03247 F539      BNE	0x326F
(0222) 		        if(page>0) page--;
    03248 E080      LDI	R24,0
    03249 800F      LDD	R0,Y+7
    0324A 1580      CP	R24,R0
    0324B F418      BCC	0x324F
    0324C 940A      DEC	R0
    0324D 820F      STD	Y+7,R0
    0324E C01C      RJMP	0x326B
(0223) 				else{
(0224) 				page =5;
    0324F E085      LDI	R24,5
    03250 838F      STD	Y+7,R24
(0225) 				next_step_time = config.now + config.checkDeltaTime;
    03251 9020 08BB LDS	R2,config+16
    03253 9030 08BC LDS	R3,config+17
    03255 2444      CLR	R4
    03256 FC37      SBRC	R3,7
    03257 9440      COM	R4
    03258 2455      CLR	R5
    03259 FC47      SBRC	R4,7
    0325A 9450      COM	R5
    0325B 9080 08B8 LDS	R8,config+13
    0325D 9090 08B9 LDS	R9,config+14
    0325F 9060 08B6 LDS	R6,config+11
    03261 9070 08B7 LDS	R7,config+12
    03263 0C62      ADD	R6,R2
    03264 1C73      ADC	R7,R3
    03265 1C84      ADC	R8,R4
    03266 1C95      ADC	R9,R5
    03267 826B      STD	Y+3,R6
    03268 827C      STD	Y+4,R7
    03269 828D      STD	Y+5,R8
    0326A 829E      STD	Y+6,R9
(0226) 				}
(0227) 		    	LCD_CLR();
    0326B 940E 3F9E CALL	_LCD_CLR
(0228) 		    	LCD_Init();
    0326D 940E 3F6C CALL	_LCD_Init
(0229) 			}
(0230) 			if(key==down){//下键 ： 页面加
    0326F 2D8C      MOV	R24,R12
    03270 318D      CPI	R24,0x1D
    03271 F539      BNE	0x3299
(0231) 		        page++;
    03272 800F      LDD	R0,Y+7
    03273 9403      INC	R0
    03274 820F      STD	Y+7,R0
(0232) 				next_step_time = config.now + config.checkDeltaTime;
    03275 9020 08BB LDS	R2,config+16
    03277 9030 08BC LDS	R3,config+17
    03279 2444      CLR	R4
    0327A FC37      SBRC	R3,7
    0327B 9440      COM	R4
    0327C 2455      CLR	R5
    0327D FC47      SBRC	R4,7
    0327E 9450      COM	R5
    0327F 9080 08B8 LDS	R8,config+13
    03281 9090 08B9 LDS	R9,config+14
    03283 9060 08B6 LDS	R6,config+11
    03285 9070 08B7 LDS	R7,config+12
    03287 0C62      ADD	R6,R2
    03288 1C73      ADC	R7,R3
    03289 1C84      ADC	R8,R4
    0328A 1C95      ADC	R9,R5
    0328B 826B      STD	Y+3,R6
    0328C 827C      STD	Y+4,R7
    0328D 828D      STD	Y+5,R8
    0328E 829E      STD	Y+6,R9
(0233) 		  		LCD_CLR();
    0328F 940E 3F9E CALL	_LCD_CLR
(0234) 		    	LCD_Init();
    03291 940E 3F6C CALL	_LCD_Init
(0235) 				if(page >= 6 ) {
    03293 818F      LDD	R24,Y+7
    03294 3086      CPI	R24,6
    03295 F018      BCS	0x3299
(0236) 					page=0;
    03296 2400      CLR	R0
    03297 820F      STD	Y+7,R0
(0237) 					continue ;
    03298 C06C      RJMP	0x3305
(0238) 				}
(0239) 			} 	
(0240) 			//LCD_print2num(4,1,page);
(0241) 			//LCD_print4num(4,3,config.now);
(0242) 			//LCD_print4num(4,6,next_step_time);
(0243) 			if( config.autocheck == 1 ){  //如果开启自动翻页
    03299 9180 08BA LDS	R24,config+15
    0329B 3081      CPI	R24,1
    0329C F5A1      BNE	0x32D1
(0244) 			      if(config.now >= next_step_time || page >=6 )	{
    0329D 802B      LDD	R2,Y+3
    0329E 803C      LDD	R3,Y+4
    0329F 804D      LDD	R4,Y+5
    032A0 805E      LDD	R5,Y+6
    032A1 9080 08B8 LDS	R8,config+13
    032A3 9090 08B9 LDS	R9,config+14
    032A5 9060 08B6 LDS	R6,config+11
    032A7 9070 08B7 LDS	R7,config+12
    032A9 1462      CP	R6,R2
    032AA 0473      CPC	R7,R3
    032AB 0484      CPC	R8,R4
    032AC 0495      CPC	R9,R5
    032AD F418      BCC	0x32B1
    032AE 818F      LDD	R24,Y+7
    032AF 3086      CPI	R24,6
    032B0 F100      BCS	0x32D1
(0245) 				      next_step_time = config.now + config.checkDeltaTime;
    032B1 9020 08BB LDS	R2,config+16
    032B3 9030 08BC LDS	R3,config+17
    032B5 2444      CLR	R4
    032B6 FC37      SBRC	R3,7
    032B7 9440      COM	R4
    032B8 2455      CLR	R5
    032B9 FC47      SBRC	R4,7
    032BA 9450      COM	R5
    032BB 9080 08B8 LDS	R8,config+13
    032BD 9090 08B9 LDS	R9,config+14
    032BF 9060 08B6 LDS	R6,config+11
    032C1 9070 08B7 LDS	R7,config+12
    032C3 0C62      ADD	R6,R2
    032C4 1C73      ADC	R7,R3
    032C5 1C84      ADC	R8,R4
    032C6 1C95      ADC	R9,R5
    032C7 826B      STD	Y+3,R6
    032C8 827C      STD	Y+4,R7
    032C9 828D      STD	Y+5,R8
    032CA 829E      STD	Y+6,R9
(0246) 					  page++;
    032CB 800F      LDD	R0,Y+7
    032CC 9403      INC	R0
    032CD 820F      STD	Y+7,R0
(0247) 					  LCD_CLR(); 
    032CE 940E 3F9E CALL	_LCD_CLR
(0248) 					  key=0;
    032D0 24CC      CLR	R12
(0249) 				  }  
(0250) 			}
(0251) 			if( page>=6 || key == left){
    032D1 818F      LDD	R24,Y+7
    032D2 3086      CPI	R24,6
    032D3 F418      BCC	0x32D7
    032D4 2D8C      MOV	R24,R12
    032D5 318B      CPI	R24,0x1B
    032D6 F551      BNE	0x3301
(0252) 					      //翻到最后页，页面清零开启下次检测
(0253) 					      page = 0;
    032D7 2400      CLR	R0
    032D8 820F      STD	Y+7,R0
(0254) 						  dateRefresh(1); //刷新时间
    032D9 E001      LDI	R16,1
    032DA D68A      RCALL	_dateRefresh
(0255) 						  is_on =1 ; //开启检测
    032DB 2400      CLR	R0
    032DC 9403      INC	R0
    032DD 8608      STD	Y+8,R0
(0256) 						  config.time1=config.now+config.THRESHOLD_delta_sec; //更新下次检测时间
    032DE 9040 08B0 LDS	R4,config+5
    032E0 9050 08B1 LDS	R5,config+6
    032E2 9020 08AE LDS	R2,config+3
    032E4 9030 08AF LDS	R3,config+4
    032E6 9080 08B8 LDS	R8,config+13
    032E8 9090 08B9 LDS	R9,config+14
    032EA 9060 08B6 LDS	R6,config+11
    032EC 9070 08B7 LDS	R7,config+12
    032EE 0C62      ADD	R6,R2
    032EF 1C73      ADC	R7,R3
    032F0 1C84      ADC	R8,R4
    032F1 1C95      ADC	R9,R5
    032F2 9270 08B3 STS	config+8,R7
    032F4 9260 08B2 STS	config+7,R6
    032F6 9290 08B5 STS	config+10,R9
    032F8 9280 08B4 STS	config+9,R8
(0257) 						  Result.TempChar[0]=0; //清除上次结果
    032FA 2422      CLR	R2
    032FB 9220 0666 STS	Result+45,R2
(0258) 						  Result.WSChar[0]=0;
    032FD 9220 0670 STS	Result+55,R2
(0259) 					   	  LCD_CLR();  
    032FF 940E 3F9E CALL	_LCD_CLR
(0260) 					  }
(0261) 				         
(0262) 				
(0263) 
(0264) 		} 
(0265) 		
(0266) 	    delayms(10); 
    03301 E00A      LDI	R16,0xA
    03302 E010      LDI	R17,0
    03303 940E 2D55 CALL	_delayms
    03305 940E 0477 CALL	_alwaysCheck
    03307 2EC0      MOV	R12,R16
    03308 2300      TST	R16
    03309 F009      BEQ	0x330B
    0330A CE35      RJMP	0x3140
    0330B 962A      ADIW	R28,0xA
    0330C 940C 4B12 JMP	pop_xgsetF0FC
__GUI_datashow:
  page                 --> R20
    0330E 940E 4B3C CALL	push_xgsetF00C
    03310 2F40      MOV	R20,R16
    03311 9722      SBIW	R28,2
(0267) 	}//end while
(0268) }//end function
(0269) void _GUI_datashow(char page){
(0270) 	if(page == 0){
    03312 2344      TST	R20
    03313 F539      BNE	0x333B
(0271)  	//显示日期时间
(0272) 	    LCD_var_disp(1,1,GUI_get_date());
    03314 D205      RCALL	_GUI_get_date
    03315 8319      STD	Y+1,R17
    03316 8308      ST	Y,R16
    03317 E021      LDI	R18,1
    03318 E001      LDI	R16,1
    03319 940E 3F25 CALL	_LCD_var_disp
(0273) 	//显示温度
(0274) 	 	LCD_const_disp(2,1,"温度 (℃):      ");
    0331B E280      LDI	R24,0x20
    0331C E095      LDI	R25,5
    0331D 8399      STD	Y+1,R25
    0331E 8388      ST	Y,R24
    0331F E021      LDI	R18,1
    03320 E002      LDI	R16,2
    03321 940E 3EF8 CALL	_LCD_const_disp
(0275) 	 	LCD_var_disp(2,6,Result.TempChar);
    03323 E686      LDI	R24,0x66
    03324 E096      LDI	R25,6
    03325 8399      STD	Y+1,R25
    03326 8388      ST	Y,R24
    03327 E026      LDI	R18,6
    03328 E002      LDI	R16,2
    03329 940E 3F25 CALL	_LCD_var_disp
(0276) 	//显示风速
(0277) 	    LCD_const_disp(3,1,"风速(m/s):      ");
    0332B E08F      LDI	R24,0xF
    0332C E095      LDI	R25,5
    0332D 8399      STD	Y+1,R25
    0332E 8388      ST	Y,R24
    0332F E021      LDI	R18,1
    03330 E003      LDI	R16,3
    03331 940E 3EF8 CALL	_LCD_const_disp
(0278) 	 	LCD_const_disp(3,6,Result.WSChar);
    03333 E780      LDI	R24,0x70
    03334 E096      LDI	R25,6
    03335 8399      STD	Y+1,R25
    03336 8388      ST	Y,R24
    03337 E026      LDI	R18,6
    03338 E003      LDI	R16,3
    03339 940E 3EF8 CALL	_LCD_const_disp
(0279) 
(0280) 	 } 
(0281) 	 if(page == 1){
    0333B 3041      CPI	R20,1
    0333C F5B9      BNE	0x3374
(0282) 	     LCD_var_disp(1,1,GUI_get_date());
    0333D D1DC      RCALL	_GUI_get_date
    0333E 8319      STD	Y+1,R17
    0333F 8308      ST	Y,R16
    03340 E021      LDI	R18,1
    03341 E001      LDI	R16,1
    03342 940E 3F25 CALL	_LCD_var_disp
(0283) 		 LCD_const_disp(2,1,"风冷指数: ");
    03344 E084      LDI	R24,4
    03345 E095      LDI	R25,5
    03346 8399      STD	Y+1,R25
    03347 8388      ST	Y,R24
    03348 E021      LDI	R18,1
    03349 E002      LDI	R16,2
    0334A 940E 3EF8 CALL	_LCD_const_disp
(0284) 		 LCD_var_disp(2,6,Result.WCIChar);						
    0334C E789      LDI	R24,0x79
    0334D E096      LDI	R25,6
    0334E 8399      STD	Y+1,R25
    0334F 8388      ST	Y,R24
    03350 E026      LDI	R18,6
    03351 E002      LDI	R16,2
    03352 940E 3F25 CALL	_LCD_var_disp
(0285) 		 LCD_const_disp(3,1,"等价温度: ");
    03354 EF89      LDI	R24,0xF9
    03355 E094      LDI	R25,4
    03356 8399      STD	Y+1,R25
    03357 8388      ST	Y,R24
    03358 E021      LDI	R18,1
    03359 E003      LDI	R16,3
    0335A 940E 3EF8 CALL	_LCD_const_disp
(0286) 		 LCD_var_disp(3,6,Result.ECTChar);	 
    0335C E885      LDI	R24,0x85
    0335D E096      LDI	R25,6
    0335E 8399      STD	Y+1,R25
    0335F 8388      ST	Y,R24
    03360 E026      LDI	R18,6
    03361 E003      LDI	R16,3
    03362 940E 3F25 CALL	_LCD_var_disp
(0287) 		 LCD_const_disp(4,1,"相当温度: ");
    03364 EE8E      LDI	R24,0xEE
    03365 E094      LDI	R25,4
    03366 8399      STD	Y+1,R25
    03367 8388      ST	Y,R24
    03368 E021      LDI	R18,1
    03369 E004      LDI	R16,4
    0336A 940E 3EF8 CALL	_LCD_const_disp
(0288) 		 LCD_var_disp(4,6,Result.TeqChar);	
    0336C E88F      LDI	R24,0x8F
    0336D E096      LDI	R25,6
    0336E 8399      STD	Y+1,R25
    0336F 8388      ST	Y,R24
    03370 E026      LDI	R18,6
    03371 E004      LDI	R16,4
    03372 940E 3F25 CALL	_LCD_var_disp
(0289) 	 }
(0290) 	 if(page == 2){
    03374 3042      CPI	R20,2
    03375 F009      BEQ	0x3377
    03376 C03F      RJMP	0x33B6
(0291) 	     LCD_var_disp(1,1,GUI_get_date());
    03377 D1A2      RCALL	_GUI_get_date
    03378 0158      MOVW	R10,R16
    03379 82B9      STD	Y+1,R11
    0337A 82A8      ST	Y,R10
    0337B E021      LDI	R18,1
    0337C E001      LDI	R16,1
    0337D 940E 3F25 CALL	_LCD_var_disp
(0292) 		 LCD_const_disp(2,1,"冻伤危害性:");
    0337F EE82      LDI	R24,0xE2
    03380 E094      LDI	R25,4
    03381 8399      STD	Y+1,R25
    03382 8388      ST	Y,R24
    03383 E021      LDI	R18,1
    03384 E002      LDI	R16,2
    03385 940E 3EF8 CALL	_LCD_const_disp
(0293) 	 if(Result.WeiHai==0){LCD_const_disp(3,1,"  冻伤危害性小");			 }
    03387 9020 0695 LDS	R2,Result+92
    03389 2022      TST	R2
    0338A F449      BNE	0x3394
    0338B ED83      LDI	R24,0xD3
    0338C E094      LDI	R25,4
    0338D 8399      STD	Y+1,R25
    0338E 8388      ST	Y,R24
    0338F E021      LDI	R18,1
    03390 E003      LDI	R16,3
    03391 940E 3EF8 CALL	_LCD_const_disp
    03393 C022      RJMP	0x33B6
(0294) 	 else if(Result.WeiHai==1){	LCD_const_disp(3,1,"  冻伤危害性较大");	 }
    03394 9180 0695 LDS	R24,Result+92
    03396 3081      CPI	R24,1
    03397 F449      BNE	0x33A1
    03398 EC82      LDI	R24,0xC2
    03399 E094      LDI	R25,4
    0339A 8399      STD	Y+1,R25
    0339B 8388      ST	Y,R24
    0339C E021      LDI	R18,1
    0339D E003      LDI	R16,3
    0339E 940E 3EF8 CALL	_LCD_const_disp
    033A0 C015      RJMP	0x33B6
(0295) 	 else if(Result.WeiHai==2){	LCD_const_disp(3,1,"  冻伤危害性很大");	 }
    033A1 9180 0695 LDS	R24,Result+92
    033A3 3082      CPI	R24,2
    033A4 F449      BNE	0x33AE
    033A5 EB81      LDI	R24,0xB1
    033A6 E094      LDI	R25,4
    033A7 8399      STD	Y+1,R25
    033A8 8388      ST	Y,R24
    033A9 E021      LDI	R18,1
    033AA E003      LDI	R16,3
    033AB 940E 3EF8 CALL	_LCD_const_disp
    033AD C008      RJMP	0x33B6
(0296) 	 else LCD_const_disp(3,1,"冻伤危害性小。");
    033AE EA82      LDI	R24,0xA2
    033AF E094      LDI	R25,4
    033B0 8399      STD	Y+1,R25
    033B1 8388      ST	Y,R24
    033B2 E021      LDI	R18,1
    033B3 E003      LDI	R16,3
    033B4 940E 3EF8 CALL	_LCD_const_disp
(0297) 	 }	  
(0298) 	 if(page==3){
    033B6 3043      CPI	R20,3
    033B7 F009      BEQ	0x33B9
    033B8 C061      RJMP	0x341A
(0299) 	     LCD_const_disp(1,1,labelH);		
    033B9 E98E      LDI	R24,0x9E
    033BA E092      LDI	R25,2
    033BB 8399      STD	Y+1,R25
    033BC 8388      ST	Y,R24
    033BD E021      LDI	R18,1
    033BE E001      LDI	R16,1
    033BF 940E 3EF8 CALL	_LCD_const_disp
(0300) 	 	 switch( Result.WeiHai ){
    033C1 9160 0695 LDS	R22,Result+92
    033C3 2777      CLR	R23
    033C4 3060      CPI	R22,0
    033C5 0767      CPC	R22,R23
    033C6 F049      BEQ	0x33D0
    033C7 3061      CPI	R22,1
    033C8 E0E0      LDI	R30,0
    033C9 077E      CPC	R23,R30
    033CA F0F1      BEQ	0x33E9
    033CB 3062      CPI	R22,2
    033CC E0E0      LDI	R30,0
    033CD 077E      CPC	R23,R30
    033CE F199      BEQ	0x3402
    033CF C04A      RJMP	0x341A
(0301) 			case 0 :
(0302) 			LCD_const_disp(2,1,H01);
    033D0 EC8A      LDI	R24,0xCA
    033D1 E092      LDI	R25,2
    033D2 8399      STD	Y+1,R25
    033D3 8388      ST	Y,R24
    033D4 E021      LDI	R18,1
    033D5 E002      LDI	R16,2
    033D6 940E 3EF8 CALL	_LCD_const_disp
(0303) 			LCD_const_disp(3,1,H02);
    033D8 ED8A      LDI	R24,0xDA
    033D9 E092      LDI	R25,2
    033DA 8399      STD	Y+1,R25
    033DB 8388      ST	Y,R24
    033DC E021      LDI	R18,1
    033DD E003      LDI	R16,3
    033DE 940E 3EF8 CALL	_LCD_const_disp
(0304) 			LCD_const_disp(4,1,H03);
    033E0 EE85      LDI	R24,0xE5
    033E1 E092      LDI	R25,2
    033E2 8399      STD	Y+1,R25
    033E3 8388      ST	Y,R24
    033E4 E021      LDI	R18,1
    033E5 E004      LDI	R16,4
    033E6 940E 3EF8 CALL	_LCD_const_disp
(0305) 			break;
    033E8 C031      RJMP	0x341A
(0306) 			case 1 : 
(0307) 			LCD_const_disp(2,1,H11);
    033E9 E081      LDI	R24,1
    033EA E093      LDI	R25,3
    033EB 8399      STD	Y+1,R25
    033EC 8388      ST	Y,R24
    033ED E021      LDI	R18,1
    033EE E002      LDI	R16,2
    033EF 940E 3EF8 CALL	_LCD_const_disp
(0308) 			LCD_const_disp(3,1,H12);
    033F1 EE85      LDI	R24,0xE5
    033F2 E092      LDI	R25,2
    033F3 8399      STD	Y+1,R25
    033F4 8388      ST	Y,R24
    033F5 E021      LDI	R18,1
    033F6 E003      LDI	R16,3
    033F7 940E 3EF8 CALL	_LCD_const_disp
(0309) 			LCD_const_disp(4,1,H13);
    033F9 E18A      LDI	R24,0x1A
    033FA E093      LDI	R25,3
    033FB 8399      STD	Y+1,R25
    033FC 8388      ST	Y,R24
    033FD E021      LDI	R18,1
    033FE E004      LDI	R16,4
    033FF 940E 3EF8 CALL	_LCD_const_disp
(0310) 			break ;	
    03401 C018      RJMP	0x341A
(0311) 			case 2 :
(0312) 			LCD_const_disp(2,1,H21);
    03402 E48E      LDI	R24,0x4E
    03403 E093      LDI	R25,3
    03404 8399      STD	Y+1,R25
    03405 8388      ST	Y,R24
    03406 E021      LDI	R18,1
    03407 E002      LDI	R16,2
    03408 940E 3EF8 CALL	_LCD_const_disp
(0313) 			LCD_const_disp(3,1,H22);
    0340A E680      LDI	R24,0x60
    0340B E093      LDI	R25,3
    0340C 8399      STD	Y+1,R25
    0340D 8388      ST	Y,R24
    0340E E021      LDI	R18,1
    0340F E003      LDI	R16,3
    03410 940E 3EF8 CALL	_LCD_const_disp
(0314) 			LCD_const_disp(4,1,H23);
    03412 EE85      LDI	R24,0xE5
    03413 E092      LDI	R25,2
    03414 8399      STD	Y+1,R25
    03415 8388      ST	Y,R24
    03416 E021      LDI	R18,1
    03417 E004      LDI	R16,4
    03418 940E 3EF8 CALL	_LCD_const_disp
(0315) 			break;
(0316) 			default : ;
(0317) 		}
(0318) 	 } 
(0319) 	 if(page==4){
    0341A 3044      CPI	R20,4
    0341B F009      BEQ	0x341D
    0341C C086      RJMP	0x34A3
(0320) 	 		LCD_const_disp(1,1,labelM);		
    0341D EA8C      LDI	R24,0xAC
    0341E E092      LDI	R25,2
    0341F 8399      STD	Y+1,R25
    03420 8388      ST	Y,R24
    03421 E021      LDI	R18,1
    03422 E001      LDI	R16,1
    03423 940E 3EF8 CALL	_LCD_const_disp
(0321) 	 		switch( Result.WeiHai ){
    03425 9160 0695 LDS	R22,Result+92
    03427 2777      CLR	R23
    03428 3060      CPI	R22,0
    03429 0767      CPC	R22,R23
    0342A F059      BEQ	0x3436
    0342B 3061      CPI	R22,1
    0342C E0E0      LDI	R30,0
    0342D 077E      CPC	R23,R30
    0342E F409      BNE	0x3430
    0342F C052      RJMP	0x3482
    03430 3062      CPI	R22,2
    03431 E0E0      LDI	R30,0
    03432 077E      CPC	R23,R30
    03433 F409      BNE	0x3435
    03434 C066      RJMP	0x349B
    03435 C06D      RJMP	0x34A3
(0322) 	 			case 0 :
(0323) 				LCD_const_disp(2,1,M01);
    03436 EC8A      LDI	R24,0xCA
    03437 E092      LDI	R25,2
    03438 8399      STD	Y+1,R25
    03439 8388      ST	Y,R24
    0343A E021      LDI	R18,1
    0343B E002      LDI	R16,2
    0343C 940E 3EF8 CALL	_LCD_const_disp
(0324) 				LCD_const_disp(3,1,M02);
    0343E EE85      LDI	R24,0xE5
    0343F E092      LDI	R25,2
    03440 8399      STD	Y+1,R25
    03441 8388      ST	Y,R24
    03442 E021      LDI	R18,1
    03443 E003      LDI	R16,3
    03444 940E 3EF8 CALL	_LCD_const_disp
(0325) 				if(Result.Temperature < -17.7){
    03446 9040 0664 LDS	R4,Result+43
    03448 9050 0665 LDS	R5,Result+44
    0344A 9020 0662 LDS	R2,Result+41
    0344C 9030 0663 LDS	R3,Result+42
    0344E EE00      LDI	R16,0xE0
    0344F E010      LDI	R17,0
    03450 940E 4AA5 CALL	elpm32
    03452 933A      ST	-Y,R19
    03453 932A      ST	-Y,R18
    03454 931A      ST	-Y,R17
    03455 930A      ST	-Y,R16
    03456 0181      MOVW	R16,R2
    03457 0192      MOVW	R18,R4
    03458 940E 4E9D CALL	fpcmp2
    0345A F44C      BGE	0x3464
(0326) 				    LCD_const_disp(4,1,"戴面罩；禁油彩。");
    0345B E981      LDI	R24,0x91
    0345C E094      LDI	R25,4
    0345D 8399      STD	Y+1,R25
    0345E 8388      ST	Y,R24
    0345F E021      LDI	R18,1
    03460 E004      LDI	R16,4
    03461 940E 3EF8 CALL	_LCD_const_disp
(0327) 				}
    03463 C03F      RJMP	0x34A3
(0328) 				else if(Result.Temperature < -12){
    03464 9040 0664 LDS	R4,Result+43
    03466 9050 0665 LDS	R5,Result+44
    03468 9020 0662 LDS	R2,Result+41
    0346A 9030 0663 LDS	R3,Result+42
    0346C ED0C      LDI	R16,0xDC
    0346D E010      LDI	R17,0
    0346E 940E 4AA5 CALL	elpm32
    03470 933A      ST	-Y,R19
    03471 932A      ST	-Y,R18
    03472 931A      ST	-Y,R17
    03473 930A      ST	-Y,R16
    03474 0181      MOVW	R16,R2
    03475 0192      MOVW	R18,R4
    03476 940E 4E9D CALL	fpcmp2
    03478 F554      BGE	0x34A3
(0329) 				    LCD_const_disp(4,1,"禁油彩。        \0");
    03479 E78F      LDI	R24,0x7F
    0347A E094      LDI	R25,4
    0347B 8399      STD	Y+1,R25
    0347C 8388      ST	Y,R24
    0347D E021      LDI	R18,1
    0347E E004      LDI	R16,4
    0347F 940E 3EF8 CALL	_LCD_const_disp
(0330) 				}
(0331) 				break;
    03481 C021      RJMP	0x34A3
(0332) 				case 1 : 
(0333) 			    LCD_const_disp(2,1,M11);
    03482 EC8A      LDI	R24,0xCA
    03483 E092      LDI	R25,2
    03484 8399      STD	Y+1,R25
    03485 8388      ST	Y,R24
    03486 E021      LDI	R18,1
    03487 E002      LDI	R16,2
    03488 940E 3EF8 CALL	_LCD_const_disp
(0334) 				LCD_const_disp(3,1,M12);
    0348A E28A      LDI	R24,0x2A
    0348B E093      LDI	R25,3
    0348C 8399      STD	Y+1,R25
    0348D 8388      ST	Y,R24
    0348E E021      LDI	R18,1
    0348F E003      LDI	R16,3
    03490 940E 3EF8 CALL	_LCD_const_disp
(0335) 				LCD_const_disp(4,1,M13);
    03492 E38C      LDI	R24,0x3C
    03493 E093      LDI	R25,3
    03494 8399      STD	Y+1,R25
    03495 8388      ST	Y,R24
    03496 E021      LDI	R18,1
    03497 E004      LDI	R16,4
    03498 940E 3EF8 CALL	_LCD_const_disp
(0336) 				break ;
    0349A C008      RJMP	0x34A3
(0337) 				case 2 :
(0338) 				LCD_const_disp(2,1,M21);
    0349B E782      LDI	R24,0x72
    0349C E093      LDI	R25,3
    0349D 8399      STD	Y+1,R25
    0349E 8388      ST	Y,R24
    0349F E021      LDI	R18,1
    034A0 E002      LDI	R16,2
    034A1 940E 3EF8 CALL	_LCD_const_disp
(0339) 				break ;
(0340) 				default :;
(0341) 	 		}
(0342) 	 }
(0343) 	 if(page==5){
    034A3 3045      CPI	R20,5
    034A4 F009      BEQ	0x34A6
    034A5 C071      RJMP	0x3517
(0344) 	     LCD_const_disp(1,1,labelL);		
    034A6 EB8C      LDI	R24,0xBC
    034A7 E092      LDI	R25,2
    034A8 8399      STD	Y+1,R25
    034A9 8388      ST	Y,R24
    034AA E021      LDI	R18,1
    034AB E001      LDI	R16,1
    034AC 940E 3EF8 CALL	_LCD_const_disp
(0345) 	 	 switch( Result.WeiHai ){	
    034AE 9140 0695 LDS	R20,Result+92
    034B0 2755      CLR	R21
    034B1 3040      CPI	R20,0
    034B2 0745      CPC	R20,R21
    034B3 F059      BEQ	0x34BF
    034B4 3041      CPI	R20,1
    034B5 E0E0      LDI	R30,0
    034B6 075E      CPC	R21,R30
    034B7 F409      BNE	0x34B9
    034B8 C03D      RJMP	0x34F6
    034B9 3042      CPI	R20,2
    034BA E0E0      LDI	R30,0
    034BB 075E      CPC	R21,R30
    034BC F409      BNE	0x34BE
    034BD C051      RJMP	0x350F
    034BE C058      RJMP	0x3517
(0346) 		     case 0 :
(0347) 			 LCD_const_disp(2,1,L01);
    034BF EF87      LDI	R24,0xF7
    034C0 E092      LDI	R25,2
    034C1 8399      STD	Y+1,R25
    034C2 8388      ST	Y,R24
    034C3 E021      LDI	R18,1
    034C4 E002      LDI	R16,2
    034C5 940E 3EF8 CALL	_LCD_const_disp
(0348) 			 if(Result.Temperature < -12) {
    034C7 9040 0664 LDS	R4,Result+43
    034C9 9050 0665 LDS	R5,Result+44
    034CB 9020 0662 LDS	R2,Result+41
    034CD 9030 0663 LDS	R3,Result+42
    034CF ED0C      LDI	R16,0xDC
    034D0 E010      LDI	R17,0
    034D1 940E 4AA5 CALL	elpm32
    034D3 933A      ST	-Y,R19
    034D4 932A      ST	-Y,R18
    034D5 931A      ST	-Y,R17
    034D6 930A      ST	-Y,R16
    034D7 0181      MOVW	R16,R2
    034D8 0192      MOVW	R18,R4
    034D9 940E 4E9D CALL	fpcmp2
    034DB F48C      BGE	0x34ED
(0349) 			 LCD_const_disp(3,1,L02);
    034DC E081      LDI	R24,1
    034DD E093      LDI	R25,3
    034DE 8399      STD	Y+1,R25
    034DF 8388      ST	Y,R24
    034E0 E021      LDI	R18,1
    034E1 E003      LDI	R16,3
    034E2 940E 3EF8 CALL	_LCD_const_disp
(0350) 			 LCD_const_disp(4,1,L03);
    034E4 E08B      LDI	R24,0xB
    034E5 E093      LDI	R25,3
    034E6 8399      STD	Y+1,R25
    034E7 8388      ST	Y,R24
    034E8 E021      LDI	R18,1
    034E9 E004      LDI	R16,4
    034EA 940E 3EF8 CALL	_LCD_const_disp
(0351) 			 } 
    034EC C02A      RJMP	0x3517
(0352) 			 else {
(0353) 			 LCD_const_disp(3,1,L03);
    034ED E08B      LDI	R24,0xB
    034EE E093      LDI	R25,3
    034EF 8399      STD	Y+1,R25
    034F0 8388      ST	Y,R24
    034F1 E021      LDI	R18,1
    034F2 E003      LDI	R16,3
    034F3 940E 3EF8 CALL	_LCD_const_disp
(0354) 			 }
(0355) 			 break;
    034F5 C021      RJMP	0x3517
(0356) 			 case 1: 
(0357) 			 LCD_const_disp(2,1,L11);
    034F6 E48E      LDI	R24,0x4E
    034F7 E093      LDI	R25,3
    034F8 8399      STD	Y+1,R25
    034F9 8388      ST	Y,R24
    034FA E021      LDI	R18,1
    034FB E002      LDI	R16,2
    034FC 940E 3EF8 CALL	_LCD_const_disp
(0358) 			 LCD_const_disp(3,1,L12);
    034FE E680      LDI	R24,0x60
    034FF E093      LDI	R25,3
    03500 8399      STD	Y+1,R25
    03501 8388      ST	Y,R24
    03502 E021      LDI	R18,1
    03503 E003      LDI	R16,3
    03504 940E 3EF8 CALL	_LCD_const_disp
(0359) 			 LCD_const_disp(3,1,L13);
    03506 EE85      LDI	R24,0xE5
    03507 E092      LDI	R25,2
    03508 8399      STD	Y+1,R25
    03509 8388      ST	Y,R24
    0350A E021      LDI	R18,1
    0350B E003      LDI	R16,3
    0350C 940E 3EF8 CALL	_LCD_const_disp
(0360) 			 break ;
    0350E C008      RJMP	0x3517
(0361) 			 case 2 :
(0362) 			 LCD_const_disp(2,1,L21);
    0350F E782      LDI	R24,0x72
    03510 E093      LDI	R25,3
    03511 8399      STD	Y+1,R25
    03512 8388      ST	Y,R24
    03513 E021      LDI	R18,1
    03514 E002      LDI	R16,2
    03515 940E 3EF8 CALL	_LCD_const_disp
(0363) 			 break;
(0364) 			 default : ;
(0365) 		} //end switch
(0366) 	}  //end if
    03517 9622      ADIW	R28,2
    03518 940C 4B43 JMP	pop_xgsetF00C
(0367) }
(0368) char * GUI_get_date(void) {  
(0369)   //格式:12月11日19:00:00
(0370)     GUI_date[0]=Result.Date[4]; 
_GUI_get_date:
    0351A 9020 0653 LDS	R2,Result+26
    0351C 9220 0392 STS	GUI_date,R2
(0371)     GUI_date[1]=Result.Date[5];
    0351E 9020 0654 LDS	R2,Result+27
    03520 9220 0393 STS	GUI_date+1,R2
(0372)     GUI_date[4]=Result.Date[6];
    03522 9020 0655 LDS	R2,Result+28
    03524 9220 0396 STS	GUI_date+4,R2
(0373)     GUI_date[5]=Result.Date[7];
    03526 9020 0656 LDS	R2,Result+29
    03528 9220 0397 STS	GUI_date+5,R2
(0374)     GUI_date[8]=Result.Time[0];
    0352A 9020 0658 LDS	R2,Result+31
    0352C 9220 039A STS	GUI_date+8,R2
(0375)     GUI_date[9]=Result.Time[1];
    0352E 9020 0659 LDS	R2,Result+32
    03530 9220 039B STS	GUI_date+9,R2
(0376)     GUI_date[11]=Result.Time[3];
    03532 9020 065B LDS	R2,Result+34
    03534 9220 039D STS	GUI_date+11,R2
(0377)     GUI_date[12]=Result.Time[4];
    03536 9020 065C LDS	R2,Result+35
    03538 9220 039E STS	GUI_date+12,R2
(0378)     GUI_date[14]=Result.Time[6];
    0353A 9020 065E LDS	R2,Result+37
    0353C 9220 03A0 STS	GUI_date+14,R2
(0379)     GUI_date[15]=Result.Time[7];
    0353E 9020 065F LDS	R2,Result+38
    03540 9220 03A1 STS	GUI_date+15,R2
(0380)     GUI_date[16]='\0';
    03542 2422      CLR	R2
    03543 9220 03A2 STS	GUI_date+16,R2
(0381)     return GUI_date;
    03545 E902      LDI	R16,0x92
    03546 E013      LDI	R17,3
    03547 9508      RET
_GUI_set_time:
  GUI_down             --> Y,+5
  GUI_up               --> Y,+2
  ary                  --> R12
  p                    --> Y,+10
  i                    --> R14
  keyc                 --> R20
  pT                   --> R10
  pD                   --> Y,+8
    03548 940E 4B1D CALL	push_xgsetF0FC
    0354A 972B      SBIW	R28,0xB
(0382) }
(0383) //设置时间 菜单 
(0384) void GUI_set_time(void){
(0385)     unsigned char p=2;
    0354B E082      LDI	R24,2
    0354C 878A      STD	Y+10,R24
(0386) 	char GUI_up[]= "↑";
    0354D EA83      LDI	R24,0xA3
    0354E E093      LDI	R25,3
    0354F 01FE      MOVW	R30,R28
    03550 9632      ADIW	R30,2
    03551 E003      LDI	R16,3
    03552 E010      LDI	R17,0
    03553 93FA      ST	-Y,R31
    03554 93EA      ST	-Y,R30
    03555 939A      ST	-Y,R25
    03556 938A      ST	-Y,R24
    03557 940E 4BCD CALL	asgnblk
(0387) 	char GUI_down[]= "↓";
    03559 EA86      LDI	R24,0xA6
    0355A E093      LDI	R25,3
    0355B 01FE      MOVW	R30,R28
    0355C 9635      ADIW	R30,5
    0355D E003      LDI	R16,3
    0355E E010      LDI	R17,0
    0355F 93FA      ST	-Y,R31
    03560 93EA      ST	-Y,R30
    03561 939A      ST	-Y,R25
    03562 938A      ST	-Y,R24
    03563 940E 4BCD CALL	asgnblk
(0388) 	char *pD=NULL,*pT=NULL;
    03565 2400      CLR	R0
    03566 2411      CLR	R1
    03567 8619      STD	Y+9,R1
    03568 8608      STD	Y+8,R0
(0389) 	char *ary=GUI_up;
    03569 01CE      MOVW	R24,R28
    0356A 9602      ADIW	R24,2
    0356B 016C      MOVW	R12,R24
(0390) 	unsigned char i=0,keyc=NO_KEY;
    0356C 24EE      CLR	R14
    0356D 2744      CLR	R20
(0391) 	LCD_CLR(); //清屏
    0356E 940E 3F9E CALL	_LCD_CLR
(0392) 	pD="2012年12月31日\0";
    03570 E68F      LDI	R24,0x6F
    03571 E094      LDI	R25,4
    03572 8799      STD	Y+9,R25
    03573 8788      STD	Y+8,R24
(0393) 	pT="12: 30: 59\0";
    03574 E683      LDI	R24,0x63
    03575 E094      LDI	R25,4
    03576 015C      MOVW	R10,R24
(0394) 	LCD_const_disp(1,1,"时间设置:       ");
    03577 E582      LDI	R24,0x52
    03578 E094      LDI	R25,4
    03579 8399      STD	Y+1,R25
    0357A 8388      ST	Y,R24
    0357B E021      LDI	R18,1
    0357C E001      LDI	R16,1
    0357D 940E 3EF8 CALL	_LCD_const_disp
(0395) 	LCD_const_disp(4,7,"保存");
    0357F E48D      LDI	R24,0x4D
    03580 E094      LDI	R25,4
    03581 8399      STD	Y+1,R25
    03582 8388      ST	Y,R24
    03583 E027      LDI	R18,7
    03584 E004      LDI	R16,4
    03585 940E 3EF8 CALL	_LCD_const_disp
(0396) 	LCD_var_disp(3,p,ary);
    03587 82D9      STD	Y+1,R13
    03588 82C8      ST	Y,R12
    03589 852A      LDD	R18,Y+10
    0358A E003      LDI	R16,3
    0358B 940E 3F25 CALL	_LCD_var_disp
(0397) 	LCD_var_disp(2,1,pD);
    0358D 8408      LDD	R0,Y+8
    0358E 8419      LDD	R1,Y+9
    0358F 8219      STD	Y+1,R1
    03590 8208      ST	Y,R0
    03591 E021      LDI	R18,1
    03592 E002      LDI	R16,2
    03593 940E 3F25 CALL	_LCD_var_disp
(0398) 	LCD_var_disp(4,1,pT);
    03595 82B9      STD	Y+1,R11
    03596 82A8      ST	Y,R10
    03597 E021      LDI	R18,1
    03598 E004      LDI	R16,4
    03599 940E 3F25 CALL	_LCD_var_disp
(0399) 	delayms(250);
    0359B EF0A      LDI	R16,0xFA
    0359C E010      LDI	R17,0
    0359D 940E 2D55 CALL	_delayms
    0359F C1F5      RJMP	0x3795
(0400) 	while(alwaysCheck()){
(0401) 	    keyc=kbscan();
    035A0 940E 44FE CALL	_kbscan
    035A2 2F40      MOV	R20,R16
(0402) 		pD[2]=Result.Date[2];
    035A3 9020 0651 LDS	R2,Result+24
    035A5 85E8      LDD	R30,Y+8
    035A6 85F9      LDD	R31,Y+9
    035A7 8222      STD	Z+2,R2
(0403) 		pD[3]=Result.Date[3];
    035A8 9020 0652 LDS	R2,Result+25
    035AA 8223      STD	Z+3,R2
(0404) 		pD[6]=Result.Date[4];
    035AB 9020 0653 LDS	R2,Result+26
    035AD 8226      STD	Z+6,R2
(0405) 		pD[7]=Result.Date[5];
    035AE 9020 0654 LDS	R2,Result+27
    035B0 8227      STD	Z+7,R2
(0406) 		pD[10]=Result.Date[6];
    035B1 9020 0655 LDS	R2,Result+28
    035B3 8622      STD	Z+10,R2
(0407) 		pD[11]=Result.Date[7];  
    035B4 9020 0656 LDS	R2,Result+29
    035B6 8623      STD	Z+11,R2
(0408) 		pT[0] = Result.Time[0];
    035B7 9020 0658 LDS	R2,Result+31
    035B9 01F5      MOVW	R30,R10
    035BA 8220      ST	Z,R2
(0409) 		pT[1] = Result.Time[1];
    035BB 9020 0659 LDS	R2,Result+32
    035BD 8221      STD	Z+1,R2
(0410) 		pT[4] = Result.Time[3];
    035BE 9020 065B LDS	R2,Result+34
    035C0 8224      STD	Z+4,R2
(0411) 		pT[5] = Result.Time[4];
    035C1 9020 065C LDS	R2,Result+35
    035C3 8225      STD	Z+5,R2
(0412) 		pT[8] = Result.Time[6];
    035C4 9020 065E LDS	R2,Result+37
    035C6 8620      STD	Z+8,R2
(0413) 		pT[9] = Result.Time[7];
    035C7 9020 065F LDS	R2,Result+38
    035C9 8621      STD	Z+9,R2
(0414) 		
(0415) 		switch(i){
    035CA 2D6E      MOV	R22,R14
    035CB 2777      CLR	R23
    035CC 3060      CPI	R22,0
    035CD 0767      CPC	R22,R23
    035CE F0D1      BEQ	0x35E9
    035CF 3061      CPI	R22,1
    035D0 E0E0      LDI	R30,0
    035D1 077E      CPC	R23,R30
    035D2 F409      BNE	0x35D4
    035D3 C04A      RJMP	0x361E
    035D4 3062      CPI	R22,2
    035D5 E0E0      LDI	R30,0
    035D6 077E      CPC	R23,R30
    035D7 F409      BNE	0x35D9
    035D8 C07C      RJMP	0x3655
    035D9 3063      CPI	R22,3
    035DA E0E0      LDI	R30,0
    035DB 077E      CPC	R23,R30
    035DC F409      BNE	0x35DE
    035DD C0BE      RJMP	0x369C
    035DE 3064      CPI	R22,4
    035DF E0E0      LDI	R30,0
    035E0 077E      CPC	R23,R30
    035E1 F409      BNE	0x35E3
    035E2 C0F1      RJMP	0x36D4
    035E3 3065      CPI	R22,5
    035E4 E0E0      LDI	R30,0
    035E5 077E      CPC	R23,R30
    035E6 F409      BNE	0x35E8
    035E7 C123      RJMP	0x370B
    035E8 C15C      RJMP	0x3745
(0416)             case 0: p=2;ary=GUI_up;  //年
    035E9 E082      LDI	R24,2
    035EA 878A      STD	Y+10,R24
    035EB 01CE      MOVW	R24,R28
    035EC 9602      ADIW	R24,2
    035ED 016C      MOVW	R12,R24
(0417) 		 	  	 if(keyc==up){
    035EE 314E      CPI	R20,0x1E
    035EF F491      BNE	0x3602
(0418) 				     if(time_buf[1]<0x99){ 
    035F0 9180 05E0 LDS	R24,time_buf+1
    035F2 3989      CPI	R24,0x99
    035F3 F008      BCS	0x35F5
    035F4 C150      RJMP	0x3745
(0419) 					     time_buf[1]++;
    035F5 5F8F      SUBI	R24,0xFF
    035F6 9380 05E0 STS	time_buf+1,R24
(0420) 						 if((time_buf[1]&0x0f)==0x0a) 
    035F8 708F      ANDI	R24,0xF
    035F9 308A      CPI	R24,0xA
    035FA F009      BEQ	0x35FC
    035FB C149      RJMP	0x3745
(0421) 						     time_buf[1]=time_buf[1]+6;
    035FC 9180 05E0 LDS	R24,time_buf+1
    035FE 5F8A      SUBI	R24,0xFA
    035FF 9380 05E0 STS	time_buf+1,R24
(0422) 					 }
(0423) 												     
(0424) 				}				  
    03601 C143      RJMP	0x3745
(0425)  					        
(0426) 			    else if(keyc==down){ 
    03602 314D      CPI	R20,0x1D
    03603 F4A1      BNE	0x3618
(0427) 				    if(time_buf[1]>0x00){
    03604 E080      LDI	R24,0
    03605 9020 05E0 LDS	R2,time_buf+1
    03607 1582      CP	R24,R2
    03608 F008      BCS	0x360A
    03609 C13B      RJMP	0x3745
(0428) 				        time_buf[1]--;
    0360A 2D82      MOV	R24,R2
    0360B 5081      SUBI	R24,1
    0360C 9380 05E0 STS	time_buf+1,R24
(0429) 						if((time_buf[1]&0x0f)==0x0f) 
    0360E 708F      ANDI	R24,0xF
    0360F 308F      CPI	R24,0xF
    03610 F009      BEQ	0x3612
    03611 C133      RJMP	0x3745
(0430) 						    time_buf[1]=time_buf[1]-6;
    03612 9180 05E0 LDS	R24,time_buf+1
    03614 5086      SUBI	R24,6
    03615 9380 05E0 STS	time_buf+1,R24
(0431) 		 	  	 		 }
(0432) 												   
(0433) 					}			   		
    03617 C12D      RJMP	0x3745
(0434) 				else if(keyc==left) {i=1;}
    03618 314B      CPI	R20,0x1B
    03619 F009      BEQ	0x361B
    0361A C12A      RJMP	0x3745
    0361B 24EE      CLR	R14
    0361C 94E3      INC	R14
(0435) 				break;
    0361D C127      RJMP	0x3745
(0436) 		 case 1:p=4;ary=GUI_up;  //月
    0361E E084      LDI	R24,4
    0361F 878A      STD	Y+10,R24
    03620 01CE      MOVW	R24,R28
    03621 9602      ADIW	R24,2
    03622 016C      MOVW	R12,R24
(0437) 		  	  	if(keyc==up){
    03623 314E      CPI	R20,0x1E
    03624 F499      BNE	0x3638
(0438) 				    if(time_buf[2]<0x12){  
    03625 9180 05E1 LDS	R24,time_buf+2
    03627 3182      CPI	R24,0x12
    03628 F460      BCC	0x3635
(0439) 					    time_buf[2]++;	
    03629 5F8F      SUBI	R24,0xFF
    0362A 9380 05E1 STS	time_buf+2,R24
(0440) 						if((time_buf[2]&0x0f)==0x0a) time_buf[2]+=6;
    0362C 708F      ANDI	R24,0xF
    0362D 308A      CPI	R24,0xA
    0362E F449      BNE	0x3638
    0362F 9180 05E1 LDS	R24,time_buf+2
    03631 5F8A      SUBI	R24,0xFA
    03632 9380 05E1 STS	time_buf+2,R24
(0441) 					}
    03634 C003      RJMP	0x3638
(0442) 					else 
(0443) 					    time_buf[2]=0x01;
    03635 E081      LDI	R24,1
    03636 9380 05E1 STS	time_buf+2,R24
(0444) 				}						 
(0445) 				if(keyc==down){ 
    03638 314D      CPI	R20,0x1D
    03639 F4A9      BNE	0x364F
(0446) 				    if(time_buf[2]>0x01){  
    0363A E081      LDI	R24,1
    0363B 9020 05E1 LDS	R2,time_buf+2
    0363D 1582      CP	R24,R2
    0363E F468      BCC	0x364C
(0447) 					    time_buf[2]--;	
    0363F 2D82      MOV	R24,R2
    03640 5081      SUBI	R24,1
    03641 9380 05E1 STS	time_buf+2,R24
(0448) 						if((time_buf[2]&0x0f)==0x0f) 
    03643 708F      ANDI	R24,0xF
    03644 308F      CPI	R24,0xF
    03645 F449      BNE	0x364F
(0449) 						    time_buf[2]-=6;
    03646 9180 05E1 LDS	R24,time_buf+2
    03648 5086      SUBI	R24,6
    03649 9380 05E1 STS	time_buf+2,R24
(0450) 			  		}
    0364B C003      RJMP	0x364F
(0451) 				    else 
(0452) 					    time_buf[2]=0x12;						
    0364C E182      LDI	R24,0x12
    0364D 9380 05E1 STS	time_buf+2,R24
(0453) 				}						 							
(0454)  								
(0455) 				if(keyc==left){
    0364F 314B      CPI	R20,0x1B
    03650 F009      BEQ	0x3652
    03651 C0F3      RJMP	0x3745
(0456) 				    i=2;   
    03652 E082      LDI	R24,2
    03653 2EE8      MOV	R14,R24
(0457) 				}  
(0458) 				break;
    03654 C0F0      RJMP	0x3745
(0459) 	 	 case 2: p=6;ary=GUI_up;
    03655 E086      LDI	R24,6
    03656 878A      STD	Y+10,R24
    03657 01CE      MOVW	R24,R28
    03658 9602      ADIW	R24,2
    03659 016C      MOVW	R12,R24
(0460) 		 	  	 if(keyc==up){ 
    0365A 314E      CPI	R20,0x1E
    0365B F519      BNE	0x367F
(0461) 				     if(time_buf[3]<0x31){ 
    0365C 9180 05E2 LDS	R24,time_buf+3
    0365E 3381      CPI	R24,0x31
    0365F F5B0      BCC	0x3696
(0462) 				         time_buf[3]++;
    03660 5F8F      SUBI	R24,0xFF
    03661 9380 05E2 STS	time_buf+3,R24
(0463) 						 if ((time_buf[3]&0x0f)==0x0a) time_buf[3]=time_buf[3]+6;
    03663 708F      ANDI	R24,0xF
    03664 308A      CPI	R24,0xA
    03665 F429      BNE	0x366B
    03666 9180 05E2 LDS	R24,time_buf+3
    03668 5F8A      SUBI	R24,0xFA
    03669 9380 05E2 STS	time_buf+3,R24
(0464) 						 if(  //2 4 6 9 11 月最大30天
(0465) 						  ( ((time_buf[2]==0x02) || (time_buf[2]==0x04)|| (time_buf[2]==0x06)||
    0366B 9180 05E1 LDS	R24,time_buf+2
    0366D 3082      CPI	R24,2
    0366E F041      BEQ	0x3677
    0366F 3084      CPI	R24,4
    03670 F031      BEQ	0x3677
    03671 3086      CPI	R24,6
    03672 F021      BEQ	0x3677
    03673 3089      CPI	R24,0x9
    03674 F011      BEQ	0x3677
    03675 3181      CPI	R24,0x11
    03676 F4F9      BNE	0x3696
    03677 9180 05E2 LDS	R24,time_buf+3
    03679 3381      CPI	R24,0x31
    0367A F4D9      BNE	0x3696
(0466) 						  (time_buf[2]==0x09)||(time_buf[2]==0x11))&&(time_buf[3]==0x31))){
(0467) 						      time_buf[3]=0x30;
    0367B E380      LDI	R24,0x30
    0367C 9380 05E2 STS	time_buf+3,R24
(0468) 						}
(0469) 				     }
(0470)  									  
(0471)  				 }
    0367E C017      RJMP	0x3696
(0472) 			     else if(keyc==down){ 
    0367F 314D      CPI	R20,0x1D
    03680 F4A9      BNE	0x3696
(0473) 				      if(time_buf[3]>0x01){  
    03681 E081      LDI	R24,1
    03682 9020 05E2 LDS	R2,time_buf+3
    03684 1582      CP	R24,R2
    03685 F468      BCC	0x3693
(0474) 					     time_buf[3]--;
    03686 2D82      MOV	R24,R2
    03687 5081      SUBI	R24,1
    03688 9380 05E2 STS	time_buf+3,R24
(0475) 				 	  	 if((time_buf[3]&0x0f)==0x0f) time_buf[3]=time_buf[3]-6;
    0368A 708F      ANDI	R24,0xF
    0368B 308F      CPI	R24,0xF
    0368C F449      BNE	0x3696
    0368D 9180 05E2 LDS	R24,time_buf+3
    0368F 5086      SUBI	R24,6
    03690 9380 05E2 STS	time_buf+3,R24
(0476) 		 	  	 	 }
    03692 C003      RJMP	0x3696
(0477) 					 else time_buf[3]=0x31;						
    03693 E381      LDI	R24,0x31
    03694 9380 05E2 STS	time_buf+3,R24
(0478) 											   
(0479) 				}
(0480) 				if(keyc==left) {i=3;  }						 			   		
    03696 314B      CPI	R20,0x1B
    03697 F009      BEQ	0x3699
    03698 C0AC      RJMP	0x3745
    03699 E083      LDI	R24,3
    0369A 2EE8      MOV	R14,R24
(0481) 				break;
    0369B C0A9      RJMP	0x3745
(0482) 		case 3:p=1;ary=GUI_down;
    0369C 2400      CLR	R0
    0369D 9403      INC	R0
    0369E 860A      STD	Y+10,R0
    0369F 01CE      MOVW	R24,R28
    036A0 9605      ADIW	R24,5
    036A1 016C      MOVW	R12,R24
(0483)  	  	if(keyc==up){ if(time_buf[4]<0x23){  time_buf[4]++;	
    036A2 314E      CPI	R20,0x1E
    036A3 F499      BNE	0x36B7
    036A4 9180 05E3 LDS	R24,time_buf+4
    036A6 3283      CPI	R24,0x23
    036A7 F460      BCC	0x36B4
    036A8 5F8F      SUBI	R24,0xFF
    036A9 9380 05E3 STS	time_buf+4,R24
(0484) 													if((time_buf[4]&0x0f)==0x0a) time_buf[4]+=6;
    036AB 708F      ANDI	R24,0xF
    036AC 308A      CPI	R24,0xA
    036AD F449      BNE	0x36B7
    036AE 9180 05E3 LDS	R24,time_buf+4
    036B0 5F8A      SUBI	R24,0xFA
    036B1 9380 05E3 STS	time_buf+4,R24
(0485) 													 
(0486) 													
(0487) 												 }
    036B3 C003      RJMP	0x36B7
(0488) 							else time_buf[4]=0x00;
    036B4 2422      CLR	R2
    036B5 9220 05E3 STS	time_buf+4,R2
(0489) 						  }						 
(0490) 				if(keyc==down){ if(time_buf[4]>0x00){  time_buf[4]--;	
    036B7 314D      CPI	R20,0x1D
    036B8 F4A9      BNE	0x36CE
    036B9 E080      LDI	R24,0
    036BA 9020 05E3 LDS	R2,time_buf+4
    036BC 1582      CP	R24,R2
    036BD F468      BCC	0x36CB
    036BE 2D82      MOV	R24,R2
    036BF 5081      SUBI	R24,1
    036C0 9380 05E3 STS	time_buf+4,R24
(0491) 													if((time_buf[4]&0x0f)==0x0f) time_buf[4]-=6;
    036C2 708F      ANDI	R24,0xF
    036C3 308F      CPI	R24,0xF
    036C4 F449      BNE	0x36CE
    036C5 9180 05E3 LDS	R24,time_buf+4
    036C7 5086      SUBI	R24,6
    036C8 9380 05E3 STS	time_buf+4,R24
(0492) 													
(0493) 												 }
    036CA C003      RJMP	0x36CE
(0494) 							 else time_buf[4]=0x23;						
    036CB E283      LDI	R24,0x23
    036CC 9380 05E3 STS	time_buf+4,R24
(0495) 						  }	
(0496) 		if(keyc==left) {i=4;    } 
    036CE 314B      CPI	R20,0x1B
    036CF F009      BEQ	0x36D1
    036D0 C074      RJMP	0x3745
    036D1 E084      LDI	R24,4
    036D2 2EE8      MOV	R14,R24
(0497) 		break;						  					 			
    036D3 C071      RJMP	0x3745
(0498)  case 4:p=3;ary=GUI_down;
    036D4 E083      LDI	R24,3
    036D5 878A      STD	Y+10,R24
    036D6 01CE      MOVW	R24,R28
    036D7 9605      ADIW	R24,5
    036D8 016C      MOVW	R12,R24
(0499)  	  	if(keyc==up){ if(time_buf[5]<0x59){  time_buf[5]++;	
    036D9 314E      CPI	R20,0x1E
    036DA F499      BNE	0x36EE
    036DB 9180 05E4 LDS	R24,time_buf+5
    036DD 3589      CPI	R24,0x59
    036DE F460      BCC	0x36EB
    036DF 5F8F      SUBI	R24,0xFF
    036E0 9380 05E4 STS	time_buf+5,R24
(0500) 											 if((time_buf[5]&0x0f)==0x0a) time_buf[5]+=6;
    036E2 708F      ANDI	R24,0xF
    036E3 308A      CPI	R24,0xA
    036E4 F449      BNE	0x36EE
    036E5 9180 05E4 LDS	R24,time_buf+5
    036E7 5F8A      SUBI	R24,0xFA
    036E8 9380 05E4 STS	time_buf+5,R24
(0501) 										  }
    036EA C003      RJMP	0x36EE
(0502) 					  else time_buf[5]=0x00;
    036EB 2422      CLR	R2
    036EC 9220 05E4 STS	time_buf+5,R2
(0503) 					}						 
(0504) 		if(keyc==down){ if(time_buf[5]>0x00){  time_buf[5]--;	
    036EE 314D      CPI	R20,0x1D
    036EF F4A9      BNE	0x3705
    036F0 E080      LDI	R24,0
    036F1 9020 05E4 LDS	R2,time_buf+5
    036F3 1582      CP	R24,R2
    036F4 F468      BCC	0x3702
    036F5 2D82      MOV	R24,R2
    036F6 5081      SUBI	R24,1
    036F7 9380 05E4 STS	time_buf+5,R24
(0505) 												if((time_buf[5]&0x0f)==0x0f) time_buf[5]-=6;
    036F9 708F      ANDI	R24,0xF
    036FA 308F      CPI	R24,0xF
    036FB F449      BNE	0x3705
    036FC 9180 05E4 LDS	R24,time_buf+5
    036FE 5086      SUBI	R24,6
    036FF 9380 05E4 STS	time_buf+5,R24
(0506) 											}
    03701 C003      RJMP	0x3705
(0507) 						else time_buf[5]=0x59;						
    03702 E589      LDI	R24,0x59
    03703 9380 05E4 STS	time_buf+5,R24
(0508) 					  }
(0509) 		if(keyc==left ) {i=5;    } 		  						 								  			
    03705 314B      CPI	R20,0x1B
    03706 F009      BEQ	0x3708
    03707 C03D      RJMP	0x3745
    03708 E085      LDI	R24,5
    03709 2EE8      MOV	R14,R24
(0510) 		break;			   
    0370A C03A      RJMP	0x3745
(0511)  case 5:p=5;ary=GUI_down;
    0370B E085      LDI	R24,5
    0370C 878A      STD	Y+10,R24
    0370D 01CE      MOVW	R24,R28
    0370E 9605      ADIW	R24,5
    0370F 016C      MOVW	R12,R24
(0512)  	  	if(keyc==up){ if(time_buf[6]<0x59){  time_buf[6]++;	
    03710 314E      CPI	R20,0x1E
    03711 F499      BNE	0x3725
    03712 9180 05E5 LDS	R24,time_buf+6
    03714 3589      CPI	R24,0x59
    03715 F460      BCC	0x3722
    03716 5F8F      SUBI	R24,0xFF
    03717 9380 05E5 STS	time_buf+6,R24
(0513) 											 if((time_buf[6]&0x0f)==0x0a) time_buf[6]+=6;
    03719 708F      ANDI	R24,0xF
    0371A 308A      CPI	R24,0xA
    0371B F449      BNE	0x3725
    0371C 9180 05E5 LDS	R24,time_buf+6
    0371E 5F8A      SUBI	R24,0xFA
    0371F 9380 05E5 STS	time_buf+6,R24
(0514) 										 }
    03721 C003      RJMP	0x3725
(0515) 					  else time_buf[6]=0x00;
    03722 2422      CLR	R2
    03723 9220 05E5 STS	time_buf+6,R2
(0516) 					}						 
(0517) 		if(keyc==down){ if(time_buf[6]>0x00){  time_buf[6]--;	
    03725 314D      CPI	R20,0x1D
    03726 F4A9      BNE	0x373C
    03727 E080      LDI	R24,0
    03728 9020 05E5 LDS	R2,time_buf+6
    0372A 1582      CP	R24,R2
    0372B F468      BCC	0x3739
    0372C 2D82      MOV	R24,R2
    0372D 5081      SUBI	R24,1
    0372E 9380 05E5 STS	time_buf+6,R24
(0518) 						if((time_buf[6]&0x0f)==0x0f) time_buf[6]-=6;
    03730 708F      ANDI	R24,0xF
    03731 308F      CPI	R24,0xF
    03732 F449      BNE	0x373C
    03733 9180 05E5 LDS	R24,time_buf+6
    03735 5086      SUBI	R24,6
    03736 9380 05E5 STS	time_buf+6,R24
(0519) 					  }
    03738 C003      RJMP	0x373C
(0520) 		else time_buf[6]=0x59;		}				
    03739 E589      LDI	R24,0x59
    0373A 9380 05E5 STS	time_buf+6,R24
(0521) 		if(keyc==left) {i=6;p=1;ary=NULL;}  
    0373C 314B      CPI	R20,0x1B
    0373D F439      BNE	0x3745
    0373E E086      LDI	R24,6
    0373F 2EE8      MOV	R14,R24
    03740 2400      CLR	R0
    03741 9403      INC	R0
    03742 860A      STD	Y+10,R0
    03743 24CC      CLR	R12
    03744 24DD      CLR	R13
(0522) 		break;           
(0523) 							 
(0524) 		 }//endcase
(0525)  		 dateRefresh(88); //set clock mode
    03745 E508      LDI	R16,0x58
    03746 D21E      RCALL	_dateRefresh
(0526) 		 
(0527) 		 LCD_const_disp(3,1,"                "); //清空箭头 
    03747 E38C      LDI	R24,0x3C
    03748 E094      LDI	R25,4
    03749 8399      STD	Y+1,R25
    0374A 8388      ST	Y,R24
    0374B E021      LDI	R18,1
    0374C E003      LDI	R16,3
    0374D 940E 3EF8 CALL	_LCD_const_disp
(0528)  		 LCD_var_disp(3,p,ary); //显示箭头 
    0374F 82D9      STD	Y+1,R13
    03750 82C8      ST	Y,R12
    03751 852A      LDD	R18,Y+10
    03752 E003      LDI	R16,3
    03753 940E 3F25 CALL	_LCD_var_disp
(0529)  		 LCD_var_disp(2,1,pD);  //显示日期
    03755 8408      LDD	R0,Y+8
    03756 8419      LDD	R1,Y+9
    03757 8219      STD	Y+1,R1
    03758 8208      ST	Y,R0
    03759 E021      LDI	R18,1
    0375A E002      LDI	R16,2
    0375B 940E 3F25 CALL	_LCD_var_disp
(0530)  		 LCD_var_disp(4,1,pT);  //显示时间
    0375D 82B9      STD	Y+1,R11
    0375E 82A8      ST	Y,R10
    0375F E021      LDI	R18,1
    03760 E004      LDI	R16,4
    03761 940E 3F25 CALL	_LCD_var_disp
(0531)  if(keyc==right) {		  
    03763 3147      CPI	R20,0x17
    03764 F479      BNE	0x3774
(0532)  		  LCD_const_disp(3,1,"        放弃修改"); 
    03765 E28B      LDI	R24,0x2B
    03766 E094      LDI	R25,4
    03767 8399      STD	Y+1,R25
    03768 8388      ST	Y,R24
    03769 E021      LDI	R18,1
    0376A E003      LDI	R16,3
    0376B 940E 3EF8 CALL	_LCD_const_disp
(0533) 		  delayms(500);
    0376D EF04      LDI	R16,0xF4
    0376E E011      LDI	R17,1
    0376F 940E 2D55 CALL	_delayms
(0534) 		  LCD_CLR(); //清屏
    03771 940E 3F9E CALL	_LCD_CLR
(0535) 		  return ;} 
    03773 C026      RJMP	0x379A
(0536)  keyc=NO_KEY;
    03774 2744      CLR	R20
(0537)  if(i==6){    //各值改变完成后 显示已保存 清屏 返回
    03775 2D8E      MOV	R24,R14
    03776 3086      CPI	R24,6
    03777 F4C9      BNE	0x3791
(0538) 		  ds1302_write_time(); 
    03778 940E 44B1 CALL	_ds1302_write_time
(0539)           LCD_const_disp(4,7,"    ");		  
    0377A E286      LDI	R24,0x26
    0377B E094      LDI	R25,4
    0377C 8399      STD	Y+1,R25
    0377D 8388      ST	Y,R24
    0377E E027      LDI	R18,7
    0377F E004      LDI	R16,4
    03780 940E 3EF8 CALL	_LCD_const_disp
(0540) 		  LCD_const_disp(3,1,"          已保存"); 
    03782 E185      LDI	R24,0x15
    03783 E094      LDI	R25,4
    03784 8399      STD	Y+1,R25
    03785 8388      ST	Y,R24
    03786 E021      LDI	R18,1
    03787 E003      LDI	R16,3
    03788 940E 3EF8 CALL	_LCD_const_disp
(0541) 		  delayms(300);
    0378A E20C      LDI	R16,0x2C
    0378B E011      LDI	R17,1
    0378C 940E 2D55 CALL	_delayms
(0542) 		  LCD_CLR(); //清屏
    0378E 940E 3F9E CALL	_LCD_CLR
(0543) 		  return ;
    03790 C009      RJMP	0x379A
(0544) 		  }
(0545)  delayms(2);	  
    03791 E002      LDI	R16,2
    03792 E010      LDI	R17,0
    03793 940E 2D55 CALL	_delayms
    03795 940E 0477 CALL	_alwaysCheck
    03797 2300      TST	R16
    03798 F009      BEQ	0x379A
    03799 CE06      RJMP	0x35A0
    0379A 962B      ADIW	R28,0xB
    0379B 940C 4B12 JMP	pop_xgsetF0FC
_GUI_readback:
  res                  --> R12
  file_buf             --> Y,+3
  page                 --> R20
  key                  --> R22
  buf                  --> R10
    0379D 940E 4B1D CALL	push_xgsetF0FC
    0379F 0158      MOVW	R10,R16
    037A0 9760      SBIW	R28,0x10
(0546) }//endwhile(1)
(0547) }
(0548) void GUI_readback(char *buf){
(0549)     char key=0;
    037A1 2766      CLR	R22
(0550) 	char page=0;
    037A2 2744      CLR	R20
(0551) 	char res=0;
    037A3 24CC      CLR	R12
(0552) 	char file_buf[]="201201.xls\0\0";
    037A4 EA89      LDI	R24,0xA9
    037A5 E093      LDI	R25,3
    037A6 01FE      MOVW	R30,R28
    037A7 9633      ADIW	R30,3
    037A8 E00D      LDI	R16,0xD
    037A9 E010      LDI	R17,0
    037AA 93FA      ST	-Y,R31
    037AB 93EA      ST	-Y,R30
    037AC 939A      ST	-Y,R25
    037AD 938A      ST	-Y,R24
    037AE 940E 4BCD CALL	asgnblk
(0553) 	LCD_CLR(); //清屏
    037B0 940E 3F9E CALL	_LCD_CLR
(0554) 	//1 检测SD状态
(0555) 		//无SD卡 显示无卡 退出
(0556) 	if((SD_DET()==0)) {
    037B2 B181      IN	R24,0x01
    037B3 9586      LSR	R24
    037B4 9586      LSR	R24
    037B5 9586      LSR	R24
    037B6 9586      LSR	R24
    037B7 9586      LSR	R24
    037B8 7081      ANDI	R24,1
    037B9 F421      BNE	0x37BE
    037BA E081      LDI	R24,1
    037BB E090      LDI	R25,0
    037BC 017C      MOVW	R14,R24
    037BD C002      RJMP	0x37C0
    037BE 24EE      CLR	R14
    037BF 24FF      CLR	R15
    037C0 20EE      TST	R14
    037C1 F479      BNE	0x37D1
    037C2 20FF      TST	R15
    037C3 F469      BNE	0x37D1
(0557) 		LCD_const_disp(2,1,"未检测到SD卡..");
    037C4 E086      LDI	R24,6
    037C5 E094      LDI	R25,4
    037C6 8399      STD	Y+1,R25
    037C7 8388      ST	Y,R24
    037C8 E021      LDI	R18,1
    037C9 E002      LDI	R16,2
    037CA 940E 3EF8 CALL	_LCD_const_disp
(0558) 			#ifdef _DBG_RD_
(0559) 		   PrintString_n("not find sd");
(0560) 		   #endif
(0561) 		delayms(500);
    037CC EF04      LDI	R16,0xF4
    037CD E011      LDI	R17,1
    037CE 940E 2D55 CALL	_delayms
(0562) 		return ;
    037D0 C174      RJMP	0x3945
(0563) 	}
(0564) 	//2 显示当前月份
(0565) 	get_name(file_buf);
    037D1 018E      MOVW	R16,R28
    037D2 5F0D      SUBI	R16,0xFD
    037D3 4F1F      SBCI	R17,0xFF
    037D4 940E 0AF0 CALL	_get_name
(0566) 	LCD_const_disp(1,1,"查找数据:");
    037D6 EF8C      LDI	R24,0xFC
    037D7 E093      LDI	R25,3
    037D8 8399      STD	Y+1,R25
    037D9 8388      ST	Y,R24
    037DA E021      LDI	R18,1
    037DB E001      LDI	R16,1
    037DC 940E 3EF8 CALL	_LCD_const_disp
(0567) 	LCD_const_disp(2,2,file_buf);
    037DE 01CE      MOVW	R24,R28
    037DF 9603      ADIW	R24,3
    037E0 8399      STD	Y+1,R25
    037E1 8388      ST	Y,R24
    037E2 E022      LDI	R18,2
    037E3 E002      LDI	R16,2
    037E4 940E 3EF8 CALL	_LCD_const_disp
(0568) 	#ifdef _DBG_RD_
(0569) 		   PrintString_n(file_buf);
(0570) 	#endif
(0571) 	//3 查找文件是否存在
(0572) 		//存在-> 进入读取顺序的选择
(0573) 		//不存在 -> 询问查找上月
(0574) 	//4 选择 查询顺序
(0575) 		//计算总条数
(0576) 		//顺序 增量为1， 查询第一条 
(0577) 		//逆序 增量为-1，查询最后一条
(0578) 	//5 读取	
(0579) 	//6 显示
(0580) 	//7 上一条 下一条  退出
(0581) 		//设置条数 判断边界 进入5
(0582) 		//退出 返回主程序	
(0583) 	//!!res=checkFile(file_buf);
(0584) label_recheck:	
(0585) 	LCD_Init(); //清屏
    037E6 940E 3F6C CALL	_LCD_Init
(0586) 	LCD_CLR();  
    037E8 940E 3F9E CALL	_LCD_CLR
(0587) 	if(res == 0){ //找到并已经确认文件
    037EA 20CC      TST	R12
    037EB F009      BEQ	0x37ED
    037EC C158      RJMP	0x3945
(0588) 		   LCD_const_disp(1,1,"菜单/ 查询");
    037ED EF81      LDI	R24,0xF1
    037EE E093      LDI	R25,3
    037EF 8399      STD	Y+1,R25
    037F0 8388      ST	Y,R24
    037F1 E021      LDI	R18,1
    037F2 E001      LDI	R16,1
    037F3 940E 3EF8 CALL	_LCD_const_disp
(0589)    		   LCD_const_disp(2,3,"按顺序");
    037F5 EE8A      LDI	R24,0xEA
    037F6 E093      LDI	R25,3
    037F7 8399      STD	Y+1,R25
    037F8 8388      ST	Y,R24
    037F9 E023      LDI	R18,3
    037FA E002      LDI	R16,2
    037FB 940E 3EF8 CALL	_LCD_const_disp
(0590) 		   LCD_const_disp(3,3,"最后一次");		 
    037FD EE81      LDI	R24,0xE1
    037FE E093      LDI	R25,3
    037FF 8399      STD	Y+1,R25
    03800 8388      ST	Y,R24
    03801 E023      LDI	R18,3
    03802 E003      LDI	R16,3
    03803 940E 3EF8 CALL	_LCD_const_disp
(0591) 	       if(config.readMode == READ_MODE_LAST){
    03805 9020 08BD LDS	R2,config+18
    03807 2022      TST	R2
    03808 F4A1      BNE	0x381D
(0592) 		       config.readMode=READ_MODE_FIRST;
    03809 E081      LDI	R24,1
    0380A 9380 08BD STS	config+18,R24
(0593) 			   Set_White(1,2,8,0);
    0380C 2422      CLR	R2
    0380D 822A      STD	Y+2,R2
    0380E E088      LDI	R24,0x8
    0380F 8388      ST	Y,R24
    03810 E022      LDI	R18,2
    03811 E001      LDI	R16,1
    03812 940E 4028 CALL	_Set_White
(0594)  			   Set_White(1,3,8,1);
    03814 E081      LDI	R24,1
    03815 838A      STD	Y+2,R24
    03816 E088      LDI	R24,0x8
    03817 8388      ST	Y,R24
    03818 E023      LDI	R18,3
    03819 E001      LDI	R16,1
    0381A 940E 4028 CALL	_Set_White
(0595) 		  }
    0381C C067      RJMP	0x3884
(0596) 		  else {
(0597) 		       config.readMode=READ_MODE_LAST;
    0381D 2422      CLR	R2
    0381E 9220 08BD STS	config+18,R2
(0598) 			   Set_White(1,2,8,1);
    03820 E081      LDI	R24,1
    03821 838A      STD	Y+2,R24
    03822 E088      LDI	R24,0x8
    03823 8388      ST	Y,R24
    03824 E022      LDI	R18,2
    03825 E001      LDI	R16,1
    03826 940E 4028 CALL	_Set_White
(0599)  			   Set_White(1,3,8,0);
    03828 2422      CLR	R2
    03829 822A      STD	Y+2,R2
    0382A E088      LDI	R24,0x8
    0382B 8388      ST	Y,R24
    0382C E023      LDI	R18,3
    0382D E001      LDI	R16,1
    0382E 940E 4028 CALL	_Set_White
(0600) 		 }
    03830 C053      RJMP	0x3884
(0601) 		   // 菜单/查询   按顺序/最后一次
(0602) 		   while(alwaysCheck()){
(0603)  		       key=kbscan();
    03831 940E 44FE CALL	_kbscan
    03833 2F60      MOV	R22,R16
(0604) 			   dateRefresh(0); //只刷新后台时间
    03834 2700      CLR	R16
    03835 D12F      RCALL	_dateRefresh
(0605) 			   //上键短按 选择
(0606) 			   if(key==up || key ==down){
    03836 316E      CPI	R22,0x1E
    03837 F011      BEQ	0x383A
    03838 316D      CPI	R22,0x1D
    03839 F559      BNE	0x3865
(0607) 	    	       if(config.readMode == READ_MODE_LAST){
    0383A 9020 08BD LDS	R2,config+18
    0383C 2022      TST	R2
    0383D F4A1      BNE	0x3852
(0608) 		    	       config.readMode=READ_MODE_FIRST;
    0383E E081      LDI	R24,1
    0383F 9380 08BD STS	config+18,R24
(0609) 					   Set_White(1,2,8,0);
    03841 2422      CLR	R2
    03842 822A      STD	Y+2,R2
    03843 E088      LDI	R24,0x8
    03844 8388      ST	Y,R24
    03845 E022      LDI	R18,2
    03846 E001      LDI	R16,1
    03847 940E 4028 CALL	_Set_White
(0610)  					   Set_White(1,3,8,1);
    03849 E081      LDI	R24,1
    0384A 838A      STD	Y+2,R24
    0384B E088      LDI	R24,0x8
    0384C 8388      ST	Y,R24
    0384D E023      LDI	R18,3
    0384E E001      LDI	R16,1
    0384F 940E 4028 CALL	_Set_White
(0611) 				   }
    03851 C013      RJMP	0x3865
(0612) 				   else {
(0613) 		    	       config.readMode=READ_MODE_LAST;
    03852 2422      CLR	R2
    03853 9220 08BD STS	config+18,R2
(0614) 					   Set_White(1,2,8,1);
    03855 E081      LDI	R24,1
    03856 838A      STD	Y+2,R24
    03857 E088      LDI	R24,0x8
    03858 8388      ST	Y,R24
    03859 E022      LDI	R18,2
    0385A E001      LDI	R16,1
    0385B 940E 4028 CALL	_Set_White
(0615)  					   Set_White(1,3,8,0);
    0385D 2422      CLR	R2
    0385E 822A      STD	Y+2,R2
    0385F E088      LDI	R24,0x8
    03860 8388      ST	Y,R24
    03861 E023      LDI	R18,3
    03862 E001      LDI	R16,1
    03863 940E 4028 CALL	_Set_White
(0616) 				   }
(0617) 				}      
(0618) 				//左键短按  进入
(0619) 				if(key == left) {
    03865 316B      CPI	R22,0x1B
    03866 F4A9      BNE	0x387C
(0620) 				    Set_White(1,2,8,1);
    03867 E081      LDI	R24,1
    03868 838A      STD	Y+2,R24
    03869 E088      LDI	R24,0x8
    0386A 8388      ST	Y,R24
    0386B E022      LDI	R18,2
    0386C E001      LDI	R16,1
    0386D 940E 4028 CALL	_Set_White
(0621)  				    Set_White(1,3,8,1);
    0386F E081      LDI	R24,1
    03870 838A      STD	Y+2,R24
    03871 E088      LDI	R24,0x8
    03872 8388      ST	Y,R24
    03873 E023      LDI	R18,3
    03874 E001      LDI	R16,1
    03875 940E 4028 CALL	_Set_White
(0622) 					delayms(100);
    03877 E604      LDI	R16,0x64
    03878 E010      LDI	R17,0
    03879 940E 2D55 CALL	_delayms
(0623) 				break ;		
    0387B C00D      RJMP	0x3889
(0624) 				}
(0625) 				//右键短按  返回
(0626) 				if(key == right) {
    0387C 3167      CPI	R22,0x17
    0387D F429      BNE	0x3883
(0627) 				    LCD_CLR();
    0387E 940E 3F9E CALL	_LCD_CLR
(0628) 	    			LCD_Init(); //清屏
    03880 940E 3F6C CALL	_LCD_Init
(0629) 					return ;	//返回主界面	
    03882 C0C2      RJMP	0x3945
(0630) 				}
(0631) 				key=0;
    03883 2766      CLR	R22
    03884 940E 0477 CALL	_alwaysCheck
    03886 2300      TST	R16
    03887 F009      BEQ	0x3889
    03888 CFA8      RJMP	0x3831
(0632) 		    } //end of while
(0633) 			if(config.readMode==READ_MODE_LAST){
    03889 9020 08BD LDS	R2,config+18
    0388B 2022      TST	R2
    0388C F461      BNE	0x3899
(0634) 			    ReadSDFile(file_buf,65535,buf,0); //最后一条
    0388D 2422      CLR	R2
    0388E 822A      STD	Y+2,R2
    0388F 82B9      STD	Y+1,R11
    03890 82A8      ST	Y,R10
    03891 EF2F      LDI	R18,0xFF
    03892 EF3F      LDI	R19,0xFF
    03893 018E      MOVW	R16,R28
    03894 5F0D      SUBI	R16,0xFD
    03895 4F1F      SBCI	R17,0xFF
    03896 940E 0665 CALL	_ReadSDFile
(0635) 			}
    03898 C00B      RJMP	0x38A4
(0636) 			else {
(0637) 			    ReadSDFile(file_buf,1,buf,0); //读第一条
    03899 2422      CLR	R2
    0389A 822A      STD	Y+2,R2
    0389B 82B9      STD	Y+1,R11
    0389C 82A8      ST	Y,R10
    0389D E021      LDI	R18,1
    0389E E030      LDI	R19,0
    0389F 018E      MOVW	R16,R28
    038A0 5F0D      SUBI	R16,0xFD
    038A1 4F1F      SBCI	R17,0xFF
    038A2 940E 0665 CALL	_ReadSDFile
(0638) 			}
(0639) 			CharToStruct(buf);      //转换
    038A4 0185      MOVW	R16,R10
    038A5 940E 0AAB CALL	_CharToStruct
    038A7 C097      RJMP	0x393F
(0640) 			while(alwaysCheck()){
(0641) 			    key=kbscan();     //键盘扫描
    038A8 940E 44FE CALL	_kbscan
    038AA 2EE0      MOV	R14,R16
    038AB 2D6E      MOV	R22,R14
(0642) 				dateRefresh(0); //只刷新后台时间
    038AC 2700      CLR	R16
    038AD D0B7      RCALL	_dateRefresh
(0643) 				if(key != 0){ 
    038AE 20EE      TST	R14
    038AF F021      BEQ	0x38B4
(0644) 					   beep(0,1);
    038B0 E021      LDI	R18,1
    038B1 2700      CLR	R16
    038B2 940E 4275 CALL	_beep
(0645) 				}
(0646) 				//dateRefresh(0);  //刷新
(0647) 				_GUI_datashow(page); //显示
    038B4 2F04      MOV	R16,R20
    038B5 DA58      RCALL	__GUI_datashow
(0648) 				if( key==left ){ //按left键下一条
    038B6 316B      CPI	R22,0x1B
    038B7 F4A1      BNE	0x38CC
(0649) 					next_item:  //下一条
(0650) 				    ReadSDFile(file_buf,1,buf,1); //偏移到下一条
    038B8 E081      LDI	R24,1
    038B9 838A      STD	Y+2,R24
    038BA 82B9      STD	Y+1,R11
    038BB 82A8      ST	Y,R10
    038BC E021      LDI	R18,1
    038BD E030      LDI	R19,0
    038BE 018E      MOVW	R16,R28
    038BF 5F0D      SUBI	R16,0xFD
    038C0 4F1F      SBCI	R17,0xFF
    038C1 940E 0665 CALL	_ReadSDFile
(0651) 					CharToStruct(buf);
    038C3 0185      MOVW	R16,R10
    038C4 940E 0AAB CALL	_CharToStruct
(0652) 					LCD_CLR();
    038C6 940E 3F9E CALL	_LCD_CLR
(0653) 		    		LCD_Init();
    038C8 940E 3F6C CALL	_LCD_Init
(0654) 					page = 0;
    038CA 2744      CLR	R20
(0655) 					key=0;
    038CB 2766      CLR	R22
(0656) 				}
(0657) 				if( key==lleft ){ //长按left键上一条
    038CC 396B      CPI	R22,0x9B
    038CD F4A1      BNE	0x38E2
(0658) 		    	    pre_item: //上一条
(0659) 					ReadSDFile(file_buf,-1,buf,1); //偏移到上一条
    038CE E081      LDI	R24,1
    038CF 838A      STD	Y+2,R24
    038D0 82B9      STD	Y+1,R11
    038D1 82A8      ST	Y,R10
    038D2 EF2F      LDI	R18,0xFF
    038D3 EF3F      LDI	R19,0xFF
    038D4 018E      MOVW	R16,R28
    038D5 5F0D      SUBI	R16,0xFD
    038D6 4F1F      SBCI	R17,0xFF
    038D7 940E 0665 CALL	_ReadSDFile
(0660) 					CharToStruct(buf);
    038D9 0185      MOVW	R16,R10
    038DA 940E 0AAB CALL	_CharToStruct
(0661) 					LCD_CLR();
    038DC 940E 3F9E CALL	_LCD_CLR
(0662) 		    		LCD_Init();
    038DE 940E 3F6C CALL	_LCD_Init
(0663) 					page = 0;
    038E0 2744      CLR	R20
(0664) 					key=0;
    038E1 2766      CLR	R22
(0665) 				}
(0666) 				if(key==up){ //上键 : 页面减 
    038E2 316E      CPI	R22,0x1E
    038E3 F441      BNE	0x38EC
(0667) 	    		     LCD_CLR();
    038E4 940E 3F9E CALL	_LCD_CLR
(0668) 		    		 LCD_Init();
    038E6 940E 3F6C CALL	_LCD_Init
(0669) 					 if(page>0) page--;
    038E8 E080      LDI	R24,0
    038E9 1784      CP	R24,R20
    038EA F718      BCC	0x38CE
    038EB 954A      DEC	R20
(0670) 	    			 else{ 
(0671) 					    goto pre_item;
(0672) 					 }
(0673) 				}
(0674) 				if(key==lup){ //长按上键 : -10 条 
    038EC 396E      CPI	R22,0x9E
    038ED F4A1      BNE	0x3902
(0675) 	    		     LCD_CLR();
    038EE 940E 3F9E CALL	_LCD_CLR
(0676) 		    		 LCD_Init();
    038F0 940E 3F6C CALL	_LCD_Init
(0677) 					 ReadSDFile(file_buf,-10,buf,1); //偏移到下10条
    038F2 E081      LDI	R24,1
    038F3 838A      STD	Y+2,R24
    038F4 82B9      STD	Y+1,R11
    038F5 82A8      ST	Y,R10
    038F6 EF26      LDI	R18,0xF6
    038F7 EF3F      LDI	R19,0xFF
    038F8 018E      MOVW	R16,R28
    038F9 5F0D      SUBI	R16,0xFD
    038FA 4F1F      SBCI	R17,0xFF
    038FB 940E 0665 CALL	_ReadSDFile
(0678) 					 CharToStruct(buf);
    038FD 0185      MOVW	R16,R10
    038FE 940E 0AAB CALL	_CharToStruct
(0679) 					 page = 0;
    03900 2744      CLR	R20
(0680) 					 key = 0;
    03901 2766      CLR	R22
(0681) 				}
(0682) 				if(key==down){ //下键 ： 页面加
    03902 316D      CPI	R22,0x1D
    03903 F441      BNE	0x390C
(0683) 					LCD_CLR();
    03904 940E 3F9E CALL	_LCD_CLR
(0684) 		    		LCD_Init();
    03906 940E 3F6C CALL	_LCD_Init
(0685) 					if(page<5) page++;
    03908 3045      CPI	R20,5
    03909 F008      BCS	0x390B
    0390A CFAD      RJMP	0x38B8
    0390B 9543      INC	R20
(0686) 	  				else{
(0687) 						goto next_item;
(0688) 					}
(0689) 				}
(0690) 				if(key==ldown){ //长按下键 ： 页面加10条・
    0390C 396D      CPI	R22,0x9D
    0390D F4A1      BNE	0x3922
(0691) 					LCD_CLR();
    0390E 940E 3F9E CALL	_LCD_CLR
(0692) 		    		LCD_Init();
    03910 940E 3F6C CALL	_LCD_Init
(0693) 					page = 0;
    03912 2744      CLR	R20
(0694) 					key = 0;
    03913 2766      CLR	R22
(0695) 	 				ReadSDFile(file_buf,10,buf,1); //偏移到下10条
    03914 E081      LDI	R24,1
    03915 838A      STD	Y+2,R24
    03916 82B9      STD	Y+1,R11
    03917 82A8      ST	Y,R10
    03918 E02A      LDI	R18,0xA
    03919 E030      LDI	R19,0
    0391A 018E      MOVW	R16,R28
    0391B 5F0D      SUBI	R16,0xFD
    0391C 4F1F      SBCI	R17,0xFF
    0391D 940E 0665 CALL	_ReadSDFile
(0696) 					CharToStruct(buf);
    0391F 0185      MOVW	R16,R10
    03920 940E 0AAB CALL	_CharToStruct
(0697) 				}
(0698) 				//右键短按  返回
(0699) 				if(key == right) {
    03922 3167      CPI	R22,0x17
    03923 F429      BNE	0x3929
(0700) 				    LCD_CLR();
    03924 940E 3F9E CALL	_LCD_CLR
(0701) 		    		LCD_Init();
    03926 940E 3F6C CALL	_LCD_Init
(0702) 					goto label_recheck;	   
    03928 CEBD      RJMP	0x37E6
(0703) 				}
(0704) 				if(page == 0 ){
    03929 2344      TST	R20
    0392A F481      BNE	0x393B
(0705) 					LCD_const_disp(4,1,"ID:             ");
    0392B ED80      LDI	R24,0xD0
    0392C E093      LDI	R25,3
    0392D 8399      STD	Y+1,R25
    0392E 8388      ST	Y,R24
    0392F E021      LDI	R18,1
    03930 E004      LDI	R16,4
    03931 940E 3EF8 CALL	_LCD_const_disp
(0706) 					LCD_const_disp(4,3,Result.IndexChar);
    03933 E487      LDI	R24,0x47
    03934 E096      LDI	R25,6
    03935 8399      STD	Y+1,R25
    03936 8388      ST	Y,R24
    03937 E023      LDI	R18,3
    03938 E004      LDI	R16,4
    03939 940E 3EF8 CALL	_LCD_const_disp
(0707) 				}
(0708) 
(0709)     			delayms(30); 
    0393B E10E      LDI	R16,0x1E
    0393C E010      LDI	R17,0
    0393D 940E 2D55 CALL	_delayms
    0393F 940E 0477 CALL	_alwaysCheck
    03941 2EE0      MOV	R14,R16
    03942 2300      TST	R16
    03943 F009      BEQ	0x3945
    03944 CF63      RJMP	0x38A8
(0710) 		 }//end while
(0711) 		   
(0712) 	}
(0713) 	else { //未找到或未确认文件
(0714) 		 //逆序查找文件，直到月份小于 200001.xls
(0715) 		 //或是手工确认的方式
(0716) 	}
    03945 9660      ADIW	R28,0x10
    03946 940C 4B12 JMP	pop_xgsetF0FC
_GUI_welcome:
    03948 9722      SBIW	R28,2
(0717) 
(0718) }
(0719) void GUI_welcome(void){
(0720)     LCD_CLR(); //清屏
    03949 940E 3F9E CALL	_LCD_CLR
(0721) 	LCD_const_disp(2,3,"欢迎使用");
    0394B EC87      LDI	R24,0xC7
    0394C E093      LDI	R25,3
    0394D 8399      STD	Y+1,R25
    0394E 8388      ST	Y,R24
    0394F E023      LDI	R18,3
    03950 E002      LDI	R16,2
    03951 940E 3EF8 CALL	_LCD_const_disp
(0722) 	LCD_const_disp(3,1,"环境冷强度检测仪");
    03953 EB86      LDI	R24,0xB6
    03954 E093      LDI	R25,3
    03955 8399      STD	Y+1,R25
    03956 8388      ST	Y,R24
    03957 E021      LDI	R18,1
    03958 E003      LDI	R16,3
    03959 940E 3EF8 CALL	_LCD_const_disp
(0723) 	delayms(800);
    0395B E200      LDI	R16,0x20
    0395C E013      LDI	R17,3
    0395D 940E 2D55 CALL	_delayms
(0724) 	beep(0,1);
    0395F E021      LDI	R18,1
    03960 2700      CLR	R16
    03961 940E 4275 CALL	_beep
    03963 9622      ADIW	R28,2
    03964 9508      RET
_dateRefresh:
  readhardware         --> R20
    03965 934A      ST	-Y,R20
    03966 2F40      MOV	R20,R16
(0725) 	
(0726) }
(0727) 
(0728) ////////////////////////////////////
(0729) //  函数作用
(0730) //   将ds1302中缓存的时钟数据转换进结构体中
(0731) ////////////////////////////////////
(0732) void dateRefresh(unsigned char readhardware)
(0733) {	//readhardware = 0 not refresh, =1 refresh
(0734) 
(0735)  if( readhardware!=88 )	ds1302_read_time();
    03967 3548      CPI	R20,0x58
    03968 F011      BEQ	0x396B
    03969 940E 44D6 CALL	_ds1302_read_time
(0736) 	t.tm_sec=(((time_buf[6]&0x70)>>4)*10)+(time_buf[6]&0x0f);
    0396B 9110 05E5 LDS	R17,time_buf+6
    0396D 7710      ANDI	R17,0x70
    0396E 9512      SWAP	R17
    0396F 701F      ANDI	R17,0xF
    03970 E00A      LDI	R16,0xA
    03971 0301      MULSU	R16,R17
    03972 0110      MOVW	R2,R0
    03973 9180 05E5 LDS	R24,time_buf+6
    03975 2799      CLR	R25
    03976 708F      ANDI	R24,0xF
    03977 7090      ANDI	R25,0
    03978 0E28      ADD	R2,R24
    03979 1E39      ADC	R3,R25
    0397A 9230 089A STS	t+1,R3
    0397C 9220 0899 STS	t,R2
(0737) 	t.tm_min=  (((time_buf[5]&0x70)>>4)*10)+(time_buf[5]&0x0f);
    0397E 9110 05E4 LDS	R17,time_buf+5
    03980 7710      ANDI	R17,0x70
    03981 9512      SWAP	R17
    03982 701F      ANDI	R17,0xF
    03983 0301      MULSU	R16,R17
    03984 0110      MOVW	R2,R0
    03985 9180 05E4 LDS	R24,time_buf+5
    03987 2799      CLR	R25
    03988 708F      ANDI	R24,0xF
    03989 7090      ANDI	R25,0
    0398A 0E28      ADD	R2,R24
    0398B 1E39      ADC	R3,R25
    0398C 9230 089C STS	t+3,R3
    0398E 9220 089B STS	t+2,R2
(0738) 	t.tm_hour=  (((time_buf[4]&0x70)>>4)*10)+(time_buf[4]&0x0f);
    03990 9110 05E3 LDS	R17,time_buf+4
    03992 7710      ANDI	R17,0x70
    03993 9512      SWAP	R17
    03994 701F      ANDI	R17,0xF
    03995 0301      MULSU	R16,R17
    03996 0110      MOVW	R2,R0
    03997 9180 05E3 LDS	R24,time_buf+4
    03999 2799      CLR	R25
    0399A 708F      ANDI	R24,0xF
    0399B 7090      ANDI	R25,0
    0399C 0E28      ADD	R2,R24
    0399D 1E39      ADC	R3,R25
    0399E 9230 089E STS	t+5,R3
    039A0 9220 089D STS	t+4,R2
(0739) 	t.tm_mday=	(((time_buf[3]&0x70)>>4)*10)+(time_buf[3]&0x0f);
    039A2 9110 05E2 LDS	R17,time_buf+3
    039A4 7710      ANDI	R17,0x70
    039A5 9512      SWAP	R17
    039A6 701F      ANDI	R17,0xF
    039A7 0301      MULSU	R16,R17
    039A8 0110      MOVW	R2,R0
    039A9 9180 05E2 LDS	R24,time_buf+3
    039AB 2799      CLR	R25
    039AC 708F      ANDI	R24,0xF
    039AD 7090      ANDI	R25,0
    039AE 0E28      ADD	R2,R24
    039AF 1E39      ADC	R3,R25
    039B0 9230 08A0 STS	t+7,R3
    039B2 9220 089F STS	t+6,R2
(0740) 	t.tm_mon= (((time_buf[2]&0x70)>>4)*10)+(time_buf[2]&0x0f);
    039B4 9110 05E1 LDS	R17,time_buf+2
    039B6 7710      ANDI	R17,0x70
    039B7 9512      SWAP	R17
    039B8 701F      ANDI	R17,0xF
    039B9 0301      MULSU	R16,R17
    039BA 0110      MOVW	R2,R0
    039BB 9180 05E1 LDS	R24,time_buf+2
    039BD 2799      CLR	R25
    039BE 708F      ANDI	R24,0xF
    039BF 7090      ANDI	R25,0
    039C0 0E28      ADD	R2,R24
    039C1 1E39      ADC	R3,R25
    039C2 9230 08A2 STS	t+9,R3
    039C4 9220 08A1 STS	t+8,R2
(0741) 	t.tm_wday=	(time_buf[7]&0x0f);
    039C6 9180 05E6 LDS	R24,time_buf+7
    039C8 2799      CLR	R25
    039C9 708F      ANDI	R24,0xF
    039CA 7090      ANDI	R25,0
    039CB 9390 08A6 STS	t+13,R25
    039CD 9380 08A5 STS	t+12,R24
(0742)     t.tm_year=	(((time_buf[1]&0x70)>>4)*10)+(time_buf[1]&0x0f);
    039CF 9110 05E0 LDS	R17,time_buf+1
    039D1 7710      ANDI	R17,0x70
    039D2 9512      SWAP	R17
    039D3 701F      ANDI	R17,0xF
    039D4 0301      MULSU	R16,R17
    039D5 0110      MOVW	R2,R0
    039D6 9180 05E0 LDS	R24,time_buf+1
    039D8 2799      CLR	R25
    039D9 708F      ANDI	R24,0xF
    039DA 7090      ANDI	R25,0
    039DB 0E28      ADD	R2,R24
    039DC 1E39      ADC	R3,R25
    039DD 9230 08A4 STS	t+11,R3
    039DF 9220 08A3 STS	t+10,R2
(0743) 	if(readhardware != 0){
    039E1 2344      TST	R20
    039E2 F409      BNE	0x39E4
    039E3 C09F      RJMP	0x3A83
(0744) 	Result.Date[0]='2';
    039E4 E382      LDI	R24,0x32
    039E5 9380 064F STS	Result+22,R24
(0745) 	Result.Date[1]='0';
    039E7 E380      LDI	R24,0x30
    039E8 9380 0650 STS	Result+23,R24
(0746) 	Result.Date[2]=t.tm_year/10+'0';
    039EA E02A      LDI	R18,0xA
    039EB E030      LDI	R19,0
    039EC 0181      MOVW	R16,R2
    039ED 940E 49ED CALL	div16s
    039EF 01C8      MOVW	R24,R16
    039F0 96C0      ADIW	R24,0x30
    039F1 9380 0651 STS	Result+24,R24
(0747) 	Result.Date[3]=t.tm_year%10+'0';
    039F3 E02A      LDI	R18,0xA
    039F4 E030      LDI	R19,0
    039F5 9100 08A3 LDS	R16,t+10
    039F7 9110 08A4 LDS	R17,t+11
    039F9 940E 49E9 CALL	mod16s
    039FB 01C8      MOVW	R24,R16
    039FC 96C0      ADIW	R24,0x30
    039FD 9380 0652 STS	Result+25,R24
(0748) 	Result.Date[4]=t.tm_mon/10+'0';
    039FF E02A      LDI	R18,0xA
    03A00 E030      LDI	R19,0
    03A01 9100 08A1 LDS	R16,t+8
    03A03 9110 08A2 LDS	R17,t+9
    03A05 940E 49ED CALL	div16s
    03A07 01C8      MOVW	R24,R16
    03A08 96C0      ADIW	R24,0x30
    03A09 9380 0653 STS	Result+26,R24
(0749) 	Result.Date[5]=t.tm_mon%10+'0';
    03A0B E02A      LDI	R18,0xA
    03A0C E030      LDI	R19,0
    03A0D 9100 08A1 LDS	R16,t+8
    03A0F 9110 08A2 LDS	R17,t+9
    03A11 940E 49E9 CALL	mod16s
    03A13 01C8      MOVW	R24,R16
    03A14 96C0      ADIW	R24,0x30
    03A15 9380 0654 STS	Result+27,R24
(0750) 	Result.Date[6]=t.tm_mday/10+'0';
    03A17 E02A      LDI	R18,0xA
    03A18 E030      LDI	R19,0
    03A19 9100 089F LDS	R16,t+6
    03A1B 9110 08A0 LDS	R17,t+7
    03A1D 940E 49ED CALL	div16s
    03A1F 01C8      MOVW	R24,R16
    03A20 96C0      ADIW	R24,0x30
    03A21 9380 0655 STS	Result+28,R24
(0751) 	Result.Date[7]=t.tm_mday%10+'0';
    03A23 E02A      LDI	R18,0xA
    03A24 E030      LDI	R19,0
    03A25 9100 089F LDS	R16,t+6
    03A27 9110 08A0 LDS	R17,t+7
    03A29 940E 49E9 CALL	mod16s
    03A2B 01C8      MOVW	R24,R16
    03A2C 96C0      ADIW	R24,0x30
    03A2D 9380 0656 STS	Result+29,R24
(0752)     Result.Date[8]='\0';
    03A2F 2422      CLR	R2
    03A30 9220 0657 STS	Result+30,R2
(0753) 
(0754) 	Result.Time[0]=t.tm_hour/10+'0';
    03A32 E02A      LDI	R18,0xA
    03A33 E030      LDI	R19,0
    03A34 9100 089D LDS	R16,t+4
    03A36 9110 089E LDS	R17,t+5
    03A38 940E 49ED CALL	div16s
    03A3A 01C8      MOVW	R24,R16
    03A3B 96C0      ADIW	R24,0x30
    03A3C 9380 0658 STS	Result+31,R24
(0755) 	Result.Time[1]=t.tm_hour%10+'0';
    03A3E E02A      LDI	R18,0xA
    03A3F E030      LDI	R19,0
    03A40 9100 089D LDS	R16,t+4
    03A42 9110 089E LDS	R17,t+5
    03A44 940E 49E9 CALL	mod16s
    03A46 01C8      MOVW	R24,R16
    03A47 96C0      ADIW	R24,0x30
    03A48 9380 0659 STS	Result+32,R24
(0756) 	Result.Time[2]=':';
    03A4A E38A      LDI	R24,0x3A
    03A4B 9380 065A STS	Result+33,R24
(0757) 	//Result.Time[3]=' ';
(0758) 	Result.Time[3]=t.tm_min/10+'0';
    03A4D E02A      LDI	R18,0xA
    03A4E E030      LDI	R19,0
    03A4F 9100 089B LDS	R16,t+2
    03A51 9110 089C LDS	R17,t+3
    03A53 940E 49ED CALL	div16s
    03A55 01C8      MOVW	R24,R16
    03A56 96C0      ADIW	R24,0x30
    03A57 9380 065B STS	Result+34,R24
(0759) 	Result.Time[4]=t.tm_min%10+'0';
    03A59 E02A      LDI	R18,0xA
    03A5A E030      LDI	R19,0
    03A5B 9100 089B LDS	R16,t+2
    03A5D 9110 089C LDS	R17,t+3
    03A5F 940E 49E9 CALL	mod16s
    03A61 01C8      MOVW	R24,R16
    03A62 96C0      ADIW	R24,0x30
    03A63 9380 065C STS	Result+35,R24
(0760) 	Result.Time[5]=':';
    03A65 E38A      LDI	R24,0x3A
    03A66 9380 065D STS	Result+36,R24
(0761) 	//Result.Time[7]=' ';
(0762) 	Result.Time[6]=t.tm_sec/10+'0';
    03A68 E02A      LDI	R18,0xA
    03A69 E030      LDI	R19,0
    03A6A 9100 0899 LDS	R16,t
    03A6C 9110 089A LDS	R17,t+1
    03A6E 940E 49ED CALL	div16s
    03A70 01C8      MOVW	R24,R16
    03A71 96C0      ADIW	R24,0x30
    03A72 9380 065E STS	Result+37,R24
(0763) 	Result.Time[7]=t.tm_sec%10+'0';
    03A74 E02A      LDI	R18,0xA
    03A75 E030      LDI	R19,0
    03A76 9100 0899 LDS	R16,t
    03A78 9110 089A LDS	R17,t+1
    03A7A 940E 49E9 CALL	mod16s
    03A7C 01C8      MOVW	R24,R16
    03A7D 96C0      ADIW	R24,0x30
    03A7E 9380 065F STS	Result+38,R24
(0764) 	Result.Time[8]='\0'; 
    03A80 2422      CLR	R2
    03A81 9220 0660 STS	Result+39,R2
(0765) 	}
(0766)     config.now =t.tm_hour*3600 + t.tm_min*60 + t.tm_sec; //更新系统心跳
    03A83 9120 089B LDS	R18,t+2
    03A85 9130 089C LDS	R19,t+3
    03A87 E30C      LDI	R16,0x3C
    03A88 E010      LDI	R17,0
    03A89 940E 4AB9 CALL	empy16s
    03A8B 0118      MOVW	R2,R16
    03A8C 9120 089D LDS	R18,t+4
    03A8E 9130 089E LDS	R19,t+5
    03A90 E100      LDI	R16,0x10
    03A91 E01E      LDI	R17,0xE
    03A92 940E 4AB9 CALL	empy16s
    03A94 0128      MOVW	R4,R16
    03A95 0C42      ADD	R4,R2
    03A96 1C53      ADC	R5,R3
    03A97 9020 0899 LDS	R2,t
    03A99 9030 089A LDS	R3,t+1
    03A9B 0C42      ADD	R4,R2
    03A9C 1C53      ADC	R5,R3
    03A9D 0112      MOVW	R2,R4
    03A9E 2444      CLR	R4
    03A9F FC37      SBRC	R3,7
    03AA0 9440      COM	R4
    03AA1 2455      CLR	R5
    03AA2 FC47      SBRC	R4,7
    03AA3 9450      COM	R5
    03AA4 9230 08B7 STS	config+12,R3
    03AA6 9220 08B6 STS	config+11,R2
    03AA8 9250 08B9 STS	config+14,R5
    03AAA 9240 08B8 STS	config+13,R4
    03AAC 9149      LD	R20,Y+
    03AAD 9508      RET
FILE: D:\LQD\software\software_src\zigbee.c
(0001) /*  此文件定义了从机zigbee的模块自检 及 与上位机通信的相关函数
(0002) *   版本 V1.0
(0003) *   日期 2012 08 10
(0004) *   版本历史：
(0005) * 数据格式
(0006) * 帧头    长度    目的地址   命令  内容     校验    帧尾
(0007) * FA       AA      B1        D1    01 03    00 00    fb  
(0008) *
(0009) *
(0010) *
(0011) ************/
(0012) #include "config.h"
(0013) 
(0014) #ifndef _DEVICE_INFOMATION_
(0015) #define _DEVICE_INFOMATION_
(0016) //设备相关信息 可存进EEPROM 调试阶段暂时做成全局常量
(0017) 
(0018) const char CommonId = 0xFF; //从设备公共ID
(0019) /***************配置设备ID***************/
(0020) #define _DEVICE_ID 1
(0021) /**************************************/
(0022) #if   _DEVICE_ID == 1 
(0023) char devicename[8] = {"DEV00001"};//设备名称
(0024) const char deviceId = 0xB1;//设备ID		
(0025) #elif  _DEVICE_ID == 2 
(0026) char devicename[8] = {"DEV000002"};//设备名称
(0027) const char deviceId = 0xB2;//设备ID		
(0028) #elif  _DEVICE_ID == 3  
(0029) char devicename[8] = {"DEV000003"};//设备名称
(0030) const char deviceId = 0xB3;//设备ID		
(0031) #elif  _DEVICE_ID == 4  
(0032) char devicename[8] = {"DEV000004"};//设备名称
(0033) const char deviceId = 0xB4;//设备ID		
(0034) #elif  _DEVICE_ID == 5  
(0035) char devicename[8] = {"DEV000005"};//设备名称
(0036) const char deviceId = 0xB5;//设备ID		
(0037) #elif  _DEVICE_ID == 6  
(0038) char devicename[8] = {"DEV000006"};//设备名称
(0039) const char deviceId = 0xB6;//设备ID		
(0040) #endif
(0041) 
(0042) //char *reslut_a ="Dev000001,0001,20120920,12:00,-40.5,12.3,-55.5,-40.4,-40.3";
(0043) 
(0044) //char *p2 = "a123456789b12456789c123456789d123456789e123456789f12456789g123456789h12345789i12456789";
(0045) #endif
(0046)  
(0047) 
(0048) #define FRAME_LEN     13
(0049) #define STORAGE_DB_AND_SD  0
(0050) #define STORAGE_DB		   1
(0051) #define STORAGE_SD		   2
(0052) #define Z_CMD0 0xD0   
(0053) //命令0 响应查找从机命令
(0054) 
(0055) #define Z_CMD1_DATE 0xD1
(0056) //命令1 发送 采样日期  Result.Date
(0057) 
(0058) #define Z_CMD2_TIME 0xD2
(0059) //命令2 发送 采样时间  Result.Time
(0060) 
(0061) #define Z_CMD3_TEMPERATURE 0xD3
(0062) //命令3 发送 温度
(0063) 
(0064) #define Z_CMD4_WS 0xD4
(0065) //命令4 发送风速
(0066) 
(0067) #define Z_CMD5_WCI 0xD5
(0068) //命令5 发送WCI
(0069) 
(0070) #define Z_CMD6_ETC 0xD6
(0071) //命令6 发送ETC
(0072) 
(0073) #define Z_CMD7_TEQ 0xD7
(0074) //命令7 发送TEQ
(0075) 
(0076) #define Z_CMD8_OTHER 0xD8
(0077) //命令8 发送冻伤危害性和轻、重、中四个字节的数据
(0078) 
(0079) #define Z_CMD9_SINGLE 0xD9
(0080) //命令09 单次检测
(0081) 
(0082) #define Z_CMD8_CYCLE 0xDA
(0083) //命令10 循环检测
(0084) 
(0085) #define Z_CMD8_STOP 0xDB
(0086) //命令11 中止检测
(0087) 
(0088) #define Z_CMD8_SYNC 0xDC
(0089) //命令12 同步时钟
(0090) 
(0091) #define Z_CMD8_GET_DATA 0xDD
(0092) //命令13 请求数据
(0093) 
(0094) #define Z_CMD9_SET_STORAGE 0xDE
(0095) //命令9 设置存储位置
(0096) 
(0097) struct buffer_struct Rec;
(0098) //缓存池 Buf[100] ;
(0099) //读缓存指针BufReadP;
(0100) //写缓存指针BufWriteP;
(0101) //当前缓存个数 BufCount;
(0102) 
(0103) //struct SendStruct Send; 
(0104) 
(0105) void zigbee_init( void )
(0106) {
(0107)   Rec.BufReadP=0;
_zigbee_init:
    03AAE 2422      CLR	R2
    03AAF 9220 091F STS	Rec+90,R2
(0108)   Rec.BufWriteP=0;
    03AB1 9220 0920 STS	Rec+91,R2
(0109)   Rec.BufCount=0;
    03AB3 9220 0921 STS	Rec+92,R2
    03AB5 9508      RET
(0110) }
(0111) unsigned char RecAdd(unsigned char ByteRec)
(0112) {
(0113)   if (Rec.BufWriteP >= BufSize)  
_RecAdd:
  ByteRec              --> R16
    03AB6 9180 0920 LDS	R24,Rec+91
    03AB8 358A      CPI	R24,0x5A
    03AB9 F018      BCS	0x3ABD
(0114)   	 Rec.BufWriteP=0;
    03ABA 2422      CLR	R2
    03ABB 9220 0920 STS	Rec+91,R2
(0115)   Rec.Buf[Rec.BufWriteP++] = ByteRec ;
    03ABD 9020 0920 LDS	R2,Rec+91
    03ABF 2D82      MOV	R24,R2
    03AC0 5F8F      SUBI	R24,0xFF
    03AC1 9380 0920 STS	Rec+91,R24
    03AC3 EC85      LDI	R24,0xC5
    03AC4 E098      LDI	R25,0x8
    03AC5 2DE2      MOV	R30,R2
    03AC6 27FF      CLR	R31
    03AC7 0FE8      ADD	R30,R24
    03AC8 1FF9      ADC	R31,R25
    03AC9 8300      ST	Z,R16
(0116)   Rec.BufCount++;
    03ACA 9180 0921 LDS	R24,Rec+92
    03ACC 5F8F      SUBI	R24,0xFF
    03ACD 9380 0921 STS	Rec+92,R24
(0117)   return Rec.BufWriteP;
    03ACF 9100 0920 LDS	R16,Rec+91
    03AD1 9508      RET
_RecRemove:
  N                    --> R10
    03AD2 92AA      ST	-Y,R10
    03AD3 2EA0      MOV	R10,R16
(0118) } 
(0119) 
(0120) void RecRemove(char N)
(0121) { 
(0122)   if(Rec.BufCount >= N ) 
    03AD4 9020 0921 LDS	R2,Rec+92
    03AD6 142A      CP	R2,R10
    03AD7 F168      BCS	0x3B05
(0123)   {  debug("DEL=",Rec.Buf[Rec.BufReadP]);
    03AD8 EC85      LDI	R24,0xC5
    03AD9 E098      LDI	R25,0x8
    03ADA 91E0 091F LDS	R30,Rec+90
    03ADC 27FF      CLR	R31
    03ADD 0FE8      ADD	R30,R24
    03ADE 1FF9      ADC	R31,R25
    03ADF 8120      LD	R18,Z
    03AE0 EB0E      LDI	R16,0xBE
    03AE1 E015      LDI	R17,5
    03AE2 940E 0BCB CALL	_debug
(0124)      Rec.Buf[Rec.BufReadP]=0x00; 
    03AE4 EC85      LDI	R24,0xC5
    03AE5 E098      LDI	R25,0x8
    03AE6 91E0 091F LDS	R30,Rec+90
    03AE8 27FF      CLR	R31
    03AE9 0FE8      ADD	R30,R24
    03AEA 1FF9      ADC	R31,R25
    03AEB 2422      CLR	R2
    03AEC 8220      ST	Z,R2
(0125)    	 Rec.BufReadP=Rec.BufReadP+N;
    03AED 9020 091F LDS	R2,Rec+90
    03AEF 0C2A      ADD	R2,R10
    03AF0 9220 091F STS	Rec+90,R2
(0126) 	 if(Rec.BufReadP >= BufSize) {
    03AF2 2D82      MOV	R24,R2
    03AF3 358A      CPI	R24,0x5A
    03AF4 F018      BCS	0x3AF8
(0127) 	 				 		 Rec.BufReadP =Rec.BufReadP-BufSize;
    03AF5 558A      SUBI	R24,0x5A
    03AF6 9380 091F STS	Rec+90,R24
(0128) 							 }
(0129) 	 Rec.BufCount=Rec.BufCount-N;
    03AF8 9020 0921 LDS	R2,Rec+92
    03AFA 182A      SUB	R2,R10
    03AFB 9220 0921 STS	Rec+92,R2
(0130) 	 if(Rec.BufCount==0) {
    03AFD 2022      TST	R2
    03AFE F469      BNE	0x3B0C
(0131) 	 Rec.BufReadP=0;
    03AFF 2422      CLR	R2
    03B00 9220 091F STS	Rec+90,R2
(0132)      Rec.BufWriteP=0;
    03B02 9220 0920 STS	Rec+91,R2
(0133) 	 
(0134) 	 }
(0135) 	 
(0136)   }
    03B04 C007      RJMP	0x3B0C
(0137)   else 
(0138)   {  //移除量大于现有量 移除所有 计数清零
(0139)     Rec.BufReadP=0;
    03B05 2422      CLR	R2
    03B06 9220 091F STS	Rec+90,R2
(0140)     Rec.BufWriteP=0;
    03B08 9220 0920 STS	Rec+91,R2
(0141)     Rec.BufCount=0;
    03B0A 9220 0921 STS	Rec+92,R2
(0142)   
(0143)   }
    03B0C 90A9      LD	R10,Y+
    03B0D 9508      RET
_RecRead:
  tmp                  --> R20
  index                --> R16
    03B0E 934A      ST	-Y,R20
    03B0F 935A      ST	-Y,R21
(0144)  }
(0145) char  RecRead(unsigned char index)
(0146) { 
(0147)   int tmp;
(0148)   if(Rec.BufCount < index) 
    03B10 9020 0921 LDS	R2,Rec+92
    03B12 1620      CP	R2,R16
    03B13 F410      BCC	0x3B16
(0149)   	return 0;
    03B14 2700      CLR	R16
    03B15 C013      RJMP	0x3B29
(0150) 	
(0151)   tmp=Rec.BufReadP+index;
    03B16 2E20      MOV	R2,R16
    03B17 2433      CLR	R3
    03B18 9140 091F LDS	R20,Rec+90
    03B1A 2755      CLR	R21
    03B1B 0D42      ADD	R20,R2
    03B1C 1D53      ADC	R21,R3
(0152)   if(tmp>=BufSize)  {tmp=tmp-BufSize;}
    03B1D 354A      CPI	R20,0x5A
    03B1E E0E0      LDI	R30,0
    03B1F 075E      CPC	R21,R30
    03B20 F014      BLT	0x3B23
    03B21 554A      SUBI	R20,0x5A
    03B22 4050      SBCI	R21,0
(0153)   return Rec.Buf[tmp-1];
    03B23 EC84      LDI	R24,0xC4
    03B24 E098      LDI	R25,0x8
    03B25 01FA      MOVW	R30,R20
    03B26 0FE8      ADD	R30,R24
    03B27 1FF9      ADC	R31,R25
    03B28 8100      LD	R16,Z
    03B29 9159      LD	R21,Y+
    03B2A 9149      LD	R20,Y+
    03B2B 9508      RET
_CheckCRC:
  i                    --> Y,+0
    03B2C 931A      ST	-Y,R17
    03B2D 930A      ST	-Y,R16
(0154) } 
(0155) 
(0156) 
(0157) char CheckCRC(unsigned char i)
(0158) {
(0159)  i=i;
(0160)  return 1;  //校验成功
    03B2E E001      LDI	R16,1
    03B2F 9622      ADIW	R28,2
    03B30 9508      RET
_RecDeal:
  buf                  --> Y,+1
  state                --> R20
  tmp                  --> R10
  i                    --> R22
    03B31 940E 4B3C CALL	push_xgsetF00C
    03B33 9726      SBIW	R28,6
(0161) 
(0162) }
(0163) #define res Result
(0164)  //1 找头 2找长度 3计算尾 4找尾 5核对校验码 6分析命令 7执行操作
(0165) unsigned char RecDeal( void )
(0166) { 
(0167)   int i=0 , tmp=0, state=0 ;
    03B34 24AA      CLR	R10
    03B35 24BB      CLR	R11
    03B36 2744      CLR	R20
    03B37 2755      CLR	R21
(0168)   char buf[5];
(0169)   //[TASK :找帧头]
(0170)   for(i=0;i <= Rec.BufCount ; i++ ){ 
    03B38 2766      CLR	R22
    03B39 2777      CLR	R23
    03B3A C013      RJMP	0x3B4E
(0171)       tmp = RecRead(1);    //读出当前值
    03B3B E001      LDI	R16,1
    03B3C DFD1      RCALL	_RecRead
    03B3D 2EA0      MOV	R10,R16
    03B3E 24BB      CLR	R11
(0172) 	  if(tmp != FRAME_HEAD ) {
    03B3F 01C5      MOVW	R24,R10
    03B40 3F8A      CPI	R24,0xFA
    03B41 E0E0      LDI	R30,0
    03B42 079E      CPC	R25,R30
    03B43 F029      BEQ	0x3B49
(0173) 	      state = 1; //已查找无帧头
    03B44 E041      LDI	R20,1
    03B45 E050      LDI	R21,0
(0174) 		  RecRemove(1);
    03B46 E001      LDI	R16,1
    03B47 DF8A      RCALL	_RecRemove
(0175) 	  }		  
    03B48 C003      RJMP	0x3B4C
(0176) 	  else{	  //已找到帧头 跳出循环
(0177)       state = 2 ;  //已找到帧头 标志	 
    03B49 E042      LDI	R20,2
    03B4A E050      LDI	R21,0
(0178) 	  break ;
    03B4B C008      RJMP	0x3B54
    03B4C 5F6F      SUBI	R22,0xFF
    03B4D 4F7F      SBCI	R23,0xFF
    03B4E 9020 0921 LDS	R2,Rec+92
    03B50 2433      CLR	R3
    03B51 1626      CP	R2,R22
    03B52 0637      CPC	R3,R23
    03B53 F73C      BGE	0x3B3B
(0179) 	  }
(0180)  }		
(0181)  
(0182)  if(Rec.BufCount < FRAME_LEN) return 0x01;  //缓冲区数据太少  直接返回
    03B54 9180 0921 LDS	R24,Rec+92
    03B56 308D      CPI	R24,0xD
    03B57 F410      BCC	0x3B5A
    03B58 E001      LDI	R16,1
    03B59 C0A7      RJMP	0x3C01
(0183)  
(0184)  if(state == 1 || Rec.BufCount< FRAME_LEN ) return 0x03; //退出函数  无帧头
    03B5A 3041      CPI	R20,1
    03B5B E0E0      LDI	R30,0
    03B5C 075E      CPC	R21,R30
    03B5D F021      BEQ	0x3B62
    03B5E 9180 0921 LDS	R24,Rec+92
    03B60 308D      CPI	R24,0xD
    03B61 F410      BCC	0x3B64
    03B62 E003      LDI	R16,3
    03B63 C09D      RJMP	0x3C01
(0185)  //debug("#FRAME END =",RecRead(FRAME_LEN));
(0186)  //debug("#RECREAD(3) =",RecRead(3));
(0187)  if(RecRead(FRAME_LEN) != FRAME_END || ((RecRead(3)!=deviceId)&& (RecRead(3)!=CommonId) )  )  //非成帧数据或ID不符
    03B64 E00D      LDI	R16,0xD
    03B65 DFA8      RCALL	_RecRead
    03B66 3F0B      CPI	R16,0xFB
    03B67 F471      BNE	0x3B76
    03B68 E003      LDI	R16,3
    03B69 DFA4      RCALL	_RecRead
    03B6A 2EA0      MOV	R10,R16
    03B6B 9020 05BD LDS	R2,deviceId
    03B6D 1502      CP	R16,R2
    03B6E F059      BEQ	0x3B7A
    03B6F E003      LDI	R16,3
    03B70 DF9D      RCALL	_RecRead
    03B71 2EA0      MOV	R10,R16
    03B72 9020 05B4 LDS	R2,CommonId
    03B74 1502      CP	R16,R2
    03B75 F021      BEQ	0x3B7A
(0188)  {
(0189)     RecRemove(1);	//移除命令
    03B76 E001      LDI	R16,1
    03B77 DF5A      RCALL	_RecRemove
(0190)     return 0x05;    //非成帧数据 或ID不符
    03B78 E005      LDI	R16,5
    03B79 C087      RJMP	0x3C01
(0191)  }
(0192)  else if((CheckCRC(FRAME_LEN)==1))   //校验通过
    03B7A E00D      LDI	R16,0xD
    03B7B DFB0      RCALL	_CheckCRC
    03B7C 2F40      MOV	R20,R16
    03B7D 3001      CPI	R16,1
    03B7E F009      BEQ	0x3B80
    03B7F C07C      RJMP	0x3BFC
(0193)  {
(0194)      switch(RecRead(4)){
    03B80 E004      LDI	R16,4
    03B81 DF8C      RCALL	_RecRead
    03B82 2EA0      MOV	R10,R16
    03B83 2D4A      MOV	R20,R10
    03B84 2755      CLR	R21
    03B85 3D40      CPI	R20,0xD0
    03B86 E0E0      LDI	R30,0
    03B87 075E      CPC	R21,R30
    03B88 F40C      BGE	0x3B8A
    03B89 C070      RJMP	0x3BFA
    03B8A ED8E      LDI	R24,0xDE
    03B8B E090      LDI	R25,0
    03B8C 1784      CP	R24,R20
    03B8D 0795      CPC	R25,R21
    03B8E F40C      BGE	0x3B90
    03B8F C06A      RJMP	0x3BFA
    03B90 E88C      LDI	R24,0x8C
    03B91 E090      LDI	R25,0
    03B92 01FA      MOVW	R30,R20
    03B93 5DE0      SUBI	R30,0xD0
    03B94 40F0      SBCI	R31,0
    03B95 0FEE      LSL	R30
    03B96 1FFF      ROL	R31
    03B97 0FE8      ADD	R30,R24
    03B98 1FF9      ADC	R31,R25
    03B99 9027      ELPM	R2,Z+
    03B9A 9036      ELPM	R3,Z
    03B9B 01F1      MOVW	R30,R2
    03B9C 9409      IJMP
(0195)          case Z_CMD0 :  //发送设备信息
(0196) 		 Send_string((char *)devicename,Z_CMD0,sizeof(devicename));
    03B9D E088      LDI	R24,0x8
    03B9E 8388      ST	Y,R24
    03B9F ED20      LDI	R18,0xD0
    03BA0 EB05      LDI	R16,0xB5
    03BA1 E015      LDI	R17,5
    03BA2 D061      RCALL	_Send_string
(0197) 		 RecRemove(12);
    03BA3 E00C      LDI	R16,0xC
    03BA4 DF2D      RCALL	_RecRemove
(0198) 	     return Z_CMD0;  //发送完成 返回成功
    03BA5 ED00      LDI	R16,0xD0
    03BA6 C05A      RJMP	0x3C01
(0199) 		 break ;
(0200)   		
(0201) 		 case Z_CMD1_DATE :  //发送日期
(0202) 		 Send_string(res.Date, Z_CMD1_DATE, 9);
    03BA7 E089      LDI	R24,0x9
    03BA8 8388      ST	Y,R24
    03BA9 ED21      LDI	R18,0xD1
    03BAA E40F      LDI	R16,0x4F
    03BAB E016      LDI	R17,6
    03BAC D057      RCALL	_Send_string
(0203) 		 return Z_CMD1_DATE;  //发送完成 返回成功
    03BAD ED01      LDI	R16,0xD1
    03BAE C052      RJMP	0x3C01
(0204) 		 break ;	
(0205) 		 
(0206) 		 case Z_CMD2_TIME :  //发送Time
(0207) 		 Send_string(res.Time, Z_CMD2_TIME, 10);
    03BAF E08A      LDI	R24,0xA
    03BB0 8388      ST	Y,R24
    03BB1 ED22      LDI	R18,0xD2
    03BB2 E508      LDI	R16,0x58
    03BB3 E016      LDI	R17,6
    03BB4 D04F      RCALL	_Send_string
(0208) 		 return Z_CMD2_TIME;  //发送完成 返回成功
    03BB5 ED02      LDI	R16,0xD2
    03BB6 C04A      RJMP	0x3C01
(0209) 		 break ;	
(0210) 		 
(0211) 		 case Z_CMD3_TEMPERATURE :  //发送温度
(0212) 		 Send_string(res.TempChar, Z_CMD3_TEMPERATURE, 6);
    03BB7 E086      LDI	R24,6
    03BB8 8388      ST	Y,R24
    03BB9 ED23      LDI	R18,0xD3
    03BBA E606      LDI	R16,0x66
    03BBB E016      LDI	R17,6
    03BBC D047      RCALL	_Send_string
(0213) 		 return Z_CMD3_TEMPERATURE;  //发送完成 返回成功
    03BBD ED03      LDI	R16,0xD3
    03BBE C042      RJMP	0x3C01
(0214) 		 break ;	
(0215) 		 
(0216) 		 case Z_CMD4_WS :  //发送WSChar
(0217) 		 Send_string(res.WSChar, Z_CMD4_WS, 5);
    03BBF E085      LDI	R24,5
    03BC0 8388      ST	Y,R24
    03BC1 ED24      LDI	R18,0xD4
    03BC2 E700      LDI	R16,0x70
    03BC3 E016      LDI	R17,6
    03BC4 D03F      RCALL	_Send_string
(0218) 		 return Z_CMD4_WS;  //发送完成 返回成功
    03BC5 ED04      LDI	R16,0xD4
    03BC6 C03A      RJMP	0x3C01
(0219) 		 break ;			 
(0220) 		 
(0221) 		 case Z_CMD5_WCI :  //发送WCIChar
(0222) 		 Send_string(res.WCIChar, Z_CMD5_WCI ,8);
    03BC7 E088      LDI	R24,0x8
    03BC8 8388      ST	Y,R24
    03BC9 ED25      LDI	R18,0xD5
    03BCA E709      LDI	R16,0x79
    03BCB E016      LDI	R17,6
    03BCC D037      RCALL	_Send_string
(0223) 		 return Z_CMD5_WCI;  //发送完成 返回成功
    03BCD ED05      LDI	R16,0xD5
    03BCE C032      RJMP	0x3C01
(0224) 		 break ;	
(0225) 		 
(0226) 		 case Z_CMD6_ETC :  //ECTChar
(0227) 		 Send_string(res.ECTChar, Z_CMD6_ETC ,6);
    03BCF E086      LDI	R24,6
    03BD0 8388      ST	Y,R24
    03BD1 ED26      LDI	R18,0xD6
    03BD2 E805      LDI	R16,0x85
    03BD3 E016      LDI	R17,6
    03BD4 D02F      RCALL	_Send_string
(0228) 		 return Z_CMD6_ETC;  //发送完成 返回成功
    03BD5 ED06      LDI	R16,0xD6
    03BD6 C02A      RJMP	0x3C01
(0229) 		 break ;		
(0230) 		 
(0231) 		 case Z_CMD7_TEQ :  //发送TeqCharres.TeqChar
(0232) 		 Send_string(res.TeqChar, Z_CMD7_TEQ ,6);
    03BD7 E086      LDI	R24,6
    03BD8 8388      ST	Y,R24
    03BD9 ED27      LDI	R18,0xD7
    03BDA E80F      LDI	R16,0x8F
    03BDB E016      LDI	R17,6
    03BDC D027      RCALL	_Send_string
(0233) 		 return Z_CMD7_TEQ;  //发送完成 返回成功
    03BDD ED07      LDI	R16,0xD7
    03BDE C022      RJMP	0x3C01
(0234) 		 break ;	 
(0235) 		 
(0236) 		 case Z_CMD8_OTHER :  //发送日期
(0237) 		 buf[0]= res.WeiHai + 0x30;
    03BDF 9180 0695 LDS	R24,Result+92
    03BE1 5D80      SUBI	R24,0xD0
    03BE2 8389      STD	Y+1,R24
(0238) 		 buf[1]= res.LowLabor + 0x30;
    03BE3 9180 0696 LDS	R24,Result+93
    03BE5 5D80      SUBI	R24,0xD0
    03BE6 838A      STD	Y+2,R24
(0239) 		 buf[2]= res.MidLabor + 0x30;
    03BE7 9180 0697 LDS	R24,Result+94
    03BE9 5D80      SUBI	R24,0xD0
    03BEA 838B      STD	Y+3,R24
(0240) 		 buf[3]= res.HighLabor + 0x30;
    03BEB 9180 0698 LDS	R24,Result+95
    03BED 5D80      SUBI	R24,0xD0
    03BEE 838C      STD	Y+4,R24
(0241) 		 buf[4]= 0;
    03BEF 2422      CLR	R2
    03BF0 822D      STD	Y+5,R2
(0242) 		 Send_string(buf, Z_CMD8_OTHER, 4);
    03BF1 E084      LDI	R24,4
    03BF2 8388      ST	Y,R24
    03BF3 ED28      LDI	R18,0xD8
    03BF4 018E      MOVW	R16,R28
    03BF5 5F0F      SUBI	R16,0xFF
    03BF6 4F1F      SBCI	R17,0xFF
    03BF7 D00C      RCALL	_Send_string
(0243) 		 return Z_CMD8_OTHER;  //发送完成 返回成功
    03BF8 ED08      LDI	R16,0xD8
    03BF9 C007      RJMP	0x3C01
(0244) 		 break ;
(0245) 		 
(0246) 		 case Z_CMD9_SINGLE:
(0247) 		 
(0248) 		 break;
(0249) 		 
(0250) 		 case Z_CMD8_CYCLE:
(0251) 		 break;
(0252) 		 
(0253) 		 case Z_CMD8_STOP:
(0254) 		 break;
(0255) 		 
(0256) 		 case Z_CMD8_SYNC:
(0257) 		 break;
(0258) 		 
(0259) 		 case Z_CMD8_GET_DATA:
(0260) 		 break;
(0261) 		 
(0262) 		 case Z_CMD9_SET_STORAGE:
(0263) 		 break;
(0264) 		 
(0265) 		 default:    
(0266) 	     return 0xff;			   
    03BFA EF0F      LDI	R16,0xFF
    03BFB C005      RJMP	0x3C01
(0267)      }
(0268)  } 
(0269)  else { //校验不成功 丢弃帧头 寻找下一帧头
(0270)   RecRemove(1);  //丢弃帧头
    03BFC E001      LDI	R16,1
    03BFD DED4      RCALL	_RecRemove
(0271)   return 0xff;
    03BFE EF0F      LDI	R16,0xFF
    03BFF C001      RJMP	0x3C01
(0272)  }
(0273) return 0xff;
    03C00 EF0F      LDI	R16,0xFF
    03C01 9626      ADIW	R28,6
    03C02 940C 4B43 JMP	pop_xgsetF00C
_Send_string:
  sendBuf              --> Y,+0
  i                    --> R20
  MaxLen               --> R12
  cmd                  --> R14
  buf                  --> R10
    03C04 940E 4B1F CALL	push_xgset30FC
    03C06 2EE2      MOV	R14,R18
    03C07 0158      MOVW	R10,R16
    03C08 97EF      SBIW	R28,0x3F
    03C09 9721      SBIW	R28,1
    03C0A 01FE      MOVW	R30,R28
    03C0B 5BE8      SUBI	R30,0xB8
    03C0C 4FFF      SBCI	R31,0xFF
    03C0D 80C0      LD	R12,Z
(0274) }
(0275) void Send_string(char *buf, unsigned char cmd, unsigned char MaxLen){
(0276) 	 char i = 0;
(0277) 	 
(0278) 	 unsigned char sendBuf[64];
(0279) 	 sendBuf[0] = FRAME_HEAD;
    03C0E EF8A      LDI	R24,0xFA
    03C0F 8388      ST	Y,R24
(0280) 	 sendBuf[1] = 0;
    03C10 2422      CLR	R2
    03C11 8229      STD	Y+1,R2
(0281) 	 sendBuf[2] = 0x00; //主机地址
    03C12 822A      STD	Y+2,R2
(0282) 	 sendBuf[3] = deviceId;//Send.src; //本机地址
    03C13 9020 05BD LDS	R2,deviceId
    03C15 822B      STD	Y+3,R2
(0283) 	 sendBuf[4] = cmd; //
    03C16 82EC      STD	Y+4,R14
(0284) 	 for(i=0;i<MaxLen;i++){
    03C17 2744      CLR	R20
    03C18 C014      RJMP	0x3C2D
(0285) 	     if( *(buf+i) != 0 ){
    03C19 2FE4      MOV	R30,R20
    03C1A 27FF      CLR	R31
    03C1B 0DEA      ADD	R30,R10
    03C1C 1DFB      ADC	R31,R11
    03C1D 8020      LD	R2,Z
    03C1E 2022      TST	R2
    03C1F F079      BEQ	0x3C2F
(0286) 		 	 sendBuf[i+5] = *(buf+i);
    03C20 2FE4      MOV	R30,R20
    03C21 27FF      CLR	R31
    03C22 0DEA      ADD	R30,R10
    03C23 1DFB      ADC	R31,R11
    03C24 8020      LD	R2,Z
    03C25 01CE      MOVW	R24,R28
    03C26 9605      ADIW	R24,5
    03C27 2FE4      MOV	R30,R20
    03C28 27FF      CLR	R31
    03C29 0FE8      ADD	R30,R24
    03C2A 1FF9      ADC	R31,R25
    03C2B 8220      ST	Z,R2
    03C2C 9543      INC	R20
    03C2D 154C      CP	R20,R12
    03C2E F350      BCS	0x3C19
(0287) 		 }
(0288) 		 else { 
(0289) 		 break;
(0290) 		 }
(0291) 	 }
(0292) 	 i=i+5;
    03C2F 5F4B      SUBI	R20,0xFB
(0293) 	 sendBuf[i++] = 0xCC;
    03C30 2E24      MOV	R2,R20
    03C31 2433      CLR	R3
    03C32 5F4F      SUBI	R20,0xFF
    03C33 01CE      MOVW	R24,R28
    03C34 2DE2      MOV	R30,R2
    03C35 27FF      CLR	R31
    03C36 0FE8      ADD	R30,R24
    03C37 1FF9      ADC	R31,R25
    03C38 EC8C      LDI	R24,0xCC
    03C39 8380      ST	Z,R24
(0294) 	 sendBuf[i++] = 0xCC;
    03C3A 2E24      MOV	R2,R20
    03C3B 2433      CLR	R3
    03C3C 5F4F      SUBI	R20,0xFF
    03C3D 01CE      MOVW	R24,R28
    03C3E 2DE2      MOV	R30,R2
    03C3F 27FF      CLR	R31
    03C40 0FE8      ADD	R30,R24
    03C41 1FF9      ADC	R31,R25
    03C42 EC8C      LDI	R24,0xCC
    03C43 8380      ST	Z,R24
(0295) 	 sendBuf[i] = FRAME_END;
    03C44 01CE      MOVW	R24,R28
    03C45 2FE4      MOV	R30,R20
    03C46 27FF      CLR	R31
    03C47 0FE8      ADD	R30,R24
    03C48 1FF9      ADC	R31,R25
    03C49 EF8B      LDI	R24,0xFB
    03C4A 8380      ST	Z,R24
(0296) 	 sendBuf[1] = i+1;
    03C4B 2F84      MOV	R24,R20
    03C4C 5F8F      SUBI	R24,0xFF
    03C4D 8389      STD	Y+1,R24
(0297) 	 delayms((deviceId-0xB1)*1);  //不同设备延时不同时间发送数据，避免碰撞
    03C4E 9110 05BD LDS	R17,deviceId
    03C50 E001      LDI	R16,1
    03C51 0301      MULSU	R16,R17
    03C52 0180      MOVW	R16,R0
    03C53 5B01      SUBI	R16,0xB1
    03C54 4010      SBCI	R17,0
    03C55 940E 2D55 CALL	_delayms
(0298) 	 Send_nByte(sendBuf, i+1); //uart send
    03C57 2F24      MOV	R18,R20
    03C58 5F2F      SUBI	R18,0xFF
    03C59 018E      MOVW	R16,R28
    03C5A 940E 3D11 CALL	_Send_nByte
    03C5C 96EF      ADIW	R28,0x3F
    03C5D 9621      ADIW	R28,1
    03C5E 940C 4B09 JMP	pop_xgset30FC
_zigbee_send_date:
  buf                  --> Y,+1
    03C60 9726      SBIW	R28,6
(0299) }
(0300) /* 发送hex 暂未用到
(0301) void Send_bin(char *buf, unsigned char cmd, unsigned char buf_len){
(0302) 	 char i = 0;
(0303) 	 
(0304) 	 unsigned char sendBuf[64];
(0305) 	 sendBuf[0] = FRAME_HEAD;
(0306) 	 sendBuf[1] = 0;
(0307) 	 sendBuf[2] = 0x00; //主机地址
(0308) 	 sendBuf[3] = deviceId; //本机地址
(0309) 	 sendBuf[4] = cmd; //
(0310) 	 for(i=0;i<buf_len;i++){
(0311) 			 	 sendBuf[i+5] = *(buf+i);
(0312) 	 }
(0313) 	 i=i+5;
(0314) 	 sendBuf[i++] = 0xCC;
(0315) 	 sendBuf[i++] = 0xCC;
(0316) 	 sendBuf[i] = FRAME_END;
(0317) 	 sendBuf[1] = i+1;
(0318) 	 delayms((deviceId-0xB1)*1);  //不同设备延时不同时间发送数据，避免碰撞
(0319) 	 Send_nByte(sendBuf, i+1); //uart send
(0320) }
(0321) */
(0322) void zigbee_send_date(void){
(0323) 	char buf[5];
(0324)     Send_string(res.Date, Z_CMD1_DATE, 9);
    03C61 E089      LDI	R24,0x9
    03C62 8388      ST	Y,R24
    03C63 ED21      LDI	R18,0xD1
    03C64 E40F      LDI	R16,0x4F
    03C65 E016      LDI	R17,6
    03C66 DF9D      RCALL	_Send_string
(0325) 	Send_string(res.Time, Z_CMD2_TIME, 10);
    03C67 E08A      LDI	R24,0xA
    03C68 8388      ST	Y,R24
    03C69 ED22      LDI	R18,0xD2
    03C6A E508      LDI	R16,0x58
    03C6B E016      LDI	R17,6
    03C6C DF97      RCALL	_Send_string
(0326) 	Send_string(res.TempChar, Z_CMD3_TEMPERATURE, 6);
    03C6D E086      LDI	R24,6
    03C6E 8388      ST	Y,R24
    03C6F ED23      LDI	R18,0xD3
    03C70 E606      LDI	R16,0x66
    03C71 E016      LDI	R17,6
    03C72 DF91      RCALL	_Send_string
(0327) 	Send_string(res.WSChar, Z_CMD4_WS, 5);
    03C73 E085      LDI	R24,5
    03C74 8388      ST	Y,R24
    03C75 ED24      LDI	R18,0xD4
    03C76 E700      LDI	R16,0x70
    03C77 E016      LDI	R17,6
    03C78 DF8B      RCALL	_Send_string
(0328) 	Send_string(res.WCIChar, Z_CMD5_WCI ,8);
    03C79 E088      LDI	R24,0x8
    03C7A 8388      ST	Y,R24
    03C7B ED25      LDI	R18,0xD5
    03C7C E709      LDI	R16,0x79
    03C7D E016      LDI	R17,6
    03C7E DF85      RCALL	_Send_string
(0329) 	Send_string(res.ECTChar, Z_CMD6_ETC ,6);
    03C7F E086      LDI	R24,6
    03C80 8388      ST	Y,R24
    03C81 ED26      LDI	R18,0xD6
    03C82 E805      LDI	R16,0x85
    03C83 E016      LDI	R17,6
    03C84 DF7F      RCALL	_Send_string
(0330) 	Send_string(res.TeqChar, Z_CMD7_TEQ ,6);
    03C85 E086      LDI	R24,6
    03C86 8388      ST	Y,R24
    03C87 ED27      LDI	R18,0xD7
    03C88 E80F      LDI	R16,0x8F
    03C89 E016      LDI	R17,6
    03C8A DF79      RCALL	_Send_string
(0331) 	
(0332) 	buf[0]= Result.WeiHai + 0x30;
    03C8B 9180 0695 LDS	R24,Result+92
    03C8D 5D80      SUBI	R24,0xD0
    03C8E 8389      STD	Y+1,R24
(0333) 	buf[1]= Result.LowLabor + 0x30;
    03C8F 9180 0696 LDS	R24,Result+93
    03C91 5D80      SUBI	R24,0xD0
    03C92 838A      STD	Y+2,R24
(0334) 	buf[2]= Result.MidLabor + 0x30;
    03C93 9180 0697 LDS	R24,Result+94
    03C95 5D80      SUBI	R24,0xD0
    03C96 838B      STD	Y+3,R24
(0335) 	buf[3]= Result.HighLabor + 0x30;
    03C97 9180 0698 LDS	R24,Result+95
    03C99 5D80      SUBI	R24,0xD0
    03C9A 838C      STD	Y+4,R24
(0336) 	buf[4]= 0;
    03C9B 2422      CLR	R2
    03C9C 822D      STD	Y+5,R2
(0337) 	Send_string(buf, Z_CMD8_OTHER, 5);
    03C9D E085      LDI	R24,5
    03C9E 8388      ST	Y,R24
    03C9F ED28      LDI	R18,0xD8
    03CA0 018E      MOVW	R16,R28
    03CA1 5F0F      SUBI	R16,0xFF
    03CA2 4F1F      SBCI	R17,0xFF
    03CA3 DF60      RCALL	_Send_string
(0338) 	return ;
    03CA4 9626      ADIW	R28,6
    03CA5 9508      RET
_zigbee_send_id:
    03CA6 9721      SBIW	R28,1
(0339) }
(0340) 
(0341) void zigbee_send_id(void){
(0342) 	 Send_string((char *)devicename,Z_CMD0,sizeof(devicename));
    03CA7 E088      LDI	R24,0x8
    03CA8 8388      ST	Y,R24
    03CA9 ED20      LDI	R18,0xD0
    03CAA EB05      LDI	R16,0xB5
    03CAB E015      LDI	R17,5
    03CAC DF57      RCALL	_Send_string
    03CAD 9621      ADIW	R28,1
    03CAE 9508      RET
FILE: D:\LQD\software\software_src\usart.c
(0001) #include "config.h"
(0002) 
(0003) 
(0004) #define fosc 7372800UL //晶振7.3728MHZ
(0005) #define baud 38400  //波特率
(0006) //串口通信初始化  MEGA128
(0007) //UART1 initialize
(0008) // desired baud rate:38400
(0009) // actual baud rate:38400 (0.0%)
(0010) // char size: 8 bit
(0011) // parity: Disabled
(0012) void uart1_init(void)
(0013) {
(0014)  UCSR1B = 0x00; //disable while setting baud rate
_uart1_init:
    03CAF 2422      CLR	R2
    03CB0 9220 009A STS	0x9A,R2
(0015)  UCSR1A = 0x00;
    03CB2 9220 009B STS	0x9B,R2
(0016)  UCSR1C = 0x06;
    03CB4 E086      LDI	R24,6
    03CB5 9380 009D STS	0x9D,R24
(0017)  UBRR1L = 0x0B; //set baud rate lo
    03CB7 E08B      LDI	R24,0xB
    03CB8 9380 0099 STS	0x99,R24
(0018)  UBRR1H = 0x00; //set baud rate hi
    03CBA 9220 0098 STS	0x98,R2
(0019)  UCSR1B = 0x98;
    03CBC E988      LDI	R24,0x98
    03CBD 9380 009A STS	0x9A,R24
    03CBF 9508      RET
_uart1_rx_isr:
  tmp                  --> R10
    03CC0 920A      ST	-Y,R0
    03CC1 921A      ST	-Y,R1
    03CC2 922A      ST	-Y,R2
    03CC3 923A      ST	-Y,R3
    03CC4 924A      ST	-Y,R4
    03CC5 925A      ST	-Y,R5
    03CC6 926A      ST	-Y,R6
    03CC7 927A      ST	-Y,R7
    03CC8 928A      ST	-Y,R8
    03CC9 929A      ST	-Y,R9
    03CCA 930A      ST	-Y,R16
    03CCB 931A      ST	-Y,R17
    03CCC 932A      ST	-Y,R18
    03CCD 933A      ST	-Y,R19
    03CCE 938A      ST	-Y,R24
    03CCF 939A      ST	-Y,R25
    03CD0 93AA      ST	-Y,R26
    03CD1 93BA      ST	-Y,R27
    03CD2 93EA      ST	-Y,R30
    03CD3 93FA      ST	-Y,R31
    03CD4 B60F      IN	R0,0x3F
    03CD5 920A      ST	-Y,R0
    03CD6 92AA      ST	-Y,R10
(0020) }
(0021) 
(0022) #pragma interrupt_handler uart1_rx_isr:iv_USART1_RXC
(0023) void uart1_rx_isr(void){   
(0024) 	 char tmp;
(0025) 	 tmp=UDR1;
    03CD7 90A0 009C LDS	R10,0x9C
(0026) 	 //Usart_Transmit(tmp);
(0027) 	 RecAdd(tmp); //this function is come from zigbee.c
    03CD9 2D0A      MOV	R16,R10
    03CDA 940E 3AB6 CALL	_RecAdd
    03CDC 90A9      LD	R10,Y+
    03CDD 9009      LD	R0,Y+
    03CDE BE0F      OUT	0x3F,R0
    03CDF 91F9      LD	R31,Y+
    03CE0 91E9      LD	R30,Y+
    03CE1 91B9      LD	R27,Y+
    03CE2 91A9      LD	R26,Y+
    03CE3 9199      LD	R25,Y+
    03CE4 9189      LD	R24,Y+
    03CE5 9139      LD	R19,Y+
    03CE6 9129      LD	R18,Y+
    03CE7 9119      LD	R17,Y+
    03CE8 9109      LD	R16,Y+
    03CE9 9099      LD	R9,Y+
    03CEA 9089      LD	R8,Y+
    03CEB 9079      LD	R7,Y+
    03CEC 9069      LD	R6,Y+
    03CED 9059      LD	R5,Y+
    03CEE 9049      LD	R4,Y+
    03CEF 9039      LD	R3,Y+
    03CF0 9029      LD	R2,Y+
    03CF1 9019      LD	R1,Y+
    03CF2 9009      LD	R0,Y+
    03CF3 9518      RETI
(0028) }
(0029) 
(0030) void Usart_Transmit(char c)
(0031) {
(0032)  	 while (!(UCSR1A&(1<<UDRE1)));//表明发送器一准备就绪
_Usart_Transmit:
  c                    --> R16
    03CF4 9020 009B LDS	R2,0x9B
    03CF6 FE25      SBRS	R2,5
    03CF7 CFFC      RJMP	_Usart_Transmit
(0033) 	 UDR1=c;
    03CF8 9300 009C STS	0x9C,R16
    03CFA 9508      RET
_Puts:
  s                    --> R20
    03CFB 934A      ST	-Y,R20
    03CFC 935A      ST	-Y,R21
    03CFD 01A8      MOVW	R20,R16
(0034) }
(0035) 
(0036) //串口输出字符串
(0037) void Puts( unsigned char *s)
(0038) { 
    03CFE C00B      RJMP	0x3D0A
(0039) 	 while (*s) 
(0040)       { 
(0041) 	  //为数据间的隔断创造一个串口能显示的隔断字符 即'/t'  ->  ' '
(0042) 	  if(*s==0x09)  
    03CFF 01FA      MOVW	R30,R20
    03D00 8180      LD	R24,Z
    03D01 3089      CPI	R24,0x9
    03D02 F411      BNE	0x3D05
(0043) 	  {   Usart_Transmit(' ');    }
    03D03 E200      LDI	R16,0x20
    03D04 DFEF      RCALL	_Usart_Transmit
(0044) 	 Usart_Transmit(*s);
    03D05 01FA      MOVW	R30,R20
    03D06 8100      LD	R16,Z
    03D07 DFEC      RCALL	_Usart_Transmit
(0045) 	 s++;
    03D08 5F4F      SUBI	R20,0xFF
    03D09 4F5F      SBCI	R21,0xFF
    03D0A 01FA      MOVW	R30,R20
    03D0B 8020      LD	R2,Z
    03D0C 2022      TST	R2
    03D0D F789      BNE	0x3CFF
    03D0E 9159      LD	R21,Y+
    03D0F 9149      LD	R20,Y+
    03D10 9508      RET
_Send_nByte:
  i                    --> R20
  len                  --> R10
  p                    --> R12
    03D11 940E 4B4A CALL	push_xgset303C
    03D13 2EA2      MOV	R10,R18
    03D14 0168      MOVW	R12,R16
(0046) 	
(0047) 	
(0048)       }
(0049) }
(0050) 
(0051) 
(0052) 
(0053) void Send_nByte(unsigned char *p, unsigned char len)
(0054) { 
(0055)   int i = 0;
(0056)   for(i=0;i<len;i++)
    03D15 2744      CLR	R20
    03D16 2755      CLR	R21
    03D17 C007      RJMP	0x3D1F
(0057)   {
(0058)    	Usart_Transmit(*(p+i));
    03D18 01FA      MOVW	R30,R20
    03D19 0DEC      ADD	R30,R12
    03D1A 1DFD      ADC	R31,R13
    03D1B 8100      LD	R16,Z
    03D1C DFD7      RCALL	_Usart_Transmit
    03D1D 5F4F      SUBI	R20,0xFF
    03D1E 4F5F      SBCI	R21,0xFF
    03D1F 2C2A      MOV	R2,R10
    03D20 2433      CLR	R3
    03D21 1542      CP	R20,R2
    03D22 0553      CPC	R21,R3
    03D23 F3A4      BLT	0x3D18
    03D24 940C 4B51 JMP	pop_xgset303C
_PrintString:
  str                  --> R10
    03D26 92AA      ST	-Y,R10
    03D27 92BA      ST	-Y,R11
    03D28 0158      MOVW	R10,R16
(0059)   }
(0060) }
(0061) 
(0062) void  PrintString(const unsigned char *str)
(0063) {    
    03D29 C004      RJMP	0x3D2E
(0064) 	while(*str!=0)	Usart_Transmit(*str++);
    03D2A 01F5      MOVW	R30,R10
    03D2B 9101      LD	R16,Z+
    03D2C 015F      MOVW	R10,R30
    03D2D DFC6      RCALL	_Usart_Transmit
    03D2E 01F5      MOVW	R30,R10
    03D2F 8020      LD	R2,Z
    03D30 2022      TST	R2
    03D31 F7C1      BNE	0x3D2A
    03D32 90B9      LD	R11,Y+
    03D33 90A9      LD	R10,Y+
    03D34 9508      RET
_PrintString_n:
  str                  --> R10
    03D35 92AA      ST	-Y,R10
    03D36 92BA      ST	-Y,R11
    03D37 0158      MOVW	R10,R16
(0065) }
(0066) void  PrintString_n(const unsigned char *str)
(0067) {   
(0068) 	Usart_Transmit('\r');
    03D38 E00D      LDI	R16,0xD
    03D39 DFBA      RCALL	_Usart_Transmit
(0069) 	Usart_Transmit('\n'); 
    03D3A E00A      LDI	R16,0xA
    03D3B DFB8      RCALL	_Usart_Transmit
    03D3C C004      RJMP	0x3D41
(0070) 	while(*str!=0)	Usart_Transmit(*str++);
    03D3D 01F5      MOVW	R30,R10
    03D3E 9101      LD	R16,Z+
    03D3F 015F      MOVW	R10,R30
    03D40 DFB3      RCALL	_Usart_Transmit
    03D41 01F5      MOVW	R30,R10
    03D42 8020      LD	R2,Z
    03D43 2022      TST	R2
    03D44 F7C1      BNE	0x3D3D
    03D45 90B9      LD	R11,Y+
    03D46 90A9      LD	R10,Y+
    03D47 9508      RET
_PrintLong:
  i                    --> R20
  da                   --> Y,+0
  data                 --> Y,+9
    03D48 940E 49D8 CALL	push_arg4
    03D4A 934A      ST	-Y,R20
    03D4B 9728      SBIW	R28,0x8
(0071) 
(0072) } 
(0073)  
(0074) void PrintLong(unsigned long data)
(0075) {
(0076)  
(0077) 	unsigned char da[8];
(0078) 	unsigned char i;
(0079) 	for(i=0;i<8;i++)	da[i]=0;
    03D4C 2744      CLR	R20
    03D4D C008      RJMP	0x3D56
    03D4E 01CE      MOVW	R24,R28
    03D4F 2FE4      MOV	R30,R20
    03D50 27FF      CLR	R31
    03D51 0FE8      ADD	R30,R24
    03D52 1FF9      ADC	R31,R25
    03D53 2422      CLR	R2
    03D54 8220      ST	Z,R2
    03D55 9543      INC	R20
    03D56 3048      CPI	R20,0x8
    03D57 F3B0      BCS	0x3D4E
    03D58 C013      RJMP	0x3D6C
(0080) 	while(data>=10000000L){ ++da[7];data-=10000000L;}
    03D59 818F      LDD	R24,Y+7
    03D5A 5F8F      SUBI	R24,0xFF
    03D5B 838F      STD	Y+7,R24
    03D5C E880      LDI	R24,0x80
    03D5D E996      LDI	R25,0x96
    03D5E E9A8      LDI	R26,0x98
    03D5F E0B0      LDI	R27,0
    03D60 8429      LDD	R2,Y+9
    03D61 843A      LDD	R3,Y+10
    03D62 844B      LDD	R4,Y+11
    03D63 845C      LDD	R5,Y+12
    03D64 1A28      SUB	R2,R24
    03D65 0A39      SBC	R3,R25
    03D66 0A4A      SBC	R4,R26
    03D67 0A5B      SBC	R5,R27
    03D68 8629      STD	Y+9,R2
    03D69 863A      STD	Y+10,R3
    03D6A 864B      STD	Y+11,R4
    03D6B 865C      STD	Y+12,R5
    03D6C E880      LDI	R24,0x80
    03D6D E996      LDI	R25,0x96
    03D6E E9A8      LDI	R26,0x98
    03D6F E0B0      LDI	R27,0
    03D70 8429      LDD	R2,Y+9
    03D71 843A      LDD	R3,Y+10
    03D72 844B      LDD	R4,Y+11
    03D73 845C      LDD	R5,Y+12
    03D74 1628      CP	R2,R24
    03D75 0639      CPC	R3,R25
    03D76 064A      CPC	R4,R26
    03D77 065B      CPC	R5,R27
    03D78 F700      BCC	0x3D59
(0081) 	if(da[7])	i=0;
    03D79 802F      LDD	R2,Y+7
    03D7A 2022      TST	R2
    03D7B F009      BEQ	0x3D7D
    03D7C 2744      CLR	R20
(0082) 	if(i==0)	Usart_Transmit('0'+da[7]);
    03D7D 2344      TST	R20
    03D7E F4B9      BNE	0x3D96
    03D7F 810F      LDD	R16,Y+7
    03D80 5D00      SUBI	R16,0xD0
    03D81 DF72      RCALL	_Usart_Transmit
    03D82 C013      RJMP	0x3D96
(0083) 	while(data>=1000000L) { ++da[6];data-=1000000L;}
    03D83 818E      LDD	R24,Y+6
    03D84 5F8F      SUBI	R24,0xFF
    03D85 838E      STD	Y+6,R24
    03D86 E480      LDI	R24,0x40
    03D87 E492      LDI	R25,0x42
    03D88 E0AF      LDI	R26,0xF
    03D89 E0B0      LDI	R27,0
    03D8A 8429      LDD	R2,Y+9
    03D8B 843A      LDD	R3,Y+10
    03D8C 844B      LDD	R4,Y+11
    03D8D 845C      LDD	R5,Y+12
    03D8E 1A28      SUB	R2,R24
    03D8F 0A39      SBC	R3,R25
    03D90 0A4A      SBC	R4,R26
    03D91 0A5B      SBC	R5,R27
    03D92 8629      STD	Y+9,R2
    03D93 863A      STD	Y+10,R3
    03D94 864B      STD	Y+11,R4
    03D95 865C      STD	Y+12,R5
    03D96 E480      LDI	R24,0x40
    03D97 E492      LDI	R25,0x42
    03D98 E0AF      LDI	R26,0xF
    03D99 E0B0      LDI	R27,0
    03D9A 8429      LDD	R2,Y+9
    03D9B 843A      LDD	R3,Y+10
    03D9C 844B      LDD	R4,Y+11
    03D9D 845C      LDD	R5,Y+12
    03D9E 1628      CP	R2,R24
    03D9F 0639      CPC	R3,R25
    03DA0 064A      CPC	R4,R26
    03DA1 065B      CPC	R5,R27
    03DA2 F700      BCC	0x3D83
(0084) 	if(da[6])	i=0;
    03DA3 802E      LDD	R2,Y+6
    03DA4 2022      TST	R2
    03DA5 F009      BEQ	0x3DA7
    03DA6 2744      CLR	R20
(0085) 	if(i==0)	Usart_Transmit('0'+da[6]);
    03DA7 2344      TST	R20
    03DA8 F4B9      BNE	0x3DC0
    03DA9 810E      LDD	R16,Y+6
    03DAA 5D00      SUBI	R16,0xD0
    03DAB DF48      RCALL	_Usart_Transmit
    03DAC C013      RJMP	0x3DC0
(0086) 	while(data>=100000L)  { ++da[5];data-=100000L;}
    03DAD 818D      LDD	R24,Y+5
    03DAE 5F8F      SUBI	R24,0xFF
    03DAF 838D      STD	Y+5,R24
    03DB0 EA80      LDI	R24,0xA0
    03DB1 E896      LDI	R25,0x86
    03DB2 E0A1      LDI	R26,1
    03DB3 E0B0      LDI	R27,0
    03DB4 8429      LDD	R2,Y+9
    03DB5 843A      LDD	R3,Y+10
    03DB6 844B      LDD	R4,Y+11
    03DB7 845C      LDD	R5,Y+12
    03DB8 1A28      SUB	R2,R24
    03DB9 0A39      SBC	R3,R25
    03DBA 0A4A      SBC	R4,R26
    03DBB 0A5B      SBC	R5,R27
    03DBC 8629      STD	Y+9,R2
    03DBD 863A      STD	Y+10,R3
    03DBE 864B      STD	Y+11,R4
    03DBF 865C      STD	Y+12,R5
    03DC0 EA80      LDI	R24,0xA0
    03DC1 E896      LDI	R25,0x86
    03DC2 E0A1      LDI	R26,1
    03DC3 E0B0      LDI	R27,0
    03DC4 8429      LDD	R2,Y+9
    03DC5 843A      LDD	R3,Y+10
    03DC6 844B      LDD	R4,Y+11
    03DC7 845C      LDD	R5,Y+12
    03DC8 1628      CP	R2,R24
    03DC9 0639      CPC	R3,R25
    03DCA 064A      CPC	R4,R26
    03DCB 065B      CPC	R5,R27
    03DCC F700      BCC	0x3DAD
(0087) 	if(da[5])	i=0;
    03DCD 802D      LDD	R2,Y+5
    03DCE 2022      TST	R2
    03DCF F009      BEQ	0x3DD1
    03DD0 2744      CLR	R20
(0088) 	if(i==0)	Usart_Transmit('0'+da[5]);
    03DD1 2344      TST	R20
    03DD2 F4B9      BNE	0x3DEA
    03DD3 810D      LDD	R16,Y+5
    03DD4 5D00      SUBI	R16,0xD0
    03DD5 DF1E      RCALL	_Usart_Transmit
    03DD6 C013      RJMP	0x3DEA
(0089) 	while(data>=10000L)   { ++da[4];data-=10000L;}
    03DD7 818C      LDD	R24,Y+4
    03DD8 5F8F      SUBI	R24,0xFF
    03DD9 838C      STD	Y+4,R24
    03DDA E180      LDI	R24,0x10
    03DDB E297      LDI	R25,0x27
    03DDC E0A0      LDI	R26,0
    03DDD E0B0      LDI	R27,0
    03DDE 8429      LDD	R2,Y+9
    03DDF 843A      LDD	R3,Y+10
    03DE0 844B      LDD	R4,Y+11
    03DE1 845C      LDD	R5,Y+12
    03DE2 1A28      SUB	R2,R24
    03DE3 0A39      SBC	R3,R25
    03DE4 0A4A      SBC	R4,R26
    03DE5 0A5B      SBC	R5,R27
    03DE6 8629      STD	Y+9,R2
    03DE7 863A      STD	Y+10,R3
    03DE8 864B      STD	Y+11,R4
    03DE9 865C      STD	Y+12,R5
    03DEA E180      LDI	R24,0x10
    03DEB E297      LDI	R25,0x27
    03DEC E0A0      LDI	R26,0
    03DED E0B0      LDI	R27,0
    03DEE 8429      LDD	R2,Y+9
    03DEF 843A      LDD	R3,Y+10
    03DF0 844B      LDD	R4,Y+11
    03DF1 845C      LDD	R5,Y+12
    03DF2 1628      CP	R2,R24
    03DF3 0639      CPC	R3,R25
    03DF4 064A      CPC	R4,R26
    03DF5 065B      CPC	R5,R27
    03DF6 F700      BCC	0x3DD7
(0090) 	if(da[4])	i=0;
    03DF7 802C      LDD	R2,Y+4
    03DF8 2022      TST	R2
    03DF9 F009      BEQ	0x3DFB
    03DFA 2744      CLR	R20
(0091) 	if(i==0)	Usart_Transmit('0'+da[4]);
    03DFB 2344      TST	R20
    03DFC F4B9      BNE	0x3E14
    03DFD 810C      LDD	R16,Y+4
    03DFE 5D00      SUBI	R16,0xD0
    03DFF DEF4      RCALL	_Usart_Transmit
    03E00 C013      RJMP	0x3E14
(0092) 	while(data>=1000L)    { ++da[3];data-=1000L;}
    03E01 818B      LDD	R24,Y+3
    03E02 5F8F      SUBI	R24,0xFF
    03E03 838B      STD	Y+3,R24
    03E04 EE88      LDI	R24,0xE8
    03E05 E093      LDI	R25,3
    03E06 E0A0      LDI	R26,0
    03E07 E0B0      LDI	R27,0
    03E08 8429      LDD	R2,Y+9
    03E09 843A      LDD	R3,Y+10
    03E0A 844B      LDD	R4,Y+11
    03E0B 845C      LDD	R5,Y+12
    03E0C 1A28      SUB	R2,R24
    03E0D 0A39      SBC	R3,R25
    03E0E 0A4A      SBC	R4,R26
    03E0F 0A5B      SBC	R5,R27
    03E10 8629      STD	Y+9,R2
    03E11 863A      STD	Y+10,R3
    03E12 864B      STD	Y+11,R4
    03E13 865C      STD	Y+12,R5
    03E14 EE88      LDI	R24,0xE8
    03E15 E093      LDI	R25,3
    03E16 E0A0      LDI	R26,0
    03E17 E0B0      LDI	R27,0
    03E18 8429      LDD	R2,Y+9
    03E19 843A      LDD	R3,Y+10
    03E1A 844B      LDD	R4,Y+11
    03E1B 845C      LDD	R5,Y+12
    03E1C 1628      CP	R2,R24
    03E1D 0639      CPC	R3,R25
    03E1E 064A      CPC	R4,R26
    03E1F 065B      CPC	R5,R27
    03E20 F700      BCC	0x3E01
(0093) 	if(da[3])	i=0;
    03E21 802B      LDD	R2,Y+3
    03E22 2022      TST	R2
    03E23 F009      BEQ	0x3E25
    03E24 2744      CLR	R20
(0094) 	if(i==0)	Usart_Transmit('0'+da[3]);
    03E25 2344      TST	R20
    03E26 F4B9      BNE	0x3E3E
    03E27 810B      LDD	R16,Y+3
    03E28 5D00      SUBI	R16,0xD0
    03E29 DECA      RCALL	_Usart_Transmit
    03E2A C013      RJMP	0x3E3E
(0095) 	while(data>=100L)     { ++da[2];data-=100L;}
    03E2B 818A      LDD	R24,Y+2
    03E2C 5F8F      SUBI	R24,0xFF
    03E2D 838A      STD	Y+2,R24
    03E2E E684      LDI	R24,0x64
    03E2F E090      LDI	R25,0
    03E30 E0A0      LDI	R26,0
    03E31 E0B0      LDI	R27,0
    03E32 8429      LDD	R2,Y+9
    03E33 843A      LDD	R3,Y+10
    03E34 844B      LDD	R4,Y+11
    03E35 845C      LDD	R5,Y+12
    03E36 1A28      SUB	R2,R24
    03E37 0A39      SBC	R3,R25
    03E38 0A4A      SBC	R4,R26
    03E39 0A5B      SBC	R5,R27
    03E3A 8629      STD	Y+9,R2
    03E3B 863A      STD	Y+10,R3
    03E3C 864B      STD	Y+11,R4
    03E3D 865C      STD	Y+12,R5
    03E3E E684      LDI	R24,0x64
    03E3F E090      LDI	R25,0
    03E40 E0A0      LDI	R26,0
    03E41 E0B0      LDI	R27,0
    03E42 8429      LDD	R2,Y+9
    03E43 843A      LDD	R3,Y+10
    03E44 844B      LDD	R4,Y+11
    03E45 845C      LDD	R5,Y+12
    03E46 1628      CP	R2,R24
    03E47 0639      CPC	R3,R25
    03E48 064A      CPC	R4,R26
    03E49 065B      CPC	R5,R27
    03E4A F700      BCC	0x3E2B
(0096) 	if(da[2])	i=0;
    03E4B 802A      LDD	R2,Y+2
    03E4C 2022      TST	R2
    03E4D F009      BEQ	0x3E4F
    03E4E 2744      CLR	R20
(0097) 	if(i==0)	Usart_Transmit('0'+da[2]);
    03E4F 2344      TST	R20
    03E50 F4B9      BNE	0x3E68
    03E51 810A      LDD	R16,Y+2
    03E52 5D00      SUBI	R16,0xD0
    03E53 DEA0      RCALL	_Usart_Transmit
    03E54 C013      RJMP	0x3E68
(0098) 	while(data>=10L)      { ++da[1];data-=10L;}
    03E55 8189      LDD	R24,Y+1
    03E56 5F8F      SUBI	R24,0xFF
    03E57 8389      STD	Y+1,R24
    03E58 E08A      LDI	R24,0xA
    03E59 E090      LDI	R25,0
    03E5A E0A0      LDI	R26,0
    03E5B E0B0      LDI	R27,0
    03E5C 8429      LDD	R2,Y+9
    03E5D 843A      LDD	R3,Y+10
    03E5E 844B      LDD	R4,Y+11
    03E5F 845C      LDD	R5,Y+12
    03E60 1A28      SUB	R2,R24
    03E61 0A39      SBC	R3,R25
    03E62 0A4A      SBC	R4,R26
    03E63 0A5B      SBC	R5,R27
    03E64 8629      STD	Y+9,R2
    03E65 863A      STD	Y+10,R3
    03E66 864B      STD	Y+11,R4
    03E67 865C      STD	Y+12,R5
    03E68 E08A      LDI	R24,0xA
    03E69 E090      LDI	R25,0
    03E6A E0A0      LDI	R26,0
    03E6B E0B0      LDI	R27,0
    03E6C 8429      LDD	R2,Y+9
    03E6D 843A      LDD	R3,Y+10
    03E6E 844B      LDD	R4,Y+11
    03E6F 845C      LDD	R5,Y+12
    03E70 1628      CP	R2,R24
    03E71 0639      CPC	R3,R25
    03E72 064A      CPC	R4,R26
    03E73 065B      CPC	R5,R27
    03E74 F700      BCC	0x3E55
(0099) 	if(da[1])	i=0;
    03E75 8029      LDD	R2,Y+1
    03E76 2022      TST	R2
    03E77 F009      BEQ	0x3E79
    03E78 2744      CLR	R20
(0100) 	if(i==0)	Usart_Transmit('0'+da[1]);
    03E79 2344      TST	R20
    03E7A F419      BNE	0x3E7E
    03E7B 8109      LDD	R16,Y+1
    03E7C 5D00      SUBI	R16,0xD0
    03E7D DE76      RCALL	_Usart_Transmit
(0101) 	Usart_Transmit('0'+data);
    03E7E E380      LDI	R24,0x30
    03E7F E090      LDI	R25,0
    03E80 E0A0      LDI	R26,0
    03E81 E0B0      LDI	R27,0
    03E82 8429      LDD	R2,Y+9
    03E83 843A      LDD	R3,Y+10
    03E84 844B      LDD	R4,Y+11
    03E85 845C      LDD	R5,Y+12
    03E86 0E28      ADD	R2,R24
    03E87 1E39      ADC	R3,R25
    03E88 1E4A      ADC	R4,R26
    03E89 1E5B      ADC	R5,R27
    03E8A 2D02      MOV	R16,R2
    03E8B DE68      RCALL	_Usart_Transmit
    03E8C 9628      ADIW	R28,0x8
    03E8D 9149      LD	R20,Y+
    03E8E 9624      ADIW	R28,4
    03E8F 9508      RET
_PrintChar:
  h                    --> R20
  d                    --> R22
    03E90 934A      ST	-Y,R20
    03E91 936A      ST	-Y,R22
    03E92 2F60      MOV	R22,R16
(0102)  
(0103) }
(0104)  
(0105) void PrintChar(unsigned char d)
(0106) {
(0107) 	unsigned char h=(d&0xF0)>>4;
    03E93 2F46      MOV	R20,R22
    03E94 7F40      ANDI	R20,0xF0
    03E95 9542      SWAP	R20
    03E96 704F      ANDI	R20,0xF
(0108) 	if(h<10)	Usart_Transmit('0'+h);
    03E97 304A      CPI	R20,0xA
    03E98 F420      BCC	0x3E9D
    03E99 2F04      MOV	R16,R20
    03E9A 5D00      SUBI	R16,0xD0
    03E9B DE58      RCALL	_Usart_Transmit
    03E9C C003      RJMP	0x3EA0
(0109) 	else		Usart_Transmit('A'-10+h);
    03E9D 2F04      MOV	R16,R20
    03E9E 5C09      SUBI	R16,0xC9
    03E9F DE54      RCALL	_Usart_Transmit
(0110) 	h=d&0x0f;
    03EA0 2F46      MOV	R20,R22
    03EA1 704F      ANDI	R20,0xF
(0111) 	if(h<10)	Usart_Transmit('0'+h);
    03EA2 304A      CPI	R20,0xA
    03EA3 F420      BCC	0x3EA8
    03EA4 2F04      MOV	R16,R20
    03EA5 5D00      SUBI	R16,0xD0
    03EA6 DE4D      RCALL	_Usart_Transmit
    03EA7 C003      RJMP	0x3EAB
(0112) 	else		Usart_Transmit('A'-10+h);
    03EA8 2F04      MOV	R16,R20
    03EA9 5C09      SUBI	R16,0xC9
    03EAA DE49      RCALL	_Usart_Transmit
(0113) 	Usart_Transmit(' ');
    03EAB E200      LDI	R16,0x20
    03EAC DE47      RCALL	_Usart_Transmit
    03EAD 9169      LD	R22,Y+
    03EAE 9149      LD	R20,Y+
    03EAF 9508      RET
FILE: D:\LQD\software\software_src\SPI.c
(0001) //*****************************************************************************//
(0002) //*								 
(0003) //*控制芯片：ATmgea128
(0004) //*开发环境：AVR Studio+GCC
(0005) //*隶属模块：SPI接口控制
(0006) //*****************************************************************************//
(0007) #include "SPI.h"
(0008) 
(0009) /******************************************************************
(0010) SPI接口函数初始化
(0011) ******************************************************************/
(0012) void SPI_IO_Init(void)
(0013) {
(0014) 	SPI_PORT |= (1<<SS);////拉高CS
_SPI_IO_Init:
    03EB0 9AC0      SBI	0x18,0
(0015) 	SPI_DDR |= (1<<SCLK)|(1<<MOSI)|(1<<SS);////CS,CLK,MOSI设为输出
    03EB1 B387      IN	R24,0x17
    03EB2 6087      ORI	R24,7
    03EB3 BB87      OUT	0x17,R24
(0016) 	SPI_DDR &=~(1<<MISO);//MISO设为输入
    03EB4 98BB      CBI	0x17,3
(0017) 	SPI_PORT |= (1<<SCLK);//拉高CLK
    03EB5 9AC1      SBI	0x18,1
(0018) 	SPI_High();//SPI高通
    03EB6 E580      LDI	R24,0x50
    03EB7 B98D      OUT	0x0D,R24
    03EB8 9A70      SBI	0x0E,0
    03EB9 9508      RET
(0019) }
(0020) /******************************************************************
(0021) SPI写一个字节
(0022) ******************************************************************/
(0023) void SPI_Write(UINT8 data)
(0024) {
(0025) 	SPDR = data;
_SPI_Write:
  data                 --> R16
    03EBA B90F      OUT	0x0F,R16
(0026) 	while ((SPSR&(1<<SPIF))==0);
    03EBB 9B77      SBIS	0x0E,7
    03EBC CFFE      RJMP	0x3EBB
    03EBD 9508      RET
(0027) 	//loop_until_bit_is_set(SPSR,SPIF);
(0028) }
(0029) /******************************************************************
(0030) SPI读一个字节
(0031) ******************************************************************/
(0032) unsigned char SPI_Read(void)
(0033) {
(0034) 	SPDR = 0xFF;//写0xFF启动SPI
_SPI_Read:
    03EBE EF8F      LDI	R24,0xFF
    03EBF B98F      OUT	0x0F,R24
(0035) 	while ((SPSR&(1<<SPIF))==0);
    03EC0 9B77      SBIS	0x0E,7
    03EC1 CFFE      RJMP	0x3EC0
(0036) 	//loop_until_bit_is_set(SPSR,SPIF);//等待SPIF为高电平
(0037) 	return  SPDR;//返回读取值
    03EC2 B10F      IN	R16,0x0F
    03EC3 9508      RET
FILE: D:\LQD\software\software_src\lcd.c
(0001) #include "config.h"
(0002) 
(0003) //此硬件引脚适合冷强度检测仪第2版电路  mega128
(0004) #define LCD_PIN_CS   4
(0005) #define LCD_PIN_SID  3
(0006) #define LCD_PIN_SCLK 2
(0007) #define LCD_PIN_RST  1
(0008) #define LCD_BACKLIGHT_SW		0
(0009) #define LCD_PORT PORTC
(0010) #define LCD_PIN_DDR DDRC
(0011) #define Set_CS()     LCD_PIN_DDR |= (1<<LCD_PIN_CS)  ;LCD_PORT |= (1<<LCD_PIN_CS) 
(0012) #define Set_SID()    LCD_PIN_DDR |= (1<<LCD_PIN_SID) ;LCD_PORT |= (1<<LCD_PIN_SID) 
(0013) #define Set_SCLK()   LCD_PIN_DDR |= (1<<LCD_PIN_SCLK);LCD_PORT |= (1<<LCD_PIN_SCLK) 
(0014) #define LCD_LIGHT_ON()   LCD_PIN_DDR |= (1<<LCD_BACKLIGHT_SW);LCD_PORT |= (1<<LCD_BACKLIGHT_SW) 
(0015) #define Set_RST()   LCD_PIN_DDR |= (1<<LCD_PIN_RST);LCD_PORT |= (1<<LCD_PIN_RST) 
(0016) 
(0017) #define Clr_CS()     LCD_PIN_DDR |= (1<<LCD_PIN_CS)  ;LCD_PORT &=~(1<<LCD_PIN_CS) 
(0018) #define Clr_SID()    LCD_PIN_DDR |= (1<<LCD_PIN_SID) ;LCD_PORT &=~(1<<LCD_PIN_SID) 
(0019) #define Clr_SCLK()   LCD_PIN_DDR |= (1<<LCD_PIN_SCLK);LCD_PORT &=~(1<<LCD_PIN_SCLK) 
(0020) #define LCD_LIGHT_OFF()   LCD_PIN_DDR |= (1<<LCD_BACKLIGHT_SW);LCD_PORT &=~(1<<LCD_BACKLIGHT_SW) 
(0021) #define Clr_RST()   LCD_PIN_DDR |= (1<<LCD_PIN_RST);LCD_PORT &=~(1<<LCD_PIN_RST) 
(0022)  
(0023) void W_1byte(unsigned char RW, unsigned char RS, unsigned char W_data); 
(0024) void Write_8bits(unsigned int W_bits); 
(0025) void LCD_Init(void); 
(0026) unsigned char LCD_INT(void); 
(0027) 
(0028) unsigned char LCD_SW(unsigned char i)
(0029) {
(0030)  if(i==0){
_LCD_SW:
  i                    --> R16
    03EC4 2300      TST	R16
    03EC5 F421      BNE	0x3ECA
(0031)  LCD_LIGHT_OFF();
    03EC6 9AA0      SBI	0x14,0
    03EC7 98A8      CBI	0x15,0
(0032)  return 0;
    03EC8 2700      CLR	R16
    03EC9 C003      RJMP	0x3ECD
(0033)  }
(0034)  else{
(0035)  LCD_LIGHT_ON();
    03ECA 9AA0      SBI	0x14,0
    03ECB 9AA8      SBI	0x15,0
(0036)  return 1;
    03ECC E001      LDI	R16,1
    03ECD 9508      RET
(0037)  }
(0038)  
(0039) }
(0040)  
(0041) unsigned char LCD_INT(void) 
(0042) { 
(0043)   Clr_CS(); 
_LCD_INT:
    03ECE 9AA4      SBI	0x14,4
    03ECF 98AC      CBI	0x15,4
(0044)   Clr_SID(); 
    03ED0 9AA3      SBI	0x14,3
    03ED1 98AB      CBI	0x15,3
(0045)   Clr_SCLK(); 
    03ED2 9AA2      SBI	0x14,2
    03ED3 98AA      CBI	0x15,2
(0046)   LCD_Init(); 
    03ED4 D097      RCALL	_LCD_Init
(0047)   return (0);
    03ED5 2700      CLR	R16
    03ED6 9508      RET
_address:
  a                    --> R20
  y                    --> R18
  x                    --> R16
    03ED7 940E 4B32 CALL	push_xgsetF000
(0048) } 
(0049)   
(0050) /******************************************************************** 
(0051) 函数 名：address
(0052) 入口参数：地址转换
(0053) 出口参数：无 
(0054) 函数作用： 
(0055) 说        明： 
(0056) ********************************************************************/ 
(0057) unsigned char address(unsigned char x,unsigned char y)
(0058) {  
(0059)  unsigned char a;
(0060) 
(0061) switch(x) 
    03ED9 2F60      MOV	R22,R16
    03EDA 2777      CLR	R23
    03EDB 3061      CPI	R22,1
    03EDC E0E0      LDI	R30,0
    03EDD 077E      CPC	R23,R30
    03EDE F069      BEQ	0x3EEC
    03EDF 3062      CPI	R22,2
    03EE0 E0E0      LDI	R30,0
    03EE1 077E      CPC	R23,R30
    03EE2 F059      BEQ	0x3EEE
    03EE3 3063      CPI	R22,3
    03EE4 E0E0      LDI	R30,0
    03EE5 077E      CPC	R23,R30
    03EE6 F049      BEQ	0x3EF0
    03EE7 3064      CPI	R22,4
    03EE8 E0E0      LDI	R30,0
    03EE9 077E      CPC	R23,R30
    03EEA F039      BEQ	0x3EF2
    03EEB C007      RJMP	0x3EF3
(0062) { 
(0063) case 1: 
(0064) {a=0x80;break;} 
    03EEC E840      LDI	R20,0x80
    03EED C005      RJMP	0x3EF3
(0065) case 2: 
(0066) {a=0x90;break;} 
    03EEE E940      LDI	R20,0x90
    03EEF C003      RJMP	0x3EF3
(0067)   case 3: 
(0068) {a=0x88;break;} 
    03EF0 E848      LDI	R20,0x88
    03EF1 C001      RJMP	0x3EF3
(0069)   case 4: 
(0070) {a=0x98;break;} 
    03EF2 E948      LDI	R20,0x98
(0071) } 
(0072) a=a+y-1;
    03EF3 0F42      ADD	R20,R18
    03EF4 5041      SUBI	R20,1
(0073) 
(0074) return a;
    03EF5 2F04      MOV	R16,R20
    03EF6 940C 4B37 JMP	pop_xgsetF000
_LCD_const_disp:
  a                    --> R12
  i                    --> R20
  single_data          --> R10
  y                    --> R14
  x                    --> R12
    03EF8 940E 4B1F CALL	push_xgset30FC
    03EFA 2EE2      MOV	R14,R18
    03EFB 2EC0      MOV	R12,R16
    03EFC 9721      SBIW	R28,1
    03EFD 84A9      LDD	R10,Y+9
    03EFE 84BA      LDD	R11,Y+10
(0075) }
(0076)  
(0077) //////////////////////////////////////////////////////////////
(0078) 
(0079) /******************************************************************** 
(0080) 函数 名：LCD_const_disp
(0081) 入口参数：x y  *single_data
(0082) 出口参数：无 
(0083) 函数作用：负责 显示一串常量
(0084) 说        明： 
(0085) ********************************************************************/ 
(0086) void LCD_const_disp(unsigned char x, unsigned char y, const unsigned char *single_data) 
(0087) { 
(0088) unsigned char  a,i; 
(0089) a=address(x,y);
    03EFF 2D2E      MOV	R18,R14
    03F00 2D0C      MOV	R16,R12
    03F01 DFD5      RCALL	_address
    03F02 2EC0      MOV	R12,R16
(0090) W_1byte(0,0,a);     //显示的地址 
    03F03 82C8      ST	Y,R12
    03F04 2722      CLR	R18
    03F05 2700      CLR	R16
    03F06 D0B7      RCALL	_W_1byte
(0091)    for(i=0; single_data[i]!='\0';i++) 
    03F07 2744      CLR	R20
    03F08 C00D      RJMP	0x3F16
(0092)    {
(0093)     if(i>=16) break; 
    03F09 3140      CPI	R20,0x10
    03F0A F008      BCS	0x3F0C
    03F0B C011      RJMP	0x3F1D
(0094)     W_1byte(0,1,single_data[i]); 
    03F0C 2FE4      MOV	R30,R20
    03F0D 27FF      CLR	R31
    03F0E 0DEA      ADD	R30,R10
    03F0F 1DFB      ADC	R31,R11
    03F10 8020      LD	R2,Z
    03F11 8228      ST	Y,R2
    03F12 E021      LDI	R18,1
    03F13 2700      CLR	R16
    03F14 D0A9      RCALL	_W_1byte
    03F15 9543      INC	R20
    03F16 2FE4      MOV	R30,R20
    03F17 27FF      CLR	R31
    03F18 0DEA      ADD	R30,R10
    03F19 1DFB      ADC	R31,R11
    03F1A 8020      LD	R2,Z
    03F1B 2022      TST	R2
    03F1C F761      BNE	0x3F09
(0095)     
(0096)    } 
(0097)    W_1byte(0,0,0XFF); // 移走地址指针 防止下一输入内容的干扰
    03F1D EF8F      LDI	R24,0xFF
    03F1E 8388      ST	Y,R24
    03F1F 2722      CLR	R18
    03F20 2700      CLR	R16
    03F21 D09C      RCALL	_W_1byte
    03F22 9621      ADIW	R28,1
    03F23 940C 4B09 JMP	pop_xgset30FC
_LCD_var_disp:
  a                    --> R12
  i                    --> R20
  single_data          --> R10
  y                    --> R14
  x                    --> R12
    03F25 940E 4B1F CALL	push_xgset30FC
    03F27 2EE2      MOV	R14,R18
    03F28 2EC0      MOV	R12,R16
    03F29 9721      SBIW	R28,1
    03F2A 84A9      LDD	R10,Y+9
    03F2B 84BA      LDD	R11,Y+10
(0098)  
(0099) } 
(0100) 
(0101) /******************************************************************** 
(0102) 函数 名：LCD_var_disp
(0103) 入口参数：single_row single_line  *single_data
(0104) 出口参数：无 
(0105) 函数作用：负责 显示一串变量
(0106) 说        明： 
(0107) ********************************************************************/ 
(0108) 
(0109) void LCD_var_disp(unsigned char x, unsigned char y, unsigned char *single_data) 
(0110) { 
(0111) unsigned char  a,i; 
(0112) 
(0113) #if _debug == 1 
(0114) 	PrintString_n(single_data);
(0115) #endif 
(0116) 
(0117) a=address( x,y);
    03F2C 2D2E      MOV	R18,R14
    03F2D 2D0C      MOV	R16,R12
    03F2E DFA8      RCALL	_address
    03F2F 2EC0      MOV	R12,R16
(0118) W_1byte(0,0,a);     //显示的地址0x88 
    03F30 82C8      ST	Y,R12
    03F31 2722      CLR	R18
    03F32 2700      CLR	R16
    03F33 D08A      RCALL	_W_1byte
(0119) 
(0120) for(i=0; single_data[i]!='\0';i++) 
    03F34 2744      CLR	R20
    03F35 C00D      RJMP	0x3F43
(0121)    { 
(0122)     if(i>=16) break;
    03F36 3140      CPI	R20,0x10
    03F37 F008      BCS	0x3F39
    03F38 C011      RJMP	0x3F4A
(0123)     W_1byte(0,1,single_data[i]); 
    03F39 2FE4      MOV	R30,R20
    03F3A 27FF      CLR	R31
    03F3B 0DEA      ADD	R30,R10
    03F3C 1DFB      ADC	R31,R11
    03F3D 8020      LD	R2,Z
    03F3E 8228      ST	Y,R2
    03F3F E021      LDI	R18,1
    03F40 2700      CLR	R16
    03F41 D07C      RCALL	_W_1byte
    03F42 9543      INC	R20
    03F43 2FE4      MOV	R30,R20
    03F44 27FF      CLR	R31
    03F45 0DEA      ADD	R30,R10
    03F46 1DFB      ADC	R31,R11
    03F47 8020      LD	R2,Z
    03F48 2022      TST	R2
    03F49 F761      BNE	0x3F36
(0124) 	} 
(0125)   W_1byte(0,0,0XFF); // 移走地址指针 防止下一输入内容的干扰
    03F4A EF8F      LDI	R24,0xFF
    03F4B 8388      ST	Y,R24
    03F4C 2722      CLR	R18
    03F4D 2700      CLR	R16
    03F4E D06F      RCALL	_W_1byte
    03F4F 9621      ADIW	R28,1
    03F50 940C 4B09 JMP	pop_xgset30FC
_LCD_char_disp:
  a                    --> R12
  data                 --> R10
  y                    --> R14
  x                    --> R12
    03F52 940E 4B21 CALL	push_xgset00FC
    03F54 2EE2      MOV	R14,R18
    03F55 2EC0      MOV	R12,R16
    03F56 9721      SBIW	R28,1
    03F57 80AF      LDD	R10,Y+7
(0126) } 
(0127) /******************************************************************** 
(0128) 函数 名：LCD_char_disp
(0129) 入口参数：single_row single_line  data
(0130) 出口参数：无 
(0131) 函数作用：负责 显示一个 变量
(0132) 说        明： 
(0133) ********************************************************************/ 
(0134) 
(0135) void LCD_char_disp(unsigned char x, unsigned char y, unsigned char data) 
(0136) { 
(0137) unsigned char a; 
(0138) a=address(x,y);
    03F58 2D2E      MOV	R18,R14
    03F59 2D0C      MOV	R16,R12
    03F5A DF7C      RCALL	_address
    03F5B 2EC0      MOV	R12,R16
(0139) W_1byte(0,0,a);     //显示的地址 
    03F5C 82C8      ST	Y,R12
    03F5D 2722      CLR	R18
    03F5E 2700      CLR	R16
    03F5F D05E      RCALL	_W_1byte
(0140) W_1byte(0,1,data);  //显示内容
    03F60 82A8      ST	Y,R10
    03F61 E021      LDI	R18,1
    03F62 2700      CLR	R16
    03F63 D05A      RCALL	_W_1byte
(0141)  
(0142)   W_1byte(0,0,0XFF); // 移走地址指针 防止下一输入内容的干扰
    03F64 EF8F      LDI	R24,0xFF
    03F65 8388      ST	Y,R24
    03F66 2722      CLR	R18
    03F67 2700      CLR	R16
    03F68 D055      RCALL	_W_1byte
    03F69 9621      ADIW	R28,1
    03F6A 940C 4B02 JMP	pop_xgset00FC
_LCD_Init:
  cmd                  --> R20
    03F6C 934A      ST	-Y,R20
    03F6D 9721      SBIW	R28,1
(0143) } 
(0144) 
(0145) /******************************************************************** 
(0146) 函数 名：LCD_Init
(0147) 入口参数：无
(0148) 出口参数：unsigned char  0/1
(0149) 函数作用：负责 清空液晶显示
(0150) 说        明： 
(0151) ********************************************************************/ 
(0152) void LCD_Init(void) 
(0153) { 
(0154)    unsigned char cmd; 
(0155)    cmd=0x30;      //功能设置 8 位数据，基本指令 
    03F6E E340      LDI	R20,0x30
(0156)   W_1byte(0,0,cmd); 
    03F6F 8348      ST	Y,R20
    03F70 2722      CLR	R18
    03F71 2700      CLR	R16
    03F72 D04B      RCALL	_W_1byte
(0157)   delayms(2); 
    03F73 E002      LDI	R16,2
    03F74 E010      LDI	R17,0
    03F75 940E 2D55 CALL	_delayms
(0158)   cmd=0x0C;      //显示状态 ON，游标OFF，反白OFF 
    03F77 E04C      LDI	R20,0xC
(0159)   W_1byte(0,0,cmd); //写指令 
    03F78 8348      ST	Y,R20
    03F79 2722      CLR	R18
    03F7A 2700      CLR	R16
    03F7B D042      RCALL	_W_1byte
(0160)   delayms(2); 
    03F7C E002      LDI	R16,2
    03F7D E010      LDI	R17,0
    03F7E 940E 2D55 CALL	_delayms
(0161)   cmd=0x01;      //清除显示 
    03F80 E041      LDI	R20,1
(0162)   W_1byte(0,0,cmd); //写指令 
    03F81 8348      ST	Y,R20
    03F82 2722      CLR	R18
    03F83 2700      CLR	R16
    03F84 D039      RCALL	_W_1byte
(0163)   delayms(2); 
    03F85 E002      LDI	R16,2
    03F86 E010      LDI	R17,0
    03F87 940E 2D55 CALL	_delayms
(0164)   cmd=0x02;      //地址归位 
    03F89 E042      LDI	R20,2
(0165)   W_1byte(0,0,cmd); //写指令 
    03F8A 8348      ST	Y,R20
    03F8B 2722      CLR	R18
    03F8C 2700      CLR	R16
    03F8D D030      RCALL	_W_1byte
(0166)   delayms(2); 
    03F8E E002      LDI	R16,2
    03F8F E010      LDI	R17,0
    03F90 940E 2D55 CALL	_delayms
(0167)   cmd=0x80;      //设置DDRAM 地址 
    03F92 E840      LDI	R20,0x80
(0168)   W_1byte(0,0,cmd); //写指令 
    03F93 8348      ST	Y,R20
    03F94 2722      CLR	R18
    03F95 2700      CLR	R16
    03F96 D027      RCALL	_W_1byte
(0169)   delayms(2);     //延时 
    03F97 E002      LDI	R16,2
    03F98 E010      LDI	R17,0
    03F99 940E 2D55 CALL	_delayms
    03F9B 9621      ADIW	R28,1
    03F9C 9149      LD	R20,Y+
    03F9D 9508      RET
_LCD_CLR:
  cmd                  --> R20
    03F9E 934A      ST	-Y,R20
    03F9F 9721      SBIW	R28,1
(0170) } 
(0171) 
(0172) void LCD_CLR(void)
(0173) {
(0174) unsigned char cmd;
(0175)   cmd=0x01;      //清除显示 
    03FA0 E041      LDI	R20,1
(0176)   W_1byte(0,0,cmd); //写指令 
    03FA1 8348      ST	Y,R20
    03FA2 2722      CLR	R18
    03FA3 2700      CLR	R16
    03FA4 D019      RCALL	_W_1byte
(0177)   delayms(1); 
    03FA5 E001      LDI	R16,1
    03FA6 E010      LDI	R17,0
    03FA7 940E 2D55 CALL	_delayms
(0178)   cmd=0x02;      //地址归位 
    03FA9 E042      LDI	R20,2
(0179)   W_1byte(0,0,cmd); //写指令 
    03FAA 8348      ST	Y,R20
    03FAB 2722      CLR	R18
    03FAC 2700      CLR	R16
    03FAD D010      RCALL	_W_1byte
(0180)   delayms(1); 
    03FAE E001      LDI	R16,1
    03FAF E010      LDI	R17,0
    03FB0 940E 2D55 CALL	_delayms
(0181)   cmd=0x80;      //设置DDRAM 地址 
    03FB2 E840      LDI	R20,0x80
(0182)   W_1byte(0,0,cmd); //写指令 
    03FB3 8348      ST	Y,R20
    03FB4 2722      CLR	R18
    03FB5 2700      CLR	R16
    03FB6 D007      RCALL	_W_1byte
(0183)   delayms(1);     //延时
    03FB7 E001      LDI	R16,1
    03FB8 E010      LDI	R17,0
    03FB9 940E 2D55 CALL	_delayms
    03FBB 9621      ADIW	R28,1
    03FBC 9149      LD	R20,Y+
    03FBD 9508      RET
_W_1byte:
  H_data               --> R22
  S_ID                 --> R10
  L_data               --> R20
  W_data               --> R12
  RS                   --> R14
  RW                   --> R20
    03FBE 940E 4B1D CALL	push_xgsetF0FC
    03FC0 2EE2      MOV	R14,R18
    03FC1 2F40      MOV	R20,R16
    03FC2 84CA      LDD	R12,Y+10
(0184) 
(0185) }
(0186)  
(0187) /*******************************************************************
(0188) 函 数 名：W_1byte
(0189) 入口参数：RW、RS、W_data
(0190) 出口参数：无
(0191) 建立日期：2007年3月3日
(0192) 修改日期：
(0193) 函数作用：写一个字节的数据到12864液晶，包括指令和数据
(0194) 说    明：RW=1，从液晶读数据到MCU；RW=0，写一个数据到液晶；
(0195) 		 （一般RW都设为0，即只向液晶写数据，不读数据）
(0196)           RS=1，写入的是数据；RS=0，写入的是指令；
(0197) 		  一般模式：RW=0，RS=1;写数据
(0198) 		  			RW=0，RS=0;写指令
(0199) ********************************************************************/
(0200) void W_1byte(unsigned char RW, unsigned char RS, unsigned char W_data)
(0201) {
(0202) 	unsigned int H_data,L_data,S_ID = 0xf8;	 //11111RWRS0
    03FC3 EF88      LDI	R24,0xF8
    03FC4 E090      LDI	R25,0
    03FC5 015C      MOVW	R10,R24
(0203) 	if(RW == 0)
    03FC6 2344      TST	R20
    03FC7 F419      BNE	0x3FCB
(0204) 	{
(0205) 	 	S_ID &=~ 0x04;
    03FC8 7F8B      ANDI	R24,0xFB
    03FC9 015C      MOVW	R10,R24
(0206) 	}
    03FCA C003      RJMP	0x3FCE
(0207) 	else					//if(RW==1)
(0208) 	{
(0209) 	 	S_ID |= 0X04;
    03FCB 01C5      MOVW	R24,R10
    03FCC 6084      ORI	R24,4
    03FCD 015C      MOVW	R10,R24
(0210) 	}
(0211) 	if(RS == 0)
    03FCE 20EE      TST	R14
    03FCF F421      BNE	0x3FD4
(0212) 	{
(0213) 	 	S_ID &=~ 0x02;
    03FD0 01C5      MOVW	R24,R10
    03FD1 7F8D      ANDI	R24,0xFD
    03FD2 015C      MOVW	R10,R24
(0214) 	}
    03FD3 C003      RJMP	0x3FD7
(0215) 	else					//if(RS==1)
(0216) 	{
(0217) 	 	S_ID |= 0X02;
    03FD4 01C5      MOVW	R24,R10
    03FD5 6082      ORI	R24,2
    03FD6 015C      MOVW	R10,R24
(0218) 	}
(0219) 	H_data = W_data;
    03FD7 2D6C      MOV	R22,R12
    03FD8 2777      CLR	R23
(0220) 	H_data &= 0xf0;			//屏蔽低4位的数据
    03FD9 7F60      ANDI	R22,0xF0
    03FDA 7070      ANDI	R23,0
(0221) 	L_data = W_data;	   	//xxxx0000格式
    03FDB 2D4C      MOV	R20,R12
    03FDC 2755      CLR	R21
(0222) 	L_data &= 0x0f;			//屏蔽高4位的数据
    03FDD 704F      ANDI	R20,0xF
    03FDE 7050      ANDI	R21,0
(0223) 	L_data <<= 4;			//xxxx0000格式
    03FDF 0F44      LSL	R20
    03FE0 1F55      ROL	R21
    03FE1 0F44      LSL	R20
    03FE2 1F55      ROL	R21
    03FE3 0F44      LSL	R20
    03FE4 1F55      ROL	R21
    03FE5 0F44      LSL	R20
    03FE6 1F55      ROL	R21
(0224) 	Set_CS();
    03FE7 9AA4      SBI	0x14,4
    03FE8 9AAC      SBI	0x15,4
(0225) 	Write_8bits(S_ID); 		//发送S_ID
    03FE9 0185      MOVW	R16,R10
    03FEA D00C      RCALL	_Write_8bits
(0226) 	Write_8bits(H_data);	//发送H_data
    03FEB 018B      MOVW	R16,R22
    03FEC D00A      RCALL	_Write_8bits
(0227) 	Write_8bits(L_data);	//发送L_data
    03FED 018A      MOVW	R16,R20
    03FEE D008      RCALL	_Write_8bits
(0228) 	Clr_CS();	Clr_CS();	Clr_CS();	
    03FEF 9AA4      SBI	0x14,4
    03FF0 98AC      CBI	0x15,4
    03FF1 9AA4      SBI	0x14,4
    03FF2 98AC      CBI	0x15,4
    03FF3 9AA4      SBI	0x14,4
    03FF4 98AC      CBI	0x15,4
    03FF5 940C 4B12 JMP	pop_xgsetF0FC
_Write_8bits:
  Temp_data            --> R12
  i                    --> R20
  W_bits               --> R10
    03FF7 940E 4B4A CALL	push_xgset303C
    03FF9 0158      MOVW	R10,R16
(0229) 	 
(0230) 
(0231) }
(0232) /********************************************************************
(0233) 函 数 名：Write_8bits
(0234) 入口参数：W_bits
(0235) 出口参数：无
(0236) 建立日期：2007年3月3日
(0237) 修改日期：
(0238) 函数作用：负责串行输出8个bit位
(0239) 说    明：
(0240) ********************************************************************/
(0241) void Write_8bits(unsigned int W_bits)
(0242) {
(0243) 	unsigned int i,Temp_data;
(0244) 	for(i=0; i<8; i++)
    03FFA 2744      CLR	R20
    03FFB 2755      CLR	R21
    03FFC C019      RJMP	0x4016
(0245) 	{
(0246) 		Temp_data = W_bits;
    03FFD 0165      MOVW	R12,R10
(0247) 		Temp_data <<= i;
    03FFE 019A      MOVW	R18,R20
    03FFF 0186      MOVW	R16,R12
    04000 940E 4BA1 CALL	lsl16
    04002 0168      MOVW	R12,R16
(0248) 		if((Temp_data&0x80)==0) 
    04003 FD07      SBRC	R16,7
    04004 C003      RJMP	0x4008
(0249) 		{
(0250) 		 	Clr_SID();
    04005 9AA3      SBI	0x14,3
    04006 98AB      CBI	0x15,3
(0251) 		}
    04007 C002      RJMP	0x400A
(0252) 		else
(0253) 		{
(0254) 		 	Set_SID();
    04008 9AA3      SBI	0x14,3
    04009 9AAB      SBI	0x15,3
(0255) 		} 
(0256) 		NOP();
    0400A 0000      NOP
(0257) 		Set_SCLK();
    0400B 9AA2      SBI	0x14,2
    0400C 9AAA      SBI	0x15,2
(0258) 		NOP();
    0400D 0000      NOP
(0259) 		NOP();
    0400E 0000      NOP
(0260) 		Clr_SCLK();
    0400F 9AA2      SBI	0x14,2
    04010 98AA      CBI	0x15,2
(0261) 		NOP();
    04011 0000      NOP
(0262) 		Clr_SID();
    04012 9AA3      SBI	0x14,3
    04013 98AB      CBI	0x15,3
    04014 5F4F      SUBI	R20,0xFF
    04015 4F5F      SBCI	R21,0xFF
    04016 3048      CPI	R20,0x8
    04017 E0E0      LDI	R30,0
    04018 075E      CPC	R21,R30
    04019 F318      BCS	0x3FFD
    0401A 940C 4B51 JMP	pop_xgset303C
_Set_Draw:
    0401C 9721      SBIW	R28,1
(0263) 	}
(0264) }
(0265)  
(0266) /********************************************************************
(0267) 函 数 名：Set_Draw(
(0268) 入口参数：无
(0269) 出口参数：无
(0270) 函数作用：设置为绘图模式
(0271) 说    明：
(0272) ********************************************************************/
(0273) void Set_Draw(void)
(0274) {  	
(0275) 	//W_1byte(0,0,0x34);			//8BIT控制界面，扩充指令集,，绘图显示OFF
(0276) 	W_1byte(0,0,0x36);
    0401D E386      LDI	R24,0x36
    0401E 8388      ST	Y,R24
    0401F 2722      CLR	R18
    04020 2700      CLR	R16
    04021 DF9C      RCALL	_W_1byte
(0277) 	delayms(1);					//延时
    04022 E001      LDI	R16,1
    04023 E010      LDI	R17,0
    04024 940E 2D55 CALL	_delayms
    04026 9621      ADIW	R28,1
    04027 9508      RET
_Set_White:
  clr_y                --> R10
  clr_x                --> R20
  white_y              --> Y,+2
  white_x              --> Y,+1
  i                    --> R22
  white_end_x          --> R12
  j                    --> R14
  clear                --> Y,+15
  end_x                --> R12
  y                    --> R14
  x                    --> R22
    04028 940E 4B1D CALL	push_xgsetF0FC
    0402A 2EE2      MOV	R14,R18
    0402B 2F60      MOV	R22,R16
    0402C 9723      SBIW	R28,3
    0402D 84CD      LDD	R12,Y+13
(0278) } 
(0279)  
(0280) 
(0281) /******************************************************************** 
(0282) 函数 名：Set_White 
(0283) 入口参数：  x,   y,  end_x,  clear
(0284) 出口参数：无 
(0285) 函数作用： 设置反显
(0286) 说        明： 
(0287) ********************************************************************/ 
(0288) void Set_White(unsigned char x,unsigned char y,unsigned char end_x,unsigned char clear)
(0289) {
(0290)  
(0291) 	unsigned char i, j, white_x, white_y,white_end_x,clr_x,clr_y ;		//
(0292)   
(0293) 	W_1byte(0,0,0x36);	  //8BIT控制界面，扩充指令集,，绘图显示ON
    0402E E386      LDI	R24,0x36
    0402F 8388      ST	Y,R24
    04030 2722      CLR	R18
    04031 2700      CLR	R16
    04032 DF8B      RCALL	_W_1byte
(0294) 	delayus(20);					//延时
    04033 E104      LDI	R16,0x14
    04034 E010      LDI	R17,0
    04035 940E 2D4D CALL	_delayus
(0295)  
(0296) 	white_end_x = (end_x-x+1);
    04037 2D8C      MOV	R24,R12
    04038 1B86      SUB	R24,R22
    04039 5F8F      SUBI	R24,0xFF
    0403A 2EC8      MOV	R12,R24
(0297) 	white_end_x <<= 1;
    0403B 0CCC      LSL	R12
(0298) 	if(y==1)   //x,1  a=80+x-1                   
    0403C 2D8E      MOV	R24,R14
    0403D 3081      CPI	R24,1
    0403E F449      BNE	0x4048
(0299) 	{
(0300) 	 	white_x = (0x80+x-1); 
    0403F 2F86      MOV	R24,R22
    04040 5880      SUBI	R24,0x80
    04041 5081      SUBI	R24,1
    04042 8389      STD	Y+1,R24
(0301) 		white_y = 0x80;
    04043 E880      LDI	R24,0x80
    04044 838A      STD	Y+2,R24
(0302) 		clr_x = 0x80;
    04045 E840      LDI	R20,0x80
(0303) 		clr_y = 0x80;
    04046 2EA8      MOV	R10,R24
(0304) 	}
    04047 C023      RJMP	0x406B
(0305) 	else if(y==2)
    04048 2D8E      MOV	R24,R14
    04049 3082      CPI	R24,2
    0404A F449      BNE	0x4054
(0306) 	{
(0307) 	 	white_x = (0x80+x-1);
    0404B 2F86      MOV	R24,R22
    0404C 5880      SUBI	R24,0x80
    0404D 5081      SUBI	R24,1
    0404E 8389      STD	Y+1,R24
(0308) 		white_y = 0x90;
    0404F E980      LDI	R24,0x90
    04050 838A      STD	Y+2,R24
(0309) 		clr_x = 0x80;
    04051 E840      LDI	R20,0x80
(0310) 		clr_y = 0x90;
    04052 2EA8      MOV	R10,R24
(0311) 	}
    04053 C017      RJMP	0x406B
(0312) 	else if(y==3)
    04054 2D8E      MOV	R24,R14
    04055 3083      CPI	R24,3
    04056 F449      BNE	0x4060
(0313) 	{
(0314) 	 	white_x = (0x88+x-1);
    04057 2F86      MOV	R24,R22
    04058 5788      SUBI	R24,0x78
    04059 5081      SUBI	R24,1
    0405A 8389      STD	Y+1,R24
(0315) 		white_y = 0x80;
    0405B E880      LDI	R24,0x80
    0405C 838A      STD	Y+2,R24
(0316) 		clr_x = 0x88;
    0405D E848      LDI	R20,0x88
(0317) 		clr_y = 0x80;
    0405E 2EA8      MOV	R10,R24
(0318) 	}
    0405F C00B      RJMP	0x406B
(0319) 	else if(y==4)
    04060 2D8E      MOV	R24,R14
    04061 3084      CPI	R24,4
    04062 F441      BNE	0x406B
(0320) 	{
(0321) 	 	white_x = (0x88+x-1);
    04063 2F86      MOV	R24,R22
    04064 5788      SUBI	R24,0x78
    04065 5081      SUBI	R24,1
    04066 8389      STD	Y+1,R24
(0322) 		white_y = 0x90;
    04067 E980      LDI	R24,0x90
    04068 838A      STD	Y+2,R24
(0323) 		clr_x = 0x88;
    04069 E848      LDI	R20,0x88
(0324) 		clr_y = 0x90;
    0406A 2EA8      MOV	R10,R24
(0325) 	}
(0326)   if(clear==0)//要反白时，先将整行的液晶全部清成不反白（此处行指y）
    0406B 840F      LDD	R0,Y+15
    0406C 2000      TST	R0
    0406D F4E9      BNE	0x408B
(0327) 	{
(0328) 	 	for(i=0;i<16;i++ )			//16行
    0406E 2766      CLR	R22
    0406F C019      RJMP	0x4089
(0329) 		{
(0330) 		 	W_1byte(0,0,clr_y++);	//设置绘图区的Y地址坐标0
    04070 2C2A      MOV	R2,R10
    04071 2D82      MOV	R24,R2
    04072 5F8F      SUBI	R24,0xFF
    04073 2EA8      MOV	R10,R24
    04074 8228      ST	Y,R2
    04075 2722      CLR	R18
    04076 2700      CLR	R16
    04077 DF46      RCALL	_W_1byte
(0331) 			W_1byte(0,0,clr_x);		//设置绘图区的X地址坐标0
    04078 8348      ST	Y,R20
    04079 2722      CLR	R18
    0407A 2700      CLR	R16
    0407B DF42      RCALL	_W_1byte
(0332) 			for(j=0;j<16;j++)		//
    0407C 24EE      CLR	R14
    0407D C007      RJMP	0x4085
(0333) 			{
(0334) 			 	W_1byte(0,1,0x00);	//清成不反白
    0407E 2422      CLR	R2
    0407F 8228      ST	Y,R2
    04080 E021      LDI	R18,1
    04081 2700      CLR	R16
    04082 DF3B      RCALL	_W_1byte
(0335) 			 	nop();
    04083 0000      NOP
    04084 94E3      INC	R14
    04085 2D8E      MOV	R24,R14
    04086 3180      CPI	R24,0x10
    04087 F3B0      BCS	0x407E
    04088 9563      INC	R22
    04089 3160      CPI	R22,0x10
    0408A F328      BCS	0x4070
(0336) 			}
(0337) 		}
(0338) 	}
(0339) 	nop();
    0408B 0000      NOP
(0340) //	
(0341) 	for(i=0;i<16;i++ )				//16行，因为是16*16汉字
    0408C 2766      CLR	R22
    0408D C022      RJMP	0x40B0
(0342) 	{
(0343) 		W_1byte(0,0,white_y++);		//设置绘图区的Y地址坐标0
    0408E 802A      LDD	R2,Y+2
    0408F 2D82      MOV	R24,R2
    04090 5F8F      SUBI	R24,0xFF
    04091 838A      STD	Y+2,R24
    04092 8228      ST	Y,R2
    04093 2722      CLR	R18
    04094 2700      CLR	R16
    04095 DF28      RCALL	_W_1byte
(0344) 		W_1byte(0,0,white_x);		//设置绘图区的X地址坐标0
    04096 8009      LDD	R0,Y+1
    04097 8208      ST	Y,R0
    04098 2722      CLR	R18
    04099 2700      CLR	R16
    0409A DF23      RCALL	_W_1byte
(0345) 		for(j=0;j<white_end_x;j++)	//
    0409B 24EE      CLR	R14
    0409C C010      RJMP	0x40AD
(0346) 		{
(0347) 			 if(clear==1)
    0409D 858F      LDD	R24,Y+15
    0409E 3081      CPI	R24,1
    0409F F431      BNE	0x40A6
(0348) 			 {
(0349) 			  	W_1byte(0,1,0x00); //取消这一行的8个点的反白，液晶地址自动加1
    040A0 2422      CLR	R2
    040A1 8228      ST	Y,R2
    040A2 E021      LDI	R18,1
    040A3 2700      CLR	R16
    040A4 DF19      RCALL	_W_1byte
(0350) 								   //（此处行指一个一个液晶点所组成的行）
(0351) 			 }
    040A5 C005      RJMP	0x40AB
(0352) 			 else
(0353) 			 {
(0354) 				W_1byte(0,1,0xff); //反白这一行的8个点，液晶地址自动加1
    040A6 EF8F      LDI	R24,0xFF
    040A7 8388      ST	Y,R24
    040A8 E021      LDI	R18,1
    040A9 2700      CLR	R16
    040AA DF13      RCALL	_W_1byte
(0355) 								   //（此处行指一个一个液晶点所组成的行）
(0356) 			 }
(0357) 			nop();
    040AB 0000      NOP
    040AC 94E3      INC	R14
    040AD 14EC      CP	R14,R12
    040AE F370      BCS	0x409D
    040AF 9563      INC	R22
    040B0 3160      CPI	R22,0x10
    040B1 F2E0      BCS	0x408E
(0358) 		}
(0359) 	}
(0360) 	W_1byte(0,0,0x30);		//基本指令集,，绘图显示OFF
    040B2 E380      LDI	R24,0x30
    040B3 8388      ST	Y,R24
    040B4 2722      CLR	R18
    040B5 2700      CLR	R16
    040B6 DF07      RCALL	_W_1byte
    040B7 9623      ADIW	R28,3
    040B8 940C 4B12 JMP	pop_xgsetF0FC
_set_white_n:
  tempendx             --> R10
  tempy                --> R22
  tempx                --> R20
  clear                --> R12
  n                    --> R14
    040BA 940E 4B1D CALL	push_xgsetF0FC
    040BC 2EC2      MOV	R12,R18
    040BD 2EE0      MOV	R14,R16
    040BE 9723      SBIW	R28,3
(0361)  }
(0362) 
(0363) /******************************************************************** 
(0364) 函数 名：set_white_n
(0365) 入口参数： n ,  clear
(0366) 出口参数：无 
(0367) 函数作用：   将四行分成八个位置。n代表位置1-8。本函数用于反显或取消反显
(0368)           某一位置的文字。
(0369) 说        明： 例如 set_white_n(1,0); 表示反显第一行前四个字
(0370) ********************************************************************/ 
(0371) void set_white_n(unsigned char n,unsigned char clear)
(0372) {
(0373) unsigned char tempx,tempy,tempendx;
(0374) if(n==1) {tempx=1;tempy=1;tempendx=4;}
    040BF 2D8E      MOV	R24,R14
    040C0 3081      CPI	R24,1
    040C1 F429      BNE	0x40C7
    040C2 E041      LDI	R20,1
    040C3 E061      LDI	R22,1
    040C4 E084      LDI	R24,4
    040C5 2EA8      MOV	R10,R24
    040C6 C037      RJMP	0x40FE
(0375) else if(n==2) {tempx=5;tempy=1;tempendx=8;}
    040C7 2D8E      MOV	R24,R14
    040C8 3082      CPI	R24,2
    040C9 F429      BNE	0x40CF
    040CA E045      LDI	R20,5
    040CB E061      LDI	R22,1
    040CC E088      LDI	R24,0x8
    040CD 2EA8      MOV	R10,R24
    040CE C02F      RJMP	0x40FE
(0376) else if(n==3) {tempx=1;tempy=2;tempendx=4;}
    040CF 2D8E      MOV	R24,R14
    040D0 3083      CPI	R24,3
    040D1 F429      BNE	0x40D7
    040D2 E041      LDI	R20,1
    040D3 E062      LDI	R22,2
    040D4 E084      LDI	R24,4
    040D5 2EA8      MOV	R10,R24
    040D6 C027      RJMP	0x40FE
(0377) else if(n==4) {tempx=5;tempy=2;tempendx=8;}
    040D7 2D8E      MOV	R24,R14
    040D8 3084      CPI	R24,4
    040D9 F429      BNE	0x40DF
    040DA E045      LDI	R20,5
    040DB E062      LDI	R22,2
    040DC E088      LDI	R24,0x8
    040DD 2EA8      MOV	R10,R24
    040DE C01F      RJMP	0x40FE
(0378) else if(n==5) {tempx=1;tempy=3;tempendx=4;}
    040DF 2D8E      MOV	R24,R14
    040E0 3085      CPI	R24,5
    040E1 F429      BNE	0x40E7
    040E2 E041      LDI	R20,1
    040E3 E063      LDI	R22,3
    040E4 E084      LDI	R24,4
    040E5 2EA8      MOV	R10,R24
    040E6 C017      RJMP	0x40FE
(0379) else if(n==6) {tempx=5;tempy=3;tempendx=8;}
    040E7 2D8E      MOV	R24,R14
    040E8 3086      CPI	R24,6
    040E9 F429      BNE	0x40EF
    040EA E045      LDI	R20,5
    040EB E063      LDI	R22,3
    040EC E088      LDI	R24,0x8
    040ED 2EA8      MOV	R10,R24
    040EE C00F      RJMP	0x40FE
(0380) else if(n==7) {tempx=1;tempy=4;tempendx=4;}
    040EF 2D8E      MOV	R24,R14
    040F0 3087      CPI	R24,7
    040F1 F429      BNE	0x40F7
    040F2 E041      LDI	R20,1
    040F3 E064      LDI	R22,4
    040F4 E084      LDI	R24,4
    040F5 2EA8      MOV	R10,R24
    040F6 C007      RJMP	0x40FE
(0381) else if(n==8) {tempx=5;tempy=4;tempendx=8;}
    040F7 2D8E      MOV	R24,R14
    040F8 3088      CPI	R24,0x8
    040F9 F421      BNE	0x40FE
    040FA E045      LDI	R20,5
    040FB E064      LDI	R22,4
    040FC E088      LDI	R24,0x8
    040FD 2EA8      MOV	R10,R24
(0382) Set_White(tempx,tempy,tempendx,clear);
    040FE 82CA      STD	Y+2,R12
    040FF 82A8      ST	Y,R10
    04100 2F26      MOV	R18,R22
    04101 2F04      MOV	R16,R20
    04102 DF25      RCALL	_Set_White
    04103 9623      ADIW	R28,3
    04104 940C 4B12 JMP	pop_xgsetF0FC
_clr_white:
  clr_x                --> R10
  clr_y                --> R20
  i                    --> R22
  j                    --> R12
    04106 940E 4B1D CALL	push_xgsetF0FC
    04108 9721      SBIW	R28,1
(0383) 
(0384) }
(0385)  
(0386) /******************************************************************** 
(0387) 函数 名：clr_white
(0388) 入口参数： 清所有 反白
(0389) 出口参数：无 
(0390) 函数作用： 
(0391) 说        明： 
(0392) ********************************************************************/ 
(0393) void clr_white(void)
(0394) {      unsigned char i,j;
(0395) 
(0396)        unsigned char  clr_y=0x80;
    04109 E840      LDI	R20,0x80
(0397) 	   unsigned char  clr_x=0x80;
    0410A E880      LDI	R24,0x80
    0410B 2EA8      MOV	R10,R24
(0398) 	   W_1byte(0,0,0x36);	  //8BIT控制界面，扩充指令集,，绘图显示ON
    0410C E386      LDI	R24,0x36
    0410D 8388      ST	Y,R24
    0410E 2722      CLR	R18
    0410F 2700      CLR	R16
    04110 DEAD      RCALL	_W_1byte
(0399) 	 	for(i=0;i<16;i++ )			//16行
    04111 2766      CLR	R22
    04112 C017      RJMP	0x412A
(0400) 		{
(0401) 		 	W_1byte(0,0,clr_y++);	//设置绘图区的Y地址坐标0
    04113 2E24      MOV	R2,R20
    04114 5F4F      SUBI	R20,0xFF
    04115 8228      ST	Y,R2
    04116 2722      CLR	R18
    04117 2700      CLR	R16
    04118 DEA5      RCALL	_W_1byte
(0402) 			W_1byte(0,0,clr_x);		//设置绘图区的X地址坐标0
    04119 82A8      ST	Y,R10
    0411A 2722      CLR	R18
    0411B 2700      CLR	R16
    0411C DEA1      RCALL	_W_1byte
(0403) 			for(j=0;j<16;j++)		//
    0411D 24CC      CLR	R12
    0411E C007      RJMP	0x4126
(0404) 			{
(0405) 			 	W_1byte(0,1,0x00);	//清成不反白
    0411F 2422      CLR	R2
    04120 8228      ST	Y,R2
    04121 E021      LDI	R18,1
    04122 2700      CLR	R16
    04123 DE9A      RCALL	_W_1byte
(0406) 			 	nop();
    04124 0000      NOP
    04125 94C3      INC	R12
    04126 2D8C      MOV	R24,R12
    04127 3180      CPI	R24,0x10
    04128 F3B0      BCS	0x411F
    04129 9563      INC	R22
    0412A 3160      CPI	R22,0x10
    0412B F338      BCS	0x4113
(0407) 			}
(0408) 		}
(0409) 	
(0410) 	    clr_y=0x80;
    0412C E840      LDI	R20,0x80
(0411) 	    clr_x=0x90;
    0412D E980      LDI	R24,0x90
    0412E 2EA8      MOV	R10,R24
(0412) 		 	for(i=0;i<16;i++ )			//16行
    0412F 2766      CLR	R22
    04130 C017      RJMP	0x4148
(0413) 		{
(0414) 		 	W_1byte(0,0,clr_y++);	//设置绘图区的Y地址坐标0
    04131 2E24      MOV	R2,R20
    04132 5F4F      SUBI	R20,0xFF
    04133 8228      ST	Y,R2
    04134 2722      CLR	R18
    04135 2700      CLR	R16
    04136 DE87      RCALL	_W_1byte
(0415) 			W_1byte(0,0,clr_x);		//设置绘图区的X地址坐标0
    04137 82A8      ST	Y,R10
    04138 2722      CLR	R18
    04139 2700      CLR	R16
    0413A DE83      RCALL	_W_1byte
(0416) 			for(j=0;j<16;j++)		//
    0413B 24CC      CLR	R12
    0413C C007      RJMP	0x4144
(0417) 			{
(0418) 			 	W_1byte(0,1,0x00);	//清成不反白
    0413D 2422      CLR	R2
    0413E 8228      ST	Y,R2
    0413F E021      LDI	R18,1
    04140 2700      CLR	R16
    04141 DE7C      RCALL	_W_1byte
(0419) 			 	nop();
    04142 0000      NOP
    04143 94C3      INC	R12
    04144 2D8C      MOV	R24,R12
    04145 3180      CPI	R24,0x10
    04146 F3B0      BCS	0x413D
    04147 9563      INC	R22
    04148 3160      CPI	R22,0x10
    04149 F338      BCS	0x4131
(0420) 			}
(0421) 		}   
(0422) 	   
(0423) 	     clr_y=0x88;
    0414A E848      LDI	R20,0x88
(0424) 	     clr_x=0x80;
    0414B E880      LDI	R24,0x80
    0414C 2EA8      MOV	R10,R24
(0425) 		 	for(i=0;i<16;i++ )			//16行
    0414D 2766      CLR	R22
    0414E C017      RJMP	0x4166
(0426) 		{
(0427) 		 	W_1byte(0,0,clr_y++);	//设置绘图区的Y地址坐标0
    0414F 2EE4      MOV	R14,R20
    04150 5F4F      SUBI	R20,0xFF
    04151 82E8      ST	Y,R14
    04152 2722      CLR	R18
    04153 2700      CLR	R16
    04154 DE69      RCALL	_W_1byte
(0428) 			W_1byte(0,0,clr_x);		//设置绘图区的X地址坐标0
    04155 82A8      ST	Y,R10
    04156 2722      CLR	R18
    04157 2700      CLR	R16
    04158 DE65      RCALL	_W_1byte
(0429) 			for(j=0;j<16;j++)		//
    04159 24CC      CLR	R12
    0415A C007      RJMP	0x4162
(0430) 			{
(0431) 			 	W_1byte(0,1,0x00);	//清成不反白
    0415B 2422      CLR	R2
    0415C 8228      ST	Y,R2
    0415D E021      LDI	R18,1
    0415E 2700      CLR	R16
    0415F DE5E      RCALL	_W_1byte
(0432) 			 	nop();
    04160 0000      NOP
    04161 94C3      INC	R12
    04162 2D8C      MOV	R24,R12
    04163 3180      CPI	R24,0x10
    04164 F3B0      BCS	0x415B
    04165 9563      INC	R22
    04166 3160      CPI	R22,0x10
    04167 F338      BCS	0x414F
(0433) 			}
(0434) 		} 
(0435) 	     clr_y=0x88;
    04168 E848      LDI	R20,0x88
(0436) 	     clr_x=0x90;
    04169 E980      LDI	R24,0x90
    0416A 2EA8      MOV	R10,R24
(0437) 		 	for(i=0;i<16;i++ )			//16行
    0416B 2766      CLR	R22
    0416C C017      RJMP	0x4184
(0438) 		{
(0439) 		 	W_1byte(0,0,clr_y++);	//设置绘图区的Y地址坐标0
    0416D 2EE4      MOV	R14,R20
    0416E 5F4F      SUBI	R20,0xFF
    0416F 82E8      ST	Y,R14
    04170 2722      CLR	R18
    04171 2700      CLR	R16
    04172 DE4B      RCALL	_W_1byte
(0440) 			W_1byte(0,0,clr_x);		//设置绘图区的X地址坐标0
    04173 82A8      ST	Y,R10
    04174 2722      CLR	R18
    04175 2700      CLR	R16
    04176 DE47      RCALL	_W_1byte
(0441) 			for(j=0;j<16;j++)		//
    04177 24CC      CLR	R12
    04178 C007      RJMP	0x4180
(0442) 			{
(0443) 			 	W_1byte(0,1,0x00);	//清成不反白
    04179 2422      CLR	R2
    0417A 8228      ST	Y,R2
    0417B E021      LDI	R18,1
    0417C 2700      CLR	R16
    0417D DE40      RCALL	_W_1byte
(0444) 			 	nop();
    0417E 0000      NOP
    0417F 94C3      INC	R12
    04180 2D8C      MOV	R24,R12
    04181 3180      CPI	R24,0x10
    04182 F3B0      BCS	0x4179
    04183 9563      INC	R22
    04184 3160      CPI	R22,0x10
    04185 F338      BCS	0x416D
(0445) 			}
(0446) 		} 		
(0447)   W_1byte(0,0,0x30);	  //8BIT控制界面，扩充指令集,，绘图显示ON
    04186 E380      LDI	R24,0x30
    04187 8388      ST	Y,R24
    04188 2722      CLR	R18
    04189 2700      CLR	R16
    0418A DE33      RCALL	_W_1byte
    0418B 9621      ADIW	R28,1
    0418C 940C 4B12 JMP	pop_xgsetF0FC
_LCD_print2num:
  a                    --> R12
  tem                  --> R20
  num                  --> R10
  y                    --> R14
  x                    --> R12
    0418E 940E 4B1F CALL	push_xgset30FC
    04190 2EE2      MOV	R14,R18
    04191 2EC0      MOV	R12,R16
    04192 9721      SBIW	R28,1
    04193 84A9      LDD	R10,Y+9
(0448) 	}
(0449) /******************************************************************** 
(0450) 函数 名：LCD_print2num
(0451) 入口参数： 显示2数字
(0452) 出口参数：无 
(0453) 函数作用： 
(0454) 说        明： 
(0455) ********************************************************************/ 
(0456) void LCD_print2num(unsigned char x,unsigned char y,unsigned char num){
(0457) unsigned char tem;
(0458) unsigned char a; 
(0459) 
(0460) a=address(x,y);
    04194 2D2E      MOV	R18,R14
    04195 2D0C      MOV	R16,R12
    04196 DD40      RCALL	_address
    04197 2EC0      MOV	R12,R16
(0461) W_1byte(0,0,a);     //显示的地址 
    04198 82C8      ST	Y,R12
    04199 2722      CLR	R18
    0419A 2700      CLR	R16
    0419B DE22      RCALL	_W_1byte
(0462) tem=num/10;
    0419C E01A      LDI	R17,0xA
    0419D 2D0A      MOV	R16,R10
    0419E 940E 4A8F CALL	div8u
    041A0 2F40      MOV	R20,R16
(0463) W_1byte(0,1,tem+0x30);
    041A1 2F84      MOV	R24,R20
    041A2 5D80      SUBI	R24,0xD0
    041A3 8388      ST	Y,R24
    041A4 E021      LDI	R18,1
    041A5 2700      CLR	R16
    041A6 DE17      RCALL	_W_1byte
(0464) tem=num%10;
    041A7 E01A      LDI	R17,0xA
    041A8 2D0A      MOV	R16,R10
    041A9 940E 4A8D CALL	mod8u
    041AB 2F40      MOV	R20,R16
(0465) W_1byte(0,1,tem+0x30); 
    041AC 2F84      MOV	R24,R20
    041AD 5D80      SUBI	R24,0xD0
    041AE 8388      ST	Y,R24
    041AF E021      LDI	R18,1
    041B0 2700      CLR	R16
    041B1 DE0C      RCALL	_W_1byte
(0466) W_1byte(0,0,0XFF); // 移走地址指针 防止下一输入内容的干扰
    041B2 EF8F      LDI	R24,0xFF
    041B3 8388      ST	Y,R24
    041B4 2722      CLR	R18
    041B5 2700      CLR	R16
    041B6 DE07      RCALL	_W_1byte
    041B7 9621      ADIW	R28,1
    041B8 940C 4B09 JMP	pop_xgset30FC
_LCD_print4num:
  tem                  --> R12
  num                  --> R14
  y                    --> R20
  x                    --> R10
    041BA 940E 4B1F CALL	push_xgset30FC
    041BC 2F42      MOV	R20,R18
    041BD 2EA0      MOV	R10,R16
    041BE 9721      SBIW	R28,1
    041BF 84E9      LDD	R14,Y+9
    041C0 84FA      LDD	R15,Y+10
(0467) }
(0468)  
(0469) /******************************************************************** 
(0470) 函数 名：LCD_print4num
(0471) 入口参数： 显示4数字
(0472) 出口参数：无 
(0473) 函数作用： 
(0474) 说        明： 
(0475) ********************************************************************/ 
(0476) void LCD_print4num(unsigned char x,unsigned char y,unsigned int num){
(0477) unsigned char tem;
(0478) tem=num/100;
    041C1 E624      LDI	R18,0x64
    041C2 E030      LDI	R19,0
    041C3 0187      MOVW	R16,R14
    041C4 940E 4A09 CALL	div16u
    041C6 2EC0      MOV	R12,R16
(0479) LCD_print2num(x,y,tem);
    041C7 82C8      ST	Y,R12
    041C8 2F24      MOV	R18,R20
    041C9 2D0A      MOV	R16,R10
    041CA DFC3      RCALL	_LCD_print2num
(0480) 
(0481) tem=num%100;   
    041CB E624      LDI	R18,0x64
    041CC E030      LDI	R19,0
    041CD 0187      MOVW	R16,R14
    041CE 940E 4A07 CALL	mod16u
    041D0 2EC0      MOV	R12,R16
(0482) LCD_print2num(x,y+1,tem);
    041D1 82C8      ST	Y,R12
    041D2 2F24      MOV	R18,R20
    041D3 5F2F      SUBI	R18,0xFF
    041D4 2D0A      MOV	R16,R10
    041D5 DFB8      RCALL	_LCD_print2num
(0483) 
(0484) 
(0485)   W_1byte(0,0,0XFF); // 移走地址指针 防止下一输入内容的干扰
    041D6 EF8F      LDI	R24,0xFF
    041D7 8388      ST	Y,R24
    041D8 2722      CLR	R18
    041D9 2700      CLR	R16
    041DA DDE3      RCALL	_W_1byte
    041DB 9621      ADIW	R28,1
    041DC 940C 4B09 JMP	pop_xgset30FC
_LCD_print:
  a                    --> R12
  ch                   --> R10
  y                    --> R14
  x                    --> R12
    041DE 940E 4B21 CALL	push_xgset00FC
    041E0 2EE2      MOV	R14,R18
    041E1 2EC0      MOV	R12,R16
    041E2 9721      SBIW	R28,1
    041E3 80AF      LDD	R10,Y+7
(0486) }
(0487)  
(0488) //////////////////////////////////////////////////////////////
(0489) 
(0490) /******************************************************************** 
(0491) 函数 名：LCD_print 
(0492) 入口参数： 显示1 ascii
(0493) 出口参数：无 
(0494) 函数作用： 
(0495) 说        明： 
(0496) ********************************************************************/ 
(0497) void LCD_print(unsigned char x,unsigned char y,unsigned char ch)
(0498) {  
(0499) unsigned char a; 
(0500) a=address(x,y);
    041E4 2D2E      MOV	R18,R14
    041E5 2D0C      MOV	R16,R12
    041E6 DCF0      RCALL	_address
    041E7 2EC0      MOV	R12,R16
(0501) W_1byte(0,0,a);     //显示的地址 
    041E8 82C8      ST	Y,R12
    041E9 2722      CLR	R18
    041EA 2700      CLR	R16
    041EB DDD2      RCALL	_W_1byte
(0502) W_1byte(0,1,ch); 
    041EC 82A8      ST	Y,R10
    041ED E021      LDI	R18,1
    041EE 2700      CLR	R16
    041EF DDCE      RCALL	_W_1byte
    041F0 9621      ADIW	R28,1
    041F1 940C 4B02 JMP	pop_xgset00FC
_LCD_print1:
  ch                   --> R10
    041F3 92AA      ST	-Y,R10
    041F4 2EA0      MOV	R10,R16
    041F5 9721      SBIW	R28,1
(0503) 
(0504) 
(0505) 
(0506) }
(0507) /******************************************************************** 
(0508) 函数 名：LCD_print1 
(0509) 入口参数： 显示1 ascii
(0510) 出口参数：无 
(0511) 函数作用：接着上文地址显示，不重设地址 
(0512) 说        明： 
(0513) ********************************************************************/ 
(0514) void LCD_print1(char ch)
(0515) {  
(0516) W_1byte(0,1,ch); 
    041F6 82A8      ST	Y,R10
    041F7 E021      LDI	R18,1
    041F8 2700      CLR	R16
    041F9 DDC4      RCALL	_W_1byte
    041FA 9621      ADIW	R28,1
    041FB 90A9      LD	R10,Y+
    041FC 9508      RET
_lp:
  p                    --> R10
    041FD 92AA      ST	-Y,R10
    041FE 92BA      ST	-Y,R11
    041FF 0158      MOVW	R10,R16
    04200 9722      SBIW	R28,2
(0517) }
(0518) //////////////////////////////////////////////////////////////
(0519) 
(0520) 
(0521) 
(0522)  void lp(unsigned char *p)
(0523)  {
(0524)  static unsigned char *p1=" ",*p2=" ",*p3=" ",*p4=" ";
(0525)  p4=p3;
    04201 9020 05C7 LDS	R2,lcd.c:p3
    04203 9030 05C8 LDS	R3,lcd.c:p3+1
    04205 9230 05CA STS	lcd.c:p4+1,R3
    04207 9220 05C9 STS	lcd.c:p4,R2
(0526)  p3=p2;
    04209 9020 05C5 LDS	R2,lcd.c:p2
    0420B 9030 05C6 LDS	R3,lcd.c:p2+1
    0420D 9230 05C8 STS	lcd.c:p3+1,R3
    0420F 9220 05C7 STS	lcd.c:p3,R2
(0527)  p2=p1;
    04211 9020 05C3 LDS	R2,lcd.c:p1
    04213 9030 05C4 LDS	R3,lcd.c:p1+1
    04215 9230 05C6 STS	lcd.c:p2+1,R3
    04217 9220 05C5 STS	lcd.c:p2,R2
(0528)  p1=p;
    04219 92B0 05C4 STS	lcd.c:p1+1,R11
    0421B 92A0 05C3 STS	lcd.c:p1,R10
(0529)   LCD_const_disp(1,1,"                ");
    0421D EC8B      LDI	R24,0xCB
    0421E E095      LDI	R25,5
    0421F 8399      STD	Y+1,R25
    04220 8388      ST	Y,R24
    04221 E021      LDI	R18,1
    04222 E001      LDI	R16,1
    04223 DCD4      RCALL	_LCD_const_disp
(0530)   LCD_const_disp(2,1,"                ");
    04224 EC8B      LDI	R24,0xCB
    04225 E095      LDI	R25,5
    04226 8399      STD	Y+1,R25
    04227 8388      ST	Y,R24
    04228 E021      LDI	R18,1
    04229 E002      LDI	R16,2
    0422A DCCD      RCALL	_LCD_const_disp
(0531)   LCD_const_disp(3,1,"                ");
    0422B EC8B      LDI	R24,0xCB
    0422C E095      LDI	R25,5
    0422D 8399      STD	Y+1,R25
    0422E 8388      ST	Y,R24
    0422F E021      LDI	R18,1
    04230 E003      LDI	R16,3
    04231 DCC6      RCALL	_LCD_const_disp
(0532)   LCD_const_disp(4,1,"                ");
    04232 EC8B      LDI	R24,0xCB
    04233 E095      LDI	R25,5
    04234 8399      STD	Y+1,R25
    04235 8388      ST	Y,R24
    04236 E021      LDI	R18,1
    04237 E004      LDI	R16,4
    04238 DCBF      RCALL	_LCD_const_disp
(0533)   LCD_var_disp(1,1,p4);
    04239 9020 05C9 LDS	R2,lcd.c:p4
    0423B 9030 05CA LDS	R3,lcd.c:p4+1
    0423D 8239      STD	Y+1,R3
    0423E 8228      ST	Y,R2
    0423F E021      LDI	R18,1
    04240 E001      LDI	R16,1
    04241 DCE3      RCALL	_LCD_var_disp
(0534)   LCD_var_disp(2,1,p3);
    04242 9020 05C7 LDS	R2,lcd.c:p3
    04244 9030 05C8 LDS	R3,lcd.c:p3+1
    04246 8239      STD	Y+1,R3
    04247 8228      ST	Y,R2
    04248 E021      LDI	R18,1
    04249 E002      LDI	R16,2
    0424A DCDA      RCALL	_LCD_var_disp
(0535)   LCD_var_disp(3,1,p2);
    0424B 9020 05C5 LDS	R2,lcd.c:p2
    0424D 9030 05C6 LDS	R3,lcd.c:p2+1
    0424F 8239      STD	Y+1,R3
    04250 8228      ST	Y,R2
    04251 E021      LDI	R18,1
    04252 E003      LDI	R16,3
    04253 DCD1      RCALL	_LCD_var_disp
(0536)   LCD_var_disp(4,1,p1);
    04254 9020 05C3 LDS	R2,lcd.c:p1
    04256 9030 05C4 LDS	R3,lcd.c:p1+1
    04258 8239      STD	Y+1,R3
    04259 8228      ST	Y,R2
    0425A E021      LDI	R18,1
    0425B E004      LDI	R16,4
    0425C DCC8      RCALL	_LCD_var_disp
(0537)   delayms(300);
    0425D E20C      LDI	R16,0x2C
    0425E E011      LDI	R17,1
    0425F 940E 2D55 CALL	_delayms
    04261 9622      ADIW	R28,2
    04262 90B9      LD	R11,Y+
    04263 90A9      LD	R10,Y+
    04264 9508      RET
FILE: D:\LQD\software\software_src\relay.c
(0001) #include "config.h"
(0002) /*继电器初始化
(0003) *设置端口
(0004) *初始化关闭
(0005) */
(0006) void relay_init(void){
(0007) 	
(0008) 		RELAY_DDR_SET() ;
_relay_init:
    04265 9AA5      SBI	0x14,5
(0009) 		RELAY_OFF();
    04266 98AD      CBI	0x15,5
    04267 9508      RET
(0010) 		//state.Relay = 0;
(0011) 	}	
(0012) 
(0013) /*继电器控制
(0014) *传入 ： 温度
(0015) *传出 ： 当前继电器状态
(0016) *
(0017) */
(0018) unsigned char  relay(int temp)
(0019) {
(0020) 	if(temp<config.heatThreshold)
_relay:
  temp                 --> R16
    04268 9020 08BE LDS	R2,config+19
    0426A 2433      CLR	R3
    0426B 1502      CP	R16,R2
    0426C 0513      CPC	R17,R3
    0426D F41C      BGE	0x4271
(0021) 	{
(0022) 	 		RELAY_DDR_SET();
    0426E 9AA5      SBI	0x14,5
(0023) 			RELAY_ON();
    0426F 9AAD      SBI	0x15,5
(0024) 			//state.Relay = 1 ;
(0025) 	}
    04270 C002      RJMP	0x4273
(0026) 	else
(0027) 	{
(0028) 	 	RELAY_DDR_SET();
    04271 9AA5      SBI	0x14,5
(0029) 		RELAY_OFF();
    04272 98AD      CBI	0x15,5
(0030) 		//state.Relay = 0 ;
(0031) 	}		
(0032) 	//return state.Relay;
(0033) 	return 0;
    04273 2700      CLR	R16
    04274 9508      RET
_beep:
  i                    --> R10
  short_beep           --> R12
  long_beep            --> R14
    04275 940E 4B21 CALL	push_xgset00FC
    04277 2EC2      MOV	R12,R18
    04278 2EE0      MOV	R14,R16
FILE: D:\LQD\software\software_src\beep.c
(0001) #include "config.h"
(0002) 
(0003) #define BEEP_PORT	PORTC
(0004) #define BEEP_PIN	6
(0005) #define BEEP_OFF() BEEP_PORT|=(1<<BEEP_PIN)
(0006) #define BEEP_ON()  BEEP_PORT&=~(1<<BEEP_PIN)
(0007) //楦ｅ
(0008) void beep(unsigned char long_beep,unsigned char short_beep)
(0009) { 
(0010) unsigned char i;
(0011) DDRB|=(1<<0);
    04279 9AB8      SBI	0x17,0
(0012) for(i=0;i<long_beep;i++)
    0427A 24AA      CLR	R10
    0427B C00B      RJMP	0x4287
(0013) {
(0014) BEEP_ON();  delayms(200);
    0427C 98AE      CBI	0x15,6
    0427D EC08      LDI	R16,0xC8
    0427E E010      LDI	R17,0
    0427F 940E 2D55 CALL	_delayms
(0015) BEEP_OFF(); delayms(50);
    04281 9AAE      SBI	0x15,6
    04282 E302      LDI	R16,0x32
    04283 E010      LDI	R17,0
    04284 940E 2D55 CALL	_delayms
    04286 94A3      INC	R10
    04287 14AE      CP	R10,R14
    04288 F398      BCS	0x427C
(0016) }
(0017) delayms(100);
    04289 E604      LDI	R16,0x64
    0428A E010      LDI	R17,0
    0428B 940E 2D55 CALL	_delayms
(0018) for(i=0;i<short_beep;i++)
    0428D 24AA      CLR	R10
    0428E C00B      RJMP	0x429A
(0019) {
(0020) BEEP_ON();  delayms(80);
    0428F 98AE      CBI	0x15,6
    04290 E500      LDI	R16,0x50
    04291 E010      LDI	R17,0
    04292 940E 2D55 CALL	_delayms
(0021) BEEP_OFF(); delayms(50);
    04294 9AAE      SBI	0x15,6
    04295 E302      LDI	R16,0x32
    04296 E010      LDI	R17,0
    04297 940E 2D55 CALL	_delayms
    04299 94A3      INC	R10
    0429A 14AC      CP	R10,R12
    0429B F398      BCS	0x428F
    0429C 940C 4B02 JMP	pop_xgset00FC
_Delay_nus:
  i                    --> R20
  n                    --> R16
    0429E 934A      ST	-Y,R20
    0429F 935A      ST	-Y,R21
FILE: D:\LQD\software\software_src\DS18B20_driver.c
(0001) //------------------------------------------------------------------------------
(0002) // 文件名：DS18B20_driver.c
(0003) // 说明：  DS18B20驱动头文件
(0004) // 功能：  实现1-wire器件的读写
(0005) // 使用方法：   void Delay_nus(unsigned int n);             //延时n微秒函数
(0006) //              unsigned char reset_18B20(void);            //18B20复位
(0007) //              void write_bit_18B20(char bitval);          //写一位到18B20
(0008) //              unsigned char read_bit_18B20(void);         //读一位从18B20
(0009) //              void write_byte_18B20(unsigned char data);  //写一字节到18B20
(0010) //              unsigned char read_18B20(void);             //读一字节到18B20
(0011) //
(0012) // 运行平台：   AVR 8bit (M16已验证)
(0013) // 依存关系：   DS18B20_driver.h    DS18B20基本驱动头文件（函数声明）
(0014) // 移植人：     
(0015) // 最后修改：   
(0016) //------------------------------------------------------------------------------
(0017) 
(0018) #include "config.h"
(0019) #define DS18B20_PORT PORTG
(0020) #define DS18B20_PIN  PING
(0021) #define DS18B20_DDR  DDRG
(0022) #define CL_DQ   DS18B20_PORT&=~(1<<T_NUM)					   
(0023) #define SET_DQ  DS18B20_PORT|=(1<<T_NUM)			   
(0024) #define SET_OUT DS18B20_DDR|=(1<<T_NUM)				   
(0025) #define SET_IN  DS18B20_DDR&=~(1<<T_NUM)			   
(0026) #define IN_DQ   DS18B20_PIN&(1<<T_NUM)				  
(0027) unsigned char T_NUM=0;
(0028) 
(0029) 
(0030) //------------------------------------------------------------------------------
(0031) // 延时N微秒程序 供控制读写DS18B20时序使用
(0032) //------------------------------------------------------------------------------
(0033) void Delay_nus(unsigned int n)   
(0034) {  unsigned int i;
(0035) 	  for (i=0;i<n;i++) 
    042A0 2744      CLR	R20
    042A1 2755      CLR	R21
    042A2 C005      RJMP	0x42A8
(0036) 	  		{NOP();
    042A3 0000      NOP
(0037) 						NOP();
    042A4 0000      NOP
(0038) 						NOP();				        //20--300//比较接近
    042A5 0000      NOP
    042A6 5F4F      SUBI	R20,0xFF
    042A7 4F5F      SBCI	R21,0xFF
    042A8 1740      CP	R20,R16
    042A9 0751      CPC	R21,R17
    042AA F3C0      BCS	0x42A3
    042AB 9159      LD	R21,Y+
    042AC 9149      LD	R20,Y+
    042AD 9508      RET
_reset_18B20:
  bus_flag             --> R10
    042AE 92AA      ST	-Y,R10
(0039) 					}
(0040) }
(0041) 
(0042) 
(0043) //------------------------------------------------------------------------------
(0044) // 1-wire总线复位
(0045) //------------------------------------------------------------------------------
(0046) unsigned char reset_18B20(void)
(0047) {
(0048) 	char bus_flag;
(0049) 	CLI();
    042AF 94F8      BCLR	7
(0050) 	SET_DQ;
    042B0 9110 05DE LDS	R17,T_NUM
    042B2 E001      LDI	R16,1
    042B3 940E 4BB4 CALL	lsl8
    042B5 9020 0065 LDS	R2,0x65
    042B7 2A20      OR	R2,R16
    042B8 9220 0065 STS	0x65,R2
(0051) 	SET_OUT;
    042BA 9110 05DE LDS	R17,T_NUM
    042BC E001      LDI	R16,1
    042BD 940E 4BB4 CALL	lsl8
    042BF 9020 0064 LDS	R2,0x64
    042C1 2A20      OR	R2,R16
    042C2 9220 0064 STS	0x64,R2
(0052)  	
(0053)   	Delay_nus(1);
    042C4 E001      LDI	R16,1
    042C5 E010      LDI	R17,0
    042C6 DFD7      RCALL	_Delay_nus
(0054)   	CL_DQ;
    042C7 9110 05DE LDS	R17,T_NUM
    042C9 E001      LDI	R16,1
    042CA 940E 4BB4 CALL	lsl8
    042CC 2E20      MOV	R2,R16
    042CD 9420      COM	R2
    042CE 9030 0065 LDS	R3,0x65
    042D0 2032      AND	R3,R2
    042D1 9230 0065 STS	0x65,R3
(0055)   	Delay_nus(550);		//拉低至少480us时间
    042D3 E206      LDI	R16,0x26
    042D4 E012      LDI	R17,2
    042D5 DFC8      RCALL	_Delay_nus
(0056)   	SET_DQ;				//释放
    042D6 9110 05DE LDS	R17,T_NUM
    042D8 E001      LDI	R16,1
    042D9 940E 4BB4 CALL	lsl8
    042DB 9020 0065 LDS	R2,0x65
    042DD 2A20      OR	R2,R16
    042DE 9220 0065 STS	0x65,R2
(0057) 					NOP();
    042E0 0000      NOP
(0058) 					NOP();
    042E1 0000      NOP
(0059)   	SET_IN;				//输入
    042E2 9110 05DE LDS	R17,T_NUM
    042E4 E001      LDI	R16,1
    042E5 940E 4BB4 CALL	lsl8
    042E7 2E20      MOV	R2,R16
    042E8 9420      COM	R2
    042E9 9030 0064 LDS	R3,0x64
    042EB 2032      AND	R3,R2
    042EC 9230 0064 STS	0x64,R3
(0060)   	Delay_nus(60);
    042EE E30C      LDI	R16,0x3C
    042EF E010      LDI	R17,0
    042F0 DFAD      RCALL	_Delay_nus
(0061)   	
(0062) 						//等待回复
(0063)   	bus_flag = IN_DQ;
    042F1 9110 05DE LDS	R17,T_NUM
    042F3 E001      LDI	R16,1
    042F4 940E 4BB4 CALL	lsl8
    042F6 90A0 0063 LDS	R10,0x63
    042F8 22A0      AND	R10,R16
(0064)   	
(0065)   	Delay_nus(240);		//回复的低电平在60到240US
    042F9 EF00      LDI	R16,0xF0
    042FA E010      LDI	R17,0
    042FB DFA2      RCALL	_Delay_nus
(0066)   	SET_OUT;
    042FC 9110 05DE LDS	R17,T_NUM
    042FE E001      LDI	R16,1
    042FF 940E 4BB4 CALL	lsl8
    04301 9020 0064 LDS	R2,0x64
    04303 2A20      OR	R2,R16
    04304 9220 0064 STS	0x64,R2
(0067) 					NOP();
    04306 0000      NOP
(0068) 					NOP();
    04307 0000      NOP
(0069)   	SET_DQ;				//回到初始DQ=1；
    04308 9110 05DE LDS	R17,T_NUM
    0430A E001      LDI	R16,1
    0430B 940E 4BB4 CALL	lsl8
    0430D 9020 0065 LDS	R2,0x65
    0430F 2A20      OR	R2,R16
    04310 9220 0065 STS	0x65,R2
(0070) 
(0071)   	SEI();
    04312 9478      BSET	7
(0072) 	if(bus_flag){
    04313 20AA      TST	R10
    04314 F011      BEQ	0x4317
(0073) 		return FALSE;
    04315 2700      CLR	R16
    04316 C001      RJMP	0x4318
(0074) 	}else{
(0075) 		return TRUE;
    04317 E001      LDI	R16,1
    04318 90A9      LD	R10,Y+
    04319 9508      RET
_write_bit_18B20:
  bitval               --> R10
    0431A 92AA      ST	-Y,R10
    0431B 2EA0      MOV	R10,R16
(0076) 	}
(0077) 
(0078) }
(0079) 
(0080) //------------------------------------------------------------------------------
(0081) // 写一位到总线
(0082) //------------------------------------------------------------------------------
(0083) void write_bit_18B20(char bitval)
(0084) {
(0085)     SET_OUT;
    0431C 9110 05DE LDS	R17,T_NUM
    0431E E001      LDI	R16,1
    0431F 940E 4BB4 CALL	lsl8
    04321 9020 0064 LDS	R2,0x64
    04323 2A20      OR	R2,R16
    04324 9220 0064 STS	0x64,R2
(0086) 					NOP();
    04326 0000      NOP
(0087) 					NOP();
    04327 0000      NOP
(0088) 			 CL_DQ;
    04328 9110 05DE LDS	R17,T_NUM
    0432A E001      LDI	R16,1
    0432B 940E 4BB4 CALL	lsl8
    0432D 2E20      MOV	R2,R16
    0432E 9420      COM	R2
    0432F 9030 0065 LDS	R3,0x65
    04331 2032      AND	R3,R2
    04332 9230 0065 STS	0x65,R3
(0089) 	   Delay_nus(1);
    04334 E001      LDI	R16,1
    04335 E010      LDI	R17,0
    04336 DF67      RCALL	_Delay_nus
(0090) 	   if(bitval){    //写数据，从低位开始
    04337 20AA      TST	R10
    04338 F059      BEQ	0x4344
(0091) 		     SET_DQ;
    04339 9110 05DE LDS	R17,T_NUM
    0433B E001      LDI	R16,1
    0433C 940E 4BB4 CALL	lsl8
    0433E 9020 0065 LDS	R2,0x65
    04340 2A20      OR	R2,R16
    04341 9220 0065 STS	0x65,R2
(0092) 	  }else{
    04343 C00C      RJMP	0x4350
(0093) 		     CL_DQ;
    04344 9110 05DE LDS	R17,T_NUM
    04346 E001      LDI	R16,1
    04347 940E 4BB4 CALL	lsl8
    04349 2E20      MOV	R2,R16
    0434A 9420      COM	R2
    0434B 9030 0065 LDS	R3,0x65
    0434D 2032      AND	R3,R2
    0434E 9230 0065 STS	0x65,R3
(0094) 	  }
(0095) 	Delay_nus(40);		//15~60us
    04350 E208      LDI	R16,0x28
    04351 E010      LDI	R17,0
    04352 DF4B      RCALL	_Delay_nus
(0096) 	SET_DQ;
    04353 9110 05DE LDS	R17,T_NUM
    04355 E001      LDI	R16,1
    04356 940E 4BB4 CALL	lsl8
    04358 9020 0065 LDS	R2,0x65
    0435A 2A20      OR	R2,R16
    0435B 9220 0065 STS	0x65,R2
(0097) 	Delay_nus(10);
    0435D E00A      LDI	R16,0xA
    0435E E010      LDI	R17,0
    0435F DF3E      RCALL	_Delay_nus
    04360 90A9      LD	R10,Y+
    04361 9508      RET
_read_bit_18B20:
  k                    --> R10
    04362 92AA      ST	-Y,R10
(0098) }
(0099) 
(0100) //------------------------------------------------------------------------------
(0101) // 读一位从总线
(0102) //------------------------------------------------------------------------------
(0103) unsigned char read_bit_18B20(void)
(0104) {
(0105) 	unsigned char k;
(0106) 	SET_OUT;
    04363 9110 05DE LDS	R17,T_NUM
    04365 E001      LDI	R16,1
    04366 940E 4BB4 CALL	lsl8
    04368 9020 0064 LDS	R2,0x64
    0436A 2A20      OR	R2,R16
    0436B 9220 0064 STS	0x64,R2
(0107) 	CL_DQ;			//读时间片开始，拉低总线至少1us
    0436D 9110 05DE LDS	R17,T_NUM
    0436F E001      LDI	R16,1
    04370 940E 4BB4 CALL	lsl8
    04372 2E20      MOV	R2,R16
    04373 9420      COM	R2
    04374 9030 0065 LDS	R3,0x65
    04376 2032      AND	R3,R2
    04377 9230 0065 STS	0x65,R3
(0108) 	Delay_nus(1);
    04379 E001      LDI	R16,1
    0437A E010      LDI	R17,0
    0437B DF22      RCALL	_Delay_nus
(0109) 	
(0110) 					//SET_DQ;	
(0111) 	SET_IN;
    0437C 9110 05DE LDS	R17,T_NUM
    0437E E001      LDI	R16,1
    0437F 940E 4BB4 CALL	lsl8
    04381 2E20      MOV	R2,R16
    04382 9420      COM	R2
    04383 9030 0064 LDS	R3,0x64
    04385 2032      AND	R3,R2
    04386 9230 0064 STS	0x64,R3
(0112) 	Delay_nus(4);
    04388 E004      LDI	R16,4
    04389 E010      LDI	R17,0
    0438A DF13      RCALL	_Delay_nus
(0113) 	k=IN_DQ;    	//读数据,从低位开始
    0438B 9110 05DE LDS	R17,T_NUM
    0438D E001      LDI	R16,1
    0438E 940E 4BB4 CALL	lsl8
    04390 90A0 0063 LDS	R10,0x63
    04392 22A0      AND	R10,R16
(0114) 	Delay_nus(10);
    04393 E00A      LDI	R16,0xA
    04394 E010      LDI	R17,0
    04395 DF08      RCALL	_Delay_nus
(0115) 	SET_DQ;	
    04396 9110 05DE LDS	R17,T_NUM
    04398 E001      LDI	R16,1
    04399 940E 4BB4 CALL	lsl8
    0439B 9020 0065 LDS	R2,0x65
    0439D 2A20      OR	R2,R16
    0439E 9220 0065 STS	0x65,R2
(0116) 				NOP();
    043A0 0000      NOP
(0117) 				NOP();
    043A1 0000      NOP
(0118) 	SET_OUT;
    043A2 9110 05DE LDS	R17,T_NUM
    043A4 E001      LDI	R16,1
    043A5 940E 4BB4 CALL	lsl8
    043A7 9020 0064 LDS	R2,0x64
    043A9 2A20      OR	R2,R16
    043AA 9220 0064 STS	0x64,R2
(0119) 	    NOP();
    043AC 0000      NOP
(0120) 					NOP();
    043AD 0000      NOP
(0121) 	if(k){
    043AE 20AA      TST	R10
    043AF F011      BEQ	0x43B2
(0122) 	    return 1;
    043B0 E001      LDI	R16,1
    043B1 C001      RJMP	0x43B3
(0123) 	}else{
(0124) 	    return 0;
    043B2 2700      CLR	R16
    043B3 90A9      LD	R10,Y+
    043B4 9508      RET
_write_byte_18B20:
  i                    --> R20
  data                 --> R10
    043B5 92AA      ST	-Y,R10
    043B6 934A      ST	-Y,R20
    043B7 2EA0      MOV	R10,R16
(0125) 	}
(0126) 	
(0127) }
(0128) 
(0129) //------------------------------------------------------------------------------
(0130) // 写一个字节到总线
(0131) //------------------------------------------------------------------------------
(0132) void write_byte_18B20(unsigned char data)
(0133) {
(0134) 	unsigned char i;
(0135)    CLI();
    043B8 94F8      BCLR	7
(0136)     for(i=0;i<8;i++)
    043B9 2744      CLR	R20
    043BA C009      RJMP	0x43C4
(0137)     {
(0138)         write_bit_18B20(data&(1<<i));
    043BB E001      LDI	R16,1
    043BC 2F14      MOV	R17,R20
    043BD 940E 4BB4 CALL	lsl8
    043BF 2E20      MOV	R2,R16
    043C0 2D0A      MOV	R16,R10
    043C1 2102      AND	R16,R2
    043C2 DF57      RCALL	_write_bit_18B20
    043C3 9543      INC	R20
    043C4 3048      CPI	R20,0x8
    043C5 F3A8      BCS	0x43BB
(0139)         
(0140)     }
(0141)     SET_DQ;
    043C6 9110 05DE LDS	R17,T_NUM
    043C8 E001      LDI	R16,1
    043C9 940E 4BB4 CALL	lsl8
    043CB 9020 0065 LDS	R2,0x65
    043CD 2A20      OR	R2,R16
    043CE 9220 0065 STS	0x65,R2
(0142) 				  NOP();
    043D0 0000      NOP
(0143) 					 NOP();
    043D1 0000      NOP
(0144)     SEI();
    043D2 9478      BSET	7
    043D3 9149      LD	R20,Y+
    043D4 90A9      LD	R10,Y+
    043D5 9508      RET
_read_byte_18B20:
  temp                 --> R10
  n                    --> R20
    043D6 92AA      ST	-Y,R10
    043D7 934A      ST	-Y,R20
(0145)     
(0146)     //return;
(0147) }
(0148) 
(0149) //------------------------------------------------------------------------------
(0150) // 读一个字节
(0151) //------------------------------------------------------------------------------
(0152) unsigned char read_byte_18B20(void)
(0153) {
(0154) 	unsigned char temp,n;
(0155)     CLI();
    043D8 94F8      BCLR	7
(0156)   	temp=0;
    043D9 24AA      CLR	R10
(0157)     for(n=0;n<8;n++)
    043DA 2744      CLR	R20
    043DB C014      RJMP	0x43F0
(0158)     {
(0159)       	if(read_bit_18B20()){
    043DC DF85      RCALL	_read_bit_18B20
    043DD 2300      TST	R16
    043DE F031      BEQ	0x43E5
(0160)       		temp|=(1<<n);
    043DF E001      LDI	R16,1
    043E0 2F14      MOV	R17,R20
    043E1 940E 4BB4 CALL	lsl8
    043E3 2AA0      OR	R10,R16
(0161)       	}else{
    043E4 C007      RJMP	0x43EC
(0162)       		temp&=~(1<<n);
    043E5 E001      LDI	R16,1
    043E6 2F14      MOV	R17,R20
    043E7 940E 4BB4 CALL	lsl8
    043E9 2E20      MOV	R2,R16
    043EA 9420      COM	R2
    043EB 20A2      AND	R10,R2
(0163)       	}
(0164)       	Delay_nus(70); //60~120us
    043EC E406      LDI	R16,0x46
    043ED E010      LDI	R17,0
    043EE DEAF      RCALL	_Delay_nus
    043EF 9543      INC	R20
    043F0 3048      CPI	R20,0x8
    043F1 F350      BCS	0x43DC
(0165)       	
(0166)    }
(0167)    SEI();
    043F2 9478      BSET	7
(0168) 
(0169)    return temp;
    043F3 2D0A      MOV	R16,R10
    043F4 9149      LD	R20,Y+
    043F5 90A9      LD	R10,Y+
    043F6 9508      RET
(0170) }
(0171) 
(0172) 
(0173) 
(0174) //------------------------------------------------------------------------------
(0175) // 应用函数部分！ 供外部调用
(0176) //------------------------------------------------------------------------------
(0177) //------------------------------------------------------------------------------
(0178) // 单器件/多器件：开始转换
(0179) //------------------------------------------------------------------------------
(0180) void convert_T(void)
(0181) {
(0182) 					if(reset_18B20()){
_convert_T:
    043F7 DEB6      RCALL	_reset_18B20
    043F8 2300      TST	R16
    043F9 F021      BEQ	0x43FE
(0183) 					write_byte_18B20(0xcc);
    043FA EC0C      LDI	R16,0xCC
    043FB DFB9      RCALL	_write_byte_18B20
(0184) 					write_byte_18B20(0x44);
    043FC E404      LDI	R16,0x44
    043FD DFB7      RCALL	_write_byte_18B20
(0185) 					}
    043FE 9508      RET
_read_T:
  tmp                  --> Y,+0
  tl                   --> R12
  th                   --> R10
    043FF 940E 4B21 CALL	push_xgset00FC
    04401 9724      SBIW	R28,4
(0186) }
(0187) 
(0188) //------------------------------------------------------------------------------
(0189) // 单器件：读温度，返回INIT8U型温度数据（原始数据）
(0190) //------------------------------------------------------------------------------
(0191) float read_T(void)
(0192) {
(0193)     unsigned char th=0,tl=0;
    04402 24AA      CLR	R10
    04403 24CC      CLR	R12
(0194) 	float tmp;
(0195)     if(reset_18B20()){
    04404 DEA9      RCALL	_reset_18B20
    04405 2300      TST	R16
    04406 F021      BEQ	0x440B
(0196)     	write_byte_18B20(0xcc);
    04407 EC0C      LDI	R16,0xCC
    04408 DFAC      RCALL	_write_byte_18B20
(0197)     	write_byte_18B20(0xbe);
    04409 EB0E      LDI	R16,0xBE
    0440A DFAA      RCALL	_write_byte_18B20
(0198)     }
(0199)     
(0200)     tl = read_byte_18B20();
    0440B DFCA      RCALL	_read_byte_18B20
    0440C 2EC0      MOV	R12,R16
(0201)     th = read_byte_18B20();
    0440D DFC8      RCALL	_read_byte_18B20
    0440E 2EE0      MOV	R14,R16
    0440F 2CAE      MOV	R10,R14
(0202)  	tmp= ((float)(th<<8|tl))*0.0625;
    04410 EE08      LDI	R16,0xE8
    04411 E010      LDI	R17,0
    04412 940E 4AA5 CALL	elpm32
    04414 0118      MOVW	R2,R16
    04415 0129      MOVW	R4,R18
    04416 2D1A      MOV	R17,R10
    04417 2D0C      MOV	R16,R12
    04418 940E 4CC8 CALL	int2fp
    0441A 933A      ST	-Y,R19
    0441B 932A      ST	-Y,R18
    0441C 931A      ST	-Y,R17
    0441D 930A      ST	-Y,R16
    0441E 0181      MOVW	R16,R2
    0441F 0192      MOVW	R18,R4
    04420 940E 4E6D CALL	fpmule2
    04422 8308      ST	Y,R16
    04423 8319      STD	Y+1,R17
    04424 832A      STD	Y+2,R18
    04425 833B      STD	Y+3,R19
(0203)     return( tmp);
    04426 8108      LD	R16,Y
    04427 8119      LDD	R17,Y+1
    04428 812A      LDD	R18,Y+2
    04429 813B      LDD	R19,Y+3
    0442A 9624      ADIW	R28,4
    0442B 940C 4B02 JMP	pop_xgset00FC
_read_T_NUM:
  ttemp                --> Y,+0
  NUM                  --> R10
    0442D 92AA      ST	-Y,R10
    0442E 2EA0      MOV	R10,R16
    0442F 9724      SBIW	R28,4
(0204) }
(0205) 
(0206) float read_T_NUM(unsigned char NUM){
(0207) float ttemp;
(0208) if ( NUM >1) return 123.45;
    04430 E081      LDI	R24,1
    04431 158A      CP	R24,R10
    04432 F428      BCC	0x4438
    04433 EE04      LDI	R16,0xE4
    04434 E010      LDI	R17,0
    04435 940E 4AA5 CALL	elpm32
    04437 C010      RJMP	0x4448
(0209) T_NUM=NUM;//设置访问器件
    04438 92A0 05DE STS	T_NUM,R10
(0210) convert_T();//温度转换
    0443A DFBC      RCALL	_convert_T
(0211) delayms(800);
    0443B E200      LDI	R16,0x20
    0443C E013      LDI	R17,3
    0443D 940E 2D55 CALL	_delayms
(0212) ttemp=read_T();
    0443F DFBF      RCALL	_read_T
    04440 8308      ST	Y,R16
    04441 8319      STD	Y+1,R17
    04442 832A      STD	Y+2,R18
    04443 833B      STD	Y+3,R19
(0213) return ttemp;
    04444 8108      LD	R16,Y
    04445 8119      LDD	R17,Y+1
    04446 812A      LDD	R18,Y+2
    04447 813B      LDD	R19,Y+3
    04448 9624      ADIW	R28,4
    04449 90A9      LD	R10,Y+
    0444A 9508      RET
_readWithoutDelay:
  ttemp                --> Y,+0
  NUM                  --> R10
    0444B 92AA      ST	-Y,R10
    0444C 2EA0      MOV	R10,R16
    0444D 9724      SBIW	R28,4
(0214) }
(0215) float readWithoutDelay(unsigned char NUM)
(0216) {
(0217) float ttemp;
(0218) if ( NUM >1) return 123.45;
    0444E E081      LDI	R24,1
    0444F 158A      CP	R24,R10
    04450 F428      BCC	0x4456
    04451 EE04      LDI	R16,0xE4
    04452 E010      LDI	R17,0
    04453 940E 4AA5 CALL	elpm32
    04455 C00C      RJMP	0x4462
(0219) T_NUM=NUM;//设置访问器件
    04456 92A0 05DE STS	T_NUM,R10
(0220) ttemp=read_T();
    04458 DFA6      RCALL	_read_T
    04459 8308      ST	Y,R16
    0445A 8319      STD	Y+1,R17
    0445B 832A      STD	Y+2,R18
    0445C 833B      STD	Y+3,R19
(0221) convert_T();//温度转换
    0445D DF99      RCALL	_convert_T
(0222) return ttemp;
    0445E 8108      LD	R16,Y
    0445F 8119      LDD	R17,Y+1
    04460 812A      LDD	R18,Y+2
    04461 813B      LDD	R19,Y+3
    04462 9624      ADIW	R28,4
    04463 90A9      LD	R10,Y+
    04464 9508      RET
FILE: D:\LQD\software\software_src\ds1302.c
(0001) #include "config.h"
(0002) 
(0003) #define TPORT PORTB
(0004) #define TDDR DDRB
(0005) #define TPIN PINB
(0006) #define PIN_RST	 4
(0007) #define PIN_IO	 5
(0008) #define PIN_SCK	 6
(0009) /******************复位脚*********************/
(0010) #define RST_CLR	TPORT &= ~(1 << PIN_RST)   /*电平置低*/
(0011) #define RST_SET	TPORT |= (1 << PIN_RST)    /*电平置高*/
(0012) #define RST_IN	TDDR &= ~(1 << PIN_RST)    /*方向输入*/
(0013) #define RST_OUT	TDDR |= (1 << PIN_RST)     /*方向输出*/
(0014) 
(0015) /*****************双向数据********************/
(0016) #define IO_CLR	TPORT &= ~(1 << PIN_IO)  /*电平置低*/
(0017) #define IO_SET	TPORT |= (1 << PIN_IO)   /*电平置高*/
(0018) #define IO_R	TPIN & (1 << PIN_IO)     /*电平读取*/
(0019) #define IO_IN	TDDR &= ~(1 << PIN_IO)   /*方向输入*/
(0020) #define IO_OUT	TDDR |= (1 << PIN_IO)    /*方向输出*/
(0021) 
(0022) /*****************时钟信号*******************/
(0023) #define SCK_CLR	TPORT &= ~(1 << PIN_SCK)  /*时钟信号*/
(0024) #define SCK_SET	TPORT |= (1 << PIN_SCK)   /*电平置高*/
(0025) #define SCK_IN	TDDR &= ~(1 << PIN_SCK)   /*方向输入*/
(0026) #define SCK_OUT	TDDR |= (1 << PIN_SCK)    /*方向输出*/
(0027) 
(0028) #define ds1302_sec_add			0x80		//秒数据地址
(0029) #define ds1302_min_add			0x82		//分数据地址
(0030) #define ds1302_hr_add			0x84		//时数据地址
(0031) #define ds1302_date_add			0x86		//日数据地址
(0032) #define ds1302_month_add		0x88		//月数据地址
(0033) #define ds1302_day_add			0x8a		//星期数据地址
(0034) #define ds1302_year_add			0x8c		//年数据地址
(0035) #define ds1302_control_add		0x8e		//控制数据地址
(0036) #define ds1302_charger_add		0x90 					 
(0037) #define ds1302_clkburst_add		0xbe
(0038) 
(0039) unsigned char time_buf[8] = {0x20,0x0c,0x0A,0x1c,0x22,0x46,0x00,0x06};
(0040) /*
(0041)  struct tm {
(0042)    	int tm_sec;   // 秒 seconds after the minute, 0 to 60
(0043)    	int tm_min;   // 分 minutes after the hour, 0 to 59
(0044) 	int tm_hour;  // 时 hours since midnight, 0 to 23*
(0045) 	int tm_mday;  // 日 day of the month, 1 to 31
(0046) 	int tm_mon;   // 月 months since January, 0 to 11
(0047) 	int tm_year;  // 年 years since 1900
(0048) 	int tm_wday;  // 星期 days since Sunday, 0 to 6
(0049) 	int tm_yday;  // 从元旦起的天数 days since January 1, 0 to 365
(0050)  	int tm_isdst; // 夏令时？？Daylight Savings Time flag
(0051)  	};	
(0052) 	*/
(0053) 
(0054) //DS1302初始化函数
(0055) void ds1302_init(void) 
(0056) {
(0057) 	RST_CLR;			/*RST脚置低*/
_ds1302_init:
    04465 98C4      CBI	0x18,4
(0058) 	SCK_CLR;			/*SCK脚置低*/
    04466 98C6      CBI	0x18,6
(0059) 	RST_OUT;			/*RST脚设置为输出*/
    04467 9ABC      SBI	0x17,4
(0060) 	SCK_OUT;			/*SCK脚设置为输出*/
    04468 9ABE      SBI	0x17,6
    04469 9508      RET
_ds1302_write_byte:
  i                    --> R20
  d                    --> R18
  addr                 --> R16
    0446A 934A      ST	-Y,R20
(0061) }
(0062) 
(0063) //向DS1302写入一字节数据
(0064) void ds1302_write_byte(unsigned char addr, unsigned char d) {
(0065) 
(0066) 	unsigned char i;
(0067) 	RST_SET;					/*启动DS1302总线*/
    0446B 9AC4      SBI	0x18,4
(0068) 	
(0069) 	/*写入目标地址：addr*/
(0070) 	IO_OUT;
    0446C 9ABD      SBI	0x17,5
(0071) 	addr = addr & 0xFE;   //最低位置零，寄存器0位为0时写，为1时读
    0446D 7F0E      ANDI	R16,0xFE
(0072) 	for (i = 0; i < 8; i ++) {
    0446E 2744      CLR	R20
    0446F C009      RJMP	0x4479
(0073) 		if (addr & 0x01) {
    04470 FF00      SBRS	R16,0
    04471 C002      RJMP	0x4474
(0074) 			IO_SET;
    04472 9AC5      SBI	0x18,5
(0075) 			}
    04473 C001      RJMP	0x4475
(0076) 		else {
(0077) 			IO_CLR;
    04474 98C5      CBI	0x18,5
(0078) 			}
(0079) 		SCK_SET;      //产生时钟
    04475 9AC6      SBI	0x18,6
(0080) 		SCK_CLR;
    04476 98C6      CBI	0x18,6
(0081) 		addr = addr >> 1;
    04477 9506      LSR	R16
    04478 9543      INC	R20
    04479 3048      CPI	R20,0x8
    0447A F3A8      BCS	0x4470
(0082) 		}
(0083) 	
(0084) 	/*写入数据：d*/
(0085) 	IO_OUT;
    0447B 9ABD      SBI	0x17,5
(0086) 	for (i = 0; i < 8; i ++) {
    0447C 2744      CLR	R20
    0447D C009      RJMP	0x4487
(0087) 		if (d & 0x01) {
    0447E FF20      SBRS	R18,0
    0447F C002      RJMP	0x4482
(0088) 			IO_SET;
    04480 9AC5      SBI	0x18,5
(0089) 			}
    04481 C001      RJMP	0x4483
(0090) 		else {
(0091) 			IO_CLR;
    04482 98C5      CBI	0x18,5
(0092) 			}
(0093) 		SCK_SET;    //产生时钟
    04483 9AC6      SBI	0x18,6
(0094) 		SCK_CLR;
    04484 98C6      CBI	0x18,6
(0095) 		d = d >> 1;
    04485 9526      LSR	R18
    04486 9543      INC	R20
    04487 3048      CPI	R20,0x8
    04488 F3A8      BCS	0x447E
(0096) 		}
(0097) 	RST_CLR;		//停止DS1302总线
    04489 98C4      CBI	0x18,4
    0448A 9149      LD	R20,Y+
    0448B 9508      RET
_ds1302_read_byte:
  temp                 --> R20
  i                    --> R22
  addr                 --> R16
    0448C 934A      ST	-Y,R20
    0448D 936A      ST	-Y,R22
(0098) 	
(0099) }
(0100) 
(0101) //从DS1302读出一字节数据
(0102) unsigned char ds1302_read_byte(unsigned char addr) {
(0103) 
(0104) 	unsigned char i;
(0105) 	unsigned char temp;
(0106) 	RST_SET;					/*启动DS1302总线*/
    0448E 9AC4      SBI	0x18,4
(0107) 
(0108) 	/*写入目标地址：addr*/
(0109) 	IO_OUT;
    0448F 9ABD      SBI	0x17,5
(0110) 	addr = addr | 0x01;    //最低位置高，寄存器0位为0时写，为1时读
    04490 6001      ORI	R16,1
(0111) 	for (i = 0; i < 8; i ++) {
    04491 2766      CLR	R22
    04492 C009      RJMP	0x449C
(0112) 		if (addr & 0x01) {
    04493 FF00      SBRS	R16,0
    04494 C002      RJMP	0x4497
(0113) 			IO_SET;
    04495 9AC5      SBI	0x18,5
(0114) 			}
    04496 C001      RJMP	0x4498
(0115) 		else {
(0116) 			IO_CLR;
    04497 98C5      CBI	0x18,5
(0117) 			}
(0118) 		SCK_SET;
    04498 9AC6      SBI	0x18,6
(0119) 		SCK_CLR;
    04499 98C6      CBI	0x18,6
(0120) 		addr = addr >> 1;
    0449A 9506      LSR	R16
    0449B 9563      INC	R22
    0449C 3068      CPI	R22,0x8
    0449D F3A8      BCS	0x4493
(0121) 		}
(0122) 	
(0123) 	/*输出数据：temp*/
(0124) 	IO_IN;
    0449E 98BD      CBI	0x17,5
(0125) 	for (i = 0; i < 8; i ++) {
    0449F 2766      CLR	R22
    044A0 C009      RJMP	0x44AA
(0126) 		temp = temp >> 1;
    044A1 9546      LSR	R20
(0127) 		if (IO_R) {
    044A2 9BB5      SBIS	0x16,5
    044A3 C002      RJMP	0x44A6
(0128) 			temp |= 0x80;
    044A4 6840      ORI	R20,0x80
(0129) 			}
    044A5 C001      RJMP	0x44A7
(0130) 		else {
(0131) 			temp &= 0x7F;
    044A6 774F      ANDI	R20,0x7F
(0132) 			}
(0133) 		SCK_SET;
    044A7 9AC6      SBI	0x18,6
(0134) 		SCK_CLR;
    044A8 98C6      CBI	0x18,6
    044A9 9563      INC	R22
    044AA 3068      CPI	R22,0x8
    044AB F3A8      BCS	0x44A1
(0135) 		}
(0136) 	
(0137) 	RST_CLR;					/*停止DS1302总线*/
    044AC 98C4      CBI	0x18,4
(0138) 	return temp;
    044AD 2F04      MOV	R16,R20
    044AE 9169      LD	R22,Y+
    044AF 9149      LD	R20,Y+
    044B0 9508      RET
(0139) }
(0140) 
(0141) //向DS302写入时钟数据
(0142) void ds1302_write_time(void) {
(0143) 
(0144) 	ds1302_write_byte(ds1302_control_add,0x00);			//关闭写保护 
_ds1302_write_time:
    044B1 2722      CLR	R18
    044B2 E80E      LDI	R16,0x8E
    044B3 DFB6      RCALL	_ds1302_write_byte
(0145) 	ds1302_write_byte(ds1302_sec_add,0x80);				//暂停时钟 
    044B4 E820      LDI	R18,0x80
    044B5 E800      LDI	R16,0x80
    044B6 DFB3      RCALL	_ds1302_write_byte
(0146) 	//ds1302_write_byte(ds1302_charger_add,0xa9);	    //涓流充电 
(0147) 	ds1302_write_byte(ds1302_year_add,time_buf[1]);		//年 
    044B7 9120 05E0 LDS	R18,time_buf+1
    044B9 E80C      LDI	R16,0x8C
    044BA DFAF      RCALL	_ds1302_write_byte
(0148) 	ds1302_write_byte(ds1302_month_add,time_buf[2]);	//月 
    044BB 9120 05E1 LDS	R18,time_buf+2
    044BD E808      LDI	R16,0x88
    044BE DFAB      RCALL	_ds1302_write_byte
(0149) 	ds1302_write_byte(ds1302_date_add,time_buf[3]);		//日 
    044BF 9120 05E2 LDS	R18,time_buf+3
    044C1 E806      LDI	R16,0x86
    044C2 DFA7      RCALL	_ds1302_write_byte
(0150) 	ds1302_write_byte(ds1302_hr_add,time_buf[4]);		//时 
    044C3 9120 05E3 LDS	R18,time_buf+4
    044C5 E804      LDI	R16,0x84
    044C6 DFA3      RCALL	_ds1302_write_byte
(0151) 	ds1302_write_byte(ds1302_min_add,time_buf[5]);		//分
    044C7 9120 05E4 LDS	R18,time_buf+5
    044C9 E802      LDI	R16,0x82
    044CA DF9F      RCALL	_ds1302_write_byte
(0152) 	ds1302_write_byte(ds1302_sec_add,time_buf[6]);		//秒
    044CB 9120 05E5 LDS	R18,time_buf+6
    044CD E800      LDI	R16,0x80
    044CE DF9B      RCALL	_ds1302_write_byte
(0153) 	ds1302_write_byte(ds1302_day_add,time_buf[7]);		//周 
    044CF 9120 05E6 LDS	R18,time_buf+7
    044D1 E80A      LDI	R16,0x8A
    044D2 DF97      RCALL	_ds1302_write_byte
(0154) 	ds1302_write_byte(ds1302_control_add,0x80);			//打开写保护 
    044D3 E820      LDI	R18,0x80
    044D4 E80E      LDI	R16,0x8E
    044D5 CF94      RJMP	_ds1302_write_byte
_ds1302_read_time:
    044D6 92AA      ST	-Y,R10
    044D7 934A      ST	-Y,R20
(0155) }
(0156) 
(0157) //从DS302读出时钟数据
(0158) void ds1302_read_time(void)  { 
(0159) 	time_buf[1]=ds1302_read_byte(ds1302_year_add);		//年 
    044D8 E80C      LDI	R16,0x8C
    044D9 DFB2      RCALL	_ds1302_read_byte
    044DA 9300 05E0 STS	time_buf+1,R16
(0160) 	time_buf[2]=ds1302_read_byte(ds1302_month_add);		//月 
    044DC E808      LDI	R16,0x88
    044DD DFAE      RCALL	_ds1302_read_byte
    044DE 9300 05E1 STS	time_buf+2,R16
(0161) 	time_buf[3]=ds1302_read_byte(ds1302_date_add);		//日 
    044E0 E806      LDI	R16,0x86
    044E1 DFAA      RCALL	_ds1302_read_byte
    044E2 2EA0      MOV	R10,R16
    044E3 92A0 05E2 STS	time_buf+3,R10
(0162) 	time_buf[4]=ds1302_read_byte(ds1302_hr_add);		//时 
    044E5 E804      LDI	R16,0x84
    044E6 DFA5      RCALL	_ds1302_read_byte
    044E7 2EA0      MOV	R10,R16
    044E8 92A0 05E3 STS	time_buf+4,R10
(0163) 	time_buf[5]=ds1302_read_byte(ds1302_min_add);		//分 
    044EA E802      LDI	R16,0x82
    044EB DFA0      RCALL	_ds1302_read_byte
    044EC 2EA0      MOV	R10,R16
    044ED 92A0 05E4 STS	time_buf+5,R10
(0164) 	time_buf[6]=(ds1302_read_byte(ds1302_sec_add))&0x7F;//秒，屏蔽秒的第7位，避免超出59
    044EF E800      LDI	R16,0x80
    044F0 DF9B      RCALL	_ds1302_read_byte
    044F1 2F40      MOV	R20,R16
    044F2 2F84      MOV	R24,R20
    044F3 778F      ANDI	R24,0x7F
    044F4 9380 05E5 STS	time_buf+6,R24
(0165) 	time_buf[7]=ds1302_read_byte(ds1302_day_add);		//周 
    044F6 E80A      LDI	R16,0x8A
    044F7 DF94      RCALL	_ds1302_read_byte
    044F8 2EA0      MOV	R10,R16
    044F9 92A0 05E6 STS	time_buf+7,R10
    044FB 9149      LD	R20,Y+
    044FC 90A9      LD	R10,Y+
    044FD 9508      RET
_kbscan:
  key                  --> R20
  temp                 --> Y,+0
    044FE 934A      ST	-Y,R20
    044FF 9724      SBIW	R28,4
FILE: D:\LQD\software\software_src\key.c
(0001) #include "config.h"
(0002) //键盘扫描函数
(0003) unsigned char kbscan(void)
(0004)   {
(0005)    unsigned char key;
(0006)    unsigned long temp=0;
    04500 E080      LDI	R24,0
    04501 8388      ST	Y,R24
    04502 8389      STD	Y+1,R24
    04503 838A      STD	Y+2,R24
    04504 838B      STD	Y+3,R24
(0007)    DDR_SET;
    04505 B38A      IN	R24,0x1A
    04506 7087      ANDI	R24,7
    04507 BB8A      OUT	0x1A,R24
(0008)    
(0009)    if((KEY_PIN) != KEY_MASK)         //检测A口按键引脚电平，如果全是高电平则退出
    04508 B389      IN	R24,0x19
    04509 718F      ANDI	R24,0x1F
    0450A 318F      CPI	R24,0x1F
    0450B F1A9      BEQ	0x4541
(0010)     {
(0011)      delayms(20);           //防抖
    0450C E104      LDI	R16,0x14
    0450D E010      LDI	R17,0
    0450E 940E 2D55 CALL	_delayms
(0012)      if((KEY_PIN) != KEY_MASK )      //再次检测A口电平，如果不全是高电平则继续执行程序
    04510 B389      IN	R24,0x19
    04511 718F      ANDI	R24,0x1F
    04512 318F      CPI	R24,0x1F
    04513 F179      BEQ	0x4543
(0013)       {
(0014)        key = KEY_PIN ;          //读取PINA，将其存放在key中
    04514 B349      IN	R20,0x19
    04515 714F      ANDI	R20,0x1F
    04516 C024      RJMP	0x453B
(0015)         while((KEY_PIN) != KEY_MASK)
(0016) 		{
(0017) 		 temp++ ;
    04517 E081      LDI	R24,1
    04518 E090      LDI	R25,0
    04519 E0A0      LDI	R26,0
    0451A E0B0      LDI	R27,0
    0451B 8028      LD	R2,Y
    0451C 8039      LDD	R3,Y+1
    0451D 804A      LDD	R4,Y+2
    0451E 805B      LDD	R5,Y+3
    0451F 0E28      ADD	R2,R24
    04520 1E39      ADC	R3,R25
    04521 1E4A      ADC	R4,R26
    04522 1E5B      ADC	R5,R27
    04523 8228      ST	Y,R2
    04524 8239      STD	Y+1,R3
    04525 824A      STD	Y+2,R4
    04526 825B      STD	Y+3,R5
(0018) 		 if(temp>LONGKEY) {  
    04527 E880      LDI	R24,0x80
    04528 E398      LDI	R25,0x38
    04529 E0A1      LDI	R26,1
    0452A E0B0      LDI	R27,0
    0452B 8028      LD	R2,Y
    0452C 8039      LDD	R3,Y+1
    0452D 804A      LDD	R4,Y+2
    0452E 805B      LDD	R5,Y+3
    0452F 1582      CP	R24,R2
    04530 0593      CPC	R25,R3
    04531 05A4      CPC	R26,R4
    04532 05B5      CPC	R27,R5
    04533 F438      BCC	0x453B
(0019) 		     delayms(30);
    04534 E10E      LDI	R16,0x1E
    04535 E010      LDI	R17,0
    04536 940E 2D55 CALL	_delayms
(0020) 			 return key+0x80;  
    04538 2F04      MOV	R16,R20
    04539 5800      SUBI	R16,0x80
    0453A C009      RJMP	0x4544
    0453B B389      IN	R24,0x19
    0453C 718F      ANDI	R24,0x1F
    0453D 318F      CPI	R24,0x1F
    0453E F6C1      BNE	0x4517
(0021) 		 };
(0022) 		}
(0023) 		; //当前有按键处于按下状态，再按其他按键时程序维持当前状态 
(0024)       	
(0025) 		return key;
    0453F 2F04      MOV	R16,R20
    04540 C003      RJMP	0x4544
(0026) 	  
(0027) 	  }
(0028)     }
(0029) 	else return NO_KEY;
    04541 2700      CLR	R16
    04542 C001      RJMP	0x4544
(0030) 	
(0031) 	return NO_KEY;
FILE: <library>
    04543 2700      CLR	R16
    04544 9624      ADIW	R28,4
    04545 9149      LD	R20,Y+
    04546 9508      RET
__print:
    04547 940E 49D8 CALL	push_arg4
    04549 940E 4B1D CALL	push_xgsetF0FC
    0454B 976C      SBIW	R28,0x1C
    0454C 2400      CLR	R0
    0454D 2411      CLR	R1
    0454E 8A1F      STD	Y+23,R1
    0454F 8A0E      STD	Y+22,R0
    04550 C456      RJMP	0x49A7
    04551 A5E8      LDD	R30,Y+40
    04552 A5F9      LDD	R31,Y+41
    04553 8180      LD	R24,Z
    04554 3285      CPI	R24,0x25
    04555 F059      BEQ	0x4561
    04556 8100      LD	R16,Z
    04557 A1EE      LDD	R30,Y+38
    04558 A1FF      LDD	R31,Y+39
    04559 940E 4B6A CALL	xicallx
    0455B 898E      LDD	R24,Y+22
    0455C 899F      LDD	R25,Y+23
    0455D 9601      ADIW	R24,1
    0455E 8B9F      STD	Y+23,R25
    0455F 8B8E      STD	Y+22,R24
    04560 C441      RJMP	0x49A2
    04561 2400      CLR	R0
    04562 2411      CLR	R1
    04563 8A1D      STD	Y+21,R1
    04564 8A0C      STD	Y+20,R0
    04565 EF8F      LDI	R24,0xFF
    04566 EF9F      LDI	R25,0xFF
    04567 8F99      STD	Y+25,R25
    04568 8F88      STD	Y+24,R24
    04569 24AA      CLR	R10
    0456A 24BB      CLR	R11
    0456B E242      LDI	R20,0x22
    0456C E059      LDI	R21,0x9
    0456D E260      LDI	R22,0x20
    0456E A588      LDD	R24,Y+40
    0456F A599      LDD	R25,Y+41
    04570 9601      ADIW	R24,1
    04571 A799      STD	Y+41,R25
    04572 A788      STD	Y+40,R24
    04573 24CC      CLR	R12
    04574 24DD      CLR	R13
    04575 A5E8      LDD	R30,Y+40
    04576 A5F9      LDD	R31,Y+41
    04577 80E0      LD	R14,Z
    04578 24FF      CLR	R15
    04579 01C7      MOVW	R24,R14
    0457A 3280      CPI	R24,0x20
    0457B E0E0      LDI	R30,0
    0457C 079E      CPC	R25,R30
    0457D F119      BEQ	0x45A1
    0457E 3283      CPI	R24,0x23
    0457F E0E0      LDI	R30,0
    04580 079E      CPC	R25,R30
    04581 F091      BEQ	0x4594
    04582 3280      CPI	R24,0x20
    04583 E0E0      LDI	R30,0
    04584 079E      CPC	R25,R30
    04585 F124      BLT	0x45AA
    04586 01C7      MOVW	R24,R14
    04587 328B      CPI	R24,0x2B
    04588 E0E0      LDI	R30,0
    04589 079E      CPC	R25,R30
    0458A F089      BEQ	0x459C
    0458B 328D      CPI	R24,0x2D
    0458C E0E0      LDI	R30,0
    0458D 079E      CPC	R25,R30
    0458E F049      BEQ	0x4598
    0458F 3380      CPI	R24,0x30
    04590 E0E0      LDI	R30,0
    04591 079E      CPC	R25,R30
    04592 F099      BEQ	0x45A6
    04593 C016      RJMP	0x45AA
    04594 01C5      MOVW	R24,R10
    04595 6081      ORI	R24,1
    04596 015C      MOVW	R10,R24
    04597 C015      RJMP	0x45AD
    04598 01C5      MOVW	R24,R10
    04599 6084      ORI	R24,4
    0459A 015C      MOVW	R10,R24
    0459B C011      RJMP	0x45AD
    0459C 01C5      MOVW	R24,R10
    0459D 6088      ORI	R24,0x8
    0459E 015C      MOVW	R10,R24
    0459F E26B      LDI	R22,0x2B
    045A0 C00C      RJMP	0x45AD
    045A1 01C5      MOVW	R24,R10
    045A2 6088      ORI	R24,0x8
    045A3 015C      MOVW	R10,R24
    045A4 E260      LDI	R22,0x20
    045A5 C007      RJMP	0x45AD
    045A6 01C5      MOVW	R24,R10
    045A7 6180      ORI	R24,0x10
    045A8 015C      MOVW	R10,R24
    045A9 C003      RJMP	0x45AD
    045AA E081      LDI	R24,1
    045AB E090      LDI	R25,0
    045AC 016C      MOVW	R12,R24
    045AD 20CC      TST	R12
    045AE F411      BNE	0x45B1
    045AF 20DD      TST	R13
    045B0 F009      BEQ	0x45B2
    045B1 C006      RJMP	0x45B8
    045B2 A588      LDD	R24,Y+40
    045B3 A599      LDD	R25,Y+41
    045B4 9601      ADIW	R24,1
    045B5 A799      STD	Y+41,R25
    045B6 A788      STD	Y+40,R24
    045B7 CFBD      RJMP	0x4575
    045B8 A5E8      LDD	R30,Y+40
    045B9 A5F9      LDD	R31,Y+41
    045BA 8100      LD	R16,Z
    045BB 2711      CLR	R17
    045BC 940E 525F CALL	_isdigit
    045BE 3000      CPI	R16,0
    045BF 0701      CPC	R16,R17
    045C0 F0B9      BEQ	0x45D8
    045C1 A508      LDD	R16,Y+40
    045C2 A519      LDD	R17,Y+41
    045C3 940E 4EC0 CALL	_atoi
    045C5 8B1D      STD	Y+21,R17
    045C6 8B0C      STD	Y+20,R16
    045C7 C005      RJMP	0x45CD
    045C8 A588      LDD	R24,Y+40
    045C9 A599      LDD	R25,Y+41
    045CA 9601      ADIW	R24,1
    045CB A799      STD	Y+41,R25
    045CC A788      STD	Y+40,R24
    045CD A5E8      LDD	R30,Y+40
    045CE A5F9      LDD	R31,Y+41
    045CF 8100      LD	R16,Z
    045D0 2711      CLR	R17
    045D1 940E 525F CALL	_isdigit
    045D3 0168      MOVW	R12,R16
    045D4 3000      CPI	R16,0
    045D5 0701      CPC	R16,R17
    045D6 F789      BNE	0x45C8
    045D7 C015      RJMP	0x45ED
    045D8 A5E8      LDD	R30,Y+40
    045D9 A5F9      LDD	R31,Y+41
    045DA 8180      LD	R24,Z
    045DB 328A      CPI	R24,0x2A
    045DC F481      BNE	0x45ED
    045DD A58A      LDD	R24,Y+42
    045DE A59B      LDD	R25,Y+43
    045DF 9602      ADIW	R24,2
    045E0 A79B      STD	Y+43,R25
    045E1 A78A      STD	Y+42,R24
    045E2 01FC      MOVW	R30,R24
    045E3 9732      SBIW	R30,2
    045E4 8020      LD	R2,Z
    045E5 8031      LDD	R3,Z+1
    045E6 8A3D      STD	Y+21,R3
    045E7 8A2C      STD	Y+20,R2
    045E8 A588      LDD	R24,Y+40
    045E9 A599      LDD	R25,Y+41
    045EA 9601      ADIW	R24,1
    045EB A799      STD	Y+41,R25
    045EC A788      STD	Y+40,R24
    045ED A5E8      LDD	R30,Y+40
    045EE A5F9      LDD	R31,Y+41
    045EF 8180      LD	R24,Z
    045F0 328E      CPI	R24,0x2E
    045F1 F009      BEQ	0x45F3
    045F2 C03A      RJMP	0x462D
    045F3 01CF      MOVW	R24,R30
    045F4 9601      ADIW	R24,1
    045F5 A799      STD	Y+41,R25
    045F6 A788      STD	Y+40,R24
    045F7 01FC      MOVW	R30,R24
    045F8 8100      LD	R16,Z
    045F9 2711      CLR	R17
    045FA 940E 525F CALL	_isdigit
    045FC 0168      MOVW	R12,R16
    045FD 3000      CPI	R16,0
    045FE 0701      CPC	R16,R17
    045FF F0C1      BEQ	0x4618
    04600 A508      LDD	R16,Y+40
    04601 A519      LDD	R17,Y+41
    04602 940E 4EC0 CALL	_atoi
    04604 0168      MOVW	R12,R16
    04605 8ED9      STD	Y+25,R13
    04606 8EC8      STD	Y+24,R12
    04607 C005      RJMP	0x460D
    04608 A588      LDD	R24,Y+40
    04609 A599      LDD	R25,Y+41
    0460A 9601      ADIW	R24,1
    0460B A799      STD	Y+41,R25
    0460C A788      STD	Y+40,R24
    0460D A5E8      LDD	R30,Y+40
    0460E A5F9      LDD	R31,Y+41
    0460F 8100      LD	R16,Z
    04610 2711      CLR	R17
    04611 940E 525F CALL	_isdigit
    04613 0168      MOVW	R12,R16
    04614 3000      CPI	R16,0
    04615 0701      CPC	R16,R17
    04616 F789      BNE	0x4608
    04617 C015      RJMP	0x462D
    04618 A5E8      LDD	R30,Y+40
    04619 A5F9      LDD	R31,Y+41
    0461A 8180      LD	R24,Z
    0461B 328A      CPI	R24,0x2A
    0461C F481      BNE	0x462D
    0461D A58A      LDD	R24,Y+42
    0461E A59B      LDD	R25,Y+43
    0461F 9602      ADIW	R24,2
    04620 A79B      STD	Y+43,R25
    04621 A78A      STD	Y+42,R24
    04622 01FC      MOVW	R30,R24
    04623 9732      SBIW	R30,2
    04624 8020      LD	R2,Z
    04625 8031      LDD	R3,Z+1
    04626 8E39      STD	Y+25,R3
    04627 8E28      STD	Y+24,R2
    04628 A588      LDD	R24,Y+40
    04629 A599      LDD	R25,Y+41
    0462A 9601      ADIW	R24,1
    0462B A799      STD	Y+41,R25
    0462C A788      STD	Y+40,R24
    0462D A5E8      LDD	R30,Y+40
    0462E A5F9      LDD	R31,Y+41
    0462F 8180      LD	R24,Z
    04630 368C      CPI	R24,0x6C
    04631 F439      BNE	0x4639
    04632 01CF      MOVW	R24,R30
    04633 9601      ADIW	R24,1
    04634 A799      STD	Y+41,R25
    04635 A788      STD	Y+40,R24
    04636 01C5      MOVW	R24,R10
    04637 6082      ORI	R24,2
    04638 015C      MOVW	R10,R24
    04639 A5E8      LDD	R30,Y+40
    0463A A5F9      LDD	R31,Y+41
    0463B 80C0      LD	R12,Z
    0463C 24DD      CLR	R13
    0463D 01C6      MOVW	R24,R12
    0463E 3583      CPI	R24,0x53
    0463F E0E0      LDI	R30,0
    04640 079E      CPC	R25,R30
    04641 F409      BNE	0x4643
    04642 C18A      RJMP	0x47CD
    04643 E583      LDI	R24,0x53
    04644 158C      CP	R24,R12
    04645 059D      CPC	R25,R13
    04646 F064      BLT	0x4653
    04647 01C6      MOVW	R24,R12
    04648 3485      CPI	R24,0x45
    04649 E0E0      LDI	R30,0
    0464A 079E      CPC	R25,R30
    0464B F409      BNE	0x464D
    0464C C307      RJMP	0x4954
    0464D 3487      CPI	R24,0x47
    0464E E0E0      LDI	R30,0
    0464F 079E      CPC	R25,R30
    04650 F409      BNE	0x4652
    04651 C30B      RJMP	0x495D
    04652 C043      RJMP	0x4696
    04653 01C6      MOVW	R24,R12
    04654 3588      CPI	R24,0x58
    04655 E0E0      LDI	R30,0
    04656 079E      CPC	R25,R30
    04657 F409      BNE	0x4659
    04658 C07E      RJMP	0x46D7
    04659 3588      CPI	R24,0x58
    0465A E0E0      LDI	R30,0
    0465B 079E      CPC	R25,R30
    0465C F40C      BGE	0x465E
    0465D C038      RJMP	0x4696
    0465E 01C6      MOVW	R24,R12
    0465F 3683      CPI	R24,0x63
    04660 E0E0      LDI	R30,0
    04661 079E      CPC	R25,R30
    04662 F409      BNE	0x4664
    04663 C145      RJMP	0x47A9
    04664 3684      CPI	R24,0x64
    04665 E0E0      LDI	R30,0
    04666 079E      CPC	R25,R30
    04667 F409      BNE	0x4669
    04668 C03A      RJMP	0x46A3
    04669 3685      CPI	R24,0x65
    0466A E0E0      LDI	R30,0
    0466B 079E      CPC	R25,R30
    0466C F409      BNE	0x466E
    0466D C2E3      RJMP	0x4951
    0466E 3686      CPI	R24,0x66
    0466F E0E0      LDI	R30,0
    04670 079E      CPC	R25,R30
    04671 F409      BNE	0x4673
    04672 C2E4      RJMP	0x4957
    04673 3687      CPI	R24,0x67
    04674 E0E0      LDI	R30,0
    04675 079E      CPC	R25,R30
    04676 F409      BNE	0x4678
    04677 C2E2      RJMP	0x495A
    04678 3689      CPI	R24,0x69
    04679 E0E0      LDI	R30,0
    0467A 079E      CPC	R25,R30
    0467B F139      BEQ	0x46A3
    0467C 368F      CPI	R24,0x6F
    0467D E0E0      LDI	R30,0
    0467E 079E      CPC	R25,R30
    0467F F409      BNE	0x4681
    04680 C056      RJMP	0x46D7
    04681 3780      CPI	R24,0x70
    04682 E0E0      LDI	R30,0
    04683 079E      CPC	R25,R30
    04684 F409      BNE	0x4686
    04685 C051      RJMP	0x46D7
    04686 3783      CPI	R24,0x73
    04687 E0E0      LDI	R30,0
    04688 079E      CPC	R25,R30
    04689 F409      BNE	0x468B
    0468A C200      RJMP	0x488B
    0468B 3785      CPI	R24,0x75
    0468C E0E0      LDI	R30,0
    0468D 079E      CPC	R25,R30
    0468E F409      BNE	0x4690
    0468F C047      RJMP	0x46D7
    04690 3788      CPI	R24,0x78
    04691 E0E0      LDI	R30,0
    04692 079E      CPC	R25,R30
    04693 F409      BNE	0x4695
    04694 C042      RJMP	0x46D7
    04695 C000      RJMP	0x4696
    04696 A5E8      LDD	R30,Y+40
    04697 A5F9      LDD	R31,Y+41
    04698 8100      LD	R16,Z
    04699 A1EE      LDD	R30,Y+38
    0469A A1FF      LDD	R31,Y+39
    0469B 940E 4B6A CALL	xicallx
    0469D 898E      LDD	R24,Y+22
    0469E 899F      LDD	R25,Y+23
    0469F 9601      ADIW	R24,1
    046A0 8B9F      STD	Y+23,R25
    046A1 8B8E      STD	Y+22,R24
    046A2 C2FF      RJMP	0x49A2
    046A3 FEA1      SBRS	R10,1
    046A4 C01E      RJMP	0x46C3
    046A5 A58A      LDD	R24,Y+42
    046A6 A59B      LDD	R25,Y+43
    046A7 9604      ADIW	R24,4
    046A8 A79B      STD	Y+43,R25
    046A9 A78A      STD	Y+42,R24
    046AA 01FC      MOVW	R30,R24
    046AB 9734      SBIW	R30,4
    046AC 8020      LD	R2,Z
    046AD 8031      LDD	R3,Z+1
    046AE 8042      LDD	R4,Z+2
    046AF 8053      LDD	R5,Z+3
    046B0 862C      STD	Y+12,R2
    046B1 863D      STD	Y+13,R3
    046B2 864E      STD	Y+14,R4
    046B3 865F      STD	Y+15,R5
    046B4 E08A      LDI	R24,0xA
    046B5 E090      LDI	R25,0
    046B6 839B      STD	Y+3,R25
    046B7 838A      STD	Y+2,R24
    046B8 842C      LDD	R2,Y+12
    046B9 843D      LDD	R3,Y+13
    046BA 844E      LDD	R4,Y+14
    046BB 845F      LDD	R5,Y+15
    046BC 8248      ST	Y,R4
    046BD 8259      STD	Y+1,R5
    046BE 0191      MOVW	R18,R2
    046BF 018A      MOVW	R16,R20
    046C0 940E 4F71 CALL	_ltoa
    046C2 C0C1      RJMP	0x4784
    046C3 A58A      LDD	R24,Y+42
    046C4 A59B      LDD	R25,Y+43
    046C5 9602      ADIW	R24,2
    046C6 A79B      STD	Y+43,R25
    046C7 A78A      STD	Y+42,R24
    046C8 01FC      MOVW	R30,R24
    046C9 9732      SBIW	R30,2
    046CA 8020      LD	R2,Z
    046CB 8031      LDD	R3,Z+1
    046CC 8E3B      STD	Y+27,R3
    046CD 8E2A      STD	Y+26,R2
    046CE E08A      LDI	R24,0xA
    046CF E090      LDI	R25,0
    046D0 8399      STD	Y+1,R25
    046D1 8388      ST	Y,R24
    046D2 0191      MOVW	R18,R2
    046D3 018A      MOVW	R16,R20
    046D4 940E 4F06 CALL	_itoa
    046D6 C0AD      RJMP	0x4784
    046D7 FEA1      SBRS	R10,1
    046D8 C010      RJMP	0x46E9
    046D9 A58A      LDD	R24,Y+42
    046DA A59B      LDD	R25,Y+43
    046DB 9604      ADIW	R24,4
    046DC A79B      STD	Y+43,R25
    046DD A78A      STD	Y+42,R24
    046DE 01FC      MOVW	R30,R24
    046DF 9734      SBIW	R30,4
    046E0 8020      LD	R2,Z
    046E1 8031      LDD	R3,Z+1
    046E2 8042      LDD	R4,Z+2
    046E3 8053      LDD	R5,Z+3
    046E4 862C      STD	Y+12,R2
    046E5 863D      STD	Y+13,R3
    046E6 864E      STD	Y+14,R4
    046E7 865F      STD	Y+15,R5
    046E8 C00B      RJMP	0x46F4
    046E9 A58A      LDD	R24,Y+42
    046EA A59B      LDD	R25,Y+43
    046EB 9602      ADIW	R24,2
    046EC A79B      STD	Y+43,R25
    046ED A78A      STD	Y+42,R24
    046EE 01FC      MOVW	R30,R24
    046EF 9732      SBIW	R30,2
    046F0 8020      LD	R2,Z
    046F1 8031      LDD	R3,Z+1
    046F2 8E3B      STD	Y+27,R3
    046F3 8E2A      STD	Y+26,R2
    046F4 A5E8      LDD	R30,Y+40
    046F5 A5F9      LDD	R31,Y+41
    046F6 8180      LD	R24,Z
    046F7 3785      CPI	R24,0x75
    046F8 F4D9      BNE	0x4714
    046F9 FEA1      SBRS	R10,1
    046FA C00F      RJMP	0x470A
    046FB E08A      LDI	R24,0xA
    046FC E090      LDI	R25,0
    046FD 839B      STD	Y+3,R25
    046FE 838A      STD	Y+2,R24
    046FF 842C      LDD	R2,Y+12
    04700 843D      LDD	R3,Y+13
    04701 844E      LDD	R4,Y+14
    04702 845F      LDD	R5,Y+15
    04703 8248      ST	Y,R4
    04704 8259      STD	Y+1,R5
    04705 0191      MOVW	R18,R2
    04706 018A      MOVW	R16,R20
    04707 940E 5029 CALL	_ultoa
    04709 C07A      RJMP	0x4784
    0470A E08A      LDI	R24,0xA
    0470B E090      LDI	R25,0
    0470C 8399      STD	Y+1,R25
    0470D 8388      ST	Y,R24
    0470E 8D2A      LDD	R18,Y+26
    0470F 8D3B      LDD	R19,Y+27
    04710 018A      MOVW	R16,R20
    04711 940E 5090 CALL	_utoa
    04713 C070      RJMP	0x4784
    04714 A5E8      LDD	R30,Y+40
    04715 A5F9      LDD	R31,Y+41
    04716 8180      LD	R24,Z
    04717 368F      CPI	R24,0x6F
    04718 F509      BNE	0x473A
    04719 FEA0      SBRS	R10,0
    0471A C004      RJMP	0x471F
    0471B E380      LDI	R24,0x30
    0471C 01FA      MOVW	R30,R20
    0471D 9381      ST	Z+,R24
    0471E 01AF      MOVW	R20,R30
    0471F FEA1      SBRS	R10,1
    04720 C00F      RJMP	0x4730
    04721 E088      LDI	R24,0x8
    04722 E090      LDI	R25,0
    04723 839B      STD	Y+3,R25
    04724 838A      STD	Y+2,R24
    04725 842C      LDD	R2,Y+12
    04726 843D      LDD	R3,Y+13
    04727 844E      LDD	R4,Y+14
    04728 845F      LDD	R5,Y+15
    04729 8248      ST	Y,R4
    0472A 8259      STD	Y+1,R5
    0472B 0191      MOVW	R18,R2
    0472C 018A      MOVW	R16,R20
    0472D 940E 5029 CALL	_ultoa
    0472F C054      RJMP	0x4784
    04730 E088      LDI	R24,0x8
    04731 E090      LDI	R25,0
    04732 8399      STD	Y+1,R25
    04733 8388      ST	Y,R24
    04734 8D2A      LDD	R18,Y+26
    04735 8D3B      LDD	R19,Y+27
    04736 018A      MOVW	R16,R20
    04737 940E 5090 CALL	_utoa
    04739 C04A      RJMP	0x4784
    0473A A5E8      LDD	R30,Y+40
    0473B A5F9      LDD	R31,Y+41
    0473C 8180      LD	R24,Z
    0473D 3780      CPI	R24,0x70
    0473E F439      BNE	0x4746
    0473F E380      LDI	R24,0x30
    04740 01FA      MOVW	R30,R20
    04741 9381      ST	Z+,R24
    04742 E788      LDI	R24,0x78
    04743 9381      ST	Z+,R24
    04744 01AF      MOVW	R20,R30
    04745 C00C      RJMP	0x4752
    04746 FEA0      SBRS	R10,0
    04747 C00A      RJMP	0x4752
    04748 E380      LDI	R24,0x30
    04749 01FA      MOVW	R30,R20
    0474A 9381      ST	Z+,R24
    0474B 01AF      MOVW	R20,R30
    0474C A5E8      LDD	R30,Y+40
    0474D A5F9      LDD	R31,Y+41
    0474E 8020      LD	R2,Z
    0474F 01FA      MOVW	R30,R20
    04750 9221      ST	Z+,R2
    04751 01AF      MOVW	R20,R30
    04752 FEA1      SBRS	R10,1
    04753 C00F      RJMP	0x4763
    04754 E180      LDI	R24,0x10
    04755 E090      LDI	R25,0
    04756 839B      STD	Y+3,R25
    04757 838A      STD	Y+2,R24
    04758 842C      LDD	R2,Y+12
    04759 843D      LDD	R3,Y+13
    0475A 844E      LDD	R4,Y+14
    0475B 845F      LDD	R5,Y+15
    0475C 8248      ST	Y,R4
    0475D 8259      STD	Y+1,R5
    0475E 0191      MOVW	R18,R2
    0475F 018A      MOVW	R16,R20
    04760 940E 5029 CALL	_ultoa
    04762 C009      RJMP	0x476C
    04763 E180      LDI	R24,0x10
    04764 E090      LDI	R25,0
    04765 8399      STD	Y+1,R25
    04766 8388      ST	Y,R24
    04767 8D2A      LDD	R18,Y+26
    04768 8D3B      LDD	R19,Y+27
    04769 018A      MOVW	R16,R20
    0476A 940E 5090 CALL	_utoa
    0476C A5E8      LDD	R30,Y+40
    0476D A5F9      LDD	R31,Y+41
    0476E 8180      LD	R24,Z
    0476F 3588      CPI	R24,0x58
    04770 F499      BNE	0x4784
    04771 E282      LDI	R24,0x22
    04772 E099      LDI	R25,0x9
    04773 017C      MOVW	R14,R24
    04774 C00B      RJMP	0x4780
    04775 01F7      MOVW	R30,R14
    04776 8100      LD	R16,Z
    04777 2711      CLR	R17
    04778 940E 527D CALL	_toupper
    0477A 0168      MOVW	R12,R16
    0477B 01F7      MOVW	R30,R14
    0477C 82C0      ST	Z,R12
    0477D 01C7      MOVW	R24,R14
    0477E 9601      ADIW	R24,1
    0477F 017C      MOVW	R14,R24
    04780 01F7      MOVW	R30,R14
    04781 8020      LD	R2,Z
    04782 2022      TST	R2
    04783 F789      BNE	0x4775
    04784 E282      LDI	R24,0x22
    04785 E099      LDI	R25,0x9
    04786 017C      MOVW	R14,R24
    04787 8D88      LDD	R24,Y+24
    04788 8D99      LDD	R25,Y+25
    04789 3F8F      CPI	R24,0xFF
    0478A EFEF      LDI	R30,0xFF
    0478B 079E      CPC	R25,R30
    0478C F421      BNE	0x4791
    0478D 2400      CLR	R0
    0478E 2411      CLR	R1
    0478F 8E19      STD	Y+25,R1
    04790 8E08      STD	Y+24,R0
    04791 8C08      LDD	R0,Y+24
    04792 8C19      LDD	R1,Y+25
    04793 2000      TST	R0
    04794 F419      BNE	0x4798
    04795 2011      TST	R1
    04796 F409      BNE	0x4798
    04797 C104      RJMP	0x489C
    04798 E202      LDI	R16,0x22
    04799 E019      LDI	R17,0x9
    0479A 940E 49CC CALL	_strlen
    0479C 0168      MOVW	R12,R16
    0479D 8EDB      STD	Y+27,R13
    0479E 8ECA      STD	Y+26,R12
    0479F 8C08      LDD	R0,Y+24
    047A0 8C19      LDD	R1,Y+25
    047A1 140C      CP	R0,R12
    047A2 041D      CPC	R1,R13
    047A3 F00C      BLT	0x47A5
    047A4 C0F7      RJMP	0x489C
    047A5 0106      MOVW	R0,R12
    047A6 8E19      STD	Y+25,R1
    047A7 8E08      STD	Y+24,R0
    047A8 C0F3      RJMP	0x489C
    047A9 A58A      LDD	R24,Y+42
    047AA A59B      LDD	R25,Y+43
    047AB 9602      ADIW	R24,2
    047AC A79B      STD	Y+43,R25
    047AD A78A      STD	Y+42,R24
    047AE 01FC      MOVW	R30,R24
    047AF 9732      SBIW	R30,2
    047B0 8020      LD	R2,Z
    047B1 8031      LDD	R3,Z+1
    047B2 862A      STD	Y+10,R2
    047B3 E081      LDI	R24,1
    047B4 E090      LDI	R25,0
    047B5 880C      LDD	R0,Y+20
    047B6 881D      LDD	R1,Y+21
    047B7 1580      CP	R24,R0
    047B8 0591      CPC	R25,R1
    047B9 F444      BGE	0x47C2
    047BA 8E19      STD	Y+25,R1
    047BB 8E08      STD	Y+24,R0
    047BC 2422      CLR	R2
    047BD 862B      STD	Y+11,R2
    047BE 01CE      MOVW	R24,R28
    047BF 960A      ADIW	R24,0xA
    047C0 017C      MOVW	R14,R24
    047C1 C0DA      RJMP	0x489C
    047C2 850A      LDD	R16,Y+10
    047C3 A1EE      LDD	R30,Y+38
    047C4 A1FF      LDD	R31,Y+39
    047C5 940E 4B6A CALL	xicallx
    047C7 898E      LDD	R24,Y+22
    047C8 899F      LDD	R25,Y+23
    047C9 9601      ADIW	R24,1
    047CA 8B9F      STD	Y+23,R25
    047CB 8B8E      STD	Y+22,R24
    047CC C1D5      RJMP	0x49A2
    047CD A58A      LDD	R24,Y+42
    047CE A59B      LDD	R25,Y+43
    047CF 9602      ADIW	R24,2
    047D0 A79B      STD	Y+43,R25
    047D1 A78A      STD	Y+42,R24
    047D2 01FC      MOVW	R30,R24
    047D3 9732      SBIW	R30,2
    047D4 80C0      LD	R12,Z
    047D5 80D1      LDD	R13,Z+1
    047D6 8D88      LDD	R24,Y+24
    047D7 8D99      LDD	R25,Y+25
    047D8 3F8F      CPI	R24,0xFF
    047D9 EFEF      LDI	R30,0xFF
    047DA 079E      CPC	R25,R30
    047DB F421      BNE	0x47E0
    047DC 2400      CLR	R0
    047DD 2411      CLR	R1
    047DE 8E19      STD	Y+25,R1
    047DF 8E08      STD	Y+24,R0
    047E0 880C      LDD	R0,Y+20
    047E1 881D      LDD	R1,Y+21
    047E2 2000      TST	R0
    047E3 F411      BNE	0x47E6
    047E4 2011      TST	R1
    047E5 F051      BEQ	0x47F0
    047E6 0186      MOVW	R16,R12
    047E7 940E 4EB3 CALL	_cstrlen
    047E9 01A8      MOVW	R20,R16
    047EA 882C      LDD	R2,Y+20
    047EB 883D      LDD	R3,Y+21
    047EC 1A20      SUB	R2,R16
    047ED 0A31      SBC	R3,R17
    047EE 8A3D      STD	Y+21,R3
    047EF 8A2C      STD	Y+20,R2
    047F0 8C08      LDD	R0,Y+24
    047F1 8C19      LDD	R1,Y+25
    047F2 2000      TST	R0
    047F3 F441      BNE	0x47FC
    047F4 2011      TST	R1
    047F5 F431      BNE	0x47FC
    047F6 0186      MOVW	R16,R12
    047F7 940E 4EB3 CALL	_cstrlen
    047F9 01A8      MOVW	R20,R16
    047FA 8F59      STD	Y+25,R21
    047FB 8F48      STD	Y+24,R20
    047FC 880C      LDD	R0,Y+20
    047FD 881D      LDD	R1,Y+21
    047FE 2000      TST	R0
    047FF F411      BNE	0x4802
    04800 2011      TST	R1
    04801 F031      BEQ	0x4808
    04802 FEA3      SBRS	R10,3
    04803 C004      RJMP	0x4808
    04804 01C0      MOVW	R24,R0
    04805 9701      SBIW	R24,1
    04806 8B9D      STD	Y+21,R25
    04807 8B8C      STD	Y+20,R24
    04808 FEA4      SBRS	R10,4
    04809 C026      RJMP	0x4830
    0480A FEA3      SBRS	R10,3
    0480B C00A      RJMP	0x4816
    0480C 2F06      MOV	R16,R22
    0480D A1EE      LDD	R30,Y+38
    0480E A1FF      LDD	R31,Y+39
    0480F 940E 4B6A CALL	xicallx
    04811 898E      LDD	R24,Y+22
    04812 899F      LDD	R25,Y+23
    04813 9601      ADIW	R24,1
    04814 8B9F      STD	Y+23,R25
    04815 8B8E      STD	Y+22,R24
    04816 FCA2      SBRC	R10,2
    04817 C04C      RJMP	0x4864
    04818 C00F      RJMP	0x4828
    04819 E300      LDI	R16,0x30
    0481A A1EE      LDD	R30,Y+38
    0481B A1FF      LDD	R31,Y+39
    0481C 940E 4B6A CALL	xicallx
    0481E 898E      LDD	R24,Y+22
    0481F 899F      LDD	R25,Y+23
    04820 9601      ADIW	R24,1
    04821 8B9F      STD	Y+23,R25
    04822 8B8E      STD	Y+22,R24
    04823 898C      LDD	R24,Y+20
    04824 899D      LDD	R25,Y+21
    04825 9701      SBIW	R24,1
    04826 8B9D      STD	Y+21,R25
    04827 8B8C      STD	Y+20,R24
    04828 2422      CLR	R2
    04829 2433      CLR	R3
    0482A 880C      LDD	R0,Y+20
    0482B 881D      LDD	R1,Y+21
    0482C 1420      CP	R2,R0
    0482D 0431      CPC	R3,R1
    0482E F354      BLT	0x4819
    0482F C034      RJMP	0x4864
    04830 FCA2      SBRC	R10,2
    04831 C017      RJMP	0x4849
    04832 C00F      RJMP	0x4842
    04833 E200      LDI	R16,0x20
    04834 A1EE      LDD	R30,Y+38
    04835 A1FF      LDD	R31,Y+39
    04836 940E 4B6A CALL	xicallx
    04838 898E      LDD	R24,Y+22
    04839 899F      LDD	R25,Y+23
    0483A 9601      ADIW	R24,1
    0483B 8B9F      STD	Y+23,R25
    0483C 8B8E      STD	Y+22,R24
    0483D 898C      LDD	R24,Y+20
    0483E 899D      LDD	R25,Y+21
    0483F 9701      SBIW	R24,1
    04840 8B9D      STD	Y+21,R25
    04841 8B8C      STD	Y+20,R24
    04842 2422      CLR	R2
    04843 2433      CLR	R3
    04844 880C      LDD	R0,Y+20
    04845 881D      LDD	R1,Y+21
    04846 1420      CP	R2,R0
    04847 0431      CPC	R3,R1
    04848 F354      BLT	0x4833
    04849 FEA3      SBRS	R10,3
    0484A C019      RJMP	0x4864
    0484B 2F06      MOV	R16,R22
    0484C A1EE      LDD	R30,Y+38
    0484D A1FF      LDD	R31,Y+39
    0484E 940E 4B6A CALL	xicallx
    04850 898E      LDD	R24,Y+22
    04851 899F      LDD	R25,Y+23
    04852 9601      ADIW	R24,1
    04853 8B9F      STD	Y+23,R25
    04854 8B8E      STD	Y+22,R24
    04855 C00E      RJMP	0x4864
    04856 01F6      MOVW	R30,R12
    04857 9106      ELPM	R16,Z
    04858 A1EE      LDD	R30,Y+38
    04859 A1FF      LDD	R31,Y+39
    0485A 940E 4B6A CALL	xicallx
    0485C 898E      LDD	R24,Y+22
    0485D 899F      LDD	R25,Y+23
    0485E 9601      ADIW	R24,1
    0485F 8B9F      STD	Y+23,R25
    04860 8B8E      STD	Y+22,R24
    04861 01C6      MOVW	R24,R12
    04862 9601      ADIW	R24,1
    04863 016C      MOVW	R12,R24
    04864 01F6      MOVW	R30,R12
    04865 9026      ELPM	R2,Z
    04866 2022      TST	R2
    04867 F049      BEQ	0x4871
    04868 8D48      LDD	R20,Y+24
    04869 8D59      LDD	R21,Y+25
    0486A 01CA      MOVW	R24,R20
    0486B 9701      SBIW	R24,1
    0486C 8F99      STD	Y+25,R25
    0486D 8F88      STD	Y+24,R24
    0486E 3040      CPI	R20,0
    0486F 0745      CPC	R20,R21
    04870 F729      BNE	0x4856
    04871 FEA2      SBRS	R10,2
    04872 C12F      RJMP	0x49A2
    04873 C00F      RJMP	0x4883
    04874 E200      LDI	R16,0x20
    04875 A1EE      LDD	R30,Y+38
    04876 A1FF      LDD	R31,Y+39
    04877 940E 4B6A CALL	xicallx
    04879 898E      LDD	R24,Y+22
    0487A 899F      LDD	R25,Y+23
    0487B 9601      ADIW	R24,1
    0487C 8B9F      STD	Y+23,R25
    0487D 8B8E      STD	Y+22,R24
    0487E 898C      LDD	R24,Y+20
    0487F 899D      LDD	R25,Y+21
    04880 9701      SBIW	R24,1
    04881 8B9D      STD	Y+21,R25
    04882 8B8C      STD	Y+20,R24
    04883 2422      CLR	R2
    04884 2433      CLR	R3
    04885 880C      LDD	R0,Y+20
    04886 881D      LDD	R1,Y+21
    04887 1420      CP	R2,R0
    04888 0431      CPC	R3,R1
    04889 F354      BLT	0x4874
    0488A C117      RJMP	0x49A2
    0488B A58A      LDD	R24,Y+42
    0488C A59B      LDD	R25,Y+43
    0488D 9602      ADIW	R24,2
    0488E A79B      STD	Y+43,R25
    0488F A78A      STD	Y+42,R24
    04890 01FC      MOVW	R30,R24
    04891 9732      SBIW	R30,2
    04892 80E0      LD	R14,Z
    04893 80F1      LDD	R15,Z+1
    04894 20EE      TST	R14
    04895 F431      BNE	0x489C
    04896 20FF      TST	R15
    04897 F421      BNE	0x489C
    04898 EE8C      LDI	R24,0xEC
    04899 E090      LDI	R25,0
    0489A 016C      MOVW	R12,R24
    0489B CF3A      RJMP	0x47D6
    0489C 8D88      LDD	R24,Y+24
    0489D 8D99      LDD	R25,Y+25
    0489E 3F8F      CPI	R24,0xFF
    0489F EFEF      LDI	R30,0xFF
    048A0 079E      CPC	R25,R30
    048A1 F421      BNE	0x48A6
    048A2 2400      CLR	R0
    048A3 2411      CLR	R1
    048A4 8E19      STD	Y+25,R1
    048A5 8E08      STD	Y+24,R0
    048A6 880C      LDD	R0,Y+20
    048A7 881D      LDD	R1,Y+21
    048A8 2000      TST	R0
    048A9 F411      BNE	0x48AC
    048AA 2011      TST	R1
    048AB F051      BEQ	0x48B6
    048AC 0187      MOVW	R16,R14
    048AD 940E 49CC CALL	_strlen
    048AF 0168      MOVW	R12,R16
    048B0 882C      LDD	R2,Y+20
    048B1 883D      LDD	R3,Y+21
    048B2 1A20      SUB	R2,R16
    048B3 0A31      SBC	R3,R17
    048B4 8A3D      STD	Y+21,R3
    048B5 8A2C      STD	Y+20,R2
    048B6 8C08      LDD	R0,Y+24
    048B7 8C19      LDD	R1,Y+25
    048B8 2000      TST	R0
    048B9 F441      BNE	0x48C2
    048BA 2011      TST	R1
    048BB F431      BNE	0x48C2
    048BC 0187      MOVW	R16,R14
    048BD 940E 49CC CALL	_strlen
    048BF 0168      MOVW	R12,R16
    048C0 8ED9      STD	Y+25,R13
    048C1 8EC8      STD	Y+24,R12
    048C2 880C      LDD	R0,Y+20
    048C3 881D      LDD	R1,Y+21
    048C4 2000      TST	R0
    048C5 F411      BNE	0x48C8
    048C6 2011      TST	R1
    048C7 F031      BEQ	0x48CE
    048C8 FEA3      SBRS	R10,3
    048C9 C004      RJMP	0x48CE
    048CA 01C0      MOVW	R24,R0
    048CB 9701      SBIW	R24,1
    048CC 8B9D      STD	Y+21,R25
    048CD 8B8C      STD	Y+20,R24
    048CE FEA4      SBRS	R10,4
    048CF C026      RJMP	0x48F6
    048D0 FEA3      SBRS	R10,3
    048D1 C00A      RJMP	0x48DC
    048D2 2F06      MOV	R16,R22
    048D3 A1EE      LDD	R30,Y+38
    048D4 A1FF      LDD	R31,Y+39
    048D5 940E 4B6A CALL	xicallx
    048D7 898E      LDD	R24,Y+22
    048D8 899F      LDD	R25,Y+23
    048D9 9601      ADIW	R24,1
    048DA 8B9F      STD	Y+23,R25
    048DB 8B8E      STD	Y+22,R24
    048DC FCA2      SBRC	R10,2
    048DD C04C      RJMP	0x492A
    048DE C00F      RJMP	0x48EE
    048DF E300      LDI	R16,0x30
    048E0 A1EE      LDD	R30,Y+38
    048E1 A1FF      LDD	R31,Y+39
    048E2 940E 4B6A CALL	xicallx
    048E4 898E      LDD	R24,Y+22
    048E5 899F      LDD	R25,Y+23
    048E6 9601      ADIW	R24,1
    048E7 8B9F      STD	Y+23,R25
    048E8 8B8E      STD	Y+22,R24
    048E9 898C      LDD	R24,Y+20
    048EA 899D      LDD	R25,Y+21
    048EB 9701      SBIW	R24,1
    048EC 8B9D      STD	Y+21,R25
    048ED 8B8C      STD	Y+20,R24
    048EE 2422      CLR	R2
    048EF 2433      CLR	R3
    048F0 880C      LDD	R0,Y+20
    048F1 881D      LDD	R1,Y+21
    048F2 1420      CP	R2,R0
    048F3 0431      CPC	R3,R1
    048F4 F354      BLT	0x48DF
    048F5 C034      RJMP	0x492A
    048F6 FCA2      SBRC	R10,2
    048F7 C017      RJMP	0x490F
    048F8 C00F      RJMP	0x4908
    048F9 E200      LDI	R16,0x20
    048FA A1EE      LDD	R30,Y+38
    048FB A1FF      LDD	R31,Y+39
    048FC 940E 4B6A CALL	xicallx
    048FE 898E      LDD	R24,Y+22
    048FF 899F      LDD	R25,Y+23
    04900 9601      ADIW	R24,1
    04901 8B9F      STD	Y+23,R25
    04902 8B8E      STD	Y+22,R24
    04903 898C      LDD	R24,Y+20
    04904 899D      LDD	R25,Y+21
    04905 9701      SBIW	R24,1
    04906 8B9D      STD	Y+21,R25
    04907 8B8C      STD	Y+20,R24
    04908 2422      CLR	R2
    04909 2433      CLR	R3
    0490A 880C      LDD	R0,Y+20
    0490B 881D      LDD	R1,Y+21
    0490C 1420      CP	R2,R0
    0490D 0431      CPC	R3,R1
    0490E F354      BLT	0x48F9
    0490F FEA3      SBRS	R10,3
    04910 C019      RJMP	0x492A
    04911 2F06      MOV	R16,R22
    04912 A1EE      LDD	R30,Y+38
    04913 A1FF      LDD	R31,Y+39
    04914 940E 4B6A CALL	xicallx
    04916 898E      LDD	R24,Y+22
    04917 899F      LDD	R25,Y+23
    04918 9601      ADIW	R24,1
    04919 8B9F      STD	Y+23,R25
    0491A 8B8E      STD	Y+22,R24
    0491B C00E      RJMP	0x492A
    0491C 01F7      MOVW	R30,R14
    0491D 8100      LD	R16,Z
    0491E A1EE      LDD	R30,Y+38
    0491F A1FF      LDD	R31,Y+39
    04920 940E 4B6A CALL	xicallx
    04922 898E      LDD	R24,Y+22
    04923 899F      LDD	R25,Y+23
    04924 9601      ADIW	R24,1
    04925 8B9F      STD	Y+23,R25
    04926 8B8E      STD	Y+22,R24
    04927 01C7      MOVW	R24,R14
    04928 9601      ADIW	R24,1
    04929 017C      MOVW	R14,R24
    0492A 01F7      MOVW	R30,R14
    0492B 8020      LD	R2,Z
    0492C 2022      TST	R2
    0492D F049      BEQ	0x4937
    0492E 8D68      LDD	R22,Y+24
    0492F 8D79      LDD	R23,Y+25
    04930 01CB      MOVW	R24,R22
    04931 9701      SBIW	R24,1
    04932 8F99      STD	Y+25,R25
    04933 8F88      STD	Y+24,R24
    04934 3060      CPI	R22,0
    04935 0767      CPC	R22,R23
    04936 F729      BNE	0x491C
    04937 FEA2      SBRS	R10,2
    04938 C069      RJMP	0x49A2
    04939 C00F      RJMP	0x4949
    0493A E200      LDI	R16,0x20
    0493B A1EE      LDD	R30,Y+38
    0493C A1FF      LDD	R31,Y+39
    0493D 940E 4B6A CALL	xicallx
    0493F 898E      LDD	R24,Y+22
    04940 899F      LDD	R25,Y+23
    04941 9601      ADIW	R24,1
    04942 8B9F      STD	Y+23,R25
    04943 8B8E      STD	Y+22,R24
    04944 898C      LDD	R24,Y+20
    04945 899D      LDD	R25,Y+21
    04946 9701      SBIW	R24,1
    04947 8B9D      STD	Y+21,R25
    04948 8B8C      STD	Y+20,R24
    04949 2422      CLR	R2
    0494A 2433      CLR	R3
    0494B 880C      LDD	R0,Y+20
    0494C 881D      LDD	R1,Y+21
    0494D 1420      CP	R2,R0
    0494E 0431      CPC	R3,R1
    0494F F354      BLT	0x493A
    04950 C051      RJMP	0x49A2
    04951 E061      LDI	R22,1
    04952 E070      LDI	R23,0
    04953 C00B      RJMP	0x495F
    04954 E062      LDI	R22,2
    04955 E070      LDI	R23,0
    04956 C008      RJMP	0x495F
    04957 2766      CLR	R22
    04958 2777      CLR	R23
    04959 C005      RJMP	0x495F
    0495A E063      LDI	R22,3
    0495B E070      LDI	R23,0
    0495C C002      RJMP	0x495F
    0495D E064      LDI	R22,4
    0495E E070      LDI	R23,0
    0495F A58A      LDD	R24,Y+42
    04960 A59B      LDD	R25,Y+43
    04961 9604      ADIW	R24,4
    04962 A79B      STD	Y+43,R25
    04963 A78A      STD	Y+42,R24
    04964 01FC      MOVW	R30,R24
    04965 9734      SBIW	R30,4
    04966 8020      LD	R2,Z
    04967 8031      LDD	R3,Z+1
    04968 8042      LDD	R4,Z+2
    04969 8053      LDD	R5,Z+3
    0496A 8A28      STD	Y+16,R2
    0496B 8A39      STD	Y+17,R3
    0496C 8A4A      STD	Y+18,R4
    0496D 8A5B      STD	Y+19,R5
    0496E 8D88      LDD	R24,Y+24
    0496F 8D99      LDD	R25,Y+25
    04970 3F8F      CPI	R24,0xFF
    04971 EFEF      LDI	R30,0xFF
    04972 079E      CPC	R25,R30
    04973 F421      BNE	0x4978
    04974 E086      LDI	R24,6
    04975 E090      LDI	R25,0
    04976 8F99      STD	Y+25,R25
    04977 8F88      STD	Y+24,R24
    04978 8C08      LDD	R0,Y+24
    04979 8C19      LDD	R1,Y+25
    0497A 8619      STD	Y+9,R1
    0497B 8608      STD	Y+8,R0
    0497C 880C      LDD	R0,Y+20
    0497D 881D      LDD	R1,Y+21
    0497E 821F      STD	Y+7,R1
    0497F 820E      STD	Y+6,R0
    04980 82BD      STD	Y+5,R11
    04981 82AC      STD	Y+4,R10
    04982 8828      LDD	R2,Y+16
    04983 8839      LDD	R3,Y+17
    04984 884A      LDD	R4,Y+18
    04985 885B      LDD	R5,Y+19
    04986 8228      ST	Y,R2
    04987 8239      STD	Y+1,R3
    04988 824A      STD	Y+2,R4
    04989 825B      STD	Y+3,R5
    0498A 019B      MOVW	R18,R22
    0498B E202      LDI	R16,0x22
    0498C E019      LDI	R17,0x9
    0498D 940E 52DE CALL	__FormatFP_1
    0498F 01B8      MOVW	R22,R16
    04990 017B      MOVW	R14,R22
    04991 C00C      RJMP	0x499E
    04992 01F7      MOVW	R30,R14
    04993 9101      LD	R16,Z+
    04994 017F      MOVW	R14,R30
    04995 A1EE      LDD	R30,Y+38
    04996 A1FF      LDD	R31,Y+39
    04997 940E 4B6A CALL	xicallx
    04999 898E      LDD	R24,Y+22
    0499A 899F      LDD	R25,Y+23
    0499B 9601      ADIW	R24,1
    0499C 8B9F      STD	Y+23,R25
    0499D 8B8E      STD	Y+22,R24
    0499E 01F7      MOVW	R30,R14
    0499F 8020      LD	R2,Z
    049A0 2022      TST	R2
    049A1 F781      BNE	0x4992
    049A2 A588      LDD	R24,Y+40
    049A3 A599      LDD	R25,Y+41
    049A4 9601      ADIW	R24,1
    049A5 A799      STD	Y+41,R25
    049A6 A788      STD	Y+40,R24
    049A7 A5E8      LDD	R30,Y+40
    049A8 A5F9      LDD	R31,Y+41
    049A9 8020      LD	R2,Z
    049AA 2022      TST	R2
    049AB F009      BEQ	0x49AD
    049AC CBA4      RJMP	0x4551
    049AD 890E      LDD	R16,Y+22
    049AE 891F      LDD	R17,Y+23
    049AF 966C      ADIW	R28,0x1C
    049B0 940E 4B12 CALL	pop_xgsetF0FC
    049B2 9624      ADIW	R28,4
    049B3 9508      RET
_memset:
    049B4 8188      LD	R24,Y
    049B5 8199      LDD	R25,Y+1
    049B6 3080      CPI	R24,0
    049B7 0789      CPC	R24,R25
    049B8 F029      BEQ	0x49BE
    049B9 2FE0      MOV	R30,R16
    049BA 2FF1      MOV	R31,R17
    049BB 9321      ST	Z+,R18
    049BC 9701      SBIW	R24,1
    049BD F7E9      BNE	0x49BB
    049BE 9508      RET
_strcat:
    049BF 2FA0      MOV	R26,R16
    049C0 2FB1      MOV	R27,R17
    049C1 2FE2      MOV	R30,R18
    049C2 2FF3      MOV	R31,R19
    049C3 912D      LD	R18,X+
    049C4 2322      TST	R18
    049C5 F7E9      BNE	0x49C3
    049C6 9711      SBIW	R26,1
    049C7 9121      LD	R18,Z+
    049C8 932D      ST	X+,R18
    049C9 2322      TST	R18
    049CA F7E1      BNE	0x49C7
    049CB 9508      RET
_strlen:
    049CC 2FE0      MOV	R30,R16
    049CD 2FF1      MOV	R31,R17
    049CE 27AA      CLR	R26
    049CF 27BB      CLR	R27
    049D0 9001      LD	R0,Z+
    049D1 2000      TST	R0
    049D2 F011      BEQ	0x49D5
    049D3 9611      ADIW	R26,1
    049D4 CFFB      RJMP	0x49D0
    049D5 2F0A      MOV	R16,R26
    049D6 2F1B      MOV	R17,R27
    049D7 9508      RET
push_arg4:
    049D8 933A      ST	-Y,R19
    049D9 932A      ST	-Y,R18
push_arg2:
    049DA 931A      ST	-Y,R17
    049DB 930A      ST	-Y,R16
    049DC 9508      RET
asr32:
    049DD 920F      PUSH	R0
    049DE 9009      LD	R0,Y+
    049DF 2000      TST	R0
    049E0 F031      BEQ	0x49E7
    049E1 9535      ASR	R19
    049E2 9527      ROR	R18
    049E3 9517      ROR	R17
    049E4 9507      ROR	R16
    049E5 940A      DEC	R0
    049E6 CFF8      RJMP	0x49DF
    049E7 900F      POP	R0
    049E8 9508      RET
mod16s:
    049E9 9468      BSET	6
    049EA 92DA      ST	-Y,R13
    049EB 2ED1      MOV	R13,R17
    049EC C004      RJMP	0x49F1
div16s:
    049ED 94E8      BCLR	6
    049EE 92DA      ST	-Y,R13
    049EF 2ED1      MOV	R13,R17
    049F0 26D3      EOR	R13,R19
    049F1 FF17      SBRS	R17,7
    049F2 C004      RJMP	0x49F7
    049F3 9510      COM	R17
    049F4 9500      COM	R16
    049F5 5F0F      SUBI	R16,0xFF
    049F6 4F1F      SBCI	R17,0xFF
    049F7 FF37      SBRS	R19,7
    049F8 C004      RJMP	0x49FD
    049F9 9530      COM	R19
    049FA 9520      COM	R18
    049FB 5F2F      SUBI	R18,0xFF
    049FC 4F3F      SBCI	R19,0xFF
    049FD 940E 4A0A CALL	xdiv16u
    049FF FED7      SBRS	R13,7
    04A00 C004      RJMP	0x4A05
    04A01 9510      COM	R17
    04A02 9500      COM	R16
    04A03 5F0F      SUBI	R16,0xFF
    04A04 4F1F      SBCI	R17,0xFF
    04A05 90D9      LD	R13,Y+
    04A06 9508      RET
mod16u:
    04A07 9468      BSET	6
    04A08 C001      RJMP	xdiv16u
div16u:
    04A09 94E8      BCLR	6
xdiv16u:
    04A0A 92EA      ST	-Y,R14
    04A0B 92FA      ST	-Y,R15
    04A0C 938A      ST	-Y,R24
    04A0D 24EE      CLR	R14
    04A0E 24FF      CLR	R15
    04A0F E180      LDI	R24,0x10
    04A10 0F00      LSL	R16
    04A11 1F11      ROL	R17
    04A12 1CEE      ROL	R14
    04A13 1CFF      ROL	R15
    04A14 16E2      CP	R14,R18
    04A15 06F3      CPC	R15,R19
    04A16 F018      BCS	0x4A1A
    04A17 1AE2      SUB	R14,R18
    04A18 0AF3      SBC	R15,R19
    04A19 9503      INC	R16
    04A1A 958A      DEC	R24
    04A1B F7A1      BNE	0x4A10
    04A1C F416      BRTC	0x4A1F
    04A1D 2D0E      MOV	R16,R14
    04A1E 2D1F      MOV	R17,R15
    04A1F 9189      LD	R24,Y+
    04A20 90F9      LD	R15,Y+
    04A21 90E9      LD	R14,Y+
    04A22 9508      RET
div32u:
    04A23 94E8      BCLR	6
    04A24 C001      RJMP	0x4A26
mod32u:
    04A25 9468      BSET	6
    04A26 D030      RCALL	long_div_prolog
    04A27 24CC      CLR	R12
    04A28 C009      RJMP	0x4A32
div32s:
    04A29 94E8      BCLR	6
    04A2A C001      RJMP	0x4A2C
mod32s:
    04A2B 9468      BSET	6
    04A2C D02A      RCALL	long_div_prolog
    04A2D FD37      SBRC	R19,7
    04A2E 940E 4B73 CALL	neg32
    04A30 FDB7      SBRC	R27,7
    04A31 D052      RCALL	neg_R24_R27
    04A32 2477      CLR	R7
    04A33 2488      CLR	R8
    04A34 2499      CLR	R9
    04A35 24AA      CLR	R10
    04A36 24BB      CLR	R11
    04A37 D042      RCALL	tst_R16_R19
    04A38 F0C1      BEQ	0x4A51
    04A39 D045      RCALL	tst_R24_R27
    04A3A F0B1      BEQ	0x4A51
    04A3B E2E8      LDI	R30,0x28
    04A3C 0F00      LSL	R16
    04A3D 1F11      ROL	R17
    04A3E 1F22      ROL	R18
    04A3F 1F33      ROL	R19
    04A40 1C77      ROL	R7
    04A41 1C88      ROL	R8
    04A42 1C99      ROL	R9
    04A43 1CAA      ROL	R10
    04A44 1CBB      ROL	R11
    04A45 1688      CP	R8,R24
    04A46 0699      CPC	R9,R25
    04A47 06AA      CPC	R10,R26
    04A48 06BB      CPC	R11,R27
    04A49 F028      BCS	0x4A4F
    04A4A 1A88      SUB	R8,R24
    04A4B 0A99      SBC	R9,R25
    04A4C 0AAA      SBC	R10,R26
    04A4D 0ABB      SBC	R11,R27
    04A4E 9503      INC	R16
    04A4F 95EA      DEC	R30
    04A50 F759      BNE	0x4A3C
    04A51 F426      BRTC	0x4A56
    04A52 2D08      MOV	R16,R8
    04A53 2D19      MOV	R17,R9
    04A54 2D2A      MOV	R18,R10
    04A55 2D3B      MOV	R19,R11
    04A56 C013      RJMP	long_div_epilog
long_div_prolog:
    04A57 927A      ST	-Y,R7
    04A58 928A      ST	-Y,R8
    04A59 929A      ST	-Y,R9
    04A5A 92AA      ST	-Y,R10
    04A5B 92BA      ST	-Y,R11
    04A5C 92CA      ST	-Y,R12
    04A5D 93EA      ST	-Y,R30
    04A5E 938A      ST	-Y,R24
    04A5F 939A      ST	-Y,R25
    04A60 93AA      ST	-Y,R26
    04A61 93BA      ST	-Y,R27
    04A62 858B      LDD	R24,Y+11
    04A63 859C      LDD	R25,Y+12
    04A64 85AD      LDD	R26,Y+13
    04A65 85BE      LDD	R27,Y+14
    04A66 2EC3      MOV	R12,R19
    04A67 F00E      BRTS	0x4A69
    04A68 26CB      EOR	R12,R27
    04A69 9508      RET
long_div_epilog:
    04A6A FCC7      SBRC	R12,7
    04A6B 940E 4B73 CALL	neg32
    04A6D 91B9      LD	R27,Y+
    04A6E 91A9      LD	R26,Y+
    04A6F 9199      LD	R25,Y+
    04A70 9189      LD	R24,Y+
    04A71 91E9      LD	R30,Y+
    04A72 90C9      LD	R12,Y+
    04A73 90B9      LD	R11,Y+
    04A74 90A9      LD	R10,Y+
    04A75 9099      LD	R9,Y+
    04A76 9089      LD	R8,Y+
    04A77 9079      LD	R7,Y+
    04A78 9624      ADIW	R28,4
    04A79 9508      RET
tst_R16_R19:
    04A7A 2FE0      MOV	R30,R16
    04A7B 2BE1      OR	R30,R17
    04A7C 2BE2      OR	R30,R18
    04A7D 2BE3      OR	R30,R19
    04A7E 9508      RET
tst_R24_R27:
    04A7F 2FE8      MOV	R30,R24
    04A80 2BE9      OR	R30,R25
    04A81 2BEA      OR	R30,R26
    04A82 2BEB      OR	R30,R27
    04A83 9508      RET
neg_R24_R27:
    04A84 9580      COM	R24
    04A85 9590      COM	R25
    04A86 95A0      COM	R26
    04A87 95B0      COM	R27
    04A88 5F8F      SUBI	R24,0xFF
    04A89 4F9F      SBCI	R25,0xFF
    04A8A 4FAF      SBCI	R26,0xFF
    04A8B 4FBF      SBCI	R27,0xFF
    04A8C 9508      RET
mod8u:
    04A8D 9468      BSET	6
    04A8E C001      RJMP	xdiv8u
div8u:
    04A8F 94E8      BCLR	6
xdiv8u:
    04A90 932A      ST	-Y,R18
    04A91 92FA      ST	-Y,R15
    04A92 92EA      ST	-Y,R14
    04A93 24FF      CLR	R15
    04A94 24EE      CLR	R14
    04A95 E120      LDI	R18,0x10
    04A96 0F00      LSL	R16
    04A97 1CFF      ROL	R15
    04A98 1CEE      ROL	R14
    04A99 16E1      CP	R14,R17
    04A9A F010      BCS	0x4A9D
    04A9B 1AE1      SUB	R14,R17
    04A9C 9503      INC	R16
    04A9D 952A      DEC	R18
    04A9E F7B9      BNE	0x4A96
    04A9F F40E      BRTC	0x4AA1
    04AA0 2D0E      MOV	R16,R14
    04AA1 90E9      LD	R14,Y+
    04AA2 90F9      LD	R15,Y+
    04AA3 9129      LD	R18,Y+
    04AA4 9508      RET
elpm32:
    04AA5 93EA      ST	-Y,R30
    04AA6 93FA      ST	-Y,R31
    04AA7 920A      ST	-Y,R0
    04AA8 2FE0      MOV	R30,R16
    04AA9 2FF1      MOV	R31,R17
    04AAA 95D8      ELPM
    04AAB 2D00      MOV	R16,R0
    04AAC 9631      ADIW	R30,1
    04AAD 95D8      ELPM
    04AAE 2D10      MOV	R17,R0
    04AAF 9631      ADIW	R30,1
    04AB0 95D8      ELPM
    04AB1 2D20      MOV	R18,R0
    04AB2 9631      ADIW	R30,1
    04AB3 95D8      ELPM
    04AB4 2D30      MOV	R19,R0
    04AB5 9009      LD	R0,Y+
    04AB6 91F9      LD	R31,Y+
    04AB7 91E9      LD	R30,Y+
    04AB8 9508      RET
empy16s:
    04AB9 920A      ST	-Y,R0
    04ABA 921A      ST	-Y,R1
    04ABB 938A      ST	-Y,R24
    04ABC 939A      ST	-Y,R25
    04ABD 9F02      MUL	R16,R18
    04ABE 01C0      MOVW	R24,R0
    04ABF 9F12      MUL	R17,R18
    04AC0 0D90      ADD	R25,R0
    04AC1 9F03      MUL	R16,R19
    04AC2 0D90      ADD	R25,R0
    04AC3 018C      MOVW	R16,R24
    04AC4 9199      LD	R25,Y+
    04AC5 9189      LD	R24,Y+
    04AC6 9019      LD	R1,Y+
    04AC7 9009      LD	R0,Y+
    04AC8 9508      RET
empy32s|empy32u:
    04AC9 940E 4B7C CALL	long_prolog
    04ACB 927A      ST	-Y,R7
    04ACC 940E 4B95 CALL	tstzero1
    04ACE F159      BEQ	0x4AFA
    04ACF 2477      CLR	R7
    04AD0 940E 4B9B CALL	tstzero2
    04AD2 F419      BNE	0x4AD6
    04AD3 018C      MOVW	R16,R24
    04AD4 019D      MOVW	R18,R26
    04AD5 C024      RJMP	0x4AFA
    04AD6 920A      ST	-Y,R0
    04AD7 921A      ST	-Y,R1
    04AD8 9F08      MUL	R16,R24
    04AD9 2CB0      MOV	R11,R0
    04ADA 2CA1      MOV	R10,R1
    04ADB 9F28      MUL	R18,R24
    04ADC 2C90      MOV	R9,R0
    04ADD 2C81      MOV	R8,R1
    04ADE 9F18      MUL	R17,R24
    04ADF 0CA0      ADD	R10,R0
    04AE0 1C91      ADC	R9,R1
    04AE1 1C87      ADC	R8,R7
    04AE2 9F09      MUL	R16,R25
    04AE3 0CA0      ADD	R10,R0
    04AE4 1C91      ADC	R9,R1
    04AE5 1C87      ADC	R8,R7
    04AE6 9F19      MUL	R17,R25
    04AE7 0C90      ADD	R9,R0
    04AE8 1C81      ADC	R8,R1
    04AE9 9F0A      MUL	R16,R26
    04AEA 0C90      ADD	R9,R0
    04AEB 1C81      ADC	R8,R1
    04AEC 9F38      MUL	R19,R24
    04AED 0C80      ADD	R8,R0
    04AEE 9F29      MUL	R18,R25
    04AEF 0C80      ADD	R8,R0
    04AF0 9F1A      MUL	R17,R26
    04AF1 0C80      ADD	R8,R0
    04AF2 9F0B      MUL	R16,R27
    04AF3 0C80      ADD	R8,R0
    04AF4 9019      LD	R1,Y+
    04AF5 9009      LD	R0,Y+
    04AF6 2D0B      MOV	R16,R11
    04AF7 2D1A      MOV	R17,R10
    04AF8 2D29      MOV	R18,R9
    04AF9 2D38      MOV	R19,R8
    04AFA 9079      LD	R7,Y+
    04AFB 940C 4B8A JMP	long_epilog
pop_xgset003C:
    04AFD 90A9      LD	R10,Y+
    04AFE 90B9      LD	R11,Y+
    04AFF 90C9      LD	R12,Y+
    04B00 90D9      LD	R13,Y+
    04B01 9508      RET
pop_xgset00FC:
    04B02 90A9      LD	R10,Y+
    04B03 90B9      LD	R11,Y+
    04B04 90C9      LD	R12,Y+
    04B05 90D9      LD	R13,Y+
    04B06 90E9      LD	R14,Y+
    04B07 90F9      LD	R15,Y+
    04B08 9508      RET
pop_xgset30FC:
    04B09 90A9      LD	R10,Y+
    04B0A 90B9      LD	R11,Y+
    04B0B 90C9      LD	R12,Y+
    04B0C 90D9      LD	R13,Y+
    04B0D 90E9      LD	R14,Y+
    04B0E 90F9      LD	R15,Y+
    04B0F 9149      LD	R20,Y+
    04B10 9159      LD	R21,Y+
    04B11 9508      RET
pop_xgsetF0FC:
    04B12 90A9      LD	R10,Y+
    04B13 90B9      LD	R11,Y+
    04B14 90C9      LD	R12,Y+
    04B15 90D9      LD	R13,Y+
    04B16 90E9      LD	R14,Y+
    04B17 90F9      LD	R15,Y+
    04B18 9149      LD	R20,Y+
    04B19 9159      LD	R21,Y+
    04B1A 9169      LD	R22,Y+
    04B1B 9179      LD	R23,Y+
    04B1C 9508      RET
push_xgsetF0FC:
    04B1D 937A      ST	-Y,R23
    04B1E 936A      ST	-Y,R22
push_xgset30FC:
    04B1F 935A      ST	-Y,R21
    04B20 934A      ST	-Y,R20
push_xgset00FC:
    04B21 92FA      ST	-Y,R15
    04B22 92EA      ST	-Y,R14
push_xgset003C:
    04B23 92DA      ST	-Y,R13
    04B24 92CA      ST	-Y,R12
    04B25 92BA      ST	-Y,R11
    04B26 92AA      ST	-Y,R10
    04B27 9508      RET
push_xgset300C:
    04B28 935A      ST	-Y,R21
    04B29 934A      ST	-Y,R20
    04B2A 92BA      ST	-Y,R11
    04B2B 92AA      ST	-Y,R10
    04B2C 9508      RET
pop_xgset300C:
    04B2D 90A9      LD	R10,Y+
    04B2E 90B9      LD	R11,Y+
    04B2F 9149      LD	R20,Y+
    04B30 9159      LD	R21,Y+
    04B31 9508      RET
push_xgsetF000:
    04B32 937A      ST	-Y,R23
    04B33 936A      ST	-Y,R22
    04B34 935A      ST	-Y,R21
    04B35 934A      ST	-Y,R20
    04B36 9508      RET
pop_xgsetF000:
    04B37 9149      LD	R20,Y+
    04B38 9159      LD	R21,Y+
    04B39 9169      LD	R22,Y+
    04B3A 9179      LD	R23,Y+
    04B3B 9508      RET
push_xgsetF00C:
    04B3C 937A      ST	-Y,R23
    04B3D 936A      ST	-Y,R22
    04B3E 935A      ST	-Y,R21
    04B3F 934A      ST	-Y,R20
    04B40 92BA      ST	-Y,R11
    04B41 92AA      ST	-Y,R10
    04B42 9508      RET
pop_xgsetF00C:
    04B43 90A9      LD	R10,Y+
    04B44 90B9      LD	R11,Y+
    04B45 9149      LD	R20,Y+
    04B46 9159      LD	R21,Y+
    04B47 9169      LD	R22,Y+
    04B48 9179      LD	R23,Y+
    04B49 9508      RET
push_xgset303C:
    04B4A 935A      ST	-Y,R21
    04B4B 934A      ST	-Y,R20
    04B4C 92DA      ST	-Y,R13
    04B4D 92CA      ST	-Y,R12
    04B4E 92BA      ST	-Y,R11
    04B4F 92AA      ST	-Y,R10
    04B50 9508      RET
pop_xgset303C:
    04B51 90A9      LD	R10,Y+
    04B52 90B9      LD	R11,Y+
    04B53 90C9      LD	R12,Y+
    04B54 90D9      LD	R13,Y+
    04B55 9149      LD	R20,Y+
    04B56 9159      LD	R21,Y+
    04B57 9508      RET
push_xgsetF03C:
    04B58 937A      ST	-Y,R23
    04B59 936A      ST	-Y,R22
    04B5A 935A      ST	-Y,R21
    04B5B 934A      ST	-Y,R20
    04B5C 92DA      ST	-Y,R13
    04B5D 92CA      ST	-Y,R12
    04B5E 92BA      ST	-Y,R11
    04B5F 92AA      ST	-Y,R10
    04B60 9508      RET
pop_xgsetF03C:
    04B61 90A9      LD	R10,Y+
    04B62 90B9      LD	R11,Y+
    04B63 90C9      LD	R12,Y+
    04B64 90D9      LD	R13,Y+
    04B65 9149      LD	R20,Y+
    04B66 9159      LD	R21,Y+
    04B67 9169      LD	R22,Y+
    04B68 9179      LD	R23,Y+
    04B69 9508      RET
xicallx:
    04B6A 920A      ST	-Y,R0
    04B6B 95D8      ELPM
    04B6C 920A      ST	-Y,R0
    04B6D 9631      ADIW	R30,1
    04B6E 95D8      ELPM
    04B6F 2DF0      MOV	R31,R0
    04B70 91E9      LD	R30,Y+
    04B71 9009      LD	R0,Y+
    04B72 9409      IJMP
neg32:
    04B73 9500      COM	R16
    04B74 9510      COM	R17
    04B75 9520      COM	R18
    04B76 9530      COM	R19
    04B77 5F0F      SUBI	R16,0xFF
    04B78 4F1F      SBCI	R17,0xFF
    04B79 4F2F      SBCI	R18,0xFF
    04B7A 4F3F      SBCI	R19,0xFF
    04B7B 9508      RET
long_prolog:
    04B7C 928A      ST	-Y,R8
    04B7D 929A      ST	-Y,R9
    04B7E 92AA      ST	-Y,R10
    04B7F 92BA      ST	-Y,R11
    04B80 93EA      ST	-Y,R30
    04B81 938A      ST	-Y,R24
    04B82 939A      ST	-Y,R25
    04B83 93AA      ST	-Y,R26
    04B84 93BA      ST	-Y,R27
    04B85 8589      LDD	R24,Y+9
    04B86 859A      LDD	R25,Y+10
    04B87 85AB      LDD	R26,Y+11
    04B88 85BC      LDD	R27,Y+12
    04B89 9508      RET
long_epilog:
    04B8A 91B9      LD	R27,Y+
    04B8B 91A9      LD	R26,Y+
    04B8C 9199      LD	R25,Y+
    04B8D 9189      LD	R24,Y+
    04B8E 91E9      LD	R30,Y+
    04B8F 90B9      LD	R11,Y+
    04B90 90A9      LD	R10,Y+
    04B91 9099      LD	R9,Y+
    04B92 9089      LD	R8,Y+
    04B93 9624      ADIW	R28,4
    04B94 9508      RET
tstzero1:
    04B95 27EE      CLR	R30
    04B96 2BE0      OR	R30,R16
    04B97 2BE1      OR	R30,R17
    04B98 2BE2      OR	R30,R18
    04B99 2BE3      OR	R30,R19
    04B9A 9508      RET
tstzero2:
    04B9B 27EE      CLR	R30
    04B9C 2BE8      OR	R30,R24
    04B9D 2BE9      OR	R30,R25
    04B9E 2BEA      OR	R30,R26
    04B9F 2BEB      OR	R30,R27
    04BA0 9508      RET
lsl16:
    04BA1 2322      TST	R18
    04BA2 F021      BEQ	0x4BA7
    04BA3 0F00      LSL	R16
    04BA4 1F11      ROL	R17
    04BA5 952A      DEC	R18
    04BA6 CFFA      RJMP	lsl16
    04BA7 9508      RET
lsl32:
    04BA8 920F      PUSH	R0
    04BA9 9009      LD	R0,Y+
    04BAA 2000      TST	R0
    04BAB F031      BEQ	0x4BB2
    04BAC 0F00      LSL	R16
    04BAD 1F11      ROL	R17
    04BAE 1F22      ROL	R18
    04BAF 1F33      ROL	R19
    04BB0 940A      DEC	R0
    04BB1 CFF8      RJMP	0x4BAA
    04BB2 900F      POP	R0
    04BB3 9508      RET
lsl8:
    04BB4 2311      TST	R17
    04BB5 F019      BEQ	0x4BB9
    04BB6 0F00      LSL	R16
    04BB7 951A      DEC	R17
    04BB8 CFFB      RJMP	lsl8
    04BB9 9508      RET
lsr16:
    04BBA 2322      TST	R18
    04BBB F021      BEQ	0x4BC0
    04BBC 9516      LSR	R17
    04BBD 9507      ROR	R16
    04BBE 952A      DEC	R18
    04BBF CFFA      RJMP	lsr16
    04BC0 9508      RET
lsr32:
    04BC1 920F      PUSH	R0
    04BC2 9009      LD	R0,Y+
    04BC3 2000      TST	R0
    04BC4 F031      BEQ	0x4BCB
    04BC5 9536      LSR	R19
    04BC6 9527      ROR	R18
    04BC7 9517      ROR	R17
    04BC8 9507      ROR	R16
    04BC9 940A      DEC	R0
    04BCA CFF8      RJMP	0x4BC3
    04BCB 900F      POP	R0
    04BCC 9508      RET
asgnblk:
    04BCD 93AA      ST	-Y,R26
    04BCE 93BA      ST	-Y,R27
    04BCF 93EA      ST	-Y,R30
    04BD0 93FA      ST	-Y,R31
    04BD1 920A      ST	-Y,R0
    04BD2 81AF      LDD	R26,Y+7
    04BD3 85B8      LDD	R27,Y+8
    04BD4 81ED      LDD	R30,Y+5
    04BD5 81FE      LDD	R31,Y+6
    04BD6 3000      CPI	R16,0
    04BD7 0701      CPC	R16,R17
    04BD8 F029      BEQ	0x4BDE
    04BD9 9001      LD	R0,Z+
    04BDA 920D      ST	X+,R0
    04BDB 5001      SUBI	R16,1
    04BDC 4010      SBCI	R17,0
    04BDD CFF8      RJMP	0x4BD6
    04BDE 9009      LD	R0,Y+
    04BDF 91F9      LD	R31,Y+
    04BE0 91E9      LD	R30,Y+
    04BE1 91B9      LD	R27,Y+
    04BE2 91A9      LD	R26,Y+
    04BE3 9624      ADIW	R28,4
    04BE4 9508      RET
fpsub:
    04BE5 9468      BSET	6
    04BE6 C001      RJMP	fpadd_alt
fpadd:
    04BE7 94E8      BCLR	6
fpadd_alt:
    04BE8 940E 4DF2 CALL	saveFPRegs
    04BEA 940E 4D84 CALL	unpacks
    04BEC F409      BNE	0x4BEE
    04BED C048      RJMP	0x4C36
    04BEE 2CE6      MOV	R14,R6
    04BEF 2CD5      MOV	R13,R5
    04BF0 2CC4      MOV	R12,R4
    04BF1 2EB3      MOV	R11,R19
    04BF2 2EA2      MOV	R10,R18
    04BF3 2E91      MOV	R9,R17
    04BF4 2E80      MOV	R8,R16
    04BF5 8100      LD	R16,Z
    04BF6 8111      LDD	R17,Z+1
    04BF7 8122      LDD	R18,Z+2
    04BF8 8133      LDD	R19,Z+3
    04BF9 940E 4D84 CALL	unpacks
    04BFB F409      BNE	0x4BFD
    04BFC C044      RJMP	0x4C41
    04BFD 2D84      MOV	R24,R4
    04BFE 2D95      MOV	R25,R5
    04BFF 198C      SUB	R24,R12
    04C00 099D      SBC	R25,R13
    04C01 F0B9      BEQ	0x4C19
    04C02 F472      BPL	0x4C11
    04C03 9590      COM	R25
    04C04 9580      COM	R24
    04C05 9601      ADIW	R24,1
    04C06 2C4C      MOV	R4,R12
    04C07 2C5D      MOV	R5,R13
    04C08 3188      CPI	R24,0x18
    04C09 F5B8      BCC	0x4C41
    04C0A 9535      ASR	R19
    04C0B 9527      ROR	R18
    04C0C 9517      ROR	R17
    04C0D 9507      ROR	R16
    04C0E 9701      SBIW	R24,1
    04C0F F7D1      BNE	0x4C0A
    04C10 C008      RJMP	0x4C19
    04C11 3188      CPI	R24,0x18
    04C12 F518      BCC	0x4C36
    04C13 94B5      ASR	R11
    04C14 94A7      ROR	R10
    04C15 9497      ROR	R9
    04C16 9487      ROR	R8
    04C17 9701      SBIW	R24,1
    04C18 F7D1      BNE	0x4C13
    04C19 2466      CLR	R6
    04C1A F02E      BRTS	0x4C20
    04C1B 0D08      ADD	R16,R8
    04C1C 1D19      ADC	R17,R9
    04C1D 1D2A      ADC	R18,R10
    04C1E 1D3B      ADC	R19,R11
    04C1F C009      RJMP	0x4C29
    04C20 1A80      SUB	R8,R16
    04C21 0A91      SBC	R9,R17
    04C22 0AA2      SBC	R10,R18
    04C23 0AB3      SBC	R11,R19
    04C24 2D08      MOV	R16,R8
    04C25 2D19      MOV	R17,R9
    04C26 2D2A      MOV	R18,R10
    04C27 2D3B      MOV	R19,R11
    04C28 2333      TST	R19
    04C29 F422      BPL	0x4C2E
    04C2A 940E 4B73 CALL	neg32
    04C2C E880      LDI	R24,0x80
    04C2D 2E68      MOV	R6,R24
    04C2E 940E 4DAD CALL	normalize_and_pack
    04C30 C002      RJMP	0x4C33
    04C31 940E 4DE2 CALL	pack
    04C33 940E 4E01 CALL	restoreFPRegs
    04C35 9508      RET
    04C36 8100      LD	R16,Z
    04C37 8111      LDD	R17,Z+1
    04C38 8122      LDD	R18,Z+2
    04C39 8133      LDD	R19,Z+3
    04C3A F7C6      BRTC	0x4C33
    04C3B 940E 4D8C CALL	tstR16_R19
    04C3D F3A9      BEQ	0x4C33
    04C3E E880      LDI	R24,0x80
    04C3F 2738      EOR	R19,R24
    04C40 CFF2      RJMP	0x4C33
    04C41 2D08      MOV	R16,R8
    04C42 2D19      MOV	R17,R9
    04C43 2D2A      MOV	R18,R10
    04C44 2D3B      MOV	R19,R11
    04C45 2C4C      MOV	R4,R12
    04C46 2C5D      MOV	R5,R13
    04C47 2C6E      MOV	R6,R14
    04C48 2333      TST	R19
    04C49 F73A      BPL	0x4C31
    04C4A 940E 4B73 CALL	neg32
    04C4C E880      LDI	R24,0x80
    04C4D 2E68      MOV	R6,R24
    04C4E CFE2      RJMP	0x4C31
fpadd1:
    04C4F 93FA      ST	-Y,R31
    04C50 93EA      ST	-Y,R30
    04C51 81EA      LDD	R30,Y+2
    04C52 81FB      LDD	R31,Y+3
    04C53 940E 4BE7 CALL	fpadd
    04C55 91E9      LD	R30,Y+
    04C56 91F9      LD	R31,Y+
    04C57 9622      ADIW	R28,2
    04C58 9508      RET
fpadd2:
    04C59 93FA      ST	-Y,R31
    04C5A 93EA      ST	-Y,R30
    04C5B 2FEC      MOV	R30,R28
    04C5C 2FFD      MOV	R31,R29
    04C5D 9632      ADIW	R30,2
    04C5E 940E 4BE7 CALL	fpadd
    04C60 91E9      LD	R30,Y+
    04C61 91F9      LD	R31,Y+
    04C62 9624      ADIW	R28,4
    04C63 9508      RET
fpsub1:
    04C64 93FA      ST	-Y,R31
    04C65 93EA      ST	-Y,R30
    04C66 81EA      LDD	R30,Y+2
    04C67 81FB      LDD	R31,Y+3
    04C68 940E 4BE5 CALL	fpsub
    04C6A 91E9      LD	R30,Y+
    04C6B 91F9      LD	R31,Y+
    04C6C 9622      ADIW	R28,2
    04C6D 9508      RET
fpsub2:
    04C6E 93FA      ST	-Y,R31
    04C6F 93EA      ST	-Y,R30
    04C70 2FEC      MOV	R30,R28
    04C71 2FFD      MOV	R31,R29
    04C72 9632      ADIW	R30,2
    04C73 940E 4BE5 CALL	fpsub
    04C75 91E9      LD	R30,Y+
    04C76 91F9      LD	R31,Y+
    04C77 9624      ADIW	R28,4
    04C78 9508      RET
fpsub1x:
    04C79 93FA      ST	-Y,R31
    04C7A 93EA      ST	-Y,R30
    04C7B 81EA      LDD	R30,Y+2
    04C7C 81FB      LDD	R31,Y+3
    04C7D 940E 4BE5 CALL	fpsub
    04C7F 91E9      LD	R30,Y+
    04C80 91F9      LD	R31,Y+
    04C81 8339      STD	Y+1,R19
    04C82 8328      ST	Y,R18
    04C83 931A      ST	-Y,R17
    04C84 930A      ST	-Y,R16
    04C85 9508      RET
fpsub2x:
    04C86 93FA      ST	-Y,R31
    04C87 93EA      ST	-Y,R30
    04C88 2FEC      MOV	R30,R28
    04C89 2FFD      MOV	R31,R29
    04C8A 9632      ADIW	R30,2
    04C8B 940E 4BE5 CALL	fpsub
    04C8D 91E9      LD	R30,Y+
    04C8E 91F9      LD	R31,Y+
    04C8F 833B      STD	Y+3,R19
    04C90 832A      STD	Y+2,R18
    04C91 8319      STD	Y+1,R17
    04C92 8308      ST	Y,R16
    04C93 9508      RET
fpint:
    04C94 924A      ST	-Y,R4
    04C95 925A      ST	-Y,R5
    04C96 926A      ST	-Y,R6
    04C97 938A      ST	-Y,R24
    04C98 940E 4D94 CALL	unpacku
    04C9A F111      BEQ	0x4CBD
    04C9B 2055      TST	R5
    04C9C F0E2      BMI	0x4CB9
    04C9D E18F      LDI	R24,0x1F
    04C9E 1648      CP	R4,R24
    04C9F F4C0      BCC	0x4CB8
    04CA0 E187      LDI	R24,0x17
    04CA1 1648      CP	R4,R24
    04CA2 F0D1      BEQ	0x4CBD
    04CA3 F458      BCC	0x4CAF
    04CA4 9441      NEG	R4
    04CA5 EE89      LDI	R24,0xE9
    04CA6 1A48      SUB	R4,R24
    04CA7 C005      RJMP	0x4CAD
    04CA8 9535      ASR	R19
    04CA9 9527      ROR	R18
    04CAA 9517      ROR	R17
    04CAB 9507      ROR	R16
    04CAC 944A      DEC	R4
    04CAD F7D1      BNE	0x4CA8
    04CAE C00E      RJMP	0x4CBD
    04CAF E187      LDI	R24,0x17
    04CB0 1A48      SUB	R4,R24
    04CB1 0F00      LSL	R16
    04CB2 1F11      ROL	R17
    04CB3 1F22      ROL	R18
    04CB4 1F33      ROL	R19
    04CB5 944A      DEC	R4
    04CB6 F7D1      BNE	0x4CB1
    04CB7 C005      RJMP	0x4CBD
    04CB8 E73F      LDI	R19,0x7F
    04CB9 2F23      MOV	R18,R19
    04CBA 2F13      MOV	R17,R19
    04CBB 2F03      MOV	R16,R19
    04CBC C004      RJMP	0x4CC1
    04CBD 2066      TST	R6
    04CBE F011      BEQ	0x4CC1
    04CBF 940E 4B73 CALL	neg32
    04CC1 9189      LD	R24,Y+
    04CC2 9069      LD	R6,Y+
    04CC3 9059      LD	R5,Y+
    04CC4 9049      LD	R4,Y+
    04CC5 9508      RET
uint2fp:
    04CC6 9468      BSET	6
    04CC7 C001      RJMP	0x4CC9
int2fp:
    04CC8 94E8      BCLR	6
    04CC9 2722      CLR	R18
    04CCA 2733      CLR	R19
    04CCB F046      BRTS	0x4CD4
    04CCC FD17      SBRC	R17,7
    04CCD 9520      COM	R18
    04CCE FD17      SBRC	R17,7
    04CCF 9530      COM	R19
    04CD0 C003      RJMP	0x4CD4
ulong2fp:
    04CD1 9468      BSET	6
    04CD2 C001      RJMP	0x4CD4
long2fp:
    04CD3 94E8      BCLR	6
    04CD4 924A      ST	-Y,R4
    04CD5 925A      ST	-Y,R5
    04CD6 926A      ST	-Y,R6
    04CD7 938A      ST	-Y,R24
    04CD8 E187      LDI	R24,0x17
    04CD9 2E48      MOV	R4,R24
    04CDA 2455      CLR	R5
    04CDB 2466      CLR	R6
    04CDC F036      BRTS	0x4CE3
    04CDD 2333      TST	R19
    04CDE F422      BPL	0x4CE3
    04CDF 940E 4B73 CALL	neg32
    04CE1 E880      LDI	R24,0x80
    04CE2 2E68      MOV	R6,R24
    04CE3 940E 4DAD CALL	normalize_and_pack
    04CE5 9189      LD	R24,Y+
    04CE6 9069      LD	R6,Y+
    04CE7 9059      LD	R5,Y+
    04CE8 9049      LD	R4,Y+
    04CE9 9508      RET
fpdiv1:
    04CEA 93FA      ST	-Y,R31
    04CEB 93EA      ST	-Y,R30
    04CEC 81EA      LDD	R30,Y+2
    04CED 81FB      LDD	R31,Y+3
    04CEE D027      RCALL	0x4D16
    04CEF 91E9      LD	R30,Y+
    04CF0 91F9      LD	R31,Y+
    04CF1 9622      ADIW	R28,2
    04CF2 9508      RET
fpdiv2:
    04CF3 93FA      ST	-Y,R31
    04CF4 93EA      ST	-Y,R30
    04CF5 2FEC      MOV	R30,R28
    04CF6 2FFD      MOV	R31,R29
    04CF7 9632      ADIW	R30,2
    04CF8 D01D      RCALL	0x4D16
    04CF9 91E9      LD	R30,Y+
    04CFA 91F9      LD	R31,Y+
    04CFB 9624      ADIW	R28,4
    04CFC 9508      RET
fpdiv1x:
    04CFD 93FA      ST	-Y,R31
    04CFE 93EA      ST	-Y,R30
    04CFF 81EA      LDD	R30,Y+2
    04D00 81FB      LDD	R31,Y+3
    04D01 D014      RCALL	0x4D16
    04D02 91E9      LD	R30,Y+
    04D03 91F9      LD	R31,Y+
    04D04 8339      STD	Y+1,R19
    04D05 8328      ST	Y,R18
    04D06 931A      ST	-Y,R17
    04D07 930A      ST	-Y,R16
    04D08 9508      RET
fpdiv2x:
    04D09 93FA      ST	-Y,R31
    04D0A 93EA      ST	-Y,R30
    04D0B 2FEC      MOV	R30,R28
    04D0C 2FFD      MOV	R31,R29
    04D0D 9632      ADIW	R30,2
    04D0E D007      RCALL	0x4D16
    04D0F 91E9      LD	R30,Y+
    04D10 91F9      LD	R31,Y+
    04D11 833B      STD	Y+3,R19
    04D12 832A      STD	Y+2,R18
    04D13 8319      STD	Y+1,R17
    04D14 8308      ST	Y,R16
    04D15 9508      RET
    04D16 920A      ST	-Y,R0
    04D17 921A      ST	-Y,R1
    04D18 922A      ST	-Y,R2
    04D19 923A      ST	-Y,R3
    04D1A 940E 4DF2 CALL	saveFPRegs
    04D1C 933A      ST	-Y,R19
    04D1D 932A      ST	-Y,R18
    04D1E 931A      ST	-Y,R17
    04D1F 930A      ST	-Y,R16
    04D20 8100      LD	R16,Z
    04D21 8111      LDD	R17,Z+1
    04D22 8122      LDD	R18,Z+2
    04D23 8133      LDD	R19,Z+3
    04D24 940E 4D94 CALL	unpacku
    04D26 F409      BNE	0x4D28
    04D27 C057      RJMP	0x4D7F
    04D28 2CE6      MOV	R14,R6
    04D29 2CD5      MOV	R13,R5
    04D2A 2CC4      MOV	R12,R4
    04D2B 2EB3      MOV	R11,R19
    04D2C 2EA2      MOV	R10,R18
    04D2D 2E91      MOV	R9,R17
    04D2E 2E80      MOV	R8,R16
    04D2F 9109      LD	R16,Y+
    04D30 9119      LD	R17,Y+
    04D31 9129      LD	R18,Y+
    04D32 9139      LD	R19,Y+
    04D33 940E 4D94 CALL	unpacku
    04D35 F1A1      BEQ	0x4D6A
    04D36 246E      EOR	R6,R14
    04D37 184C      SUB	R4,R12
    04D38 085D      SBC	R5,R13
    04D39 E880      LDI	R24,0x80
    04D3A 1648      CP	R4,R24
    04D3B 0653      CPC	R5,R19
    04D3C F00C      BLT	0x4D3E
    04D3D C033      RJMP	0x4D71
    04D3E E881      LDI	R24,0x81
    04D3F 1648      CP	R4,R24
    04D40 EF8F      LDI	R24,0xFF
    04D41 0658      CPC	R5,R24
    04D42 F40C      BGE	0x4D44
    04D43 C036      RJMP	0x4D7A
    04D44 E280      LDI	R24,0x20
    04D45 2433      CLR	R3
    04D46 2E23      MOV	R2,R19
    04D47 2E12      MOV	R1,R18
    04D48 2E01      MOV	R0,R17
    04D49 2F30      MOV	R19,R16
    04D4A 2722      CLR	R18
    04D4B 2711      CLR	R17
    04D4C 2700      CLR	R16
    04D4D 9426      LSR	R2
    04D4E 9417      ROR	R1
    04D4F 9407      ROR	R0
    04D50 9537      ROR	R19
    04D51 9527      ROR	R18
    04D52 0F00      LSL	R16
    04D53 1F11      ROL	R17
    04D54 1F22      ROL	R18
    04D55 1F33      ROL	R19
    04D56 1C00      ROL	R0
    04D57 1C11      ROL	R1
    04D58 1C22      ROL	R2
    04D59 1C33      ROL	R3
    04D5A F028      BCS	0x4D60
    04D5B 1808      SUB	R0,R8
    04D5C 0819      SBC	R1,R9
    04D5D 082A      SBC	R2,R10
    04D5E 083B      SBC	R3,R11
    04D5F C004      RJMP	0x4D64
    04D60 0C08      ADD	R0,R8
    04D61 1C19      ADC	R1,R9
    04D62 1C2A      ADC	R2,R10
    04D63 1C3B      ADC	R3,R11
    04D64 F00A      BMI	0x4D66
    04D65 6001      ORI	R16,1
    04D66 958A      DEC	R24
    04D67 F751      BNE	0x4D52
    04D68 940E 4DAD CALL	normalize_and_pack
    04D6A 940E 4E01 CALL	restoreFPRegs
    04D6C 9039      LD	R3,Y+
    04D6D 9029      LD	R2,Y+
    04D6E 9019      LD	R1,Y+
    04D6F 9009      LD	R0,Y+
    04D70 9508      RET
    04D71 EF0F      LDI	R16,0xFF
    04D72 2F10      MOV	R17,R16
    04D73 E72F      LDI	R18,0x7F
    04D74 E73F      LDI	R19,0x7F
    04D75 2066      TST	R6
    04D76 F399      BEQ	0x4D6A
    04D77 940E 4B73 CALL	neg32
    04D79 CFF0      RJMP	0x4D6A
    04D7A 2700      CLR	R16
    04D7B 2F10      MOV	R17,R16
    04D7C 2F20      MOV	R18,R16
    04D7D 2F30      MOV	R19,R16
    04D7E CFEB      RJMP	0x4D6A
    04D7F 9109      LD	R16,Y+
    04D80 9119      LD	R17,Y+
    04D81 9129      LD	R18,Y+
    04D82 9139      LD	R19,Y+
    04D83 CFED      RJMP	0x4D71
unpacks:
    04D84 D00F      RCALL	unpacku
    04D85 F029      BEQ	0x4D8B
    04D86 2066      TST	R6
    04D87 F011      BEQ	0x4D8A
    04D88 940E 4B73 CALL	neg32
    04D8A 9498      BCLR	1
    04D8B 9508      RET
tstR16_R19:
    04D8C 2300      TST	R16
    04D8D F429      BNE	0x4D93
    04D8E 2311      TST	R17
    04D8F F419      BNE	0x4D93
    04D90 2322      TST	R18
    04D91 F409      BNE	0x4D93
    04D92 2333      TST	R19
    04D93 9508      RET
unpacku:
    04D94 DFF7      RCALL	tstR16_R19
    04D95 F099      BEQ	0x4DA9
    04D96 938A      ST	-Y,R24
    04D97 2E63      MOV	R6,R19
    04D98 E880      LDI	R24,0x80
    04D99 2268      AND	R6,R24
    04D9A 0F22      LSL	R18
    04D9B 1F33      ROL	R19
    04D9C 2E43      MOV	R4,R19
    04D9D E78F      LDI	R24,0x7F
    04D9E 1A48      SUB	R4,R24
    04D9F 2455      CLR	R5
    04DA0 2788      CLR	R24
    04DA1 0A58      SBC	R5,R24
    04DA2 9526      LSR	R18
    04DA3 E830      LDI	R19,0x80
    04DA4 2B23      OR	R18,R19
    04DA5 2733      CLR	R19
    04DA6 9189      LD	R24,Y+
    04DA7 9498      BCLR	1
    04DA8 9508      RET
    04DA9 2444      CLR	R4
    04DAA 2455      CLR	R5
    04DAB 2466      CLR	R6
    04DAC 9508      RET
normalize_and_pack:
    04DAD DFDE      RCALL	tstR16_R19
    04DAE F409      BNE	0x4DB0
    04DAF 9508      RET
    04DB0 93AA      ST	-Y,R26
    04DB1 93BA      ST	-Y,R27
    04DB2 01D2      MOVW	R26,R4
    04DB3 939A      ST	-Y,R25
    04DB4 938A      ST	-Y,R24
    04DB5 E78E      LDI	R24,0x7E
    04DB6 E090      LDI	R25,0
    04DB7 2333      TST	R19
    04DB8 F049      BEQ	0x4DC2
    04DB9 9536      LSR	R19
    04DBA 9527      ROR	R18
    04DBB 9517      ROR	R17
    04DBC 9507      ROR	R16
    04DBD 17A8      CP	R26,R24
    04DBE 07B9      CPC	R27,R25
    04DBF F4CC      BGE	0x4DD9
    04DC0 9611      ADIW	R26,1
    04DC1 CFF5      RJMP	0x4DB7
    04DC2 9580      COM	R24
    04DC3 9590      COM	R25
    04DC4 9601      ADIW	R24,1
    04DC5 2322      TST	R18
    04DC6 F0BA      BMI	0x4DDE
    04DC7 0F00      LSL	R16
    04DC8 1F11      ROL	R17
    04DC9 1F22      ROL	R18
    04DCA 17A8      CP	R26,R24
    04DCB 07B9      CPC	R27,R25
    04DCC F014      BLT	0x4DCF
    04DCD 9711      SBIW	R26,1
    04DCE CFF6      RJMP	0x4DC5
    04DCF 2700      CLR	R16
    04DD0 2711      CLR	R17
    04DD1 2722      CLR	R18
    04DD2 2733      CLR	R19
    04DD3 9189      LD	R24,Y+
    04DD4 9199      LD	R25,Y+
    04DD5 012D      MOVW	R4,R26
    04DD6 91B9      LD	R27,Y+
    04DD7 91A9      LD	R26,Y+
    04DD8 9508      RET
    04DD9 2733      CLR	R19
    04DDA EF0F      LDI	R16,0xFF
    04DDB 2F10      MOV	R17,R16
    04DDC E72F      LDI	R18,0x7F
    04DDD 2F32      MOV	R19,R18
    04DDE 9189      LD	R24,Y+
    04DDF 9199      LD	R25,Y+
    04DE0 012D      MOVW	R4,R26
    04DE1 C002      RJMP	0x4DE4
pack:
    04DE2 93AA      ST	-Y,R26
    04DE3 93BA      ST	-Y,R27
    04DE4 DFA7      RCALL	tstR16_R19
    04DE5 F049      BEQ	0x4DEF
    04DE6 01D2      MOVW	R26,R4
    04DE7 58A1      SUBI	R26,0x81
    04DE8 4FBF      SBCI	R27,0xFF
    04DE9 012D      MOVW	R4,R26
    04DEA 2D34      MOV	R19,R4
    04DEB 0F22      LSL	R18
    04DEC 9536      LSR	R19
    04DED 9527      ROR	R18
    04DEE 2936      OR	R19,R6
    04DEF 91B9      LD	R27,Y+
    04DF0 91A9      LD	R26,Y+
    04DF1 9508      RET
saveFPRegs:
    04DF2 924A      ST	-Y,R4
    04DF3 925A      ST	-Y,R5
    04DF4 926A      ST	-Y,R6
    04DF5 927A      ST	-Y,R7
    04DF6 928A      ST	-Y,R8
    04DF7 929A      ST	-Y,R9
    04DF8 92AA      ST	-Y,R10
    04DF9 92BA      ST	-Y,R11
    04DFA 92CA      ST	-Y,R12
    04DFB 92DA      ST	-Y,R13
    04DFC 92EA      ST	-Y,R14
    04DFD 92FA      ST	-Y,R15
    04DFE 938A      ST	-Y,R24
    04DFF 939A      ST	-Y,R25
    04E00 9508      RET
restoreFPRegs:
    04E01 9199      LD	R25,Y+
    04E02 9189      LD	R24,Y+
    04E03 90F9      LD	R15,Y+
    04E04 90E9      LD	R14,Y+
    04E05 90D9      LD	R13,Y+
    04E06 90C9      LD	R12,Y+
    04E07 90B9      LD	R11,Y+
    04E08 90A9      LD	R10,Y+
    04E09 9099      LD	R9,Y+
    04E0A 9089      LD	R8,Y+
    04E0B 9079      LD	R7,Y+
    04E0C 9069      LD	R6,Y+
    04E0D 9059      LD	R5,Y+
    04E0E 9049      LD	R4,Y+
    04E0F 9508      RET
fpmule:
    04E10 940E 4DF2 CALL	saveFPRegs
    04E12 93AA      ST	-Y,R26
    04E13 93BA      ST	-Y,R27
    04E14 940E 4D94 CALL	unpacku
    04E16 F1E1      BEQ	0x4E53
    04E17 2CE6      MOV	R14,R6
    04E18 2CD5      MOV	R13,R5
    04E19 2CC4      MOV	R12,R4
    04E1A 2EB3      MOV	R11,R19
    04E1B 2EA2      MOV	R10,R18
    04E1C 2E91      MOV	R9,R17
    04E1D 2E80      MOV	R8,R16
    04E1E 8100      LD	R16,Z
    04E1F 8111      LDD	R17,Z+1
    04E20 8122      LDD	R18,Z+2
    04E21 8133      LDD	R19,Z+3
    04E22 940E 4D94 CALL	unpacku
    04E24 F171      BEQ	0x4E53
    04E25 246E      EOR	R6,R14
    04E26 0C4C      ADD	R4,R12
    04E27 1C5D      ADC	R5,R13
    04E28 E880      LDI	R24,0x80
    04E29 1648      CP	R4,R24
    04E2A 0653      CPC	R5,R19
    04E2B F564      BGE	0x4E58
    04E2C E881      LDI	R24,0x81
    04E2D 1648      CP	R4,R24
    04E2E EF8F      LDI	R24,0xFF
    04E2F 0658      CPC	R5,R24
    04E30 F16C      BLT	0x4E5E
    04E31 9EA2      MUL	R10,R18
    04E32 2DB1      MOV	R27,R1
    04E33 2DA0      MOV	R26,R0
    04E34 9E91      MUL	R9,R17
    04E35 2D91      MOV	R25,R1
    04E36 2D80      MOV	R24,R0
    04E37 9EA0      MUL	R10,R16
    04E38 0D80      ADD	R24,R0
    04E39 1D91      ADC	R25,R1
    04E3A 1FA3      ADC	R26,R19
    04E3B 1FB3      ADC	R27,R19
    04E3C 9E82      MUL	R8,R18
    04E3D 0D80      ADD	R24,R0
    04E3E 1D91      ADC	R25,R1
    04E3F 1FA3      ADC	R26,R19
    04E40 1FB3      ADC	R27,R19
    04E41 9E92      MUL	R9,R18
    04E42 0D90      ADD	R25,R0
    04E43 1DA1      ADC	R26,R1
    04E44 1FB3      ADC	R27,R19
    04E45 9EA1      MUL	R10,R17
    04E46 0D90      ADD	R25,R0
    04E47 1DA1      ADC	R26,R1
    04E48 1FB3      ADC	R27,R19
    04E49 2F2B      MOV	R18,R27
    04E4A 2F1A      MOV	R17,R26
    04E4B 2F09      MOV	R16,R25
    04E4C 0F88      LSL	R24
    04E4D 1F00      ROL	R16
    04E4E 1F11      ROL	R17
    04E4F 1F22      ROL	R18
    04E50 1F33      ROL	R19
    04E51 940E 4DAD CALL	normalize_and_pack
    04E53 91B9      LD	R27,Y+
    04E54 91A9      LD	R26,Y+
    04E55 940E 4E01 CALL	restoreFPRegs
    04E57 9508      RET
    04E58 EF0F      LDI	R16,0xFF
    04E59 2F10      MOV	R17,R16
    04E5A E72F      LDI	R18,0x7F
    04E5B E78F      LDI	R24,0x7F
    04E5C 2E48      MOV	R4,R24
    04E5D CFF5      RJMP	0x4E53
    04E5E 2700      CLR	R16
    04E5F 2F10      MOV	R17,R16
    04E60 2F20      MOV	R18,R16
    04E61 2F30      MOV	R19,R16
    04E62 CFF0      RJMP	0x4E53
fpmule1:
    04E63 93FA      ST	-Y,R31
    04E64 93EA      ST	-Y,R30
    04E65 81EA      LDD	R30,Y+2
    04E66 81FB      LDD	R31,Y+3
    04E67 940E 4E10 CALL	fpmule
    04E69 91E9      LD	R30,Y+
    04E6A 91F9      LD	R31,Y+
    04E6B 9622      ADIW	R28,2
    04E6C 9508      RET
fpmule2:
    04E6D 93FA      ST	-Y,R31
    04E6E 93EA      ST	-Y,R30
    04E6F 2FEC      MOV	R30,R28
    04E70 2FFD      MOV	R31,R29
    04E71 9632      ADIW	R30,2
    04E72 940E 4E10 CALL	fpmule
    04E74 91E9      LD	R30,Y+
    04E75 91F9      LD	R31,Y+
    04E76 9624      ADIW	R28,4
    04E77 9508      RET
fpmule1x:
    04E78 93FA      ST	-Y,R31
    04E79 93EA      ST	-Y,R30
    04E7A 81EA      LDD	R30,Y+2
    04E7B 81FB      LDD	R31,Y+3
    04E7C 940E 4E10 CALL	fpmule
    04E7E 91E9      LD	R30,Y+
    04E7F 91F9      LD	R31,Y+
    04E80 8339      STD	Y+1,R19
    04E81 8328      ST	Y,R18
    04E82 931A      ST	-Y,R17
    04E83 930A      ST	-Y,R16
    04E84 9508      RET
fpcmp:
    04E85 940E 4BE5 CALL	fpsub
    04E87 2333      TST	R19
    04E88 F03A      BMI	0x4E90
    04E89 940E 4D8C CALL	tstR16_R19
    04E8B F011      BEQ	0x4E8E
    04E8C E001      LDI	R16,1
    04E8D 9508      RET
    04E8E 2700      CLR	R16
    04E8F 9508      RET
    04E90 EF0F      LDI	R16,0xFF
    04E91 9508      RET
fpcmp1:
    04E92 93FA      ST	-Y,R31
    04E93 93EA      ST	-Y,R30
    04E94 81EA      LDD	R30,Y+2
    04E95 81FB      LDD	R31,Y+3
    04E96 940E 4E85 CALL	fpcmp
    04E98 91E9      LD	R30,Y+
    04E99 91F9      LD	R31,Y+
    04E9A 9622      ADIW	R28,2
    04E9B 2300      TST	R16
    04E9C 9508      RET
fpcmp2:
    04E9D 93FA      ST	-Y,R31
    04E9E 93EA      ST	-Y,R30
    04E9F 2FEC      MOV	R30,R28
    04EA0 2FFD      MOV	R31,R29
    04EA1 9632      ADIW	R30,2
    04EA2 940E 4E85 CALL	fpcmp
    04EA4 91E9      LD	R30,Y+
    04EA5 91F9      LD	R31,Y+
    04EA6 9624      ADIW	R28,4
    04EA7 2300      TST	R16
    04EA8 9508      RET
_cstrcpy:
    04EA9 2FA0      MOV	R26,R16
    04EAA 2FB1      MOV	R27,R17
    04EAB 2FE2      MOV	R30,R18
    04EAC 2FF3      MOV	R31,R19
    04EAD 95C8      LPM
    04EAE 9631      ADIW	R30,1
    04EAF 920D      ST	X+,R0
    04EB0 2000      TST	R0
    04EB1 F7D9      BNE	0x4EAD
    04EB2 9508      RET
_cstrlen:
    04EB3 2FE0      MOV	R30,R16
    04EB4 2FF1      MOV	R31,R17
    04EB5 27AA      CLR	R26
    04EB6 27BB      CLR	R27
    04EB7 95C8      LPM
    04EB8 2000      TST	R0
    04EB9 F019      BEQ	0x4EBD
    04EBA 9631      ADIW	R30,1
    04EBB 9611      ADIW	R26,1
    04EBC CFFA      RJMP	0x4EB7
    04EBD 2F0A      MOV	R16,R26
    04EBE 2F1B      MOV	R17,R27
    04EBF 9508      RET
_atoi:
    04EC0 940E 4B3C CALL	push_xgsetF00C
    04EC2 0158      MOVW	R10,R16
    04EC3 C003      RJMP	0x4EC7
    04EC4 01C5      MOVW	R24,R10
    04EC5 9601      ADIW	R24,1
    04EC6 015C      MOVW	R10,R24
    04EC7 01F5      MOVW	R30,R10
    04EC8 8100      LD	R16,Z
    04EC9 2711      CLR	R17
    04ECA 940E 5273 CALL	_isspace
    04ECC 3000      CPI	R16,0
    04ECD 0701      CPC	R16,R17
    04ECE F7A9      BNE	0x4EC4
    04ECF 2766      CLR	R22
    04ED0 2777      CLR	R23
    04ED1 01F5      MOVW	R30,R10
    04ED2 8180      LD	R24,Z
    04ED3 328D      CPI	R24,0x2D
    04ED4 F429      BNE	0x4EDA
    04ED5 E061      LDI	R22,1
    04ED6 01CF      MOVW	R24,R30
    04ED7 9601      ADIW	R24,1
    04ED8 015C      MOVW	R10,R24
    04ED9 C007      RJMP	0x4EE1
    04EDA 01F5      MOVW	R30,R10
    04EDB 8180      LD	R24,Z
    04EDC 328B      CPI	R24,0x2B
    04EDD F419      BNE	0x4EE1
    04EDE 01CF      MOVW	R24,R30
    04EDF 9601      ADIW	R24,1
    04EE0 015C      MOVW	R10,R24
    04EE1 2744      CLR	R20
    04EE2 2755      CLR	R21
    04EE3 C00E      RJMP	0x4EF2
    04EE4 E00A      LDI	R16,0xA
    04EE5 E010      LDI	R17,0
    04EE6 019A      MOVW	R18,R20
    04EE7 940E 4AB9 CALL	empy16s
    04EE9 01A8      MOVW	R20,R16
    04EEA 01F5      MOVW	R30,R10
    04EEB 9021      LD	R2,Z+
    04EEC 015F      MOVW	R10,R30
    04EED 2433      CLR	R3
    04EEE 0D42      ADD	R20,R2
    04EEF 1D53      ADC	R21,R3
    04EF0 5340      SUBI	R20,0x30
    04EF1 4050      SBCI	R21,0
    04EF2 01F5      MOVW	R30,R10
    04EF3 8100      LD	R16,Z
    04EF4 2711      CLR	R17
    04EF5 940E 525F CALL	_isdigit
    04EF7 3000      CPI	R16,0
    04EF8 0701      CPC	R16,R17
    04EF9 F751      BNE	0x4EE4
    04EFA 3060      CPI	R22,0
    04EFB 0767      CPC	R22,R23
    04EFC F031      BEQ	0x4F03
    04EFD 018A      MOVW	R16,R20
    04EFE 9500      COM	R16
    04EFF 9510      COM	R17
    04F00 5F0F      SUBI	R16,0xFF
    04F01 4F1F      SBCI	R17,0xFF
    04F02 C001      RJMP	0x4F04
    04F03 018A      MOVW	R16,R20
    04F04 940C 4B43 JMP	pop_xgsetF00C
_itoa:
    04F06 940E 49D8 CALL	push_arg4
    04F08 940E 4B1D CALL	push_xgsetF0FC
    04F0A 01A9      MOVW	R20,R18
    04F0B 84EE      LDD	R14,Y+14
    04F0C 84FF      LDD	R15,Y+15
    04F0D 015A      MOVW	R10,R20
    04F0E 20AA      TST	R10
    04F0F F451      BNE	0x4F1A
    04F10 20BB      TST	R11
    04F11 F441      BNE	0x4F1A
    04F12 E380      LDI	R24,0x30
    04F13 85EA      LDD	R30,Y+10
    04F14 85FB      LDD	R31,Y+11
    04F15 8380      ST	Z,R24
    04F16 2422      CLR	R2
    04F17 8221      STD	Z+1,R2
    04F18 018F      MOVW	R16,R30
    04F19 C053      RJMP	0x4F6D
    04F1A 3040      CPI	R20,0
    04F1B E0E0      LDI	R30,0
    04F1C 075E      CPC	R21,R30
    04F1D F46C      BGE	0x4F2B
    04F1E 01C7      MOVW	R24,R14
    04F1F 308A      CPI	R24,0xA
    04F20 E0E0      LDI	R30,0
    04F21 079E      CPC	R25,R30
    04F22 F441      BNE	0x4F2B
    04F23 24CC      CLR	R12
    04F24 94C3      INC	R12
    04F25 01C5      MOVW	R24,R10
    04F26 9580      COM	R24
    04F27 9590      COM	R25
    04F28 9601      ADIW	R24,1
    04F29 015C      MOVW	R10,R24
    04F2A C001      RJMP	0x4F2C
    04F2B 24CC      CLR	R12
    04F2C 856A      LDD	R22,Y+10
    04F2D 857B      LDD	R23,Y+11
    04F2E 0197      MOVW	R18,R14
    04F2F 0185      MOVW	R16,R10
    04F30 940E 4A07 CALL	mod16u
    04F32 01A8      MOVW	R20,R16
    04F33 E089      LDI	R24,0x9
    04F34 E090      LDI	R25,0
    04F35 1780      CP	R24,R16
    04F36 0791      CPC	R25,R17
    04F37 F034      BLT	0x4F3E
    04F38 01CA      MOVW	R24,R20
    04F39 96C0      ADIW	R24,0x30
    04F3A 01FB      MOVW	R30,R22
    04F3B 9381      ST	Z+,R24
    04F3C 01BF      MOVW	R22,R30
    04F3D C006      RJMP	0x4F44
    04F3E 01CA      MOVW	R24,R20
    04F3F 5A89      SUBI	R24,0xA9
    04F40 4F9F      SBCI	R25,0xFF
    04F41 01FB      MOVW	R30,R22
    04F42 9381      ST	Z+,R24
    04F43 01BF      MOVW	R22,R30
    04F44 0197      MOVW	R18,R14
    04F45 0185      MOVW	R16,R10
    04F46 940E 4A09 CALL	div16u
    04F48 0158      MOVW	R10,R16
    04F49 20AA      TST	R10
    04F4A F719      BNE	0x4F2E
    04F4B 20BB      TST	R11
    04F4C F709      BNE	0x4F2E
    04F4D 20CC      TST	R12
    04F4E F021      BEQ	0x4F53
    04F4F E28D      LDI	R24,0x2D
    04F50 01FB      MOVW	R30,R22
    04F51 9381      ST	Z+,R24
    04F52 01BF      MOVW	R22,R30
    04F53 012B      MOVW	R4,R22
    04F54 5061      SUBI	R22,1
    04F55 4070      SBCI	R23,0
    04F56 2422      CLR	R2
    04F57 01F2      MOVW	R30,R4
    04F58 8220      ST	Z,R2
    04F59 84AA      LDD	R10,Y+10
    04F5A 84BB      LDD	R11,Y+11
    04F5B C00C      RJMP	0x4F68
    04F5C 01F5      MOVW	R30,R10
    04F5D 80C0      LD	R12,Z
    04F5E 01FB      MOVW	R30,R22
    04F5F 8020      LD	R2,Z
    04F60 01F5      MOVW	R30,R10
    04F61 9221      ST	Z+,R2
    04F62 015F      MOVW	R10,R30
    04F63 011B      MOVW	R2,R22
    04F64 5061      SUBI	R22,1
    04F65 4070      SBCI	R23,0
    04F66 01F1      MOVW	R30,R2
    04F67 82C0      ST	Z,R12
    04F68 16A6      CP	R10,R22
    04F69 06B7      CPC	R11,R23
    04F6A F388      BCS	0x4F5C
    04F6B 850A      LDD	R16,Y+10
    04F6C 851B      LDD	R17,Y+11
    04F6D 940E 4B12 CALL	pop_xgsetF0FC
    04F6F 9624      ADIW	R28,4
    04F70 9508      RET
_ltoa:
    04F71 940E 49D8 CALL	push_arg4
    04F73 940E 4B1D CALL	push_xgsetF0FC
    04F75 9724      SBIW	R28,4
    04F76 8828      LDD	R2,Y+16
    04F77 8839      LDD	R3,Y+17
    04F78 884A      LDD	R4,Y+18
    04F79 885B      LDD	R5,Y+19
    04F7A 8228      ST	Y,R2
    04F7B 8239      STD	Y+1,R3
    04F7C 824A      STD	Y+2,R4
    04F7D 825B      STD	Y+3,R5
    04F7E 8828      LDD	R2,Y+16
    04F7F 8839      LDD	R3,Y+17
    04F80 884A      LDD	R4,Y+18
    04F81 885B      LDD	R5,Y+19
    04F82 9488      BCLR	0
    04F83 2022      TST	R2
    04F84 0432      CPC	R3,R2
    04F85 0442      CPC	R4,R2
    04F86 0452      CPC	R5,R2
    04F87 F441      BNE	0x4F90
    04F88 E380      LDI	R24,0x30
    04F89 85EE      LDD	R30,Y+14
    04F8A 85FF      LDD	R31,Y+15
    04F8B 8380      ST	Z,R24
    04F8C 2422      CLR	R2
    04F8D 8221      STD	Z+1,R2
    04F8E 018F      MOVW	R16,R30
    04F8F C094      RJMP	0x5024
    04F90 E040      LDI	R20,0
    04F91 E050      LDI	R21,0
    04F92 E060      LDI	R22,0
    04F93 E070      LDI	R23,0
    04F94 8828      LDD	R2,Y+16
    04F95 8839      LDD	R3,Y+17
    04F96 884A      LDD	R4,Y+18
    04F97 885B      LDD	R5,Y+19
    04F98 1624      CP	R2,R20
    04F99 0635      CPC	R3,R21
    04F9A 0646      CPC	R4,R22
    04F9B 0657      CPC	R5,R23
    04F9C F4EC      BGE	0x4FBA
    04F9D 898C      LDD	R24,Y+20
    04F9E 899D      LDD	R25,Y+21
    04F9F 308A      CPI	R24,0xA
    04FA0 E0A0      LDI	R26,0
    04FA1 079A      CPC	R25,R26
    04FA2 F4B9      BNE	0x4FBA
    04FA3 24AA      CLR	R10
    04FA4 94A3      INC	R10
    04FA5 E041      LDI	R20,1
    04FA6 E050      LDI	R21,0
    04FA7 E060      LDI	R22,0
    04FA8 E070      LDI	R23,0
    04FA9 8028      LD	R2,Y
    04FAA 8039      LDD	R3,Y+1
    04FAB 804A      LDD	R4,Y+2
    04FAC 805B      LDD	R5,Y+3
    04FAD 9420      COM	R2
    04FAE 9430      COM	R3
    04FAF 9440      COM	R4
    04FB0 9450      COM	R5
    04FB1 0E24      ADD	R2,R20
    04FB2 1E35      ADC	R3,R21
    04FB3 1E46      ADC	R4,R22
    04FB4 1E57      ADC	R5,R23
    04FB5 8228      ST	Y,R2
    04FB6 8239      STD	Y+1,R3
    04FB7 824A      STD	Y+2,R4
    04FB8 825B      STD	Y+3,R5
    04FB9 C001      RJMP	0x4FBB
    04FBA 24AA      CLR	R10
    04FBB 84CE      LDD	R12,Y+14
    04FBC 84DF      LDD	R13,Y+15
    04FBD 882C      LDD	R2,Y+20
    04FBE 883D      LDD	R3,Y+21
    04FBF 2444      CLR	R4
    04FC0 FC37      SBRC	R3,7
    04FC1 9440      COM	R4
    04FC2 2455      CLR	R5
    04FC3 FC47      SBRC	R4,7
    04FC4 9450      COM	R5
    04FC5 8108      LD	R16,Y
    04FC6 8119      LDD	R17,Y+1
    04FC7 812A      LDD	R18,Y+2
    04FC8 813B      LDD	R19,Y+3
    04FC9 925A      ST	-Y,R5
    04FCA 924A      ST	-Y,R4
    04FCB 923A      ST	-Y,R3
    04FCC 922A      ST	-Y,R2
    04FCD 940E 4A25 CALL	mod32u
    04FCF 0178      MOVW	R14,R16
    04FD0 E089      LDI	R24,0x9
    04FD1 E090      LDI	R25,0
    04FD2 1780      CP	R24,R16
    04FD3 0791      CPC	R25,R17
    04FD4 F034      BLT	0x4FDB
    04FD5 01C7      MOVW	R24,R14
    04FD6 96C0      ADIW	R24,0x30
    04FD7 01F6      MOVW	R30,R12
    04FD8 9381      ST	Z+,R24
    04FD9 016F      MOVW	R12,R30
    04FDA C006      RJMP	0x4FE1
    04FDB 01C7      MOVW	R24,R14
    04FDC 5A89      SUBI	R24,0xA9
    04FDD 4F9F      SBCI	R25,0xFF
    04FDE 01F6      MOVW	R30,R12
    04FDF 9381      ST	Z+,R24
    04FE0 016F      MOVW	R12,R30
    04FE1 882C      LDD	R2,Y+20
    04FE2 883D      LDD	R3,Y+21
    04FE3 2444      CLR	R4
    04FE4 FC37      SBRC	R3,7
    04FE5 9440      COM	R4
    04FE6 2455      CLR	R5
    04FE7 FC47      SBRC	R4,7
    04FE8 9450      COM	R5
    04FE9 8108      LD	R16,Y
    04FEA 8119      LDD	R17,Y+1
    04FEB 812A      LDD	R18,Y+2
    04FEC 813B      LDD	R19,Y+3
    04FED 925A      ST	-Y,R5
    04FEE 924A      ST	-Y,R4
    04FEF 923A      ST	-Y,R3
    04FF0 922A      ST	-Y,R2
    04FF1 940E 4A23 CALL	div32u
    04FF3 8308      ST	Y,R16
    04FF4 8319      STD	Y+1,R17
    04FF5 832A      STD	Y+2,R18
    04FF6 833B      STD	Y+3,R19
    04FF7 8028      LD	R2,Y
    04FF8 8039      LDD	R3,Y+1
    04FF9 804A      LDD	R4,Y+2
    04FFA 805B      LDD	R5,Y+3
    04FFB 9488      BCLR	0
    04FFC 2022      TST	R2
    04FFD 0432      CPC	R3,R2
    04FFE 0442      CPC	R4,R2
    04FFF 0452      CPC	R5,R2
    05000 F009      BEQ	0x5002
    05001 CFBB      RJMP	0x4FBD
    05002 20AA      TST	R10
    05003 F021      BEQ	0x5008
    05004 E28D      LDI	R24,0x2D
    05005 01F6      MOVW	R30,R12
    05006 9381      ST	Z+,R24
    05007 016F      MOVW	R12,R30
    05008 0126      MOVW	R4,R12
    05009 01C2      MOVW	R24,R4
    0500A 9701      SBIW	R24,1
    0500B 016C      MOVW	R12,R24
    0500C 2422      CLR	R2
    0500D 01F2      MOVW	R30,R4
    0500E 8220      ST	Z,R2
    0500F 84EE      LDD	R14,Y+14
    05010 84FF      LDD	R15,Y+15
    05011 C00D      RJMP	0x501F
    05012 01F7      MOVW	R30,R14
    05013 80A0      LD	R10,Z
    05014 01F6      MOVW	R30,R12
    05015 8020      LD	R2,Z
    05016 01F7      MOVW	R30,R14
    05017 9221      ST	Z+,R2
    05018 017F      MOVW	R14,R30
    05019 0116      MOVW	R2,R12
    0501A 01C1      MOVW	R24,R2
    0501B 9701      SBIW	R24,1
    0501C 016C      MOVW	R12,R24
    0501D 01F1      MOVW	R30,R2
    0501E 82A0      ST	Z,R10
    0501F 14EC      CP	R14,R12
    05020 04FD      CPC	R15,R13
    05021 F380      BCS	0x5012
    05022 850E      LDD	R16,Y+14
    05023 851F      LDD	R17,Y+15
    05024 9624      ADIW	R28,4
    05025 940E 4B12 CALL	pop_xgsetF0FC
    05027 9624      ADIW	R28,4
    05028 9508      RET
_ultoa:
    05029 933A      ST	-Y,R19
    0502A 932A      ST	-Y,R18
    0502B 940E 4B1D CALL	push_xgsetF0FC
    0502D 0158      MOVW	R10,R16
    0502E 84CE      LDD	R12,Y+14
    0502F 84DF      LDD	R13,Y+15
    05030 01A5      MOVW	R20,R10
    05031 0116      MOVW	R2,R12
    05032 2444      CLR	R4
    05033 FC37      SBRC	R3,7
    05034 9440      COM	R4
    05035 2455      CLR	R5
    05036 FC47      SBRC	R4,7
    05037 9450      COM	R5
    05038 850A      LDD	R16,Y+10
    05039 851B      LDD	R17,Y+11
    0503A 852C      LDD	R18,Y+12
    0503B 853D      LDD	R19,Y+13
    0503C 925A      ST	-Y,R5
    0503D 924A      ST	-Y,R4
    0503E 923A      ST	-Y,R3
    0503F 922A      ST	-Y,R2
    05040 940E 4A25 CALL	mod32u
    05042 01B8      MOVW	R22,R16
    05043 E089      LDI	R24,0x9
    05044 E090      LDI	R25,0
    05045 1780      CP	R24,R16
    05046 0791      CPC	R25,R17
    05047 F034      BLT	0x504E
    05048 01CB      MOVW	R24,R22
    05049 96C0      ADIW	R24,0x30
    0504A 01FA      MOVW	R30,R20
    0504B 9381      ST	Z+,R24
    0504C 01AF      MOVW	R20,R30
    0504D C006      RJMP	0x5054
    0504E 01CB      MOVW	R24,R22
    0504F 5A89      SUBI	R24,0xA9
    05050 4F9F      SBCI	R25,0xFF
    05051 01FA      MOVW	R30,R20
    05052 9381      ST	Z+,R24
    05053 01AF      MOVW	R20,R30
    05054 0116      MOVW	R2,R12
    05055 2444      CLR	R4
    05056 FC37      SBRC	R3,7
    05057 9440      COM	R4
    05058 2455      CLR	R5
    05059 FC47      SBRC	R4,7
    0505A 9450      COM	R5
    0505B 850A      LDD	R16,Y+10
    0505C 851B      LDD	R17,Y+11
    0505D 852C      LDD	R18,Y+12
    0505E 853D      LDD	R19,Y+13
    0505F 925A      ST	-Y,R5
    05060 924A      ST	-Y,R4
    05061 923A      ST	-Y,R3
    05062 922A      ST	-Y,R2
    05063 940E 4A23 CALL	div32u
    05065 870A      STD	Y+10,R16
    05066 871B      STD	Y+11,R17
    05067 872C      STD	Y+12,R18
    05068 873D      STD	Y+13,R19
    05069 842A      LDD	R2,Y+10
    0506A 843B      LDD	R3,Y+11
    0506B 844C      LDD	R4,Y+12
    0506C 845D      LDD	R5,Y+13
    0506D 9488      BCLR	0
    0506E 2022      TST	R2
    0506F 0432      CPC	R3,R2
    05070 0442      CPC	R4,R2
    05071 0452      CPC	R5,R2
    05072 F009      BEQ	0x5074
    05073 CFBD      RJMP	0x5031
    05074 012A      MOVW	R4,R20
    05075 5041      SUBI	R20,1
    05076 4050      SBCI	R21,0
    05077 2422      CLR	R2
    05078 01F2      MOVW	R30,R4
    05079 8220      ST	Z,R2
    0507A 0165      MOVW	R12,R10
    0507B C00C      RJMP	0x5088
    0507C 01F6      MOVW	R30,R12
    0507D 80E0      LD	R14,Z
    0507E 01FA      MOVW	R30,R20
    0507F 8020      LD	R2,Z
    05080 01F6      MOVW	R30,R12
    05081 9221      ST	Z+,R2
    05082 016F      MOVW	R12,R30
    05083 011A      MOVW	R2,R20
    05084 5041      SUBI	R20,1
    05085 4050      SBCI	R21,0
    05086 01F1      MOVW	R30,R2
    05087 82E0      ST	Z,R14
    05088 16C4      CP	R12,R20
    05089 06D5      CPC	R13,R21
    0508A F388      BCS	0x507C
    0508B 0185      MOVW	R16,R10
    0508C 940E 4B12 CALL	pop_xgsetF0FC
    0508E 9622      ADIW	R28,2
    0508F 9508      RET
_utoa:
    05090 940E 4B1D CALL	push_xgsetF0FC
    05092 0169      MOVW	R12,R18
    05093 0158      MOVW	R10,R16
    05094 84EA      LDD	R14,Y+10
    05095 84FB      LDD	R15,Y+11
    05096 01A5      MOVW	R20,R10
    05097 0197      MOVW	R18,R14
    05098 0186      MOVW	R16,R12
    05099 940E 4A07 CALL	mod16u
    0509B 01B8      MOVW	R22,R16
    0509C E089      LDI	R24,0x9
    0509D E090      LDI	R25,0
    0509E 1780      CP	R24,R16
    0509F 0791      CPC	R25,R17
    050A0 F034      BLT	0x50A7
    050A1 01CB      MOVW	R24,R22
    050A2 96C0      ADIW	R24,0x30
    050A3 01FA      MOVW	R30,R20
    050A4 9381      ST	Z+,R24
    050A5 01AF      MOVW	R20,R30
    050A6 C006      RJMP	0x50AD
    050A7 01CB      MOVW	R24,R22
    050A8 5A89      SUBI	R24,0xA9
    050A9 4F9F      SBCI	R25,0xFF
    050AA 01FA      MOVW	R30,R20
    050AB 9381      ST	Z+,R24
    050AC 01AF      MOVW	R20,R30
    050AD 0197      MOVW	R18,R14
    050AE 0186      MOVW	R16,R12
    050AF 940E 4A09 CALL	div16u
    050B1 0168      MOVW	R12,R16
    050B2 20CC      TST	R12
    050B3 F719      BNE	0x5097
    050B4 20DD      TST	R13
    050B5 F709      BNE	0x5097
    050B6 012A      MOVW	R4,R20
    050B7 5041      SUBI	R20,1
    050B8 4050      SBCI	R21,0
    050B9 2422      CLR	R2
    050BA 01F2      MOVW	R30,R4
    050BB 8220      ST	Z,R2
    050BC 0165      MOVW	R12,R10
    050BD C00C      RJMP	0x50CA
    050BE 01F6      MOVW	R30,R12
    050BF 80E0      LD	R14,Z
    050C0 01FA      MOVW	R30,R20
    050C1 8020      LD	R2,Z
    050C2 01F6      MOVW	R30,R12
    050C3 9221      ST	Z+,R2
    050C4 016F      MOVW	R12,R30
    050C5 011A      MOVW	R2,R20
    050C6 5041      SUBI	R20,1
    050C7 4050      SBCI	R21,0
    050C8 01F1      MOVW	R30,R2
    050C9 82E0      ST	Z,R14
    050CA 16C4      CP	R12,R20
    050CB 06D5      CPC	R13,R21
    050CC F388      BCS	0x50BE
    050CD 0185      MOVW	R16,R10
    050CE 940C 4B12 JMP	pop_xgsetF0FC
_ftoa:
    050D0 940E 49D8 CALL	push_arg4
    050D2 940E 4B1D CALL	push_xgsetF0FC
    050D4 9764      SBIW	R28,0x14
    050D5 A0CA      LDD	R12,Y+34
    050D6 A0DB      LDD	R13,Y+35
    050D7 2422      CLR	R2
    050D8 2433      CLR	R3
    050D9 01F6      MOVW	R30,R12
    050DA 8231      STD	Z+1,R3
    050DB 8220      ST	Z,R2
    050DC 8C2E      LDD	R2,Y+30
    050DD 8C3F      LDD	R3,Y+31
    050DE A048      LDD	R4,Y+32
    050DF A059      LDD	R5,Y+33
    050E0 EF0E      LDI	R16,0xFE
    050E1 E010      LDI	R17,0
    050E2 940E 4AA5 CALL	elpm32
    050E4 933A      ST	-Y,R19
    050E5 932A      ST	-Y,R18
    050E6 931A      ST	-Y,R17
    050E7 930A      ST	-Y,R16
    050E8 0181      MOVW	R16,R2
    050E9 0192      MOVW	R18,R4
    050EA 940E 4E9D CALL	fpcmp2
    050EC F479      BNE	0x50FC
    050ED E380      LDI	R24,0x30
    050EE 9380 093B STS	Rec+118,R24
    050F0 E28E      LDI	R24,0x2E
    050F1 9380 093C STS	Rec+119,R24
    050F3 E380      LDI	R24,0x30
    050F4 9380 093D STS	Rec+120,R24
    050F6 2422      CLR	R2
    050F7 9220 093E STS	Rec+121,R2
    050F9 E30B      LDI	R16,0x3B
    050FA E019      LDI	R17,0x9
    050FB C15E      RJMP	0x525A
    050FC 8C2E      LDD	R2,Y+30
    050FD 8C3F      LDD	R3,Y+31
    050FE A048      LDD	R4,Y+32
    050FF A059      LDD	R5,Y+33
    05100 8628      STD	Y+8,R2
    05101 8639      STD	Y+9,R3
    05102 864A      STD	Y+10,R4
    05103 865B      STD	Y+11,R5
    05104 E187      LDI	R24,0x17
    05105 E090      LDI	R25,0
    05106 8508      LDD	R16,Y+8
    05107 8519      LDD	R17,Y+9
    05108 852A      LDD	R18,Y+10
    05109 853B      LDD	R19,Y+11
    0510A 938A      ST	-Y,R24
    0510B 940E 49DD CALL	asr32
    0510D 2F80      MOV	R24,R16
    0510E 2799      CLR	R25
    0510F 578F      SUBI	R24,0x7F
    05110 4090      SBCI	R25,0
    05111 015C      MOVW	R10,R24
    05112 EF4F      LDI	R20,0xFF
    05113 EF5F      LDI	R21,0xFF
    05114 EF6F      LDI	R22,0xFF
    05115 E070      LDI	R23,0
    05116 8428      LDD	R2,Y+8
    05117 8439      LDD	R3,Y+9
    05118 844A      LDD	R4,Y+10
    05119 845B      LDD	R5,Y+11
    0511A 2224      AND	R2,R20
    0511B 2235      AND	R3,R21
    0511C 2246      AND	R4,R22
    0511D 2257      AND	R5,R23
    0511E 93EF      PUSH	R30
    0511F 2DE4      MOV	R30,R4
    05120 68E0      ORI	R30,0x80
    05121 2E4E      MOV	R4,R30
    05122 91EF      POP	R30
    05123 8A28      STD	Y+16,R2
    05124 8A39      STD	Y+17,R3
    05125 8A4A      STD	Y+18,R4
    05126 8A5B      STD	Y+19,R5
    05127 E080      LDI	R24,0
    05128 838C      STD	Y+4,R24
    05129 838D      STD	Y+5,R24
    0512A 838E      STD	Y+6,R24
    0512B 838F      STD	Y+7,R24
    0512C E080      LDI	R24,0
    0512D 878C      STD	Y+12,R24
    0512E 878D      STD	Y+13,R24
    0512F 878E      STD	Y+14,R24
    05130 878F      STD	Y+15,R24
    05131 01C5      MOVW	R24,R10
    05132 318F      CPI	R24,0x1F
    05133 E0E0      LDI	R30,0
    05134 079E      CPC	R25,R30
    05135 F044      BLT	0x513E
    05136 EF8E      LDI	R24,0xFE
    05137 EF9F      LDI	R25,0xFF
    05138 01F6      MOVW	R30,R12
    05139 8391      STD	Z+1,R25
    0513A 8380      ST	Z,R24
    0513B 2700      CLR	R16
    0513C 2711      CLR	R17
    0513D C11C      RJMP	0x525A
    0513E 01C5      MOVW	R24,R10
    0513F 3E89      CPI	R24,0xE9
    05140 EFEF      LDI	R30,0xFF
    05141 079E      CPC	R25,R30
    05142 F444      BGE	0x514B
    05143 EF8F      LDI	R24,0xFF
    05144 EF9F      LDI	R25,0xFF
    05145 01F6      MOVW	R30,R12
    05146 8391      STD	Z+1,R25
    05147 8380      ST	Z,R24
    05148 2700      CLR	R16
    05149 2711      CLR	R17
    0514A C10F      RJMP	0x525A
    0514B 01C5      MOVW	R24,R10
    0514C 3187      CPI	R24,0x17
    0514D E0A0      LDI	R26,0
    0514E 079A      CPC	R25,R26
    0514F F06C      BLT	0x515D
    05150 9747      SBIW	R24,0x17
    05151 8908      LDD	R16,Y+16
    05152 8919      LDD	R17,Y+17
    05153 892A      LDD	R18,Y+18
    05154 893B      LDD	R19,Y+19
    05155 938A      ST	-Y,R24
    05156 940E 4BA8 CALL	lsl32
    05158 870C      STD	Y+12,R16
    05159 871D      STD	Y+13,R17
    0515A 872E      STD	Y+14,R18
    0515B 873F      STD	Y+15,R19
    0515C C045      RJMP	0x51A2
    0515D 01C5      MOVW	R24,R10
    0515E 3080      CPI	R24,0
    0515F E0A0      LDI	R26,0
    05160 079A      CPC	R25,R26
    05161 F13C      BLT	0x5189
    05162 E187      LDI	R24,0x17
    05163 E090      LDI	R25,0
    05164 198A      SUB	R24,R10
    05165 099B      SBC	R25,R11
    05166 8908      LDD	R16,Y+16
    05167 8919      LDD	R17,Y+17
    05168 892A      LDD	R18,Y+18
    05169 893B      LDD	R19,Y+19
    0516A 938A      ST	-Y,R24
    0516B 940E 49DD CALL	asr32
    0516D 870C      STD	Y+12,R16
    0516E 871D      STD	Y+13,R17
    0516F 872E      STD	Y+14,R18
    05170 873F      STD	Y+15,R19
    05171 01C5      MOVW	R24,R10
    05172 9601      ADIW	R24,1
    05173 8908      LDD	R16,Y+16
    05174 8919      LDD	R17,Y+17
    05175 892A      LDD	R18,Y+18
    05176 893B      LDD	R19,Y+19
    05177 938A      ST	-Y,R24
    05178 940E 4BA8 CALL	lsl32
    0517A 0118      MOVW	R2,R16
    0517B 0129      MOVW	R4,R18
    0517C EF4F      LDI	R20,0xFF
    0517D EF5F      LDI	R21,0xFF
    0517E EF6F      LDI	R22,0xFF
    0517F E070      LDI	R23,0
    05180 2224      AND	R2,R20
    05181 2235      AND	R3,R21
    05182 2246      AND	R4,R22
    05183 2257      AND	R5,R23
    05184 822C      STD	Y+4,R2
    05185 823D      STD	Y+5,R3
    05186 824E      STD	Y+6,R4
    05187 825F      STD	Y+7,R5
    05188 C019      RJMP	0x51A2
    05189 EF4F      LDI	R20,0xFF
    0518A EF5F      LDI	R21,0xFF
    0518B EF6F      LDI	R22,0xFF
    0518C E070      LDI	R23,0
    0518D 8908      LDD	R16,Y+16
    0518E 8919      LDD	R17,Y+17
    0518F 892A      LDD	R18,Y+18
    05190 893B      LDD	R19,Y+19
    05191 2304      AND	R16,R20
    05192 2315      AND	R17,R21
    05193 2326      AND	R18,R22
    05194 2337      AND	R19,R23
    05195 01C5      MOVW	R24,R10
    05196 9601      ADIW	R24,1
    05197 9580      COM	R24
    05198 9590      COM	R25
    05199 5F8F      SUBI	R24,0xFF
    0519A 4F9F      SBCI	R25,0xFF
    0519B 938A      ST	-Y,R24
    0519C 940E 49DD CALL	asr32
    0519E 830C      STD	Y+4,R16
    0519F 831D      STD	Y+5,R17
    051A0 832E      STD	Y+6,R18
    051A1 833F      STD	Y+7,R19
    051A2 E38B      LDI	R24,0x3B
    051A3 E099      LDI	R25,0x9
    051A4 015C      MOVW	R10,R24
    051A5 E040      LDI	R20,0
    051A6 E050      LDI	R21,0
    051A7 E060      LDI	R22,0
    051A8 E070      LDI	R23,0
    051A9 8428      LDD	R2,Y+8
    051AA 8439      LDD	R3,Y+9
    051AB 844A      LDD	R4,Y+10
    051AC 845B      LDD	R5,Y+11
    051AD 1624      CP	R2,R20
    051AE 0635      CPC	R3,R21
    051AF 0646      CPC	R4,R22
    051B0 0657      CPC	R5,R23
    051B1 F424      BGE	0x51B6
    051B2 E28D      LDI	R24,0x2D
    051B3 01F5      MOVW	R30,R10
    051B4 9381      ST	Z+,R24
    051B5 015F      MOVW	R10,R30
    051B6 842C      LDD	R2,Y+12
    051B7 843D      LDD	R3,Y+13
    051B8 844E      LDD	R4,Y+14
    051B9 845F      LDD	R5,Y+15
    051BA 9488      BCLR	0
    051BB 2022      TST	R2
    051BC 0432      CPC	R3,R2
    051BD 0442      CPC	R4,R2
    051BE 0452      CPC	R5,R2
    051BF F429      BNE	0x51C5
    051C0 E380      LDI	R24,0x30
    051C1 01F5      MOVW	R30,R10
    051C2 9381      ST	Z+,R24
    051C3 015F      MOVW	R10,R30
    051C4 C016      RJMP	0x51DB
    051C5 E08A      LDI	R24,0xA
    051C6 E090      LDI	R25,0
    051C7 839B      STD	Y+3,R25
    051C8 838A      STD	Y+2,R24
    051C9 842C      LDD	R2,Y+12
    051CA 843D      LDD	R3,Y+13
    051CB 844E      LDD	R4,Y+14
    051CC 845F      LDD	R5,Y+15
    051CD 8248      ST	Y,R4
    051CE 8259      STD	Y+1,R5
    051CF 0191      MOVW	R18,R2
    051D0 0185      MOVW	R16,R10
    051D1 940E 4F71 CALL	_ltoa
    051D3 C003      RJMP	0x51D7
    051D4 01C5      MOVW	R24,R10
    051D5 9601      ADIW	R24,1
    051D6 015C      MOVW	R10,R24
    051D7 01F5      MOVW	R30,R10
    051D8 8020      LD	R2,Z
    051D9 2022      TST	R2
    051DA F7C9      BNE	0x51D4
    051DB E28E      LDI	R24,0x2E
    051DC 01F5      MOVW	R30,R10
    051DD 9381      ST	Z+,R24
    051DE 015F      MOVW	R10,R30
    051DF 802C      LDD	R2,Y+4
    051E0 803D      LDD	R3,Y+5
    051E1 804E      LDD	R4,Y+6
    051E2 805F      LDD	R5,Y+7
    051E3 9488      BCLR	0
    051E4 2022      TST	R2
    051E5 0432      CPC	R3,R2
    051E6 0442      CPC	R4,R2
    051E7 0452      CPC	R5,R2
    051E8 F421      BNE	0x51ED
    051E9 E380      LDI	R24,0x30
    051EA 9381      ST	Z+,R24
    051EB 015F      MOVW	R10,R30
    051EC C068      RJMP	0x5255
    051ED E38B      LDI	R24,0x3B
    051EE E099      LDI	R25,0x9
    051EF 0115      MOVW	R2,R10
    051F0 1A28      SUB	R2,R24
    051F1 0A39      SBC	R3,R25
    051F2 E08F      LDI	R24,0xF
    051F3 E090      LDI	R25,0
    051F4 1982      SUB	R24,R2
    051F5 0993      SBC	R25,R3
    051F6 9701      SBIW	R24,1
    051F7 2EC8      MOV	R12,R24
    051F8 E087      LDI	R24,7
    051F9 158C      CP	R24,R12
    051FA F408      BCC	0x51FC
    051FB 2EC8      MOV	R12,R24
    051FC 24EE      CLR	R14
    051FD C042      RJMP	0x5240
    051FE E083      LDI	R24,3
    051FF E090      LDI	R25,0
    05200 810C      LDD	R16,Y+4
    05201 811D      LDD	R17,Y+5
    05202 812E      LDD	R18,Y+6
    05203 813F      LDD	R19,Y+7
    05204 938A      ST	-Y,R24
    05205 940E 4BA8 CALL	lsl32
    05207 0118      MOVW	R2,R16
    05208 0129      MOVW	R4,R18
    05209 806C      LDD	R6,Y+4
    0520A 807D      LDD	R7,Y+5
    0520B 808E      LDD	R8,Y+6
    0520C 809F      LDD	R9,Y+7
    0520D 0C66      LSL	R6
    0520E 1C77      ROL	R7
    0520F 1C88      ROL	R8
    05210 1C99      ROL	R9
    05211 0C26      ADD	R2,R6
    05212 1C37      ADC	R3,R7
    05213 1C48      ADC	R4,R8
    05214 1C59      ADC	R5,R9
    05215 822C      STD	Y+4,R2
    05216 823D      STD	Y+5,R3
    05217 824E      STD	Y+6,R4
    05218 825F      STD	Y+7,R5
    05219 E188      LDI	R24,0x18
    0521A E090      LDI	R25,0
    0521B 810C      LDD	R16,Y+4
    0521C 811D      LDD	R17,Y+5
    0521D 812E      LDD	R18,Y+6
    0521E 813F      LDD	R19,Y+7
    0521F 938A      ST	-Y,R24
    05220 940E 49DD CALL	asr32
    05222 0118      MOVW	R2,R16
    05223 0129      MOVW	R4,R18
    05224 E340      LDI	R20,0x30
    05225 E050      LDI	R21,0
    05226 E060      LDI	R22,0
    05227 E070      LDI	R23,0
    05228 0E24      ADD	R2,R20
    05229 1E35      ADC	R3,R21
    0522A 1E46      ADC	R4,R22
    0522B 1E57      ADC	R5,R23
    0522C 01F5      MOVW	R30,R10
    0522D 9221      ST	Z+,R2
    0522E 015F      MOVW	R10,R30
    0522F EF4F      LDI	R20,0xFF
    05230 EF5F      LDI	R21,0xFF
    05231 EF6F      LDI	R22,0xFF
    05232 E070      LDI	R23,0
    05233 802C      LDD	R2,Y+4
    05234 803D      LDD	R3,Y+5
    05235 804E      LDD	R4,Y+6
    05236 805F      LDD	R5,Y+7
    05237 2224      AND	R2,R20
    05238 2235      AND	R3,R21
    05239 2246      AND	R4,R22
    0523A 2257      AND	R5,R23
    0523B 822C      STD	Y+4,R2
    0523C 823D      STD	Y+5,R3
    0523D 824E      STD	Y+6,R4
    0523E 825F      STD	Y+7,R5
    0523F 94E3      INC	R14
    05240 14EC      CP	R14,R12
    05241 F408      BCC	0x5243
    05242 CFBB      RJMP	0x51FE
    05243 01C5      MOVW	R24,R10
    05244 9701      SBIW	R24,1
    05245 015C      MOVW	R10,R24
    05246 C003      RJMP	0x524A
    05247 01C5      MOVW	R24,R10
    05248 9701      SBIW	R24,1
    05249 015C      MOVW	R10,R24
    0524A 01F5      MOVW	R30,R10
    0524B 8180      LD	R24,Z
    0524C 3380      CPI	R24,0x30
    0524D F421      BNE	0x5252
    0524E 9731      SBIW	R30,1
    0524F 8180      LD	R24,Z
    05250 328E      CPI	R24,0x2E
    05251 F7A9      BNE	0x5247
    05252 01C5      MOVW	R24,R10
    05253 9601      ADIW	R24,1
    05254 015C      MOVW	R10,R24
    05255 2422      CLR	R2
    05256 01F5      MOVW	R30,R10
    05257 8220      ST	Z,R2
    05258 E30B      LDI	R16,0x3B
    05259 E019      LDI	R17,0x9
    0525A 9664      ADIW	R28,0x14
    0525B 940E 4B12 CALL	pop_xgsetF0FC
    0525D 9624      ADIW	R28,4
    0525E 9508      RET
_isdigit:
    0525F E083      LDI	R24,3
    05260 E091      LDI	R25,1
    05261 01F8      MOVW	R30,R16
    05262 0FE8      ADD	R30,R24
    05263 1FF9      ADC	R31,R25
    05264 9106      ELPM	R16,Z
    05265 2711      CLR	R17
    05266 7004      ANDI	R16,4
    05267 7010      ANDI	R17,0
    05268 9508      RET
_islower:
    05269 E083      LDI	R24,3
    0526A E091      LDI	R25,1
    0526B 01F8      MOVW	R30,R16
    0526C 0FE8      ADD	R30,R24
    0526D 1FF9      ADC	R31,R25
    0526E 9106      ELPM	R16,Z
    0526F 2711      CLR	R17
    05270 7002      ANDI	R16,2
    05271 7010      ANDI	R17,0
    05272 9508      RET
_isspace:
    05273 E083      LDI	R24,3
    05274 E091      LDI	R25,1
    05275 01F8      MOVW	R30,R16
    05276 0FE8      ADD	R30,R24
    05277 1FF9      ADC	R31,R25
    05278 9106      ELPM	R16,Z
    05279 2711      CLR	R17
    0527A 7100      ANDI	R16,0x10
    0527B 7010      ANDI	R17,0
    0527C 9508      RET
_toupper:
    0527D 934A      ST	-Y,R20
    0527E 935A      ST	-Y,R21
    0527F 01A8      MOVW	R20,R16
    05280 018A      MOVW	R16,R20
    05281 940E 5269 CALL	_islower
    05283 3000      CPI	R16,0
    05284 0701      CPC	R16,R17
    05285 F031      BEQ	0x528C
    05286 018A      MOVW	R16,R20
    05287 5601      SUBI	R16,0x61
    05288 4010      SBCI	R17,0
    05289 5B0F      SUBI	R16,0xBF
    0528A 4F1F      SBCI	R17,0xFF
    0528B C001      RJMP	0x528D
    0528C 018A      MOVW	R16,R20
    0528D 9159      LD	R21,Y+
    0528E 9149      LD	R20,Y+
    0528F 9508      RET
__sdepi:
    05290 91E0 094A LDS	R30,Rec+133
    05292 91F0 094B LDS	R31,Rec+134
    05294 9301      ST	Z+,R16
    05295 93F0 094B STS	Rec+134,R31
    05297 93E0 094A STS	Rec+133,R30
    05299 9508      RET
_sprintf:
    0529A 940E 49D8 CALL	push_arg4
    0529C 92AA      ST	-Y,R10
    0529D 92BA      ST	-Y,R11
    0529E 9722      SBIW	R28,2
    0529F 802C      LDD	R2,Y+4
    052A0 803D      LDD	R3,Y+5
    052A1 9230 094B STS	Rec+134,R3
    052A3 9220 094A STS	Rec+133,R2
    052A5 01CE      MOVW	R24,R28
    052A6 9608      ADIW	R24,0x8
    052A7 015C      MOVW	R10,R24
    052A8 82B9      STD	Y+1,R11
    052A9 82A8      ST	Y,R10
    052AA 812E      LDD	R18,Y+6
    052AB 813F      LDD	R19,Y+7
    052AC EA0A      LDI	R16,0xAA
    052AD E010      LDI	R17,0
    052AE 940E 4547 CALL	__print
    052B0 2422      CLR	R2
    052B1 91E0 094A LDS	R30,Rec+133
    052B3 91F0 094B LDS	R31,Rec+134
    052B5 8220      ST	Z,R2
    052B6 802C      LDD	R2,Y+4
    052B7 803D      LDD	R3,Y+5
    052B8 9100 094A LDS	R16,Rec+133
    052BA 9110 094B LDS	R17,Rec+134
    052BC 1902      SUB	R16,R2
    052BD 0913      SBC	R17,R3
    052BE 9622      ADIW	R28,2
    052BF 90B9      LD	R11,Y+
    052C0 90A9      LD	R10,Y+
    052C1 9624      ADIW	R28,4
    052C2 9508      RET
    052C3 940E 4B3C CALL	push_xgsetF00C
    052C5 01B9      MOVW	R22,R18
    052C6 0158      MOVW	R10,R16
    052C7 3F6E      CPI	R22,0xFE
    052C8 EFEF      LDI	R30,0xFF
    052C9 077E      CPC	R23,R30
    052CA F419      BNE	0x52CE
    052CB E043      LDI	R20,3
    052CC E052      LDI	R21,2
    052CD C009      RJMP	0x52D7
    052CE 3F6F      CPI	R22,0xFF
    052CF EFEF      LDI	R30,0xFF
    052D0 077E      CPC	R23,R30
    052D1 F419      BNE	0x52D5
    052D2 E14E      LDI	R20,0x1E
    052D3 E052      LDI	R21,2
    052D4 C002      RJMP	0x52D7
    052D5 E34B      LDI	R20,0x3B
    052D6 E052      LDI	R21,2
    052D7 019A      MOVW	R18,R20
    052D8 0185      MOVW	R16,R10
    052D9 940E 4EA9 CALL	_cstrcpy
    052DB 0185      MOVW	R16,R10
    052DC 940C 4B43 JMP	pop_xgsetF00C
__FormatFP_1:
    052DE 940E 49D8 CALL	push_arg4
    052E0 940E 4B1D CALL	push_xgsetF0FC
    052E2 01B9      MOVW	R22,R18
    052E3 97A2      SBIW	R28,0x22
    052E4 EF8F      LDI	R24,0xFF
    052E5 EF9F      LDI	R25,0xFF
    052E6 015C      MOVW	R10,R24
    052E7 879F      STD	Y+15,R25
    052E8 878E      STD	Y+14,R24
    052E9 8B9B      STD	Y+19,R25
    052EA 8B8A      STD	Y+18,R24
    052EB 8B99      STD	Y+17,R25
    052EC 8B88      STD	Y+16,R24
    052ED 8F9E      STD	Y+30,R25
    052EE 8F8D      STD	Y+29,R24
    052EF 8B9E      STD	Y+22,R25
    052F0 8B8D      STD	Y+21,R24
    052F1 2400      CLR	R0
    052F2 2411      CLR	R1
    052F3 8E19      STD	Y+25,R1
    052F4 8E08      STD	Y+24,R0
    052F5 2799      CLR	R25
    052F6 A398      STD	Y+32,R25
    052F7 8F8F      STD	Y+31,R24
    052F8 24EE      CLR	R14
    052F9 24FF      CLR	R15
    052FA 2744      CLR	R20
    052FB 2755      CLR	R21
    052FC E280      LDI	R24,0x20
    052FD 8B8F      STD	Y+23,R24
    052FE 8F8C      STD	Y+28,R24
    052FF E685      LDI	R24,0x65
    05300 A389      STD	Y+33,R24
    05301 E184      LDI	R24,0x14
    05302 A80E      LDD	R0,Y+54
    05303 A81F      LDD	R1,Y+55
    05304 1580      CP	R24,R0
    05305 0591      CPC	R25,R1
    05306 F414      BGE	0x5309
    05307 AB9F      STD	Y+55,R25
    05308 AB8E      STD	Y+54,R24
    05309 E184      LDI	R24,0x14
    0530A E090      LDI	R25,0
    0530B AC08      LDD	R0,Y+56
    0530C AC19      LDD	R1,Y+57
    0530D 1580      CP	R24,R0
    0530E 0591      CPC	R25,R1
    0530F F414      BGE	0x5312
    05310 AF99      STD	Y+57,R25
    05311 AF88      STD	Y+56,R24
    05312 3060      CPI	R22,0
    05313 0767      CPC	R22,R23
    05314 F409      BNE	0x5316
    05315 C084      RJMP	0x539A
    05316 3061      CPI	R22,1
    05317 E0E0      LDI	R30,0
    05318 077E      CPC	R23,R30
    05319 F079      BEQ	0x5329
    0531A 3062      CPI	R22,2
    0531B E0E0      LDI	R30,0
    0531C 077E      CPC	R23,R30
    0531D F049      BEQ	0x5327
    0531E 3063      CPI	R22,3
    0531F E0E0      LDI	R30,0
    05320 077E      CPC	R23,R30
    05321 F061      BEQ	0x532E
    05322 3064      CPI	R22,4
    05323 E0E0      LDI	R30,0
    05324 077E      CPC	R23,R30
    05325 F031      BEQ	0x532C
    05326 C073      RJMP	0x539A
    05327 E485      LDI	R24,0x45
    05328 A389      STD	Y+33,R24
    05329 E041      LDI	R20,1
    0532A E050      LDI	R21,0
    0532B C06E      RJMP	0x539A
    0532C E485      LDI	R24,0x45
    0532D A389      STD	Y+33,R24
    0532E A828      LDD	R2,Y+48
    0532F A839      LDD	R3,Y+49
    05330 A84A      LDD	R4,Y+50
    05331 A85B      LDD	R5,Y+51
    05332 8628      STD	Y+8,R2
    05333 8639      STD	Y+9,R3
    05334 864A      STD	Y+10,R4
    05335 865B      STD	Y+11,R5
    05336 A828      LDD	R2,Y+48
    05337 A839      LDD	R3,Y+49
    05338 A84A      LDD	R4,Y+50
    05339 A85B      LDD	R5,Y+51
    0533A E60C      LDI	R16,0x6C
    0533B E012      LDI	R17,2
    0533C 940E 4AA5 CALL	elpm32
    0533E 933A      ST	-Y,R19
    0533F 932A      ST	-Y,R18
    05340 931A      ST	-Y,R17
    05341 930A      ST	-Y,R16
    05342 0181      MOVW	R16,R2
    05343 0192      MOVW	R18,R4
    05344 940E 4E9D CALL	fpcmp2
    05346 F474      BGE	0x5355
    05347 E608      LDI	R16,0x68
    05348 E012      LDI	R17,2
    05349 940E 4AA5 CALL	elpm32
    0534B 01CE      MOVW	R24,R28
    0534C 96C0      ADIW	R24,0x30
    0534D 939A      ST	-Y,R25
    0534E 938A      ST	-Y,R24
    0534F 940E 4E63 CALL	fpmule1
    05351 8708      STD	Y+8,R16
    05352 8719      STD	Y+9,R17
    05353 872A      STD	Y+10,R18
    05354 873B      STD	Y+11,R19
    05355 E604      LDI	R16,0x64
    05356 E012      LDI	R17,2
    05357 940E 4AA5 CALL	elpm32
    05359 830A      STD	Y+2,R16
    0535A 831B      STD	Y+3,R17
    0535B 832C      STD	Y+4,R18
    0535C 833D      STD	Y+5,R19
    0535D 2400      CLR	R0
    0535E 2411      CLR	R1
    0535F 861D      STD	Y+13,R1
    05360 860C      STD	Y+12,R0
    05361 C013      RJMP	0x5375
    05362 E600      LDI	R16,0x60
    05363 E012      LDI	R17,2
    05364 940E 4AA5 CALL	elpm32
    05366 01CE      MOVW	R24,R28
    05367 9602      ADIW	R24,2
    05368 939A      ST	-Y,R25
    05369 938A      ST	-Y,R24
    0536A 940E 4E63 CALL	fpmule1
    0536C 830A      STD	Y+2,R16
    0536D 831B      STD	Y+3,R17
    0536E 832C      STD	Y+4,R18
    0536F 833D      STD	Y+5,R19
    05370 858C      LDD	R24,Y+12
    05371 859D      LDD	R25,Y+13
    05372 9601      ADIW	R24,1
    05373 879D      STD	Y+13,R25
    05374 878C      STD	Y+12,R24
    05375 840C      LDD	R0,Y+12
    05376 841D      LDD	R1,Y+13
    05377 AD08      LDD	R16,Y+56
    05378 AD19      LDD	R17,Y+57
    05379 1600      CP	R0,R16
    0537A 0611      CPC	R1,R17
    0537B F334      BLT	0x5362
    0537C 8428      LDD	R2,Y+8
    0537D 8439      LDD	R3,Y+9
    0537E 844A      LDD	R4,Y+10
    0537F 845B      LDD	R5,Y+11
    05380 E50C      LDI	R16,0x5C
    05381 E012      LDI	R17,2
    05382 940E 4AA5 CALL	elpm32
    05384 933A      ST	-Y,R19
    05385 932A      ST	-Y,R18
    05386 931A      ST	-Y,R17
    05387 930A      ST	-Y,R16
    05388 0181      MOVW	R16,R2
    05389 0192      MOVW	R18,R4
    0538A 940E 4E9D CALL	fpcmp2
    0538C F05C      BLT	0x5398
    0538D 01CE      MOVW	R24,R28
    0538E 9608      ADIW	R24,0x8
    0538F 810A      LDD	R16,Y+2
    05390 811B      LDD	R17,Y+3
    05391 812C      LDD	R18,Y+4
    05392 813D      LDD	R19,Y+5
    05393 939A      ST	-Y,R25
    05394 938A      ST	-Y,R24
    05395 940E 4E92 CALL	fpcmp1
    05397 F414      BGE	0x539A
    05398 E041      LDI	R20,1
    05399 E050      LDI	R21,0
    0539A A80C      LDD	R0,Y+52
    0539B A81D      LDD	R1,Y+53
    0539C FE04      SBRS	R0,4
    0539D C002      RJMP	0x53A0
    0539E E380      LDI	R24,0x30
    0539F 8B8F      STD	Y+23,R24
    053A0 880F      LDD	R0,Y+23
    053A1 8A0C      STD	Y+20,R0
    053A2 A80C      LDD	R0,Y+52
    053A3 A81D      LDD	R1,Y+53
    053A4 FE03      SBRS	R0,3
    053A5 C002      RJMP	0x53A8
    053A6 E28B      LDI	R24,0x2B
    053A7 8B8C      STD	Y+20,R24
    053A8 3040      CPI	R20,0
    053A9 0745      CPC	R20,R21
    053AA F061      BEQ	0x53B7
    053AB 01CE      MOVW	R24,R28
    053AC 9606      ADIW	R24,6
    053AD 8399      STD	Y+1,R25
    053AE 8388      ST	Y,R24
    053AF A908      LDD	R16,Y+48
    053B0 A919      LDD	R17,Y+49
    053B1 A92A      LDD	R18,Y+50
    053B2 A93B      LDD	R19,Y+51
    053B3 940E 50D0 CALL	_ftoa
    053B5 01B8      MOVW	R22,R16
    053B6 C062      RJMP	0x5419
    053B7 E508      LDI	R16,0x58
    053B8 E012      LDI	R17,2
    053B9 940E 4AA5 CALL	elpm32
    053BB 830A      STD	Y+2,R16
    053BC 831B      STD	Y+3,R17
    053BD 832C      STD	Y+4,R18
    053BE 833D      STD	Y+5,R19
    053BF 2400      CLR	R0
    053C0 2411      CLR	R1
    053C1 861D      STD	Y+13,R1
    053C2 860C      STD	Y+12,R0
    053C3 C019      RJMP	0x53DD
    053C4 802A      LDD	R2,Y+2
    053C5 803B      LDD	R3,Y+3
    053C6 804C      LDD	R4,Y+4
    053C7 805D      LDD	R5,Y+5
    053C8 E600      LDI	R16,0x60
    053C9 E012      LDI	R17,2
    053CA 940E 4AA5 CALL	elpm32
    053CC 933A      ST	-Y,R19
    053CD 932A      ST	-Y,R18
    053CE 931A      ST	-Y,R17
    053CF 930A      ST	-Y,R16
    053D0 0181      MOVW	R16,R2
    053D1 0192      MOVW	R18,R4
    053D2 940E 4CF3 CALL	fpdiv2
    053D4 830A      STD	Y+2,R16
    053D5 831B      STD	Y+3,R17
    053D6 832C      STD	Y+4,R18
    053D7 833D      STD	Y+5,R19
    053D8 858C      LDD	R24,Y+12
    053D9 859D      LDD	R25,Y+13
    053DA 9601      ADIW	R24,1
    053DB 879D      STD	Y+13,R25
    053DC 878C      STD	Y+12,R24
    053DD 840C      LDD	R0,Y+12
    053DE 841D      LDD	R1,Y+13
    053DF AD08      LDD	R16,Y+56
    053E0 AD19      LDD	R17,Y+57
    053E1 1600      CP	R0,R16
    053E2 0611      CPC	R1,R17
    053E3 F304      BLT	0x53C4
    053E4 A828      LDD	R2,Y+48
    053E5 A839      LDD	R3,Y+49
    053E6 A84A      LDD	R4,Y+50
    053E7 A85B      LDD	R5,Y+51
    053E8 E60C      LDI	R16,0x6C
    053E9 E012      LDI	R17,2
    053EA 940E 4AA5 CALL	elpm32
    053EC 933A      ST	-Y,R19
    053ED 932A      ST	-Y,R18
    053EE 931A      ST	-Y,R17
    053EF 930A      ST	-Y,R16
    053F0 0181      MOVW	R16,R2
    053F1 0192      MOVW	R18,R4
    053F2 940E 4E9D CALL	fpcmp2
    053F4 F494      BGE	0x5407
    053F5 01CE      MOVW	R24,R28
    053F6 9606      ADIW	R24,6
    053F7 8399      STD	Y+1,R25
    053F8 8388      ST	Y,R24
    053F9 A908      LDD	R16,Y+48
    053FA A919      LDD	R17,Y+49
    053FB A92A      LDD	R18,Y+50
    053FC A93B      LDD	R19,Y+51
    053FD 01CE      MOVW	R24,R28
    053FE 9602      ADIW	R24,2
    053FF 939A      ST	-Y,R25
    05400 938A      ST	-Y,R24
    05401 940E 4C64 CALL	fpsub1
    05403 940E 50D0 CALL	_ftoa
    05405 01B8      MOVW	R22,R16
    05406 C012      RJMP	0x5419
    05407 01CE      MOVW	R24,R28
    05408 9606      ADIW	R24,6
    05409 8399      STD	Y+1,R25
    0540A 8388      ST	Y,R24
    0540B A908      LDD	R16,Y+48
    0540C A919      LDD	R17,Y+49
    0540D A92A      LDD	R18,Y+50
    0540E A93B      LDD	R19,Y+51
    0540F 01CE      MOVW	R24,R28
    05410 9602      ADIW	R24,2
    05411 939A      ST	-Y,R25
    05412 938A      ST	-Y,R24
    05413 940E 4C4F CALL	fpadd1
    05415 940E 50D0 CALL	_ftoa
    05417 0168      MOVW	R12,R16
    05418 01B6      MOVW	R22,R12
    05419 802E      LDD	R2,Y+6
    0541A 803F      LDD	R3,Y+7
    0541B 2022      TST	R2
    0541C F411      BNE	0x541F
    0541D 2033      TST	R3
    0541E F031      BEQ	0x5425
    0541F 0191      MOVW	R18,R2
    05420 A50C      LDD	R16,Y+44
    05421 A51D      LDD	R17,Y+45
    05422 DEA0      RCALL	0x52C3
    05423 0168      MOVW	R12,R16
    05424 C39E      RJMP	0x57C3
    05425 2400      CLR	R0
    05426 2411      CLR	R1
    05427 861D      STD	Y+13,R1
    05428 860C      STD	Y+12,R0
    05429 3040      CPI	R20,0
    0542A 0745      CPC	R20,R21
    0542B F481      BNE	0x543C
    0542C 858E      LDD	R24,Y+14
    0542D 859F      LDD	R25,Y+15
    0542E 3080      CPI	R24,0
    0542F E0E0      LDI	R30,0
    05430 079E      CPC	R25,R30
    05431 F054      BLT	0x543C
    05432 842C      LDD	R2,Y+12
    05433 843D      LDD	R3,Y+13
    05434 1A28      SUB	R2,R24
    05435 0A39      SBC	R3,R25
    05436 AC08      LDD	R0,Y+56
    05437 AC19      LDD	R1,Y+57
    05438 1402      CP	R0,R2
    05439 0413      CPC	R1,R3
    0543A F40C      BGE	0x543C
    0543B C060      RJMP	0x549C
    0543C 85EC      LDD	R30,Y+12
    0543D 85FD      LDD	R31,Y+13
    0543E 0FE6      ADD	R30,R22
    0543F 1FF7      ADC	R31,R23
    05440 80C0      LD	R12,Z
    05441 2D8C      MOV	R24,R12
    05442 3380      CPI	R24,0x30
    05443 F1E0      BCS	0x5480
    05444 E389      LDI	R24,0x39
    05445 158C      CP	R24,R12
    05446 F1C8      BCS	0x5480
    05447 84AC      LDD	R10,Y+12
    05448 84BD      LDD	R11,Y+13
    05449 E380      LDI	R24,0x30
    0544A 158C      CP	R24,R12
    0544B F448      BCC	0x5455
    0544C 8D8D      LDD	R24,Y+29
    0544D 8D9E      LDD	R25,Y+30
    0544E 3080      CPI	R24,0
    0544F E0E0      LDI	R30,0
    05450 079E      CPC	R25,R30
    05451 F41C      BGE	0x5455
    05452 0105      MOVW	R0,R10
    05453 8E1E      STD	Y+30,R1
    05454 8E0D      STD	Y+29,R0
    05455 858E      LDD	R24,Y+14
    05456 859F      LDD	R25,Y+15
    05457 3080      CPI	R24,0
    05458 E0E0      LDI	R30,0
    05459 079E      CPC	R25,R30
    0545A F4C4      BGE	0x5473
    0545B 8988      LDD	R24,Y+16
    0545C 8999      LDD	R25,Y+17
    0545D 3080      CPI	R24,0
    0545E E0E0      LDI	R30,0
    0545F 079E      CPC	R25,R30
    05460 F43C      BGE	0x5468
    05461 E380      LDI	R24,0x30
    05462 158C      CP	R24,R12
    05463 F420      BCC	0x5468
    05464 840C      LDD	R0,Y+12
    05465 841D      LDD	R1,Y+13
    05466 8A19      STD	Y+17,R1
    05467 8A08      STD	Y+16,R0
    05468 8988      LDD	R24,Y+16
    05469 8999      LDD	R25,Y+17
    0546A 3080      CPI	R24,0
    0546B E0E0      LDI	R30,0
    0546C 079E      CPC	R25,R30
    0546D F02C      BLT	0x5473
    0546E 8D88      LDD	R24,Y+24
    0546F 8D99      LDD	R25,Y+25
    05470 9601      ADIW	R24,1
    05471 8F99      STD	Y+25,R25
    05472 8F88      STD	Y+24,R24
    05473 858E      LDD	R24,Y+14
    05474 859F      LDD	R25,Y+15
    05475 3080      CPI	R24,0
    05476 E0E0      LDI	R30,0
    05477 079E      CPC	R25,R30
    05478 F03C      BLT	0x5480
    05479 E380      LDI	R24,0x30
    0547A 158C      CP	R24,R12
    0547B F420      BCC	0x5480
    0547C 840C      LDD	R0,Y+12
    0547D 841D      LDD	R1,Y+13
    0547E 8A1E      STD	Y+22,R1
    0547F 8A0D      STD	Y+21,R0
    05480 2D8C      MOV	R24,R12
    05481 328E      CPI	R24,0x2E
    05482 F421      BNE	0x5487
    05483 840C      LDD	R0,Y+12
    05484 841D      LDD	R1,Y+13
    05485 861F      STD	Y+15,R1
    05486 860E      STD	Y+14,R0
    05487 2D8C      MOV	R24,R12
    05488 328D      CPI	R24,0x2D
    05489 F429      BNE	0x548F
    0548A E081      LDI	R24,1
    0548B E090      LDI	R25,0
    0548C 017C      MOVW	R14,R24
    0548D E28D      LDI	R24,0x2D
    0548E 8B8C      STD	Y+20,R24
    0548F 20CC      TST	R12
    05490 F409      BNE	0x5492
    05491 C00A      RJMP	0x549C
    05492 858C      LDD	R24,Y+12
    05493 859D      LDD	R25,Y+13
    05494 9601      ADIW	R24,1
    05495 879D      STD	Y+13,R25
    05496 878C      STD	Y+12,R24
    05497 3184      CPI	R24,0x14
    05498 E0E0      LDI	R30,0
    05499 079E      CPC	R25,R30
    0549A F40C      BGE	0x549C
    0549B CF8D      RJMP	0x5429
    0549C 858E      LDD	R24,Y+14
    0549D 859F      LDD	R25,Y+15
    0549E 3080      CPI	R24,0
    0549F E0E0      LDI	R30,0
    054A0 079E      CPC	R25,R30
    054A1 F43C      BGE	0x54A9
    054A2 01C5      MOVW	R24,R10
    054A3 9601      ADIW	R24,1
    054A4 8B9B      STD	Y+19,R25
    054A5 8B8A      STD	Y+18,R24
    054A6 9601      ADIW	R24,1
    054A7 015C      MOVW	R10,R24
    054A8 C012      RJMP	0x54BB
    054A9 840E      LDD	R0,Y+14
    054AA 841F      LDD	R1,Y+15
    054AB 8A1B      STD	Y+19,R1
    054AC 8A0A      STD	Y+18,R0
    054AD 898D      LDD	R24,Y+21
    054AE 899E      LDD	R25,Y+22
    054AF 3080      CPI	R24,0
    054B0 E0E0      LDI	R30,0
    054B1 079E      CPC	R25,R30
    054B2 F424      BGE	0x54B7
    054B3 01C0      MOVW	R24,R0
    054B4 9601      ADIW	R24,1
    054B5 015C      MOVW	R10,R24
    054B6 C004      RJMP	0x54BB
    054B7 898D      LDD	R24,Y+21
    054B8 899E      LDD	R25,Y+22
    054B9 9601      ADIW	R24,1
    054BA 015C      MOVW	R10,R24
    054BB 8988      LDD	R24,Y+16
    054BC 8999      LDD	R25,Y+17
    054BD 3080      CPI	R24,0
    054BE E0E0      LDI	R30,0
    054BF 079E      CPC	R25,R30
    054C0 F42C      BGE	0x54C6
    054C1 898A      LDD	R24,Y+18
    054C2 899B      LDD	R25,Y+19
    054C3 9701      SBIW	R24,1
    054C4 8B99      STD	Y+17,R25
    054C5 8B88      STD	Y+16,R24
    054C6 3040      CPI	R20,0
    054C7 0745      CPC	R20,R21
    054C8 F409      BNE	0x54CA
    054C9 C1D2      RJMP	0x569C
    054CA 2400      CLR	R0
    054CB 2411      CLR	R1
    054CC 861D      STD	Y+13,R1
    054CD 860C      STD	Y+12,R0
    054CE 880C      LDD	R0,Y+20
    054CF 890F      LDD	R16,Y+23
    054D0 1600      CP	R0,R16
    054D1 F069      BEQ	0x54DF
    054D2 854C      LDD	R20,Y+12
    054D3 855D      LDD	R21,Y+13
    054D4 01CA      MOVW	R24,R20
    054D5 9601      ADIW	R24,1
    054D6 879D      STD	Y+13,R25
    054D7 878C      STD	Y+12,R24
    054D8 01FA      MOVW	R30,R20
    054D9 A40C      LDD	R0,Y+44
    054DA A41D      LDD	R1,Y+45
    054DB 0DE0      ADD	R30,R0
    054DC 1DF1      ADC	R31,R1
    054DD 880C      LDD	R0,Y+20
    054DE 8200      ST	Z,R0
    054DF 854C      LDD	R20,Y+12
    054E0 855D      LDD	R21,Y+13
    054E1 01CA      MOVW	R24,R20
    054E2 9601      ADIW	R24,1
    054E3 879D      STD	Y+13,R25
    054E4 878C      STD	Y+12,R24
    054E5 8DED      LDD	R30,Y+29
    054E6 8DFE      LDD	R31,Y+30
    054E7 0FE6      ADD	R30,R22
    054E8 1FF7      ADC	R31,R23
    054E9 8020      LD	R2,Z
    054EA 01FA      MOVW	R30,R20
    054EB A40C      LDD	R0,Y+44
    054EC A41D      LDD	R1,Y+45
    054ED 0DE0      ADD	R30,R0
    054EE 1DF1      ADC	R31,R1
    054EF 8220      ST	Z,R2
    054F0 01FC      MOVW	R30,R24
    054F1 0DE0      ADD	R30,R0
    054F2 1DF1      ADC	R31,R1
    054F3 E28E      LDI	R24,0x2E
    054F4 8380      ST	Z,R24
    054F5 2422      CLR	R2
    054F6 2433      CLR	R3
    054F7 AC08      LDD	R0,Y+56
    054F8 AC19      LDD	R1,Y+57
    054F9 1420      CP	R2,R0
    054FA 0431      CPC	R3,R1
    054FB F42C      BGE	0x5501
    054FC 858C      LDD	R24,Y+12
    054FD 859D      LDD	R25,Y+13
    054FE 9601      ADIW	R24,1
    054FF 879D      STD	Y+13,R25
    05500 878C      STD	Y+12,R24
    05501 8D4D      LDD	R20,Y+29
    05502 8D5E      LDD	R21,Y+30
    05503 5F4F      SUBI	R20,0xFF
    05504 4F5F      SBCI	R21,0xFF
    05505 24CC      CLR	R12
    05506 24DD      CLR	R13
    05507 C034      RJMP	0x553C
    05508 880A      LDD	R0,Y+18
    05509 881B      LDD	R1,Y+19
    0550A 1540      CP	R20,R0
    0550B 0551      CPC	R21,R1
    0550C F409      BNE	0x550E
    0550D C02C      RJMP	0x553A
    0550E 154A      CP	R20,R10
    0550F 055B      CPC	R21,R11
    05510 F48C      BGE	0x5522
    05511 84EC      LDD	R14,Y+12
    05512 84FD      LDD	R15,Y+13
    05513 01C7      MOVW	R24,R14
    05514 9601      ADIW	R24,1
    05515 879D      STD	Y+13,R25
    05516 878C      STD	Y+12,R24
    05517 01FA      MOVW	R30,R20
    05518 0FE6      ADD	R30,R22
    05519 1FF7      ADC	R31,R23
    0551A 8020      LD	R2,Z
    0551B 01F7      MOVW	R30,R14
    0551C A40C      LDD	R0,Y+44
    0551D A41D      LDD	R1,Y+45
    0551E 0DE0      ADD	R30,R0
    0551F 1DF1      ADC	R31,R1
    05520 8220      ST	Z,R2
    05521 C015      RJMP	0x5537
    05522 A80C      LDD	R0,Y+52
    05523 A81D      LDD	R1,Y+53
    05524 FC00      SBRC	R0,0
    05525 C004      RJMP	0x552A
    05526 20CC      TST	R12
    05527 F501      BNE	0x5548
    05528 20DD      TST	R13
    05529 F4F1      BNE	0x5548
    0552A 84EC      LDD	R14,Y+12
    0552B 84FD      LDD	R15,Y+13
    0552C 01C7      MOVW	R24,R14
    0552D 9601      ADIW	R24,1
    0552E 879D      STD	Y+13,R25
    0552F 878C      STD	Y+12,R24
    05530 01F7      MOVW	R30,R14
    05531 A40C      LDD	R0,Y+44
    05532 A41D      LDD	R1,Y+45
    05533 0DE0      ADD	R30,R0
    05534 1DF1      ADC	R31,R1
    05535 E380      LDI	R24,0x30
    05536 8380      ST	Z,R24
    05537 01C6      MOVW	R24,R12
    05538 9601      ADIW	R24,1
    05539 016C      MOVW	R12,R24
    0553A 5F4F      SUBI	R20,0xFF
    0553B 4F5F      SBCI	R21,0xFF
    0553C AC08      LDD	R0,Y+56
    0553D AC19      LDD	R1,Y+57
    0553E 14C0      CP	R12,R0
    0553F 04D1      CPC	R13,R1
    05540 F43C      BGE	0x5548
    05541 858C      LDD	R24,Y+12
    05542 859D      LDD	R25,Y+13
    05543 308E      CPI	R24,0xE
    05544 E0E0      LDI	R30,0
    05545 079E      CPC	R25,R30
    05546 F40C      BGE	0x5548
    05547 CFC0      RJMP	0x5508
    05548 858C      LDD	R24,Y+12
    05549 859D      LDD	R25,Y+13
    0554A 9701      SBIW	R24,1
    0554B 016C      MOVW	R12,R24
    0554C AC08      LDD	R0,Y+56
    0554D AC19      LDD	R1,Y+57
    0554E 2000      TST	R0
    0554F F421      BNE	0x5554
    05550 2011      TST	R1
    05551 F411      BNE	0x5554
    05552 84CC      LDD	R12,Y+12
    05553 84DD      LDD	R13,Y+13
    05554 898A      LDD	R24,Y+18
    05555 899B      LDD	R25,Y+19
    05556 8C0D      LDD	R0,Y+29
    05557 8C1E      LDD	R1,Y+30
    05558 1980      SUB	R24,R0
    05559 0991      SBC	R25,R1
    0555A 9701      SBIW	R24,1
    0555B A398      STD	Y+32,R25
    0555C 8F8F      STD	Y+31,R24
    0555D 154A      CP	R20,R10
    0555E 055B      CPC	R21,R11
    0555F F444      BGE	0x5568
    05560 01FA      MOVW	R30,R20
    05561 0FE6      ADD	R30,R22
    05562 1FF7      ADC	R31,R23
    05563 8180      LD	R24,Z
    05564 328E      CPI	R24,0x2E
    05565 F411      BNE	0x5568
    05566 5F4F      SUBI	R20,0xFF
    05567 4F5F      SBCI	R21,0xFF
    05568 154A      CP	R20,R10
    05569 055B      CPC	R21,R11
    0556A F00C      BLT	0x556C
    0556B C06B      RJMP	0x55D7
    0556C 01FA      MOVW	R30,R20
    0556D 0FE6      ADD	R30,R22
    0556E 1FF7      ADC	R31,R23
    0556F 80E0      LD	R14,Z
    05570 24FF      CLR	R15
    05571 2D8E      MOV	R24,R14
    05572 3385      CPI	R24,0x35
    05573 F408      BCC	0x5575
    05574 C062      RJMP	0x55D7
    05575 E389      LDI	R24,0x39
    05576 158E      CP	R24,R14
    05577 F408      BCC	0x5579
    05578 C05E      RJMP	0x55D7
    05579 C057      RJMP	0x55D1
    0557A 01F6      MOVW	R30,R12
    0557B A40C      LDD	R0,Y+44
    0557C A41D      LDD	R1,Y+45
    0557D 0DE0      ADD	R30,R0
    0557E 1DF1      ADC	R31,R1
    0557F 80E0      LD	R14,Z
    05580 24FF      CLR	R15
    05581 2D8E      MOV	R24,R14
    05582 3380      CPI	R24,0x30
    05583 F058      BCS	0x558F
    05584 E388      LDI	R24,0x38
    05585 158E      CP	R24,R14
    05586 F040      BCS	0x558F
    05587 0176      MOVW	R14,R12
    05588 0CE0      ADD	R14,R0
    05589 1CF1      ADC	R15,R1
    0558A 01F7      MOVW	R30,R14
    0558B 8180      LD	R24,Z
    0558C 5F8F      SUBI	R24,0xFF
    0558D 8380      ST	Z,R24
    0558E C048      RJMP	0x55D7
    0558F 01F6      MOVW	R30,R12
    05590 A40C      LDD	R0,Y+44
    05591 A41D      LDD	R1,Y+45
    05592 0DE0      ADD	R30,R0
    05593 1DF1      ADC	R31,R1
    05594 8180      LD	R24,Z
    05595 328E      CPI	R24,0x2E
    05596 F009      BEQ	0x5598
    05597 C029      RJMP	0x55C1
    05598 01C6      MOVW	R24,R12
    05599 9701      SBIW	R24,1
    0559A 016C      MOVW	R12,R24
    0559B 01FC      MOVW	R30,R24
    0559C 0DE0      ADD	R30,R0
    0559D 1DF1      ADC	R31,R1
    0559E 80E0      LD	R14,Z
    0559F 24FF      CLR	R15
    055A0 2D8E      MOV	R24,R14
    055A1 3380      CPI	R24,0x30
    055A2 F058      BCS	0x55AE
    055A3 E388      LDI	R24,0x38
    055A4 158E      CP	R24,R14
    055A5 F040      BCS	0x55AE
    055A6 0176      MOVW	R14,R12
    055A7 0CE0      ADD	R14,R0
    055A8 1CF1      ADC	R15,R1
    055A9 01F7      MOVW	R30,R14
    055AA 8180      LD	R24,Z
    055AB 5F8F      SUBI	R24,0xFF
    055AC 8380      ST	Z,R24
    055AD C029      RJMP	0x55D7
    055AE 01F6      MOVW	R30,R12
    055AF A40C      LDD	R0,Y+44
    055B0 A41D      LDD	R1,Y+45
    055B1 0DE0      ADD	R30,R0
    055B2 1DF1      ADC	R31,R1
    055B3 8180      LD	R24,Z
    055B4 3389      CPI	R24,0x39
    055B5 F459      BNE	0x55C1
    055B6 01F6      MOVW	R30,R12
    055B7 0DE0      ADD	R30,R0
    055B8 1DF1      ADC	R31,R1
    055B9 E381      LDI	R24,0x31
    055BA 8380      ST	Z,R24
    055BB 8D8F      LDD	R24,Y+31
    055BC A198      LDD	R25,Y+32
    055BD 9601      ADIW	R24,1
    055BE A398      STD	Y+32,R25
    055BF 8F8F      STD	Y+31,R24
    055C0 C016      RJMP	0x55D7
    055C1 01F6      MOVW	R30,R12
    055C2 A40C      LDD	R0,Y+44
    055C3 A41D      LDD	R1,Y+45
    055C4 0DE0      ADD	R30,R0
    055C5 1DF1      ADC	R31,R1
    055C6 8180      LD	R24,Z
    055C7 3389      CPI	R24,0x39
    055C8 F429      BNE	0x55CE
    055C9 01F6      MOVW	R30,R12
    055CA 0DE0      ADD	R30,R0
    055CB 1DF1      ADC	R31,R1
    055CC E380      LDI	R24,0x30
    055CD 8380      ST	Z,R24
    055CE 01C6      MOVW	R24,R12
    055CF 9701      SBIW	R24,1
    055D0 016C      MOVW	R12,R24
    055D1 01C6      MOVW	R24,R12
    055D2 3080      CPI	R24,0
    055D3 E0E0      LDI	R30,0
    055D4 079E      CPC	R25,R30
    055D5 F00C      BLT	0x55D7
    055D6 CFA3      RJMP	0x557A
    055D7 84CC      LDD	R12,Y+12
    055D8 84DD      LDD	R13,Y+13
    055D9 01C6      MOVW	R24,R12
    055DA 9601      ADIW	R24,1
    055DB 879D      STD	Y+13,R25
    055DC 878C      STD	Y+12,R24
    055DD 01F6      MOVW	R30,R12
    055DE A40C      LDD	R0,Y+44
    055DF A41D      LDD	R1,Y+45
    055E0 0DE0      ADD	R30,R0
    055E1 1DF1      ADC	R31,R1
    055E2 A009      LDD	R0,Y+33
    055E3 8200      ST	Z,R0
    055E4 8D8F      LDD	R24,Y+31
    055E5 A198      LDD	R25,Y+32
    055E6 3080      CPI	R24,0
    055E7 E0E0      LDI	R30,0
    055E8 079E      CPC	R25,R30
    055E9 F49C      BGE	0x55FD
    055EA 84CC      LDD	R12,Y+12
    055EB 84DD      LDD	R13,Y+13
    055EC 01C6      MOVW	R24,R12
    055ED 9601      ADIW	R24,1
    055EE 879D      STD	Y+13,R25
    055EF 878C      STD	Y+12,R24
    055F0 01F6      MOVW	R30,R12
    055F1 A40C      LDD	R0,Y+44
    055F2 A41D      LDD	R1,Y+45
    055F3 0DE0      ADD	R30,R0
    055F4 1DF1      ADC	R31,R1
    055F5 E28D      LDI	R24,0x2D
    055F6 8380      ST	Z,R24
    055F7 8C0F      LDD	R0,Y+31
    055F8 A018      LDD	R1,Y+32
    055F9 9400      COM	R0
    055FA 9410      COM	R1
    055FB A218      STD	Y+32,R1
    055FC 8E0F      STD	Y+31,R0
    055FD E08A      LDI	R24,0xA
    055FE E090      LDI	R25,0
    055FF 8399      STD	Y+1,R25
    05600 8388      ST	Y,R24
    05601 8D2F      LDD	R18,Y+31
    05602 A138      LDD	R19,Y+32
    05603 850C      LDD	R16,Y+12
    05604 851D      LDD	R17,Y+13
    05605 A40C      LDD	R0,Y+44
    05606 A41D      LDD	R1,Y+45
    05607 0D00      ADD	R16,R0
    05608 1D11      ADC	R17,R1
    05609 940E 4F06 CALL	_itoa
    0560B 2400      CLR	R0
    0560C 2411      CLR	R1
    0560D 861D      STD	Y+13,R1
    0560E 860C      STD	Y+12,R0
    0560F 85EC      LDD	R30,Y+12
    05610 85FD      LDD	R31,Y+13
    05611 A40C      LDD	R0,Y+44
    05612 A41D      LDD	R1,Y+45
    05613 0DE0      ADD	R30,R0
    05614 1DF1      ADC	R31,R1
    05615 8020      LD	R2,Z
    05616 2022      TST	R2
    05617 F429      BNE	0x561D
    05618 840C      LDD	R0,Y+12
    05619 841D      LDD	R1,Y+13
    0561A 8E1B      STD	Y+27,R1
    0561B 8E0A      STD	Y+26,R0
    0561C C009      RJMP	0x5626
    0561D 858C      LDD	R24,Y+12
    0561E 859D      LDD	R25,Y+13
    0561F 9601      ADIW	R24,1
    05620 879D      STD	Y+13,R25
    05621 878C      STD	Y+12,R24
    05622 3184      CPI	R24,0x14
    05623 E0E0      LDI	R30,0
    05624 079E      CPC	R25,R30
    05625 F34C      BLT	0x560F
    05626 A80C      LDD	R0,Y+52
    05627 A81D      LDD	R1,Y+53
    05628 FE02      SBRS	R0,2
    05629 C021      RJMP	0x564B
    0562A 8C0A      LDD	R0,Y+26
    0562B 8C1B      LDD	R1,Y+27
    0562C A90E      LDD	R16,Y+54
    0562D A91F      LDD	R17,Y+55
    0562E 1600      CP	R0,R16
    0562F 0611      CPC	R1,R17
    05630 F00C      BLT	0x5632
    05631 C18F      RJMP	0x57C1
    05632 01A0      MOVW	R20,R0
    05633 C009      RJMP	0x563D
    05634 01FA      MOVW	R30,R20
    05635 A40C      LDD	R0,Y+44
    05636 A41D      LDD	R1,Y+45
    05637 0DE0      ADD	R30,R0
    05638 1DF1      ADC	R31,R1
    05639 8C0C      LDD	R0,Y+28
    0563A 8200      ST	Z,R0
    0563B 5F4F      SUBI	R20,0xFF
    0563C 4F5F      SBCI	R21,0xFF
    0563D A80E      LDD	R0,Y+54
    0563E A81F      LDD	R1,Y+55
    0563F 1540      CP	R20,R0
    05640 0551      CPC	R21,R1
    05641 F394      BLT	0x5634
    05642 01F0      MOVW	R30,R0
    05643 9731      SBIW	R30,1
    05644 A40C      LDD	R0,Y+44
    05645 A41D      LDD	R1,Y+45
    05646 0DE0      ADD	R30,R0
    05647 1DF1      ADC	R31,R1
    05648 2422      CLR	R2
    05649 8220      ST	Z,R2
    0564A C176      RJMP	0x57C1
    0564B 8C0A      LDD	R0,Y+26
    0564C 8C1B      LDD	R1,Y+27
    0564D A90E      LDD	R16,Y+54
    0564E A91F      LDD	R17,Y+55
    0564F 1600      CP	R0,R16
    05650 0611      CPC	R1,R17
    05651 F00C      BLT	0x5653
    05652 C16E      RJMP	0x57C1
    05653 01A0      MOVW	R20,R0
    05654 C014      RJMP	0x5669
    05655 01FA      MOVW	R30,R20
    05656 A80E      LDD	R0,Y+54
    05657 A81F      LDD	R1,Y+55
    05658 0DE0      ADD	R30,R0
    05659 1DF1      ADC	R31,R1
    0565A 8C0A      LDD	R0,Y+26
    0565B 8C1B      LDD	R1,Y+27
    0565C 19E0      SUB	R30,R0
    0565D 09F1      SBC	R31,R1
    0565E A40C      LDD	R0,Y+44
    0565F A41D      LDD	R1,Y+45
    05660 0DE0      ADD	R30,R0
    05661 1DF1      ADC	R31,R1
    05662 01DA      MOVW	R26,R20
    05663 0DA0      ADD	R26,R0
    05664 1DB1      ADC	R27,R1
    05665 902C      LD	R2,X
    05666 8220      ST	Z,R2
    05667 5041      SUBI	R20,1
    05668 4050      SBCI	R21,0
    05669 3040      CPI	R20,0
    0566A E0E0      LDI	R30,0
    0566B 075E      CPC	R21,R30
    0566C F744      BGE	0x5655
    0566D A94E      LDD	R20,Y+54
    0566E A95F      LDD	R21,Y+55
    0566F 8C0A      LDD	R0,Y+26
    05670 8C1B      LDD	R1,Y+27
    05671 1940      SUB	R20,R0
    05672 0951      SBC	R21,R1
    05673 5041      SUBI	R20,1
    05674 4050      SBCI	R21,0
    05675 C009      RJMP	0x567F
    05676 01FA      MOVW	R30,R20
    05677 A40C      LDD	R0,Y+44
    05678 A41D      LDD	R1,Y+45
    05679 0DE0      ADD	R30,R0
    0567A 1DF1      ADC	R31,R1
    0567B 880F      LDD	R0,Y+23
    0567C 8200      ST	Z,R0
    0567D 5041      SUBI	R20,1
    0567E 4050      SBCI	R21,0
    0567F 3040      CPI	R20,0
    05680 E0E0      LDI	R30,0
    05681 075E      CPC	R21,R30
    05682 F79C      BGE	0x5676
    05683 A80C      LDD	R0,Y+52
    05684 A81D      LDD	R1,Y+53
    05685 FE04      SBRS	R0,4
    05686 C13A      RJMP	0x57C1
    05687 880C      LDD	R0,Y+20
    05688 890F      LDD	R16,Y+23
    05689 1600      CP	R0,R16
    0568A F409      BNE	0x568C
    0568B C135      RJMP	0x57C1
    0568C A5EC      LDD	R30,Y+44
    0568D A5FD      LDD	R31,Y+45
    0568E 8200      ST	Z,R0
    0568F A9EE      LDD	R30,Y+54
    05690 A9FF      LDD	R31,Y+55
    05691 8C0A      LDD	R0,Y+26
    05692 8C1B      LDD	R1,Y+27
    05693 19E0      SUB	R30,R0
    05694 09F1      SBC	R31,R1
    05695 A40C      LDD	R0,Y+44
    05696 A41D      LDD	R1,Y+45
    05697 0DE0      ADD	R30,R0
    05698 1DF1      ADC	R31,R1
    05699 2E00      MOV	R0,R16
    0569A 8200      ST	Z,R0
    0569B C125      RJMP	0x57C1
    0569C A80C      LDD	R0,Y+52
    0569D A81D      LDD	R1,Y+53
    0569E FE00      SBRS	R0,0
    0569F C010      RJMP	0x56B0
    056A0 882A      LDD	R2,Y+18
    056A1 883B      LDD	R3,Y+19
    056A2 AC08      LDD	R0,Y+56
    056A3 AC19      LDD	R1,Y+57
    056A4 0C20      ADD	R2,R0
    056A5 1C31      ADC	R3,R1
    056A6 142A      CP	R2,R10
    056A7 043B      CPC	R3,R11
    056A8 F07C      BLT	0x56B8
    056A9 898A      LDD	R24,Y+18
    056AA 899B      LDD	R25,Y+19
    056AB 0D80      ADD	R24,R0
    056AC 1D91      ADC	R25,R1
    056AD 9601      ADIW	R24,1
    056AE 015C      MOVW	R10,R24
    056AF C008      RJMP	0x56B8
    056B0 898A      LDD	R24,Y+18
    056B1 899B      LDD	R25,Y+19
    056B2 9601      ADIW	R24,1
    056B3 16A8      CP	R10,R24
    056B4 06B9      CPC	R11,R25
    056B5 F411      BNE	0x56B8
    056B6 88AA      LDD	R10,Y+18
    056B7 88BB      LDD	R11,Y+19
    056B8 E184      LDI	R24,0x14
    056B9 E090      LDI	R25,0
    056BA 158A      CP	R24,R10
    056BB 059B      CPC	R25,R11
    056BC F40C      BGE	0x56BE
    056BD 015C      MOVW	R10,R24
    056BE 0115      MOVW	R2,R10
    056BF 8808      LDD	R0,Y+16
    056C0 8819      LDD	R1,Y+17
    056C1 1820      SUB	R2,R0
    056C2 0831      SBC	R3,R1
    056C3 8E3B      STD	Y+27,R3
    056C4 8E2A      STD	Y+26,R2
    056C5 880C      LDD	R0,Y+20
    056C6 890F      LDD	R16,Y+23
    056C7 1600      CP	R0,R16
    056C8 F021      BEQ	0x56CD
    056C9 01C1      MOVW	R24,R2
    056CA 9601      ADIW	R24,1
    056CB 8F9B      STD	Y+27,R25
    056CC 8F8A      STD	Y+26,R24
    056CD A80E      LDD	R0,Y+54
    056CE A81F      LDD	R1,Y+55
    056CF 8D0A      LDD	R16,Y+26
    056D0 8D1B      LDD	R17,Y+27
    056D1 1600      CP	R0,R16
    056D2 0611      CPC	R1,R17
    056D3 F41C      BGE	0x56D7
    056D4 0108      MOVW	R0,R16
    056D5 AA1F      STD	Y+55,R1
    056D6 AA0E      STD	Y+54,R0
    056D7 E184      LDI	R24,0x14
    056D8 E090      LDI	R25,0
    056D9 A80E      LDD	R0,Y+54
    056DA A81F      LDD	R1,Y+55
    056DB 1580      CP	R24,R0
    056DC 0591      CPC	R25,R1
    056DD F414      BGE	0x56E0
    056DE AB9F      STD	Y+55,R25
    056DF AB8E      STD	Y+54,R24
    056E0 E184      LDI	R24,0x14
    056E1 E090      LDI	R25,0
    056E2 8C0A      LDD	R0,Y+26
    056E3 8C1B      LDD	R1,Y+27
    056E4 1580      CP	R24,R0
    056E5 0591      CPC	R25,R1
    056E6 F414      BGE	0x56E9
    056E7 8F9B      STD	Y+27,R25
    056E8 8F8A      STD	Y+26,R24
    056E9 A80C      LDD	R0,Y+52
    056EA A81D      LDD	R1,Y+53
    056EB FC02      SBRC	R0,2
    056EC C007      RJMP	0x56F4
    056ED A80E      LDD	R0,Y+54
    056EE A81F      LDD	R1,Y+55
    056EF 8D0A      LDD	R16,Y+26
    056F0 8D1B      LDD	R17,Y+27
    056F1 1600      CP	R0,R16
    056F2 0611      CPC	R1,R17
    056F3 F471      BNE	0x5702
    056F4 24CC      CLR	R12
    056F5 24DD      CLR	R13
    056F6 880C      LDD	R0,Y+20
    056F7 890F      LDD	R16,Y+23
    056F8 1600      CP	R0,R16
    056F9 F409      BNE	0x56FB
    056FA C033      RJMP	0x572E
    056FB A5EC      LDD	R30,Y+44
    056FC A5FD      LDD	R31,Y+45
    056FD 8200      ST	Z,R0
    056FE E081      LDI	R24,1
    056FF E090      LDI	R25,0
    05700 016C      MOVW	R12,R24
    05701 C02C      RJMP	0x572E
    05702 A8CE      LDD	R12,Y+54
    05703 A8DF      LDD	R13,Y+55
    05704 8C0A      LDD	R0,Y+26
    05705 8C1B      LDD	R1,Y+27
    05706 18C0      SUB	R12,R0
    05707 08D1      SBC	R13,R1
    05708 2744      CLR	R20
    05709 2755      CLR	R21
    0570A C009      RJMP	0x5714
    0570B 01FA      MOVW	R30,R20
    0570C A40C      LDD	R0,Y+44
    0570D A41D      LDD	R1,Y+45
    0570E 0DE0      ADD	R30,R0
    0570F 1DF1      ADC	R31,R1
    05710 880F      LDD	R0,Y+23
    05711 8200      ST	Z,R0
    05712 5F4F      SUBI	R20,0xFF
    05713 4F5F      SBCI	R21,0xFF
    05714 16C4      CP	R12,R20
    05715 06D5      CPC	R13,R21
    05716 F7A4      BGE	0x570B
    05717 880C      LDD	R0,Y+20
    05718 890F      LDD	R16,Y+23
    05719 1600      CP	R0,R16
    0571A F099      BEQ	0x572E
    0571B A80C      LDD	R0,Y+52
    0571C A81D      LDD	R1,Y+53
    0571D FE04      SBRS	R0,4
    0571E C005      RJMP	0x5724
    0571F A5EC      LDD	R30,Y+44
    05720 A5FD      LDD	R31,Y+45
    05721 880C      LDD	R0,Y+20
    05722 8200      ST	Z,R0
    05723 C007      RJMP	0x572B
    05724 01F6      MOVW	R30,R12
    05725 A40C      LDD	R0,Y+44
    05726 A41D      LDD	R1,Y+45
    05727 0DE0      ADD	R30,R0
    05728 1DF1      ADC	R31,R1
    05729 880C      LDD	R0,Y+20
    0572A 8200      ST	Z,R0
    0572B 01C6      MOVW	R24,R12
    0572C 9601      ADIW	R24,1
    0572D 016C      MOVW	R12,R24
    0572E 01A6      MOVW	R20,R12
    0572F 8C08      LDD	R0,Y+24
    05730 8C19      LDD	R1,Y+25
    05731 2000      TST	R0
    05732 F459      BNE	0x573E
    05733 2011      TST	R1
    05734 F449      BNE	0x573E
    05735 01FA      MOVW	R30,R20
    05736 A40C      LDD	R0,Y+44
    05737 A41D      LDD	R1,Y+45
    05738 0DE0      ADD	R30,R0
    05739 1DF1      ADC	R31,R1
    0573A E380      LDI	R24,0x30
    0573B 8380      ST	Z,R24
    0573C 5F4F      SUBI	R20,0xFF
    0573D 4F5F      SBCI	R21,0xFF
    0573E 2400      CLR	R0
    0573F 2411      CLR	R1
    05740 861D      STD	Y+13,R1
    05741 860C      STD	Y+12,R0
    05742 C016      RJMP	0x5759
    05743 842C      LDD	R2,Y+12
    05744 843D      LDD	R3,Y+13
    05745 0E26      ADD	R2,R22
    05746 1E37      ADC	R3,R23
    05747 89E8      LDD	R30,Y+16
    05748 89F9      LDD	R31,Y+17
    05749 0DE2      ADD	R30,R2
    0574A 1DF3      ADC	R31,R3
    0574B 8020      LD	R2,Z
    0574C 01FA      MOVW	R30,R20
    0574D A40C      LDD	R0,Y+44
    0574E A41D      LDD	R1,Y+45
    0574F 0DE0      ADD	R30,R0
    05750 1DF1      ADC	R31,R1
    05751 8220      ST	Z,R2
    05752 5F4F      SUBI	R20,0xFF
    05753 4F5F      SBCI	R21,0xFF
    05754 858C      LDD	R24,Y+12
    05755 859D      LDD	R25,Y+13
    05756 9601      ADIW	R24,1
    05757 879D      STD	Y+13,R25
    05758 878C      STD	Y+12,R24
    05759 840C      LDD	R0,Y+12
    0575A 841D      LDD	R1,Y+13
    0575B 8D08      LDD	R16,Y+24
    0575C 8D19      LDD	R17,Y+25
    0575D 1600      CP	R0,R16
    0575E 0611      CPC	R1,R17
    0575F F31C      BLT	0x5743
    05760 880A      LDD	R0,Y+18
    05761 881B      LDD	R1,Y+19
    05762 140A      CP	R0,R10
    05763 041B      CPC	R1,R11
    05764 F44C      BGE	0x576E
    05765 01FA      MOVW	R30,R20
    05766 A40C      LDD	R0,Y+44
    05767 A41D      LDD	R1,Y+45
    05768 0DE0      ADD	R30,R0
    05769 1DF1      ADC	R31,R1
    0576A E28E      LDI	R24,0x2E
    0576B 8380      ST	Z,R24
    0576C 5F4F      SUBI	R20,0xFF
    0576D 4F5F      SBCI	R21,0xFF
    0576E 2400      CLR	R0
    0576F 2411      CLR	R1
    05770 861D      STD	Y+13,R1
    05771 860C      STD	Y+12,R0
    05772 C02C      RJMP	0x579F
    05773 882D      LDD	R2,Y+21
    05774 883E      LDD	R3,Y+22
    05775 840E      LDD	R0,Y+14
    05776 841F      LDD	R1,Y+15
    05777 1820      SUB	R2,R0
    05778 0831      SBC	R3,R1
    05779 840C      LDD	R0,Y+12
    0577A 841D      LDD	R1,Y+13
    0577B 1402      CP	R0,R2
    0577C 0413      CPC	R1,R3
    0577D F47C      BGE	0x578D
    0577E 0110      MOVW	R2,R0
    0577F 0E26      ADD	R2,R22
    05780 1E37      ADC	R3,R23
    05781 85EE      LDD	R30,Y+14
    05782 85FF      LDD	R31,Y+15
    05783 0DE2      ADD	R30,R2
    05784 1DF3      ADC	R31,R3
    05785 8021      LDD	R2,Z+1
    05786 01FA      MOVW	R30,R20
    05787 A40C      LDD	R0,Y+44
    05788 A41D      LDD	R1,Y+45
    05789 0DE0      ADD	R30,R0
    0578A 1DF1      ADC	R31,R1
    0578B 8220      ST	Z,R2
    0578C C00B      RJMP	0x5798
    0578D A80C      LDD	R0,Y+52
    0578E A81D      LDD	R1,Y+53
    0578F FE00      SBRS	R0,0
    05790 C024      RJMP	0x57B5
    05791 01FA      MOVW	R30,R20
    05792 A40C      LDD	R0,Y+44
    05793 A41D      LDD	R1,Y+45
    05794 0DE0      ADD	R30,R0
    05795 1DF1      ADC	R31,R1
    05796 E380      LDI	R24,0x30
    05797 8380      ST	Z,R24
    05798 5F4F      SUBI	R20,0xFF
    05799 4F5F      SBCI	R21,0xFF
    0579A 858C      LDD	R24,Y+12
    0579B 859D      LDD	R25,Y+13
    0579C 9601      ADIW	R24,1
    0579D 879D      STD	Y+13,R25
    0579E 878C      STD	Y+12,R24
    0579F 840C      LDD	R0,Y+12
    057A0 841D      LDD	R1,Y+13
    057A1 AD08      LDD	R16,Y+56
    057A2 AD19      LDD	R17,Y+57
    057A3 1600      CP	R0,R16
    057A4 0611      CPC	R1,R17
    057A5 F42C      BGE	0x57AB
    057A6 3144      CPI	R20,0x14
    057A7 E0E0      LDI	R30,0
    057A8 075E      CPC	R21,R30
    057A9 F40C      BGE	0x57AB
    057AA CFC8      RJMP	0x5773
    057AB C009      RJMP	0x57B5
    057AC 01FA      MOVW	R30,R20
    057AD A40C      LDD	R0,Y+44
    057AE A41D      LDD	R1,Y+45
    057AF 0DE0      ADD	R30,R0
    057B0 1DF1      ADC	R31,R1
    057B1 8C0C      LDD	R0,Y+28
    057B2 8200      ST	Z,R0
    057B3 5F4F      SUBI	R20,0xFF
    057B4 4F5F      SBCI	R21,0xFF
    057B5 A80E      LDD	R0,Y+54
    057B6 A81F      LDD	R1,Y+55
    057B7 1540      CP	R20,R0
    057B8 0551      CPC	R21,R1
    057B9 F394      BLT	0x57AC
    057BA 01FA      MOVW	R30,R20
    057BB A40C      LDD	R0,Y+44
    057BC A41D      LDD	R1,Y+45
    057BD 0DE0      ADD	R30,R0
    057BE 1DF1      ADC	R31,R1
    057BF 2422      CLR	R2
    057C0 8220      ST	Z,R2
    057C1 A50C      LDD	R16,Y+44
    057C2 A51D      LDD	R17,Y+45
    057C3 96A2      ADIW	R28,0x22
    057C4 940E 4B12 CALL	pop_xgsetF0FC
    057C6 9624      ADIW	R28,4
    057C7 9508      RET
