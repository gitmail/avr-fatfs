Interrupt Vectors
    00000 940C 039D JMP	__text_start|__start
    0003C 940C 3CAA JMP	_uart1_rx_isr

Program Code (text area)
__text_start|__start:
    0039D EFCF      LDI	R28,0xFF
    0039E E1D0      LDI	R29,0x10
    0039F BFCD      OUT	0x3D,R28
    003A0 BFDE      OUT	0x3E,R29
    003A1 50C0      SUBI	R28,0
    003A2 40D1      SBCI	R29,1
    003A3 EA0A      LDI	R16,0xAA
    003A4 8308      ST	Y,R16
    003A5 2400      CLR	R0
    003A6 EEE7      LDI	R30,0xE7
    003A7 E0F5      LDI	R31,5
    003A8 E019      LDI	R17,0x9
    003A9 34EC      CPI	R30,0x4C
    003AA 07F1      CPC	R31,R17
    003AB F011      BEQ	0x03AE
    003AC 9201      ST	Z+,R0
    003AD CFFB      RJMP	0x03A9
    003AE 8300      ST	Z,R16
    003AF E5E2      LDI	R30,0x52
    003B0 E0F2      LDI	R31,2
    003B1 E0A0      LDI	R26,0
    003B2 E0B1      LDI	R27,1
    003B3 E017      LDI	R17,7
    003B4 E000      LDI	R16,0
    003B5 BF0B      OUT	0x3B,R16
    003B6 33E9      CPI	R30,0x39
    003B7 07F1      CPC	R31,R17
    003B8 F021      BEQ	0x03BD
    003B9 95C8      LPM
    003BA 9631      ADIW	R30,1
    003BB 920D      ST	X+,R0
    003BC CFF9      RJMP	0x03B6
    003BD 940E 2593 CALL	_main
_exit:
    003BF CFFF      RJMP	_exit
_disk_initialize:
  state                --> R20
  drv                  --> R10
    003C0 92AA      ST	-Y,R10
    003C1 934A      ST	-Y,R20
    003C2 2EA0      MOV	R10,R16
FILE: D:\LQD\software\software_src\diskio.c
(0001) 
(0002) 
(0003) /*-----------------------------------------------------------------------*/
(0004) /* Low level disk I/O module skeleton for FatFs     (C)ChaN, 2007        */
(0005) /*-----------------------------------------------------------------------*/
(0006) /* This is a stub disk I/O module that acts as front end of the existing */
(0007) /* disk I/O modules and attach it to FatFs module with common interface. */
(0008) /*-----------------------------------------------------------------------*/
(0009) 
(0010) #include "diskio.h"
(0011) #include "sd.h"
(0012) 
(0013) 
(0014) /*-----------------------------------------------------------------------*/
(0015) /* Correspondence between physical drive number and physical drive.      */
(0016) /* Note that Tiny-FatFs supports only single drive and always            */
(0017)                                       
(0018) 
(0019) ////////////////////////////
(0020) /*
(0021)    struct tm {
(0022)    	int tm_sec;   // 秒 seconds after the minute, 0 to 60
(0023)    	int tm_min;   // 分 minutes after the hour, 0 to 59
(0024) 	int tm_hour;  // 时 hours since midnight, 0 to 23*
(0025) 	int tm_mday;  // 日 day of the month, 1 to 31
(0026) 	int tm_mon;   // 月 months since January, 0 to 11
(0027) 	int tm_year;  // 年 years since 1900
(0028) 	int tm_wday;  // 星期 days since Sunday, 0 to 6
(0029) 	int tm_yday;  // 从元旦起的天数 days since January 1, 0 to 365
(0030)  	int tm_isdst; // 夏令时？？Daylight Savings Time flag
(0031)  	};
(0032) */
(0033) /*-----------------------------------------------------------------------*/
(0034) /* Inidialize a Drive                                                    */
(0035) 
(0036) DSTATUS disk_initialize ( 
(0037) BYTE drv				/* Physical drive nmuber (0..) */
(0038) )
(0039) {
(0040)     unsigned char state;
(0041) 
(0042)     if(drv)
    003C3 20AA      TST	R10
    003C4 F011      BEQ	0x03C7
(0043)     {
(0044)         return STA_NOINIT;  //仅支持磁盘0的操作
    003C5 E001      LDI	R16,1
    003C6 C00C      RJMP	0x03D3
(0045)     }
(0046) 
(0047)     state = SD_Init();
    003C7 940E 2D8F CALL	_SD_Init
    003C9 2F40      MOV	R20,R16
(0048)     if(state == STA_NODISK)
    003CA 3002      CPI	R16,2
    003CB F411      BNE	0x03CE
(0049)     {
(0050)         return STA_NODISK;
    003CC E002      LDI	R16,2
    003CD C005      RJMP	0x03D3
(0051)     }
(0052)     else if(state != 0)
    003CE 2344      TST	R20
    003CF F011      BEQ	0x03D2
(0053)     {
(0054)         return STA_NOINIT;  //其他错误：初始化失败
    003D0 E001      LDI	R16,1
    003D1 C001      RJMP	0x03D3
(0055)     }
(0056)     else
(0057)     {
(0058)         return 0;           //初始化成功
    003D2 2700      CLR	R16
    003D3 9149      LD	R20,Y+
    003D4 90A9      LD	R10,Y+
    003D5 9508      RET
(0059)     }
(0060) }
(0061) 
(0062) 
(0063) 
(0064) /*-----------------------------------------------------------------------*/
(0065) /* Return Disk Status                                                    */
(0066) 
(0067) DSTATUS disk_status (
(0068) 	BYTE drv		/* Physical drive nmuber (0..) */
(0069) )
(0070) {
(0071)     if(drv)
_disk_status:
  drv                  --> R16
    003D6 2300      TST	R16
    003D7 F011      BEQ	0x03DA
(0072)     {
(0073)         return STA_NOINIT;  //仅支持磁盘0操作
    003D8 E001      LDI	R16,1
    003D9 C001      RJMP	0x03DB
(0074)     }
(0075)     return 0;
    003DA 2700      CLR	R16
    003DB 9508      RET
_disk_read:
  res                  --> R10
  count                --> R20
  sector               --> Y,+10
  buff                 --> R12
  drv                  --> R14
    003DC 940E 4B09 CALL	push_xgset30FC
    003DE 0169      MOVW	R12,R18
    003DF 2EE0      MOV	R14,R16
    003E0 9722      SBIW	R28,2
    003E1 854E      LDD	R20,Y+14
(0076) }
(0077) 
(0078) 
(0079) 
(0080) /*-----------------------------------------------------------------------*/
(0081) /* Read Sector(s)                                                        */
(0082) 
(0083) DRESULT disk_read (
(0084) 	BYTE drv,		/* Physical drive nmuber (0..) */
(0085) 	BYTE *buff,		/* Data buffer to store read data */
(0086) 	DWORD sector,	/* Sector address (LBA) */
(0087) 	BYTE count		/* Number of sectors to read (1..255) */
(0088) )
(0089) {
(0090) 	unsigned char res=0;
    003E2 24AA      CLR	R10
(0091)     if (drv || !count)
    003E3 20EE      TST	R14
    003E4 F411      BNE	0x03E7
    003E5 2344      TST	R20
    003E6 F411      BNE	0x03E9
(0092)     {    
(0093)         return RES_PARERR;  //仅支持单磁盘操作，count不能等于0，否则返回参数错误
    003E7 E004      LDI	R16,4
    003E8 C010      RJMP	0x03F9
(0094)     }
(0095) 
(0096)     if(count==1)            //1个sector的读操作      
    003E9 3041      CPI	R20,1
    003EA F449      BNE	0x03F4
(0097)     {                                                
(0098)         res = SD_Read_Sector(sector, buff);      
    003EB 82D9      STD	Y+1,R13
    003EC 82C8      ST	Y,R12
    003ED 850A      LDD	R16,Y+10
    003EE 851B      LDD	R17,Y+11
    003EF 852C      LDD	R18,Y+12
    003F0 853D      LDD	R19,Y+13
    003F1 940E 2E75 CALL	_SD_Read_Sector
    003F3 2EA0      MOV	R10,R16
(0099)     }                                                                                                 
(0100) 
(0101)     //处理返回值，将SD_driver.c的返回值转成ff.c的返回值
(0102)     if(res == 0x00)
    003F4 20AA      TST	R10
    003F5 F411      BNE	0x03F8
(0103)     {
(0104)         return RES_OK;
    003F6 2700      CLR	R16
    003F7 C001      RJMP	0x03F9
(0105)     }
(0106)     else
(0107)     {
(0108)         return RES_ERROR;
    003F8 E001      LDI	R16,1
    003F9 9622      ADIW	R28,2
    003FA 940C 4AF3 JMP	pop_xgset30FC
_disk_write:
  count                --> R12
  sector               --> Y,+8
  buff                 --> R10
  drv                  --> R14
    003FC 940E 4B0B CALL	push_xgset00FC
    003FE 0159      MOVW	R10,R18
    003FF 2EE0      MOV	R14,R16
    00400 9722      SBIW	R28,2
    00401 84CC      LDD	R12,Y+12
(0109)     }
(0110) }
(0111) 
(0112) 
(0113) 
(0114) /*-----------------------------------------------------------------------*/
(0115) /* Write Sector(s)                                                       */
(0116) 
(0117) #if _READONLY == 0
(0118) DRESULT disk_write (
(0119) 	BYTE drv,			/* Physical drive nmuber (0..) */
(0120) 	BYTE *buff,	        /* Data to be written */
(0121) 	DWORD sector,		/* Sector address (LBA) */
(0122) 	BYTE count			/* Number of sectors to write (1..255) */
(0123) )
(0124) {
(0125)     if (drv || !count)
    00402 20EE      TST	R14
    00403 F411      BNE	0x0406
    00404 20CC      TST	R12
    00405 F411      BNE	0x0408
(0126)     {    
(0127)         return RES_PARERR;  //仅支持单磁盘操作，count不能等于0，否则返回参数错误
    00406 E004      LDI	R16,4
    00407 C009      RJMP	0x0411
(0128)     }   
(0129)    // 读写操作
(0130)     SD_Write_Sector(sector,buff);
    00408 82B9      STD	Y+1,R11
    00409 82A8      ST	Y,R10
    0040A 8508      LDD	R16,Y+8
    0040B 8519      LDD	R17,Y+9
    0040C 852A      LDD	R18,Y+10
    0040D 853B      LDD	R19,Y+11
    0040E 940E 2DEF CALL	_SD_Write_Sector
(0131) 	  
(0132)     return RES_OK;
    00410 2700      CLR	R16
    00411 9622      ADIW	R28,2
    00412 940C 4AEC JMP	pop_xgset00FC
_disk_ioctl:
  buff                 --> Y,+4
  ctrl                 --> Y,+2
  drv                  --> Y,+0
    00414 940E 49C2 CALL	push_arg4
(0133) }
(0134) #endif /* _READONLY */
(0135) 
(0136) 
(0137) 
(0138) /*-----------------------------------------------------------------------*/
(0139) /* Miscellaneous Functions                                               */
(0140) DRESULT disk_ioctl (
(0141) 	BYTE drv,		/* Physical drive nmuber (0..) */
(0142) 	BYTE ctrl,		/* Control code */
(0143) 	void *buff		/* Buffer to send/receive control data */
(0144) )
(0145) {
(0146)  	drv=drv;
(0147) 	ctrl=ctrl;
(0148) 	buff=buff;
(0149) 	return 0;
    00416 2700      CLR	R16
    00417 9624      ADIW	R28,4
    00418 9508      RET
(0150) }
(0151) DWORD get_fattime (void)
(0152) {
(0153) 
(0154)   return 1950466005;
_get_fattime:
    00419 ED05      LDI	R16,0xD5
    0041A EB1F      LDI	R17,0xBF
    0041B E421      LDI	R18,0x41
    0041C E734      LDI	R19,0x74
    0041D 9508      RET
ff.c:mem_cpy:
  s                    --> R12
  d                    --> R10
  cnt                  --> R20
  src                  --> R18
  dst                  --> R16
    0041E 940E 4B34 CALL	push_xgset303C
    00420 814E      LDD	R20,Y+6
    00421 815F      LDD	R21,Y+7
FILE: D:\LQD\software\software_src\ff.c
(0001) /*----------------------------------------------------------------------------/
(0002) /  FatFs - FAT file system module  R0.09                  (C)ChaN, 2011
(0003) /-----------------------------------------------------------------------------/
(0004) / FatFs module is a generic FAT file system module for small embedded systems.
(0005) / This is a free software that opened for education, research and commercial
(0006) / developments under license policy of following terms.
(0007) /
(0008) /  Copyright (C) 2011, ChaN, all right reserved.
(0009) /
(0010) / * The FatFs module is a free software and there is NO WARRANTY.
(0011) / * No restriction on use. You can use, modify and redistribute it for
(0012) /   personal, non-profit or commercial products UNDER YOUR RESPONSIBILITY.
(0013) / * Redistributions of source code must retain the above copyright notice.
(0014) /
(0015) /-----------------------------------------------------------------------------/
(0016) / Feb 26,'06 R0.00  Prototype.
(0017) /
(0018) / Apr 29,'06 R0.01  First stable version.
(0019) /
(0020) / Jun 01,'06 R0.02  Added FAT12 support.
(0021) /                   Removed unbuffered mode.
(0022) /                   Fixed a problem on small (<32M) partition.
(0023) / Jun 10,'06 R0.02a Added a configuration option (_FS_MINIMUM).
(0024) /
(0025) / Sep 22,'06 R0.03  Added f_rename().
(0026) /                   Changed option _FS_MINIMUM to _FS_MINIMIZE.
(0027) / Dec 11,'06 R0.03a Improved cluster scan algorithm to write files fast.
(0028) /                   Fixed f_mkdir() creates incorrect directory on FAT32.
(0029) /
(0030) / Feb 04,'07 R0.04  Supported multiple drive system.
(0031) /                   Changed some interfaces for multiple drive system.
(0032) /                   Changed f_mountdrv() to f_mount().
(0033) /                   Added f_mkfs().
(0034) / Apr 01,'07 R0.04a Supported multiple partitions on a physical drive.
(0035) /                   Added a capability of extending file size to f_lseek().
(0036) /                   Added minimization level 3.
(0037) /                   Fixed an endian sensitive code in f_mkfs().
(0038) / May 05,'07 R0.04b Added a configuration option _USE_NTFLAG.
(0039) /                   Added FSInfo support.
(0040) /                   Fixed DBCS name can result FR_INVALID_NAME.
(0041) /                   Fixed short seek (<= csize) collapses the file object.
(0042) /
(0043) / Aug 25,'07 R0.05  Changed arguments of f_read(), f_write() and f_mkfs().
(0044) /                   Fixed f_mkfs() on FAT32 creates incorrect FSInfo.
(0045) /                   Fixed f_mkdir() on FAT32 creates incorrect directory.
(0046) / Feb 03,'08 R0.05a Added f_truncate() and f_utime().
(0047) /                   Fixed off by one error at FAT sub-type determination.
(0048) /                   Fixed btr in f_read() can be mistruncated.
(0049) /                   Fixed cached sector is not flushed when create and close without write.
(0050) /
(0051) / Apr 01,'08 R0.06  Added fputc(), fputs(), fprintf() and fgets().
(0052) /                   Improved performance of f_lseek() on moving to the same or following cluster.
(0053) /
(0054) / Apr 01,'09 R0.07  Merged Tiny-FatFs as a configuration option. (_FS_TINY)
(0055) /                   Added long file name feature.
(0056) /                   Added multiple code page feature.
(0057) /                   Added re-entrancy for multitask operation.
(0058) /                   Added auto cluster size selection to f_mkfs().
(0059) /                   Added rewind option to f_readdir().
(0060) /                   Changed result code of critical errors.
(0061) /                   Renamed string functions to avoid name collision.
(0062) / Apr 14,'09 R0.07a Separated out OS dependent code on reentrant cfg.
(0063) /                   Added multiple sector size feature.
(0064) / Jun 21,'09 R0.07c Fixed f_unlink() can return FR_OK on error.
(0065) /                   Fixed wrong cache control in f_lseek().
(0066) /                   Added relative path feature.
(0067) /                   Added f_chdir() and f_chdrive().
(0068) /                   Added proper case conversion to extended char.
(0069) / Nov 03,'09 R0.07e Separated out configuration options from ff.h to ffconf.h.
(0070) /                   Fixed f_unlink() fails to remove a sub-dir on _FS_RPATH.
(0071) /                   Fixed name matching error on the 13 char boundary.
(0072) /                   Added a configuration option, _LFN_UNICODE.
(0073) /                   Changed f_readdir() to return the SFN with always upper case on non-LFN cfg.
(0074) /
(0075) / May 15,'10 R0.08  Added a memory configuration option. (_USE_LFN = 3)
(0076) /                   Added file lock feature. (_FS_SHARE)
(0077) /                   Added fast seek feature. (_USE_FASTSEEK)
(0078) /                   Changed some types on the API, XCHAR->TCHAR.
(0079) /                   Changed fname member in the FILINFO structure on Unicode cfg.
(0080) /                   String functions support UTF-8 encoding files on Unicode cfg.
(0081) / Aug 16,'10 R0.08a Added f_getcwd(). (_FS_RPATH = 2)
(0082) /                   Added sector erase feature. (_USE_ERASE)
(0083) /                   Moved file lock semaphore table from fs object to the bss.
(0084) /                   Fixed a wrong directory entry is created on non-LFN cfg when the given name contains ';'.
(0085) /                   Fixed f_mkfs() creates wrong FAT32 volume.
(0086) / Jan 15,'11 R0.08b Fast seek feature is also applied to f_read() and f_write().
(0087) /                   f_lseek() reports required table size on creating CLMP.
(0088) /                   Extended format syntax of f_printf function.
(0089) /                   Ignores duplicated directory separators in given path names.
(0090) /
(0091) / Sep 06,'11 R0.09  f_mkfs() supports multiple partition to finish the multiple partition feature.
(0092) /                   Added f_fdisk(). (_MULTI_PARTITION = 2)
(0093) /---------------------------------------------------------------------------*/
(0094) 
(0095) #include "ff.h"			/* FatFs configurations and declarations */
(0096) #include "diskio.h"		/* Declarations of low level disk I/O functions */
(0097) #include <string.h>
(0098) 
(0099) /*--------------------------------------------------------------------------
(0100) 
(0101)    Module Private Definitions
(0102) 
(0103) ---------------------------------------------------------------------------*/
(0104) 
(0105) #if _FATFS != 6502	/* Revision ID */
(0106) #error Wrong include file (ff.h).
(0107) #endif
(0108) 
(0109) 
(0110) /* Definitions on sector size */
(0111) #if _MAX_SS != 512 && _MAX_SS != 1024 && _MAX_SS != 2048 && _MAX_SS != 4096
(0112) #error Wrong sector size.
(0113) #endif
(0114) #if _MAX_SS != 512
(0115) #define	SS(fs)	((fs)->ssize)	/* Variable sector size */
(0116) #else
(0117) #define	SS(fs)	512U			/* Fixed sector size */
(0118) #endif
(0119) 
(0120) 
(0121) /* Reentrancy related */
(0122) #if _FS_REENTRANT
(0123) #if _USE_LFN == 1
(0124) #error Static LFN work area must not be used in re-entrant configuration.
(0125) #endif
(0126) #define	ENTER_FF(fs)		{ if (!lock_fs(fs)) return FR_TIMEOUT; }
(0127) #define	LEAVE_FF(fs, res)	{ unlock_fs(fs, res); return res; }
(0128) #else
(0129) #define	ENTER_FF(fs)
(0130) #define LEAVE_FF(fs, res)	return res
(0131) #endif
(0132) 
(0133) #define	ABORT(fs, res)		{ fp->flag |= FA__ERROR; LEAVE_FF(fs, res); }
(0134) 
(0135) 
(0136) /* File shareing feature */
(0137) #if _FS_SHARE
(0138) #if _FS_READONLY
(0139) #error _FS_SHARE must be 0 on read-only cfg.
(0140) #endif
(0141) typedef struct {
(0142) 	FATFS *fs;				/* File ID 1, volume (NULL:blank entry) */
(0143) 	DWORD clu;				/* File ID 2, directory */
(0144) 	WORD idx;				/* File ID 3, directory index */
(0145) 	WORD ctr;				/* File open counter, 0:none, 0x01..0xFF:read open count, 0x100:write mode */
(0146) } FILESEM;
(0147) #endif
(0148) 
(0149) 
(0150) /* Misc definitions */
(0151) #define LD_CLUST(dir)	(((DWORD)LD_WORD(dir+DIR_FstClusHI)<<16) | LD_WORD(dir+DIR_FstClusLO))
(0152) #define ST_CLUST(dir,cl) {ST_WORD(dir+DIR_FstClusLO, cl); ST_WORD(dir+DIR_FstClusHI, (DWORD)cl>>16);}
(0153) 
(0154) 
(0155) /* DBCS code ranges and SBCS extend char conversion table */
(0156) 
(0157) #if _CODE_PAGE == 932	/* Japanese Shift-JIS */
(0158) #define _DF1S	0x81	/* DBC 1st byte range 1 start */
(0159) #define _DF1E	0x9F	/* DBC 1st byte range 1 end */
(0160) #define _DF2S	0xE0	/* DBC 1st byte range 2 start */
(0161) #define _DF2E	0xFC	/* DBC 1st byte range 2 end */
(0162) #define _DS1S	0x40	/* DBC 2nd byte range 1 start */
(0163) #define _DS1E	0x7E	/* DBC 2nd byte range 1 end */
(0164) #define _DS2S	0x80	/* DBC 2nd byte range 2 start */
(0165) #define _DS2E	0xFC	/* DBC 2nd byte range 2 end */
(0166) 
(0167) #elif _CODE_PAGE == 936	/* Simplified Chinese GBK */
(0168) #define _DF1S	0x81
(0169) #define _DF1E	0xFE
(0170) #define _DS1S	0x40
(0171) #define _DS1E	0x7E
(0172) #define _DS2S	0x80
(0173) #define _DS2E	0xFE
(0174) 
(0175) #elif _CODE_PAGE == 949	/* Korean */
(0176) #define _DF1S	0x81
(0177) #define _DF1E	0xFE
(0178) #define _DS1S	0x41
(0179) #define _DS1E	0x5A
(0180) #define _DS2S	0x61
(0181) #define _DS2E	0x7A
(0182) #define _DS3S	0x81
(0183) #define _DS3E	0xFE
(0184) 
(0185) #elif _CODE_PAGE == 950	/* Traditional Chinese Big5 */
(0186) #define _DF1S	0x81
(0187) #define _DF1E	0xFE
(0188) #define _DS1S	0x40
(0189) #define _DS1E	0x7E
(0190) #define _DS2S	0xA1
(0191) #define _DS2E	0xFE
(0192) 
(0193) #elif _CODE_PAGE == 437	/* U.S. (OEM) */
(0194) #define _DF1S	0
(0195) #define _EXCVT {0x80,0x9A,0x90,0x41,0x8E,0x41,0x8F,0x80,0x45,0x45,0x45,0x49,0x49,0x49,0x8E,0x8F,0x90,0x92,0x92,0x4F,0x99,0x4F,0x55,0x55,0x59,0x99,0x9A,0x9B,0x9C,0x9D,0x9E,0x9F, \
(0196) 				0x41,0x49,0x4F,0x55,0xA5,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0x21,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0197) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0198) 				0xE0,0xE1,0xE2,0xE3,0xE4,0xE5,0xE6,0xE7,0xE8,0xE9,0xEA,0xEB,0xEC,0xED,0xEE,0xEF,0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}
(0199) 
(0200) #elif _CODE_PAGE == 720	/* Arabic (OEM) */
(0201) #define _DF1S	0
(0202) #define _EXCVT {0x80,0x81,0x45,0x41,0x84,0x41,0x86,0x43,0x45,0x45,0x45,0x49,0x49,0x8D,0x8E,0x8F,0x90,0x92,0x92,0x93,0x94,0x95,0x49,0x49,0x98,0x99,0x9A,0x9B,0x9C,0x9D,0x9E,0x9F, \
(0203) 				0xA0,0xA1,0xA2,0xA3,0xA4,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0204) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0205) 				0xE0,0xE1,0xE2,0xE3,0xE4,0xE5,0xE6,0xE7,0xE8,0xE9,0xEA,0xEB,0xEC,0xED,0xEE,0xEF,0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}
(0206) 
(0207) #elif _CODE_PAGE == 737	/* Greek (OEM) */
(0208) #define _DF1S	0
(0209) #define _EXCVT {0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x92,0x92,0x93,0x94,0x95,0x96,0x97,0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87, \
(0210) 				0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x91,0xAA,0x92,0x93,0x94,0x95,0x96,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0211) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0212) 				0x97,0xEA,0xEB,0xEC,0xE4,0xED,0xEE,0xE7,0xE8,0xF1,0xEA,0xEB,0xEC,0xED,0xEE,0xEF,0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}
(0213) 
(0214) #elif _CODE_PAGE == 775	/* Baltic (OEM) */
(0215) #define _DF1S	0
(0216) #define _EXCVT {0x80,0x9A,0x91,0xA0,0x8E,0x95,0x8F,0x80,0xAD,0xED,0x8A,0x8A,0xA1,0x8D,0x8E,0x8F,0x90,0x92,0x92,0xE2,0x99,0x95,0x96,0x97,0x97,0x99,0x9A,0x9D,0x9C,0x9D,0x9E,0x9F, \
(0217) 				0xA0,0xA1,0xE0,0xA3,0xA3,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0218) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xB5,0xB6,0xB7,0xB8,0xBD,0xBE,0xC6,0xC7,0xA5,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0219) 				0xE0,0xE1,0xE2,0xE3,0xE5,0xE5,0xE6,0xE3,0xE8,0xE8,0xEA,0xEA,0xEE,0xED,0xEE,0xEF,0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}
(0220) 
(0221) #elif _CODE_PAGE == 850	/* Multilingual Latin 1 (OEM) */
(0222) #define _DF1S	0
(0223) #define _EXCVT {0x80,0x9A,0x90,0xB6,0x8E,0xB7,0x8F,0x80,0xD2,0xD3,0xD4,0xD8,0xD7,0xDE,0x8E,0x8F,0x90,0x92,0x92,0xE2,0x99,0xE3,0xEA,0xEB,0x59,0x99,0x9A,0x9D,0x9C,0x9D,0x9E,0x9F, \
(0224) 				0xB5,0xD6,0xE0,0xE9,0xA5,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0x21,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0225) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC7,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0226) 				0xE0,0xE1,0xE2,0xE3,0xE5,0xE5,0xE6,0xE7,0xE7,0xE9,0xEA,0xEB,0xED,0xED,0xEE,0xEF,0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}
(0227) 
(0228) #elif _CODE_PAGE == 852	/* Latin 2 (OEM) */
(0229) #define _DF1S	0
(0230) #define _EXCVT {0x80,0x9A,0x90,0xB6,0x8E,0xDE,0x8F,0x80,0x9D,0xD3,0x8A,0x8A,0xD7,0x8D,0x8E,0x8F,0x90,0x91,0x91,0xE2,0x99,0x95,0x95,0x97,0x97,0x99,0x9A,0x9B,0x9B,0x9D,0x9E,0x9F, \
(0231) 				0xB5,0xD6,0xE0,0xE9,0xA4,0xA4,0xA6,0xA6,0xA8,0xA8,0xAA,0x8D,0xAC,0xB8,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBD,0xBF, \
(0232) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC6,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD1,0xD1,0xD2,0xD3,0xD2,0xD5,0xD6,0xD7,0xB7,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0233) 				0xE0,0xE1,0xE2,0xE3,0xE3,0xD5,0xE6,0xE6,0xE8,0xE9,0xE8,0xEB,0xED,0xED,0xDD,0xEF,0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xEB,0xFC,0xFC,0xFE,0xFF}
(0234) 
(0235) #elif _CODE_PAGE == 855	/* Cyrillic (OEM) */
(0236) #define _DF1S	0
(0237) #define _EXCVT {0x81,0x81,0x83,0x83,0x85,0x85,0x87,0x87,0x89,0x89,0x8B,0x8B,0x8D,0x8D,0x8F,0x8F,0x91,0x91,0x93,0x93,0x95,0x95,0x97,0x97,0x99,0x99,0x9B,0x9B,0x9D,0x9D,0x9F,0x9F, \
(0238) 				0xA1,0xA1,0xA3,0xA3,0xA5,0xA5,0xA7,0xA7,0xA9,0xA9,0xAB,0xAB,0xAD,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB6,0xB6,0xB8,0xB8,0xB9,0xBA,0xBB,0xBC,0xBE,0xBE,0xBF, \
(0239) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC7,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD1,0xD1,0xD3,0xD3,0xD5,0xD5,0xD7,0xD7,0xDD,0xD9,0xDA,0xDB,0xDC,0xDD,0xE0,0xDF, \
(0240) 				0xE0,0xE2,0xE2,0xE4,0xE4,0xE6,0xE6,0xE8,0xE8,0xEA,0xEA,0xEC,0xEC,0xEE,0xEE,0xEF,0xF0,0xF2,0xF2,0xF4,0xF4,0xF6,0xF6,0xF8,0xF8,0xFA,0xFA,0xFC,0xFC,0xFD,0xFE,0xFF}
(0241) 
(0242) #elif _CODE_PAGE == 857	/* Turkish (OEM) */
(0243) #define _DF1S	0
(0244) #define _EXCVT {0x80,0x9A,0x90,0xB6,0x8E,0xB7,0x8F,0x80,0xD2,0xD3,0xD4,0xD8,0xD7,0x98,0x8E,0x8F,0x90,0x92,0x92,0xE2,0x99,0xE3,0xEA,0xEB,0x98,0x99,0x9A,0x9D,0x9C,0x9D,0x9E,0x9E, \
(0245) 				0xB5,0xD6,0xE0,0xE9,0xA5,0xA5,0xA6,0xA6,0xA8,0xA9,0xAA,0xAB,0xAC,0x21,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0246) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC7,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0247) 				0xE0,0xE1,0xE2,0xE3,0xE5,0xE5,0xE6,0xE7,0xE8,0xE9,0xEA,0xEB,0xDE,0x59,0xEE,0xEF,0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}
(0248) 
(0249) #elif _CODE_PAGE == 858	/* Multilingual Latin 1 + Euro (OEM) */
(0250) #define _DF1S	0
(0251) #define _EXCVT {0x80,0x9A,0x90,0xB6,0x8E,0xB7,0x8F,0x80,0xD2,0xD3,0xD4,0xD8,0xD7,0xDE,0x8E,0x8F,0x90,0x92,0x92,0xE2,0x99,0xE3,0xEA,0xEB,0x59,0x99,0x9A,0x9D,0x9C,0x9D,0x9E,0x9F, \
(0252) 				0xB5,0xD6,0xE0,0xE9,0xA5,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0x21,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0253) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC7,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD1,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0254) 				0xE0,0xE1,0xE2,0xE3,0xE5,0xE5,0xE6,0xE7,0xE7,0xE9,0xEA,0xEB,0xED,0xED,0xEE,0xEF,0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}
(0255) 
(0256) #elif _CODE_PAGE == 862	/* Hebrew (OEM) */
(0257) #define _DF1S	0
(0258) #define _EXCVT {0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x9A,0x9B,0x9C,0x9D,0x9E,0x9F, \
(0259) 				0x41,0x49,0x4F,0x55,0xA5,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0x21,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0260) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0261) 				0xE0,0xE1,0xE2,0xE3,0xE4,0xE5,0xE6,0xE7,0xE8,0xE9,0xEA,0xEB,0xEC,0xED,0xEE,0xEF,0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}
(0262) 
(0263) #elif _CODE_PAGE == 866	/* Russian (OEM) */
(0264) #define _DF1S	0
(0265) #define _EXCVT {0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x9A,0x9B,0x9C,0x9D,0x9E,0x9F, \
(0266) 				0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0267) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0268) 				0x90,0x91,0x92,0x93,0x9d,0x95,0x96,0x97,0x98,0x99,0x9A,0x9B,0x9C,0x9D,0x9E,0x9F,0xF0,0xF0,0xF2,0xF2,0xF4,0xF4,0xF6,0xF6,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}
(0269) 
(0270) #elif _CODE_PAGE == 874	/* Thai (OEM, Windows) */
(0271) #define _DF1S	0
(0272) #define _EXCVT {0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x9A,0x9B,0x9C,0x9D,0x9E,0x9F, \
(0273) 				0xA0,0xA1,0xA2,0xA3,0xA4,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0274) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0275) 				0xE0,0xE1,0xE2,0xE3,0xE4,0xE5,0xE6,0xE7,0xE8,0xE9,0xEA,0xEB,0xEC,0xED,0xEE,0xEF,0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}
(0276) 
(0277) #elif _CODE_PAGE == 1250 /* Central Europe (Windows) */
(0278) #define _DF1S	0
(0279) #define _EXCVT {0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x8A,0x9B,0x8C,0x8D,0x8E,0x8F, \
(0280) 				0xA0,0xA1,0xA2,0xA3,0xA4,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xA3,0xB4,0xB5,0xB6,0xB7,0xB8,0xA5,0xAA,0xBB,0xBC,0xBD,0xBC,0xAF, \
(0281) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0282) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xF7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xFF}
(0283) 
(0284) #elif _CODE_PAGE == 1251 /* Cyrillic (Windows) */
(0285) #define _DF1S	0
(0286) #define _EXCVT {0x80,0x81,0x82,0x82,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x80,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x8A,0x9B,0x8C,0x8D,0x8E,0x8F, \
(0287) 				0xA0,0xA2,0xA2,0xA3,0xA4,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xB2,0xA5,0xB5,0xB6,0xB7,0xA8,0xB9,0xAA,0xBB,0xA3,0xBD,0xBD,0xAF, \
(0288) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0289) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF}
(0290) 
(0291) #elif _CODE_PAGE == 1252 /* Latin 1 (Windows) */
(0292) #define _DF1S	0
(0293) #define _EXCVT {0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0xAd,0x9B,0x8C,0x9D,0xAE,0x9F, \
(0294) 				0xA0,0x21,0xA2,0xA3,0xA4,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0295) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0296) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xF7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0x9F}
(0297) 
(0298) #elif _CODE_PAGE == 1253 /* Greek (Windows) */
(0299) #define _DF1S	0
(0300) #define _EXCVT {0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x9A,0x9B,0x9C,0x9D,0x9E,0x9F, \
(0301) 				0xA0,0xA1,0xA2,0xA3,0xA4,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0302) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xA2,0xB8,0xB9,0xBA, \
(0303) 				0xE0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xF2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xFB,0xBC,0xFD,0xBF,0xFF}
(0304) 
(0305) #elif _CODE_PAGE == 1254 /* Turkish (Windows) */
(0306) #define _DF1S	0
(0307) #define _EXCVT {0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x8A,0x9B,0x8C,0x9D,0x9E,0x9F, \
(0308) 				0xA0,0x21,0xA2,0xA3,0xA4,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0309) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0310) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xF7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0x9F}
(0311) 
(0312) #elif _CODE_PAGE == 1255 /* Hebrew (Windows) */
(0313) #define _DF1S	0
(0314) #define _EXCVT {0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x9A,0x9B,0x9C,0x9D,0x9E,0x9F, \
(0315) 				0xA0,0x21,0xA2,0xA3,0xA4,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0316) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0317) 				0xE0,0xE1,0xE2,0xE3,0xE4,0xE5,0xE6,0xE7,0xE8,0xE9,0xEA,0xEB,0xEC,0xED,0xEE,0xEF,0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}
(0318) 
(0319) #elif _CODE_PAGE == 1256 /* Arabic (Windows) */
(0320) #define _DF1S	0
(0321) #define _EXCVT {0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x9A,0x9B,0x8C,0x9D,0x9E,0x9F, \
(0322) 				0xA0,0xA1,0xA2,0xA3,0xA4,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0323) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0324) 				0x41,0xE1,0x41,0xE3,0xE4,0xE5,0xE6,0x43,0x45,0x45,0x45,0x45,0xEC,0xED,0x49,0x49,0xF0,0xF1,0xF2,0xF3,0x4F,0xF5,0xF6,0xF7,0xF8,0x55,0xFA,0x55,0x55,0xFD,0xFE,0xFF}
(0325) 
(0326) #elif _CODE_PAGE == 1257 /* Baltic (Windows) */
(0327) #define _DF1S	0
(0328) #define _EXCVT {0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x9A,0x9B,0x9C,0x9D,0x9E,0x9F, \
(0329) 				0xA0,0xA1,0xA2,0xA3,0xA4,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xA8,0xB9,0xAA,0xBB,0xBC,0xBD,0xBE,0xAF, \
(0330) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0331) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xF7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xFF}
(0332) 
(0333) #elif _CODE_PAGE == 1258 /* Vietnam (OEM, Windows) */
(0334) #define _DF1S	0
(0335) #define _EXCVT {0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x9A,0x9B,0xAC,0x9D,0x9E,0x9F, \
(0336) 				0xA0,0x21,0xA2,0xA3,0xA4,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0337) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0338) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xEC,0xCD,0xCE,0xCF,0xD0,0xD1,0xF2,0xD3,0xD4,0xD5,0xD6,0xF7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xFE,0x9F}
(0339) 
(0340) #elif _CODE_PAGE == 1	/* ASCII (for only non-LFN cfg) */
(0341) #if _USE_LFN
(0342) #error Cannot use LFN feature without valid code page.
(0343) #endif
(0344) #define _DF1S	0
(0345) 
(0346) #else
(0347) #error Unknown code page
(0348) 
(0349) #endif
(0350) 
(0351) 
(0352) /* Character code support macros */
(0353) #define IsUpper(c)	(((c)>='A')&&((c)<='Z'))
(0354) #define IsLower(c)	(((c)>='a')&&((c)<='z'))
(0355) #define IsDigit(c)	(((c)>='0')&&((c)<='9'))
(0356) 
(0357) #if _DF1S		/* Code page is DBCS */
(0358) 
(0359) #ifdef _DF2S	/* Two 1st byte areas */
(0360) #define IsDBCS1(c)	(((BYTE)(c) >= _DF1S && (BYTE)(c) <= _DF1E) || ((BYTE)(c) >= _DF2S && (BYTE)(c) <= _DF2E))
(0361) #else			/* One 1st byte area */
(0362) #define IsDBCS1(c)	((BYTE)(c) >= _DF1S && (BYTE)(c) <= _DF1E)
(0363) #endif
(0364) 
(0365) #ifdef _DS3S	/* Three 2nd byte areas */
(0366) #define IsDBCS2(c)	(((BYTE)(c) >= _DS1S && (BYTE)(c) <= _DS1E) || ((BYTE)(c) >= _DS2S && (BYTE)(c) <= _DS2E) || ((BYTE)(c) >= _DS3S && (BYTE)(c) <= _DS3E))
(0367) #else			/* Two 2nd byte areas */
(0368) #define IsDBCS2(c)	(((BYTE)(c) >= _DS1S && (BYTE)(c) <= _DS1E) || ((BYTE)(c) >= _DS2S && (BYTE)(c) <= _DS2E))
(0369) #endif
(0370) 
(0371) #else			/* Code page is SBCS */
(0372) 
(0373) #define IsDBCS1(c)	0
(0374) #define IsDBCS2(c)	0
(0375) 
(0376) #endif /* _DF1S */
(0377) 
(0378) 
(0379) /* Name status flags */
(0380) #define NS			11		/* Index of name status byte in fn[] */
(0381) #define NS_LOSS		0x01	/* Out of 8.3 format */
(0382) #define NS_LFN		0x02	/* Force to create LFN entry */
(0383) #define NS_LAST		0x04	/* Last segment */
(0384) #define NS_BODY		0x08	/* Lower case flag (body) */
(0385) #define NS_EXT		0x10	/* Lower case flag (ext) */
(0386) #define NS_DOT		0x20	/* Dot entry */
(0387) 
(0388) 
(0389) /* FAT sub-type boundaries */
(0390) /* Note that the FAT spec by Microsoft says 4085 but Windows works with 4087! */
(0391) #define MIN_FAT16	4086	/* Minimum number of clusters for FAT16 */
(0392) #define	MIN_FAT32	65526	/* Minimum number of clusters for FAT32 */
(0393) 
(0394) 
(0395) /* FatFs refers the members in the FAT structures as byte array instead of
(0396) / structure member because the structure is not binary compatible between
(0397) / different platforms */
(0398) 
(0399) #define BS_jmpBoot			0	/* Jump instruction (3) */
(0400) #define BS_OEMName			3	/* OEM name (8) */
(0401) #define BPB_BytsPerSec		11	/* Sector size [byte] (2) */
(0402) #define BPB_SecPerClus		13	/* Cluster size [sector] (1) */
(0403) #define BPB_RsvdSecCnt		14	/* Size of reserved area [sector] (2) */
(0404) #define BPB_NumFATs			16	/* Number of FAT copies (1) */
(0405) #define BPB_RootEntCnt		17	/* Number of root dir entries for FAT12/16 (2) */
(0406) #define BPB_TotSec16		19	/* Volume size [sector] (2) */
(0407) #define BPB_Media			21	/* Media descriptor (1) */
(0408) #define BPB_FATSz16			22	/* FAT size [sector] (2) */
(0409) #define BPB_SecPerTrk		24	/* Track size [sector] (2) */
(0410) #define BPB_NumHeads		26	/* Number of heads (2) */
(0411) #define BPB_HiddSec			28	/* Number of special hidden sectors (4) */
(0412) #define BPB_TotSec32		32	/* Volume size [sector] (4) */
(0413) #define BS_DrvNum			36	/* Physical drive number (2) */
(0414) #define BS_BootSig			38	/* Extended boot signature (1) */
(0415) #define BS_VolID			39	/* Volume serial number (4) */
(0416) #define BS_VolLab			43	/* Volume label (8) */
(0417) #define BS_FilSysType		54	/* File system type (1) */
(0418) #define BPB_FATSz32			36	/* FAT size [sector] (4) */
(0419) #define BPB_ExtFlags		40	/* Extended flags (2) */
(0420) #define BPB_FSVer			42	/* File system version (2) */
(0421) #define BPB_RootClus		44	/* Root dir first cluster (4) */
(0422) #define BPB_FSInfo			48	/* Offset of FSInfo sector (2) */
(0423) #define BPB_BkBootSec		50	/* Offset of backup boot sectot (2) */
(0424) #define BS_DrvNum32			64	/* Physical drive number (2) */
(0425) #define BS_BootSig32		66	/* Extended boot signature (1) */
(0426) #define BS_VolID32			67	/* Volume serial number (4) */
(0427) #define BS_VolLab32			71	/* Volume label (8) */
(0428) #define BS_FilSysType32		82	/* File system type (1) */
(0429) #define	FSI_LeadSig			0	/* FSI: Leading signature (4) */
(0430) #define	FSI_StrucSig		484	/* FSI: Structure signature (4) */
(0431) #define	FSI_Free_Count		488	/* FSI: Number of free clusters (4) */
(0432) #define	FSI_Nxt_Free		492	/* FSI: Last allocated cluster (4) */
(0433) #define MBR_Table			446	/* MBR: Partition table offset (2) */
(0434) #define	SZ_PTE				16	/* MBR: Size of a partition table entry */
(0435) #define BS_55AA				510	/* Boot sector signature (2) */
(0436) 
(0437) #define	DIR_Name			0	/* Short file name (11) */
(0438) #define	DIR_Attr			11	/* Attribute (1) */
(0439) #define	DIR_NTres			12	/* NT flag (1) */
(0440) #define	DIR_CrtTime			14	/* Created time (2) */
(0441) #define	DIR_CrtDate			16	/* Created date (2) */
(0442) #define	DIR_FstClusHI		20	/* Higher 16-bit of first cluster (2) */
(0443) #define	DIR_WrtTime			22	/* Modified time (2) */
(0444) #define	DIR_WrtDate			24	/* Modified date (2) */
(0445) #define	DIR_FstClusLO		26	/* Lower 16-bit of first cluster (2) */
(0446) #define	DIR_FileSize		28	/* File size (4) */
(0447) #define	LDIR_Ord			0	/* LFN entry order and LLE flag (1) */
(0448) #define	LDIR_Attr			11	/* LFN attribute (1) */
(0449) #define	LDIR_Type			12	/* LFN type (1) */
(0450) #define	LDIR_Chksum			13	/* Sum of corresponding SFN entry */
(0451) #define	LDIR_FstClusLO		26	/* Filled by zero (0) */
(0452) #define	SZ_DIR				32		/* Size of a directory entry */
(0453) #define	LLE					0x40	/* Last long entry flag in LDIR_Ord */
(0454) #define	DDE					0xE5	/* Deleted directory enrty mark in DIR_Name[0] */
(0455) #define	NDDE				0x05	/* Replacement of a character collides with DDE */
(0456) 
(0457) 
(0458) /*------------------------------------------------------------*/
(0459) /* Module private work area                                   */
(0460) /*------------------------------------------------------------*/
(0461) /* Note that uninitialized variables with static duration are
(0462) /  zeroed/nulled at start-up. If not, the compiler or start-up
(0463) /  routine is out of ANSI-C standard.
(0464) */
(0465) 
(0466) #if _VOLUMES
(0467) static
(0468) FATFS *FatFs[_VOLUMES];	/* Pointer to the file system objects (logical drives) */
(0469) #else
(0470) #error Number of volumes must not be 0.
(0471) #endif
(0472) 
(0473) static
(0474) WORD Fsid;				/* File system mount ID */
(0475) 
(0476) #if _FS_RPATH
(0477) static
(0478) BYTE CurrVol;			/* Current drive */
(0479) #endif
(0480) 
(0481) #if _FS_SHARE
(0482) static
(0483) FILESEM	Files[_FS_SHARE];	/* File lock semaphores */
(0484) #endif
(0485) 
(0486) #if _USE_LFN == 0			/* No LFN feature */
(0487) #define	DEF_NAMEBUF			BYTE sfn[12]
(0488) #define INIT_BUF(dobj)		(dobj).fn = sfn
(0489) #define	FREE_BUF()
(0490) 
(0491) #elif _USE_LFN == 1			/* LFN feature with static working buffer */
(0492) static WCHAR LfnBuf[_MAX_LFN+1];
(0493) #define	DEF_NAMEBUF			BYTE sfn[12]
(0494) #define INIT_BUF(dobj)		{ (dobj).fn = sfn; (dobj).lfn = LfnBuf; }
(0495) #define	FREE_BUF()
(0496) 
(0497) #elif _USE_LFN == 2 		/* LFN feature with dynamic working buffer on the stack */
(0498) #define	DEF_NAMEBUF			BYTE sfn[12]; WCHAR lbuf[_MAX_LFN+1]
(0499) #define INIT_BUF(dobj)		{ (dobj).fn = sfn; (dobj).lfn = lbuf; }
(0500) #define	FREE_BUF()
(0501) 
(0502) #elif _USE_LFN == 3 		/* LFN feature with dynamic working buffer on the heap */
(0503) #define	DEF_NAMEBUF			BYTE sfn[12]; WCHAR *lfn
(0504) #define INIT_BUF(dobj)		{ lfn = ff_memalloc((_MAX_LFN + 1) * 2); \
(0505) 							  if (!lfn) LEAVE_FF((dobj).fs, FR_NOT_ENOUGH_CORE); \
(0506) 							  (dobj).lfn = lfn;	(dobj).fn = sfn; }
(0507) #define	FREE_BUF()			ff_memfree(lfn)
(0508) 
(0509) #else
(0510) #error Wrong LFN configuration.
(0511) #endif
(0512) 
(0513) 
(0514) 
(0515) 
(0516) /*--------------------------------------------------------------------------
(0517) 
(0518)    Module Private Functions
(0519) 
(0520) ---------------------------------------------------------------------------*/
(0521) 
(0522) 
(0523) /*-----------------------------------------------------------------------*/
(0524) /* String functions                                                      */
(0525) /*-----------------------------------------------------------------------*/
(0526) 
(0527) /* Copy memory to memory */
(0528) static
(0529) void mem_cpy (void* dst, const void* src, UINT cnt) {
(0530) 	BYTE *d = (BYTE*)dst;
    00422 0158      MOVW	R10,R16
(0531) 	const BYTE *s = (const BYTE*)src;
    00423 0169      MOVW	R12,R18
    00424 C006      RJMP	0x042B
(0532) 
(0533) #if _WORD_ACCESS == 1
(0534) 	while (cnt >= sizeof(int)) {
(0535) 		*(int*)d = *(int*)s;
(0536) 		d += sizeof(int); s += sizeof(int);
(0537) 		cnt -= sizeof(int);
(0538) 	}
(0539) #endif
(0540) 	while (cnt--)
(0541) 		*d++ = *s++;
    00425 01F6      MOVW	R30,R12
    00426 01D5      MOVW	R26,R10
    00427 9001      LD	R0,Z+
    00428 016F      MOVW	R12,R30
    00429 920D      ST	X+,R0
    0042A 015D      MOVW	R10,R26
    0042B 011A      MOVW	R2,R20
    0042C 5041      SUBI	R20,1
    0042D 4050      SBCI	R21,0
    0042E 2022      TST	R2
    0042F F7A9      BNE	0x0425
    00430 2033      TST	R3
    00431 F799      BNE	0x0425
    00432 940C 4B3B JMP	pop_xgset303C
ff.c:mem_set:
  d                    --> R10
  cnt                  --> R20
  val                  --> R18
  dst                  --> R16
    00434 940E 4B12 CALL	push_xgset300C
    00436 814C      LDD	R20,Y+4
    00437 815D      LDD	R21,Y+5
(0542) }
(0543) 
(0544) /* Fill memory */
(0545) static
(0546) void mem_set (void* dst, int val, UINT cnt) {
(0547) 	BYTE *d = (BYTE*)dst;
    00438 0158      MOVW	R10,R16
    00439 C003      RJMP	0x043D
(0548) 
(0549) 	while (cnt--)
(0550) 		*d++ = (BYTE)val;
    0043A 01F5      MOVW	R30,R10
    0043B 9321      ST	Z+,R18
    0043C 015F      MOVW	R10,R30
    0043D 011A      MOVW	R2,R20
    0043E 5041      SUBI	R20,1
    0043F 4050      SBCI	R21,0
    00440 2022      TST	R2
    00441 F7C1      BNE	0x043A
    00442 2033      TST	R3
    00443 F7B1      BNE	0x043A
    00444 940C 4B17 JMP	pop_xgset300C
ff.c:mem_cmp:
  s                    --> R14
  d                    --> R12
  r                    --> R10
  cnt                  --> R20
  src                  --> R18
  dst                  --> R16
    00446 940E 4B09 CALL	push_xgset30FC
    00448 8548      LDD	R20,Y+8
    00449 8559      LDD	R21,Y+9
(0551) }
(0552) 
(0553) /* Compare memory to memory */
(0554) static
(0555) int mem_cmp (const void* dst, const void* src, UINT cnt) {
(0556) 	const BYTE *d = (const BYTE *)dst, *s = (const BYTE *)src;
    0044A 0168      MOVW	R12,R16
    0044B 0179      MOVW	R14,R18
(0557) 	int r = 0;
    0044C 24AA      CLR	R10
    0044D 24BB      CLR	R11
(0558) 
(0559) 	while (cnt-- && (r = *d++ - *s++) == 0) ;
    0044E 011A      MOVW	R2,R20
    0044F 5041      SUBI	R20,1
    00450 4050      SBCI	R21,0
    00451 2022      TST	R2
    00452 F411      BNE	0x0455
    00453 2033      TST	R3
    00454 F079      BEQ	0x0464
    00455 01F7      MOVW	R30,R14
    00456 9021      LD	R2,Z+
    00457 017F      MOVW	R14,R30
    00458 2433      CLR	R3
    00459 01F6      MOVW	R30,R12
    0045A 9041      LD	R4,Z+
    0045B 016F      MOVW	R12,R30
    0045C 2455      CLR	R5
    0045D 1842      SUB	R4,R2
    0045E 0853      SBC	R5,R3
    0045F 0152      MOVW	R10,R4
    00460 20AA      TST	R10
    00461 F411      BNE	0x0464
    00462 20BB      TST	R11
    00463 F351      BEQ	0x044E
(0560) 	return r;
    00464 0185      MOVW	R16,R10
    00465 940C 4AF3 JMP	pop_xgset30FC
(0561) }
(0562) 
(0563) /* Check if chr is contained in the string */
(0564) static
(0565) int chk_chr (const char* str, int chr) {
ff.c:chk_chr:
  chr                  --> R18
  str                  --> R16
    00467 C002      RJMP	0x046A
(0566) 	while (*str && *str != chr) str++;
    00468 5F0F      SUBI	R16,0xFF
    00469 4F1F      SBCI	R17,0xFF
    0046A 01F8      MOVW	R30,R16
    0046B 8020      LD	R2,Z
    0046C 2433      CLR	R3
    0046D 2022      TST	R2
    0046E F021      BEQ	0x0473
    0046F 2433      CLR	R3
    00470 1622      CP	R2,R18
    00471 0633      CPC	R3,R19
    00472 F7A9      BNE	0x0468
(0567) 	return *str;
    00473 01F8      MOVW	R30,R16
    00474 8100      LD	R16,Z
    00475 2711      CLR	R17
    00476 9508      RET
ff.c:move_window:
  nf                   --> R10
  wsect                --> Y,+5
  sector               --> Y,+13
  fs                   --> R20
    00477 933A      ST	-Y,R19
    00478 932A      ST	-Y,R18
    00479 940E 4B12 CALL	push_xgset300C
    0047B 01A8      MOVW	R20,R16
    0047C 9729      SBIW	R28,0x9
(0568) }
(0569) 
(0570) 
(0571) 
(0572) /*-----------------------------------------------------------------------*/
(0573) /* Request/Release grant to access the volume                            */
(0574) /*-----------------------------------------------------------------------*/
(0575) #if _FS_REENTRANT
(0576) 
(0577) static
(0578) int lock_fs (
(0579) 	FATFS *fs		/* File system object */
(0580) )
(0581) {
(0582) 	return ff_req_grant(fs->sobj);
(0583) }
(0584) 
(0585) 
(0586) static
(0587) void unlock_fs (
(0588) 	FATFS *fs,		/* File system object */
(0589) 	FRESULT res		/* Result code to be returned */
(0590) )
(0591) {
(0592) 	if (res != FR_NOT_ENABLED &&
(0593) 		res != FR_INVALID_DRIVE &&
(0594) 		res != FR_INVALID_OBJECT &&
(0595) 		res != FR_TIMEOUT) {
(0596) 		ff_rel_grant(fs->sobj);
(0597) 	}
(0598) }
(0599) #endif
(0600) 
(0601) 
(0602) 
(0603) /*-----------------------------------------------------------------------*/
(0604) /* File shareing control functions                                       */
(0605) /*-----------------------------------------------------------------------*/
(0606) #if _FS_SHARE
(0607) 
(0608) static
(0609) FRESULT chk_lock (	/* Check if the file can be accessed */
(0610) 	DIR* dj,		/* Directory object pointing the file to be checked */
(0611) 	int acc			/* Desired access (0:Read, 1:Write, 2:Delete/Rename) */
(0612) )
(0613) {
(0614) 	UINT i, be;
(0615) 
(0616) 	/* Search file semaphore table */
(0617) 	for (i = be = 0; i < _FS_SHARE; i++) {
(0618) 		if (Files[i].fs) {	/* Existing entry */
(0619) 			if (Files[i].fs == dj->fs &&	 	/* Check if the file matched with an open file */
(0620) 				Files[i].clu == dj->sclust &&
(0621) 				Files[i].idx == dj->index) break;
(0622) 		} else {			/* Blank entry */
(0623) 			be++;
(0624) 		}
(0625) 	}
(0626) 	if (i == _FS_SHARE)	/* The file is not opened */
(0627) 		return (be || acc == 2) ? FR_OK : FR_TOO_MANY_OPEN_FILES;	/* Is there a blank entry for new file? */
(0628) 
(0629) 	/* The file has been opened. Reject any open against writing file and all write mode open */
(0630) 	return (acc || Files[i].ctr == 0x100) ? FR_LOCKED : FR_OK;
(0631) }
(0632) 
(0633) 
(0634) static
(0635) int enq_lock (void)	/* Check if an entry is available for a new file */
(0636) {
(0637) 	UINT i;
(0638) 
(0639) 	for (i = 0; i < _FS_SHARE && Files[i].fs; i++) ;
(0640) 	return (i == _FS_SHARE) ? 0 : 1;
(0641) }
(0642) 
(0643) 
(0644) static
(0645) UINT inc_lock (	/* Increment file open counter and returns its index (0:int error) */
(0646) 	DIR* dj,	/* Directory object pointing the file to register or increment */
(0647) 	int acc		/* Desired access mode (0:Read, !0:Write) */
(0648) )
(0649) {
(0650) 	UINT i;
(0651) 
(0652) 
(0653) 	for (i = 0; i < _FS_SHARE; i++) {	/* Find the file */
(0654) 		if (Files[i].fs == dj->fs &&
(0655) 			Files[i].clu == dj->sclust &&
(0656) 			Files[i].idx == dj->index) break;
(0657) 	}
(0658) 
(0659) 	if (i == _FS_SHARE) {				/* Not opened. Register it as new. */
(0660) 		for (i = 0; i < _FS_SHARE && Files[i].fs; i++) ;
(0661) 		if (i == _FS_SHARE) return 0;	/* No space to register (int err) */
(0662) 		Files[i].fs = dj->fs;
(0663) 		Files[i].clu = dj->sclust;
(0664) 		Files[i].idx = dj->index;
(0665) 		Files[i].ctr = 0;
(0666) 	}
(0667) 
(0668) 	if (acc && Files[i].ctr) return 0;	/* Access violation (int err) */
(0669) 
(0670) 	Files[i].ctr = acc ? 0x100 : Files[i].ctr + 1;	/* Set semaphore value */
(0671) 
(0672) 	return i + 1;
(0673) }
(0674) 
(0675) 
(0676) static
(0677) FRESULT dec_lock (	/* Decrement file open counter */
(0678) 	UINT i			/* Semaphore index */
(0679) )
(0680) {
(0681) 	WORD n;
(0682) 	FRESULT res;
(0683) 
(0684) 
(0685) 	if (--i < _FS_SHARE) {
(0686) 		n = Files[i].ctr;
(0687) 		if (n == 0x100) n = 0;
(0688) 		if (n) n--;
(0689) 		Files[i].ctr = n;
(0690) 		if (!n) Files[i].fs = 0;
(0691) 		res = FR_OK;
(0692) 	} else {
(0693) 		res = FR_INT_ERR;
(0694) 	}
(0695) 	return res;
(0696) }
(0697) 
(0698) 
(0699) static
(0700) void clear_lock (	/* Clear lock entries of the volume */
(0701) 	FATFS *fs
(0702) )
(0703) {
(0704) 	UINT i;
(0705) 
(0706) 	for (i = 0; i < _FS_SHARE; i++) {
(0707) 		if (Files[i].fs == fs) Files[i].fs = 0;
(0708) 	}
(0709) }
(0710) #endif
(0711) 
(0712) 
(0713) 
(0714) /*-----------------------------------------------------------------------*/
(0715) /* Change window offset                                                  */
(0716) /*-----------------------------------------------------------------------*/
(0717) 
(0718) static
(0719) FRESULT move_window (
(0720) 	FATFS *fs,		/* File system object */
(0721) 	DWORD sector	/* Sector number to make appearance in the fs->win[] */
(0722) )					/* Move to zero only writes back dirty window */
(0723) {
(0724) 	DWORD wsect;
(0725) 
(0726) 
(0727) 	wsect = fs->winsect;
    0047D 01FA      MOVW	R30,R20
    0047E 96BA      ADIW	R30,0x2A
    0047F 8020      LD	R2,Z
    00480 8031      LDD	R3,Z+1
    00481 8042      LDD	R4,Z+2
    00482 8053      LDD	R5,Z+3
    00483 822D      STD	Y+5,R2
    00484 823E      STD	Y+6,R3
    00485 824F      STD	Y+7,R4
    00486 8658      STD	Y+8,R5
(0728) 	if (wsect != sector) {	/* Changed current window */
    00487 842D      LDD	R2,Y+13
    00488 843E      LDD	R3,Y+14
    00489 844F      LDD	R4,Y+15
    0048A 8858      LDD	R5,Y+16
    0048B 806D      LDD	R6,Y+5
    0048C 807E      LDD	R7,Y+6
    0048D 808F      LDD	R8,Y+7
    0048E 8498      LDD	R9,Y+8
    0048F 1462      CP	R6,R2
    00490 0473      CPC	R7,R3
    00491 0484      CPC	R8,R4
    00492 0495      CPC	R9,R5
    00493 F409      BNE	0x0495
    00494 C07E      RJMP	0x0513
(0729) #if !_FS_READONLY
(0730) 		if (fs->wflag) {	/* Write back dirty window if needed */
    00495 01FA      MOVW	R30,R20
    00496 8024      LDD	R2,Z+4
    00497 2022      TST	R2
    00498 F409      BNE	0x049A
    00499 C055      RJMP	0x04EF
(0731) 			if (disk_write(fs->drv, fs->win, wsect, 1) != RES_OK)
    0049A E081      LDI	R24,1
    0049B 838C      STD	Y+4,R24
    0049C 0113      MOVW	R2,R6
    0049D 0124      MOVW	R4,R8
    0049E 8228      ST	Y,R2
    0049F 8239      STD	Y+1,R3
    004A0 824A      STD	Y+2,R4
    004A1 825B      STD	Y+3,R5
    004A2 019A      MOVW	R18,R20
    004A3 5D22      SUBI	R18,0xD2
    004A4 4F3F      SBCI	R19,0xFF
    004A5 8101      LDD	R16,Z+1
    004A6 940E 03FC CALL	_disk_write
    004A8 2300      TST	R16
    004A9 F011      BEQ	0x04AC
(0732) 				return FR_DISK_ERR;
    004AA E001      LDI	R16,1
    004AB C068      RJMP	0x0514
(0733) 			fs->wflag = 0;
    004AC 2422      CLR	R2
    004AD 01FA      MOVW	R30,R20
    004AE 8224      STD	Z+4,R2
(0734) 			if (wsect < (fs->fatbase + fs->fsize)) {	/* In FAT area */
    004AF 8C22      LDD	R2,Z+26
    004B0 8C33      LDD	R3,Z+27
    004B1 8C44      LDD	R4,Z+28
    004B2 8C55      LDD	R5,Z+29
    004B3 967E      ADIW	R30,0x1E
    004B4 8060      LD	R6,Z
    004B5 8071      LDD	R7,Z+1
    004B6 8082      LDD	R8,Z+2
    004B7 8093      LDD	R9,Z+3
    004B8 0C62      ADD	R6,R2
    004B9 1C73      ADC	R7,R3
    004BA 1C84      ADC	R8,R4
    004BB 1C95      ADC	R9,R5
    004BC 802D      LDD	R2,Y+5
    004BD 803E      LDD	R3,Y+6
    004BE 804F      LDD	R4,Y+7
    004BF 8458      LDD	R5,Y+8
    004C0 1426      CP	R2,R6
    004C1 0437      CPC	R3,R7
    004C2 0448      CPC	R4,R8
    004C3 0459      CPC	R5,R9
    004C4 F550      BCC	0x04EF
(0735) 				BYTE nf;
(0736) 				for (nf = fs->n_fats; nf > 1; nf--) {	/* Reflect the change to all FAT copies */
    004C5 01FA      MOVW	R30,R20
    004C6 80A3      LDD	R10,Z+3
    004C7 C024      RJMP	0x04EC
(0737) 					wsect += fs->fsize;
    004C8 01FA      MOVW	R30,R20
    004C9 967A      ADIW	R30,0x1A
    004CA 8020      LD	R2,Z
    004CB 8031      LDD	R3,Z+1
    004CC 8042      LDD	R4,Z+2
    004CD 8053      LDD	R5,Z+3
    004CE 806D      LDD	R6,Y+5
    004CF 807E      LDD	R7,Y+6
    004D0 808F      LDD	R8,Y+7
    004D1 8498      LDD	R9,Y+8
    004D2 0C62      ADD	R6,R2
    004D3 1C73      ADC	R7,R3
    004D4 1C84      ADC	R8,R4
    004D5 1C95      ADC	R9,R5
    004D6 826D      STD	Y+5,R6
    004D7 827E      STD	Y+6,R7
    004D8 828F      STD	Y+7,R8
    004D9 8698      STD	Y+8,R9
(0738) 					disk_write(fs->drv, fs->win, wsect, 1);
    004DA E081      LDI	R24,1
    004DB 838C      STD	Y+4,R24
    004DC 802D      LDD	R2,Y+5
    004DD 803E      LDD	R3,Y+6
    004DE 804F      LDD	R4,Y+7
    004DF 8458      LDD	R5,Y+8
    004E0 8228      ST	Y,R2
    004E1 8239      STD	Y+1,R3
    004E2 824A      STD	Y+2,R4
    004E3 825B      STD	Y+3,R5
    004E4 019A      MOVW	R18,R20
    004E5 5D22      SUBI	R18,0xD2
    004E6 4F3F      SBCI	R19,0xFF
    004E7 01FA      MOVW	R30,R20
    004E8 8101      LDD	R16,Z+1
    004E9 940E 03FC CALL	_disk_write
    004EB 94AA      DEC	R10
    004EC E081      LDI	R24,1
    004ED 158A      CP	R24,R10
    004EE F2C8      BCS	0x04C8
(0739) 				}
(0740) 			}
(0741) 		}
(0742) #endif
(0743) 		if (sector) {
    004EF 842D      LDD	R2,Y+13
    004F0 843E      LDD	R3,Y+14
    004F1 844F      LDD	R4,Y+15
    004F2 8858      LDD	R5,Y+16
    004F3 9488      BCLR	0
    004F4 2022      TST	R2
    004F5 0432      CPC	R3,R2
    004F6 0442      CPC	R4,R2
    004F7 0452      CPC	R5,R2
    004F8 F0D1      BEQ	0x0513
(0744) 			if (disk_read(fs->drv, fs->win, sector, 1) != RES_OK)
    004F9 E081      LDI	R24,1
    004FA 838C      STD	Y+4,R24
    004FB 8228      ST	Y,R2
    004FC 8239      STD	Y+1,R3
    004FD 824A      STD	Y+2,R4
    004FE 825B      STD	Y+3,R5
    004FF 019A      MOVW	R18,R20
    00500 5D22      SUBI	R18,0xD2
    00501 4F3F      SBCI	R19,0xFF
    00502 01FA      MOVW	R30,R20
    00503 8101      LDD	R16,Z+1
    00504 940E 03DC CALL	_disk_read
    00506 2300      TST	R16
    00507 F011      BEQ	0x050A
(0745) 				return FR_DISK_ERR;
    00508 E001      LDI	R16,1
    00509 C00A      RJMP	0x0514
(0746) 			fs->winsect = sector;
    0050A 842D      LDD	R2,Y+13
    0050B 843E      LDD	R3,Y+14
    0050C 844F      LDD	R4,Y+15
    0050D 8858      LDD	R5,Y+16
    0050E 01FA      MOVW	R30,R20
    0050F A622      STD	Z+42,R2
    00510 A633      STD	Z+43,R3
    00511 A644      STD	Z+44,R4
    00512 A655      STD	Z+45,R5
(0747) 		}
(0748) 	}
(0749) 
(0750) 	return FR_OK;
    00513 2700      CLR	R16
    00514 9629      ADIW	R28,0x9
    00515 940E 4B17 CALL	pop_xgset300C
    00517 9622      ADIW	R28,2
    00518 9508      RET
ff.c:sync:
  res                  --> R20
  fs                   --> R22
    00519 940E 4B1C CALL	push_xgsetF000
    0051B 01B8      MOVW	R22,R16
    0051C 9725      SBIW	R28,5
(0751) }
(0752) 
(0753) 
(0754) 
(0755) 
(0756) /*-----------------------------------------------------------------------*/
(0757) /* Clean-up cached data                                                  */
(0758) /*-----------------------------------------------------------------------*/
(0759) #if !_FS_READONLY
(0760) static
(0761) FRESULT sync (	/* FR_OK: successful, FR_DISK_ERR: failed */
(0762) 	FATFS *fs	/* File system object */
(0763) )
(0764) {
(0765) 	FRESULT res;
(0766) 
(0767) 
(0768) 	res = move_window(fs, 0);
    0051D E080      LDI	R24,0
    0051E E090      LDI	R25,0
    0051F E0A0      LDI	R26,0
    00520 E0B0      LDI	R27,0
    00521 83A8      ST	Y,R26
    00522 83B9      STD	Y+1,R27
    00523 019C      MOVW	R18,R24
    00524 018B      MOVW	R16,R22
    00525 DF51      RCALL	ff.c:move_window
    00526 2F40      MOV	R20,R16
(0769) 	if (res == FR_OK) {
    00527 2300      TST	R16
    00528 F009      BEQ	0x052A
    00529 C0C0      RJMP	0x05EA
(0770) 		/* Update FSInfo sector if needed */
(0771) 		if (fs->fs_type == FS_FAT32 && fs->fsi_flag) {
    0052A 01FB      MOVW	R30,R22
    0052B 8180      LD	R24,Z
    0052C 3083      CPI	R24,3
    0052D F009      BEQ	0x052F
    0052E C0AC      RJMP	0x05DB
    0052F 8025      LDD	R2,Z+5
    00530 2022      TST	R2
    00531 F409      BNE	0x0533
    00532 C0A8      RJMP	0x05DB
(0772) 			fs->winsect = 0;
    00533 96BA      ADIW	R30,0x2A
    00534 E080      LDI	R24,0
    00535 8380      ST	Z,R24
    00536 8381      STD	Z+1,R24
    00537 8382      STD	Z+2,R24
    00538 8383      STD	Z+3,R24
(0773) 			/* Create FSInfo structure */
(0774) 			mem_set(fs->win, 0, 512);
    00539 E080      LDI	R24,0
    0053A E092      LDI	R25,2
    0053B 8399      STD	Y+1,R25
    0053C 8388      ST	Y,R24
    0053D 2722      CLR	R18
    0053E 2733      CLR	R19
    0053F 018B      MOVW	R16,R22
    00540 5D02      SUBI	R16,0xD2
    00541 4F1F      SBCI	R17,0xFF
    00542 DEF1      RCALL	ff.c:mem_set
(0775) 			ST_WORD(fs->win+BS_55AA, 0xAA55);
    00543 E585      LDI	R24,0x55
    00544 01FB      MOVW	R30,R22
    00545 5DE4      SUBI	R30,0xD4
    00546 4FFD      SBCI	R31,0xFD
    00547 8380      ST	Z,R24
    00548 52EC      SUBI	R30,0x2C
    00549 40F2      SBCI	R31,2
    0054A EA8A      LDI	R24,0xAA
    0054B 5DE3      SUBI	R30,0xD3
    0054C 4FFD      SBCI	R31,0xFD
    0054D 8380      ST	Z,R24
    0054E 52ED      SUBI	R30,0x2D
    0054F 40F2      SBCI	R31,2
(0776) 			ST_DWORD(fs->win+FSI_LeadSig, 0x41615252);
    00550 E582      LDI	R24,0x52
    00551 A786      STD	Z+46,R24
    00552 A787      STD	Z+47,R24
    00553 E681      LDI	R24,0x61
    00554 AB80      STD	Z+48,R24
    00555 E481      LDI	R24,0x41
    00556 AB81      STD	Z+49,R24
(0777) 			ST_DWORD(fs->win+FSI_StrucSig, 0x61417272);
    00557 E782      LDI	R24,0x72
    00558 5EEE      SUBI	R30,0xEE
    00559 4FFD      SBCI	R31,0xFD
    0055A 8380      ST	Z,R24
    0055B 51E2      SUBI	R30,0x12
    0055C 40F2      SBCI	R31,2
    0055D 5EED      SUBI	R30,0xED
    0055E 4FFD      SBCI	R31,0xFD
    0055F 8380      ST	Z,R24
    00560 51E3      SUBI	R30,0x13
    00561 40F2      SBCI	R31,2
    00562 E481      LDI	R24,0x41
    00563 5EEC      SUBI	R30,0xEC
    00564 4FFD      SBCI	R31,0xFD
    00565 8380      ST	Z,R24
    00566 51E4      SUBI	R30,0x14
    00567 40F2      SBCI	R31,2
    00568 E681      LDI	R24,0x61
    00569 5EEB      SUBI	R30,0xEB
    0056A 4FFD      SBCI	R31,0xFD
    0056B 8380      ST	Z,R24
    0056C 51E5      SUBI	R30,0x15
    0056D 40F2      SBCI	R31,2
(0778) 			ST_DWORD(fs->win+FSI_Free_Count, fs->free_clust);
    0056E 8426      LDD	R2,Z+14
    0056F 8437      LDD	R3,Z+15
    00570 8840      LDD	R4,Z+16
    00571 8851      LDD	R5,Z+17
    00572 5EEA      SUBI	R30,0xEA
    00573 4FFD      SBCI	R31,0xFD
    00574 8220      ST	Z,R2
    00575 51E6      SUBI	R30,0x16
    00576 40F2      SBCI	R31,2
    00577 8426      LDD	R2,Z+14
    00578 8437      LDD	R3,Z+15
    00579 2C23      MOV	R2,R3
    0057A 2433      CLR	R3
    0057B 5EE9      SUBI	R30,0xE9
    0057C 4FFD      SBCI	R31,0xFD
    0057D 8220      ST	Z,R2
    0057E 51E7      SUBI	R30,0x17
    0057F 40F2      SBCI	R31,2
    00580 8426      LDD	R2,Z+14
    00581 8437      LDD	R3,Z+15
    00582 8840      LDD	R4,Z+16
    00583 8851      LDD	R5,Z+17
    00584 0112      MOVW	R2,R4
    00585 2444      CLR	R4
    00586 2455      CLR	R5
    00587 5EE8      SUBI	R30,0xE8
    00588 4FFD      SBCI	R31,0xFD
    00589 8220      ST	Z,R2
    0058A 51E8      SUBI	R30,0x18
    0058B 40F2      SBCI	R31,2
    0058C E188      LDI	R24,0x18
    0058D E090      LDI	R25,0
    0058E 8506      LDD	R16,Z+14
    0058F 8517      LDD	R17,Z+15
    00590 8920      LDD	R18,Z+16
    00591 8931      LDD	R19,Z+17
    00592 938A      ST	-Y,R24
    00593 940E 4BAB CALL	lsr32
    00595 01FB      MOVW	R30,R22
    00596 5EE7      SUBI	R30,0xE7
    00597 4FFD      SBCI	R31,0xFD
    00598 8300      ST	Z,R16
    00599 51E9      SUBI	R30,0x19
    0059A 40F2      SBCI	R31,2
(0779) 			ST_DWORD(fs->win+FSI_Nxt_Free, fs->last_clust);
    0059B 8422      LDD	R2,Z+10
    0059C 8433      LDD	R3,Z+11
    0059D 8444      LDD	R4,Z+12
    0059E 8455      LDD	R5,Z+13
    0059F 5EE6      SUBI	R30,0xE6
    005A0 4FFD      SBCI	R31,0xFD
    005A1 8220      ST	Z,R2
    005A2 51EA      SUBI	R30,0x1A
    005A3 40F2      SBCI	R31,2
    005A4 8422      LDD	R2,Z+10
    005A5 8433      LDD	R3,Z+11
    005A6 2C23      MOV	R2,R3
    005A7 2433      CLR	R3
    005A8 5EE5      SUBI	R30,0xE5
    005A9 4FFD      SBCI	R31,0xFD
    005AA 8220      ST	Z,R2
    005AB 51EB      SUBI	R30,0x1B
    005AC 40F2      SBCI	R31,2
    005AD 8422      LDD	R2,Z+10
    005AE 8433      LDD	R3,Z+11
    005AF 8444      LDD	R4,Z+12
    005B0 8455      LDD	R5,Z+13
    005B1 0112      MOVW	R2,R4
    005B2 2444      CLR	R4
    005B3 2455      CLR	R5
    005B4 5EE4      SUBI	R30,0xE4
    005B5 4FFD      SBCI	R31,0xFD
    005B6 8220      ST	Z,R2
    005B7 51EC      SUBI	R30,0x1C
    005B8 40F2      SBCI	R31,2
    005B9 E188      LDI	R24,0x18
    005BA E090      LDI	R25,0
    005BB 8502      LDD	R16,Z+10
    005BC 8513      LDD	R17,Z+11
    005BD 8524      LDD	R18,Z+12
    005BE 8535      LDD	R19,Z+13
    005BF 938A      ST	-Y,R24
    005C0 940E 4BAB CALL	lsr32
    005C2 01FB      MOVW	R30,R22
    005C3 5EE3      SUBI	R30,0xE3
    005C4 4FFD      SBCI	R31,0xFD
    005C5 8300      ST	Z,R16
    005C6 51ED      SUBI	R30,0x1D
    005C7 40F2      SBCI	R31,2
(0780) 			/* Write it into the FSInfo sector */
(0781) 			disk_write(fs->drv, fs->win, fs->fsi_sector, 1);
    005C8 E081      LDI	R24,1
    005C9 838C      STD	Y+4,R24
    005CA 8822      LDD	R2,Z+18
    005CB 8833      LDD	R3,Z+19
    005CC 8844      LDD	R4,Z+20
    005CD 8855      LDD	R5,Z+21
    005CE 8228      ST	Y,R2
    005CF 8239      STD	Y+1,R3
    005D0 824A      STD	Y+2,R4
    005D1 825B      STD	Y+3,R5
    005D2 019F      MOVW	R18,R30
    005D3 5D22      SUBI	R18,0xD2
    005D4 4F3F      SBCI	R19,0xFF
    005D5 8101      LDD	R16,Z+1
    005D6 940E 03FC CALL	_disk_write
(0782) 			fs->fsi_flag = 0;
    005D8 2422      CLR	R2
    005D9 01FB      MOVW	R30,R22
    005DA 8225      STD	Z+5,R2
(0783) 		}
(0784) 		/* Make sure that no pending write process in the physical drive */
(0785) 		if (disk_ioctl(fs->drv, CTRL_SYNC, 0) != RES_OK)
    005DB 2422      CLR	R2
    005DC 2433      CLR	R3
    005DD 8239      STD	Y+1,R3
    005DE 8228      ST	Y,R2
    005DF 2722      CLR	R18
    005E0 2733      CLR	R19
    005E1 01FB      MOVW	R30,R22
    005E2 8101      LDD	R16,Z+1
    005E3 2711      CLR	R17
    005E4 940E 0414 CALL	_disk_ioctl
    005E6 3000      CPI	R16,0
    005E7 0701      CPC	R16,R17
    005E8 F009      BEQ	0x05EA
(0786) 			res = FR_DISK_ERR;
    005E9 E041      LDI	R20,1
(0787) 	}
(0788) 
(0789) 	return res;
    005EA 2F04      MOV	R16,R20
    005EB 9625      ADIW	R28,5
    005EC 940C 4B21 JMP	pop_xgsetF000
_clust2sect:
  clst                 --> Y,+6
  fs                   --> R10
    005EE 933A      ST	-Y,R19
    005EF 932A      ST	-Y,R18
    005F0 940E 4B26 CALL	push_xgsetF00C
    005F2 0158      MOVW	R10,R16
(0790) }
(0791) #endif
(0792) 
(0793) 
(0794) 
(0795) 
(0796) /*-----------------------------------------------------------------------*/
(0797) /* Get sector# from cluster#                                             */
(0798) /*-----------------------------------------------------------------------*/
(0799) 
(0800) 
(0801) DWORD clust2sect (	/* !=0: Sector number, 0: Failed - invalid cluster# */
(0802) 	FATFS *fs,		/* File system object */
(0803) 	DWORD clst		/* Cluster# to be converted */
(0804) )
(0805) {
(0806) 	clst -= 2;
    005F3 E042      LDI	R20,2
    005F4 E050      LDI	R21,0
    005F5 E060      LDI	R22,0
    005F6 E070      LDI	R23,0
    005F7 802E      LDD	R2,Y+6
    005F8 803F      LDD	R3,Y+7
    005F9 8448      LDD	R4,Y+8
    005FA 8459      LDD	R5,Y+9
    005FB 1A24      SUB	R2,R20
    005FC 0A35      SBC	R3,R21
    005FD 0A46      SBC	R4,R22
    005FE 0A57      SBC	R5,R23
    005FF 822E      STD	Y+6,R2
    00600 823F      STD	Y+7,R3
    00601 8648      STD	Y+8,R4
    00602 8659      STD	Y+9,R5
(0807) 	if (clst >= (fs->n_fatent - 2)) return 0;		/* Invalid cluster# */
    00603 E042      LDI	R20,2
    00604 E050      LDI	R21,0
    00605 E060      LDI	R22,0
    00606 E070      LDI	R23,0
    00607 01F5      MOVW	R30,R10
    00608 9676      ADIW	R30,0x16
    00609 8020      LD	R2,Z
    0060A 8031      LDD	R3,Z+1
    0060B 8042      LDD	R4,Z+2
    0060C 8053      LDD	R5,Z+3
    0060D 1A24      SUB	R2,R20
    0060E 0A35      SBC	R3,R21
    0060F 0A46      SBC	R4,R22
    00610 0A57      SBC	R5,R23
    00611 806E      LDD	R6,Y+6
    00612 807F      LDD	R7,Y+7
    00613 8488      LDD	R8,Y+8
    00614 8499      LDD	R9,Y+9
    00615 1462      CP	R6,R2
    00616 0473      CPC	R7,R3
    00617 0484      CPC	R8,R4
    00618 0495      CPC	R9,R5
    00619 F028      BCS	0x061F
    0061A E000      LDI	R16,0
    0061B E010      LDI	R17,0
    0061C E020      LDI	R18,0
    0061D E030      LDI	R19,0
    0061E C01D      RJMP	0x063C
(0808) 	return clst * fs->csize + fs->database;
    0061F 01F5      MOVW	R30,R10
    00620 9632      ADIW	R30,2
    00621 8020      LD	R2,Z
    00622 2433      CLR	R3
    00623 2444      CLR	R4
    00624 2455      CLR	R5
    00625 810E      LDD	R16,Y+6
    00626 811F      LDD	R17,Y+7
    00627 8528      LDD	R18,Y+8
    00628 8539      LDD	R19,Y+9
    00629 925A      ST	-Y,R5
    0062A 924A      ST	-Y,R4
    0062B 923A      ST	-Y,R3
    0062C 922A      ST	-Y,R2
    0062D 940E 4AB3 CALL	empy32s|empy32u
    0062F 0118      MOVW	R2,R16
    00630 0129      MOVW	R4,R18
    00631 01F5      MOVW	R30,R10
    00632 A066      LDD	R6,Z+38
    00633 A077      LDD	R7,Z+39
    00634 A480      LDD	R8,Z+40
    00635 A491      LDD	R9,Z+41
    00636 0C26      ADD	R2,R6
    00637 1C37      ADC	R3,R7
    00638 1C48      ADC	R4,R8
    00639 1C59      ADC	R5,R9
    0063A 0181      MOVW	R16,R2
    0063B 0192      MOVW	R18,R4
    0063C 940E 4B2D CALL	pop_xgsetF00C
    0063E 9622      ADIW	R28,2
    0063F 9508      RET
_get_fat:
  wc                   --> R14
  p                    --> R10
  bc                   --> R10
  clst                 --> Y,+12
  fs                   --> R12
    00640 933A      ST	-Y,R19
    00641 932A      ST	-Y,R18
    00642 940E 4B07 CALL	push_xgsetF0FC
    00644 0168      MOVW	R12,R16
    00645 9722      SBIW	R28,2
(0809) }
(0810) 
(0811) 
(0812) 
(0813) 
(0814) /*-----------------------------------------------------------------------*/
(0815) /* FAT access - Read value of a FAT entry                                */
(0816) /*-----------------------------------------------------------------------*/
(0817) 
(0818) 
(0819) DWORD get_fat (	/* 0xFFFFFFFF:Disk error, 1:Internal error, Else:Cluster status */
(0820) 	FATFS *fs,	/* File system object */
(0821) 	DWORD clst	/* Cluster# to get the link information */
(0822) )
(0823) {
(0824) 	UINT wc, bc;
(0825) 	BYTE *p;
(0826) 
(0827) 
(0828) 	if (clst < 2 || clst >= fs->n_fatent)	/* Chack range */
    00646 E042      LDI	R20,2
    00647 E050      LDI	R21,0
    00648 E060      LDI	R22,0
    00649 E070      LDI	R23,0
    0064A 842C      LDD	R2,Y+12
    0064B 843D      LDD	R3,Y+13
    0064C 844E      LDD	R4,Y+14
    0064D 845F      LDD	R5,Y+15
    0064E 1624      CP	R2,R20
    0064F 0635      CPC	R3,R21
    00650 0646      CPC	R4,R22
    00651 0657      CPC	R5,R23
    00652 F078      BCS	0x0662
    00653 01F6      MOVW	R30,R12
    00654 9676      ADIW	R30,0x16
    00655 8020      LD	R2,Z
    00656 8031      LDD	R3,Z+1
    00657 8042      LDD	R4,Z+2
    00658 8053      LDD	R5,Z+3
    00659 846C      LDD	R6,Y+12
    0065A 847D      LDD	R7,Y+13
    0065B 848E      LDD	R8,Y+14
    0065C 849F      LDD	R9,Y+15
    0065D 1462      CP	R6,R2
    0065E 0473      CPC	R7,R3
    0065F 0484      CPC	R8,R4
    00660 0495      CPC	R9,R5
    00661 F028      BCS	0x0667
(0829) 		return 1;
    00662 E001      LDI	R16,1
    00663 E010      LDI	R17,0
    00664 E020      LDI	R18,0
    00665 E030      LDI	R19,0
    00666 C124      RJMP	0x078B
(0830) 
(0831) 	switch (fs->fs_type) {
    00667 01F6      MOVW	R30,R12
    00668 80A0      LD	R10,Z
    00669 24BB      CLR	R11
    0066A 01C5      MOVW	R24,R10
    0066B 3081      CPI	R24,1
    0066C E0E0      LDI	R30,0
    0066D 079E      CPC	R25,R30
    0066E F059      BEQ	0x067A
    0066F 3082      CPI	R24,2
    00670 E0E0      LDI	R30,0
    00671 079E      CPC	R25,R30
    00672 F409      BNE	0x0674
    00673 C06F      RJMP	0x06E3
    00674 3083      CPI	R24,3
    00675 E0E0      LDI	R30,0
    00676 079E      CPC	R25,R30
    00677 F409      BNE	0x0679
    00678 C0A6      RJMP	0x071F
    00679 C10D      RJMP	0x0787
(0832) 	case FS_FAT12 :
(0833) 		bc = (UINT)clst; bc += bc / 2;
    0067A 84AC      LDD	R10,Y+12
    0067B 84BD      LDD	R11,Y+13
    0067C 0115      MOVW	R2,R10
    0067D 9436      LSR	R3
    0067E 9427      ROR	R2
    0067F 0CA2      ADD	R10,R2
    00680 1CB3      ADC	R11,R3
(0834) 		if (move_window(fs, fs->fatbase + (bc / SS(fs)))) break;
    00681 E029      LDI	R18,0x9
    00682 E030      LDI	R19,0
    00683 0185      MOVW	R16,R10
    00684 940E 4BA4 CALL	lsr16
    00686 0118      MOVW	R2,R16
    00687 2444      CLR	R4
    00688 2455      CLR	R5
    00689 01F6      MOVW	R30,R12
    0068A 8C66      LDD	R6,Z+30
    0068B 8C77      LDD	R7,Z+31
    0068C A080      LDD	R8,Z+32
    0068D A091      LDD	R9,Z+33
    0068E 0C62      ADD	R6,R2
    0068F 1C73      ADC	R7,R3
    00690 1C84      ADC	R8,R4
    00691 1C95      ADC	R9,R5
    00692 8288      ST	Y,R8
    00693 8299      STD	Y+1,R9
    00694 0193      MOVW	R18,R6
    00695 018F      MOVW	R16,R30
    00696 DDE0      RCALL	ff.c:move_window
    00697 2300      TST	R16
    00698 F009      BEQ	0x069A
    00699 C0ED      RJMP	0x0787
(0835) 		wc = fs->win[bc % SS(fs)]; bc++;
    0069A 01C6      MOVW	R24,R12
    0069B 968E      ADIW	R24,0x2E
    0069C 01F5      MOVW	R30,R10
    0069D 70F1      ANDI	R31,1
    0069E 0FE8      ADD	R30,R24
    0069F 1FF9      ADC	R31,R25
    006A0 80E0      LD	R14,Z
    006A1 24FF      CLR	R15
    006A2 01C5      MOVW	R24,R10
    006A3 9601      ADIW	R24,1
    006A4 015C      MOVW	R10,R24
(0836) 		if (move_window(fs, fs->fatbase + (bc / SS(fs)))) break;
    006A5 E029      LDI	R18,0x9
    006A6 E030      LDI	R19,0
    006A7 018C      MOVW	R16,R24
    006A8 940E 4BA4 CALL	lsr16
    006AA 0118      MOVW	R2,R16
    006AB 2444      CLR	R4
    006AC 2455      CLR	R5
    006AD 01F6      MOVW	R30,R12
    006AE 8C66      LDD	R6,Z+30
    006AF 8C77      LDD	R7,Z+31
    006B0 A080      LDD	R8,Z+32
    006B1 A091      LDD	R9,Z+33
    006B2 0C62      ADD	R6,R2
    006B3 1C73      ADC	R7,R3
    006B4 1C84      ADC	R8,R4
    006B5 1C95      ADC	R9,R5
    006B6 8288      ST	Y,R8
    006B7 8299      STD	Y+1,R9
    006B8 0193      MOVW	R18,R6
    006B9 018F      MOVW	R16,R30
    006BA DDBC      RCALL	ff.c:move_window
    006BB 2300      TST	R16
    006BC F009      BEQ	0x06BE
    006BD C0C9      RJMP	0x0787
(0837) 		wc |= fs->win[bc % SS(fs)] << 8;
    006BE 01C6      MOVW	R24,R12
    006BF 968E      ADIW	R24,0x2E
    006C0 01F5      MOVW	R30,R10
    006C1 70F1      ANDI	R31,1
    006C2 0FE8      ADD	R30,R24
    006C3 1FF9      ADC	R31,R25
    006C4 8020      LD	R2,Z
    006C5 2433      CLR	R3
    006C6 2C32      MOV	R3,R2
    006C7 2422      CLR	R2
    006C8 28E2      OR	R14,R2
    006C9 28F3      OR	R15,R3
(0838) 		return (clst & 1) ? (wc >> 4) : (wc & 0xFFF);
    006CA 842C      LDD	R2,Y+12
    006CB 843D      LDD	R3,Y+13
    006CC 844E      LDD	R4,Y+14
    006CD 845F      LDD	R5,Y+15
    006CE 2DE2      MOV	R30,R2
    006CF 70E1      ANDI	R30,1
    006D0 F051      BEQ	0x06DB
    006D1 0157      MOVW	R10,R14
    006D2 94B6      LSR	R11
    006D3 94A7      ROR	R10
    006D4 94B6      LSR	R11
    006D5 94A7      ROR	R10
    006D6 94B6      LSR	R11
    006D7 94A7      ROR	R10
    006D8 94B6      LSR	R11
    006D9 94A7      ROR	R10
    006DA C003      RJMP	0x06DE
    006DB 01C7      MOVW	R24,R14
    006DC 709F      ANDI	R25,0xF
    006DD 015C      MOVW	R10,R24
    006DE 0185      MOVW	R16,R10
    006DF 0196      MOVW	R18,R12
    006E0 2722      CLR	R18
    006E1 2733      CLR	R19
    006E2 C0A8      RJMP	0x078B
(0839) 
(0840) 	case FS_FAT16 :
(0841) 		if (move_window(fs, fs->fatbase + (clst / (SS(fs) / 2)))) break;
    006E3 E088      LDI	R24,0x8
    006E4 E090      LDI	R25,0
    006E5 850C      LDD	R16,Y+12
    006E6 851D      LDD	R17,Y+13
    006E7 852E      LDD	R18,Y+14
    006E8 853F      LDD	R19,Y+15
    006E9 938A      ST	-Y,R24
    006EA 940E 4BAB CALL	lsr32
    006EC 01F6      MOVW	R30,R12
    006ED 8C26      LDD	R2,Z+30
    006EE 8C37      LDD	R3,Z+31
    006EF A040      LDD	R4,Z+32
    006F0 A051      LDD	R5,Z+33
    006F1 0E20      ADD	R2,R16
    006F2 1E31      ADC	R3,R17
    006F3 1E42      ADC	R4,R18
    006F4 1E53      ADC	R5,R19
    006F5 8248      ST	Y,R4
    006F6 8259      STD	Y+1,R5
    006F7 0191      MOVW	R18,R2
    006F8 018F      MOVW	R16,R30
    006F9 DD7D      RCALL	ff.c:move_window
    006FA 2EA0      MOV	R10,R16
    006FB 2300      TST	R16
    006FC F009      BEQ	0x06FE
    006FD C089      RJMP	0x0787
(0842) 		p = &fs->win[clst * 2 % SS(fs)];
    006FE EF4F      LDI	R20,0xFF
    006FF E051      LDI	R21,1
    00700 E060      LDI	R22,0
    00701 E070      LDI	R23,0
    00702 842C      LDD	R2,Y+12
    00703 843D      LDD	R3,Y+13
    00704 844E      LDD	R4,Y+14
    00705 845F      LDD	R5,Y+15
    00706 0C22      LSL	R2
    00707 1C33      ROL	R3
    00708 1C44      ROL	R4
    00709 1C55      ROL	R5
    0070A 2224      AND	R2,R20
    0070B 2235      AND	R3,R21
    0070C 2246      AND	R4,R22
    0070D 2257      AND	R5,R23
    0070E 0151      MOVW	R10,R2
    0070F 01C6      MOVW	R24,R12
    00710 968E      ADIW	R24,0x2E
    00711 0EA8      ADD	R10,R24
    00712 1EB9      ADC	R11,R25
(0843) 		return LD_WORD(p);
    00713 01F5      MOVW	R30,R10
    00714 8020      LD	R2,Z
    00715 2433      CLR	R3
    00716 8101      LDD	R16,Z+1
    00717 2711      CLR	R17
    00718 2F10      MOV	R17,R16
    00719 2700      CLR	R16
    0071A 2902      OR	R16,R2
    0071B 2913      OR	R17,R3
    0071C 2722      CLR	R18
    0071D 2733      CLR	R19
    0071E C06C      RJMP	0x078B
(0844) 
(0845) 	case FS_FAT32 :
(0846) 		if (move_window(fs, fs->fatbase + (clst / (SS(fs) / 4)))) break;
    0071F E087      LDI	R24,7
    00720 E090      LDI	R25,0
    00721 850C      LDD	R16,Y+12
    00722 851D      LDD	R17,Y+13
    00723 852E      LDD	R18,Y+14
    00724 853F      LDD	R19,Y+15
    00725 938A      ST	-Y,R24
    00726 940E 4BAB CALL	lsr32
    00728 01F6      MOVW	R30,R12
    00729 8C26      LDD	R2,Z+30
    0072A 8C37      LDD	R3,Z+31
    0072B A040      LDD	R4,Z+32
    0072C A051      LDD	R5,Z+33
    0072D 0E20      ADD	R2,R16
    0072E 1E31      ADC	R3,R17
    0072F 1E42      ADC	R4,R18
    00730 1E53      ADC	R5,R19
    00731 8248      ST	Y,R4
    00732 8259      STD	Y+1,R5
    00733 0191      MOVW	R18,R2
    00734 018F      MOVW	R16,R30
    00735 DD41      RCALL	ff.c:move_window
    00736 2EE0      MOV	R14,R16
    00737 2300      TST	R16
    00738 F009      BEQ	0x073A
    00739 C04D      RJMP	0x0787
(0847) 		p = &fs->win[clst * 4 % SS(fs)];
    0073A E082      LDI	R24,2
    0073B E090      LDI	R25,0
    0073C 850C      LDD	R16,Y+12
    0073D 851D      LDD	R17,Y+13
    0073E 852E      LDD	R18,Y+14
    0073F 853F      LDD	R19,Y+15
    00740 938A      ST	-Y,R24
    00741 940E 4B92 CALL	lsl32
    00743 0118      MOVW	R2,R16
    00744 0129      MOVW	R4,R18
    00745 EF4F      LDI	R20,0xFF
    00746 E051      LDI	R21,1
    00747 E060      LDI	R22,0
    00748 E070      LDI	R23,0
    00749 2224      AND	R2,R20
    0074A 2235      AND	R3,R21
    0074B 2246      AND	R4,R22
    0074C 2257      AND	R5,R23
    0074D 0151      MOVW	R10,R2
    0074E 01C6      MOVW	R24,R12
    0074F 968E      ADIW	R24,0x2E
    00750 0EA8      ADD	R10,R24
    00751 1EB9      ADC	R11,R25
(0848) 		return LD_DWORD(p) & 0x0FFFFFFF;
    00752 E188      LDI	R24,0x18
    00753 E090      LDI	R25,0
    00754 01F5      MOVW	R30,R10
    00755 8103      LDD	R16,Z+3
    00756 2711      CLR	R17
    00757 2722      CLR	R18
    00758 2733      CLR	R19
    00759 938A      ST	-Y,R24
    0075A 940E 4B92 CALL	lsl32
    0075C 0118      MOVW	R2,R16
    0075D 0129      MOVW	R4,R18
    0075E 01F5      MOVW	R30,R10
    0075F 8062      LDD	R6,Z+2
    00760 2477      CLR	R7
    00761 2488      CLR	R8
    00762 2499      CLR	R9
    00763 0143      MOVW	R8,R6
    00764 2466      CLR	R6
    00765 2477      CLR	R7
    00766 2826      OR	R2,R6
    00767 2837      OR	R3,R7
    00768 2848      OR	R4,R8
    00769 2859      OR	R5,R9
    0076A 8061      LDD	R6,Z+1
    0076B 2477      CLR	R7
    0076C 2C76      MOV	R7,R6
    0076D 2466      CLR	R6
    0076E 2488      CLR	R8
    0076F 2499      CLR	R9
    00770 2826      OR	R2,R6
    00771 2837      OR	R3,R7
    00772 2848      OR	R4,R8
    00773 2859      OR	R5,R9
    00774 8060      LD	R6,Z
    00775 2477      CLR	R7
    00776 2488      CLR	R8
    00777 2499      CLR	R9
    00778 2826      OR	R2,R6
    00779 2837      OR	R3,R7
    0077A 2848      OR	R4,R8
    0077B 2859      OR	R5,R9
    0077C EF4F      LDI	R20,0xFF
    0077D EF5F      LDI	R21,0xFF
    0077E EF6F      LDI	R22,0xFF
    0077F E07F      LDI	R23,0xF
    00780 2224      AND	R2,R20
    00781 2235      AND	R3,R21
    00782 2246      AND	R4,R22
    00783 2257      AND	R5,R23
    00784 0181      MOVW	R16,R2
    00785 0192      MOVW	R18,R4
    00786 C004      RJMP	0x078B
(0849) 	}
(0850) 
(0851) 	return 0xFFFFFFFF;	/* An error occurred at the disk I/O layer */
    00787 EF0F      LDI	R16,0xFF
    00788 EF1F      LDI	R17,0xFF
    00789 EF2F      LDI	R18,0xFF
    0078A EF3F      LDI	R19,0xFF
    0078B 9622      ADIW	R28,2
    0078C 940E 4AFC CALL	pop_xgsetF0FC
    0078E 9622      ADIW	R28,2
    0078F 9508      RET
_put_fat:
  bc                   --> R12
  p                    --> R14
  res                  --> Y,+2
  val                  --> Y,+19
  clst                 --> Y,+15
  fs                   --> Y,+13
    00790 940E 49C2 CALL	push_arg4
    00792 940E 4B07 CALL	push_xgsetF0FC
    00794 9723      SBIW	R28,3
(0852) }
(0853) 
(0854) 
(0855) 
(0856) 
(0857) /*-----------------------------------------------------------------------*/
(0858) /* FAT access - Change value of a FAT entry                              */
(0859) /*-----------------------------------------------------------------------*/
(0860) #if !_FS_READONLY
(0861) 
(0862) FRESULT put_fat (
(0863) 	FATFS *fs,	/* File system object */
(0864) 	DWORD clst,	/* Cluster# to be changed in range of 2 to fs->n_fatent - 1 */
(0865) 	DWORD val	/* New value to mark the cluster */
(0866) )
(0867) {
(0868) 	UINT bc;
(0869) 	BYTE *p;
(0870) 	FRESULT res;
(0871) 
(0872) 
(0873) 	if (clst < 2 || clst >= fs->n_fatent) {	/* Check range */
    00795 E042      LDI	R20,2
    00796 E050      LDI	R21,0
    00797 E060      LDI	R22,0
    00798 E070      LDI	R23,0
    00799 842F      LDD	R2,Y+15
    0079A 8838      LDD	R3,Y+16
    0079B 8849      LDD	R4,Y+17
    0079C 885A      LDD	R5,Y+18
    0079D 1624      CP	R2,R20
    0079E 0635      CPC	R3,R21
    0079F 0646      CPC	R4,R22
    007A0 0657      CPC	R5,R23
    007A1 F080      BCS	0x07B2
    007A2 85ED      LDD	R30,Y+13
    007A3 85FE      LDD	R31,Y+14
    007A4 9676      ADIW	R30,0x16
    007A5 8020      LD	R2,Z
    007A6 8031      LDD	R3,Z+1
    007A7 8042      LDD	R4,Z+2
    007A8 8053      LDD	R5,Z+3
    007A9 846F      LDD	R6,Y+15
    007AA 8878      LDD	R7,Y+16
    007AB 8889      LDD	R8,Y+17
    007AC 889A      LDD	R9,Y+18
    007AD 1462      CP	R6,R2
    007AE 0473      CPC	R7,R3
    007AF 0484      CPC	R8,R4
    007B0 0495      CPC	R9,R5
    007B1 F018      BCS	0x07B5
(0874) 		res = FR_INT_ERR;
    007B2 E082      LDI	R24,2
    007B3 838A      STD	Y+2,R24
(0875) 
(0876) 	} else {
    007B4 C194      RJMP	0x0949
(0877) 		switch (fs->fs_type) {
    007B5 85ED      LDD	R30,Y+13
    007B6 85FE      LDD	R31,Y+14
    007B7 80A0      LD	R10,Z
    007B8 24BB      CLR	R11
    007B9 01C5      MOVW	R24,R10
    007BA 3081      CPI	R24,1
    007BB E0E0      LDI	R30,0
    007BC 079E      CPC	R25,R30
    007BD F059      BEQ	0x07C9
    007BE 3082      CPI	R24,2
    007BF E0E0      LDI	R30,0
    007C0 079E      CPC	R25,R30
    007C1 F409      BNE	0x07C3
    007C2 C0B0      RJMP	0x0873
    007C3 3083      CPI	R24,3
    007C4 E0E0      LDI	R30,0
    007C5 079E      CPC	R25,R30
    007C6 F409      BNE	0x07C8
    007C7 C0E7      RJMP	0x08AF
    007C8 C17A      RJMP	0x0943
(0878) 		case FS_FAT12 :
(0879) 			bc = clst; bc += bc / 2;
    007C9 84CF      LDD	R12,Y+15
    007CA 88D8      LDD	R13,Y+16
    007CB 0116      MOVW	R2,R12
    007CC 9436      LSR	R3
    007CD 9427      ROR	R2
    007CE 0CC2      ADD	R12,R2
    007CF 1CD3      ADC	R13,R3
(0880) 			res = move_window(fs, fs->fatbase + (bc / SS(fs)));
    007D0 E029      LDI	R18,0x9
    007D1 E030      LDI	R19,0
    007D2 0186      MOVW	R16,R12
    007D3 940E 4BA4 CALL	lsr16
    007D5 0118      MOVW	R2,R16
    007D6 2444      CLR	R4
    007D7 2455      CLR	R5
    007D8 85ED      LDD	R30,Y+13
    007D9 85FE      LDD	R31,Y+14
    007DA 8C66      LDD	R6,Z+30
    007DB 8C77      LDD	R7,Z+31
    007DC A080      LDD	R8,Z+32
    007DD A091      LDD	R9,Z+33
    007DE 0C62      ADD	R6,R2
    007DF 1C73      ADC	R7,R3
    007E0 1C84      ADC	R8,R4
    007E1 1C95      ADC	R9,R5
    007E2 8288      ST	Y,R8
    007E3 8299      STD	Y+1,R9
    007E4 0193      MOVW	R18,R6
    007E5 018F      MOVW	R16,R30
    007E6 DC90      RCALL	ff.c:move_window
    007E7 830A      STD	Y+2,R16
(0881) 			if (res != FR_OK) break;
    007E8 2E00      MOV	R0,R16
    007E9 2300      TST	R16
    007EA F009      BEQ	0x07EC
    007EB C159      RJMP	0x0945
(0882) 			p = &fs->win[bc % SS(fs)];
    007EC 858D      LDD	R24,Y+13
    007ED 859E      LDD	R25,Y+14
    007EE 968E      ADIW	R24,0x2E
    007EF 01F6      MOVW	R30,R12
    007F0 70F1      ANDI	R31,1
    007F1 017F      MOVW	R14,R30
    007F2 0EE8      ADD	R14,R24
    007F3 1EF9      ADC	R15,R25
(0883) 			*p = (clst & 1) ? ((*p & 0x0F) | ((BYTE)val << 4)) : (BYTE)val;
    007F4 842F      LDD	R2,Y+15
    007F5 8838      LDD	R3,Y+16
    007F6 8849      LDD	R4,Y+17
    007F7 885A      LDD	R5,Y+18
    007F8 93EF      PUSH	R30
    007F9 2DE2      MOV	R30,R2
    007FA 70E1      ANDI	R30,1
    007FB 91EF      POP	R30
    007FC F0B1      BEQ	0x0813
    007FD 882B      LDD	R2,Y+19
    007FE 883C      LDD	R3,Y+20
    007FF 884D      LDD	R4,Y+21
    00800 885E      LDD	R5,Y+22
    00801 2433      CLR	R3
    00802 0C22      LSL	R2
    00803 1C33      ROL	R3
    00804 0C22      LSL	R2
    00805 1C33      ROL	R3
    00806 0C22      LSL	R2
    00807 1C33      ROL	R3
    00808 0C22      LSL	R2
    00809 1C33      ROL	R3
    0080A 01F7      MOVW	R30,R14
    0080B 8180      LD	R24,Z
    0080C 2799      CLR	R25
    0080D 708F      ANDI	R24,0xF
    0080E 7090      ANDI	R25,0
    0080F 015C      MOVW	R10,R24
    00810 28A2      OR	R10,R2
    00811 28B3      OR	R11,R3
    00812 C006      RJMP	0x0819
    00813 882B      LDD	R2,Y+19
    00814 883C      LDD	R3,Y+20
    00815 884D      LDD	R4,Y+21
    00816 885E      LDD	R5,Y+22
    00817 2CA2      MOV	R10,R2
    00818 24BB      CLR	R11
    00819 01F7      MOVW	R30,R14
    0081A 82A0      ST	Z,R10
(0884) 			bc++;
    0081B 01C6      MOVW	R24,R12
    0081C 9601      ADIW	R24,1
    0081D 016C      MOVW	R12,R24
(0885) 			fs->wflag = 1;
    0081E E081      LDI	R24,1
    0081F 85ED      LDD	R30,Y+13
    00820 85FE      LDD	R31,Y+14
    00821 8384      STD	Z+4,R24
(0886) 			res = move_window(fs, fs->fatbase + (bc / SS(fs)));
    00822 E029      LDI	R18,0x9
    00823 E030      LDI	R19,0
    00824 0186      MOVW	R16,R12
    00825 940E 4BA4 CALL	lsr16
    00827 0118      MOVW	R2,R16
    00828 2444      CLR	R4
    00829 2455      CLR	R5
    0082A 85ED      LDD	R30,Y+13
    0082B 85FE      LDD	R31,Y+14
    0082C 8C66      LDD	R6,Z+30
    0082D 8C77      LDD	R7,Z+31
    0082E A080      LDD	R8,Z+32
    0082F A091      LDD	R9,Z+33
    00830 0C62      ADD	R6,R2
    00831 1C73      ADC	R7,R3
    00832 1C84      ADC	R8,R4
    00833 1C95      ADC	R9,R5
    00834 8288      ST	Y,R8
    00835 8299      STD	Y+1,R9
    00836 0193      MOVW	R18,R6
    00837 018F      MOVW	R16,R30
    00838 DC3E      RCALL	ff.c:move_window
    00839 830A      STD	Y+2,R16
(0887) 			if (res != FR_OK) break;
    0083A 2E00      MOV	R0,R16
    0083B 2300      TST	R16
    0083C F009      BEQ	0x083E
    0083D C107      RJMP	0x0945
(0888) 			p = &fs->win[bc % SS(fs)];
    0083E 858D      LDD	R24,Y+13
    0083F 859E      LDD	R25,Y+14
    00840 968E      ADIW	R24,0x2E
    00841 01F6      MOVW	R30,R12
    00842 70F1      ANDI	R31,1
    00843 017F      MOVW	R14,R30
    00844 0EE8      ADD	R14,R24
    00845 1EF9      ADC	R15,R25
(0889) 			*p = (clst & 1) ? (BYTE)(val >> 4) : ((*p & 0xF0) | ((BYTE)(val >> 8) & 0x0F));
    00846 842F      LDD	R2,Y+15
    00847 8838      LDD	R3,Y+16
    00848 8849      LDD	R4,Y+17
    00849 885A      LDD	R5,Y+18
    0084A 93EF      PUSH	R30
    0084B 2DE2      MOV	R30,R2
    0084C 70E1      ANDI	R30,1
    0084D 91EF      POP	R30
    0084E F061      BEQ	0x085B
    0084F E084      LDI	R24,4
    00850 E090      LDI	R25,0
    00851 890B      LDD	R16,Y+19
    00852 891C      LDD	R17,Y+20
    00853 892D      LDD	R18,Y+21
    00854 893E      LDD	R19,Y+22
    00855 938A      ST	-Y,R24
    00856 940E 4BAB CALL	lsr32
    00858 2EC0      MOV	R12,R16
    00859 24DD      CLR	R13
    0085A C015      RJMP	0x0870
    0085B E088      LDI	R24,0x8
    0085C E090      LDI	R25,0
    0085D 890B      LDD	R16,Y+19
    0085E 891C      LDD	R17,Y+20
    0085F 892D      LDD	R18,Y+21
    00860 893E      LDD	R19,Y+22
    00861 938A      ST	-Y,R24
    00862 940E 4BAB CALL	lsr32
    00864 2F80      MOV	R24,R16
    00865 2799      CLR	R25
    00866 708F      ANDI	R24,0xF
    00867 7090      ANDI	R25,0
    00868 01F7      MOVW	R30,R14
    00869 81E0      LD	R30,Z
    0086A 27FF      CLR	R31
    0086B 7FE0      ANDI	R30,0xF0
    0086C 70F0      ANDI	R31,0
    0086D 016F      MOVW	R12,R30
    0086E 2AC8      OR	R12,R24
    0086F 2AD9      OR	R13,R25
    00870 01F7      MOVW	R30,R14
    00871 82C0      ST	Z,R12
(0890) 			break;
    00872 C0D2      RJMP	0x0945
(0891) 
(0892) 		case FS_FAT16 :
(0893) 			res = move_window(fs, fs->fatbase + (clst / (SS(fs) / 2)));
    00873 E088      LDI	R24,0x8
    00874 E090      LDI	R25,0
    00875 850F      LDD	R16,Y+15
    00876 8918      LDD	R17,Y+16
    00877 8929      LDD	R18,Y+17
    00878 893A      LDD	R19,Y+18
    00879 938A      ST	-Y,R24
    0087A 940E 4BAB CALL	lsr32
    0087C 85ED      LDD	R30,Y+13
    0087D 85FE      LDD	R31,Y+14
    0087E 8C26      LDD	R2,Z+30
    0087F 8C37      LDD	R3,Z+31
    00880 A040      LDD	R4,Z+32
    00881 A051      LDD	R5,Z+33
    00882 0E20      ADD	R2,R16
    00883 1E31      ADC	R3,R17
    00884 1E42      ADC	R4,R18
    00885 1E53      ADC	R5,R19
    00886 8248      ST	Y,R4
    00887 8259      STD	Y+1,R5
    00888 0191      MOVW	R18,R2
    00889 018F      MOVW	R16,R30
    0088A DBEC      RCALL	ff.c:move_window
    0088B 2EC0      MOV	R12,R16
    0088C 82CA      STD	Y+2,R12
(0894) 			if (res != FR_OK) break;
    0088D 2C0C      MOV	R0,R12
    0088E 2300      TST	R16
    0088F F009      BEQ	0x0891
    00890 C0B4      RJMP	0x0945
(0895) 			p = &fs->win[clst * 2 % SS(fs)];
    00891 EF4F      LDI	R20,0xFF
    00892 E051      LDI	R21,1
    00893 E060      LDI	R22,0
    00894 E070      LDI	R23,0
    00895 842F      LDD	R2,Y+15
    00896 8838      LDD	R3,Y+16
    00897 8849      LDD	R4,Y+17
    00898 885A      LDD	R5,Y+18
    00899 0C22      LSL	R2
    0089A 1C33      ROL	R3
    0089B 1C44      ROL	R4
    0089C 1C55      ROL	R5
    0089D 2224      AND	R2,R20
    0089E 2235      AND	R3,R21
    0089F 2246      AND	R4,R22
    008A0 2257      AND	R5,R23
    008A1 0171      MOVW	R14,R2
    008A2 858D      LDD	R24,Y+13
    008A3 859E      LDD	R25,Y+14
    008A4 968E      ADIW	R24,0x2E
    008A5 0EE8      ADD	R14,R24
    008A6 1EF9      ADC	R15,R25
(0896) 			ST_WORD(p, (WORD)val);
    008A7 882B      LDD	R2,Y+19
    008A8 883C      LDD	R3,Y+20
    008A9 01F7      MOVW	R30,R14
    008AA 8220      ST	Z,R2
    008AB 2C23      MOV	R2,R3
    008AC 2433      CLR	R3
    008AD 8221      STD	Z+1,R2
(0897) 			break;
    008AE C096      RJMP	0x0945
(0898) 
(0899) 		case FS_FAT32 :
(0900) 			res = move_window(fs, fs->fatbase + (clst / (SS(fs) / 4)));
    008AF E087      LDI	R24,7
    008B0 E090      LDI	R25,0
    008B1 850F      LDD	R16,Y+15
    008B2 8918      LDD	R17,Y+16
    008B3 8929      LDD	R18,Y+17
    008B4 893A      LDD	R19,Y+18
    008B5 938A      ST	-Y,R24
    008B6 940E 4BAB CALL	lsr32
    008B8 85ED      LDD	R30,Y+13
    008B9 85FE      LDD	R31,Y+14
    008BA 8C26      LDD	R2,Z+30
    008BB 8C37      LDD	R3,Z+31
    008BC A040      LDD	R4,Z+32
    008BD A051      LDD	R5,Z+33
    008BE 0E20      ADD	R2,R16
    008BF 1E31      ADC	R3,R17
    008C0 1E42      ADC	R4,R18
    008C1 1E53      ADC	R5,R19
    008C2 8248      ST	Y,R4
    008C3 8259      STD	Y+1,R5
    008C4 0191      MOVW	R18,R2
    008C5 018F      MOVW	R16,R30
    008C6 DBB0      RCALL	ff.c:move_window
    008C7 2EC0      MOV	R12,R16
    008C8 82CA      STD	Y+2,R12
(0901) 			if (res != FR_OK) break;
    008C9 2C0C      MOV	R0,R12
    008CA 2300      TST	R16
    008CB F009      BEQ	0x08CD
    008CC C078      RJMP	0x0945
(0902) 			p = &fs->win[clst * 4 % SS(fs)];
    008CD E082      LDI	R24,2
    008CE E090      LDI	R25,0
    008CF 850F      LDD	R16,Y+15
    008D0 8918      LDD	R17,Y+16
    008D1 8929      LDD	R18,Y+17
    008D2 893A      LDD	R19,Y+18
    008D3 938A      ST	-Y,R24
    008D4 940E 4B92 CALL	lsl32
    008D6 0118      MOVW	R2,R16
    008D7 0129      MOVW	R4,R18
    008D8 EF4F      LDI	R20,0xFF
    008D9 E051      LDI	R21,1
    008DA E060      LDI	R22,0
    008DB E070      LDI	R23,0
    008DC 2224      AND	R2,R20
    008DD 2235      AND	R3,R21
    008DE 2246      AND	R4,R22
    008DF 2257      AND	R5,R23
    008E0 0171      MOVW	R14,R2
    008E1 858D      LDD	R24,Y+13
    008E2 859E      LDD	R25,Y+14
    008E3 968E      ADIW	R24,0x2E
    008E4 0EE8      ADD	R14,R24
    008E5 1EF9      ADC	R15,R25
(0903) 			val |= LD_DWORD(p) & 0xF0000000;
    008E6 E188      LDI	R24,0x18
    008E7 E090      LDI	R25,0
    008E8 01F7      MOVW	R30,R14
    008E9 8103      LDD	R16,Z+3
    008EA 2711      CLR	R17
    008EB 2722      CLR	R18
    008EC 2733      CLR	R19
    008ED 938A      ST	-Y,R24
    008EE 940E 4B92 CALL	lsl32
    008F0 0118      MOVW	R2,R16
    008F1 0129      MOVW	R4,R18
    008F2 01F7      MOVW	R30,R14
    008F3 8062      LDD	R6,Z+2
    008F4 2477      CLR	R7
    008F5 2488      CLR	R8
    008F6 2499      CLR	R9
    008F7 0143      MOVW	R8,R6
    008F8 2466      CLR	R6
    008F9 2477      CLR	R7
    008FA 2826      OR	R2,R6
    008FB 2837      OR	R3,R7
    008FC 2848      OR	R4,R8
    008FD 2859      OR	R5,R9
    008FE 8061      LDD	R6,Z+1
    008FF 2477      CLR	R7
    00900 2C76      MOV	R7,R6
    00901 2466      CLR	R6
    00902 2488      CLR	R8
    00903 2499      CLR	R9
    00904 2826      OR	R2,R6
    00905 2837      OR	R3,R7
    00906 2848      OR	R4,R8
    00907 2859      OR	R5,R9
    00908 8060      LD	R6,Z
    00909 2477      CLR	R7
    0090A 2488      CLR	R8
    0090B 2499      CLR	R9
    0090C 2826      OR	R2,R6
    0090D 2837      OR	R3,R7
    0090E 2848      OR	R4,R8
    0090F 2859      OR	R5,R9
    00910 E040      LDI	R20,0
    00911 E050      LDI	R21,0
    00912 E060      LDI	R22,0
    00913 EF70      LDI	R23,0xF0
    00914 2224      AND	R2,R20
    00915 2235      AND	R3,R21
    00916 2246      AND	R4,R22
    00917 2257      AND	R5,R23
    00918 886B      LDD	R6,Y+19
    00919 887C      LDD	R7,Y+20
    0091A 888D      LDD	R8,Y+21
    0091B 889E      LDD	R9,Y+22
    0091C 2862      OR	R6,R2
    0091D 2873      OR	R7,R3
    0091E 2884      OR	R8,R4
    0091F 2895      OR	R9,R5
    00920 8A6B      STD	Y+19,R6
    00921 8A7C      STD	Y+20,R7
    00922 8A8D      STD	Y+21,R8
    00923 8A9E      STD	Y+22,R9
(0904) 			ST_DWORD(p, val);
    00924 882B      LDD	R2,Y+19
    00925 883C      LDD	R3,Y+20
    00926 884D      LDD	R4,Y+21
    00927 885E      LDD	R5,Y+22
    00928 8220      ST	Z,R2
    00929 2C23      MOV	R2,R3
    0092A 2433      CLR	R3
    0092B 9631      ADIW	R30,1
    0092C 8220      ST	Z,R2
    0092D 882B      LDD	R2,Y+19
    0092E 883C      LDD	R3,Y+20
    0092F 884D      LDD	R4,Y+21
    00930 885E      LDD	R5,Y+22
    00931 0112      MOVW	R2,R4
    00932 2444      CLR	R4
    00933 2455      CLR	R5
    00934 01F7      MOVW	R30,R14
    00935 9632      ADIW	R30,2
    00936 8220      ST	Z,R2
    00937 E188      LDI	R24,0x18
    00938 E090      LDI	R25,0
    00939 890B      LDD	R16,Y+19
    0093A 891C      LDD	R17,Y+20
    0093B 892D      LDD	R18,Y+21
    0093C 893E      LDD	R19,Y+22
    0093D 938A      ST	-Y,R24
    0093E 940E 4BAB CALL	lsr32
    00940 01F7      MOVW	R30,R14
    00941 8303      STD	Z+3,R16
(0905) 			break;
    00942 C002      RJMP	0x0945
(0906) 
(0907) 		default :
(0908) 			res = FR_INT_ERR;
    00943 E082      LDI	R24,2
    00944 838A      STD	Y+2,R24
(0909) 		}
(0910) 		fs->wflag = 1;
    00945 E081      LDI	R24,1
    00946 85ED      LDD	R30,Y+13
    00947 85FE      LDD	R31,Y+14
    00948 8384      STD	Z+4,R24
(0911) 	}
(0912) 
(0913) 	return res;
    00949 810A      LDD	R16,Y+2
    0094A 9623      ADIW	R28,3
    0094B 940E 4AFC CALL	pop_xgsetF0FC
    0094D 9624      ADIW	R28,4
    0094E 9508      RET
ff.c:remove_chain:
  res                  --> R10
  nxt                  --> Y,+6
  clst                 --> Y,+18
  fs                   --> R12
    0094F 933A      ST	-Y,R19
    00950 932A      ST	-Y,R18
    00951 940E 4B42 CALL	push_xgsetF03C
    00953 0168      MOVW	R12,R16
    00954 972A      SBIW	R28,0xA
(0914) }
(0915) #endif /* !_FS_READONLY */
(0916) 
(0917) 
(0918) 
(0919) 
(0920) /*-----------------------------------------------------------------------*/
(0921) /* FAT handling - Remove a cluster chain                                 */
(0922) /*-----------------------------------------------------------------------*/
(0923) #if !_FS_READONLY
(0924) static
(0925) FRESULT remove_chain (
(0926) 	FATFS *fs,			/* File system object */
(0927) 	DWORD clst			/* Cluster# to remove a chain from */
(0928) )
(0929) {
(0930) 	FRESULT res;
(0931) 	DWORD nxt;
(0932) #if _USE_ERASE
(0933) 	DWORD scl = clst, ecl = clst, resion[2];
(0934) #endif
(0935) 
(0936) 	if (clst < 2 || clst >= fs->n_fatent) {	/* Check range */
    00955 E042      LDI	R20,2
    00956 E050      LDI	R21,0
    00957 E060      LDI	R22,0
    00958 E070      LDI	R23,0
    00959 882A      LDD	R2,Y+18
    0095A 883B      LDD	R3,Y+19
    0095B 884C      LDD	R4,Y+20
    0095C 885D      LDD	R5,Y+21
    0095D 1624      CP	R2,R20
    0095E 0635      CPC	R3,R21
    0095F 0646      CPC	R4,R22
    00960 0657      CPC	R5,R23
    00961 F078      BCS	0x0971
    00962 01F6      MOVW	R30,R12
    00963 9676      ADIW	R30,0x16
    00964 8020      LD	R2,Z
    00965 8031      LDD	R3,Z+1
    00966 8042      LDD	R4,Z+2
    00967 8053      LDD	R5,Z+3
    00968 886A      LDD	R6,Y+18
    00969 887B      LDD	R7,Y+19
    0096A 888C      LDD	R8,Y+20
    0096B 889D      LDD	R9,Y+21
    0096C 1462      CP	R6,R2
    0096D 0473      CPC	R7,R3
    0096E 0484      CPC	R8,R4
    0096F 0495      CPC	R9,R5
    00970 F018      BCS	0x0974
(0937) 		res = FR_INT_ERR;
    00971 E082      LDI	R24,2
    00972 2EA8      MOV	R10,R24
(0938) 
(0939) 	} else {
    00973 C088      RJMP	0x09FC
(0940) 		res = FR_OK;
    00974 24AA      CLR	R10
    00975 C076      RJMP	0x09EC
(0941) 		while (clst < fs->n_fatent) {			/* Not a last link? */
(0942) 			nxt = get_fat(fs, clst);			/* Get cluster status */
    00976 882A      LDD	R2,Y+18
    00977 883B      LDD	R3,Y+19
    00978 884C      LDD	R4,Y+20
    00979 885D      LDD	R5,Y+21
    0097A 8248      ST	Y,R4
    0097B 8259      STD	Y+1,R5
    0097C 0191      MOVW	R18,R2
    0097D 0186      MOVW	R16,R12
    0097E DCC1      RCALL	_get_fat
    0097F 830E      STD	Y+6,R16
    00980 831F      STD	Y+7,R17
    00981 8728      STD	Y+8,R18
    00982 8739      STD	Y+9,R19
(0943) 			if (nxt == 0) break;				/* Empty cluster? */
    00983 802E      LDD	R2,Y+6
    00984 803F      LDD	R3,Y+7
    00985 8448      LDD	R4,Y+8
    00986 8459      LDD	R5,Y+9
    00987 9488      BCLR	0
    00988 2022      TST	R2
    00989 0432      CPC	R3,R2
    0098A 0442      CPC	R4,R2
    0098B 0452      CPC	R5,R2
    0098C F409      BNE	0x098E
    0098D C06E      RJMP	0x09FC
(0944) 			if (nxt == 1) { res = FR_INT_ERR; break; }	/* Internal error? */
    0098E E041      LDI	R20,1
    0098F E050      LDI	R21,0
    00990 E060      LDI	R22,0
    00991 E070      LDI	R23,0
    00992 802E      LDD	R2,Y+6
    00993 803F      LDD	R3,Y+7
    00994 8448      LDD	R4,Y+8
    00995 8459      LDD	R5,Y+9
    00996 1624      CP	R2,R20
    00997 0635      CPC	R3,R21
    00998 0646      CPC	R4,R22
    00999 0657      CPC	R5,R23
    0099A F419      BNE	0x099E
    0099B E082      LDI	R24,2
    0099C 2EA8      MOV	R10,R24
    0099D C05E      RJMP	0x09FC
(0945) 			if (nxt == 0xFFFFFFFF) { res = FR_DISK_ERR; break; }	/* Disk error? */
    0099E EF4F      LDI	R20,0xFF
    0099F EF5F      LDI	R21,0xFF
    009A0 EF6F      LDI	R22,0xFF
    009A1 EF7F      LDI	R23,0xFF
    009A2 802E      LDD	R2,Y+6
    009A3 803F      LDD	R3,Y+7
    009A4 8448      LDD	R4,Y+8
    009A5 8459      LDD	R5,Y+9
    009A6 1624      CP	R2,R20
    009A7 0635      CPC	R3,R21
    009A8 0646      CPC	R4,R22
    009A9 0657      CPC	R5,R23
    009AA F419      BNE	0x09AE
    009AB 24AA      CLR	R10
    009AC 94A3      INC	R10
    009AD C04E      RJMP	0x09FC
(0946) 			res = put_fat(fs, clst, 0);			/* Mark the cluster "empty" */
    009AE E080      LDI	R24,0
    009AF 838A      STD	Y+2,R24
    009B0 838B      STD	Y+3,R24
    009B1 838C      STD	Y+4,R24
    009B2 838D      STD	Y+5,R24
    009B3 882A      LDD	R2,Y+18
    009B4 883B      LDD	R3,Y+19
    009B5 884C      LDD	R4,Y+20
    009B6 885D      LDD	R5,Y+21
    009B7 8248      ST	Y,R4
    009B8 8259      STD	Y+1,R5
    009B9 0191      MOVW	R18,R2
    009BA 0186      MOVW	R16,R12
    009BB DDD4      RCALL	_put_fat
    009BC 2EA0      MOV	R10,R16
(0947) 			if (res != FR_OK) break;
    009BD 2300      TST	R16
    009BE F009      BEQ	0x09C0
    009BF C03C      RJMP	0x09FC
(0948) 			if (fs->free_clust != 0xFFFFFFFF) {	/* Update FSInfo */
    009C0 EF4F      LDI	R20,0xFF
    009C1 EF5F      LDI	R21,0xFF
    009C2 EF6F      LDI	R22,0xFF
    009C3 EF7F      LDI	R23,0xFF
    009C4 01F6      MOVW	R30,R12
    009C5 8426      LDD	R2,Z+14
    009C6 8437      LDD	R3,Z+15
    009C7 8840      LDD	R4,Z+16
    009C8 8851      LDD	R5,Z+17
    009C9 1624      CP	R2,R20
    009CA 0635      CPC	R3,R21
    009CB 0646      CPC	R4,R22
    009CC 0657      CPC	R5,R23
    009CD F0B1      BEQ	0x09E4
(0949) 				fs->free_clust++;
    009CE 01CF      MOVW	R24,R30
    009CF 960E      ADIW	R24,0xE
    009D0 E041      LDI	R20,1
    009D1 E050      LDI	R21,0
    009D2 E060      LDI	R22,0
    009D3 E070      LDI	R23,0
    009D4 01FC      MOVW	R30,R24
    009D5 8020      LD	R2,Z
    009D6 8031      LDD	R3,Z+1
    009D7 8042      LDD	R4,Z+2
    009D8 8053      LDD	R5,Z+3
    009D9 0E24      ADD	R2,R20
    009DA 1E35      ADC	R3,R21
    009DB 1E46      ADC	R4,R22
    009DC 1E57      ADC	R5,R23
    009DD 8220      ST	Z,R2
    009DE 8231      STD	Z+1,R3
    009DF 8242      STD	Z+2,R4
    009E0 8253      STD	Z+3,R5
(0950) 				fs->fsi_flag = 1;
    009E1 E081      LDI	R24,1
    009E2 01F6      MOVW	R30,R12
    009E3 8385      STD	Z+5,R24
(0951) 			}
(0952) #if _USE_ERASE
(0953) 			if (ecl + 1 == nxt) {	/* Next cluster is contiguous */
(0954) 				ecl = nxt;
(0955) 			} else {				/* End of contiguous clusters */ 
(0956) 				resion[0] = clust2sect(fs, scl);					/* Start sector */
(0957) 				resion[1] = clust2sect(fs, ecl) + fs->csize - 1;	/* End sector */
(0958) 				disk_ioctl(fs->drv, CTRL_ERASE_SECTOR, resion);		/* Erase the block */
(0959) 				scl = ecl = nxt;
(0960) 			}
(0961) #endif
(0962) 			clst = nxt;	/* Next cluster */
    009E4 802E      LDD	R2,Y+6
    009E5 803F      LDD	R3,Y+7
    009E6 8448      LDD	R4,Y+8
    009E7 8459      LDD	R5,Y+9
    009E8 8A2A      STD	Y+18,R2
    009E9 8A3B      STD	Y+19,R3
    009EA 8A4C      STD	Y+20,R4
    009EB 8A5D      STD	Y+21,R5
    009EC 01F6      MOVW	R30,R12
    009ED 9676      ADIW	R30,0x16
    009EE 8020      LD	R2,Z
    009EF 8031      LDD	R3,Z+1
    009F0 8042      LDD	R4,Z+2
    009F1 8053      LDD	R5,Z+3
    009F2 886A      LDD	R6,Y+18
    009F3 887B      LDD	R7,Y+19
    009F4 888C      LDD	R8,Y+20
    009F5 889D      LDD	R9,Y+21
    009F6 1462      CP	R6,R2
    009F7 0473      CPC	R7,R3
    009F8 0484      CPC	R8,R4
    009F9 0495      CPC	R9,R5
    009FA F408      BCC	0x09FC
    009FB CF7A      RJMP	0x0976
(0963) 		}
(0964) 	}
(0965) 
(0966) 	return res;
    009FC 2D0A      MOV	R16,R10
    009FD 962A      ADIW	R28,0xA
    009FE 940E 4B4B CALL	pop_xgsetF03C
    00A00 9622      ADIW	R28,2
    00A01 9508      RET
ff.c:create_chain:
  res                  --> R10
  scl                  --> Y,+14
  cs                   --> Y,+10
  ncl                  --> Y,+6
  clst                 --> Y,+32
  fs                   --> R12
    00A02 933A      ST	-Y,R19
    00A03 932A      ST	-Y,R18
    00A04 940E 4B07 CALL	push_xgsetF0FC
    00A06 0168      MOVW	R12,R16
    00A07 9766      SBIW	R28,0x16
(0967) }
(0968) #endif
(0969) 
(0970) 
(0971) 
(0972) 
(0973) /*-----------------------------------------------------------------------*/
(0974) /* FAT handling - Stretch or Create a cluster chain                      */
(0975) /*-----------------------------------------------------------------------*/
(0976) #if !_FS_READONLY
(0977) static
(0978) DWORD create_chain (	/* 0:No free cluster, 1:Internal error, 0xFFFFFFFF:Disk error, >=2:New cluster# */
(0979) 	FATFS *fs,			/* File system object */
(0980) 	DWORD clst			/* Cluster# to stretch. 0 means create a new chain. */
(0981) )
(0982) {
(0983) 	DWORD cs, ncl, scl;
(0984) 	FRESULT res;
(0985) 
(0986) 
(0987) 	if (clst == 0) {		/* Create a new chain */
    00A08 A028      LDD	R2,Y+32
    00A09 A039      LDD	R3,Y+33
    00A0A A04A      LDD	R4,Y+34
    00A0B A05B      LDD	R5,Y+35
    00A0C 9488      BCLR	0
    00A0D 2022      TST	R2
    00A0E 0432      CPC	R3,R2
    00A0F 0442      CPC	R4,R2
    00A10 0452      CPC	R5,R2
    00A11 F559      BNE	0x0A3D
(0988) 		scl = fs->last_clust;			/* Get suggested start point */
    00A12 01F6      MOVW	R30,R12
    00A13 963A      ADIW	R30,0xA
    00A14 8020      LD	R2,Z
    00A15 8031      LDD	R3,Z+1
    00A16 8042      LDD	R4,Z+2
    00A17 8053      LDD	R5,Z+3
    00A18 862E      STD	Y+14,R2
    00A19 863F      STD	Y+15,R3
    00A1A 8A48      STD	Y+16,R4
    00A1B 8A59      STD	Y+17,R5
(0989) 		if (!scl || scl >= fs->n_fatent) scl = 1;
    00A1C 842E      LDD	R2,Y+14
    00A1D 843F      LDD	R3,Y+15
    00A1E 8848      LDD	R4,Y+16
    00A1F 8859      LDD	R5,Y+17
    00A20 9488      BCLR	0
    00A21 2022      TST	R2
    00A22 0432      CPC	R3,R2
    00A23 0442      CPC	R4,R2
    00A24 0452      CPC	R5,R2
    00A25 F081      BEQ	0x0A36
    00A26 01F6      MOVW	R30,R12
    00A27 9676      ADIW	R30,0x16
    00A28 8020      LD	R2,Z
    00A29 8031      LDD	R3,Z+1
    00A2A 8042      LDD	R4,Z+2
    00A2B 8053      LDD	R5,Z+3
    00A2C 846E      LDD	R6,Y+14
    00A2D 847F      LDD	R7,Y+15
    00A2E 8888      LDD	R8,Y+16
    00A2F 8899      LDD	R9,Y+17
    00A30 1462      CP	R6,R2
    00A31 0473      CPC	R7,R3
    00A32 0484      CPC	R8,R4
    00A33 0495      CPC	R9,R5
    00A34 F408      BCC	0x0A36
    00A35 C040      RJMP	0x0A76
    00A36 E081      LDI	R24,1
    00A37 878E      STD	Y+14,R24
    00A38 E080      LDI	R24,0
    00A39 878F      STD	Y+15,R24
    00A3A 8B88      STD	Y+16,R24
    00A3B 8B89      STD	Y+17,R24
(0990) 	}
    00A3C C039      RJMP	0x0A76
(0991) 	else {					/* Stretch the current chain */
(0992) 		cs = get_fat(fs, clst);			/* Check the cluster status */
    00A3D A028      LDD	R2,Y+32
    00A3E A039      LDD	R3,Y+33
    00A3F A04A      LDD	R4,Y+34
    00A40 A05B      LDD	R5,Y+35
    00A41 8248      ST	Y,R4
    00A42 8259      STD	Y+1,R5
    00A43 0191      MOVW	R18,R2
    00A44 0186      MOVW	R16,R12
    00A45 DBFA      RCALL	_get_fat
    00A46 870A      STD	Y+10,R16
    00A47 871B      STD	Y+11,R17
    00A48 872C      STD	Y+12,R18
    00A49 873D      STD	Y+13,R19
(0993) 		if (cs < 2) return 1;			/* It is an invalid cluster */
    00A4A E042      LDI	R20,2
    00A4B E050      LDI	R21,0
    00A4C E060      LDI	R22,0
    00A4D E070      LDI	R23,0
    00A4E 842A      LDD	R2,Y+10
    00A4F 843B      LDD	R3,Y+11
    00A50 844C      LDD	R4,Y+12
    00A51 845D      LDD	R5,Y+13
    00A52 1624      CP	R2,R20
    00A53 0635      CPC	R3,R21
    00A54 0646      CPC	R4,R22
    00A55 0657      CPC	R5,R23
    00A56 F428      BCC	0x0A5C
    00A57 E001      LDI	R16,1
    00A58 E010      LDI	R17,0
    00A59 E020      LDI	R18,0
    00A5A E030      LDI	R19,0
    00A5B C119      RJMP	0x0B75
(0994) 		if (cs < fs->n_fatent) return cs;	/* It is already followed by next cluster */
    00A5C 01F6      MOVW	R30,R12
    00A5D 9676      ADIW	R30,0x16
    00A5E 8020      LD	R2,Z
    00A5F 8031      LDD	R3,Z+1
    00A60 8042      LDD	R4,Z+2
    00A61 8053      LDD	R5,Z+3
    00A62 846A      LDD	R6,Y+10
    00A63 847B      LDD	R7,Y+11
    00A64 848C      LDD	R8,Y+12
    00A65 849D      LDD	R9,Y+13
    00A66 1462      CP	R6,R2
    00A67 0473      CPC	R7,R3
    00A68 0484      CPC	R8,R4
    00A69 0495      CPC	R9,R5
    00A6A F418      BCC	0x0A6E
    00A6B 0183      MOVW	R16,R6
    00A6C 0194      MOVW	R18,R8
    00A6D C107      RJMP	0x0B75
(0995) 		scl = clst;
    00A6E A028      LDD	R2,Y+32
    00A6F A039      LDD	R3,Y+33
    00A70 A04A      LDD	R4,Y+34
    00A71 A05B      LDD	R5,Y+35
    00A72 862E      STD	Y+14,R2
    00A73 863F      STD	Y+15,R3
    00A74 8A48      STD	Y+16,R4
    00A75 8A59      STD	Y+17,R5
(0996) 	}
(0997) 
(0998) 	ncl = scl;				/* Start cluster */
    00A76 842E      LDD	R2,Y+14
    00A77 843F      LDD	R3,Y+15
    00A78 8848      LDD	R4,Y+16
    00A79 8859      LDD	R5,Y+17
    00A7A 822E      STD	Y+6,R2
    00A7B 823F      STD	Y+7,R3
    00A7C 8648      STD	Y+8,R4
    00A7D 8659      STD	Y+9,R5
(0999) 	for (;;) {
(1000) 		ncl++;							/* Next cluster */
    00A7E E041      LDI	R20,1
    00A7F E050      LDI	R21,0
    00A80 E060      LDI	R22,0
    00A81 E070      LDI	R23,0
    00A82 802E      LDD	R2,Y+6
    00A83 803F      LDD	R3,Y+7
    00A84 8448      LDD	R4,Y+8
    00A85 8459      LDD	R5,Y+9
    00A86 0E24      ADD	R2,R20
    00A87 1E35      ADC	R3,R21
    00A88 1E46      ADC	R4,R22
    00A89 1E57      ADC	R5,R23
    00A8A 822E      STD	Y+6,R2
    00A8B 823F      STD	Y+7,R3
    00A8C 8648      STD	Y+8,R4
    00A8D 8659      STD	Y+9,R5
(1001) 		if (ncl >= fs->n_fatent) {		/* Wrap around */
    00A8E 01F6      MOVW	R30,R12
    00A8F 9676      ADIW	R30,0x16
    00A90 8020      LD	R2,Z
    00A91 8031      LDD	R3,Z+1
    00A92 8042      LDD	R4,Z+2
    00A93 8053      LDD	R5,Z+3
    00A94 806E      LDD	R6,Y+6
    00A95 807F      LDD	R7,Y+7
    00A96 8488      LDD	R8,Y+8
    00A97 8499      LDD	R9,Y+9
    00A98 1462      CP	R6,R2
    00A99 0473      CPC	R7,R3
    00A9A 0484      CPC	R8,R4
    00A9B 0495      CPC	R9,R5
    00A9C F0C0      BCS	0x0AB5
(1002) 			ncl = 2;
    00A9D E082      LDI	R24,2
    00A9E 838E      STD	Y+6,R24
    00A9F E080      LDI	R24,0
    00AA0 838F      STD	Y+7,R24
    00AA1 8788      STD	Y+8,R24
    00AA2 8789      STD	Y+9,R24
(1003) 			if (ncl > scl) return 0;	/* No free cluster */
    00AA3 842E      LDD	R2,Y+14
    00AA4 843F      LDD	R3,Y+15
    00AA5 8848      LDD	R4,Y+16
    00AA6 8859      LDD	R5,Y+17
    00AA7 806E      LDD	R6,Y+6
    00AA8 807F      LDD	R7,Y+7
    00AA9 8488      LDD	R8,Y+8
    00AAA 8499      LDD	R9,Y+9
    00AAB 1426      CP	R2,R6
    00AAC 0437      CPC	R3,R7
    00AAD 0448      CPC	R4,R8
    00AAE 0459      CPC	R5,R9
    00AAF F428      BCC	0x0AB5
    00AB0 E000      LDI	R16,0
    00AB1 E010      LDI	R17,0
    00AB2 E020      LDI	R18,0
    00AB3 E030      LDI	R19,0
    00AB4 C0C0      RJMP	0x0B75
(1004) 		}
(1005) 		cs = get_fat(fs, ncl);			/* Get the cluster status */
    00AB5 802E      LDD	R2,Y+6
    00AB6 803F      LDD	R3,Y+7
    00AB7 8448      LDD	R4,Y+8
    00AB8 8459      LDD	R5,Y+9
    00AB9 8248      ST	Y,R4
    00ABA 8259      STD	Y+1,R5
    00ABB 0191      MOVW	R18,R2
    00ABC 0186      MOVW	R16,R12
    00ABD DB82      RCALL	_get_fat
    00ABE 870A      STD	Y+10,R16
    00ABF 871B      STD	Y+11,R17
    00AC0 872C      STD	Y+12,R18
    00AC1 873D      STD	Y+13,R19
(1006) 		if (cs == 0) break;				/* Found a free cluster */
    00AC2 842A      LDD	R2,Y+10
    00AC3 843B      LDD	R3,Y+11
    00AC4 844C      LDD	R4,Y+12
    00AC5 845D      LDD	R5,Y+13
    00AC6 9488      BCLR	0
    00AC7 2022      TST	R2
    00AC8 0432      CPC	R3,R2
    00AC9 0442      CPC	R4,R2
    00ACA 0452      CPC	R5,R2
    00ACB F409      BNE	0x0ACD
    00ACC C02E      RJMP	0x0AFB
(1007) 		if (cs == 0xFFFFFFFF || cs == 1)/* An error occurred */
    00ACD EF4F      LDI	R20,0xFF
    00ACE EF5F      LDI	R21,0xFF
    00ACF EF6F      LDI	R22,0xFF
    00AD0 EF7F      LDI	R23,0xFF
    00AD1 842A      LDD	R2,Y+10
    00AD2 843B      LDD	R3,Y+11
    00AD3 844C      LDD	R4,Y+12
    00AD4 845D      LDD	R5,Y+13
    00AD5 1624      CP	R2,R20
    00AD6 0635      CPC	R3,R21
    00AD7 0646      CPC	R4,R22
    00AD8 0657      CPC	R5,R23
    00AD9 F049      BEQ	0x0AE3
    00ADA E041      LDI	R20,1
    00ADB E050      LDI	R21,0
    00ADC E060      LDI	R22,0
    00ADD E070      LDI	R23,0
    00ADE 1624      CP	R2,R20
    00ADF 0635      CPC	R3,R21
    00AE0 0646      CPC	R4,R22
    00AE1 0657      CPC	R5,R23
    00AE2 F429      BNE	0x0AE8
(1008) 			return cs;
    00AE3 850A      LDD	R16,Y+10
    00AE4 851B      LDD	R17,Y+11
    00AE5 852C      LDD	R18,Y+12
    00AE6 853D      LDD	R19,Y+13
    00AE7 C08D      RJMP	0x0B75
(1009) 		if (ncl == scl) return 0;		/* No free cluster */
    00AE8 842E      LDD	R2,Y+14
    00AE9 843F      LDD	R3,Y+15
    00AEA 8848      LDD	R4,Y+16
    00AEB 8859      LDD	R5,Y+17
    00AEC 806E      LDD	R6,Y+6
    00AED 807F      LDD	R7,Y+7
    00AEE 8488      LDD	R8,Y+8
    00AEF 8499      LDD	R9,Y+9
    00AF0 1462      CP	R6,R2
    00AF1 0473      CPC	R7,R3
    00AF2 0484      CPC	R8,R4
    00AF3 0495      CPC	R9,R5
    00AF4 F009      BEQ	0x0AF6
    00AF5 CF88      RJMP	0x0A7E
    00AF6 E000      LDI	R16,0
    00AF7 E010      LDI	R17,0
    00AF8 E020      LDI	R18,0
    00AF9 E030      LDI	R19,0
    00AFA C07A      RJMP	0x0B75
(1010) 	}
(1011) 
(1012) 	res = put_fat(fs, ncl, 0x0FFFFFFF);	/* Mark the new cluster "last link" */
    00AFB EF8F      LDI	R24,0xFF
    00AFC 838A      STD	Y+2,R24
    00AFD 838B      STD	Y+3,R24
    00AFE 838C      STD	Y+4,R24
    00AFF E08F      LDI	R24,0xF
    00B00 838D      STD	Y+5,R24
    00B01 802E      LDD	R2,Y+6
    00B02 803F      LDD	R3,Y+7
    00B03 8448      LDD	R4,Y+8
    00B04 8459      LDD	R5,Y+9
    00B05 8248      ST	Y,R4
    00B06 8259      STD	Y+1,R5
    00B07 0191      MOVW	R18,R2
    00B08 0186      MOVW	R16,R12
    00B09 DC86      RCALL	_put_fat
    00B0A 2EA0      MOV	R10,R16
(1013) 	if (res == FR_OK && clst != 0) {
    00B0B 2300      TST	R16
    00B0C F4E1      BNE	0x0B29
    00B0D A028      LDD	R2,Y+32
    00B0E A039      LDD	R3,Y+33
    00B0F A04A      LDD	R4,Y+34
    00B10 A05B      LDD	R5,Y+35
    00B11 9488      BCLR	0
    00B12 2022      TST	R2
    00B13 0432      CPC	R3,R2
    00B14 0442      CPC	R4,R2
    00B15 0452      CPC	R5,R2
    00B16 F091      BEQ	0x0B29
(1014) 		res = put_fat(fs, clst, ncl);	/* Link it to the previous one if needed */
    00B17 802E      LDD	R2,Y+6
    00B18 803F      LDD	R3,Y+7
    00B19 8448      LDD	R4,Y+8
    00B1A 8459      LDD	R5,Y+9
    00B1B 822A      STD	Y+2,R2
    00B1C 823B      STD	Y+3,R3
    00B1D 824C      STD	Y+4,R4
    00B1E 825D      STD	Y+5,R5
    00B1F A028      LDD	R2,Y+32
    00B20 A039      LDD	R3,Y+33
    00B21 A04A      LDD	R4,Y+34
    00B22 A05B      LDD	R5,Y+35
    00B23 8248      ST	Y,R4
    00B24 8259      STD	Y+1,R5
    00B25 0191      MOVW	R18,R2
    00B26 0186      MOVW	R16,R12
    00B27 DC68      RCALL	_put_fat
    00B28 2EA0      MOV	R10,R16
(1015) 	}
(1016) 	if (res == FR_OK) {
    00B29 20AA      TST	R10
    00B2A F009      BEQ	0x0B2C
    00B2B C02E      RJMP	0x0B5A
(1017) 		fs->last_clust = ncl;			/* Update FSINFO */
    00B2C 802E      LDD	R2,Y+6
    00B2D 803F      LDD	R3,Y+7
    00B2E 8448      LDD	R4,Y+8
    00B2F 8459      LDD	R5,Y+9
    00B30 01F6      MOVW	R30,R12
    00B31 8622      STD	Z+10,R2
    00B32 8633      STD	Z+11,R3
    00B33 8644      STD	Z+12,R4
    00B34 8655      STD	Z+13,R5
(1018) 		if (fs->free_clust != 0xFFFFFFFF) {
    00B35 EF4F      LDI	R20,0xFF
    00B36 EF5F      LDI	R21,0xFF
    00B37 EF6F      LDI	R22,0xFF
    00B38 EF7F      LDI	R23,0xFF
    00B39 8426      LDD	R2,Z+14
    00B3A 8437      LDD	R3,Z+15
    00B3B 8840      LDD	R4,Z+16
    00B3C 8851      LDD	R5,Z+17
    00B3D 1624      CP	R2,R20
    00B3E 0635      CPC	R3,R21
    00B3F 0646      CPC	R4,R22
    00B40 0657      CPC	R5,R23
    00B41 F179      BEQ	0x0B71
(1019) 			fs->free_clust--;
    00B42 01CF      MOVW	R24,R30
    00B43 960E      ADIW	R24,0xE
    00B44 017C      MOVW	R14,R24
    00B45 E041      LDI	R20,1
    00B46 E050      LDI	R21,0
    00B47 E060      LDI	R22,0
    00B48 E070      LDI	R23,0
    00B49 01FC      MOVW	R30,R24
    00B4A 8020      LD	R2,Z
    00B4B 8031      LDD	R3,Z+1
    00B4C 8042      LDD	R4,Z+2
    00B4D 8053      LDD	R5,Z+3
    00B4E 1A24      SUB	R2,R20
    00B4F 0A35      SBC	R3,R21
    00B50 0A46      SBC	R4,R22
    00B51 0A57      SBC	R5,R23
    00B52 8220      ST	Z,R2
    00B53 8231      STD	Z+1,R3
    00B54 8242      STD	Z+2,R4
    00B55 8253      STD	Z+3,R5
(1020) 			fs->fsi_flag = 1;
    00B56 E081      LDI	R24,1
    00B57 01F6      MOVW	R30,R12
    00B58 8385      STD	Z+5,R24
(1021) 		}
(1022) 	} else {
    00B59 C017      RJMP	0x0B71
(1023) 		ncl = (res == FR_DISK_ERR) ? 0xFFFFFFFF : 1;
    00B5A 2D8A      MOV	R24,R10
    00B5B 3081      CPI	R24,1
    00B5C F431      BNE	0x0B63
    00B5D EF8F      LDI	R24,0xFF
    00B5E 8B8A      STD	Y+18,R24
    00B5F 8B8B      STD	Y+19,R24
    00B60 8B8C      STD	Y+20,R24
    00B61 8B8D      STD	Y+21,R24
    00B62 C006      RJMP	0x0B69
    00B63 E081      LDI	R24,1
    00B64 8B8A      STD	Y+18,R24
    00B65 E080      LDI	R24,0
    00B66 8B8B      STD	Y+19,R24
    00B67 8B8C      STD	Y+20,R24
    00B68 8B8D      STD	Y+21,R24
    00B69 882A      LDD	R2,Y+18
    00B6A 883B      LDD	R3,Y+19
    00B6B 884C      LDD	R4,Y+20
    00B6C 885D      LDD	R5,Y+21
    00B6D 822E      STD	Y+6,R2
    00B6E 823F      STD	Y+7,R3
    00B6F 8648      STD	Y+8,R4
    00B70 8659      STD	Y+9,R5
(1024) 	}
(1025) 
(1026) 	return ncl;		/* Return new cluster number or error code */
    00B71 810E      LDD	R16,Y+6
    00B72 811F      LDD	R17,Y+7
    00B73 8528      LDD	R18,Y+8
    00B74 8539      LDD	R19,Y+9
    00B75 9666      ADIW	R28,0x16
    00B76 940E 4AFC CALL	pop_xgsetF0FC
    00B78 9622      ADIW	R28,2
    00B79 9508      RET
ff.c:clmt_clust:
  tbl                  --> R10
  cl                   --> Y,+4
  ncl                  --> Y,+0
  ofs                  --> Y,+12
  fp                   --> R12
    00B7A 933A      ST	-Y,R19
    00B7B 932A      ST	-Y,R18
    00B7C 940E 4B0D CALL	push_xgset003C
    00B7E 0168      MOVW	R12,R16
    00B7F 9728      SBIW	R28,0x8
(1027) }
(1028) #endif /* !_FS_READONLY */
(1029) 
(1030) 
(1031) 
(1032) /*-----------------------------------------------------------------------*/
(1033) /* FAT handling - Convert offset into cluster with link map table        */
(1034) /*-----------------------------------------------------------------------*/
(1035) 
(1036) #if _USE_FASTSEEK
(1037) static
(1038) DWORD clmt_clust (	/* <2:Error, >=2:Cluster number */
(1039) 	FIL* fp,		/* Pointer to the file object */
(1040) 	DWORD ofs		/* File offset to be converted to cluster# */
(1041) )
(1042) {
(1043) 	DWORD cl, ncl, *tbl;
(1044) 
(1045) 
(1046) 	tbl = fp->cltbl + 1;	/* Top of CLMT */
    00B80 01F6      MOVW	R30,R12
    00B81 96B0      ADIW	R30,0x20
    00B82 8180      LD	R24,Z
    00B83 8191      LDD	R25,Z+1
    00B84 9604      ADIW	R24,4
    00B85 015C      MOVW	R10,R24
(1047) 	cl = ofs / SS(fp->fs) / fp->fs->csize;	/* Cluster order from top of the file */
    00B86 E089      LDI	R24,0x9
    00B87 E090      LDI	R25,0
    00B88 850C      LDD	R16,Y+12
    00B89 851D      LDD	R17,Y+13
    00B8A 852E      LDD	R18,Y+14
    00B8B 853F      LDD	R19,Y+15
    00B8C 938A      ST	-Y,R24
    00B8D 940E 4BAB CALL	lsr32
    00B8F 01F6      MOVW	R30,R12
    00B90 93AF      PUSH	R26
    00B91 93BF      PUSH	R27
    00B92 81A0      LD	R26,Z
    00B93 81B1      LDD	R27,Z+1
    00B94 01FD      MOVW	R30,R26
    00B95 91BF      POP	R27
    00B96 91AF      POP	R26
    00B97 9632      ADIW	R30,2
    00B98 8020      LD	R2,Z
    00B99 2433      CLR	R3
    00B9A 2444      CLR	R4
    00B9B 2455      CLR	R5
    00B9C 925A      ST	-Y,R5
    00B9D 924A      ST	-Y,R4
    00B9E 923A      ST	-Y,R3
    00B9F 922A      ST	-Y,R2
    00BA0 940E 4A0D CALL	div32u
    00BA2 830C      STD	Y+4,R16
    00BA3 831D      STD	Y+5,R17
    00BA4 832E      STD	Y+6,R18
    00BA5 833F      STD	Y+7,R19
(1048) 	for (;;) {
(1049) 		ncl = *tbl++;			/* Number of cluters in the fragment */
    00BA6 01F5      MOVW	R30,R10
    00BA7 9021      LD	R2,Z+
    00BA8 9031      LD	R3,Z+
    00BA9 9041      LD	R4,Z+
    00BAA 9051      LD	R5,Z+
    00BAB 015F      MOVW	R10,R30
    00BAC 8228      ST	Y,R2
    00BAD 8239      STD	Y+1,R3
    00BAE 824A      STD	Y+2,R4
    00BAF 825B      STD	Y+3,R5
(1050) 		if (!ncl) return 0;		/* End of table? (error) */
    00BB0 8028      LD	R2,Y
    00BB1 8039      LDD	R3,Y+1
    00BB2 804A      LDD	R4,Y+2
    00BB3 805B      LDD	R5,Y+3
    00BB4 9488      BCLR	0
    00BB5 2022      TST	R2
    00BB6 0432      CPC	R3,R2
    00BB7 0442      CPC	R4,R2
    00BB8 0452      CPC	R5,R2
    00BB9 F429      BNE	0x0BBF
    00BBA E000      LDI	R16,0
    00BBB E010      LDI	R17,0
    00BBC E020      LDI	R18,0
    00BBD E030      LDI	R19,0
    00BBE C02F      RJMP	0x0BEE
(1051) 		if (cl < ncl) break;	/* In this fragment? */
    00BBF 8028      LD	R2,Y
    00BC0 8039      LDD	R3,Y+1
    00BC1 804A      LDD	R4,Y+2
    00BC2 805B      LDD	R5,Y+3
    00BC3 806C      LDD	R6,Y+4
    00BC4 807D      LDD	R7,Y+5
    00BC5 808E      LDD	R8,Y+6
    00BC6 809F      LDD	R9,Y+7
    00BC7 1462      CP	R6,R2
    00BC8 0473      CPC	R7,R3
    00BC9 0484      CPC	R8,R4
    00BCA 0495      CPC	R9,R5
    00BCB F408      BCC	0x0BCD
    00BCC C014      RJMP	0x0BE1
(1052) 		cl -= ncl; tbl++;		/* Next fragment */
    00BCD 8028      LD	R2,Y
    00BCE 8039      LDD	R3,Y+1
    00BCF 804A      LDD	R4,Y+2
    00BD0 805B      LDD	R5,Y+3
    00BD1 806C      LDD	R6,Y+4
    00BD2 807D      LDD	R7,Y+5
    00BD3 808E      LDD	R8,Y+6
    00BD4 809F      LDD	R9,Y+7
    00BD5 1862      SUB	R6,R2
    00BD6 0873      SBC	R7,R3
    00BD7 0884      SBC	R8,R4
    00BD8 0895      SBC	R9,R5
    00BD9 826C      STD	Y+4,R6
    00BDA 827D      STD	Y+5,R7
    00BDB 828E      STD	Y+6,R8
    00BDC 829F      STD	Y+7,R9
    00BDD 01C5      MOVW	R24,R10
    00BDE 9604      ADIW	R24,4
    00BDF 015C      MOVW	R10,R24
    00BE0 CFC5      RJMP	0x0BA6
(1053) 	}
(1054) 	return cl + *tbl;	/* Return the cluster number */
    00BE1 01F5      MOVW	R30,R10
    00BE2 8020      LD	R2,Z
    00BE3 8031      LDD	R3,Z+1
    00BE4 8042      LDD	R4,Z+2
    00BE5 8053      LDD	R5,Z+3
    00BE6 810C      LDD	R16,Y+4
    00BE7 811D      LDD	R17,Y+5
    00BE8 812E      LDD	R18,Y+6
    00BE9 813F      LDD	R19,Y+7
    00BEA 0D02      ADD	R16,R2
    00BEB 1D13      ADC	R17,R3
    00BEC 1D24      ADC	R18,R4
    00BED 1D35      ADC	R19,R5
    00BEE 9628      ADIW	R28,0x8
    00BEF 940E 4AE7 CALL	pop_xgset003C
    00BF1 9622      ADIW	R28,2
    00BF2 9508      RET
ff.c:dir_sdi:
  ic                   --> R14
  clst                 --> Y,+2
  idx                  --> R12
  dj                   --> R10
    00BF3 940E 4B07 CALL	push_xgsetF0FC
    00BF5 0169      MOVW	R12,R18
    00BF6 0158      MOVW	R10,R16
    00BF7 9726      SBIW	R28,6
(1055) }
(1056) #endif	/* _USE_FASTSEEK */
(1057) 
(1058) 
(1059) 
(1060) /*-----------------------------------------------------------------------*/
(1061) /* Directory handling - Set directory index                              */
(1062) /*-----------------------------------------------------------------------*/
(1063) 
(1064) static
(1065) FRESULT dir_sdi (
(1066) 	DIR *dj,		/* Pointer to directory object */
(1067) 	WORD idx		/* Directory index number */
(1068) )
(1069) {
(1070) 	DWORD clst;
(1071) 	WORD ic;
(1072) 
(1073) 
(1074) 	dj->index = idx;
    00BF8 01F5      MOVW	R30,R10
    00BF9 82D5      STD	Z+5,R13
    00BFA 82C4      STD	Z+4,R12
(1075) 	clst = dj->sclust;
    00BFB 9636      ADIW	R30,6
    00BFC 8020      LD	R2,Z
    00BFD 8031      LDD	R3,Z+1
    00BFE 8042      LDD	R4,Z+2
    00BFF 8053      LDD	R5,Z+3
    00C00 822A      STD	Y+2,R2
    00C01 823B      STD	Y+3,R3
    00C02 824C      STD	Y+4,R4
    00C03 825D      STD	Y+5,R5
(1076) 	if (clst == 1 || clst >= dj->fs->n_fatent)	/* Check start cluster range */
    00C04 E041      LDI	R20,1
    00C05 E050      LDI	R21,0
    00C06 E060      LDI	R22,0
    00C07 E070      LDI	R23,0
    00C08 802A      LDD	R2,Y+2
    00C09 803B      LDD	R3,Y+3
    00C0A 804C      LDD	R4,Y+4
    00C0B 805D      LDD	R5,Y+5
    00C0C 1624      CP	R2,R20
    00C0D 0635      CPC	R3,R21
    00C0E 0646      CPC	R4,R22
    00C0F 0657      CPC	R5,R23
    00C10 F089      BEQ	0x0C22
    00C11 01F5      MOVW	R30,R10
    00C12 81A0      LD	R26,Z
    00C13 81B1      LDD	R27,Z+1
    00C14 9656      ADIW	R26,0x16
    00C15 902D      LD	R2,X+
    00C16 903D      LD	R3,X+
    00C17 904D      LD	R4,X+
    00C18 905C      LD	R5,X
    00C19 806A      LDD	R6,Y+2
    00C1A 807B      LDD	R7,Y+3
    00C1B 808C      LDD	R8,Y+4
    00C1C 809D      LDD	R9,Y+5
    00C1D 1462      CP	R6,R2
    00C1E 0473      CPC	R7,R3
    00C1F 0484      CPC	R8,R4
    00C20 0495      CPC	R9,R5
    00C21 F010      BCS	0x0C24
(1077) 		return FR_INT_ERR;
    00C22 E002      LDI	R16,2
    00C23 C0D6      RJMP	0x0CFA
(1078) 	if (!clst && dj->fs->fs_type == FS_FAT32)	/* Replace cluster# 0 with root cluster# if in FAT32 */
    00C24 802A      LDD	R2,Y+2
    00C25 803B      LDD	R3,Y+3
    00C26 804C      LDD	R4,Y+4
    00C27 805D      LDD	R5,Y+5
    00C28 9488      BCLR	0
    00C29 2022      TST	R2
    00C2A 0432      CPC	R3,R2
    00C2B 0442      CPC	R4,R2
    00C2C 0452      CPC	R5,R2
    00C2D F479      BNE	0x0C3D
    00C2E 01F5      MOVW	R30,R10
    00C2F 81A0      LD	R26,Z
    00C30 81B1      LDD	R27,Z+1
    00C31 918C      LD	R24,X
    00C32 3083      CPI	R24,3
    00C33 F449      BNE	0x0C3D
(1079) 		clst = dj->fs->dirbase;
    00C34 9692      ADIW	R26,0x22
    00C35 902D      LD	R2,X+
    00C36 903D      LD	R3,X+
    00C37 904D      LD	R4,X+
    00C38 905C      LD	R5,X
    00C39 822A      STD	Y+2,R2
    00C3A 823B      STD	Y+3,R3
    00C3B 824C      STD	Y+4,R4
    00C3C 825D      STD	Y+5,R5
(1080) 
(1081) 	if (clst == 0) {	/* Static table (root-dir in FAT12/16) */
    00C3D 802A      LDD	R2,Y+2
    00C3E 803B      LDD	R3,Y+3
    00C3F 804C      LDD	R4,Y+4
    00C40 805D      LDD	R5,Y+5
    00C41 9488      BCLR	0
    00C42 2022      TST	R2
    00C43 0432      CPC	R3,R2
    00C44 0442      CPC	R4,R2
    00C45 0452      CPC	R5,R2
    00C46 F009      BEQ	0x0C48
    00C47 C02B      RJMP	0x0C73
(1082) 		dj->clust = clst;
    00C48 01F5      MOVW	R30,R10
    00C49 8622      STD	Z+10,R2
    00C4A 8633      STD	Z+11,R3
    00C4B 8644      STD	Z+12,R4
    00C4C 8655      STD	Z+13,R5
(1083) 		if (idx >= dj->fs->n_rootdir)		/* Index is out of range */
    00C4D 81A0      LD	R26,Z
    00C4E 81B1      LDD	R27,Z+1
    00C4F 9618      ADIW	R26,0x8
    00C50 902D      LD	R2,X+
    00C51 903C      LD	R3,X
    00C52 14C2      CP	R12,R2
    00C53 04D3      CPC	R13,R3
    00C54 F010      BCS	0x0C57
(1084) 			return FR_INT_ERR;
    00C55 E002      LDI	R16,2
    00C56 C0A3      RJMP	0x0CFA
(1085) 		dj->sect = dj->fs->dirbase + idx / (SS(dj->fs) / SZ_DIR);	/* Sector# */
    00C57 0116      MOVW	R2,R12
    00C58 9436      LSR	R3
    00C59 9427      ROR	R2
    00C5A 9436      LSR	R3
    00C5B 9427      ROR	R2
    00C5C 9436      LSR	R3
    00C5D 9427      ROR	R2
    00C5E 9436      LSR	R3
    00C5F 9427      ROR	R2
    00C60 2444      CLR	R4
    00C61 2455      CLR	R5
    00C62 01F5      MOVW	R30,R10
    00C63 81A0      LD	R26,Z
    00C64 81B1      LDD	R27,Z+1
    00C65 9692      ADIW	R26,0x22
    00C66 906D      LD	R6,X+
    00C67 907D      LD	R7,X+
    00C68 908D      LD	R8,X+
    00C69 909C      LD	R9,X
    00C6A 0C62      ADD	R6,R2
    00C6B 1C73      ADC	R7,R3
    00C6C 1C84      ADC	R8,R4
    00C6D 1C95      ADC	R9,R5
    00C6E 8666      STD	Z+14,R6
    00C6F 8677      STD	Z+15,R7
    00C70 8A80      STD	Z+16,R8
    00C71 8A91      STD	Z+17,R9
(1086) 	}
    00C72 C076      RJMP	0x0CE9
(1087) 	else {				/* Dynamic table (sub-dirs or root-dir in FAT32) */
(1088) 		ic = SS(dj->fs) / SZ_DIR * dj->fs->csize;	/* Entries per cluster */
    00C73 01F5      MOVW	R30,R10
    00C74 93AF      PUSH	R26
    00C75 93BF      PUSH	R27
    00C76 81A0      LD	R26,Z
    00C77 81B1      LDD	R27,Z+1
    00C78 01FD      MOVW	R30,R26
    00C79 91BF      POP	R27
    00C7A 91AF      POP	R26
    00C7B 8022      LDD	R2,Z+2
    00C7C E180      LDI	R24,0x10
    00C7D 9D82      MUL	R24,R2
    00C7E 0170      MOVW	R14,R0
    00C7F C040      RJMP	0x0CC0
(1089) 		while (idx >= ic) {	/* Follow cluster chain */
(1090) 			clst = get_fat(dj->fs, clst);				/* Get next cluster */
    00C80 802A      LDD	R2,Y+2
    00C81 803B      LDD	R3,Y+3
    00C82 804C      LDD	R4,Y+4
    00C83 805D      LDD	R5,Y+5
    00C84 8248      ST	Y,R4
    00C85 8259      STD	Y+1,R5
    00C86 0191      MOVW	R18,R2
    00C87 01F5      MOVW	R30,R10
    00C88 8100      LD	R16,Z
    00C89 8111      LDD	R17,Z+1
    00C8A D9B5      RCALL	_get_fat
    00C8B 830A      STD	Y+2,R16
    00C8C 831B      STD	Y+3,R17
    00C8D 832C      STD	Y+4,R18
    00C8E 833D      STD	Y+5,R19
(1091) 			if (clst == 0xFFFFFFFF) return FR_DISK_ERR;	/* Disk error */
    00C8F EF4F      LDI	R20,0xFF
    00C90 EF5F      LDI	R21,0xFF
    00C91 EF6F      LDI	R22,0xFF
    00C92 EF7F      LDI	R23,0xFF
    00C93 802A      LDD	R2,Y+2
    00C94 803B      LDD	R3,Y+3
    00C95 804C      LDD	R4,Y+4
    00C96 805D      LDD	R5,Y+5
    00C97 1624      CP	R2,R20
    00C98 0635      CPC	R3,R21
    00C99 0646      CPC	R4,R22
    00C9A 0657      CPC	R5,R23
    00C9B F411      BNE	0x0C9E
    00C9C E001      LDI	R16,1
    00C9D C05C      RJMP	0x0CFA
(1092) 			if (clst < 2 || clst >= dj->fs->n_fatent)	/* Reached to end of table or int error */
    00C9E E042      LDI	R20,2
    00C9F E050      LDI	R21,0
    00CA0 E060      LDI	R22,0
    00CA1 E070      LDI	R23,0
    00CA2 802A      LDD	R2,Y+2
    00CA3 803B      LDD	R3,Y+3
    00CA4 804C      LDD	R4,Y+4
    00CA5 805D      LDD	R5,Y+5
    00CA6 1624      CP	R2,R20
    00CA7 0635      CPC	R3,R21
    00CA8 0646      CPC	R4,R22
    00CA9 0657      CPC	R5,R23
    00CAA F088      BCS	0x0CBC
    00CAB 01F5      MOVW	R30,R10
    00CAC 81A0      LD	R26,Z
    00CAD 81B1      LDD	R27,Z+1
    00CAE 9656      ADIW	R26,0x16
    00CAF 902D      LD	R2,X+
    00CB0 903D      LD	R3,X+
    00CB1 904D      LD	R4,X+
    00CB2 905C      LD	R5,X
    00CB3 806A      LDD	R6,Y+2
    00CB4 807B      LDD	R7,Y+3
    00CB5 808C      LDD	R8,Y+4
    00CB6 809D      LDD	R9,Y+5
    00CB7 1462      CP	R6,R2
    00CB8 0473      CPC	R7,R3
    00CB9 0484      CPC	R8,R4
    00CBA 0495      CPC	R9,R5
    00CBB F010      BCS	0x0CBE
(1093) 				return FR_INT_ERR;
    00CBC E002      LDI	R16,2
    00CBD C03C      RJMP	0x0CFA
(1094) 			idx -= ic;
    00CBE 18CE      SUB	R12,R14
    00CBF 08DF      SBC	R13,R15
    00CC0 14CE      CP	R12,R14
    00CC1 04DF      CPC	R13,R15
    00CC2 F008      BCS	0x0CC4
    00CC3 CFBC      RJMP	0x0C80
(1095) 		}
(1096) 		dj->clust = clst;
    00CC4 802A      LDD	R2,Y+2
    00CC5 803B      LDD	R3,Y+3
    00CC6 804C      LDD	R4,Y+4
    00CC7 805D      LDD	R5,Y+5
    00CC8 01F5      MOVW	R30,R10
    00CC9 8622      STD	Z+10,R2
    00CCA 8633      STD	Z+11,R3
    00CCB 8644      STD	Z+12,R4
    00CCC 8655      STD	Z+13,R5
(1097) 		dj->sect = clust2sect(dj->fs, clst) + idx / (SS(dj->fs) / SZ_DIR);	/* Sector# */
    00CCD 8248      ST	Y,R4
    00CCE 8259      STD	Y+1,R5
    00CCF 0191      MOVW	R18,R2
    00CD0 8100      LD	R16,Z
    00CD1 8111      LDD	R17,Z+1
    00CD2 D91B      RCALL	_clust2sect
    00CD3 0116      MOVW	R2,R12
    00CD4 9436      LSR	R3
    00CD5 9427      ROR	R2
    00CD6 9436      LSR	R3
    00CD7 9427      ROR	R2
    00CD8 9436      LSR	R3
    00CD9 9427      ROR	R2
    00CDA 9436      LSR	R3
    00CDB 9427      ROR	R2
    00CDC 2444      CLR	R4
    00CDD 2455      CLR	R5
    00CDE 0138      MOVW	R6,R16
    00CDF 0149      MOVW	R8,R18
    00CE0 0C62      ADD	R6,R2
    00CE1 1C73      ADC	R7,R3
    00CE2 1C84      ADC	R8,R4
    00CE3 1C95      ADC	R9,R5
    00CE4 01F5      MOVW	R30,R10
    00CE5 8666      STD	Z+14,R6
    00CE6 8677      STD	Z+15,R7
    00CE7 8A80      STD	Z+16,R8
    00CE8 8A91      STD	Z+17,R9
(1098) 	}
(1099) 
(1100) 	dj->dir = dj->fs->win + (idx % (SS(dj->fs) / SZ_DIR)) * SZ_DIR;	/* Ptr to the entry in the sector */
    00CE9 0196      MOVW	R18,R12
    00CEA 702F      ANDI	R18,0xF
    00CEB 7030      ANDI	R19,0
    00CEC E200      LDI	R16,0x20
    00CED E010      LDI	R17,0
    00CEE 940E 4AA3 CALL	empy16s
    00CF0 0118      MOVW	R2,R16
    00CF1 01F5      MOVW	R30,R10
    00CF2 8180      LD	R24,Z
    00CF3 8191      LDD	R25,Z+1
    00CF4 968E      ADIW	R24,0x2E
    00CF5 0E28      ADD	R2,R24
    00CF6 1E39      ADC	R3,R25
    00CF7 8A33      STD	Z+19,R3
    00CF8 8A22      STD	Z+18,R2
(1101) 
(1102) 	return FR_OK;	/* Seek succeeded */
    00CF9 2700      CLR	R16
    00CFA 9626      ADIW	R28,6
    00CFB 940C 4AFC JMP	pop_xgsetF0FC
ff.c:dir_next:
  c                    --> R10
  clst                 --> Y,+2
  i                    --> R12
  stretch              --> R10
  dj                   --> Y,+16
    00CFD 940E 49C2 CALL	push_arg4
    00CFF 940E 4B07 CALL	push_xgsetF0FC
    00D01 0159      MOVW	R10,R18
    00D02 9726      SBIW	R28,6
(1103) }
(1104) 
(1105) 
(1106) 
(1107) 
(1108) /*-----------------------------------------------------------------------*/
(1109) /* Directory handling - Move directory index next                        */
(1110) /*-----------------------------------------------------------------------*/
(1111) 
(1112) static
(1113) FRESULT dir_next (	/* FR_OK:Succeeded, FR_NO_FILE:End of table, FR_DENIED:EOT and could not stretch */
(1114) 	DIR *dj,		/* Pointer to directory object */
(1115) 	int stretch		/* 0: Do not stretch table, 1: Stretch table if needed */
(1116) )
(1117) {
(1118) 	DWORD clst;
(1119) 	WORD i;
(1120) 
(1121) 
(1122) 	stretch = stretch;		/* To suppress warning on read-only cfg. */
(1123) 	i = dj->index + 1;
    00D03 89E8      LDD	R30,Y+16
    00D04 89F9      LDD	R31,Y+17
    00D05 8184      LDD	R24,Z+4
    00D06 8195      LDD	R25,Z+5
    00D07 9601      ADIW	R24,1
    00D08 016C      MOVW	R12,R24
(1124) 	if (!i || !dj->sect)	/* Report EOT when index has reached 65535 */
    00D09 3080      CPI	R24,0
    00D0A 0789      CPC	R24,R25
    00D0B F059      BEQ	0x0D17
    00D0C 963E      ADIW	R30,0xE
    00D0D 8020      LD	R2,Z
    00D0E 8031      LDD	R3,Z+1
    00D0F 8042      LDD	R4,Z+2
    00D10 8053      LDD	R5,Z+3
    00D11 9488      BCLR	0
    00D12 2022      TST	R2
    00D13 0432      CPC	R3,R2
    00D14 0442      CPC	R4,R2
    00D15 0452      CPC	R5,R2
    00D16 F411      BNE	0x0D19
(1125) 		return FR_NO_FILE;
    00D17 E004      LDI	R16,4
    00D18 C18D      RJMP	0x0EA6
(1126) 
(1127) 	if (!(i % (SS(dj->fs) / SZ_DIR))) {	/* Sector changed? */
    00D19 01C6      MOVW	R24,R12
    00D1A 708F      ANDI	R24,0xF
    00D1B 7090      ANDI	R25,0
    00D1C 3080      CPI	R24,0
    00D1D 0789      CPC	R24,R25
    00D1E F009      BEQ	0x0D20
    00D1F C170      RJMP	0x0E90
(1128) 		dj->sect++;					/* Next sector */
    00D20 8988      LDD	R24,Y+16
    00D21 8999      LDD	R25,Y+17
    00D22 960E      ADIW	R24,0xE
    00D23 E041      LDI	R20,1
    00D24 E050      LDI	R21,0
    00D25 E060      LDI	R22,0
    00D26 E070      LDI	R23,0
    00D27 01FC      MOVW	R30,R24
    00D28 8020      LD	R2,Z
    00D29 8031      LDD	R3,Z+1
    00D2A 8042      LDD	R4,Z+2
    00D2B 8053      LDD	R5,Z+3
    00D2C 0E24      ADD	R2,R20
    00D2D 1E35      ADC	R3,R21
    00D2E 1E46      ADC	R4,R22
    00D2F 1E57      ADC	R5,R23
    00D30 8220      ST	Z,R2
    00D31 8231      STD	Z+1,R3
    00D32 8242      STD	Z+2,R4
    00D33 8253      STD	Z+3,R5
(1129) 
(1130) 		if (dj->clust == 0) {	/* Static table */
    00D34 89E8      LDD	R30,Y+16
    00D35 89F9      LDD	R31,Y+17
    00D36 963A      ADIW	R30,0xA
    00D37 8020      LD	R2,Z
    00D38 8031      LDD	R3,Z+1
    00D39 8042      LDD	R4,Z+2
    00D3A 8053      LDD	R5,Z+3
    00D3B 9488      BCLR	0
    00D3C 2022      TST	R2
    00D3D 0432      CPC	R3,R2
    00D3E 0442      CPC	R4,R2
    00D3F 0452      CPC	R5,R2
    00D40 F469      BNE	0x0D4E
(1131) 			if (i >= dj->fs->n_rootdir)	/* Report EOT when end of table */
    00D41 89E8      LDD	R30,Y+16
    00D42 89F9      LDD	R31,Y+17
    00D43 81A0      LD	R26,Z
    00D44 81B1      LDD	R27,Z+1
    00D45 9618      ADIW	R26,0x8
    00D46 902D      LD	R2,X+
    00D47 903C      LD	R3,X
    00D48 14C2      CP	R12,R2
    00D49 04D3      CPC	R13,R3
    00D4A F408      BCC	0x0D4C
    00D4B C144      RJMP	0x0E90
(1132) 				return FR_NO_FILE;
    00D4C E004      LDI	R16,4
    00D4D C158      RJMP	0x0EA6
(1133) 		}
(1134) 		else {					/* Dynamic table */
(1135) 			if (((i / (SS(dj->fs) / SZ_DIR)) & (dj->fs->csize - 1)) == 0) {	/* Cluster changed? */
    00D4E 89E8      LDD	R30,Y+16
    00D4F 89F9      LDD	R31,Y+17
    00D50 93AF      PUSH	R26
    00D51 93BF      PUSH	R27
    00D52 81A0      LD	R26,Z
    00D53 81B1      LDD	R27,Z+1
    00D54 01FD      MOVW	R30,R26
    00D55 91BF      POP	R27
    00D56 91AF      POP	R26
    00D57 8182      LDD	R24,Z+2
    00D58 2799      CLR	R25
    00D59 9701      SBIW	R24,1
    00D5A 0116      MOVW	R2,R12
    00D5B 9436      LSR	R3
    00D5C 9427      ROR	R2
    00D5D 9436      LSR	R3
    00D5E 9427      ROR	R2
    00D5F 9436      LSR	R3
    00D60 9427      ROR	R2
    00D61 9436      LSR	R3
    00D62 9427      ROR	R2
    00D63 2228      AND	R2,R24
    00D64 2239      AND	R3,R25
    00D65 2022      TST	R2
    00D66 F009      BEQ	0x0D68
    00D67 C128      RJMP	0x0E90
    00D68 2033      TST	R3
    00D69 F009      BEQ	0x0D6B
    00D6A C125      RJMP	0x0E90
(1136) 				clst = get_fat(dj->fs, dj->clust);				/* Get next cluster */
    00D6B 89E8      LDD	R30,Y+16
    00D6C 89F9      LDD	R31,Y+17
    00D6D 8422      LDD	R2,Z+10
    00D6E 8433      LDD	R3,Z+11
    00D6F 8444      LDD	R4,Z+12
    00D70 8455      LDD	R5,Z+13
    00D71 8248      ST	Y,R4
    00D72 8259      STD	Y+1,R5
    00D73 0191      MOVW	R18,R2
    00D74 8100      LD	R16,Z
    00D75 8111      LDD	R17,Z+1
    00D76 D8C9      RCALL	_get_fat
    00D77 830A      STD	Y+2,R16
    00D78 831B      STD	Y+3,R17
    00D79 832C      STD	Y+4,R18
    00D7A 833D      STD	Y+5,R19
(1137) 				if (clst <= 1) return FR_INT_ERR;
    00D7B E041      LDI	R20,1
    00D7C E050      LDI	R21,0
    00D7D E060      LDI	R22,0
    00D7E E070      LDI	R23,0
    00D7F 802A      LDD	R2,Y+2
    00D80 803B      LDD	R3,Y+3
    00D81 804C      LDD	R4,Y+4
    00D82 805D      LDD	R5,Y+5
    00D83 1542      CP	R20,R2
    00D84 0553      CPC	R21,R3
    00D85 0564      CPC	R22,R4
    00D86 0575      CPC	R23,R5
    00D87 F010      BCS	0x0D8A
    00D88 E002      LDI	R16,2
    00D89 C11C      RJMP	0x0EA6
(1138) 				if (clst == 0xFFFFFFFF) return FR_DISK_ERR;
    00D8A EF4F      LDI	R20,0xFF
    00D8B EF5F      LDI	R21,0xFF
    00D8C EF6F      LDI	R22,0xFF
    00D8D EF7F      LDI	R23,0xFF
    00D8E 802A      LDD	R2,Y+2
    00D8F 803B      LDD	R3,Y+3
    00D90 804C      LDD	R4,Y+4
    00D91 805D      LDD	R5,Y+5
    00D92 1624      CP	R2,R20
    00D93 0635      CPC	R3,R21
    00D94 0646      CPC	R4,R22
    00D95 0657      CPC	R5,R23
    00D96 F411      BNE	0x0D99
    00D97 E001      LDI	R16,1
    00D98 C10D      RJMP	0x0EA6
(1139) 				if (clst >= dj->fs->n_fatent) {					/* When it reached end of dynamic table */
    00D99 89E8      LDD	R30,Y+16
    00D9A 89F9      LDD	R31,Y+17
    00D9B 81A0      LD	R26,Z
    00D9C 81B1      LDD	R27,Z+1
    00D9D 9656      ADIW	R26,0x16
    00D9E 902D      LD	R2,X+
    00D9F 903D      LD	R3,X+
    00DA0 904D      LD	R4,X+
    00DA1 905C      LD	R5,X
    00DA2 806A      LDD	R6,Y+2
    00DA3 807B      LDD	R7,Y+3
    00DA4 808C      LDD	R8,Y+4
    00DA5 809D      LDD	R9,Y+5
    00DA6 1462      CP	R6,R2
    00DA7 0473      CPC	R7,R3
    00DA8 0484      CPC	R8,R4
    00DA9 0495      CPC	R9,R5
    00DAA F408      BCC	0x0DAC
    00DAB C0CD      RJMP	0x0E79
(1140) #if !_FS_READONLY
(1141) 					BYTE c;
(1142) 					if (!stretch) return FR_NO_FILE;			/* When do not stretch, report EOT */
    00DAC 20AA      TST	R10
    00DAD F421      BNE	0x0DB2
    00DAE 20BB      TST	R11
    00DAF F411      BNE	0x0DB2
    00DB0 E004      LDI	R16,4
    00DB1 C0F4      RJMP	0x0EA6
(1143) 					clst = create_chain(dj->fs, dj->clust);		/* Stretch cluster chain */
    00DB2 89E8      LDD	R30,Y+16
    00DB3 89F9      LDD	R31,Y+17
    00DB4 8422      LDD	R2,Z+10
    00DB5 8433      LDD	R3,Z+11
    00DB6 8444      LDD	R4,Z+12
    00DB7 8455      LDD	R5,Z+13
    00DB8 8248      ST	Y,R4
    00DB9 8259      STD	Y+1,R5
    00DBA 0191      MOVW	R18,R2
    00DBB 8100      LD	R16,Z
    00DBC 8111      LDD	R17,Z+1
    00DBD DC44      RCALL	ff.c:create_chain
    00DBE 830A      STD	Y+2,R16
    00DBF 831B      STD	Y+3,R17
    00DC0 832C      STD	Y+4,R18
    00DC1 833D      STD	Y+5,R19
(1144) 					if (clst == 0) return FR_DENIED;			/* No free cluster */
    00DC2 802A      LDD	R2,Y+2
    00DC3 803B      LDD	R3,Y+3
    00DC4 804C      LDD	R4,Y+4
    00DC5 805D      LDD	R5,Y+5
    00DC6 9488      BCLR	0
    00DC7 2022      TST	R2
    00DC8 0432      CPC	R3,R2
    00DC9 0442      CPC	R4,R2
    00DCA 0452      CPC	R5,R2
    00DCB F411      BNE	0x0DCE
    00DCC E007      LDI	R16,7
    00DCD C0D8      RJMP	0x0EA6
(1145) 					if (clst == 1) return FR_INT_ERR;
    00DCE E041      LDI	R20,1
    00DCF E050      LDI	R21,0
    00DD0 E060      LDI	R22,0
    00DD1 E070      LDI	R23,0
    00DD2 802A      LDD	R2,Y+2
    00DD3 803B      LDD	R3,Y+3
    00DD4 804C      LDD	R4,Y+4
    00DD5 805D      LDD	R5,Y+5
    00DD6 1624      CP	R2,R20
    00DD7 0635      CPC	R3,R21
    00DD8 0646      CPC	R4,R22
    00DD9 0657      CPC	R5,R23
    00DDA F411      BNE	0x0DDD
    00DDB E002      LDI	R16,2
    00DDC C0C9      RJMP	0x0EA6
(1146) 					if (clst == 0xFFFFFFFF) return FR_DISK_ERR;
    00DDD EF4F      LDI	R20,0xFF
    00DDE EF5F      LDI	R21,0xFF
    00DDF EF6F      LDI	R22,0xFF
    00DE0 EF7F      LDI	R23,0xFF
    00DE1 802A      LDD	R2,Y+2
    00DE2 803B      LDD	R3,Y+3
    00DE3 804C      LDD	R4,Y+4
    00DE4 805D      LDD	R5,Y+5
    00DE5 1624      CP	R2,R20
    00DE6 0635      CPC	R3,R21
    00DE7 0646      CPC	R4,R22
    00DE8 0657      CPC	R5,R23
    00DE9 F411      BNE	0x0DEC
    00DEA E001      LDI	R16,1
    00DEB C0BA      RJMP	0x0EA6
(1147) 					/* Clean-up stretched table */
(1148) 					if (move_window(dj->fs, 0)) return FR_DISK_ERR;	/* Flush active window */
    00DEC E040      LDI	R20,0
    00DED E050      LDI	R21,0
    00DEE E060      LDI	R22,0
    00DEF E070      LDI	R23,0
    00DF0 8368      ST	Y,R22
    00DF1 8379      STD	Y+1,R23
    00DF2 019A      MOVW	R18,R20
    00DF3 89E8      LDD	R30,Y+16
    00DF4 89F9      LDD	R31,Y+17
    00DF5 8100      LD	R16,Z
    00DF6 8111      LDD	R17,Z+1
    00DF7 940E 0477 CALL	ff.c:move_window
    00DF9 2300      TST	R16
    00DFA F011      BEQ	0x0DFD
    00DFB E001      LDI	R16,1
    00DFC C0A9      RJMP	0x0EA6
(1149) 					mem_set(dj->fs->win, 0, SS(dj->fs));			/* Clear window buffer */
    00DFD E080      LDI	R24,0
    00DFE E092      LDI	R25,2
    00DFF 8399      STD	Y+1,R25
    00E00 8388      ST	Y,R24
    00E01 2722      CLR	R18
    00E02 2733      CLR	R19
    00E03 89E8      LDD	R30,Y+16
    00E04 89F9      LDD	R31,Y+17
    00E05 8100      LD	R16,Z
    00E06 8111      LDD	R17,Z+1
    00E07 5D02      SUBI	R16,0xD2
    00E08 4F1F      SBCI	R17,0xFF
    00E09 940E 0434 CALL	ff.c:mem_set
(1150) 					dj->fs->winsect = clust2sect(dj->fs, clst);	/* Cluster start sector */
    00E0B 802A      LDD	R2,Y+2
    00E0C 803B      LDD	R3,Y+3
    00E0D 804C      LDD	R4,Y+4
    00E0E 805D      LDD	R5,Y+5
    00E0F 8248      ST	Y,R4
    00E10 8259      STD	Y+1,R5
    00E11 0191      MOVW	R18,R2
    00E12 89E8      LDD	R30,Y+16
    00E13 89F9      LDD	R31,Y+17
    00E14 80A0      LD	R10,Z
    00E15 80B1      LDD	R11,Z+1
    00E16 0185      MOVW	R16,R10
    00E17 940E 05EE CALL	_clust2sect
    00E19 01F5      MOVW	R30,R10
    00E1A A702      STD	Z+42,R16
    00E1B A713      STD	Z+43,R17
    00E1C A724      STD	Z+44,R18
    00E1D A735      STD	Z+45,R19
(1151) 					for (c = 0; c < dj->fs->csize; c++) {		/* Fill the new cluster with 0 */
    00E1E 24AA      CLR	R10
    00E1F C035      RJMP	0x0E55
(1152) 						dj->fs->wflag = 1;
    00E20 E081      LDI	R24,1
    00E21 89E8      LDD	R30,Y+16
    00E22 89F9      LDD	R31,Y+17
    00E23 93AF      PUSH	R26
    00E24 93BF      PUSH	R27
    00E25 81A0      LD	R26,Z
    00E26 81B1      LDD	R27,Z+1
    00E27 01FD      MOVW	R30,R26
    00E28 91BF      POP	R27
    00E29 91AF      POP	R26
    00E2A 8384      STD	Z+4,R24
(1153) 						if (move_window(dj->fs, 0)) return FR_DISK_ERR;
    00E2B E040      LDI	R20,0
    00E2C E050      LDI	R21,0
    00E2D E060      LDI	R22,0
    00E2E E070      LDI	R23,0
    00E2F 8368      ST	Y,R22
    00E30 8379      STD	Y+1,R23
    00E31 019A      MOVW	R18,R20
    00E32 89E8      LDD	R30,Y+16
    00E33 89F9      LDD	R31,Y+17
    00E34 8100      LD	R16,Z
    00E35 8111      LDD	R17,Z+1
    00E36 940E 0477 CALL	ff.c:move_window
    00E38 2EE0      MOV	R14,R16
    00E39 2300      TST	R16
    00E3A F011      BEQ	0x0E3D
    00E3B E001      LDI	R16,1
    00E3C C069      RJMP	0x0EA6
(1154) 						dj->fs->winsect++;
    00E3D 89E8      LDD	R30,Y+16
    00E3E 89F9      LDD	R31,Y+17
    00E3F 8180      LD	R24,Z
    00E40 8191      LDD	R25,Z+1
    00E41 968A      ADIW	R24,0x2A
    00E42 017C      MOVW	R14,R24
    00E43 E041      LDI	R20,1
    00E44 E050      LDI	R21,0
    00E45 E060      LDI	R22,0
    00E46 E070      LDI	R23,0
    00E47 01FC      MOVW	R30,R24
    00E48 8020      LD	R2,Z
    00E49 8031      LDD	R3,Z+1
    00E4A 8042      LDD	R4,Z+2
    00E4B 8053      LDD	R5,Z+3
    00E4C 0E24      ADD	R2,R20
    00E4D 1E35      ADC	R3,R21
    00E4E 1E46      ADC	R4,R22
    00E4F 1E57      ADC	R5,R23
    00E50 8220      ST	Z,R2
    00E51 8231      STD	Z+1,R3
    00E52 8242      STD	Z+2,R4
    00E53 8253      STD	Z+3,R5
    00E54 94A3      INC	R10
    00E55 89E8      LDD	R30,Y+16
    00E56 89F9      LDD	R31,Y+17
    00E57 93AF      PUSH	R26
    00E58 93BF      PUSH	R27
    00E59 81A0      LD	R26,Z
    00E5A 81B1      LDD	R27,Z+1
    00E5B 01FD      MOVW	R30,R26
    00E5C 91BF      POP	R27
    00E5D 91AF      POP	R26
    00E5E 8022      LDD	R2,Z+2
    00E5F 14A2      CP	R10,R2
    00E60 F408      BCC	0x0E62
    00E61 CFBE      RJMP	0x0E20
(1155) 					}
(1156) 					dj->fs->winsect -= c;						/* Rewind window address */
    00E62 89E8      LDD	R30,Y+16
    00E63 89F9      LDD	R31,Y+17
    00E64 8180      LD	R24,Z
    00E65 8191      LDD	R25,Z+1
    00E66 968A      ADIW	R24,0x2A
    00E67 017C      MOVW	R14,R24
    00E68 2C2A      MOV	R2,R10
    00E69 2433      CLR	R3
    00E6A 2444      CLR	R4
    00E6B 2455      CLR	R5
    00E6C 01FC      MOVW	R30,R24
    00E6D 8060      LD	R6,Z
    00E6E 8071      LDD	R7,Z+1
    00E6F 8082      LDD	R8,Z+2
    00E70 8093      LDD	R9,Z+3
    00E71 1862      SUB	R6,R2
    00E72 0873      SBC	R7,R3
    00E73 0884      SBC	R8,R4
    00E74 0895      SBC	R9,R5
    00E75 8260      ST	Z,R6
    00E76 8271      STD	Z+1,R7
    00E77 8282      STD	Z+2,R8
    00E78 8293      STD	Z+3,R9
(1157) #else
(1158) 					return FR_NO_FILE;			/* Report EOT */
(1159) #endif
(1160) 				}
(1161) 				dj->clust = clst;				/* Initialize data for new cluster */
    00E79 802A      LDD	R2,Y+2
    00E7A 803B      LDD	R3,Y+3
    00E7B 804C      LDD	R4,Y+4
    00E7C 805D      LDD	R5,Y+5
    00E7D 89E8      LDD	R30,Y+16
    00E7E 89F9      LDD	R31,Y+17
    00E7F 8622      STD	Z+10,R2
    00E80 8633      STD	Z+11,R3
    00E81 8644      STD	Z+12,R4
    00E82 8655      STD	Z+13,R5
(1162) 				dj->sect = clust2sect(dj->fs, clst);
    00E83 8248      ST	Y,R4
    00E84 8259      STD	Y+1,R5
    00E85 0191      MOVW	R18,R2
    00E86 8100      LD	R16,Z
    00E87 8111      LDD	R17,Z+1
    00E88 940E 05EE CALL	_clust2sect
    00E8A 89E8      LDD	R30,Y+16
    00E8B 89F9      LDD	R31,Y+17
    00E8C 8706      STD	Z+14,R16
    00E8D 8717      STD	Z+15,R17
    00E8E 8B20      STD	Z+16,R18
    00E8F 8B31      STD	Z+17,R19
(1163) 			}
(1164) 		}
(1165) 	}
(1166) 
(1167) 	dj->index = i;
    00E90 89E8      LDD	R30,Y+16
    00E91 89F9      LDD	R31,Y+17
    00E92 82D5      STD	Z+5,R13
    00E93 82C4      STD	Z+4,R12
(1168) 	dj->dir = dj->fs->win + (i % (SS(dj->fs) / SZ_DIR)) * SZ_DIR;
    00E94 0196      MOVW	R18,R12
    00E95 702F      ANDI	R18,0xF
    00E96 7030      ANDI	R19,0
    00E97 E200      LDI	R16,0x20
    00E98 E010      LDI	R17,0
    00E99 940E 4AA3 CALL	empy16s
    00E9B 0118      MOVW	R2,R16
    00E9C 89E8      LDD	R30,Y+16
    00E9D 89F9      LDD	R31,Y+17
    00E9E 8180      LD	R24,Z
    00E9F 8191      LDD	R25,Z+1
    00EA0 968E      ADIW	R24,0x2E
    00EA1 0E28      ADD	R2,R24
    00EA2 1E39      ADC	R3,R25
    00EA3 8A33      STD	Z+19,R3
    00EA4 8A22      STD	Z+18,R2
(1169) 
(1170) 	return FR_OK;
    00EA5 2700      CLR	R16
    00EA6 9626      ADIW	R28,6
    00EA7 940E 4AFC CALL	pop_xgsetF0FC
    00EA9 9624      ADIW	R28,4
    00EAA 9508      RET
ff.c:dir_find:
  c                    --> R12
  dir                  --> R10
  res                  --> R20
  dj                   --> R22
    00EAB 940E 4B42 CALL	push_xgsetF03C
    00EAD 01B8      MOVW	R22,R16
    00EAE 9722      SBIW	R28,2
(1171) }
(1172) 
(1173) 
(1174) 
(1175) 
(1176) /*-----------------------------------------------------------------------*/
(1177) /* LFN handling - Test/Pick/Fit an LFN segment from/to directory entry   */
(1178) /*-----------------------------------------------------------------------*/
(1179) #if _USE_LFN
(1180) static
(1181) const BYTE LfnOfs[] = {1,3,5,7,9,14,16,18,20,22,24,28,30};	/* Offset of LFN chars in the directory entry */
(1182) 
(1183) 
(1184) static
(1185) int cmp_lfn (			/* 1:Matched, 0:Not matched */
(1186) 	WCHAR *lfnbuf,		/* Pointer to the LFN to be compared */
(1187) 	BYTE *dir			/* Pointer to the directory entry containing a part of LFN */
(1188) )
(1189) {
(1190) 	UINT i, s;
(1191) 	WCHAR wc, uc;
(1192) 
(1193) 
(1194) 	i = ((dir[LDIR_Ord] & ~LLE) - 1) * 13;	/* Get offset in the LFN buffer */
(1195) 	s = 0; wc = 1;
(1196) 	do {
(1197) 		uc = LD_WORD(dir+LfnOfs[s]);	/* Pick an LFN character from the entry */
(1198) 		if (wc) {	/* Last char has not been processed */
(1199) 			wc = ff_wtoupper(uc);		/* Convert it to upper case */
(1200) 			if (i >= _MAX_LFN || wc != ff_wtoupper(lfnbuf[i++]))	/* Compare it */
(1201) 				return 0;				/* Not matched */
(1202) 		} else {
(1203) 			if (uc != 0xFFFF) return 0;	/* Check filler */
(1204) 		}
(1205) 	} while (++s < 13);				/* Repeat until all chars in the entry are checked */
(1206) 
(1207) 	if ((dir[LDIR_Ord] & LLE) && wc && lfnbuf[i])	/* Last segment matched but different length */
(1208) 		return 0;
(1209) 
(1210) 	return 1;						/* The part of LFN matched */
(1211) }
(1212) 
(1213) 
(1214) 
(1215) static
(1216) int pick_lfn (			/* 1:Succeeded, 0:Buffer overflow */
(1217) 	WCHAR *lfnbuf,		/* Pointer to the Unicode-LFN buffer */
(1218) 	BYTE *dir			/* Pointer to the directory entry */
(1219) )
(1220) {
(1221) 	UINT i, s;
(1222) 	WCHAR wc, uc;
(1223) 
(1224) 
(1225) 	i = ((dir[LDIR_Ord] & 0x3F) - 1) * 13;	/* Offset in the LFN buffer */
(1226) 
(1227) 	s = 0; wc = 1;
(1228) 	do {
(1229) 		uc = LD_WORD(dir+LfnOfs[s]);		/* Pick an LFN character from the entry */
(1230) 		if (wc) {	/* Last char has not been processed */
(1231) 			if (i >= _MAX_LFN) return 0;	/* Buffer overflow? */
(1232) 			lfnbuf[i++] = wc = uc;			/* Store it */
(1233) 		} else {
(1234) 			if (uc != 0xFFFF) return 0;		/* Check filler */
(1235) 		}
(1236) 	} while (++s < 13);						/* Read all character in the entry */
(1237) 
(1238) 	if (dir[LDIR_Ord] & LLE) {				/* Put terminator if it is the last LFN part */
(1239) 		if (i >= _MAX_LFN) return 0;		/* Buffer overflow? */
(1240) 		lfnbuf[i] = 0;
(1241) 	}
(1242) 
(1243) 	return 1;
(1244) }
(1245) 
(1246) 
(1247) #if !_FS_READONLY
(1248) static
(1249) void fit_lfn (
(1250) 	const WCHAR *lfnbuf,	/* Pointer to the LFN buffer */
(1251) 	BYTE *dir,				/* Pointer to the directory entry */
(1252) 	BYTE ord,				/* LFN order (1-20) */
(1253) 	BYTE sum				/* SFN sum */
(1254) )
(1255) {
(1256) 	UINT i, s;
(1257) 	WCHAR wc;
(1258) 
(1259) 
(1260) 	dir[LDIR_Chksum] = sum;			/* Set check sum */
(1261) 	dir[LDIR_Attr] = AM_LFN;		/* Set attribute. LFN entry */
(1262) 	dir[LDIR_Type] = 0;
(1263) 	ST_WORD(dir+LDIR_FstClusLO, 0);
(1264) 
(1265) 	i = (ord - 1) * 13;				/* Get offset in the LFN buffer */
(1266) 	s = wc = 0;
(1267) 	do {
(1268) 		if (wc != 0xFFFF) wc = lfnbuf[i++];	/* Get an effective char */
(1269) 		ST_WORD(dir+LfnOfs[s], wc);	/* Put it */
(1270) 		if (!wc) wc = 0xFFFF;		/* Padding chars following last char */
(1271) 	} while (++s < 13);
(1272) 	if (wc == 0xFFFF || !lfnbuf[i]) ord |= LLE;	/* Bottom LFN part is the start of LFN sequence */
(1273) 	dir[LDIR_Ord] = ord;			/* Set the LFN order */
(1274) }
(1275) 
(1276) #endif
(1277) #endif
(1278) 
(1279) 
(1280) 
(1281) /*-----------------------------------------------------------------------*/
(1282) /* Create numbered name                                                  */
(1283) /*-----------------------------------------------------------------------*/
(1284) #if _USE_LFN
(1285) void gen_numname (
(1286) 	BYTE *dst,			/* Pointer to generated SFN */
(1287) 	const BYTE *src,	/* Pointer to source SFN to be modified */
(1288) 	const WCHAR *lfn,	/* Pointer to LFN */
(1289) 	WORD seq			/* Sequence number */
(1290) )
(1291) {
(1292) 	BYTE ns[8], c;
(1293) 	UINT i, j;
(1294) 
(1295) 
(1296) 	mem_cpy(dst, src, 11);
(1297) 
(1298) 	if (seq > 5) {	/* On many collisions, generate a hash number instead of sequential number */
(1299) 		do seq = (seq >> 1) + (seq << 15) + (WORD)*lfn++; while (*lfn);
(1300) 	}
(1301) 
(1302) 	/* itoa (hexdecimal) */
(1303) 	i = 7;
(1304) 	do {
(1305) 		c = (seq % 16) + '0';
(1306) 		if (c > '9') c += 7;
(1307) 		ns[i--] = c;
(1308) 		seq /= 16;
(1309) 	} while (seq);
(1310) 	ns[i] = '~';
(1311) 
(1312) 	/* Append the number */
(1313) 	for (j = 0; j < i && dst[j] != ' '; j++) {
(1314) 		if (IsDBCS1(dst[j])) {
(1315) 			if (j == i - 1) break;
(1316) 			j++;
(1317) 		}
(1318) 	}
(1319) 	do {
(1320) 		dst[j++] = (i < 8) ? ns[i++] : ' ';
(1321) 	} while (j < 8);
(1322) }
(1323) #endif
(1324) 
(1325) 
(1326) 
(1327) 
(1328) /*-----------------------------------------------------------------------*/
(1329) /* Calculate sum of an SFN                                               */
(1330) /*-----------------------------------------------------------------------*/
(1331) #if _USE_LFN
(1332) static
(1333) BYTE sum_sfn (
(1334) 	const BYTE *dir		/* Ptr to directory entry */
(1335) )
(1336) {
(1337) 	BYTE sum = 0;
(1338) 	UINT n = 11;
(1339) 
(1340) 	do sum = (sum >> 1) + (sum << 7) + *dir++; while (--n);
(1341) 	return sum;
(1342) }
(1343) #endif
(1344) 
(1345) 
(1346) 
(1347) 
(1348) /*-----------------------------------------------------------------------*/
(1349) /* Directory handling - Find an object in the directory                  */
(1350) /*-----------------------------------------------------------------------*/
(1351) 
(1352) static
(1353) FRESULT dir_find (
(1354) 	DIR *dj			/* Pointer to the directory object linked to the file name */
(1355) )
(1356) {
(1357) 	FRESULT res;
(1358) 	BYTE c, *dir;
(1359) #if _USE_LFN
(1360) 	BYTE a, ord, sum;
(1361) #endif
(1362) 
(1363) 	res = dir_sdi(dj, 0);			/* Rewind directory object */
    00EAF 2722      CLR	R18
    00EB0 2733      CLR	R19
    00EB1 018B      MOVW	R16,R22
    00EB2 DD40      RCALL	ff.c:dir_sdi
    00EB3 2F40      MOV	R20,R16
(1364) 	if (res != FR_OK) return res;
    00EB4 2300      TST	R16
    00EB5 F009      BEQ	0x0EB7
    00EB6 C036      RJMP	0x0EED
(1365) 
(1366) #if _USE_LFN
(1367) 	ord = sum = 0xFF;
(1368) #endif
(1369) 	do {
(1370) 		res = move_window(dj->fs, dj->sect);
    00EB7 01FB      MOVW	R30,R22
    00EB8 8426      LDD	R2,Z+14
    00EB9 8437      LDD	R3,Z+15
    00EBA 8840      LDD	R4,Z+16
    00EBB 8851      LDD	R5,Z+17
    00EBC 8248      ST	Y,R4
    00EBD 8259      STD	Y+1,R5
    00EBE 0191      MOVW	R18,R2
    00EBF 8100      LD	R16,Z
    00EC0 8111      LDD	R17,Z+1
    00EC1 940E 0477 CALL	ff.c:move_window
    00EC3 2F40      MOV	R20,R16
(1371) 		if (res != FR_OK) break;
    00EC4 2300      TST	R16
    00EC5 F009      BEQ	0x0EC7
    00EC6 C025      RJMP	0x0EEC
(1372) 		dir = dj->dir;					/* Ptr to the directory entry of current index */
    00EC7 01FB      MOVW	R30,R22
    00EC8 88A2      LDD	R10,Z+18
    00EC9 88B3      LDD	R11,Z+19
(1373) 		c = dir[DIR_Name];
    00ECA 01F5      MOVW	R30,R10
    00ECB 80C0      LD	R12,Z
(1374) 		if (c == 0) { res = FR_NO_FILE; break; }	/* Reached to end of table */
    00ECC 20CC      TST	R12
    00ECD F411      BNE	0x0ED0
    00ECE E044      LDI	R20,4
    00ECF C01C      RJMP	0x0EEC
(1375) #if _USE_LFN	/* LFN configuration */
(1376) 		a = dir[DIR_Attr] & AM_MASK;
(1377) 		if (c == DDE || ((a & AM_VOL) && a != AM_LFN)) {	/* An entry without valid data */
(1378) 			ord = 0xFF;
(1379) 		} else {
(1380) 			if (a == AM_LFN) {			/* An LFN entry is found */
(1381) 				if (dj->lfn) {
(1382) 					if (c & LLE) {		/* Is it start of LFN sequence? */
(1383) 						sum = dir[LDIR_Chksum];
(1384) 						c &= ~LLE; ord = c;	/* LFN start order */
(1385) 						dj->lfn_idx = dj->index;
(1386) 					}
(1387) 					/* Check validity of the LFN entry and compare it with given name */
(1388) 					ord = (c == ord && sum == dir[LDIR_Chksum] && cmp_lfn(dj->lfn, dir)) ? ord - 1 : 0xFF;
(1389) 				}
(1390) 			} else {					/* An SFN entry is found */
(1391) 				if (!ord && sum == sum_sfn(dir)) break;	/* LFN matched? */
(1392) 				ord = 0xFF; dj->lfn_idx = 0xFFFF;	/* Reset LFN sequence */
(1393) 				if (!(dj->fn[NS] & NS_LOSS) && !mem_cmp(dir, dj->fn, 11)) break;	/* SFN matched? */
(1394) 			}
(1395) 		}
(1396) #else		/* Non LFN configuration */
(1397) 		if (!(dir[DIR_Attr] & AM_VOL) && !mem_cmp(dir, dj->fn, 11)) /* Is it a valid entry? */
    00ED0 01F5      MOVW	R30,R10
    00ED1 8423      LDD	R2,Z+11
    00ED2 FC23      SBRC	R2,3
    00ED3 C00F      RJMP	0x0EE3
    00ED4 E08B      LDI	R24,0xB
    00ED5 E090      LDI	R25,0
    00ED6 8399      STD	Y+1,R25
    00ED7 8388      ST	Y,R24
    00ED8 01FB      MOVW	R30,R22
    00ED9 8924      LDD	R18,Z+20
    00EDA 8935      LDD	R19,Z+21
    00EDB 0185      MOVW	R16,R10
    00EDC 940E 0446 CALL	ff.c:mem_cmp
    00EDE 0158      MOVW	R10,R16
    00EDF 3000      CPI	R16,0
    00EE0 0701      CPC	R16,R17
    00EE1 F409      BNE	0x0EE3
(1398) 			break;
    00EE2 C009      RJMP	0x0EEC
(1399) #endif
(1400) 		res = dir_next(dj, 0);		/* Next entry */
    00EE3 2722      CLR	R18
    00EE4 2733      CLR	R19
    00EE5 018B      MOVW	R16,R22
    00EE6 DE16      RCALL	ff.c:dir_next
    00EE7 2EA0      MOV	R10,R16
    00EE8 2D4A      MOV	R20,R10
(1401) 	} while (res == FR_OK);
    00EE9 2344      TST	R20
    00EEA F409      BNE	0x0EEC
    00EEB CFCB      RJMP	0x0EB7
(1402) 
(1403) 	return res;
    00EEC 2F04      MOV	R16,R20
    00EED 9622      ADIW	R28,2
    00EEE 940C 4B4B JMP	pop_xgsetF03C
ff.c:dir_read:
  dir                  --> R10
  c                    --> R12
  res                  --> R20
  dj                   --> R22
    00EF0 940E 4B42 CALL	push_xgsetF03C
    00EF2 01B8      MOVW	R22,R16
    00EF3 9722      SBIW	R28,2
(1404) }
(1405) 
(1406) 
(1407) 
(1408) 
(1409) /*-----------------------------------------------------------------------*/
(1410) /* Read an object from the directory                                     */
(1411) /*-----------------------------------------------------------------------*/
(1412) #if _FS_MINIMIZE <= 1
(1413) static
(1414) FRESULT dir_read (
(1415) 	DIR *dj			/* Pointer to the directory object that pointing the entry to be read */
(1416) )
(1417) {
(1418) 	FRESULT res;
(1419) 	BYTE c, *dir;
(1420) #if _USE_LFN
(1421) 	BYTE a, ord = 0xFF, sum = 0xFF;
(1422) #endif
(1423) 
(1424) 	res = FR_NO_FILE;
    00EF4 E044      LDI	R20,4
    00EF5 C02B      RJMP	0x0F21
(1425) 	while (dj->sect) {
(1426) 		res = move_window(dj->fs, dj->sect);
    00EF6 01FB      MOVW	R30,R22
    00EF7 8426      LDD	R2,Z+14
    00EF8 8437      LDD	R3,Z+15
    00EF9 8840      LDD	R4,Z+16
    00EFA 8851      LDD	R5,Z+17
    00EFB 8248      ST	Y,R4
    00EFC 8259      STD	Y+1,R5
    00EFD 0191      MOVW	R18,R2
    00EFE 8100      LD	R16,Z
    00EFF 8111      LDD	R17,Z+1
    00F00 940E 0477 CALL	ff.c:move_window
    00F02 2F40      MOV	R20,R16
(1427) 		if (res != FR_OK) break;
    00F03 2300      TST	R16
    00F04 F009      BEQ	0x0F06
    00F05 C028      RJMP	0x0F2E
(1428) 		dir = dj->dir;					/* Ptr to the directory entry of current index */
    00F06 01FB      MOVW	R30,R22
    00F07 88A2      LDD	R10,Z+18
    00F08 88B3      LDD	R11,Z+19
(1429) 		c = dir[DIR_Name];
    00F09 01F5      MOVW	R30,R10
    00F0A 80C0      LD	R12,Z
(1430) 		if (c == 0) { res = FR_NO_FILE; break; }	/* Reached to end of table */
    00F0B 20CC      TST	R12
    00F0C F411      BNE	0x0F0F
    00F0D E044      LDI	R20,4
    00F0E C01F      RJMP	0x0F2E
(1431) #if _USE_LFN	/* LFN configuration */
(1432) 		a = dir[DIR_Attr] & AM_MASK;
(1433) 		if (c == DDE || (!_FS_RPATH && c == '.') || ((a & AM_VOL) && a != AM_LFN)) {	/* An entry without valid data */
(1434) 			ord = 0xFF;
(1435) 		} else {
(1436) 			if (a == AM_LFN) {			/* An LFN entry is found */
(1437) 				if (c & LLE) {			/* Is it start of LFN sequence? */
(1438) 					sum = dir[LDIR_Chksum];
(1439) 					c &= ~LLE; ord = c;
(1440) 					dj->lfn_idx = dj->index;
(1441) 				}
(1442) 				/* Check LFN validity and capture it */
(1443) 				ord = (c == ord && sum == dir[LDIR_Chksum] && pick_lfn(dj->lfn, dir)) ? ord - 1 : 0xFF;
(1444) 			} else {					/* An SFN entry is found */
(1445) 				if (ord || sum != sum_sfn(dir))	/* Is there a valid LFN? */
(1446) 					dj->lfn_idx = 0xFFFF;		/* It has no LFN. */
(1447) 				break;
(1448) 			}
(1449) 		}
(1450) #else		/* Non LFN configuration */
(1451) 		if (c != DDE && (_FS_RPATH || c != '.') && !(dir[DIR_Attr] & AM_VOL))	/* Is it a valid entry? */
    00F0F 2D8C      MOV	R24,R12
    00F10 3E85      CPI	R24,0xE5
    00F11 F039      BEQ	0x0F19
    00F12 328E      CPI	R24,0x2E
    00F13 F029      BEQ	0x0F19
    00F14 01F5      MOVW	R30,R10
    00F15 8423      LDD	R2,Z+11
    00F16 FC23      SBRC	R2,3
    00F17 C001      RJMP	0x0F19
(1452) 			break;
    00F18 C015      RJMP	0x0F2E
(1453) #endif
(1454) 		res = dir_next(dj, 0);				/* Next entry */
    00F19 2722      CLR	R18
    00F1A 2733      CLR	R19
    00F1B 018B      MOVW	R16,R22
    00F1C DDE0      RCALL	ff.c:dir_next
    00F1D 2F40      MOV	R20,R16
(1455) 		if (res != FR_OK) break;
    00F1E 2300      TST	R16
    00F1F F009      BEQ	0x0F21
    00F20 C00D      RJMP	0x0F2E
    00F21 01FB      MOVW	R30,R22
    00F22 963E      ADIW	R30,0xE
    00F23 8020      LD	R2,Z
    00F24 8031      LDD	R3,Z+1
    00F25 8042      LDD	R4,Z+2
    00F26 8053      LDD	R5,Z+3
    00F27 9488      BCLR	0
    00F28 2022      TST	R2
    00F29 0432      CPC	R3,R2
    00F2A 0442      CPC	R4,R2
    00F2B 0452      CPC	R5,R2
    00F2C F009      BEQ	0x0F2E
    00F2D CFC8      RJMP	0x0EF6
(1456) 	}
(1457) 
(1458) 	if (res != FR_OK) dj->sect = 0;
    00F2E 2344      TST	R20
    00F2F F039      BEQ	0x0F37
    00F30 01FB      MOVW	R30,R22
    00F31 963E      ADIW	R30,0xE
    00F32 E080      LDI	R24,0
    00F33 8380      ST	Z,R24
    00F34 8381      STD	Z+1,R24
    00F35 8382      STD	Z+2,R24
    00F36 8383      STD	Z+3,R24
(1459) 
(1460) 	return res;
    00F37 2F04      MOV	R16,R20
    00F38 9622      ADIW	R28,2
    00F39 940C 4B4B JMP	pop_xgsetF03C
ff.c:dir_register:
  dir                  --> R12
  c                    --> R22
  res                  --> R10
  dj                   --> R20
    00F3B 940E 4B42 CALL	push_xgsetF03C
    00F3D 01A8      MOVW	R20,R16
    00F3E 9722      SBIW	R28,2
(1461) }
(1462) #endif
(1463) 
(1464) 
(1465) 
(1466) /*-----------------------------------------------------------------------*/
(1467) /* Register an object to the directory                                   */
(1468) /*-----------------------------------------------------------------------*/
(1469) #if !_FS_READONLY
(1470) static
(1471) FRESULT dir_register (	/* FR_OK:Successful, FR_DENIED:No free entry or too many SFN collision, FR_DISK_ERR:Disk error */
(1472) 	DIR *dj				/* Target directory with object name to be created */
(1473) )
(1474) {
(1475) 	FRESULT res;
(1476) 	BYTE c, *dir;
(1477) #if _USE_LFN	/* LFN configuration */
(1478) 	WORD n, ne, is;
(1479) 	BYTE sn[12], *fn, sum;
(1480) 	WCHAR *lfn;
(1481) 
(1482) 
(1483) 	fn = dj->fn; lfn = dj->lfn;
(1484) 	mem_cpy(sn, fn, 12);
(1485) 
(1486) 	if (_FS_RPATH && (sn[NS] & NS_DOT))		/* Cannot create dot entry */
(1487) 		return FR_INVALID_NAME;
(1488) 
(1489) 	if (sn[NS] & NS_LOSS) {			/* When LFN is out of 8.3 format, generate a numbered name */
(1490) 		fn[NS] = 0; dj->lfn = 0;			/* Find only SFN */
(1491) 		for (n = 1; n < 100; n++) {
(1492) 			gen_numname(fn, sn, lfn, n);	/* Generate a numbered name */
(1493) 			res = dir_find(dj);				/* Check if the name collides with existing SFN */
(1494) 			if (res != FR_OK) break;
(1495) 		}
(1496) 		if (n == 100) return FR_DENIED;		/* Abort if too many collisions */
(1497) 		if (res != FR_NO_FILE) return res;	/* Abort if the result is other than 'not collided' */
(1498) 		fn[NS] = sn[NS]; dj->lfn = lfn;
(1499) 	}
(1500) 
(1501) 	if (sn[NS] & NS_LFN) {			/* When LFN is to be created, reserve an SFN + LFN entries. */
(1502) 		for (ne = 0; lfn[ne]; ne++) ;
(1503) 		ne = (ne + 25) / 13;
(1504) 	} else {						/* Otherwise reserve only an SFN entry. */
(1505) 		ne = 1;
(1506) 	}
(1507) 
(1508) 	/* Reserve contiguous entries */
(1509) 	res = dir_sdi(dj, 0);
(1510) 	if (res != FR_OK) return res;
(1511) 	n = is = 0;
(1512) 	do {
(1513) 		res = move_window(dj->fs, dj->sect);
(1514) 		if (res != FR_OK) break;
(1515) 		c = *dj->dir;				/* Check the entry status */
(1516) 		if (c == DDE || c == 0) {	/* Is it a blank entry? */
(1517) 			if (n == 0) is = dj->index;	/* First index of the contiguous entry */
(1518) 			if (++n == ne) break;	/* A contiguous entry that required count is found */
(1519) 		} else {
(1520) 			n = 0;					/* Not a blank entry. Restart to search */
(1521) 		}
(1522) 		res = dir_next(dj, 1);		/* Next entry with table stretch */
(1523) 	} while (res == FR_OK);
(1524) 
(1525) 	if (res == FR_OK && ne > 1) {	/* Initialize LFN entry if needed */
(1526) 		res = dir_sdi(dj, is);
(1527) 		if (res == FR_OK) {
(1528) 			sum = sum_sfn(dj->fn);	/* Sum of the SFN tied to the LFN */
(1529) 			ne--;
(1530) 			do {					/* Store LFN entries in bottom first */
(1531) 				res = move_window(dj->fs, dj->sect);
(1532) 				if (res != FR_OK) break;
(1533) 				fit_lfn(dj->lfn, dj->dir, (BYTE)ne, sum);
(1534) 				dj->fs->wflag = 1;
(1535) 				res = dir_next(dj, 0);	/* Next entry */
(1536) 			} while (res == FR_OK && --ne);
(1537) 		}
(1538) 	}
(1539) 
(1540) #else	/* Non LFN configuration */
(1541) 	res = dir_sdi(dj, 0);
    00F3F 2722      CLR	R18
    00F40 2733      CLR	R19
    00F41 018A      MOVW	R16,R20
    00F42 DCB0      RCALL	ff.c:dir_sdi
    00F43 2EA0      MOV	R10,R16
(1542) 	if (res == FR_OK) {
    00F44 2300      TST	R16
    00F45 F509      BNE	0x0F67
(1543) 		do {	/* Find a blank entry for the SFN */
(1544) 			res = move_window(dj->fs, dj->sect);
    00F46 01FA      MOVW	R30,R20
    00F47 8426      LDD	R2,Z+14
    00F48 8437      LDD	R3,Z+15
    00F49 8840      LDD	R4,Z+16
    00F4A 8851      LDD	R5,Z+17
    00F4B 8248      ST	Y,R4
    00F4C 8259      STD	Y+1,R5
    00F4D 0191      MOVW	R18,R2
    00F4E 8100      LD	R16,Z
    00F4F 8111      LDD	R17,Z+1
    00F50 940E 0477 CALL	ff.c:move_window
    00F52 2EA0      MOV	R10,R16
(1545) 			if (res != FR_OK) break;
    00F53 2300      TST	R16
    00F54 F009      BEQ	0x0F56
    00F55 C011      RJMP	0x0F67
(1546) 			c = *dj->dir;
    00F56 01FA      MOVW	R30,R20
    00F57 89A2      LDD	R26,Z+18
    00F58 89B3      LDD	R27,Z+19
    00F59 916C      LD	R22,X
(1547) 			if (c == DDE || c == 0) break;	/* Is it a blank entry? */
    00F5A 3E65      CPI	R22,0xE5
    00F5B F011      BEQ	0x0F5E
    00F5C 2366      TST	R22
    00F5D F409      BNE	0x0F5F
    00F5E C008      RJMP	0x0F67
(1548) 			res = dir_next(dj, 1);			/* Next entry with table stretch */
    00F5F E021      LDI	R18,1
    00F60 E030      LDI	R19,0
    00F61 018A      MOVW	R16,R20
    00F62 DD9A      RCALL	ff.c:dir_next
    00F63 2EC0      MOV	R12,R16
    00F64 2CAC      MOV	R10,R12
(1549) 		} while (res == FR_OK);
    00F65 20AA      TST	R10
    00F66 F2F9      BEQ	0x0F46
(1550) 	}
(1551) #endif
(1552) 
(1553) 	if (res == FR_OK) {		/* Initialize the SFN entry */
    00F67 20AA      TST	R10
    00F68 F009      BEQ	0x0F6A
    00F69 C030      RJMP	0x0F9A
(1554) 		res = move_window(dj->fs, dj->sect);
    00F6A 01FA      MOVW	R30,R20
    00F6B 8426      LDD	R2,Z+14
    00F6C 8437      LDD	R3,Z+15
    00F6D 8840      LDD	R4,Z+16
    00F6E 8851      LDD	R5,Z+17
    00F6F 8248      ST	Y,R4
    00F70 8259      STD	Y+1,R5
    00F71 0191      MOVW	R18,R2
    00F72 8100      LD	R16,Z
    00F73 8111      LDD	R17,Z+1
    00F74 940E 0477 CALL	ff.c:move_window
    00F76 2EC0      MOV	R12,R16
    00F77 2CAC      MOV	R10,R12
(1555) 		if (res == FR_OK) {
    00F78 2300      TST	R16
    00F79 F501      BNE	0x0F9A
(1556) 			dir = dj->dir;
    00F7A 01FA      MOVW	R30,R20
    00F7B 88C2      LDD	R12,Z+18
    00F7C 88D3      LDD	R13,Z+19
(1557) 			mem_set(dir, 0, SZ_DIR);	/* Clean the entry */
    00F7D E280      LDI	R24,0x20
    00F7E E090      LDI	R25,0
    00F7F 8399      STD	Y+1,R25
    00F80 8388      ST	Y,R24
    00F81 2722      CLR	R18
    00F82 2733      CLR	R19
    00F83 0186      MOVW	R16,R12
    00F84 940E 0434 CALL	ff.c:mem_set
(1558) 			mem_cpy(dir, dj->fn, 11);	/* Put SFN */
    00F86 E08B      LDI	R24,0xB
    00F87 E090      LDI	R25,0
    00F88 8399      STD	Y+1,R25
    00F89 8388      ST	Y,R24
    00F8A 01FA      MOVW	R30,R20
    00F8B 8924      LDD	R18,Z+20
    00F8C 8935      LDD	R19,Z+21
    00F8D 0186      MOVW	R16,R12
    00F8E 940E 041E CALL	ff.c:mem_cpy
(1559) #if _USE_LFN
(1560) 			dir[DIR_NTres] = *(dj->fn+NS) & (NS_BODY | NS_EXT);	/* Put NT flag */
(1561) #endif
(1562) 			dj->fs->wflag = 1;
    00F90 E081      LDI	R24,1
    00F91 01FA      MOVW	R30,R20
    00F92 93AF      PUSH	R26
    00F93 93BF      PUSH	R27
    00F94 81A0      LD	R26,Z
    00F95 81B1      LDD	R27,Z+1
    00F96 01FD      MOVW	R30,R26
    00F97 91BF      POP	R27
    00F98 91AF      POP	R26
    00F99 8384      STD	Z+4,R24
(1563) 		}
(1564) 	}
(1565) 
(1566) 	return res;
    00F9A 2D0A      MOV	R16,R10
    00F9B 9622      ADIW	R28,2
    00F9C 940C 4B4B JMP	pop_xgsetF03C
ff.c:create_name:
  si                   --> R22
  b                    --> Y,+8
  sfn                  --> Y,+6
  ni                   --> R12
  d                    --> R10
  i                    --> Y,+4
  p                    --> Y,+2
  c                    --> R20
  path                 --> Y,+19
  dj                   --> R20
    00F9E 933A      ST	-Y,R19
    00F9F 932A      ST	-Y,R18
    00FA0 940E 4B07 CALL	push_xgsetF0FC
    00FA2 01A8      MOVW	R20,R16
    00FA3 9729      SBIW	R28,0x9
(1567) }
(1568) #endif /* !_FS_READONLY */
(1569) 
(1570) 
(1571) 
(1572) 
(1573) /*-----------------------------------------------------------------------*/
(1574) /* Remove an object from the directory                                   */
(1575) /*-----------------------------------------------------------------------*/
(1576) #if !_FS_READONLY && !_FS_MINIMIZE
(1577) static
(1578) FRESULT dir_remove (	/* FR_OK: Successful, FR_DISK_ERR: A disk error */
(1579) 	DIR *dj				/* Directory object pointing the entry to be removed */
(1580) )
(1581) {
(1582) 	FRESULT res;
(1583) #if _USE_LFN	/* LFN configuration */
(1584) 	WORD i;
(1585) 
(1586) 	i = dj->index;	/* SFN index */
(1587) 	res = dir_sdi(dj, (WORD)((dj->lfn_idx == 0xFFFF) ? i : dj->lfn_idx));	/* Goto the SFN or top of the LFN entries */
(1588) 	if (res == FR_OK) {
(1589) 		do {
(1590) 			res = move_window(dj->fs, dj->sect);
(1591) 			if (res != FR_OK) break;
(1592) 			*dj->dir = DDE;			/* Mark the entry "deleted" */
(1593) 			dj->fs->wflag = 1;
(1594) 			if (dj->index >= i) break;	/* When reached SFN, all entries of the object has been deleted. */
(1595) 			res = dir_next(dj, 0);		/* Next entry */
(1596) 		} while (res == FR_OK);
(1597) 		if (res == FR_NO_FILE) res = FR_INT_ERR;
(1598) 	}
(1599) 
(1600) #else			/* Non LFN configuration */
(1601) 	res = dir_sdi(dj, dj->index);
(1602) 	if (res == FR_OK) {
(1603) 		res = move_window(dj->fs, dj->sect);
(1604) 		if (res == FR_OK) {
(1605) 			*dj->dir = DDE;			/* Mark the entry "deleted" */
(1606) 			dj->fs->wflag = 1;
(1607) 		}
(1608) 	}
(1609) #endif
(1610) 
(1611) 	return res;
(1612) }
(1613) #endif /* !_FS_READONLY */
(1614) 
(1615) 
(1616) 
(1617) 
(1618) /*-----------------------------------------------------------------------*/
(1619) /* Pick a segment and create the object name in directory form           */
(1620) /*-----------------------------------------------------------------------*/
(1621) 
(1622) static
(1623) FRESULT create_name (
(1624) 	DIR *dj,			/* Pointer to the directory object */
(1625) 	const TCHAR **path	/* Pointer to pointer to the segment in the path string */
(1626) )
(1627) {
(1628) #ifdef _EXCVT
(1629) 	static const BYTE excvt[] = _EXCVT;	/* Upper conversion table for extended chars */
(1630) #endif
(1631) 
(1632) #if _USE_LFN	/* LFN configuration */
(1633) 	BYTE b, cf;
(1634) 	WCHAR w, *lfn;
(1635) 	UINT i, ni, si, di;
(1636) 	const TCHAR *p;
(1637) 
(1638) 	/* Create LFN in Unicode */
(1639) 	for (p = *path; *p == '/' || *p == '\\'; p++) ;	/* Strip duplicated separator */
(1640) 	lfn = dj->lfn;
(1641) 	si = di = 0;
(1642) 	for (;;) {
(1643) 		w = p[si++];					/* Get a character */
(1644) 		if (w < ' ' || w == '/' || w == '\\') break;	/* Break on end of segment */
(1645) 		if (di >= _MAX_LFN)				/* Reject too long name */
(1646) 			return FR_INVALID_NAME;
(1647) #if !_LFN_UNICODE
(1648) 		w &= 0xFF;
(1649) 		if (IsDBCS1(w)) {				/* Check if it is a DBC 1st byte (always false on SBCS cfg) */
(1650) 			b = (BYTE)p[si++];			/* Get 2nd byte */
(1651) 			if (!IsDBCS2(b))
(1652) 				return FR_INVALID_NAME;	/* Reject invalid sequence */
(1653) 			w = (w << 8) + b;			/* Create a DBC */
(1654) 		}
(1655) 		w = ff_convert(w, 1);			/* Convert ANSI/OEM to Unicode */
(1656) 		if (!w) return FR_INVALID_NAME;	/* Reject invalid code */
(1657) #endif
(1658) 		if (w < 0x80 && chk_chr("\"*:<>\?|\x7F", w)) /* Reject illegal chars for LFN */
(1659) 			return FR_INVALID_NAME;
(1660) 		lfn[di++] = w;					/* Store the Unicode char */
(1661) 	}
(1662) 	*path = &p[si];						/* Return pointer to the next segment */
(1663) 	cf = (w < ' ') ? NS_LAST : 0;		/* Set last segment flag if end of path */
(1664) #if _FS_RPATH
(1665) 	if ((di == 1 && lfn[di-1] == '.') || /* Is this a dot entry? */
(1666) 		(di == 2 && lfn[di-1] == '.' && lfn[di-2] == '.')) {
(1667) 		lfn[di] = 0;
(1668) 		for (i = 0; i < 11; i++)
(1669) 			dj->fn[i] = (i < di) ? '.' : ' ';
(1670) 		dj->fn[i] = cf | NS_DOT;		/* This is a dot entry */
(1671) 		return FR_OK;
(1672) 	}
(1673) #endif
(1674) 	while (di) {						/* Strip trailing spaces and dots */
(1675) 		w = lfn[di-1];
(1676) 		if (w != ' ' && w != '.') break;
(1677) 		di--;
(1678) 	}
(1679) 	if (!di) return FR_INVALID_NAME;	/* Reject nul string */
(1680) 
(1681) 	lfn[di] = 0;						/* LFN is created */
(1682) 
(1683) 	/* Create SFN in directory form */
(1684) 	mem_set(dj->fn, ' ', 11);
(1685) 	for (si = 0; lfn[si] == ' ' || lfn[si] == '.'; si++) ;	/* Strip leading spaces and dots */
(1686) 	if (si) cf |= NS_LOSS | NS_LFN;
(1687) 	while (di && lfn[di - 1] != '.') di--;	/* Find extension (di<=si: no extension) */
(1688) 
(1689) 	b = i = 0; ni = 8;
(1690) 	for (;;) {
(1691) 		w = lfn[si++];					/* Get an LFN char */
(1692) 		if (!w) break;					/* Break on end of the LFN */
(1693) 		if (w == ' ' || (w == '.' && si != di)) {	/* Remove spaces and dots */
(1694) 			cf |= NS_LOSS | NS_LFN; continue;
(1695) 		}
(1696) 
(1697) 		if (i >= ni || si == di) {		/* Extension or end of SFN */
(1698) 			if (ni == 11) {				/* Long extension */
(1699) 				cf |= NS_LOSS | NS_LFN; break;
(1700) 			}
(1701) 			if (si != di) cf |= NS_LOSS | NS_LFN;	/* Out of 8.3 format */
(1702) 			if (si > di) break;			/* No extension */
(1703) 			si = di; i = 8; ni = 11;	/* Enter extension section */
(1704) 			b <<= 2; continue;
(1705) 		}
(1706) 
(1707) 		if (w >= 0x80) {				/* Non ASCII char */
(1708) #ifdef _EXCVT
(1709) 			w = ff_convert(w, 0);		/* Unicode -> OEM code */
(1710) 			if (w) w = excvt[w - 0x80];	/* Convert extended char to upper (SBCS) */
(1711) #else
(1712) 			w = ff_convert(ff_wtoupper(w), 0);	/* Upper converted Unicode -> OEM code */
(1713) #endif
(1714) 			cf |= NS_LFN;				/* Force create LFN entry */
(1715) 		}
(1716) 
(1717) 		if (_DF1S && w >= 0x100) {		/* Double byte char (always false on SBCS cfg) */
(1718) 			if (i >= ni - 1) {
(1719) 				cf |= NS_LOSS | NS_LFN; i = ni; continue;
(1720) 			}
(1721) 			dj->fn[i++] = (BYTE)(w >> 8);
(1722) 		} else {						/* Single byte char */
(1723) 			if (!w || chk_chr("+,;=[]", w)) {	/* Replace illegal chars for SFN */
(1724) 				w = '_'; cf |= NS_LOSS | NS_LFN;/* Lossy conversion */
(1725) 			} else {
(1726) 				if (IsUpper(w)) {		/* ASCII large capital */
(1727) 					b |= 2;
(1728) 				} else {
(1729) 					if (IsLower(w)) {	/* ASCII small capital */
(1730) 						b |= 1; w -= 0x20;
(1731) 					}
(1732) 				}
(1733) 			}
(1734) 		}
(1735) 		dj->fn[i++] = (BYTE)w;
(1736) 	}
(1737) 
(1738) 	if (dj->fn[0] == DDE) dj->fn[0] = NDDE;	/* If the first char collides with deleted mark, replace it with 0x05 */
(1739) 
(1740) 	if (ni == 8) b <<= 2;
(1741) 	if ((b & 0x0C) == 0x0C || (b & 0x03) == 0x03)	/* Create LFN entry when there are composite capitals */
(1742) 		cf |= NS_LFN;
(1743) 	if (!(cf & NS_LFN)) {						/* When LFN is in 8.3 format without extended char, NT flags are created */
(1744) 		if ((b & 0x03) == 0x01) cf |= NS_EXT;	/* NT flag (Extension has only small capital) */
(1745) 		if ((b & 0x0C) == 0x04) cf |= NS_BODY;	/* NT flag (Filename has only small capital) */
(1746) 	}
(1747) 
(1748) 	dj->fn[NS] = cf;	/* SFN is created */
(1749) 
(1750) 	return FR_OK;
(1751) 
(1752) 
(1753) #else	/* Non-LFN configuration */
(1754) 	BYTE b, c, d, *sfn;
(1755) 	UINT ni, si, i;
(1756) 	const char *p;
(1757) 
(1758) 	/* Create file name in directory form */
(1759) 	for (p = *path; *p == '/' || *p == '\\'; p++) ;	/* Strip duplicated separator */
    00FA4 89EB      LDD	R30,Y+19
    00FA5 89FC      LDD	R31,Y+20
    00FA6 8020      LD	R2,Z
    00FA7 8031      LDD	R3,Z+1
    00FA8 823B      STD	Y+3,R3
    00FA9 822A      STD	Y+2,R2
    00FAA C005      RJMP	0x0FB0
    00FAB 818A      LDD	R24,Y+2
    00FAC 819B      LDD	R25,Y+3
    00FAD 9601      ADIW	R24,1
    00FAE 839B      STD	Y+3,R25
    00FAF 838A      STD	Y+2,R24
    00FB0 81EA      LDD	R30,Y+2
    00FB1 81FB      LDD	R31,Y+3
    00FB2 8020      LD	R2,Z
    00FB3 2433      CLR	R3
    00FB4 2D82      MOV	R24,R2
    00FB5 328F      CPI	R24,0x2F
    00FB6 F3A1      BEQ	0x0FAB
    00FB7 358C      CPI	R24,0x5C
    00FB8 F391      BEQ	0x0FAB
(1760) 	sfn = dj->fn;
    00FB9 01FA      MOVW	R30,R20
    00FBA 8824      LDD	R2,Z+20
    00FBB 8835      LDD	R3,Z+21
    00FBC 823F      STD	Y+7,R3
    00FBD 822E      STD	Y+6,R2
(1761) 	mem_set(sfn, ' ', 11);
    00FBE E08B      LDI	R24,0xB
    00FBF E090      LDI	R25,0
    00FC0 8399      STD	Y+1,R25
    00FC1 8388      ST	Y,R24
    00FC2 E220      LDI	R18,0x20
    00FC3 E030      LDI	R19,0
    00FC4 0181      MOVW	R16,R2
    00FC5 940E 0434 CALL	ff.c:mem_set
(1762) 	si = i = b = 0; ni = 8;
    00FC7 2400      CLR	R0
    00FC8 8608      STD	Y+8,R0
    00FC9 2422      CLR	R2
    00FCA 2433      CLR	R3
    00FCB 823D      STD	Y+5,R3
    00FCC 822C      STD	Y+4,R2
    00FCD 01B1      MOVW	R22,R2
    00FCE E088      LDI	R24,0x8
    00FCF E090      LDI	R25,0
    00FD0 016C      MOVW	R12,R24
(1763) #if _FS_RPATH
(1764) 	if (p[si] == '.') { /* Is this a dot entry? */
(1765) 		for (;;) {
(1766) 			c = (BYTE)p[si++];
(1767) 			if (c != '.' || si >= 3) break;
(1768) 			sfn[i++] = c;
(1769) 		}
(1770) 		if (c != '/' && c != '\\' && c > ' ') return FR_INVALID_NAME;
(1771) 		*path = &p[si];									/* Return pointer to the next segment */
(1772) 		sfn[NS] = (c <= ' ') ? NS_LAST | NS_DOT : NS_DOT;	/* Set last segment flag if end of path */
(1773) 		return FR_OK;
(1774) 	}
(1775) #endif
(1776) 	for (;;) {
(1777) 		c = (BYTE)p[si++];
    00FD1 01AB      MOVW	R20,R22
    00FD2 5F6F      SUBI	R22,0xFF
    00FD3 4F7F      SBCI	R23,0xFF
    00FD4 01FA      MOVW	R30,R20
    00FD5 800A      LDD	R0,Y+2
    00FD6 801B      LDD	R1,Y+3
    00FD7 0DE0      ADD	R30,R0
    00FD8 1DF1      ADC	R31,R1
    00FD9 8140      LD	R20,Z
(1778) 		if (c <= ' ' || c == '/' || c == '\\') break;	/* Break on end of segment */
    00FDA E280      LDI	R24,0x20
    00FDB 1784      CP	R24,R20
    00FDC F420      BCC	0x0FE1
    00FDD 324F      CPI	R20,0x2F
    00FDE F011      BEQ	0x0FE1
    00FDF 354C      CPI	R20,0x5C
    00FE0 F409      BNE	0x0FE2
    00FE1 C087      RJMP	0x1069
(1779) 		if (c == '.' || i >= ni) {
    00FE2 324E      CPI	R20,0x2E
    00FE3 F029      BEQ	0x0FE9
    00FE4 800C      LDD	R0,Y+4
    00FE5 801D      LDD	R1,Y+5
    00FE6 140C      CP	R0,R12
    00FE7 041D      CPC	R1,R13
    00FE8 F0A0      BCS	0x0FFD
(1780) 			if (ni != 8 || c != '.') return FR_INVALID_NAME;
    00FE9 01C6      MOVW	R24,R12
    00FEA 3088      CPI	R24,0x8
    00FEB E0E0      LDI	R30,0
    00FEC 079E      CPC	R25,R30
    00FED F411      BNE	0x0FF0
    00FEE 324E      CPI	R20,0x2E
    00FEF F011      BEQ	0x0FF2
    00FF0 E006      LDI	R16,6
    00FF1 C0AF      RJMP	0x10A1
(1781) 			i = 8; ni = 11;
    00FF2 E088      LDI	R24,0x8
    00FF3 E090      LDI	R25,0
    00FF4 839D      STD	Y+5,R25
    00FF5 838C      STD	Y+4,R24
    00FF6 E08B      LDI	R24,0xB
    00FF7 016C      MOVW	R12,R24
(1782) 			b <<= 2; continue;
    00FF8 8408      LDD	R0,Y+8
    00FF9 0C00      LSL	R0
    00FFA 0C00      LSL	R0
    00FFB 8608      STD	Y+8,R0
    00FFC CFD4      RJMP	0x0FD1
(1783) 		}
(1784) 		if (c >= 0x80) {				/* Extended char? */
    00FFD 3840      CPI	R20,0x80
    00FFE F018      BCS	0x1002
(1785) 			b |= 3;						/* Eliminate NT flag */
    00FFF 8588      LDD	R24,Y+8
    01000 6083      ORI	R24,3
    01001 8788      STD	Y+8,R24
(1786) #ifdef _EXCVT
(1787) 			c = excvt[c-0x80];			/* Upper conversion (SBCS) */
(1788) #else
(1789) #if !_DF1S	/* ASCII only cfg */
(1790) 			return FR_INVALID_NAME;
(1791) #endif
(1792) #endif
(1793) 		}
(1794) 		if (IsDBCS1(c)) {				/* Check if it is a DBC 1st byte (always false on SBCS cfg) */
    01002 3841      CPI	R20,0x81
    01003 F408      BCC	0x1005
    01004 C039      RJMP	0x103E
    01005 EF8E      LDI	R24,0xFE
    01006 1784      CP	R24,R20
    01007 F408      BCC	0x1009
    01008 C035      RJMP	0x103E
(1795) 			d = (BYTE)p[si++];			/* Get 2nd byte */
    01009 015B      MOVW	R10,R22
    0100A 5F6F      SUBI	R22,0xFF
    0100B 4F7F      SBCI	R23,0xFF
    0100C 01F5      MOVW	R30,R10
    0100D 800A      LDD	R0,Y+2
    0100E 801B      LDD	R1,Y+3
    0100F 0DE0      ADD	R30,R0
    01010 1DF1      ADC	R31,R1
    01011 80A0      LD	R10,Z
(1796) 			if (!IsDBCS2(d) || i >= ni - 1)	/* Reject invalid DBC */
    01012 2D8A      MOV	R24,R10
    01013 3480      CPI	R24,0x40
    01014 F018      BCS	0x1018
    01015 E78E      LDI	R24,0x7E
    01016 158A      CP	R24,R10
    01017 F430      BCC	0x101E
    01018 2D8A      MOV	R24,R10
    01019 3880      CPI	R24,0x80
    0101A F050      BCS	0x1025
    0101B EF8E      LDI	R24,0xFE
    0101C 158A      CP	R24,R10
    0101D F038      BCS	0x1025
    0101E 01C6      MOVW	R24,R12
    0101F 9701      SBIW	R24,1
    01020 800C      LDD	R0,Y+4
    01021 801D      LDD	R1,Y+5
    01022 1608      CP	R0,R24
    01023 0619      CPC	R1,R25
    01024 F010      BCS	0x1027
(1797) 				return FR_INVALID_NAME;
    01025 E006      LDI	R16,6
    01026 C07A      RJMP	0x10A1
(1798) 			sfn[i++] = c;
    01027 80EC      LDD	R14,Y+4
    01028 80FD      LDD	R15,Y+5
    01029 01C7      MOVW	R24,R14
    0102A 9601      ADIW	R24,1
    0102B 839D      STD	Y+5,R25
    0102C 838C      STD	Y+4,R24
    0102D 01F7      MOVW	R30,R14
    0102E 800E      LDD	R0,Y+6
    0102F 801F      LDD	R1,Y+7
    01030 0DE0      ADD	R30,R0
    01031 1DF1      ADC	R31,R1
    01032 8340      ST	Z,R20
(1799) 			sfn[i++] = d;
    01033 017C      MOVW	R14,R24
    01034 9601      ADIW	R24,1
    01035 839D      STD	Y+5,R25
    01036 838C      STD	Y+4,R24
    01037 01F7      MOVW	R30,R14
    01038 800E      LDD	R0,Y+6
    01039 801F      LDD	R1,Y+7
    0103A 0DE0      ADD	R30,R0
    0103B 1DF1      ADC	R31,R1
    0103C 82A0      ST	Z,R10
(1800) 		} else {						/* Single byte code */
    0103D CF93      RJMP	0x0FD1
(1801) 			if (chk_chr("\"*+,:;<=>\?[]|\x7F", c))	/* Reject illegal chrs for SFN */
    0103E 2F24      MOV	R18,R20
    0103F 2733      CLR	R19
    01040 E000      LDI	R16,0
    01041 E011      LDI	R17,1
    01042 940E 0467 CALL	ff.c:chk_chr
    01044 0158      MOVW	R10,R16
    01045 3000      CPI	R16,0
    01046 0701      CPC	R16,R17
    01047 F011      BEQ	0x104A
(1802) 				return FR_INVALID_NAME;
    01048 E006      LDI	R16,6
    01049 C057      RJMP	0x10A1
(1803) 			if (IsUpper(c)) {			/* ASCII large capital? */
    0104A 3441      CPI	R20,0x41
    0104B F038      BCS	0x1053
    0104C E58A      LDI	R24,0x5A
    0104D 1784      CP	R24,R20
    0104E F020      BCS	0x1053
(1804) 				b |= 2;
    0104F 8588      LDD	R24,Y+8
    01050 6082      ORI	R24,2
    01051 8788      STD	Y+8,R24
(1805) 			} else {
    01052 C009      RJMP	0x105C
(1806) 				if (IsLower(c)) {		/* ASCII small capital? */
    01053 3641      CPI	R20,0x61
    01054 F038      BCS	0x105C
    01055 E78A      LDI	R24,0x7A
    01056 1784      CP	R24,R20
    01057 F020      BCS	0x105C
(1807) 					b |= 1; c -= 0x20;
    01058 8588      LDD	R24,Y+8
    01059 6081      ORI	R24,1
    0105A 8788      STD	Y+8,R24
    0105B 5240      SUBI	R20,0x20
(1808) 				}
(1809) 			}
(1810) 			sfn[i++] = c;
    0105C 80AC      LDD	R10,Y+4
    0105D 80BD      LDD	R11,Y+5
    0105E 01C5      MOVW	R24,R10
    0105F 9601      ADIW	R24,1
    01060 839D      STD	Y+5,R25
    01061 838C      STD	Y+4,R24
    01062 01F5      MOVW	R30,R10
    01063 800E      LDD	R0,Y+6
    01064 801F      LDD	R1,Y+7
    01065 0DE0      ADD	R30,R0
    01066 1DF1      ADC	R31,R1
    01067 8340      ST	Z,R20
    01068 CF68      RJMP	0x0FD1
(1811) 		}
(1812) 	}
(1813) 	*path = &p[si];						/* Return pointer to the next segment */
    01069 011B      MOVW	R2,R22
    0106A 800A      LDD	R0,Y+2
    0106B 801B      LDD	R1,Y+3
    0106C 0C20      ADD	R2,R0
    0106D 1C31      ADC	R3,R1
    0106E 89EB      LDD	R30,Y+19
    0106F 89FC      LDD	R31,Y+20
    01070 8231      STD	Z+1,R3
    01071 8220      ST	Z,R2
(1814) 	c = (c <= ' ') ? NS_LAST : 0;		/* Set last segment flag if end of path */
    01072 E280      LDI	R24,0x20
    01073 1784      CP	R24,R20
    01074 F018      BCS	0x1078
    01075 E064      LDI	R22,4
    01076 E070      LDI	R23,0
    01077 C002      RJMP	0x107A
    01078 2766      CLR	R22
    01079 2777      CLR	R23
    0107A 2F46      MOV	R20,R22
(1815) 
(1816) 	if (!i) return FR_INVALID_NAME;		/* Reject nul string */
    0107B 800C      LDD	R0,Y+4
    0107C 801D      LDD	R1,Y+5
    0107D 2000      TST	R0
    0107E F421      BNE	0x1083
    0107F 2011      TST	R1
    01080 F411      BNE	0x1083
    01081 E006      LDI	R16,6
    01082 C01E      RJMP	0x10A1
(1817) 	if (sfn[0] == DDE) sfn[0] = NDDE;	/* When first char collides with DDE, replace it with 0x05 */
    01083 81EE      LDD	R30,Y+6
    01084 81FF      LDD	R31,Y+7
    01085 8180      LD	R24,Z
    01086 3E85      CPI	R24,0xE5
    01087 F411      BNE	0x108A
    01088 E085      LDI	R24,5
    01089 8380      ST	Z,R24
(1818) 
(1819) 	if (ni == 8) b <<= 2;
    0108A 01C6      MOVW	R24,R12
    0108B 3088      CPI	R24,0x8
    0108C E0E0      LDI	R30,0
    0108D 079E      CPC	R25,R30
    0108E F421      BNE	0x1093
    0108F 8408      LDD	R0,Y+8
    01090 0C00      LSL	R0
    01091 0C00      LSL	R0
    01092 8608      STD	Y+8,R0
(1820) 	if ((b & 0x03) == 0x01) c |= NS_EXT;	/* NT flag (Name extension has only small capital) */
    01093 8588      LDD	R24,Y+8
    01094 7083      ANDI	R24,3
    01095 3081      CPI	R24,1
    01096 F409      BNE	0x1098
    01097 6140      ORI	R20,0x10
(1821) 	if ((b & 0x0C) == 0x04) c |= NS_BODY;	/* NT flag (Name body has only small capital) */
    01098 8588      LDD	R24,Y+8
    01099 708C      ANDI	R24,0xC
    0109A 3084      CPI	R24,4
    0109B F409      BNE	0x109D
    0109C 6048      ORI	R20,0x8
(1822) 
(1823) 	sfn[NS] = c;		/* Store NT flag, File name is created */
    0109D 81EE      LDD	R30,Y+6
    0109E 81FF      LDD	R31,Y+7
    0109F 8743      STD	Z+11,R20
(1824) 
(1825) 	return FR_OK;
    010A0 2700      CLR	R16
    010A1 9629      ADIW	R28,0x9
    010A2 940E 4AFC CALL	pop_xgsetF0FC
    010A4 9622      ADIW	R28,2
    010A5 9508      RET
ff.c:get_fileinfo:
  nt                   --> R12
  p                    --> R20
  dir                  --> R10
  i                    --> R12
  c                    --> R14
  fno                  --> R22
  dj                   --> R10
    010A6 940E 4B07 CALL	push_xgsetF0FC
    010A8 01B9      MOVW	R22,R18
    010A9 0158      MOVW	R10,R16
(1826) #endif
(1827) }
(1828) 
(1829) 
(1830) 
(1831) 
(1832) /*-----------------------------------------------------------------------*/
(1833) /* Get file information from directory entry                             */
(1834) /*-----------------------------------------------------------------------*/
(1835) #if _FS_MINIMIZE <= 1
(1836) static
(1837) void get_fileinfo (		/* No return code */
(1838) 	DIR *dj,			/* Pointer to the directory object */
(1839) 	FILINFO *fno	 	/* Pointer to the file information to be filled */
(1840) )
(1841) {
(1842) 	UINT i;
(1843) 	BYTE nt, *dir;
(1844) 	TCHAR *p, c;
(1845) 
(1846) 
(1847) 	p = fno->fname;
    010AA 01AB      MOVW	R20,R22
    010AB 5F47      SUBI	R20,0xF7
    010AC 4F5F      SBCI	R21,0xFF
(1848) 	if (dj->sect) {
    010AD 01F5      MOVW	R30,R10
    010AE 963E      ADIW	R30,0xE
    010AF 8020      LD	R2,Z
    010B0 8031      LDD	R3,Z+1
    010B1 8042      LDD	R4,Z+2
    010B2 8053      LDD	R5,Z+3
    010B3 9488      BCLR	0
    010B4 2022      TST	R2
    010B5 0432      CPC	R3,R2
    010B6 0442      CPC	R4,R2
    010B7 0452      CPC	R5,R2
    010B8 F409      BNE	0x10BA
    010B9 C08A      RJMP	0x1144
(1849) 		dir = dj->dir;
    010BA 01F5      MOVW	R30,R10
    010BB 88A2      LDD	R10,Z+18
    010BC 88B3      LDD	R11,Z+19
(1850) 		nt = dir[DIR_NTres];		/* NT flag */
(1851) 		for (i = 0; i < 8; i++) {	/* Copy name body */
    010BD 24CC      CLR	R12
    010BE 24DD      CLR	R13
    010BF C014      RJMP	0x10D4
(1852) 			c = dir[i];
    010C0 01F6      MOVW	R30,R12
    010C1 0DEA      ADD	R30,R10
    010C2 1DFB      ADC	R31,R11
    010C3 80E0      LD	R14,Z
(1853) 			if (c == ' ') break;
    010C4 2D8E      MOV	R24,R14
    010C5 3280      CPI	R24,0x20
    010C6 F409      BNE	0x10C8
    010C7 C011      RJMP	0x10D9
(1854) 			if (c == NDDE) c = (TCHAR)DDE;
    010C8 2D8E      MOV	R24,R14
    010C9 3085      CPI	R24,5
    010CA F411      BNE	0x10CD
    010CB EE85      LDI	R24,0xE5
    010CC 2EE8      MOV	R14,R24
(1855) 			if (_USE_LFN && (nt & NS_BODY) && IsUpper(c)) c += 0x20;
    010CD C000      RJMP	0x10CE
(1856) #if _LFN_UNICODE
(1857) 			if (IsDBCS1(c) && i < 7 && IsDBCS2(dir[i+1]))
(1858) 				c = (c << 8) | dir[++i];
(1859) 			c = ff_convert(c, 1);
(1860) 			if (!c) c = '?';
(1861) #endif
(1862) 			*p++ = c;
    010CE 01FA      MOVW	R30,R20
    010CF 92E1      ST	Z+,R14
    010D0 01AF      MOVW	R20,R30
    010D1 01C6      MOVW	R24,R12
    010D2 9601      ADIW	R24,1
    010D3 016C      MOVW	R12,R24
    010D4 01C6      MOVW	R24,R12
    010D5 3088      CPI	R24,0x8
    010D6 E0E0      LDI	R30,0
    010D7 079E      CPC	R25,R30
    010D8 F338      BCS	0x10C0
(1863) 		}
(1864) 		if (dir[8] != ' ') {		/* Copy name extension */
    010D9 01F5      MOVW	R30,R10
    010DA 8580      LDD	R24,Z+8
    010DB 3280      CPI	R24,0x20
    010DC F0E1      BEQ	0x10F9
(1865) 			*p++ = '.';
    010DD E28E      LDI	R24,0x2E
    010DE 01FA      MOVW	R30,R20
    010DF 9381      ST	Z+,R24
    010E0 01AF      MOVW	R20,R30
(1866) 			for (i = 8; i < 11; i++) {
    010E1 E088      LDI	R24,0x8
    010E2 E090      LDI	R25,0
    010E3 016C      MOVW	R12,R24
    010E4 C00F      RJMP	0x10F4
(1867) 				c = dir[i];
    010E5 01F6      MOVW	R30,R12
    010E6 0DEA      ADD	R30,R10
    010E7 1DFB      ADC	R31,R11
    010E8 80E0      LD	R14,Z
(1868) 				if (c == ' ') break;
    010E9 2D8E      MOV	R24,R14
    010EA 3280      CPI	R24,0x20
    010EB F409      BNE	0x10ED
    010EC C00C      RJMP	0x10F9
(1869) 				if (_USE_LFN && (nt & NS_EXT) && IsUpper(c)) c += 0x20;
    010ED C000      RJMP	0x10EE
(1870) #if _LFN_UNICODE
(1871) 				if (IsDBCS1(c) && i < 10 && IsDBCS2(dir[i+1]))
(1872) 					c = (c << 8) | dir[++i];
(1873) 				c = ff_convert(c, 1);
(1874) 				if (!c) c = '?';
(1875) #endif
(1876) 				*p++ = c;
    010EE 01FA      MOVW	R30,R20
    010EF 92E1      ST	Z+,R14
    010F0 01AF      MOVW	R20,R30
    010F1 01C6      MOVW	R24,R12
    010F2 9601      ADIW	R24,1
    010F3 016C      MOVW	R12,R24
    010F4 01C6      MOVW	R24,R12
    010F5 308B      CPI	R24,0xB
    010F6 E0E0      LDI	R30,0
    010F7 079E      CPC	R25,R30
    010F8 F360      BCS	0x10E5
(1877) 			}
(1878) 		}
(1879) 		fno->fattrib = dir[DIR_Attr];				/* Attribute */
    010F9 01F5      MOVW	R30,R10
    010FA 8423      LDD	R2,Z+11
    010FB 01FB      MOVW	R30,R22
    010FC 8620      STD	Z+8,R2
(1880) 		fno->fsize = LD_DWORD(dir+DIR_FileSize);	/* Size */
    010FD E188      LDI	R24,0x18
    010FE E090      LDI	R25,0
    010FF 01F5      MOVW	R30,R10
    01100 8D07      LDD	R16,Z+31
    01101 2711      CLR	R17
    01102 2722      CLR	R18
    01103 2733      CLR	R19
    01104 938A      ST	-Y,R24
    01105 940E 4B92 CALL	lsl32
    01107 0118      MOVW	R2,R16
    01108 0129      MOVW	R4,R18
    01109 01F5      MOVW	R30,R10
    0110A 8C66      LDD	R6,Z+30
    0110B 2477      CLR	R7
    0110C 2488      CLR	R8
    0110D 2499      CLR	R9
    0110E 0143      MOVW	R8,R6
    0110F 2466      CLR	R6
    01110 2477      CLR	R7
    01111 2826      OR	R2,R6
    01112 2837      OR	R3,R7
    01113 2848      OR	R4,R8
    01114 2859      OR	R5,R9
    01115 8C65      LDD	R6,Z+29
    01116 2477      CLR	R7
    01117 2C76      MOV	R7,R6
    01118 2466      CLR	R6
    01119 2488      CLR	R8
    0111A 2499      CLR	R9
    0111B 2826      OR	R2,R6
    0111C 2837      OR	R3,R7
    0111D 2848      OR	R4,R8
    0111E 2859      OR	R5,R9
    0111F 8C64      LDD	R6,Z+28
    01120 2477      CLR	R7
    01121 2488      CLR	R8
    01122 2499      CLR	R9
    01123 2826      OR	R2,R6
    01124 2837      OR	R3,R7
    01125 2848      OR	R4,R8
    01126 2859      OR	R5,R9
    01127 01FB      MOVW	R30,R22
    01128 8220      ST	Z,R2
    01129 8231      STD	Z+1,R3
    0112A 8242      STD	Z+2,R4
    0112B 8253      STD	Z+3,R5
(1881) 		fno->fdate = LD_WORD(dir+DIR_WrtDate);		/* Date */
    0112C 01F5      MOVW	R30,R10
    0112D 8C20      LDD	R2,Z+24
    0112E 2433      CLR	R3
    0112F 8C41      LDD	R4,Z+25
    01130 2455      CLR	R5
    01131 2C54      MOV	R5,R4
    01132 2444      CLR	R4
    01133 2842      OR	R4,R2
    01134 2853      OR	R5,R3
    01135 01FB      MOVW	R30,R22
    01136 8255      STD	Z+5,R5
    01137 8244      STD	Z+4,R4
(1882) 		fno->ftime = LD_WORD(dir+DIR_WrtTime);		/* Time */
    01138 01F5      MOVW	R30,R10
    01139 8826      LDD	R2,Z+22
    0113A 2433      CLR	R3
    0113B 8847      LDD	R4,Z+23
    0113C 2455      CLR	R5
    0113D 2C54      MOV	R5,R4
    0113E 2444      CLR	R4
    0113F 2842      OR	R4,R2
    01140 2853      OR	R5,R3
    01141 01FB      MOVW	R30,R22
    01142 8257      STD	Z+7,R5
    01143 8246      STD	Z+6,R4
(1883) 	}
(1884) 	*p = 0;		/* Terminate SFN str by a \0 */
    01144 2422      CLR	R2
    01145 01FA      MOVW	R30,R20
    01146 8220      ST	Z,R2
    01147 940C 4AFC JMP	pop_xgsetF0FC
ff.c:follow_path:
  ns                   --> R10
  res                  --> R20
  dir                  --> R10
  path                 --> Y,+6
  dj                   --> R22
    01149 933A      ST	-Y,R19
    0114A 932A      ST	-Y,R18
    0114B 940E 4B26 CALL	push_xgsetF00C
    0114D 01B8      MOVW	R22,R16
(1885) 
(1886) #if _USE_LFN
(1887) 	if (fno->lfname && fno->lfsize) {
(1888) 		TCHAR *tp = fno->lfname;
(1889) 		WCHAR w, *lfn;
(1890) 
(1891) 		i = 0;
(1892) 		if (dj->sect && dj->lfn_idx != 0xFFFF) {/* Get LFN if available */
(1893) 			lfn = dj->lfn;
(1894) 			while ((w = *lfn++) != 0) {			/* Get an LFN char */
(1895) #if !_LFN_UNICODE
(1896) 				w = ff_convert(w, 0);			/* Unicode -> OEM conversion */
(1897) 				if (!w) { i = 0; break; }		/* Could not convert, no LFN */
(1898) 				if (_DF1S && w >= 0x100)		/* Put 1st byte if it is a DBC (always false on SBCS cfg) */
(1899) 					tp[i++] = (TCHAR)(w >> 8);
(1900) #endif
(1901) 				if (i >= fno->lfsize - 1) { i = 0; break; }	/* Buffer overflow, no LFN */
(1902) 				tp[i++] = (TCHAR)w;
(1903) 			}
(1904) 		}
(1905) 		tp[i] = 0;	/* Terminate the LFN str by a \0 */
(1906) 	}
(1907) #endif
(1908) }
(1909) #endif /* _FS_MINIMIZE <= 1 */
(1910) 
(1911) 
(1912) 
(1913) 
(1914) /*-----------------------------------------------------------------------*/
(1915) /* Follow a file path                                                    */
(1916) /*-----------------------------------------------------------------------*/
(1917) 
(1918) static
(1919) FRESULT follow_path (	/* FR_OK(0): successful, !=0: error code */
(1920) 	DIR *dj,			/* Directory object to return last directory and found object */
(1921) 	const TCHAR *path	/* Full-path string to find a file or directory */
(1922) )
(1923) {
(1924) 	FRESULT res;
(1925) 	BYTE *dir, ns;
(1926) 
(1927) 
(1928) #if _FS_RPATH
(1929) 	if (*path == '/' || *path == '\\') { /* There is a heading separator */
(1930) 		path++;	dj->sclust = 0;		/* Strip it and start from the root dir */
(1931) 	} else {							/* No heading separator */
(1932) 		dj->sclust = dj->fs->cdir;	/* Start from the current dir */
(1933) 	}
(1934) #else
(1935) 	if (*path == '/' || *path == '\\')	/* Strip heading separator if exist */
    0114E 81EE      LDD	R30,Y+6
    0114F 81FF      LDD	R31,Y+7
    01150 8020      LD	R2,Z
    01151 2433      CLR	R3
    01152 2D82      MOV	R24,R2
    01153 328F      CPI	R24,0x2F
    01154 F011      BEQ	0x1157
    01155 358C      CPI	R24,0x5C
    01156 F429      BNE	0x115C
(1936) 		path++;
    01157 818E      LDD	R24,Y+6
    01158 819F      LDD	R25,Y+7
    01159 9601      ADIW	R24,1
    0115A 839F      STD	Y+7,R25
    0115B 838E      STD	Y+6,R24
(1937) 	dj->sclust = 0;						/* Start from the root dir */
    0115C 01FB      MOVW	R30,R22
    0115D 9636      ADIW	R30,6
    0115E E080      LDI	R24,0
    0115F 8380      ST	Z,R24
    01160 8381      STD	Z+1,R24
    01161 8382      STD	Z+2,R24
    01162 8383      STD	Z+3,R24
(1938) #endif
(1939) 
(1940) 	if ((UINT)*path < ' ') {			/* Nul path means the start directory itself */
    01163 81EE      LDD	R30,Y+6
    01164 81FF      LDD	R31,Y+7
    01165 8180      LD	R24,Z
    01166 2799      CLR	R25
    01167 3280      CPI	R24,0x20
    01168 E0E0      LDI	R30,0
    01169 079E      CPC	R25,R30
    0116A F458      BCC	0x1176
(1941) 		res = dir_sdi(dj, 0);
    0116B 2722      CLR	R18
    0116C 2733      CLR	R19
    0116D 018B      MOVW	R16,R22
    0116E DA84      RCALL	ff.c:dir_sdi
    0116F 2F40      MOV	R20,R16
(1942) 		dj->dir = 0;
    01170 2422      CLR	R2
    01171 2433      CLR	R3
    01172 01FB      MOVW	R30,R22
    01173 8A33      STD	Z+19,R3
    01174 8A22      STD	Z+18,R2
(1943) 
(1944) 	} else {							/* Follow path */
    01175 C052      RJMP	0x11C8
(1945) 		for (;;) {
(1946) 			res = create_name(dj, &path);	/* Get a segment */
    01176 019E      MOVW	R18,R28
    01177 5F2A      SUBI	R18,0xFA
    01178 4F3F      SBCI	R19,0xFF
    01179 018B      MOVW	R16,R22
    0117A DE23      RCALL	ff.c:create_name
    0117B 2EA0      MOV	R10,R16
    0117C 2D4A      MOV	R20,R10
(1947) 			if (res != FR_OK) break;
    0117D 2300      TST	R16
    0117E F009      BEQ	0x1180
    0117F C048      RJMP	0x11C8
(1948) 			res = dir_find(dj);				/* Find it */
    01180 018B      MOVW	R16,R22
    01181 DD29      RCALL	ff.c:dir_find
    01182 2EA0      MOV	R10,R16
    01183 2D4A      MOV	R20,R10
(1949) 			ns = *(dj->fn+NS);
    01184 01FB      MOVW	R30,R22
    01185 93AF      PUSH	R26
    01186 93BF      PUSH	R27
    01187 89A4      LDD	R26,Z+20
    01188 89B5      LDD	R27,Z+21
    01189 01FD      MOVW	R30,R26
    0118A 91BF      POP	R27
    0118B 91AF      POP	R26
    0118C 84A3      LDD	R10,Z+11
(1950) 			if (res != FR_OK) {				/* Failed to find the object */
    0118D 2300      TST	R16
    0118E F049      BEQ	0x1198
(1951) 				if (res != FR_NO_FILE) break;	/* Abort if any hard error occured */
    0118F 3004      CPI	R16,4
    01190 F009      BEQ	0x1192
    01191 C036      RJMP	0x11C8
(1952) 				/* Object not found */
(1953) 				if (_FS_RPATH && (ns & NS_DOT)) {	/* If dot entry is not exit */
    01192 C001      RJMP	0x1194
(1954) 					dj->sclust = 0; dj->dir = 0;	/* It is the root dir */
(1955) 					res = FR_OK;
(1956) 					if (!(ns & NS_LAST)) continue;
    01193 CFE2      RJMP	0x1176
(1957) 				} else {							/* Could not find the object */
(1958) 					if (!(ns & NS_LAST)) res = FR_NO_PATH;
    01194 FCA2      SBRC	R10,2
    01195 C032      RJMP	0x11C8
    01196 E045      LDI	R20,5
(1959) 				}
(1960) 				break;
    01197 C030      RJMP	0x11C8
(1961) 			}
(1962) 			if (ns & NS_LAST) break;			/* Last segment match. Function completed. */
    01198 FEA2      SBRS	R10,2
    01199 C001      RJMP	0x119B
    0119A C02D      RJMP	0x11C8
(1963) 			dir = dj->dir;						/* There is next segment. Follow the sub directory */
    0119B 01FB      MOVW	R30,R22
    0119C 88A2      LDD	R10,Z+18
    0119D 88B3      LDD	R11,Z+19
(1964) 			if (!(dir[DIR_Attr] & AM_DIR)) {	/* Cannot follow because it is a file */
    0119E 01F5      MOVW	R30,R10
    0119F 8423      LDD	R2,Z+11
    011A0 FC24      SBRC	R2,4
    011A1 C002      RJMP	0x11A4
(1965) 				res = FR_NO_PATH; break;
    011A2 E045      LDI	R20,5
    011A3 C024      RJMP	0x11C8
(1966) 			}
(1967) 			dj->sclust = LD_CLUST(dir);
    011A4 01F5      MOVW	R30,R10
    011A5 8C22      LDD	R2,Z+26
    011A6 2433      CLR	R3
    011A7 8C43      LDD	R4,Z+27
    011A8 2455      CLR	R5
    011A9 2C54      MOV	R5,R4
    011AA 2444      CLR	R4
    011AB 2842      OR	R4,R2
    011AC 2853      OR	R5,R3
    011AD 0112      MOVW	R2,R4
    011AE 2444      CLR	R4
    011AF 2455      CLR	R5
    011B0 8864      LDD	R6,Z+20
    011B1 2477      CLR	R7
    011B2 8885      LDD	R8,Z+21
    011B3 2499      CLR	R9
    011B4 2C98      MOV	R9,R8
    011B5 2488      CLR	R8
    011B6 2886      OR	R8,R6
    011B7 2897      OR	R9,R7
    011B8 0134      MOVW	R6,R8
    011B9 2488      CLR	R8
    011BA 2499      CLR	R9
    011BB 0143      MOVW	R8,R6
    011BC 2466      CLR	R6
    011BD 2477      CLR	R7
    011BE 2862      OR	R6,R2
    011BF 2873      OR	R7,R3
    011C0 2884      OR	R8,R4
    011C1 2895      OR	R9,R5
    011C2 01FB      MOVW	R30,R22
    011C3 8266      STD	Z+6,R6
    011C4 8277      STD	Z+7,R7
    011C5 8680      STD	Z+8,R8
    011C6 8691      STD	Z+9,R9
    011C7 CFAE      RJMP	0x1176
(1968) 		}
(1969) 	}
(1970) 
(1971) 	return res;
    011C8 2F04      MOV	R16,R20
    011C9 940E 4B2D CALL	pop_xgsetF00C
    011CB 9622      ADIW	R28,2
    011CC 9508      RET
ff.c:check_fs:
  sect                 --> Y,+11
  fs                   --> R10
    011CD 933A      ST	-Y,R19
    011CE 932A      ST	-Y,R18
    011CF 940E 4B26 CALL	push_xgsetF00C
    011D1 0158      MOVW	R10,R16
    011D2 9725      SBIW	R28,5
(1972) }
(1973) 
(1974) 
(1975) 
(1976) 
(1977) /*-----------------------------------------------------------------------*/
(1978) /* Load a sector and check if it is an FAT Volume Boot Record            */
(1979) /*-----------------------------------------------------------------------*/
(1980) 
(1981) static
(1982) BYTE check_fs (	/* 0:FAT-VBR, 1:Valid BR but not FAT, 2:Not a BR, 3:Disk error */
(1983) 	FATFS *fs,	/* File system object */
(1984) 	DWORD sect	/* Sector# (lba) to check if it is an FAT boot record or not */
(1985) )
(1986) {
(1987) 	if (disk_read(fs->drv, fs->win, sect, 1) != RES_OK)	/* Load boot record */
    011D3 E081      LDI	R24,1
    011D4 838C      STD	Y+4,R24
    011D5 842B      LDD	R2,Y+11
    011D6 843C      LDD	R3,Y+12
    011D7 844D      LDD	R4,Y+13
    011D8 845E      LDD	R5,Y+14
    011D9 8228      ST	Y,R2
    011DA 8239      STD	Y+1,R3
    011DB 824A      STD	Y+2,R4
    011DC 825B      STD	Y+3,R5
    011DD 0195      MOVW	R18,R10
    011DE 5D22      SUBI	R18,0xD2
    011DF 4F3F      SBCI	R19,0xFF
    011E0 01F5      MOVW	R30,R10
    011E1 8101      LDD	R16,Z+1
    011E2 940E 03DC CALL	_disk_read
    011E4 2300      TST	R16
    011E5 F011      BEQ	0x11E8
(1988) 		return 3;
    011E6 E003      LDI	R16,3
    011E7 C0A8      RJMP	0x1290
(1989) 	if (LD_WORD(&fs->win[BS_55AA]) != 0xAA55)		/* Check record signature (always placed at offset 510 even if the sector size is >512) */
    011E8 01F5      MOVW	R30,R10
    011E9 5DE4      SUBI	R30,0xD4
    011EA 4FFD      SBCI	R31,0xFD
    011EB 8020      LD	R2,Z
    011EC 52EC      SUBI	R30,0x2C
    011ED 40F2      SBCI	R31,2
    011EE 2433      CLR	R3
    011EF 5DE3      SUBI	R30,0xD3
    011F0 4FFD      SBCI	R31,0xFD
    011F1 8180      LD	R24,Z
    011F2 2799      CLR	R25
    011F3 2F98      MOV	R25,R24
    011F4 2788      CLR	R24
    011F5 2982      OR	R24,R2
    011F6 2993      OR	R25,R3
    011F7 3585      CPI	R24,0x55
    011F8 EAEA      LDI	R30,0xAA
    011F9 079E      CPC	R25,R30
    011FA F011      BEQ	0x11FD
(1990) 		return 2;
    011FB E002      LDI	R16,2
    011FC C093      RJMP	0x1290
(1991) 
(1992) 	if ((LD_DWORD(&fs->win[BS_FilSysType]) & 0xFFFFFF) == 0x544146)	/* Check "FAT" string */
    011FD E188      LDI	R24,0x18
    011FE E090      LDI	R25,0
    011FF 01F5      MOVW	R30,R10
    01200 59E9      SUBI	R30,0x99
    01201 4FFF      SBCI	R31,0xFF
    01202 8100      LD	R16,Z
    01203 2711      CLR	R17
    01204 2722      CLR	R18
    01205 2733      CLR	R19
    01206 938A      ST	-Y,R24
    01207 940E 4B92 CALL	lsl32
    01209 0118      MOVW	R2,R16
    0120A 0129      MOVW	R4,R18
    0120B 01F5      MOVW	R30,R10
    0120C 59EA      SUBI	R30,0x9A
    0120D 4FFF      SBCI	R31,0xFF
    0120E 8060      LD	R6,Z
    0120F 56E6      SUBI	R30,0x66
    01210 40F0      SBCI	R31,0
    01211 2477      CLR	R7
    01212 2488      CLR	R8
    01213 2499      CLR	R9
    01214 0143      MOVW	R8,R6
    01215 2466      CLR	R6
    01216 2477      CLR	R7
    01217 2826      OR	R2,R6
    01218 2837      OR	R3,R7
    01219 2848      OR	R4,R8
    0121A 2859      OR	R5,R9
    0121B 59EB      SUBI	R30,0x9B
    0121C 4FFF      SBCI	R31,0xFF
    0121D 8060      LD	R6,Z
    0121E 56E5      SUBI	R30,0x65
    0121F 40F0      SBCI	R31,0
    01220 2477      CLR	R7
    01221 2C76      MOV	R7,R6
    01222 2466      CLR	R6
    01223 2488      CLR	R8
    01224 2499      CLR	R9
    01225 2826      OR	R2,R6
    01226 2837      OR	R3,R7
    01227 2848      OR	R4,R8
    01228 2859      OR	R5,R9
    01229 59EC      SUBI	R30,0x9C
    0122A 4FFF      SBCI	R31,0xFF
    0122B 8060      LD	R6,Z
    0122C 2477      CLR	R7
    0122D 2488      CLR	R8
    0122E 2499      CLR	R9
    0122F 2826      OR	R2,R6
    01230 2837      OR	R3,R7
    01231 2848      OR	R4,R8
    01232 2859      OR	R5,R9
    01233 EF4F      LDI	R20,0xFF
    01234 EF5F      LDI	R21,0xFF
    01235 EF6F      LDI	R22,0xFF
    01236 E070      LDI	R23,0
    01237 2224      AND	R2,R20
    01238 2235      AND	R3,R21
    01239 2246      AND	R4,R22
    0123A 2257      AND	R5,R23
    0123B E446      LDI	R20,0x46
    0123C E451      LDI	R21,0x41
    0123D E564      LDI	R22,0x54
    0123E E070      LDI	R23,0
    0123F 1624      CP	R2,R20
    01240 0635      CPC	R3,R21
    01241 0646      CPC	R4,R22
    01242 0657      CPC	R5,R23
    01243 F411      BNE	0x1246
(1993) 		return 0;
    01244 2700      CLR	R16
    01245 C04A      RJMP	0x1290
(1994) 	if ((LD_DWORD(&fs->win[BS_FilSysType32]) & 0xFFFFFF) == 0x544146)
    01246 E188      LDI	R24,0x18
    01247 E090      LDI	R25,0
    01248 01F5      MOVW	R30,R10
    01249 57ED      SUBI	R30,0x7D
    0124A 4FFF      SBCI	R31,0xFF
    0124B 8100      LD	R16,Z
    0124C 2711      CLR	R17
    0124D 2722      CLR	R18
    0124E 2733      CLR	R19
    0124F 938A      ST	-Y,R24
    01250 940E 4B92 CALL	lsl32
    01252 0118      MOVW	R2,R16
    01253 0129      MOVW	R4,R18
    01254 01F5      MOVW	R30,R10
    01255 57EE      SUBI	R30,0x7E
    01256 4FFF      SBCI	R31,0xFF
    01257 8060      LD	R6,Z
    01258 58E2      SUBI	R30,0x82
    01259 40F0      SBCI	R31,0
    0125A 2477      CLR	R7
    0125B 2488      CLR	R8
    0125C 2499      CLR	R9
    0125D 0143      MOVW	R8,R6
    0125E 2466      CLR	R6
    0125F 2477      CLR	R7
    01260 2826      OR	R2,R6
    01261 2837      OR	R3,R7
    01262 2848      OR	R4,R8
    01263 2859      OR	R5,R9
    01264 57EF      SUBI	R30,0x7F
    01265 4FFF      SBCI	R31,0xFF
    01266 8060      LD	R6,Z
    01267 58E1      SUBI	R30,0x81
    01268 40F0      SBCI	R31,0
    01269 2477      CLR	R7
    0126A 2C76      MOV	R7,R6
    0126B 2466      CLR	R6
    0126C 2488      CLR	R8
    0126D 2499      CLR	R9
    0126E 2826      OR	R2,R6
    0126F 2837      OR	R3,R7
    01270 2848      OR	R4,R8
    01271 2859      OR	R5,R9
    01272 58E0      SUBI	R30,0x80
    01273 4FFF      SBCI	R31,0xFF
    01274 8060      LD	R6,Z
    01275 2477      CLR	R7
    01276 2488      CLR	R8
    01277 2499      CLR	R9
    01278 2826      OR	R2,R6
    01279 2837      OR	R3,R7
    0127A 2848      OR	R4,R8
    0127B 2859      OR	R5,R9
    0127C EF4F      LDI	R20,0xFF
    0127D EF5F      LDI	R21,0xFF
    0127E EF6F      LDI	R22,0xFF
    0127F E070      LDI	R23,0
    01280 2224      AND	R2,R20
    01281 2235      AND	R3,R21
    01282 2246      AND	R4,R22
    01283 2257      AND	R5,R23
    01284 E446      LDI	R20,0x46
    01285 E451      LDI	R21,0x41
    01286 E564      LDI	R22,0x54
    01287 E070      LDI	R23,0
    01288 1624      CP	R2,R20
    01289 0635      CPC	R3,R21
    0128A 0646      CPC	R4,R22
    0128B 0657      CPC	R5,R23
    0128C F411      BNE	0x128F
(1995) 		return 0;
    0128D 2700      CLR	R16
    0128E C001      RJMP	0x1290
(1996) 
(1997) 	return 1;
    0128F E001      LDI	R16,1
    01290 9625      ADIW	R28,5
    01291 940E 4B2D CALL	pop_xgsetF00C
    01293 9622      ADIW	R28,2
    01294 9508      RET
ff.c:chk_mounted:
  pi                   --> R10
  szbfat               --> Y,+25
  tbl                  --> R10
  p                    --> R10
  nrsv                 --> R14
  sysect               --> Y,+21
  bsect                --> Y,+17
  stat                 --> R10
  tsect                --> Y,+13
  nclst                --> Y,+9
  vol                  --> R14
  fasize               --> Y,+5
  b                    --> R14
  fmt                  --> R12
  fs                   --> Y,+37
  chk_wp               --> Y,+51
  rfs                  --> Y,+49
  path                 --> R12
    01295 933A      ST	-Y,R19
    01296 932A      ST	-Y,R18
    01297 940E 4B07 CALL	push_xgsetF0FC
    01299 0168      MOVW	R12,R16
    0129A 97A7      SBIW	R28,0x27
(1998) }
(1999) 
(2000) 
(2001) 
(2002) 
(2003) /*-----------------------------------------------------------------------*/
(2004) /* Check if the file system object is valid or not                       */
(2005) /*-----------------------------------------------------------------------*/
(2006) 
(2007) static
(2008) FRESULT chk_mounted (	/* FR_OK(0): successful, !=0: any error occurred */
(2009) 	const TCHAR **path,	/* Pointer to pointer to the path name (drive number) */
(2010) 	FATFS **rfs,		/* Pointer to pointer to the found file system object */
(2011) 	BYTE chk_wp			/* !=0: Check media write protection for write access */
(2012) )
(2013) {
(2014) 	BYTE fmt, b, pi, *tbl;
(2015) 	UINT vol;
(2016) 	DSTATUS stat;
(2017) 	DWORD bsect, fasize, tsect, sysect, nclst, szbfat;
(2018) 	WORD nrsv;
(2019) 	const TCHAR *p = *path;
    0129B 01F6      MOVW	R30,R12
    0129C 80A0      LD	R10,Z
    0129D 80B1      LDD	R11,Z+1
(2020) 	FATFS *fs;
(2021) 
(2022) 	/* Get logical drive number from the path name */
(2023) 	vol = p[0] - '0';					/* Is there a drive number? */
    0129E 01F5      MOVW	R30,R10
    0129F 8180      LD	R24,Z
    012A0 2799      CLR	R25
    012A1 97C0      SBIW	R24,0x30
    012A2 017C      MOVW	R14,R24
(2024) 	if (vol <= 9 && p[1] == ':') {		/* Found a drive number, get and strip it */
    012A3 E089      LDI	R24,0x9
    012A4 E090      LDI	R25,0
    012A5 158E      CP	R24,R14
    012A6 059F      CPC	R25,R15
    012A7 F050      BCS	0x12B2
    012A8 8181      LDD	R24,Z+1
    012A9 338A      CPI	R24,0x3A
    012AA F439      BNE	0x12B2
(2025) 		p += 2; *path = p;				/* Return pointer to the path name */
    012AB 01CF      MOVW	R24,R30
    012AC 9602      ADIW	R24,2
    012AD 015C      MOVW	R10,R24
    012AE 01F6      MOVW	R30,R12
    012AF 82B1      STD	Z+1,R11
    012B0 82A0      ST	Z,R10
(2026) 	} else {							/* No drive number is given */
    012B1 C002      RJMP	0x12B4
(2027) #if _FS_RPATH
(2028) 		vol = CurrVol;					/* Use current drive */
(2029) #else
(2030) 		vol = 0;						/* Use drive 0 */
    012B2 24EE      CLR	R14
    012B3 24FF      CLR	R15
(2031) #endif
(2032) 	}
(2033) 
(2034) 	/* Check if the file system object is valid or not */
(2035) 	if (vol >= _VOLUMES) 				/* Is the drive number valid? */
    012B4 01C7      MOVW	R24,R14
    012B5 3081      CPI	R24,1
    012B6 E0E0      LDI	R30,0
    012B7 079E      CPC	R25,R30
    012B8 F010      BCS	0x12BB
(2036) 		return FR_INVALID_DRIVE;
    012B9 E00B      LDI	R16,0xB
    012BA C4CF      RJMP	0x178A
(2037) 	*rfs = fs = FatFs[vol];				/* Return pointer to the corresponding file system object */
    012BB EE89      LDI	R24,0xE9
    012BC E095      LDI	R25,5
    012BD 01F7      MOVW	R30,R14
    012BE 0FEE      LSL	R30
    012BF 1FFF      ROL	R31
    012C0 0FE8      ADD	R30,R24
    012C1 1FF9      ADC	R31,R25
    012C2 8020      LD	R2,Z
    012C3 8031      LDD	R3,Z+1
    012C4 A23E      STD	Y+38,R3
    012C5 A22D      STD	Y+37,R2
    012C6 A9E9      LDD	R30,Y+49
    012C7 A9FA      LDD	R31,Y+50
    012C8 8231      STD	Z+1,R3
    012C9 8220      ST	Z,R2
(2038) 	if (!fs) return FR_NOT_ENABLED;		/* Is the file system object available? */
    012CA 0101      MOVW	R0,R2
    012CB 2022      TST	R2
    012CC F421      BNE	0x12D1
    012CD 2033      TST	R3
    012CE F411      BNE	0x12D1
    012CF E00C      LDI	R16,0xC
    012D0 C4B9      RJMP	0x178A
(2039) 
(2040) 	ENTER_FF(fs);						/* Lock file system */
(2041) 
(2042) 	if (fs->fs_type) {					/* If the logical drive has been mounted */
    012D1 A1ED      LDD	R30,Y+37
    012D2 A1FE      LDD	R31,Y+38
    012D3 8020      LD	R2,Z
    012D4 2022      TST	R2
    012D5 F079      BEQ	0x12E5
(2043) 		stat = disk_status(fs->drv);
    012D6 8101      LDD	R16,Z+1
    012D7 940E 03D6 CALL	_disk_status
    012D9 2EA0      MOV	R10,R16
(2044) 		if (!(stat & STA_NOINIT)) {		/* and the physical drive is kept initialized (has not been changed), */
    012DA FD00      SBRC	R16,0
    012DB C009      RJMP	0x12E5
(2045) 			if (!_FS_READONLY && chk_wp && (stat & STA_PROTECT))	/* Check write protection if needed */
    012DC A80B      LDD	R0,Y+51
    012DD 2000      TST	R0
    012DE F021      BEQ	0x12E3
    012DF FF02      SBRS	R16,2
    012E0 C002      RJMP	0x12E3
(2046) 				return FR_WRITE_PROTECTED;
    012E1 E00A      LDI	R16,0xA
    012E2 C4A7      RJMP	0x178A
(2047) 			return FR_OK;				/* The file system object is valid */
    012E3 2700      CLR	R16
    012E4 C4A5      RJMP	0x178A
(2048) 		}
(2049) 	}
(2050) 
(2051) 	/* The file system object is not valid. */
(2052) 	/* Following code attempts to mount the volume. (analyze BPB and initialize the fs object) */
(2053) 
(2054) 	fs->fs_type = 0;					/* Clear the file system object */
    012E5 2422      CLR	R2
    012E6 A1ED      LDD	R30,Y+37
    012E7 A1FE      LDD	R31,Y+38
    012E8 8220      ST	Z,R2
(2055) 	fs->drv = LD2PD(vol);				/* Bind the logical drive and a physical drive */
    012E9 82E1      STD	Z+1,R14
(2056) 	stat = disk_initialize(fs->drv);	/* Initialize low level disk I/O layer */
    012EA 8101      LDD	R16,Z+1
    012EB 940E 03C0 CALL	_disk_initialize
    012ED 2EE0      MOV	R14,R16
    012EE 2CAE      MOV	R10,R14
(2057) 	if (stat & STA_NOINIT)				/* Check if the initialization succeeded */
    012EF FF00      SBRS	R16,0
    012F0 C002      RJMP	0x12F3
(2058) 		return FR_NOT_READY;			/* Failed to initialize due to no media or hard error */
    012F1 E003      LDI	R16,3
    012F2 C497      RJMP	0x178A
(2059) 	if (!_FS_READONLY && chk_wp && (stat & STA_PROTECT))	/* Check disk write protection if needed */
    012F3 A80B      LDD	R0,Y+51
    012F4 2000      TST	R0
    012F5 F021      BEQ	0x12FA
    012F6 FEA2      SBRS	R10,2
    012F7 C002      RJMP	0x12FA
(2060) 		return FR_WRITE_PROTECTED;
    012F8 E00A      LDI	R16,0xA
    012F9 C490      RJMP	0x178A
(2061) #if _MAX_SS != 512						/* Get disk sector size (variable sector size cfg only) */
(2062) 	if (disk_ioctl(fs->drv, GET_SECTOR_SIZE, &fs->ssize) != RES_OK)
(2063) 		return FR_DISK_ERR;
(2064) #endif
(2065) 	/* Search FAT partition on the drive. Supports only generic partitionings, FDISK and SFD. */
(2066) 	fmt = check_fs(fs, bsect = 0);		/* Load sector 0 and check if it is an FAT-VBR (in SFD) */
    012FA E080      LDI	R24,0
    012FB 8B89      STD	Y+17,R24
    012FC 8B8A      STD	Y+18,R24
    012FD 8B8B      STD	Y+19,R24
    012FE 8B8C      STD	Y+20,R24
    012FF E040      LDI	R20,0
    01300 E050      LDI	R21,0
    01301 E060      LDI	R22,0
    01302 E070      LDI	R23,0
    01303 8368      ST	Y,R22
    01304 8379      STD	Y+1,R23
    01305 019A      MOVW	R18,R20
    01306 A10D      LDD	R16,Y+37
    01307 A11E      LDD	R17,Y+38
    01308 DEC4      RCALL	ff.c:check_fs
    01309 2EA0      MOV	R10,R16
    0130A 2CCA      MOV	R12,R10
(2067) 	if (LD2PT(vol) && !fmt) fmt = 1;	/* Force non-SFD if the volume is forced partition */
    0130B C000      RJMP	0x130C
(2068) 	if (fmt == 1) {						/* Not an FAT-VBR, the physical drive can be partitioned */
    0130C 2D8C      MOV	R24,R12
    0130D 3081      CPI	R24,1
    0130E F009      BEQ	0x1310
    0130F C04C      RJMP	0x135C
(2069) 		/* Check the partition listed in the partition table */
(2070) 		pi = LD2PT(vol);
    01310 24AA      CLR	R10
(2071) 		if (pi) pi--;
    01311 F009      BEQ	0x1313
    01312 94AA      DEC	R10
(2072) 		tbl = &fs->win[MBR_Table + pi * SZ_PTE];/* Partition table */
    01313 E100      LDI	R16,0x10
    01314 2D1A      MOV	R17,R10
    01315 0301      MULSU	R16,R17
    01316 0150      MOVW	R10,R0
    01317 A18D      LDD	R24,Y+37
    01318 A19E      LDD	R25,Y+38
    01319 5184      SUBI	R24,0x14
    0131A 4F9E      SBCI	R25,0xFE
    0131B 0EA8      ADD	R10,R24
    0131C 1EB9      ADC	R11,R25
(2073) 		if (tbl[4]) {						/* Is the partition existing? */
    0131D 01F5      MOVW	R30,R10
    0131E 8024      LDD	R2,Z+4
    0131F 2022      TST	R2
    01320 F409      BNE	0x1322
    01321 C03A      RJMP	0x135C
(2074) 			bsect = LD_DWORD(&tbl[8]);		/* Partition offset in LBA */
    01322 E188      LDI	R24,0x18
    01323 E090      LDI	R25,0
    01324 8503      LDD	R16,Z+11
    01325 2711      CLR	R17
    01326 2722      CLR	R18
    01327 2733      CLR	R19
    01328 938A      ST	-Y,R24
    01329 940E 4B92 CALL	lsl32
    0132B 0118      MOVW	R2,R16
    0132C 0129      MOVW	R4,R18
    0132D 01F5      MOVW	R30,R10
    0132E 8462      LDD	R6,Z+10
    0132F 2477      CLR	R7
    01330 2488      CLR	R8
    01331 2499      CLR	R9
    01332 0143      MOVW	R8,R6
    01333 2466      CLR	R6
    01334 2477      CLR	R7
    01335 2826      OR	R2,R6
    01336 2837      OR	R3,R7
    01337 2848      OR	R4,R8
    01338 2859      OR	R5,R9
    01339 8461      LDD	R6,Z+9
    0133A 2477      CLR	R7
    0133B 2C76      MOV	R7,R6
    0133C 2466      CLR	R6
    0133D 2488      CLR	R8
    0133E 2499      CLR	R9
    0133F 2826      OR	R2,R6
    01340 2837      OR	R3,R7
    01341 2848      OR	R4,R8
    01342 2859      OR	R5,R9
    01343 9638      ADIW	R30,0x8
    01344 8060      LD	R6,Z
    01345 2477      CLR	R7
    01346 2488      CLR	R8
    01347 2499      CLR	R9
    01348 2826      OR	R2,R6
    01349 2837      OR	R3,R7
    0134A 2848      OR	R4,R8
    0134B 2859      OR	R5,R9
    0134C 8A29      STD	Y+17,R2
    0134D 8A3A      STD	Y+18,R3
    0134E 8A4B      STD	Y+19,R4
    0134F 8A5C      STD	Y+20,R5
(2075) 			fmt = check_fs(fs, bsect);		/* Check the partition */
    01350 8829      LDD	R2,Y+17
    01351 883A      LDD	R3,Y+18
    01352 884B      LDD	R4,Y+19
    01353 885C      LDD	R5,Y+20
    01354 8248      ST	Y,R4
    01355 8259      STD	Y+1,R5
    01356 0191      MOVW	R18,R2
    01357 A10D      LDD	R16,Y+37
    01358 A11E      LDD	R17,Y+38
    01359 DE73      RCALL	ff.c:check_fs
    0135A 2EA0      MOV	R10,R16
    0135B 2CCA      MOV	R12,R10
(2076) 		}
(2077) 	}
(2078) 	if (fmt == 3) return FR_DISK_ERR;
    0135C 2D8C      MOV	R24,R12
    0135D 3083      CPI	R24,3
    0135E F411      BNE	0x1361
    0135F E001      LDI	R16,1
    01360 C429      RJMP	0x178A
(2079) 	if (fmt) return FR_NO_FILESYSTEM;		/* No FAT volume is found */
    01361 20CC      TST	R12
    01362 F011      BEQ	0x1365
    01363 E00D      LDI	R16,0xD
    01364 C425      RJMP	0x178A
(2080) 
(2081) 	/* An FAT volume is found. Following code initializes the file system object */
(2082) 
(2083) 	if (LD_WORD(fs->win+BPB_BytsPerSec) != SS(fs))		/* (BPB_BytsPerSec must be equal to the physical sector size) */
    01365 A1ED      LDD	R30,Y+37
    01366 A1FE      LDD	R31,Y+38
    01367 AC21      LDD	R2,Z+57
    01368 2433      CLR	R3
    01369 AD82      LDD	R24,Z+58
    0136A 2799      CLR	R25
    0136B 2F98      MOV	R25,R24
    0136C 2788      CLR	R24
    0136D 2982      OR	R24,R2
    0136E 2993      OR	R25,R3
    0136F 3080      CPI	R24,0
    01370 E0E2      LDI	R30,2
    01371 079E      CPC	R25,R30
    01372 F011      BEQ	0x1375
(2084) 		return FR_NO_FILESYSTEM;
    01373 E00D      LDI	R16,0xD
    01374 C415      RJMP	0x178A
(2085) 
(2086) 	fasize = LD_WORD(fs->win+BPB_FATSz16);				/* Number of sectors per FAT */
    01375 A1ED      LDD	R30,Y+37
    01376 A1FE      LDD	R31,Y+38
    01377 5BEC      SUBI	R30,0xBC
    01378 4FFF      SBCI	R31,0xFF
    01379 8020      LD	R2,Z
    0137A 54E4      SUBI	R30,0x44
    0137B 40F0      SBCI	R31,0
    0137C 2433      CLR	R3
    0137D 5BEB      SUBI	R30,0xBB
    0137E 4FFF      SBCI	R31,0xFF
    0137F 8040      LD	R4,Z
    01380 2455      CLR	R5
    01381 2C54      MOV	R5,R4
    01382 2444      CLR	R4
    01383 2842      OR	R4,R2
    01384 2853      OR	R5,R3
    01385 0112      MOVW	R2,R4
    01386 2444      CLR	R4
    01387 2455      CLR	R5
    01388 822D      STD	Y+5,R2
    01389 823E      STD	Y+6,R3
    0138A 824F      STD	Y+7,R4
    0138B 8658      STD	Y+8,R5
(2087) 	if (!fasize) fasize = LD_DWORD(fs->win+BPB_FATSz32);
    0138C 802D      LDD	R2,Y+5
    0138D 803E      LDD	R3,Y+6
    0138E 804F      LDD	R4,Y+7
    0138F 8458      LDD	R5,Y+8
    01390 9488      BCLR	0
    01391 2022      TST	R2
    01392 0432      CPC	R3,R2
    01393 0442      CPC	R4,R2
    01394 0452      CPC	R5,R2
    01395 F009      BEQ	0x1397
    01396 C03C      RJMP	0x13D3
    01397 E188      LDI	R24,0x18
    01398 E090      LDI	R25,0
    01399 A1ED      LDD	R30,Y+37
    0139A A1FE      LDD	R31,Y+38
    0139B 5AEB      SUBI	R30,0xAB
    0139C 4FFF      SBCI	R31,0xFF
    0139D 8100      LD	R16,Z
    0139E 2711      CLR	R17
    0139F 2722      CLR	R18
    013A0 2733      CLR	R19
    013A1 938A      ST	-Y,R24
    013A2 940E 4B92 CALL	lsl32
    013A4 0118      MOVW	R2,R16
    013A5 0129      MOVW	R4,R18
    013A6 A1ED      LDD	R30,Y+37
    013A7 A1FE      LDD	R31,Y+38
    013A8 5AEC      SUBI	R30,0xAC
    013A9 4FFF      SBCI	R31,0xFF
    013AA 8060      LD	R6,Z
    013AB 55E4      SUBI	R30,0x54
    013AC 40F0      SBCI	R31,0
    013AD 2477      CLR	R7
    013AE 2488      CLR	R8
    013AF 2499      CLR	R9
    013B0 0143      MOVW	R8,R6
    013B1 2466      CLR	R6
    013B2 2477      CLR	R7
    013B3 2826      OR	R2,R6
    013B4 2837      OR	R3,R7
    013B5 2848      OR	R4,R8
    013B6 2859      OR	R5,R9
    013B7 5AED      SUBI	R30,0xAD
    013B8 4FFF      SBCI	R31,0xFF
    013B9 8060      LD	R6,Z
    013BA 55E3      SUBI	R30,0x53
    013BB 40F0      SBCI	R31,0
    013BC 2477      CLR	R7
    013BD 2C76      MOV	R7,R6
    013BE 2466      CLR	R6
    013BF 2488      CLR	R8
    013C0 2499      CLR	R9
    013C1 2826      OR	R2,R6
    013C2 2837      OR	R3,R7
    013C3 2848      OR	R4,R8
    013C4 2859      OR	R5,R9
    013C5 5AEE      SUBI	R30,0xAE
    013C6 4FFF      SBCI	R31,0xFF
    013C7 8060      LD	R6,Z
    013C8 2477      CLR	R7
    013C9 2488      CLR	R8
    013CA 2499      CLR	R9
    013CB 2826      OR	R2,R6
    013CC 2837      OR	R3,R7
    013CD 2848      OR	R4,R8
    013CE 2859      OR	R5,R9
    013CF 822D      STD	Y+5,R2
    013D0 823E      STD	Y+6,R3
    013D1 824F      STD	Y+7,R4
    013D2 8658      STD	Y+8,R5
(2088) 	fs->fsize = fasize;
    013D3 802D      LDD	R2,Y+5
    013D4 803E      LDD	R3,Y+6
    013D5 804F      LDD	R4,Y+7
    013D6 8458      LDD	R5,Y+8
    013D7 A1ED      LDD	R30,Y+37
    013D8 A1FE      LDD	R31,Y+38
    013D9 8E22      STD	Z+26,R2
    013DA 8E33      STD	Z+27,R3
    013DB 8E44      STD	Z+28,R4
    013DC 8E55      STD	Z+29,R5
(2089) 
(2090) 	fs->n_fats = b = fs->win[BPB_NumFATs];				/* Number of FAT copies */
    013DD ACA6      LDD	R10,Z+62
    013DE 2CEA      MOV	R14,R10
    013DF 82A3      STD	Z+3,R10
(2091) 	if (b != 1 && b != 2) return FR_NO_FILESYSTEM;		/* (Must be 1 or 2) */
    013E0 2D8E      MOV	R24,R14
    013E1 3081      CPI	R24,1
    013E2 F021      BEQ	0x13E7
    013E3 3082      CPI	R24,2
    013E4 F011      BEQ	0x13E7
    013E5 E00D      LDI	R16,0xD
    013E6 C3A3      RJMP	0x178A
(2092) 	fasize *= b;										/* Number of sectors for FAT area */
    013E7 2C2E      MOV	R2,R14
    013E8 2433      CLR	R3
    013E9 2444      CLR	R4
    013EA 2455      CLR	R5
    013EB 810D      LDD	R16,Y+5
    013EC 811E      LDD	R17,Y+6
    013ED 812F      LDD	R18,Y+7
    013EE 8538      LDD	R19,Y+8
    013EF 925A      ST	-Y,R5
    013F0 924A      ST	-Y,R4
    013F1 923A      ST	-Y,R3
    013F2 922A      ST	-Y,R2
    013F3 940E 4AB3 CALL	empy32s|empy32u
    013F5 830D      STD	Y+5,R16
    013F6 831E      STD	Y+6,R17
    013F7 832F      STD	Y+7,R18
    013F8 8738      STD	Y+8,R19
(2093) 
(2094) 	fs->csize = b = fs->win[BPB_SecPerClus];			/* Number of sectors per cluster */
    013F9 A1ED      LDD	R30,Y+37
    013FA A1FE      LDD	R31,Y+38
    013FB ACA3      LDD	R10,Z+59
    013FC 2CEA      MOV	R14,R10
    013FD 82A2      STD	Z+2,R10
(2095) 	if (!b || (b & (b - 1))) return FR_NO_FILESYSTEM;	/* (Must be power of 2) */
    013FE 20AA      TST	R10
    013FF F029      BEQ	0x1405
    01400 2D8E      MOV	R24,R14
    01401 5081      SUBI	R24,1
    01402 2C2E      MOV	R2,R14
    01403 2228      AND	R2,R24
    01404 F011      BEQ	0x1407
    01405 E00D      LDI	R16,0xD
    01406 C383      RJMP	0x178A
(2096) 
(2097) 	fs->n_rootdir = LD_WORD(fs->win+BPB_RootEntCnt);	/* Number of root directory entries */
    01407 A1ED      LDD	R30,Y+37
    01408 A1FE      LDD	R31,Y+38
    01409 AC27      LDD	R2,Z+63
    0140A 2433      CLR	R3
    0140B 5CE0      SUBI	R30,0xC0
    0140C 4FFF      SBCI	R31,0xFF
    0140D 8040      LD	R4,Z
    0140E 54E0      SUBI	R30,0x40
    0140F 40F0      SBCI	R31,0
    01410 2455      CLR	R5
    01411 2C54      MOV	R5,R4
    01412 2444      CLR	R4
    01413 2842      OR	R4,R2
    01414 2853      OR	R5,R3
    01415 8651      STD	Z+9,R5
    01416 8640      STD	Z+8,R4
(2098) 	if (fs->n_rootdir % (SS(fs) / SZ_DIR)) return FR_NO_FILESYSTEM;	/* (BPB_RootEntCnt must be sector aligned) */
    01417 8580      LDD	R24,Z+8
    01418 8591      LDD	R25,Z+9
    01419 708F      ANDI	R24,0xF
    0141A 7090      ANDI	R25,0
    0141B 3080      CPI	R24,0
    0141C 0789      CPC	R24,R25
    0141D F011      BEQ	0x1420
    0141E E00D      LDI	R16,0xD
    0141F C36A      RJMP	0x178A
(2099) 
(2100) 	tsect = LD_WORD(fs->win+BPB_TotSec16);				/* Number of sectors on the volume */
    01420 A1ED      LDD	R30,Y+37
    01421 A1FE      LDD	R31,Y+38
    01422 5BEF      SUBI	R30,0xBF
    01423 4FFF      SBCI	R31,0xFF
    01424 8020      LD	R2,Z
    01425 54E1      SUBI	R30,0x41
    01426 40F0      SBCI	R31,0
    01427 2433      CLR	R3
    01428 5BEE      SUBI	R30,0xBE
    01429 4FFF      SBCI	R31,0xFF
    0142A 8040      LD	R4,Z
    0142B 2455      CLR	R5
    0142C 2C54      MOV	R5,R4
    0142D 2444      CLR	R4
    0142E 2842      OR	R4,R2
    0142F 2853      OR	R5,R3
    01430 0112      MOVW	R2,R4
    01431 2444      CLR	R4
    01432 2455      CLR	R5
    01433 862D      STD	Y+13,R2
    01434 863E      STD	Y+14,R3
    01435 864F      STD	Y+15,R4
    01436 8A58      STD	Y+16,R5
(2101) 	if (!tsect) tsect = LD_DWORD(fs->win+BPB_TotSec32);
    01437 842D      LDD	R2,Y+13
    01438 843E      LDD	R3,Y+14
    01439 844F      LDD	R4,Y+15
    0143A 8858      LDD	R5,Y+16
    0143B 9488      BCLR	0
    0143C 2022      TST	R2
    0143D 0432      CPC	R3,R2
    0143E 0442      CPC	R4,R2
    0143F 0452      CPC	R5,R2
    01440 F009      BEQ	0x1442
    01441 C03C      RJMP	0x147E
    01442 E188      LDI	R24,0x18
    01443 E090      LDI	R25,0
    01444 A1ED      LDD	R30,Y+37
    01445 A1FE      LDD	R31,Y+38
    01446 5AEF      SUBI	R30,0xAF
    01447 4FFF      SBCI	R31,0xFF
    01448 8100      LD	R16,Z
    01449 2711      CLR	R17
    0144A 2722      CLR	R18
    0144B 2733      CLR	R19
    0144C 938A      ST	-Y,R24
    0144D 940E 4B92 CALL	lsl32
    0144F 0118      MOVW	R2,R16
    01450 0129      MOVW	R4,R18
    01451 A1ED      LDD	R30,Y+37
    01452 A1FE      LDD	R31,Y+38
    01453 5BE0      SUBI	R30,0xB0
    01454 4FFF      SBCI	R31,0xFF
    01455 8060      LD	R6,Z
    01456 55E0      SUBI	R30,0x50
    01457 40F0      SBCI	R31,0
    01458 2477      CLR	R7
    01459 2488      CLR	R8
    0145A 2499      CLR	R9
    0145B 0143      MOVW	R8,R6
    0145C 2466      CLR	R6
    0145D 2477      CLR	R7
    0145E 2826      OR	R2,R6
    0145F 2837      OR	R3,R7
    01460 2848      OR	R4,R8
    01461 2859      OR	R5,R9
    01462 5BE1      SUBI	R30,0xB1
    01463 4FFF      SBCI	R31,0xFF
    01464 8060      LD	R6,Z
    01465 54EF      SUBI	R30,0x4F
    01466 40F0      SBCI	R31,0
    01467 2477      CLR	R7
    01468 2C76      MOV	R7,R6
    01469 2466      CLR	R6
    0146A 2488      CLR	R8
    0146B 2499      CLR	R9
    0146C 2826      OR	R2,R6
    0146D 2837      OR	R3,R7
    0146E 2848      OR	R4,R8
    0146F 2859      OR	R5,R9
    01470 5BE2      SUBI	R30,0xB2
    01471 4FFF      SBCI	R31,0xFF
    01472 8060      LD	R6,Z
    01473 2477      CLR	R7
    01474 2488      CLR	R8
    01475 2499      CLR	R9
    01476 2826      OR	R2,R6
    01477 2837      OR	R3,R7
    01478 2848      OR	R4,R8
    01479 2859      OR	R5,R9
    0147A 862D      STD	Y+13,R2
    0147B 863E      STD	Y+14,R3
    0147C 864F      STD	Y+15,R4
    0147D 8A58      STD	Y+16,R5
(2102) 
(2103) 	nrsv = LD_WORD(fs->win+BPB_RsvdSecCnt);				/* Number of reserved sectors */
    0147E A1ED      LDD	R30,Y+37
    0147F A1FE      LDD	R31,Y+38
    01480 AC24      LDD	R2,Z+60
    01481 2433      CLR	R3
    01482 ACE5      LDD	R14,Z+61
    01483 24FF      CLR	R15
    01484 2CFE      MOV	R15,R14
    01485 24EE      CLR	R14
    01486 28E2      OR	R14,R2
    01487 28F3      OR	R15,R3
(2104) 	if (!nrsv) return FR_NO_FILESYSTEM;					/* (BPB_RsvdSecCnt must not be 0) */
    01488 20EE      TST	R14
    01489 F421      BNE	0x148E
    0148A 20FF      TST	R15
    0148B F411      BNE	0x148E
    0148C E00D      LDI	R16,0xD
    0148D C2FC      RJMP	0x178A
(2105) 
(2106) 	/* Determine the FAT sub type */
(2107) 	sysect = nrsv + fasize + fs->n_rootdir / (SS(fs) / SZ_DIR);	/* RSV+FAT+DIR */
    0148E 802D      LDD	R2,Y+5
    0148F 803E      LDD	R3,Y+6
    01490 804F      LDD	R4,Y+7
    01491 8458      LDD	R5,Y+8
    01492 0137      MOVW	R6,R14
    01493 2488      CLR	R8
    01494 2499      CLR	R9
    01495 0C62      ADD	R6,R2
    01496 1C73      ADC	R7,R3
    01497 1C84      ADC	R8,R4
    01498 1C95      ADC	R9,R5
    01499 A1ED      LDD	R30,Y+37
    0149A A1FE      LDD	R31,Y+38
    0149B 9638      ADIW	R30,0x8
    0149C 8020      LD	R2,Z
    0149D 8031      LDD	R3,Z+1
    0149E 9436      LSR	R3
    0149F 9427      ROR	R2
    014A0 9436      LSR	R3
    014A1 9427      ROR	R2
    014A2 9436      LSR	R3
    014A3 9427      ROR	R2
    014A4 9436      LSR	R3
    014A5 9427      ROR	R2
    014A6 2444      CLR	R4
    014A7 2455      CLR	R5
    014A8 0C62      ADD	R6,R2
    014A9 1C73      ADC	R7,R3
    014AA 1C84      ADC	R8,R4
    014AB 1C95      ADC	R9,R5
    014AC 8A6D      STD	Y+21,R6
    014AD 8A7E      STD	Y+22,R7
    014AE 8A8F      STD	Y+23,R8
    014AF 8E98      STD	Y+24,R9
(2108) 	if (tsect < sysect) return FR_NO_FILESYSTEM;		/* (Invalid volume size) */
    014B0 882D      LDD	R2,Y+21
    014B1 883E      LDD	R3,Y+22
    014B2 884F      LDD	R4,Y+23
    014B3 8C58      LDD	R5,Y+24
    014B4 846D      LDD	R6,Y+13
    014B5 847E      LDD	R7,Y+14
    014B6 848F      LDD	R8,Y+15
    014B7 8898      LDD	R9,Y+16
    014B8 1462      CP	R6,R2
    014B9 0473      CPC	R7,R3
    014BA 0484      CPC	R8,R4
    014BB 0495      CPC	R9,R5
    014BC F410      BCC	0x14BF
    014BD E00D      LDI	R16,0xD
    014BE C2CB      RJMP	0x178A
(2109) 	nclst = (tsect - sysect) / fs->csize;				/* Number of clusters */
    014BF 882D      LDD	R2,Y+21
    014C0 883E      LDD	R3,Y+22
    014C1 884F      LDD	R4,Y+23
    014C2 8C58      LDD	R5,Y+24
    014C3 850D      LDD	R16,Y+13
    014C4 851E      LDD	R17,Y+14
    014C5 852F      LDD	R18,Y+15
    014C6 8938      LDD	R19,Y+16
    014C7 1902      SUB	R16,R2
    014C8 0913      SBC	R17,R3
    014C9 0924      SBC	R18,R4
    014CA 0935      SBC	R19,R5
    014CB A1ED      LDD	R30,Y+37
    014CC A1FE      LDD	R31,Y+38
    014CD 9632      ADIW	R30,2
    014CE 8020      LD	R2,Z
    014CF 2433      CLR	R3
    014D0 2444      CLR	R4
    014D1 2455      CLR	R5
    014D2 925A      ST	-Y,R5
    014D3 924A      ST	-Y,R4
    014D4 923A      ST	-Y,R3
    014D5 922A      ST	-Y,R2
    014D6 940E 4A0D CALL	div32u
    014D8 8709      STD	Y+9,R16
    014D9 871A      STD	Y+10,R17
    014DA 872B      STD	Y+11,R18
    014DB 873C      STD	Y+12,R19
(2110) 	if (!nclst) return FR_NO_FILESYSTEM;				/* (Invalid volume size) */
    014DC 8429      LDD	R2,Y+9
    014DD 843A      LDD	R3,Y+10
    014DE 844B      LDD	R4,Y+11
    014DF 845C      LDD	R5,Y+12
    014E0 9488      BCLR	0
    014E1 2022      TST	R2
    014E2 0432      CPC	R3,R2
    014E3 0442      CPC	R4,R2
    014E4 0452      CPC	R5,R2
    014E5 F411      BNE	0x14E8
    014E6 E00D      LDI	R16,0xD
    014E7 C2A2      RJMP	0x178A
(2111) 	fmt = FS_FAT12;
    014E8 24CC      CLR	R12
    014E9 94C3      INC	R12
(2112) 	if (nclst >= MIN_FAT16) fmt = FS_FAT16;
    014EA EF46      LDI	R20,0xF6
    014EB E05F      LDI	R21,0xF
    014EC E060      LDI	R22,0
    014ED E070      LDI	R23,0
    014EE 8429      LDD	R2,Y+9
    014EF 843A      LDD	R3,Y+10
    014F0 844B      LDD	R4,Y+11
    014F1 845C      LDD	R5,Y+12
    014F2 1624      CP	R2,R20
    014F3 0635      CPC	R3,R21
    014F4 0646      CPC	R4,R22
    014F5 0657      CPC	R5,R23
    014F6 F010      BCS	0x14F9
    014F7 E082      LDI	R24,2
    014F8 2EC8      MOV	R12,R24
(2113) 	if (nclst >= MIN_FAT32) fmt = FS_FAT32;
    014F9 EF46      LDI	R20,0xF6
    014FA EF5F      LDI	R21,0xFF
    014FB E060      LDI	R22,0
    014FC E070      LDI	R23,0
    014FD 8429      LDD	R2,Y+9
    014FE 843A      LDD	R3,Y+10
    014FF 844B      LDD	R4,Y+11
    01500 845C      LDD	R5,Y+12
    01501 1624      CP	R2,R20
    01502 0635      CPC	R3,R21
    01503 0646      CPC	R4,R22
    01504 0657      CPC	R5,R23
    01505 F010      BCS	0x1508
    01506 E083      LDI	R24,3
    01507 2EC8      MOV	R12,R24
(2114) 
(2115) 	/* Boundaries and Limits */
(2116) 	fs->n_fatent = nclst + 2;							/* Number of FAT entries */
    01508 E042      LDI	R20,2
    01509 E050      LDI	R21,0
    0150A E060      LDI	R22,0
    0150B E070      LDI	R23,0
    0150C 8429      LDD	R2,Y+9
    0150D 843A      LDD	R3,Y+10
    0150E 844B      LDD	R4,Y+11
    0150F 845C      LDD	R5,Y+12
    01510 0E24      ADD	R2,R20
    01511 1E35      ADC	R3,R21
    01512 1E46      ADC	R4,R22
    01513 1E57      ADC	R5,R23
    01514 A1ED      LDD	R30,Y+37
    01515 A1FE      LDD	R31,Y+38
    01516 9676      ADIW	R30,0x16
    01517 8220      ST	Z,R2
    01518 8231      STD	Z+1,R3
    01519 8242      STD	Z+2,R4
    0151A 8253      STD	Z+3,R5
(2117) 	fs->database = bsect + sysect;						/* Data start sector */
    0151B 882D      LDD	R2,Y+21
    0151C 883E      LDD	R3,Y+22
    0151D 884F      LDD	R4,Y+23
    0151E 8C58      LDD	R5,Y+24
    0151F 8869      LDD	R6,Y+17
    01520 887A      LDD	R7,Y+18
    01521 888B      LDD	R8,Y+19
    01522 889C      LDD	R9,Y+20
    01523 0C62      ADD	R6,R2
    01524 1C73      ADC	R7,R3
    01525 1C84      ADC	R8,R4
    01526 1C95      ADC	R9,R5
    01527 A1ED      LDD	R30,Y+37
    01528 A1FE      LDD	R31,Y+38
    01529 96B6      ADIW	R30,0x26
    0152A 8260      ST	Z,R6
    0152B 8271      STD	Z+1,R7
    0152C 8282      STD	Z+2,R8
    0152D 8293      STD	Z+3,R9
(2118) 	fs->fatbase = bsect + nrsv; 						/* FAT start sector */
    0152E 0117      MOVW	R2,R14
    0152F 2444      CLR	R4
    01530 2455      CLR	R5
    01531 8869      LDD	R6,Y+17
    01532 887A      LDD	R7,Y+18
    01533 888B      LDD	R8,Y+19
    01534 889C      LDD	R9,Y+20
    01535 0C62      ADD	R6,R2
    01536 1C73      ADC	R7,R3
    01537 1C84      ADC	R8,R4
    01538 1C95      ADC	R9,R5
    01539 A1ED      LDD	R30,Y+37
    0153A A1FE      LDD	R31,Y+38
    0153B 8E66      STD	Z+30,R6
    0153C 8E77      STD	Z+31,R7
    0153D A280      STD	Z+32,R8
    0153E A291      STD	Z+33,R9
(2119) 	if (fmt == FS_FAT32) {
    0153F 2D8C      MOV	R24,R12
    01540 3083      CPI	R24,3
    01541 F009      BEQ	0x1543
    01542 C055      RJMP	0x1598
(2120) 		if (fs->n_rootdir) return FR_NO_FILESYSTEM;		/* (BPB_RootEntCnt must be 0) */
    01543 8420      LDD	R2,Z+8
    01544 8431      LDD	R3,Z+9
    01545 2022      TST	R2
    01546 F411      BNE	0x1549
    01547 2033      TST	R3
    01548 F011      BEQ	0x154B
    01549 E00D      LDI	R16,0xD
    0154A C23F      RJMP	0x178A
(2121) 		fs->dirbase = LD_DWORD(fs->win+BPB_RootClus);	/* Root directory start cluster */
    0154B E188      LDI	R24,0x18
    0154C E090      LDI	R25,0
    0154D A1ED      LDD	R30,Y+37
    0154E A1FE      LDD	R31,Y+38
    0154F 5AE3      SUBI	R30,0xA3
    01550 4FFF      SBCI	R31,0xFF
    01551 8100      LD	R16,Z
    01552 2711      CLR	R17
    01553 2722      CLR	R18
    01554 2733      CLR	R19
    01555 938A      ST	-Y,R24
    01556 940E 4B92 CALL	lsl32
    01558 0118      MOVW	R2,R16
    01559 0129      MOVW	R4,R18
    0155A A1ED      LDD	R30,Y+37
    0155B A1FE      LDD	R31,Y+38
    0155C 5AE4      SUBI	R30,0xA4
    0155D 4FFF      SBCI	R31,0xFF
    0155E 8060      LD	R6,Z
    0155F 55EC      SUBI	R30,0x5C
    01560 40F0      SBCI	R31,0
    01561 2477      CLR	R7
    01562 2488      CLR	R8
    01563 2499      CLR	R9
    01564 0143      MOVW	R8,R6
    01565 2466      CLR	R6
    01566 2477      CLR	R7
    01567 2826      OR	R2,R6
    01568 2837      OR	R3,R7
    01569 2848      OR	R4,R8
    0156A 2859      OR	R5,R9
    0156B 5AE5      SUBI	R30,0xA5
    0156C 4FFF      SBCI	R31,0xFF
    0156D 8060      LD	R6,Z
    0156E 55EB      SUBI	R30,0x5B
    0156F 40F0      SBCI	R31,0
    01570 2477      CLR	R7
    01571 2C76      MOV	R7,R6
    01572 2466      CLR	R6
    01573 2488      CLR	R8
    01574 2499      CLR	R9
    01575 2826      OR	R2,R6
    01576 2837      OR	R3,R7
    01577 2848      OR	R4,R8
    01578 2859      OR	R5,R9
    01579 5AE6      SUBI	R30,0xA6
    0157A 4FFF      SBCI	R31,0xFF
    0157B 8060      LD	R6,Z
    0157C 55EA      SUBI	R30,0x5A
    0157D 40F0      SBCI	R31,0
    0157E 2477      CLR	R7
    0157F 2488      CLR	R8
    01580 2499      CLR	R9
    01581 2826      OR	R2,R6
    01582 2837      OR	R3,R7
    01583 2848      OR	R4,R8
    01584 2859      OR	R5,R9
    01585 A222      STD	Z+34,R2
    01586 A233      STD	Z+35,R3
    01587 A244      STD	Z+36,R4
    01588 A255      STD	Z+37,R5
(2122) 		szbfat = fs->n_fatent * 4;						/* (Required FAT size) */
    01589 E082      LDI	R24,2
    0158A E090      LDI	R25,0
    0158B 9676      ADIW	R30,0x16
    0158C 8100      LD	R16,Z
    0158D 8111      LDD	R17,Z+1
    0158E 8122      LDD	R18,Z+2
    0158F 8133      LDD	R19,Z+3
    01590 938A      ST	-Y,R24
    01591 940E 4B92 CALL	lsl32
    01593 8F09      STD	Y+25,R16
    01594 8F1A      STD	Y+26,R17
    01595 8F2B      STD	Y+27,R18
    01596 8F3C      STD	Y+28,R19
(2123) 	} else {
    01597 C06A      RJMP	0x1602
(2124) 		if (!fs->n_rootdir)	return FR_NO_FILESYSTEM;	/* (BPB_RootEntCnt must not be 0) */
    01598 A1ED      LDD	R30,Y+37
    01599 A1FE      LDD	R31,Y+38
    0159A 8420      LDD	R2,Z+8
    0159B 8431      LDD	R3,Z+9
    0159C 2022      TST	R2
    0159D F421      BNE	0x15A2
    0159E 2033      TST	R3
    0159F F411      BNE	0x15A2
    015A0 E00D      LDI	R16,0xD
    015A1 C1E8      RJMP	0x178A
(2125) 		fs->dirbase = fs->fatbase + fasize;				/* Root directory start sector */
    015A2 802D      LDD	R2,Y+5
    015A3 803E      LDD	R3,Y+6
    015A4 804F      LDD	R4,Y+7
    015A5 8458      LDD	R5,Y+8
    015A6 A1ED      LDD	R30,Y+37
    015A7 A1FE      LDD	R31,Y+38
    015A8 8C66      LDD	R6,Z+30
    015A9 8C77      LDD	R7,Z+31
    015AA A080      LDD	R8,Z+32
    015AB A091      LDD	R9,Z+33
    015AC 0C62      ADD	R6,R2
    015AD 1C73      ADC	R7,R3
    015AE 1C84      ADC	R8,R4
    015AF 1C95      ADC	R9,R5
    015B0 A262      STD	Z+34,R6
    015B1 A273      STD	Z+35,R7
    015B2 A284      STD	Z+36,R8
    015B3 A295      STD	Z+37,R9
(2126) 		szbfat = (fmt == FS_FAT16) ?					/* (Required FAT size) */
    015B4 2D8C      MOV	R24,R12
    015B5 3082      CPI	R24,2
    015B6 F471      BNE	0x15C5
    015B7 9676      ADIW	R30,0x16
    015B8 8020      LD	R2,Z
    015B9 8031      LDD	R3,Z+1
    015BA 8042      LDD	R4,Z+2
    015BB 8053      LDD	R5,Z+3
    015BC 0C22      LSL	R2
    015BD 1C33      ROL	R3
    015BE 1C44      ROL	R4
    015BF 1C55      ROL	R5
    015C0 8E2D      STD	Y+29,R2
    015C1 8E3E      STD	Y+30,R3
    015C2 8E4F      STD	Y+31,R4
    015C3 A258      STD	Y+32,R5
    015C4 C035      RJMP	0x15FA
    015C5 A1ED      LDD	R30,Y+37
    015C6 A1FE      LDD	R31,Y+38
    015C7 9676      ADIW	R30,0x16
    015C8 8020      LD	R2,Z
    015C9 8031      LDD	R3,Z+1
    015CA 8042      LDD	R4,Z+2
    015CB 8053      LDD	R5,Z+3
    015CC A229      STD	Y+33,R2
    015CD A23A      STD	Y+34,R3
    015CE A24B      STD	Y+35,R4
    015CF A25C      STD	Y+36,R5
    015D0 E041      LDI	R20,1
    015D1 E050      LDI	R21,0
    015D2 E060      LDI	R22,0
    015D3 E070      LDI	R23,0
    015D4 A029      LDD	R2,Y+33
    015D5 A03A      LDD	R3,Y+34
    015D6 A04B      LDD	R4,Y+35
    015D7 A05C      LDD	R5,Y+36
    015D8 2224      AND	R2,R20
    015D9 2235      AND	R3,R21
    015DA 2246      AND	R4,R22
    015DB 2257      AND	R5,R23
    015DC A069      LDD	R6,Y+33
    015DD A07A      LDD	R7,Y+34
    015DE A08B      LDD	R8,Y+35
    015DF A09C      LDD	R9,Y+36
    015E0 E043      LDI	R20,3
    015E1 E050      LDI	R21,0
    015E2 E060      LDI	R22,0
    015E3 E070      LDI	R23,0
    015E4 929A      ST	-Y,R9
    015E5 928A      ST	-Y,R8
    015E6 927A      ST	-Y,R7
    015E7 926A      ST	-Y,R6
    015E8 018A      MOVW	R16,R20
    015E9 019B      MOVW	R18,R22
    015EA 940E 4AB3 CALL	empy32s|empy32u
    015EC 0138      MOVW	R6,R16
    015ED 0149      MOVW	R8,R18
    015EE 9496      LSR	R9
    015EF 9487      ROR	R8
    015F0 9477      ROR	R7
    015F1 9467      ROR	R6
    015F2 0C62      ADD	R6,R2
    015F3 1C73      ADC	R7,R3
    015F4 1C84      ADC	R8,R4
    015F5 1C95      ADC	R9,R5
    015F6 8E6D      STD	Y+29,R6
    015F7 8E7E      STD	Y+30,R7
    015F8 8E8F      STD	Y+31,R8
    015F9 A298      STD	Y+32,R9
    015FA 8C2D      LDD	R2,Y+29
    015FB 8C3E      LDD	R3,Y+30
    015FC 8C4F      LDD	R4,Y+31
    015FD A058      LDD	R5,Y+32
    015FE 8E29      STD	Y+25,R2
    015FF 8E3A      STD	Y+26,R3
    01600 8E4B      STD	Y+27,R4
    01601 8E5C      STD	Y+28,R5
(2127) 			fs->n_fatent * 2 : fs->n_fatent * 3 / 2 + (fs->n_fatent & 1);
(2128) 	}
(2129) 	if (fs->fsize < (szbfat + (SS(fs) - 1)) / SS(fs))	/* (BPB_FATSz must not be less than required) */
    01602 EF4F      LDI	R20,0xFF
    01603 E051      LDI	R21,1
    01604 E060      LDI	R22,0
    01605 E070      LDI	R23,0
    01606 8D09      LDD	R16,Y+25
    01607 8D1A      LDD	R17,Y+26
    01608 8D2B      LDD	R18,Y+27
    01609 8D3C      LDD	R19,Y+28
    0160A 0F04      ADD	R16,R20
    0160B 1F15      ADC	R17,R21
    0160C 1F26      ADC	R18,R22
    0160D 1F37      ADC	R19,R23
    0160E E089      LDI	R24,0x9
    0160F E090      LDI	R25,0
    01610 938A      ST	-Y,R24
    01611 940E 4BAB CALL	lsr32
    01613 A1ED      LDD	R30,Y+37
    01614 A1FE      LDD	R31,Y+38
    01615 8C22      LDD	R2,Z+26
    01616 8C33      LDD	R3,Z+27
    01617 8C44      LDD	R4,Z+28
    01618 8C55      LDD	R5,Z+29
    01619 1620      CP	R2,R16
    0161A 0631      CPC	R3,R17
    0161B 0642      CPC	R4,R18
    0161C 0653      CPC	R5,R19
    0161D F410      BCC	0x1620
(2130) 		return FR_NO_FILESYSTEM;
    0161E E00D      LDI	R16,0xD
    0161F C16A      RJMP	0x178A
(2131) 
(2132) #if !_FS_READONLY
(2133) 	/* Initialize cluster allocation information */
(2134) 	fs->free_clust = 0xFFFFFFFF;
    01620 A1ED      LDD	R30,Y+37
    01621 A1FE      LDD	R31,Y+38
    01622 963E      ADIW	R30,0xE
    01623 EF8F      LDI	R24,0xFF
    01624 8380      ST	Z,R24
    01625 8381      STD	Z+1,R24
    01626 8382      STD	Z+2,R24
    01627 8383      STD	Z+3,R24
(2135) 	fs->last_clust = 0;
    01628 A1ED      LDD	R30,Y+37
    01629 A1FE      LDD	R31,Y+38
    0162A 963A      ADIW	R30,0xA
    0162B E080      LDI	R24,0
    0162C 8380      ST	Z,R24
    0162D 8381      STD	Z+1,R24
    0162E 8382      STD	Z+2,R24
    0162F 8383      STD	Z+3,R24
(2136) 
(2137) 	/* Get fsinfo if available */
(2138) 	if (fmt == FS_FAT32) {
    01630 2D8C      MOV	R24,R12
    01631 3083      CPI	R24,3
    01632 F009      BEQ	0x1634
    01633 C13C      RJMP	0x1770
(2139) 	 	fs->fsi_flag = 0;
    01634 2422      CLR	R2
    01635 A1ED      LDD	R30,Y+37
    01636 A1FE      LDD	R31,Y+38
    01637 8225      STD	Z+5,R2
(2140) 		fs->fsi_sector = bsect + LD_WORD(fs->win+BPB_FSInfo);
    01638 5AE2      SUBI	R30,0xA2
    01639 4FFF      SBCI	R31,0xFF
    0163A 8020      LD	R2,Z
    0163B 55EE      SUBI	R30,0x5E
    0163C 40F0      SBCI	R31,0
    0163D 2433      CLR	R3
    0163E 5AE1      SUBI	R30,0xA1
    0163F 4FFF      SBCI	R31,0xFF
    01640 8040      LD	R4,Z
    01641 2455      CLR	R5
    01642 2C54      MOV	R5,R4
    01643 2444      CLR	R4
    01644 2842      OR	R4,R2
    01645 2853      OR	R5,R3
    01646 0112      MOVW	R2,R4
    01647 2444      CLR	R4
    01648 2455      CLR	R5
    01649 8869      LDD	R6,Y+17
    0164A 887A      LDD	R7,Y+18
    0164B 888B      LDD	R8,Y+19
    0164C 889C      LDD	R9,Y+20
    0164D 0C62      ADD	R6,R2
    0164E 1C73      ADC	R7,R3
    0164F 1C84      ADC	R8,R4
    01650 1C95      ADC	R9,R5
    01651 A1ED      LDD	R30,Y+37
    01652 A1FE      LDD	R31,Y+38
    01653 8A62      STD	Z+18,R6
    01654 8A73      STD	Z+19,R7
    01655 8A84      STD	Z+20,R8
    01656 8A95      STD	Z+21,R9
(2141) 		if (disk_read(fs->drv, fs->win, fs->fsi_sector, 1) == RES_OK &&
    01657 E081      LDI	R24,1
    01658 838C      STD	Y+4,R24
    01659 8822      LDD	R2,Z+18
    0165A 8833      LDD	R3,Z+19
    0165B 8844      LDD	R4,Z+20
    0165C 8855      LDD	R5,Z+21
    0165D 8228      ST	Y,R2
    0165E 8239      STD	Y+1,R3
    0165F 824A      STD	Y+2,R4
    01660 825B      STD	Y+3,R5
    01661 019F      MOVW	R18,R30
    01662 5D22      SUBI	R18,0xD2
    01663 4F3F      SBCI	R19,0xFF
    01664 8101      LDD	R16,Z+1
    01665 940E 03DC CALL	_disk_read
    01667 2EE0      MOV	R14,R16
    01668 2300      TST	R16
    01669 F009      BEQ	0x166B
    0166A C105      RJMP	0x1770
    0166B A1ED      LDD	R30,Y+37
    0166C A1FE      LDD	R31,Y+38
    0166D 5DE4      SUBI	R30,0xD4
    0166E 4FFD      SBCI	R31,0xFD
    0166F 8020      LD	R2,Z
    01670 52EC      SUBI	R30,0x2C
    01671 40F2      SBCI	R31,2
    01672 2433      CLR	R3
    01673 5DE3      SUBI	R30,0xD3
    01674 4FFD      SBCI	R31,0xFD
    01675 8180      LD	R24,Z
    01676 52ED      SUBI	R30,0x2D
    01677 40F2      SBCI	R31,2
    01678 2799      CLR	R25
    01679 2F98      MOV	R25,R24
    0167A 2788      CLR	R24
    0167B 2982      OR	R24,R2
    0167C 2993      OR	R25,R3
    0167D 3585      CPI	R24,0x55
    0167E EAAA      LDI	R26,0xAA
    0167F 079A      CPC	R25,R26
    01680 F009      BEQ	0x1682
    01681 C0EE      RJMP	0x1770
    01682 E188      LDI	R24,0x18
    01683 E090      LDI	R25,0
    01684 A901      LDD	R16,Z+49
    01685 2711      CLR	R17
    01686 2722      CLR	R18
    01687 2733      CLR	R19
    01688 938A      ST	-Y,R24
    01689 940E 4B92 CALL	lsl32
    0168B 0118      MOVW	R2,R16
    0168C 0129      MOVW	R4,R18
    0168D A1ED      LDD	R30,Y+37
    0168E A1FE      LDD	R31,Y+38
    0168F A860      LDD	R6,Z+48
    01690 2477      CLR	R7
    01691 2488      CLR	R8
    01692 2499      CLR	R9
    01693 0143      MOVW	R8,R6
    01694 2466      CLR	R6
    01695 2477      CLR	R7
    01696 2826      OR	R2,R6
    01697 2837      OR	R3,R7
    01698 2848      OR	R4,R8
    01699 2859      OR	R5,R9
    0169A A467      LDD	R6,Z+47
    0169B 2477      CLR	R7
    0169C 2C76      MOV	R7,R6
    0169D 2466      CLR	R6
    0169E 2488      CLR	R8
    0169F 2499      CLR	R9
    016A0 2826      OR	R2,R6
    016A1 2837      OR	R3,R7
    016A2 2848      OR	R4,R8
    016A3 2859      OR	R5,R9
    016A4 A466      LDD	R6,Z+46
    016A5 2477      CLR	R7
    016A6 2488      CLR	R8
    016A7 2499      CLR	R9
    016A8 2826      OR	R2,R6
    016A9 2837      OR	R3,R7
    016AA 2848      OR	R4,R8
    016AB 2859      OR	R5,R9
    016AC E542      LDI	R20,0x52
    016AD E552      LDI	R21,0x52
    016AE E661      LDI	R22,0x61
    016AF E471      LDI	R23,0x41
    016B0 1624      CP	R2,R20
    016B1 0635      CPC	R3,R21
    016B2 0646      CPC	R4,R22
    016B3 0657      CPC	R5,R23
    016B4 F009      BEQ	0x16B6
    016B5 C0BA      RJMP	0x1770
    016B6 E188      LDI	R24,0x18
    016B7 E090      LDI	R25,0
    016B8 5EEB      SUBI	R30,0xEB
    016B9 4FFD      SBCI	R31,0xFD
    016BA 8100      LD	R16,Z
    016BB 2711      CLR	R17
    016BC 2722      CLR	R18
    016BD 2733      CLR	R19
    016BE 938A      ST	-Y,R24
    016BF 940E 4B92 CALL	lsl32
    016C1 0118      MOVW	R2,R16
    016C2 0129      MOVW	R4,R18
    016C3 A1ED      LDD	R30,Y+37
    016C4 A1FE      LDD	R31,Y+38
    016C5 5EEC      SUBI	R30,0xEC
    016C6 4FFD      SBCI	R31,0xFD
    016C7 8060      LD	R6,Z
    016C8 51E4      SUBI	R30,0x14
    016C9 40F2      SBCI	R31,2
    016CA 2477      CLR	R7
    016CB 2488      CLR	R8
    016CC 2499      CLR	R9
    016CD 0143      MOVW	R8,R6
    016CE 2466      CLR	R6
    016CF 2477      CLR	R7
    016D0 2826      OR	R2,R6
    016D1 2837      OR	R3,R7
    016D2 2848      OR	R4,R8
    016D3 2859      OR	R5,R9
    016D4 5EED      SUBI	R30,0xED
    016D5 4FFD      SBCI	R31,0xFD
    016D6 8060      LD	R6,Z
    016D7 51E3      SUBI	R30,0x13
    016D8 40F2      SBCI	R31,2
    016D9 2477      CLR	R7
    016DA 2C76      MOV	R7,R6
    016DB 2466      CLR	R6
    016DC 2488      CLR	R8
    016DD 2499      CLR	R9
    016DE 2826      OR	R2,R6
    016DF 2837      OR	R3,R7
    016E0 2848      OR	R4,R8
    016E1 2859      OR	R5,R9
    016E2 5EEE      SUBI	R30,0xEE
    016E3 4FFD      SBCI	R31,0xFD
    016E4 8060      LD	R6,Z
    016E5 51E2      SUBI	R30,0x12
    016E6 40F2      SBCI	R31,2
    016E7 2477      CLR	R7
    016E8 2488      CLR	R8
    016E9 2499      CLR	R9
    016EA 2826      OR	R2,R6
    016EB 2837      OR	R3,R7
    016EC 2848      OR	R4,R8
    016ED 2859      OR	R5,R9
    016EE E742      LDI	R20,0x72
    016EF E752      LDI	R21,0x72
    016F0 E461      LDI	R22,0x41
    016F1 E671      LDI	R23,0x61
    016F2 1624      CP	R2,R20
    016F3 0635      CPC	R3,R21
    016F4 0646      CPC	R4,R22
    016F5 0657      CPC	R5,R23
    016F6 F009      BEQ	0x16F8
    016F7 C078      RJMP	0x1770
(2142) 			LD_WORD(fs->win+BS_55AA) == 0xAA55 &&
(2143) 			LD_DWORD(fs->win+FSI_LeadSig) == 0x41615252 &&
(2144) 			LD_DWORD(fs->win+FSI_StrucSig) == 0x61417272) {
(2145) 				fs->last_clust = LD_DWORD(fs->win+FSI_Nxt_Free);
    016F8 E188      LDI	R24,0x18
    016F9 E090      LDI	R25,0
    016FA 5EE3      SUBI	R30,0xE3
    016FB 4FFD      SBCI	R31,0xFD
    016FC 8100      LD	R16,Z
    016FD 2711      CLR	R17
    016FE 2722      CLR	R18
    016FF 2733      CLR	R19
    01700 938A      ST	-Y,R24
    01701 940E 4B92 CALL	lsl32
    01703 0118      MOVW	R2,R16
    01704 0129      MOVW	R4,R18
    01705 A1ED      LDD	R30,Y+37
    01706 A1FE      LDD	R31,Y+38
    01707 5EE4      SUBI	R30,0xE4
    01708 4FFD      SBCI	R31,0xFD
    01709 8060      LD	R6,Z
    0170A 51EC      SUBI	R30,0x1C
    0170B 40F2      SBCI	R31,2
    0170C 2477      CLR	R7
    0170D 2488      CLR	R8
    0170E 2499      CLR	R9
    0170F 0143      MOVW	R8,R6
    01710 2466      CLR	R6
    01711 2477      CLR	R7
    01712 2826      OR	R2,R6
    01713 2837      OR	R3,R7
    01714 2848      OR	R4,R8
    01715 2859      OR	R5,R9
    01716 5EE5      SUBI	R30,0xE5
    01717 4FFD      SBCI	R31,0xFD
    01718 8060      LD	R6,Z
    01719 51EB      SUBI	R30,0x1B
    0171A 40F2      SBCI	R31,2
    0171B 2477      CLR	R7
    0171C 2C76      MOV	R7,R6
    0171D 2466      CLR	R6
    0171E 2488      CLR	R8
    0171F 2499      CLR	R9
    01720 2826      OR	R2,R6
    01721 2837      OR	R3,R7
    01722 2848      OR	R4,R8
    01723 2859      OR	R5,R9
    01724 5EE6      SUBI	R30,0xE6
    01725 4FFD      SBCI	R31,0xFD
    01726 8060      LD	R6,Z
    01727 51EA      SUBI	R30,0x1A
    01728 40F2      SBCI	R31,2
    01729 2477      CLR	R7
    0172A 2488      CLR	R8
    0172B 2499      CLR	R9
    0172C 2826      OR	R2,R6
    0172D 2837      OR	R3,R7
    0172E 2848      OR	R4,R8
    0172F 2859      OR	R5,R9
    01730 8622      STD	Z+10,R2
    01731 8633      STD	Z+11,R3
    01732 8644      STD	Z+12,R4
    01733 8655      STD	Z+13,R5
(2146) 				fs->free_clust = LD_DWORD(fs->win+FSI_Free_Count);
    01734 E188      LDI	R24,0x18
    01735 E090      LDI	R25,0
    01736 5EE7      SUBI	R30,0xE7
    01737 4FFD      SBCI	R31,0xFD
    01738 8100      LD	R16,Z
    01739 2711      CLR	R17
    0173A 2722      CLR	R18
    0173B 2733      CLR	R19
    0173C 938A      ST	-Y,R24
    0173D 940E 4B92 CALL	lsl32
    0173F 0118      MOVW	R2,R16
    01740 0129      MOVW	R4,R18
    01741 A1ED      LDD	R30,Y+37
    01742 A1FE      LDD	R31,Y+38
    01743 5EE8      SUBI	R30,0xE8
    01744 4FFD      SBCI	R31,0xFD
    01745 8060      LD	R6,Z
    01746 51E8      SUBI	R30,0x18
    01747 40F2      SBCI	R31,2
    01748 2477      CLR	R7
    01749 2488      CLR	R8
    0174A 2499      CLR	R9
    0174B 0143      MOVW	R8,R6
    0174C 2466      CLR	R6
    0174D 2477      CLR	R7
    0174E 2826      OR	R2,R6
    0174F 2837      OR	R3,R7
    01750 2848      OR	R4,R8
    01751 2859      OR	R5,R9
    01752 5EE9      SUBI	R30,0xE9
    01753 4FFD      SBCI	R31,0xFD
    01754 8060      LD	R6,Z
    01755 51E7      SUBI	R30,0x17
    01756 40F2      SBCI	R31,2
    01757 2477      CLR	R7
    01758 2C76      MOV	R7,R6
    01759 2466      CLR	R6
    0175A 2488      CLR	R8
    0175B 2499      CLR	R9
    0175C 2826      OR	R2,R6
    0175D 2837      OR	R3,R7
    0175E 2848      OR	R4,R8
    0175F 2859      OR	R5,R9
    01760 5EEA      SUBI	R30,0xEA
    01761 4FFD      SBCI	R31,0xFD
    01762 8060      LD	R6,Z
    01763 51E6      SUBI	R30,0x16
    01764 40F2      SBCI	R31,2
    01765 2477      CLR	R7
    01766 2488      CLR	R8
    01767 2499      CLR	R9
    01768 2826      OR	R2,R6
    01769 2837      OR	R3,R7
    0176A 2848      OR	R4,R8
    0176B 2859      OR	R5,R9
    0176C 8626      STD	Z+14,R2
    0176D 8637      STD	Z+15,R3
    0176E 8A40      STD	Z+16,R4
    0176F 8A51      STD	Z+17,R5
(2147) 		}
(2148) 	}
(2149) #endif
(2150) 	fs->fs_type = fmt;		/* FAT sub-type */
    01770 A1ED      LDD	R30,Y+37
    01771 A1FE      LDD	R31,Y+38
    01772 82C0      ST	Z,R12
(2151) 	fs->id = ++Fsid;		/* File system mount ID */
    01773 9180 05E7 LDS	R24,ff.c:Fsid
    01775 9190 05E8 LDS	R25,ff.c:Fsid+1
    01777 9601      ADIW	R24,1
    01778 016C      MOVW	R12,R24
    01779 92D0 05E8 STS	ff.c:Fsid+1,R13
    0177B 92C0 05E7 STS	ff.c:Fsid,R12
    0177D 82D7      STD	Z+7,R13
    0177E 82C6      STD	Z+6,R12
(2152) 	fs->winsect = 0;		/* Invalidate sector cache */
    0177F 96BA      ADIW	R30,0x2A
    01780 E080      LDI	R24,0
    01781 8380      ST	Z,R24
    01782 8381      STD	Z+1,R24
    01783 8382      STD	Z+2,R24
    01784 8383      STD	Z+3,R24
(2153) 	fs->wflag = 0;
    01785 2422      CLR	R2
    01786 A1ED      LDD	R30,Y+37
    01787 A1FE      LDD	R31,Y+38
    01788 8224      STD	Z+4,R2
(2154) #if _FS_RPATH
(2155) 	fs->cdir = 0;			/* Current directory (root dir) */
(2156) #endif
(2157) #if _FS_SHARE				/* Clear file lock semaphores */
(2158) 	clear_lock(fs);
(2159) #endif
(2160) 
(2161) 	return FR_OK;
    01789 2700      CLR	R16
    0178A 96A7      ADIW	R28,0x27
    0178B 940E 4AFC CALL	pop_xgsetF0FC
    0178D 9622      ADIW	R28,2
    0178E 9508      RET
ff.c:validate:
  id                   --> R10
  fs                   --> R20
    0178F 940E 4B12 CALL	push_xgset300C
    01791 0159      MOVW	R10,R18
    01792 01A8      MOVW	R20,R16
(2162) }
(2163) 
(2164) 
(2165) 
(2166) 
(2167) /*-----------------------------------------------------------------------*/
(2168) /* Check if the file/dir object is valid or not                          */
(2169) /*-----------------------------------------------------------------------*/
(2170) 
(2171) static
(2172) FRESULT validate (	/* FR_OK(0): The object is valid, !=0: Invalid */
(2173) 	FATFS *fs,		/* Pointer to the file system object */
(2174) 	WORD id			/* Member id of the target object to be checked */
(2175) )
(2176) {
(2177) 	if (!fs || !fs->fs_type || fs->id != id)
    01793 3040      CPI	R20,0
    01794 0745      CPC	R20,R21
    01795 F049      BEQ	0x179F
    01796 01FA      MOVW	R30,R20
    01797 8020      LD	R2,Z
    01798 2022      TST	R2
    01799 F029      BEQ	0x179F
    0179A 8026      LDD	R2,Z+6
    0179B 8037      LDD	R3,Z+7
    0179C 142A      CP	R2,R10
    0179D 043B      CPC	R3,R11
    0179E F011      BEQ	0x17A1
(2178) 		return FR_INVALID_OBJECT;
    0179F E009      LDI	R16,0x9
    017A0 C009      RJMP	0x17AA
(2179) 
(2180) 	ENTER_FF(fs);		/* Lock file system */
(2181) 
(2182) 	if (disk_status(fs->drv) & STA_NOINIT)
    017A1 01FA      MOVW	R30,R20
    017A2 8101      LDD	R16,Z+1
    017A3 940E 03D6 CALL	_disk_status
    017A5 FF00      SBRS	R16,0
    017A6 C002      RJMP	0x17A9
(2183) 		return FR_NOT_READY;
    017A7 E003      LDI	R16,3
    017A8 C001      RJMP	0x17AA
(2184) 
(2185) 	return FR_OK;
    017A9 2700      CLR	R16
    017AA 940C 4B17 JMP	pop_xgset300C
_f_mount:
  rfs                  --> R10
  fs                   --> R18
  vol                  --> R16
    017AC 92AA      ST	-Y,R10
    017AD 92BA      ST	-Y,R11
(2186) }
(2187) 
(2188) 
(2189) 
(2190) 
(2191) /*--------------------------------------------------------------------------
(2192) 
(2193)    Public Functions
(2194) 
(2195) --------------------------------------------------------------------------*/
(2196) 
(2197) 
(2198) 
(2199) /*-----------------------------------------------------------------------*/
(2200) /* Mount/Unmount a Logical Drive                                         */
(2201) /*-----------------------------------------------------------------------*/
(2202) 
(2203) FRESULT f_mount (
(2204) 	BYTE vol,		/* Logical drive number to be mounted/unmounted */
(2205) 	FATFS *fs		/* Pointer to new file system object (NULL for unmount)*/
(2206) )
(2207) {
(2208) 	FATFS *rfs;
(2209) 
(2210) 
(2211) 	if (vol >= _VOLUMES)		/* Check if the drive number is valid */
    017AE 3001      CPI	R16,1
    017AF F010      BCS	0x17B2
(2212) 		return FR_INVALID_DRIVE;
    017B0 E00B      LDI	R16,0xB
    017B1 C022      RJMP	0x17D4
(2213) 	rfs = FatFs[vol];			/* Get current fs object */
    017B2 EE89      LDI	R24,0xE9
    017B3 E095      LDI	R25,5
    017B4 2FE0      MOV	R30,R16
    017B5 27FF      CLR	R31
    017B6 0FEE      LSL	R30
    017B7 1FFF      ROL	R31
    017B8 0FE8      ADD	R30,R24
    017B9 1FF9      ADC	R31,R25
    017BA 80A0      LD	R10,Z
    017BB 80B1      LDD	R11,Z+1
(2214) 
(2215) 	if (rfs) {
    017BC 20AA      TST	R10
    017BD F411      BNE	0x17C0
    017BE 20BB      TST	R11
    017BF F019      BEQ	0x17C3
(2216) #if _FS_SHARE
(2217) 		clear_lock(rfs);
(2218) #endif
(2219) #if _FS_REENTRANT				/* Discard sync object of the current volume */
(2220) 		if (!ff_del_syncobj(rfs->sobj)) return FR_INT_ERR;
(2221) #endif
(2222) 		rfs->fs_type = 0;		/* Clear old fs object */
    017C0 2422      CLR	R2
    017C1 01F5      MOVW	R30,R10
    017C2 8220      ST	Z,R2
(2223) 	}
(2224) 
(2225) 	if (fs) {
    017C3 3020      CPI	R18,0
    017C4 0723      CPC	R18,R19
    017C5 F019      BEQ	0x17C9
(2226) 		fs->fs_type = 0;		/* Clear new fs object */
    017C6 2422      CLR	R2
    017C7 01F9      MOVW	R30,R18
    017C8 8220      ST	Z,R2
(2227) #if _FS_REENTRANT				/* Create sync object for the new volume */
(2228) 		if (!ff_cre_syncobj(vol, &fs->sobj)) return FR_INT_ERR;
(2229) #endif
(2230) 	}
(2231) 	FatFs[vol] = fs;			/* Register new fs object */
    017C9 EE89      LDI	R24,0xE9
    017CA E095      LDI	R25,5
    017CB 2FE0      MOV	R30,R16
    017CC 27FF      CLR	R31
    017CD 0FEE      LSL	R30
    017CE 1FFF      ROL	R31
    017CF 0FE8      ADD	R30,R24
    017D0 1FF9      ADC	R31,R25
    017D1 8331      STD	Z+1,R19
    017D2 8320      ST	Z,R18
(2232) 
(2233) 	return FR_OK;
    017D3 2700      CLR	R16
    017D4 90B9      LD	R11,Y+
    017D5 90A9      LD	R10,Y+
    017D6 9508      RET
_f_open:
  cl                   --> Y,+40
  dw                   --> Y,+36
  sfn                  --> Y,+24
  dj                   --> Y,+2
  res                  --> R10
  dir                  --> R14
  mode                 --> Y,+58
  path                 --> Y,+56
  fp                   --> Y,+54
    017D7 940E 49C2 CALL	push_arg4
    017D9 940E 4B07 CALL	push_xgsetF0FC
    017DB 97AC      SBIW	R28,0x2C
(2234) }
(2235) 
(2236) 
(2237) 
(2238) 
(2239) /*-----------------------------------------------------------------------*/
(2240) /* Open or Create a File                                                 */
(2241) /*-----------------------------------------------------------------------*/
(2242) 
(2243) FRESULT f_open (
(2244) 	FIL *fp,			/* Pointer to the blank file object */
(2245) 	const TCHAR *path,	/* Pointer to the file name */
(2246) 	BYTE mode			/* Access mode and file open mode flags */
(2247) )
(2248) {
(2249) 	FRESULT res;
(2250) 	DIR dj;
(2251) 	BYTE *dir;
(2252) 	DEF_NAMEBUF;
(2253) 
(2254) 
(2255) 	fp->fs = 0;			/* Clear file object */
    017DC 2422      CLR	R2
    017DD 2433      CLR	R3
    017DE A9EE      LDD	R30,Y+54
    017DF A9FF      LDD	R31,Y+55
    017E0 8231      STD	Z+1,R3
    017E1 8220      ST	Z,R2
(2256) 
(2257) #if !_FS_READONLY
(2258) 	mode &= FA_READ | FA_WRITE | FA_CREATE_ALWAYS | FA_OPEN_ALWAYS | FA_CREATE_NEW;
    017E2 AD8A      LDD	R24,Y+58
    017E3 718F      ANDI	R24,0x1F
    017E4 AF8A      STD	Y+58,R24
(2259) 	res = chk_mounted(&path, &dj.fs, (BYTE)(mode & ~FA_READ));
    017E5 2799      CLR	R25
    017E6 7F8E      ANDI	R24,0xFE
    017E7 8388      ST	Y,R24
    017E8 019E      MOVW	R18,R28
    017E9 5F2E      SUBI	R18,0xFE
    017EA 4F3F      SBCI	R19,0xFF
    017EB 018E      MOVW	R16,R28
    017EC 5C08      SUBI	R16,0xC8
    017ED 4F1F      SBCI	R17,0xFF
    017EE DAA6      RCALL	ff.c:chk_mounted
    017EF 2EA0      MOV	R10,R16
(2260) #else
(2261) 	mode &= FA_READ;
(2262) 	res = chk_mounted(&path, &dj.fs, 0);
(2263) #endif
(2264) 	INIT_BUF(dj);
    017F0 01CE      MOVW	R24,R28
    017F1 9648      ADIW	R24,0x18
    017F2 8B9F      STD	Y+23,R25
    017F3 8B8E      STD	Y+22,R24
(2265) 	if (res == FR_OK)
    017F4 2300      TST	R16
    017F5 F439      BNE	0x17FD
(2266) 		res = follow_path(&dj, path);	/* Follow the file path */
    017F6 AD28      LDD	R18,Y+56
    017F7 AD39      LDD	R19,Y+57
    017F8 018E      MOVW	R16,R28
    017F9 5F0E      SUBI	R16,0xFE
    017FA 4F1F      SBCI	R17,0xFF
    017FB D94D      RCALL	ff.c:follow_path
    017FC 2EA0      MOV	R10,R16
(2267) 	dir = dj.dir;
    017FD 88EC      LDD	R14,Y+20
    017FE 88FD      LDD	R15,Y+21
(2268) 
(2269) #if !_FS_READONLY	/* R/W configuration */
(2270) 	if (res == FR_OK) {
    017FF 20AA      TST	R10
    01800 F431      BNE	0x1807
(2271) 		if (!dir)	/* Current dir itself */
    01801 20EE      TST	R14
    01802 F421      BNE	0x1807
    01803 20FF      TST	R15
    01804 F411      BNE	0x1807
(2272) 			res = FR_INVALID_NAME;
    01805 E086      LDI	R24,6
    01806 2EA8      MOV	R10,R24
(2273) #if _FS_SHARE
(2274) 		else
(2275) 			res = chk_lock(&dj, (mode & ~FA_READ) ? 1 : 0);
(2276) #endif
(2277) 	}
(2278) 	/* Create or Open a file */
(2279) 	if (mode & (FA_CREATE_ALWAYS | FA_OPEN_ALWAYS | FA_CREATE_NEW)) {
    01807 AD8A      LDD	R24,Y+58
    01808 718C      ANDI	R24,0x1C
    01809 F409      BNE	0x180B
    0180A C0C0      RJMP	0x18CB
(2280) 		DWORD dw, cl;
(2281) 
(2282) 		if (res != FR_OK) {					/* No file, create new */
    0180B 20AA      TST	R10
    0180C F081      BEQ	0x181D
(2283) 			if (res == FR_NO_FILE)			/* There is no file to open, create a new entry */
    0180D 2D8A      MOV	R24,R10
    0180E 3084      CPI	R24,4
    0180F F439      BNE	0x1817
(2284) #if _FS_SHARE
(2285) 				res = enq_lock() ? dir_register(&dj) : FR_TOO_MANY_OPEN_FILES;
(2286) #else
(2287) 				res = dir_register(&dj);
    01810 018E      MOVW	R16,R28
    01811 5F0E      SUBI	R16,0xFE
    01812 4F1F      SBCI	R17,0xFF
    01813 940E 0F3B CALL	ff.c:dir_register
    01815 2EC0      MOV	R12,R16
    01816 2CAC      MOV	R10,R12
(2288) #endif
(2289) 			mode |= FA_CREATE_ALWAYS;		/* File is created */
    01817 AD8A      LDD	R24,Y+58
    01818 6088      ORI	R24,0x8
    01819 AF8A      STD	Y+58,R24
(2290) 			dir = dj.dir;					/* New entry */
    0181A 88EC      LDD	R14,Y+20
    0181B 88FD      LDD	R15,Y+21
(2291) 		}
    0181C C00C      RJMP	0x1829
(2292) 		else {								/* Any object is already existing */
(2293) 			if (dir[DIR_Attr] & (AM_RDO | AM_DIR)) {	/* Cannot overwrite it (R/O or DIR) */
    0181D 01F7      MOVW	R30,R14
    0181E 8583      LDD	R24,Z+11
    0181F 7181      ANDI	R24,0x11
    01820 F019      BEQ	0x1824
(2294) 				res = FR_DENIED;
    01821 E087      LDI	R24,7
    01822 2EA8      MOV	R10,R24
(2295) 			} else {
    01823 C005      RJMP	0x1829
(2296) 				if (mode & FA_CREATE_NEW)	/* Cannot create as new file */
    01824 AC0A      LDD	R0,Y+58
    01825 FE02      SBRS	R0,2
    01826 C002      RJMP	0x1829
(2297) 					res = FR_EXIST;
    01827 E088      LDI	R24,0x8
    01828 2EA8      MOV	R10,R24
(2298) 			}
(2299) 		}
(2300) 		if (res == FR_OK && (mode & FA_CREATE_ALWAYS)) {	/* Truncate it if overwrite mode */
    01829 20AA      TST	R10
    0182A F009      BEQ	0x182C
    0182B C0B1      RJMP	0x18DD
    0182C AC0A      LDD	R0,Y+58
    0182D FE03      SBRS	R0,3
    0182E C0AE      RJMP	0x18DD
(2301) 			dw = get_fattime();					/* Created time */
    0182F 940E 0419 CALL	_get_fattime
    01831 A30C      STD	Y+36,R16
    01832 A31D      STD	Y+37,R17
    01833 A32E      STD	Y+38,R18
    01834 A33F      STD	Y+39,R19
(2302) 			ST_DWORD(dir+DIR_CrtTime, dw);
    01835 A02C      LDD	R2,Y+36
    01836 A03D      LDD	R3,Y+37
    01837 A04E      LDD	R4,Y+38
    01838 A05F      LDD	R5,Y+39
    01839 01F7      MOVW	R30,R14
    0183A 8626      STD	Z+14,R2
    0183B 2C23      MOV	R2,R3
    0183C 2433      CLR	R3
    0183D 963F      ADIW	R30,0xF
    0183E 8220      ST	Z,R2
    0183F A02C      LDD	R2,Y+36
    01840 A03D      LDD	R3,Y+37
    01841 A04E      LDD	R4,Y+38
    01842 A05F      LDD	R5,Y+39
    01843 0112      MOVW	R2,R4
    01844 2444      CLR	R4
    01845 2455      CLR	R5
    01846 01F7      MOVW	R30,R14
    01847 9670      ADIW	R30,0x10
    01848 8220      ST	Z,R2
    01849 E188      LDI	R24,0x18
    0184A E090      LDI	R25,0
    0184B A10C      LDD	R16,Y+36
    0184C A11D      LDD	R17,Y+37
    0184D A12E      LDD	R18,Y+38
    0184E A13F      LDD	R19,Y+39
    0184F 938A      ST	-Y,R24
    01850 940E 4BAB CALL	lsr32
    01852 01F7      MOVW	R30,R14
    01853 8B01      STD	Z+17,R16
(2303) 			dir[DIR_Attr] = 0;					/* Reset attribute */
    01854 2422      CLR	R2
    01855 8623      STD	Z+11,R2
(2304) 			ST_DWORD(dir+DIR_FileSize, 0);		/* size = 0 */
    01856 8E24      STD	Z+28,R2
    01857 8E25      STD	Z+29,R2
    01858 8E26      STD	Z+30,R2
    01859 8E27      STD	Z+31,R2
(2305) 			cl = LD_CLUST(dir);					/* Get start cluster */
    0185A 8C22      LDD	R2,Z+26
    0185B 2433      CLR	R3
    0185C 8C43      LDD	R4,Z+27
    0185D 2455      CLR	R5
    0185E 2C54      MOV	R5,R4
    0185F 2444      CLR	R4
    01860 2842      OR	R4,R2
    01861 2853      OR	R5,R3
    01862 0112      MOVW	R2,R4
    01863 2444      CLR	R4
    01864 2455      CLR	R5
    01865 8864      LDD	R6,Z+20
    01866 2477      CLR	R7
    01867 9675      ADIW	R30,0x15
    01868 8080      LD	R8,Z
    01869 2499      CLR	R9
    0186A 2C98      MOV	R9,R8
    0186B 2488      CLR	R8
    0186C 2886      OR	R8,R6
    0186D 2897      OR	R9,R7
    0186E 0134      MOVW	R6,R8
    0186F 2488      CLR	R8
    01870 2499      CLR	R9
    01871 0143      MOVW	R8,R6
    01872 2466      CLR	R6
    01873 2477      CLR	R7
    01874 2862      OR	R6,R2
    01875 2873      OR	R7,R3
    01876 2884      OR	R8,R4
    01877 2895      OR	R9,R5
    01878 A668      STD	Y+40,R6
    01879 A679      STD	Y+41,R7
    0187A A68A      STD	Y+42,R8
    0187B A69B      STD	Y+43,R9
(2306) 			ST_CLUST(dir, 0);					/* cluster = 0 */
    0187C 2422      CLR	R2
    0187D 01F7      MOVW	R30,R14
    0187E 8E22      STD	Z+26,R2
    0187F 8E23      STD	Z+27,R2
    01880 8A24      STD	Z+20,R2
    01881 8A25      STD	Z+21,R2
(2307) 			dj.fs->wflag = 1;
    01882 E081      LDI	R24,1
    01883 81EA      LDD	R30,Y+2
    01884 81FB      LDD	R31,Y+3
    01885 9634      ADIW	R30,4
    01886 8380      ST	Z,R24
(2308) 			if (cl) {							/* Remove the cluster chain if exist */
    01887 A428      LDD	R2,Y+40
    01888 A439      LDD	R3,Y+41
    01889 A44A      LDD	R4,Y+42
    0188A A45B      LDD	R5,Y+43
    0188B 9488      BCLR	0
    0188C 2022      TST	R2
    0188D 0432      CPC	R3,R2
    0188E 0442      CPC	R4,R2
    0188F 0452      CPC	R5,R2
    01890 F409      BNE	0x1892
    01891 C04B      RJMP	0x18DD
(2309) 				dw = dj.fs->winsect;
    01892 81EA      LDD	R30,Y+2
    01893 81FB      LDD	R31,Y+3
    01894 A422      LDD	R2,Z+42
    01895 A433      LDD	R3,Z+43
    01896 A444      LDD	R4,Z+44
    01897 A455      LDD	R5,Z+45
    01898 A22C      STD	Y+36,R2
    01899 A23D      STD	Y+37,R3
    0189A A24E      STD	Y+38,R4
    0189B A25F      STD	Y+39,R5
(2310) 				res = remove_chain(dj.fs, cl);
    0189C A428      LDD	R2,Y+40
    0189D A439      LDD	R3,Y+41
    0189E A44A      LDD	R4,Y+42
    0189F A45B      LDD	R5,Y+43
    018A0 8248      ST	Y,R4
    018A1 8259      STD	Y+1,R5
    018A2 0191      MOVW	R18,R2
    018A3 810A      LDD	R16,Y+2
    018A4 811B      LDD	R17,Y+3
    018A5 940E 094F CALL	ff.c:remove_chain
    018A7 2EC0      MOV	R12,R16
    018A8 2CAC      MOV	R10,R12
(2311) 				if (res == FR_OK) {
    018A9 2300      TST	R16
    018AA F591      BNE	0x18DD
(2312) 					dj.fs->last_clust = cl - 1;	/* Reuse the cluster hole */
    018AB E041      LDI	R20,1
    018AC E050      LDI	R21,0
    018AD E060      LDI	R22,0
    018AE E070      LDI	R23,0
    018AF A428      LDD	R2,Y+40
    018B0 A439      LDD	R3,Y+41
    018B1 A44A      LDD	R4,Y+42
    018B2 A45B      LDD	R5,Y+43
    018B3 1A24      SUB	R2,R20
    018B4 0A35      SBC	R3,R21
    018B5 0A46      SBC	R4,R22
    018B6 0A57      SBC	R5,R23
    018B7 81EA      LDD	R30,Y+2
    018B8 81FB      LDD	R31,Y+3
    018B9 8622      STD	Z+10,R2
    018BA 8633      STD	Z+11,R3
    018BB 8644      STD	Z+12,R4
    018BC 8655      STD	Z+13,R5
(2313) 					res = move_window(dj.fs, dw);
    018BD A02C      LDD	R2,Y+36
    018BE A03D      LDD	R3,Y+37
    018BF A04E      LDD	R4,Y+38
    018C0 A05F      LDD	R5,Y+39
    018C1 8248      ST	Y,R4
    018C2 8259      STD	Y+1,R5
    018C3 0191      MOVW	R18,R2
    018C4 810A      LDD	R16,Y+2
    018C5 811B      LDD	R17,Y+3
    018C6 940E 0477 CALL	ff.c:move_window
    018C8 2EC0      MOV	R12,R16
    018C9 2CAC      MOV	R10,R12
(2314) 				}
(2315) 			}
(2316) 		}
(2317) 	}
    018CA C012      RJMP	0x18DD
(2318) 	else {	/* Open an existing file */
(2319) 		if (res == FR_OK) {						/* Follow succeeded */
    018CB 20AA      TST	R10
    018CC F481      BNE	0x18DD
(2320) 			if (dir[DIR_Attr] & AM_DIR) {		/* It is a directory */
    018CD 01F7      MOVW	R30,R14
    018CE 8423      LDD	R2,Z+11
    018CF FE24      SBRS	R2,4
    018D0 C003      RJMP	0x18D4
(2321) 				res = FR_NO_FILE;
    018D1 E084      LDI	R24,4
    018D2 2EA8      MOV	R10,R24
(2322) 			} else {
    018D3 C009      RJMP	0x18DD
(2323) 				if ((mode & FA_WRITE) && (dir[DIR_Attr] & AM_RDO)) /* R/O violation */
    018D4 AC0A      LDD	R0,Y+58
    018D5 FE01      SBRS	R0,1
    018D6 C006      RJMP	0x18DD
    018D7 01F7      MOVW	R30,R14
    018D8 8423      LDD	R2,Z+11
    018D9 FE20      SBRS	R2,0
    018DA C002      RJMP	0x18DD
(2324) 					res = FR_DENIED;
    018DB E087      LDI	R24,7
    018DC 2EA8      MOV	R10,R24
(2325) 			}
(2326) 		}
(2327) 	}
(2328) 	if (res == FR_OK) {
    018DD 20AA      TST	R10
    018DE F4A1      BNE	0x18F3
(2329) 		if (mode & FA_CREATE_ALWAYS)			/* Set file change flag if created or overwritten */
    018DF AC0A      LDD	R0,Y+58
    018E0 FE03      SBRS	R0,3
    018E1 C003      RJMP	0x18E5
(2330) 			mode |= FA__WRITTEN;
    018E2 2D80      MOV	R24,R0
    018E3 6280      ORI	R24,0x20
    018E4 AF8A      STD	Y+58,R24
(2331) 		fp->dir_sect = dj.fs->winsect;			/* Pointer to the directory entry */
    018E5 81EA      LDD	R30,Y+2
    018E6 81FB      LDD	R31,Y+3
    018E7 A422      LDD	R2,Z+42
    018E8 A433      LDD	R3,Z+43
    018E9 A444      LDD	R4,Z+44
    018EA A455      LDD	R5,Z+45
    018EB A9EE      LDD	R30,Y+54
    018EC A9FF      LDD	R31,Y+55
    018ED 8E22      STD	Z+26,R2
    018EE 8E33      STD	Z+27,R3
    018EF 8E44      STD	Z+28,R4
    018F0 8E55      STD	Z+29,R5
(2332) 		fp->dir_ptr = dir;
    018F1 8EF7      STD	Z+31,R15
    018F2 8EE6      STD	Z+30,R14
(2333) #if _FS_SHARE
(2334) 		fp->lockid = inc_lock(&dj, (mode & ~FA_READ) ? 1 : 0);
(2335) 		if (!fp->lockid) res = FR_INT_ERR;
(2336) #endif
(2337) 	}
(2338) 
(2339) #else				/* R/O configuration */
(2340) 	if (res == FR_OK) {					/* Follow succeeded */
(2341) 		if (!dir) {						/* Current dir itself */
(2342) 			res = FR_INVALID_NAME;
(2343) 		} else {
(2344) 			if (dir[DIR_Attr] & AM_DIR)	/* It is a directory */
(2345) 				res = FR_NO_FILE;
(2346) 		}
(2347) 	}
(2348) #endif
(2349) 	FREE_BUF();
(2350) 
(2351) 	if (res == FR_OK) {
    018F3 20AA      TST	R10
    018F4 F009      BEQ	0x18F6
    018F5 C077      RJMP	0x196D
(2352) 		fp->flag = mode;					/* File access mode */
    018F6 A9EE      LDD	R30,Y+54
    018F7 A9FF      LDD	R31,Y+55
    018F8 AC0A      LDD	R0,Y+58
    018F9 8204      STD	Z+4,R0
(2353) 		fp->sclust = LD_CLUST(dir);			/* File start cluster */
    018FA 01F7      MOVW	R30,R14
    018FB 8C22      LDD	R2,Z+26
    018FC 2433      CLR	R3
    018FD 8C43      LDD	R4,Z+27
    018FE 2455      CLR	R5
    018FF 2C54      MOV	R5,R4
    01900 2444      CLR	R4
    01901 2842      OR	R4,R2
    01902 2853      OR	R5,R3
    01903 0112      MOVW	R2,R4
    01904 2444      CLR	R4
    01905 2455      CLR	R5
    01906 8864      LDD	R6,Z+20
    01907 2477      CLR	R7
    01908 8885      LDD	R8,Z+21
    01909 2499      CLR	R9
    0190A 2C98      MOV	R9,R8
    0190B 2488      CLR	R8
    0190C 2886      OR	R8,R6
    0190D 2897      OR	R9,R7
    0190E 0134      MOVW	R6,R8
    0190F 2488      CLR	R8
    01910 2499      CLR	R9
    01911 0143      MOVW	R8,R6
    01912 2466      CLR	R6
    01913 2477      CLR	R7
    01914 2862      OR	R6,R2
    01915 2873      OR	R7,R3
    01916 2884      OR	R8,R4
    01917 2895      OR	R9,R5
    01918 A9EE      LDD	R30,Y+54
    01919 A9FF      LDD	R31,Y+55
    0191A 8666      STD	Z+14,R6
    0191B 8677      STD	Z+15,R7
    0191C 8A80      STD	Z+16,R8
    0191D 8A91      STD	Z+17,R9
(2354) 		fp->fsize = LD_DWORD(dir+DIR_FileSize);	/* File size */
    0191E E188      LDI	R24,0x18
    0191F E090      LDI	R25,0
    01920 01F7      MOVW	R30,R14
    01921 8D07      LDD	R16,Z+31
    01922 2711      CLR	R17
    01923 2722      CLR	R18
    01924 2733      CLR	R19
    01925 938A      ST	-Y,R24
    01926 940E 4B92 CALL	lsl32
    01928 0118      MOVW	R2,R16
    01929 0129      MOVW	R4,R18
    0192A 01F7      MOVW	R30,R14
    0192B 8C66      LDD	R6,Z+30
    0192C 2477      CLR	R7
    0192D 2488      CLR	R8
    0192E 2499      CLR	R9
    0192F 0143      MOVW	R8,R6
    01930 2466      CLR	R6
    01931 2477      CLR	R7
    01932 2826      OR	R2,R6
    01933 2837      OR	R3,R7
    01934 2848      OR	R4,R8
    01935 2859      OR	R5,R9
    01936 8C65      LDD	R6,Z+29
    01937 2477      CLR	R7
    01938 2C76      MOV	R7,R6
    01939 2466      CLR	R6
    0193A 2488      CLR	R8
    0193B 2499      CLR	R9
    0193C 2826      OR	R2,R6
    0193D 2837      OR	R3,R7
    0193E 2848      OR	R4,R8
    0193F 2859      OR	R5,R9
    01940 8C64      LDD	R6,Z+28
    01941 2477      CLR	R7
    01942 2488      CLR	R8
    01943 2499      CLR	R9
    01944 2826      OR	R2,R6
    01945 2837      OR	R3,R7
    01946 2848      OR	R4,R8
    01947 2859      OR	R5,R9
    01948 A9EE      LDD	R30,Y+54
    01949 A9FF      LDD	R31,Y+55
    0194A 8622      STD	Z+10,R2
    0194B 8633      STD	Z+11,R3
    0194C 8644      STD	Z+12,R4
    0194D 8655      STD	Z+13,R5
(2355) 		fp->fptr = 0;						/* File pointer */
    0194E 9636      ADIW	R30,6
    0194F E080      LDI	R24,0
    01950 8380      ST	Z,R24
    01951 8381      STD	Z+1,R24
    01952 8382      STD	Z+2,R24
    01953 8383      STD	Z+3,R24
(2356) 		fp->dsect = 0;
    01954 A9EE      LDD	R30,Y+54
    01955 A9FF      LDD	R31,Y+55
    01956 9676      ADIW	R30,0x16
    01957 E080      LDI	R24,0
    01958 8380      ST	Z,R24
    01959 8381      STD	Z+1,R24
    0195A 8382      STD	Z+2,R24
    0195B 8383      STD	Z+3,R24
(2357) #if _USE_FASTSEEK
(2358) 		fp->cltbl = 0;						/* Normal seek mode */
    0195C 2422      CLR	R2
    0195D 2433      CLR	R3
    0195E A9EE      LDD	R30,Y+54
    0195F A9FF      LDD	R31,Y+55
    01960 A231      STD	Z+33,R3
    01961 A220      STD	Z+32,R2
(2359) #endif
(2360) 		fp->fs = dj.fs; fp->id = dj.fs->id;	/* Validate file object */
    01962 802A      LDD	R2,Y+2
    01963 803B      LDD	R3,Y+3
    01964 8231      STD	Z+1,R3
    01965 8220      ST	Z,R2
    01966 01F1      MOVW	R30,R2
    01967 8026      LDD	R2,Z+6
    01968 8037      LDD	R3,Z+7
    01969 A9EE      LDD	R30,Y+54
    0196A A9FF      LDD	R31,Y+55
    0196B 8233      STD	Z+3,R3
    0196C 8222      STD	Z+2,R2
(2361) 	}
(2362) 
(2363) 	LEAVE_FF(dj.fs, res);
    0196D 2D0A      MOV	R16,R10
    0196E 96AC      ADIW	R28,0x2C
    0196F 940E 4AFC CALL	pop_xgsetF0FC
    01971 9624      ADIW	R28,4
    01972 9508      RET
_f_read:
  remain               --> Y,+13
  res                  --> R10
  clst                 --> Y,+9
  csect                --> R12
  cc                   --> R10
  rbuff                --> R14
  sect                 --> Y,+5
  rcnt                 --> R12
  br                   --> Y,+33
  btr                  --> Y,+31
  buff                 --> R10
  fp                   --> Y,+27
    01973 940E 49C2 CALL	push_arg4
    01975 940E 4B07 CALL	push_xgsetF0FC
    01977 0159      MOVW	R10,R18
    01978 9761      SBIW	R28,0x11
(2364) }
(2365) 
(2366) 
(2367) 
(2368) 
(2369) /*-----------------------------------------------------------------------*/
(2370) /* Read File                                                             */
(2371) /*-----------------------------------------------------------------------*/
(2372) 
(2373) FRESULT f_read (
(2374) 	FIL *fp, 		/* Pointer to the file object */
(2375) 	void *buff,		/* Pointer to data buffer */
(2376) 	UINT btr,		/* Number of bytes to read */
(2377) 	UINT *br		/* Pointer to number of bytes read */
(2378) )
(2379) {
(2380) 	FRESULT res;
(2381) 	DWORD clst, sect, remain;
(2382) 	UINT rcnt, cc;
(2383) 	BYTE csect, *rbuff = buff;
    01979 0175      MOVW	R14,R10
(2384) 
(2385) 	memset(buff,0,512);
    0197A E080      LDI	R24,0
    0197B E092      LDI	R25,2
    0197C 8399      STD	Y+1,R25
    0197D 8388      ST	Y,R24
    0197E 2722      CLR	R18
    0197F 2733      CLR	R19
    01980 0185      MOVW	R16,R10
    01981 940E 499E CALL	_memset
(2386) 
(2387) 	*br = 0;	/* Initialize byte counter */
    01983 2422      CLR	R2
    01984 2433      CLR	R3
    01985 A1E9      LDD	R30,Y+33
    01986 A1FA      LDD	R31,Y+34
    01987 8231      STD	Z+1,R3
    01988 8220      ST	Z,R2
(2388) 
(2389) 	res = validate(fp->fs, fp->id);				/* Check validity */
    01989 8DEB      LDD	R30,Y+27
    0198A 8DFC      LDD	R31,Y+28
    0198B 8122      LDD	R18,Z+2
    0198C 8133      LDD	R19,Z+3
    0198D 8100      LD	R16,Z
    0198E 8111      LDD	R17,Z+1
    0198F DDFF      RCALL	ff.c:validate
    01990 2EA0      MOV	R10,R16
(2390) 	if (res != FR_OK) LEAVE_FF(fp->fs, res);
    01991 2300      TST	R16
    01992 F009      BEQ	0x1994
    01993 C245      RJMP	0x1BD9
(2391) 	if (fp->flag & FA__ERROR)					/* Aborted file? */
    01994 8DEB      LDD	R30,Y+27
    01995 8DFC      LDD	R31,Y+28
    01996 8024      LDD	R2,Z+4
    01997 FE27      SBRS	R2,7
    01998 C002      RJMP	0x199B
(2392) 		LEAVE_FF(fp->fs, FR_INT_ERR);
    01999 E002      LDI	R16,2
    0199A C23E      RJMP	0x1BD9
(2393) 	if (!(fp->flag & FA_READ)) 					/* Check access mode */
    0199B 8DEB      LDD	R30,Y+27
    0199C 8DFC      LDD	R31,Y+28
    0199D 8024      LDD	R2,Z+4
    0199E FC20      SBRC	R2,0
    0199F C002      RJMP	0x19A2
(2394) 		LEAVE_FF(fp->fs, FR_DENIED);
    019A0 E007      LDI	R16,7
    019A1 C237      RJMP	0x1BD9
(2395) 	remain = fp->fsize - fp->fptr;
    019A2 8DEB      LDD	R30,Y+27
    019A3 8DFC      LDD	R31,Y+28
    019A4 8026      LDD	R2,Z+6
    019A5 8037      LDD	R3,Z+7
    019A6 8440      LDD	R4,Z+8
    019A7 8451      LDD	R5,Z+9
    019A8 963A      ADIW	R30,0xA
    019A9 8060      LD	R6,Z
    019AA 8071      LDD	R7,Z+1
    019AB 8082      LDD	R8,Z+2
    019AC 8093      LDD	R9,Z+3
    019AD 1862      SUB	R6,R2
    019AE 0873      SBC	R7,R3
    019AF 0884      SBC	R8,R4
    019B0 0895      SBC	R9,R5
    019B1 866D      STD	Y+13,R6
    019B2 867E      STD	Y+14,R7
    019B3 868F      STD	Y+15,R8
    019B4 8A98      STD	Y+16,R9
(2396) 	if (btr > remain) btr = (UINT)remain;		/* Truncate btr by remaining bytes */
    019B5 842D      LDD	R2,Y+13
    019B6 843E      LDD	R3,Y+14
    019B7 844F      LDD	R4,Y+15
    019B8 8858      LDD	R5,Y+16
    019B9 8C6F      LDD	R6,Y+31
    019BA A078      LDD	R7,Y+32
    019BB 2488      CLR	R8
    019BC 2499      CLR	R9
    019BD 1426      CP	R2,R6
    019BE 0437      CPC	R3,R7
    019BF 0448      CPC	R4,R8
    019C0 0459      CPC	R5,R9
    019C1 F008      BCS	0x19C3
    019C2 C20D      RJMP	0x1BD0
    019C3 A238      STD	Y+32,R3
    019C4 8E2F      STD	Y+31,R2
(2397) 
(2398) 	for ( ;  btr;								/* Repeat until all data read */
    019C5 C20A      RJMP	0x1BD0
(2399) 		rbuff += rcnt, fp->fptr += rcnt, *br += rcnt, btr -= rcnt) {
(2400) 		if ((fp->fptr % SS(fp->fs)) == 0) {		/* On the sector boundary? */
    019C6 EF4F      LDI	R20,0xFF
    019C7 E051      LDI	R21,1
    019C8 E060      LDI	R22,0
    019C9 E070      LDI	R23,0
    019CA 8DEB      LDD	R30,Y+27
    019CB 8DFC      LDD	R31,Y+28
    019CC 9636      ADIW	R30,6
    019CD 8020      LD	R2,Z
    019CE 8031      LDD	R3,Z+1
    019CF 8042      LDD	R4,Z+2
    019D0 8053      LDD	R5,Z+3
    019D1 2224      AND	R2,R20
    019D2 2235      AND	R3,R21
    019D3 2246      AND	R4,R22
    019D4 2257      AND	R5,R23
    019D5 9488      BCLR	0
    019D6 2022      TST	R2
    019D7 0432      CPC	R3,R2
    019D8 0442      CPC	R4,R2
    019D9 0452      CPC	R5,R2
    019DA F009      BEQ	0x19DC
    019DB C180      RJMP	0x1B5C
(2401) 			csect = (BYTE)(fp->fptr / SS(fp->fs) & (fp->fs->csize - 1));	/* Sector offset in the cluster */
    019DC E089      LDI	R24,0x9
    019DD E090      LDI	R25,0
    019DE 8DEB      LDD	R30,Y+27
    019DF 8DFC      LDD	R31,Y+28
    019E0 8106      LDD	R16,Z+6
    019E1 8117      LDD	R17,Z+7
    019E2 8520      LDD	R18,Z+8
    019E3 8531      LDD	R19,Z+9
    019E4 938A      ST	-Y,R24
    019E5 940E 4BAB CALL	lsr32
    019E7 0118      MOVW	R2,R16
    019E8 0129      MOVW	R4,R18
    019E9 8DEB      LDD	R30,Y+27
    019EA 8DFC      LDD	R31,Y+28
    019EB 93AF      PUSH	R26
    019EC 93BF      PUSH	R27
    019ED 81A0      LD	R26,Z
    019EE 81B1      LDD	R27,Z+1
    019EF 01FD      MOVW	R30,R26
    019F0 91BF      POP	R27
    019F1 91AF      POP	R26
    019F2 8182      LDD	R24,Z+2
    019F3 2799      CLR	R25
    019F4 9701      SBIW	R24,1
    019F5 013C      MOVW	R6,R24
    019F6 2488      CLR	R8
    019F7 FC77      SBRC	R7,7
    019F8 9480      COM	R8
    019F9 2499      CLR	R9
    019FA FC87      SBRC	R8,7
    019FB 9490      COM	R9
    019FC 2026      AND	R2,R6
    019FD 2037      AND	R3,R7
    019FE 2048      AND	R4,R8
    019FF 2059      AND	R5,R9
    01A00 2CC2      MOV	R12,R2
(2402) 			if (!csect) {						/* On the cluster boundary? */
    01A01 2022      TST	R2
    01A02 F009      BEQ	0x1A04
    01A03 C078      RJMP	0x1A7C
(2403) 				if (fp->fptr == 0) {			/* On the top of the file? */
    01A04 8DEB      LDD	R30,Y+27
    01A05 8DFC      LDD	R31,Y+28
    01A06 9636      ADIW	R30,6
    01A07 8020      LD	R2,Z
    01A08 8031      LDD	R3,Z+1
    01A09 8042      LDD	R4,Z+2
    01A0A 8053      LDD	R5,Z+3
    01A0B 9488      BCLR	0
    01A0C 2022      TST	R2
    01A0D 0432      CPC	R3,R2
    01A0E 0442      CPC	R4,R2
    01A0F 0452      CPC	R5,R2
    01A10 F461      BNE	0x1A1D
(2404) 					clst = fp->sclust;			/* Follow from the origin */
    01A11 8DEB      LDD	R30,Y+27
    01A12 8DFC      LDD	R31,Y+28
    01A13 963E      ADIW	R30,0xE
    01A14 8020      LD	R2,Z
    01A15 8031      LDD	R3,Z+1
    01A16 8042      LDD	R4,Z+2
    01A17 8053      LDD	R5,Z+3
    01A18 8629      STD	Y+9,R2
    01A19 863A      STD	Y+10,R3
    01A1A 864B      STD	Y+11,R4
    01A1B 865C      STD	Y+12,R5
(2405) 				} else {						/* Middle or end of the file */
    01A1C C028      RJMP	0x1A45
(2406) #if _USE_FASTSEEK
(2407) 					if (fp->cltbl)
    01A1D 8DEB      LDD	R30,Y+27
    01A1E 8DFC      LDD	R31,Y+28
    01A1F A020      LDD	R2,Z+32
    01A20 A031      LDD	R3,Z+33
    01A21 2022      TST	R2
    01A22 F411      BNE	0x1A25
    01A23 2033      TST	R3
    01A24 F079      BEQ	0x1A34
(2408) 						clst = clmt_clust(fp, fp->fptr);	/* Get cluster# from the CLMT */
    01A25 8026      LDD	R2,Z+6
    01A26 8037      LDD	R3,Z+7
    01A27 8440      LDD	R4,Z+8
    01A28 8451      LDD	R5,Z+9
    01A29 8248      ST	Y,R4
    01A2A 8259      STD	Y+1,R5
    01A2B 0191      MOVW	R18,R2
    01A2C 018F      MOVW	R16,R30
    01A2D 940E 0B7A CALL	ff.c:clmt_clust
    01A2F 8709      STD	Y+9,R16
    01A30 871A      STD	Y+10,R17
    01A31 872B      STD	Y+11,R18
    01A32 873C      STD	Y+12,R19
    01A33 C011      RJMP	0x1A45
(2409) 					else
(2410) #endif
(2411) 						clst = get_fat(fp->fs, fp->clust);	/* Follow cluster chain on the FAT */
    01A34 8DEB      LDD	R30,Y+27
    01A35 8DFC      LDD	R31,Y+28
    01A36 8822      LDD	R2,Z+18
    01A37 8833      LDD	R3,Z+19
    01A38 8844      LDD	R4,Z+20
    01A39 8855      LDD	R5,Z+21
    01A3A 8248      ST	Y,R4
    01A3B 8259      STD	Y+1,R5
    01A3C 0191      MOVW	R18,R2
    01A3D 8100      LD	R16,Z
    01A3E 8111      LDD	R17,Z+1
    01A3F 940E 0640 CALL	_get_fat
    01A41 8709      STD	Y+9,R16
    01A42 871A      STD	Y+10,R17
    01A43 872B      STD	Y+11,R18
    01A44 873C      STD	Y+12,R19
(2412) 				}
(2413) 				if (clst < 2) ABORT(fp->fs, FR_INT_ERR);
    01A45 E042      LDI	R20,2
    01A46 E050      LDI	R21,0
    01A47 E060      LDI	R22,0
    01A48 E070      LDI	R23,0
    01A49 8429      LDD	R2,Y+9
    01A4A 843A      LDD	R3,Y+10
    01A4B 844B      LDD	R4,Y+11
    01A4C 845C      LDD	R5,Y+12
    01A4D 1624      CP	R2,R20
    01A4E 0635      CPC	R3,R21
    01A4F 0646      CPC	R4,R22
    01A50 0657      CPC	R5,R23
    01A51 F448      BCC	0x1A5B
    01A52 8D8B      LDD	R24,Y+27
    01A53 8D9C      LDD	R25,Y+28
    01A54 9604      ADIW	R24,4
    01A55 01FC      MOVW	R30,R24
    01A56 8180      LD	R24,Z
    01A57 6880      ORI	R24,0x80
    01A58 8380      ST	Z,R24
    01A59 E002      LDI	R16,2
    01A5A C17E      RJMP	0x1BD9
(2414) 				if (clst == 0xFFFFFFFF) ABORT(fp->fs, FR_DISK_ERR);
    01A5B EF4F      LDI	R20,0xFF
    01A5C EF5F      LDI	R21,0xFF
    01A5D EF6F      LDI	R22,0xFF
    01A5E EF7F      LDI	R23,0xFF
    01A5F 8429      LDD	R2,Y+9
    01A60 843A      LDD	R3,Y+10
    01A61 844B      LDD	R4,Y+11
    01A62 845C      LDD	R5,Y+12
    01A63 1624      CP	R2,R20
    01A64 0635      CPC	R3,R21
    01A65 0646      CPC	R4,R22
    01A66 0657      CPC	R5,R23
    01A67 F451      BNE	0x1A72
    01A68 8D8B      LDD	R24,Y+27
    01A69 8D9C      LDD	R25,Y+28
    01A6A 9604      ADIW	R24,4
    01A6B 015C      MOVW	R10,R24
    01A6C 01FC      MOVW	R30,R24
    01A6D 8180      LD	R24,Z
    01A6E 6880      ORI	R24,0x80
    01A6F 8380      ST	Z,R24
    01A70 E001      LDI	R16,1
    01A71 C167      RJMP	0x1BD9
(2415) 				fp->clust = clst;				/* Update current cluster */
    01A72 8429      LDD	R2,Y+9
    01A73 843A      LDD	R3,Y+10
    01A74 844B      LDD	R4,Y+11
    01A75 845C      LDD	R5,Y+12
    01A76 8DEB      LDD	R30,Y+27
    01A77 8DFC      LDD	R31,Y+28
    01A78 8A22      STD	Z+18,R2
    01A79 8A33      STD	Z+19,R3
    01A7A 8A44      STD	Z+20,R4
    01A7B 8A55      STD	Z+21,R5
(2416) 			}
(2417) 			sect = clust2sect(fp->fs, fp->clust);	/* Get current sector */
    01A7C 8DEB      LDD	R30,Y+27
    01A7D 8DFC      LDD	R31,Y+28
    01A7E 8822      LDD	R2,Z+18
    01A7F 8833      LDD	R3,Z+19
    01A80 8844      LDD	R4,Z+20
    01A81 8855      LDD	R5,Z+21
    01A82 8248      ST	Y,R4
    01A83 8259      STD	Y+1,R5
    01A84 0191      MOVW	R18,R2
    01A85 8100      LD	R16,Z
    01A86 8111      LDD	R17,Z+1
    01A87 940E 05EE CALL	_clust2sect
    01A89 830D      STD	Y+5,R16
    01A8A 831E      STD	Y+6,R17
    01A8B 832F      STD	Y+7,R18
    01A8C 8738      STD	Y+8,R19
(2418) 			if (!sect) ABORT(fp->fs, FR_INT_ERR);
    01A8D 802D      LDD	R2,Y+5
    01A8E 803E      LDD	R3,Y+6
    01A8F 804F      LDD	R4,Y+7
    01A90 8458      LDD	R5,Y+8
    01A91 9488      BCLR	0
    01A92 2022      TST	R2
    01A93 0432      CPC	R3,R2
    01A94 0442      CPC	R4,R2
    01A95 0452      CPC	R5,R2
    01A96 F451      BNE	0x1AA1
    01A97 8D8B      LDD	R24,Y+27
    01A98 8D9C      LDD	R25,Y+28
    01A99 9604      ADIW	R24,4
    01A9A 015C      MOVW	R10,R24
    01A9B 01FC      MOVW	R30,R24
    01A9C 8180      LD	R24,Z
    01A9D 6880      ORI	R24,0x80
    01A9E 8380      ST	Z,R24
    01A9F E002      LDI	R16,2
    01AA0 C138      RJMP	0x1BD9
(2419) 			sect += csect;
    01AA1 2C2C      MOV	R2,R12
    01AA2 2433      CLR	R3
    01AA3 2444      CLR	R4
    01AA4 2455      CLR	R5
    01AA5 806D      LDD	R6,Y+5
    01AA6 807E      LDD	R7,Y+6
    01AA7 808F      LDD	R8,Y+7
    01AA8 8498      LDD	R9,Y+8
    01AA9 0C62      ADD	R6,R2
    01AAA 1C73      ADC	R7,R3
    01AAB 1C84      ADC	R8,R4
    01AAC 1C95      ADC	R9,R5
    01AAD 826D      STD	Y+5,R6
    01AAE 827E      STD	Y+6,R7
    01AAF 828F      STD	Y+7,R8
    01AB0 8698      STD	Y+8,R9
(2420) 			cc = btr / SS(fp->fs);				/* When remaining bytes >= sector size, */
    01AB1 E029      LDI	R18,0x9
    01AB2 E030      LDI	R19,0
    01AB3 8D0F      LDD	R16,Y+31
    01AB4 A118      LDD	R17,Y+32
    01AB5 940E 4BA4 CALL	lsr16
    01AB7 0158      MOVW	R10,R16
(2421) 			if (cc) {							/* Read maximum contiguous sectors directly */
    01AB8 3000      CPI	R16,0
    01AB9 0701      CPC	R16,R17
    01ABA F409      BNE	0x1ABC
    01ABB C096      RJMP	0x1B52
(2422) 				if (csect + cc > fp->fs->csize)	/* Clip at cluster boundary */
    01ABC 2C2C      MOV	R2,R12
    01ABD 2433      CLR	R3
    01ABE 0E20      ADD	R2,R16
    01ABF 1E31      ADC	R3,R17
    01AC0 8DEB      LDD	R30,Y+27
    01AC1 8DFC      LDD	R31,Y+28
    01AC2 93AF      PUSH	R26
    01AC3 93BF      PUSH	R27
    01AC4 81A0      LD	R26,Z
    01AC5 81B1      LDD	R27,Z+1
    01AC6 01FD      MOVW	R30,R26
    01AC7 91BF      POP	R27
    01AC8 91AF      POP	R26
    01AC9 8042      LDD	R4,Z+2
    01ACA 2455      CLR	R5
    01ACB 1442      CP	R4,R2
    01ACC 0453      CPC	R5,R3
    01ACD F478      BCC	0x1ADD
(2423) 					cc = fp->fs->csize - csect;
    01ACE 2C2C      MOV	R2,R12
    01ACF 2433      CLR	R3
    01AD0 8DEB      LDD	R30,Y+27
    01AD1 8DFC      LDD	R31,Y+28
    01AD2 93AF      PUSH	R26
    01AD3 93BF      PUSH	R27
    01AD4 81A0      LD	R26,Z
    01AD5 81B1      LDD	R27,Z+1
    01AD6 01FD      MOVW	R30,R26
    01AD7 91BF      POP	R27
    01AD8 91AF      POP	R26
    01AD9 80A2      LDD	R10,Z+2
    01ADA 24BB      CLR	R11
    01ADB 18A2      SUB	R10,R2
    01ADC 08B3      SBC	R11,R3
(2424) 				if (disk_read(fp->fs->drv, rbuff, sect, (BYTE)cc) != RES_OK)
    01ADD 82AC      STD	Y+4,R10
    01ADE 802D      LDD	R2,Y+5
    01ADF 803E      LDD	R3,Y+6
    01AE0 804F      LDD	R4,Y+7
    01AE1 8458      LDD	R5,Y+8
    01AE2 8228      ST	Y,R2
    01AE3 8239      STD	Y+1,R3
    01AE4 824A      STD	Y+2,R4
    01AE5 825B      STD	Y+3,R5
    01AE6 0197      MOVW	R18,R14
    01AE7 8DEB      LDD	R30,Y+27
    01AE8 8DFC      LDD	R31,Y+28
    01AE9 93AF      PUSH	R26
    01AEA 93BF      PUSH	R27
    01AEB 81A0      LD	R26,Z
    01AEC 81B1      LDD	R27,Z+1
    01AED 01FD      MOVW	R30,R26
    01AEE 91BF      POP	R27
    01AEF 91AF      POP	R26
    01AF0 8101      LDD	R16,Z+1
    01AF1 940E 03DC CALL	_disk_read
    01AF3 2EC0      MOV	R12,R16
    01AF4 2300      TST	R16
    01AF5 F051      BEQ	0x1B00
(2425) 					ABORT(fp->fs, FR_DISK_ERR);
    01AF6 8D8B      LDD	R24,Y+27
    01AF7 8D9C      LDD	R25,Y+28
    01AF8 9604      ADIW	R24,4
    01AF9 016C      MOVW	R12,R24
    01AFA 01FC      MOVW	R30,R24
    01AFB 8180      LD	R24,Z
    01AFC 6880      ORI	R24,0x80
    01AFD 8380      ST	Z,R24
    01AFE E001      LDI	R16,1
    01AFF C0D9      RJMP	0x1BD9
(2426) #if !_FS_READONLY && _FS_MINIMIZE <= 2			/* Replace one of the read sectors with cached data if it contains a dirty sector */
(2427) #if _FS_TINY
(2428) 				if (fp->fs->wflag && fp->fs->winsect - sect < cc)
    01B00 8DEB      LDD	R30,Y+27
    01B01 8DFC      LDD	R31,Y+28
    01B02 80C0      LD	R12,Z
    01B03 80D1      LDD	R13,Z+1
    01B04 01F6      MOVW	R30,R12
    01B05 9634      ADIW	R30,4
    01B06 8020      LD	R2,Z
    01B07 2022      TST	R2
    01B08 F409      BNE	0x1B0A
    01B09 C041      RJMP	0x1B4B
    01B0A 802D      LDD	R2,Y+5
    01B0B 803E      LDD	R3,Y+6
    01B0C 804F      LDD	R4,Y+7
    01B0D 8458      LDD	R5,Y+8
    01B0E 01F6      MOVW	R30,R12
    01B0F A462      LDD	R6,Z+42
    01B10 A473      LDD	R7,Z+43
    01B11 A484      LDD	R8,Z+44
    01B12 A495      LDD	R9,Z+45
    01B13 1862      SUB	R6,R2
    01B14 0873      SBC	R7,R3
    01B15 0884      SBC	R8,R4
    01B16 0895      SBC	R9,R5
    01B17 0115      MOVW	R2,R10
    01B18 2444      CLR	R4
    01B19 2455      CLR	R5
    01B1A 1462      CP	R6,R2
    01B1B 0473      CPC	R7,R3
    01B1C 0484      CPC	R8,R4
    01B1D 0495      CPC	R9,R5
    01B1E F560      BCC	0x1B4B
(2429) 					mem_cpy(rbuff + ((fp->fs->winsect - sect) * SS(fp->fs)), fp->fs->win, SS(fp->fs));
    01B1F E080      LDI	R24,0
    01B20 E092      LDI	R25,2
    01B21 8399      STD	Y+1,R25
    01B22 8388      ST	Y,R24
    01B23 8DEB      LDD	R30,Y+27
    01B24 8DFC      LDD	R31,Y+28
    01B25 80C0      LD	R12,Z
    01B26 80D1      LDD	R13,Z+1
    01B27 0196      MOVW	R18,R12
    01B28 5D22      SUBI	R18,0xD2
    01B29 4F3F      SBCI	R19,0xFF
    01B2A 802D      LDD	R2,Y+5
    01B2B 803E      LDD	R3,Y+6
    01B2C 804F      LDD	R4,Y+7
    01B2D 8458      LDD	R5,Y+8
    01B2E 01F6      MOVW	R30,R12
    01B2F A462      LDD	R6,Z+42
    01B30 A473      LDD	R7,Z+43
    01B31 A484      LDD	R8,Z+44
    01B32 A495      LDD	R9,Z+45
    01B33 1862      SUB	R6,R2
    01B34 0873      SBC	R7,R3
    01B35 0884      SBC	R8,R4
    01B36 0895      SBC	R9,R5
    01B37 E040      LDI	R20,0
    01B38 E052      LDI	R21,2
    01B39 E060      LDI	R22,0
    01B3A E070      LDI	R23,0
    01B3B 932F      PUSH	R18
    01B3C 933F      PUSH	R19
    01B3D 929A      ST	-Y,R9
    01B3E 928A      ST	-Y,R8
    01B3F 927A      ST	-Y,R7
    01B40 926A      ST	-Y,R6
    01B41 018A      MOVW	R16,R20
    01B42 019B      MOVW	R18,R22
    01B43 940E 4AB3 CALL	empy32s|empy32u
    01B45 913F      POP	R19
    01B46 912F      POP	R18
    01B47 0D0E      ADD	R16,R14
    01B48 1D1F      ADC	R17,R15
    01B49 940E 041E CALL	ff.c:mem_cpy
(2430) #else
(2431) 				if ((fp->flag & FA__DIRTY) && fp->dsect - sect < cc)
(2432) 					mem_cpy(rbuff + ((fp->dsect - sect) * SS(fp->fs)), fp->buf, SS(fp->fs));
(2433) #endif
(2434) #endif
(2435) 				rcnt = SS(fp->fs) * cc;			/* Number of bytes transferred */
    01B4B E000      LDI	R16,0
    01B4C E012      LDI	R17,2
    01B4D 0195      MOVW	R18,R10
    01B4E 940E 4AA3 CALL	empy16s
    01B50 0168      MOVW	R12,R16
(2436) 				continue;
    01B51 C05A      RJMP	0x1BAC
(2437) 			}
(2438) #if !_FS_TINY
(2439) 			if (fp->dsect != sect) {			/* Load data sector if not in cache */
(2440) #if !_FS_READONLY
(2441) 				if (fp->flag & FA__DIRTY) {		/* Write-back dirty sector cache */
(2442) 					if (disk_write(fp->fs->drv, fp->buf, fp->dsect, 1) != RES_OK)
(2443) 						ABORT(fp->fs, FR_DISK_ERR);
(2444) 					fp->flag &= ~FA__DIRTY;
(2445) 				}
(2446) #endif
(2447) 				if (disk_read(fp->fs->drv, fp->buf, sect, 1) != RES_OK)	/* Fill sector cache */
(2448) 					ABORT(fp->fs, FR_DISK_ERR);
(2449) 			}
(2450) #endif
(2451) 			fp->dsect = sect;
    01B52 802D      LDD	R2,Y+5
    01B53 803E      LDD	R3,Y+6
    01B54 804F      LDD	R4,Y+7
    01B55 8458      LDD	R5,Y+8
    01B56 8DEB      LDD	R30,Y+27
    01B57 8DFC      LDD	R31,Y+28
    01B58 8A26      STD	Z+22,R2
    01B59 8A37      STD	Z+23,R3
    01B5A 8E40      STD	Z+24,R4
    01B5B 8E51      STD	Z+25,R5
(2452) 		}
(2453) 		rcnt = SS(fp->fs) - (fp->fptr % SS(fp->fs));	/* Get partial sector data from sector buffer */
    01B5C EF4F      LDI	R20,0xFF
    01B5D E051      LDI	R21,1
    01B5E E060      LDI	R22,0
    01B5F E070      LDI	R23,0
    01B60 8DEB      LDD	R30,Y+27
    01B61 8DFC      LDD	R31,Y+28
    01B62 8026      LDD	R2,Z+6
    01B63 8037      LDD	R3,Z+7
    01B64 8440      LDD	R4,Z+8
    01B65 8451      LDD	R5,Z+9
    01B66 2224      AND	R2,R20
    01B67 2235      AND	R3,R21
    01B68 2246      AND	R4,R22
    01B69 2257      AND	R5,R23
    01B6A E040      LDI	R20,0
    01B6B E052      LDI	R21,2
    01B6C E060      LDI	R22,0
    01B6D E070      LDI	R23,0
    01B6E 1942      SUB	R20,R2
    01B6F 0953      SBC	R21,R3
    01B70 0964      SBC	R22,R4
    01B71 0975      SBC	R23,R5
    01B72 016A      MOVW	R12,R20
(2454) 		if (rcnt > btr) rcnt = btr;
    01B73 8C0F      LDD	R0,Y+31
    01B74 A018      LDD	R1,Y+32
    01B75 1604      CP	R0,R20
    01B76 0615      CPC	R1,R21
    01B77 F408      BCC	0x1B79
    01B78 0160      MOVW	R12,R0
(2455) #if _FS_TINY
(2456) 		if (move_window(fp->fs, fp->dsect))		/* Move sector window */
    01B79 8DEB      LDD	R30,Y+27
    01B7A 8DFC      LDD	R31,Y+28
    01B7B 8826      LDD	R2,Z+22
    01B7C 8837      LDD	R3,Z+23
    01B7D 8C40      LDD	R4,Z+24
    01B7E 8C51      LDD	R5,Z+25
    01B7F 8248      ST	Y,R4
    01B80 8259      STD	Y+1,R5
    01B81 0191      MOVW	R18,R2
    01B82 8100      LD	R16,Z
    01B83 8111      LDD	R17,Z+1
    01B84 940E 0477 CALL	ff.c:move_window
    01B86 2EA0      MOV	R10,R16
    01B87 2300      TST	R16
    01B88 F051      BEQ	0x1B93
(2457) 			ABORT(fp->fs, FR_DISK_ERR);
    01B89 8D8B      LDD	R24,Y+27
    01B8A 8D9C      LDD	R25,Y+28
    01B8B 9604      ADIW	R24,4
    01B8C 015C      MOVW	R10,R24
    01B8D 01FC      MOVW	R30,R24
    01B8E 8180      LD	R24,Z
    01B8F 6880      ORI	R24,0x80
    01B90 8380      ST	Z,R24
    01B91 E001      LDI	R16,1
    01B92 C046      RJMP	0x1BD9
(2458) 		mem_cpy(rbuff, &fp->fs->win[fp->fptr % SS(fp->fs)], rcnt);	/* Pick partial sector */
    01B93 82D9      STD	Y+1,R13
    01B94 82C8      ST	Y,R12
    01B95 EF4F      LDI	R20,0xFF
    01B96 E051      LDI	R21,1
    01B97 E060      LDI	R22,0
    01B98 E070      LDI	R23,0
    01B99 8DEB      LDD	R30,Y+27
    01B9A 8DFC      LDD	R31,Y+28
    01B9B 8026      LDD	R2,Z+6
    01B9C 8037      LDD	R3,Z+7
    01B9D 8440      LDD	R4,Z+8
    01B9E 8451      LDD	R5,Z+9
    01B9F 2224      AND	R2,R20
    01BA0 2235      AND	R3,R21
    01BA1 2246      AND	R4,R22
    01BA2 2257      AND	R5,R23
    01BA3 0191      MOVW	R18,R2
    01BA4 8180      LD	R24,Z
    01BA5 8191      LDD	R25,Z+1
    01BA6 968E      ADIW	R24,0x2E
    01BA7 0F28      ADD	R18,R24
    01BA8 1F39      ADC	R19,R25
    01BA9 0187      MOVW	R16,R14
    01BAA 940E 041E CALL	ff.c:mem_cpy
    01BAC 0CEC      ADD	R14,R12
    01BAD 1CFD      ADC	R15,R13
    01BAE 8D8B      LDD	R24,Y+27
    01BAF 8D9C      LDD	R25,Y+28
    01BB0 9606      ADIW	R24,6
    01BB1 015C      MOVW	R10,R24
    01BB2 0116      MOVW	R2,R12
    01BB3 2444      CLR	R4
    01BB4 2455      CLR	R5
    01BB5 01FC      MOVW	R30,R24
    01BB6 8060      LD	R6,Z
    01BB7 8071      LDD	R7,Z+1
    01BB8 8082      LDD	R8,Z+2
    01BB9 8093      LDD	R9,Z+3
    01BBA 0C62      ADD	R6,R2
    01BBB 1C73      ADC	R7,R3
    01BBC 1C84      ADC	R8,R4
    01BBD 1C95      ADC	R9,R5
    01BBE 8260      ST	Z,R6
    01BBF 8271      STD	Z+1,R7
    01BC0 8282      STD	Z+2,R8
    01BC1 8293      STD	Z+3,R9
    01BC2 A1E9      LDD	R30,Y+33
    01BC3 A1FA      LDD	R31,Y+34
    01BC4 8020      LD	R2,Z
    01BC5 8031      LDD	R3,Z+1
    01BC6 0C2C      ADD	R2,R12
    01BC7 1C3D      ADC	R3,R13
    01BC8 8231      STD	Z+1,R3
    01BC9 8220      ST	Z,R2
    01BCA 8C0F      LDD	R0,Y+31
    01BCB A018      LDD	R1,Y+32
    01BCC 180C      SUB	R0,R12
    01BCD 081D      SBC	R1,R13
    01BCE A218      STD	Y+32,R1
    01BCF 8E0F      STD	Y+31,R0
    01BD0 8C0F      LDD	R0,Y+31
    01BD1 A018      LDD	R1,Y+32
    01BD2 2000      TST	R0
    01BD3 F009      BEQ	0x1BD5
    01BD4 CDF1      RJMP	0x19C6
    01BD5 2011      TST	R1
    01BD6 F009      BEQ	0x1BD8
    01BD7 CDEE      RJMP	0x19C6
(2459) #else
(2460) 		mem_cpy(rbuff, &fp->buf[fp->fptr % SS(fp->fs)], rcnt);	/* Pick partial sector */
(2461) #endif
(2462) 	}
(2463) 
(2464) 	LEAVE_FF(fp->fs, FR_OK);
    01BD8 2700      CLR	R16
    01BD9 9661      ADIW	R28,0x11
    01BDA 940E 4AFC CALL	pop_xgsetF0FC
    01BDC 9624      ADIW	R28,4
    01BDD 9508      RET
_f_write:
  res                  --> R10
  clst                 --> Y,+9
  csect                --> R12
  cc                   --> R10
  wbuff                --> R14
  sect                 --> Y,+5
  wcnt                 --> R12
  bw                   --> Y,+33
  btw                  --> Y,+31
  buff                 --> R10
  fp                   --> Y,+27
    01BDE 940E 49C2 CALL	push_arg4
    01BE0 940E 4B07 CALL	push_xgsetF0FC
    01BE2 0159      MOVW	R10,R18
    01BE3 9761      SBIW	R28,0x11
(2465) }
(2466) 
(2467) 
(2468) 
(2469) 
(2470) #if !_FS_READONLY
(2471) /*-----------------------------------------------------------------------*/
(2472) /* Write File                                                            */
(2473) /*-----------------------------------------------------------------------*/
(2474) 
(2475) FRESULT f_write (
(2476) 	FIL *fp,			/* Pointer to the file object */
(2477) 	const void *buff,	/* Pointer to the data to be written */
(2478) 	UINT btw,			/* Number of bytes to write */
(2479) 	UINT *bw			/* Pointer to number of bytes written */
(2480) )
(2481) {
(2482) 	FRESULT res;
(2483) 	DWORD clst, sect;
(2484) 	UINT wcnt, cc;
(2485) 	const BYTE *wbuff = buff;
    01BE4 0175      MOVW	R14,R10
(2486) 	BYTE csect;
(2487) 
(2488) 
(2489) 	*bw = 0;	/* Initialize byte counter */
    01BE5 2422      CLR	R2
    01BE6 2433      CLR	R3
    01BE7 A1E9      LDD	R30,Y+33
    01BE8 A1FA      LDD	R31,Y+34
    01BE9 8231      STD	Z+1,R3
    01BEA 8220      ST	Z,R2
(2490) 
(2491) 	res = validate(fp->fs, fp->id);			/* Check validity */
    01BEB 8DEB      LDD	R30,Y+27
    01BEC 8DFC      LDD	R31,Y+28
    01BED 8122      LDD	R18,Z+2
    01BEE 8133      LDD	R19,Z+3
    01BEF 8100      LD	R16,Z
    01BF0 8111      LDD	R17,Z+1
    01BF1 DB9D      RCALL	ff.c:validate
    01BF2 2EA0      MOV	R10,R16
(2492) 	if (res != FR_OK) LEAVE_FF(fp->fs, res);
    01BF3 2300      TST	R16
    01BF4 F009      BEQ	0x1BF6
    01BF5 C2FC      RJMP	0x1EF2
(2493) 	if (fp->flag & FA__ERROR)				/* Aborted file? */
    01BF6 8DEB      LDD	R30,Y+27
    01BF7 8DFC      LDD	R31,Y+28
    01BF8 8024      LDD	R2,Z+4
    01BF9 FE27      SBRS	R2,7
    01BFA C002      RJMP	0x1BFD
(2494) 		LEAVE_FF(fp->fs, FR_INT_ERR);
    01BFB E002      LDI	R16,2
    01BFC C2F5      RJMP	0x1EF2
(2495) 	if (!(fp->flag & FA_WRITE))				/* Check access mode */
    01BFD 8DEB      LDD	R30,Y+27
    01BFE 8DFC      LDD	R31,Y+28
    01BFF 8024      LDD	R2,Z+4
    01C00 FC21      SBRC	R2,1
    01C01 C002      RJMP	0x1C04
(2496) 		LEAVE_FF(fp->fs, FR_DENIED);
    01C02 E007      LDI	R16,7
    01C03 C2EE      RJMP	0x1EF2
(2497) 	if ((DWORD)(fp->fsize + btw) < fp->fsize) btw = 0;	/* File size cannot reach 4GB */
    01C04 8DEB      LDD	R30,Y+27
    01C05 8DFC      LDD	R31,Y+28
    01C06 963A      ADIW	R30,0xA
    01C07 8020      LD	R2,Z
    01C08 8031      LDD	R3,Z+1
    01C09 8042      LDD	R4,Z+2
    01C0A 8053      LDD	R5,Z+3
    01C0B 862D      STD	Y+13,R2
    01C0C 863E      STD	Y+14,R3
    01C0D 864F      STD	Y+15,R4
    01C0E 8A58      STD	Y+16,R5
    01C0F 8C2F      LDD	R2,Y+31
    01C10 A038      LDD	R3,Y+32
    01C11 2444      CLR	R4
    01C12 2455      CLR	R5
    01C13 846D      LDD	R6,Y+13
    01C14 847E      LDD	R7,Y+14
    01C15 848F      LDD	R8,Y+15
    01C16 8898      LDD	R9,Y+16
    01C17 0C62      ADD	R6,R2
    01C18 1C73      ADC	R7,R3
    01C19 1C84      ADC	R8,R4
    01C1A 1C95      ADC	R9,R5
    01C1B 842D      LDD	R2,Y+13
    01C1C 843E      LDD	R3,Y+14
    01C1D 844F      LDD	R4,Y+15
    01C1E 8858      LDD	R5,Y+16
    01C1F 1462      CP	R6,R2
    01C20 0473      CPC	R7,R3
    01C21 0484      CPC	R8,R4
    01C22 0495      CPC	R9,R5
    01C23 F008      BCS	0x1C25
    01C24 C2A5      RJMP	0x1ECA
    01C25 2400      CLR	R0
    01C26 2411      CLR	R1
    01C27 A218      STD	Y+32,R1
    01C28 8E0F      STD	Y+31,R0
(2498) 
(2499) 	for ( ;  btw;							/* Repeat until all data written */
    01C29 C2A0      RJMP	0x1ECA
(2500) 		wbuff += wcnt, fp->fptr += wcnt, *bw += wcnt, btw -= wcnt) {
(2501) 		if ((fp->fptr % SS(fp->fs)) == 0) {	/* On the sector boundary? */
    01C2A EF4F      LDI	R20,0xFF
    01C2B E051      LDI	R21,1
    01C2C E060      LDI	R22,0
    01C2D E070      LDI	R23,0
    01C2E 8DEB      LDD	R30,Y+27
    01C2F 8DFC      LDD	R31,Y+28
    01C30 9636      ADIW	R30,6
    01C31 8020      LD	R2,Z
    01C32 8031      LDD	R3,Z+1
    01C33 8042      LDD	R4,Z+2
    01C34 8053      LDD	R5,Z+3
    01C35 2224      AND	R2,R20
    01C36 2235      AND	R3,R21
    01C37 2246      AND	R4,R22
    01C38 2257      AND	R5,R23
    01C39 9488      BCLR	0
    01C3A 2022      TST	R2
    01C3B 0432      CPC	R3,R2
    01C3C 0442      CPC	R4,R2
    01C3D 0452      CPC	R5,R2
    01C3E F009      BEQ	0x1C40
    01C3F C20B      RJMP	0x1E4B
(2502) 			csect = (BYTE)(fp->fptr / SS(fp->fs) & (fp->fs->csize - 1));	/* Sector offset in the cluster */
    01C40 E089      LDI	R24,0x9
    01C41 E090      LDI	R25,0
    01C42 8DEB      LDD	R30,Y+27
    01C43 8DFC      LDD	R31,Y+28
    01C44 8106      LDD	R16,Z+6
    01C45 8117      LDD	R17,Z+7
    01C46 8520      LDD	R18,Z+8
    01C47 8531      LDD	R19,Z+9
    01C48 938A      ST	-Y,R24
    01C49 940E 4BAB CALL	lsr32
    01C4B 0118      MOVW	R2,R16
    01C4C 0129      MOVW	R4,R18
    01C4D 8DEB      LDD	R30,Y+27
    01C4E 8DFC      LDD	R31,Y+28
    01C4F 93AF      PUSH	R26
    01C50 93BF      PUSH	R27
    01C51 81A0      LD	R26,Z
    01C52 81B1      LDD	R27,Z+1
    01C53 01FD      MOVW	R30,R26
    01C54 91BF      POP	R27
    01C55 91AF      POP	R26
    01C56 8182      LDD	R24,Z+2
    01C57 2799      CLR	R25
    01C58 9701      SBIW	R24,1
    01C59 013C      MOVW	R6,R24
    01C5A 2488      CLR	R8
    01C5B FC77      SBRC	R7,7
    01C5C 9480      COM	R8
    01C5D 2499      CLR	R9
    01C5E FC87      SBRC	R8,7
    01C5F 9490      COM	R9
    01C60 2026      AND	R2,R6
    01C61 2037      AND	R3,R7
    01C62 2048      AND	R4,R8
    01C63 2059      AND	R5,R9
    01C64 2CC2      MOV	R12,R2
(2503) 			if (!csect) {					/* On the cluster boundary? */
    01C65 2022      TST	R2
    01C66 F009      BEQ	0x1C68
    01C67 C0A5      RJMP	0x1D0D
(2504) 				if (fp->fptr == 0) {		/* On the top of the file? */
    01C68 8DEB      LDD	R30,Y+27
    01C69 8DFC      LDD	R31,Y+28
    01C6A 9636      ADIW	R30,6
    01C6B 8020      LD	R2,Z
    01C6C 8031      LDD	R3,Z+1
    01C6D 8042      LDD	R4,Z+2
    01C6E 8053      LDD	R5,Z+3
    01C6F 9488      BCLR	0
    01C70 2022      TST	R2
    01C71 0432      CPC	R3,R2
    01C72 0442      CPC	R4,R2
    01C73 0452      CPC	R5,R2
    01C74 F571      BNE	0x1CA3
(2505) 					clst = fp->sclust;		/* Follow from the origin */
    01C75 8DEB      LDD	R30,Y+27
    01C76 8DFC      LDD	R31,Y+28
    01C77 963E      ADIW	R30,0xE
    01C78 8020      LD	R2,Z
    01C79 8031      LDD	R3,Z+1
    01C7A 8042      LDD	R4,Z+2
    01C7B 8053      LDD	R5,Z+3
    01C7C 8629      STD	Y+9,R2
    01C7D 863A      STD	Y+10,R3
    01C7E 864B      STD	Y+11,R4
    01C7F 865C      STD	Y+12,R5
(2506) 					if (clst == 0)			/* When no cluster is allocated, */
    01C80 8429      LDD	R2,Y+9
    01C81 843A      LDD	R3,Y+10
    01C82 844B      LDD	R4,Y+11
    01C83 845C      LDD	R5,Y+12
    01C84 9488      BCLR	0
    01C85 2022      TST	R2
    01C86 0432      CPC	R3,R2
    01C87 0442      CPC	R4,R2
    01C88 0452      CPC	R5,R2
    01C89 F009      BEQ	0x1C8B
    01C8A C040      RJMP	0x1CCB
(2507) 						fp->sclust = clst = create_chain(fp->fs, 0);	/* Create a new cluster chain */
    01C8B E040      LDI	R20,0
    01C8C E050      LDI	R21,0
    01C8D E060      LDI	R22,0
    01C8E E070      LDI	R23,0
    01C8F 8368      ST	Y,R22
    01C90 8379      STD	Y+1,R23
    01C91 019A      MOVW	R18,R20
    01C92 8DEB      LDD	R30,Y+27
    01C93 8DFC      LDD	R31,Y+28
    01C94 8100      LD	R16,Z
    01C95 8111      LDD	R17,Z+1
    01C96 940E 0A02 CALL	ff.c:create_chain
    01C98 8709      STD	Y+9,R16
    01C99 871A      STD	Y+10,R17
    01C9A 872B      STD	Y+11,R18
    01C9B 873C      STD	Y+12,R19
    01C9C 8DEB      LDD	R30,Y+27
    01C9D 8DFC      LDD	R31,Y+28
    01C9E 8706      STD	Z+14,R16
    01C9F 8717      STD	Z+15,R17
    01CA0 8B20      STD	Z+16,R18
    01CA1 8B31      STD	Z+17,R19
(2508) 				} else {					/* Middle or end of the file */
    01CA2 C028      RJMP	0x1CCB
(2509) #if _USE_FASTSEEK
(2510) 					if (fp->cltbl)
    01CA3 8DEB      LDD	R30,Y+27
    01CA4 8DFC      LDD	R31,Y+28
    01CA5 A020      LDD	R2,Z+32
    01CA6 A031      LDD	R3,Z+33
    01CA7 2022      TST	R2
    01CA8 F411      BNE	0x1CAB
    01CA9 2033      TST	R3
    01CAA F079      BEQ	0x1CBA
(2511) 						clst = clmt_clust(fp, fp->fptr);	/* Get cluster# from the CLMT */
    01CAB 8026      LDD	R2,Z+6
    01CAC 8037      LDD	R3,Z+7
    01CAD 8440      LDD	R4,Z+8
    01CAE 8451      LDD	R5,Z+9
    01CAF 8248      ST	Y,R4
    01CB0 8259      STD	Y+1,R5
    01CB1 0191      MOVW	R18,R2
    01CB2 018F      MOVW	R16,R30
    01CB3 940E 0B7A CALL	ff.c:clmt_clust
    01CB5 8709      STD	Y+9,R16
    01CB6 871A      STD	Y+10,R17
    01CB7 872B      STD	Y+11,R18
    01CB8 873C      STD	Y+12,R19
    01CB9 C011      RJMP	0x1CCB
(2512) 					else
(2513) #endif
(2514) 						clst = create_chain(fp->fs, fp->clust);	/* Follow or stretch cluster chain on the FAT */
    01CBA 8DEB      LDD	R30,Y+27
    01CBB 8DFC      LDD	R31,Y+28
    01CBC 8822      LDD	R2,Z+18
    01CBD 8833      LDD	R3,Z+19
    01CBE 8844      LDD	R4,Z+20
    01CBF 8855      LDD	R5,Z+21
    01CC0 8248      ST	Y,R4
    01CC1 8259      STD	Y+1,R5
    01CC2 0191      MOVW	R18,R2
    01CC3 8100      LD	R16,Z
    01CC4 8111      LDD	R17,Z+1
    01CC5 940E 0A02 CALL	ff.c:create_chain
    01CC7 8709      STD	Y+9,R16
    01CC8 871A      STD	Y+10,R17
    01CC9 872B      STD	Y+11,R18
    01CCA 873C      STD	Y+12,R19
(2515) 				}
(2516) 				if (clst == 0) break;		/* Could not allocate a new cluster (disk full) */
    01CCB 8429      LDD	R2,Y+9
    01CCC 843A      LDD	R3,Y+10
    01CCD 844B      LDD	R4,Y+11
    01CCE 845C      LDD	R5,Y+12
    01CCF 9488      BCLR	0
    01CD0 2022      TST	R2
    01CD1 0432      CPC	R3,R2
    01CD2 0442      CPC	R4,R2
    01CD3 0452      CPC	R5,R2
    01CD4 F409      BNE	0x1CD6
    01CD5 C1FC      RJMP	0x1ED2
(2517) 				if (clst == 1) ABORT(fp->fs, FR_INT_ERR);
    01CD6 E041      LDI	R20,1
    01CD7 E050      LDI	R21,0
    01CD8 E060      LDI	R22,0
    01CD9 E070      LDI	R23,0
    01CDA 8429      LDD	R2,Y+9
    01CDB 843A      LDD	R3,Y+10
    01CDC 844B      LDD	R4,Y+11
    01CDD 845C      LDD	R5,Y+12
    01CDE 1624      CP	R2,R20
    01CDF 0635      CPC	R3,R21
    01CE0 0646      CPC	R4,R22
    01CE1 0657      CPC	R5,R23
    01CE2 F449      BNE	0x1CEC
    01CE3 8D8B      LDD	R24,Y+27
    01CE4 8D9C      LDD	R25,Y+28
    01CE5 9604      ADIW	R24,4
    01CE6 01FC      MOVW	R30,R24
    01CE7 8180      LD	R24,Z
    01CE8 6880      ORI	R24,0x80
    01CE9 8380      ST	Z,R24
    01CEA E002      LDI	R16,2
    01CEB C206      RJMP	0x1EF2
(2518) 				if (clst == 0xFFFFFFFF) ABORT(fp->fs, FR_DISK_ERR);
    01CEC EF4F      LDI	R20,0xFF
    01CED EF5F      LDI	R21,0xFF
    01CEE EF6F      LDI	R22,0xFF
    01CEF EF7F      LDI	R23,0xFF
    01CF0 8429      LDD	R2,Y+9
    01CF1 843A      LDD	R3,Y+10
    01CF2 844B      LDD	R4,Y+11
    01CF3 845C      LDD	R5,Y+12
    01CF4 1624      CP	R2,R20
    01CF5 0635      CPC	R3,R21
    01CF6 0646      CPC	R4,R22
    01CF7 0657      CPC	R5,R23
    01CF8 F451      BNE	0x1D03
    01CF9 8D8B      LDD	R24,Y+27
    01CFA 8D9C      LDD	R25,Y+28
    01CFB 9604      ADIW	R24,4
    01CFC 015C      MOVW	R10,R24
    01CFD 01FC      MOVW	R30,R24
    01CFE 8180      LD	R24,Z
    01CFF 6880      ORI	R24,0x80
    01D00 8380      ST	Z,R24
    01D01 E001      LDI	R16,1
    01D02 C1EF      RJMP	0x1EF2
(2519) 				fp->clust = clst;			/* Update current cluster */
    01D03 8429      LDD	R2,Y+9
    01D04 843A      LDD	R3,Y+10
    01D05 844B      LDD	R4,Y+11
    01D06 845C      LDD	R5,Y+12
    01D07 8DEB      LDD	R30,Y+27
    01D08 8DFC      LDD	R31,Y+28
    01D09 8A22      STD	Z+18,R2
    01D0A 8A33      STD	Z+19,R3
    01D0B 8A44      STD	Z+20,R4
    01D0C 8A55      STD	Z+21,R5
(2520) 			}
(2521) #if _FS_TINY
(2522) 			if (fp->fs->winsect == fp->dsect && move_window(fp->fs, 0))	/* Write-back sector cache */
    01D0D 8DEB      LDD	R30,Y+27
    01D0E 8DFC      LDD	R31,Y+28
    01D0F 80A0      LD	R10,Z
    01D10 80B1      LDD	R11,Z+1
    01D11 8826      LDD	R2,Z+22
    01D12 8837      LDD	R3,Z+23
    01D13 8C40      LDD	R4,Z+24
    01D14 8C51      LDD	R5,Z+25
    01D15 01F5      MOVW	R30,R10
    01D16 A462      LDD	R6,Z+42
    01D17 A473      LDD	R7,Z+43
    01D18 A484      LDD	R8,Z+44
    01D19 A495      LDD	R9,Z+45
    01D1A 1462      CP	R6,R2
    01D1B 0473      CPC	R7,R3
    01D1C 0484      CPC	R8,R4
    01D1D 0495      CPC	R9,R5
    01D1E F4B9      BNE	0x1D36
    01D1F E040      LDI	R20,0
    01D20 E050      LDI	R21,0
    01D21 E060      LDI	R22,0
    01D22 E070      LDI	R23,0
    01D23 8368      ST	Y,R22
    01D24 8379      STD	Y+1,R23
    01D25 019A      MOVW	R18,R20
    01D26 018F      MOVW	R16,R30
    01D27 940E 0477 CALL	ff.c:move_window
    01D29 2EA0      MOV	R10,R16
    01D2A 2300      TST	R16
    01D2B F051      BEQ	0x1D36
(2523) 				ABORT(fp->fs, FR_DISK_ERR);
    01D2C 8D8B      LDD	R24,Y+27
    01D2D 8D9C      LDD	R25,Y+28
    01D2E 9604      ADIW	R24,4
    01D2F 015C      MOVW	R10,R24
    01D30 01FC      MOVW	R30,R24
    01D31 8180      LD	R24,Z
    01D32 6880      ORI	R24,0x80
    01D33 8380      ST	Z,R24
    01D34 E001      LDI	R16,1
    01D35 C1BC      RJMP	0x1EF2
(2524) #else
(2525) 			if (fp->flag & FA__DIRTY) {		/* Write-back sector cache */
(2526) 				if (disk_write(fp->fs->drv, fp->buf, fp->dsect, 1) != RES_OK)
(2527) 					ABORT(fp->fs, FR_DISK_ERR);
(2528) 				fp->flag &= ~FA__DIRTY;
(2529) 			}
(2530) #endif
(2531) 			sect = clust2sect(fp->fs, fp->clust);	/* Get current sector */
    01D36 8DEB      LDD	R30,Y+27
    01D37 8DFC      LDD	R31,Y+28
    01D38 8822      LDD	R2,Z+18
    01D39 8833      LDD	R3,Z+19
    01D3A 8844      LDD	R4,Z+20
    01D3B 8855      LDD	R5,Z+21
    01D3C 8248      ST	Y,R4
    01D3D 8259      STD	Y+1,R5
    01D3E 0191      MOVW	R18,R2
    01D3F 8100      LD	R16,Z
    01D40 8111      LDD	R17,Z+1
    01D41 940E 05EE CALL	_clust2sect
    01D43 830D      STD	Y+5,R16
    01D44 831E      STD	Y+6,R17
    01D45 832F      STD	Y+7,R18
    01D46 8738      STD	Y+8,R19
(2532) 			if (!sect) ABORT(fp->fs, FR_INT_ERR);
    01D47 802D      LDD	R2,Y+5
    01D48 803E      LDD	R3,Y+6
    01D49 804F      LDD	R4,Y+7
    01D4A 8458      LDD	R5,Y+8
    01D4B 9488      BCLR	0
    01D4C 2022      TST	R2
    01D4D 0432      CPC	R3,R2
    01D4E 0442      CPC	R4,R2
    01D4F 0452      CPC	R5,R2
    01D50 F451      BNE	0x1D5B
    01D51 8D8B      LDD	R24,Y+27
    01D52 8D9C      LDD	R25,Y+28
    01D53 9604      ADIW	R24,4
    01D54 015C      MOVW	R10,R24
    01D55 01FC      MOVW	R30,R24
    01D56 8180      LD	R24,Z
    01D57 6880      ORI	R24,0x80
    01D58 8380      ST	Z,R24
    01D59 E002      LDI	R16,2
    01D5A C197      RJMP	0x1EF2
(2533) 			sect += csect;
    01D5B 2C2C      MOV	R2,R12
    01D5C 2433      CLR	R3
    01D5D 2444      CLR	R4
    01D5E 2455      CLR	R5
    01D5F 806D      LDD	R6,Y+5
    01D60 807E      LDD	R7,Y+6
    01D61 808F      LDD	R8,Y+7
    01D62 8498      LDD	R9,Y+8
    01D63 0C62      ADD	R6,R2
    01D64 1C73      ADC	R7,R3
    01D65 1C84      ADC	R8,R4
    01D66 1C95      ADC	R9,R5
    01D67 826D      STD	Y+5,R6
    01D68 827E      STD	Y+6,R7
    01D69 828F      STD	Y+7,R8
    01D6A 8698      STD	Y+8,R9
(2534) 			cc = btw / SS(fp->fs);			/* When remaining bytes >= sector size, */
    01D6B E029      LDI	R18,0x9
    01D6C E030      LDI	R19,0
    01D6D 8D0F      LDD	R16,Y+31
    01D6E A118      LDD	R17,Y+32
    01D6F 940E 4BA4 CALL	lsr16
    01D71 0158      MOVW	R10,R16
(2535) 			if (cc) {						/* Write maximum contiguous sectors directly */
    01D72 3000      CPI	R16,0
    01D73 0701      CPC	R16,R17
    01D74 F409      BNE	0x1D76
    01D75 C097      RJMP	0x1E0D
(2536) 				if (csect + cc > fp->fs->csize)	/* Clip at cluster boundary */
    01D76 2C2C      MOV	R2,R12
    01D77 2433      CLR	R3
    01D78 0E20      ADD	R2,R16
    01D79 1E31      ADC	R3,R17
    01D7A 8DEB      LDD	R30,Y+27
    01D7B 8DFC      LDD	R31,Y+28
    01D7C 93AF      PUSH	R26
    01D7D 93BF      PUSH	R27
    01D7E 81A0      LD	R26,Z
    01D7F 81B1      LDD	R27,Z+1
    01D80 01FD      MOVW	R30,R26
    01D81 91BF      POP	R27
    01D82 91AF      POP	R26
    01D83 8042      LDD	R4,Z+2
    01D84 2455      CLR	R5
    01D85 1442      CP	R4,R2
    01D86 0453      CPC	R5,R3
    01D87 F478      BCC	0x1D97
(2537) 					cc = fp->fs->csize - csect;
    01D88 2C2C      MOV	R2,R12
    01D89 2433      CLR	R3
    01D8A 8DEB      LDD	R30,Y+27
    01D8B 8DFC      LDD	R31,Y+28
    01D8C 93AF      PUSH	R26
    01D8D 93BF      PUSH	R27
    01D8E 81A0      LD	R26,Z
    01D8F 81B1      LDD	R27,Z+1
    01D90 01FD      MOVW	R30,R26
    01D91 91BF      POP	R27
    01D92 91AF      POP	R26
    01D93 80A2      LDD	R10,Z+2
    01D94 24BB      CLR	R11
    01D95 18A2      SUB	R10,R2
    01D96 08B3      SBC	R11,R3
(2538) 				if (disk_write(fp->fs->drv,(char*)wbuff, sect, (BYTE)cc) != RES_OK)
    01D97 82AC      STD	Y+4,R10
    01D98 802D      LDD	R2,Y+5
    01D99 803E      LDD	R3,Y+6
    01D9A 804F      LDD	R4,Y+7
    01D9B 8458      LDD	R5,Y+8
    01D9C 8228      ST	Y,R2
    01D9D 8239      STD	Y+1,R3
    01D9E 824A      STD	Y+2,R4
    01D9F 825B      STD	Y+3,R5
    01DA0 0197      MOVW	R18,R14
    01DA1 8DEB      LDD	R30,Y+27
    01DA2 8DFC      LDD	R31,Y+28
    01DA3 93AF      PUSH	R26
    01DA4 93BF      PUSH	R27
    01DA5 81A0      LD	R26,Z
    01DA6 81B1      LDD	R27,Z+1
    01DA7 01FD      MOVW	R30,R26
    01DA8 91BF      POP	R27
    01DA9 91AF      POP	R26
    01DAA 8101      LDD	R16,Z+1
    01DAB 940E 03FC CALL	_disk_write
    01DAD 2EC0      MOV	R12,R16
    01DAE 2300      TST	R16
    01DAF F051      BEQ	0x1DBA
(2539) 					ABORT(fp->fs, FR_DISK_ERR);
    01DB0 8D8B      LDD	R24,Y+27
    01DB1 8D9C      LDD	R25,Y+28
    01DB2 9604      ADIW	R24,4
    01DB3 016C      MOVW	R12,R24
    01DB4 01FC      MOVW	R30,R24
    01DB5 8180      LD	R24,Z
    01DB6 6880      ORI	R24,0x80
    01DB7 8380      ST	Z,R24
    01DB8 E001      LDI	R16,1
    01DB9 C138      RJMP	0x1EF2
(2540) #if _FS_TINY
(2541) 				if (fp->fs->winsect - sect < cc) {	/* Refill sector cache if it gets invalidated by the direct write */
    01DBA 802D      LDD	R2,Y+5
    01DBB 803E      LDD	R3,Y+6
    01DBC 804F      LDD	R4,Y+7
    01DBD 8458      LDD	R5,Y+8
    01DBE 8DEB      LDD	R30,Y+27
    01DBF 8DFC      LDD	R31,Y+28
    01DC0 81A0      LD	R26,Z
    01DC1 81B1      LDD	R27,Z+1
    01DC2 969A      ADIW	R26,0x2A
    01DC3 906D      LD	R6,X+
    01DC4 907D      LD	R7,X+
    01DC5 908D      LD	R8,X+
    01DC6 909C      LD	R9,X
    01DC7 1862      SUB	R6,R2
    01DC8 0873      SBC	R7,R3
    01DC9 0884      SBC	R8,R4
    01DCA 0895      SBC	R9,R5
    01DCB 0115      MOVW	R2,R10
    01DCC 2444      CLR	R4
    01DCD 2455      CLR	R5
    01DCE 1462      CP	R6,R2
    01DCF 0473      CPC	R7,R3
    01DD0 0484      CPC	R8,R4
    01DD1 0495      CPC	R9,R5
    01DD2 F008      BCS	0x1DD4
    01DD3 C032      RJMP	0x1E06
(2542) 					mem_cpy(fp->fs->win, wbuff + ((fp->fs->winsect - sect) * SS(fp->fs)), SS(fp->fs));
    01DD4 E080      LDI	R24,0
    01DD5 E092      LDI	R25,2
    01DD6 8399      STD	Y+1,R25
    01DD7 8388      ST	Y,R24
    01DD8 80C0      LD	R12,Z
    01DD9 80D1      LDD	R13,Z+1
    01DDA 802D      LDD	R2,Y+5
    01DDB 803E      LDD	R3,Y+6
    01DDC 804F      LDD	R4,Y+7
    01DDD 8458      LDD	R5,Y+8
    01DDE 01F6      MOVW	R30,R12
    01DDF A462      LDD	R6,Z+42
    01DE0 A473      LDD	R7,Z+43
    01DE1 A484      LDD	R8,Z+44
    01DE2 A495      LDD	R9,Z+45
    01DE3 1862      SUB	R6,R2
    01DE4 0873      SBC	R7,R3
    01DE5 0884      SBC	R8,R4
    01DE6 0895      SBC	R9,R5
    01DE7 E040      LDI	R20,0
    01DE8 E052      LDI	R21,2
    01DE9 E060      LDI	R22,0
    01DEA E070      LDI	R23,0
    01DEB 929A      ST	-Y,R9
    01DEC 928A      ST	-Y,R8
    01DED 927A      ST	-Y,R7
    01DEE 926A      ST	-Y,R6
    01DEF 018A      MOVW	R16,R20
    01DF0 019B      MOVW	R18,R22
    01DF1 940E 4AB3 CALL	empy32s|empy32u
    01DF3 0198      MOVW	R18,R16
    01DF4 0D2E      ADD	R18,R14
    01DF5 1D3F      ADC	R19,R15
    01DF6 0186      MOVW	R16,R12
    01DF7 5D02      SUBI	R16,0xD2
    01DF8 4F1F      SBCI	R17,0xFF
    01DF9 940E 041E CALL	ff.c:mem_cpy
(2543) 					fp->fs->wflag = 0;
    01DFB 2422      CLR	R2
    01DFC 8DEB      LDD	R30,Y+27
    01DFD 8DFC      LDD	R31,Y+28
    01DFE 93AF      PUSH	R26
    01DFF 93BF      PUSH	R27
    01E00 81A0      LD	R26,Z
    01E01 81B1      LDD	R27,Z+1
    01E02 01FD      MOVW	R30,R26
    01E03 91BF      POP	R27
    01E04 91AF      POP	R26
    01E05 8224      STD	Z+4,R2
(2544) 				}
(2545) #else
(2546) 				if (fp->dsect - sect < cc) { /* Refill sector cache if it gets invalidated by the direct write */
(2547) 					mem_cpy(fp->buf, wbuff + ((fp->dsect - sect) * SS(fp->fs)), SS(fp->fs));
(2548) 					fp->flag &= ~FA__DIRTY;
(2549) 				}
(2550) #endif
(2551) 				wcnt = SS(fp->fs) * cc;		/* Number of bytes transferred */
    01E06 E000      LDI	R16,0
    01E07 E012      LDI	R17,2
    01E08 0195      MOVW	R18,R10
    01E09 940E 4AA3 CALL	empy16s
    01E0B 0168      MOVW	R12,R16
(2552) 				continue;
    01E0C C099      RJMP	0x1EA6
(2553) 			}
(2554) #if _FS_TINY
(2555) 			if (fp->fptr >= fp->fsize) {	/* Avoid silly cache filling at growing edge */
    01E0D 8DEB      LDD	R30,Y+27
    01E0E 8DFC      LDD	R31,Y+28
    01E0F 8422      LDD	R2,Z+10
    01E10 8433      LDD	R3,Z+11
    01E11 8444      LDD	R4,Z+12
    01E12 8455      LDD	R5,Z+13
    01E13 8066      LDD	R6,Z+6
    01E14 8077      LDD	R7,Z+7
    01E15 8480      LDD	R8,Z+8
    01E16 8491      LDD	R9,Z+9
    01E17 1462      CP	R6,R2
    01E18 0473      CPC	R7,R3
    01E19 0484      CPC	R8,R4
    01E1A 0495      CPC	R9,R5
    01E1B F128      BCS	0x1E41
(2556) 				if (move_window(fp->fs, 0)) ABORT(fp->fs, FR_DISK_ERR);
    01E1C E040      LDI	R20,0
    01E1D E050      LDI	R21,0
    01E1E E060      LDI	R22,0
    01E1F E070      LDI	R23,0
    01E20 8368      ST	Y,R22
    01E21 8379      STD	Y+1,R23
    01E22 019A      MOVW	R18,R20
    01E23 8100      LD	R16,Z
    01E24 8111      LDD	R17,Z+1
    01E25 940E 0477 CALL	ff.c:move_window
    01E27 2EA0      MOV	R10,R16
    01E28 2300      TST	R16
    01E29 F051      BEQ	0x1E34
    01E2A 8D8B      LDD	R24,Y+27
    01E2B 8D9C      LDD	R25,Y+28
    01E2C 9604      ADIW	R24,4
    01E2D 015C      MOVW	R10,R24
    01E2E 01FC      MOVW	R30,R24
    01E2F 8180      LD	R24,Z
    01E30 6880      ORI	R24,0x80
    01E31 8380      ST	Z,R24
    01E32 E001      LDI	R16,1
    01E33 C0BE      RJMP	0x1EF2
(2557) 				fp->fs->winsect = sect;
    01E34 802D      LDD	R2,Y+5
    01E35 803E      LDD	R3,Y+6
    01E36 804F      LDD	R4,Y+7
    01E37 8458      LDD	R5,Y+8
    01E38 8DEB      LDD	R30,Y+27
    01E39 8DFC      LDD	R31,Y+28
    01E3A 81A0      LD	R26,Z
    01E3B 81B1      LDD	R27,Z+1
    01E3C 969A      ADIW	R26,0x2A
    01E3D 922D      ST	X+,R2
    01E3E 923D      ST	X+,R3
    01E3F 924D      ST	X+,R4
    01E40 925C      ST	X,R5
(2558) 			}
(2559) #else
(2560) 			if (fp->dsect != sect) {		/* Fill sector cache with file data */
(2561) 				if (fp->fptr < fp->fsize &&
(2562) 					disk_read(fp->fs->drv, fp->buf, sect, 1) != RES_OK)
(2563) 						ABORT(fp->fs, FR_DISK_ERR);
(2564) 			}
(2565) #endif
(2566) 			fp->dsect = sect;
    01E41 802D      LDD	R2,Y+5
    01E42 803E      LDD	R3,Y+6
    01E43 804F      LDD	R4,Y+7
    01E44 8458      LDD	R5,Y+8
    01E45 8DEB      LDD	R30,Y+27
    01E46 8DFC      LDD	R31,Y+28
    01E47 8A26      STD	Z+22,R2
    01E48 8A37      STD	Z+23,R3
    01E49 8E40      STD	Z+24,R4
    01E4A 8E51      STD	Z+25,R5
(2567) 		}
(2568) 		wcnt = SS(fp->fs) - (fp->fptr % SS(fp->fs));/* Put partial sector into file I/O buffer */
    01E4B EF4F      LDI	R20,0xFF
    01E4C E051      LDI	R21,1
    01E4D E060      LDI	R22,0
    01E4E E070      LDI	R23,0
    01E4F 8DEB      LDD	R30,Y+27
    01E50 8DFC      LDD	R31,Y+28
    01E51 8026      LDD	R2,Z+6
    01E52 8037      LDD	R3,Z+7
    01E53 8440      LDD	R4,Z+8
    01E54 8451      LDD	R5,Z+9
    01E55 2224      AND	R2,R20
    01E56 2235      AND	R3,R21
    01E57 2246      AND	R4,R22
    01E58 2257      AND	R5,R23
    01E59 E040      LDI	R20,0
    01E5A E052      LDI	R21,2
    01E5B E060      LDI	R22,0
    01E5C E070      LDI	R23,0
    01E5D 1942      SUB	R20,R2
    01E5E 0953      SBC	R21,R3
    01E5F 0964      SBC	R22,R4
    01E60 0975      SBC	R23,R5
    01E61 016A      MOVW	R12,R20
(2569) 		if (wcnt > btw) wcnt = btw;
    01E62 8C0F      LDD	R0,Y+31
    01E63 A018      LDD	R1,Y+32
    01E64 1604      CP	R0,R20
    01E65 0615      CPC	R1,R21
    01E66 F408      BCC	0x1E68
    01E67 0160      MOVW	R12,R0
(2570) #if _FS_TINY
(2571) 		if (move_window(fp->fs, fp->dsect))	/* Move sector window */
    01E68 8DEB      LDD	R30,Y+27
    01E69 8DFC      LDD	R31,Y+28
    01E6A 8826      LDD	R2,Z+22
    01E6B 8837      LDD	R3,Z+23
    01E6C 8C40      LDD	R4,Z+24
    01E6D 8C51      LDD	R5,Z+25
    01E6E 8248      ST	Y,R4
    01E6F 8259      STD	Y+1,R5
    01E70 0191      MOVW	R18,R2
    01E71 8100      LD	R16,Z
    01E72 8111      LDD	R17,Z+1
    01E73 940E 0477 CALL	ff.c:move_window
    01E75 2EA0      MOV	R10,R16
    01E76 2300      TST	R16
    01E77 F051      BEQ	0x1E82
(2572) 			ABORT(fp->fs, FR_DISK_ERR);
    01E78 8D8B      LDD	R24,Y+27
    01E79 8D9C      LDD	R25,Y+28
    01E7A 9604      ADIW	R24,4
    01E7B 015C      MOVW	R10,R24
    01E7C 01FC      MOVW	R30,R24
    01E7D 8180      LD	R24,Z
    01E7E 6880      ORI	R24,0x80
    01E7F 8380      ST	Z,R24
    01E80 E001      LDI	R16,1
    01E81 C070      RJMP	0x1EF2
(2573) 		mem_cpy(&fp->fs->win[fp->fptr % SS(fp->fs)], wbuff, wcnt);	/* Fit partial sector */
    01E82 82D9      STD	Y+1,R13
    01E83 82C8      ST	Y,R12
    01E84 0197      MOVW	R18,R14
    01E85 EF4F      LDI	R20,0xFF
    01E86 E051      LDI	R21,1
    01E87 E060      LDI	R22,0
    01E88 E070      LDI	R23,0
    01E89 8DEB      LDD	R30,Y+27
    01E8A 8DFC      LDD	R31,Y+28
    01E8B 8026      LDD	R2,Z+6
    01E8C 8037      LDD	R3,Z+7
    01E8D 8440      LDD	R4,Z+8
    01E8E 8451      LDD	R5,Z+9
    01E8F 2224      AND	R2,R20
    01E90 2235      AND	R3,R21
    01E91 2246      AND	R4,R22
    01E92 2257      AND	R5,R23
    01E93 0181      MOVW	R16,R2
    01E94 8180      LD	R24,Z
    01E95 8191      LDD	R25,Z+1
    01E96 968E      ADIW	R24,0x2E
    01E97 0F08      ADD	R16,R24
    01E98 1F19      ADC	R17,R25
    01E99 940E 041E CALL	ff.c:mem_cpy
(2574) 		fp->fs->wflag = 1;
    01E9B E081      LDI	R24,1
    01E9C 8DEB      LDD	R30,Y+27
    01E9D 8DFC      LDD	R31,Y+28
    01E9E 93AF      PUSH	R26
    01E9F 93BF      PUSH	R27
    01EA0 81A0      LD	R26,Z
    01EA1 81B1      LDD	R27,Z+1
    01EA2 01FD      MOVW	R30,R26
    01EA3 91BF      POP	R27
    01EA4 91AF      POP	R26
    01EA5 8384      STD	Z+4,R24
    01EA6 0CEC      ADD	R14,R12
    01EA7 1CFD      ADC	R15,R13
    01EA8 8D8B      LDD	R24,Y+27
    01EA9 8D9C      LDD	R25,Y+28
    01EAA 9606      ADIW	R24,6
    01EAB 015C      MOVW	R10,R24
    01EAC 0116      MOVW	R2,R12
    01EAD 2444      CLR	R4
    01EAE 2455      CLR	R5
    01EAF 01FC      MOVW	R30,R24
    01EB0 8060      LD	R6,Z
    01EB1 8071      LDD	R7,Z+1
    01EB2 8082      LDD	R8,Z+2
    01EB3 8093      LDD	R9,Z+3
    01EB4 0C62      ADD	R6,R2
    01EB5 1C73      ADC	R7,R3
    01EB6 1C84      ADC	R8,R4
    01EB7 1C95      ADC	R9,R5
    01EB8 8260      ST	Z,R6
    01EB9 8271      STD	Z+1,R7
    01EBA 8282      STD	Z+2,R8
    01EBB 8293      STD	Z+3,R9
    01EBC A1E9      LDD	R30,Y+33
    01EBD A1FA      LDD	R31,Y+34
    01EBE 8020      LD	R2,Z
    01EBF 8031      LDD	R3,Z+1
    01EC0 0C2C      ADD	R2,R12
    01EC1 1C3D      ADC	R3,R13
    01EC2 8231      STD	Z+1,R3
    01EC3 8220      ST	Z,R2
    01EC4 8C0F      LDD	R0,Y+31
    01EC5 A018      LDD	R1,Y+32
    01EC6 180C      SUB	R0,R12
    01EC7 081D      SBC	R1,R13
    01EC8 A218      STD	Y+32,R1
    01EC9 8E0F      STD	Y+31,R0
    01ECA 8C0F      LDD	R0,Y+31
    01ECB A018      LDD	R1,Y+32
    01ECC 2000      TST	R0
    01ECD F009      BEQ	0x1ECF
    01ECE CD5B      RJMP	0x1C2A
    01ECF 2011      TST	R1
    01ED0 F009      BEQ	0x1ED2
    01ED1 CD58      RJMP	0x1C2A
(2575) #else
(2576) 		mem_cpy(&fp->buf[fp->fptr % SS(fp->fs)], wbuff, wcnt);	/* Fit partial sector */
(2577) 		fp->flag |= FA__DIRTY;
(2578) #endif
(2579) 	}
(2580) 
(2581) 	if (fp->fptr > fp->fsize) fp->fsize = fp->fptr;	/* Update file size if needed */
    01ED2 8DEB      LDD	R30,Y+27
    01ED3 8DFC      LDD	R31,Y+28
    01ED4 8422      LDD	R2,Z+10
    01ED5 8433      LDD	R3,Z+11
    01ED6 8444      LDD	R4,Z+12
    01ED7 8455      LDD	R5,Z+13
    01ED8 8066      LDD	R6,Z+6
    01ED9 8077      LDD	R7,Z+7
    01EDA 8480      LDD	R8,Z+8
    01EDB 8491      LDD	R9,Z+9
    01EDC 1426      CP	R2,R6
    01EDD 0437      CPC	R3,R7
    01EDE 0448      CPC	R4,R8
    01EDF 0459      CPC	R5,R9
    01EE0 F440      BCC	0x1EE9
    01EE1 8026      LDD	R2,Z+6
    01EE2 8037      LDD	R3,Z+7
    01EE3 8440      LDD	R4,Z+8
    01EE4 8451      LDD	R5,Z+9
    01EE5 8622      STD	Z+10,R2
    01EE6 8633      STD	Z+11,R3
    01EE7 8644      STD	Z+12,R4
    01EE8 8655      STD	Z+13,R5
(2582) 	fp->flag |= FA__WRITTEN;						/* Set file change flag */
    01EE9 8D8B      LDD	R24,Y+27
    01EEA 8D9C      LDD	R25,Y+28
    01EEB 9604      ADIW	R24,4
    01EEC 015C      MOVW	R10,R24
    01EED 01FC      MOVW	R30,R24
    01EEE 8180      LD	R24,Z
    01EEF 6280      ORI	R24,0x20
    01EF0 8380      ST	Z,R24
(2583) 
(2584) 	LEAVE_FF(fp->fs, FR_OK);
    01EF1 2700      CLR	R16
    01EF2 9661      ADIW	R28,0x11
    01EF3 940E 4AFC CALL	pop_xgsetF0FC
    01EF5 9624      ADIW	R28,4
    01EF6 9508      RET
_f_sync:
  tim                  --> Y,+2
  dir                  --> R22
  res                  --> R10
  fp                   --> R20
    01EF7 940E 4B42 CALL	push_xgsetF03C
    01EF9 01A8      MOVW	R20,R16
    01EFA 9726      SBIW	R28,6
(2585) }
(2586) 
(2587) 
(2588) 
(2589) 
(2590) /*-----------------------------------------------------------------------*/
(2591) /* Synchronize the File Object                                           */
(2592) /*-----------------------------------------------------------------------*/
(2593) 
(2594) FRESULT f_sync (
(2595) 	FIL *fp		/* Pointer to the file object */
(2596) )
(2597) {
(2598) 	FRESULT res;
(2599) 	DWORD tim;
(2600) 	BYTE *dir;
(2601) 
(2602) 
(2603) 	res = validate(fp->fs, fp->id);		/* Check validity of the object */
    01EFB 01FA      MOVW	R30,R20
    01EFC 8122      LDD	R18,Z+2
    01EFD 8133      LDD	R19,Z+3
    01EFE 8100      LD	R16,Z
    01EFF 8111      LDD	R17,Z+1
    01F00 D88E      RCALL	ff.c:validate
    01F01 2EA0      MOV	R10,R16
(2604) 	if (res == FR_OK) {
    01F02 2300      TST	R16
    01F03 F009      BEQ	0x1F05
    01F04 C09F      RJMP	0x1FA4
(2605) 		if (fp->flag & FA__WRITTEN) {	/* Has the file been written? */
    01F05 01FA      MOVW	R30,R20
    01F06 8024      LDD	R2,Z+4
    01F07 FE25      SBRS	R2,5
    01F08 C09B      RJMP	0x1FA4
(2606) #if !_FS_TINY	/* Write-back dirty buffer */
(2607) 			if (fp->flag & FA__DIRTY) {
(2608) 				if (disk_write(fp->fs->drv, fp->buf, fp->dsect, 1) != RES_OK)
(2609) 					LEAVE_FF(fp->fs, FR_DISK_ERR);
(2610) 				fp->flag &= ~FA__DIRTY;
(2611) 			}
(2612) #endif
(2613) 			/* Update the directory entry */
(2614) 			res = move_window(fp->fs, fp->dir_sect);
    01F09 8C22      LDD	R2,Z+26
    01F0A 8C33      LDD	R3,Z+27
    01F0B 8C44      LDD	R4,Z+28
    01F0C 8C55      LDD	R5,Z+29
    01F0D 8248      ST	Y,R4
    01F0E 8259      STD	Y+1,R5
    01F0F 0191      MOVW	R18,R2
    01F10 8100      LD	R16,Z
    01F11 8111      LDD	R17,Z+1
    01F12 940E 0477 CALL	ff.c:move_window
    01F14 2EA0      MOV	R10,R16
(2615) 			if (res == FR_OK) {
    01F15 2300      TST	R16
    01F16 F009      BEQ	0x1F18
    01F17 C08C      RJMP	0x1FA4
(2616) 				dir = fp->dir_ptr;
    01F18 01FA      MOVW	R30,R20
    01F19 8D66      LDD	R22,Z+30
    01F1A 8D77      LDD	R23,Z+31
(2617) 				dir[DIR_Attr] |= AM_ARC;					/* Set archive bit */
    01F1B 01CB      MOVW	R24,R22
    01F1C 960B      ADIW	R24,0xB
    01F1D 01FC      MOVW	R30,R24
    01F1E 8180      LD	R24,Z
    01F1F 6280      ORI	R24,0x20
    01F20 8380      ST	Z,R24
(2618) 				ST_DWORD(dir+DIR_FileSize, fp->fsize);		/* Update file size */
    01F21 01FA      MOVW	R30,R20
    01F22 8422      LDD	R2,Z+10
    01F23 8433      LDD	R3,Z+11
    01F24 8444      LDD	R4,Z+12
    01F25 8455      LDD	R5,Z+13
    01F26 01FB      MOVW	R30,R22
    01F27 8E24      STD	Z+28,R2
    01F28 01FA      MOVW	R30,R20
    01F29 8422      LDD	R2,Z+10
    01F2A 8433      LDD	R3,Z+11
    01F2B 2C23      MOV	R2,R3
    01F2C 2433      CLR	R3
    01F2D 01FB      MOVW	R30,R22
    01F2E 8E25      STD	Z+29,R2
    01F2F 01FA      MOVW	R30,R20
    01F30 8422      LDD	R2,Z+10
    01F31 8433      LDD	R3,Z+11
    01F32 8444      LDD	R4,Z+12
    01F33 8455      LDD	R5,Z+13
    01F34 0112      MOVW	R2,R4
    01F35 2444      CLR	R4
    01F36 2455      CLR	R5
    01F37 01FB      MOVW	R30,R22
    01F38 8E26      STD	Z+30,R2
    01F39 E188      LDI	R24,0x18
    01F3A E090      LDI	R25,0
    01F3B 01FA      MOVW	R30,R20
    01F3C 8502      LDD	R16,Z+10
    01F3D 8513      LDD	R17,Z+11
    01F3E 8524      LDD	R18,Z+12
    01F3F 8535      LDD	R19,Z+13
    01F40 938A      ST	-Y,R24
    01F41 940E 4BAB CALL	lsr32
    01F43 01FB      MOVW	R30,R22
    01F44 8F07      STD	Z+31,R16
(2619) 				ST_CLUST(dir, fp->sclust);					/* Update start cluster */
    01F45 01FA      MOVW	R30,R20
    01F46 8426      LDD	R2,Z+14
    01F47 8437      LDD	R3,Z+15
    01F48 8840      LDD	R4,Z+16
    01F49 8851      LDD	R5,Z+17
    01F4A 01FB      MOVW	R30,R22
    01F4B 8E22      STD	Z+26,R2
    01F4C 01FA      MOVW	R30,R20
    01F4D 8426      LDD	R2,Z+14
    01F4E 8437      LDD	R3,Z+15
    01F4F 2C23      MOV	R2,R3
    01F50 2433      CLR	R3
    01F51 01FB      MOVW	R30,R22
    01F52 8E23      STD	Z+27,R2
    01F53 01FA      MOVW	R30,R20
    01F54 8426      LDD	R2,Z+14
    01F55 8437      LDD	R3,Z+15
    01F56 8840      LDD	R4,Z+16
    01F57 8851      LDD	R5,Z+17
    01F58 0112      MOVW	R2,R4
    01F59 2444      CLR	R4
    01F5A 2455      CLR	R5
    01F5B 01FB      MOVW	R30,R22
    01F5C 8A24      STD	Z+20,R2
    01F5D 01FA      MOVW	R30,R20
    01F5E 8426      LDD	R2,Z+14
    01F5F 8437      LDD	R3,Z+15
    01F60 8840      LDD	R4,Z+16
    01F61 8851      LDD	R5,Z+17
    01F62 0112      MOVW	R2,R4
    01F63 2C23      MOV	R2,R3
    01F64 2433      CLR	R3
    01F65 01FB      MOVW	R30,R22
    01F66 8A25      STD	Z+21,R2
(2620) 				tim = get_fattime();						/* Update updated time */
    01F67 940E 0419 CALL	_get_fattime
    01F69 830A      STD	Y+2,R16
    01F6A 831B      STD	Y+3,R17
    01F6B 832C      STD	Y+4,R18
    01F6C 833D      STD	Y+5,R19
(2621) 				ST_DWORD(dir+DIR_WrtTime, tim);
    01F6D 802A      LDD	R2,Y+2
    01F6E 803B      LDD	R3,Y+3
    01F6F 804C      LDD	R4,Y+4
    01F70 805D      LDD	R5,Y+5
    01F71 01FB      MOVW	R30,R22
    01F72 8A26      STD	Z+22,R2
    01F73 2C23      MOV	R2,R3
    01F74 2433      CLR	R3
    01F75 9677      ADIW	R30,0x17
    01F76 8220      ST	Z,R2
    01F77 802A      LDD	R2,Y+2
    01F78 803B      LDD	R3,Y+3
    01F79 804C      LDD	R4,Y+4
    01F7A 805D      LDD	R5,Y+5
    01F7B 0112      MOVW	R2,R4
    01F7C 2444      CLR	R4
    01F7D 2455      CLR	R5
    01F7E 01FB      MOVW	R30,R22
    01F7F 9678      ADIW	R30,0x18
    01F80 8220      ST	Z,R2
    01F81 E188      LDI	R24,0x18
    01F82 E090      LDI	R25,0
    01F83 810A      LDD	R16,Y+2
    01F84 811B      LDD	R17,Y+3
    01F85 812C      LDD	R18,Y+4
    01F86 813D      LDD	R19,Y+5
    01F87 938A      ST	-Y,R24
    01F88 940E 4BAB CALL	lsr32
    01F8A 01FB      MOVW	R30,R22
    01F8B 8F01      STD	Z+25,R16
(2622) 				fp->flag &= ~FA__WRITTEN;
    01F8C 01BA      MOVW	R22,R20
    01F8D 5F6C      SUBI	R22,0xFC
    01F8E 4F7F      SBCI	R23,0xFF
    01F8F 01FB      MOVW	R30,R22
    01F90 8180      LD	R24,Z
    01F91 7D8F      ANDI	R24,0xDF
    01F92 8380      ST	Z,R24
(2623) 				fp->fs->wflag = 1;
    01F93 E081      LDI	R24,1
    01F94 01FA      MOVW	R30,R20
    01F95 93AF      PUSH	R26
    01F96 93BF      PUSH	R27
    01F97 81A0      LD	R26,Z
    01F98 81B1      LDD	R27,Z+1
    01F99 01FD      MOVW	R30,R26
    01F9A 91BF      POP	R27
    01F9B 91AF      POP	R26
    01F9C 8384      STD	Z+4,R24
(2624) 				res = sync(fp->fs);
    01F9D 01FA      MOVW	R30,R20
    01F9E 8100      LD	R16,Z
    01F9F 8111      LDD	R17,Z+1
    01FA0 940E 0519 CALL	ff.c:sync
    01FA2 2EC0      MOV	R12,R16
    01FA3 2CAC      MOV	R10,R12
(2625) 			}
(2626) 		}
(2627) 	}
(2628) 
(2629) 	LEAVE_FF(fp->fs, res);
    01FA4 2D0A      MOV	R16,R10
    01FA5 9626      ADIW	R28,6
    01FA6 940C 4B4B JMP	pop_xgsetF03C
_f_close:
  res                  --> R10
  fp                   --> R12
    01FA8 940E 4B0D CALL	push_xgset003C
    01FAA 0168      MOVW	R12,R16
(2630) }
(2631) 
(2632) #endif /* !_FS_READONLY */
(2633) 
(2634) 
(2635) 
(2636) 
(2637) /*-----------------------------------------------------------------------*/
(2638) /* Close File                                                            */
(2639) /*-----------------------------------------------------------------------*/
(2640) 
(2641) FRESULT f_close (
(2642) 	FIL *fp		/* Pointer to the file object to be closed */
(2643) )
(2644) {
(2645) 	FRESULT res;
(2646) 
(2647) #if _FS_READONLY
(2648) 	FATFS *fs = fp->fs;
(2649) 	res = validate(fs, fp->id);
(2650) 	if (res == FR_OK) fp->fs = 0;	/* Discard file object */
(2651) 	LEAVE_FF(fs, res);
(2652) 
(2653) #else
(2654) 	res = f_sync(fp);		/* Flush cached data */
    01FAB 0186      MOVW	R16,R12
    01FAC DF4A      RCALL	_f_sync
    01FAD 2EA0      MOV	R10,R16
(2655) #if _FS_SHARE
(2656) 	if (res == FR_OK) {		/* Decrement open counter */
(2657) #if _FS_REENTRANT
(2658) 		res = validate(fp->fs, fp->id);
(2659) 		if (res == FR_OK) {
(2660) 			res = dec_lock(fp->lockid);	
(2661) 			unlock_fs(fp->fs, FR_OK);
(2662) 		}
(2663) #else
(2664) 		res = dec_lock(fp->lockid);
(2665) #endif
(2666) 	}
(2667) #endif
(2668) 	if (res == FR_OK) fp->fs = 0;	/* Discard file object */
    01FAE 2300      TST	R16
    01FAF F429      BNE	0x1FB5
    01FB0 2422      CLR	R2
    01FB1 2433      CLR	R3
    01FB2 01F6      MOVW	R30,R12
    01FB3 8231      STD	Z+1,R3
    01FB4 8220      ST	Z,R2
(2669) 	return res;
    01FB5 2D0A      MOV	R16,R10
    01FB6 940C 4AE7 JMP	pop_xgset003C
_f_lseek:
  ifptr                --> Y,+14
  nsect                --> Y,+10
  bcs                  --> Y,+6
  clst                 --> Y,+2
  dsc                  --> Y,+26
  tlen                 --> Y,+22
  tbl                  --> R14
  tcl                  --> Y,+18
  ulen                 --> Y,+14
  ncl                  --> Y,+10
  pcl                  --> Y,+6
  cl                   --> Y,+2
  res                  --> R10
  ofs                  --> Y,+42
  fp                   --> Y,+40
    01FB8 940E 49C2 CALL	push_arg4
    01FBA 940E 4B07 CALL	push_xgsetF0FC
    01FBC 976E      SBIW	R28,0x1E
(2670) #endif
(2671) }
(2672) 
(2673) 
(2674) 
(2675) 
(2676) /*-----------------------------------------------------------------------*/
(2677) /* Current Drive/Directory Handlings                                     */
(2678) /*-----------------------------------------------------------------------*/
(2679) 
(2680) #if _FS_RPATH >= 1
(2681) 
(2682) FRESULT f_chdrive (
(2683) 	BYTE drv		/* Drive number */
(2684) )
(2685) {
(2686) 	if (drv >= _VOLUMES) return FR_INVALID_DRIVE;
(2687) 
(2688) 	CurrVol = drv;
(2689) 
(2690) 	return FR_OK;
(2691) }
(2692) 
(2693) 
(2694) 
(2695) FRESULT f_chdir (
(2696) 	const TCHAR *path	/* Pointer to the directory path */
(2697) )
(2698) {
(2699) 	FRESULT res;
(2700) 	DIR dj;
(2701) 	DEF_NAMEBUF;
(2702) 
(2703) 
(2704) 	res = chk_mounted(&path, &dj.fs, 0);
(2705) 	if (res == FR_OK) {
(2706) 		INIT_BUF(dj);
(2707) 		res = follow_path(&dj, path);		/* Follow the path */
(2708) 		FREE_BUF();
(2709) 		if (res == FR_OK) {					/* Follow completed */
(2710) 			if (!dj.dir) {
(2711) 				dj.fs->cdir = dj.sclust;	/* Start directory itself */
(2712) 			} else {
(2713) 				if (dj.dir[DIR_Attr] & AM_DIR)	/* Reached to the directory */
(2714) 					dj.fs->cdir = LD_CLUST(dj.dir);
(2715) 				else
(2716) 					res = FR_NO_PATH;		/* Reached but a file */
(2717) 			}
(2718) 		}
(2719) 		if (res == FR_NO_FILE) res = FR_NO_PATH;
(2720) 	}
(2721) 
(2722) 	LEAVE_FF(dj.fs, res);
(2723) }
(2724) 
(2725) 
(2726) #if _FS_RPATH >= 2
(2727) FRESULT f_getcwd (
(2728) 	TCHAR *path,	/* Pointer to the directory path */
(2729) 	UINT sz_path	/* Size of path */
(2730) )
(2731) {
(2732) 	FRESULT res;
(2733) 	DIR dj;
(2734) 	UINT i, n;
(2735) 	DWORD ccl;
(2736) 	TCHAR *tp;
(2737) 	FILINFO fno;
(2738) 	DEF_NAMEBUF;
(2739) 
(2740) 
(2741) 	*path = 0;
(2742) 	res = chk_mounted((const TCHAR**)&path, &dj.fs, 0);	/* Get current volume */
(2743) 	if (res == FR_OK) {
(2744) 		INIT_BUF(dj);
(2745) 		i = sz_path;		/* Bottom of buffer (dir stack base) */
(2746) 		dj.sclust = dj.fs->cdir;			/* Start to follow upper dir from current dir */
(2747) 		while ((ccl = dj.sclust) != 0) {	/* Repeat while current dir is a sub-dir */
(2748) 			res = dir_sdi(&dj, 1);			/* Get parent dir */
(2749) 			if (res != FR_OK) break;
(2750) 			res = dir_read(&dj);
(2751) 			if (res != FR_OK) break;
(2752) 			dj.sclust = LD_CLUST(dj.dir);	/* Goto parent dir */
(2753) 			res = dir_sdi(&dj, 0);
(2754) 			if (res != FR_OK) break;
(2755) 			do {							/* Find the entry links to the child dir */
(2756) 				res = dir_read(&dj);
(2757) 				if (res != FR_OK) break;
(2758) 				if (ccl == LD_CLUST(dj.dir)) break;	/* Found the entry */
(2759) 				res = dir_next(&dj, 0);	
(2760) 			} while (res == FR_OK);
(2761) 			if (res == FR_NO_FILE) res = FR_INT_ERR;/* It cannot be 'not found'. */
(2762) 			if (res != FR_OK) break;
(2763) #if _USE_LFN
(2764) 			fno.lfname = path;
(2765) 			fno.lfsize = i;
(2766) #endif
(2767) 			get_fileinfo(&dj, &fno);		/* Get the dir name and push it to the buffer */
(2768) 			tp = fno.fname;
(2769) 			if (_USE_LFN && *path) tp = path;
(2770) 			for (n = 0; tp[n]; n++) ;
(2771) 			if (i < n + 3) {
(2772) 				res = FR_NOT_ENOUGH_CORE; break;
(2773) 			}
(2774) 			while (n) path[--i] = tp[--n];
(2775) 			path[--i] = '/';
(2776) 		}
(2777) 		tp = path;
(2778) 		if (res == FR_OK) {
(2779) 			*tp++ = '0' + CurrVol;			/* Put drive number */
(2780) 			*tp++ = ':';
(2781) 			if (i == sz_path) {				/* Root-dir */
(2782) 				*tp++ = '/';
(2783) 			} else {						/* Sub-dir */
(2784) 				do		/* Add stacked path str */
(2785) 					*tp++ = path[i++];
(2786) 				while (i < sz_path);
(2787) 			}
(2788) 		}
(2789) 		*tp = 0;
(2790) 		FREE_BUF();
(2791) 	}
(2792) 
(2793) 	LEAVE_FF(dj.fs, res);
(2794) }
(2795) #endif /* _FS_RPATH >= 2 */
(2796) #endif /* _FS_RPATH >= 1 */
(2797) 
(2798) 
(2799) 
(2800) #if _FS_MINIMIZE <= 2
(2801) /*-----------------------------------------------------------------------*/
(2802) /* Seek File R/W Pointer                                                 */
(2803) /*-----------------------------------------------------------------------*/
(2804) 
(2805) FRESULT f_lseek (
(2806) 	FIL *fp,		/* Pointer to the file object */
(2807) 	DWORD ofs		/* File pointer from top of file */
(2808) )
(2809) {
(2810) 	FRESULT res;
(2811) 
(2812) 
(2813) 	res = validate(fp->fs, fp->id);		/* Check validity of the object */
    01FBD A5E8      LDD	R30,Y+40
    01FBE A5F9      LDD	R31,Y+41
    01FBF 8122      LDD	R18,Z+2
    01FC0 8133      LDD	R19,Z+3
    01FC1 8100      LD	R16,Z
    01FC2 8111      LDD	R17,Z+1
    01FC3 940E 178F CALL	ff.c:validate
    01FC5 2EA0      MOV	R10,R16
(2814) 	if (res != FR_OK) LEAVE_FF(fp->fs, res);
    01FC6 2300      TST	R16
    01FC7 F009      BEQ	0x1FC9
    01FC8 C4A7      RJMP	0x2470
(2815) 	if (fp->flag & FA__ERROR)			/* Check abort flag */
    01FC9 A5E8      LDD	R30,Y+40
    01FCA A5F9      LDD	R31,Y+41
    01FCB 8024      LDD	R2,Z+4
    01FCC FE27      SBRS	R2,7
    01FCD C002      RJMP	0x1FD0
(2816) 		LEAVE_FF(fp->fs, FR_INT_ERR);
    01FCE E002      LDI	R16,2
    01FCF C4A0      RJMP	0x2470
(2817) 
(2818) #if _USE_FASTSEEK
(2819) 	if (fp->cltbl) {	/* Fast seek */
    01FD0 A5E8      LDD	R30,Y+40
    01FD1 A5F9      LDD	R31,Y+41
    01FD2 96B0      ADIW	R30,0x20
    01FD3 8020      LD	R2,Z
    01FD4 8031      LDD	R3,Z+1
    01FD5 2022      TST	R2
    01FD6 F419      BNE	0x1FDA
    01FD7 2033      TST	R3
    01FD8 F409      BNE	0x1FDA
    01FD9 C1E3      RJMP	0x21BD
(2820) 		DWORD cl, pcl, ncl, tcl, dsc, tlen, ulen, *tbl;
(2821) 
(2822) 		if (ofs == CREATE_LINKMAP) {	/* Create CLMT */
    01FDA EF4F      LDI	R20,0xFF
    01FDB EF5F      LDI	R21,0xFF
    01FDC EF6F      LDI	R22,0xFF
    01FDD EF7F      LDI	R23,0xFF
    01FDE A42A      LDD	R2,Y+42
    01FDF A43B      LDD	R3,Y+43
    01FE0 A44C      LDD	R4,Y+44
    01FE1 A45D      LDD	R5,Y+45
    01FE2 1624      CP	R2,R20
    01FE3 0635      CPC	R3,R21
    01FE4 0646      CPC	R4,R22
    01FE5 0657      CPC	R5,R23
    01FE6 F009      BEQ	0x1FE8
    01FE7 C109      RJMP	0x20F1
(2823) 			tbl = fp->cltbl;
    01FE8 A5E8      LDD	R30,Y+40
    01FE9 A5F9      LDD	R31,Y+41
    01FEA A0E0      LDD	R14,Z+32
    01FEB A0F1      LDD	R15,Z+33
(2824) 			tlen = *tbl++; ulen = 2;	/* Given table size and required table size */
    01FEC 01F7      MOVW	R30,R14
    01FED 9021      LD	R2,Z+
    01FEE 9031      LD	R3,Z+
    01FEF 9041      LD	R4,Z+
    01FF0 9051      LD	R5,Z+
    01FF1 017F      MOVW	R14,R30
    01FF2 8A2E      STD	Y+22,R2
    01FF3 8A3F      STD	Y+23,R3
    01FF4 8E48      STD	Y+24,R4
    01FF5 8E59      STD	Y+25,R5
    01FF6 E082      LDI	R24,2
    01FF7 878E      STD	Y+14,R24
    01FF8 E080      LDI	R24,0
    01FF9 878F      STD	Y+15,R24
    01FFA 8B88      STD	Y+16,R24
    01FFB 8B89      STD	Y+17,R24
(2825) 			cl = fp->sclust;			/* Top of the chain */
    01FFC A5E8      LDD	R30,Y+40
    01FFD A5F9      LDD	R31,Y+41
    01FFE 963E      ADIW	R30,0xE
    01FFF 8020      LD	R2,Z
    02000 8031      LDD	R3,Z+1
    02001 8042      LDD	R4,Z+2
    02002 8053      LDD	R5,Z+3
    02003 822A      STD	Y+2,R2
    02004 823B      STD	Y+3,R3
    02005 824C      STD	Y+4,R4
    02006 825D      STD	Y+5,R5
(2826) 			if (cl) {
    02007 802A      LDD	R2,Y+2
    02008 803B      LDD	R3,Y+3
    02009 804C      LDD	R4,Y+4
    0200A 805D      LDD	R5,Y+5
    0200B 9488      BCLR	0
    0200C 2022      TST	R2
    0200D 0432      CPC	R3,R2
    0200E 0442      CPC	R4,R2
    0200F 0452      CPC	R5,R2
    02010 F409      BNE	0x2012
    02011 C0BB      RJMP	0x20CD
(2827) 				do {
(2828) 					/* Get a fragment */
(2829) 					tcl = cl; ncl = 0; ulen += 2;	/* Top, length and used items */
    02012 802A      LDD	R2,Y+2
    02013 803B      LDD	R3,Y+3
    02014 804C      LDD	R4,Y+4
    02015 805D      LDD	R5,Y+5
    02016 8A2A      STD	Y+18,R2
    02017 8A3B      STD	Y+19,R3
    02018 8A4C      STD	Y+20,R4
    02019 8A5D      STD	Y+21,R5
    0201A E080      LDI	R24,0
    0201B 878A      STD	Y+10,R24
    0201C 878B      STD	Y+11,R24
    0201D 878C      STD	Y+12,R24
    0201E 878D      STD	Y+13,R24
    0201F E042      LDI	R20,2
    02020 E050      LDI	R21,0
    02021 E060      LDI	R22,0
    02022 E070      LDI	R23,0
    02023 842E      LDD	R2,Y+14
    02024 843F      LDD	R3,Y+15
    02025 8848      LDD	R4,Y+16
    02026 8859      LDD	R5,Y+17
    02027 0E24      ADD	R2,R20
    02028 1E35      ADC	R3,R21
    02029 1E46      ADC	R4,R22
    0202A 1E57      ADC	R5,R23
    0202B 862E      STD	Y+14,R2
    0202C 863F      STD	Y+15,R3
    0202D 8A48      STD	Y+16,R4
    0202E 8A59      STD	Y+17,R5
(2830) 					do {
(2831) 						pcl = cl; ncl++;
    0202F 802A      LDD	R2,Y+2
    02030 803B      LDD	R3,Y+3
    02031 804C      LDD	R4,Y+4
    02032 805D      LDD	R5,Y+5
    02033 822E      STD	Y+6,R2
    02034 823F      STD	Y+7,R3
    02035 8648      STD	Y+8,R4
    02036 8659      STD	Y+9,R5
    02037 E041      LDI	R20,1
    02038 E050      LDI	R21,0
    02039 E060      LDI	R22,0
    0203A E070      LDI	R23,0
    0203B 842A      LDD	R2,Y+10
    0203C 843B      LDD	R3,Y+11
    0203D 844C      LDD	R4,Y+12
    0203E 845D      LDD	R5,Y+13
    0203F 0E24      ADD	R2,R20
    02040 1E35      ADC	R3,R21
    02041 1E46      ADC	R4,R22
    02042 1E57      ADC	R5,R23
    02043 862A      STD	Y+10,R2
    02044 863B      STD	Y+11,R3
    02045 864C      STD	Y+12,R4
    02046 865D      STD	Y+13,R5
(2832) 						cl = get_fat(fp->fs, cl);
    02047 802A      LDD	R2,Y+2
    02048 803B      LDD	R3,Y+3
    02049 804C      LDD	R4,Y+4
    0204A 805D      LDD	R5,Y+5
    0204B 8248      ST	Y,R4
    0204C 8259      STD	Y+1,R5
    0204D 0191      MOVW	R18,R2
    0204E A5E8      LDD	R30,Y+40
    0204F A5F9      LDD	R31,Y+41
    02050 8100      LD	R16,Z
    02051 8111      LDD	R17,Z+1
    02052 940E 0640 CALL	_get_fat
    02054 830A      STD	Y+2,R16
    02055 831B      STD	Y+3,R17
    02056 832C      STD	Y+4,R18
    02057 833D      STD	Y+5,R19
(2833) 						if (cl <= 1) ABORT(fp->fs, FR_INT_ERR);
    02058 E041      LDI	R20,1
    02059 E050      LDI	R21,0
    0205A E060      LDI	R22,0
    0205B E070      LDI	R23,0
    0205C 802A      LDD	R2,Y+2
    0205D 803B      LDD	R3,Y+3
    0205E 804C      LDD	R4,Y+4
    0205F 805D      LDD	R5,Y+5
    02060 1542      CP	R20,R2
    02061 0553      CPC	R21,R3
    02062 0564      CPC	R22,R4
    02063 0575      CPC	R23,R5
    02064 F048      BCS	0x206E
    02065 A588      LDD	R24,Y+40
    02066 A599      LDD	R25,Y+41
    02067 9604      ADIW	R24,4
    02068 01FC      MOVW	R30,R24
    02069 8180      LD	R24,Z
    0206A 6880      ORI	R24,0x80
    0206B 8380      ST	Z,R24
    0206C E002      LDI	R16,2
    0206D C402      RJMP	0x2470
(2834) 						if (cl == 0xFFFFFFFF) ABORT(fp->fs, FR_DISK_ERR);
    0206E EF4F      LDI	R20,0xFF
    0206F EF5F      LDI	R21,0xFF
    02070 EF6F      LDI	R22,0xFF
    02071 EF7F      LDI	R23,0xFF
    02072 802A      LDD	R2,Y+2
    02073 803B      LDD	R3,Y+3
    02074 804C      LDD	R4,Y+4
    02075 805D      LDD	R5,Y+5
    02076 1624      CP	R2,R20
    02077 0635      CPC	R3,R21
    02078 0646      CPC	R4,R22
    02079 0657      CPC	R5,R23
    0207A F451      BNE	0x2085
    0207B A588      LDD	R24,Y+40
    0207C A599      LDD	R25,Y+41
    0207D 9604      ADIW	R24,4
    0207E 016C      MOVW	R12,R24
    0207F 01FC      MOVW	R30,R24
    02080 8180      LD	R24,Z
    02081 6880      ORI	R24,0x80
    02082 8380      ST	Z,R24
    02083 E001      LDI	R16,1
    02084 C3EB      RJMP	0x2470
(2835) 					} while (cl == pcl + 1);
    02085 E041      LDI	R20,1
    02086 E050      LDI	R21,0
    02087 E060      LDI	R22,0
    02088 E070      LDI	R23,0
    02089 802E      LDD	R2,Y+6
    0208A 803F      LDD	R3,Y+7
    0208B 8448      LDD	R4,Y+8
    0208C 8459      LDD	R5,Y+9
    0208D 0E24      ADD	R2,R20
    0208E 1E35      ADC	R3,R21
    0208F 1E46      ADC	R4,R22
    02090 1E57      ADC	R5,R23
    02091 806A      LDD	R6,Y+2
    02092 807B      LDD	R7,Y+3
    02093 808C      LDD	R8,Y+4
    02094 809D      LDD	R9,Y+5
    02095 1462      CP	R6,R2
    02096 0473      CPC	R7,R3
    02097 0484      CPC	R8,R4
    02098 0495      CPC	R9,R5
    02099 F409      BNE	0x209B
    0209A CF94      RJMP	0x202F
(2836) 					if (ulen <= tlen) {		/* Store the length and top of the fragment */
    0209B 882E      LDD	R2,Y+22
    0209C 883F      LDD	R3,Y+23
    0209D 8C48      LDD	R4,Y+24
    0209E 8C59      LDD	R5,Y+25
    0209F 846E      LDD	R6,Y+14
    020A0 847F      LDD	R7,Y+15
    020A1 8888      LDD	R8,Y+16
    020A2 8899      LDD	R9,Y+17
    020A3 1426      CP	R2,R6
    020A4 0437      CPC	R3,R7
    020A5 0448      CPC	R4,R8
    020A6 0459      CPC	R5,R9
    020A7 F090      BCS	0x20BA
(2837) 						*tbl++ = ncl; *tbl++ = tcl;
    020A8 842A      LDD	R2,Y+10
    020A9 843B      LDD	R3,Y+11
    020AA 844C      LDD	R4,Y+12
    020AB 845D      LDD	R5,Y+13
    020AC 01F7      MOVW	R30,R14
    020AD 9221      ST	Z+,R2
    020AE 9231      ST	Z+,R3
    020AF 9241      ST	Z+,R4
    020B0 9251      ST	Z+,R5
    020B1 882A      LDD	R2,Y+18
    020B2 883B      LDD	R3,Y+19
    020B3 884C      LDD	R4,Y+20
    020B4 885D      LDD	R5,Y+21
    020B5 9221      ST	Z+,R2
    020B6 9231      ST	Z+,R3
    020B7 9241      ST	Z+,R4
    020B8 9251      ST	Z+,R5
    020B9 017F      MOVW	R14,R30
(2838) 					}
(2839) 				} while (cl < fp->fs->n_fatent);	/* Repeat until end of chain */
    020BA A5E8      LDD	R30,Y+40
    020BB A5F9      LDD	R31,Y+41
    020BC 81A0      LD	R26,Z
    020BD 81B1      LDD	R27,Z+1
    020BE 9656      ADIW	R26,0x16
    020BF 902D      LD	R2,X+
    020C0 903D      LD	R3,X+
    020C1 904D      LD	R4,X+
    020C2 905C      LD	R5,X
    020C3 806A      LDD	R6,Y+2
    020C4 807B      LDD	R7,Y+3
    020C5 808C      LDD	R8,Y+4
    020C6 809D      LDD	R9,Y+5
    020C7 1462      CP	R6,R2
    020C8 0473      CPC	R7,R3
    020C9 0484      CPC	R8,R4
    020CA 0495      CPC	R9,R5
    020CB F408      BCC	0x20CD
    020CC CF45      RJMP	0x2012
(2840) 			}
(2841) 			*fp->cltbl = ulen;	/* Number of items used */
    020CD 842E      LDD	R2,Y+14
    020CE 843F      LDD	R3,Y+15
    020CF 8848      LDD	R4,Y+16
    020D0 8859      LDD	R5,Y+17
    020D1 A5E8      LDD	R30,Y+40
    020D2 A5F9      LDD	R31,Y+41
    020D3 96B0      ADIW	R30,0x20
    020D4 81A0      LD	R26,Z
    020D5 81B1      LDD	R27,Z+1
    020D6 922D      ST	X+,R2
    020D7 923D      ST	X+,R3
    020D8 924D      ST	X+,R4
    020D9 925C      ST	X,R5
(2842) 			if (ulen <= tlen)
    020DA 882E      LDD	R2,Y+22
    020DB 883F      LDD	R3,Y+23
    020DC 8C48      LDD	R4,Y+24
    020DD 8C59      LDD	R5,Y+25
    020DE 846E      LDD	R6,Y+14
    020DF 847F      LDD	R7,Y+15
    020E0 8888      LDD	R8,Y+16
    020E1 8899      LDD	R9,Y+17
    020E2 1426      CP	R2,R6
    020E3 0437      CPC	R3,R7
    020E4 0448      CPC	R4,R8
    020E5 0459      CPC	R5,R9
    020E6 F038      BCS	0x20EE
(2843) 				*tbl = 0;		/* Terminate table */
    020E7 01F7      MOVW	R30,R14
    020E8 E080      LDI	R24,0
    020E9 8380      ST	Z,R24
    020EA 8381      STD	Z+1,R24
    020EB 8382      STD	Z+2,R24
    020EC 8383      STD	Z+3,R24
    020ED C381      RJMP	0x246F
(2844) 			else
(2845) 				res = FR_NOT_ENOUGH_CORE;	/* Given table size is smaller than required */
    020EE E181      LDI	R24,0x11
    020EF 2EA8      MOV	R10,R24
(2846) 
(2847) 		} else {						/* Fast seek */
    020F0 C37E      RJMP	0x246F
(2848) 			if (ofs > fp->fsize)		/* Clip offset at the file size */
    020F1 A5E8      LDD	R30,Y+40
    020F2 A5F9      LDD	R31,Y+41
    020F3 963A      ADIW	R30,0xA
    020F4 8020      LD	R2,Z
    020F5 8031      LDD	R3,Z+1
    020F6 8042      LDD	R4,Z+2
    020F7 8053      LDD	R5,Z+3
    020F8 A46A      LDD	R6,Y+42
    020F9 A47B      LDD	R7,Y+43
    020FA A48C      LDD	R8,Y+44
    020FB A49D      LDD	R9,Y+45
    020FC 1426      CP	R2,R6
    020FD 0437      CPC	R3,R7
    020FE 0448      CPC	R4,R8
    020FF 0459      CPC	R5,R9
    02100 F458      BCC	0x210C
(2849) 				ofs = fp->fsize;
    02101 A5E8      LDD	R30,Y+40
    02102 A5F9      LDD	R31,Y+41
    02103 963A      ADIW	R30,0xA
    02104 8020      LD	R2,Z
    02105 8031      LDD	R3,Z+1
    02106 8042      LDD	R4,Z+2
    02107 8053      LDD	R5,Z+3
    02108 A62A      STD	Y+42,R2
    02109 A63B      STD	Y+43,R3
    0210A A64C      STD	Y+44,R4
    0210B A65D      STD	Y+45,R5
(2850) 			fp->fptr = ofs;				/* Set file pointer */
    0210C A42A      LDD	R2,Y+42
    0210D A43B      LDD	R3,Y+43
    0210E A44C      LDD	R4,Y+44
    0210F A45D      LDD	R5,Y+45
    02110 A5E8      LDD	R30,Y+40
    02111 A5F9      LDD	R31,Y+41
    02112 9636      ADIW	R30,6
    02113 8220      ST	Z,R2
    02114 8231      STD	Z+1,R3
    02115 8242      STD	Z+2,R4
    02116 8253      STD	Z+3,R5
(2851) 			if (ofs) {
    02117 9488      BCLR	0
    02118 2022      TST	R2
    02119 0432      CPC	R3,R2
    0211A 0442      CPC	R4,R2
    0211B 0452      CPC	R5,R2
    0211C F409      BNE	0x211E
    0211D C351      RJMP	0x246F
(2852) 				fp->clust = clmt_clust(fp, ofs - 1);
    0211E E041      LDI	R20,1
    0211F E050      LDI	R21,0
    02120 E060      LDI	R22,0
    02121 E070      LDI	R23,0
    02122 1A24      SUB	R2,R20
    02123 0A35      SBC	R3,R21
    02124 0A46      SBC	R4,R22
    02125 0A57      SBC	R5,R23
    02126 8248      ST	Y,R4
    02127 8259      STD	Y+1,R5
    02128 0191      MOVW	R18,R2
    02129 A508      LDD	R16,Y+40
    0212A A519      LDD	R17,Y+41
    0212B 940E 0B7A CALL	ff.c:clmt_clust
    0212D A5E8      LDD	R30,Y+40
    0212E A5F9      LDD	R31,Y+41
    0212F 8B02      STD	Z+18,R16
    02130 8B13      STD	Z+19,R17
    02131 8B24      STD	Z+20,R18
    02132 8B35      STD	Z+21,R19
(2853) 				dsc = clust2sect(fp->fs, fp->clust);
    02133 8822      LDD	R2,Z+18
    02134 8833      LDD	R3,Z+19
    02135 8844      LDD	R4,Z+20
    02136 8855      LDD	R5,Z+21
    02137 8248      ST	Y,R4
    02138 8259      STD	Y+1,R5
    02139 0191      MOVW	R18,R2
    0213A 8100      LD	R16,Z
    0213B 8111      LDD	R17,Z+1
    0213C 940E 05EE CALL	_clust2sect
    0213E 8F0A      STD	Y+26,R16
    0213F 8F1B      STD	Y+27,R17
    02140 8F2C      STD	Y+28,R18
    02141 8F3D      STD	Y+29,R19
(2854) 				if (!dsc) ABORT(fp->fs, FR_INT_ERR);
    02142 8C2A      LDD	R2,Y+26
    02143 8C3B      LDD	R3,Y+27
    02144 8C4C      LDD	R4,Y+28
    02145 8C5D      LDD	R5,Y+29
    02146 9488      BCLR	0
    02147 2022      TST	R2
    02148 0432      CPC	R3,R2
    02149 0442      CPC	R4,R2
    0214A 0452      CPC	R5,R2
    0214B F451      BNE	0x2156
    0214C A588      LDD	R24,Y+40
    0214D A599      LDD	R25,Y+41
    0214E 9604      ADIW	R24,4
    0214F 017C      MOVW	R14,R24
    02150 01FC      MOVW	R30,R24
    02151 8180      LD	R24,Z
    02152 6880      ORI	R24,0x80
    02153 8380      ST	Z,R24
    02154 E002      LDI	R16,2
    02155 C31A      RJMP	0x2470
(2855) 				dsc += (ofs - 1) / SS(fp->fs) & (fp->fs->csize - 1);
    02156 E041      LDI	R20,1
    02157 E050      LDI	R21,0
    02158 E060      LDI	R22,0
    02159 E070      LDI	R23,0
    0215A A50A      LDD	R16,Y+42
    0215B A51B      LDD	R17,Y+43
    0215C A52C      LDD	R18,Y+44
    0215D A53D      LDD	R19,Y+45
    0215E 1B04      SUB	R16,R20
    0215F 0B15      SBC	R17,R21
    02160 0B26      SBC	R18,R22
    02161 0B37      SBC	R19,R23
    02162 E089      LDI	R24,0x9
    02163 E090      LDI	R25,0
    02164 938A      ST	-Y,R24
    02165 940E 4BAB CALL	lsr32
    02167 0118      MOVW	R2,R16
    02168 0129      MOVW	R4,R18
    02169 A5E8      LDD	R30,Y+40
    0216A A5F9      LDD	R31,Y+41
    0216B 93AF      PUSH	R26
    0216C 93BF      PUSH	R27
    0216D 81A0      LD	R26,Z
    0216E 81B1      LDD	R27,Z+1
    0216F 01FD      MOVW	R30,R26
    02170 91BF      POP	R27
    02171 91AF      POP	R26
    02172 9632      ADIW	R30,2
    02173 8180      LD	R24,Z
    02174 2799      CLR	R25
    02175 9701      SBIW	R24,1
    02176 013C      MOVW	R6,R24
    02177 2488      CLR	R8
    02178 FC77      SBRC	R7,7
    02179 9480      COM	R8
    0217A 2499      CLR	R9
    0217B FC87      SBRC	R8,7
    0217C 9490      COM	R9
    0217D 2026      AND	R2,R6
    0217E 2037      AND	R3,R7
    0217F 2048      AND	R4,R8
    02180 2059      AND	R5,R9
    02181 8C6A      LDD	R6,Y+26
    02182 8C7B      LDD	R7,Y+27
    02183 8C8C      LDD	R8,Y+28
    02184 8C9D      LDD	R9,Y+29
    02185 0C62      ADD	R6,R2
    02186 1C73      ADC	R7,R3
    02187 1C84      ADC	R8,R4
    02188 1C95      ADC	R9,R5
    02189 8E6A      STD	Y+26,R6
    0218A 8E7B      STD	Y+27,R7
    0218B 8E8C      STD	Y+28,R8
    0218C 8E9D      STD	Y+29,R9
(2856) 				if (fp->fptr % SS(fp->fs) && dsc != fp->dsect) {	/* Refill sector cache if needed */
    0218D EF4F      LDI	R20,0xFF
    0218E E051      LDI	R21,1
    0218F E060      LDI	R22,0
    02190 E070      LDI	R23,0
    02191 A5E8      LDD	R30,Y+40
    02192 A5F9      LDD	R31,Y+41
    02193 9636      ADIW	R30,6
    02194 8020      LD	R2,Z
    02195 8031      LDD	R3,Z+1
    02196 8042      LDD	R4,Z+2
    02197 8053      LDD	R5,Z+3
    02198 2224      AND	R2,R20
    02199 2235      AND	R3,R21
    0219A 2246      AND	R4,R22
    0219B 2257      AND	R5,R23
    0219C 9488      BCLR	0
    0219D 2022      TST	R2
    0219E 0432      CPC	R3,R2
    0219F 0442      CPC	R4,R2
    021A0 0452      CPC	R5,R2
    021A1 F409      BNE	0x21A3
    021A2 C2CC      RJMP	0x246F
    021A3 A5E8      LDD	R30,Y+40
    021A4 A5F9      LDD	R31,Y+41
    021A5 9676      ADIW	R30,0x16
    021A6 8020      LD	R2,Z
    021A7 8031      LDD	R3,Z+1
    021A8 8042      LDD	R4,Z+2
    021A9 8053      LDD	R5,Z+3
    021AA 8C6A      LDD	R6,Y+26
    021AB 8C7B      LDD	R7,Y+27
    021AC 8C8C      LDD	R8,Y+28
    021AD 8C9D      LDD	R9,Y+29
    021AE 1462      CP	R6,R2
    021AF 0473      CPC	R7,R3
    021B0 0484      CPC	R8,R4
    021B1 0495      CPC	R9,R5
    021B2 F409      BNE	0x21B4
    021B3 C2BB      RJMP	0x246F
(2857) #if !_FS_TINY
(2858) #if !_FS_READONLY
(2859) 					if (fp->flag & FA__DIRTY) {		/* Write-back dirty sector cache */
(2860) 						if (disk_write(fp->fs->drv, fp->buf, fp->dsect, 1) != RES_OK)
(2861) 							ABORT(fp->fs, FR_DISK_ERR);
(2862) 						fp->flag &= ~FA__DIRTY;
(2863) 					}
(2864) #endif
(2865) 					if (disk_read(fp->fs->drv, fp->buf, dsc, 1) != RES_OK)	/* Load current sector */
(2866) 						ABORT(fp->fs, FR_DISK_ERR);
(2867) #endif
(2868) 					fp->dsect = dsc;
    021B4 0113      MOVW	R2,R6
    021B5 0124      MOVW	R4,R8
    021B6 A5E8      LDD	R30,Y+40
    021B7 A5F9      LDD	R31,Y+41
    021B8 8A26      STD	Z+22,R2
    021B9 8A37      STD	Z+23,R3
    021BA 8E40      STD	Z+24,R4
    021BB 8E51      STD	Z+25,R5
(2869) 				}
(2870) 			}
(2871) 		}
(2872) 	} else
    021BC C2B2      RJMP	0x246F
(2873) #endif
(2874) 
(2875) 	/* Normal Seek */
(2876) 	{
(2877) 		DWORD clst, bcs, nsect, ifptr;
(2878) 
(2879) 		if (ofs > fp->fsize					/* In read-only mode, clip offset with the file size */
    021BD A5E8      LDD	R30,Y+40
    021BE A5F9      LDD	R31,Y+41
    021BF 963A      ADIW	R30,0xA
    021C0 8020      LD	R2,Z
    021C1 8031      LDD	R3,Z+1
    021C2 8042      LDD	R4,Z+2
    021C3 8053      LDD	R5,Z+3
    021C4 A46A      LDD	R6,Y+42
    021C5 A47B      LDD	R7,Y+43
    021C6 A48C      LDD	R8,Y+44
    021C7 A49D      LDD	R9,Y+45
    021C8 1426      CP	R2,R6
    021C9 0437      CPC	R3,R7
    021CA 0448      CPC	R4,R8
    021CB 0459      CPC	R5,R9
    021CC F470      BCC	0x21DB
    021CD A5E8      LDD	R30,Y+40
    021CE A5F9      LDD	R31,Y+41
    021CF 8024      LDD	R2,Z+4
    021D0 FC21      SBRC	R2,1
    021D1 C009      RJMP	0x21DB
(2880) #if !_FS_READONLY
(2881) 			 && !(fp->flag & FA_WRITE)
(2882) #endif
(2883) 			) ofs = fp->fsize;
    021D2 963A      ADIW	R30,0xA
    021D3 8020      LD	R2,Z
    021D4 8031      LDD	R3,Z+1
    021D5 8042      LDD	R4,Z+2
    021D6 8053      LDD	R5,Z+3
    021D7 A62A      STD	Y+42,R2
    021D8 A63B      STD	Y+43,R3
    021D9 A64C      STD	Y+44,R4
    021DA A65D      STD	Y+45,R5
(2884) 
(2885) 		ifptr = fp->fptr;
    021DB A5E8      LDD	R30,Y+40
    021DC A5F9      LDD	R31,Y+41
    021DD 9636      ADIW	R30,6
    021DE 8020      LD	R2,Z
    021DF 8031      LDD	R3,Z+1
    021E0 8042      LDD	R4,Z+2
    021E1 8053      LDD	R5,Z+3
    021E2 862E      STD	Y+14,R2
    021E3 863F      STD	Y+15,R3
    021E4 8A48      STD	Y+16,R4
    021E5 8A59      STD	Y+17,R5
(2886) 		fp->fptr = nsect = 0;
    021E6 E080      LDI	R24,0
    021E7 878A      STD	Y+10,R24
    021E8 878B      STD	Y+11,R24
    021E9 878C      STD	Y+12,R24
    021EA 878D      STD	Y+13,R24
    021EB A5E8      LDD	R30,Y+40
    021EC A5F9      LDD	R31,Y+41
    021ED 9636      ADIW	R30,6
    021EE E080      LDI	R24,0
    021EF 8380      ST	Z,R24
    021F0 8381      STD	Z+1,R24
    021F1 8382      STD	Z+2,R24
    021F2 8383      STD	Z+3,R24
(2887) 		if (ofs) {
    021F3 A42A      LDD	R2,Y+42
    021F4 A43B      LDD	R3,Y+43
    021F5 A44C      LDD	R4,Y+44
    021F6 A45D      LDD	R5,Y+45
    021F7 9488      BCLR	0
    021F8 2022      TST	R2
    021F9 0432      CPC	R3,R2
    021FA 0442      CPC	R4,R2
    021FB 0452      CPC	R5,R2
    021FC F409      BNE	0x21FE
    021FD C226      RJMP	0x2424
(2888) 			bcs = (DWORD)fp->fs->csize * SS(fp->fs);	/* Cluster size (byte) */
    021FE A5E8      LDD	R30,Y+40
    021FF A5F9      LDD	R31,Y+41
    02200 93AF      PUSH	R26
    02201 93BF      PUSH	R27
    02202 81A0      LD	R26,Z
    02203 81B1      LDD	R27,Z+1
    02204 01FD      MOVW	R30,R26
    02205 91BF      POP	R27
    02206 91AF      POP	R26
    02207 9632      ADIW	R30,2
    02208 8020      LD	R2,Z
    02209 2433      CLR	R3
    0220A 2444      CLR	R4
    0220B 2455      CLR	R5
    0220C E040      LDI	R20,0
    0220D E052      LDI	R21,2
    0220E E060      LDI	R22,0
    0220F E070      LDI	R23,0
    02210 925A      ST	-Y,R5
    02211 924A      ST	-Y,R4
    02212 923A      ST	-Y,R3
    02213 922A      ST	-Y,R2
    02214 018A      MOVW	R16,R20
    02215 019B      MOVW	R18,R22
    02216 940E 4AB3 CALL	empy32s|empy32u
    02218 830E      STD	Y+6,R16
    02219 831F      STD	Y+7,R17
    0221A 8728      STD	Y+8,R18
    0221B 8739      STD	Y+9,R19
(2889) 			if (ifptr > 0 &&
    0221C 842E      LDD	R2,Y+14
    0221D 843F      LDD	R3,Y+15
    0221E 8848      LDD	R4,Y+16
    0221F 8859      LDD	R5,Y+17
    02220 9488      BCLR	0
    02221 2022      TST	R2
    02222 0432      CPC	R3,R2
    02223 0442      CPC	R4,R2
    02224 0452      CPC	R5,R2
    02225 F409      BNE	0x2227
    02226 C075      RJMP	0x229C
    02227 E041      LDI	R20,1
    02228 E050      LDI	R21,0
    02229 E060      LDI	R22,0
    0222A E070      LDI	R23,0
    0222B 0181      MOVW	R16,R2
    0222C 0192      MOVW	R18,R4
    0222D 1B04      SUB	R16,R20
    0222E 0B15      SBC	R17,R21
    0222F 0B26      SBC	R18,R22
    02230 0B37      SBC	R19,R23
    02231 802E      LDD	R2,Y+6
    02232 803F      LDD	R3,Y+7
    02233 8448      LDD	R4,Y+8
    02234 8459      LDD	R5,Y+9
    02235 925A      ST	-Y,R5
    02236 924A      ST	-Y,R4
    02237 923A      ST	-Y,R3
    02238 922A      ST	-Y,R2
    02239 940E 4A0D CALL	div32u
    0223B 0118      MOVW	R2,R16
    0223C 0129      MOVW	R4,R18
    0223D E041      LDI	R20,1
    0223E E050      LDI	R21,0
    0223F E060      LDI	R22,0
    02240 E070      LDI	R23,0
    02241 A50A      LDD	R16,Y+42
    02242 A51B      LDD	R17,Y+43
    02243 A52C      LDD	R18,Y+44
    02244 A53D      LDD	R19,Y+45
    02245 1B04      SUB	R16,R20
    02246 0B15      SBC	R17,R21
    02247 0B26      SBC	R18,R22
    02248 0B37      SBC	R19,R23
    02249 806E      LDD	R6,Y+6
    0224A 807F      LDD	R7,Y+7
    0224B 8488      LDD	R8,Y+8
    0224C 8499      LDD	R9,Y+9
    0224D 929A      ST	-Y,R9
    0224E 928A      ST	-Y,R8
    0224F 927A      ST	-Y,R7
    02250 926A      ST	-Y,R6
    02251 940E 4A0D CALL	div32u
    02253 1502      CP	R16,R2
    02254 0513      CPC	R17,R3
    02255 0524      CPC	R18,R4
    02256 0535      CPC	R19,R5
    02257 F408      BCC	0x2259
    02258 C043      RJMP	0x229C
(2890) 				(ofs - 1) / bcs >= (ifptr - 1) / bcs) {	/* When seek to same or following cluster, */
(2891) 				fp->fptr = (ifptr - 1) & ~(bcs - 1);	/* start from the current cluster */
    02259 E041      LDI	R20,1
    0225A E050      LDI	R21,0
    0225B E060      LDI	R22,0
    0225C E070      LDI	R23,0
    0225D 802E      LDD	R2,Y+6
    0225E 803F      LDD	R3,Y+7
    0225F 8448      LDD	R4,Y+8
    02260 8459      LDD	R5,Y+9
    02261 1A24      SUB	R2,R20
    02262 0A35      SBC	R3,R21
    02263 0A46      SBC	R4,R22
    02264 0A57      SBC	R5,R23
    02265 9420      COM	R2
    02266 9430      COM	R3
    02267 9440      COM	R4
    02268 9450      COM	R5
    02269 E041      LDI	R20,1
    0226A E050      LDI	R21,0
    0226B E060      LDI	R22,0
    0226C E070      LDI	R23,0
    0226D 846E      LDD	R6,Y+14
    0226E 847F      LDD	R7,Y+15
    0226F 8888      LDD	R8,Y+16
    02270 8899      LDD	R9,Y+17
    02271 1A64      SUB	R6,R20
    02272 0A75      SBC	R7,R21
    02273 0A86      SBC	R8,R22
    02274 0A97      SBC	R9,R23
    02275 2062      AND	R6,R2
    02276 2073      AND	R7,R3
    02277 2084      AND	R8,R4
    02278 2095      AND	R9,R5
    02279 A5E8      LDD	R30,Y+40
    0227A A5F9      LDD	R31,Y+41
    0227B 8266      STD	Z+6,R6
    0227C 8277      STD	Z+7,R7
    0227D 8680      STD	Z+8,R8
    0227E 8691      STD	Z+9,R9
(2892) 				ofs -= fp->fptr;
    0227F 9636      ADIW	R30,6
    02280 8020      LD	R2,Z
    02281 8031      LDD	R3,Z+1
    02282 8042      LDD	R4,Z+2
    02283 8053      LDD	R5,Z+3
    02284 A46A      LDD	R6,Y+42
    02285 A47B      LDD	R7,Y+43
    02286 A48C      LDD	R8,Y+44
    02287 A49D      LDD	R9,Y+45
    02288 1862      SUB	R6,R2
    02289 0873      SBC	R7,R3
    0228A 0884      SBC	R8,R4
    0228B 0895      SBC	R9,R5
    0228C A66A      STD	Y+42,R6
    0228D A67B      STD	Y+43,R7
    0228E A68C      STD	Y+44,R8
    0228F A69D      STD	Y+45,R9
(2893) 				clst = fp->clust;
    02290 A5E8      LDD	R30,Y+40
    02291 A5F9      LDD	R31,Y+41
    02292 9672      ADIW	R30,0x12
    02293 8020      LD	R2,Z
    02294 8031      LDD	R3,Z+1
    02295 8042      LDD	R4,Z+2
    02296 8053      LDD	R5,Z+3
    02297 822A      STD	Y+2,R2
    02298 823B      STD	Y+3,R3
    02299 824C      STD	Y+4,R4
    0229A 825D      STD	Y+5,R5
(2894) 			} else {									/* When seek to back cluster, */
    0229B C069      RJMP	0x2305
(2895) 				clst = fp->sclust;						/* start from the first cluster */
    0229C A5E8      LDD	R30,Y+40
    0229D A5F9      LDD	R31,Y+41
    0229E 963E      ADIW	R30,0xE
    0229F 8020      LD	R2,Z
    022A0 8031      LDD	R3,Z+1
    022A1 8042      LDD	R4,Z+2
    022A2 8053      LDD	R5,Z+3
    022A3 822A      STD	Y+2,R2
    022A4 823B      STD	Y+3,R3
    022A5 824C      STD	Y+4,R4
    022A6 825D      STD	Y+5,R5
(2896) #if !_FS_READONLY
(2897) 				if (clst == 0) {						/* If no cluster chain, create a new chain */
    022A7 802A      LDD	R2,Y+2
    022A8 803B      LDD	R3,Y+3
    022A9 804C      LDD	R4,Y+4
    022AA 805D      LDD	R5,Y+5
    022AB 9488      BCLR	0
    022AC 2022      TST	R2
    022AD 0432      CPC	R3,R2
    022AE 0442      CPC	R4,R2
    022AF 0452      CPC	R5,R2
    022B0 F009      BEQ	0x22B2
    022B1 C049      RJMP	0x22FB
(2898) 					clst = create_chain(fp->fs, 0);
    022B2 E040      LDI	R20,0
    022B3 E050      LDI	R21,0
    022B4 E060      LDI	R22,0
    022B5 E070      LDI	R23,0
    022B6 8368      ST	Y,R22
    022B7 8379      STD	Y+1,R23
    022B8 019A      MOVW	R18,R20
    022B9 A5E8      LDD	R30,Y+40
    022BA A5F9      LDD	R31,Y+41
    022BB 8100      LD	R16,Z
    022BC 8111      LDD	R17,Z+1
    022BD 940E 0A02 CALL	ff.c:create_chain
    022BF 830A      STD	Y+2,R16
    022C0 831B      STD	Y+3,R17
    022C1 832C      STD	Y+4,R18
    022C2 833D      STD	Y+5,R19
(2899) 					if (clst == 1) ABORT(fp->fs, FR_INT_ERR);
    022C3 E041      LDI	R20,1
    022C4 E050      LDI	R21,0
    022C5 E060      LDI	R22,0
    022C6 E070      LDI	R23,0
    022C7 802A      LDD	R2,Y+2
    022C8 803B      LDD	R3,Y+3
    022C9 804C      LDD	R4,Y+4
    022CA 805D      LDD	R5,Y+5
    022CB 1624      CP	R2,R20
    022CC 0635      CPC	R3,R21
    022CD 0646      CPC	R4,R22
    022CE 0657      CPC	R5,R23
    022CF F451      BNE	0x22DA
    022D0 A588      LDD	R24,Y+40
    022D1 A599      LDD	R25,Y+41
    022D2 9604      ADIW	R24,4
    022D3 017C      MOVW	R14,R24
    022D4 01FC      MOVW	R30,R24
    022D5 8180      LD	R24,Z
    022D6 6880      ORI	R24,0x80
    022D7 8380      ST	Z,R24
    022D8 E002      LDI	R16,2
    022D9 C196      RJMP	0x2470
(2900) 					if (clst == 0xFFFFFFFF) ABORT(fp->fs, FR_DISK_ERR);
    022DA EF4F      LDI	R20,0xFF
    022DB EF5F      LDI	R21,0xFF
    022DC EF6F      LDI	R22,0xFF
    022DD EF7F      LDI	R23,0xFF
    022DE 802A      LDD	R2,Y+2
    022DF 803B      LDD	R3,Y+3
    022E0 804C      LDD	R4,Y+4
    022E1 805D      LDD	R5,Y+5
    022E2 1624      CP	R2,R20
    022E3 0635      CPC	R3,R21
    022E4 0646      CPC	R4,R22
    022E5 0657      CPC	R5,R23
    022E6 F451      BNE	0x22F1
    022E7 A588      LDD	R24,Y+40
    022E8 A599      LDD	R25,Y+41
    022E9 9604      ADIW	R24,4
    022EA 017C      MOVW	R14,R24
    022EB 01FC      MOVW	R30,R24
    022EC 8180      LD	R24,Z
    022ED 6880      ORI	R24,0x80
    022EE 8380      ST	Z,R24
    022EF E001      LDI	R16,1
    022F0 C17F      RJMP	0x2470
(2901) 					fp->sclust = clst;
    022F1 802A      LDD	R2,Y+2
    022F2 803B      LDD	R3,Y+3
    022F3 804C      LDD	R4,Y+4
    022F4 805D      LDD	R5,Y+5
    022F5 A5E8      LDD	R30,Y+40
    022F6 A5F9      LDD	R31,Y+41
    022F7 8626      STD	Z+14,R2
    022F8 8637      STD	Z+15,R3
    022F9 8A40      STD	Z+16,R4
    022FA 8A51      STD	Z+17,R5
(2902) 				}
(2903) #endif
(2904) 				fp->clust = clst;
    022FB 802A      LDD	R2,Y+2
    022FC 803B      LDD	R3,Y+3
    022FD 804C      LDD	R4,Y+4
    022FE 805D      LDD	R5,Y+5
    022FF A5E8      LDD	R30,Y+40
    02300 A5F9      LDD	R31,Y+41
    02301 8A22      STD	Z+18,R2
    02302 8A33      STD	Z+19,R3
    02303 8A44      STD	Z+20,R4
    02304 8A55      STD	Z+21,R5
(2905) 			}
(2906) 			if (clst != 0) {
    02305 802A      LDD	R2,Y+2
    02306 803B      LDD	R3,Y+3
    02307 804C      LDD	R4,Y+4
    02308 805D      LDD	R5,Y+5
    02309 9488      BCLR	0
    0230A 2022      TST	R2
    0230B 0432      CPC	R3,R2
    0230C 0442      CPC	R4,R2
    0230D 0452      CPC	R5,R2
    0230E F409      BNE	0x2310
    0230F C114      RJMP	0x2424
    02310 C0A7      RJMP	0x23B8
(2907) 				while (ofs > bcs) {						/* Cluster following loop */
(2908) #if !_FS_READONLY
(2909) 					if (fp->flag & FA_WRITE) {			/* Check if in write mode or not */
    02311 A5E8      LDD	R30,Y+40
    02312 A5F9      LDD	R31,Y+41
    02313 9634      ADIW	R30,4
    02314 8020      LD	R2,Z
    02315 FE21      SBRS	R2,1
    02316 C024      RJMP	0x233B
(2910) 						clst = create_chain(fp->fs, clst);	/* Force stretch if in write mode */
    02317 802A      LDD	R2,Y+2
    02318 803B      LDD	R3,Y+3
    02319 804C      LDD	R4,Y+4
    0231A 805D      LDD	R5,Y+5
    0231B 8248      ST	Y,R4
    0231C 8259      STD	Y+1,R5
    0231D 0191      MOVW	R18,R2
    0231E A5E8      LDD	R30,Y+40
    0231F A5F9      LDD	R31,Y+41
    02320 8100      LD	R16,Z
    02321 8111      LDD	R17,Z+1
    02322 940E 0A02 CALL	ff.c:create_chain
    02324 830A      STD	Y+2,R16
    02325 831B      STD	Y+3,R17
    02326 832C      STD	Y+4,R18
    02327 833D      STD	Y+5,R19
(2911) 						if (clst == 0) {				/* When disk gets full, clip file size */
    02328 802A      LDD	R2,Y+2
    02329 803B      LDD	R3,Y+3
    0232A 804C      LDD	R4,Y+4
    0232B 805D      LDD	R5,Y+5
    0232C 9488      BCLR	0
    0232D 2022      TST	R2
    0232E 0432      CPC	R3,R2
    0232F 0442      CPC	R4,R2
    02330 0452      CPC	R5,R2
    02331 F4D1      BNE	0x234C
(2912) 							ofs = bcs; break;
    02332 802E      LDD	R2,Y+6
    02333 803F      LDD	R3,Y+7
    02334 8448      LDD	R4,Y+8
    02335 8459      LDD	R5,Y+9
    02336 A62A      STD	Y+42,R2
    02337 A63B      STD	Y+43,R3
    02338 A64C      STD	Y+44,R4
    02339 A65D      STD	Y+45,R5
    0233A C08B      RJMP	0x23C6
(2913) 						}
(2914) 					} else
(2915) #endif
(2916) 						clst = get_fat(fp->fs, clst);	/* Follow cluster chain if not in write mode */
    0233B 802A      LDD	R2,Y+2
    0233C 803B      LDD	R3,Y+3
    0233D 804C      LDD	R4,Y+4
    0233E 805D      LDD	R5,Y+5
    0233F 8248      ST	Y,R4
    02340 8259      STD	Y+1,R5
    02341 0191      MOVW	R18,R2
    02342 A5E8      LDD	R30,Y+40
    02343 A5F9      LDD	R31,Y+41
    02344 8100      LD	R16,Z
    02345 8111      LDD	R17,Z+1
    02346 940E 0640 CALL	_get_fat
    02348 830A      STD	Y+2,R16
    02349 831B      STD	Y+3,R17
    0234A 832C      STD	Y+4,R18
    0234B 833D      STD	Y+5,R19
(2917) 					if (clst == 0xFFFFFFFF) ABORT(fp->fs, FR_DISK_ERR);
    0234C EF4F      LDI	R20,0xFF
    0234D EF5F      LDI	R21,0xFF
    0234E EF6F      LDI	R22,0xFF
    0234F EF7F      LDI	R23,0xFF
    02350 802A      LDD	R2,Y+2
    02351 803B      LDD	R3,Y+3
    02352 804C      LDD	R4,Y+4
    02353 805D      LDD	R5,Y+5
    02354 1624      CP	R2,R20
    02355 0635      CPC	R3,R21
    02356 0646      CPC	R4,R22
    02357 0657      CPC	R5,R23
    02358 F451      BNE	0x2363
    02359 A588      LDD	R24,Y+40
    0235A A599      LDD	R25,Y+41
    0235B 9604      ADIW	R24,4
    0235C 017C      MOVW	R14,R24
    0235D 01FC      MOVW	R30,R24
    0235E 8180      LD	R24,Z
    0235F 6880      ORI	R24,0x80
    02360 8380      ST	Z,R24
    02361 E001      LDI	R16,1
    02362 C10D      RJMP	0x2470
(2918) 					if (clst <= 1 || clst >= fp->fs->n_fatent) ABORT(fp->fs, FR_INT_ERR);
    02363 E041      LDI	R20,1
    02364 E050      LDI	R21,0
    02365 E060      LDI	R22,0
    02366 E070      LDI	R23,0
    02367 802A      LDD	R2,Y+2
    02368 803B      LDD	R3,Y+3
    02369 804C      LDD	R4,Y+4
    0236A 805D      LDD	R5,Y+5
    0236B 1542      CP	R20,R2
    0236C 0553      CPC	R21,R3
    0236D 0564      CPC	R22,R4
    0236E 0575      CPC	R23,R5
    0236F F490      BCC	0x2382
    02370 A5E8      LDD	R30,Y+40
    02371 A5F9      LDD	R31,Y+41
    02372 81A0      LD	R26,Z
    02373 81B1      LDD	R27,Z+1
    02374 9656      ADIW	R26,0x16
    02375 902D      LD	R2,X+
    02376 903D      LD	R3,X+
    02377 904D      LD	R4,X+
    02378 905C      LD	R5,X
    02379 806A      LDD	R6,Y+2
    0237A 807B      LDD	R7,Y+3
    0237B 808C      LDD	R8,Y+4
    0237C 809D      LDD	R9,Y+5
    0237D 1462      CP	R6,R2
    0237E 0473      CPC	R7,R3
    0237F 0484      CPC	R8,R4
    02380 0495      CPC	R9,R5
    02381 F050      BCS	0x238C
    02382 A588      LDD	R24,Y+40
    02383 A599      LDD	R25,Y+41
    02384 9604      ADIW	R24,4
    02385 017C      MOVW	R14,R24
    02386 01FC      MOVW	R30,R24
    02387 8180      LD	R24,Z
    02388 6880      ORI	R24,0x80
    02389 8380      ST	Z,R24
    0238A E002      LDI	R16,2
    0238B C0E4      RJMP	0x2470
(2919) 					fp->clust = clst;
    0238C 802A      LDD	R2,Y+2
    0238D 803B      LDD	R3,Y+3
    0238E 804C      LDD	R4,Y+4
    0238F 805D      LDD	R5,Y+5
    02390 A5E8      LDD	R30,Y+40
    02391 A5F9      LDD	R31,Y+41
    02392 9672      ADIW	R30,0x12
    02393 8220      ST	Z,R2
    02394 8231      STD	Z+1,R3
    02395 8242      STD	Z+2,R4
    02396 8253      STD	Z+3,R5
(2920) 					fp->fptr += bcs;
    02397 A588      LDD	R24,Y+40
    02398 A599      LDD	R25,Y+41
    02399 9606      ADIW	R24,6
    0239A 017C      MOVW	R14,R24
    0239B 802E      LDD	R2,Y+6
    0239C 803F      LDD	R3,Y+7
    0239D 8448      LDD	R4,Y+8
    0239E 8459      LDD	R5,Y+9
    0239F 01FC      MOVW	R30,R24
    023A0 8060      LD	R6,Z
    023A1 8071      LDD	R7,Z+1
    023A2 8082      LDD	R8,Z+2
    023A3 8093      LDD	R9,Z+3
    023A4 0C62      ADD	R6,R2
    023A5 1C73      ADC	R7,R3
    023A6 1C84      ADC	R8,R4
    023A7 1C95      ADC	R9,R5
    023A8 8260      ST	Z,R6
    023A9 8271      STD	Z+1,R7
    023AA 8282      STD	Z+2,R8
    023AB 8293      STD	Z+3,R9
(2921) 					ofs -= bcs;
    023AC A46A      LDD	R6,Y+42
    023AD A47B      LDD	R7,Y+43
    023AE A48C      LDD	R8,Y+44
    023AF A49D      LDD	R9,Y+45
    023B0 1862      SUB	R6,R2
    023B1 0873      SBC	R7,R3
    023B2 0884      SBC	R8,R4
    023B3 0895      SBC	R9,R5
    023B4 A66A      STD	Y+42,R6
    023B5 A67B      STD	Y+43,R7
    023B6 A68C      STD	Y+44,R8
    023B7 A69D      STD	Y+45,R9
    023B8 802E      LDD	R2,Y+6
    023B9 803F      LDD	R3,Y+7
    023BA 8448      LDD	R4,Y+8
    023BB 8459      LDD	R5,Y+9
    023BC A46A      LDD	R6,Y+42
    023BD A47B      LDD	R7,Y+43
    023BE A48C      LDD	R8,Y+44
    023BF A49D      LDD	R9,Y+45
    023C0 1426      CP	R2,R6
    023C1 0437      CPC	R3,R7
    023C2 0448      CPC	R4,R8
    023C3 0459      CPC	R5,R9
    023C4 F408      BCC	0x23C6
    023C5 CF4B      RJMP	0x2311
(2922) 				}
(2923) 				fp->fptr += ofs;
    023C6 A588      LDD	R24,Y+40
    023C7 A599      LDD	R25,Y+41
    023C8 9606      ADIW	R24,6
    023C9 017C      MOVW	R14,R24
    023CA A42A      LDD	R2,Y+42
    023CB A43B      LDD	R3,Y+43
    023CC A44C      LDD	R4,Y+44
    023CD A45D      LDD	R5,Y+45
    023CE 01FC      MOVW	R30,R24
    023CF 8060      LD	R6,Z
    023D0 8071      LDD	R7,Z+1
    023D1 8082      LDD	R8,Z+2
    023D2 8093      LDD	R9,Z+3
    023D3 0C62      ADD	R6,R2
    023D4 1C73      ADC	R7,R3
    023D5 1C84      ADC	R8,R4
    023D6 1C95      ADC	R9,R5
    023D7 8260      ST	Z,R6
    023D8 8271      STD	Z+1,R7
    023D9 8282      STD	Z+2,R8
    023DA 8293      STD	Z+3,R9
(2924) 				if (ofs % SS(fp->fs)) {
    023DB EF4F      LDI	R20,0xFF
    023DC E051      LDI	R21,1
    023DD E060      LDI	R22,0
    023DE E070      LDI	R23,0
    023DF 2224      AND	R2,R20
    023E0 2235      AND	R3,R21
    023E1 2246      AND	R4,R22
    023E2 2257      AND	R5,R23
    023E3 9488      BCLR	0
    023E4 2022      TST	R2
    023E5 0432      CPC	R3,R2
    023E6 0442      CPC	R4,R2
    023E7 0452      CPC	R5,R2
    023E8 F409      BNE	0x23EA
    023E9 C03A      RJMP	0x2424
(2925) 					nsect = clust2sect(fp->fs, clst);	/* Current sector */
    023EA 802A      LDD	R2,Y+2
    023EB 803B      LDD	R3,Y+3
    023EC 804C      LDD	R4,Y+4
    023ED 805D      LDD	R5,Y+5
    023EE 8248      ST	Y,R4
    023EF 8259      STD	Y+1,R5
    023F0 0191      MOVW	R18,R2
    023F1 A5E8      LDD	R30,Y+40
    023F2 A5F9      LDD	R31,Y+41
    023F3 8100      LD	R16,Z
    023F4 8111      LDD	R17,Z+1
    023F5 940E 05EE CALL	_clust2sect
    023F7 870A      STD	Y+10,R16
    023F8 871B      STD	Y+11,R17
    023F9 872C      STD	Y+12,R18
    023FA 873D      STD	Y+13,R19
(2926) 					if (!nsect) ABORT(fp->fs, FR_INT_ERR);
    023FB 842A      LDD	R2,Y+10
    023FC 843B      LDD	R3,Y+11
    023FD 844C      LDD	R4,Y+12
    023FE 845D      LDD	R5,Y+13
    023FF 9488      BCLR	0
    02400 2022      TST	R2
    02401 0432      CPC	R3,R2
    02402 0442      CPC	R4,R2
    02403 0452      CPC	R5,R2
    02404 F451      BNE	0x240F
    02405 A588      LDD	R24,Y+40
    02406 A599      LDD	R25,Y+41
    02407 9604      ADIW	R24,4
    02408 017C      MOVW	R14,R24
    02409 01FC      MOVW	R30,R24
    0240A 8180      LD	R24,Z
    0240B 6880      ORI	R24,0x80
    0240C 8380      ST	Z,R24
    0240D E002      LDI	R16,2
    0240E C061      RJMP	0x2470
(2927) 					nsect += ofs / SS(fp->fs);
    0240F E089      LDI	R24,0x9
    02410 E090      LDI	R25,0
    02411 A50A      LDD	R16,Y+42
    02412 A51B      LDD	R17,Y+43
    02413 A52C      LDD	R18,Y+44
    02414 A53D      LDD	R19,Y+45
    02415 938A      ST	-Y,R24
    02416 940E 4BAB CALL	lsr32
    02418 842A      LDD	R2,Y+10
    02419 843B      LDD	R3,Y+11
    0241A 844C      LDD	R4,Y+12
    0241B 845D      LDD	R5,Y+13
    0241C 0E20      ADD	R2,R16
    0241D 1E31      ADC	R3,R17
    0241E 1E42      ADC	R4,R18
    0241F 1E53      ADC	R5,R19
    02420 862A      STD	Y+10,R2
    02421 863B      STD	Y+11,R3
    02422 864C      STD	Y+12,R4
    02423 865D      STD	Y+13,R5
(2928) 				}
(2929) 			}
(2930) 		}
(2931) 		if (fp->fptr % SS(fp->fs) && nsect != fp->dsect) {	/* Fill sector cache if needed */
    02424 EF4F      LDI	R20,0xFF
    02425 E051      LDI	R21,1
    02426 E060      LDI	R22,0
    02427 E070      LDI	R23,0
    02428 A5E8      LDD	R30,Y+40
    02429 A5F9      LDD	R31,Y+41
    0242A 9636      ADIW	R30,6
    0242B 8020      LD	R2,Z
    0242C 8031      LDD	R3,Z+1
    0242D 8042      LDD	R4,Z+2
    0242E 8053      LDD	R5,Z+3
    0242F 2224      AND	R2,R20
    02430 2235      AND	R3,R21
    02431 2246      AND	R4,R22
    02432 2257      AND	R5,R23
    02433 9488      BCLR	0
    02434 2022      TST	R2
    02435 0432      CPC	R3,R2
    02436 0442      CPC	R4,R2
    02437 0452      CPC	R5,R2
    02438 F0C1      BEQ	0x2451
    02439 A5E8      LDD	R30,Y+40
    0243A A5F9      LDD	R31,Y+41
    0243B 9676      ADIW	R30,0x16
    0243C 8020      LD	R2,Z
    0243D 8031      LDD	R3,Z+1
    0243E 8042      LDD	R4,Z+2
    0243F 8053      LDD	R5,Z+3
    02440 846A      LDD	R6,Y+10
    02441 847B      LDD	R7,Y+11
    02442 848C      LDD	R8,Y+12
    02443 849D      LDD	R9,Y+13
    02444 1462      CP	R6,R2
    02445 0473      CPC	R7,R3
    02446 0484      CPC	R8,R4
    02447 0495      CPC	R9,R5
    02448 F041      BEQ	0x2451
(2932) #if !_FS_TINY
(2933) #if !_FS_READONLY
(2934) 			if (fp->flag & FA__DIRTY) {			/* Write-back dirty sector cache */
(2935) 				if (disk_write(fp->fs->drv, fp->buf, fp->dsect, 1) != RES_OK)
(2936) 					ABORT(fp->fs, FR_DISK_ERR);
(2937) 				fp->flag &= ~FA__DIRTY;
(2938) 			}
(2939) #endif
(2940) 			if (disk_read(fp->fs->drv, fp->buf, nsect, 1) != RES_OK)	/* Fill sector cache */
(2941) 				ABORT(fp->fs, FR_DISK_ERR);
(2942) #endif
(2943) 			fp->dsect = nsect;
    02449 0113      MOVW	R2,R6
    0244A 0124      MOVW	R4,R8
    0244B A5E8      LDD	R30,Y+40
    0244C A5F9      LDD	R31,Y+41
    0244D 8A26      STD	Z+22,R2
    0244E 8A37      STD	Z+23,R3
    0244F 8E40      STD	Z+24,R4
    02450 8E51      STD	Z+25,R5
(2944) 		}
(2945) #if !_FS_READONLY
(2946) 		if (fp->fptr > fp->fsize) {			/* Set file change flag if the file size is extended */
    02451 A5E8      LDD	R30,Y+40
    02452 A5F9      LDD	R31,Y+41
    02453 8422      LDD	R2,Z+10
    02454 8433      LDD	R3,Z+11
    02455 8444      LDD	R4,Z+12
    02456 8455      LDD	R5,Z+13
    02457 8066      LDD	R6,Z+6
    02458 8077      LDD	R7,Z+7
    02459 8480      LDD	R8,Z+8
    0245A 8491      LDD	R9,Z+9
    0245B 1426      CP	R2,R6
    0245C 0437      CPC	R3,R7
    0245D 0448      CPC	R4,R8
    0245E 0459      CPC	R5,R9
    0245F F478      BCC	0x246F
(2947) 			fp->fsize = fp->fptr;
    02460 8026      LDD	R2,Z+6
    02461 8037      LDD	R3,Z+7
    02462 8440      LDD	R4,Z+8
    02463 8451      LDD	R5,Z+9
    02464 8622      STD	Z+10,R2
    02465 8633      STD	Z+11,R3
    02466 8644      STD	Z+12,R4
    02467 8655      STD	Z+13,R5
(2948) 			fp->flag |= FA__WRITTEN;
    02468 01CF      MOVW	R24,R30
    02469 9604      ADIW	R24,4
    0246A 016C      MOVW	R12,R24
    0246B 01FC      MOVW	R30,R24
    0246C 8180      LD	R24,Z
    0246D 6280      ORI	R24,0x20
    0246E 8380      ST	Z,R24
(2949) 		}
(2950) #endif
(2951) 	}
(2952) 
(2953) 	LEAVE_FF(fp->fs, res);
    0246F 2D0A      MOV	R16,R10
    02470 966E      ADIW	R28,0x1E
    02471 940E 4AFC CALL	pop_xgsetF0FC
    02473 9624      ADIW	R28,4
    02474 9508      RET
_f_opendir:
  sfn                  --> Y,+1
  res                  --> R20
  path                 --> Y,+19
  dj                   --> R22
    02475 933A      ST	-Y,R19
    02476 932A      ST	-Y,R18
    02477 940E 4B26 CALL	push_xgsetF00C
    02479 01B8      MOVW	R22,R16
    0247A 972D      SBIW	R28,0xD
(2954) }
(2955) 
(2956) 
(2957) 
(2958) #if _FS_MINIMIZE <= 1
(2959) /*-----------------------------------------------------------------------*/
(2960) /* Create a Directroy Object                                             */
(2961) /*-----------------------------------------------------------------------*/
(2962) 
(2963) FRESULT f_opendir (
(2964) 	DIR *dj,			/* Pointer to directory object to create */
(2965) 	const TCHAR *path	/* Pointer to the directory path */
(2966) )
(2967) {
(2968) 	FRESULT res;
(2969) 	DEF_NAMEBUF;
(2970) 
(2971) 
(2972) 	res = chk_mounted(&path, &dj->fs, 0);
    0247B 2422      CLR	R2
    0247C 8228      ST	Y,R2
    0247D 019B      MOVW	R18,R22
    0247E 018E      MOVW	R16,R28
    0247F 5E0D      SUBI	R16,0xED
    02480 4F1F      SBCI	R17,0xFF
    02481 940E 1295 CALL	ff.c:chk_mounted
    02483 2F40      MOV	R20,R16
(2973) 	if (res == FR_OK) {
    02484 2300      TST	R16
    02485 F009      BEQ	0x2487
    02486 C05C      RJMP	0x24E3
(2974) 		INIT_BUF(*dj);
    02487 01CE      MOVW	R24,R28
    02488 9601      ADIW	R24,1
    02489 01FB      MOVW	R30,R22
    0248A 8B95      STD	Z+21,R25
    0248B 8B84      STD	Z+20,R24
(2975) 		res = follow_path(dj, path);			/* Follow the path to the directory */
    0248C 892B      LDD	R18,Y+19
    0248D 893C      LDD	R19,Y+20
    0248E 018F      MOVW	R16,R30
    0248F 940E 1149 CALL	ff.c:follow_path
    02491 2F40      MOV	R20,R16
(2976) 		FREE_BUF();
(2977) 		if (res == FR_OK) {						/* Follow completed */
    02492 2300      TST	R16
    02493 F009      BEQ	0x2495
    02494 C04B      RJMP	0x24E0
(2978) 			if (dj->dir) {						/* It is not the root dir */
    02495 01FB      MOVW	R30,R22
    02496 8822      LDD	R2,Z+18
    02497 8833      LDD	R3,Z+19
    02498 2022      TST	R2
    02499 F419      BNE	0x249D
    0249A 2033      TST	R3
    0249B F409      BNE	0x249D
    0249C C032      RJMP	0x24CF
(2979) 				if (dj->dir[DIR_Attr] & AM_DIR) {	/* The object is a directory */
    0249D 93AF      PUSH	R26
    0249E 93BF      PUSH	R27
    0249F 89A2      LDD	R26,Z+18
    024A0 89B3      LDD	R27,Z+19
    024A1 01FD      MOVW	R30,R26
    024A2 91BF      POP	R27
    024A3 91AF      POP	R26
    024A4 8423      LDD	R2,Z+11
    024A5 FE24      SBRS	R2,4
    024A6 C027      RJMP	0x24CE
(2980) 					dj->sclust = LD_CLUST(dj->dir);
    024A7 01FB      MOVW	R30,R22
    024A8 88A2      LDD	R10,Z+18
    024A9 88B3      LDD	R11,Z+19
    024AA 01F5      MOVW	R30,R10
    024AB 8C22      LDD	R2,Z+26
    024AC 2433      CLR	R3
    024AD 8C43      LDD	R4,Z+27
    024AE 2455      CLR	R5
    024AF 2C54      MOV	R5,R4
    024B0 2444      CLR	R4
    024B1 2842      OR	R4,R2
    024B2 2853      OR	R5,R3
    024B3 0112      MOVW	R2,R4
    024B4 2444      CLR	R4
    024B5 2455      CLR	R5
    024B6 8864      LDD	R6,Z+20
    024B7 2477      CLR	R7
    024B8 8885      LDD	R8,Z+21
    024B9 2499      CLR	R9
    024BA 2C98      MOV	R9,R8
    024BB 2488      CLR	R8
    024BC 2886      OR	R8,R6
    024BD 2897      OR	R9,R7
    024BE 0134      MOVW	R6,R8
    024BF 2488      CLR	R8
    024C0 2499      CLR	R9
    024C1 0143      MOVW	R8,R6
    024C2 2466      CLR	R6
    024C3 2477      CLR	R7
    024C4 2862      OR	R6,R2
    024C5 2873      OR	R7,R3
    024C6 2884      OR	R8,R4
    024C7 2895      OR	R9,R5
    024C8 01FB      MOVW	R30,R22
    024C9 8266      STD	Z+6,R6
    024CA 8277      STD	Z+7,R7
    024CB 8680      STD	Z+8,R8
    024CC 8691      STD	Z+9,R9
(2981) 				} else {						/* The object is not a directory */
    024CD C001      RJMP	0x24CF
(2982) 					res = FR_NO_PATH;
    024CE E045      LDI	R20,5
(2983) 				}
(2984) 			}
(2985) 			if (res == FR_OK) {
    024CF 2344      TST	R20
    024D0 F479      BNE	0x24E0
(2986) 				dj->id = dj->fs->id;
    024D1 01FB      MOVW	R30,R22
    024D2 81A0      LD	R26,Z
    024D3 81B1      LDD	R27,Z+1
    024D4 9616      ADIW	R26,6
    024D5 902D      LD	R2,X+
    024D6 903C      LD	R3,X
    024D7 8233      STD	Z+3,R3
    024D8 8222      STD	Z+2,R2
(2987) 				res = dir_sdi(dj, 0);			/* Rewind dir */
    024D9 2722      CLR	R18
    024DA 2733      CLR	R19
    024DB 018F      MOVW	R16,R30
    024DC 940E 0BF3 CALL	ff.c:dir_sdi
    024DE 2EA0      MOV	R10,R16
    024DF 2D4A      MOV	R20,R10
(2988) 			}
(2989) 		}
(2990) 		if (res == FR_NO_FILE) res = FR_NO_PATH;
    024E0 3044      CPI	R20,4
    024E1 F409      BNE	0x24E3
    024E2 E045      LDI	R20,5
(2991) 	}
(2992) 
(2993) 	LEAVE_FF(dj->fs, res);
    024E3 2F04      MOV	R16,R20
    024E4 962D      ADIW	R28,0xD
    024E5 940E 4B2D CALL	pop_xgsetF00C
    024E7 9622      ADIW	R28,2
    024E8 9508      RET
_f_readdir:
  sfn                  --> Y,+0
  res                  --> R20
  fno                  --> R10
  dj                   --> R22
    024E9 940E 4B42 CALL	push_xgsetF03C
    024EB 0159      MOVW	R10,R18
    024EC 01B8      MOVW	R22,R16
    024ED 972C      SBIW	R28,0xC
(2994) }
(2995) 
(2996) 
(2997) 
(2998) 
(2999) /*-----------------------------------------------------------------------*/
(3000) /* Read Directory Entry in Sequense                                      */
(3001) /*-----------------------------------------------------------------------*/
(3002) 
(3003) FRESULT f_readdir (
(3004) 	DIR *dj,			/* Pointer to the open directory object */
(3005) 	FILINFO *fno		/* Pointer to file information to return */
(3006) )
(3007) {
(3008) 	FRESULT res;
(3009) 	DEF_NAMEBUF;
(3010) 
(3011) 
(3012) 	res = validate(dj->fs, dj->id);			/* Check validity of the object */
    024EE 01FB      MOVW	R30,R22
    024EF 8122      LDD	R18,Z+2
    024F0 8133      LDD	R19,Z+3
    024F1 8100      LD	R16,Z
    024F2 8111      LDD	R17,Z+1
    024F3 940E 178F CALL	ff.c:validate
    024F5 2F40      MOV	R20,R16
(3013) 	if (res == FR_OK) {
    024F6 2300      TST	R16
    024F7 F009      BEQ	0x24F9
    024F8 C035      RJMP	0x252E
(3014) 		if (!fno) {
    024F9 20AA      TST	R10
    024FA F449      BNE	0x2504
    024FB 20BB      TST	R11
    024FC F439      BNE	0x2504
(3015) 			res = dir_sdi(dj, 0);			/* Rewind the directory object */
    024FD 2722      CLR	R18
    024FE 2733      CLR	R19
    024FF 018B      MOVW	R16,R22
    02500 940E 0BF3 CALL	ff.c:dir_sdi
    02502 2F40      MOV	R20,R16
(3016) 		} else {
    02503 C02A      RJMP	0x252E
(3017) 			INIT_BUF(*dj);
    02504 01CE      MOVW	R24,R28
    02505 01FB      MOVW	R30,R22
    02506 8B95      STD	Z+21,R25
    02507 8B84      STD	Z+20,R24
(3018) 			res = dir_read(dj);				/* Read an directory item */
    02508 018F      MOVW	R16,R30
    02509 940E 0EF0 CALL	ff.c:dir_read
    0250B 2EC0      MOV	R12,R16
    0250C 2D4C      MOV	R20,R12
(3019) 			if (res == FR_NO_FILE) {		/* Reached end of dir */
    0250D 3004      CPI	R16,4
    0250E F441      BNE	0x2517
(3020) 				dj->sect = 0;
    0250F 01FB      MOVW	R30,R22
    02510 963E      ADIW	R30,0xE
    02511 E080      LDI	R24,0
    02512 8380      ST	Z,R24
    02513 8381      STD	Z+1,R24
    02514 8382      STD	Z+2,R24
    02515 8383      STD	Z+3,R24
(3021) 				res = FR_OK;
    02516 2744      CLR	R20
(3022) 			}
(3023) 			if (res == FR_OK) {				/* A valid entry is found */
    02517 2344      TST	R20
    02518 F4A9      BNE	0x252E
(3024) 				get_fileinfo(dj, fno);		/* Get the object information */
    02519 0195      MOVW	R18,R10
    0251A 018B      MOVW	R16,R22
    0251B 940E 10A6 CALL	ff.c:get_fileinfo
(3025) 				res = dir_next(dj, 0);		/* Increment index for next */
    0251D 2722      CLR	R18
    0251E 2733      CLR	R19
    0251F 018B      MOVW	R16,R22
    02520 940E 0CFD CALL	ff.c:dir_next
    02522 2EA0      MOV	R10,R16
    02523 2D4A      MOV	R20,R10
(3026) 				if (res == FR_NO_FILE) {
    02524 3004      CPI	R16,4
    02525 F441      BNE	0x252E
(3027) 					dj->sect = 0;
    02526 01FB      MOVW	R30,R22
    02527 963E      ADIW	R30,0xE
    02528 E080      LDI	R24,0
    02529 8380      ST	Z,R24
    0252A 8381      STD	Z+1,R24
    0252B 8382      STD	Z+2,R24
    0252C 8383      STD	Z+3,R24
(3028) 					res = FR_OK;
    0252D 2744      CLR	R20
(3029) 				}
(3030) 			}
(3031) 			FREE_BUF();
(3032) 		}
(3033) 	}
(3034) 
(3035) 	LEAVE_FF(dj->fs, res);
    0252E 2F04      MOV	R16,R20
    0252F 962C      ADIW	R28,0xC
    02530 940C 4B4B JMP	pop_xgsetF03C
FILE: D:\LQD\software\software_src\delay.c
(0001) /*******************************
(0002)  function ：延时函数
(0003) Clock F  :7.3728M 
(0004) Software : ICCAVR7.14C
(0005) ********************************/
(0006) /*---------------------------------------------------------------------------------
(0007)      延时程序计算方法
(0008)      计数个数j = 延时时间/6*晶振频率 - 1
(0009) ---------------------------------------------------------------------------------*/
(0010) void delayus(unsigned int tttt)   // 1.2us 延时子函数   
(0011) { 
(0012)    do
(0013)    {
(0014)        tttt--;
_delayus:
  tttt                 --> R16
    02532 5001      SUBI	R16,1
    02533 4010      SBCI	R17,0
(0015)    }
(0016)    while(tttt>1);
    02534 E081      LDI	R24,1
    02535 E090      LDI	R25,0
    02536 1780      CP	R24,R16
    02537 0791      CPC	R25,R17
    02538 F3C8      BCS	0x2532
    02539 9508      RET
_delayms:
  j                    --> R20
  i                    --> R16
    0253A 934A      ST	-Y,R20
    0253B 935A      ST	-Y,R21
(0017) }
(0018) void delayms(unsigned int i)                 //1ms延时
(0019)    {
    0253C C00A      RJMP	0x2547
(0020)     while(i--)
(0021)     {                          
(0022) 	    unsigned int j;                
(0023)         for(j=1;j<=1227;j++)   
    0253D E041      LDI	R20,1
    0253E E050      LDI	R21,0
    0253F C002      RJMP	0x2542
    02540 5F4F      SUBI	R20,0xFF
    02541 4F5F      SBCI	R21,0xFF
    02542 EC8B      LDI	R24,0xCB
    02543 E094      LDI	R25,4
    02544 1784      CP	R24,R20
    02545 0795      CPC	R25,R21
    02546 F7C8      BCC	0x2540
    02547 0118      MOVW	R2,R16
    02548 5001      SUBI	R16,1
    02549 4010      SBCI	R17,0
    0254A 2022      TST	R2
    0254B F789      BNE	0x253D
    0254C 2033      TST	R3
    0254D F779      BNE	0x253D
    0254E 9159      LD	R21,Y+
    0254F 9149      LD	R20,Y+
    02550 9508      RET
FILE: D:\LQD\software\software_src\main.c
(0001) #include "config.h"
(0002) #define  N_per_Second  (2.72*60)
(0003) const char tab[]="\t\0";
(0004) const char enter[]="\n\0";
(0005) char buffer[512];
(0006) char TempChar[80]; //存放临时字串
(0007) struct DATA Result;
(0008) struct tm t;
(0009) unsigned long now =0; 
(0010) void debug(UINT8 *str,UINT8 val);
(0011) void WriteSDFile(void);
(0012) struct CONFIG config;
(0013) void initDevices(void){
(0014)      CLI();
_initDevices:
    02551 94F8      BCLR	7
(0015) 	 DDRA=0XFF;
    02552 EF8F      LDI	R24,0xFF
    02553 BB8A      OUT	0x1A,R24
(0016) 	 PORTA=0XFF;
    02554 BB8B      OUT	0x1B,R24
(0017) 	 DDRB=0XFF;
    02555 BB87      OUT	0x17,R24
(0018) 	 PORTB=0XFF; 	 
    02556 BB88      OUT	0x18,R24
(0019) 	 DDRC=0XFF;
    02557 BB84      OUT	0x14,R24
(0020) 	 PORTC=0XFF;
    02558 BB85      OUT	0x15,R24
(0021) 	 DDRG=0XFF;
    02559 9380 0064 STS	0x64,R24
(0022) 	 PORTG=0XFF;	 
    0255B 9380 0065 STS	0x65,R24
(0023) 	 SPI_IO_Init(); 
    0255D 940E 3E9A CALL	_SPI_IO_Init
(0024) 	 SD_Init();
    0255F 940E 2D8F CALL	_SD_Init
(0025) 	 uart1_init();
    02561 940E 3C99 CALL	_uart1_init
(0026) 	 LCD_INT();delayms(50);LCD_INT();
    02563 940E 3EB8 CALL	_LCD_INT
    02565 E302      LDI	R16,0x32
    02566 E010      LDI	R17,0
    02567 940E 253A CALL	_delayms
    02569 940E 3EB8 CALL	_LCD_INT
(0027) 	 LCD_SW(1);
    0256B E001      LDI	R16,1
    0256C 940E 3EAE CALL	_LCD_SW
(0028) 	 config.THRESHOLD_delta_sec=60; //一次检测用时
    0256E E38C      LDI	R24,0x3C
    0256F 9380 08B3 STS	config+4,R24
    02571 E080      LDI	R24,0
    02572 9380 08B4 STS	config+5,R24
    02574 9380 08B5 STS	config+6,R24
    02576 9380 08B6 STS	config+7,R24
(0029) 	 config.heatThreshold = 5; //继电器开启温度 
    02578 E085      LDI	R24,5
    02579 9380 08C3 STS	config+20,R24
(0030) 	 config.checkDeltaTime=20;  //自动检测模式 时间间隔	 
    0257B E184      LDI	R24,0x14
    0257C E090      LDI	R25,0
    0257D 9390 08C1 STS	config+18,R25
    0257F 9380 08C0 STS	config+17,R24
(0031) 	 config.autocheck=1;        //自动检测开关
    02581 E081      LDI	R24,1
    02582 9380 08BF STS	config+16,R24
(0032) 	 config.readMode = 0;      //读数据模式
    02584 2422      CLR	R2
    02585 9220 08C2 STS	config+19,R2
(0033) 	 config.autoSend = 1; //zigbee发送开关，>=1时，使能发送
    02587 9380 08C4 STS	config+21,R24
(0034) 	 #ifdef _FOR_FAST_TEST
(0035) 	 config.THRESHOLD_delta_sec=5; //一次检测用时
(0036) 	 config.heatThreshold = 20; //继电器开启温度 
(0037) 	 config.checkDeltaTime=5;  //自动检测模式 时间间隔	 
(0038) 	 #endif
(0039) 	 SEI();
    02589 9478      BSET	7
    0258A 9508      RET
(0040) }
(0041) void timer1_init(void)
(0042) {
(0043)  TCCR1B = 0x00; //stop
_timer1_init:
    0258B 2422      CLR	R2
    0258C BC2E      OUT	0x2E,R2
(0044)  TCNT1H = 0x00 /*INVALID SETTING*/; //setup
    0258D BC2D      OUT	0x2D,R2
(0045)  TCNT1L = 0x00 /*INVALID SETTING*/;
    0258E BC2C      OUT	0x2C,R2
(0046)  TCCR1A = 0x00;
    0258F BC2F      OUT	0x2F,R2
(0047)  TCCR1B = 0x46; //start Timer
    02590 E486      LDI	R24,0x46
    02591 BD8E      OUT	0x2E,R24
    02592 9508      RET
_main:
  keycode              --> Y,+1
  i                    --> R10
  filename             --> Y,+513
  buf512               --> Y,+0
  tmp                  --> R10
    02593 97EF      SBIW	R28,0x3F
    02594 97EF      SBIW	R28,0x3F
    02595 97EF      SBIW	R28,0x3F
    02596 97EF      SBIW	R28,0x3F
    02597 97EF      SBIW	R28,0x3F
    02598 97EF      SBIW	R28,0x3F
    02599 97EF      SBIW	R28,0x3F
    0259A 97EF      SBIW	R28,0x3F
    0259B 9767      SBIW	R28,0x17
(0048) }
(0049) ////////////////////////////////////////////////////////////////
(0050) void main(void){
(0051) 	 UINT8 tmp,keycode;
(0052) 	 UINT8 buf512[513];
(0053) 	 char filename[]="201301.xls\0\0\0";
    0259C E189      LDI	R24,0x19
    0259D E091      LDI	R25,1
    0259E 01FE      MOVW	R30,R28
    0259F 5FEF      SUBI	R30,0xFF
    025A0 4FFD      SBCI	R31,0xFD
    025A1 E00E      LDI	R16,0xE
    025A2 E010      LDI	R17,0
    025A3 93FA      ST	-Y,R31
    025A4 93EA      ST	-Y,R30
    025A5 939A      ST	-Y,R25
    025A6 938A      ST	-Y,R24
    025A7 940E 4BB7 CALL	asgnblk
(0054) 	 int i=0;
    025A9 24AA      CLR	R10
    025AA 24BB      CLR	R11
(0055) 	 initDevices();
    025AB DFA5      RCALL	_initDevices
(0056) 	 dateRefresh(1);
    025AC E001      LDI	R16,1
    025AD 940E 3956 CALL	_dateRefresh
(0057) 	 WriteFileHead();
    025AF D16E      RCALL	_WriteFileHead
(0058)      Result.Index=findIndex(get_name(filename),buf512);
    025B0 018E      MOVW	R16,R28
    025B1 5F0F      SUBI	R16,0xFF
    025B2 4F1D      SBCI	R17,0xFD
    025B3 D6BE      RCALL	_get_name
    025B4 019E      MOVW	R18,R28
    025B5 D2E3      RCALL	_findIndex
    025B6 0118      MOVW	R2,R16
    025B7 2444      CLR	R4
    025B8 2455      CLR	R5
    025B9 9230 0648 STS	Result+11,R3
    025BB 9220 0647 STS	Result+10,R2
    025BD 9250 064A STS	Result+13,R5
    025BF 9240 0649 STS	Result+12,R4
(0059) 	 #ifdef _DBG_RD_  
(0060) 	 	 while(1){
(0061) 		     GUI_readback(buf512);
(0062) 	     }
(0063) 	 #endif
(0064) 	 //selfTest();
(0065) 	 GUI_welcome();
    025C1 940E 3939 CALL	_GUI_welcome
    025C3 C025      RJMP	0x25E9
(0066) 	 /*
(0067) 	 while(1)
(0068) 	 {
(0069) 	   delayms(100);dateRefresh(1);StructToChar();
(0070) 	   check();
(0071) 	   zigbee_send_date();
(0072) 	 }
(0073) 	  */
(0074) 	 while(alwaysCheck()){
(0075) 	    tmp=GUI_mainmeu();
    025C4 940E 2F68 CALL	_GUI_mainmeu
    025C6 2EA0      MOV	R10,R16
(0076) 		switch(tmp){
    025C7 2D4A      MOV	R20,R10
    025C8 2755      CLR	R21
    025C9 3043      CPI	R20,3
    025CA E0E0      LDI	R30,0
    025CB 075E      CPC	R21,R30
    025CC F069      BEQ	0x25DA
    025CD 3044      CPI	R20,4
    025CE E0E0      LDI	R30,0
    025CF 075E      CPC	R21,R30
    025D0 F061      BEQ	0x25DD
    025D1 3045      CPI	R20,5
    025D2 E0E0      LDI	R30,0
    025D3 075E      CPC	R21,R30
    025D4 F059      BEQ	0x25E0
    025D5 3047      CPI	R20,7
    025D6 E0E0      LDI	R30,0
    025D7 075E      CPC	R21,R30
    025D8 F059      BEQ	0x25E4
    025D9 C00B      RJMP	0x25E5
(0077) 		    case 3 : GUI_check(); break; 
    025DA 940E 305D CALL	_GUI_check
    025DC C008      RJMP	0x25E5
(0078) 			case 4 : GUI_set_time(); break ;
    025DD 940E 3539 CALL	_GUI_set_time
    025DF C005      RJMP	0x25E5
(0079) 			case 5 : GUI_readback(buf512); break;
    025E0 018E      MOVW	R16,R28
    025E1 940E 378E CALL	_GUI_readback
    025E3 C001      RJMP	0x25E5
(0080) 			//case 6 : GUI_send_date();
(0081) 			case 7 : selfTest(); break ;
    025E4 D058      RCALL	_selfTest
(0082) 			default : break;
(0083) 	   }
(0084) 	   delayms(100);
    025E5 E604      LDI	R16,0x64
    025E6 E010      LDI	R17,0
    025E7 940E 253A CALL	_delayms
    025E9 D00D      RCALL	_alwaysCheck
    025EA 2EA0      MOV	R10,R16
    025EB 2300      TST	R16
    025EC F6B9      BNE	0x25C4
    025ED 96EF      ADIW	R28,0x3F
    025EE 96EF      ADIW	R28,0x3F
    025EF 96EF      ADIW	R28,0x3F
    025F0 96EF      ADIW	R28,0x3F
    025F1 96EF      ADIW	R28,0x3F
    025F2 96EF      ADIW	R28,0x3F
    025F3 96EF      ADIW	R28,0x3F
    025F4 96EF      ADIW	R28,0x3F
    025F5 9667      ADIW	R28,0x17
    025F6 9508      RET
_alwaysCheck:
  temp                 --> Y,+0
    025F7 940E 4B1C CALL	push_xgsetF000
    025F9 9724      SBIW	R28,4
(0085) 	 }
(0086) }
(0087) char alwaysCheck(void)
(0088) {
(0089)  static unsigned long last=0;
(0090)  float temp;
(0091)  RecDeal(); //zigbee data deal
    025FA 940E 3B22 CALL	_RecDeal
(0092)  if(config.now>last)
    025FC 9040 0129 LDS	R4,main.c:last+2
    025FE 9050 012A LDS	R5,main.c:last+3
    02600 9020 0127 LDS	R2,main.c:last
    02602 9030 0128 LDS	R3,main.c:last+1
    02604 9080 08BD LDS	R8,config+14
    02606 9090 08BE LDS	R9,config+15
    02608 9060 08BB LDS	R6,config+12
    0260A 9070 08BC LDS	R7,config+13
    0260C 1426      CP	R2,R6
    0260D 0437      CPC	R3,R7
    0260E 0448      CPC	R4,R8
    0260F 0459      CPC	R5,R9
    02610 F540      BCC	0x2639
(0093)  {   
(0094)  	 last=config.now+5;
    02611 E045      LDI	R20,5
    02612 E050      LDI	R21,0
    02613 E060      LDI	R22,0
    02614 E070      LDI	R23,0
    02615 0113      MOVW	R2,R6
    02616 0124      MOVW	R4,R8
    02617 0E24      ADD	R2,R20
    02618 1E35      ADC	R3,R21
    02619 1E46      ADC	R4,R22
    0261A 1E57      ADC	R5,R23
    0261B 9230 0128 STS	main.c:last+1,R3
    0261D 9220 0127 STS	main.c:last,R2
    0261F 9250 012A STS	main.c:last+3,R5
    02621 9240 0129 STS	main.c:last+2,R4
(0095)      temp= readWithoutDelay(INSIDE_SENSOR);
    02623 2700      CLR	R16
    02624 940E 4435 CALL	_readWithoutDelay
    02626 8308      ST	Y,R16
    02627 8319      STD	Y+1,R17
    02628 832A      STD	Y+2,R18
    02629 833B      STD	Y+3,R19
(0096)      if (temp>config.heatThreshold) {
    0262A 01CE      MOVW	R24,R28
    0262B 9100 08C3 LDS	R16,config+20
    0262D 2711      CLR	R17
    0262E 940E 4CB2 CALL	int2fp
    02630 939A      ST	-Y,R25
    02631 938A      ST	-Y,R24
    02632 940E 4E7C CALL	fpcmp1
    02634 F41C      BGE	0x2638
(0097)  	     RELAY_OFF(); //debug("off=",(int)temp);
    02635 98AD      CBI	0x15,5
(0098) 		 return 1;
    02636 E001      LDI	R16,1
    02637 C002      RJMP	0x263A
(0099)  	  }
(0100)       else  {
(0101)    	     RELAY_ON();//debug("on=",(int)temp);
    02638 9AAD      SBI	0x15,5
(0102) 	  } 
(0103)  }
(0104)  return 1;
    02639 E001      LDI	R16,1
    0263A 9624      ADIW	R28,4
    0263B 940C 4B21 JMP	pop_xgsetF000
_selfTest:
  str2                 --> Y,+14
  str1                 --> Y,+8
  tmp                  --> Y,+4
    0263D 92AA      ST	-Y,R10
    0263E 92BA      ST	-Y,R11
    0263F 9764      SBIW	R28,0x14
(0105) }
(0106) void selfTest(void){
(0107) 	float tmp=0;                                                                
    02640 EB0A      LDI	R16,0xBA
    02641 E010      LDI	R17,0
    02642 940E 4A8F CALL	elpm32
    02644 830C      STD	Y+4,R16
    02645 831D      STD	Y+5,R17
    02646 832E      STD	Y+6,R18
    02647 833F      STD	Y+7,R19
(0108) 	char str1[6],str2[6];
(0109) 	lp("┌──────┐");
    02648 E705      LDI	R16,0x75
    02649 E012      LDI	R17,2
    0264A 940E 41E7 CALL	_lp
(0110) 	lp("│  自检程序  │");
    0264C E604      LDI	R16,0x64
    0264D E012      LDI	R17,2
    0264E 940E 41E7 CALL	_lp
(0111) 	lp("│            │");
    02650 E503      LDI	R16,0x53
    02651 E012      LDI	R17,2
    02652 940E 41E7 CALL	_lp
(0112) 	lp("└──────┘");
    02654 E402      LDI	R16,0x42
    02655 E012      LDI	R17,2
    02656 940E 41E7 CALL	_lp
(0113) 	 //自检程序
(0114) 	delayms(500);
    02658 EF04      LDI	R16,0xF4
    02659 E011      LDI	R17,1
    0265A 940E 253A CALL	_delayms
(0115) 	lp("外部温度 ");
    0265C E308      LDI	R16,0x38
    0265D E012      LDI	R17,2
    0265E 940E 41E7 CALL	_lp
(0116) 	tmp=read_T_NUM(OUTSIDE_SENSOR);
    02660 E001      LDI	R16,1
    02661 940E 4417 CALL	_read_T_NUM
    02663 830C      STD	Y+4,R16
    02664 831D      STD	Y+5,R17
    02665 832E      STD	Y+6,R18
    02666 833F      STD	Y+7,R19
(0117) 	sprintf(str1,"%#0.1f",tmp);
    02667 802C      LDD	R2,Y+4
    02668 803D      LDD	R3,Y+5
    02669 804E      LDD	R4,Y+6
    0266A 805F      LDD	R5,Y+7
    0266B 8228      ST	Y,R2
    0266C 8239      STD	Y+1,R3
    0266D 824A      STD	Y+2,R4
    0266E 825B      STD	Y+3,R5
    0266F E321      LDI	R18,0x31
    02670 E032      LDI	R19,2
    02671 018E      MOVW	R16,R28
    02672 5F08      SUBI	R16,0xF8
    02673 4F1F      SBCI	R17,0xFF
    02674 940E 5284 CALL	_sprintf
(0118) 	str1[6]=0;
    02676 2422      CLR	R2
    02677 862E      STD	Y+14,R2
(0119) 	lp(str1);
    02678 018E      MOVW	R16,R28
    02679 5F08      SUBI	R16,0xF8
    0267A 4F1F      SBCI	R17,0xFF
    0267B 940E 41E7 CALL	_lp
(0120) 	delayms(500);
    0267D EF04      LDI	R16,0xF4
    0267E E011      LDI	R17,1
    0267F 940E 253A CALL	_delayms
(0121) 	lp("内部温度");
    02681 E208      LDI	R16,0x28
    02682 E012      LDI	R17,2
    02683 940E 41E7 CALL	_lp
(0122) 	tmp=read_T_NUM(INSIDE_SENSOR);
    02685 2700      CLR	R16
    02686 940E 4417 CALL	_read_T_NUM
    02688 830C      STD	Y+4,R16
    02689 831D      STD	Y+5,R17
    0268A 832E      STD	Y+6,R18
    0268B 833F      STD	Y+7,R19
(0123) 	sprintf(str2,"%#0.1f",tmp);
    0268C 802C      LDD	R2,Y+4
    0268D 803D      LDD	R3,Y+5
    0268E 804E      LDD	R4,Y+6
    0268F 805F      LDD	R5,Y+7
    02690 8228      ST	Y,R2
    02691 8239      STD	Y+1,R3
    02692 824A      STD	Y+2,R4
    02693 825B      STD	Y+3,R5
    02694 E321      LDI	R18,0x31
    02695 E032      LDI	R19,2
    02696 018E      MOVW	R16,R28
    02697 5F02      SUBI	R16,0xF2
    02698 4F1F      SBCI	R17,0xFF
    02699 940E 5284 CALL	_sprintf
(0124) 	str2[6]=0;
    0269B 2422      CLR	R2
    0269C 8A2C      STD	Y+20,R2
(0125) 	lp(str2);
    0269D 018E      MOVW	R16,R28
    0269E 5F02      SUBI	R16,0xF2
    0269F 4F1F      SBCI	R17,0xFF
    026A0 940E 41E7 CALL	_lp
(0126) 	delayms(500);
    026A2 EF04      LDI	R16,0xF4
    026A3 E011      LDI	R17,1
    026A4 940E 253A CALL	_delayms
(0127) 	lp("风速脉冲：");delayms(500);
    026A6 E10D      LDI	R16,0x1D
    026A7 E012      LDI	R17,2
    026A8 940E 41E7 CALL	_lp
    026AA EF04      LDI	R16,0xF4
    026AB E011      LDI	R17,1
    026AC 940E 253A CALL	_delayms
(0128) 	lp("蜂鸣器"); beep(2,2);delayms(500);
    026AE E106      LDI	R16,0x16
    026AF E012      LDI	R17,2
    026B0 940E 41E7 CALL	_lp
    026B2 E022      LDI	R18,2
    026B3 E002      LDI	R16,2
    026B4 940E 425F CALL	_beep
    026B6 EF04      LDI	R16,0xF4
    026B7 E011      LDI	R17,1
    026B8 940E 253A CALL	_delayms
(0129) 	lp("power 指示灯");
    026BA E009      LDI	R16,0x9
    026BB E012      LDI	R17,2
    026BC 940E 41E7 CALL	_lp
(0130) 	LED_OFF();delayms(100);LED_ON();delayms(100);
    026BE 9AA7      SBI	0x14,7
    026BF 98AF      CBI	0x15,7
    026C0 E604      LDI	R16,0x64
    026C1 E010      LDI	R17,0
    026C2 940E 253A CALL	_delayms
    026C4 9AA7      SBI	0x14,7
    026C5 9AAF      SBI	0x15,7
    026C6 E604      LDI	R16,0x64
    026C7 E010      LDI	R17,0
    026C8 940E 253A CALL	_delayms
(0131) 	LED_OFF();delayms(100);LED_ON();delayms(100);
    026CA 9AA7      SBI	0x14,7
    026CB 98AF      CBI	0x15,7
    026CC E604      LDI	R16,0x64
    026CD E010      LDI	R17,0
    026CE 940E 253A CALL	_delayms
    026D0 9AA7      SBI	0x14,7
    026D1 9AAF      SBI	0x15,7
    026D2 E604      LDI	R16,0x64
    026D3 E010      LDI	R17,0
    026D4 940E 253A CALL	_delayms
(0132) 	LED_OFF();delayms(100);LED_ON();delayms(100);
    026D6 9AA7      SBI	0x14,7
    026D7 98AF      CBI	0x15,7
    026D8 E604      LDI	R16,0x64
    026D9 E010      LDI	R17,0
    026DA 940E 253A CALL	_delayms
    026DC 9AA7      SBI	0x14,7
    026DD 9AAF      SBI	0x15,7
    026DE E604      LDI	R16,0x64
    026DF E010      LDI	R17,0
    026E0 940E 253A CALL	_delayms
(0133) 	delayms(500);
    026E2 EF04      LDI	R16,0xF4
    026E3 E011      LDI	R17,1
    026E4 940E 253A CALL	_delayms
(0134) 	lp("加热开关");
    026E6 E000      LDI	R16,0
    026E7 E012      LDI	R17,2
    026E8 940E 41E7 CALL	_lp
(0135) 	RELAY_ON();delayms(100);  
    026EA 9AAD      SBI	0x15,5
    026EB E604      LDI	R16,0x64
    026EC E010      LDI	R17,0
    026ED 940E 253A CALL	_delayms
(0136) 	RELAY_OFF();delayms(100);
    026EF 98AD      CBI	0x15,5
    026F0 E604      LDI	R16,0x64
    026F1 E010      LDI	R17,0
    026F2 940E 253A CALL	_delayms
(0137) 	RELAY_ON();delayms(100);
    026F4 9AAD      SBI	0x15,5
    026F5 E604      LDI	R16,0x64
    026F6 E010      LDI	R17,0
    026F7 940E 253A CALL	_delayms
(0138) 	RELAY_OFF();delayms(100);
    026F9 98AD      CBI	0x15,5
    026FA E604      LDI	R16,0x64
    026FB E010      LDI	R17,0
    026FC 940E 253A CALL	_delayms
(0139) 	lp("  ");delayms(500);
    026FE EF0D      LDI	R16,0xFD
    026FF E011      LDI	R17,1
    02700 940E 41E7 CALL	_lp
    02702 EF04      LDI	R16,0xF4
    02703 E011      LDI	R17,1
    02704 940E 253A CALL	_delayms
(0140) 	lp("                ");
    02706 EE0C      LDI	R16,0xEC
    02707 E011      LDI	R17,1
    02708 940E 41E7 CALL	_lp
(0141) 	lp("                ");
    0270A EE0C      LDI	R16,0xEC
    0270B E011      LDI	R17,1
    0270C 940E 41E7 CALL	_lp
(0142) 	lp("                ");
    0270E EE0C      LDI	R16,0xEC
    0270F E011      LDI	R17,1
    02710 940E 41E7 CALL	_lp
(0143) 	lp("                ");
    02712 EE0C      LDI	R16,0xEC
    02713 E011      LDI	R17,1
    02714 940E 41E7 CALL	_lp
(0144) 	delayms(100);
    02716 E604      LDI	R16,0x64
    02717 E010      LDI	R17,0
    02718 940E 253A CALL	_delayms
    0271A 9664      ADIW	R28,0x14
    0271B 90B9      LD	R11,Y+
    0271C 90A9      LD	R10,Y+
    0271D 9508      RET
_WriteFileHead:
  fs                   --> Y,+177
  bw                   --> Y,+175
  itam                 --> Y,+52
  fnamep               --> Y,+38
  file                 --> Y,+4
  res                  --> R10
    0271E 940E 4B0D CALL	push_xgset003C
    02720 97EF      SBIW	R28,0x3F
    02721 97EF      SBIW	R28,0x3F
    02722 97EF      SBIW	R28,0x3F
    02723 97EF      SBIW	R28,0x3F
    02724 97EF      SBIW	R28,0x3F
    02725 97EF      SBIW	R28,0x3F
    02726 97EF      SBIW	R28,0x3F
    02727 97EF      SBIW	R28,0x3F
    02728 97EF      SBIW	R28,0x3F
    02729 97EF      SBIW	R28,0x3F
    0272A 97EF      SBIW	R28,0x3F
    0272B 97AA      SBIW	R28,0x2A
(0145) 	  
(0146) }
(0147) 
(0148) void WriteFileHead(void)   
(0149) {
(0150)  	 unsigned int bw;
(0151) 	 FRESULT res;
(0152) 	 FATFS fs;
(0153) 	 FIL file;
(0154) 	 char fnamep[]="201201.xls\0\0\0"; 
    0272C E28B      LDI	R24,0x2B
    0272D E091      LDI	R25,1
    0272E 01FE      MOVW	R30,R28
    0272F 96B6      ADIW	R30,0x26
    02730 E00E      LDI	R16,0xE
    02731 E010      LDI	R17,0
    02732 93FA      ST	-Y,R31
    02733 93EA      ST	-Y,R30
    02734 939A      ST	-Y,R25
    02735 938A      ST	-Y,R24
    02736 940E 4BB7 CALL	asgnblk
(0155) 	 UINT8 itam[]="DEV000001\t\t\t\t\t\t\t\t\t\t\r\n序号\t日期\t时分\t温度\t风速\t风冷指数\t等价制冷温度\t相当温度\t冻伤危害性\t安静作业\t中等强度作业\t高强度作业\n\0";
    02738 E389      LDI	R24,0x39
    02739 E091      LDI	R25,1
    0273A 01FE      MOVW	R30,R28
    0273B 96F4      ADIW	R30,0x34
    0273C E70B      LDI	R16,0x7B
    0273D E010      LDI	R17,0
    0273E 93FA      ST	-Y,R31
    0273F 93EA      ST	-Y,R30
    02740 939A      ST	-Y,R25
    02741 938A      ST	-Y,R24
    02742 940E 4BB7 CALL	asgnblk
(0156) 	 res=disk_initialize(0);
    02744 2700      CLR	R16
    02745 940E 03C0 CALL	_disk_initialize
(0157) 	 res = f_mount(0, &fs);
    02747 019E      MOVW	R18,R28
    02748 542F      SUBI	R18,0x4F
    02749 4F3F      SBCI	R19,0xFF
    0274A 2700      CLR	R16
    0274B 940E 17AC CALL	_f_mount
(0158) 	 //get_name(fnamep)
(0159) 	 res = f_open(&file, get_name(fnamep) , FA_OPEN_ALWAYS | FA_WRITE );  //创建一个新的文件
    0274D 018E      MOVW	R16,R28
    0274E 5D0A      SUBI	R16,0xDA
    0274F 4F1F      SBCI	R17,0xFF
    02750 D521      RCALL	_get_name
    02751 0168      MOVW	R12,R16
    02752 E182      LDI	R24,0x12
    02753 8388      ST	Y,R24
    02754 0196      MOVW	R18,R12
    02755 018E      MOVW	R16,R28
    02756 5F0C      SUBI	R16,0xFC
    02757 4F1F      SBCI	R17,0xFF
    02758 940E 17D7 CALL	_f_open
(0160) 	 res = f_write(&file,itam,128,&bw);   //bw 已写入字节数
    0275A 01CE      MOVW	R24,R28
    0275B 5581      SUBI	R24,0x51
    0275C 4F9F      SBCI	R25,0xFF
    0275D 839B      STD	Y+3,R25
    0275E 838A      STD	Y+2,R24
    0275F E880      LDI	R24,0x80
    02760 E090      LDI	R25,0
    02761 8399      STD	Y+1,R25
    02762 8388      ST	Y,R24
    02763 019E      MOVW	R18,R28
    02764 5C2C      SUBI	R18,0xCC
    02765 4F3F      SBCI	R19,0xFF
    02766 018E      MOVW	R16,R28
    02767 5F0C      SUBI	R16,0xFC
    02768 4F1F      SBCI	R17,0xFF
    02769 940E 1BDE CALL	_f_write
    0276B 2EC0      MOV	R12,R16
    0276C 2CAC      MOV	R10,R12
(0161) 	 f_close(&file);
    0276D 018E      MOVW	R16,R28
    0276E 5F0C      SUBI	R16,0xFC
    0276F 4F1F      SBCI	R17,0xFF
    02770 940E 1FA8 CALL	_f_close
(0162) 	 f_mount(0, NULL);
    02772 2722      CLR	R18
    02773 2733      CLR	R19
    02774 2700      CLR	R16
    02775 940E 17AC CALL	_f_mount
    02777 96EF      ADIW	R28,0x3F
    02778 96EF      ADIW	R28,0x3F
    02779 96EF      ADIW	R28,0x3F
    0277A 96EF      ADIW	R28,0x3F
    0277B 96EF      ADIW	R28,0x3F
    0277C 96EF      ADIW	R28,0x3F
    0277D 96EF      ADIW	R28,0x3F
    0277E 96EF      ADIW	R28,0x3F
    0277F 96EF      ADIW	R28,0x3F
    02780 96EF      ADIW	R28,0x3F
    02781 96EF      ADIW	R28,0x3F
    02782 96AA      ADIW	R28,0x2A
    02783 940C 4AE7 JMP	pop_xgset003C
_WriteSDFile:
  fnamep               --> Y,+602
  fs                   --> Y,+44
  bw                   --> Y,+42
  lenth                --> Y,+38
  res                  --> R10
  file                 --> Y,+4
    02785 92AA      ST	-Y,R10
    02786 92CA      ST	-Y,R12
    02787 97EF      SBIW	R28,0x3F
    02788 97EF      SBIW	R28,0x3F
    02789 97EF      SBIW	R28,0x3F
    0278A 97EF      SBIW	R28,0x3F
    0278B 97EF      SBIW	R28,0x3F
    0278C 97EF      SBIW	R28,0x3F
    0278D 97EF      SBIW	R28,0x3F
    0278E 97EF      SBIW	R28,0x3F
    0278F 97EF      SBIW	R28,0x3F
    02790 97E0      SBIW	R28,0x30
(0163) } /////////////////////////////////////////////////
(0164) //       写入文件函数 
(0165) //(创建)打开文件 
(0166) // data 指向欲写入的的字符串 64byt 
(0167) //////////////////////////////////////////////// 
(0168) void WriteSDFile(void)   
(0169) {
(0170)     unsigned int bw;
(0171) 	FRESULT res;
(0172) 	FATFS fs;
(0173)     FIL file;
(0174) 	char fnamep[13];
(0175) 	long lenth=0;
    02791 E080      LDI	R24,0
    02792 A38E      STD	Y+38,R24
    02793 A38F      STD	Y+39,R24
    02794 A788      STD	Y+40,R24
    02795 A789      STD	Y+41,R24
(0176) 	disk_initialize(0);
    02796 2700      CLR	R16
    02797 940E 03C0 CALL	_disk_initialize
(0177) 	res = f_mount(0, &fs);
    02799 019E      MOVW	R18,R28
    0279A 5D24      SUBI	R18,0xD4
    0279B 4F3F      SBCI	R19,0xFF
    0279C 2700      CLR	R16
    0279D 940E 17AC CALL	_f_mount
(0178) 	res = f_open(&file,get_name(fnamep), FA_OPEN_ALWAYS | FA_WRITE );  //创建一个新的文件
    0279F 018E      MOVW	R16,R28
    027A0 5A06      SUBI	R16,0xA6
    027A1 4F1D      SBCI	R17,0xFD
    027A2 D4CF      RCALL	_get_name
    027A3 E182      LDI	R24,0x12
    027A4 8388      ST	Y,R24
    027A5 0198      MOVW	R18,R16
    027A6 018E      MOVW	R16,R28
    027A7 5F0C      SUBI	R16,0xFC
    027A8 4F1F      SBCI	R17,0xFF
    027A9 940E 17D7 CALL	_f_open
(0179) 	lenth=file.fsize;   
    027AB 842E      LDD	R2,Y+14
    027AC 843F      LDD	R3,Y+15
    027AD 8848      LDD	R4,Y+16
    027AE 8859      LDD	R5,Y+17
    027AF A22E      STD	Y+38,R2
    027B0 A23F      STD	Y+39,R3
    027B1 A648      STD	Y+40,R4
    027B2 A659      STD	Y+41,R5
(0180) 	res = f_lseek (&file,lenth);	 
    027B3 A02E      LDD	R2,Y+38
    027B4 A03F      LDD	R3,Y+39
    027B5 A448      LDD	R4,Y+40
    027B6 A459      LDD	R5,Y+41
    027B7 8248      ST	Y,R4
    027B8 8259      STD	Y+1,R5
    027B9 0191      MOVW	R18,R2
    027BA 018E      MOVW	R16,R28
    027BB 5F0C      SUBI	R16,0xFC
    027BC 4F1F      SBCI	R17,0xFF
    027BD 940E 1FB8 CALL	_f_lseek
(0181) 	res = f_write(&file,TempChar,SINGLE_ITEM_SIZE,&bw);   //bw 已写入字节数
    027BF 01CE      MOVW	R24,R28
    027C0 968A      ADIW	R24,0x2A
    027C1 839B      STD	Y+3,R25
    027C2 838A      STD	Y+2,R24
    027C3 E480      LDI	R24,0x40
    027C4 E090      LDI	R25,0
    027C5 8399      STD	Y+1,R25
    027C6 8388      ST	Y,R24
    027C7 EE2D      LDI	R18,0xED
    027C8 E035      LDI	R19,5
    027C9 018E      MOVW	R16,R28
    027CA 5F0C      SUBI	R16,0xFC
    027CB 4F1F      SBCI	R17,0xFF
    027CC 940E 1BDE CALL	_f_write
    027CE 2EC0      MOV	R12,R16
    027CF 2CAC      MOV	R10,R12
(0182) 	f_close(&file);
    027D0 018E      MOVW	R16,R28
    027D1 5F0C      SUBI	R16,0xFC
    027D2 4F1F      SBCI	R17,0xFF
    027D3 940E 1FA8 CALL	_f_close
(0183) 	f_mount(0, NULL);
    027D5 2722      CLR	R18
    027D6 2733      CLR	R19
    027D7 2700      CLR	R16
    027D8 940E 17AC CALL	_f_mount
    027DA 96EF      ADIW	R28,0x3F
    027DB 96EF      ADIW	R28,0x3F
    027DC 96EF      ADIW	R28,0x3F
    027DD 96EF      ADIW	R28,0x3F
    027DE 96EF      ADIW	R28,0x3F
    027DF 96EF      ADIW	R28,0x3F
    027E0 96EF      ADIW	R28,0x3F
    027E1 96EF      ADIW	R28,0x3F
    027E2 96EF      ADIW	R28,0x3F
    027E3 96E0      ADIW	R28,0x30
    027E4 90C9      LD	R12,Y+
    027E5 90A9      LD	R10,Y+
    027E6 9508      RET
_ReadSDFile:
  fs                   --> Y,+40
  bw                   --> Y,+38
  max                  --> R12
  file                 --> Y,+4
  res                  --> R20
  mode                 --> R22
  data                 --> R10
  index                --> R14
  fnamep               --> R12
    027E7 940E 4B07 CALL	push_xgsetF0FC
    027E9 0179      MOVW	R14,R18
    027EA 0168      MOVW	R12,R16
    027EB 97EF      SBIW	R28,0x3F
    027EC 97EF      SBIW	R28,0x3F
    027ED 97EF      SBIW	R28,0x3F
    027EE 97EF      SBIW	R28,0x3F
    027EF 97EF      SBIW	R28,0x3F
    027F0 97EF      SBIW	R28,0x3F
    027F1 97EF      SBIW	R28,0x3F
    027F2 97EF      SBIW	R28,0x3F
    027F3 97EF      SBIW	R28,0x3F
    027F4 976F      SBIW	R28,0x1F
    027F5 01FE      MOVW	R30,R28
    027F6 5AE0      SUBI	R30,0xA0
    027F7 4FFD      SBCI	R31,0xFD
    027F8 80A0      LD	R10,Z
    027F9 80B1      LDD	R11,Z+1
    027FA 01FE      MOVW	R30,R28
    027FB 59EE      SUBI	R30,0x9E
    027FC 4FFD      SBCI	R31,0xFD
    027FD 8160      LD	R22,Z
(0184) }
(0185) /////////////////////////////////////////////////
(0186) //       读取文件函数
(0187) //以64byte为一块 读取
(0188) //index数据偏移量   data读出后存放地
(0189) //////////////////////////////////////////////// 
(0190) char ReadSDFile(char *fnamep,int index, char *data, char mode)
(0191) {
(0192)  	unsigned int bw;
(0193) 	char res;
(0194) 	FATFS fs;
(0195)     FIL file;
(0196) 	static int indexoffset;
(0197) 	unsigned int max;
(0198) 	disk_initialize(0);
    027FE 2700      CLR	R16
    027FF 940E 03C0 CALL	_disk_initialize
(0199)     res = f_mount(0, &fs);
    02801 019E      MOVW	R18,R28
    02802 5D28      SUBI	R18,0xD8
    02803 4F3F      SBCI	R19,0xFF
    02804 2700      CLR	R16
    02805 940E 17AC CALL	_f_mount
(0200)     res = f_open(&file,fnamep,FA_READ);  
    02807 E081      LDI	R24,1
    02808 8388      ST	Y,R24
    02809 0196      MOVW	R18,R12
    0280A 018E      MOVW	R16,R28
    0280B 5F0C      SUBI	R16,0xFC
    0280C 4F1F      SBCI	R17,0xFF
    0280D 940E 17D7 CALL	_f_open
    0280F 2F40      MOV	R20,R16
(0201)     if(res==FR_NO_FILE) {
    02810 3004      CPI	R16,4
    02811 F419      BNE	0x2815
(0202) 	data=NULL;
    02812 24AA      CLR	R10
    02813 24BB      CLR	R11
(0203)     #if _debug >= 1 
(0204)     debug_out("now file",255);
(0205) 	debug_out(filename,res);
(0206) 	debug_out("file is no exist....",255);
(0207)     #endif 
(0208)     return res;
    02814 C078      RJMP	0x288D
(0209)     }   
(0210)     max = (file.fsize-128)/SINGLE_ITEM_SIZE;
    02815 E880      LDI	R24,0x80
    02816 E090      LDI	R25,0
    02817 E0A0      LDI	R26,0
    02818 E0B0      LDI	R27,0
    02819 850E      LDD	R16,Y+14
    0281A 851F      LDD	R17,Y+15
    0281B 8928      LDD	R18,Y+16
    0281C 8939      LDD	R19,Y+17
    0281D 1B08      SUB	R16,R24
    0281E 0B19      SBC	R17,R25
    0281F 0B2A      SBC	R18,R26
    02820 0B3B      SBC	R19,R27
    02821 E086      LDI	R24,6
    02822 E090      LDI	R25,0
    02823 938A      ST	-Y,R24
    02824 940E 4BAB CALL	lsr32
    02826 0168      MOVW	R12,R16
(0211) 	if(mode == 0){ //绝对位置模式
    02827 2366      TST	R22
    02828 F429      BNE	0x282E
(0212) 		indexoffset = index;
    02829 92F0 05EC STS	main.c:indexoffset+1,R15
    0282B 92E0 05EB STS	main.c:indexoffset,R14
(0213) 	}
    0282D C00C      RJMP	0x283A
(0214) 	else if(mode == 1){ //位置偏移模式
    0282E 3061      CPI	R22,1
    0282F F451      BNE	0x283A
(0215) 		indexoffset+=index;
    02830 9020 05EB LDS	R2,main.c:indexoffset
    02832 9030 05EC LDS	R3,main.c:indexoffset+1
    02834 0C2E      ADD	R2,R14
    02835 1C3F      ADC	R3,R15
    02836 9230 05EC STS	main.c:indexoffset+1,R3
    02838 9220 05EB STS	main.c:indexoffset,R2
(0216) 	}
(0217) 	if(indexoffset >max){
    0283A 9020 05EB LDS	R2,main.c:indexoffset
    0283C 9030 05EC LDS	R3,main.c:indexoffset+1
    0283E 14C2      CP	R12,R2
    0283F 04D3      CPC	R13,R3
    02840 F428      BCC	0x2846
(0218) 	    indexoffset = max;
    02841 92D0 05EC STS	main.c:indexoffset+1,R13
    02843 92C0 05EB STS	main.c:indexoffset,R12
(0219) 	}
    02845 C00F      RJMP	0x2855
(0220) 	else if(indexoffset <=0){
    02846 2422      CLR	R2
    02847 2433      CLR	R3
    02848 9040 05EB LDS	R4,main.c:indexoffset
    0284A 9050 05EC LDS	R5,main.c:indexoffset+1
    0284C 1424      CP	R2,R4
    0284D 0435      CPC	R3,R5
    0284E F034      BLT	0x2855
(0221) 		indexoffset = 1;
    0284F E081      LDI	R24,1
    02850 E090      LDI	R25,0
    02851 9390 05EC STS	main.c:indexoffset+1,R25
    02853 9380 05EB STS	main.c:indexoffset,R24
(0222) 	}
(0223) 	res = f_lseek (&file,(indexoffset-1)*SINGLE_ITEM_SIZE+128);	 //前两个字节数据为文件头空间 所以从第三块读/写起
    02855 9120 05EB LDS	R18,main.c:indexoffset
    02857 9130 05EC LDS	R19,main.c:indexoffset+1
    02859 E400      LDI	R16,0x40
    0285A E010      LDI	R17,0
    0285B 940E 4AA3 CALL	empy16s
    0285D 01C8      MOVW	R24,R16
    0285E 5480      SUBI	R24,0x40
    0285F 4090      SBCI	R25,0
    02860 5880      SUBI	R24,0x80
    02861 4F9F      SBCI	R25,0xFF
    02862 011C      MOVW	R2,R24
    02863 2444      CLR	R4
    02864 FC37      SBRC	R3,7
    02865 9440      COM	R4
    02866 2455      CLR	R5
    02867 FC47      SBRC	R4,7
    02868 9450      COM	R5
    02869 8248      ST	Y,R4
    0286A 8259      STD	Y+1,R5
    0286B 0191      MOVW	R18,R2
    0286C 018E      MOVW	R16,R28
    0286D 5F0C      SUBI	R16,0xFC
    0286E 4F1F      SBCI	R17,0xFF
    0286F 940E 1FB8 CALL	_f_lseek
    02871 2EC0      MOV	R12,R16
(0224)     res = f_read(&file,data,SINGLE_ITEM_SIZE,&bw);
    02872 01CE      MOVW	R24,R28
    02873 9686      ADIW	R24,0x26
    02874 839B      STD	Y+3,R25
    02875 838A      STD	Y+2,R24
    02876 E480      LDI	R24,0x40
    02877 E090      LDI	R25,0
    02878 8399      STD	Y+1,R25
    02879 8388      ST	Y,R24
    0287A 0195      MOVW	R18,R10
    0287B 018E      MOVW	R16,R28
    0287C 5F0C      SUBI	R16,0xFC
    0287D 4F1F      SBCI	R17,0xFF
    0287E 940E 1973 CALL	_f_read
    02880 2EA0      MOV	R10,R16
    02881 2D4A      MOV	R20,R10
(0225)     f_close(&file);
    02882 018E      MOVW	R16,R28
    02883 5F0C      SUBI	R16,0xFC
    02884 4F1F      SBCI	R17,0xFF
    02885 940E 1FA8 CALL	_f_close
(0226) 	f_mount(0, NULL);
    02887 2722      CLR	R18
    02888 2733      CLR	R19
    02889 2700      CLR	R16
    0288A 940E 17AC CALL	_f_mount
(0227) 	return res;
    0288C 2F04      MOV	R16,R20
    0288D 96EF      ADIW	R28,0x3F
    0288E 96EF      ADIW	R28,0x3F
    0288F 96EF      ADIW	R28,0x3F
    02890 96EF      ADIW	R28,0x3F
    02891 96EF      ADIW	R28,0x3F
    02892 96EF      ADIW	R28,0x3F
    02893 96EF      ADIW	R28,0x3F
    02894 96EF      ADIW	R28,0x3F
    02895 96EF      ADIW	R28,0x3F
    02896 966F      ADIW	R28,0x1F
    02897 940C 4AFC JMP	pop_xgsetF0FC
_findIndex:
  fs                   --> Y,+48
  bw                   --> Y,+46
  fnamep               --> R14
  readsize             --> R10
  res                  --> R12
  file                 --> Y,+12
  lenth                --> Y,+8
  index                --> Y,+4
  is_first_end         --> Y,+606
  tmp                  --> R10
  buf                  --> Y,+617
  filename             --> R10
    02899 933A      ST	-Y,R19
    0289A 932A      ST	-Y,R18
    0289B 940E 4B07 CALL	push_xgsetF0FC
    0289D 0158      MOVW	R10,R16
    0289E 97EF      SBIW	R28,0x3F
    0289F 97EF      SBIW	R28,0x3F
    028A0 97EF      SBIW	R28,0x3F
    028A1 97EF      SBIW	R28,0x3F
    028A2 97EF      SBIW	R28,0x3F
    028A3 97EF      SBIW	R28,0x3F
    028A4 97EF      SBIW	R28,0x3F
    028A5 97EF      SBIW	R28,0x3F
    028A6 97EF      SBIW	R28,0x3F
    028A7 97A8      SBIW	R28,0x28
(0228) } 
(0229) //////////////////////////////////
(0230) //   find index
(0231) // 检查当前文件尺寸，根据倒数第二个
(0232) //'\n'及其后面的index确定当前index值
(0233) //////////////////////////////////
(0234) unsigned int findIndex(char *filename,char *buf){
(0235)     unsigned int bw,tmp;
(0236) 	long index =0;
    028A8 E080      LDI	R24,0
    028A9 838C      STD	Y+4,R24
    028AA 838D      STD	Y+5,R24
    028AB 838E      STD	Y+6,R24
    028AC 838F      STD	Y+7,R24
(0237) 	unsigned char is_first_end=0;
    028AD 2400      CLR	R0
    028AE 01DE      MOVW	R26,R28
    028AF 5AA2      SUBI	R26,0xA2
    028B0 4FBD      SBCI	R27,0xFD
    028B1 920C      ST	X,R0
(0238) 	char *fnamep=filename;
    028B2 0175      MOVW	R14,R10
(0239) 	FRESULT res;
(0240) 	FATFS fs;
(0241) 	FIL file;
(0242) 	long lenth=0;
    028B3 E080      LDI	R24,0
    028B4 8788      STD	Y+8,R24
    028B5 8789      STD	Y+9,R24
    028B6 878A      STD	Y+10,R24
    028B7 878B      STD	Y+11,R24
(0243) 	int readsize=0;
    028B8 24AA      CLR	R10
    028B9 24BB      CLR	R11
(0244) 	//PrintString_n(fnamep);
(0245) 	res = f_mount(0, &fs);
    028BA 019E      MOVW	R18,R28
    028BB 5D20      SUBI	R18,0xD0
    028BC 4F3F      SBCI	R19,0xFF
    028BD 2700      CLR	R16
    028BE 940E 17AC CALL	_f_mount
(0246) 	res = f_open(&file,fnamep, FA_OPEN_ALWAYS | FA_READ );  //创建一个新的文件
    028C0 E181      LDI	R24,0x11
    028C1 8388      ST	Y,R24
    028C2 0197      MOVW	R18,R14
    028C3 018E      MOVW	R16,R28
    028C4 5F04      SUBI	R16,0xF4
    028C5 4F1F      SBCI	R17,0xFF
    028C6 940E 17D7 CALL	_f_open
    028C8 2EC0      MOV	R12,R16
(0247) 	if(res !=  FR_OK){ //openerror
    028C9 2300      TST	R16
    028CA F011      BEQ	0x28CD
(0248) 	    return res;}
    028CB 2711      CLR	R17
    028CC C110      RJMP	0x29DD
(0249) 	lenth=file.fsize;   //文件尾部为 file.size 
    028CD 882E      LDD	R2,Y+22
    028CE 883F      LDD	R3,Y+23
    028CF 8C48      LDD	R4,Y+24
    028D0 8C59      LDD	R5,Y+25
    028D1 8628      STD	Y+8,R2
    028D2 8639      STD	Y+9,R3
    028D3 864A      STD	Y+10,R4
    028D4 865B      STD	Y+11,R5
(0250) 	//debug("size=",0xff);
(0251) 	//PrintLong(lenth);
(0252) 	if(lenth > 512) {
    028D5 E040      LDI	R20,0
    028D6 E052      LDI	R21,2
    028D7 E060      LDI	R22,0
    028D8 E070      LDI	R23,0
    028D9 8428      LDD	R2,Y+8
    028DA 8439      LDD	R3,Y+9
    028DB 844A      LDD	R4,Y+10
    028DC 845B      LDD	R5,Y+11
    028DD 1542      CP	R20,R2
    028DE 0553      CPC	R21,R3
    028DF 0564      CPC	R22,R4
    028E0 0575      CPC	R23,R5
    028E1 F464      BGE	0x28EE
(0253) 	    readsize=512;
    028E2 E080      LDI	R24,0
    028E3 E092      LDI	R25,2
    028E4 015C      MOVW	R10,R24
(0254) 		lenth=file.fsize;
    028E5 882E      LDD	R2,Y+22
    028E6 883F      LDD	R3,Y+23
    028E7 8C48      LDD	R4,Y+24
    028E8 8C59      LDD	R5,Y+25
    028E9 8628      STD	Y+8,R2
    028EA 8639      STD	Y+9,R3
    028EB 864A      STD	Y+10,R4
    028EC 865B      STD	Y+11,R5
(0255) 	}
    028ED C007      RJMP	0x28F5
(0256) 	else {
(0257) 	    readsize =file.fsize;
    028EE 88AE      LDD	R10,Y+22
    028EF 88BF      LDD	R11,Y+23
(0258) 		lenth=0;
    028F0 E080      LDI	R24,0
    028F1 8788      STD	Y+8,R24
    028F2 8789      STD	Y+9,R24
    028F3 878A      STD	Y+10,R24
    028F4 878B      STD	Y+11,R24
(0259) 	}
(0260) 	res = f_lseek (&file,file.fsize-readsize);
    028F5 0115      MOVW	R2,R10
    028F6 2444      CLR	R4
    028F7 FC37      SBRC	R3,7
    028F8 9440      COM	R4
    028F9 2455      CLR	R5
    028FA FC47      SBRC	R4,7
    028FB 9450      COM	R5
    028FC 886E      LDD	R6,Y+22
    028FD 887F      LDD	R7,Y+23
    028FE 8C88      LDD	R8,Y+24
    028FF 8C99      LDD	R9,Y+25
    02900 1862      SUB	R6,R2
    02901 0873      SBC	R7,R3
    02902 0884      SBC	R8,R4
    02903 0895      SBC	R9,R5
    02904 8288      ST	Y,R8
    02905 8299      STD	Y+1,R9
    02906 0193      MOVW	R18,R6
    02907 018E      MOVW	R16,R28
    02908 5F04      SUBI	R16,0xF4
    02909 4F1F      SBCI	R17,0xFF
    0290A 940E 1FB8 CALL	_f_lseek
(0261) 	//debug("readSIZE=",0x00);
(0262) 	//PrintLong((file.fsize-readsize));
(0263) 	res = f_read(&file,buf,readsize,&bw);
    0290C 01CE      MOVW	R24,R28
    0290D 968E      ADIW	R24,0x2E
    0290E 839B      STD	Y+3,R25
    0290F 838A      STD	Y+2,R24
    02910 82B9      STD	Y+1,R11
    02911 82A8      ST	Y,R10
    02912 01FE      MOVW	R30,R28
    02913 59E7      SUBI	R30,0x97
    02914 4FFD      SBCI	R31,0xFD
    02915 8120      LD	R18,Z
    02916 8131      LDD	R19,Z+1
    02917 018E      MOVW	R16,R28
    02918 5F04      SUBI	R16,0xF4
    02919 4F1F      SBCI	R17,0xFF
    0291A 940E 1973 CALL	_f_read
    0291C 2EE0      MOV	R14,R16
    0291D 2CCE      MOV	R12,R14
(0264) 	f_close(&file);
    0291E 018E      MOVW	R16,R28
    0291F 5F04      SUBI	R16,0xF4
    02920 4F1F      SBCI	R17,0xFF
    02921 940E 1FA8 CALL	_f_close
(0265) 	//debug("readRES=",res);
(0266) 	//debug("readbw=",0X00);
(0267) 	//PrintLong(bw);
(0268) 	//PrintString_n(buf);
(0269) 	for(tmp=readsize;tmp>0;tmp--){
    02923 C040      RJMP	0x2964
(0270) 		//debug("buf index",buf[tmp]);
(0271) 		//PrintLong(tmp);
(0272) 		//if(buf[tmp] == '\n') Usart_Transmit('@');						  
(0273) 		if(buf[tmp] == '\n' && is_first_end== 0){
    02924 01F5      MOVW	R30,R10
    02925 01DE      MOVW	R26,R28
    02926 59A7      SUBI	R26,0x97
    02927 4FBD      SBCI	R27,0xFD
    02928 900D      LD	R0,X+
    02929 901C      LD	R1,X
    0292A 0DE0      ADD	R30,R0
    0292B 1DF1      ADC	R31,R1
    0292C 8180      LD	R24,Z
    0292D 308A      CPI	R24,0xA
    0292E F469      BNE	0x293C
    0292F 01FE      MOVW	R30,R28
    02930 5AE2      SUBI	R30,0xA2
    02931 4FFD      SBCI	R31,0xFD
    02932 8000      LD	R0,Z
    02933 2000      TST	R0
    02934 F439      BNE	0x293C
(0274) 		    is_first_end=1; 	
    02935 2400      CLR	R0
    02936 9403      INC	R0
    02937 01FE      MOVW	R30,R28
    02938 5AE2      SUBI	R30,0xA2
    02939 4FFD      SBCI	R31,0xFD
    0293A 8200      ST	Z,R0
(0275) 			//debug("first=",0xf0);					      
(0276) 		}
    0293B C025      RJMP	0x2961
(0277) 		else if(buf[tmp] == '\n' && is_first_end== 1){
    0293C 01F5      MOVW	R30,R10
    0293D 01DE      MOVW	R26,R28
    0293E 59A7      SUBI	R26,0x97
    0293F 4FBD      SBCI	R27,0xFD
    02940 900D      LD	R0,X+
    02941 901C      LD	R1,X
    02942 0DE0      ADD	R30,R0
    02943 1DF1      ADC	R31,R1
    02944 8180      LD	R24,Z
    02945 308A      CPI	R24,0xA
    02946 F4D1      BNE	0x2961
    02947 01DE      MOVW	R26,R28
    02948 5AA2      SUBI	R26,0xA2
    02949 4FBD      SBCI	R27,0xFD
    0294A 918C      LD	R24,X
    0294B 3081      CPI	R24,1
    0294C F4A1      BNE	0x2961
(0278) 		    lenth -= (512-tmp);
    0294D E080      LDI	R24,0
    0294E E092      LDI	R25,2
    0294F 011C      MOVW	R2,R24
    02950 182A      SUB	R2,R10
    02951 083B      SBC	R3,R11
    02952 2444      CLR	R4
    02953 2455      CLR	R5
    02954 8468      LDD	R6,Y+8
    02955 8479      LDD	R7,Y+9
    02956 848A      LDD	R8,Y+10
    02957 849B      LDD	R9,Y+11
    02958 1862      SUB	R6,R2
    02959 0873      SBC	R7,R3
    0295A 0884      SBC	R8,R4
    0295B 0895      SBC	R9,R5
    0295C 8668      STD	Y+8,R6
    0295D 8679      STD	Y+9,R7
    0295E 868A      STD	Y+10,R8
    0295F 869B      STD	Y+11,R9
(0279) 			break;
    02960 C009      RJMP	0x296A
    02961 01C5      MOVW	R24,R10
    02962 9701      SBIW	R24,1
    02963 015C      MOVW	R10,R24
    02964 20AA      TST	R10
    02965 F009      BEQ	0x2967
    02966 CFBD      RJMP	0x2924
    02967 20BB      TST	R11
    02968 F009      BEQ	0x296A
    02969 CFBA      RJMP	0x2924
(0280) 		} 						
(0281) 	}
(0282) 	//debug("start=",0X00); PrintLong(lenth);
(0283) 	if(lenth < 118 ){ 
    0296A E746      LDI	R20,0x76
    0296B E050      LDI	R21,0
    0296C E060      LDI	R22,0
    0296D E070      LDI	R23,0
    0296E 8428      LDD	R2,Y+8
    0296F 8439      LDD	R3,Y+9
    02970 844A      LDD	R4,Y+10
    02971 845B      LDD	R5,Y+11
    02972 1624      CP	R2,R20
    02973 0635      CPC	R3,R21
    02974 0646      CPC	R4,R22
    02975 0657      CPC	R5,R23
    02976 F434      BGE	0x297D
(0284)  		return 1;
    02977 E001      LDI	R16,1
    02978 E010      LDI	R17,0
    02979 C063      RJMP	0x29DD
(0285) 	}
(0286) 	else {
(0287) 		 //debug(">128 ",0X00);
(0288) 		 while(buf[tmp] <= '0' || buf[tmp] >= '9') tmp++;
    0297A 01C5      MOVW	R24,R10
    0297B 9601      ADIW	R24,1
    0297C 015C      MOVW	R10,R24
    0297D 01F5      MOVW	R30,R10
    0297E 01DE      MOVW	R26,R28
    0297F 59A7      SUBI	R26,0x97
    02980 4FBD      SBCI	R27,0xFD
    02981 900D      LD	R0,X+
    02982 901C      LD	R1,X
    02983 0DE0      ADD	R30,R0
    02984 1DF1      ADC	R31,R1
    02985 80E0      LD	R14,Z
    02986 24FF      CLR	R15
    02987 E380      LDI	R24,0x30
    02988 158E      CP	R24,R14
    02989 F780      BCC	0x297A
    0298A 2D8E      MOV	R24,R14
    0298B 3389      CPI	R24,0x39
    0298C F768      BCC	0x297A
    0298D C02F      RJMP	0x29BD
(0289) 		 //debug("nozero ",bw); PrintLong(tmp);
(0290) 		 while(buf[tmp] != 't' && buf[tmp] >= '0' && buf[tmp] <= '9'){
(0291) 		     index=index*10+(buf[tmp]-'0');
    0298E 01F5      MOVW	R30,R10
    0298F 01DE      MOVW	R26,R28
    02990 59A7      SUBI	R26,0x97
    02991 4FBD      SBCI	R27,0xFD
    02992 900D      LD	R0,X+
    02993 901C      LD	R1,X
    02994 0DE0      ADD	R30,R0
    02995 1DF1      ADC	R31,R1
    02996 8180      LD	R24,Z
    02997 2799      CLR	R25
    02998 97C0      SBIW	R24,0x30
    02999 011C      MOVW	R2,R24
    0299A 2444      CLR	R4
    0299B FC37      SBRC	R3,7
    0299C 9440      COM	R4
    0299D 2455      CLR	R5
    0299E FC47      SBRC	R4,7
    0299F 9450      COM	R5
    029A0 806C      LDD	R6,Y+4
    029A1 807D      LDD	R7,Y+5
    029A2 808E      LDD	R8,Y+6
    029A3 809F      LDD	R9,Y+7
    029A4 E04A      LDI	R20,0xA
    029A5 E050      LDI	R21,0
    029A6 E060      LDI	R22,0
    029A7 E070      LDI	R23,0
    029A8 929A      ST	-Y,R9
    029A9 928A      ST	-Y,R8
    029AA 927A      ST	-Y,R7
    029AB 926A      ST	-Y,R6
    029AC 018A      MOVW	R16,R20
    029AD 019B      MOVW	R18,R22
    029AE 940E 4AB3 CALL	empy32s|empy32u
    029B0 0138      MOVW	R6,R16
    029B1 0149      MOVW	R8,R18
    029B2 0C62      ADD	R6,R2
    029B3 1C73      ADC	R7,R3
    029B4 1C84      ADC	R8,R4
    029B5 1C95      ADC	R9,R5
    029B6 826C      STD	Y+4,R6
    029B7 827D      STD	Y+5,R7
    029B8 828E      STD	Y+6,R8
    029B9 829F      STD	Y+7,R9
(0292) 		 	 //Usart_Transmit(buf[tmp]);	
(0293) 		 	 tmp++;
    029BA 01C5      MOVW	R24,R10
    029BB 9601      ADIW	R24,1
    029BC 015C      MOVW	R10,R24
    029BD 01F5      MOVW	R30,R10
    029BE 01DE      MOVW	R26,R28
    029BF 59A7      SUBI	R26,0x97
    029C0 4FBD      SBCI	R27,0xFD
    029C1 900D      LD	R0,X+
    029C2 901C      LD	R1,X
    029C3 0DE0      ADD	R30,R0
    029C4 1DF1      ADC	R31,R1
    029C5 80E0      LD	R14,Z
    029C6 24FF      CLR	R15
    029C7 2D8E      MOV	R24,R14
    029C8 3784      CPI	R24,0x74
    029C9 F031      BEQ	0x29D0
    029CA 3380      CPI	R24,0x30
    029CB F020      BCS	0x29D0
    029CC E389      LDI	R24,0x39
    029CD 158E      CP	R24,R14
    029CE F008      BCS	0x29D0
    029CF CFBE      RJMP	0x298E
(0294) 		 }
(0295) 	}
(0296) 	//debug("index=",0X00);
(0297) 	//PrintLong(index+1);
(0298) 	return index+1;
    029D0 E041      LDI	R20,1
    029D1 E050      LDI	R21,0
    029D2 E060      LDI	R22,0
    029D3 E070      LDI	R23,0
    029D4 802C      LDD	R2,Y+4
    029D5 803D      LDD	R3,Y+5
    029D6 804E      LDD	R4,Y+6
    029D7 805F      LDD	R5,Y+7
    029D8 0E24      ADD	R2,R20
    029D9 1E35      ADC	R3,R21
    029DA 1E46      ADC	R4,R22
    029DB 1E57      ADC	R5,R23
    029DC 0181      MOVW	R16,R2
    029DD 96EF      ADIW	R28,0x3F
    029DE 96EF      ADIW	R28,0x3F
    029DF 96EF      ADIW	R28,0x3F
    029E0 96EF      ADIW	R28,0x3F
    029E1 96EF      ADIW	R28,0x3F
    029E2 96EF      ADIW	R28,0x3F
    029E3 96EF      ADIW	R28,0x3F
    029E4 96EF      ADIW	R28,0x3F
    029E5 96EF      ADIW	R28,0x3F
    029E6 96A8      ADIW	R28,0x28
    029E7 940E 4AFC CALL	pop_xgsetF0FC
    029E9 9622      ADIW	R28,2
    029EA 9508      RET
_Round:
  x                    --> Y,+0
    029EB 940E 49C2 CALL	push_arg4
(0299) }
(0300) float Round(float x){
(0301)     x=x*10;
    029ED EB06      LDI	R16,0xB6
    029EE E010      LDI	R17,0
    029EF 940E 4A8F CALL	elpm32
    029F1 01CE      MOVW	R24,R28
    029F2 939A      ST	-Y,R25
    029F3 938A      ST	-Y,R24
    029F4 940E 4E4D CALL	fpmule1
    029F6 8308      ST	Y,R16
    029F7 8319      STD	Y+1,R17
    029F8 832A      STD	Y+2,R18
    029F9 833B      STD	Y+3,R19
(0302) 	if(x >=0) x+=0.5;
    029FA 8028      LD	R2,Y
    029FB 8039      LDD	R3,Y+1
    029FC 804A      LDD	R4,Y+2
    029FD 805B      LDD	R5,Y+3
    029FE EB0A      LDI	R16,0xBA
    029FF E010      LDI	R17,0
    02A00 940E 4A8F CALL	elpm32
    02A02 933A      ST	-Y,R19
    02A03 932A      ST	-Y,R18
    02A04 931A      ST	-Y,R17
    02A05 930A      ST	-Y,R16
    02A06 0181      MOVW	R16,R2
    02A07 0192      MOVW	R18,R4
    02A08 940E 4E87 CALL	fpcmp2
    02A0A F0AC      BLT	0x2A20
    02A0B 8028      LD	R2,Y
    02A0C 8039      LDD	R3,Y+1
    02A0D 804A      LDD	R4,Y+2
    02A0E 805B      LDD	R5,Y+3
    02A0F EB02      LDI	R16,0xB2
    02A10 E010      LDI	R17,0
    02A11 940E 4A8F CALL	elpm32
    02A13 933A      ST	-Y,R19
    02A14 932A      ST	-Y,R18
    02A15 931A      ST	-Y,R17
    02A16 930A      ST	-Y,R16
    02A17 0181      MOVW	R16,R2
    02A18 0192      MOVW	R18,R4
    02A19 940E 4C43 CALL	fpadd2
    02A1B 8308      ST	Y,R16
    02A1C 8319      STD	Y+1,R17
    02A1D 832A      STD	Y+2,R18
    02A1E 833B      STD	Y+3,R19
    02A1F C014      RJMP	0x2A34
(0303) 	else x-=0.5;
    02A20 8028      LD	R2,Y
    02A21 8039      LDD	R3,Y+1
    02A22 804A      LDD	R4,Y+2
    02A23 805B      LDD	R5,Y+3
    02A24 EB02      LDI	R16,0xB2
    02A25 E010      LDI	R17,0
    02A26 940E 4A8F CALL	elpm32
    02A28 933A      ST	-Y,R19
    02A29 932A      ST	-Y,R18
    02A2A 931A      ST	-Y,R17
    02A2B 930A      ST	-Y,R16
    02A2C 0181      MOVW	R16,R2
    02A2D 0192      MOVW	R18,R4
    02A2E 940E 4C58 CALL	fpsub2
    02A30 8308      ST	Y,R16
    02A31 8319      STD	Y+1,R17
    02A32 832A      STD	Y+2,R18
    02A33 833B      STD	Y+3,R19
(0304) 	x=(int)x;
    02A34 8108      LD	R16,Y
    02A35 8119      LDD	R17,Y+1
    02A36 812A      LDD	R18,Y+2
    02A37 813B      LDD	R19,Y+3
    02A38 940E 4C7E CALL	fpint
    02A3A 940E 4CB2 CALL	int2fp
    02A3C 8308      ST	Y,R16
    02A3D 8319      STD	Y+1,R17
    02A3E 832A      STD	Y+2,R18
    02A3F 833B      STD	Y+3,R19
(0305) 	x=x/10.0;
    02A40 8028      LD	R2,Y
    02A41 8039      LDD	R3,Y+1
    02A42 804A      LDD	R4,Y+2
    02A43 805B      LDD	R5,Y+3
    02A44 EA0E      LDI	R16,0xAE
    02A45 E010      LDI	R17,0
    02A46 940E 4A8F CALL	elpm32
    02A48 933A      ST	-Y,R19
    02A49 932A      ST	-Y,R18
    02A4A 931A      ST	-Y,R17
    02A4B 930A      ST	-Y,R16
    02A4C 0181      MOVW	R16,R2
    02A4D 0192      MOVW	R18,R4
    02A4E 940E 4CDD CALL	fpdiv2
    02A50 8308      ST	Y,R16
    02A51 8319      STD	Y+1,R17
    02A52 832A      STD	Y+2,R18
    02A53 833B      STD	Y+3,R19
(0306) 	return x;
    02A54 8108      LD	R16,Y
    02A55 8119      LDD	R17,Y+1
    02A56 812A      LDD	R18,Y+2
    02A57 813B      LDD	R19,Y+3
    02A58 9624      ADIW	R28,4
    02A59 9508      RET
_check:
  WScounter            --> R10
  tmp                  --> R12
    02A5A 940E 4B0D CALL	push_xgset003C
    02A5C 9724      SBIW	R28,4
(0307) }
(0308) 
(0309) void check( void )
(0310) {
(0311)  unsigned char tmp;
(0312)  unsigned int WScounter;
(0313)  //检测风速
(0314)  //读计数器1 此步需严格按手册进行。
(0315)  tmp=SREG;
    02A5D B6CF      IN	R12,0x3F
(0316)  CLI();
    02A5E 94F8      BCLR	7
(0317)  WScounter=TCNT1H*256+TCNT1L;
    02A5F B52D      IN	R18,0x2D
    02A60 2733      CLR	R19
    02A61 E000      LDI	R16,0
    02A62 E011      LDI	R17,1
    02A63 940E 4AA3 CALL	empy16s
    02A65 0158      MOVW	R10,R16
    02A66 B42C      IN	R2,0x2C
    02A67 2433      CLR	R3
    02A68 0CA2      ADD	R10,R2
    02A69 1CB3      ADC	R11,R3
(0318)  SREG=tmp;
    02A6A BECF      OUT	0x3F,R12
(0319)  SEI();
    02A6B 9478      BSET	7
(0320)  //计算风速
(0321)  Result.WindSpeed=WScounter/N_per_Second;
    02A6C 0185      MOVW	R16,R10
    02A6D 940E 4CB0 CALL	uint2fp
    02A6F 0118      MOVW	R2,R16
    02A70 0129      MOVW	R4,R18
    02A71 EA0A      LDI	R16,0xAA
    02A72 E010      LDI	R17,0
    02A73 940E 4A8F CALL	elpm32
    02A75 933A      ST	-Y,R19
    02A76 932A      ST	-Y,R18
    02A77 931A      ST	-Y,R17
    02A78 930A      ST	-Y,R16
    02A79 0181      MOVW	R16,R2
    02A7A 0192      MOVW	R18,R4
    02A7B 940E 4CDD CALL	fpdiv2
    02A7D 9310 0671 STS	Result+52,R17
    02A7F 9300 0670 STS	Result+51,R16
    02A81 9330 0673 STS	Result+54,R19
    02A83 9320 0672 STS	Result+53,R18
(0322)  //四舍五入
(0323)  Result.WindSpeed=Round(Result.WindSpeed);
    02A85 DF65      RCALL	_Round
    02A86 9310 0671 STS	Result+52,R17
    02A88 9300 0670 STS	Result+51,R16
    02A8A 9330 0673 STS	Result+54,R19
    02A8C 9320 0672 STS	Result+53,R18
(0324)   //温度
(0325)  Result.Temperature=read_T_NUM(OUTSIDE_SENSOR); //读两次 避免出错
    02A8E E001      LDI	R16,1
    02A8F 940E 4417 CALL	_read_T_NUM
    02A91 9310 0667 STS	Result+42,R17
    02A93 9300 0666 STS	Result+41,R16
    02A95 9330 0669 STS	Result+44,R19
    02A97 9320 0668 STS	Result+43,R18
(0326)  Result.Temperature=read_T_NUM(OUTSIDE_SENSOR);
    02A99 E001      LDI	R16,1
    02A9A 940E 4417 CALL	_read_T_NUM
    02A9C 9310 0667 STS	Result+42,R17
    02A9E 9300 0666 STS	Result+41,R16
    02AA0 9330 0669 STS	Result+44,R19
    02AA2 9320 0668 STS	Result+43,R18
(0327)  //四舍五入
(0328)  Result.Temperature=Round(Result.Temperature);
    02AA4 DF46      RCALL	_Round
    02AA5 9310 0667 STS	Result+42,R17
    02AA7 9300 0666 STS	Result+41,R16
    02AA9 9330 0669 STS	Result+44,R19
    02AAB 9320 0668 STS	Result+43,R18
(0329)  //WCI风冷指数
(0330)   Result.WCI = 4.18 *(10*SquareRootFloat(Result.WindSpeed) + 10.45 -  Result.WindSpeed  ) *( 33 - Result.Temperature );
    02AAD 9120 0672 LDS	R18,Result+53
    02AAF 9130 0673 LDS	R19,Result+54
    02AB1 9100 0670 LDS	R16,Result+51
    02AB3 9110 0671 LDS	R17,Result+52
    02AB5 D1FB      RCALL	_SquareRootFloat
    02AB6 0118      MOVW	R2,R16
    02AB7 0129      MOVW	R4,R18
    02AB8 EA06      LDI	R16,0xA6
    02AB9 E010      LDI	R17,0
    02ABA 940E 4A8F CALL	elpm32
    02ABC 0138      MOVW	R6,R16
    02ABD 0149      MOVW	R8,R18
    02ABE EB06      LDI	R16,0xB6
    02ABF E010      LDI	R17,0
    02AC0 940E 4A8F CALL	elpm32
    02AC2 925A      ST	-Y,R5
    02AC3 924A      ST	-Y,R4
    02AC4 923A      ST	-Y,R3
    02AC5 922A      ST	-Y,R2
    02AC6 940E 4E57 CALL	fpmule2
    02AC8 0118      MOVW	R2,R16
    02AC9 0129      MOVW	R4,R18
    02ACA EA02      LDI	R16,0xA2
    02ACB E010      LDI	R17,0
    02ACC 940E 4A8F CALL	elpm32
    02ACE 933A      ST	-Y,R19
    02ACF 932A      ST	-Y,R18
    02AD0 931A      ST	-Y,R17
    02AD1 930A      ST	-Y,R16
    02AD2 0181      MOVW	R16,R2
    02AD3 0192      MOVW	R18,R4
    02AD4 940E 4C43 CALL	fpadd2
    02AD6 E780      LDI	R24,0x70
    02AD7 E096      LDI	R25,6
    02AD8 939A      ST	-Y,R25
    02AD9 938A      ST	-Y,R24
    02ADA 940E 4C63 CALL	fpsub1x
    02ADC 0183      MOVW	R16,R6
    02ADD 0194      MOVW	R18,R8
    02ADE 940E 4E57 CALL	fpmule2
    02AE0 0118      MOVW	R2,R16
    02AE1 0129      MOVW	R4,R18
    02AE2 E90E      LDI	R16,0x9E
    02AE3 E010      LDI	R17,0
    02AE4 940E 4A8F CALL	elpm32
    02AE6 E686      LDI	R24,0x66
    02AE7 E096      LDI	R25,6
    02AE8 939A      ST	-Y,R25
    02AE9 938A      ST	-Y,R24
    02AEA 940E 4C63 CALL	fpsub1x
    02AEC 0181      MOVW	R16,R2
    02AED 0192      MOVW	R18,R4
    02AEE 940E 4E57 CALL	fpmule2
    02AF0 9310 067A STS	Result+61,R17
    02AF2 9300 0679 STS	Result+60,R16
    02AF4 9330 067C STS	Result+63,R19
    02AF6 9320 067B STS	Result+62,R18
(0331)  //ECT等价制冷温度
(0332)  Result.ECT=33.0f - 0.01085f*Result.WCI;
    02AF8 E90E      LDI	R16,0x9E
    02AF9 E010      LDI	R17,0
    02AFA 940E 4A8F CALL	elpm32
    02AFC 0118      MOVW	R2,R16
    02AFD 0129      MOVW	R4,R18
    02AFE E90A      LDI	R16,0x9A
    02AFF E010      LDI	R17,0
    02B00 940E 4A8F CALL	elpm32
    02B02 E789      LDI	R24,0x79
    02B03 E096      LDI	R25,6
    02B04 939A      ST	-Y,R25
    02B05 938A      ST	-Y,R24
    02B06 940E 4E62 CALL	fpmule1x
    02B08 0181      MOVW	R16,R2
    02B09 0192      MOVW	R18,R4
    02B0A 940E 4C58 CALL	fpsub2
    02B0C 9310 0686 STS	Result+73,R17
    02B0E 9300 0685 STS	Result+72,R16
    02B10 9330 0688 STS	Result+75,R19
    02B12 9320 0687 STS	Result+74,R18
(0333)  //TEQ 相当温度
(0334)  Result.Teq = Result.Temperature +( (Result.Temperature -36)/10 ) * Result.WindSpeed ;
    02B14 9040 0668 LDS	R4,Result+43
    02B16 9050 0669 LDS	R5,Result+44
    02B18 9020 0666 LDS	R2,Result+41
    02B1A 9030 0667 LDS	R3,Result+42
    02B1C 0131      MOVW	R6,R2
    02B1D 0142      MOVW	R8,R4
    02B1E E906      LDI	R16,0x96
    02B1F E010      LDI	R17,0
    02B20 940E 4A8F CALL	elpm32
    02B22 933A      ST	-Y,R19
    02B23 932A      ST	-Y,R18
    02B24 931A      ST	-Y,R17
    02B25 930A      ST	-Y,R16
    02B26 0183      MOVW	R16,R6
    02B27 0194      MOVW	R18,R8
    02B28 940E 4C58 CALL	fpsub2
    02B2A 0138      MOVW	R6,R16
    02B2B 0149      MOVW	R8,R18
    02B2C EB06      LDI	R16,0xB6
    02B2D E010      LDI	R17,0
    02B2E 940E 4A8F CALL	elpm32
    02B30 933A      ST	-Y,R19
    02B31 932A      ST	-Y,R18
    02B32 931A      ST	-Y,R17
    02B33 930A      ST	-Y,R16
    02B34 0183      MOVW	R16,R6
    02B35 0194      MOVW	R18,R8
    02B36 940E 4CDD CALL	fpdiv2
    02B38 E780      LDI	R24,0x70
    02B39 E096      LDI	R25,6
    02B3A 939A      ST	-Y,R25
    02B3B 938A      ST	-Y,R24
    02B3C 940E 4E62 CALL	fpmule1x
    02B3E 0181      MOVW	R16,R2
    02B3F 0192      MOVW	R18,R4
    02B40 940E 4C43 CALL	fpadd2
    02B42 9310 0690 STS	Result+83,R17
    02B44 9300 068F STS	Result+82,R16
    02B46 9330 0692 STS	Result+85,R19
    02B48 9320 0691 STS	Result+84,R18
(0335) //将数据转换成字符串
(0336) sprintf(Result.WSChar, "%#.1lf", (float)Result.WindSpeed);
    02B4A 9040 0672 LDS	R4,Result+53
    02B4C 9050 0673 LDS	R5,Result+54
    02B4E 9020 0670 LDS	R2,Result+51
    02B50 9030 0671 LDS	R3,Result+52
    02B52 8228      ST	Y,R2
    02B53 8239      STD	Y+1,R3
    02B54 824A      STD	Y+2,R4
    02B55 825B      STD	Y+3,R5
    02B56 EE25      LDI	R18,0xE5
    02B57 E031      LDI	R19,1
    02B58 E704      LDI	R16,0x74
    02B59 E016      LDI	R17,6
    02B5A 940E 5284 CALL	_sprintf
(0337) sprintf(Result.TempChar, "%#.1lf", (float)Result.Temperature); //PrintString_n(Result.TempChar);
    02B5C 9040 0668 LDS	R4,Result+43
    02B5E 9050 0669 LDS	R5,Result+44
    02B60 9020 0666 LDS	R2,Result+41
    02B62 9030 0667 LDS	R3,Result+42
    02B64 8228      ST	Y,R2
    02B65 8239      STD	Y+1,R3
    02B66 824A      STD	Y+2,R4
    02B67 825B      STD	Y+3,R5
    02B68 EE25      LDI	R18,0xE5
    02B69 E031      LDI	R19,1
    02B6A E60A      LDI	R16,0x6A
    02B6B E016      LDI	R17,6
    02B6C 940E 5284 CALL	_sprintf
(0338) sprintf(Result.WCIChar, "%#.1lf",  (float)Result.WCI); //PrintString_n(Result.WCIChar);
    02B6E 9040 067B LDS	R4,Result+62
    02B70 9050 067C LDS	R5,Result+63
    02B72 9020 0679 LDS	R2,Result+60
    02B74 9030 067A LDS	R3,Result+61
    02B76 8228      ST	Y,R2
    02B77 8239      STD	Y+1,R3
    02B78 824A      STD	Y+2,R4
    02B79 825B      STD	Y+3,R5
    02B7A EE25      LDI	R18,0xE5
    02B7B E031      LDI	R19,1
    02B7C E70D      LDI	R16,0x7D
    02B7D E016      LDI	R17,6
    02B7E 940E 5284 CALL	_sprintf
(0339) sprintf(Result.ECTChar, "%#.1lf", (float)Result.ECT);  //PrintString_n(Result.ECTChar);
    02B80 9040 0687 LDS	R4,Result+74
    02B82 9050 0688 LDS	R5,Result+75
    02B84 9020 0685 LDS	R2,Result+72
    02B86 9030 0686 LDS	R3,Result+73
    02B88 8228      ST	Y,R2
    02B89 8239      STD	Y+1,R3
    02B8A 824A      STD	Y+2,R4
    02B8B 825B      STD	Y+3,R5
    02B8C EE25      LDI	R18,0xE5
    02B8D E031      LDI	R19,1
    02B8E E809      LDI	R16,0x89
    02B8F E016      LDI	R17,6
    02B90 940E 5284 CALL	_sprintf
(0340) sprintf(Result.TeqChar, "%#.1lf", (float)Result.Teq);
    02B92 9040 0691 LDS	R4,Result+84
    02B94 9050 0692 LDS	R5,Result+85
    02B96 9020 068F LDS	R2,Result+82
    02B98 9030 0690 LDS	R3,Result+83
    02B9A 8228      ST	Y,R2
    02B9B 8239      STD	Y+1,R3
    02B9C 824A      STD	Y+2,R4
    02B9D 825B      STD	Y+3,R5
    02B9E EE25      LDI	R18,0xE5
    02B9F E031      LDI	R19,1
    02BA0 E903      LDI	R16,0x93
    02BA1 E016      LDI	R17,6
    02BA2 940E 5284 CALL	_sprintf
(0341) sprintf(Result.IndexChar, "%d", Result.Index);
    02BA4 9040 0649 LDS	R4,Result+12
    02BA6 9050 064A LDS	R5,Result+13
    02BA8 9020 0647 LDS	R2,Result+10
    02BAA 9030 0648 LDS	R3,Result+11
    02BAC 8228      ST	Y,R2
    02BAD 8239      STD	Y+1,R3
    02BAE 824A      STD	Y+2,R4
    02BAF 825B      STD	Y+3,R5
    02BB0 EE22      LDI	R18,0xE2
    02BB1 E031      LDI	R19,1
    02BB2 E40B      LDI	R16,0x4B
    02BB3 E016      LDI	R17,6
    02BB4 940E 5284 CALL	_sprintf
(0342) Result.TempChar[6]='\0';
    02BB6 2422      CLR	R2
    02BB7 9220 0670 STS	Result+51,R2
(0343) Result.WSChar[5]='\0';
    02BB9 9220 0679 STS	Result+60,R2
(0344) Result.WCIChar[7]='\0';
    02BBB 9220 0684 STS	Result+71,R2
(0345) Result.ECTChar[6]='\0';
    02BBD 9220 068F STS	Result+82,R2
(0346) Result.TeqChar[6]='\0';
    02BBF 9220 0699 STS	Result+92,R2
(0347)  return ;
    02BC1 9624      ADIW	R28,4
    02BC2 940C 4AE7 JMP	pop_xgset003C
_StructToChar:
  otherbyte            --> Y,+16
  ary                  --> Y,+0
  i                    --> R10
    02BC4 92AA      ST	-Y,R10
    02BC5 9768      SBIW	R28,0x18
(0348) }
(0349) /*
(0350) ////////////////////////////////////////////
(0351) //				字符串转换函数
(0352) //   浮点 到  字符串
(0353) ////////////////////////////////////////////
(0354) void ftochr(float a,char * dest){//float
(0355) char i=0,j=0,lenth;
(0356) int status;
(0357) char *res;
(0358)  res=ftoa(a,&status);  //float to ascii
(0359) lenth=strlen(res);
(0360) 
(0361) for(i=0;i <lenth;i++) 
(0362)        {
(0363) 	   	dest[i]=res[i];
(0364) 
(0365) 		if( res[i]=='.'  ) 
(0366) 			{
(0367) 				dest[i+1]=res[i+1];
(0368) 					dest[i+2]='\0';
(0369) 						return ;    
(0370) 		    }
(0371)  
(0372)  		}
(0373) }
(0374) //////////////////////////////////////////////////////
(0375) //              整型数据变字符串
(0376) //    a  到  dest
(0377) ///////////////////////////////////////////////////////
(0378) void itochr(int a,char * dest){ //int to ascii
(0379) 	 itoa(dest,a,10); 
(0380) }
(0381) */
(0382) //////////////////////////////////////////////////////
(0383) //                  结构体 变字符串
(0384) // 将目前存于结构体的数据转换到Temp_Char中。
(0385) ///////////////////////////////////////////////////////
(0386) void  StructToChar(void)
(0387) { 
(0388)   unsigned char i;
(0389)   char otherbyte[]="0\t0\t0\t0";
    02BC6 EB84      LDI	R24,0xB4
    02BC7 E091      LDI	R25,1
    02BC8 01FE      MOVW	R30,R28
    02BC9 9670      ADIW	R30,0x10
    02BCA E008      LDI	R16,0x8
    02BCB E010      LDI	R17,0
    02BCC 93FA      ST	-Y,R31
    02BCD 93EA      ST	-Y,R30
    02BCE 939A      ST	-Y,R25
    02BCF 938A      ST	-Y,R24
    02BD0 940E 4BB7 CALL	asgnblk
(0390)   char *(ary[])={Result.IndexChar,Result.Date,Result.Time,
    02BD2 EB8C      LDI	R24,0xBC
    02BD3 E091      LDI	R25,1
    02BD4 01FE      MOVW	R30,R28
    02BD5 E100      LDI	R16,0x10
    02BD6 E010      LDI	R17,0
    02BD7 93FA      ST	-Y,R31
    02BD8 93EA      ST	-Y,R30
    02BD9 939A      ST	-Y,R25
    02BDA 938A      ST	-Y,R24
    02BDB 940E 4BB7 CALL	asgnblk
(0391)  	  			Result.TempChar,Result.WSChar,Result.WCIChar,Result.ECTChar,
(0392) 				Result.TeqChar
(0393) 			   };  //指向数组首地址的指针
(0394)   //strcat(Temp_Char,Result.Name);
(0395)   for(i=0;i<=80;i++) TempChar[i]='\0';  //清空数组
    02BDD 24AA      CLR	R10
    02BDE C009      RJMP	0x2BE8
    02BDF EE8D      LDI	R24,0xED
    02BE0 E095      LDI	R25,5
    02BE1 2DEA      MOV	R30,R10
    02BE2 27FF      CLR	R31
    02BE3 0FE8      ADD	R30,R24
    02BE4 1FF9      ADC	R31,R25
    02BE5 2422      CLR	R2
    02BE6 8220      ST	Z,R2
    02BE7 94A3      INC	R10
    02BE8 E580      LDI	R24,0x50
    02BE9 158A      CP	R24,R10
    02BEA F7A0      BCC	0x2BDF
(0396)     for(i=0;i<=7;i++){
    02BEB 24AA      CLR	R10
    02BEC C014      RJMP	0x2C01
(0397) 		strcat(TempChar,ary[i]);  // 按顺序复制字符串
    02BED 01CE      MOVW	R24,R28
    02BEE 2DEA      MOV	R30,R10
    02BEF 27FF      CLR	R31
    02BF0 0FEE      LSL	R30
    02BF1 1FFF      ROL	R31
    02BF2 0FE8      ADD	R30,R24
    02BF3 1FF9      ADC	R31,R25
    02BF4 8120      LD	R18,Z
    02BF5 8131      LDD	R19,Z+1
    02BF6 EE0D      LDI	R16,0xED
    02BF7 E015      LDI	R17,5
    02BF8 940E 49A9 CALL	_strcat
(0398) 		strcat(TempChar,tab);     // 字串结尾加上制表符
    02BFA E02F      LDI	R18,0xF
    02BFB E031      LDI	R19,1
    02BFC EE0D      LDI	R16,0xED
    02BFD E015      LDI	R17,5
    02BFE 940E 49A9 CALL	_strcat
    02C00 94A3      INC	R10
    02C01 E087      LDI	R24,7
    02C02 158A      CP	R24,R10
    02C03 F748      BCC	0x2BED
(0399)     }
(0400) 				 
(0401) 				 otherbyte[0]=otherbyte[0]+Result.WeiHai;
    02C04 9020 0699 LDS	R2,Result+92
    02C06 8838      LDD	R3,Y+16
    02C07 0C32      ADD	R3,R2
    02C08 8A38      STD	Y+16,R3
(0402) 				 otherbyte[2]=otherbyte[0]+Result.LowLabor;
    02C09 9020 069A LDS	R2,Result+93
    02C0B 0C32      ADD	R3,R2
    02C0C 8A3A      STD	Y+18,R3
(0403) 				 otherbyte[4]=otherbyte[0]+Result.MidLabor;
    02C0D 9020 069B LDS	R2,Result+94
    02C0F 8838      LDD	R3,Y+16
    02C10 0C32      ADD	R3,R2
    02C11 8A3C      STD	Y+20,R3
(0404) 				 otherbyte[6]=otherbyte[0]+Result.HighLabor;
    02C12 9020 069C LDS	R2,Result+95
    02C14 8838      LDD	R3,Y+16
    02C15 0C32      ADD	R3,R2
    02C16 8A3E      STD	Y+22,R3
(0405)  
(0406)   strcat(TempChar,otherbyte);  
    02C17 019E      MOVW	R18,R28
    02C18 5F20      SUBI	R18,0xF0
    02C19 4F3F      SBCI	R19,0xFF
    02C1A EE0D      LDI	R16,0xED
    02C1B E015      LDI	R17,5
    02C1C 940E 49A9 CALL	_strcat
(0407)   strcat(TempChar,enter);  
    02C1E E122      LDI	R18,0x12
    02C1F E031      LDI	R19,1
    02C20 EE0D      LDI	R16,0xED
    02C21 E015      LDI	R17,5
    02C22 940E 49A9 CALL	_strcat
(0408)   strcat(TempChar,"\0");
    02C24 EE20      LDI	R18,0xE0
    02C25 E031      LDI	R19,1
    02C26 EE0D      LDI	R16,0xED
    02C27 E015      LDI	R17,5
    02C28 940E 49A9 CALL	_strcat
    02C2A 9668      ADIW	R28,0x18
    02C2B 90A9      LD	R10,Y+
    02C2C 9508      RET
_CharToStruct:
  ary                  --> Y,+0
  j                    --> R12
  p                    --> R10
  q                    --> R20
  buf                  --> R14
    02C2D 940E 4B09 CALL	push_xgset30FC
    02C2F 0178      MOVW	R14,R16
    02C30 9760      SBIW	R28,0x10
(0409) }
(0410) 
(0411) //////////////////////////////////////////////////////
(0412) //               字符串  变  结构体
(0413) // 
(0414) ///////////////////////////////////////////////////////
(0415) void CharToStruct(char *buf)
(0416) {
(0417)   unsigned char j=0;
    02C31 24CC      CLR	R12
(0418)   unsigned char *p,*q;
(0419)   char *(ary[])={Result.IndexChar,Result.Date,Result.Time,
    02C32 EC8C      LDI	R24,0xCC
    02C33 E091      LDI	R25,1
    02C34 01FE      MOVW	R30,R28
    02C35 E100      LDI	R16,0x10
    02C36 E010      LDI	R17,0
    02C37 93FA      ST	-Y,R31
    02C38 93EA      ST	-Y,R30
    02C39 939A      ST	-Y,R25
    02C3A 938A      ST	-Y,R24
    02C3B 940E 4BB7 CALL	asgnblk
(0420)  	  			Result.TempChar,Result.WSChar,Result.WCIChar,Result.ECTChar,
(0421) 				Result.TeqChar
(0422) 			   };  //指向数组首地址的指针
(0423)     p=ary[j];
    02C3D 01CE      MOVW	R24,R28
    02C3E 2DEC      MOV	R30,R12
    02C3F 27FF      CLR	R31
    02C40 0FEE      LSL	R30
    02C41 1FFF      ROL	R31
    02C42 0FE8      ADD	R30,R24
    02C43 1FF9      ADC	R31,R25
    02C44 80A0      LD	R10,Z
    02C45 80B1      LDD	R11,Z+1
(0424) 	q=buf;
    02C46 01A7      MOVW	R20,R14
    02C47 C026      RJMP	0x2C6E
(0425) 	
(0426) 	while(1){
(0427)     if(*q =='\n') {*p='\0'; return;} ;
    02C48 01FA      MOVW	R30,R20
    02C49 8180      LD	R24,Z
    02C4A 308A      CPI	R24,0xA
    02C4B F421      BNE	0x2C50
    02C4C 2422      CLR	R2
    02C4D 01F5      MOVW	R30,R10
    02C4E 8220      ST	Z,R2
    02C4F C01F      RJMP	0x2C6F
(0428) 	if(*q =='\t') {
    02C50 01FA      MOVW	R30,R20
    02C51 8180      LD	R24,Z
    02C52 3089      CPI	R24,0x9
    02C53 F4A1      BNE	0x2C68
(0429) 		*p='\0';
    02C54 2422      CLR	R2
    02C55 01F5      MOVW	R30,R10
    02C56 8220      ST	Z,R2
(0430) 		q++;
    02C57 5F4F      SUBI	R20,0xFF
    02C58 4F5F      SBCI	R21,0xFF
(0431) 	    if(j>7) break ;
    02C59 E087      LDI	R24,7
    02C5A 158C      CP	R24,R12
    02C5B F408      BCC	0x2C5D
    02C5C C012      RJMP	0x2C6F
(0432) 		j++;
    02C5D 94C3      INC	R12
(0433) 		p=ary[j];
    02C5E 01CE      MOVW	R24,R28
    02C5F 2DEC      MOV	R30,R12
    02C60 27FF      CLR	R31
    02C61 0FEE      LSL	R30
    02C62 1FFF      ROL	R31
    02C63 0FE8      ADD	R30,R24
    02C64 1FF9      ADC	R31,R25
    02C65 80A0      LD	R10,Z
    02C66 80B1      LDD	R11,Z+1
(0434) 		continue ;
    02C67 C006      RJMP	0x2C6E
(0435) 	}
(0436)     *p++=*q++;
    02C68 01FA      MOVW	R30,R20
    02C69 01D5      MOVW	R26,R10
    02C6A 9001      LD	R0,Z+
    02C6B 01AF      MOVW	R20,R30
    02C6C 920D      ST	X+,R0
    02C6D 015D      MOVW	R10,R26
    02C6E CFD9      RJMP	0x2C48
    02C6F 9660      ADIW	R28,0x10
    02C70 940C 4AF3 JMP	pop_xgset30FC
_get_name:
  i                    --> R20
  filenamep            --> R16
    02C72 940E 4B1C CALL	push_xgsetF000
(0437) 	}
(0438) 	return ;
(0439) }
(0440)  
(0441)  ////////////////////////////////////////////
(0442) //				根据当前日期获取文件名
(0443) //   
(0444) ////////////////////////////////////////////
(0445) char *get_name( char filenamep[] ){     
(0446) 	  unsigned char i=0;
(0447)  	  for(i=0;i<6;i++) {
    02C74 2744      CLR	R20
    02C75 C00D      RJMP	0x2C83
(0448) 	  				    *(filenamep+i)=Result.Date[i];
    02C76 E583      LDI	R24,0x53
    02C77 E096      LDI	R25,6
    02C78 2FE4      MOV	R30,R20
    02C79 27FF      CLR	R31
    02C7A 0FE8      ADD	R30,R24
    02C7B 1FF9      ADC	R31,R25
    02C7C 8020      LD	R2,Z
    02C7D 2FE4      MOV	R30,R20
    02C7E 27FF      CLR	R31
    02C7F 0FE0      ADD	R30,R16
    02C80 1FF1      ADC	R31,R17
    02C81 8220      ST	Z,R2
    02C82 9543      INC	R20
    02C83 3046      CPI	R20,6
    02C84 F388      BCS	0x2C76
(0449) 	  				   } 
(0450) 	 	*(filenamep+(i++))='.';
    02C85 2E24      MOV	R2,R20
    02C86 2433      CLR	R3
    02C87 5F4F      SUBI	R20,0xFF
    02C88 2DE2      MOV	R30,R2
    02C89 27FF      CLR	R31
    02C8A 0FE0      ADD	R30,R16
    02C8B 1FF1      ADC	R31,R17
    02C8C E28E      LDI	R24,0x2E
    02C8D 8380      ST	Z,R24
(0451) 		*(filenamep+(i++))='x';
    02C8E 2E24      MOV	R2,R20
    02C8F 2433      CLR	R3
    02C90 5F4F      SUBI	R20,0xFF
    02C91 2DE2      MOV	R30,R2
    02C92 27FF      CLR	R31
    02C93 0FE0      ADD	R30,R16
    02C94 1FF1      ADC	R31,R17
    02C95 E788      LDI	R24,0x78
    02C96 8380      ST	Z,R24
(0452) 		*(filenamep+(i++))='l';
    02C97 2F64      MOV	R22,R20
    02C98 2777      CLR	R23
    02C99 5F4F      SUBI	R20,0xFF
    02C9A 2FE6      MOV	R30,R22
    02C9B 27FF      CLR	R31
    02C9C 0FE0      ADD	R30,R16
    02C9D 1FF1      ADC	R31,R17
    02C9E E68C      LDI	R24,0x6C
    02C9F 8380      ST	Z,R24
(0453) 		*(filenamep+(i++))='s';
    02CA0 2F64      MOV	R22,R20
    02CA1 2777      CLR	R23
    02CA2 5F4F      SUBI	R20,0xFF
    02CA3 2FE6      MOV	R30,R22
    02CA4 27FF      CLR	R31
    02CA5 0FE0      ADD	R30,R16
    02CA6 1FF1      ADC	R31,R17
    02CA7 E783      LDI	R24,0x73
    02CA8 8380      ST	Z,R24
(0454) 		*(filenamep+(i))='\0';
    02CA9 2FE4      MOV	R30,R20
    02CAA 27FF      CLR	R31
    02CAB 0FE0      ADD	R30,R16
    02CAC 1FF1      ADC	R31,R17
    02CAD 2422      CLR	R2
    02CAE 8220      ST	Z,R2
(0455) 					   
(0456)       return filenamep;
    02CAF 940C 4B21 JMP	pop_xgsetF000
_SquareRootFloat:
  f                    --> Y,+12
  x                    --> Y,+8
  i                    --> Y,+4
  y                    --> Y,+0
  number               --> Y,+20
    02CB1 940E 49C2 CALL	push_arg4
    02CB3 940E 4B1C CALL	push_xgsetF000
    02CB5 9760      SBIW	R28,0x10
(0457) } 
(0458) float SquareRootFloat(float number)
(0459) {
(0460)     long i;
(0461)     float x, y;
(0462)     const float f = 1.5F;
    02CB6 E902      LDI	R16,0x92
    02CB7 E010      LDI	R17,0
    02CB8 940E 4A8F CALL	elpm32
    02CBA 870C      STD	Y+12,R16
    02CBB 871D      STD	Y+13,R17
    02CBC 872E      STD	Y+14,R18
    02CBD 873F      STD	Y+15,R19
(0463)     x = number * 0.5F;
    02CBE E80E      LDI	R16,0x8E
    02CBF E010      LDI	R17,0
    02CC0 940E 4A8F CALL	elpm32
    02CC2 01CE      MOVW	R24,R28
    02CC3 9644      ADIW	R24,0x14
    02CC4 939A      ST	-Y,R25
    02CC5 938A      ST	-Y,R24
    02CC6 940E 4E4D CALL	fpmule1
    02CC8 8708      STD	Y+8,R16
    02CC9 8719      STD	Y+9,R17
    02CCA 872A      STD	Y+10,R18
    02CCB 873B      STD	Y+11,R19
(0464)     y  = number;
    02CCC 882C      LDD	R2,Y+20
    02CCD 883D      LDD	R3,Y+21
    02CCE 884E      LDD	R4,Y+22
    02CCF 885F      LDD	R5,Y+23
    02CD0 8228      ST	Y,R2
    02CD1 8239      STD	Y+1,R3
    02CD2 824A      STD	Y+2,R4
    02CD3 825B      STD	Y+3,R5
(0465)     i  = * ( long * ) &y;
    02CD4 01FE      MOVW	R30,R28
    02CD5 8020      LD	R2,Z
    02CD6 8031      LDD	R3,Z+1
    02CD7 8042      LDD	R4,Z+2
    02CD8 8053      LDD	R5,Z+3
    02CD9 822C      STD	Y+4,R2
    02CDA 823D      STD	Y+5,R3
    02CDB 824E      STD	Y+6,R4
    02CDC 825F      STD	Y+7,R5
(0466)     i  = 0x5f3759df - ( i >> 1 );  //卡马克
    02CDD 802C      LDD	R2,Y+4
    02CDE 803D      LDD	R3,Y+5
    02CDF 804E      LDD	R4,Y+6
    02CE0 805F      LDD	R5,Y+7
    02CE1 9455      ASR	R5
    02CE2 9447      ROR	R4
    02CE3 9437      ROR	R3
    02CE4 9427      ROR	R2
    02CE5 ED4F      LDI	R20,0xDF
    02CE6 E559      LDI	R21,0x59
    02CE7 E367      LDI	R22,0x37
    02CE8 E57F      LDI	R23,0x5F
    02CE9 1942      SUB	R20,R2
    02CEA 0953      SBC	R21,R3
    02CEB 0964      SBC	R22,R4
    02CEC 0975      SBC	R23,R5
    02CED 834C      STD	Y+4,R20
    02CEE 835D      STD	Y+5,R21
    02CEF 836E      STD	Y+6,R22
    02CF0 837F      STD	Y+7,R23
(0467)   //i  = 0x5f375a86 - ( i >> 1 );  //Lomont
(0468)     y  = * ( float * ) &i;
    02CF1 01FE      MOVW	R30,R28
    02CF2 9634      ADIW	R30,4
    02CF3 8020      LD	R2,Z
    02CF4 8031      LDD	R3,Z+1
    02CF5 8042      LDD	R4,Z+2
    02CF6 8053      LDD	R5,Z+3
    02CF7 8228      ST	Y,R2
    02CF8 8239      STD	Y+1,R3
    02CF9 824A      STD	Y+2,R4
    02CFA 825B      STD	Y+3,R5
(0469)     y  = y * ( f - ( x * y * y ) );
    02CFB 8028      LD	R2,Y
    02CFC 8039      LDD	R3,Y+1
    02CFD 804A      LDD	R4,Y+2
    02CFE 805B      LDD	R5,Y+3
    02CFF 846C      LDD	R6,Y+12
    02D00 847D      LDD	R7,Y+13
    02D01 848E      LDD	R8,Y+14
    02D02 849F      LDD	R9,Y+15
    02D03 8508      LDD	R16,Y+8
    02D04 8519      LDD	R17,Y+9
    02D05 852A      LDD	R18,Y+10
    02D06 853B      LDD	R19,Y+11
    02D07 01CE      MOVW	R24,R28
    02D08 939A      ST	-Y,R25
    02D09 938A      ST	-Y,R24
    02D0A 940E 4E4D CALL	fpmule1
    02D0C 01CE      MOVW	R24,R28
    02D0D 939A      ST	-Y,R25
    02D0E 938A      ST	-Y,R24
    02D0F 940E 4E62 CALL	fpmule1x
    02D11 0183      MOVW	R16,R6
    02D12 0194      MOVW	R18,R8
    02D13 940E 4C70 CALL	fpsub2x
    02D15 0181      MOVW	R16,R2
    02D16 0192      MOVW	R18,R4
    02D17 940E 4E57 CALL	fpmule2
    02D19 8308      ST	Y,R16
    02D1A 8319      STD	Y+1,R17
    02D1B 832A      STD	Y+2,R18
    02D1C 833B      STD	Y+3,R19
(0470)     y  = y * ( f - ( x * y * y ) );
    02D1D 8028      LD	R2,Y
    02D1E 8039      LDD	R3,Y+1
    02D1F 804A      LDD	R4,Y+2
    02D20 805B      LDD	R5,Y+3
    02D21 846C      LDD	R6,Y+12
    02D22 847D      LDD	R7,Y+13
    02D23 848E      LDD	R8,Y+14
    02D24 849F      LDD	R9,Y+15
    02D25 8508      LDD	R16,Y+8
    02D26 8519      LDD	R17,Y+9
    02D27 852A      LDD	R18,Y+10
    02D28 853B      LDD	R19,Y+11
    02D29 01CE      MOVW	R24,R28
    02D2A 939A      ST	-Y,R25
    02D2B 938A      ST	-Y,R24
    02D2C 940E 4E4D CALL	fpmule1
    02D2E 01CE      MOVW	R24,R28
    02D2F 939A      ST	-Y,R25
    02D30 938A      ST	-Y,R24
    02D31 940E 4E62 CALL	fpmule1x
    02D33 0183      MOVW	R16,R6
    02D34 0194      MOVW	R18,R8
    02D35 940E 4C70 CALL	fpsub2x
    02D37 0181      MOVW	R16,R2
    02D38 0192      MOVW	R18,R4
    02D39 940E 4E57 CALL	fpmule2
    02D3B 8308      ST	Y,R16
    02D3C 8319      STD	Y+1,R17
    02D3D 832A      STD	Y+2,R18
    02D3E 833B      STD	Y+3,R19
(0471)     return number * y;
    02D3F 890C      LDD	R16,Y+20
    02D40 891D      LDD	R17,Y+21
    02D41 892E      LDD	R18,Y+22
    02D42 893F      LDD	R19,Y+23
    02D43 01CE      MOVW	R24,R28
    02D44 939A      ST	-Y,R25
    02D45 938A      ST	-Y,R24
    02D46 940E 4E4D CALL	fpmule1
    02D48 9660      ADIW	R28,0x10
    02D49 940E 4B21 CALL	pop_xgsetF000
    02D4B 9624      ADIW	R28,4
    02D4C 9508      RET
_debug:
  str2                 --> Y,+0
  val                  --> Y,+6
  str                  --> Y,+4
    02D4D 940E 49C2 CALL	push_arg4
    02D4F 9724      SBIW	R28,4
(0472) } 
(0473) //
(0474) //###############################################################//
(0475) //debug
(0476) void debug(UINT8 *str,UINT8 val)
(0477) {
(0478)  UINT8 str2[4]={0,0,0,0};
    02D50 ED8C      LDI	R24,0xDC
    02D51 E091      LDI	R25,1
    02D52 01FE      MOVW	R30,R28
    02D53 E004      LDI	R16,4
    02D54 E010      LDI	R17,0
    02D55 93FA      ST	-Y,R31
    02D56 93EA      ST	-Y,R30
    02D57 939A      ST	-Y,R25
    02D58 938A      ST	-Y,R24
    02D59 940E 4BB7 CALL	asgnblk
(0479)  str=str;
(0480)  val=val;
    02D5B 9628      ADIW	R28,0x8
    02D5C 9508      RET
_SD_Write_cmd:
  k                    --> R22
  temp                 --> R20
  p                    --> R20
    02D5D 940E 4B1C CALL	push_xgsetF000
    02D5F 01A8      MOVW	R20,R16
FILE: D:\LQD\software\software_src\sd.c
(0001) //*****************************************************************************//
(0002) //*								数码相框
(0003) //*控制芯片：ATmgea128
(0004) //*开发环境：AVR Studio+GCC
(0005) //*隶属模块：SD卡控制
(0006) //*修改者：  桃子
(0007) //*****************************************************************************//
(0008) #include "sd.h"
(0009) 
(0010) //****************************************************************
(0011) //*隶属模块：SD卡控制
(0012) //*函数功能：写6字节数据
(0013) //****************************************************************
(0014) UINT8 SD_Write_cmd(UINT8 *p)
(0015) {	
(0016) 	UINT16 temp,k=0;
    02D60 2766      CLR	R22
    02D61 2777      CLR	R23
(0017) 	SD_CS_DIS();//禁止SPI
    02D62 9AC0      SBI	0x18,0
(0018) 	SPI_Read();//空读一字节
    02D63 940E 3EA8 CALL	_SPI_Read
(0019) 	SD_CS_EN();//使能SPI
    02D65 98C0      CBI	0x18,0
(0020) 
(0021) 	SPI_Write(p[0]);
    02D66 01FA      MOVW	R30,R20
    02D67 8100      LD	R16,Z
    02D68 940E 3EA4 CALL	_SPI_Write
(0022) 	SPI_Write(p[1]);
    02D6A 01FA      MOVW	R30,R20
    02D6B 8101      LDD	R16,Z+1
    02D6C 940E 3EA4 CALL	_SPI_Write
(0023) 	SPI_Write(p[2]);
    02D6E 01FA      MOVW	R30,R20
    02D6F 8102      LDD	R16,Z+2
    02D70 940E 3EA4 CALL	_SPI_Write
(0024) 	SPI_Write(p[3]);
    02D72 01FA      MOVW	R30,R20
    02D73 8103      LDD	R16,Z+3
    02D74 940E 3EA4 CALL	_SPI_Write
(0025) 	SPI_Write(p[4]);
    02D76 01FA      MOVW	R30,R20
    02D77 8104      LDD	R16,Z+4
    02D78 940E 3EA4 CALL	_SPI_Write
(0026) 	SPI_Write(p[5]);
    02D7A 01FA      MOVW	R30,R20
    02D7B 8105      LDD	R16,Z+5
    02D7C 940E 3EA4 CALL	_SPI_Write
(0027) 
(0028) 	do 
(0029)  	{  
(0030)   		temp = SPI_Read();//一直读，直到读到的不是0xff或超时
    02D7E 940E 3EA8 CALL	_SPI_Read
    02D80 2F40      MOV	R20,R16
    02D81 2755      CLR	R21
(0031)  		k++;
    02D82 5F6F      SUBI	R22,0xFF
    02D83 4F7F      SBCI	R23,0xFF
(0032)  	}while((temp==0xff)&&(k<TRY_TIME)); 
    02D84 3F4F      CPI	R20,0xFF
    02D85 E0E0      LDI	R30,0
    02D86 075E      CPC	R21,R30
    02D87 F421      BNE	0x2D8C
    02D88 3164      CPI	R22,0x14
    02D89 E0E0      LDI	R30,0
    02D8A 077E      CPC	R23,R30
    02D8B F390      BCS	0x2D7E
(0033) 
(0034) 	return temp;
    02D8C 2F04      MOV	R16,R20
    02D8D 940C 4B21 JMP	pop_xgsetF000
_SD_Init:
  pcmd                 --> Y,+0
  temp                 --> R22
  time                 --> R20
    02D8F 940E 4B26 CALL	push_xgsetF00C
    02D91 9726      SBIW	R28,6
(0035) }
(0036) //****************************************************************
(0037) //*隶属模块：SD卡控制
(0038) //*函数功能：初始化
(0039) //****************************************************************
(0040) UINT8 SD_Init(void)	
(0041) {  
(0042) 	UINT8 time=0,temp=0;
    02D92 2744      CLR	R20
    02D93 2766      CLR	R22
(0043) 	UINT8 pcmd[] = {0x40,0x00,0x00,0x00,0x00,0x95}; //命令0的字节序列
    02D94 E886      LDI	R24,0x86
    02D95 E092      LDI	R25,2
    02D96 01FE      MOVW	R30,R28
    02D97 E006      LDI	R16,6
    02D98 E010      LDI	R17,0
    02D99 93FA      ST	-Y,R31
    02D9A 93EA      ST	-Y,R30
    02D9B 939A      ST	-Y,R25
    02D9C 938A      ST	-Y,R24
    02D9D 940E 4BB7 CALL	asgnblk
(0044) 	if(SD_DET()==0) return 0x02; //no disk
    02D9F B181      IN	R24,0x01
    02DA0 9586      LSR	R24
    02DA1 9586      LSR	R24
    02DA2 9586      LSR	R24
    02DA3 9586      LSR	R24
    02DA4 9586      LSR	R24
    02DA5 7081      ANDI	R24,1
    02DA6 F421      BNE	0x2DAB
    02DA7 E081      LDI	R24,1
    02DA8 E090      LDI	R25,0
    02DA9 015C      MOVW	R10,R24
    02DAA C002      RJMP	0x2DAD
    02DAB 24AA      CLR	R10
    02DAC 24BB      CLR	R11
    02DAD 20AA      TST	R10
    02DAE F421      BNE	0x2DB3
    02DAF 20BB      TST	R11
    02DB0 F411      BNE	0x2DB3
    02DB1 E002      LDI	R16,2
    02DB2 C039      RJMP	0x2DEC
(0045) 	SD_PORT |= (1<<SD_CS);
    02DB3 9AC0      SBI	0x18,0
(0046) 	SD_DDR |= (1<<SD_CS);
    02DB4 9AB8      SBI	0x17,0
(0047) 
(0048) 	SPI_IO_Init();
    02DB5 940E 3E9A CALL	_SPI_IO_Init
(0049) 	SPI_Low();
    02DB7 E582      LDI	R24,0x52
    02DB8 B98D      OUT	0x0D,R24
    02DB9 B18E      IN	R24,0x0E
    02DBA 7F8F      ANDI	R24,0xFF
    02DBB B98E      OUT	0x0E,R24
(0050) 
(0051) 	SD_CS_DIS();  //关闭片选 
    02DBC 9AC0      SBI	0x18,0
(0052) 	for(time=0;time<10;time++) //初始时，首先要发送最少74个时钟信号，这是必须的！！！
    02DBD 2744      CLR	R20
    02DBE C003      RJMP	0x2DC2
(0053) 	{
(0054)   		SPI_Read(); 
    02DBF 940E 3EA8 CALL	_SPI_Read
    02DC1 9543      INC	R20
    02DC2 304A      CPI	R20,0xA
    02DC3 F3D8      BCS	0x2DBF
(0055) 	}
(0056) 	SD_CS_EN(); //打开片选
    02DC4 98C0      CBI	0x18,0
(0057) 	time = 0;
    02DC5 2744      CLR	R20
(0058) 	do
(0059) 	{ 
(0060) 		temp=SD_Write_cmd(pcmd);//写入CMD0
    02DC6 018E      MOVW	R16,R28
    02DC7 DF95      RCALL	_SD_Write_cmd
    02DC8 2F60      MOV	R22,R16
(0061) 	 	time++;
    02DC9 9543      INC	R20
(0062) 	 	if(time==TRY_TIME) 
    02DCA 3144      CPI	R20,0x14
    02DCB F419      BNE	0x2DCF
(0063) 	 	{ 
(0064) 	  		SD_CS_DIS(); //关闭片选
    02DCC 9AC0      SBI	0x18,0
(0065) 	  		return(INIT_CMD0_ERROR);//CMD0写入失败
    02DCD E001      LDI	R16,1
    02DCE C01D      RJMP	0x2DEC
(0066) 	 	}
(0067) 	 }while(temp!=0x01);
    02DCF 3061      CPI	R22,1
    02DD0 F7A9      BNE	0x2DC6
(0068) 
(0069) 	SD_CS_DIS(); //关闭片选
    02DD1 9AC0      SBI	0x18,0
(0070) 	SPI_Read(); //按照SD卡的操作时序在这里补8个时钟 
    02DD2 940E 3EA8 CALL	_SPI_Read
(0071) 	SD_CS_EN(); //打开片选
    02DD4 98C0      CBI	0x18,0
(0072) 
(0073) 	pcmd[0]=0x41,pcmd[5]=0xff;
    02DD5 E481      LDI	R24,0x41
    02DD6 8388      ST	Y,R24
    02DD7 EF8F      LDI	R24,0xFF
    02DD8 838D      STD	Y+5,R24
(0074) 	time = 0;
    02DD9 2744      CLR	R20
(0075) 	do
(0076) 	{ 
(0077) 		temp=SD_Write_cmd(pcmd);
    02DDA 018E      MOVW	R16,R28
    02DDB DF81      RCALL	_SD_Write_cmd
    02DDC 2F60      MOV	R22,R16
(0078) 		time++;
    02DDD 9543      INC	R20
(0079) 		if(time==TRY_TIME) 
    02DDE 3144      CPI	R20,0x14
    02DDF F419      BNE	0x2DE3
(0080) 		{ 
(0081) 		 	SD_CS_DIS(); //关闭片选
    02DE0 9AC0      SBI	0x18,0
(0082) 			 return(INIT_CMD1_ERROR);//CMD1写入失败
    02DE1 E002      LDI	R16,2
    02DE2 C009      RJMP	0x2DEC
(0083) 		 }
(0084) 	 }while(temp!=0);
    02DE3 2366      TST	R22
    02DE4 F7A9      BNE	0x2DDA
(0085)   
(0086) 	 SPI_High();  
    02DE5 E580      LDI	R24,0x50
    02DE6 B98D      OUT	0x0D,R24
    02DE7 9A70      SBI	0x0E,0
(0087) 	 SD_CS_DIS();  //关闭片选 
    02DE8 9AC0      SBI	0x18,0
(0088) 	 SPI_Read(); //按照SD卡的操作时序在这里补8个时钟
    02DE9 940E 3EA8 CALL	_SPI_Read
(0089) 	 return SD_TURE; //返回0,说明初始化操作成功
    02DEB 2700      CLR	R16
    02DEC 9626      ADIW	R28,6
    02DED 940C 4B2D JMP	pop_xgsetF00C
_SD_Write_Sector:
  pcmd                 --> Y,+0
  time                 --> R12
  temp                 --> R20
  i                    --> R22
  buffer               --> R10
  addr                 --> Y,+14
    02DEF 940E 49C2 CALL	push_arg4
    02DF1 940E 4B42 CALL	push_xgsetF03C
    02DF3 9726      SBIW	R28,6
    02DF4 88AA      LDD	R10,Y+18
    02DF5 88BB      LDD	R11,Y+19
(0090) } 
(0091) //****************************************************************
(0092) //*隶属模块：SD卡控制
(0093) //*函数功能：写512字节数据（一扇区字节）
(0094) //****************************************************************
(0095) UINT16 SD_Write_Sector(UINT32 addr,UINT8 *buffer)
(0096) {  
(0097) 	UINT8 temp=0,time=0;
    02DF6 2744      CLR	R20
    02DF7 24CC      CLR	R12
(0098) 	UINT16 i=0;
    02DF8 2766      CLR	R22
    02DF9 2777      CLR	R23
(0099) 	UINT8 pcmd[] = {0x58,0x00,0x00,0x00,0x00,0xff}; //向SD卡中单个块（512字节，一个扇区）写入数据，用CMD24
    02DFA E88C      LDI	R24,0x8C
    02DFB E092      LDI	R25,2
    02DFC 01FE      MOVW	R30,R28
    02DFD E006      LDI	R16,6
    02DFE E010      LDI	R17,0
    02DFF 93FA      ST	-Y,R31
    02E00 93EA      ST	-Y,R30
    02E01 939A      ST	-Y,R25
    02E02 938A      ST	-Y,R24
    02E03 940E 4BB7 CALL	asgnblk
(0100) 
(0101) 	 addr<<=9; //将块地址（扇区地址）转为字节地址 ［这里就限制了SD卡的最大容量为4G］
    02E05 E089      LDI	R24,0x9
    02E06 E090      LDI	R25,0
    02E07 850E      LDD	R16,Y+14
    02E08 851F      LDD	R17,Y+15
    02E09 8928      LDD	R18,Y+16
    02E0A 8939      LDD	R19,Y+17
    02E0B 938A      ST	-Y,R24
    02E0C 940E 4B92 CALL	lsl32
    02E0E 870E      STD	Y+14,R16
    02E0F 871F      STD	Y+15,R17
    02E10 8B28      STD	Y+16,R18
    02E11 8B39      STD	Y+17,R19
(0102) 
(0103) 	 pcmd[1]=(addr>>24); //将字节地址写入到CMD24字节序列中
    02E12 E188      LDI	R24,0x18
    02E13 E090      LDI	R25,0
    02E14 850E      LDD	R16,Y+14
    02E15 851F      LDD	R17,Y+15
    02E16 8928      LDD	R18,Y+16
    02E17 8939      LDD	R19,Y+17
    02E18 938A      ST	-Y,R24
    02E19 940E 4BAB CALL	lsr32
    02E1B 8309      STD	Y+1,R16
(0104) 	 pcmd[2]=(addr>>16);
    02E1C 842E      LDD	R2,Y+14
    02E1D 843F      LDD	R3,Y+15
    02E1E 8848      LDD	R4,Y+16
    02E1F 8859      LDD	R5,Y+17
    02E20 0112      MOVW	R2,R4
    02E21 2444      CLR	R4
    02E22 2455      CLR	R5
    02E23 822A      STD	Y+2,R2
(0105) 	 pcmd[3]=(addr>>8);
    02E24 E088      LDI	R24,0x8
    02E25 E090      LDI	R25,0
    02E26 850E      LDD	R16,Y+14
    02E27 851F      LDD	R17,Y+15
    02E28 8928      LDD	R18,Y+16
    02E29 8939      LDD	R19,Y+17
    02E2A 938A      ST	-Y,R24
    02E2B 940E 4BAB CALL	lsr32
    02E2D 830B      STD	Y+3,R16
(0106) 	// pcmd[4]=offset;	
(0107) 	 SD_CS_EN();//打开SD卡片选
    02E2E 98C0      CBI	0x18,0
(0108) 
(0109) 	 do
(0110) 	 {  
(0111) 		temp=SD_Write_cmd(pcmd);
    02E2F 018E      MOVW	R16,R28
    02E30 DF2C      RCALL	_SD_Write_cmd
    02E31 2F40      MOV	R20,R16
(0112)   		time++;
    02E32 94C3      INC	R12
(0113)   		if(time==TRY_TIME) 
    02E33 2D8C      MOV	R24,R12
    02E34 3184      CPI	R24,0x14
    02E35 F419      BNE	0x2E39
(0114)   		{ 
(0115)    			SD_CS_DIS(); //关闭片选
    02E36 9AC0      SBI	0x18,0
(0116)    			return(temp); //命令写入失败
    02E37 2711      CLR	R17
    02E38 C037      RJMP	0x2E70
(0117)   		}
(0118) 	}while(temp!=0); 
    02E39 2344      TST	R20
    02E3A F7A1      BNE	0x2E2F
(0119) 
(0120) 	for(i=0;i<100;i++) //这里要插入若干时钟信号
    02E3B 2766      CLR	R22
    02E3C 2777      CLR	R23
    02E3D C004      RJMP	0x2E42
(0121)   		SPI_Read();
    02E3E 940E 3EA8 CALL	_SPI_Read
    02E40 5F6F      SUBI	R22,0xFF
    02E41 4F7F      SBCI	R23,0xFF
    02E42 3664      CPI	R22,0x64
    02E43 E0E0      LDI	R30,0
    02E44 077E      CPC	R23,R30
    02E45 F3C0      BCS	0x2E3E
(0122) 	
(0123) 	SPI_Write(0xfe);//写入开始字节 0xfe，后面就是要写入的512个字节的数据	
    02E46 EF0E      LDI	R16,0xFE
    02E47 940E 3EA4 CALL	_SPI_Write
(0124) 	
(0125) 	for(i=0;i<512;i++) //将缓冲区中要写入的512个字节写入SD卡
    02E49 2766      CLR	R22
    02E4A 2777      CLR	R23
    02E4B C007      RJMP	0x2E53
(0126) 		SPI_Write(*buffer++);
    02E4C 01F5      MOVW	R30,R10
    02E4D 9101      LD	R16,Z+
    02E4E 015F      MOVW	R10,R30
    02E4F 940E 3EA4 CALL	_SPI_Write
    02E51 5F6F      SUBI	R22,0xFF
    02E52 4F7F      SBCI	R23,0xFF
    02E53 3060      CPI	R22,0
    02E54 E0E2      LDI	R30,2
    02E55 077E      CPC	R23,R30
    02E56 F3A8      BCS	0x2E4C
(0127)   
(0128) 	SPI_Read(); 
    02E57 940E 3EA8 CALL	_SPI_Read
(0129) 	SPI_Read(); //两个字节的CRC校验码，不用关心
    02E59 940E 3EA8 CALL	_SPI_Read
(0130)    
(0131)     
(0132) 	temp=SPI_Read();   //读取返回值
    02E5B 940E 3EA8 CALL	_SPI_Read
    02E5D 2F40      MOV	R20,R16
(0133) 	if((temp&0x1F)!=0x05) //如果返回值是 XXX00101说明数据已经被SD卡接受了
    02E5E 2F84      MOV	R24,R20
    02E5F 718F      ANDI	R24,0x1F
    02E60 3085      CPI	R24,5
    02E61 F021      BEQ	0x2E66
(0134) 	{
(0135)  		SD_CS_DIS();
    02E62 9AC0      SBI	0x18,0
(0136)  		return(WRITE_BLOCK_ERROR); //写块数据失败
    02E63 E003      LDI	R16,3
    02E64 E010      LDI	R17,0
    02E65 C00A      RJMP	0x2E70
(0137) 	}
(0138)  
(0139) 	while(SPI_Read()!=0xff);//等到SD卡不忙（数据被接受以后，SD卡要将这些数据写入到自身的FLASH中，需要一个时间）
    02E66 940E 3EA8 CALL	_SPI_Read
    02E68 2F40      MOV	R20,R16
    02E69 3F0F      CPI	R16,0xFF
    02E6A F7D9      BNE	0x2E66
(0140) 						    //忙时，读回来的值为0x00,不忙时，为0xff
(0141) 
(0142) 	SD_CS_DIS(); //关闭片选
    02E6B 9AC0      SBI	0x18,0
(0143) 
(0144) 	SPI_Read();//按照SD卡的操作时序在这里补8个时钟
    02E6C 940E 3EA8 CALL	_SPI_Read
(0145) 	return SD_TURE;		 //返回0,说明写扇区操作成功
    02E6E 2700      CLR	R16
    02E6F 2711      CLR	R17
    02E70 9626      ADIW	R28,6
    02E71 940E 4B4B CALL	pop_xgsetF03C
    02E73 9624      ADIW	R28,4
    02E74 9508      RET
_SD_Read_Sector:
  pcmd                 --> Y,+0
  temp                 --> R12
  time                 --> R22
  j                    --> R20
  buffer               --> R10
  addr                 --> Y,+14
    02E75 940E 49C2 CALL	push_arg4
    02E77 940E 4B42 CALL	push_xgsetF03C
    02E79 9726      SBIW	R28,6
    02E7A 88AA      LDD	R10,Y+18
    02E7B 88BB      LDD	R11,Y+19
(0146) } 
(0147) //****************************************************************
(0148) //*隶属模块：SD卡控制
(0149) //*函数功能：读512字节数据（一扇区字节）
(0150) //****************************************************************
(0151) UINT16 SD_Read_Sector(UINT32 addr,UINT8 *buffer)//从SD卡的指定扇区中读出512个字节，使用CMD17（17号命令）
(0152) {
(0153) 
(0154) 	 UINT16 j=0;
    02E7C 2744      CLR	R20
    02E7D 2755      CLR	R21
(0155) 	 UINT8 time=0,temp=0;
    02E7E 2766      CLR	R22
    02E7F 24CC      CLR	R12
(0156) 	 UINT8 pcmd[]={0x51,0x00,0x00,0x00,0x00,0xff}; //CMD17的字节序列
    02E80 E982      LDI	R24,0x92
    02E81 E092      LDI	R25,2
    02E82 01FE      MOVW	R30,R28
    02E83 E006      LDI	R16,6
    02E84 E010      LDI	R17,0
    02E85 93FA      ST	-Y,R31
    02E86 93EA      ST	-Y,R30
    02E87 939A      ST	-Y,R25
    02E88 938A      ST	-Y,R24
    02E89 940E 4BB7 CALL	asgnblk
(0157) 
(0158) 	 addr <<= 9; //将块地址（扇区地址）转为字节地址
    02E8B E089      LDI	R24,0x9
    02E8C E090      LDI	R25,0
    02E8D 850E      LDD	R16,Y+14
    02E8E 851F      LDD	R17,Y+15
    02E8F 8928      LDD	R18,Y+16
    02E90 8939      LDD	R19,Y+17
    02E91 938A      ST	-Y,R24
    02E92 940E 4B92 CALL	lsl32
    02E94 870E      STD	Y+14,R16
    02E95 871F      STD	Y+15,R17
    02E96 8B28      STD	Y+16,R18
    02E97 8B39      STD	Y+17,R19
(0159) 
(0160) 	 pcmd[1] = (addr>>24);//将字节地址写入到CMD17字节序列中
    02E98 E188      LDI	R24,0x18
    02E99 E090      LDI	R25,0
    02E9A 850E      LDD	R16,Y+14
    02E9B 851F      LDD	R17,Y+15
    02E9C 8928      LDD	R18,Y+16
    02E9D 8939      LDD	R19,Y+17
    02E9E 938A      ST	-Y,R24
    02E9F 940E 4BAB CALL	lsr32
    02EA1 8309      STD	Y+1,R16
(0161) 	 pcmd[2] = (addr>>16);
    02EA2 842E      LDD	R2,Y+14
    02EA3 843F      LDD	R3,Y+15
    02EA4 8848      LDD	R4,Y+16
    02EA5 8859      LDD	R5,Y+17
    02EA6 0112      MOVW	R2,R4
    02EA7 2444      CLR	R4
    02EA8 2455      CLR	R5
    02EA9 822A      STD	Y+2,R2
(0162) 	 pcmd[3] =(addr>>8);
    02EAA E088      LDI	R24,0x8
    02EAB E090      LDI	R25,0
    02EAC 850E      LDD	R16,Y+14
    02EAD 851F      LDD	R17,Y+15
    02EAE 8928      LDD	R18,Y+16
    02EAF 8939      LDD	R19,Y+17
    02EB0 938A      ST	-Y,R24
    02EB1 940E 4BAB CALL	lsr32
    02EB3 830B      STD	Y+3,R16
(0163) 	// pcmd[4] = offset;
(0164) 
(0165) 	 SD_CS_EN();//打开片选 
    02EB4 98C0      CBI	0x18,0
(0166) 
(0167) 	 do
(0168) 	 {  
(0169) 		  temp=SD_Write_cmd(pcmd); //写入CMD17
    02EB5 018E      MOVW	R16,R28
    02EB6 DEA6      RCALL	_SD_Write_cmd
    02EB7 2EC0      MOV	R12,R16
(0170) 		  time++;
    02EB8 9563      INC	R22
(0171) 		  if(time==TRY_TIME) 
    02EB9 3164      CPI	R22,0x14
    02EBA F421      BNE	0x2EBF
(0172) 		  {
(0173) 		   SD_CS_DIS();
    02EBB 9AC0      SBI	0x18,0
(0174) 		   return(READ_BLOCK_ERROR); //读块失败
    02EBC E004      LDI	R16,4
    02EBD E010      LDI	R17,0
    02EBE C01F      RJMP	0x2EDE
(0175) 		  }
(0176) 	 }while(temp!=0); 
    02EBF 20CC      TST	R12
    02EC0 F7A1      BNE	0x2EB5
(0177)    			
(0178) 	 while(SPI_Read()!= 0xfe); //一直读，当读到0xfe时，说明后面的是512字节的数据了
    02EC1 940E 3EA8 CALL	_SPI_Read
    02EC3 3F0E      CPI	R16,0xFE
    02EC4 F7E1      BNE	0x2EC1
(0179)  		   	   	
(0180) 	 for(j=0;j<512;j++)	 //将数据写入到数据缓冲区中
    02EC5 2744      CLR	R20
    02EC6 2755      CLR	R21
    02EC7 C009      RJMP	0x2ED1
(0181) 	 {	
(0182) 	    buffer[j]=SPI_Read();
    02EC8 940E 3EA8 CALL	_SPI_Read
    02ECA 2EC0      MOV	R12,R16
    02ECB 01FA      MOVW	R30,R20
    02ECC 0DEA      ADD	R30,R10
    02ECD 1DFB      ADC	R31,R11
    02ECE 82C0      ST	Z,R12
    02ECF 5F4F      SUBI	R20,0xFF
    02ED0 4F5F      SBCI	R21,0xFF
    02ED1 3040      CPI	R20,0
    02ED2 E0E2      LDI	R30,2
    02ED3 075E      CPC	R21,R30
    02ED4 F398      BCS	0x2EC8
(0183) 	 }
(0184) 
(0185) 	 SPI_Read();//读取两个字节的CRC校验码，不用关心它们
    02ED5 940E 3EA8 CALL	_SPI_Read
(0186) 	 SPI_Read();
    02ED7 940E 3EA8 CALL	_SPI_Read
(0187) 
(0188) 	 SD_CS_DIS();  //SD卡关闭片选 
    02ED9 9AC0      SBI	0x18,0
(0189) 
(0190) 	 SPI_Read();//按照SD卡的操作时序在这里补8个时钟
    02EDA 940E 3EA8 CALL	_SPI_Read
(0191) 
(0192) 	 return SD_TURE;
    02EDC 2700      CLR	R16
    02EDD 2711      CLR	R17
    02EDE 9626      ADIW	R28,6
    02EDF 940E 4B4B CALL	pop_xgsetF03C
    02EE1 9624      ADIW	R28,4
    02EE2 9508      RET
_SD_Read_Sector_ndata:
  pcmd                 --> Y,+0
  temp                 --> R12
  time                 --> R22
  j                    --> R20
  len                  --> R14
  offset               --> R10
  buffer               --> Y,+20
  addr                 --> Y,+16
    02EE3 940E 49C2 CALL	push_arg4
    02EE5 940E 4B07 CALL	push_xgsetF0FC
    02EE7 9726      SBIW	R28,6
    02EE8 88AE      LDD	R10,Y+22
    02EE9 88BF      LDD	R11,Y+23
    02EEA 8CE8      LDD	R14,Y+24
    02EEB 8CF9      LDD	R15,Y+25
(0193) }
(0194) //****************************************************************
(0195) //*隶属模块：SD卡控制
(0196) //*函数功能：写多扇区数据（多扇区字节）
(0197) //****************************************************************
(0198) UINT16 SD_Read_Sector_ndata(UINT32 addr,UINT8 *buffer,UINT16 offset,UINT16 len)//从SD卡的指定扇区中读出512个字节，使用CMD17（17号命令）
(0199) {
(0200) 
(0201) 	 UINT16 j=0;
    02EEC 2744      CLR	R20
    02EED 2755      CLR	R21
(0202) 	 UINT8 time=0,temp=0;
    02EEE 2766      CLR	R22
    02EEF 24CC      CLR	R12
(0203) 	 UINT8 pcmd[]={0x51,0x00,0x00,0x00,0x00,0xff}; //CMD17的字节序列
    02EF0 E988      LDI	R24,0x98
    02EF1 E092      LDI	R25,2
    02EF2 01FE      MOVW	R30,R28
    02EF3 E006      LDI	R16,6
    02EF4 E010      LDI	R17,0
    02EF5 93FA      ST	-Y,R31
    02EF6 93EA      ST	-Y,R30
    02EF7 939A      ST	-Y,R25
    02EF8 938A      ST	-Y,R24
    02EF9 940E 4BB7 CALL	asgnblk
(0204) 
(0205) 	 addr <<= 9; //将块地址（扇区地址）转为字节地址
    02EFB E089      LDI	R24,0x9
    02EFC E090      LDI	R25,0
    02EFD 8908      LDD	R16,Y+16
    02EFE 8919      LDD	R17,Y+17
    02EFF 892A      LDD	R18,Y+18
    02F00 893B      LDD	R19,Y+19
    02F01 938A      ST	-Y,R24
    02F02 940E 4B92 CALL	lsl32
    02F04 8B08      STD	Y+16,R16
    02F05 8B19      STD	Y+17,R17
    02F06 8B2A      STD	Y+18,R18
    02F07 8B3B      STD	Y+19,R19
(0206) 
(0207) 	 pcmd[1] = (addr>>24);//将字节地址写入到CMD17字节序列中
    02F08 E188      LDI	R24,0x18
    02F09 E090      LDI	R25,0
    02F0A 8908      LDD	R16,Y+16
    02F0B 8919      LDD	R17,Y+17
    02F0C 892A      LDD	R18,Y+18
    02F0D 893B      LDD	R19,Y+19
    02F0E 938A      ST	-Y,R24
    02F0F 940E 4BAB CALL	lsr32
    02F11 8309      STD	Y+1,R16
(0208) 	 pcmd[2] = (addr>>16);
    02F12 8828      LDD	R2,Y+16
    02F13 8839      LDD	R3,Y+17
    02F14 884A      LDD	R4,Y+18
    02F15 885B      LDD	R5,Y+19
    02F16 0112      MOVW	R2,R4
    02F17 2444      CLR	R4
    02F18 2455      CLR	R5
    02F19 822A      STD	Y+2,R2
(0209) 	 pcmd[3] =(addr>>8);
    02F1A E088      LDI	R24,0x8
    02F1B E090      LDI	R25,0
    02F1C 8908      LDD	R16,Y+16
    02F1D 8919      LDD	R17,Y+17
    02F1E 892A      LDD	R18,Y+18
    02F1F 893B      LDD	R19,Y+19
    02F20 938A      ST	-Y,R24
    02F21 940E 4BAB CALL	lsr32
    02F23 830B      STD	Y+3,R16
(0210) 	// pcmd[4] = offset;
(0211) 
(0212) 	 SD_CS_EN();//打开片选 
    02F24 98C0      CBI	0x18,0
(0213) 
(0214) 	 do
(0215) 	 {  
(0216) 		  temp=SD_Write_cmd(pcmd); //写入CMD17
    02F25 018E      MOVW	R16,R28
    02F26 DE36      RCALL	_SD_Write_cmd
    02F27 2EC0      MOV	R12,R16
(0217) 		  time++;
    02F28 9563      INC	R22
(0218) 		  if(time==TRY_TIME) 
    02F29 3164      CPI	R22,0x14
    02F2A F421      BNE	0x2F2F
(0219) 		  {
(0220) 		   SD_CS_DIS();
    02F2B 9AC0      SBI	0x18,0
(0221) 		   return(READ_BLOCK_ERROR); //读块失败
    02F2C E004      LDI	R16,4
    02F2D E010      LDI	R17,0
    02F2E C034      RJMP	0x2F63
(0222) 		  }
(0223) 	 }while(temp!=0); 
    02F2F 20CC      TST	R12
    02F30 F7A1      BNE	0x2F25
(0224)    			
(0225) 	 while(SPI_Read()!= 0xfe); //一直读，当读到0xfe时，说明后面的是512字节的数据了
    02F31 940E 3EA8 CALL	_SPI_Read
    02F33 3F0E      CPI	R16,0xFE
    02F34 F7E1      BNE	0x2F31
(0226)  		   	   	
(0227) 	 for(j=0;j<offset;j++)	 //将数据写入到数据缓冲区中
    02F35 2744      CLR	R20
    02F36 2755      CLR	R21
    02F37 C004      RJMP	0x2F3C
(0228) 	    SPI_Read();
    02F38 940E 3EA8 CALL	_SPI_Read
    02F3A 5F4F      SUBI	R20,0xFF
    02F3B 4F5F      SBCI	R21,0xFF
    02F3C 154A      CP	R20,R10
    02F3D 055B      CPC	R21,R11
    02F3E F3C8      BCS	0x2F38
(0229) 	 for(;j<offset+len;j++)	 
    02F3F C00B      RJMP	0x2F4B
(0230) 		buffer[j]=SPI_Read();
    02F40 940E 3EA8 CALL	_SPI_Read
    02F42 2F60      MOV	R22,R16
    02F43 01FA      MOVW	R30,R20
    02F44 880C      LDD	R0,Y+20
    02F45 881D      LDD	R1,Y+21
    02F46 0DE0      ADD	R30,R0
    02F47 1DF1      ADC	R31,R1
    02F48 8360      ST	Z,R22
    02F49 5F4F      SUBI	R20,0xFF
    02F4A 4F5F      SBCI	R21,0xFF
    02F4B 0115      MOVW	R2,R10
    02F4C 0C2E      ADD	R2,R14
    02F4D 1C3F      ADC	R3,R15
    02F4E 1542      CP	R20,R2
    02F4F 0553      CPC	R21,R3
    02F50 F378      BCS	0x2F40
(0231) 	 for(;j<512;j++)	 
    02F51 C004      RJMP	0x2F56
(0232) 		SPI_Read();
    02F52 940E 3EA8 CALL	_SPI_Read
    02F54 5F4F      SUBI	R20,0xFF
    02F55 4F5F      SBCI	R21,0xFF
    02F56 3040      CPI	R20,0
    02F57 E0E2      LDI	R30,2
    02F58 075E      CPC	R21,R30
    02F59 F3C0      BCS	0x2F52
(0233) 
(0234) 	 SPI_Read();//读取两个字节的CRC校验码，不用关心它们
    02F5A 940E 3EA8 CALL	_SPI_Read
(0235) 	 SPI_Read();
    02F5C 940E 3EA8 CALL	_SPI_Read
(0236) 
(0237) 	 SD_CS_DIS();  //SD卡关闭片选 
    02F5E 9AC0      SBI	0x18,0
(0238) 
(0239) 	 SPI_Read();//按照SD卡的操作时序在这里补8个时钟
    02F5F 940E 3EA8 CALL	_SPI_Read
(0240) 
(0241) 	 return SD_TURE;
    02F61 2700      CLR	R16
    02F62 2711      CLR	R17
    02F63 9626      ADIW	R28,6
    02F64 940E 4AFC CALL	pop_xgsetF0FC
    02F66 9624      ADIW	R28,4
    02F67 9508      RET
_GUI_mainmeu:
  key                  --> R22
  select               --> R20
    02F68 940E 4B26 CALL	push_xgsetF00C
    02F6A 9723      SBIW	R28,3
FILE: D:\LQD\software\software_src\gui.c
(0001) #include "config.h"
(0002) const char labelH[]="高强度作业：\0";
(0003) const char labelM[]="中等强度作业：\0";
(0004) const char labelL[]="低强度作业：\0";
(0005) const char H01[]="加强劳动监督；\0";
(0006) const char H02[]="增加饮水;\0" ;
(0007) const char H03[]="保持干燥禁裸露。\0";
(0008) #define M01 H01
(0009) #define M02 H03
(0010) const char M03[]="戴面罩。\0";
(0011) const char M04[]="禁油彩。\0";
(0012) #define L01 M03
(0013) #define L02 M04
(0014) const char L03[]="缩短作业时间。";
(0015) //-----//
(0016) #define H11 M04
(0017) #define H12 H03
(0018) const char H13[]="休息注意保暖。\0";
(0019) #define M11 H01
(0020) const char M12[]="减少非必须作业；\0";
(0021) const char M13[]="劳动时间<30min。\0";
(0022) const char L11[]="取消非必须的作业\0";
(0023) const char L12[]="劳动时间<15min；\0";
(0024) #define L13 H03
(0025) //-----//
(0026) #define H21 L11
(0027) #define H22 L12
(0028) #define H23 H03
(0029) const char M21[]="取消户外作业。"; 
(0030) #define L21 M21
(0031) const char str_blank[]="----------------"; 
(0032) //#define LEDON   PORTC&=~(1<<7)					   
(0033) //#define LEDOFF  PINC|=(1<<7)
(0034) char GUI_date[17]="09月19日18:00:00\0";
(0035) 
(0036) // 主菜单
(0037) unsigned char GUI_mainmeu( void ){
(0038)  	unsigned char key=0; //init= nokey
    02F6B 2766      CLR	R22
(0039) 	unsigned char select=3;
    02F6C E043      LDI	R20,3
(0040) 	LCD_CLR();
    02F6D 940E 3F88 CALL	_LCD_CLR
(0041) 	
(0042)  	Set_White(1,1,8,1);
    02F6F E081      LDI	R24,1
    02F70 838A      STD	Y+2,R24
    02F71 E088      LDI	R24,0x8
    02F72 8388      ST	Y,R24
    02F73 E021      LDI	R18,1
    02F74 E001      LDI	R16,1
    02F75 940E 4012 CALL	_Set_White
(0043) 	Set_White(1,2,8,1);
    02F77 E081      LDI	R24,1
    02F78 838A      STD	Y+2,R24
    02F79 E088      LDI	R24,0x8
    02F7A 8388      ST	Y,R24
    02F7B E022      LDI	R18,2
    02F7C E001      LDI	R16,1
    02F7D 940E 4012 CALL	_Set_White
(0044) 	Set_White(1,3,8,1);
    02F7F E081      LDI	R24,1
    02F80 838A      STD	Y+2,R24
    02F81 E088      LDI	R24,0x8
    02F82 8388      ST	Y,R24
    02F83 E023      LDI	R18,3
    02F84 E001      LDI	R16,1
    02F85 940E 4012 CALL	_Set_White
(0045) 	Set_White(1,4,8,1);
    02F87 E081      LDI	R24,1
    02F88 838A      STD	Y+2,R24
    02F89 E088      LDI	R24,0x8
    02F8A 8388      ST	Y,R24
    02F8B E024      LDI	R18,4
    02F8C E001      LDI	R16,1
    02F8D 940E 4012 CALL	_Set_White
(0046) 	dateRefresh(1); //更新系统时间
    02F8F E001      LDI	R16,1
    02F90 940E 3956 CALL	_dateRefresh
(0047) 	LCD_const_disp(1,1,GUI_get_date()); //显示时间
    02F92 D578      RCALL	_GUI_get_date
    02F93 8319      STD	Y+1,R17
    02F94 8308      ST	Y,R16
    02F95 E021      LDI	R18,1
    02F96 E001      LDI	R16,1
    02F97 940E 3EE2 CALL	_LCD_const_disp
(0048) 	LCD_const_disp(2,1,"  检测  时钟调整");
    02F99 EA83      LDI	R24,0xA3
    02F9A E095      LDI	R25,5
    02F9B 8399      STD	Y+1,R25
    02F9C 8388      ST	Y,R24
    02F9D E021      LDI	R18,1
    02F9E E002      LDI	R16,2
    02F9F 940E 3EE2 CALL	_LCD_const_disp
(0049) 	LCD_const_disp(3,1,"  查询  数据传输");
    02FA1 E982      LDI	R24,0x92
    02FA2 E095      LDI	R25,5
    02FA3 8399      STD	Y+1,R25
    02FA4 8388      ST	Y,R24
    02FA5 E021      LDI	R18,1
    02FA6 E003      LDI	R16,3
    02FA7 940E 3EE2 CALL	_LCD_const_disp
(0050) 	LCD_const_disp(4,1,"  初始化");
    02FA9 E889      LDI	R24,0x89
    02FAA E095      LDI	R25,5
    02FAB 8399      STD	Y+1,R25
    02FAC 8388      ST	Y,R24
    02FAD E021      LDI	R18,1
    02FAE E004      LDI	R16,4
    02FAF 940E 3EE2 CALL	_LCD_const_disp
(0051) 	Set_White(1,1,8,1);
    02FB1 E081      LDI	R24,1
    02FB2 838A      STD	Y+2,R24
    02FB3 E088      LDI	R24,0x8
    02FB4 8388      ST	Y,R24
    02FB5 E021      LDI	R18,1
    02FB6 E001      LDI	R16,1
    02FB7 940E 4012 CALL	_Set_White
(0052) 	Set_White(1,2,8,1);
    02FB9 E081      LDI	R24,1
    02FBA 838A      STD	Y+2,R24
    02FBB E088      LDI	R24,0x8
    02FBC 8388      ST	Y,R24
    02FBD E022      LDI	R18,2
    02FBE E001      LDI	R16,1
    02FBF 940E 4012 CALL	_Set_White
(0053) 	Set_White(1,3,8,1);
    02FC1 E081      LDI	R24,1
    02FC2 838A      STD	Y+2,R24
    02FC3 E088      LDI	R24,0x8
    02FC4 8388      ST	Y,R24
    02FC5 E023      LDI	R18,3
    02FC6 E001      LDI	R16,1
    02FC7 940E 4012 CALL	_Set_White
(0054) 	Set_White(1,4,8,1);
    02FC9 E081      LDI	R24,1
    02FCA 838A      STD	Y+2,R24
    02FCB E088      LDI	R24,0x8
    02FCC 8388      ST	Y,R24
    02FCD E024      LDI	R18,4
    02FCE E001      LDI	R16,1
    02FCF 940E 4012 CALL	_Set_White
(0055) 	set_white_n(select,0);
    02FD1 2722      CLR	R18
    02FD2 2F04      MOV	R16,R20
    02FD3 940E 40A4 CALL	_set_white_n
    02FD5 C07D      RJMP	0x3053
(0056) 	while(alwaysCheck())
(0057) 	{
(0058) 	 	key=kbscan();
    02FD6 940E 44E8 CALL	_kbscan
    02FD8 2F60      MOV	R22,R16
(0059) 		dateRefresh(1); //更新系统时间
    02FD9 E001      LDI	R16,1
    02FDA 940E 3956 CALL	_dateRefresh
(0060) 		LCD_const_disp(1,1,GUI_get_date()); //显示时间
    02FDC D52E      RCALL	_GUI_get_date
    02FDD 0158      MOVW	R10,R16
    02FDE 82B9      STD	Y+1,R11
    02FDF 82A8      ST	Y,R10
    02FE0 E021      LDI	R18,1
    02FE1 E001      LDI	R16,1
    02FE2 940E 3EE2 CALL	_LCD_const_disp
(0061) 		if((select>3) && ( key==up ) ){
    02FE4 E083      LDI	R24,3
    02FE5 1784      CP	R24,R20
    02FE6 F4F8      BCC	0x3006
    02FE7 316E      CPI	R22,0x1E
    02FE8 F4E9      BNE	0x3006
(0062) 		 Set_White(1,2,8,1);
    02FE9 E081      LDI	R24,1
    02FEA 838A      STD	Y+2,R24
    02FEB E088      LDI	R24,0x8
    02FEC 8388      ST	Y,R24
    02FED E022      LDI	R18,2
    02FEE E001      LDI	R16,1
    02FEF 940E 4012 CALL	_Set_White
(0063) 		 Set_White(1,3,8,1);
    02FF1 E081      LDI	R24,1
    02FF2 838A      STD	Y+2,R24
    02FF3 E088      LDI	R24,0x8
    02FF4 8388      ST	Y,R24
    02FF5 E023      LDI	R18,3
    02FF6 E001      LDI	R16,1
    02FF7 940E 4012 CALL	_Set_White
(0064) 		 Set_White(1,4,8,1);
    02FF9 E081      LDI	R24,1
    02FFA 838A      STD	Y+2,R24
    02FFB E088      LDI	R24,0x8
    02FFC 8388      ST	Y,R24
    02FFD E024      LDI	R18,4
    02FFE E001      LDI	R16,1
    02FFF 940E 4012 CALL	_Set_White
(0065) 		 select--;
    03001 954A      DEC	R20
(0066) 		 set_white_n(select,0);
    03002 2722      CLR	R18
    03003 2F04      MOV	R16,R20
    03004 940E 40A4 CALL	_set_white_n
(0067) 		}
(0068) 		if((select<7) && ( key==down ) ){
    03006 3047      CPI	R20,7
    03007 F538      BCC	0x302F
    03008 316D      CPI	R22,0x1D
    03009 F529      BNE	0x302F
(0069) 		 Set_White(1,1,8,1);
    0300A E081      LDI	R24,1
    0300B 838A      STD	Y+2,R24
    0300C E088      LDI	R24,0x8
    0300D 8388      ST	Y,R24
    0300E E021      LDI	R18,1
    0300F E001      LDI	R16,1
    03010 940E 4012 CALL	_Set_White
(0070) 		 Set_White(1,2,8,1);
    03012 E081      LDI	R24,1
    03013 838A      STD	Y+2,R24
    03014 E088      LDI	R24,0x8
    03015 8388      ST	Y,R24
    03016 E022      LDI	R18,2
    03017 E001      LDI	R16,1
    03018 940E 4012 CALL	_Set_White
(0071) 		 Set_White(1,3,8,1);
    0301A E081      LDI	R24,1
    0301B 838A      STD	Y+2,R24
    0301C E088      LDI	R24,0x8
    0301D 8388      ST	Y,R24
    0301E E023      LDI	R18,3
    0301F E001      LDI	R16,1
    03020 940E 4012 CALL	_Set_White
(0072) 		 Set_White(1,4,8,1);
    03022 E081      LDI	R24,1
    03023 838A      STD	Y+2,R24
    03024 E088      LDI	R24,0x8
    03025 8388      ST	Y,R24
    03026 E024      LDI	R18,4
    03027 E001      LDI	R16,1
    03028 940E 4012 CALL	_Set_White
(0073) 		 select++;
    0302A 9543      INC	R20
(0074) 		 set_white_n(select,0);
    0302B 2722      CLR	R18
    0302C 2F04      MOV	R16,R20
    0302D 940E 40A4 CALL	_set_white_n
(0075) 		}
(0076) 		if(key == left ){
    0302F 316B      CPI	R22,0x1B
    03030 F511      BNE	0x3053
(0077) 		 Set_White(1,1,8,1);
    03031 E081      LDI	R24,1
    03032 838A      STD	Y+2,R24
    03033 E088      LDI	R24,0x8
    03034 8388      ST	Y,R24
    03035 E021      LDI	R18,1
    03036 E001      LDI	R16,1
    03037 940E 4012 CALL	_Set_White
(0078) 		 Set_White(1,2,8,1);
    03039 E081      LDI	R24,1
    0303A 838A      STD	Y+2,R24
    0303B E088      LDI	R24,0x8
    0303C 8388      ST	Y,R24
    0303D E022      LDI	R18,2
    0303E E001      LDI	R16,1
    0303F 940E 4012 CALL	_Set_White
(0079) 		 Set_White(1,3,8,1);
    03041 E081      LDI	R24,1
    03042 838A      STD	Y+2,R24
    03043 E088      LDI	R24,0x8
    03044 8388      ST	Y,R24
    03045 E023      LDI	R18,3
    03046 E001      LDI	R16,1
    03047 940E 4012 CALL	_Set_White
(0080) 		 Set_White(1,4,8,1);
    03049 E081      LDI	R24,1
    0304A 838A      STD	Y+2,R24
    0304B E088      LDI	R24,0x8
    0304C 8388      ST	Y,R24
    0304D E024      LDI	R18,4
    0304E E001      LDI	R16,1
    0304F 940E 4012 CALL	_Set_White
(0081) 		 //beep(3,select);
(0082) 		 return select;
    03051 2F04      MOV	R16,R20
    03052 C007      RJMP	0x305A
    03053 940E 25F7 CALL	_alwaysCheck
    03055 2EA0      MOV	R10,R16
    03056 2300      TST	R16
    03057 F009      BEQ	0x3059
    03058 CF7D      RJMP	0x2FD6
(0083) 		}
(0084)     }
(0085) 	return 0xff; //error
    03059 EF0F      LDI	R16,0xFF
    0305A 9623      ADIW	R28,3
    0305B 940C 4B2D JMP	pop_xgsetF00C
_GUI_check:
  windcounter          --> Y,+9
  next_step_time       --> Y,+3
  selectCheckMode      --> R14
  is_on                --> Y,+8
  page                 --> Y,+7
  key                  --> R12
    0305D 940E 4B07 CALL	push_xgsetF0FC
    0305F 972A      SBIW	R28,0xA
(0086) 	
(0087) }
(0088) 
(0089) //”检测 “菜单
(0090) void GUI_check(void){
(0091)     char key;
(0092) 	char page=0,is_on=0;
    03060 2400      CLR	R0
    03061 820F      STD	Y+7,R0
    03062 8608      STD	Y+8,R0
(0093) 	char windcounter=0;
    03063 8609      STD	Y+9,R0
(0094) 	unsigned long next_step_time=0;
    03064 E080      LDI	R24,0
    03065 838B      STD	Y+3,R24
    03066 838C      STD	Y+4,R24
    03067 838D      STD	Y+5,R24
    03068 838E      STD	Y+6,R24
(0095) 	char selectCheckMode=config.autocheck; //自动检测开关
    03069 90E0 08BF LDS	R14,config+16
(0096) RE_IN:
(0097) 	key=0;
    0306B 24CC      CLR	R12
(0098) 	page=0;
    0306C 2400      CLR	R0
    0306D 820F      STD	Y+7,R0
(0099) 	is_on=0;
    0306E 8608      STD	Y+8,R0
(0100) 	windcounter=0;
    0306F 8609      STD	Y+9,R0
(0101) 	next_step_time=0;
    03070 E080      LDI	R24,0
    03071 838B      STD	Y+3,R24
    03072 838C      STD	Y+4,R24
    03073 838D      STD	Y+5,R24
    03074 838E      STD	Y+6,R24
(0102) 	
(0103) 	dateRefresh(1);
    03075 E001      LDI	R16,1
    03076 940E 3956 CALL	_dateRefresh
(0104) 	LCD_CLR();
    03078 940E 3F88 CALL	_LCD_CLR
(0105) 	LCD_const_disp(1,1,"菜单/ 检测");
    0307A E78E      LDI	R24,0x7E
    0307B E095      LDI	R25,5
    0307C 8399      STD	Y+1,R25
    0307D 8388      ST	Y,R24
    0307E E021      LDI	R18,1
    0307F E001      LDI	R16,1
    03080 940E 3EE2 CALL	_LCD_const_disp
(0106) 	LCD_const_disp(2,3,"自动");		 
    03082 E789      LDI	R24,0x79
    03083 E095      LDI	R25,5
    03084 8399      STD	Y+1,R25
    03085 8388      ST	Y,R24
    03086 E023      LDI	R18,3
    03087 E002      LDI	R16,2
    03088 940E 3EE2 CALL	_LCD_const_disp
(0107) 	LCD_const_disp(3,3,"手动");
    0308A E784      LDI	R24,0x74
    0308B E095      LDI	R25,5
    0308C 8399      STD	Y+1,R25
    0308D 8388      ST	Y,R24
    0308E E023      LDI	R18,3
    0308F E003      LDI	R16,3
    03090 940E 3EE2 CALL	_LCD_const_disp
(0108) 	if(selectCheckMode==1) {
    03092 2D8E      MOV	R24,R14
    03093 3081      CPI	R24,1
    03094 F489      BNE	0x30A6
(0109) 	    Set_White(1,2,8,0);
    03095 2422      CLR	R2
    03096 822A      STD	Y+2,R2
    03097 E088      LDI	R24,0x8
    03098 8388      ST	Y,R24
    03099 E022      LDI	R18,2
    0309A E001      LDI	R16,1
    0309B 940E 4012 CALL	_Set_White
(0110) 		Set_White(1,3,8,1);
    0309D E081      LDI	R24,1
    0309E 838A      STD	Y+2,R24
    0309F E088      LDI	R24,0x8
    030A0 8388      ST	Y,R24
    030A1 E023      LDI	R18,3
    030A2 E001      LDI	R16,1
    030A3 940E 4012 CALL	_Set_White
(0111) 	}
    030A5 C05E      RJMP	0x3104
(0112) 	else {
(0113) 		 Set_White(1,2,8,1);
    030A6 E081      LDI	R24,1
    030A7 838A      STD	Y+2,R24
    030A8 E088      LDI	R24,0x8
    030A9 8388      ST	Y,R24
    030AA E022      LDI	R18,2
    030AB E001      LDI	R16,1
    030AC 940E 4012 CALL	_Set_White
(0114) 		 Set_White(1,3,8,0);
    030AE 2422      CLR	R2
    030AF 822A      STD	Y+2,R2
    030B0 E088      LDI	R24,0x8
    030B1 8388      ST	Y,R24
    030B2 E023      LDI	R18,3
    030B3 E001      LDI	R16,1
    030B4 940E 4012 CALL	_Set_White
(0115) 	}
    030B6 C04D      RJMP	0x3104
(0116) 	
(0117) //<<菜单/检测/手（自）动>>
(0118) 	while(alwaysCheck()){
(0119) 	 	key=kbscan();
    030B7 940E 44E8 CALL	_kbscan
    030B9 2EC0      MOV	R12,R16
(0120) 		dateRefresh(0); //只刷新后台时间
    030BA 2700      CLR	R16
    030BB 940E 3956 CALL	_dateRefresh
(0121) 		//上键短按 选择
(0122) 		if(key==up || key ==down){
    030BD 2D8C      MOV	R24,R12
    030BE 318E      CPI	R24,0x1E
    030BF F011      BEQ	0x30C2
    030C0 318D      CPI	R24,0x1D
    030C1 F539      BNE	0x30E9
(0123) 		    if(selectCheckMode >0){
    030C2 E080      LDI	R24,0
    030C3 158E      CP	R24,R14
    030C4 F490      BCC	0x30D7
(0124) 			    selectCheckMode=0;
    030C5 24EE      CLR	R14
(0125) 				Set_White(1,2,8,1);
    030C6 E081      LDI	R24,1
    030C7 838A      STD	Y+2,R24
    030C8 E088      LDI	R24,0x8
    030C9 8388      ST	Y,R24
    030CA E022      LDI	R18,2
    030CB E001      LDI	R16,1
    030CC 940E 4012 CALL	_Set_White
(0126) 	 			Set_White(1,3,8,0);
    030CE 2422      CLR	R2
    030CF 822A      STD	Y+2,R2
    030D0 E088      LDI	R24,0x8
    030D1 8388      ST	Y,R24
    030D2 E023      LDI	R18,3
    030D3 E001      LDI	R16,1
    030D4 940E 4012 CALL	_Set_White
(0127) 			}
    030D6 C012      RJMP	0x30E9
(0128) 			else {
(0129) 			    selectCheckMode=1;
    030D7 24EE      CLR	R14
    030D8 94E3      INC	R14
(0130) 				Set_White(1,2,8,0);
    030D9 2422      CLR	R2
    030DA 822A      STD	Y+2,R2
    030DB E088      LDI	R24,0x8
    030DC 8388      ST	Y,R24
    030DD E022      LDI	R18,2
    030DE E001      LDI	R16,1
    030DF 940E 4012 CALL	_Set_White
(0131) 	 			Set_White(1,3,8,1);
    030E1 E081      LDI	R24,1
    030E2 838A      STD	Y+2,R24
    030E3 E088      LDI	R24,0x8
    030E4 8388      ST	Y,R24
    030E5 E023      LDI	R18,3
    030E6 E001      LDI	R16,1
    030E7 940E 4012 CALL	_Set_White
(0132) 			}
(0133) 			
(0134) 		}
(0135) 		//左键短按  进入
(0136) 		if(key == left) {
    030E9 2D8C      MOV	R24,R12
    030EA 318B      CPI	R24,0x1B
    030EB F499      BNE	0x30FF
(0137) 			config.autocheck=selectCheckMode; 
    030EC 92E0 08BF STS	config+16,R14
(0138) 			Set_White(1,2,8,1);
    030EE E081      LDI	R24,1
    030EF 838A      STD	Y+2,R24
    030F0 E088      LDI	R24,0x8
    030F1 8388      ST	Y,R24
    030F2 E022      LDI	R18,2
    030F3 E001      LDI	R16,1
    030F4 940E 4012 CALL	_Set_White
(0139) 	 		Set_White(1,3,8,1); 
    030F6 E081      LDI	R24,1
    030F7 838A      STD	Y+2,R24
    030F8 E088      LDI	R24,0x8
    030F9 8388      ST	Y,R24
    030FA E023      LDI	R18,3
    030FB E001      LDI	R16,1
    030FC 940E 4012 CALL	_Set_White
(0140) 			break ;		
    030FE C00A      RJMP	0x3109
(0141) 		}
(0142) 		//右键短按  返回
(0143) 		if(key == right) {
    030FF 2D8C      MOV	R24,R12
    03100 3187      CPI	R24,0x17
    03101 F409      BNE	0x3103
(0144) 			return ;		
    03102 C1F9      RJMP	0x32FC
(0145) 		}
(0146) 		key=0;
    03103 24CC      CLR	R12
    03104 940E 25F7 CALL	_alwaysCheck
    03106 2300      TST	R16
    03107 F009      BEQ	0x3109
    03108 CFAE      RJMP	0x30B7
(0147) 	} //end of while
(0148)     //自动开启检测
(0149) 	dateRefresh(0);
    03109 2700      CLR	R16
    0310A 940E 3956 CALL	_dateRefresh
(0150) 	is_on =1 ;
    0310C 2400      CLR	R0
    0310D 9403      INC	R0
    0310E 8608      STD	Y+8,R0
(0151) 	config.time1=config.now+config.THRESHOLD_delta_sec;
    0310F 9040 08B5 LDS	R4,config+6
    03111 9050 08B6 LDS	R5,config+7
    03113 9020 08B3 LDS	R2,config+4
    03115 9030 08B4 LDS	R3,config+5
    03117 9080 08BD LDS	R8,config+14
    03119 9090 08BE LDS	R9,config+15
    0311B 9060 08BB LDS	R6,config+12
    0311D 9070 08BC LDS	R7,config+13
    0311F 0C62      ADD	R6,R2
    03120 1C73      ADC	R7,R3
    03121 1C84      ADC	R8,R4
    03122 1C95      ADC	R9,R5
    03123 9270 08B8 STS	config+9,R7
    03125 9260 08B7 STS	config+8,R6
    03127 9290 08BA STS	config+11,R9
    03129 9280 08B9 STS	config+10,R8
(0152) 	Result.TempChar[0]=0; //清除上次结果
    0312B 2422      CLR	R2
    0312C 9220 066A STS	Result+45,R2
(0153) 	Result.WSChar[0]=0;
    0312E 9220 0674 STS	Result+55,R2
    03130 C1C5      RJMP	0x32F6
(0154) 	while(alwaysCheck()){
(0155) 		key=kbscan();
    03131 940E 44E8 CALL	_kbscan
    03133 2EA0      MOV	R10,R16
    03134 2CCA      MOV	R12,R10
(0156) 		dateRefresh(0); //只刷新后台时间
    03135 2700      CLR	R16
    03136 940E 3956 CALL	_dateRefresh
(0157) 		if(key != 0) beep(0,1);
    03138 20AA      TST	R10
    03139 F021      BEQ	0x313E
    0313A E021      LDI	R18,1
    0313B 2700      CLR	R16
    0313C 940E 425F CALL	_beep
(0158) 		if(key==right){	//右键 退出
    0313E 2D8C      MOV	R24,R12
    0313F 3187      CPI	R24,0x17
    03140 F569      BNE	0x316E
(0159) 		    is_on=0;
    03141 2400      CLR	R0
    03142 8608      STD	Y+8,R0
(0160) 			LCD_CLR();
    03143 940E 3F88 CALL	_LCD_CLR
(0161) 		 	LCD_Init();	  
    03145 940E 3F56 CALL	_LCD_Init
(0162) 	 	 	LCD_const_disp(4,5,"退出    "); 
    03147 E68B      LDI	R24,0x6B
    03148 E095      LDI	R25,5
    03149 8399      STD	Y+1,R25
    0314A 8388      ST	Y,R24
    0314B E025      LDI	R18,5
    0314C E004      LDI	R16,4
    0314D 940E 3EE2 CALL	_LCD_const_disp
(0163) 		 	delayms(200);
    0314F EC08      LDI	R16,0xC8
    03150 E010      LDI	R17,0
    03151 940E 253A CALL	_delayms
(0164) 		 	LCD_const_disp(4,7,".."); 
    03153 E688      LDI	R24,0x68
    03154 E095      LDI	R25,5
    03155 8399      STD	Y+1,R25
    03156 8388      ST	Y,R24
    03157 E027      LDI	R18,7
    03158 E004      LDI	R16,4
    03159 940E 3EE2 CALL	_LCD_const_disp
(0165) 		 	delayms(200);
    0315B EC08      LDI	R16,0xC8
    0315C E010      LDI	R17,0
    0315D 940E 253A CALL	_delayms
(0166) 		 	LCD_const_disp(4,8,".."); 	
    0315F E688      LDI	R24,0x68
    03160 E095      LDI	R25,5
    03161 8399      STD	Y+1,R25
    03162 8388      ST	Y,R24
    03163 E028      LDI	R18,0x8
    03164 E004      LDI	R16,4
    03165 940E 3EE2 CALL	_LCD_const_disp
(0167) 		 	delayms(500);
    03167 EF04      LDI	R16,0xF4
    03168 E011      LDI	R17,1
    03169 940E 253A CALL	_delayms
(0168) 		 	LCD_CLR();
    0316B 940E 3F88 CALL	_LCD_CLR
(0169) 		 	goto RE_IN;
    0316D CEFD      RJMP	0x306B
(0170) 		}
(0171) 		if(is_on==1){ 
    0316E 8588      LDD	R24,Y+8
    0316F 3081      CPI	R24,1
    03170 F009      BEQ	0x3172
    03171 C0A0      RJMP	0x3212
(0172) 			dateRefresh(1); //更新时间
    03172 E001      LDI	R16,1
    03173 D7E2      RCALL	_dateRefresh
(0173) 		    _GUI_datashow(page); 
    03174 810F      LDD	R16,Y+7
    03175 D189      RCALL	__GUI_datashow
(0174) 		    if(config.now < config.time1) {
    03176 9040 08B9 LDS	R4,config+10
    03178 9050 08BA LDS	R5,config+11
    0317A 9020 08B7 LDS	R2,config+8
    0317C 9030 08B8 LDS	R3,config+9
    0317E 9080 08BD LDS	R8,config+14
    03180 9090 08BE LDS	R9,config+15
    03182 9060 08BB LDS	R6,config+12
    03184 9070 08BC LDS	R7,config+13
    03186 1462      CP	R6,R2
    03187 0473      CPC	R7,R3
    03188 0484      CPC	R8,R4
    03189 0495      CPC	R9,R5
    0318A F5A8      BCC	0x31C0
(0175) 				//时间更新 开启风速检测 等待检测 不支持翻页
(0176) 				if(windcounter==0){
    0318B 8409      LDD	R0,Y+9
    0318C 2000      TST	R0
    0318D F429      BNE	0x3193
(0177) 				    windcounter=1; //清零开启风速计数器
    0318E 2400      CLR	R0
    0318F 9403      INC	R0
    03190 8609      STD	Y+9,R0
(0178) 					timer1_init(); //开启风速传感器技术
    03191 940E 258B CALL	_timer1_init
(0179) 				}
(0180) 				if(page == 0 ){
    03193 800F      LDD	R0,Y+7
    03194 2000      TST	R0
    03195 F009      BEQ	0x3197
    03196 C15B      RJMP	0x32F2
(0181) 				
(0182) 				    LCD_const_disp(4,1,"正在检测");
    03197 E58F      LDI	R24,0x5F
    03198 E095      LDI	R25,5
    03199 8399      STD	Y+1,R25
    0319A 8388      ST	Y,R24
    0319B E021      LDI	R18,1
    0319C E004      LDI	R16,4
    0319D 940E 3EE2 CALL	_LCD_const_disp
(0183) 					LCD_print4num(4,5,config.time1-config.now);
    0319F 9020 08BB LDS	R2,config+12
    031A1 9030 08BC LDS	R3,config+13
    031A3 9040 08B7 LDS	R4,config+8
    031A5 9050 08B8 LDS	R5,config+9
    031A7 1842      SUB	R4,R2
    031A8 0853      SBC	R5,R3
    031A9 8259      STD	Y+1,R5
    031AA 8248      ST	Y,R4
    031AB E025      LDI	R18,5
    031AC E004      LDI	R16,4
    031AD 940E 41A4 CALL	_LCD_print4num
(0184) 					LCD_const_disp(2,6,"      ");
    031AF E588      LDI	R24,0x58
    031B0 E095      LDI	R25,5
    031B1 8399      STD	Y+1,R25
    031B2 8388      ST	Y,R24
    031B3 E026      LDI	R18,6
    031B4 E002      LDI	R16,2
    031B5 940E 3EE2 CALL	_LCD_const_disp
(0185) 					LCD_const_disp(3,6,"      ");
    031B7 E588      LDI	R24,0x58
    031B8 E095      LDI	R25,5
    031B9 8399      STD	Y+1,R25
    031BA 8388      ST	Y,R24
    031BB E026      LDI	R18,6
    031BC E003      LDI	R16,3
    031BD 940E 3EE2 CALL	_LCD_const_disp
(0186) 				}
(0187) 			} 
    031BF C132      RJMP	0x32F2
(0188) 			else {
(0189) 			   //检测完成 获得数据 转换数据 存储数据 切换到非检测状态
(0190) 			    windcounter =0 ; //关闭风速传感器计数器
    031C0 2400      CLR	R0
    031C1 8609      STD	Y+9,R0
(0191) 				beep(1,1);
    031C2 E021      LDI	R18,1
    031C3 E001      LDI	R16,1
    031C4 940E 425F CALL	_beep
(0192) 				LCD_const_disp(4,1,"--计算并存储--       ");
    031C6 E482      LDI	R24,0x42
    031C7 E095      LDI	R25,5
    031C8 8399      STD	Y+1,R25
    031C9 8388      ST	Y,R24
    031CA E021      LDI	R18,1
    031CB E004      LDI	R16,4
    031CC 940E 3EE2 CALL	_LCD_const_disp
(0193) 				check();
    031CE 940E 2A5A CALL	_check
(0194) 				StructToChar(); //转成字符串
    031D0 940E 2BC4 CALL	_StructToChar
(0195) 				WriteFileHead();//重写文件头
    031D2 940E 271E CALL	_WriteFileHead
(0196) 				WriteSDFile();  //写入sd卡
    031D4 940E 2785 CALL	_WriteSDFile
(0197) 				if(config.autoSend>=1) {
    031D6 9180 08C4 LDS	R24,config+21
    031D8 3081      CPI	R24,1
    031D9 F010      BCS	0x31DC
(0198) 					 zigbee_send_date(); //zigbee发送
    031DA 940E 3C5C CALL	_zigbee_send_date
(0199) 				}
(0200) 				Result.Index++; //索引自增一
    031DC E041      LDI	R20,1
    031DD E050      LDI	R21,0
    031DE E060      LDI	R22,0
    031DF E070      LDI	R23,0
    031E0 9040 0649 LDS	R4,Result+12
    031E2 9050 064A LDS	R5,Result+13
    031E4 9020 0647 LDS	R2,Result+10
    031E6 9030 0648 LDS	R3,Result+11
    031E8 0E24      ADD	R2,R20
    031E9 1E35      ADC	R3,R21
    031EA 1E46      ADC	R4,R22
    031EB 1E57      ADC	R5,R23
    031EC 9230 0648 STS	Result+11,R3
    031EE 9220 0647 STS	Result+10,R2
    031F0 9250 064A STS	Result+13,R5
    031F2 9240 0649 STS	Result+12,R4
(0201) 				is_on=0; //切换到非检测状态
    031F4 2400      CLR	R0
    031F5 8608      STD	Y+8,R0
(0202) 				next_step_time=config.now+config.checkDeltaTime;//自动翻页时间更新
    031F6 9020 08C0 LDS	R2,config+17
    031F8 9030 08C1 LDS	R3,config+18
    031FA 2444      CLR	R4
    031FB FC37      SBRC	R3,7
    031FC 9440      COM	R4
    031FD 2455      CLR	R5
    031FE FC47      SBRC	R4,7
    031FF 9450      COM	R5
    03200 9080 08BD LDS	R8,config+14
    03202 9090 08BE LDS	R9,config+15
    03204 9060 08BB LDS	R6,config+12
    03206 9070 08BC LDS	R7,config+13
    03208 0C62      ADD	R6,R2
    03209 1C73      ADC	R7,R3
    0320A 1C84      ADC	R8,R4
    0320B 1C95      ADC	R9,R5
    0320C 826B      STD	Y+3,R6
    0320D 827C      STD	Y+4,R7
    0320E 828D      STD	Y+5,R8
    0320F 829E      STD	Y+6,R9
(0203) 				page=0;
    03210 820F      STD	Y+7,R0
(0204) 		   }
(0205) 		}
    03211 C0E0      RJMP	0x32F2
(0206) 		else { //is_on == 0 非检测状态 手动翻页/自动翻页
(0207) 		    dateRefresh(0);//不更新时间
    03212 2700      CLR	R16
    03213 D742      RCALL	_dateRefresh
(0208) 			_GUI_datashow(page); 
    03214 810F      LDD	R16,Y+7
    03215 D0E9      RCALL	__GUI_datashow
(0209) 			if(page == 0 ){
    03216 800F      LDD	R0,Y+7
    03217 2000      TST	R0
    03218 F4E9      BNE	0x3236
(0210) 				
(0211) 				    LCD_const_disp(4,1,"完成检测        ");
    03219 E381      LDI	R24,0x31
    0321A E095      LDI	R25,5
    0321B 8399      STD	Y+1,R25
    0321C 8388      ST	Y,R24
    0321D E021      LDI	R18,1
    0321E E004      LDI	R16,4
    0321F 940E 3EE2 CALL	_LCD_const_disp
(0212) 					if(config.autocheck == 1){
    03221 9180 08BF LDS	R24,config+16
    03223 3081      CPI	R24,1
    03224 F449      BNE	0x322E
(0213) 					    LCD_const_disp(4,7,"自动");
    03225 E789      LDI	R24,0x79
    03226 E095      LDI	R25,5
    03227 8399      STD	Y+1,R25
    03228 8388      ST	Y,R24
    03229 E027      LDI	R18,7
    0322A E004      LDI	R16,4
    0322B 940E 3EE2 CALL	_LCD_const_disp
(0214) 					}
    0322D C008      RJMP	0x3236
(0215) 					else {
(0216) 					    LCD_const_disp(4,7,"手动");
    0322E E784      LDI	R24,0x74
    0322F E095      LDI	R25,5
    03230 8399      STD	Y+1,R25
    03231 8388      ST	Y,R24
    03232 E027      LDI	R18,7
    03233 E004      LDI	R16,4
    03234 940E 3EE2 CALL	_LCD_const_disp
(0217) 					}
(0218) 					
(0219) 				}
(0220) 						//手动翻页 
(0221) 			if(key==up){ //上键 : 页面减 
    03236 2D8C      MOV	R24,R12
    03237 318E      CPI	R24,0x1E
    03238 F539      BNE	0x3260
(0222) 		        if(page>0) page--;
    03239 E080      LDI	R24,0
    0323A 800F      LDD	R0,Y+7
    0323B 1580      CP	R24,R0
    0323C F418      BCC	0x3240
    0323D 940A      DEC	R0
    0323E 820F      STD	Y+7,R0
    0323F C01C      RJMP	0x325C
(0223) 				else{
(0224) 				page =5;
    03240 E085      LDI	R24,5
    03241 838F      STD	Y+7,R24
(0225) 				next_step_time = config.now + config.checkDeltaTime;
    03242 9020 08C0 LDS	R2,config+17
    03244 9030 08C1 LDS	R3,config+18
    03246 2444      CLR	R4
    03247 FC37      SBRC	R3,7
    03248 9440      COM	R4
    03249 2455      CLR	R5
    0324A FC47      SBRC	R4,7
    0324B 9450      COM	R5
    0324C 9080 08BD LDS	R8,config+14
    0324E 9090 08BE LDS	R9,config+15
    03250 9060 08BB LDS	R6,config+12
    03252 9070 08BC LDS	R7,config+13
    03254 0C62      ADD	R6,R2
    03255 1C73      ADC	R7,R3
    03256 1C84      ADC	R8,R4
    03257 1C95      ADC	R9,R5
    03258 826B      STD	Y+3,R6
    03259 827C      STD	Y+4,R7
    0325A 828D      STD	Y+5,R8
    0325B 829E      STD	Y+6,R9
(0226) 				}
(0227) 		    	LCD_CLR();
    0325C 940E 3F88 CALL	_LCD_CLR
(0228) 		    	LCD_Init();
    0325E 940E 3F56 CALL	_LCD_Init
(0229) 			}
(0230) 			if(key==down){//下键 ： 页面加
    03260 2D8C      MOV	R24,R12
    03261 318D      CPI	R24,0x1D
    03262 F539      BNE	0x328A
(0231) 		        page++;
    03263 800F      LDD	R0,Y+7
    03264 9403      INC	R0
    03265 820F      STD	Y+7,R0
(0232) 				next_step_time = config.now + config.checkDeltaTime;
    03266 9020 08C0 LDS	R2,config+17
    03268 9030 08C1 LDS	R3,config+18
    0326A 2444      CLR	R4
    0326B FC37      SBRC	R3,7
    0326C 9440      COM	R4
    0326D 2455      CLR	R5
    0326E FC47      SBRC	R4,7
    0326F 9450      COM	R5
    03270 9080 08BD LDS	R8,config+14
    03272 9090 08BE LDS	R9,config+15
    03274 9060 08BB LDS	R6,config+12
    03276 9070 08BC LDS	R7,config+13
    03278 0C62      ADD	R6,R2
    03279 1C73      ADC	R7,R3
    0327A 1C84      ADC	R8,R4
    0327B 1C95      ADC	R9,R5
    0327C 826B      STD	Y+3,R6
    0327D 827C      STD	Y+4,R7
    0327E 828D      STD	Y+5,R8
    0327F 829E      STD	Y+6,R9
(0233) 		  		LCD_CLR();
    03280 940E 3F88 CALL	_LCD_CLR
(0234) 		    	LCD_Init();
    03282 940E 3F56 CALL	_LCD_Init
(0235) 				if(page >= 6 ) {
    03284 818F      LDD	R24,Y+7
    03285 3086      CPI	R24,6
    03286 F018      BCS	0x328A
(0236) 					page=0;
    03287 2400      CLR	R0
    03288 820F      STD	Y+7,R0
(0237) 					continue ;
    03289 C06C      RJMP	0x32F6
(0238) 				}
(0239) 			} 	
(0240) 			//LCD_print2num(4,1,page);
(0241) 			//LCD_print4num(4,3,config.now);
(0242) 			//LCD_print4num(4,6,next_step_time);
(0243) 			if( config.autocheck == 1 ){  //如果开启自动翻页
    0328A 9180 08BF LDS	R24,config+16
    0328C 3081      CPI	R24,1
    0328D F5A1      BNE	0x32C2
(0244) 			      if(config.now >= next_step_time || page >=6 )	{
    0328E 802B      LDD	R2,Y+3
    0328F 803C      LDD	R3,Y+4
    03290 804D      LDD	R4,Y+5
    03291 805E      LDD	R5,Y+6
    03292 9080 08BD LDS	R8,config+14
    03294 9090 08BE LDS	R9,config+15
    03296 9060 08BB LDS	R6,config+12
    03298 9070 08BC LDS	R7,config+13
    0329A 1462      CP	R6,R2
    0329B 0473      CPC	R7,R3
    0329C 0484      CPC	R8,R4
    0329D 0495      CPC	R9,R5
    0329E F418      BCC	0x32A2
    0329F 818F      LDD	R24,Y+7
    032A0 3086      CPI	R24,6
    032A1 F100      BCS	0x32C2
(0245) 				      next_step_time = config.now + config.checkDeltaTime;
    032A2 9020 08C0 LDS	R2,config+17
    032A4 9030 08C1 LDS	R3,config+18
    032A6 2444      CLR	R4
    032A7 FC37      SBRC	R3,7
    032A8 9440      COM	R4
    032A9 2455      CLR	R5
    032AA FC47      SBRC	R4,7
    032AB 9450      COM	R5
    032AC 9080 08BD LDS	R8,config+14
    032AE 9090 08BE LDS	R9,config+15
    032B0 9060 08BB LDS	R6,config+12
    032B2 9070 08BC LDS	R7,config+13
    032B4 0C62      ADD	R6,R2
    032B5 1C73      ADC	R7,R3
    032B6 1C84      ADC	R8,R4
    032B7 1C95      ADC	R9,R5
    032B8 826B      STD	Y+3,R6
    032B9 827C      STD	Y+4,R7
    032BA 828D      STD	Y+5,R8
    032BB 829E      STD	Y+6,R9
(0246) 					  page++;
    032BC 800F      LDD	R0,Y+7
    032BD 9403      INC	R0
    032BE 820F      STD	Y+7,R0
(0247) 					  LCD_CLR(); 
    032BF 940E 3F88 CALL	_LCD_CLR
(0248) 					  key=0;
    032C1 24CC      CLR	R12
(0249) 				  }  
(0250) 			}
(0251) 			if( page>=6 || key == left){
    032C2 818F      LDD	R24,Y+7
    032C3 3086      CPI	R24,6
    032C4 F418      BCC	0x32C8
    032C5 2D8C      MOV	R24,R12
    032C6 318B      CPI	R24,0x1B
    032C7 F551      BNE	0x32F2
(0252) 					      //翻到最后页，页面清零开启下次检测
(0253) 					      page = 0;
    032C8 2400      CLR	R0
    032C9 820F      STD	Y+7,R0
(0254) 						  dateRefresh(1); //刷新时间
    032CA E001      LDI	R16,1
    032CB D68A      RCALL	_dateRefresh
(0255) 						  is_on =1 ; //开启检测
    032CC 2400      CLR	R0
    032CD 9403      INC	R0
    032CE 8608      STD	Y+8,R0
(0256) 						  config.time1=config.now+config.THRESHOLD_delta_sec; //更新下次检测时间
    032CF 9040 08B5 LDS	R4,config+6
    032D1 9050 08B6 LDS	R5,config+7
    032D3 9020 08B3 LDS	R2,config+4
    032D5 9030 08B4 LDS	R3,config+5
    032D7 9080 08BD LDS	R8,config+14
    032D9 9090 08BE LDS	R9,config+15
    032DB 9060 08BB LDS	R6,config+12
    032DD 9070 08BC LDS	R7,config+13
    032DF 0C62      ADD	R6,R2
    032E0 1C73      ADC	R7,R3
    032E1 1C84      ADC	R8,R4
    032E2 1C95      ADC	R9,R5
    032E3 9270 08B8 STS	config+9,R7
    032E5 9260 08B7 STS	config+8,R6
    032E7 9290 08BA STS	config+11,R9
    032E9 9280 08B9 STS	config+10,R8
(0257) 						  Result.TempChar[0]=0; //清除上次结果
    032EB 2422      CLR	R2
    032EC 9220 066A STS	Result+45,R2
(0258) 						  Result.WSChar[0]=0;
    032EE 9220 0674 STS	Result+55,R2
(0259) 					   	  LCD_CLR();  
    032F0 940E 3F88 CALL	_LCD_CLR
(0260) 					  }
(0261) 				         
(0262) 				
(0263) 
(0264) 		} 
(0265) 		
(0266) 	    delayms(10); 
    032F2 E00A      LDI	R16,0xA
    032F3 E010      LDI	R17,0
    032F4 940E 253A CALL	_delayms
    032F6 940E 25F7 CALL	_alwaysCheck
    032F8 2EC0      MOV	R12,R16
    032F9 2300      TST	R16
    032FA F009      BEQ	0x32FC
    032FB CE35      RJMP	0x3131
    032FC 962A      ADIW	R28,0xA
    032FD 940C 4AFC JMP	pop_xgsetF0FC
__GUI_datashow:
  page                 --> R20
    032FF 940E 4B26 CALL	push_xgsetF00C
    03301 2F40      MOV	R20,R16
    03302 9722      SBIW	R28,2
(0267) 	}//end while
(0268) }//end function
(0269) void _GUI_datashow(char page){
(0270) 	if(page == 0){
    03303 2344      TST	R20
    03304 F539      BNE	0x332C
(0271)  	//显示日期时间
(0272) 	    LCD_var_disp(1,1,GUI_get_date());
    03305 D205      RCALL	_GUI_get_date
    03306 8319      STD	Y+1,R17
    03307 8308      ST	Y,R16
    03308 E021      LDI	R18,1
    03309 E001      LDI	R16,1
    0330A 940E 3F0F CALL	_LCD_var_disp
(0273) 	//显示温度
(0274) 	 	LCD_const_disp(2,1,"温度 (℃):      ");
    0330C E280      LDI	R24,0x20
    0330D E095      LDI	R25,5
    0330E 8399      STD	Y+1,R25
    0330F 8388      ST	Y,R24
    03310 E021      LDI	R18,1
    03311 E002      LDI	R16,2
    03312 940E 3EE2 CALL	_LCD_const_disp
(0275) 	 	LCD_var_disp(2,6,Result.TempChar);
    03314 E68A      LDI	R24,0x6A
    03315 E096      LDI	R25,6
    03316 8399      STD	Y+1,R25
    03317 8388      ST	Y,R24
    03318 E026      LDI	R18,6
    03319 E002      LDI	R16,2
    0331A 940E 3F0F CALL	_LCD_var_disp
(0276) 	//显示风速
(0277) 	    LCD_const_disp(3,1,"风速(m/s):      ");
    0331C E08F      LDI	R24,0xF
    0331D E095      LDI	R25,5
    0331E 8399      STD	Y+1,R25
    0331F 8388      ST	Y,R24
    03320 E021      LDI	R18,1
    03321 E003      LDI	R16,3
    03322 940E 3EE2 CALL	_LCD_const_disp
(0278) 	 	LCD_const_disp(3,6,Result.WSChar);
    03324 E784      LDI	R24,0x74
    03325 E096      LDI	R25,6
    03326 8399      STD	Y+1,R25
    03327 8388      ST	Y,R24
    03328 E026      LDI	R18,6
    03329 E003      LDI	R16,3
    0332A 940E 3EE2 CALL	_LCD_const_disp
(0279) 
(0280) 	 } 
(0281) 	 if(page == 1){
    0332C 3041      CPI	R20,1
    0332D F5B9      BNE	0x3365
(0282) 	     LCD_var_disp(1,1,GUI_get_date());
    0332E D1DC      RCALL	_GUI_get_date
    0332F 8319      STD	Y+1,R17
    03330 8308      ST	Y,R16
    03331 E021      LDI	R18,1
    03332 E001      LDI	R16,1
    03333 940E 3F0F CALL	_LCD_var_disp
(0283) 		 LCD_const_disp(2,1,"风冷指数: ");
    03335 E084      LDI	R24,4
    03336 E095      LDI	R25,5
    03337 8399      STD	Y+1,R25
    03338 8388      ST	Y,R24
    03339 E021      LDI	R18,1
    0333A E002      LDI	R16,2
    0333B 940E 3EE2 CALL	_LCD_const_disp
(0284) 		 LCD_var_disp(2,6,Result.WCIChar);						
    0333D E78D      LDI	R24,0x7D
    0333E E096      LDI	R25,6
    0333F 8399      STD	Y+1,R25
    03340 8388      ST	Y,R24
    03341 E026      LDI	R18,6
    03342 E002      LDI	R16,2
    03343 940E 3F0F CALL	_LCD_var_disp
(0285) 		 LCD_const_disp(3,1,"等价温度: ");
    03345 EF89      LDI	R24,0xF9
    03346 E094      LDI	R25,4
    03347 8399      STD	Y+1,R25
    03348 8388      ST	Y,R24
    03349 E021      LDI	R18,1
    0334A E003      LDI	R16,3
    0334B 940E 3EE2 CALL	_LCD_const_disp
(0286) 		 LCD_var_disp(3,6,Result.ECTChar);	 
    0334D E889      LDI	R24,0x89
    0334E E096      LDI	R25,6
    0334F 8399      STD	Y+1,R25
    03350 8388      ST	Y,R24
    03351 E026      LDI	R18,6
    03352 E003      LDI	R16,3
    03353 940E 3F0F CALL	_LCD_var_disp
(0287) 		 LCD_const_disp(4,1,"相当温度: ");
    03355 EE8E      LDI	R24,0xEE
    03356 E094      LDI	R25,4
    03357 8399      STD	Y+1,R25
    03358 8388      ST	Y,R24
    03359 E021      LDI	R18,1
    0335A E004      LDI	R16,4
    0335B 940E 3EE2 CALL	_LCD_const_disp
(0288) 		 LCD_var_disp(4,6,Result.TeqChar);	
    0335D E983      LDI	R24,0x93
    0335E E096      LDI	R25,6
    0335F 8399      STD	Y+1,R25
    03360 8388      ST	Y,R24
    03361 E026      LDI	R18,6
    03362 E004      LDI	R16,4
    03363 940E 3F0F CALL	_LCD_var_disp
(0289) 	 }
(0290) 	 if(page == 2){
    03365 3042      CPI	R20,2
    03366 F009      BEQ	0x3368
    03367 C03F      RJMP	0x33A7
(0291) 	     LCD_var_disp(1,1,GUI_get_date());
    03368 D1A2      RCALL	_GUI_get_date
    03369 0158      MOVW	R10,R16
    0336A 82B9      STD	Y+1,R11
    0336B 82A8      ST	Y,R10
    0336C E021      LDI	R18,1
    0336D E001      LDI	R16,1
    0336E 940E 3F0F CALL	_LCD_var_disp
(0292) 		 LCD_const_disp(2,1,"冻伤危害性:");
    03370 EE82      LDI	R24,0xE2
    03371 E094      LDI	R25,4
    03372 8399      STD	Y+1,R25
    03373 8388      ST	Y,R24
    03374 E021      LDI	R18,1
    03375 E002      LDI	R16,2
    03376 940E 3EE2 CALL	_LCD_const_disp
(0293) 	 if(Result.WeiHai==0){LCD_const_disp(3,1,"  冻伤危害性小");			 }
    03378 9020 0699 LDS	R2,Result+92
    0337A 2022      TST	R2
    0337B F449      BNE	0x3385
    0337C ED83      LDI	R24,0xD3
    0337D E094      LDI	R25,4
    0337E 8399      STD	Y+1,R25
    0337F 8388      ST	Y,R24
    03380 E021      LDI	R18,1
    03381 E003      LDI	R16,3
    03382 940E 3EE2 CALL	_LCD_const_disp
    03384 C022      RJMP	0x33A7
(0294) 	 else if(Result.WeiHai==1){	LCD_const_disp(3,1,"  冻伤危害性较大");	 }
    03385 9180 0699 LDS	R24,Result+92
    03387 3081      CPI	R24,1
    03388 F449      BNE	0x3392
    03389 EC82      LDI	R24,0xC2
    0338A E094      LDI	R25,4
    0338B 8399      STD	Y+1,R25
    0338C 8388      ST	Y,R24
    0338D E021      LDI	R18,1
    0338E E003      LDI	R16,3
    0338F 940E 3EE2 CALL	_LCD_const_disp
    03391 C015      RJMP	0x33A7
(0295) 	 else if(Result.WeiHai==2){	LCD_const_disp(3,1,"  冻伤危害性很大");	 }
    03392 9180 0699 LDS	R24,Result+92
    03394 3082      CPI	R24,2
    03395 F449      BNE	0x339F
    03396 EB81      LDI	R24,0xB1
    03397 E094      LDI	R25,4
    03398 8399      STD	Y+1,R25
    03399 8388      ST	Y,R24
    0339A E021      LDI	R18,1
    0339B E003      LDI	R16,3
    0339C 940E 3EE2 CALL	_LCD_const_disp
    0339E C008      RJMP	0x33A7
(0296) 	 else LCD_const_disp(3,1,"冻伤危害性小。");
    0339F EA82      LDI	R24,0xA2
    033A0 E094      LDI	R25,4
    033A1 8399      STD	Y+1,R25
    033A2 8388      ST	Y,R24
    033A3 E021      LDI	R18,1
    033A4 E003      LDI	R16,3
    033A5 940E 3EE2 CALL	_LCD_const_disp
(0297) 	 }	  
(0298) 	 if(page==3){
    033A7 3043      CPI	R20,3
    033A8 F009      BEQ	0x33AA
    033A9 C061      RJMP	0x340B
(0299) 	     LCD_const_disp(1,1,labelH);		
    033AA E98E      LDI	R24,0x9E
    033AB E092      LDI	R25,2
    033AC 8399      STD	Y+1,R25
    033AD 8388      ST	Y,R24
    033AE E021      LDI	R18,1
    033AF E001      LDI	R16,1
    033B0 940E 3EE2 CALL	_LCD_const_disp
(0300) 	 	 switch( Result.WeiHai ){
    033B2 9160 0699 LDS	R22,Result+92
    033B4 2777      CLR	R23
    033B5 3060      CPI	R22,0
    033B6 0767      CPC	R22,R23
    033B7 F049      BEQ	0x33C1
    033B8 3061      CPI	R22,1
    033B9 E0E0      LDI	R30,0
    033BA 077E      CPC	R23,R30
    033BB F0F1      BEQ	0x33DA
    033BC 3062      CPI	R22,2
    033BD E0E0      LDI	R30,0
    033BE 077E      CPC	R23,R30
    033BF F199      BEQ	0x33F3
    033C0 C04A      RJMP	0x340B
(0301) 			case 0 :
(0302) 			LCD_const_disp(2,1,H01);
    033C1 EC8A      LDI	R24,0xCA
    033C2 E092      LDI	R25,2
    033C3 8399      STD	Y+1,R25
    033C4 8388      ST	Y,R24
    033C5 E021      LDI	R18,1
    033C6 E002      LDI	R16,2
    033C7 940E 3EE2 CALL	_LCD_const_disp
(0303) 			LCD_const_disp(3,1,H02);
    033C9 ED8A      LDI	R24,0xDA
    033CA E092      LDI	R25,2
    033CB 8399      STD	Y+1,R25
    033CC 8388      ST	Y,R24
    033CD E021      LDI	R18,1
    033CE E003      LDI	R16,3
    033CF 940E 3EE2 CALL	_LCD_const_disp
(0304) 			LCD_const_disp(4,1,H03);
    033D1 EE85      LDI	R24,0xE5
    033D2 E092      LDI	R25,2
    033D3 8399      STD	Y+1,R25
    033D4 8388      ST	Y,R24
    033D5 E021      LDI	R18,1
    033D6 E004      LDI	R16,4
    033D7 940E 3EE2 CALL	_LCD_const_disp
(0305) 			break;
    033D9 C031      RJMP	0x340B
(0306) 			case 1 : 
(0307) 			LCD_const_disp(2,1,H11);
    033DA E081      LDI	R24,1
    033DB E093      LDI	R25,3
    033DC 8399      STD	Y+1,R25
    033DD 8388      ST	Y,R24
    033DE E021      LDI	R18,1
    033DF E002      LDI	R16,2
    033E0 940E 3EE2 CALL	_LCD_const_disp
(0308) 			LCD_const_disp(3,1,H12);
    033E2 EE85      LDI	R24,0xE5
    033E3 E092      LDI	R25,2
    033E4 8399      STD	Y+1,R25
    033E5 8388      ST	Y,R24
    033E6 E021      LDI	R18,1
    033E7 E003      LDI	R16,3
    033E8 940E 3EE2 CALL	_LCD_const_disp
(0309) 			LCD_const_disp(4,1,H13);
    033EA E18A      LDI	R24,0x1A
    033EB E093      LDI	R25,3
    033EC 8399      STD	Y+1,R25
    033ED 8388      ST	Y,R24
    033EE E021      LDI	R18,1
    033EF E004      LDI	R16,4
    033F0 940E 3EE2 CALL	_LCD_const_disp
(0310) 			break ;	
    033F2 C018      RJMP	0x340B
(0311) 			case 2 :
(0312) 			LCD_const_disp(2,1,H21);
    033F3 E48E      LDI	R24,0x4E
    033F4 E093      LDI	R25,3
    033F5 8399      STD	Y+1,R25
    033F6 8388      ST	Y,R24
    033F7 E021      LDI	R18,1
    033F8 E002      LDI	R16,2
    033F9 940E 3EE2 CALL	_LCD_const_disp
(0313) 			LCD_const_disp(3,1,H22);
    033FB E680      LDI	R24,0x60
    033FC E093      LDI	R25,3
    033FD 8399      STD	Y+1,R25
    033FE 8388      ST	Y,R24
    033FF E021      LDI	R18,1
    03400 E003      LDI	R16,3
    03401 940E 3EE2 CALL	_LCD_const_disp
(0314) 			LCD_const_disp(4,1,H23);
    03403 EE85      LDI	R24,0xE5
    03404 E092      LDI	R25,2
    03405 8399      STD	Y+1,R25
    03406 8388      ST	Y,R24
    03407 E021      LDI	R18,1
    03408 E004      LDI	R16,4
    03409 940E 3EE2 CALL	_LCD_const_disp
(0315) 			break;
(0316) 			default : ;
(0317) 		}
(0318) 	 } 
(0319) 	 if(page==4){
    0340B 3044      CPI	R20,4
    0340C F009      BEQ	0x340E
    0340D C086      RJMP	0x3494
(0320) 	 		LCD_const_disp(1,1,labelM);		
    0340E EA8C      LDI	R24,0xAC
    0340F E092      LDI	R25,2
    03410 8399      STD	Y+1,R25
    03411 8388      ST	Y,R24
    03412 E021      LDI	R18,1
    03413 E001      LDI	R16,1
    03414 940E 3EE2 CALL	_LCD_const_disp
(0321) 	 		switch( Result.WeiHai ){
    03416 9160 0699 LDS	R22,Result+92
    03418 2777      CLR	R23
    03419 3060      CPI	R22,0
    0341A 0767      CPC	R22,R23
    0341B F059      BEQ	0x3427
    0341C 3061      CPI	R22,1
    0341D E0E0      LDI	R30,0
    0341E 077E      CPC	R23,R30
    0341F F409      BNE	0x3421
    03420 C052      RJMP	0x3473
    03421 3062      CPI	R22,2
    03422 E0E0      LDI	R30,0
    03423 077E      CPC	R23,R30
    03424 F409      BNE	0x3426
    03425 C066      RJMP	0x348C
    03426 C06D      RJMP	0x3494
(0322) 	 			case 0 :
(0323) 				LCD_const_disp(2,1,M01);
    03427 EC8A      LDI	R24,0xCA
    03428 E092      LDI	R25,2
    03429 8399      STD	Y+1,R25
    0342A 8388      ST	Y,R24
    0342B E021      LDI	R18,1
    0342C E002      LDI	R16,2
    0342D 940E 3EE2 CALL	_LCD_const_disp
(0324) 				LCD_const_disp(3,1,M02);
    0342F EE85      LDI	R24,0xE5
    03430 E092      LDI	R25,2
    03431 8399      STD	Y+1,R25
    03432 8388      ST	Y,R24
    03433 E021      LDI	R18,1
    03434 E003      LDI	R16,3
    03435 940E 3EE2 CALL	_LCD_const_disp
(0325) 				if(Result.Temperature < -17.7){
    03437 9040 0668 LDS	R4,Result+43
    03439 9050 0669 LDS	R5,Result+44
    0343B 9020 0666 LDS	R2,Result+41
    0343D 9030 0667 LDS	R3,Result+42
    0343F EC02      LDI	R16,0xC2
    03440 E010      LDI	R17,0
    03441 940E 4A8F CALL	elpm32
    03443 933A      ST	-Y,R19
    03444 932A      ST	-Y,R18
    03445 931A      ST	-Y,R17
    03446 930A      ST	-Y,R16
    03447 0181      MOVW	R16,R2
    03448 0192      MOVW	R18,R4
    03449 940E 4E87 CALL	fpcmp2
    0344B F44C      BGE	0x3455
(0326) 				    LCD_const_disp(4,1,"戴面罩；禁油彩。");
    0344C E981      LDI	R24,0x91
    0344D E094      LDI	R25,4
    0344E 8399      STD	Y+1,R25
    0344F 8388      ST	Y,R24
    03450 E021      LDI	R18,1
    03451 E004      LDI	R16,4
    03452 940E 3EE2 CALL	_LCD_const_disp
(0327) 				}
    03454 C03F      RJMP	0x3494
(0328) 				else if(Result.Temperature < -12){
    03455 9040 0668 LDS	R4,Result+43
    03457 9050 0669 LDS	R5,Result+44
    03459 9020 0666 LDS	R2,Result+41
    0345B 9030 0667 LDS	R3,Result+42
    0345D EB0E      LDI	R16,0xBE
    0345E E010      LDI	R17,0
    0345F 940E 4A8F CALL	elpm32
    03461 933A      ST	-Y,R19
    03462 932A      ST	-Y,R18
    03463 931A      ST	-Y,R17
    03464 930A      ST	-Y,R16
    03465 0181      MOVW	R16,R2
    03466 0192      MOVW	R18,R4
    03467 940E 4E87 CALL	fpcmp2
    03469 F554      BGE	0x3494
(0329) 				    LCD_const_disp(4,1,"禁油彩。        \0");
    0346A E78F      LDI	R24,0x7F
    0346B E094      LDI	R25,4
    0346C 8399      STD	Y+1,R25
    0346D 8388      ST	Y,R24
    0346E E021      LDI	R18,1
    0346F E004      LDI	R16,4
    03470 940E 3EE2 CALL	_LCD_const_disp
(0330) 				}
(0331) 				break;
    03472 C021      RJMP	0x3494
(0332) 				case 1 : 
(0333) 			    LCD_const_disp(2,1,M11);
    03473 EC8A      LDI	R24,0xCA
    03474 E092      LDI	R25,2
    03475 8399      STD	Y+1,R25
    03476 8388      ST	Y,R24
    03477 E021      LDI	R18,1
    03478 E002      LDI	R16,2
    03479 940E 3EE2 CALL	_LCD_const_disp
(0334) 				LCD_const_disp(3,1,M12);
    0347B E28A      LDI	R24,0x2A
    0347C E093      LDI	R25,3
    0347D 8399      STD	Y+1,R25
    0347E 8388      ST	Y,R24
    0347F E021      LDI	R18,1
    03480 E003      LDI	R16,3
    03481 940E 3EE2 CALL	_LCD_const_disp
(0335) 				LCD_const_disp(4,1,M13);
    03483 E38C      LDI	R24,0x3C
    03484 E093      LDI	R25,3
    03485 8399      STD	Y+1,R25
    03486 8388      ST	Y,R24
    03487 E021      LDI	R18,1
    03488 E004      LDI	R16,4
    03489 940E 3EE2 CALL	_LCD_const_disp
(0336) 				break ;
    0348B C008      RJMP	0x3494
(0337) 				case 2 :
(0338) 				LCD_const_disp(2,1,M21);
    0348C E782      LDI	R24,0x72
    0348D E093      LDI	R25,3
    0348E 8399      STD	Y+1,R25
    0348F 8388      ST	Y,R24
    03490 E021      LDI	R18,1
    03491 E002      LDI	R16,2
    03492 940E 3EE2 CALL	_LCD_const_disp
(0339) 				break ;
(0340) 				default :;
(0341) 	 		}
(0342) 	 }
(0343) 	 if(page==5){
    03494 3045      CPI	R20,5
    03495 F009      BEQ	0x3497
    03496 C071      RJMP	0x3508
(0344) 	     LCD_const_disp(1,1,labelL);		
    03497 EB8C      LDI	R24,0xBC
    03498 E092      LDI	R25,2
    03499 8399      STD	Y+1,R25
    0349A 8388      ST	Y,R24
    0349B E021      LDI	R18,1
    0349C E001      LDI	R16,1
    0349D 940E 3EE2 CALL	_LCD_const_disp
(0345) 	 	 switch( Result.WeiHai ){	
    0349F 9140 0699 LDS	R20,Result+92
    034A1 2755      CLR	R21
    034A2 3040      CPI	R20,0
    034A3 0745      CPC	R20,R21
    034A4 F059      BEQ	0x34B0
    034A5 3041      CPI	R20,1
    034A6 E0E0      LDI	R30,0
    034A7 075E      CPC	R21,R30
    034A8 F409      BNE	0x34AA
    034A9 C03D      RJMP	0x34E7
    034AA 3042      CPI	R20,2
    034AB E0E0      LDI	R30,0
    034AC 075E      CPC	R21,R30
    034AD F409      BNE	0x34AF
    034AE C051      RJMP	0x3500
    034AF C058      RJMP	0x3508
(0346) 		     case 0 :
(0347) 			 LCD_const_disp(2,1,L01);
    034B0 EF87      LDI	R24,0xF7
    034B1 E092      LDI	R25,2
    034B2 8399      STD	Y+1,R25
    034B3 8388      ST	Y,R24
    034B4 E021      LDI	R18,1
    034B5 E002      LDI	R16,2
    034B6 940E 3EE2 CALL	_LCD_const_disp
(0348) 			 if(Result.Temperature < -12) {
    034B8 9040 0668 LDS	R4,Result+43
    034BA 9050 0669 LDS	R5,Result+44
    034BC 9020 0666 LDS	R2,Result+41
    034BE 9030 0667 LDS	R3,Result+42
    034C0 EB0E      LDI	R16,0xBE
    034C1 E010      LDI	R17,0
    034C2 940E 4A8F CALL	elpm32
    034C4 933A      ST	-Y,R19
    034C5 932A      ST	-Y,R18
    034C6 931A      ST	-Y,R17
    034C7 930A      ST	-Y,R16
    034C8 0181      MOVW	R16,R2
    034C9 0192      MOVW	R18,R4
    034CA 940E 4E87 CALL	fpcmp2
    034CC F48C      BGE	0x34DE
(0349) 			 LCD_const_disp(3,1,L02);
    034CD E081      LDI	R24,1
    034CE E093      LDI	R25,3
    034CF 8399      STD	Y+1,R25
    034D0 8388      ST	Y,R24
    034D1 E021      LDI	R18,1
    034D2 E003      LDI	R16,3
    034D3 940E 3EE2 CALL	_LCD_const_disp
(0350) 			 LCD_const_disp(4,1,L03);
    034D5 E08B      LDI	R24,0xB
    034D6 E093      LDI	R25,3
    034D7 8399      STD	Y+1,R25
    034D8 8388      ST	Y,R24
    034D9 E021      LDI	R18,1
    034DA E004      LDI	R16,4
    034DB 940E 3EE2 CALL	_LCD_const_disp
(0351) 			 } 
    034DD C02A      RJMP	0x3508
(0352) 			 else {
(0353) 			 LCD_const_disp(3,1,L03);
    034DE E08B      LDI	R24,0xB
    034DF E093      LDI	R25,3
    034E0 8399      STD	Y+1,R25
    034E1 8388      ST	Y,R24
    034E2 E021      LDI	R18,1
    034E3 E003      LDI	R16,3
    034E4 940E 3EE2 CALL	_LCD_const_disp
(0354) 			 }
(0355) 			 break;
    034E6 C021      RJMP	0x3508
(0356) 			 case 1: 
(0357) 			 LCD_const_disp(2,1,L11);
    034E7 E48E      LDI	R24,0x4E
    034E8 E093      LDI	R25,3
    034E9 8399      STD	Y+1,R25
    034EA 8388      ST	Y,R24
    034EB E021      LDI	R18,1
    034EC E002      LDI	R16,2
    034ED 940E 3EE2 CALL	_LCD_const_disp
(0358) 			 LCD_const_disp(3,1,L12);
    034EF E680      LDI	R24,0x60
    034F0 E093      LDI	R25,3
    034F1 8399      STD	Y+1,R25
    034F2 8388      ST	Y,R24
    034F3 E021      LDI	R18,1
    034F4 E003      LDI	R16,3
    034F5 940E 3EE2 CALL	_LCD_const_disp
(0359) 			 LCD_const_disp(3,1,L13);
    034F7 EE85      LDI	R24,0xE5
    034F8 E092      LDI	R25,2
    034F9 8399      STD	Y+1,R25
    034FA 8388      ST	Y,R24
    034FB E021      LDI	R18,1
    034FC E003      LDI	R16,3
    034FD 940E 3EE2 CALL	_LCD_const_disp
(0360) 			 break ;
    034FF C008      RJMP	0x3508
(0361) 			 case 2 :
(0362) 			 LCD_const_disp(2,1,L21);
    03500 E782      LDI	R24,0x72
    03501 E093      LDI	R25,3
    03502 8399      STD	Y+1,R25
    03503 8388      ST	Y,R24
    03504 E021      LDI	R18,1
    03505 E002      LDI	R16,2
    03506 940E 3EE2 CALL	_LCD_const_disp
(0363) 			 break;
(0364) 			 default : ;
(0365) 		} //end switch
(0366) 	}  //end if
    03508 9622      ADIW	R28,2
    03509 940C 4B2D JMP	pop_xgsetF00C
(0367) }
(0368) char * GUI_get_date(void) {  
(0369)   //格式:12月11日19:00:00
(0370)     GUI_date[0]=Result.Date[4]; 
_GUI_get_date:
    0350B 9020 0657 LDS	R2,Result+26
    0350D 9220 0392 STS	GUI_date,R2
(0371)     GUI_date[1]=Result.Date[5];
    0350F 9020 0658 LDS	R2,Result+27
    03511 9220 0393 STS	GUI_date+1,R2
(0372)     GUI_date[4]=Result.Date[6];
    03513 9020 0659 LDS	R2,Result+28
    03515 9220 0396 STS	GUI_date+4,R2
(0373)     GUI_date[5]=Result.Date[7];
    03517 9020 065A LDS	R2,Result+29
    03519 9220 0397 STS	GUI_date+5,R2
(0374)     GUI_date[8]=Result.Time[0];
    0351B 9020 065C LDS	R2,Result+31
    0351D 9220 039A STS	GUI_date+8,R2
(0375)     GUI_date[9]=Result.Time[1];
    0351F 9020 065D LDS	R2,Result+32
    03521 9220 039B STS	GUI_date+9,R2
(0376)     GUI_date[11]=Result.Time[3];
    03523 9020 065F LDS	R2,Result+34
    03525 9220 039D STS	GUI_date+11,R2
(0377)     GUI_date[12]=Result.Time[4];
    03527 9020 0660 LDS	R2,Result+35
    03529 9220 039E STS	GUI_date+12,R2
(0378)     GUI_date[14]=Result.Time[6];
    0352B 9020 0662 LDS	R2,Result+37
    0352D 9220 03A0 STS	GUI_date+14,R2
(0379)     GUI_date[15]=Result.Time[7];
    0352F 9020 0663 LDS	R2,Result+38
    03531 9220 03A1 STS	GUI_date+15,R2
(0380)     GUI_date[16]='\0';
    03533 2422      CLR	R2
    03534 9220 03A2 STS	GUI_date+16,R2
(0381)     return GUI_date;
    03536 E902      LDI	R16,0x92
    03537 E013      LDI	R17,3
    03538 9508      RET
_GUI_set_time:
  GUI_down             --> Y,+5
  GUI_up               --> Y,+2
  ary                  --> R12
  p                    --> Y,+10
  i                    --> R14
  keyc                 --> R20
  pT                   --> R10
  pD                   --> Y,+8
    03539 940E 4B07 CALL	push_xgsetF0FC
    0353B 972B      SBIW	R28,0xB
(0382) }
(0383) //设置时间 菜单 
(0384) void GUI_set_time(void){
(0385)     unsigned char p=2;
    0353C E082      LDI	R24,2
    0353D 878A      STD	Y+10,R24
(0386) 	char GUI_up[]= "↑";
    0353E EA83      LDI	R24,0xA3
    0353F E093      LDI	R25,3
    03540 01FE      MOVW	R30,R28
    03541 9632      ADIW	R30,2
    03542 E003      LDI	R16,3
    03543 E010      LDI	R17,0
    03544 93FA      ST	-Y,R31
    03545 93EA      ST	-Y,R30
    03546 939A      ST	-Y,R25
    03547 938A      ST	-Y,R24
    03548 940E 4BB7 CALL	asgnblk
(0387) 	char GUI_down[]= "↓";
    0354A EA86      LDI	R24,0xA6
    0354B E093      LDI	R25,3
    0354C 01FE      MOVW	R30,R28
    0354D 9635      ADIW	R30,5
    0354E E003      LDI	R16,3
    0354F E010      LDI	R17,0
    03550 93FA      ST	-Y,R31
    03551 93EA      ST	-Y,R30
    03552 939A      ST	-Y,R25
    03553 938A      ST	-Y,R24
    03554 940E 4BB7 CALL	asgnblk
(0388) 	char *pD=NULL,*pT=NULL;
    03556 2400      CLR	R0
    03557 2411      CLR	R1
    03558 8619      STD	Y+9,R1
    03559 8608      STD	Y+8,R0
(0389) 	char *ary=GUI_up;
    0355A 01CE      MOVW	R24,R28
    0355B 9602      ADIW	R24,2
    0355C 016C      MOVW	R12,R24
(0390) 	unsigned char i=0,keyc=NO_KEY;
    0355D 24EE      CLR	R14
    0355E 2744      CLR	R20
(0391) 	LCD_CLR(); //清屏
    0355F 940E 3F88 CALL	_LCD_CLR
(0392) 	pD="2012年12月31日\0";
    03561 E68F      LDI	R24,0x6F
    03562 E094      LDI	R25,4
    03563 8799      STD	Y+9,R25
    03564 8788      STD	Y+8,R24
(0393) 	pT="12: 30: 59\0";
    03565 E683      LDI	R24,0x63
    03566 E094      LDI	R25,4
    03567 015C      MOVW	R10,R24
(0394) 	LCD_const_disp(1,1,"时间设置:       ");
    03568 E582      LDI	R24,0x52
    03569 E094      LDI	R25,4
    0356A 8399      STD	Y+1,R25
    0356B 8388      ST	Y,R24
    0356C E021      LDI	R18,1
    0356D E001      LDI	R16,1
    0356E 940E 3EE2 CALL	_LCD_const_disp
(0395) 	LCD_const_disp(4,7,"保存");
    03570 E48D      LDI	R24,0x4D
    03571 E094      LDI	R25,4
    03572 8399      STD	Y+1,R25
    03573 8388      ST	Y,R24
    03574 E027      LDI	R18,7
    03575 E004      LDI	R16,4
    03576 940E 3EE2 CALL	_LCD_const_disp
(0396) 	LCD_var_disp(3,p,ary);
    03578 82D9      STD	Y+1,R13
    03579 82C8      ST	Y,R12
    0357A 852A      LDD	R18,Y+10
    0357B E003      LDI	R16,3
    0357C 940E 3F0F CALL	_LCD_var_disp
(0397) 	LCD_var_disp(2,1,pD);
    0357E 8408      LDD	R0,Y+8
    0357F 8419      LDD	R1,Y+9
    03580 8219      STD	Y+1,R1
    03581 8208      ST	Y,R0
    03582 E021      LDI	R18,1
    03583 E002      LDI	R16,2
    03584 940E 3F0F CALL	_LCD_var_disp
(0398) 	LCD_var_disp(4,1,pT);
    03586 82B9      STD	Y+1,R11
    03587 82A8      ST	Y,R10
    03588 E021      LDI	R18,1
    03589 E004      LDI	R16,4
    0358A 940E 3F0F CALL	_LCD_var_disp
(0399) 	delayms(250);
    0358C EF0A      LDI	R16,0xFA
    0358D E010      LDI	R17,0
    0358E 940E 253A CALL	_delayms
    03590 C1F5      RJMP	0x3786
(0400) 	while(alwaysCheck()){
(0401) 	    keyc=kbscan();
    03591 940E 44E8 CALL	_kbscan
    03593 2F40      MOV	R20,R16
(0402) 		pD[2]=Result.Date[2];
    03594 9020 0655 LDS	R2,Result+24
    03596 85E8      LDD	R30,Y+8
    03597 85F9      LDD	R31,Y+9
    03598 8222      STD	Z+2,R2
(0403) 		pD[3]=Result.Date[3];
    03599 9020 0656 LDS	R2,Result+25
    0359B 8223      STD	Z+3,R2
(0404) 		pD[6]=Result.Date[4];
    0359C 9020 0657 LDS	R2,Result+26
    0359E 8226      STD	Z+6,R2
(0405) 		pD[7]=Result.Date[5];
    0359F 9020 0658 LDS	R2,Result+27
    035A1 8227      STD	Z+7,R2
(0406) 		pD[10]=Result.Date[6];
    035A2 9020 0659 LDS	R2,Result+28
    035A4 8622      STD	Z+10,R2
(0407) 		pD[11]=Result.Date[7];  
    035A5 9020 065A LDS	R2,Result+29
    035A7 8623      STD	Z+11,R2
(0408) 		pT[0] = Result.Time[0];
    035A8 9020 065C LDS	R2,Result+31
    035AA 01F5      MOVW	R30,R10
    035AB 8220      ST	Z,R2
(0409) 		pT[1] = Result.Time[1];
    035AC 9020 065D LDS	R2,Result+32
    035AE 8221      STD	Z+1,R2
(0410) 		pT[4] = Result.Time[3];
    035AF 9020 065F LDS	R2,Result+34
    035B1 8224      STD	Z+4,R2
(0411) 		pT[5] = Result.Time[4];
    035B2 9020 0660 LDS	R2,Result+35
    035B4 8225      STD	Z+5,R2
(0412) 		pT[8] = Result.Time[6];
    035B5 9020 0662 LDS	R2,Result+37
    035B7 8620      STD	Z+8,R2
(0413) 		pT[9] = Result.Time[7];
    035B8 9020 0663 LDS	R2,Result+38
    035BA 8621      STD	Z+9,R2
(0414) 		
(0415) 		switch(i){
    035BB 2D6E      MOV	R22,R14
    035BC 2777      CLR	R23
    035BD 3060      CPI	R22,0
    035BE 0767      CPC	R22,R23
    035BF F0D1      BEQ	0x35DA
    035C0 3061      CPI	R22,1
    035C1 E0E0      LDI	R30,0
    035C2 077E      CPC	R23,R30
    035C3 F409      BNE	0x35C5
    035C4 C04A      RJMP	0x360F
    035C5 3062      CPI	R22,2
    035C6 E0E0      LDI	R30,0
    035C7 077E      CPC	R23,R30
    035C8 F409      BNE	0x35CA
    035C9 C07C      RJMP	0x3646
    035CA 3063      CPI	R22,3
    035CB E0E0      LDI	R30,0
    035CC 077E      CPC	R23,R30
    035CD F409      BNE	0x35CF
    035CE C0BE      RJMP	0x368D
    035CF 3064      CPI	R22,4
    035D0 E0E0      LDI	R30,0
    035D1 077E      CPC	R23,R30
    035D2 F409      BNE	0x35D4
    035D3 C0F1      RJMP	0x36C5
    035D4 3065      CPI	R22,5
    035D5 E0E0      LDI	R30,0
    035D6 077E      CPC	R23,R30
    035D7 F409      BNE	0x35D9
    035D8 C123      RJMP	0x36FC
    035D9 C15C      RJMP	0x3736
(0416)             case 0: p=2;ary=GUI_up;  //年
    035DA E082      LDI	R24,2
    035DB 878A      STD	Y+10,R24
    035DC 01CE      MOVW	R24,R28
    035DD 9602      ADIW	R24,2
    035DE 016C      MOVW	R12,R24
(0417) 		 	  	 if(keyc==up){
    035DF 314E      CPI	R20,0x1E
    035E0 F491      BNE	0x35F3
(0418) 				     if(time_buf[1]<0x99){ 
    035E1 9180 05E0 LDS	R24,time_buf+1
    035E3 3989      CPI	R24,0x99
    035E4 F008      BCS	0x35E6
    035E5 C150      RJMP	0x3736
(0419) 					     time_buf[1]++;
    035E6 5F8F      SUBI	R24,0xFF
    035E7 9380 05E0 STS	time_buf+1,R24
(0420) 						 if((time_buf[1]&0x0f)==0x0a) 
    035E9 708F      ANDI	R24,0xF
    035EA 308A      CPI	R24,0xA
    035EB F009      BEQ	0x35ED
    035EC C149      RJMP	0x3736
(0421) 						     time_buf[1]=time_buf[1]+6;
    035ED 9180 05E0 LDS	R24,time_buf+1
    035EF 5F8A      SUBI	R24,0xFA
    035F0 9380 05E0 STS	time_buf+1,R24
(0422) 					 }
(0423) 												     
(0424) 				}				  
    035F2 C143      RJMP	0x3736
(0425)  					        
(0426) 			    else if(keyc==down){ 
    035F3 314D      CPI	R20,0x1D
    035F4 F4A1      BNE	0x3609
(0427) 				    if(time_buf[1]>0x00){
    035F5 E080      LDI	R24,0
    035F6 9020 05E0 LDS	R2,time_buf+1
    035F8 1582      CP	R24,R2
    035F9 F008      BCS	0x35FB
    035FA C13B      RJMP	0x3736
(0428) 				        time_buf[1]--;
    035FB 2D82      MOV	R24,R2
    035FC 5081      SUBI	R24,1
    035FD 9380 05E0 STS	time_buf+1,R24
(0429) 						if((time_buf[1]&0x0f)==0x0f) 
    035FF 708F      ANDI	R24,0xF
    03600 308F      CPI	R24,0xF
    03601 F009      BEQ	0x3603
    03602 C133      RJMP	0x3736
(0430) 						    time_buf[1]=time_buf[1]-6;
    03603 9180 05E0 LDS	R24,time_buf+1
    03605 5086      SUBI	R24,6
    03606 9380 05E0 STS	time_buf+1,R24
(0431) 		 	  	 		 }
(0432) 												   
(0433) 					}			   		
    03608 C12D      RJMP	0x3736
(0434) 				else if(keyc==left) {i=1;}
    03609 314B      CPI	R20,0x1B
    0360A F009      BEQ	0x360C
    0360B C12A      RJMP	0x3736
    0360C 24EE      CLR	R14
    0360D 94E3      INC	R14
(0435) 				break;
    0360E C127      RJMP	0x3736
(0436) 		 case 1:p=4;ary=GUI_up;  //月
    0360F E084      LDI	R24,4
    03610 878A      STD	Y+10,R24
    03611 01CE      MOVW	R24,R28
    03612 9602      ADIW	R24,2
    03613 016C      MOVW	R12,R24
(0437) 		  	  	if(keyc==up){
    03614 314E      CPI	R20,0x1E
    03615 F499      BNE	0x3629
(0438) 				    if(time_buf[2]<0x12){  
    03616 9180 05E1 LDS	R24,time_buf+2
    03618 3182      CPI	R24,0x12
    03619 F460      BCC	0x3626
(0439) 					    time_buf[2]++;	
    0361A 5F8F      SUBI	R24,0xFF
    0361B 9380 05E1 STS	time_buf+2,R24
(0440) 						if((time_buf[2]&0x0f)==0x0a) time_buf[2]+=6;
    0361D 708F      ANDI	R24,0xF
    0361E 308A      CPI	R24,0xA
    0361F F449      BNE	0x3629
    03620 9180 05E1 LDS	R24,time_buf+2
    03622 5F8A      SUBI	R24,0xFA
    03623 9380 05E1 STS	time_buf+2,R24
(0441) 					}
    03625 C003      RJMP	0x3629
(0442) 					else 
(0443) 					    time_buf[2]=0x01;
    03626 E081      LDI	R24,1
    03627 9380 05E1 STS	time_buf+2,R24
(0444) 				}						 
(0445) 				if(keyc==down){ 
    03629 314D      CPI	R20,0x1D
    0362A F4A9      BNE	0x3640
(0446) 				    if(time_buf[2]>0x01){  
    0362B E081      LDI	R24,1
    0362C 9020 05E1 LDS	R2,time_buf+2
    0362E 1582      CP	R24,R2
    0362F F468      BCC	0x363D
(0447) 					    time_buf[2]--;	
    03630 2D82      MOV	R24,R2
    03631 5081      SUBI	R24,1
    03632 9380 05E1 STS	time_buf+2,R24
(0448) 						if((time_buf[2]&0x0f)==0x0f) 
    03634 708F      ANDI	R24,0xF
    03635 308F      CPI	R24,0xF
    03636 F449      BNE	0x3640
(0449) 						    time_buf[2]-=6;
    03637 9180 05E1 LDS	R24,time_buf+2
    03639 5086      SUBI	R24,6
    0363A 9380 05E1 STS	time_buf+2,R24
(0450) 			  		}
    0363C C003      RJMP	0x3640
(0451) 				    else 
(0452) 					    time_buf[2]=0x12;						
    0363D E182      LDI	R24,0x12
    0363E 9380 05E1 STS	time_buf+2,R24
(0453) 				}						 							
(0454)  								
(0455) 				if(keyc==left){
    03640 314B      CPI	R20,0x1B
    03641 F009      BEQ	0x3643
    03642 C0F3      RJMP	0x3736
(0456) 				    i=2;   
    03643 E082      LDI	R24,2
    03644 2EE8      MOV	R14,R24
(0457) 				}  
(0458) 				break;
    03645 C0F0      RJMP	0x3736
(0459) 	 	 case 2: p=6;ary=GUI_up;
    03646 E086      LDI	R24,6
    03647 878A      STD	Y+10,R24
    03648 01CE      MOVW	R24,R28
    03649 9602      ADIW	R24,2
    0364A 016C      MOVW	R12,R24
(0460) 		 	  	 if(keyc==up){ 
    0364B 314E      CPI	R20,0x1E
    0364C F519      BNE	0x3670
(0461) 				     if(time_buf[3]<0x31){ 
    0364D 9180 05E2 LDS	R24,time_buf+3
    0364F 3381      CPI	R24,0x31
    03650 F5B0      BCC	0x3687
(0462) 				         time_buf[3]++;
    03651 5F8F      SUBI	R24,0xFF
    03652 9380 05E2 STS	time_buf+3,R24
(0463) 						 if ((time_buf[3]&0x0f)==0x0a) time_buf[3]=time_buf[3]+6;
    03654 708F      ANDI	R24,0xF
    03655 308A      CPI	R24,0xA
    03656 F429      BNE	0x365C
    03657 9180 05E2 LDS	R24,time_buf+3
    03659 5F8A      SUBI	R24,0xFA
    0365A 9380 05E2 STS	time_buf+3,R24
(0464) 						 if(  //2 4 6 9 11 月最大30天
(0465) 						  ( ((time_buf[2]==0x02) || (time_buf[2]==0x04)|| (time_buf[2]==0x06)||
    0365C 9180 05E1 LDS	R24,time_buf+2
    0365E 3082      CPI	R24,2
    0365F F041      BEQ	0x3668
    03660 3084      CPI	R24,4
    03661 F031      BEQ	0x3668
    03662 3086      CPI	R24,6
    03663 F021      BEQ	0x3668
    03664 3089      CPI	R24,0x9
    03665 F011      BEQ	0x3668
    03666 3181      CPI	R24,0x11
    03667 F4F9      BNE	0x3687
    03668 9180 05E2 LDS	R24,time_buf+3
    0366A 3381      CPI	R24,0x31
    0366B F4D9      BNE	0x3687
(0466) 						  (time_buf[2]==0x09)||(time_buf[2]==0x11))&&(time_buf[3]==0x31))){
(0467) 						      time_buf[3]=0x30;
    0366C E380      LDI	R24,0x30
    0366D 9380 05E2 STS	time_buf+3,R24
(0468) 						}
(0469) 				     }
(0470)  									  
(0471)  				 }
    0366F C017      RJMP	0x3687
(0472) 			     else if(keyc==down){ 
    03670 314D      CPI	R20,0x1D
    03671 F4A9      BNE	0x3687
(0473) 				      if(time_buf[3]>0x01){  
    03672 E081      LDI	R24,1
    03673 9020 05E2 LDS	R2,time_buf+3
    03675 1582      CP	R24,R2
    03676 F468      BCC	0x3684
(0474) 					     time_buf[3]--;
    03677 2D82      MOV	R24,R2
    03678 5081      SUBI	R24,1
    03679 9380 05E2 STS	time_buf+3,R24
(0475) 				 	  	 if((time_buf[3]&0x0f)==0x0f) time_buf[3]=time_buf[3]-6;
    0367B 708F      ANDI	R24,0xF
    0367C 308F      CPI	R24,0xF
    0367D F449      BNE	0x3687
    0367E 9180 05E2 LDS	R24,time_buf+3
    03680 5086      SUBI	R24,6
    03681 9380 05E2 STS	time_buf+3,R24
(0476) 		 	  	 	 }
    03683 C003      RJMP	0x3687
(0477) 					 else time_buf[3]=0x31;						
    03684 E381      LDI	R24,0x31
    03685 9380 05E2 STS	time_buf+3,R24
(0478) 											   
(0479) 				}
(0480) 				if(keyc==left) {i=3;  }						 			   		
    03687 314B      CPI	R20,0x1B
    03688 F009      BEQ	0x368A
    03689 C0AC      RJMP	0x3736
    0368A E083      LDI	R24,3
    0368B 2EE8      MOV	R14,R24
(0481) 				break;
    0368C C0A9      RJMP	0x3736
(0482) 		case 3:p=1;ary=GUI_down;
    0368D 2400      CLR	R0
    0368E 9403      INC	R0
    0368F 860A      STD	Y+10,R0
    03690 01CE      MOVW	R24,R28
    03691 9605      ADIW	R24,5
    03692 016C      MOVW	R12,R24
(0483)  	  	if(keyc==up){ if(time_buf[4]<0x23){  time_buf[4]++;	
    03693 314E      CPI	R20,0x1E
    03694 F499      BNE	0x36A8
    03695 9180 05E3 LDS	R24,time_buf+4
    03697 3283      CPI	R24,0x23
    03698 F460      BCC	0x36A5
    03699 5F8F      SUBI	R24,0xFF
    0369A 9380 05E3 STS	time_buf+4,R24
(0484) 													if((time_buf[4]&0x0f)==0x0a) time_buf[4]+=6;
    0369C 708F      ANDI	R24,0xF
    0369D 308A      CPI	R24,0xA
    0369E F449      BNE	0x36A8
    0369F 9180 05E3 LDS	R24,time_buf+4
    036A1 5F8A      SUBI	R24,0xFA
    036A2 9380 05E3 STS	time_buf+4,R24
(0485) 													 
(0486) 													
(0487) 												 }
    036A4 C003      RJMP	0x36A8
(0488) 							else time_buf[4]=0x00;
    036A5 2422      CLR	R2
    036A6 9220 05E3 STS	time_buf+4,R2
(0489) 						  }						 
(0490) 				if(keyc==down){ if(time_buf[4]>0x00){  time_buf[4]--;	
    036A8 314D      CPI	R20,0x1D
    036A9 F4A9      BNE	0x36BF
    036AA E080      LDI	R24,0
    036AB 9020 05E3 LDS	R2,time_buf+4
    036AD 1582      CP	R24,R2
    036AE F468      BCC	0x36BC
    036AF 2D82      MOV	R24,R2
    036B0 5081      SUBI	R24,1
    036B1 9380 05E3 STS	time_buf+4,R24
(0491) 													if((time_buf[4]&0x0f)==0x0f) time_buf[4]-=6;
    036B3 708F      ANDI	R24,0xF
    036B4 308F      CPI	R24,0xF
    036B5 F449      BNE	0x36BF
    036B6 9180 05E3 LDS	R24,time_buf+4
    036B8 5086      SUBI	R24,6
    036B9 9380 05E3 STS	time_buf+4,R24
(0492) 													
(0493) 												 }
    036BB C003      RJMP	0x36BF
(0494) 							 else time_buf[4]=0x23;						
    036BC E283      LDI	R24,0x23
    036BD 9380 05E3 STS	time_buf+4,R24
(0495) 						  }	
(0496) 		if(keyc==left) {i=4;    } 
    036BF 314B      CPI	R20,0x1B
    036C0 F009      BEQ	0x36C2
    036C1 C074      RJMP	0x3736
    036C2 E084      LDI	R24,4
    036C3 2EE8      MOV	R14,R24
(0497) 		break;						  					 			
    036C4 C071      RJMP	0x3736
(0498)  case 4:p=3;ary=GUI_down;
    036C5 E083      LDI	R24,3
    036C6 878A      STD	Y+10,R24
    036C7 01CE      MOVW	R24,R28
    036C8 9605      ADIW	R24,5
    036C9 016C      MOVW	R12,R24
(0499)  	  	if(keyc==up){ if(time_buf[5]<0x59){  time_buf[5]++;	
    036CA 314E      CPI	R20,0x1E
    036CB F499      BNE	0x36DF
    036CC 9180 05E4 LDS	R24,time_buf+5
    036CE 3589      CPI	R24,0x59
    036CF F460      BCC	0x36DC
    036D0 5F8F      SUBI	R24,0xFF
    036D1 9380 05E4 STS	time_buf+5,R24
(0500) 											 if((time_buf[5]&0x0f)==0x0a) time_buf[5]+=6;
    036D3 708F      ANDI	R24,0xF
    036D4 308A      CPI	R24,0xA
    036D5 F449      BNE	0x36DF
    036D6 9180 05E4 LDS	R24,time_buf+5
    036D8 5F8A      SUBI	R24,0xFA
    036D9 9380 05E4 STS	time_buf+5,R24
(0501) 										  }
    036DB C003      RJMP	0x36DF
(0502) 					  else time_buf[5]=0x00;
    036DC 2422      CLR	R2
    036DD 9220 05E4 STS	time_buf+5,R2
(0503) 					}						 
(0504) 		if(keyc==down){ if(time_buf[5]>0x00){  time_buf[5]--;	
    036DF 314D      CPI	R20,0x1D
    036E0 F4A9      BNE	0x36F6
    036E1 E080      LDI	R24,0
    036E2 9020 05E4 LDS	R2,time_buf+5
    036E4 1582      CP	R24,R2
    036E5 F468      BCC	0x36F3
    036E6 2D82      MOV	R24,R2
    036E7 5081      SUBI	R24,1
    036E8 9380 05E4 STS	time_buf+5,R24
(0505) 												if((time_buf[5]&0x0f)==0x0f) time_buf[5]-=6;
    036EA 708F      ANDI	R24,0xF
    036EB 308F      CPI	R24,0xF
    036EC F449      BNE	0x36F6
    036ED 9180 05E4 LDS	R24,time_buf+5
    036EF 5086      SUBI	R24,6
    036F0 9380 05E4 STS	time_buf+5,R24
(0506) 											}
    036F2 C003      RJMP	0x36F6
(0507) 						else time_buf[5]=0x59;						
    036F3 E589      LDI	R24,0x59
    036F4 9380 05E4 STS	time_buf+5,R24
(0508) 					  }
(0509) 		if(keyc==left ) {i=5;    } 		  						 								  			
    036F6 314B      CPI	R20,0x1B
    036F7 F009      BEQ	0x36F9
    036F8 C03D      RJMP	0x3736
    036F9 E085      LDI	R24,5
    036FA 2EE8      MOV	R14,R24
(0510) 		break;			   
    036FB C03A      RJMP	0x3736
(0511)  case 5:p=5;ary=GUI_down;
    036FC E085      LDI	R24,5
    036FD 878A      STD	Y+10,R24
    036FE 01CE      MOVW	R24,R28
    036FF 9605      ADIW	R24,5
    03700 016C      MOVW	R12,R24
(0512)  	  	if(keyc==up){ if(time_buf[6]<0x59){  time_buf[6]++;	
    03701 314E      CPI	R20,0x1E
    03702 F499      BNE	0x3716
    03703 9180 05E5 LDS	R24,time_buf+6
    03705 3589      CPI	R24,0x59
    03706 F460      BCC	0x3713
    03707 5F8F      SUBI	R24,0xFF
    03708 9380 05E5 STS	time_buf+6,R24
(0513) 											 if((time_buf[6]&0x0f)==0x0a) time_buf[6]+=6;
    0370A 708F      ANDI	R24,0xF
    0370B 308A      CPI	R24,0xA
    0370C F449      BNE	0x3716
    0370D 9180 05E5 LDS	R24,time_buf+6
    0370F 5F8A      SUBI	R24,0xFA
    03710 9380 05E5 STS	time_buf+6,R24
(0514) 										 }
    03712 C003      RJMP	0x3716
(0515) 					  else time_buf[6]=0x00;
    03713 2422      CLR	R2
    03714 9220 05E5 STS	time_buf+6,R2
(0516) 					}						 
(0517) 		if(keyc==down){ if(time_buf[6]>0x00){  time_buf[6]--;	
    03716 314D      CPI	R20,0x1D
    03717 F4A9      BNE	0x372D
    03718 E080      LDI	R24,0
    03719 9020 05E5 LDS	R2,time_buf+6
    0371B 1582      CP	R24,R2
    0371C F468      BCC	0x372A
    0371D 2D82      MOV	R24,R2
    0371E 5081      SUBI	R24,1
    0371F 9380 05E5 STS	time_buf+6,R24
(0518) 						if((time_buf[6]&0x0f)==0x0f) time_buf[6]-=6;
    03721 708F      ANDI	R24,0xF
    03722 308F      CPI	R24,0xF
    03723 F449      BNE	0x372D
    03724 9180 05E5 LDS	R24,time_buf+6
    03726 5086      SUBI	R24,6
    03727 9380 05E5 STS	time_buf+6,R24
(0519) 					  }
    03729 C003      RJMP	0x372D
(0520) 		else time_buf[6]=0x59;		}				
    0372A E589      LDI	R24,0x59
    0372B 9380 05E5 STS	time_buf+6,R24
(0521) 		if(keyc==left) {i=6;p=1;ary=NULL;}  
    0372D 314B      CPI	R20,0x1B
    0372E F439      BNE	0x3736
    0372F E086      LDI	R24,6
    03730 2EE8      MOV	R14,R24
    03731 2400      CLR	R0
    03732 9403      INC	R0
    03733 860A      STD	Y+10,R0
    03734 24CC      CLR	R12
    03735 24DD      CLR	R13
(0522) 		break;           
(0523) 							 
(0524) 		 }//endcase
(0525)  		 dateRefresh(88); //set clock mode
    03736 E508      LDI	R16,0x58
    03737 D21E      RCALL	_dateRefresh
(0526) 		 
(0527) 		 LCD_const_disp(3,1,"                "); //清空箭头 
    03738 E38C      LDI	R24,0x3C
    03739 E094      LDI	R25,4
    0373A 8399      STD	Y+1,R25
    0373B 8388      ST	Y,R24
    0373C E021      LDI	R18,1
    0373D E003      LDI	R16,3
    0373E 940E 3EE2 CALL	_LCD_const_disp
(0528)  		 LCD_var_disp(3,p,ary); //显示箭头 
    03740 82D9      STD	Y+1,R13
    03741 82C8      ST	Y,R12
    03742 852A      LDD	R18,Y+10
    03743 E003      LDI	R16,3
    03744 940E 3F0F CALL	_LCD_var_disp
(0529)  		 LCD_var_disp(2,1,pD);  //显示日期
    03746 8408      LDD	R0,Y+8
    03747 8419      LDD	R1,Y+9
    03748 8219      STD	Y+1,R1
    03749 8208      ST	Y,R0
    0374A E021      LDI	R18,1
    0374B E002      LDI	R16,2
    0374C 940E 3F0F CALL	_LCD_var_disp
(0530)  		 LCD_var_disp(4,1,pT);  //显示时间
    0374E 82B9      STD	Y+1,R11
    0374F 82A8      ST	Y,R10
    03750 E021      LDI	R18,1
    03751 E004      LDI	R16,4
    03752 940E 3F0F CALL	_LCD_var_disp
(0531)  if(keyc==right) {		  
    03754 3147      CPI	R20,0x17
    03755 F479      BNE	0x3765
(0532)  		  LCD_const_disp(3,1,"        放弃修改"); 
    03756 E28B      LDI	R24,0x2B
    03757 E094      LDI	R25,4
    03758 8399      STD	Y+1,R25
    03759 8388      ST	Y,R24
    0375A E021      LDI	R18,1
    0375B E003      LDI	R16,3
    0375C 940E 3EE2 CALL	_LCD_const_disp
(0533) 		  delayms(500);
    0375E EF04      LDI	R16,0xF4
    0375F E011      LDI	R17,1
    03760 940E 253A CALL	_delayms
(0534) 		  LCD_CLR(); //清屏
    03762 940E 3F88 CALL	_LCD_CLR
(0535) 		  return ;} 
    03764 C026      RJMP	0x378B
(0536)  keyc=NO_KEY;
    03765 2744      CLR	R20
(0537)  if(i==6){    //各值改变完成后 显示已保存 清屏 返回
    03766 2D8E      MOV	R24,R14
    03767 3086      CPI	R24,6
    03768 F4C9      BNE	0x3782
(0538) 		  ds1302_write_time(); 
    03769 940E 449B CALL	_ds1302_write_time
(0539)           LCD_const_disp(4,7,"    ");		  
    0376B E286      LDI	R24,0x26
    0376C E094      LDI	R25,4
    0376D 8399      STD	Y+1,R25
    0376E 8388      ST	Y,R24
    0376F E027      LDI	R18,7
    03770 E004      LDI	R16,4
    03771 940E 3EE2 CALL	_LCD_const_disp
(0540) 		  LCD_const_disp(3,1,"          已保存"); 
    03773 E185      LDI	R24,0x15
    03774 E094      LDI	R25,4
    03775 8399      STD	Y+1,R25
    03776 8388      ST	Y,R24
    03777 E021      LDI	R18,1
    03778 E003      LDI	R16,3
    03779 940E 3EE2 CALL	_LCD_const_disp
(0541) 		  delayms(300);
    0377B E20C      LDI	R16,0x2C
    0377C E011      LDI	R17,1
    0377D 940E 253A CALL	_delayms
(0542) 		  LCD_CLR(); //清屏
    0377F 940E 3F88 CALL	_LCD_CLR
(0543) 		  return ;
    03781 C009      RJMP	0x378B
(0544) 		  }
(0545)  delayms(2);	  
    03782 E002      LDI	R16,2
    03783 E010      LDI	R17,0
    03784 940E 253A CALL	_delayms
    03786 940E 25F7 CALL	_alwaysCheck
    03788 2300      TST	R16
    03789 F009      BEQ	0x378B
    0378A CE06      RJMP	0x3591
    0378B 962B      ADIW	R28,0xB
    0378C 940C 4AFC JMP	pop_xgsetF0FC
_GUI_readback:
  res                  --> R12
  file_buf             --> Y,+3
  page                 --> R20
  key                  --> R22
  buf                  --> R10
    0378E 940E 4B07 CALL	push_xgsetF0FC
    03790 0158      MOVW	R10,R16
    03791 9760      SBIW	R28,0x10
(0546) }//endwhile(1)
(0547) }
(0548) void GUI_readback(char *buf){
(0549)     char key=0;
    03792 2766      CLR	R22
(0550) 	char page=0;
    03793 2744      CLR	R20
(0551) 	char res=0;
    03794 24CC      CLR	R12
(0552) 	char file_buf[]="201201.xls\0\0";
    03795 EA89      LDI	R24,0xA9
    03796 E093      LDI	R25,3
    03797 01FE      MOVW	R30,R28
    03798 9633      ADIW	R30,3
    03799 E00D      LDI	R16,0xD
    0379A E010      LDI	R17,0
    0379B 93FA      ST	-Y,R31
    0379C 93EA      ST	-Y,R30
    0379D 939A      ST	-Y,R25
    0379E 938A      ST	-Y,R24
    0379F 940E 4BB7 CALL	asgnblk
(0553) 	LCD_CLR(); //清屏
    037A1 940E 3F88 CALL	_LCD_CLR
(0554) 	//1 检测SD状态
(0555) 		//无SD卡 显示无卡 退出
(0556) 	if((SD_DET()==0)) {
    037A3 B181      IN	R24,0x01
    037A4 9586      LSR	R24
    037A5 9586      LSR	R24
    037A6 9586      LSR	R24
    037A7 9586      LSR	R24
    037A8 9586      LSR	R24
    037A9 7081      ANDI	R24,1
    037AA F421      BNE	0x37AF
    037AB E081      LDI	R24,1
    037AC E090      LDI	R25,0
    037AD 017C      MOVW	R14,R24
    037AE C002      RJMP	0x37B1
    037AF 24EE      CLR	R14
    037B0 24FF      CLR	R15
    037B1 20EE      TST	R14
    037B2 F479      BNE	0x37C2
    037B3 20FF      TST	R15
    037B4 F469      BNE	0x37C2
(0557) 		LCD_const_disp(2,1,"未检测到SD卡..");
    037B5 E086      LDI	R24,6
    037B6 E094      LDI	R25,4
    037B7 8399      STD	Y+1,R25
    037B8 8388      ST	Y,R24
    037B9 E021      LDI	R18,1
    037BA E002      LDI	R16,2
    037BB 940E 3EE2 CALL	_LCD_const_disp
(0558) 			#ifdef _DBG_RD_
(0559) 		   PrintString_n("not find sd");
(0560) 		   #endif
(0561) 		delayms(500);
    037BD EF04      LDI	R16,0xF4
    037BE E011      LDI	R17,1
    037BF 940E 253A CALL	_delayms
(0562) 		return ;
    037C1 C174      RJMP	0x3936
(0563) 	}
(0564) 	//2 显示当前月份
(0565) 	get_name(file_buf);
    037C2 018E      MOVW	R16,R28
    037C3 5F0D      SUBI	R16,0xFD
    037C4 4F1F      SBCI	R17,0xFF
    037C5 940E 2C72 CALL	_get_name
(0566) 	LCD_const_disp(1,1,"查找数据:");
    037C7 EF8C      LDI	R24,0xFC
    037C8 E093      LDI	R25,3
    037C9 8399      STD	Y+1,R25
    037CA 8388      ST	Y,R24
    037CB E021      LDI	R18,1
    037CC E001      LDI	R16,1
    037CD 940E 3EE2 CALL	_LCD_const_disp
(0567) 	LCD_const_disp(2,2,file_buf);
    037CF 01CE      MOVW	R24,R28
    037D0 9603      ADIW	R24,3
    037D1 8399      STD	Y+1,R25
    037D2 8388      ST	Y,R24
    037D3 E022      LDI	R18,2
    037D4 E002      LDI	R16,2
    037D5 940E 3EE2 CALL	_LCD_const_disp
(0568) 	#ifdef _DBG_RD_
(0569) 		   PrintString_n(file_buf);
(0570) 	#endif
(0571) 	//3 查找文件是否存在
(0572) 		//存在-> 进入读取顺序的选择
(0573) 		//不存在 -> 询问查找上月
(0574) 	//4 选择 查询顺序
(0575) 		//计算总条数
(0576) 		//顺序 增量为1， 查询第一条 
(0577) 		//逆序 增量为-1，查询最后一条
(0578) 	//5 读取	
(0579) 	//6 显示
(0580) 	//7 上一条 下一条  退出
(0581) 		//设置条数 判断边界 进入5
(0582) 		//退出 返回主程序	
(0583) 	//!!res=checkFile(file_buf);
(0584) label_recheck:	
(0585) 	LCD_Init(); //清屏
    037D7 940E 3F56 CALL	_LCD_Init
(0586) 	LCD_CLR();  
    037D9 940E 3F88 CALL	_LCD_CLR
(0587) 	if(res == 0){ //找到并已经确认文件
    037DB 20CC      TST	R12
    037DC F009      BEQ	0x37DE
    037DD C158      RJMP	0x3936
(0588) 		   LCD_const_disp(1,1,"菜单/ 查询");
    037DE EF81      LDI	R24,0xF1
    037DF E093      LDI	R25,3
    037E0 8399      STD	Y+1,R25
    037E1 8388      ST	Y,R24
    037E2 E021      LDI	R18,1
    037E3 E001      LDI	R16,1
    037E4 940E 3EE2 CALL	_LCD_const_disp
(0589)    		   LCD_const_disp(2,3,"按顺序");
    037E6 EE8A      LDI	R24,0xEA
    037E7 E093      LDI	R25,3
    037E8 8399      STD	Y+1,R25
    037E9 8388      ST	Y,R24
    037EA E023      LDI	R18,3
    037EB E002      LDI	R16,2
    037EC 940E 3EE2 CALL	_LCD_const_disp
(0590) 		   LCD_const_disp(3,3,"最后一次");		 
    037EE EE81      LDI	R24,0xE1
    037EF E093      LDI	R25,3
    037F0 8399      STD	Y+1,R25
    037F1 8388      ST	Y,R24
    037F2 E023      LDI	R18,3
    037F3 E003      LDI	R16,3
    037F4 940E 3EE2 CALL	_LCD_const_disp
(0591) 	       if(config.readMode == READ_MODE_LAST){
    037F6 9020 08C2 LDS	R2,config+19
    037F8 2022      TST	R2
    037F9 F4A1      BNE	0x380E
(0592) 		       config.readMode=READ_MODE_FIRST;
    037FA E081      LDI	R24,1
    037FB 9380 08C2 STS	config+19,R24
(0593) 			   Set_White(1,2,8,0);
    037FD 2422      CLR	R2
    037FE 822A      STD	Y+2,R2
    037FF E088      LDI	R24,0x8
    03800 8388      ST	Y,R24
    03801 E022      LDI	R18,2
    03802 E001      LDI	R16,1
    03803 940E 4012 CALL	_Set_White
(0594)  			   Set_White(1,3,8,1);
    03805 E081      LDI	R24,1
    03806 838A      STD	Y+2,R24
    03807 E088      LDI	R24,0x8
    03808 8388      ST	Y,R24
    03809 E023      LDI	R18,3
    0380A E001      LDI	R16,1
    0380B 940E 4012 CALL	_Set_White
(0595) 		  }
    0380D C067      RJMP	0x3875
(0596) 		  else {
(0597) 		       config.readMode=READ_MODE_LAST;
    0380E 2422      CLR	R2
    0380F 9220 08C2 STS	config+19,R2
(0598) 			   Set_White(1,2,8,1);
    03811 E081      LDI	R24,1
    03812 838A      STD	Y+2,R24
    03813 E088      LDI	R24,0x8
    03814 8388      ST	Y,R24
    03815 E022      LDI	R18,2
    03816 E001      LDI	R16,1
    03817 940E 4012 CALL	_Set_White
(0599)  			   Set_White(1,3,8,0);
    03819 2422      CLR	R2
    0381A 822A      STD	Y+2,R2
    0381B E088      LDI	R24,0x8
    0381C 8388      ST	Y,R24
    0381D E023      LDI	R18,3
    0381E E001      LDI	R16,1
    0381F 940E 4012 CALL	_Set_White
(0600) 		 }
    03821 C053      RJMP	0x3875
(0601) 		   // 菜单/查询   按顺序/最后一次
(0602) 		   while(alwaysCheck()){
(0603)  		       key=kbscan();
    03822 940E 44E8 CALL	_kbscan
    03824 2F60      MOV	R22,R16
(0604) 			   dateRefresh(0); //只刷新后台时间
    03825 2700      CLR	R16
    03826 D12F      RCALL	_dateRefresh
(0605) 			   //上键短按 选择
(0606) 			   if(key==up || key ==down){
    03827 316E      CPI	R22,0x1E
    03828 F011      BEQ	0x382B
    03829 316D      CPI	R22,0x1D
    0382A F559      BNE	0x3856
(0607) 	    	       if(config.readMode == READ_MODE_LAST){
    0382B 9020 08C2 LDS	R2,config+19
    0382D 2022      TST	R2
    0382E F4A1      BNE	0x3843
(0608) 		    	       config.readMode=READ_MODE_FIRST;
    0382F E081      LDI	R24,1
    03830 9380 08C2 STS	config+19,R24
(0609) 					   Set_White(1,2,8,0);
    03832 2422      CLR	R2
    03833 822A      STD	Y+2,R2
    03834 E088      LDI	R24,0x8
    03835 8388      ST	Y,R24
    03836 E022      LDI	R18,2
    03837 E001      LDI	R16,1
    03838 940E 4012 CALL	_Set_White
(0610)  					   Set_White(1,3,8,1);
    0383A E081      LDI	R24,1
    0383B 838A      STD	Y+2,R24
    0383C E088      LDI	R24,0x8
    0383D 8388      ST	Y,R24
    0383E E023      LDI	R18,3
    0383F E001      LDI	R16,1
    03840 940E 4012 CALL	_Set_White
(0611) 				   }
    03842 C013      RJMP	0x3856
(0612) 				   else {
(0613) 		    	       config.readMode=READ_MODE_LAST;
    03843 2422      CLR	R2
    03844 9220 08C2 STS	config+19,R2
(0614) 					   Set_White(1,2,8,1);
    03846 E081      LDI	R24,1
    03847 838A      STD	Y+2,R24
    03848 E088      LDI	R24,0x8
    03849 8388      ST	Y,R24
    0384A E022      LDI	R18,2
    0384B E001      LDI	R16,1
    0384C 940E 4012 CALL	_Set_White
(0615)  					   Set_White(1,3,8,0);
    0384E 2422      CLR	R2
    0384F 822A      STD	Y+2,R2
    03850 E088      LDI	R24,0x8
    03851 8388      ST	Y,R24
    03852 E023      LDI	R18,3
    03853 E001      LDI	R16,1
    03854 940E 4012 CALL	_Set_White
(0616) 				   }
(0617) 				}      
(0618) 				//左键短按  进入
(0619) 				if(key == left) {
    03856 316B      CPI	R22,0x1B
    03857 F4A9      BNE	0x386D
(0620) 				    Set_White(1,2,8,1);
    03858 E081      LDI	R24,1
    03859 838A      STD	Y+2,R24
    0385A E088      LDI	R24,0x8
    0385B 8388      ST	Y,R24
    0385C E022      LDI	R18,2
    0385D E001      LDI	R16,1
    0385E 940E 4012 CALL	_Set_White
(0621)  				    Set_White(1,3,8,1);
    03860 E081      LDI	R24,1
    03861 838A      STD	Y+2,R24
    03862 E088      LDI	R24,0x8
    03863 8388      ST	Y,R24
    03864 E023      LDI	R18,3
    03865 E001      LDI	R16,1
    03866 940E 4012 CALL	_Set_White
(0622) 					delayms(100);
    03868 E604      LDI	R16,0x64
    03869 E010      LDI	R17,0
    0386A 940E 253A CALL	_delayms
(0623) 				break ;		
    0386C C00D      RJMP	0x387A
(0624) 				}
(0625) 				//右键短按  返回
(0626) 				if(key == right) {
    0386D 3167      CPI	R22,0x17
    0386E F429      BNE	0x3874
(0627) 				    LCD_CLR();
    0386F 940E 3F88 CALL	_LCD_CLR
(0628) 	    			LCD_Init(); //清屏
    03871 940E 3F56 CALL	_LCD_Init
(0629) 					return ;	//返回主界面	
    03873 C0C2      RJMP	0x3936
(0630) 				}
(0631) 				key=0;
    03874 2766      CLR	R22
    03875 940E 25F7 CALL	_alwaysCheck
    03877 2300      TST	R16
    03878 F009      BEQ	0x387A
    03879 CFA8      RJMP	0x3822
(0632) 		    } //end of while
(0633) 			if(config.readMode==READ_MODE_LAST){
    0387A 9020 08C2 LDS	R2,config+19
    0387C 2022      TST	R2
    0387D F461      BNE	0x388A
(0634) 			    ReadSDFile(file_buf,65535,buf,0); //最后一条
    0387E 2422      CLR	R2
    0387F 822A      STD	Y+2,R2
    03880 82B9      STD	Y+1,R11
    03881 82A8      ST	Y,R10
    03882 EF2F      LDI	R18,0xFF
    03883 EF3F      LDI	R19,0xFF
    03884 018E      MOVW	R16,R28
    03885 5F0D      SUBI	R16,0xFD
    03886 4F1F      SBCI	R17,0xFF
    03887 940E 27E7 CALL	_ReadSDFile
(0635) 			}
    03889 C00B      RJMP	0x3895
(0636) 			else {
(0637) 			    ReadSDFile(file_buf,1,buf,0); //读第一条
    0388A 2422      CLR	R2
    0388B 822A      STD	Y+2,R2
    0388C 82B9      STD	Y+1,R11
    0388D 82A8      ST	Y,R10
    0388E E021      LDI	R18,1
    0388F E030      LDI	R19,0
    03890 018E      MOVW	R16,R28
    03891 5F0D      SUBI	R16,0xFD
    03892 4F1F      SBCI	R17,0xFF
    03893 940E 27E7 CALL	_ReadSDFile
(0638) 			}
(0639) 			CharToStruct(buf);      //转换
    03895 0185      MOVW	R16,R10
    03896 940E 2C2D CALL	_CharToStruct
    03898 C097      RJMP	0x3930
(0640) 			while(alwaysCheck()){
(0641) 			    key=kbscan();     //键盘扫描
    03899 940E 44E8 CALL	_kbscan
    0389B 2EE0      MOV	R14,R16
    0389C 2D6E      MOV	R22,R14
(0642) 				dateRefresh(0); //只刷新后台时间
    0389D 2700      CLR	R16
    0389E D0B7      RCALL	_dateRefresh
(0643) 				if(key != 0){ 
    0389F 20EE      TST	R14
    038A0 F021      BEQ	0x38A5
(0644) 					   beep(0,1);
    038A1 E021      LDI	R18,1
    038A2 2700      CLR	R16
    038A3 940E 425F CALL	_beep
(0645) 				}
(0646) 				//dateRefresh(0);  //刷新
(0647) 				_GUI_datashow(page); //显示
    038A5 2F04      MOV	R16,R20
    038A6 DA58      RCALL	__GUI_datashow
(0648) 				if( key==left ){ //按left键下一条
    038A7 316B      CPI	R22,0x1B
    038A8 F4A1      BNE	0x38BD
(0649) 					next_item:  //下一条
(0650) 				    ReadSDFile(file_buf,1,buf,1); //偏移到下一条
    038A9 E081      LDI	R24,1
    038AA 838A      STD	Y+2,R24
    038AB 82B9      STD	Y+1,R11
    038AC 82A8      ST	Y,R10
    038AD E021      LDI	R18,1
    038AE E030      LDI	R19,0
    038AF 018E      MOVW	R16,R28
    038B0 5F0D      SUBI	R16,0xFD
    038B1 4F1F      SBCI	R17,0xFF
    038B2 940E 27E7 CALL	_ReadSDFile
(0651) 					CharToStruct(buf);
    038B4 0185      MOVW	R16,R10
    038B5 940E 2C2D CALL	_CharToStruct
(0652) 					LCD_CLR();
    038B7 940E 3F88 CALL	_LCD_CLR
(0653) 		    		LCD_Init();
    038B9 940E 3F56 CALL	_LCD_Init
(0654) 					page = 0;
    038BB 2744      CLR	R20
(0655) 					key=0;
    038BC 2766      CLR	R22
(0656) 				}
(0657) 				if( key==lleft ){ //长按left键上一条
    038BD 396B      CPI	R22,0x9B
    038BE F4A1      BNE	0x38D3
(0658) 		    	    pre_item: //上一条
(0659) 					ReadSDFile(file_buf,-1,buf,1); //偏移到上一条
    038BF E081      LDI	R24,1
    038C0 838A      STD	Y+2,R24
    038C1 82B9      STD	Y+1,R11
    038C2 82A8      ST	Y,R10
    038C3 EF2F      LDI	R18,0xFF
    038C4 EF3F      LDI	R19,0xFF
    038C5 018E      MOVW	R16,R28
    038C6 5F0D      SUBI	R16,0xFD
    038C7 4F1F      SBCI	R17,0xFF
    038C8 940E 27E7 CALL	_ReadSDFile
(0660) 					CharToStruct(buf);
    038CA 0185      MOVW	R16,R10
    038CB 940E 2C2D CALL	_CharToStruct
(0661) 					LCD_CLR();
    038CD 940E 3F88 CALL	_LCD_CLR
(0662) 		    		LCD_Init();
    038CF 940E 3F56 CALL	_LCD_Init
(0663) 					page = 0;
    038D1 2744      CLR	R20
(0664) 					key=0;
    038D2 2766      CLR	R22
(0665) 				}
(0666) 				if(key==up){ //上键 : 页面减 
    038D3 316E      CPI	R22,0x1E
    038D4 F441      BNE	0x38DD
(0667) 	    		     LCD_CLR();
    038D5 940E 3F88 CALL	_LCD_CLR
(0668) 		    		 LCD_Init();
    038D7 940E 3F56 CALL	_LCD_Init
(0669) 					 if(page>0) page--;
    038D9 E080      LDI	R24,0
    038DA 1784      CP	R24,R20
    038DB F718      BCC	0x38BF
    038DC 954A      DEC	R20
(0670) 	    			 else{ 
(0671) 					    goto pre_item;
(0672) 					 }
(0673) 				}
(0674) 				if(key==lup){ //长按上键 : -10 条 
    038DD 396E      CPI	R22,0x9E
    038DE F4A1      BNE	0x38F3
(0675) 	    		     LCD_CLR();
    038DF 940E 3F88 CALL	_LCD_CLR
(0676) 		    		 LCD_Init();
    038E1 940E 3F56 CALL	_LCD_Init
(0677) 					 ReadSDFile(file_buf,-10,buf,1); //偏移到下10条
    038E3 E081      LDI	R24,1
    038E4 838A      STD	Y+2,R24
    038E5 82B9      STD	Y+1,R11
    038E6 82A8      ST	Y,R10
    038E7 EF26      LDI	R18,0xF6
    038E8 EF3F      LDI	R19,0xFF
    038E9 018E      MOVW	R16,R28
    038EA 5F0D      SUBI	R16,0xFD
    038EB 4F1F      SBCI	R17,0xFF
    038EC 940E 27E7 CALL	_ReadSDFile
(0678) 					 CharToStruct(buf);
    038EE 0185      MOVW	R16,R10
    038EF 940E 2C2D CALL	_CharToStruct
(0679) 					 page = 0;
    038F1 2744      CLR	R20
(0680) 					 key = 0;
    038F2 2766      CLR	R22
(0681) 				}
(0682) 				if(key==down){ //下键 ： 页面加
    038F3 316D      CPI	R22,0x1D
    038F4 F441      BNE	0x38FD
(0683) 					LCD_CLR();
    038F5 940E 3F88 CALL	_LCD_CLR
(0684) 		    		LCD_Init();
    038F7 940E 3F56 CALL	_LCD_Init
(0685) 					if(page<5) page++;
    038F9 3045      CPI	R20,5
    038FA F008      BCS	0x38FC
    038FB CFAD      RJMP	0x38A9
    038FC 9543      INC	R20
(0686) 	  				else{
(0687) 						goto next_item;
(0688) 					}
(0689) 				}
(0690) 				if(key==ldown){ //长按下键 ： 页面加10条・
    038FD 396D      CPI	R22,0x9D
    038FE F4A1      BNE	0x3913
(0691) 					LCD_CLR();
    038FF 940E 3F88 CALL	_LCD_CLR
(0692) 		    		LCD_Init();
    03901 940E 3F56 CALL	_LCD_Init
(0693) 					page = 0;
    03903 2744      CLR	R20
(0694) 					key = 0;
    03904 2766      CLR	R22
(0695) 	 				ReadSDFile(file_buf,10,buf,1); //偏移到下10条
    03905 E081      LDI	R24,1
    03906 838A      STD	Y+2,R24
    03907 82B9      STD	Y+1,R11
    03908 82A8      ST	Y,R10
    03909 E02A      LDI	R18,0xA
    0390A E030      LDI	R19,0
    0390B 018E      MOVW	R16,R28
    0390C 5F0D      SUBI	R16,0xFD
    0390D 4F1F      SBCI	R17,0xFF
    0390E 940E 27E7 CALL	_ReadSDFile
(0696) 					CharToStruct(buf);
    03910 0185      MOVW	R16,R10
    03911 940E 2C2D CALL	_CharToStruct
(0697) 				}
(0698) 				//右键短按  返回
(0699) 				if(key == right) {
    03913 3167      CPI	R22,0x17
    03914 F429      BNE	0x391A
(0700) 				    LCD_CLR();
    03915 940E 3F88 CALL	_LCD_CLR
(0701) 		    		LCD_Init();
    03917 940E 3F56 CALL	_LCD_Init
(0702) 					goto label_recheck;	   
    03919 CEBD      RJMP	0x37D7
(0703) 				}
(0704) 				if(page == 0 ){
    0391A 2344      TST	R20
    0391B F481      BNE	0x392C
(0705) 					LCD_const_disp(4,1,"ID:             ");
    0391C ED80      LDI	R24,0xD0
    0391D E093      LDI	R25,3
    0391E 8399      STD	Y+1,R25
    0391F 8388      ST	Y,R24
    03920 E021      LDI	R18,1
    03921 E004      LDI	R16,4
    03922 940E 3EE2 CALL	_LCD_const_disp
(0706) 					LCD_const_disp(4,3,Result.IndexChar);
    03924 E48B      LDI	R24,0x4B
    03925 E096      LDI	R25,6
    03926 8399      STD	Y+1,R25
    03927 8388      ST	Y,R24
    03928 E023      LDI	R18,3
    03929 E004      LDI	R16,4
    0392A 940E 3EE2 CALL	_LCD_const_disp
(0707) 				}
(0708) 
(0709)     			delayms(30); 
    0392C E10E      LDI	R16,0x1E
    0392D E010      LDI	R17,0
    0392E 940E 253A CALL	_delayms
    03930 940E 25F7 CALL	_alwaysCheck
    03932 2EE0      MOV	R14,R16
    03933 2300      TST	R16
    03934 F009      BEQ	0x3936
    03935 CF63      RJMP	0x3899
(0710) 		 }//end while
(0711) 		   
(0712) 	}
(0713) 	else { //未找到或未确认文件
(0714) 		 //逆序查找文件，直到月份小于 200001.xls
(0715) 		 //或是手工确认的方式
(0716) 	}
    03936 9660      ADIW	R28,0x10
    03937 940C 4AFC JMP	pop_xgsetF0FC
_GUI_welcome:
    03939 9722      SBIW	R28,2
(0717) 
(0718) }
(0719) void GUI_welcome(void){
(0720)     LCD_CLR(); //清屏
    0393A 940E 3F88 CALL	_LCD_CLR
(0721) 	LCD_const_disp(2,3,"欢迎使用");
    0393C EC87      LDI	R24,0xC7
    0393D E093      LDI	R25,3
    0393E 8399      STD	Y+1,R25
    0393F 8388      ST	Y,R24
    03940 E023      LDI	R18,3
    03941 E002      LDI	R16,2
    03942 940E 3EE2 CALL	_LCD_const_disp
(0722) 	LCD_const_disp(3,1,"环境冷强度检测仪");
    03944 EB86      LDI	R24,0xB6
    03945 E093      LDI	R25,3
    03946 8399      STD	Y+1,R25
    03947 8388      ST	Y,R24
    03948 E021      LDI	R18,1
    03949 E003      LDI	R16,3
    0394A 940E 3EE2 CALL	_LCD_const_disp
(0723) 	delayms(800);
    0394C E200      LDI	R16,0x20
    0394D E013      LDI	R17,3
    0394E 940E 253A CALL	_delayms
(0724) 	beep(0,1);
    03950 E021      LDI	R18,1
    03951 2700      CLR	R16
    03952 940E 425F CALL	_beep
    03954 9622      ADIW	R28,2
    03955 9508      RET
_dateRefresh:
  readhardware         --> R20
    03956 934A      ST	-Y,R20
    03957 2F40      MOV	R20,R16
(0725) 	
(0726) }
(0727) 
(0728) ////////////////////////////////////
(0729) //  函数作用
(0730) //   将ds1302中缓存的时钟数据转换进结构体中
(0731) ////////////////////////////////////
(0732) void dateRefresh(unsigned char readhardware)
(0733) {	//readhardware = 0 not refresh, =1 refresh
(0734) 
(0735)  if( readhardware!=88 )	ds1302_read_time();
    03958 3548      CPI	R20,0x58
    03959 F011      BEQ	0x395C
    0395A 940E 44C0 CALL	_ds1302_read_time
(0736) 	t.tm_sec=(((time_buf[6]&0x70)>>4)*10)+(time_buf[6]&0x0f);
    0395C 9110 05E5 LDS	R17,time_buf+6
    0395E 7710      ANDI	R17,0x70
    0395F 9512      SWAP	R17
    03960 701F      ANDI	R17,0xF
    03961 E00A      LDI	R16,0xA
    03962 0301      MULSU	R16,R17
    03963 0110      MOVW	R2,R0
    03964 9180 05E5 LDS	R24,time_buf+6
    03966 2799      CLR	R25
    03967 708F      ANDI	R24,0xF
    03968 7090      ANDI	R25,0
    03969 0E28      ADD	R2,R24
    0396A 1E39      ADC	R3,R25
    0396B 9230 089E STS	t+1,R3
    0396D 9220 089D STS	t,R2
(0737) 	t.tm_min=  (((time_buf[5]&0x70)>>4)*10)+(time_buf[5]&0x0f);
    0396F 9110 05E4 LDS	R17,time_buf+5
    03971 7710      ANDI	R17,0x70
    03972 9512      SWAP	R17
    03973 701F      ANDI	R17,0xF
    03974 0301      MULSU	R16,R17
    03975 0110      MOVW	R2,R0
    03976 9180 05E4 LDS	R24,time_buf+5
    03978 2799      CLR	R25
    03979 708F      ANDI	R24,0xF
    0397A 7090      ANDI	R25,0
    0397B 0E28      ADD	R2,R24
    0397C 1E39      ADC	R3,R25
    0397D 9230 08A0 STS	t+3,R3
    0397F 9220 089F STS	t+2,R2
(0738) 	t.tm_hour=  (((time_buf[4]&0x70)>>4)*10)+(time_buf[4]&0x0f);
    03981 9110 05E3 LDS	R17,time_buf+4
    03983 7710      ANDI	R17,0x70
    03984 9512      SWAP	R17
    03985 701F      ANDI	R17,0xF
    03986 0301      MULSU	R16,R17
    03987 0110      MOVW	R2,R0
    03988 9180 05E3 LDS	R24,time_buf+4
    0398A 2799      CLR	R25
    0398B 708F      ANDI	R24,0xF
    0398C 7090      ANDI	R25,0
    0398D 0E28      ADD	R2,R24
    0398E 1E39      ADC	R3,R25
    0398F 9230 08A2 STS	t+5,R3
    03991 9220 08A1 STS	t+4,R2
(0739) 	t.tm_mday=	(((time_buf[3]&0x70)>>4)*10)+(time_buf[3]&0x0f);
    03993 9110 05E2 LDS	R17,time_buf+3
    03995 7710      ANDI	R17,0x70
    03996 9512      SWAP	R17
    03997 701F      ANDI	R17,0xF
    03998 0301      MULSU	R16,R17
    03999 0110      MOVW	R2,R0
    0399A 9180 05E2 LDS	R24,time_buf+3
    0399C 2799      CLR	R25
    0399D 708F      ANDI	R24,0xF
    0399E 7090      ANDI	R25,0
    0399F 0E28      ADD	R2,R24
    039A0 1E39      ADC	R3,R25
    039A1 9230 08A4 STS	t+7,R3
    039A3 9220 08A3 STS	t+6,R2
(0740) 	t.tm_mon= (((time_buf[2]&0x70)>>4)*10)+(time_buf[2]&0x0f);
    039A5 9110 05E1 LDS	R17,time_buf+2
    039A7 7710      ANDI	R17,0x70
    039A8 9512      SWAP	R17
    039A9 701F      ANDI	R17,0xF
    039AA 0301      MULSU	R16,R17
    039AB 0110      MOVW	R2,R0
    039AC 9180 05E1 LDS	R24,time_buf+2
    039AE 2799      CLR	R25
    039AF 708F      ANDI	R24,0xF
    039B0 7090      ANDI	R25,0
    039B1 0E28      ADD	R2,R24
    039B2 1E39      ADC	R3,R25
    039B3 9230 08A6 STS	t+9,R3
    039B5 9220 08A5 STS	t+8,R2
(0741) 	t.tm_wday=	(time_buf[7]&0x0f);
    039B7 9180 05E6 LDS	R24,time_buf+7
    039B9 2799      CLR	R25
    039BA 708F      ANDI	R24,0xF
    039BB 7090      ANDI	R25,0
    039BC 9390 08AA STS	t+13,R25
    039BE 9380 08A9 STS	t+12,R24
(0742)     t.tm_year=	(((time_buf[1]&0x70)>>4)*10)+(time_buf[1]&0x0f);
    039C0 9110 05E0 LDS	R17,time_buf+1
    039C2 7710      ANDI	R17,0x70
    039C3 9512      SWAP	R17
    039C4 701F      ANDI	R17,0xF
    039C5 0301      MULSU	R16,R17
    039C6 0110      MOVW	R2,R0
    039C7 9180 05E0 LDS	R24,time_buf+1
    039C9 2799      CLR	R25
    039CA 708F      ANDI	R24,0xF
    039CB 7090      ANDI	R25,0
    039CC 0E28      ADD	R2,R24
    039CD 1E39      ADC	R3,R25
    039CE 9230 08A8 STS	t+11,R3
    039D0 9220 08A7 STS	t+10,R2
(0743) 	if(readhardware != 0){
    039D2 2344      TST	R20
    039D3 F409      BNE	0x39D5
    039D4 C09F      RJMP	0x3A74
(0744) 	Result.Date[0]='2';
    039D5 E382      LDI	R24,0x32
    039D6 9380 0653 STS	Result+22,R24
(0745) 	Result.Date[1]='0';
    039D8 E380      LDI	R24,0x30
    039D9 9380 0654 STS	Result+23,R24
(0746) 	Result.Date[2]=t.tm_year/10+'0';
    039DB E02A      LDI	R18,0xA
    039DC E030      LDI	R19,0
    039DD 0181      MOVW	R16,R2
    039DE 940E 49D7 CALL	div16s
    039E0 01C8      MOVW	R24,R16
    039E1 96C0      ADIW	R24,0x30
    039E2 9380 0655 STS	Result+24,R24
(0747) 	Result.Date[3]=t.tm_year%10+'0';
    039E4 E02A      LDI	R18,0xA
    039E5 E030      LDI	R19,0
    039E6 9100 08A7 LDS	R16,t+10
    039E8 9110 08A8 LDS	R17,t+11
    039EA 940E 49D3 CALL	mod16s
    039EC 01C8      MOVW	R24,R16
    039ED 96C0      ADIW	R24,0x30
    039EE 9380 0656 STS	Result+25,R24
(0748) 	Result.Date[4]=t.tm_mon/10+'0';
    039F0 E02A      LDI	R18,0xA
    039F1 E030      LDI	R19,0
    039F2 9100 08A5 LDS	R16,t+8
    039F4 9110 08A6 LDS	R17,t+9
    039F6 940E 49D7 CALL	div16s
    039F8 01C8      MOVW	R24,R16
    039F9 96C0      ADIW	R24,0x30
    039FA 9380 0657 STS	Result+26,R24
(0749) 	Result.Date[5]=t.tm_mon%10+'0';
    039FC E02A      LDI	R18,0xA
    039FD E030      LDI	R19,0
    039FE 9100 08A5 LDS	R16,t+8
    03A00 9110 08A6 LDS	R17,t+9
    03A02 940E 49D3 CALL	mod16s
    03A04 01C8      MOVW	R24,R16
    03A05 96C0      ADIW	R24,0x30
    03A06 9380 0658 STS	Result+27,R24
(0750) 	Result.Date[6]=t.tm_mday/10+'0';
    03A08 E02A      LDI	R18,0xA
    03A09 E030      LDI	R19,0
    03A0A 9100 08A3 LDS	R16,t+6
    03A0C 9110 08A4 LDS	R17,t+7
    03A0E 940E 49D7 CALL	div16s
    03A10 01C8      MOVW	R24,R16
    03A11 96C0      ADIW	R24,0x30
    03A12 9380 0659 STS	Result+28,R24
(0751) 	Result.Date[7]=t.tm_mday%10+'0';
    03A14 E02A      LDI	R18,0xA
    03A15 E030      LDI	R19,0
    03A16 9100 08A3 LDS	R16,t+6
    03A18 9110 08A4 LDS	R17,t+7
    03A1A 940E 49D3 CALL	mod16s
    03A1C 01C8      MOVW	R24,R16
    03A1D 96C0      ADIW	R24,0x30
    03A1E 9380 065A STS	Result+29,R24
(0752)     Result.Date[8]='\0';
    03A20 2422      CLR	R2
    03A21 9220 065B STS	Result+30,R2
(0753) 
(0754) 	Result.Time[0]=t.tm_hour/10+'0';
    03A23 E02A      LDI	R18,0xA
    03A24 E030      LDI	R19,0
    03A25 9100 08A1 LDS	R16,t+4
    03A27 9110 08A2 LDS	R17,t+5
    03A29 940E 49D7 CALL	div16s
    03A2B 01C8      MOVW	R24,R16
    03A2C 96C0      ADIW	R24,0x30
    03A2D 9380 065C STS	Result+31,R24
(0755) 	Result.Time[1]=t.tm_hour%10+'0';
    03A2F E02A      LDI	R18,0xA
    03A30 E030      LDI	R19,0
    03A31 9100 08A1 LDS	R16,t+4
    03A33 9110 08A2 LDS	R17,t+5
    03A35 940E 49D3 CALL	mod16s
    03A37 01C8      MOVW	R24,R16
    03A38 96C0      ADIW	R24,0x30
    03A39 9380 065D STS	Result+32,R24
(0756) 	Result.Time[2]=':';
    03A3B E38A      LDI	R24,0x3A
    03A3C 9380 065E STS	Result+33,R24
(0757) 	//Result.Time[3]=' ';
(0758) 	Result.Time[3]=t.tm_min/10+'0';
    03A3E E02A      LDI	R18,0xA
    03A3F E030      LDI	R19,0
    03A40 9100 089F LDS	R16,t+2
    03A42 9110 08A0 LDS	R17,t+3
    03A44 940E 49D7 CALL	div16s
    03A46 01C8      MOVW	R24,R16
    03A47 96C0      ADIW	R24,0x30
    03A48 9380 065F STS	Result+34,R24
(0759) 	Result.Time[4]=t.tm_min%10+'0';
    03A4A E02A      LDI	R18,0xA
    03A4B E030      LDI	R19,0
    03A4C 9100 089F LDS	R16,t+2
    03A4E 9110 08A0 LDS	R17,t+3
    03A50 940E 49D3 CALL	mod16s
    03A52 01C8      MOVW	R24,R16
    03A53 96C0      ADIW	R24,0x30
    03A54 9380 0660 STS	Result+35,R24
(0760) 	Result.Time[5]=':';
    03A56 E38A      LDI	R24,0x3A
    03A57 9380 0661 STS	Result+36,R24
(0761) 	//Result.Time[7]=' ';
(0762) 	Result.Time[6]=t.tm_sec/10+'0';
    03A59 E02A      LDI	R18,0xA
    03A5A E030      LDI	R19,0
    03A5B 9100 089D LDS	R16,t
    03A5D 9110 089E LDS	R17,t+1
    03A5F 940E 49D7 CALL	div16s
    03A61 01C8      MOVW	R24,R16
    03A62 96C0      ADIW	R24,0x30
    03A63 9380 0662 STS	Result+37,R24
(0763) 	Result.Time[7]=t.tm_sec%10+'0';
    03A65 E02A      LDI	R18,0xA
    03A66 E030      LDI	R19,0
    03A67 9100 089D LDS	R16,t
    03A69 9110 089E LDS	R17,t+1
    03A6B 940E 49D3 CALL	mod16s
    03A6D 01C8      MOVW	R24,R16
    03A6E 96C0      ADIW	R24,0x30
    03A6F 9380 0663 STS	Result+38,R24
(0764) 	Result.Time[8]='\0'; 
    03A71 2422      CLR	R2
    03A72 9220 0664 STS	Result+39,R2
(0765) 	}
(0766)     config.now =t.tm_hour*3600 + t.tm_min*60 + t.tm_sec; //更新系统心跳
    03A74 9120 089F LDS	R18,t+2
    03A76 9130 08A0 LDS	R19,t+3
    03A78 E30C      LDI	R16,0x3C
    03A79 E010      LDI	R17,0
    03A7A 940E 4AA3 CALL	empy16s
    03A7C 0118      MOVW	R2,R16
    03A7D 9120 08A1 LDS	R18,t+4
    03A7F 9130 08A2 LDS	R19,t+5
    03A81 E100      LDI	R16,0x10
    03A82 E01E      LDI	R17,0xE
    03A83 940E 4AA3 CALL	empy16s
    03A85 0128      MOVW	R4,R16
    03A86 0C42      ADD	R4,R2
    03A87 1C53      ADC	R5,R3
    03A88 9020 089D LDS	R2,t
    03A8A 9030 089E LDS	R3,t+1
    03A8C 0C42      ADD	R4,R2
    03A8D 1C53      ADC	R5,R3
    03A8E 0112      MOVW	R2,R4
    03A8F 2444      CLR	R4
    03A90 FC37      SBRC	R3,7
    03A91 9440      COM	R4
    03A92 2455      CLR	R5
    03A93 FC47      SBRC	R4,7
    03A94 9450      COM	R5
    03A95 9230 08BC STS	config+13,R3
    03A97 9220 08BB STS	config+12,R2
    03A99 9250 08BE STS	config+15,R5
    03A9B 9240 08BD STS	config+14,R4
    03A9D 9149      LD	R20,Y+
    03A9E 9508      RET
FILE: D:\LQD\software\software_src\zigbee.c
(0001) /*  此文件定义了从机zigbee的模块自检 及 与上位机通信的相关函数
(0002) *   版本 V1.0
(0003) *   日期 2012 08 10
(0004) *   版本历史：
(0005) * 数据格式
(0006) * 帧头    长度    目的地址   命令  内容     校验    帧尾
(0007) * FA       AA      B1        D1    01 03    00 00    fb  
(0008) *
(0009) *
(0010) *
(0011) ************/
(0012) #include "config.h"
(0013) 
(0014) #ifndef _DEVICE_INFOMATION_
(0015) #define _DEVICE_INFOMATION_
(0016) //设备相关信息 可存进EEPROM 调试阶段暂时做成全局常量
(0017) 
(0018) const char CommonId = 0xFF; //从设备公共ID
(0019) /***************配置设备ID***************/
(0020) #define _DEVICE_ID 1
(0021) /**************************************/
(0022) #if   _DEVICE_ID == 1 
(0023) char devicename[8] = {"DEV00001"};//设备名称
(0024) const char deviceId = 0xB1;//设备ID		
(0025) #elif  _DEVICE_ID == 2 
(0026) char devicename[8] = {"DEV000002"};//设备名称
(0027) const char deviceId = 0xB2;//设备ID		
(0028) #elif  _DEVICE_ID == 3  
(0029) char devicename[8] = {"DEV000003"};//设备名称
(0030) const char deviceId = 0xB3;//设备ID		
(0031) #elif  _DEVICE_ID == 4  
(0032) char devicename[8] = {"DEV000004"};//设备名称
(0033) const char deviceId = 0xB4;//设备ID		
(0034) #elif  _DEVICE_ID == 5  
(0035) char devicename[8] = {"DEV000005"};//设备名称
(0036) const char deviceId = 0xB5;//设备ID		
(0037) #elif  _DEVICE_ID == 6  
(0038) char devicename[8] = {"DEV000006"};//设备名称
(0039) const char deviceId = 0xB6;//设备ID		
(0040) #endif
(0041) 
(0042) //char *reslut_a ="Dev000001,0001,20120920,12:00,-40.5,12.3,-55.5,-40.4,-40.3";
(0043) 
(0044) //char *p2 = "a123456789b12456789c123456789d123456789e123456789f12456789g123456789h12345789i12456789";
(0045) #endif
(0046)  
(0047) 
(0048) #define FRAME_LEN     13
(0049) #define STORAGE_DB_AND_SD  0
(0050) #define STORAGE_DB		   1
(0051) #define STORAGE_SD		   2
(0052) #define Z_CMD0 0xD0   
(0053) //命令0 响应查找从机命令
(0054) 
(0055) #define Z_CMD1 0xD1
(0056) //命令1 发送 采样日期  Result.Date
(0057) 
(0058) #define Z_CMD2 0xD2
(0059) //命令2 发送 采样时间  Result.Time
(0060) 
(0061) #define Z_CMD3 0xD3
(0062) //命令3 发送 温度
(0063) 
(0064) #define Z_CMD4 0xD4
(0065) //命令4 发送风速
(0066) 
(0067) #define Z_CMD5 0xD5
(0068) //命令5 发送WCI
(0069) 
(0070) #define Z_CMD6 0xD6
(0071) //命令6 发送ETC
(0072) 
(0073) #define Z_CMD7 0xD7
(0074) //命令7 发送TEQ
(0075) 
(0076) #define Z_CMD8 0xD8
(0077) //命令8 发送冻伤危害性和轻、重、中四个字节的数据
(0078) 
(0079) struct buffer_struct Rec;
(0080) //缓存池 Buf[100] ;
(0081) //读缓存指针BufReadP;
(0082) //写缓存指针BufWriteP;
(0083) //当前缓存个数 BufCount;
(0084) 
(0085) //struct SendStruct Send; 
(0086) 
(0087) void zigbee_init( void )
(0088) {
(0089)   Rec.BufReadP=0;
_zigbee_init:
    03A9F 2422      CLR	R2
    03AA0 9220 091F STS	Rec+90,R2
(0090)   Rec.BufWriteP=0;
    03AA2 9220 0920 STS	Rec+91,R2
(0091)   Rec.BufCount=0;
    03AA4 9220 0921 STS	Rec+92,R2
    03AA6 9508      RET
(0092) }
(0093) unsigned char RecAdd(unsigned char ByteRec)
(0094) {
(0095)   if (Rec.BufWriteP >= BufSize)  
_RecAdd:
  ByteRec              --> R16
    03AA7 9180 0920 LDS	R24,Rec+91
    03AA9 358A      CPI	R24,0x5A
    03AAA F018      BCS	0x3AAE
(0096)   	 Rec.BufWriteP=0;
    03AAB 2422      CLR	R2
    03AAC 9220 0920 STS	Rec+91,R2
(0097)   Rec.Buf[Rec.BufWriteP++] = ByteRec ;
    03AAE 9020 0920 LDS	R2,Rec+91
    03AB0 2D82      MOV	R24,R2
    03AB1 5F8F      SUBI	R24,0xFF
    03AB2 9380 0920 STS	Rec+91,R24
    03AB4 EC85      LDI	R24,0xC5
    03AB5 E098      LDI	R25,0x8
    03AB6 2DE2      MOV	R30,R2
    03AB7 27FF      CLR	R31
    03AB8 0FE8      ADD	R30,R24
    03AB9 1FF9      ADC	R31,R25
    03ABA 8300      ST	Z,R16
(0098)   Rec.BufCount++;
    03ABB 9180 0921 LDS	R24,Rec+92
    03ABD 5F8F      SUBI	R24,0xFF
    03ABE 9380 0921 STS	Rec+92,R24
(0099)   return Rec.BufWriteP;
    03AC0 9100 0920 LDS	R16,Rec+91
    03AC2 9508      RET
_RecRemove:
  N                    --> R10
    03AC3 92AA      ST	-Y,R10
    03AC4 2EA0      MOV	R10,R16
(0100) } 
(0101) 
(0102) void RecRemove(char N)
(0103) { 
(0104)   if(Rec.BufCount >= N ) 
    03AC5 9020 0921 LDS	R2,Rec+92
    03AC7 142A      CP	R2,R10
    03AC8 F168      BCS	0x3AF6
(0105)   {  debug("DEL=",Rec.Buf[Rec.BufReadP]);
    03AC9 EC85      LDI	R24,0xC5
    03ACA E098      LDI	R25,0x8
    03ACB 91E0 091F LDS	R30,Rec+90
    03ACD 27FF      CLR	R31
    03ACE 0FE8      ADD	R30,R24
    03ACF 1FF9      ADC	R31,R25
    03AD0 8120      LD	R18,Z
    03AD1 EB0E      LDI	R16,0xBE
    03AD2 E015      LDI	R17,5
    03AD3 940E 2D4D CALL	_debug
(0106)      Rec.Buf[Rec.BufReadP]=0x00; 
    03AD5 EC85      LDI	R24,0xC5
    03AD6 E098      LDI	R25,0x8
    03AD7 91E0 091F LDS	R30,Rec+90
    03AD9 27FF      CLR	R31
    03ADA 0FE8      ADD	R30,R24
    03ADB 1FF9      ADC	R31,R25
    03ADC 2422      CLR	R2
    03ADD 8220      ST	Z,R2
(0107)    	 Rec.BufReadP=Rec.BufReadP+N;
    03ADE 9020 091F LDS	R2,Rec+90
    03AE0 0C2A      ADD	R2,R10
    03AE1 9220 091F STS	Rec+90,R2
(0108) 	 if(Rec.BufReadP >= BufSize) {
    03AE3 2D82      MOV	R24,R2
    03AE4 358A      CPI	R24,0x5A
    03AE5 F018      BCS	0x3AE9
(0109) 	 				 		 Rec.BufReadP =Rec.BufReadP-BufSize;
    03AE6 558A      SUBI	R24,0x5A
    03AE7 9380 091F STS	Rec+90,R24
(0110) 							 }
(0111) 	 Rec.BufCount=Rec.BufCount-N;
    03AE9 9020 0921 LDS	R2,Rec+92
    03AEB 182A      SUB	R2,R10
    03AEC 9220 0921 STS	Rec+92,R2
(0112) 	 if(Rec.BufCount==0) {
    03AEE 2022      TST	R2
    03AEF F469      BNE	0x3AFD
(0113) 	 Rec.BufReadP=0;
    03AF0 2422      CLR	R2
    03AF1 9220 091F STS	Rec+90,R2
(0114)      Rec.BufWriteP=0;
    03AF3 9220 0920 STS	Rec+91,R2
(0115) 	 
(0116) 	 }
(0117) 	 
(0118)   }
    03AF5 C007      RJMP	0x3AFD
(0119)   else 
(0120)   {  //移除量大于现有量 移除所有 计数清零
(0121)     Rec.BufReadP=0;
    03AF6 2422      CLR	R2
    03AF7 9220 091F STS	Rec+90,R2
(0122)     Rec.BufWriteP=0;
    03AF9 9220 0920 STS	Rec+91,R2
(0123)     Rec.BufCount=0;
    03AFB 9220 0921 STS	Rec+92,R2
(0124)   
(0125)   }
    03AFD 90A9      LD	R10,Y+
    03AFE 9508      RET
_RecRead:
  tmp                  --> R20
  index                --> R16
    03AFF 934A      ST	-Y,R20
    03B00 935A      ST	-Y,R21
(0126)  }
(0127) char  RecRead(unsigned char index)
(0128) { 
(0129)   int tmp;
(0130)   if(Rec.BufCount < index) 
    03B01 9020 0921 LDS	R2,Rec+92
    03B03 1620      CP	R2,R16
    03B04 F410      BCC	0x3B07
(0131)   	return 0;
    03B05 2700      CLR	R16
    03B06 C013      RJMP	0x3B1A
(0132) 	
(0133)   tmp=Rec.BufReadP+index;
    03B07 2E20      MOV	R2,R16
    03B08 2433      CLR	R3
    03B09 9140 091F LDS	R20,Rec+90
    03B0B 2755      CLR	R21
    03B0C 0D42      ADD	R20,R2
    03B0D 1D53      ADC	R21,R3
(0134)   if(tmp>=BufSize)  {tmp=tmp-BufSize;}
    03B0E 354A      CPI	R20,0x5A
    03B0F E0E0      LDI	R30,0
    03B10 075E      CPC	R21,R30
    03B11 F014      BLT	0x3B14
    03B12 554A      SUBI	R20,0x5A
    03B13 4050      SBCI	R21,0
(0135)   return Rec.Buf[tmp-1];
    03B14 EC84      LDI	R24,0xC4
    03B15 E098      LDI	R25,0x8
    03B16 01FA      MOVW	R30,R20
    03B17 0FE8      ADD	R30,R24
    03B18 1FF9      ADC	R31,R25
    03B19 8100      LD	R16,Z
    03B1A 9159      LD	R21,Y+
    03B1B 9149      LD	R20,Y+
    03B1C 9508      RET
_CheckCRC:
  i                    --> Y,+0
    03B1D 931A      ST	-Y,R17
    03B1E 930A      ST	-Y,R16
(0136) } 
(0137) 
(0138) 
(0139) char CheckCRC(unsigned char i)
(0140) {
(0141)  i=i;
(0142)  return 1;  //校验成功
    03B1F E001      LDI	R16,1
    03B20 9622      ADIW	R28,2
    03B21 9508      RET
_RecDeal:
  buf                  --> Y,+1
  state                --> R20
  tmp                  --> R10
  i                    --> R22
    03B22 940E 4B26 CALL	push_xgsetF00C
    03B24 9726      SBIW	R28,6
(0143) 
(0144) }
(0145) #define res Result
(0146)  //1 找头 2找长度 3计算尾 4找尾 5核对校验码 6分析命令 7执行操作
(0147) unsigned char RecDeal( void )
(0148) { 
(0149)   int i=0 , tmp=0, state=0 ;
    03B25 24AA      CLR	R10
    03B26 24BB      CLR	R11
    03B27 2744      CLR	R20
    03B28 2755      CLR	R21
(0150)   char buf[5];
(0151)   //[TASK :找帧头]
(0152)   for(i=0;i <= Rec.BufCount ; i++ ){ 
    03B29 2766      CLR	R22
    03B2A 2777      CLR	R23
    03B2B C013      RJMP	0x3B3F
(0153)       tmp = RecRead(1);    //读出当前值
    03B2C E001      LDI	R16,1
    03B2D DFD1      RCALL	_RecRead
    03B2E 2EA0      MOV	R10,R16
    03B2F 24BB      CLR	R11
(0154) 	  if(tmp != FRAME_HEAD ) {
    03B30 01C5      MOVW	R24,R10
    03B31 3F8A      CPI	R24,0xFA
    03B32 E0E0      LDI	R30,0
    03B33 079E      CPC	R25,R30
    03B34 F029      BEQ	0x3B3A
(0155) 	      state = 1; //已查找无帧头
    03B35 E041      LDI	R20,1
    03B36 E050      LDI	R21,0
(0156) 		  RecRemove(1);
    03B37 E001      LDI	R16,1
    03B38 DF8A      RCALL	_RecRemove
(0157) 	  }		  
    03B39 C003      RJMP	0x3B3D
(0158) 	  else{	  //已找到帧头 跳出循环
(0159)       state = 2 ;  //已找到帧头 标志	 
    03B3A E042      LDI	R20,2
    03B3B E050      LDI	R21,0
(0160) 	  break ;
    03B3C C008      RJMP	0x3B45
    03B3D 5F6F      SUBI	R22,0xFF
    03B3E 4F7F      SBCI	R23,0xFF
    03B3F 9020 0921 LDS	R2,Rec+92
    03B41 2433      CLR	R3
    03B42 1626      CP	R2,R22
    03B43 0637      CPC	R3,R23
    03B44 F73C      BGE	0x3B2C
(0161) 	  }
(0162)  }		
(0163)  
(0164)  if(Rec.BufCount < FRAME_LEN) return 0x01;  //缓冲区数据太少  直接返回
    03B45 9180 0921 LDS	R24,Rec+92
    03B47 308D      CPI	R24,0xD
    03B48 F410      BCC	0x3B4B
    03B49 E001      LDI	R16,1
    03B4A C0B2      RJMP	0x3BFD
(0165)  
(0166)  if(state == 1 || Rec.BufCount< FRAME_LEN ) return 0x03; //退出函数  无帧头
    03B4B 3041      CPI	R20,1
    03B4C E0E0      LDI	R30,0
    03B4D 075E      CPC	R21,R30
    03B4E F021      BEQ	0x3B53
    03B4F 9180 0921 LDS	R24,Rec+92
    03B51 308D      CPI	R24,0xD
    03B52 F410      BCC	0x3B55
    03B53 E003      LDI	R16,3
    03B54 C0A8      RJMP	0x3BFD
(0167)  //debug("#FRAME END =",RecRead(FRAME_LEN));
(0168)  //debug("#RECREAD(3) =",RecRead(3));
(0169)  if(RecRead(FRAME_LEN) != FRAME_END || ((RecRead(3)!=deviceId)&& (RecRead(3)!=CommonId) )  )  //非成帧数据或ID不符
    03B55 E00D      LDI	R16,0xD
    03B56 DFA8      RCALL	_RecRead
    03B57 3F0B      CPI	R16,0xFB
    03B58 F471      BNE	0x3B67
    03B59 E003      LDI	R16,3
    03B5A DFA4      RCALL	_RecRead
    03B5B 2EA0      MOV	R10,R16
    03B5C 9020 05BD LDS	R2,deviceId
    03B5E 1502      CP	R16,R2
    03B5F F059      BEQ	0x3B6B
    03B60 E003      LDI	R16,3
    03B61 DF9D      RCALL	_RecRead
    03B62 2EA0      MOV	R10,R16
    03B63 9020 05B4 LDS	R2,CommonId
    03B65 1502      CP	R16,R2
    03B66 F021      BEQ	0x3B6B
(0170)  {
(0171)     RecRemove(1);	//移除命令
    03B67 E001      LDI	R16,1
    03B68 DF5A      RCALL	_RecRemove
(0172)     return 0x05;    //非成帧数据 或ID不符
    03B69 E005      LDI	R16,5
    03B6A C092      RJMP	0x3BFD
(0173)  }
(0174)  else if((CheckCRC(FRAME_LEN)==1))   //校验通过
    03B6B E00D      LDI	R16,0xD
    03B6C DFB0      RCALL	_CheckCRC
    03B6D 2F40      MOV	R20,R16
    03B6E 3001      CPI	R16,1
    03B6F F009      BEQ	0x3B71
    03B70 C089      RJMP	0x3BFA
(0175)  {
(0176)      switch(RecRead(4)){
    03B71 E004      LDI	R16,4
    03B72 DF8C      RCALL	_RecRead
    03B73 2EA0      MOV	R10,R16
    03B74 2D4A      MOV	R20,R10
    03B75 2755      CLR	R21
    03B76 3D40      CPI	R20,0xD0
    03B77 E0E0      LDI	R30,0
    03B78 075E      CPC	R21,R30
    03B79 F149      BEQ	0x3BA3
    03B7A 3D41      CPI	R20,0xD1
    03B7B E0E0      LDI	R30,0
    03B7C 075E      CPC	R21,R30
    03B7D F409      BNE	0x3B7F
    03B7E C02E      RJMP	0x3BAD
    03B7F 3D42      CPI	R20,0xD2
    03B80 E0E0      LDI	R30,0
    03B81 075E      CPC	R21,R30
    03B82 F409      BNE	0x3B84
    03B83 C031      RJMP	0x3BB5
    03B84 3D43      CPI	R20,0xD3
    03B85 E0E0      LDI	R30,0
    03B86 075E      CPC	R21,R30
    03B87 F409      BNE	0x3B89
    03B88 C034      RJMP	0x3BBD
    03B89 3D44      CPI	R20,0xD4
    03B8A E0E0      LDI	R30,0
    03B8B 075E      CPC	R21,R30
    03B8C F409      BNE	0x3B8E
    03B8D C037      RJMP	0x3BC5
    03B8E 3D45      CPI	R20,0xD5
    03B8F E0E0      LDI	R30,0
    03B90 075E      CPC	R21,R30
    03B91 F409      BNE	0x3B93
    03B92 C03A      RJMP	0x3BCD
    03B93 3D46      CPI	R20,0xD6
    03B94 E0E0      LDI	R30,0
    03B95 075E      CPC	R21,R30
    03B96 F409      BNE	0x3B98
    03B97 C03D      RJMP	0x3BD5
    03B98 3D47      CPI	R20,0xD7
    03B99 E0E0      LDI	R30,0
    03B9A 075E      CPC	R21,R30
    03B9B F409      BNE	0x3B9D
    03B9C C040      RJMP	0x3BDD
    03B9D 3D48      CPI	R20,0xD8
    03B9E E0E0      LDI	R30,0
    03B9F 075E      CPC	R21,R30
    03BA0 F409      BNE	0x3BA2
    03BA1 C043      RJMP	0x3BE5
    03BA2 C055      RJMP	0x3BF8
(0177)          case Z_CMD0 :  //发送设备信息
(0178) 		 Send_string((char *)devicename,Z_CMD0,sizeof(devicename));
    03BA3 E088      LDI	R24,0x8
    03BA4 8388      ST	Y,R24
    03BA5 ED20      LDI	R18,0xD0
    03BA6 EB05      LDI	R16,0xB5
    03BA7 E015      LDI	R17,5
    03BA8 D057      RCALL	_Send_string
(0179) 		 RecRemove(12);
    03BA9 E00C      LDI	R16,0xC
    03BAA DF18      RCALL	_RecRemove
(0180) 	     return 0xD0;  //发送完成 返回成功
    03BAB ED00      LDI	R16,0xD0
    03BAC C050      RJMP	0x3BFD
(0181) 		 break ;
(0182)   		
(0183) 		 case Z_CMD1 :  //发送日期
(0184) 		 Send_string(res.Date, Z_CMD1, 9);
    03BAD E089      LDI	R24,0x9
    03BAE 8388      ST	Y,R24
    03BAF ED21      LDI	R18,0xD1
    03BB0 E503      LDI	R16,0x53
    03BB1 E016      LDI	R17,6
    03BB2 D04D      RCALL	_Send_string
(0185) 		 return 0xD1;  //发送完成 返回成功
    03BB3 ED01      LDI	R16,0xD1
    03BB4 C048      RJMP	0x3BFD
(0186) 		 break ;	
(0187) 		 
(0188) 		 case Z_CMD2 :  //发送Time
(0189) 		 Send_string(res.Time, Z_CMD2, 10);
    03BB5 E08A      LDI	R24,0xA
    03BB6 8388      ST	Y,R24
    03BB7 ED22      LDI	R18,0xD2
    03BB8 E50C      LDI	R16,0x5C
    03BB9 E016      LDI	R17,6
    03BBA D045      RCALL	_Send_string
(0190) 		 return 0xD2;  //发送完成 返回成功
    03BBB ED02      LDI	R16,0xD2
    03BBC C040      RJMP	0x3BFD
(0191) 		 break ;	
(0192) 		 
(0193) 		 case Z_CMD3 :  //发送温度
(0194) 		 Send_string(res.TempChar, Z_CMD3, 6);
    03BBD E086      LDI	R24,6
    03BBE 8388      ST	Y,R24
    03BBF ED23      LDI	R18,0xD3
    03BC0 E60A      LDI	R16,0x6A
    03BC1 E016      LDI	R17,6
    03BC2 D03D      RCALL	_Send_string
(0195) 		 return 0xD3;  //发送完成 返回成功
    03BC3 ED03      LDI	R16,0xD3
    03BC4 C038      RJMP	0x3BFD
(0196) 		 break ;	
(0197) 		 
(0198) 		 case Z_CMD4 :  //发送WSChar
(0199) 		 Send_string(res.WSChar, Z_CMD4, 5);
    03BC5 E085      LDI	R24,5
    03BC6 8388      ST	Y,R24
    03BC7 ED24      LDI	R18,0xD4
    03BC8 E704      LDI	R16,0x74
    03BC9 E016      LDI	R17,6
    03BCA D035      RCALL	_Send_string
(0200) 		 return 0xD4;  //发送完成 返回成功
    03BCB ED04      LDI	R16,0xD4
    03BCC C030      RJMP	0x3BFD
(0201) 		 break ;			 
(0202) 		 
(0203) 		 case Z_CMD5 :  //发送WCIChar
(0204) 		 Send_string(res.WCIChar, Z_CMD5 ,8);
    03BCD E088      LDI	R24,0x8
    03BCE 8388      ST	Y,R24
    03BCF ED25      LDI	R18,0xD5
    03BD0 E70D      LDI	R16,0x7D
    03BD1 E016      LDI	R17,6
    03BD2 D02D      RCALL	_Send_string
(0205) 		 return 0xD5;  //发送完成 返回成功
    03BD3 ED05      LDI	R16,0xD5
    03BD4 C028      RJMP	0x3BFD
(0206) 		 break ;	
(0207) 		 
(0208) 		 case Z_CMD6 :  //ECTChar
(0209) 		 Send_string(res.ECTChar, Z_CMD6 ,6);
    03BD5 E086      LDI	R24,6
    03BD6 8388      ST	Y,R24
    03BD7 ED26      LDI	R18,0xD6
    03BD8 E809      LDI	R16,0x89
    03BD9 E016      LDI	R17,6
    03BDA D025      RCALL	_Send_string
(0210) 		 return 0xD6;  //发送完成 返回成功
    03BDB ED06      LDI	R16,0xD6
    03BDC C020      RJMP	0x3BFD
(0211) 		 break ;		
(0212) 		 
(0213) 		 case Z_CMD7 :  //发送TeqCharres.TeqChar
(0214) 		 Send_string(res.TeqChar, Z_CMD7 ,6);
    03BDD E086      LDI	R24,6
    03BDE 8388      ST	Y,R24
    03BDF ED27      LDI	R18,0xD7
    03BE0 E903      LDI	R16,0x93
    03BE1 E016      LDI	R17,6
    03BE2 D01D      RCALL	_Send_string
(0215) 		 return 0xD7;  //发送完成 返回成功
    03BE3 ED07      LDI	R16,0xD7
    03BE4 C018      RJMP	0x3BFD
(0216) 		 break ;	 
(0217) 		 
(0218) 		 case Z_CMD8 :  //发送日期
(0219) 		 //buf[0]= res.WeiHai + 0x30;
(0220) 		 //buf[1]= res.LowLabor + 0x30;
(0221) 		 //buf[2]= res.MidLabor + 0x30;
(0222) 		 //buf[3]= res.HighLabor + 0x30;
(0223) 		 buf[0]= 0 + 0x30;
    03BE5 E380      LDI	R24,0x30
    03BE6 8389      STD	Y+1,R24
(0224) 		 buf[1]= 2 + 0x30;
    03BE7 E382      LDI	R24,0x32
    03BE8 838A      STD	Y+2,R24
(0225) 		 buf[2]= 4 + 0x30;
    03BE9 E384      LDI	R24,0x34
    03BEA 838B      STD	Y+3,R24
(0226) 		 buf[3]= 7 + 0x30;
    03BEB E387      LDI	R24,0x37
    03BEC 838C      STD	Y+4,R24
(0227) 		 buf[4]= 0;
    03BED 2422      CLR	R2
    03BEE 822D      STD	Y+5,R2
(0228) 		 Send_string(buf, Z_CMD8, 4);
    03BEF E084      LDI	R24,4
    03BF0 8388      ST	Y,R24
    03BF1 ED28      LDI	R18,0xD8
    03BF2 018E      MOVW	R16,R28
    03BF3 5F0F      SUBI	R16,0xFF
    03BF4 4F1F      SBCI	R17,0xFF
    03BF5 D00A      RCALL	_Send_string
(0229) 		 return 0xD8;  //发送完成 返回成功
    03BF6 ED08      LDI	R16,0xD8
    03BF7 C005      RJMP	0x3BFD
(0230) 		 break ;
(0231) 		 default:    
(0232) 	     return 0xff;			   
    03BF8 EF0F      LDI	R16,0xFF
    03BF9 C003      RJMP	0x3BFD
(0233)      }
(0234)  } 
(0235)  else { //校验不成功 丢弃帧头 寻找下一帧头
(0236)   RecRemove(1);  //丢弃帧头
    03BFA E001      LDI	R16,1
    03BFB DEC7      RCALL	_RecRemove
(0237)   return 0xff;
    03BFC EF0F      LDI	R16,0xFF
    03BFD 9626      ADIW	R28,6
    03BFE 940C 4B2D JMP	pop_xgsetF00C
_Send_string:
  sendBuf              --> Y,+0
  i                    --> R20
  MaxLen               --> R12
  cmd                  --> R14
  buf                  --> R10
    03C00 940E 4B09 CALL	push_xgset30FC
    03C02 2EE2      MOV	R14,R18
    03C03 0158      MOVW	R10,R16
    03C04 97EF      SBIW	R28,0x3F
    03C05 9721      SBIW	R28,1
    03C06 01FE      MOVW	R30,R28
    03C07 5BE8      SUBI	R30,0xB8
    03C08 4FFF      SBCI	R31,0xFF
    03C09 80C0      LD	R12,Z
(0238)  }
(0239) }
(0240) void Send_string(char *buf, unsigned char cmd, unsigned char MaxLen){
(0241) 	 char i = 0;
(0242) 	 
(0243) 	 unsigned char sendBuf[64];
(0244) 	 sendBuf[0] = FRAME_HEAD;
    03C0A EF8A      LDI	R24,0xFA
    03C0B 8388      ST	Y,R24
(0245) 	 sendBuf[1] = 0;
    03C0C 2422      CLR	R2
    03C0D 8229      STD	Y+1,R2
(0246) 	 sendBuf[2] = 0x00; //主机地址
    03C0E 822A      STD	Y+2,R2
(0247) 	 sendBuf[3] = deviceId;//Send.src; //本机地址
    03C0F 9020 05BD LDS	R2,deviceId
    03C11 822B      STD	Y+3,R2
(0248) 	 sendBuf[4] = cmd; //
    03C12 82EC      STD	Y+4,R14
(0249) 	 for(i=0;i<MaxLen;i++){
    03C13 2744      CLR	R20
    03C14 C014      RJMP	0x3C29
(0250) 	     if( *(buf+i) != 0 ){
    03C15 2FE4      MOV	R30,R20
    03C16 27FF      CLR	R31
    03C17 0DEA      ADD	R30,R10
    03C18 1DFB      ADC	R31,R11
    03C19 8020      LD	R2,Z
    03C1A 2022      TST	R2
    03C1B F079      BEQ	0x3C2B
(0251) 		 	 sendBuf[i+5] = *(buf+i);
    03C1C 2FE4      MOV	R30,R20
    03C1D 27FF      CLR	R31
    03C1E 0DEA      ADD	R30,R10
    03C1F 1DFB      ADC	R31,R11
    03C20 8020      LD	R2,Z
    03C21 01CE      MOVW	R24,R28
    03C22 9605      ADIW	R24,5
    03C23 2FE4      MOV	R30,R20
    03C24 27FF      CLR	R31
    03C25 0FE8      ADD	R30,R24
    03C26 1FF9      ADC	R31,R25
    03C27 8220      ST	Z,R2
    03C28 9543      INC	R20
    03C29 154C      CP	R20,R12
    03C2A F350      BCS	0x3C15
(0252) 		 }
(0253) 		 else { 
(0254) 		 break;
(0255) 		 }
(0256) 	 }
(0257) 	 i=i+5;
    03C2B 5F4B      SUBI	R20,0xFB
(0258) 	 sendBuf[i++] = 0xCC;
    03C2C 2E24      MOV	R2,R20
    03C2D 2433      CLR	R3
    03C2E 5F4F      SUBI	R20,0xFF
    03C2F 01CE      MOVW	R24,R28
    03C30 2DE2      MOV	R30,R2
    03C31 27FF      CLR	R31
    03C32 0FE8      ADD	R30,R24
    03C33 1FF9      ADC	R31,R25
    03C34 EC8C      LDI	R24,0xCC
    03C35 8380      ST	Z,R24
(0259) 	 sendBuf[i++] = 0xCC;
    03C36 2E24      MOV	R2,R20
    03C37 2433      CLR	R3
    03C38 5F4F      SUBI	R20,0xFF
    03C39 01CE      MOVW	R24,R28
    03C3A 2DE2      MOV	R30,R2
    03C3B 27FF      CLR	R31
    03C3C 0FE8      ADD	R30,R24
    03C3D 1FF9      ADC	R31,R25
    03C3E EC8C      LDI	R24,0xCC
    03C3F 8380      ST	Z,R24
(0260) 	 sendBuf[i] = FRAME_END;
    03C40 01CE      MOVW	R24,R28
    03C41 2FE4      MOV	R30,R20
    03C42 27FF      CLR	R31
    03C43 0FE8      ADD	R30,R24
    03C44 1FF9      ADC	R31,R25
    03C45 EF8B      LDI	R24,0xFB
    03C46 8380      ST	Z,R24
(0261) 	 sendBuf[1] = i+1;
    03C47 2F84      MOV	R24,R20
    03C48 5F8F      SUBI	R24,0xFF
    03C49 8389      STD	Y+1,R24
(0262) 	 delayms((deviceId-0xB1)*1);  //不同设备延时不同时间发送数据，避免碰撞
    03C4A 9110 05BD LDS	R17,deviceId
    03C4C E001      LDI	R16,1
    03C4D 0301      MULSU	R16,R17
    03C4E 0180      MOVW	R16,R0
    03C4F 5B01      SUBI	R16,0xB1
    03C50 4010      SBCI	R17,0
    03C51 940E 253A CALL	_delayms
(0263) 	 Send_nByte(sendBuf, i+1); //uart send
    03C53 2F24      MOV	R18,R20
    03C54 5F2F      SUBI	R18,0xFF
    03C55 018E      MOVW	R16,R28
    03C56 940E 3CFB CALL	_Send_nByte
    03C58 96EF      ADIW	R28,0x3F
    03C59 9621      ADIW	R28,1
    03C5A 940C 4AF3 JMP	pop_xgset30FC
_zigbee_send_date:
  buf                  --> Y,+1
    03C5C 9726      SBIW	R28,6
(0264) }
(0265) /* 发送hex 暂未用到
(0266) void Send_bin(char *buf, unsigned char cmd, unsigned char buf_len){
(0267) 	 char i = 0;
(0268) 	 
(0269) 	 unsigned char sendBuf[64];
(0270) 	 sendBuf[0] = FRAME_HEAD;
(0271) 	 sendBuf[1] = 0;
(0272) 	 sendBuf[2] = 0x00; //主机地址
(0273) 	 sendBuf[3] = deviceId; //本机地址
(0274) 	 sendBuf[4] = cmd; //
(0275) 	 for(i=0;i<buf_len;i++){
(0276) 			 	 sendBuf[i+5] = *(buf+i);
(0277) 	 }
(0278) 	 i=i+5;
(0279) 	 sendBuf[i++] = 0xCC;
(0280) 	 sendBuf[i++] = 0xCC;
(0281) 	 sendBuf[i] = FRAME_END;
(0282) 	 sendBuf[1] = i+1;
(0283) 	 delayms((deviceId-0xB1)*1);  //不同设备延时不同时间发送数据，避免碰撞
(0284) 	 Send_nByte(sendBuf, i+1); //uart send
(0285) }
(0286) */
(0287) void zigbee_send_date(void){
(0288) 	char buf[5];
(0289)     Send_string(res.Date, Z_CMD1, 9);
    03C5D E089      LDI	R24,0x9
    03C5E 8388      ST	Y,R24
    03C5F ED21      LDI	R18,0xD1
    03C60 E503      LDI	R16,0x53
    03C61 E016      LDI	R17,6
    03C62 DF9D      RCALL	_Send_string
(0290) 	Send_string(res.Time, Z_CMD2, 10);
    03C63 E08A      LDI	R24,0xA
    03C64 8388      ST	Y,R24
    03C65 ED22      LDI	R18,0xD2
    03C66 E50C      LDI	R16,0x5C
    03C67 E016      LDI	R17,6
    03C68 DF97      RCALL	_Send_string
(0291) 	Send_string(res.TempChar, Z_CMD3, 6);
    03C69 E086      LDI	R24,6
    03C6A 8388      ST	Y,R24
    03C6B ED23      LDI	R18,0xD3
    03C6C E60A      LDI	R16,0x6A
    03C6D E016      LDI	R17,6
    03C6E DF91      RCALL	_Send_string
(0292) 	Send_string(res.WSChar, Z_CMD4, 5);
    03C6F E085      LDI	R24,5
    03C70 8388      ST	Y,R24
    03C71 ED24      LDI	R18,0xD4
    03C72 E704      LDI	R16,0x74
    03C73 E016      LDI	R17,6
    03C74 DF8B      RCALL	_Send_string
(0293) 	Send_string(res.WCIChar, Z_CMD5 ,8);
    03C75 E088      LDI	R24,0x8
    03C76 8388      ST	Y,R24
    03C77 ED25      LDI	R18,0xD5
    03C78 E70D      LDI	R16,0x7D
    03C79 E016      LDI	R17,6
    03C7A DF85      RCALL	_Send_string
(0294) 	Send_string(res.ECTChar, Z_CMD6 ,6);
    03C7B E086      LDI	R24,6
    03C7C 8388      ST	Y,R24
    03C7D ED26      LDI	R18,0xD6
    03C7E E809      LDI	R16,0x89
    03C7F E016      LDI	R17,6
    03C80 DF7F      RCALL	_Send_string
(0295) 	Send_string(res.TeqChar, Z_CMD7 ,6);
    03C81 E086      LDI	R24,6
    03C82 8388      ST	Y,R24
    03C83 ED27      LDI	R18,0xD7
    03C84 E903      LDI	R16,0x93
    03C85 E016      LDI	R17,6
    03C86 DF79      RCALL	_Send_string
(0296) 	
(0297) 	buf[0]= 1 + 0x30;
    03C87 E381      LDI	R24,0x31
    03C88 8389      STD	Y+1,R24
(0298) 	buf[1]= 2 + 0x30;
    03C89 E382      LDI	R24,0x32
    03C8A 838A      STD	Y+2,R24
(0299) 	buf[2]= 1 + 0x30;
    03C8B E381      LDI	R24,0x31
    03C8C 838B      STD	Y+3,R24
(0300) 	buf[3]= 1 + 0x30;
    03C8D 838C      STD	Y+4,R24
(0301) 	buf[4]= 0;
    03C8E 2422      CLR	R2
    03C8F 822D      STD	Y+5,R2
(0302) 	Send_string(buf, Z_CMD8, 5);
    03C90 E085      LDI	R24,5
    03C91 8388      ST	Y,R24
    03C92 ED28      LDI	R18,0xD8
    03C93 018E      MOVW	R16,R28
    03C94 5F0F      SUBI	R16,0xFF
    03C95 4F1F      SBCI	R17,0xFF
    03C96 DF69      RCALL	_Send_string
(0303) 	return ;
    03C97 9626      ADIW	R28,6
    03C98 9508      RET
FILE: D:\LQD\software\software_src\usart.c
(0001) #include "config.h"
(0002) 
(0003) 
(0004) #define fosc 7372800UL //晶振7.3728MHZ
(0005) #define baud 38400  //波特率
(0006) //串口通信初始化  MEGA128
(0007) //UART1 initialize
(0008) // desired baud rate:38400
(0009) // actual baud rate:38400 (0.0%)
(0010) // char size: 8 bit
(0011) // parity: Disabled
(0012) void uart1_init(void)
(0013) {
(0014)  UCSR1B = 0x00; //disable while setting baud rate
_uart1_init:
    03C99 2422      CLR	R2
    03C9A 9220 009A STS	0x9A,R2
(0015)  UCSR1A = 0x00;
    03C9C 9220 009B STS	0x9B,R2
(0016)  UCSR1C = 0x06;
    03C9E E086      LDI	R24,6
    03C9F 9380 009D STS	0x9D,R24
(0017)  UBRR1L = 0x0B; //set baud rate lo
    03CA1 E08B      LDI	R24,0xB
    03CA2 9380 0099 STS	0x99,R24
(0018)  UBRR1H = 0x00; //set baud rate hi
    03CA4 9220 0098 STS	0x98,R2
(0019)  UCSR1B = 0x98;
    03CA6 E988      LDI	R24,0x98
    03CA7 9380 009A STS	0x9A,R24
    03CA9 9508      RET
_uart1_rx_isr:
  tmp                  --> R10
    03CAA 920A      ST	-Y,R0
    03CAB 921A      ST	-Y,R1
    03CAC 922A      ST	-Y,R2
    03CAD 923A      ST	-Y,R3
    03CAE 924A      ST	-Y,R4
    03CAF 925A      ST	-Y,R5
    03CB0 926A      ST	-Y,R6
    03CB1 927A      ST	-Y,R7
    03CB2 928A      ST	-Y,R8
    03CB3 929A      ST	-Y,R9
    03CB4 930A      ST	-Y,R16
    03CB5 931A      ST	-Y,R17
    03CB6 932A      ST	-Y,R18
    03CB7 933A      ST	-Y,R19
    03CB8 938A      ST	-Y,R24
    03CB9 939A      ST	-Y,R25
    03CBA 93AA      ST	-Y,R26
    03CBB 93BA      ST	-Y,R27
    03CBC 93EA      ST	-Y,R30
    03CBD 93FA      ST	-Y,R31
    03CBE B60F      IN	R0,0x3F
    03CBF 920A      ST	-Y,R0
    03CC0 92AA      ST	-Y,R10
(0020) }
(0021) 
(0022) #pragma interrupt_handler uart1_rx_isr:iv_USART1_RXC
(0023) void uart1_rx_isr(void){   
(0024) 	 char tmp;
(0025) 	 tmp=UDR1;
    03CC1 90A0 009C LDS	R10,0x9C
(0026) 	 //Usart_Transmit(tmp);
(0027) 	 RecAdd(tmp); //this function is come from zigbee.c
    03CC3 2D0A      MOV	R16,R10
    03CC4 940E 3AA7 CALL	_RecAdd
    03CC6 90A9      LD	R10,Y+
    03CC7 9009      LD	R0,Y+
    03CC8 BE0F      OUT	0x3F,R0
    03CC9 91F9      LD	R31,Y+
    03CCA 91E9      LD	R30,Y+
    03CCB 91B9      LD	R27,Y+
    03CCC 91A9      LD	R26,Y+
    03CCD 9199      LD	R25,Y+
    03CCE 9189      LD	R24,Y+
    03CCF 9139      LD	R19,Y+
    03CD0 9129      LD	R18,Y+
    03CD1 9119      LD	R17,Y+
    03CD2 9109      LD	R16,Y+
    03CD3 9099      LD	R9,Y+
    03CD4 9089      LD	R8,Y+
    03CD5 9079      LD	R7,Y+
    03CD6 9069      LD	R6,Y+
    03CD7 9059      LD	R5,Y+
    03CD8 9049      LD	R4,Y+
    03CD9 9039      LD	R3,Y+
    03CDA 9029      LD	R2,Y+
    03CDB 9019      LD	R1,Y+
    03CDC 9009      LD	R0,Y+
    03CDD 9518      RETI
(0028) }
(0029) 
(0030) void Usart_Transmit(char c)
(0031) {
(0032)  	 while (!(UCSR1A&(1<<UDRE1)));//表明发送器一准备就绪
_Usart_Transmit:
  c                    --> R16
    03CDE 9020 009B LDS	R2,0x9B
    03CE0 FE25      SBRS	R2,5
    03CE1 CFFC      RJMP	_Usart_Transmit
(0033) 	 UDR1=c;
    03CE2 9300 009C STS	0x9C,R16
    03CE4 9508      RET
_Puts:
  s                    --> R20
    03CE5 934A      ST	-Y,R20
    03CE6 935A      ST	-Y,R21
    03CE7 01A8      MOVW	R20,R16
(0034) }
(0035) 
(0036) //串口输出字符串
(0037) void Puts( unsigned char *s)
(0038) { 
    03CE8 C00B      RJMP	0x3CF4
(0039) 	 while (*s) 
(0040)       { 
(0041) 	  //为数据间的隔断创造一个串口能显示的隔断字符 即'/t'  ->  ' '
(0042) 	  if(*s==0x09)  
    03CE9 01FA      MOVW	R30,R20
    03CEA 8180      LD	R24,Z
    03CEB 3089      CPI	R24,0x9
    03CEC F411      BNE	0x3CEF
(0043) 	  {   Usart_Transmit(' ');    }
    03CED E200      LDI	R16,0x20
    03CEE DFEF      RCALL	_Usart_Transmit
(0044) 	 Usart_Transmit(*s);
    03CEF 01FA      MOVW	R30,R20
    03CF0 8100      LD	R16,Z
    03CF1 DFEC      RCALL	_Usart_Transmit
(0045) 	 s++;
    03CF2 5F4F      SUBI	R20,0xFF
    03CF3 4F5F      SBCI	R21,0xFF
    03CF4 01FA      MOVW	R30,R20
    03CF5 8020      LD	R2,Z
    03CF6 2022      TST	R2
    03CF7 F789      BNE	0x3CE9
    03CF8 9159      LD	R21,Y+
    03CF9 9149      LD	R20,Y+
    03CFA 9508      RET
_Send_nByte:
  i                    --> R20
  len                  --> R10
  p                    --> R12
    03CFB 940E 4B34 CALL	push_xgset303C
    03CFD 2EA2      MOV	R10,R18
    03CFE 0168      MOVW	R12,R16
(0046) 	
(0047) 	
(0048)       }
(0049) }
(0050) 
(0051) 
(0052) 
(0053) void Send_nByte(unsigned char *p, unsigned char len)
(0054) { 
(0055)   int i = 0;
(0056)   for(i=0;i<len;i++)
    03CFF 2744      CLR	R20
    03D00 2755      CLR	R21
    03D01 C007      RJMP	0x3D09
(0057)   {
(0058)    	Usart_Transmit(*(p+i));
    03D02 01FA      MOVW	R30,R20
    03D03 0DEC      ADD	R30,R12
    03D04 1DFD      ADC	R31,R13
    03D05 8100      LD	R16,Z
    03D06 DFD7      RCALL	_Usart_Transmit
    03D07 5F4F      SUBI	R20,0xFF
    03D08 4F5F      SBCI	R21,0xFF
    03D09 2C2A      MOV	R2,R10
    03D0A 2433      CLR	R3
    03D0B 1542      CP	R20,R2
    03D0C 0553      CPC	R21,R3
    03D0D F3A4      BLT	0x3D02
    03D0E 940C 4B3B JMP	pop_xgset303C
_PrintString:
  str                  --> R10
    03D10 92AA      ST	-Y,R10
    03D11 92BA      ST	-Y,R11
    03D12 0158      MOVW	R10,R16
(0059)   }
(0060) }
(0061) 
(0062) void  PrintString(const unsigned char *str)
(0063) {    
    03D13 C004      RJMP	0x3D18
(0064) 	while(*str!=0)	Usart_Transmit(*str++);
    03D14 01F5      MOVW	R30,R10
    03D15 9101      LD	R16,Z+
    03D16 015F      MOVW	R10,R30
    03D17 DFC6      RCALL	_Usart_Transmit
    03D18 01F5      MOVW	R30,R10
    03D19 8020      LD	R2,Z
    03D1A 2022      TST	R2
    03D1B F7C1      BNE	0x3D14
    03D1C 90B9      LD	R11,Y+
    03D1D 90A9      LD	R10,Y+
    03D1E 9508      RET
_PrintString_n:
  str                  --> R10
    03D1F 92AA      ST	-Y,R10
    03D20 92BA      ST	-Y,R11
    03D21 0158      MOVW	R10,R16
(0065) }
(0066) void  PrintString_n(const unsigned char *str)
(0067) {   
(0068) 	Usart_Transmit('\r');
    03D22 E00D      LDI	R16,0xD
    03D23 DFBA      RCALL	_Usart_Transmit
(0069) 	Usart_Transmit('\n'); 
    03D24 E00A      LDI	R16,0xA
    03D25 DFB8      RCALL	_Usart_Transmit
    03D26 C004      RJMP	0x3D2B
(0070) 	while(*str!=0)	Usart_Transmit(*str++);
    03D27 01F5      MOVW	R30,R10
    03D28 9101      LD	R16,Z+
    03D29 015F      MOVW	R10,R30
    03D2A DFB3      RCALL	_Usart_Transmit
    03D2B 01F5      MOVW	R30,R10
    03D2C 8020      LD	R2,Z
    03D2D 2022      TST	R2
    03D2E F7C1      BNE	0x3D27
    03D2F 90B9      LD	R11,Y+
    03D30 90A9      LD	R10,Y+
    03D31 9508      RET
_PrintLong:
  i                    --> R20
  da                   --> Y,+0
  data                 --> Y,+9
    03D32 940E 49C2 CALL	push_arg4
    03D34 934A      ST	-Y,R20
    03D35 9728      SBIW	R28,0x8
(0071) 
(0072) } 
(0073)  
(0074) void PrintLong(unsigned long data)
(0075) {
(0076)  
(0077) 	unsigned char da[8];
(0078) 	unsigned char i;
(0079) 	for(i=0;i<8;i++)	da[i]=0;
    03D36 2744      CLR	R20
    03D37 C008      RJMP	0x3D40
    03D38 01CE      MOVW	R24,R28
    03D39 2FE4      MOV	R30,R20
    03D3A 27FF      CLR	R31
    03D3B 0FE8      ADD	R30,R24
    03D3C 1FF9      ADC	R31,R25
    03D3D 2422      CLR	R2
    03D3E 8220      ST	Z,R2
    03D3F 9543      INC	R20
    03D40 3048      CPI	R20,0x8
    03D41 F3B0      BCS	0x3D38
    03D42 C013      RJMP	0x3D56
(0080) 	while(data>=10000000L){ ++da[7];data-=10000000L;}
    03D43 818F      LDD	R24,Y+7
    03D44 5F8F      SUBI	R24,0xFF
    03D45 838F      STD	Y+7,R24
    03D46 E880      LDI	R24,0x80
    03D47 E996      LDI	R25,0x96
    03D48 E9A8      LDI	R26,0x98
    03D49 E0B0      LDI	R27,0
    03D4A 8429      LDD	R2,Y+9
    03D4B 843A      LDD	R3,Y+10
    03D4C 844B      LDD	R4,Y+11
    03D4D 845C      LDD	R5,Y+12
    03D4E 1A28      SUB	R2,R24
    03D4F 0A39      SBC	R3,R25
    03D50 0A4A      SBC	R4,R26
    03D51 0A5B      SBC	R5,R27
    03D52 8629      STD	Y+9,R2
    03D53 863A      STD	Y+10,R3
    03D54 864B      STD	Y+11,R4
    03D55 865C      STD	Y+12,R5
    03D56 E880      LDI	R24,0x80
    03D57 E996      LDI	R25,0x96
    03D58 E9A8      LDI	R26,0x98
    03D59 E0B0      LDI	R27,0
    03D5A 8429      LDD	R2,Y+9
    03D5B 843A      LDD	R3,Y+10
    03D5C 844B      LDD	R4,Y+11
    03D5D 845C      LDD	R5,Y+12
    03D5E 1628      CP	R2,R24
    03D5F 0639      CPC	R3,R25
    03D60 064A      CPC	R4,R26
    03D61 065B      CPC	R5,R27
    03D62 F700      BCC	0x3D43
(0081) 	if(da[7])	i=0;
    03D63 802F      LDD	R2,Y+7
    03D64 2022      TST	R2
    03D65 F009      BEQ	0x3D67
    03D66 2744      CLR	R20
(0082) 	if(i==0)	Usart_Transmit('0'+da[7]);
    03D67 2344      TST	R20
    03D68 F4B9      BNE	0x3D80
    03D69 810F      LDD	R16,Y+7
    03D6A 5D00      SUBI	R16,0xD0
    03D6B DF72      RCALL	_Usart_Transmit
    03D6C C013      RJMP	0x3D80
(0083) 	while(data>=1000000L) { ++da[6];data-=1000000L;}
    03D6D 818E      LDD	R24,Y+6
    03D6E 5F8F      SUBI	R24,0xFF
    03D6F 838E      STD	Y+6,R24
    03D70 E480      LDI	R24,0x40
    03D71 E492      LDI	R25,0x42
    03D72 E0AF      LDI	R26,0xF
    03D73 E0B0      LDI	R27,0
    03D74 8429      LDD	R2,Y+9
    03D75 843A      LDD	R3,Y+10
    03D76 844B      LDD	R4,Y+11
    03D77 845C      LDD	R5,Y+12
    03D78 1A28      SUB	R2,R24
    03D79 0A39      SBC	R3,R25
    03D7A 0A4A      SBC	R4,R26
    03D7B 0A5B      SBC	R5,R27
    03D7C 8629      STD	Y+9,R2
    03D7D 863A      STD	Y+10,R3
    03D7E 864B      STD	Y+11,R4
    03D7F 865C      STD	Y+12,R5
    03D80 E480      LDI	R24,0x40
    03D81 E492      LDI	R25,0x42
    03D82 E0AF      LDI	R26,0xF
    03D83 E0B0      LDI	R27,0
    03D84 8429      LDD	R2,Y+9
    03D85 843A      LDD	R3,Y+10
    03D86 844B      LDD	R4,Y+11
    03D87 845C      LDD	R5,Y+12
    03D88 1628      CP	R2,R24
    03D89 0639      CPC	R3,R25
    03D8A 064A      CPC	R4,R26
    03D8B 065B      CPC	R5,R27
    03D8C F700      BCC	0x3D6D
(0084) 	if(da[6])	i=0;
    03D8D 802E      LDD	R2,Y+6
    03D8E 2022      TST	R2
    03D8F F009      BEQ	0x3D91
    03D90 2744      CLR	R20
(0085) 	if(i==0)	Usart_Transmit('0'+da[6]);
    03D91 2344      TST	R20
    03D92 F4B9      BNE	0x3DAA
    03D93 810E      LDD	R16,Y+6
    03D94 5D00      SUBI	R16,0xD0
    03D95 DF48      RCALL	_Usart_Transmit
    03D96 C013      RJMP	0x3DAA
(0086) 	while(data>=100000L)  { ++da[5];data-=100000L;}
    03D97 818D      LDD	R24,Y+5
    03D98 5F8F      SUBI	R24,0xFF
    03D99 838D      STD	Y+5,R24
    03D9A EA80      LDI	R24,0xA0
    03D9B E896      LDI	R25,0x86
    03D9C E0A1      LDI	R26,1
    03D9D E0B0      LDI	R27,0
    03D9E 8429      LDD	R2,Y+9
    03D9F 843A      LDD	R3,Y+10
    03DA0 844B      LDD	R4,Y+11
    03DA1 845C      LDD	R5,Y+12
    03DA2 1A28      SUB	R2,R24
    03DA3 0A39      SBC	R3,R25
    03DA4 0A4A      SBC	R4,R26
    03DA5 0A5B      SBC	R5,R27
    03DA6 8629      STD	Y+9,R2
    03DA7 863A      STD	Y+10,R3
    03DA8 864B      STD	Y+11,R4
    03DA9 865C      STD	Y+12,R5
    03DAA EA80      LDI	R24,0xA0
    03DAB E896      LDI	R25,0x86
    03DAC E0A1      LDI	R26,1
    03DAD E0B0      LDI	R27,0
    03DAE 8429      LDD	R2,Y+9
    03DAF 843A      LDD	R3,Y+10
    03DB0 844B      LDD	R4,Y+11
    03DB1 845C      LDD	R5,Y+12
    03DB2 1628      CP	R2,R24
    03DB3 0639      CPC	R3,R25
    03DB4 064A      CPC	R4,R26
    03DB5 065B      CPC	R5,R27
    03DB6 F700      BCC	0x3D97
(0087) 	if(da[5])	i=0;
    03DB7 802D      LDD	R2,Y+5
    03DB8 2022      TST	R2
    03DB9 F009      BEQ	0x3DBB
    03DBA 2744      CLR	R20
(0088) 	if(i==0)	Usart_Transmit('0'+da[5]);
    03DBB 2344      TST	R20
    03DBC F4B9      BNE	0x3DD4
    03DBD 810D      LDD	R16,Y+5
    03DBE 5D00      SUBI	R16,0xD0
    03DBF DF1E      RCALL	_Usart_Transmit
    03DC0 C013      RJMP	0x3DD4
(0089) 	while(data>=10000L)   { ++da[4];data-=10000L;}
    03DC1 818C      LDD	R24,Y+4
    03DC2 5F8F      SUBI	R24,0xFF
    03DC3 838C      STD	Y+4,R24
    03DC4 E180      LDI	R24,0x10
    03DC5 E297      LDI	R25,0x27
    03DC6 E0A0      LDI	R26,0
    03DC7 E0B0      LDI	R27,0
    03DC8 8429      LDD	R2,Y+9
    03DC9 843A      LDD	R3,Y+10
    03DCA 844B      LDD	R4,Y+11
    03DCB 845C      LDD	R5,Y+12
    03DCC 1A28      SUB	R2,R24
    03DCD 0A39      SBC	R3,R25
    03DCE 0A4A      SBC	R4,R26
    03DCF 0A5B      SBC	R5,R27
    03DD0 8629      STD	Y+9,R2
    03DD1 863A      STD	Y+10,R3
    03DD2 864B      STD	Y+11,R4
    03DD3 865C      STD	Y+12,R5
    03DD4 E180      LDI	R24,0x10
    03DD5 E297      LDI	R25,0x27
    03DD6 E0A0      LDI	R26,0
    03DD7 E0B0      LDI	R27,0
    03DD8 8429      LDD	R2,Y+9
    03DD9 843A      LDD	R3,Y+10
    03DDA 844B      LDD	R4,Y+11
    03DDB 845C      LDD	R5,Y+12
    03DDC 1628      CP	R2,R24
    03DDD 0639      CPC	R3,R25
    03DDE 064A      CPC	R4,R26
    03DDF 065B      CPC	R5,R27
    03DE0 F700      BCC	0x3DC1
(0090) 	if(da[4])	i=0;
    03DE1 802C      LDD	R2,Y+4
    03DE2 2022      TST	R2
    03DE3 F009      BEQ	0x3DE5
    03DE4 2744      CLR	R20
(0091) 	if(i==0)	Usart_Transmit('0'+da[4]);
    03DE5 2344      TST	R20
    03DE6 F4B9      BNE	0x3DFE
    03DE7 810C      LDD	R16,Y+4
    03DE8 5D00      SUBI	R16,0xD0
    03DE9 DEF4      RCALL	_Usart_Transmit
    03DEA C013      RJMP	0x3DFE
(0092) 	while(data>=1000L)    { ++da[3];data-=1000L;}
    03DEB 818B      LDD	R24,Y+3
    03DEC 5F8F      SUBI	R24,0xFF
    03DED 838B      STD	Y+3,R24
    03DEE EE88      LDI	R24,0xE8
    03DEF E093      LDI	R25,3
    03DF0 E0A0      LDI	R26,0
    03DF1 E0B0      LDI	R27,0
    03DF2 8429      LDD	R2,Y+9
    03DF3 843A      LDD	R3,Y+10
    03DF4 844B      LDD	R4,Y+11
    03DF5 845C      LDD	R5,Y+12
    03DF6 1A28      SUB	R2,R24
    03DF7 0A39      SBC	R3,R25
    03DF8 0A4A      SBC	R4,R26
    03DF9 0A5B      SBC	R5,R27
    03DFA 8629      STD	Y+9,R2
    03DFB 863A      STD	Y+10,R3
    03DFC 864B      STD	Y+11,R4
    03DFD 865C      STD	Y+12,R5
    03DFE EE88      LDI	R24,0xE8
    03DFF E093      LDI	R25,3
    03E00 E0A0      LDI	R26,0
    03E01 E0B0      LDI	R27,0
    03E02 8429      LDD	R2,Y+9
    03E03 843A      LDD	R3,Y+10
    03E04 844B      LDD	R4,Y+11
    03E05 845C      LDD	R5,Y+12
    03E06 1628      CP	R2,R24
    03E07 0639      CPC	R3,R25
    03E08 064A      CPC	R4,R26
    03E09 065B      CPC	R5,R27
    03E0A F700      BCC	0x3DEB
(0093) 	if(da[3])	i=0;
    03E0B 802B      LDD	R2,Y+3
    03E0C 2022      TST	R2
    03E0D F009      BEQ	0x3E0F
    03E0E 2744      CLR	R20
(0094) 	if(i==0)	Usart_Transmit('0'+da[3]);
    03E0F 2344      TST	R20
    03E10 F4B9      BNE	0x3E28
    03E11 810B      LDD	R16,Y+3
    03E12 5D00      SUBI	R16,0xD0
    03E13 DECA      RCALL	_Usart_Transmit
    03E14 C013      RJMP	0x3E28
(0095) 	while(data>=100L)     { ++da[2];data-=100L;}
    03E15 818A      LDD	R24,Y+2
    03E16 5F8F      SUBI	R24,0xFF
    03E17 838A      STD	Y+2,R24
    03E18 E684      LDI	R24,0x64
    03E19 E090      LDI	R25,0
    03E1A E0A0      LDI	R26,0
    03E1B E0B0      LDI	R27,0
    03E1C 8429      LDD	R2,Y+9
    03E1D 843A      LDD	R3,Y+10
    03E1E 844B      LDD	R4,Y+11
    03E1F 845C      LDD	R5,Y+12
    03E20 1A28      SUB	R2,R24
    03E21 0A39      SBC	R3,R25
    03E22 0A4A      SBC	R4,R26
    03E23 0A5B      SBC	R5,R27
    03E24 8629      STD	Y+9,R2
    03E25 863A      STD	Y+10,R3
    03E26 864B      STD	Y+11,R4
    03E27 865C      STD	Y+12,R5
    03E28 E684      LDI	R24,0x64
    03E29 E090      LDI	R25,0
    03E2A E0A0      LDI	R26,0
    03E2B E0B0      LDI	R27,0
    03E2C 8429      LDD	R2,Y+9
    03E2D 843A      LDD	R3,Y+10
    03E2E 844B      LDD	R4,Y+11
    03E2F 845C      LDD	R5,Y+12
    03E30 1628      CP	R2,R24
    03E31 0639      CPC	R3,R25
    03E32 064A      CPC	R4,R26
    03E33 065B      CPC	R5,R27
    03E34 F700      BCC	0x3E15
(0096) 	if(da[2])	i=0;
    03E35 802A      LDD	R2,Y+2
    03E36 2022      TST	R2
    03E37 F009      BEQ	0x3E39
    03E38 2744      CLR	R20
(0097) 	if(i==0)	Usart_Transmit('0'+da[2]);
    03E39 2344      TST	R20
    03E3A F4B9      BNE	0x3E52
    03E3B 810A      LDD	R16,Y+2
    03E3C 5D00      SUBI	R16,0xD0
    03E3D DEA0      RCALL	_Usart_Transmit
    03E3E C013      RJMP	0x3E52
(0098) 	while(data>=10L)      { ++da[1];data-=10L;}
    03E3F 8189      LDD	R24,Y+1
    03E40 5F8F      SUBI	R24,0xFF
    03E41 8389      STD	Y+1,R24
    03E42 E08A      LDI	R24,0xA
    03E43 E090      LDI	R25,0
    03E44 E0A0      LDI	R26,0
    03E45 E0B0      LDI	R27,0
    03E46 8429      LDD	R2,Y+9
    03E47 843A      LDD	R3,Y+10
    03E48 844B      LDD	R4,Y+11
    03E49 845C      LDD	R5,Y+12
    03E4A 1A28      SUB	R2,R24
    03E4B 0A39      SBC	R3,R25
    03E4C 0A4A      SBC	R4,R26
    03E4D 0A5B      SBC	R5,R27
    03E4E 8629      STD	Y+9,R2
    03E4F 863A      STD	Y+10,R3
    03E50 864B      STD	Y+11,R4
    03E51 865C      STD	Y+12,R5
    03E52 E08A      LDI	R24,0xA
    03E53 E090      LDI	R25,0
    03E54 E0A0      LDI	R26,0
    03E55 E0B0      LDI	R27,0
    03E56 8429      LDD	R2,Y+9
    03E57 843A      LDD	R3,Y+10
    03E58 844B      LDD	R4,Y+11
    03E59 845C      LDD	R5,Y+12
    03E5A 1628      CP	R2,R24
    03E5B 0639      CPC	R3,R25
    03E5C 064A      CPC	R4,R26
    03E5D 065B      CPC	R5,R27
    03E5E F700      BCC	0x3E3F
(0099) 	if(da[1])	i=0;
    03E5F 8029      LDD	R2,Y+1
    03E60 2022      TST	R2
    03E61 F009      BEQ	0x3E63
    03E62 2744      CLR	R20
(0100) 	if(i==0)	Usart_Transmit('0'+da[1]);
    03E63 2344      TST	R20
    03E64 F419      BNE	0x3E68
    03E65 8109      LDD	R16,Y+1
    03E66 5D00      SUBI	R16,0xD0
    03E67 DE76      RCALL	_Usart_Transmit
(0101) 	Usart_Transmit('0'+data);
    03E68 E380      LDI	R24,0x30
    03E69 E090      LDI	R25,0
    03E6A E0A0      LDI	R26,0
    03E6B E0B0      LDI	R27,0
    03E6C 8429      LDD	R2,Y+9
    03E6D 843A      LDD	R3,Y+10
    03E6E 844B      LDD	R4,Y+11
    03E6F 845C      LDD	R5,Y+12
    03E70 0E28      ADD	R2,R24
    03E71 1E39      ADC	R3,R25
    03E72 1E4A      ADC	R4,R26
    03E73 1E5B      ADC	R5,R27
    03E74 2D02      MOV	R16,R2
    03E75 DE68      RCALL	_Usart_Transmit
    03E76 9628      ADIW	R28,0x8
    03E77 9149      LD	R20,Y+
    03E78 9624      ADIW	R28,4
    03E79 9508      RET
_PrintChar:
  h                    --> R20
  d                    --> R22
    03E7A 934A      ST	-Y,R20
    03E7B 936A      ST	-Y,R22
    03E7C 2F60      MOV	R22,R16
(0102)  
(0103) }
(0104)  
(0105) void PrintChar(unsigned char d)
(0106) {
(0107) 	unsigned char h=(d&0xF0)>>4;
    03E7D 2F46      MOV	R20,R22
    03E7E 7F40      ANDI	R20,0xF0
    03E7F 9542      SWAP	R20
    03E80 704F      ANDI	R20,0xF
(0108) 	if(h<10)	Usart_Transmit('0'+h);
    03E81 304A      CPI	R20,0xA
    03E82 F420      BCC	0x3E87
    03E83 2F04      MOV	R16,R20
    03E84 5D00      SUBI	R16,0xD0
    03E85 DE58      RCALL	_Usart_Transmit
    03E86 C003      RJMP	0x3E8A
(0109) 	else		Usart_Transmit('A'-10+h);
    03E87 2F04      MOV	R16,R20
    03E88 5C09      SUBI	R16,0xC9
    03E89 DE54      RCALL	_Usart_Transmit
(0110) 	h=d&0x0f;
    03E8A 2F46      MOV	R20,R22
    03E8B 704F      ANDI	R20,0xF
(0111) 	if(h<10)	Usart_Transmit('0'+h);
    03E8C 304A      CPI	R20,0xA
    03E8D F420      BCC	0x3E92
    03E8E 2F04      MOV	R16,R20
    03E8F 5D00      SUBI	R16,0xD0
    03E90 DE4D      RCALL	_Usart_Transmit
    03E91 C003      RJMP	0x3E95
(0112) 	else		Usart_Transmit('A'-10+h);
    03E92 2F04      MOV	R16,R20
    03E93 5C09      SUBI	R16,0xC9
    03E94 DE49      RCALL	_Usart_Transmit
(0113) 	Usart_Transmit(' ');
    03E95 E200      LDI	R16,0x20
    03E96 DE47      RCALL	_Usart_Transmit
    03E97 9169      LD	R22,Y+
    03E98 9149      LD	R20,Y+
    03E99 9508      RET
FILE: D:\LQD\software\software_src\SPI.c
(0001) //*****************************************************************************//
(0002) //*								 
(0003) //*控制芯片：ATmgea128
(0004) //*开发环境：AVR Studio+GCC
(0005) //*隶属模块：SPI接口控制
(0006) //*****************************************************************************//
(0007) #include "SPI.h"
(0008) 
(0009) /******************************************************************
(0010) SPI接口函数初始化
(0011) ******************************************************************/
(0012) void SPI_IO_Init(void)
(0013) {
(0014) 	SPI_PORT |= (1<<SS);////拉高CS
_SPI_IO_Init:
    03E9A 9AC0      SBI	0x18,0
(0015) 	SPI_DDR |= (1<<SCLK)|(1<<MOSI)|(1<<SS);////CS,CLK,MOSI设为输出
    03E9B B387      IN	R24,0x17
    03E9C 6087      ORI	R24,7
    03E9D BB87      OUT	0x17,R24
(0016) 	SPI_DDR &=~(1<<MISO);//MISO设为输入
    03E9E 98BB      CBI	0x17,3
(0017) 	SPI_PORT |= (1<<SCLK);//拉高CLK
    03E9F 9AC1      SBI	0x18,1
(0018) 	SPI_High();//SPI高通
    03EA0 E580      LDI	R24,0x50
    03EA1 B98D      OUT	0x0D,R24
    03EA2 9A70      SBI	0x0E,0
    03EA3 9508      RET
(0019) }
(0020) /******************************************************************
(0021) SPI写一个字节
(0022) ******************************************************************/
(0023) void SPI_Write(UINT8 data)
(0024) {
(0025) 	SPDR = data;
_SPI_Write:
  data                 --> R16
    03EA4 B90F      OUT	0x0F,R16
(0026) 	while ((SPSR&(1<<SPIF))==0);
    03EA5 9B77      SBIS	0x0E,7
    03EA6 CFFE      RJMP	0x3EA5
    03EA7 9508      RET
(0027) 	//loop_until_bit_is_set(SPSR,SPIF);
(0028) }
(0029) /******************************************************************
(0030) SPI读一个字节
(0031) ******************************************************************/
(0032) unsigned char SPI_Read(void)
(0033) {
(0034) 	SPDR = 0xFF;//写0xFF启动SPI
_SPI_Read:
    03EA8 EF8F      LDI	R24,0xFF
    03EA9 B98F      OUT	0x0F,R24
(0035) 	while ((SPSR&(1<<SPIF))==0);
    03EAA 9B77      SBIS	0x0E,7
    03EAB CFFE      RJMP	0x3EAA
(0036) 	//loop_until_bit_is_set(SPSR,SPIF);//等待SPIF为高电平
(0037) 	return  SPDR;//返回读取值
    03EAC B10F      IN	R16,0x0F
    03EAD 9508      RET
FILE: D:\LQD\software\software_src\lcd.c
(0001) #include "config.h"
(0002) 
(0003) //此硬件引脚适合冷强度检测仪第2版电路  mega128
(0004) #define LCD_PIN_CS   4
(0005) #define LCD_PIN_SID  3
(0006) #define LCD_PIN_SCLK 2
(0007) #define LCD_PIN_RST  1
(0008) #define LCD_BACKLIGHT_SW		0
(0009) #define LCD_PORT PORTC
(0010) #define LCD_PIN_DDR DDRC
(0011) #define Set_CS()     LCD_PIN_DDR |= (1<<LCD_PIN_CS)  ;LCD_PORT |= (1<<LCD_PIN_CS) 
(0012) #define Set_SID()    LCD_PIN_DDR |= (1<<LCD_PIN_SID) ;LCD_PORT |= (1<<LCD_PIN_SID) 
(0013) #define Set_SCLK()   LCD_PIN_DDR |= (1<<LCD_PIN_SCLK);LCD_PORT |= (1<<LCD_PIN_SCLK) 
(0014) #define LCD_LIGHT_ON()   LCD_PIN_DDR |= (1<<LCD_BACKLIGHT_SW);LCD_PORT |= (1<<LCD_BACKLIGHT_SW) 
(0015) #define Set_RST()   LCD_PIN_DDR |= (1<<LCD_PIN_RST);LCD_PORT |= (1<<LCD_PIN_RST) 
(0016) 
(0017) #define Clr_CS()     LCD_PIN_DDR |= (1<<LCD_PIN_CS)  ;LCD_PORT &=~(1<<LCD_PIN_CS) 
(0018) #define Clr_SID()    LCD_PIN_DDR |= (1<<LCD_PIN_SID) ;LCD_PORT &=~(1<<LCD_PIN_SID) 
(0019) #define Clr_SCLK()   LCD_PIN_DDR |= (1<<LCD_PIN_SCLK);LCD_PORT &=~(1<<LCD_PIN_SCLK) 
(0020) #define LCD_LIGHT_OFF()   LCD_PIN_DDR |= (1<<LCD_BACKLIGHT_SW);LCD_PORT &=~(1<<LCD_BACKLIGHT_SW) 
(0021) #define Clr_RST()   LCD_PIN_DDR |= (1<<LCD_PIN_RST);LCD_PORT &=~(1<<LCD_PIN_RST) 
(0022)  
(0023) void W_1byte(unsigned char RW, unsigned char RS, unsigned char W_data); 
(0024) void Write_8bits(unsigned int W_bits); 
(0025) void LCD_Init(void); 
(0026) unsigned char LCD_INT(void); 
(0027) 
(0028) unsigned char LCD_SW(unsigned char i)
(0029) {
(0030)  if(i==0){
_LCD_SW:
  i                    --> R16
    03EAE 2300      TST	R16
    03EAF F421      BNE	0x3EB4
(0031)  LCD_LIGHT_OFF();
    03EB0 9AA0      SBI	0x14,0
    03EB1 98A8      CBI	0x15,0
(0032)  return 0;
    03EB2 2700      CLR	R16
    03EB3 C003      RJMP	0x3EB7
(0033)  }
(0034)  else{
(0035)  LCD_LIGHT_ON();
    03EB4 9AA0      SBI	0x14,0
    03EB5 9AA8      SBI	0x15,0
(0036)  return 1;
    03EB6 E001      LDI	R16,1
    03EB7 9508      RET
(0037)  }
(0038)  
(0039) }
(0040)  
(0041) unsigned char LCD_INT(void) 
(0042) { 
(0043)   Clr_CS(); 
_LCD_INT:
    03EB8 9AA4      SBI	0x14,4
    03EB9 98AC      CBI	0x15,4
(0044)   Clr_SID(); 
    03EBA 9AA3      SBI	0x14,3
    03EBB 98AB      CBI	0x15,3
(0045)   Clr_SCLK(); 
    03EBC 9AA2      SBI	0x14,2
    03EBD 98AA      CBI	0x15,2
(0046)   LCD_Init(); 
    03EBE D097      RCALL	_LCD_Init
(0047)   return (0);
    03EBF 2700      CLR	R16
    03EC0 9508      RET
_address:
  a                    --> R20
  y                    --> R18
  x                    --> R16
    03EC1 940E 4B1C CALL	push_xgsetF000
(0048) } 
(0049)   
(0050) /******************************************************************** 
(0051) 函数 名：address
(0052) 入口参数：地址转换
(0053) 出口参数：无 
(0054) 函数作用： 
(0055) 说        明： 
(0056) ********************************************************************/ 
(0057) unsigned char address(unsigned char x,unsigned char y)
(0058) {  
(0059)  unsigned char a;
(0060) 
(0061) switch(x) 
    03EC3 2F60      MOV	R22,R16
    03EC4 2777      CLR	R23
    03EC5 3061      CPI	R22,1
    03EC6 E0E0      LDI	R30,0
    03EC7 077E      CPC	R23,R30
    03EC8 F069      BEQ	0x3ED6
    03EC9 3062      CPI	R22,2
    03ECA E0E0      LDI	R30,0
    03ECB 077E      CPC	R23,R30
    03ECC F059      BEQ	0x3ED8
    03ECD 3063      CPI	R22,3
    03ECE E0E0      LDI	R30,0
    03ECF 077E      CPC	R23,R30
    03ED0 F049      BEQ	0x3EDA
    03ED1 3064      CPI	R22,4
    03ED2 E0E0      LDI	R30,0
    03ED3 077E      CPC	R23,R30
    03ED4 F039      BEQ	0x3EDC
    03ED5 C007      RJMP	0x3EDD
(0062) { 
(0063) case 1: 
(0064) {a=0x80;break;} 
    03ED6 E840      LDI	R20,0x80
    03ED7 C005      RJMP	0x3EDD
(0065) case 2: 
(0066) {a=0x90;break;} 
    03ED8 E940      LDI	R20,0x90
    03ED9 C003      RJMP	0x3EDD
(0067)   case 3: 
(0068) {a=0x88;break;} 
    03EDA E848      LDI	R20,0x88
    03EDB C001      RJMP	0x3EDD
(0069)   case 4: 
(0070) {a=0x98;break;} 
    03EDC E948      LDI	R20,0x98
(0071) } 
(0072) a=a+y-1;
    03EDD 0F42      ADD	R20,R18
    03EDE 5041      SUBI	R20,1
(0073) 
(0074) return a;
    03EDF 2F04      MOV	R16,R20
    03EE0 940C 4B21 JMP	pop_xgsetF000
_LCD_const_disp:
  a                    --> R12
  i                    --> R20
  single_data          --> R10
  y                    --> R14
  x                    --> R12
    03EE2 940E 4B09 CALL	push_xgset30FC
    03EE4 2EE2      MOV	R14,R18
    03EE5 2EC0      MOV	R12,R16
    03EE6 9721      SBIW	R28,1
    03EE7 84A9      LDD	R10,Y+9
    03EE8 84BA      LDD	R11,Y+10
(0075) }
(0076)  
(0077) //////////////////////////////////////////////////////////////
(0078) 
(0079) /******************************************************************** 
(0080) 函数 名：LCD_const_disp
(0081) 入口参数：x y  *single_data
(0082) 出口参数：无 
(0083) 函数作用：负责 显示一串常量
(0084) 说        明： 
(0085) ********************************************************************/ 
(0086) void LCD_const_disp(unsigned char x, unsigned char y, const unsigned char *single_data) 
(0087) { 
(0088) unsigned char  a,i; 
(0089) a=address(x,y);
    03EE9 2D2E      MOV	R18,R14
    03EEA 2D0C      MOV	R16,R12
    03EEB DFD5      RCALL	_address
    03EEC 2EC0      MOV	R12,R16
(0090) W_1byte(0,0,a);     //显示的地址 
    03EED 82C8      ST	Y,R12
    03EEE 2722      CLR	R18
    03EEF 2700      CLR	R16
    03EF0 D0B7      RCALL	_W_1byte
(0091)    for(i=0; single_data[i]!='\0';i++) 
    03EF1 2744      CLR	R20
    03EF2 C00D      RJMP	0x3F00
(0092)    {
(0093)     if(i>=16) break; 
    03EF3 3140      CPI	R20,0x10
    03EF4 F008      BCS	0x3EF6
    03EF5 C011      RJMP	0x3F07
(0094)     W_1byte(0,1,single_data[i]); 
    03EF6 2FE4      MOV	R30,R20
    03EF7 27FF      CLR	R31
    03EF8 0DEA      ADD	R30,R10
    03EF9 1DFB      ADC	R31,R11
    03EFA 8020      LD	R2,Z
    03EFB 8228      ST	Y,R2
    03EFC E021      LDI	R18,1
    03EFD 2700      CLR	R16
    03EFE D0A9      RCALL	_W_1byte
    03EFF 9543      INC	R20
    03F00 2FE4      MOV	R30,R20
    03F01 27FF      CLR	R31
    03F02 0DEA      ADD	R30,R10
    03F03 1DFB      ADC	R31,R11
    03F04 8020      LD	R2,Z
    03F05 2022      TST	R2
    03F06 F761      BNE	0x3EF3
(0095)     
(0096)    } 
(0097)    W_1byte(0,0,0XFF); // 移走地址指针 防止下一输入内容的干扰
    03F07 EF8F      LDI	R24,0xFF
    03F08 8388      ST	Y,R24
    03F09 2722      CLR	R18
    03F0A 2700      CLR	R16
    03F0B D09C      RCALL	_W_1byte
    03F0C 9621      ADIW	R28,1
    03F0D 940C 4AF3 JMP	pop_xgset30FC
_LCD_var_disp:
  a                    --> R12
  i                    --> R20
  single_data          --> R10
  y                    --> R14
  x                    --> R12
    03F0F 940E 4B09 CALL	push_xgset30FC
    03F11 2EE2      MOV	R14,R18
    03F12 2EC0      MOV	R12,R16
    03F13 9721      SBIW	R28,1
    03F14 84A9      LDD	R10,Y+9
    03F15 84BA      LDD	R11,Y+10
(0098)  
(0099) } 
(0100) 
(0101) /******************************************************************** 
(0102) 函数 名：LCD_var_disp
(0103) 入口参数：single_row single_line  *single_data
(0104) 出口参数：无 
(0105) 函数作用：负责 显示一串变量
(0106) 说        明： 
(0107) ********************************************************************/ 
(0108) 
(0109) void LCD_var_disp(unsigned char x, unsigned char y, unsigned char *single_data) 
(0110) { 
(0111) unsigned char  a,i; 
(0112) 
(0113) #if _debug == 1 
(0114) 	PrintString_n(single_data);
(0115) #endif 
(0116) 
(0117) a=address( x,y);
    03F16 2D2E      MOV	R18,R14
    03F17 2D0C      MOV	R16,R12
    03F18 DFA8      RCALL	_address
    03F19 2EC0      MOV	R12,R16
(0118) W_1byte(0,0,a);     //显示的地址0x88 
    03F1A 82C8      ST	Y,R12
    03F1B 2722      CLR	R18
    03F1C 2700      CLR	R16
    03F1D D08A      RCALL	_W_1byte
(0119) 
(0120) for(i=0; single_data[i]!='\0';i++) 
    03F1E 2744      CLR	R20
    03F1F C00D      RJMP	0x3F2D
(0121)    { 
(0122)     if(i>=16) break;
    03F20 3140      CPI	R20,0x10
    03F21 F008      BCS	0x3F23
    03F22 C011      RJMP	0x3F34
(0123)     W_1byte(0,1,single_data[i]); 
    03F23 2FE4      MOV	R30,R20
    03F24 27FF      CLR	R31
    03F25 0DEA      ADD	R30,R10
    03F26 1DFB      ADC	R31,R11
    03F27 8020      LD	R2,Z
    03F28 8228      ST	Y,R2
    03F29 E021      LDI	R18,1
    03F2A 2700      CLR	R16
    03F2B D07C      RCALL	_W_1byte
    03F2C 9543      INC	R20
    03F2D 2FE4      MOV	R30,R20
    03F2E 27FF      CLR	R31
    03F2F 0DEA      ADD	R30,R10
    03F30 1DFB      ADC	R31,R11
    03F31 8020      LD	R2,Z
    03F32 2022      TST	R2
    03F33 F761      BNE	0x3F20
(0124) 	} 
(0125)   W_1byte(0,0,0XFF); // 移走地址指针 防止下一输入内容的干扰
    03F34 EF8F      LDI	R24,0xFF
    03F35 8388      ST	Y,R24
    03F36 2722      CLR	R18
    03F37 2700      CLR	R16
    03F38 D06F      RCALL	_W_1byte
    03F39 9621      ADIW	R28,1
    03F3A 940C 4AF3 JMP	pop_xgset30FC
_LCD_char_disp:
  a                    --> R12
  data                 --> R10
  y                    --> R14
  x                    --> R12
    03F3C 940E 4B0B CALL	push_xgset00FC
    03F3E 2EE2      MOV	R14,R18
    03F3F 2EC0      MOV	R12,R16
    03F40 9721      SBIW	R28,1
    03F41 80AF      LDD	R10,Y+7
(0126) } 
(0127) /******************************************************************** 
(0128) 函数 名：LCD_char_disp
(0129) 入口参数：single_row single_line  data
(0130) 出口参数：无 
(0131) 函数作用：负责 显示一个 变量
(0132) 说        明： 
(0133) ********************************************************************/ 
(0134) 
(0135) void LCD_char_disp(unsigned char x, unsigned char y, unsigned char data) 
(0136) { 
(0137) unsigned char a; 
(0138) a=address(x,y);
    03F42 2D2E      MOV	R18,R14
    03F43 2D0C      MOV	R16,R12
    03F44 DF7C      RCALL	_address
    03F45 2EC0      MOV	R12,R16
(0139) W_1byte(0,0,a);     //显示的地址 
    03F46 82C8      ST	Y,R12
    03F47 2722      CLR	R18
    03F48 2700      CLR	R16
    03F49 D05E      RCALL	_W_1byte
(0140) W_1byte(0,1,data);  //显示内容
    03F4A 82A8      ST	Y,R10
    03F4B E021      LDI	R18,1
    03F4C 2700      CLR	R16
    03F4D D05A      RCALL	_W_1byte
(0141)  
(0142)   W_1byte(0,0,0XFF); // 移走地址指针 防止下一输入内容的干扰
    03F4E EF8F      LDI	R24,0xFF
    03F4F 8388      ST	Y,R24
    03F50 2722      CLR	R18
    03F51 2700      CLR	R16
    03F52 D055      RCALL	_W_1byte
    03F53 9621      ADIW	R28,1
    03F54 940C 4AEC JMP	pop_xgset00FC
_LCD_Init:
  cmd                  --> R20
    03F56 934A      ST	-Y,R20
    03F57 9721      SBIW	R28,1
(0143) } 
(0144) 
(0145) /******************************************************************** 
(0146) 函数 名：LCD_Init
(0147) 入口参数：无
(0148) 出口参数：unsigned char  0/1
(0149) 函数作用：负责 清空液晶显示
(0150) 说        明： 
(0151) ********************************************************************/ 
(0152) void LCD_Init(void) 
(0153) { 
(0154)    unsigned char cmd; 
(0155)    cmd=0x30;      //功能设置 8 位数据，基本指令 
    03F58 E340      LDI	R20,0x30
(0156)   W_1byte(0,0,cmd); 
    03F59 8348      ST	Y,R20
    03F5A 2722      CLR	R18
    03F5B 2700      CLR	R16
    03F5C D04B      RCALL	_W_1byte
(0157)   delayms(2); 
    03F5D E002      LDI	R16,2
    03F5E E010      LDI	R17,0
    03F5F 940E 253A CALL	_delayms
(0158)   cmd=0x0C;      //显示状态 ON，游标OFF，反白OFF 
    03F61 E04C      LDI	R20,0xC
(0159)   W_1byte(0,0,cmd); //写指令 
    03F62 8348      ST	Y,R20
    03F63 2722      CLR	R18
    03F64 2700      CLR	R16
    03F65 D042      RCALL	_W_1byte
(0160)   delayms(2); 
    03F66 E002      LDI	R16,2
    03F67 E010      LDI	R17,0
    03F68 940E 253A CALL	_delayms
(0161)   cmd=0x01;      //清除显示 
    03F6A E041      LDI	R20,1
(0162)   W_1byte(0,0,cmd); //写指令 
    03F6B 8348      ST	Y,R20
    03F6C 2722      CLR	R18
    03F6D 2700      CLR	R16
    03F6E D039      RCALL	_W_1byte
(0163)   delayms(2); 
    03F6F E002      LDI	R16,2
    03F70 E010      LDI	R17,0
    03F71 940E 253A CALL	_delayms
(0164)   cmd=0x02;      //地址归位 
    03F73 E042      LDI	R20,2
(0165)   W_1byte(0,0,cmd); //写指令 
    03F74 8348      ST	Y,R20
    03F75 2722      CLR	R18
    03F76 2700      CLR	R16
    03F77 D030      RCALL	_W_1byte
(0166)   delayms(2); 
    03F78 E002      LDI	R16,2
    03F79 E010      LDI	R17,0
    03F7A 940E 253A CALL	_delayms
(0167)   cmd=0x80;      //设置DDRAM 地址 
    03F7C E840      LDI	R20,0x80
(0168)   W_1byte(0,0,cmd); //写指令 
    03F7D 8348      ST	Y,R20
    03F7E 2722      CLR	R18
    03F7F 2700      CLR	R16
    03F80 D027      RCALL	_W_1byte
(0169)   delayms(2);     //延时 
    03F81 E002      LDI	R16,2
    03F82 E010      LDI	R17,0
    03F83 940E 253A CALL	_delayms
    03F85 9621      ADIW	R28,1
    03F86 9149      LD	R20,Y+
    03F87 9508      RET
_LCD_CLR:
  cmd                  --> R20
    03F88 934A      ST	-Y,R20
    03F89 9721      SBIW	R28,1
(0170) } 
(0171) 
(0172) void LCD_CLR(void)
(0173) {
(0174) unsigned char cmd;
(0175)   cmd=0x01;      //清除显示 
    03F8A E041      LDI	R20,1
(0176)   W_1byte(0,0,cmd); //写指令 
    03F8B 8348      ST	Y,R20
    03F8C 2722      CLR	R18
    03F8D 2700      CLR	R16
    03F8E D019      RCALL	_W_1byte
(0177)   delayms(1); 
    03F8F E001      LDI	R16,1
    03F90 E010      LDI	R17,0
    03F91 940E 253A CALL	_delayms
(0178)   cmd=0x02;      //地址归位 
    03F93 E042      LDI	R20,2
(0179)   W_1byte(0,0,cmd); //写指令 
    03F94 8348      ST	Y,R20
    03F95 2722      CLR	R18
    03F96 2700      CLR	R16
    03F97 D010      RCALL	_W_1byte
(0180)   delayms(1); 
    03F98 E001      LDI	R16,1
    03F99 E010      LDI	R17,0
    03F9A 940E 253A CALL	_delayms
(0181)   cmd=0x80;      //设置DDRAM 地址 
    03F9C E840      LDI	R20,0x80
(0182)   W_1byte(0,0,cmd); //写指令 
    03F9D 8348      ST	Y,R20
    03F9E 2722      CLR	R18
    03F9F 2700      CLR	R16
    03FA0 D007      RCALL	_W_1byte
(0183)   delayms(1);     //延时
    03FA1 E001      LDI	R16,1
    03FA2 E010      LDI	R17,0
    03FA3 940E 253A CALL	_delayms
    03FA5 9621      ADIW	R28,1
    03FA6 9149      LD	R20,Y+
    03FA7 9508      RET
_W_1byte:
  H_data               --> R22
  S_ID                 --> R10
  L_data               --> R20
  W_data               --> R12
  RS                   --> R14
  RW                   --> R20
    03FA8 940E 4B07 CALL	push_xgsetF0FC
    03FAA 2EE2      MOV	R14,R18
    03FAB 2F40      MOV	R20,R16
    03FAC 84CA      LDD	R12,Y+10
(0184) 
(0185) }
(0186)  
(0187) /*******************************************************************
(0188) 函 数 名：W_1byte
(0189) 入口参数：RW、RS、W_data
(0190) 出口参数：无
(0191) 建立日期：2007年3月3日
(0192) 修改日期：
(0193) 函数作用：写一个字节的数据到12864液晶，包括指令和数据
(0194) 说    明：RW=1，从液晶读数据到MCU；RW=0，写一个数据到液晶；
(0195) 		 （一般RW都设为0，即只向液晶写数据，不读数据）
(0196)           RS=1，写入的是数据；RS=0，写入的是指令；
(0197) 		  一般模式：RW=0，RS=1;写数据
(0198) 		  			RW=0，RS=0;写指令
(0199) ********************************************************************/
(0200) void W_1byte(unsigned char RW, unsigned char RS, unsigned char W_data)
(0201) {
(0202) 	unsigned int H_data,L_data,S_ID = 0xf8;	 //11111RWRS0
    03FAD EF88      LDI	R24,0xF8
    03FAE E090      LDI	R25,0
    03FAF 015C      MOVW	R10,R24
(0203) 	if(RW == 0)
    03FB0 2344      TST	R20
    03FB1 F419      BNE	0x3FB5
(0204) 	{
(0205) 	 	S_ID &=~ 0x04;
    03FB2 7F8B      ANDI	R24,0xFB
    03FB3 015C      MOVW	R10,R24
(0206) 	}
    03FB4 C003      RJMP	0x3FB8
(0207) 	else					//if(RW==1)
(0208) 	{
(0209) 	 	S_ID |= 0X04;
    03FB5 01C5      MOVW	R24,R10
    03FB6 6084      ORI	R24,4
    03FB7 015C      MOVW	R10,R24
(0210) 	}
(0211) 	if(RS == 0)
    03FB8 20EE      TST	R14
    03FB9 F421      BNE	0x3FBE
(0212) 	{
(0213) 	 	S_ID &=~ 0x02;
    03FBA 01C5      MOVW	R24,R10
    03FBB 7F8D      ANDI	R24,0xFD
    03FBC 015C      MOVW	R10,R24
(0214) 	}
    03FBD C003      RJMP	0x3FC1
(0215) 	else					//if(RS==1)
(0216) 	{
(0217) 	 	S_ID |= 0X02;
    03FBE 01C5      MOVW	R24,R10
    03FBF 6082      ORI	R24,2
    03FC0 015C      MOVW	R10,R24
(0218) 	}
(0219) 	H_data = W_data;
    03FC1 2D6C      MOV	R22,R12
    03FC2 2777      CLR	R23
(0220) 	H_data &= 0xf0;			//屏蔽低4位的数据
    03FC3 7F60      ANDI	R22,0xF0
    03FC4 7070      ANDI	R23,0
(0221) 	L_data = W_data;	   	//xxxx0000格式
    03FC5 2D4C      MOV	R20,R12
    03FC6 2755      CLR	R21
(0222) 	L_data &= 0x0f;			//屏蔽高4位的数据
    03FC7 704F      ANDI	R20,0xF
    03FC8 7050      ANDI	R21,0
(0223) 	L_data <<= 4;			//xxxx0000格式
    03FC9 0F44      LSL	R20
    03FCA 1F55      ROL	R21
    03FCB 0F44      LSL	R20
    03FCC 1F55      ROL	R21
    03FCD 0F44      LSL	R20
    03FCE 1F55      ROL	R21
    03FCF 0F44      LSL	R20
    03FD0 1F55      ROL	R21
(0224) 	Set_CS();
    03FD1 9AA4      SBI	0x14,4
    03FD2 9AAC      SBI	0x15,4
(0225) 	Write_8bits(S_ID); 		//发送S_ID
    03FD3 0185      MOVW	R16,R10
    03FD4 D00C      RCALL	_Write_8bits
(0226) 	Write_8bits(H_data);	//发送H_data
    03FD5 018B      MOVW	R16,R22
    03FD6 D00A      RCALL	_Write_8bits
(0227) 	Write_8bits(L_data);	//发送L_data
    03FD7 018A      MOVW	R16,R20
    03FD8 D008      RCALL	_Write_8bits
(0228) 	Clr_CS();	Clr_CS();	Clr_CS();	
    03FD9 9AA4      SBI	0x14,4
    03FDA 98AC      CBI	0x15,4
    03FDB 9AA4      SBI	0x14,4
    03FDC 98AC      CBI	0x15,4
    03FDD 9AA4      SBI	0x14,4
    03FDE 98AC      CBI	0x15,4
    03FDF 940C 4AFC JMP	pop_xgsetF0FC
_Write_8bits:
  Temp_data            --> R12
  i                    --> R20
  W_bits               --> R10
    03FE1 940E 4B34 CALL	push_xgset303C
    03FE3 0158      MOVW	R10,R16
(0229) 	 
(0230) 
(0231) }
(0232) /********************************************************************
(0233) 函 数 名：Write_8bits
(0234) 入口参数：W_bits
(0235) 出口参数：无
(0236) 建立日期：2007年3月3日
(0237) 修改日期：
(0238) 函数作用：负责串行输出8个bit位
(0239) 说    明：
(0240) ********************************************************************/
(0241) void Write_8bits(unsigned int W_bits)
(0242) {
(0243) 	unsigned int i,Temp_data;
(0244) 	for(i=0; i<8; i++)
    03FE4 2744      CLR	R20
    03FE5 2755      CLR	R21
    03FE6 C019      RJMP	0x4000
(0245) 	{
(0246) 		Temp_data = W_bits;
    03FE7 0165      MOVW	R12,R10
(0247) 		Temp_data <<= i;
    03FE8 019A      MOVW	R18,R20
    03FE9 0186      MOVW	R16,R12
    03FEA 940E 4B8B CALL	lsl16
    03FEC 0168      MOVW	R12,R16
(0248) 		if((Temp_data&0x80)==0) 
    03FED FD07      SBRC	R16,7
    03FEE C003      RJMP	0x3FF2
(0249) 		{
(0250) 		 	Clr_SID();
    03FEF 9AA3      SBI	0x14,3
    03FF0 98AB      CBI	0x15,3
(0251) 		}
    03FF1 C002      RJMP	0x3FF4
(0252) 		else
(0253) 		{
(0254) 		 	Set_SID();
    03FF2 9AA3      SBI	0x14,3
    03FF3 9AAB      SBI	0x15,3
(0255) 		} 
(0256) 		NOP();
    03FF4 0000      NOP
(0257) 		Set_SCLK();
    03FF5 9AA2      SBI	0x14,2
    03FF6 9AAA      SBI	0x15,2
(0258) 		NOP();
    03FF7 0000      NOP
(0259) 		NOP();
    03FF8 0000      NOP
(0260) 		Clr_SCLK();
    03FF9 9AA2      SBI	0x14,2
    03FFA 98AA      CBI	0x15,2
(0261) 		NOP();
    03FFB 0000      NOP
(0262) 		Clr_SID();
    03FFC 9AA3      SBI	0x14,3
    03FFD 98AB      CBI	0x15,3
    03FFE 5F4F      SUBI	R20,0xFF
    03FFF 4F5F      SBCI	R21,0xFF
    04000 3048      CPI	R20,0x8
    04001 E0E0      LDI	R30,0
    04002 075E      CPC	R21,R30
    04003 F318      BCS	0x3FE7
    04004 940C 4B3B JMP	pop_xgset303C
_Set_Draw:
    04006 9721      SBIW	R28,1
(0263) 	}
(0264) }
(0265)  
(0266) /********************************************************************
(0267) 函 数 名：Set_Draw(
(0268) 入口参数：无
(0269) 出口参数：无
(0270) 函数作用：设置为绘图模式
(0271) 说    明：
(0272) ********************************************************************/
(0273) void Set_Draw(void)
(0274) {  	
(0275) 	//W_1byte(0,0,0x34);			//8BIT控制界面，扩充指令集,，绘图显示OFF
(0276) 	W_1byte(0,0,0x36);
    04007 E386      LDI	R24,0x36
    04008 8388      ST	Y,R24
    04009 2722      CLR	R18
    0400A 2700      CLR	R16
    0400B DF9C      RCALL	_W_1byte
(0277) 	delayms(1);					//延时
    0400C E001      LDI	R16,1
    0400D E010      LDI	R17,0
    0400E 940E 253A CALL	_delayms
    04010 9621      ADIW	R28,1
    04011 9508      RET
_Set_White:
  clr_y                --> R10
  clr_x                --> R20
  white_y              --> Y,+2
  white_x              --> Y,+1
  i                    --> R22
  white_end_x          --> R12
  j                    --> R14
  clear                --> Y,+15
  end_x                --> R12
  y                    --> R14
  x                    --> R22
    04012 940E 4B07 CALL	push_xgsetF0FC
    04014 2EE2      MOV	R14,R18
    04015 2F60      MOV	R22,R16
    04016 9723      SBIW	R28,3
    04017 84CD      LDD	R12,Y+13
(0278) } 
(0279)  
(0280) 
(0281) /******************************************************************** 
(0282) 函数 名：Set_White 
(0283) 入口参数：  x,   y,  end_x,  clear
(0284) 出口参数：无 
(0285) 函数作用： 设置反显
(0286) 说        明： 
(0287) ********************************************************************/ 
(0288) void Set_White(unsigned char x,unsigned char y,unsigned char end_x,unsigned char clear)
(0289) {
(0290)  
(0291) 	unsigned char i, j, white_x, white_y,white_end_x,clr_x,clr_y ;		//
(0292)   
(0293) 	W_1byte(0,0,0x36);	  //8BIT控制界面，扩充指令集,，绘图显示ON
    04018 E386      LDI	R24,0x36
    04019 8388      ST	Y,R24
    0401A 2722      CLR	R18
    0401B 2700      CLR	R16
    0401C DF8B      RCALL	_W_1byte
(0294) 	delayus(20);					//延时
    0401D E104      LDI	R16,0x14
    0401E E010      LDI	R17,0
    0401F 940E 2532 CALL	_delayus
(0295)  
(0296) 	white_end_x = (end_x-x+1);
    04021 2D8C      MOV	R24,R12
    04022 1B86      SUB	R24,R22
    04023 5F8F      SUBI	R24,0xFF
    04024 2EC8      MOV	R12,R24
(0297) 	white_end_x <<= 1;
    04025 0CCC      LSL	R12
(0298) 	if(y==1)   //x,1  a=80+x-1                   
    04026 2D8E      MOV	R24,R14
    04027 3081      CPI	R24,1
    04028 F449      BNE	0x4032
(0299) 	{
(0300) 	 	white_x = (0x80+x-1); 
    04029 2F86      MOV	R24,R22
    0402A 5880      SUBI	R24,0x80
    0402B 5081      SUBI	R24,1
    0402C 8389      STD	Y+1,R24
(0301) 		white_y = 0x80;
    0402D E880      LDI	R24,0x80
    0402E 838A      STD	Y+2,R24
(0302) 		clr_x = 0x80;
    0402F E840      LDI	R20,0x80
(0303) 		clr_y = 0x80;
    04030 2EA8      MOV	R10,R24
(0304) 	}
    04031 C023      RJMP	0x4055
(0305) 	else if(y==2)
    04032 2D8E      MOV	R24,R14
    04033 3082      CPI	R24,2
    04034 F449      BNE	0x403E
(0306) 	{
(0307) 	 	white_x = (0x80+x-1);
    04035 2F86      MOV	R24,R22
    04036 5880      SUBI	R24,0x80
    04037 5081      SUBI	R24,1
    04038 8389      STD	Y+1,R24
(0308) 		white_y = 0x90;
    04039 E980      LDI	R24,0x90
    0403A 838A      STD	Y+2,R24
(0309) 		clr_x = 0x80;
    0403B E840      LDI	R20,0x80
(0310) 		clr_y = 0x90;
    0403C 2EA8      MOV	R10,R24
(0311) 	}
    0403D C017      RJMP	0x4055
(0312) 	else if(y==3)
    0403E 2D8E      MOV	R24,R14
    0403F 3083      CPI	R24,3
    04040 F449      BNE	0x404A
(0313) 	{
(0314) 	 	white_x = (0x88+x-1);
    04041 2F86      MOV	R24,R22
    04042 5788      SUBI	R24,0x78
    04043 5081      SUBI	R24,1
    04044 8389      STD	Y+1,R24
(0315) 		white_y = 0x80;
    04045 E880      LDI	R24,0x80
    04046 838A      STD	Y+2,R24
(0316) 		clr_x = 0x88;
    04047 E848      LDI	R20,0x88
(0317) 		clr_y = 0x80;
    04048 2EA8      MOV	R10,R24
(0318) 	}
    04049 C00B      RJMP	0x4055
(0319) 	else if(y==4)
    0404A 2D8E      MOV	R24,R14
    0404B 3084      CPI	R24,4
    0404C F441      BNE	0x4055
(0320) 	{
(0321) 	 	white_x = (0x88+x-1);
    0404D 2F86      MOV	R24,R22
    0404E 5788      SUBI	R24,0x78
    0404F 5081      SUBI	R24,1
    04050 8389      STD	Y+1,R24
(0322) 		white_y = 0x90;
    04051 E980      LDI	R24,0x90
    04052 838A      STD	Y+2,R24
(0323) 		clr_x = 0x88;
    04053 E848      LDI	R20,0x88
(0324) 		clr_y = 0x90;
    04054 2EA8      MOV	R10,R24
(0325) 	}
(0326)   if(clear==0)//要反白时，先将整行的液晶全部清成不反白（此处行指y）
    04055 840F      LDD	R0,Y+15
    04056 2000      TST	R0
    04057 F4E9      BNE	0x4075
(0327) 	{
(0328) 	 	for(i=0;i<16;i++ )			//16行
    04058 2766      CLR	R22
    04059 C019      RJMP	0x4073
(0329) 		{
(0330) 		 	W_1byte(0,0,clr_y++);	//设置绘图区的Y地址坐标0
    0405A 2C2A      MOV	R2,R10
    0405B 2D82      MOV	R24,R2
    0405C 5F8F      SUBI	R24,0xFF
    0405D 2EA8      MOV	R10,R24
    0405E 8228      ST	Y,R2
    0405F 2722      CLR	R18
    04060 2700      CLR	R16
    04061 DF46      RCALL	_W_1byte
(0331) 			W_1byte(0,0,clr_x);		//设置绘图区的X地址坐标0
    04062 8348      ST	Y,R20
    04063 2722      CLR	R18
    04064 2700      CLR	R16
    04065 DF42      RCALL	_W_1byte
(0332) 			for(j=0;j<16;j++)		//
    04066 24EE      CLR	R14
    04067 C007      RJMP	0x406F
(0333) 			{
(0334) 			 	W_1byte(0,1,0x00);	//清成不反白
    04068 2422      CLR	R2
    04069 8228      ST	Y,R2
    0406A E021      LDI	R18,1
    0406B 2700      CLR	R16
    0406C DF3B      RCALL	_W_1byte
(0335) 			 	nop();
    0406D 0000      NOP
    0406E 94E3      INC	R14
    0406F 2D8E      MOV	R24,R14
    04070 3180      CPI	R24,0x10
    04071 F3B0      BCS	0x4068
    04072 9563      INC	R22
    04073 3160      CPI	R22,0x10
    04074 F328      BCS	0x405A
(0336) 			}
(0337) 		}
(0338) 	}
(0339) 	nop();
    04075 0000      NOP
(0340) //	
(0341) 	for(i=0;i<16;i++ )				//16行，因为是16*16汉字
    04076 2766      CLR	R22
    04077 C022      RJMP	0x409A
(0342) 	{
(0343) 		W_1byte(0,0,white_y++);		//设置绘图区的Y地址坐标0
    04078 802A      LDD	R2,Y+2
    04079 2D82      MOV	R24,R2
    0407A 5F8F      SUBI	R24,0xFF
    0407B 838A      STD	Y+2,R24
    0407C 8228      ST	Y,R2
    0407D 2722      CLR	R18
    0407E 2700      CLR	R16
    0407F DF28      RCALL	_W_1byte
(0344) 		W_1byte(0,0,white_x);		//设置绘图区的X地址坐标0
    04080 8009      LDD	R0,Y+1
    04081 8208      ST	Y,R0
    04082 2722      CLR	R18
    04083 2700      CLR	R16
    04084 DF23      RCALL	_W_1byte
(0345) 		for(j=0;j<white_end_x;j++)	//
    04085 24EE      CLR	R14
    04086 C010      RJMP	0x4097
(0346) 		{
(0347) 			 if(clear==1)
    04087 858F      LDD	R24,Y+15
    04088 3081      CPI	R24,1
    04089 F431      BNE	0x4090
(0348) 			 {
(0349) 			  	W_1byte(0,1,0x00); //取消这一行的8个点的反白，液晶地址自动加1
    0408A 2422      CLR	R2
    0408B 8228      ST	Y,R2
    0408C E021      LDI	R18,1
    0408D 2700      CLR	R16
    0408E DF19      RCALL	_W_1byte
(0350) 								   //（此处行指一个一个液晶点所组成的行）
(0351) 			 }
    0408F C005      RJMP	0x4095
(0352) 			 else
(0353) 			 {
(0354) 				W_1byte(0,1,0xff); //反白这一行的8个点，液晶地址自动加1
    04090 EF8F      LDI	R24,0xFF
    04091 8388      ST	Y,R24
    04092 E021      LDI	R18,1
    04093 2700      CLR	R16
    04094 DF13      RCALL	_W_1byte
(0355) 								   //（此处行指一个一个液晶点所组成的行）
(0356) 			 }
(0357) 			nop();
    04095 0000      NOP
    04096 94E3      INC	R14
    04097 14EC      CP	R14,R12
    04098 F370      BCS	0x4087
    04099 9563      INC	R22
    0409A 3160      CPI	R22,0x10
    0409B F2E0      BCS	0x4078
(0358) 		}
(0359) 	}
(0360) 	W_1byte(0,0,0x30);		//基本指令集,，绘图显示OFF
    0409C E380      LDI	R24,0x30
    0409D 8388      ST	Y,R24
    0409E 2722      CLR	R18
    0409F 2700      CLR	R16
    040A0 DF07      RCALL	_W_1byte
    040A1 9623      ADIW	R28,3
    040A2 940C 4AFC JMP	pop_xgsetF0FC
_set_white_n:
  tempendx             --> R10
  tempy                --> R22
  tempx                --> R20
  clear                --> R12
  n                    --> R14
    040A4 940E 4B07 CALL	push_xgsetF0FC
    040A6 2EC2      MOV	R12,R18
    040A7 2EE0      MOV	R14,R16
    040A8 9723      SBIW	R28,3
(0361)  }
(0362) 
(0363) /******************************************************************** 
(0364) 函数 名：set_white_n
(0365) 入口参数： n ,  clear
(0366) 出口参数：无 
(0367) 函数作用：   将四行分成八个位置。n代表位置1-8。本函数用于反显或取消反显
(0368)           某一位置的文字。
(0369) 说        明： 例如 set_white_n(1,0); 表示反显第一行前四个字
(0370) ********************************************************************/ 
(0371) void set_white_n(unsigned char n,unsigned char clear)
(0372) {
(0373) unsigned char tempx,tempy,tempendx;
(0374) if(n==1) {tempx=1;tempy=1;tempendx=4;}
    040A9 2D8E      MOV	R24,R14
    040AA 3081      CPI	R24,1
    040AB F429      BNE	0x40B1
    040AC E041      LDI	R20,1
    040AD E061      LDI	R22,1
    040AE E084      LDI	R24,4
    040AF 2EA8      MOV	R10,R24
    040B0 C037      RJMP	0x40E8
(0375) else if(n==2) {tempx=5;tempy=1;tempendx=8;}
    040B1 2D8E      MOV	R24,R14
    040B2 3082      CPI	R24,2
    040B3 F429      BNE	0x40B9
    040B4 E045      LDI	R20,5
    040B5 E061      LDI	R22,1
    040B6 E088      LDI	R24,0x8
    040B7 2EA8      MOV	R10,R24
    040B8 C02F      RJMP	0x40E8
(0376) else if(n==3) {tempx=1;tempy=2;tempendx=4;}
    040B9 2D8E      MOV	R24,R14
    040BA 3083      CPI	R24,3
    040BB F429      BNE	0x40C1
    040BC E041      LDI	R20,1
    040BD E062      LDI	R22,2
    040BE E084      LDI	R24,4
    040BF 2EA8      MOV	R10,R24
    040C0 C027      RJMP	0x40E8
(0377) else if(n==4) {tempx=5;tempy=2;tempendx=8;}
    040C1 2D8E      MOV	R24,R14
    040C2 3084      CPI	R24,4
    040C3 F429      BNE	0x40C9
    040C4 E045      LDI	R20,5
    040C5 E062      LDI	R22,2
    040C6 E088      LDI	R24,0x8
    040C7 2EA8      MOV	R10,R24
    040C8 C01F      RJMP	0x40E8
(0378) else if(n==5) {tempx=1;tempy=3;tempendx=4;}
    040C9 2D8E      MOV	R24,R14
    040CA 3085      CPI	R24,5
    040CB F429      BNE	0x40D1
    040CC E041      LDI	R20,1
    040CD E063      LDI	R22,3
    040CE E084      LDI	R24,4
    040CF 2EA8      MOV	R10,R24
    040D0 C017      RJMP	0x40E8
(0379) else if(n==6) {tempx=5;tempy=3;tempendx=8;}
    040D1 2D8E      MOV	R24,R14
    040D2 3086      CPI	R24,6
    040D3 F429      BNE	0x40D9
    040D4 E045      LDI	R20,5
    040D5 E063      LDI	R22,3
    040D6 E088      LDI	R24,0x8
    040D7 2EA8      MOV	R10,R24
    040D8 C00F      RJMP	0x40E8
(0380) else if(n==7) {tempx=1;tempy=4;tempendx=4;}
    040D9 2D8E      MOV	R24,R14
    040DA 3087      CPI	R24,7
    040DB F429      BNE	0x40E1
    040DC E041      LDI	R20,1
    040DD E064      LDI	R22,4
    040DE E084      LDI	R24,4
    040DF 2EA8      MOV	R10,R24
    040E0 C007      RJMP	0x40E8
(0381) else if(n==8) {tempx=5;tempy=4;tempendx=8;}
    040E1 2D8E      MOV	R24,R14
    040E2 3088      CPI	R24,0x8
    040E3 F421      BNE	0x40E8
    040E4 E045      LDI	R20,5
    040E5 E064      LDI	R22,4
    040E6 E088      LDI	R24,0x8
    040E7 2EA8      MOV	R10,R24
(0382) Set_White(tempx,tempy,tempendx,clear);
    040E8 82CA      STD	Y+2,R12
    040E9 82A8      ST	Y,R10
    040EA 2F26      MOV	R18,R22
    040EB 2F04      MOV	R16,R20
    040EC DF25      RCALL	_Set_White
    040ED 9623      ADIW	R28,3
    040EE 940C 4AFC JMP	pop_xgsetF0FC
_clr_white:
  clr_x                --> R10
  clr_y                --> R20
  i                    --> R22
  j                    --> R12
    040F0 940E 4B07 CALL	push_xgsetF0FC
    040F2 9721      SBIW	R28,1
(0383) 
(0384) }
(0385)  
(0386) /******************************************************************** 
(0387) 函数 名：clr_white
(0388) 入口参数： 清所有 反白
(0389) 出口参数：无 
(0390) 函数作用： 
(0391) 说        明： 
(0392) ********************************************************************/ 
(0393) void clr_white(void)
(0394) {      unsigned char i,j;
(0395) 
(0396)        unsigned char  clr_y=0x80;
    040F3 E840      LDI	R20,0x80
(0397) 	   unsigned char  clr_x=0x80;
    040F4 E880      LDI	R24,0x80
    040F5 2EA8      MOV	R10,R24
(0398) 	   W_1byte(0,0,0x36);	  //8BIT控制界面，扩充指令集,，绘图显示ON
    040F6 E386      LDI	R24,0x36
    040F7 8388      ST	Y,R24
    040F8 2722      CLR	R18
    040F9 2700      CLR	R16
    040FA DEAD      RCALL	_W_1byte
(0399) 	 	for(i=0;i<16;i++ )			//16行
    040FB 2766      CLR	R22
    040FC C017      RJMP	0x4114
(0400) 		{
(0401) 		 	W_1byte(0,0,clr_y++);	//设置绘图区的Y地址坐标0
    040FD 2E24      MOV	R2,R20
    040FE 5F4F      SUBI	R20,0xFF
    040FF 8228      ST	Y,R2
    04100 2722      CLR	R18
    04101 2700      CLR	R16
    04102 DEA5      RCALL	_W_1byte
(0402) 			W_1byte(0,0,clr_x);		//设置绘图区的X地址坐标0
    04103 82A8      ST	Y,R10
    04104 2722      CLR	R18
    04105 2700      CLR	R16
    04106 DEA1      RCALL	_W_1byte
(0403) 			for(j=0;j<16;j++)		//
    04107 24CC      CLR	R12
    04108 C007      RJMP	0x4110
(0404) 			{
(0405) 			 	W_1byte(0,1,0x00);	//清成不反白
    04109 2422      CLR	R2
    0410A 8228      ST	Y,R2
    0410B E021      LDI	R18,1
    0410C 2700      CLR	R16
    0410D DE9A      RCALL	_W_1byte
(0406) 			 	nop();
    0410E 0000      NOP
    0410F 94C3      INC	R12
    04110 2D8C      MOV	R24,R12
    04111 3180      CPI	R24,0x10
    04112 F3B0      BCS	0x4109
    04113 9563      INC	R22
    04114 3160      CPI	R22,0x10
    04115 F338      BCS	0x40FD
(0407) 			}
(0408) 		}
(0409) 	
(0410) 	    clr_y=0x80;
    04116 E840      LDI	R20,0x80
(0411) 	    clr_x=0x90;
    04117 E980      LDI	R24,0x90
    04118 2EA8      MOV	R10,R24
(0412) 		 	for(i=0;i<16;i++ )			//16行
    04119 2766      CLR	R22
    0411A C017      RJMP	0x4132
(0413) 		{
(0414) 		 	W_1byte(0,0,clr_y++);	//设置绘图区的Y地址坐标0
    0411B 2E24      MOV	R2,R20
    0411C 5F4F      SUBI	R20,0xFF
    0411D 8228      ST	Y,R2
    0411E 2722      CLR	R18
    0411F 2700      CLR	R16
    04120 DE87      RCALL	_W_1byte
(0415) 			W_1byte(0,0,clr_x);		//设置绘图区的X地址坐标0
    04121 82A8      ST	Y,R10
    04122 2722      CLR	R18
    04123 2700      CLR	R16
    04124 DE83      RCALL	_W_1byte
(0416) 			for(j=0;j<16;j++)		//
    04125 24CC      CLR	R12
    04126 C007      RJMP	0x412E
(0417) 			{
(0418) 			 	W_1byte(0,1,0x00);	//清成不反白
    04127 2422      CLR	R2
    04128 8228      ST	Y,R2
    04129 E021      LDI	R18,1
    0412A 2700      CLR	R16
    0412B DE7C      RCALL	_W_1byte
(0419) 			 	nop();
    0412C 0000      NOP
    0412D 94C3      INC	R12
    0412E 2D8C      MOV	R24,R12
    0412F 3180      CPI	R24,0x10
    04130 F3B0      BCS	0x4127
    04131 9563      INC	R22
    04132 3160      CPI	R22,0x10
    04133 F338      BCS	0x411B
(0420) 			}
(0421) 		}   
(0422) 	   
(0423) 	     clr_y=0x88;
    04134 E848      LDI	R20,0x88
(0424) 	     clr_x=0x80;
    04135 E880      LDI	R24,0x80
    04136 2EA8      MOV	R10,R24
(0425) 		 	for(i=0;i<16;i++ )			//16行
    04137 2766      CLR	R22
    04138 C017      RJMP	0x4150
(0426) 		{
(0427) 		 	W_1byte(0,0,clr_y++);	//设置绘图区的Y地址坐标0
    04139 2EE4      MOV	R14,R20
    0413A 5F4F      SUBI	R20,0xFF
    0413B 82E8      ST	Y,R14
    0413C 2722      CLR	R18
    0413D 2700      CLR	R16
    0413E DE69      RCALL	_W_1byte
(0428) 			W_1byte(0,0,clr_x);		//设置绘图区的X地址坐标0
    0413F 82A8      ST	Y,R10
    04140 2722      CLR	R18
    04141 2700      CLR	R16
    04142 DE65      RCALL	_W_1byte
(0429) 			for(j=0;j<16;j++)		//
    04143 24CC      CLR	R12
    04144 C007      RJMP	0x414C
(0430) 			{
(0431) 			 	W_1byte(0,1,0x00);	//清成不反白
    04145 2422      CLR	R2
    04146 8228      ST	Y,R2
    04147 E021      LDI	R18,1
    04148 2700      CLR	R16
    04149 DE5E      RCALL	_W_1byte
(0432) 			 	nop();
    0414A 0000      NOP
    0414B 94C3      INC	R12
    0414C 2D8C      MOV	R24,R12
    0414D 3180      CPI	R24,0x10
    0414E F3B0      BCS	0x4145
    0414F 9563      INC	R22
    04150 3160      CPI	R22,0x10
    04151 F338      BCS	0x4139
(0433) 			}
(0434) 		} 
(0435) 	     clr_y=0x88;
    04152 E848      LDI	R20,0x88
(0436) 	     clr_x=0x90;
    04153 E980      LDI	R24,0x90
    04154 2EA8      MOV	R10,R24
(0437) 		 	for(i=0;i<16;i++ )			//16行
    04155 2766      CLR	R22
    04156 C017      RJMP	0x416E
(0438) 		{
(0439) 		 	W_1byte(0,0,clr_y++);	//设置绘图区的Y地址坐标0
    04157 2EE4      MOV	R14,R20
    04158 5F4F      SUBI	R20,0xFF
    04159 82E8      ST	Y,R14
    0415A 2722      CLR	R18
    0415B 2700      CLR	R16
    0415C DE4B      RCALL	_W_1byte
(0440) 			W_1byte(0,0,clr_x);		//设置绘图区的X地址坐标0
    0415D 82A8      ST	Y,R10
    0415E 2722      CLR	R18
    0415F 2700      CLR	R16
    04160 DE47      RCALL	_W_1byte
(0441) 			for(j=0;j<16;j++)		//
    04161 24CC      CLR	R12
    04162 C007      RJMP	0x416A
(0442) 			{
(0443) 			 	W_1byte(0,1,0x00);	//清成不反白
    04163 2422      CLR	R2
    04164 8228      ST	Y,R2
    04165 E021      LDI	R18,1
    04166 2700      CLR	R16
    04167 DE40      RCALL	_W_1byte
(0444) 			 	nop();
    04168 0000      NOP
    04169 94C3      INC	R12
    0416A 2D8C      MOV	R24,R12
    0416B 3180      CPI	R24,0x10
    0416C F3B0      BCS	0x4163
    0416D 9563      INC	R22
    0416E 3160      CPI	R22,0x10
    0416F F338      BCS	0x4157
(0445) 			}
(0446) 		} 		
(0447)   W_1byte(0,0,0x30);	  //8BIT控制界面，扩充指令集,，绘图显示ON
    04170 E380      LDI	R24,0x30
    04171 8388      ST	Y,R24
    04172 2722      CLR	R18
    04173 2700      CLR	R16
    04174 DE33      RCALL	_W_1byte
    04175 9621      ADIW	R28,1
    04176 940C 4AFC JMP	pop_xgsetF0FC
_LCD_print2num:
  a                    --> R12
  tem                  --> R20
  num                  --> R10
  y                    --> R14
  x                    --> R12
    04178 940E 4B09 CALL	push_xgset30FC
    0417A 2EE2      MOV	R14,R18
    0417B 2EC0      MOV	R12,R16
    0417C 9721      SBIW	R28,1
    0417D 84A9      LDD	R10,Y+9
(0448) 	}
(0449) /******************************************************************** 
(0450) 函数 名：LCD_print2num
(0451) 入口参数： 显示2数字
(0452) 出口参数：无 
(0453) 函数作用： 
(0454) 说        明： 
(0455) ********************************************************************/ 
(0456) void LCD_print2num(unsigned char x,unsigned char y,unsigned char num){
(0457) unsigned char tem;
(0458) unsigned char a; 
(0459) 
(0460) a=address(x,y);
    0417E 2D2E      MOV	R18,R14
    0417F 2D0C      MOV	R16,R12
    04180 DD40      RCALL	_address
    04181 2EC0      MOV	R12,R16
(0461) W_1byte(0,0,a);     //显示的地址 
    04182 82C8      ST	Y,R12
    04183 2722      CLR	R18
    04184 2700      CLR	R16
    04185 DE22      RCALL	_W_1byte
(0462) tem=num/10;
    04186 E01A      LDI	R17,0xA
    04187 2D0A      MOV	R16,R10
    04188 940E 4A79 CALL	div8u
    0418A 2F40      MOV	R20,R16
(0463) W_1byte(0,1,tem+0x30);
    0418B 2F84      MOV	R24,R20
    0418C 5D80      SUBI	R24,0xD0
    0418D 8388      ST	Y,R24
    0418E E021      LDI	R18,1
    0418F 2700      CLR	R16
    04190 DE17      RCALL	_W_1byte
(0464) tem=num%10;
    04191 E01A      LDI	R17,0xA
    04192 2D0A      MOV	R16,R10
    04193 940E 4A77 CALL	mod8u
    04195 2F40      MOV	R20,R16
(0465) W_1byte(0,1,tem+0x30); 
    04196 2F84      MOV	R24,R20
    04197 5D80      SUBI	R24,0xD0
    04198 8388      ST	Y,R24
    04199 E021      LDI	R18,1
    0419A 2700      CLR	R16
    0419B DE0C      RCALL	_W_1byte
(0466) W_1byte(0,0,0XFF); // 移走地址指针 防止下一输入内容的干扰
    0419C EF8F      LDI	R24,0xFF
    0419D 8388      ST	Y,R24
    0419E 2722      CLR	R18
    0419F 2700      CLR	R16
    041A0 DE07      RCALL	_W_1byte
    041A1 9621      ADIW	R28,1
    041A2 940C 4AF3 JMP	pop_xgset30FC
_LCD_print4num:
  tem                  --> R12
  num                  --> R14
  y                    --> R20
  x                    --> R10
    041A4 940E 4B09 CALL	push_xgset30FC
    041A6 2F42      MOV	R20,R18
    041A7 2EA0      MOV	R10,R16
    041A8 9721      SBIW	R28,1
    041A9 84E9      LDD	R14,Y+9
    041AA 84FA      LDD	R15,Y+10
(0467) }
(0468)  
(0469) /******************************************************************** 
(0470) 函数 名：LCD_print4num
(0471) 入口参数： 显示4数字
(0472) 出口参数：无 
(0473) 函数作用： 
(0474) 说        明： 
(0475) ********************************************************************/ 
(0476) void LCD_print4num(unsigned char x,unsigned char y,unsigned int num){
(0477) unsigned char tem;
(0478) tem=num/100;
    041AB E624      LDI	R18,0x64
    041AC E030      LDI	R19,0
    041AD 0187      MOVW	R16,R14
    041AE 940E 49F3 CALL	div16u
    041B0 2EC0      MOV	R12,R16
(0479) LCD_print2num(x,y,tem);
    041B1 82C8      ST	Y,R12
    041B2 2F24      MOV	R18,R20
    041B3 2D0A      MOV	R16,R10
    041B4 DFC3      RCALL	_LCD_print2num
(0480) 
(0481) tem=num%100;   
    041B5 E624      LDI	R18,0x64
    041B6 E030      LDI	R19,0
    041B7 0187      MOVW	R16,R14
    041B8 940E 49F1 CALL	mod16u
    041BA 2EC0      MOV	R12,R16
(0482) LCD_print2num(x,y+1,tem);
    041BB 82C8      ST	Y,R12
    041BC 2F24      MOV	R18,R20
    041BD 5F2F      SUBI	R18,0xFF
    041BE 2D0A      MOV	R16,R10
    041BF DFB8      RCALL	_LCD_print2num
(0483) 
(0484) 
(0485)   W_1byte(0,0,0XFF); // 移走地址指针 防止下一输入内容的干扰
    041C0 EF8F      LDI	R24,0xFF
    041C1 8388      ST	Y,R24
    041C2 2722      CLR	R18
    041C3 2700      CLR	R16
    041C4 DDE3      RCALL	_W_1byte
    041C5 9621      ADIW	R28,1
    041C6 940C 4AF3 JMP	pop_xgset30FC
_LCD_print:
  a                    --> R12
  ch                   --> R10
  y                    --> R14
  x                    --> R12
    041C8 940E 4B0B CALL	push_xgset00FC
    041CA 2EE2      MOV	R14,R18
    041CB 2EC0      MOV	R12,R16
    041CC 9721      SBIW	R28,1
    041CD 80AF      LDD	R10,Y+7
(0486) }
(0487)  
(0488) //////////////////////////////////////////////////////////////
(0489) 
(0490) /******************************************************************** 
(0491) 函数 名：LCD_print 
(0492) 入口参数： 显示1 ascii
(0493) 出口参数：无 
(0494) 函数作用： 
(0495) 说        明： 
(0496) ********************************************************************/ 
(0497) void LCD_print(unsigned char x,unsigned char y,unsigned char ch)
(0498) {  
(0499) unsigned char a; 
(0500) a=address(x,y);
    041CE 2D2E      MOV	R18,R14
    041CF 2D0C      MOV	R16,R12
    041D0 DCF0      RCALL	_address
    041D1 2EC0      MOV	R12,R16
(0501) W_1byte(0,0,a);     //显示的地址 
    041D2 82C8      ST	Y,R12
    041D3 2722      CLR	R18
    041D4 2700      CLR	R16
    041D5 DDD2      RCALL	_W_1byte
(0502) W_1byte(0,1,ch); 
    041D6 82A8      ST	Y,R10
    041D7 E021      LDI	R18,1
    041D8 2700      CLR	R16
    041D9 DDCE      RCALL	_W_1byte
    041DA 9621      ADIW	R28,1
    041DB 940C 4AEC JMP	pop_xgset00FC
_LCD_print1:
  ch                   --> R10
    041DD 92AA      ST	-Y,R10
    041DE 2EA0      MOV	R10,R16
    041DF 9721      SBIW	R28,1
(0503) 
(0504) 
(0505) 
(0506) }
(0507) /******************************************************************** 
(0508) 函数 名：LCD_print1 
(0509) 入口参数： 显示1 ascii
(0510) 出口参数：无 
(0511) 函数作用：接着上文地址显示，不重设地址 
(0512) 说        明： 
(0513) ********************************************************************/ 
(0514) void LCD_print1(char ch)
(0515) {  
(0516) W_1byte(0,1,ch); 
    041E0 82A8      ST	Y,R10
    041E1 E021      LDI	R18,1
    041E2 2700      CLR	R16
    041E3 DDC4      RCALL	_W_1byte
    041E4 9621      ADIW	R28,1
    041E5 90A9      LD	R10,Y+
    041E6 9508      RET
_lp:
  p                    --> R10
    041E7 92AA      ST	-Y,R10
    041E8 92BA      ST	-Y,R11
    041E9 0158      MOVW	R10,R16
    041EA 9722      SBIW	R28,2
(0517) }
(0518) //////////////////////////////////////////////////////////////
(0519) 
(0520) 
(0521) 
(0522)  void lp(unsigned char *p)
(0523)  {
(0524)  static unsigned char *p1=" ",*p2=" ",*p3=" ",*p4=" ";
(0525)  p4=p3;
    041EB 9020 05C7 LDS	R2,lcd.c:p3
    041ED 9030 05C8 LDS	R3,lcd.c:p3+1
    041EF 9230 05CA STS	lcd.c:p4+1,R3
    041F1 9220 05C9 STS	lcd.c:p4,R2
(0526)  p3=p2;
    041F3 9020 05C5 LDS	R2,lcd.c:p2
    041F5 9030 05C6 LDS	R3,lcd.c:p2+1
    041F7 9230 05C8 STS	lcd.c:p3+1,R3
    041F9 9220 05C7 STS	lcd.c:p3,R2
(0527)  p2=p1;
    041FB 9020 05C3 LDS	R2,lcd.c:p1
    041FD 9030 05C4 LDS	R3,lcd.c:p1+1
    041FF 9230 05C6 STS	lcd.c:p2+1,R3
    04201 9220 05C5 STS	lcd.c:p2,R2
(0528)  p1=p;
    04203 92B0 05C4 STS	lcd.c:p1+1,R11
    04205 92A0 05C3 STS	lcd.c:p1,R10
(0529)   LCD_const_disp(1,1,"                ");
    04207 EC8B      LDI	R24,0xCB
    04208 E095      LDI	R25,5
    04209 8399      STD	Y+1,R25
    0420A 8388      ST	Y,R24
    0420B E021      LDI	R18,1
    0420C E001      LDI	R16,1
    0420D DCD4      RCALL	_LCD_const_disp
(0530)   LCD_const_disp(2,1,"                ");
    0420E EC8B      LDI	R24,0xCB
    0420F E095      LDI	R25,5
    04210 8399      STD	Y+1,R25
    04211 8388      ST	Y,R24
    04212 E021      LDI	R18,1
    04213 E002      LDI	R16,2
    04214 DCCD      RCALL	_LCD_const_disp
(0531)   LCD_const_disp(3,1,"                ");
    04215 EC8B      LDI	R24,0xCB
    04216 E095      LDI	R25,5
    04217 8399      STD	Y+1,R25
    04218 8388      ST	Y,R24
    04219 E021      LDI	R18,1
    0421A E003      LDI	R16,3
    0421B DCC6      RCALL	_LCD_const_disp
(0532)   LCD_const_disp(4,1,"                ");
    0421C EC8B      LDI	R24,0xCB
    0421D E095      LDI	R25,5
    0421E 8399      STD	Y+1,R25
    0421F 8388      ST	Y,R24
    04220 E021      LDI	R18,1
    04221 E004      LDI	R16,4
    04222 DCBF      RCALL	_LCD_const_disp
(0533)   LCD_var_disp(1,1,p4);
    04223 9020 05C9 LDS	R2,lcd.c:p4
    04225 9030 05CA LDS	R3,lcd.c:p4+1
    04227 8239      STD	Y+1,R3
    04228 8228      ST	Y,R2
    04229 E021      LDI	R18,1
    0422A E001      LDI	R16,1
    0422B DCE3      RCALL	_LCD_var_disp
(0534)   LCD_var_disp(2,1,p3);
    0422C 9020 05C7 LDS	R2,lcd.c:p3
    0422E 9030 05C8 LDS	R3,lcd.c:p3+1
    04230 8239      STD	Y+1,R3
    04231 8228      ST	Y,R2
    04232 E021      LDI	R18,1
    04233 E002      LDI	R16,2
    04234 DCDA      RCALL	_LCD_var_disp
(0535)   LCD_var_disp(3,1,p2);
    04235 9020 05C5 LDS	R2,lcd.c:p2
    04237 9030 05C6 LDS	R3,lcd.c:p2+1
    04239 8239      STD	Y+1,R3
    0423A 8228      ST	Y,R2
    0423B E021      LDI	R18,1
    0423C E003      LDI	R16,3
    0423D DCD1      RCALL	_LCD_var_disp
(0536)   LCD_var_disp(4,1,p1);
    0423E 9020 05C3 LDS	R2,lcd.c:p1
    04240 9030 05C4 LDS	R3,lcd.c:p1+1
    04242 8239      STD	Y+1,R3
    04243 8228      ST	Y,R2
    04244 E021      LDI	R18,1
    04245 E004      LDI	R16,4
    04246 DCC8      RCALL	_LCD_var_disp
(0537)   delayms(300);
    04247 E20C      LDI	R16,0x2C
    04248 E011      LDI	R17,1
    04249 940E 253A CALL	_delayms
    0424B 9622      ADIW	R28,2
    0424C 90B9      LD	R11,Y+
    0424D 90A9      LD	R10,Y+
    0424E 9508      RET
FILE: D:\LQD\software\software_src\relay.c
(0001) #include "config.h"
(0002) /*继电器初始化
(0003) *设置端口
(0004) *初始化关闭
(0005) */
(0006) void relay_init(void){
(0007) 	
(0008) 		RELAY_DDR_SET() ;
_relay_init:
    0424F 9AA5      SBI	0x14,5
(0009) 		RELAY_OFF();
    04250 98AD      CBI	0x15,5
    04251 9508      RET
(0010) 		//state.Relay = 0;
(0011) 	}	
(0012) 
(0013) /*继电器控制
(0014) *传入 ： 温度
(0015) *传出 ： 当前继电器状态
(0016) *
(0017) */
(0018) unsigned char  relay(int temp)
(0019) {
(0020) 	if(temp<config.heatThreshold)
_relay:
  temp                 --> R16
    04252 9020 08C3 LDS	R2,config+20
    04254 2433      CLR	R3
    04255 1502      CP	R16,R2
    04256 0513      CPC	R17,R3
    04257 F41C      BGE	0x425B
(0021) 	{
(0022) 	 		RELAY_DDR_SET();
    04258 9AA5      SBI	0x14,5
(0023) 			RELAY_ON();
    04259 9AAD      SBI	0x15,5
(0024) 			//state.Relay = 1 ;
(0025) 	}
    0425A C002      RJMP	0x425D
(0026) 	else
(0027) 	{
(0028) 	 	RELAY_DDR_SET();
    0425B 9AA5      SBI	0x14,5
(0029) 		RELAY_OFF();
    0425C 98AD      CBI	0x15,5
(0030) 		//state.Relay = 0 ;
(0031) 	}		
(0032) 	//return state.Relay;
(0033) 	return 0;
    0425D 2700      CLR	R16
    0425E 9508      RET
_beep:
  i                    --> R10
  short_beep           --> R12
  long_beep            --> R14
    0425F 940E 4B0B CALL	push_xgset00FC
    04261 2EC2      MOV	R12,R18
    04262 2EE0      MOV	R14,R16
FILE: D:\LQD\software\software_src\beep.c
(0001) #include "config.h"
(0002) 
(0003) #define BEEP_PORT	PORTC
(0004) #define BEEP_PIN	6
(0005) #define BEEP_OFF() BEEP_PORT|=(1<<BEEP_PIN)
(0006) #define BEEP_ON()  BEEP_PORT&=~(1<<BEEP_PIN)
(0007) //楦ｅ
(0008) void beep(unsigned char long_beep,unsigned char short_beep)
(0009) { 
(0010) unsigned char i;
(0011) DDRB|=(1<<0);
    04263 9AB8      SBI	0x17,0
(0012) for(i=0;i<long_beep;i++)
    04264 24AA      CLR	R10
    04265 C00B      RJMP	0x4271
(0013) {
(0014) BEEP_ON();  delayms(200);
    04266 98AE      CBI	0x15,6
    04267 EC08      LDI	R16,0xC8
    04268 E010      LDI	R17,0
    04269 940E 253A CALL	_delayms
(0015) BEEP_OFF(); delayms(50);
    0426B 9AAE      SBI	0x15,6
    0426C E302      LDI	R16,0x32
    0426D E010      LDI	R17,0
    0426E 940E 253A CALL	_delayms
    04270 94A3      INC	R10
    04271 14AE      CP	R10,R14
    04272 F398      BCS	0x4266
(0016) }
(0017) delayms(100);
    04273 E604      LDI	R16,0x64
    04274 E010      LDI	R17,0
    04275 940E 253A CALL	_delayms
(0018) for(i=0;i<short_beep;i++)
    04277 24AA      CLR	R10
    04278 C00B      RJMP	0x4284
(0019) {
(0020) BEEP_ON();  delayms(80);
    04279 98AE      CBI	0x15,6
    0427A E500      LDI	R16,0x50
    0427B E010      LDI	R17,0
    0427C 940E 253A CALL	_delayms
(0021) BEEP_OFF(); delayms(50);
    0427E 9AAE      SBI	0x15,6
    0427F E302      LDI	R16,0x32
    04280 E010      LDI	R17,0
    04281 940E 253A CALL	_delayms
    04283 94A3      INC	R10
    04284 14AC      CP	R10,R12
    04285 F398      BCS	0x4279
    04286 940C 4AEC JMP	pop_xgset00FC
_Delay_nus:
  i                    --> R20
  n                    --> R16
    04288 934A      ST	-Y,R20
    04289 935A      ST	-Y,R21
FILE: D:\LQD\software\software_src\DS18B20_driver.c
(0001) //------------------------------------------------------------------------------
(0002) // 文件名：DS18B20_driver.c
(0003) // 说明：  DS18B20驱动头文件
(0004) // 功能：  实现1-wire器件的读写
(0005) // 使用方法：   void Delay_nus(unsigned int n);             //延时n微秒函数
(0006) //              unsigned char reset_18B20(void);            //18B20复位
(0007) //              void write_bit_18B20(char bitval);          //写一位到18B20
(0008) //              unsigned char read_bit_18B20(void);         //读一位从18B20
(0009) //              void write_byte_18B20(unsigned char data);  //写一字节到18B20
(0010) //              unsigned char read_18B20(void);             //读一字节到18B20
(0011) //
(0012) // 运行平台：   AVR 8bit (M16已验证)
(0013) // 依存关系：   DS18B20_driver.h    DS18B20基本驱动头文件（函数声明）
(0014) // 移植人：     
(0015) // 最后修改：   
(0016) //------------------------------------------------------------------------------
(0017) 
(0018) #include "config.h"
(0019) #define DS18B20_PORT PORTG
(0020) #define DS18B20_PIN  PING
(0021) #define DS18B20_DDR  DDRG
(0022) #define CL_DQ   DS18B20_PORT&=~(1<<T_NUM)					   
(0023) #define SET_DQ  DS18B20_PORT|=(1<<T_NUM)			   
(0024) #define SET_OUT DS18B20_DDR|=(1<<T_NUM)				   
(0025) #define SET_IN  DS18B20_DDR&=~(1<<T_NUM)			   
(0026) #define IN_DQ   DS18B20_PIN&(1<<T_NUM)				  
(0027) unsigned char T_NUM=0;
(0028) 
(0029) 
(0030) //------------------------------------------------------------------------------
(0031) // 延时N微秒程序 供控制读写DS18B20时序使用
(0032) //------------------------------------------------------------------------------
(0033) void Delay_nus(unsigned int n)   
(0034) {  unsigned int i;
(0035) 	  for (i=0;i<n;i++) 
    0428A 2744      CLR	R20
    0428B 2755      CLR	R21
    0428C C005      RJMP	0x4292
(0036) 	  		{NOP();
    0428D 0000      NOP
(0037) 						NOP();
    0428E 0000      NOP
(0038) 						NOP();				        //20--300//比较接近
    0428F 0000      NOP
    04290 5F4F      SUBI	R20,0xFF
    04291 4F5F      SBCI	R21,0xFF
    04292 1740      CP	R20,R16
    04293 0751      CPC	R21,R17
    04294 F3C0      BCS	0x428D
    04295 9159      LD	R21,Y+
    04296 9149      LD	R20,Y+
    04297 9508      RET
_reset_18B20:
  bus_flag             --> R10
    04298 92AA      ST	-Y,R10
(0039) 					}
(0040) }
(0041) 
(0042) 
(0043) //------------------------------------------------------------------------------
(0044) // 1-wire总线复位
(0045) //------------------------------------------------------------------------------
(0046) unsigned char reset_18B20(void)
(0047) {
(0048) 	char bus_flag;
(0049) 	CLI();
    04299 94F8      BCLR	7
(0050) 	SET_DQ;
    0429A 9110 05DE LDS	R17,T_NUM
    0429C E001      LDI	R16,1
    0429D 940E 4B9E CALL	lsl8
    0429F 9020 0065 LDS	R2,0x65
    042A1 2A20      OR	R2,R16
    042A2 9220 0065 STS	0x65,R2
(0051) 	SET_OUT;
    042A4 9110 05DE LDS	R17,T_NUM
    042A6 E001      LDI	R16,1
    042A7 940E 4B9E CALL	lsl8
    042A9 9020 0064 LDS	R2,0x64
    042AB 2A20      OR	R2,R16
    042AC 9220 0064 STS	0x64,R2
(0052)  	
(0053)   	Delay_nus(1);
    042AE E001      LDI	R16,1
    042AF E010      LDI	R17,0
    042B0 DFD7      RCALL	_Delay_nus
(0054)   	CL_DQ;
    042B1 9110 05DE LDS	R17,T_NUM
    042B3 E001      LDI	R16,1
    042B4 940E 4B9E CALL	lsl8
    042B6 2E20      MOV	R2,R16
    042B7 9420      COM	R2
    042B8 9030 0065 LDS	R3,0x65
    042BA 2032      AND	R3,R2
    042BB 9230 0065 STS	0x65,R3
(0055)   	Delay_nus(550);		//拉低至少480us时间
    042BD E206      LDI	R16,0x26
    042BE E012      LDI	R17,2
    042BF DFC8      RCALL	_Delay_nus
(0056)   	SET_DQ;				//释放
    042C0 9110 05DE LDS	R17,T_NUM
    042C2 E001      LDI	R16,1
    042C3 940E 4B9E CALL	lsl8
    042C5 9020 0065 LDS	R2,0x65
    042C7 2A20      OR	R2,R16
    042C8 9220 0065 STS	0x65,R2
(0057) 					NOP();
    042CA 0000      NOP
(0058) 					NOP();
    042CB 0000      NOP
(0059)   	SET_IN;				//输入
    042CC 9110 05DE LDS	R17,T_NUM
    042CE E001      LDI	R16,1
    042CF 940E 4B9E CALL	lsl8
    042D1 2E20      MOV	R2,R16
    042D2 9420      COM	R2
    042D3 9030 0064 LDS	R3,0x64
    042D5 2032      AND	R3,R2
    042D6 9230 0064 STS	0x64,R3
(0060)   	Delay_nus(60);
    042D8 E30C      LDI	R16,0x3C
    042D9 E010      LDI	R17,0
    042DA DFAD      RCALL	_Delay_nus
(0061)   	
(0062) 						//等待回复
(0063)   	bus_flag = IN_DQ;
    042DB 9110 05DE LDS	R17,T_NUM
    042DD E001      LDI	R16,1
    042DE 940E 4B9E CALL	lsl8
    042E0 90A0 0063 LDS	R10,0x63
    042E2 22A0      AND	R10,R16
(0064)   	
(0065)   	Delay_nus(240);		//回复的低电平在60到240US
    042E3 EF00      LDI	R16,0xF0
    042E4 E010      LDI	R17,0
    042E5 DFA2      RCALL	_Delay_nus
(0066)   	SET_OUT;
    042E6 9110 05DE LDS	R17,T_NUM
    042E8 E001      LDI	R16,1
    042E9 940E 4B9E CALL	lsl8
    042EB 9020 0064 LDS	R2,0x64
    042ED 2A20      OR	R2,R16
    042EE 9220 0064 STS	0x64,R2
(0067) 					NOP();
    042F0 0000      NOP
(0068) 					NOP();
    042F1 0000      NOP
(0069)   	SET_DQ;				//回到初始DQ=1；
    042F2 9110 05DE LDS	R17,T_NUM
    042F4 E001      LDI	R16,1
    042F5 940E 4B9E CALL	lsl8
    042F7 9020 0065 LDS	R2,0x65
    042F9 2A20      OR	R2,R16
    042FA 9220 0065 STS	0x65,R2
(0070) 
(0071)   	SEI();
    042FC 9478      BSET	7
(0072) 	if(bus_flag){
    042FD 20AA      TST	R10
    042FE F011      BEQ	0x4301
(0073) 		return FALSE;
    042FF 2700      CLR	R16
    04300 C001      RJMP	0x4302
(0074) 	}else{
(0075) 		return TRUE;
    04301 E001      LDI	R16,1
    04302 90A9      LD	R10,Y+
    04303 9508      RET
_write_bit_18B20:
  bitval               --> R10
    04304 92AA      ST	-Y,R10
    04305 2EA0      MOV	R10,R16
(0076) 	}
(0077) 
(0078) }
(0079) 
(0080) //------------------------------------------------------------------------------
(0081) // 写一位到总线
(0082) //------------------------------------------------------------------------------
(0083) void write_bit_18B20(char bitval)
(0084) {
(0085)     SET_OUT;
    04306 9110 05DE LDS	R17,T_NUM
    04308 E001      LDI	R16,1
    04309 940E 4B9E CALL	lsl8
    0430B 9020 0064 LDS	R2,0x64
    0430D 2A20      OR	R2,R16
    0430E 9220 0064 STS	0x64,R2
(0086) 					NOP();
    04310 0000      NOP
(0087) 					NOP();
    04311 0000      NOP
(0088) 			 CL_DQ;
    04312 9110 05DE LDS	R17,T_NUM
    04314 E001      LDI	R16,1
    04315 940E 4B9E CALL	lsl8
    04317 2E20      MOV	R2,R16
    04318 9420      COM	R2
    04319 9030 0065 LDS	R3,0x65
    0431B 2032      AND	R3,R2
    0431C 9230 0065 STS	0x65,R3
(0089) 	   Delay_nus(1);
    0431E E001      LDI	R16,1
    0431F E010      LDI	R17,0
    04320 DF67      RCALL	_Delay_nus
(0090) 	   if(bitval){    //写数据，从低位开始
    04321 20AA      TST	R10
    04322 F059      BEQ	0x432E
(0091) 		     SET_DQ;
    04323 9110 05DE LDS	R17,T_NUM
    04325 E001      LDI	R16,1
    04326 940E 4B9E CALL	lsl8
    04328 9020 0065 LDS	R2,0x65
    0432A 2A20      OR	R2,R16
    0432B 9220 0065 STS	0x65,R2
(0092) 	  }else{
    0432D C00C      RJMP	0x433A
(0093) 		     CL_DQ;
    0432E 9110 05DE LDS	R17,T_NUM
    04330 E001      LDI	R16,1
    04331 940E 4B9E CALL	lsl8
    04333 2E20      MOV	R2,R16
    04334 9420      COM	R2
    04335 9030 0065 LDS	R3,0x65
    04337 2032      AND	R3,R2
    04338 9230 0065 STS	0x65,R3
(0094) 	  }
(0095) 	Delay_nus(40);		//15~60us
    0433A E208      LDI	R16,0x28
    0433B E010      LDI	R17,0
    0433C DF4B      RCALL	_Delay_nus
(0096) 	SET_DQ;
    0433D 9110 05DE LDS	R17,T_NUM
    0433F E001      LDI	R16,1
    04340 940E 4B9E CALL	lsl8
    04342 9020 0065 LDS	R2,0x65
    04344 2A20      OR	R2,R16
    04345 9220 0065 STS	0x65,R2
(0097) 	Delay_nus(10);
    04347 E00A      LDI	R16,0xA
    04348 E010      LDI	R17,0
    04349 DF3E      RCALL	_Delay_nus
    0434A 90A9      LD	R10,Y+
    0434B 9508      RET
_read_bit_18B20:
  k                    --> R10
    0434C 92AA      ST	-Y,R10
(0098) }
(0099) 
(0100) //------------------------------------------------------------------------------
(0101) // 读一位从总线
(0102) //------------------------------------------------------------------------------
(0103) unsigned char read_bit_18B20(void)
(0104) {
(0105) 	unsigned char k;
(0106) 	SET_OUT;
    0434D 9110 05DE LDS	R17,T_NUM
    0434F E001      LDI	R16,1
    04350 940E 4B9E CALL	lsl8
    04352 9020 0064 LDS	R2,0x64
    04354 2A20      OR	R2,R16
    04355 9220 0064 STS	0x64,R2
(0107) 	CL_DQ;			//读时间片开始，拉低总线至少1us
    04357 9110 05DE LDS	R17,T_NUM
    04359 E001      LDI	R16,1
    0435A 940E 4B9E CALL	lsl8
    0435C 2E20      MOV	R2,R16
    0435D 9420      COM	R2
    0435E 9030 0065 LDS	R3,0x65
    04360 2032      AND	R3,R2
    04361 9230 0065 STS	0x65,R3
(0108) 	Delay_nus(1);
    04363 E001      LDI	R16,1
    04364 E010      LDI	R17,0
    04365 DF22      RCALL	_Delay_nus
(0109) 	
(0110) 					//SET_DQ;	
(0111) 	SET_IN;
    04366 9110 05DE LDS	R17,T_NUM
    04368 E001      LDI	R16,1
    04369 940E 4B9E CALL	lsl8
    0436B 2E20      MOV	R2,R16
    0436C 9420      COM	R2
    0436D 9030 0064 LDS	R3,0x64
    0436F 2032      AND	R3,R2
    04370 9230 0064 STS	0x64,R3
(0112) 	Delay_nus(4);
    04372 E004      LDI	R16,4
    04373 E010      LDI	R17,0
    04374 DF13      RCALL	_Delay_nus
(0113) 	k=IN_DQ;    	//读数据,从低位开始
    04375 9110 05DE LDS	R17,T_NUM
    04377 E001      LDI	R16,1
    04378 940E 4B9E CALL	lsl8
    0437A 90A0 0063 LDS	R10,0x63
    0437C 22A0      AND	R10,R16
(0114) 	Delay_nus(10);
    0437D E00A      LDI	R16,0xA
    0437E E010      LDI	R17,0
    0437F DF08      RCALL	_Delay_nus
(0115) 	SET_DQ;	
    04380 9110 05DE LDS	R17,T_NUM
    04382 E001      LDI	R16,1
    04383 940E 4B9E CALL	lsl8
    04385 9020 0065 LDS	R2,0x65
    04387 2A20      OR	R2,R16
    04388 9220 0065 STS	0x65,R2
(0116) 				NOP();
    0438A 0000      NOP
(0117) 				NOP();
    0438B 0000      NOP
(0118) 	SET_OUT;
    0438C 9110 05DE LDS	R17,T_NUM
    0438E E001      LDI	R16,1
    0438F 940E 4B9E CALL	lsl8
    04391 9020 0064 LDS	R2,0x64
    04393 2A20      OR	R2,R16
    04394 9220 0064 STS	0x64,R2
(0119) 	    NOP();
    04396 0000      NOP
(0120) 					NOP();
    04397 0000      NOP
(0121) 	if(k){
    04398 20AA      TST	R10
    04399 F011      BEQ	0x439C
(0122) 	    return 1;
    0439A E001      LDI	R16,1
    0439B C001      RJMP	0x439D
(0123) 	}else{
(0124) 	    return 0;
    0439C 2700      CLR	R16
    0439D 90A9      LD	R10,Y+
    0439E 9508      RET
_write_byte_18B20:
  i                    --> R20
  data                 --> R10
    0439F 92AA      ST	-Y,R10
    043A0 934A      ST	-Y,R20
    043A1 2EA0      MOV	R10,R16
(0125) 	}
(0126) 	
(0127) }
(0128) 
(0129) //------------------------------------------------------------------------------
(0130) // 写一个字节到总线
(0131) //------------------------------------------------------------------------------
(0132) void write_byte_18B20(unsigned char data)
(0133) {
(0134) 	unsigned char i;
(0135)    CLI();
    043A2 94F8      BCLR	7
(0136)     for(i=0;i<8;i++)
    043A3 2744      CLR	R20
    043A4 C009      RJMP	0x43AE
(0137)     {
(0138)         write_bit_18B20(data&(1<<i));
    043A5 E001      LDI	R16,1
    043A6 2F14      MOV	R17,R20
    043A7 940E 4B9E CALL	lsl8
    043A9 2E20      MOV	R2,R16
    043AA 2D0A      MOV	R16,R10
    043AB 2102      AND	R16,R2
    043AC DF57      RCALL	_write_bit_18B20
    043AD 9543      INC	R20
    043AE 3048      CPI	R20,0x8
    043AF F3A8      BCS	0x43A5
(0139)         
(0140)     }
(0141)     SET_DQ;
    043B0 9110 05DE LDS	R17,T_NUM
    043B2 E001      LDI	R16,1
    043B3 940E 4B9E CALL	lsl8
    043B5 9020 0065 LDS	R2,0x65
    043B7 2A20      OR	R2,R16
    043B8 9220 0065 STS	0x65,R2
(0142) 				  NOP();
    043BA 0000      NOP
(0143) 					 NOP();
    043BB 0000      NOP
(0144)     SEI();
    043BC 9478      BSET	7
    043BD 9149      LD	R20,Y+
    043BE 90A9      LD	R10,Y+
    043BF 9508      RET
_read_byte_18B20:
  temp                 --> R10
  n                    --> R20
    043C0 92AA      ST	-Y,R10
    043C1 934A      ST	-Y,R20
(0145)     
(0146)     //return;
(0147) }
(0148) 
(0149) //------------------------------------------------------------------------------
(0150) // 读一个字节
(0151) //------------------------------------------------------------------------------
(0152) unsigned char read_byte_18B20(void)
(0153) {
(0154) 	unsigned char temp,n;
(0155)     CLI();
    043C2 94F8      BCLR	7
(0156)   	temp=0;
    043C3 24AA      CLR	R10
(0157)     for(n=0;n<8;n++)
    043C4 2744      CLR	R20
    043C5 C014      RJMP	0x43DA
(0158)     {
(0159)       	if(read_bit_18B20()){
    043C6 DF85      RCALL	_read_bit_18B20
    043C7 2300      TST	R16
    043C8 F031      BEQ	0x43CF
(0160)       		temp|=(1<<n);
    043C9 E001      LDI	R16,1
    043CA 2F14      MOV	R17,R20
    043CB 940E 4B9E CALL	lsl8
    043CD 2AA0      OR	R10,R16
(0161)       	}else{
    043CE C007      RJMP	0x43D6
(0162)       		temp&=~(1<<n);
    043CF E001      LDI	R16,1
    043D0 2F14      MOV	R17,R20
    043D1 940E 4B9E CALL	lsl8
    043D3 2E20      MOV	R2,R16
    043D4 9420      COM	R2
    043D5 20A2      AND	R10,R2
(0163)       	}
(0164)       	Delay_nus(70); //60~120us
    043D6 E406      LDI	R16,0x46
    043D7 E010      LDI	R17,0
    043D8 DEAF      RCALL	_Delay_nus
    043D9 9543      INC	R20
    043DA 3048      CPI	R20,0x8
    043DB F350      BCS	0x43C6
(0165)       	
(0166)    }
(0167)    SEI();
    043DC 9478      BSET	7
(0168) 
(0169)    return temp;
    043DD 2D0A      MOV	R16,R10
    043DE 9149      LD	R20,Y+
    043DF 90A9      LD	R10,Y+
    043E0 9508      RET
(0170) }
(0171) 
(0172) 
(0173) 
(0174) //------------------------------------------------------------------------------
(0175) // 应用函数部分！ 供外部调用
(0176) //------------------------------------------------------------------------------
(0177) //------------------------------------------------------------------------------
(0178) // 单器件/多器件：开始转换
(0179) //------------------------------------------------------------------------------
(0180) void convert_T(void)
(0181) {
(0182) 					if(reset_18B20()){
_convert_T:
    043E1 DEB6      RCALL	_reset_18B20
    043E2 2300      TST	R16
    043E3 F021      BEQ	0x43E8
(0183) 					write_byte_18B20(0xcc);
    043E4 EC0C      LDI	R16,0xCC
    043E5 DFB9      RCALL	_write_byte_18B20
(0184) 					write_byte_18B20(0x44);
    043E6 E404      LDI	R16,0x44
    043E7 DFB7      RCALL	_write_byte_18B20
(0185) 					}
    043E8 9508      RET
_read_T:
  tmp                  --> Y,+0
  tl                   --> R12
  th                   --> R10
    043E9 940E 4B0B CALL	push_xgset00FC
    043EB 9724      SBIW	R28,4
(0186) }
(0187) 
(0188) //------------------------------------------------------------------------------
(0189) // 单器件：读温度，返回INIT8U型温度数据（原始数据）
(0190) //------------------------------------------------------------------------------
(0191) float read_T(void)
(0192) {
(0193)     unsigned char th=0,tl=0;
    043EC 24AA      CLR	R10
    043ED 24CC      CLR	R12
(0194) 	float tmp;
(0195)     if(reset_18B20()){
    043EE DEA9      RCALL	_reset_18B20
    043EF 2300      TST	R16
    043F0 F021      BEQ	0x43F5
(0196)     	write_byte_18B20(0xcc);
    043F1 EC0C      LDI	R16,0xCC
    043F2 DFAC      RCALL	_write_byte_18B20
(0197)     	write_byte_18B20(0xbe);
    043F3 EB0E      LDI	R16,0xBE
    043F4 DFAA      RCALL	_write_byte_18B20
(0198)     }
(0199)     
(0200)     tl = read_byte_18B20();
    043F5 DFCA      RCALL	_read_byte_18B20
    043F6 2EC0      MOV	R12,R16
(0201)     th = read_byte_18B20();
    043F7 DFC8      RCALL	_read_byte_18B20
    043F8 2EE0      MOV	R14,R16
    043F9 2CAE      MOV	R10,R14
(0202)  	tmp= ((float)(th<<8|tl))*0.0625;
    043FA EC0A      LDI	R16,0xCA
    043FB E010      LDI	R17,0
    043FC 940E 4A8F CALL	elpm32
    043FE 0118      MOVW	R2,R16
    043FF 0129      MOVW	R4,R18
    04400 2D1A      MOV	R17,R10
    04401 2D0C      MOV	R16,R12
    04402 940E 4CB2 CALL	int2fp
    04404 933A      ST	-Y,R19
    04405 932A      ST	-Y,R18
    04406 931A      ST	-Y,R17
    04407 930A      ST	-Y,R16
    04408 0181      MOVW	R16,R2
    04409 0192      MOVW	R18,R4
    0440A 940E 4E57 CALL	fpmule2
    0440C 8308      ST	Y,R16
    0440D 8319      STD	Y+1,R17
    0440E 832A      STD	Y+2,R18
    0440F 833B      STD	Y+3,R19
(0203)     return( tmp);
    04410 8108      LD	R16,Y
    04411 8119      LDD	R17,Y+1
    04412 812A      LDD	R18,Y+2
    04413 813B      LDD	R19,Y+3
    04414 9624      ADIW	R28,4
    04415 940C 4AEC JMP	pop_xgset00FC
_read_T_NUM:
  ttemp                --> Y,+0
  NUM                  --> R10
    04417 92AA      ST	-Y,R10
    04418 2EA0      MOV	R10,R16
    04419 9724      SBIW	R28,4
(0204) }
(0205) 
(0206) float read_T_NUM(unsigned char NUM){
(0207) float ttemp;
(0208) if ( NUM >1) return 123.45;
    0441A E081      LDI	R24,1
    0441B 158A      CP	R24,R10
    0441C F428      BCC	0x4422
    0441D EC06      LDI	R16,0xC6
    0441E E010      LDI	R17,0
    0441F 940E 4A8F CALL	elpm32
    04421 C010      RJMP	0x4432
(0209) T_NUM=NUM;//设置访问器件
    04422 92A0 05DE STS	T_NUM,R10
(0210) convert_T();//温度转换
    04424 DFBC      RCALL	_convert_T
(0211) delayms(800);
    04425 E200      LDI	R16,0x20
    04426 E013      LDI	R17,3
    04427 940E 253A CALL	_delayms
(0212) ttemp=read_T();
    04429 DFBF      RCALL	_read_T
    0442A 8308      ST	Y,R16
    0442B 8319      STD	Y+1,R17
    0442C 832A      STD	Y+2,R18
    0442D 833B      STD	Y+3,R19
(0213) return ttemp;
    0442E 8108      LD	R16,Y
    0442F 8119      LDD	R17,Y+1
    04430 812A      LDD	R18,Y+2
    04431 813B      LDD	R19,Y+3
    04432 9624      ADIW	R28,4
    04433 90A9      LD	R10,Y+
    04434 9508      RET
_readWithoutDelay:
  ttemp                --> Y,+0
  NUM                  --> R10
    04435 92AA      ST	-Y,R10
    04436 2EA0      MOV	R10,R16
    04437 9724      SBIW	R28,4
(0214) }
(0215) float readWithoutDelay(unsigned char NUM)
(0216) {
(0217) float ttemp;
(0218) if ( NUM >1) return 123.45;
    04438 E081      LDI	R24,1
    04439 158A      CP	R24,R10
    0443A F428      BCC	0x4440
    0443B EC06      LDI	R16,0xC6
    0443C E010      LDI	R17,0
    0443D 940E 4A8F CALL	elpm32
    0443F C00C      RJMP	0x444C
(0219) T_NUM=NUM;//设置访问器件
    04440 92A0 05DE STS	T_NUM,R10
(0220) ttemp=read_T();
    04442 DFA6      RCALL	_read_T
    04443 8308      ST	Y,R16
    04444 8319      STD	Y+1,R17
    04445 832A      STD	Y+2,R18
    04446 833B      STD	Y+3,R19
(0221) convert_T();//温度转换
    04447 DF99      RCALL	_convert_T
(0222) return ttemp;
    04448 8108      LD	R16,Y
    04449 8119      LDD	R17,Y+1
    0444A 812A      LDD	R18,Y+2
    0444B 813B      LDD	R19,Y+3
    0444C 9624      ADIW	R28,4
    0444D 90A9      LD	R10,Y+
    0444E 9508      RET
FILE: D:\LQD\software\software_src\ds1302.c
(0001) #include "config.h"
(0002) 
(0003) #define TPORT PORTB
(0004) #define TDDR DDRB
(0005) #define TPIN PINB
(0006) #define PIN_RST	 4
(0007) #define PIN_IO	 5
(0008) #define PIN_SCK	 6
(0009) /******************复位脚*********************/
(0010) #define RST_CLR	TPORT &= ~(1 << PIN_RST)   /*电平置低*/
(0011) #define RST_SET	TPORT |= (1 << PIN_RST)    /*电平置高*/
(0012) #define RST_IN	TDDR &= ~(1 << PIN_RST)    /*方向输入*/
(0013) #define RST_OUT	TDDR |= (1 << PIN_RST)     /*方向输出*/
(0014) 
(0015) /*****************双向数据********************/
(0016) #define IO_CLR	TPORT &= ~(1 << PIN_IO)  /*电平置低*/
(0017) #define IO_SET	TPORT |= (1 << PIN_IO)   /*电平置高*/
(0018) #define IO_R	TPIN & (1 << PIN_IO)     /*电平读取*/
(0019) #define IO_IN	TDDR &= ~(1 << PIN_IO)   /*方向输入*/
(0020) #define IO_OUT	TDDR |= (1 << PIN_IO)    /*方向输出*/
(0021) 
(0022) /*****************时钟信号*******************/
(0023) #define SCK_CLR	TPORT &= ~(1 << PIN_SCK)  /*时钟信号*/
(0024) #define SCK_SET	TPORT |= (1 << PIN_SCK)   /*电平置高*/
(0025) #define SCK_IN	TDDR &= ~(1 << PIN_SCK)   /*方向输入*/
(0026) #define SCK_OUT	TDDR |= (1 << PIN_SCK)    /*方向输出*/
(0027) 
(0028) #define ds1302_sec_add			0x80		//秒数据地址
(0029) #define ds1302_min_add			0x82		//分数据地址
(0030) #define ds1302_hr_add			0x84		//时数据地址
(0031) #define ds1302_date_add			0x86		//日数据地址
(0032) #define ds1302_month_add		0x88		//月数据地址
(0033) #define ds1302_day_add			0x8a		//星期数据地址
(0034) #define ds1302_year_add			0x8c		//年数据地址
(0035) #define ds1302_control_add		0x8e		//控制数据地址
(0036) #define ds1302_charger_add		0x90 					 
(0037) #define ds1302_clkburst_add		0xbe
(0038) 
(0039) unsigned char time_buf[8] = {0x20,0x0c,0x0A,0x1c,0x22,0x46,0x00,0x06};
(0040) /*
(0041)  struct tm {
(0042)    	int tm_sec;   // 秒 seconds after the minute, 0 to 60
(0043)    	int tm_min;   // 分 minutes after the hour, 0 to 59
(0044) 	int tm_hour;  // 时 hours since midnight, 0 to 23*
(0045) 	int tm_mday;  // 日 day of the month, 1 to 31
(0046) 	int tm_mon;   // 月 months since January, 0 to 11
(0047) 	int tm_year;  // 年 years since 1900
(0048) 	int tm_wday;  // 星期 days since Sunday, 0 to 6
(0049) 	int tm_yday;  // 从元旦起的天数 days since January 1, 0 to 365
(0050)  	int tm_isdst; // 夏令时？？Daylight Savings Time flag
(0051)  	};	
(0052) 	*/
(0053) 
(0054) //DS1302初始化函数
(0055) void ds1302_init(void) 
(0056) {
(0057) 	RST_CLR;			/*RST脚置低*/
_ds1302_init:
    0444F 98C4      CBI	0x18,4
(0058) 	SCK_CLR;			/*SCK脚置低*/
    04450 98C6      CBI	0x18,6
(0059) 	RST_OUT;			/*RST脚设置为输出*/
    04451 9ABC      SBI	0x17,4
(0060) 	SCK_OUT;			/*SCK脚设置为输出*/
    04452 9ABE      SBI	0x17,6
    04453 9508      RET
_ds1302_write_byte:
  i                    --> R20
  d                    --> R18
  addr                 --> R16
    04454 934A      ST	-Y,R20
(0061) }
(0062) 
(0063) //向DS1302写入一字节数据
(0064) void ds1302_write_byte(unsigned char addr, unsigned char d) {
(0065) 
(0066) 	unsigned char i;
(0067) 	RST_SET;					/*启动DS1302总线*/
    04455 9AC4      SBI	0x18,4
(0068) 	
(0069) 	/*写入目标地址：addr*/
(0070) 	IO_OUT;
    04456 9ABD      SBI	0x17,5
(0071) 	addr = addr & 0xFE;   //最低位置零，寄存器0位为0时写，为1时读
    04457 7F0E      ANDI	R16,0xFE
(0072) 	for (i = 0; i < 8; i ++) {
    04458 2744      CLR	R20
    04459 C009      RJMP	0x4463
(0073) 		if (addr & 0x01) {
    0445A FF00      SBRS	R16,0
    0445B C002      RJMP	0x445E
(0074) 			IO_SET;
    0445C 9AC5      SBI	0x18,5
(0075) 			}
    0445D C001      RJMP	0x445F
(0076) 		else {
(0077) 			IO_CLR;
    0445E 98C5      CBI	0x18,5
(0078) 			}
(0079) 		SCK_SET;      //产生时钟
    0445F 9AC6      SBI	0x18,6
(0080) 		SCK_CLR;
    04460 98C6      CBI	0x18,6
(0081) 		addr = addr >> 1;
    04461 9506      LSR	R16
    04462 9543      INC	R20
    04463 3048      CPI	R20,0x8
    04464 F3A8      BCS	0x445A
(0082) 		}
(0083) 	
(0084) 	/*写入数据：d*/
(0085) 	IO_OUT;
    04465 9ABD      SBI	0x17,5
(0086) 	for (i = 0; i < 8; i ++) {
    04466 2744      CLR	R20
    04467 C009      RJMP	0x4471
(0087) 		if (d & 0x01) {
    04468 FF20      SBRS	R18,0
    04469 C002      RJMP	0x446C
(0088) 			IO_SET;
    0446A 9AC5      SBI	0x18,5
(0089) 			}
    0446B C001      RJMP	0x446D
(0090) 		else {
(0091) 			IO_CLR;
    0446C 98C5      CBI	0x18,5
(0092) 			}
(0093) 		SCK_SET;    //产生时钟
    0446D 9AC6      SBI	0x18,6
(0094) 		SCK_CLR;
    0446E 98C6      CBI	0x18,6
(0095) 		d = d >> 1;
    0446F 9526      LSR	R18
    04470 9543      INC	R20
    04471 3048      CPI	R20,0x8
    04472 F3A8      BCS	0x4468
(0096) 		}
(0097) 	RST_CLR;		//停止DS1302总线
    04473 98C4      CBI	0x18,4
    04474 9149      LD	R20,Y+
    04475 9508      RET
_ds1302_read_byte:
  temp                 --> R20
  i                    --> R22
  addr                 --> R16
    04476 934A      ST	-Y,R20
    04477 936A      ST	-Y,R22
(0098) 	
(0099) }
(0100) 
(0101) //从DS1302读出一字节数据
(0102) unsigned char ds1302_read_byte(unsigned char addr) {
(0103) 
(0104) 	unsigned char i;
(0105) 	unsigned char temp;
(0106) 	RST_SET;					/*启动DS1302总线*/
    04478 9AC4      SBI	0x18,4
(0107) 
(0108) 	/*写入目标地址：addr*/
(0109) 	IO_OUT;
    04479 9ABD      SBI	0x17,5
(0110) 	addr = addr | 0x01;    //最低位置高，寄存器0位为0时写，为1时读
    0447A 6001      ORI	R16,1
(0111) 	for (i = 0; i < 8; i ++) {
    0447B 2766      CLR	R22
    0447C C009      RJMP	0x4486
(0112) 		if (addr & 0x01) {
    0447D FF00      SBRS	R16,0
    0447E C002      RJMP	0x4481
(0113) 			IO_SET;
    0447F 9AC5      SBI	0x18,5
(0114) 			}
    04480 C001      RJMP	0x4482
(0115) 		else {
(0116) 			IO_CLR;
    04481 98C5      CBI	0x18,5
(0117) 			}
(0118) 		SCK_SET;
    04482 9AC6      SBI	0x18,6
(0119) 		SCK_CLR;
    04483 98C6      CBI	0x18,6
(0120) 		addr = addr >> 1;
    04484 9506      LSR	R16
    04485 9563      INC	R22
    04486 3068      CPI	R22,0x8
    04487 F3A8      BCS	0x447D
(0121) 		}
(0122) 	
(0123) 	/*输出数据：temp*/
(0124) 	IO_IN;
    04488 98BD      CBI	0x17,5
(0125) 	for (i = 0; i < 8; i ++) {
    04489 2766      CLR	R22
    0448A C009      RJMP	0x4494
(0126) 		temp = temp >> 1;
    0448B 9546      LSR	R20
(0127) 		if (IO_R) {
    0448C 9BB5      SBIS	0x16,5
    0448D C002      RJMP	0x4490
(0128) 			temp |= 0x80;
    0448E 6840      ORI	R20,0x80
(0129) 			}
    0448F C001      RJMP	0x4491
(0130) 		else {
(0131) 			temp &= 0x7F;
    04490 774F      ANDI	R20,0x7F
(0132) 			}
(0133) 		SCK_SET;
    04491 9AC6      SBI	0x18,6
(0134) 		SCK_CLR;
    04492 98C6      CBI	0x18,6
    04493 9563      INC	R22
    04494 3068      CPI	R22,0x8
    04495 F3A8      BCS	0x448B
(0135) 		}
(0136) 	
(0137) 	RST_CLR;					/*停止DS1302总线*/
    04496 98C4      CBI	0x18,4
(0138) 	return temp;
    04497 2F04      MOV	R16,R20
    04498 9169      LD	R22,Y+
    04499 9149      LD	R20,Y+
    0449A 9508      RET
(0139) }
(0140) 
(0141) //向DS302写入时钟数据
(0142) void ds1302_write_time(void) {
(0143) 
(0144) 	ds1302_write_byte(ds1302_control_add,0x00);			//关闭写保护 
_ds1302_write_time:
    0449B 2722      CLR	R18
    0449C E80E      LDI	R16,0x8E
    0449D DFB6      RCALL	_ds1302_write_byte
(0145) 	ds1302_write_byte(ds1302_sec_add,0x80);				//暂停时钟 
    0449E E820      LDI	R18,0x80
    0449F E800      LDI	R16,0x80
    044A0 DFB3      RCALL	_ds1302_write_byte
(0146) 	//ds1302_write_byte(ds1302_charger_add,0xa9);	    //涓流充电 
(0147) 	ds1302_write_byte(ds1302_year_add,time_buf[1]);		//年 
    044A1 9120 05E0 LDS	R18,time_buf+1
    044A3 E80C      LDI	R16,0x8C
    044A4 DFAF      RCALL	_ds1302_write_byte
(0148) 	ds1302_write_byte(ds1302_month_add,time_buf[2]);	//月 
    044A5 9120 05E1 LDS	R18,time_buf+2
    044A7 E808      LDI	R16,0x88
    044A8 DFAB      RCALL	_ds1302_write_byte
(0149) 	ds1302_write_byte(ds1302_date_add,time_buf[3]);		//日 
    044A9 9120 05E2 LDS	R18,time_buf+3
    044AB E806      LDI	R16,0x86
    044AC DFA7      RCALL	_ds1302_write_byte
(0150) 	ds1302_write_byte(ds1302_hr_add,time_buf[4]);		//时 
    044AD 9120 05E3 LDS	R18,time_buf+4
    044AF E804      LDI	R16,0x84
    044B0 DFA3      RCALL	_ds1302_write_byte
(0151) 	ds1302_write_byte(ds1302_min_add,time_buf[5]);		//分
    044B1 9120 05E4 LDS	R18,time_buf+5
    044B3 E802      LDI	R16,0x82
    044B4 DF9F      RCALL	_ds1302_write_byte
(0152) 	ds1302_write_byte(ds1302_sec_add,time_buf[6]);		//秒
    044B5 9120 05E5 LDS	R18,time_buf+6
    044B7 E800      LDI	R16,0x80
    044B8 DF9B      RCALL	_ds1302_write_byte
(0153) 	ds1302_write_byte(ds1302_day_add,time_buf[7]);		//周 
    044B9 9120 05E6 LDS	R18,time_buf+7
    044BB E80A      LDI	R16,0x8A
    044BC DF97      RCALL	_ds1302_write_byte
(0154) 	ds1302_write_byte(ds1302_control_add,0x80);			//打开写保护 
    044BD E820      LDI	R18,0x80
    044BE E80E      LDI	R16,0x8E
    044BF CF94      RJMP	_ds1302_write_byte
_ds1302_read_time:
    044C0 92AA      ST	-Y,R10
    044C1 934A      ST	-Y,R20
(0155) }
(0156) 
(0157) //从DS302读出时钟数据
(0158) void ds1302_read_time(void)  { 
(0159) 	time_buf[1]=ds1302_read_byte(ds1302_year_add);		//年 
    044C2 E80C      LDI	R16,0x8C
    044C3 DFB2      RCALL	_ds1302_read_byte
    044C4 9300 05E0 STS	time_buf+1,R16
(0160) 	time_buf[2]=ds1302_read_byte(ds1302_month_add);		//月 
    044C6 E808      LDI	R16,0x88
    044C7 DFAE      RCALL	_ds1302_read_byte
    044C8 9300 05E1 STS	time_buf+2,R16
(0161) 	time_buf[3]=ds1302_read_byte(ds1302_date_add);		//日 
    044CA E806      LDI	R16,0x86
    044CB DFAA      RCALL	_ds1302_read_byte
    044CC 2EA0      MOV	R10,R16
    044CD 92A0 05E2 STS	time_buf+3,R10
(0162) 	time_buf[4]=ds1302_read_byte(ds1302_hr_add);		//时 
    044CF E804      LDI	R16,0x84
    044D0 DFA5      RCALL	_ds1302_read_byte
    044D1 2EA0      MOV	R10,R16
    044D2 92A0 05E3 STS	time_buf+4,R10
(0163) 	time_buf[5]=ds1302_read_byte(ds1302_min_add);		//分 
    044D4 E802      LDI	R16,0x82
    044D5 DFA0      RCALL	_ds1302_read_byte
    044D6 2EA0      MOV	R10,R16
    044D7 92A0 05E4 STS	time_buf+5,R10
(0164) 	time_buf[6]=(ds1302_read_byte(ds1302_sec_add))&0x7F;//秒，屏蔽秒的第7位，避免超出59
    044D9 E800      LDI	R16,0x80
    044DA DF9B      RCALL	_ds1302_read_byte
    044DB 2F40      MOV	R20,R16
    044DC 2F84      MOV	R24,R20
    044DD 778F      ANDI	R24,0x7F
    044DE 9380 05E5 STS	time_buf+6,R24
(0165) 	time_buf[7]=ds1302_read_byte(ds1302_day_add);		//周 
    044E0 E80A      LDI	R16,0x8A
    044E1 DF94      RCALL	_ds1302_read_byte
    044E2 2EA0      MOV	R10,R16
    044E3 92A0 05E6 STS	time_buf+7,R10
    044E5 9149      LD	R20,Y+
    044E6 90A9      LD	R10,Y+
    044E7 9508      RET
_kbscan:
  key                  --> R20
  temp                 --> Y,+0
    044E8 934A      ST	-Y,R20
    044E9 9724      SBIW	R28,4
FILE: D:\LQD\software\software_src\key.c
(0001) #include "config.h"
(0002) //键盘扫描函数
(0003) unsigned char kbscan(void)
(0004)   {
(0005)    unsigned char key;
(0006)    unsigned long temp=0;
    044EA E080      LDI	R24,0
    044EB 8388      ST	Y,R24
    044EC 8389      STD	Y+1,R24
    044ED 838A      STD	Y+2,R24
    044EE 838B      STD	Y+3,R24
(0007)    DDR_SET;
    044EF B38A      IN	R24,0x1A
    044F0 7087      ANDI	R24,7
    044F1 BB8A      OUT	0x1A,R24
(0008)    
(0009)    if((KEY_PIN) != KEY_MASK)         //检测A口按键引脚电平，如果全是高电平则退出
    044F2 B389      IN	R24,0x19
    044F3 718F      ANDI	R24,0x1F
    044F4 318F      CPI	R24,0x1F
    044F5 F1A9      BEQ	0x452B
(0010)     {
(0011)      delayms(20);           //防抖
    044F6 E104      LDI	R16,0x14
    044F7 E010      LDI	R17,0
    044F8 940E 253A CALL	_delayms
(0012)      if((KEY_PIN) != KEY_MASK )      //再次检测A口电平，如果不全是高电平则继续执行程序
    044FA B389      IN	R24,0x19
    044FB 718F      ANDI	R24,0x1F
    044FC 318F      CPI	R24,0x1F
    044FD F179      BEQ	0x452D
(0013)       {
(0014)        key = KEY_PIN ;          //读取PINA，将其存放在key中
    044FE B349      IN	R20,0x19
    044FF 714F      ANDI	R20,0x1F
    04500 C024      RJMP	0x4525
(0015)         while((KEY_PIN) != KEY_MASK)
(0016) 		{
(0017) 		 temp++ ;
    04501 E081      LDI	R24,1
    04502 E090      LDI	R25,0
    04503 E0A0      LDI	R26,0
    04504 E0B0      LDI	R27,0
    04505 8028      LD	R2,Y
    04506 8039      LDD	R3,Y+1
    04507 804A      LDD	R4,Y+2
    04508 805B      LDD	R5,Y+3
    04509 0E28      ADD	R2,R24
    0450A 1E39      ADC	R3,R25
    0450B 1E4A      ADC	R4,R26
    0450C 1E5B      ADC	R5,R27
    0450D 8228      ST	Y,R2
    0450E 8239      STD	Y+1,R3
    0450F 824A      STD	Y+2,R4
    04510 825B      STD	Y+3,R5
(0018) 		 if(temp>LONGKEY) {  
    04511 E880      LDI	R24,0x80
    04512 E398      LDI	R25,0x38
    04513 E0A1      LDI	R26,1
    04514 E0B0      LDI	R27,0
    04515 8028      LD	R2,Y
    04516 8039      LDD	R3,Y+1
    04517 804A      LDD	R4,Y+2
    04518 805B      LDD	R5,Y+3
    04519 1582      CP	R24,R2
    0451A 0593      CPC	R25,R3
    0451B 05A4      CPC	R26,R4
    0451C 05B5      CPC	R27,R5
    0451D F438      BCC	0x4525
(0019) 		     delayms(30);
    0451E E10E      LDI	R16,0x1E
    0451F E010      LDI	R17,0
    04520 940E 253A CALL	_delayms
(0020) 			 return key+0x80;  
    04522 2F04      MOV	R16,R20
    04523 5800      SUBI	R16,0x80
    04524 C009      RJMP	0x452E
    04525 B389      IN	R24,0x19
    04526 718F      ANDI	R24,0x1F
    04527 318F      CPI	R24,0x1F
    04528 F6C1      BNE	0x4501
(0021) 		 };
(0022) 		}
(0023) 		; //当前有按键处于按下状态，再按其他按键时程序维持当前状态 
(0024)       	
(0025) 		return key;
    04529 2F04      MOV	R16,R20
    0452A C003      RJMP	0x452E
(0026) 	  
(0027) 	  }
(0028)     }
(0029) 	else return NO_KEY;
    0452B 2700      CLR	R16
    0452C C001      RJMP	0x452E
(0030) 	
(0031) 	return NO_KEY;
FILE: <library>
    0452D 2700      CLR	R16
    0452E 9624      ADIW	R28,4
    0452F 9149      LD	R20,Y+
    04530 9508      RET
__print:
    04531 940E 49C2 CALL	push_arg4
    04533 940E 4B07 CALL	push_xgsetF0FC
    04535 976C      SBIW	R28,0x1C
    04536 2400      CLR	R0
    04537 2411      CLR	R1
    04538 8A1F      STD	Y+23,R1
    04539 8A0E      STD	Y+22,R0
    0453A C456      RJMP	0x4991
    0453B A5E8      LDD	R30,Y+40
    0453C A5F9      LDD	R31,Y+41
    0453D 8180      LD	R24,Z
    0453E 3285      CPI	R24,0x25
    0453F F059      BEQ	0x454B
    04540 8100      LD	R16,Z
    04541 A1EE      LDD	R30,Y+38
    04542 A1FF      LDD	R31,Y+39
    04543 940E 4B54 CALL	xicallx
    04545 898E      LDD	R24,Y+22
    04546 899F      LDD	R25,Y+23
    04547 9601      ADIW	R24,1
    04548 8B9F      STD	Y+23,R25
    04549 8B8E      STD	Y+22,R24
    0454A C441      RJMP	0x498C
    0454B 2400      CLR	R0
    0454C 2411      CLR	R1
    0454D 8A1D      STD	Y+21,R1
    0454E 8A0C      STD	Y+20,R0
    0454F EF8F      LDI	R24,0xFF
    04550 EF9F      LDI	R25,0xFF
    04551 8F99      STD	Y+25,R25
    04552 8F88      STD	Y+24,R24
    04553 24AA      CLR	R10
    04554 24BB      CLR	R11
    04555 E242      LDI	R20,0x22
    04556 E059      LDI	R21,0x9
    04557 E260      LDI	R22,0x20
    04558 A588      LDD	R24,Y+40
    04559 A599      LDD	R25,Y+41
    0455A 9601      ADIW	R24,1
    0455B A799      STD	Y+41,R25
    0455C A788      STD	Y+40,R24
    0455D 24CC      CLR	R12
    0455E 24DD      CLR	R13
    0455F A5E8      LDD	R30,Y+40
    04560 A5F9      LDD	R31,Y+41
    04561 80E0      LD	R14,Z
    04562 24FF      CLR	R15
    04563 01C7      MOVW	R24,R14
    04564 3280      CPI	R24,0x20
    04565 E0E0      LDI	R30,0
    04566 079E      CPC	R25,R30
    04567 F119      BEQ	0x458B
    04568 3283      CPI	R24,0x23
    04569 E0E0      LDI	R30,0
    0456A 079E      CPC	R25,R30
    0456B F091      BEQ	0x457E
    0456C 3280      CPI	R24,0x20
    0456D E0E0      LDI	R30,0
    0456E 079E      CPC	R25,R30
    0456F F124      BLT	0x4594
    04570 01C7      MOVW	R24,R14
    04571 328B      CPI	R24,0x2B
    04572 E0E0      LDI	R30,0
    04573 079E      CPC	R25,R30
    04574 F089      BEQ	0x4586
    04575 328D      CPI	R24,0x2D
    04576 E0E0      LDI	R30,0
    04577 079E      CPC	R25,R30
    04578 F049      BEQ	0x4582
    04579 3380      CPI	R24,0x30
    0457A E0E0      LDI	R30,0
    0457B 079E      CPC	R25,R30
    0457C F099      BEQ	0x4590
    0457D C016      RJMP	0x4594
    0457E 01C5      MOVW	R24,R10
    0457F 6081      ORI	R24,1
    04580 015C      MOVW	R10,R24
    04581 C015      RJMP	0x4597
    04582 01C5      MOVW	R24,R10
    04583 6084      ORI	R24,4
    04584 015C      MOVW	R10,R24
    04585 C011      RJMP	0x4597
    04586 01C5      MOVW	R24,R10
    04587 6088      ORI	R24,0x8
    04588 015C      MOVW	R10,R24
    04589 E26B      LDI	R22,0x2B
    0458A C00C      RJMP	0x4597
    0458B 01C5      MOVW	R24,R10
    0458C 6088      ORI	R24,0x8
    0458D 015C      MOVW	R10,R24
    0458E E260      LDI	R22,0x20
    0458F C007      RJMP	0x4597
    04590 01C5      MOVW	R24,R10
    04591 6180      ORI	R24,0x10
    04592 015C      MOVW	R10,R24
    04593 C003      RJMP	0x4597
    04594 E081      LDI	R24,1
    04595 E090      LDI	R25,0
    04596 016C      MOVW	R12,R24
    04597 20CC      TST	R12
    04598 F411      BNE	0x459B
    04599 20DD      TST	R13
    0459A F009      BEQ	0x459C
    0459B C006      RJMP	0x45A2
    0459C A588      LDD	R24,Y+40
    0459D A599      LDD	R25,Y+41
    0459E 9601      ADIW	R24,1
    0459F A799      STD	Y+41,R25
    045A0 A788      STD	Y+40,R24
    045A1 CFBD      RJMP	0x455F
    045A2 A5E8      LDD	R30,Y+40
    045A3 A5F9      LDD	R31,Y+41
    045A4 8100      LD	R16,Z
    045A5 2711      CLR	R17
    045A6 940E 5249 CALL	_isdigit
    045A8 3000      CPI	R16,0
    045A9 0701      CPC	R16,R17
    045AA F0B9      BEQ	0x45C2
    045AB A508      LDD	R16,Y+40
    045AC A519      LDD	R17,Y+41
    045AD 940E 4EAA CALL	_atoi
    045AF 8B1D      STD	Y+21,R17
    045B0 8B0C      STD	Y+20,R16
    045B1 C005      RJMP	0x45B7
    045B2 A588      LDD	R24,Y+40
    045B3 A599      LDD	R25,Y+41
    045B4 9601      ADIW	R24,1
    045B5 A799      STD	Y+41,R25
    045B6 A788      STD	Y+40,R24
    045B7 A5E8      LDD	R30,Y+40
    045B8 A5F9      LDD	R31,Y+41
    045B9 8100      LD	R16,Z
    045BA 2711      CLR	R17
    045BB 940E 5249 CALL	_isdigit
    045BD 0168      MOVW	R12,R16
    045BE 3000      CPI	R16,0
    045BF 0701      CPC	R16,R17
    045C0 F789      BNE	0x45B2
    045C1 C015      RJMP	0x45D7
    045C2 A5E8      LDD	R30,Y+40
    045C3 A5F9      LDD	R31,Y+41
    045C4 8180      LD	R24,Z
    045C5 328A      CPI	R24,0x2A
    045C6 F481      BNE	0x45D7
    045C7 A58A      LDD	R24,Y+42
    045C8 A59B      LDD	R25,Y+43
    045C9 9602      ADIW	R24,2
    045CA A79B      STD	Y+43,R25
    045CB A78A      STD	Y+42,R24
    045CC 01FC      MOVW	R30,R24
    045CD 9732      SBIW	R30,2
    045CE 8020      LD	R2,Z
    045CF 8031      LDD	R3,Z+1
    045D0 8A3D      STD	Y+21,R3
    045D1 8A2C      STD	Y+20,R2
    045D2 A588      LDD	R24,Y+40
    045D3 A599      LDD	R25,Y+41
    045D4 9601      ADIW	R24,1
    045D5 A799      STD	Y+41,R25
    045D6 A788      STD	Y+40,R24
    045D7 A5E8      LDD	R30,Y+40
    045D8 A5F9      LDD	R31,Y+41
    045D9 8180      LD	R24,Z
    045DA 328E      CPI	R24,0x2E
    045DB F009      BEQ	0x45DD
    045DC C03A      RJMP	0x4617
    045DD 01CF      MOVW	R24,R30
    045DE 9601      ADIW	R24,1
    045DF A799      STD	Y+41,R25
    045E0 A788      STD	Y+40,R24
    045E1 01FC      MOVW	R30,R24
    045E2 8100      LD	R16,Z
    045E3 2711      CLR	R17
    045E4 940E 5249 CALL	_isdigit
    045E6 0168      MOVW	R12,R16
    045E7 3000      CPI	R16,0
    045E8 0701      CPC	R16,R17
    045E9 F0C1      BEQ	0x4602
    045EA A508      LDD	R16,Y+40
    045EB A519      LDD	R17,Y+41
    045EC 940E 4EAA CALL	_atoi
    045EE 0168      MOVW	R12,R16
    045EF 8ED9      STD	Y+25,R13
    045F0 8EC8      STD	Y+24,R12
    045F1 C005      RJMP	0x45F7
    045F2 A588      LDD	R24,Y+40
    045F3 A599      LDD	R25,Y+41
    045F4 9601      ADIW	R24,1
    045F5 A799      STD	Y+41,R25
    045F6 A788      STD	Y+40,R24
    045F7 A5E8      LDD	R30,Y+40
    045F8 A5F9      LDD	R31,Y+41
    045F9 8100      LD	R16,Z
    045FA 2711      CLR	R17
    045FB 940E 5249 CALL	_isdigit
    045FD 0168      MOVW	R12,R16
    045FE 3000      CPI	R16,0
    045FF 0701      CPC	R16,R17
    04600 F789      BNE	0x45F2
    04601 C015      RJMP	0x4617
    04602 A5E8      LDD	R30,Y+40
    04603 A5F9      LDD	R31,Y+41
    04604 8180      LD	R24,Z
    04605 328A      CPI	R24,0x2A
    04606 F481      BNE	0x4617
    04607 A58A      LDD	R24,Y+42
    04608 A59B      LDD	R25,Y+43
    04609 9602      ADIW	R24,2
    0460A A79B      STD	Y+43,R25
    0460B A78A      STD	Y+42,R24
    0460C 01FC      MOVW	R30,R24
    0460D 9732      SBIW	R30,2
    0460E 8020      LD	R2,Z
    0460F 8031      LDD	R3,Z+1
    04610 8E39      STD	Y+25,R3
    04611 8E28      STD	Y+24,R2
    04612 A588      LDD	R24,Y+40
    04613 A599      LDD	R25,Y+41
    04614 9601      ADIW	R24,1
    04615 A799      STD	Y+41,R25
    04616 A788      STD	Y+40,R24
    04617 A5E8      LDD	R30,Y+40
    04618 A5F9      LDD	R31,Y+41
    04619 8180      LD	R24,Z
    0461A 368C      CPI	R24,0x6C
    0461B F439      BNE	0x4623
    0461C 01CF      MOVW	R24,R30
    0461D 9601      ADIW	R24,1
    0461E A799      STD	Y+41,R25
    0461F A788      STD	Y+40,R24
    04620 01C5      MOVW	R24,R10
    04621 6082      ORI	R24,2
    04622 015C      MOVW	R10,R24
    04623 A5E8      LDD	R30,Y+40
    04624 A5F9      LDD	R31,Y+41
    04625 80C0      LD	R12,Z
    04626 24DD      CLR	R13
    04627 01C6      MOVW	R24,R12
    04628 3583      CPI	R24,0x53
    04629 E0E0      LDI	R30,0
    0462A 079E      CPC	R25,R30
    0462B F409      BNE	0x462D
    0462C C18A      RJMP	0x47B7
    0462D E583      LDI	R24,0x53
    0462E 158C      CP	R24,R12
    0462F 059D      CPC	R25,R13
    04630 F064      BLT	0x463D
    04631 01C6      MOVW	R24,R12
    04632 3485      CPI	R24,0x45
    04633 E0E0      LDI	R30,0
    04634 079E      CPC	R25,R30
    04635 F409      BNE	0x4637
    04636 C307      RJMP	0x493E
    04637 3487      CPI	R24,0x47
    04638 E0E0      LDI	R30,0
    04639 079E      CPC	R25,R30
    0463A F409      BNE	0x463C
    0463B C30B      RJMP	0x4947
    0463C C043      RJMP	0x4680
    0463D 01C6      MOVW	R24,R12
    0463E 3588      CPI	R24,0x58
    0463F E0E0      LDI	R30,0
    04640 079E      CPC	R25,R30
    04641 F409      BNE	0x4643
    04642 C07E      RJMP	0x46C1
    04643 3588      CPI	R24,0x58
    04644 E0E0      LDI	R30,0
    04645 079E      CPC	R25,R30
    04646 F40C      BGE	0x4648
    04647 C038      RJMP	0x4680
    04648 01C6      MOVW	R24,R12
    04649 3683      CPI	R24,0x63
    0464A E0E0      LDI	R30,0
    0464B 079E      CPC	R25,R30
    0464C F409      BNE	0x464E
    0464D C145      RJMP	0x4793
    0464E 3684      CPI	R24,0x64
    0464F E0E0      LDI	R30,0
    04650 079E      CPC	R25,R30
    04651 F409      BNE	0x4653
    04652 C03A      RJMP	0x468D
    04653 3685      CPI	R24,0x65
    04654 E0E0      LDI	R30,0
    04655 079E      CPC	R25,R30
    04656 F409      BNE	0x4658
    04657 C2E3      RJMP	0x493B
    04658 3686      CPI	R24,0x66
    04659 E0E0      LDI	R30,0
    0465A 079E      CPC	R25,R30
    0465B F409      BNE	0x465D
    0465C C2E4      RJMP	0x4941
    0465D 3687      CPI	R24,0x67
    0465E E0E0      LDI	R30,0
    0465F 079E      CPC	R25,R30
    04660 F409      BNE	0x4662
    04661 C2E2      RJMP	0x4944
    04662 3689      CPI	R24,0x69
    04663 E0E0      LDI	R30,0
    04664 079E      CPC	R25,R30
    04665 F139      BEQ	0x468D
    04666 368F      CPI	R24,0x6F
    04667 E0E0      LDI	R30,0
    04668 079E      CPC	R25,R30
    04669 F409      BNE	0x466B
    0466A C056      RJMP	0x46C1
    0466B 3780      CPI	R24,0x70
    0466C E0E0      LDI	R30,0
    0466D 079E      CPC	R25,R30
    0466E F409      BNE	0x4670
    0466F C051      RJMP	0x46C1
    04670 3783      CPI	R24,0x73
    04671 E0E0      LDI	R30,0
    04672 079E      CPC	R25,R30
    04673 F409      BNE	0x4675
    04674 C200      RJMP	0x4875
    04675 3785      CPI	R24,0x75
    04676 E0E0      LDI	R30,0
    04677 079E      CPC	R25,R30
    04678 F409      BNE	0x467A
    04679 C047      RJMP	0x46C1
    0467A 3788      CPI	R24,0x78
    0467B E0E0      LDI	R30,0
    0467C 079E      CPC	R25,R30
    0467D F409      BNE	0x467F
    0467E C042      RJMP	0x46C1
    0467F C000      RJMP	0x4680
    04680 A5E8      LDD	R30,Y+40
    04681 A5F9      LDD	R31,Y+41
    04682 8100      LD	R16,Z
    04683 A1EE      LDD	R30,Y+38
    04684 A1FF      LDD	R31,Y+39
    04685 940E 4B54 CALL	xicallx
    04687 898E      LDD	R24,Y+22
    04688 899F      LDD	R25,Y+23
    04689 9601      ADIW	R24,1
    0468A 8B9F      STD	Y+23,R25
    0468B 8B8E      STD	Y+22,R24
    0468C C2FF      RJMP	0x498C
    0468D FEA1      SBRS	R10,1
    0468E C01E      RJMP	0x46AD
    0468F A58A      LDD	R24,Y+42
    04690 A59B      LDD	R25,Y+43
    04691 9604      ADIW	R24,4
    04692 A79B      STD	Y+43,R25
    04693 A78A      STD	Y+42,R24
    04694 01FC      MOVW	R30,R24
    04695 9734      SBIW	R30,4
    04696 8020      LD	R2,Z
    04697 8031      LDD	R3,Z+1
    04698 8042      LDD	R4,Z+2
    04699 8053      LDD	R5,Z+3
    0469A 862C      STD	Y+12,R2
    0469B 863D      STD	Y+13,R3
    0469C 864E      STD	Y+14,R4
    0469D 865F      STD	Y+15,R5
    0469E E08A      LDI	R24,0xA
    0469F E090      LDI	R25,0
    046A0 839B      STD	Y+3,R25
    046A1 838A      STD	Y+2,R24
    046A2 842C      LDD	R2,Y+12
    046A3 843D      LDD	R3,Y+13
    046A4 844E      LDD	R4,Y+14
    046A5 845F      LDD	R5,Y+15
    046A6 8248      ST	Y,R4
    046A7 8259      STD	Y+1,R5
    046A8 0191      MOVW	R18,R2
    046A9 018A      MOVW	R16,R20
    046AA 940E 4F5B CALL	_ltoa
    046AC C0C1      RJMP	0x476E
    046AD A58A      LDD	R24,Y+42
    046AE A59B      LDD	R25,Y+43
    046AF 9602      ADIW	R24,2
    046B0 A79B      STD	Y+43,R25
    046B1 A78A      STD	Y+42,R24
    046B2 01FC      MOVW	R30,R24
    046B3 9732      SBIW	R30,2
    046B4 8020      LD	R2,Z
    046B5 8031      LDD	R3,Z+1
    046B6 8E3B      STD	Y+27,R3
    046B7 8E2A      STD	Y+26,R2
    046B8 E08A      LDI	R24,0xA
    046B9 E090      LDI	R25,0
    046BA 8399      STD	Y+1,R25
    046BB 8388      ST	Y,R24
    046BC 0191      MOVW	R18,R2
    046BD 018A      MOVW	R16,R20
    046BE 940E 4EF0 CALL	_itoa
    046C0 C0AD      RJMP	0x476E
    046C1 FEA1      SBRS	R10,1
    046C2 C010      RJMP	0x46D3
    046C3 A58A      LDD	R24,Y+42
    046C4 A59B      LDD	R25,Y+43
    046C5 9604      ADIW	R24,4
    046C6 A79B      STD	Y+43,R25
    046C7 A78A      STD	Y+42,R24
    046C8 01FC      MOVW	R30,R24
    046C9 9734      SBIW	R30,4
    046CA 8020      LD	R2,Z
    046CB 8031      LDD	R3,Z+1
    046CC 8042      LDD	R4,Z+2
    046CD 8053      LDD	R5,Z+3
    046CE 862C      STD	Y+12,R2
    046CF 863D      STD	Y+13,R3
    046D0 864E      STD	Y+14,R4
    046D1 865F      STD	Y+15,R5
    046D2 C00B      RJMP	0x46DE
    046D3 A58A      LDD	R24,Y+42
    046D4 A59B      LDD	R25,Y+43
    046D5 9602      ADIW	R24,2
    046D6 A79B      STD	Y+43,R25
    046D7 A78A      STD	Y+42,R24
    046D8 01FC      MOVW	R30,R24
    046D9 9732      SBIW	R30,2
    046DA 8020      LD	R2,Z
    046DB 8031      LDD	R3,Z+1
    046DC 8E3B      STD	Y+27,R3
    046DD 8E2A      STD	Y+26,R2
    046DE A5E8      LDD	R30,Y+40
    046DF A5F9      LDD	R31,Y+41
    046E0 8180      LD	R24,Z
    046E1 3785      CPI	R24,0x75
    046E2 F4D9      BNE	0x46FE
    046E3 FEA1      SBRS	R10,1
    046E4 C00F      RJMP	0x46F4
    046E5 E08A      LDI	R24,0xA
    046E6 E090      LDI	R25,0
    046E7 839B      STD	Y+3,R25
    046E8 838A      STD	Y+2,R24
    046E9 842C      LDD	R2,Y+12
    046EA 843D      LDD	R3,Y+13
    046EB 844E      LDD	R4,Y+14
    046EC 845F      LDD	R5,Y+15
    046ED 8248      ST	Y,R4
    046EE 8259      STD	Y+1,R5
    046EF 0191      MOVW	R18,R2
    046F0 018A      MOVW	R16,R20
    046F1 940E 5013 CALL	_ultoa
    046F3 C07A      RJMP	0x476E
    046F4 E08A      LDI	R24,0xA
    046F5 E090      LDI	R25,0
    046F6 8399      STD	Y+1,R25
    046F7 8388      ST	Y,R24
    046F8 8D2A      LDD	R18,Y+26
    046F9 8D3B      LDD	R19,Y+27
    046FA 018A      MOVW	R16,R20
    046FB 940E 507A CALL	_utoa
    046FD C070      RJMP	0x476E
    046FE A5E8      LDD	R30,Y+40
    046FF A5F9      LDD	R31,Y+41
    04700 8180      LD	R24,Z
    04701 368F      CPI	R24,0x6F
    04702 F509      BNE	0x4724
    04703 FEA0      SBRS	R10,0
    04704 C004      RJMP	0x4709
    04705 E380      LDI	R24,0x30
    04706 01FA      MOVW	R30,R20
    04707 9381      ST	Z+,R24
    04708 01AF      MOVW	R20,R30
    04709 FEA1      SBRS	R10,1
    0470A C00F      RJMP	0x471A
    0470B E088      LDI	R24,0x8
    0470C E090      LDI	R25,0
    0470D 839B      STD	Y+3,R25
    0470E 838A      STD	Y+2,R24
    0470F 842C      LDD	R2,Y+12
    04710 843D      LDD	R3,Y+13
    04711 844E      LDD	R4,Y+14
    04712 845F      LDD	R5,Y+15
    04713 8248      ST	Y,R4
    04714 8259      STD	Y+1,R5
    04715 0191      MOVW	R18,R2
    04716 018A      MOVW	R16,R20
    04717 940E 5013 CALL	_ultoa
    04719 C054      RJMP	0x476E
    0471A E088      LDI	R24,0x8
    0471B E090      LDI	R25,0
    0471C 8399      STD	Y+1,R25
    0471D 8388      ST	Y,R24
    0471E 8D2A      LDD	R18,Y+26
    0471F 8D3B      LDD	R19,Y+27
    04720 018A      MOVW	R16,R20
    04721 940E 507A CALL	_utoa
    04723 C04A      RJMP	0x476E
    04724 A5E8      LDD	R30,Y+40
    04725 A5F9      LDD	R31,Y+41
    04726 8180      LD	R24,Z
    04727 3780      CPI	R24,0x70
    04728 F439      BNE	0x4730
    04729 E380      LDI	R24,0x30
    0472A 01FA      MOVW	R30,R20
    0472B 9381      ST	Z+,R24
    0472C E788      LDI	R24,0x78
    0472D 9381      ST	Z+,R24
    0472E 01AF      MOVW	R20,R30
    0472F C00C      RJMP	0x473C
    04730 FEA0      SBRS	R10,0
    04731 C00A      RJMP	0x473C
    04732 E380      LDI	R24,0x30
    04733 01FA      MOVW	R30,R20
    04734 9381      ST	Z+,R24
    04735 01AF      MOVW	R20,R30
    04736 A5E8      LDD	R30,Y+40
    04737 A5F9      LDD	R31,Y+41
    04738 8020      LD	R2,Z
    04739 01FA      MOVW	R30,R20
    0473A 9221      ST	Z+,R2
    0473B 01AF      MOVW	R20,R30
    0473C FEA1      SBRS	R10,1
    0473D C00F      RJMP	0x474D
    0473E E180      LDI	R24,0x10
    0473F E090      LDI	R25,0
    04740 839B      STD	Y+3,R25
    04741 838A      STD	Y+2,R24
    04742 842C      LDD	R2,Y+12
    04743 843D      LDD	R3,Y+13
    04744 844E      LDD	R4,Y+14
    04745 845F      LDD	R5,Y+15
    04746 8248      ST	Y,R4
    04747 8259      STD	Y+1,R5
    04748 0191      MOVW	R18,R2
    04749 018A      MOVW	R16,R20
    0474A 940E 5013 CALL	_ultoa
    0474C C009      RJMP	0x4756
    0474D E180      LDI	R24,0x10
    0474E E090      LDI	R25,0
    0474F 8399      STD	Y+1,R25
    04750 8388      ST	Y,R24
    04751 8D2A      LDD	R18,Y+26
    04752 8D3B      LDD	R19,Y+27
    04753 018A      MOVW	R16,R20
    04754 940E 507A CALL	_utoa
    04756 A5E8      LDD	R30,Y+40
    04757 A5F9      LDD	R31,Y+41
    04758 8180      LD	R24,Z
    04759 3588      CPI	R24,0x58
    0475A F499      BNE	0x476E
    0475B E282      LDI	R24,0x22
    0475C E099      LDI	R25,0x9
    0475D 017C      MOVW	R14,R24
    0475E C00B      RJMP	0x476A
    0475F 01F7      MOVW	R30,R14
    04760 8100      LD	R16,Z
    04761 2711      CLR	R17
    04762 940E 5267 CALL	_toupper
    04764 0168      MOVW	R12,R16
    04765 01F7      MOVW	R30,R14
    04766 82C0      ST	Z,R12
    04767 01C7      MOVW	R24,R14
    04768 9601      ADIW	R24,1
    04769 017C      MOVW	R14,R24
    0476A 01F7      MOVW	R30,R14
    0476B 8020      LD	R2,Z
    0476C 2022      TST	R2
    0476D F789      BNE	0x475F
    0476E E282      LDI	R24,0x22
    0476F E099      LDI	R25,0x9
    04770 017C      MOVW	R14,R24
    04771 8D88      LDD	R24,Y+24
    04772 8D99      LDD	R25,Y+25
    04773 3F8F      CPI	R24,0xFF
    04774 EFEF      LDI	R30,0xFF
    04775 079E      CPC	R25,R30
    04776 F421      BNE	0x477B
    04777 2400      CLR	R0
    04778 2411      CLR	R1
    04779 8E19      STD	Y+25,R1
    0477A 8E08      STD	Y+24,R0
    0477B 8C08      LDD	R0,Y+24
    0477C 8C19      LDD	R1,Y+25
    0477D 2000      TST	R0
    0477E F419      BNE	0x4782
    0477F 2011      TST	R1
    04780 F409      BNE	0x4782
    04781 C104      RJMP	0x4886
    04782 E202      LDI	R16,0x22
    04783 E019      LDI	R17,0x9
    04784 940E 49B6 CALL	_strlen
    04786 0168      MOVW	R12,R16
    04787 8EDB      STD	Y+27,R13
    04788 8ECA      STD	Y+26,R12
    04789 8C08      LDD	R0,Y+24
    0478A 8C19      LDD	R1,Y+25
    0478B 140C      CP	R0,R12
    0478C 041D      CPC	R1,R13
    0478D F00C      BLT	0x478F
    0478E C0F7      RJMP	0x4886
    0478F 0106      MOVW	R0,R12
    04790 8E19      STD	Y+25,R1
    04791 8E08      STD	Y+24,R0
    04792 C0F3      RJMP	0x4886
    04793 A58A      LDD	R24,Y+42
    04794 A59B      LDD	R25,Y+43
    04795 9602      ADIW	R24,2
    04796 A79B      STD	Y+43,R25
    04797 A78A      STD	Y+42,R24
    04798 01FC      MOVW	R30,R24
    04799 9732      SBIW	R30,2
    0479A 8020      LD	R2,Z
    0479B 8031      LDD	R3,Z+1
    0479C 862A      STD	Y+10,R2
    0479D E081      LDI	R24,1
    0479E E090      LDI	R25,0
    0479F 880C      LDD	R0,Y+20
    047A0 881D      LDD	R1,Y+21
    047A1 1580      CP	R24,R0
    047A2 0591      CPC	R25,R1
    047A3 F444      BGE	0x47AC
    047A4 8E19      STD	Y+25,R1
    047A5 8E08      STD	Y+24,R0
    047A6 2422      CLR	R2
    047A7 862B      STD	Y+11,R2
    047A8 01CE      MOVW	R24,R28
    047A9 960A      ADIW	R24,0xA
    047AA 017C      MOVW	R14,R24
    047AB C0DA      RJMP	0x4886
    047AC 850A      LDD	R16,Y+10
    047AD A1EE      LDD	R30,Y+38
    047AE A1FF      LDD	R31,Y+39
    047AF 940E 4B54 CALL	xicallx
    047B1 898E      LDD	R24,Y+22
    047B2 899F      LDD	R25,Y+23
    047B3 9601      ADIW	R24,1
    047B4 8B9F      STD	Y+23,R25
    047B5 8B8E      STD	Y+22,R24
    047B6 C1D5      RJMP	0x498C
    047B7 A58A      LDD	R24,Y+42
    047B8 A59B      LDD	R25,Y+43
    047B9 9602      ADIW	R24,2
    047BA A79B      STD	Y+43,R25
    047BB A78A      STD	Y+42,R24
    047BC 01FC      MOVW	R30,R24
    047BD 9732      SBIW	R30,2
    047BE 80C0      LD	R12,Z
    047BF 80D1      LDD	R13,Z+1
    047C0 8D88      LDD	R24,Y+24
    047C1 8D99      LDD	R25,Y+25
    047C2 3F8F      CPI	R24,0xFF
    047C3 EFEF      LDI	R30,0xFF
    047C4 079E      CPC	R25,R30
    047C5 F421      BNE	0x47CA
    047C6 2400      CLR	R0
    047C7 2411      CLR	R1
    047C8 8E19      STD	Y+25,R1
    047C9 8E08      STD	Y+24,R0
    047CA 880C      LDD	R0,Y+20
    047CB 881D      LDD	R1,Y+21
    047CC 2000      TST	R0
    047CD F411      BNE	0x47D0
    047CE 2011      TST	R1
    047CF F051      BEQ	0x47DA
    047D0 0186      MOVW	R16,R12
    047D1 940E 4E9D CALL	_cstrlen
    047D3 01A8      MOVW	R20,R16
    047D4 882C      LDD	R2,Y+20
    047D5 883D      LDD	R3,Y+21
    047D6 1A20      SUB	R2,R16
    047D7 0A31      SBC	R3,R17
    047D8 8A3D      STD	Y+21,R3
    047D9 8A2C      STD	Y+20,R2
    047DA 8C08      LDD	R0,Y+24
    047DB 8C19      LDD	R1,Y+25
    047DC 2000      TST	R0
    047DD F441      BNE	0x47E6
    047DE 2011      TST	R1
    047DF F431      BNE	0x47E6
    047E0 0186      MOVW	R16,R12
    047E1 940E 4E9D CALL	_cstrlen
    047E3 01A8      MOVW	R20,R16
    047E4 8F59      STD	Y+25,R21
    047E5 8F48      STD	Y+24,R20
    047E6 880C      LDD	R0,Y+20
    047E7 881D      LDD	R1,Y+21
    047E8 2000      TST	R0
    047E9 F411      BNE	0x47EC
    047EA 2011      TST	R1
    047EB F031      BEQ	0x47F2
    047EC FEA3      SBRS	R10,3
    047ED C004      RJMP	0x47F2
    047EE 01C0      MOVW	R24,R0
    047EF 9701      SBIW	R24,1
    047F0 8B9D      STD	Y+21,R25
    047F1 8B8C      STD	Y+20,R24
    047F2 FEA4      SBRS	R10,4
    047F3 C026      RJMP	0x481A
    047F4 FEA3      SBRS	R10,3
    047F5 C00A      RJMP	0x4800
    047F6 2F06      MOV	R16,R22
    047F7 A1EE      LDD	R30,Y+38
    047F8 A1FF      LDD	R31,Y+39
    047F9 940E 4B54 CALL	xicallx
    047FB 898E      LDD	R24,Y+22
    047FC 899F      LDD	R25,Y+23
    047FD 9601      ADIW	R24,1
    047FE 8B9F      STD	Y+23,R25
    047FF 8B8E      STD	Y+22,R24
    04800 FCA2      SBRC	R10,2
    04801 C04C      RJMP	0x484E
    04802 C00F      RJMP	0x4812
    04803 E300      LDI	R16,0x30
    04804 A1EE      LDD	R30,Y+38
    04805 A1FF      LDD	R31,Y+39
    04806 940E 4B54 CALL	xicallx
    04808 898E      LDD	R24,Y+22
    04809 899F      LDD	R25,Y+23
    0480A 9601      ADIW	R24,1
    0480B 8B9F      STD	Y+23,R25
    0480C 8B8E      STD	Y+22,R24
    0480D 898C      LDD	R24,Y+20
    0480E 899D      LDD	R25,Y+21
    0480F 9701      SBIW	R24,1
    04810 8B9D      STD	Y+21,R25
    04811 8B8C      STD	Y+20,R24
    04812 2422      CLR	R2
    04813 2433      CLR	R3
    04814 880C      LDD	R0,Y+20
    04815 881D      LDD	R1,Y+21
    04816 1420      CP	R2,R0
    04817 0431      CPC	R3,R1
    04818 F354      BLT	0x4803
    04819 C034      RJMP	0x484E
    0481A FCA2      SBRC	R10,2
    0481B C017      RJMP	0x4833
    0481C C00F      RJMP	0x482C
    0481D E200      LDI	R16,0x20
    0481E A1EE      LDD	R30,Y+38
    0481F A1FF      LDD	R31,Y+39
    04820 940E 4B54 CALL	xicallx
    04822 898E      LDD	R24,Y+22
    04823 899F      LDD	R25,Y+23
    04824 9601      ADIW	R24,1
    04825 8B9F      STD	Y+23,R25
    04826 8B8E      STD	Y+22,R24
    04827 898C      LDD	R24,Y+20
    04828 899D      LDD	R25,Y+21
    04829 9701      SBIW	R24,1
    0482A 8B9D      STD	Y+21,R25
    0482B 8B8C      STD	Y+20,R24
    0482C 2422      CLR	R2
    0482D 2433      CLR	R3
    0482E 880C      LDD	R0,Y+20
    0482F 881D      LDD	R1,Y+21
    04830 1420      CP	R2,R0
    04831 0431      CPC	R3,R1
    04832 F354      BLT	0x481D
    04833 FEA3      SBRS	R10,3
    04834 C019      RJMP	0x484E
    04835 2F06      MOV	R16,R22
    04836 A1EE      LDD	R30,Y+38
    04837 A1FF      LDD	R31,Y+39
    04838 940E 4B54 CALL	xicallx
    0483A 898E      LDD	R24,Y+22
    0483B 899F      LDD	R25,Y+23
    0483C 9601      ADIW	R24,1
    0483D 8B9F      STD	Y+23,R25
    0483E 8B8E      STD	Y+22,R24
    0483F C00E      RJMP	0x484E
    04840 01F6      MOVW	R30,R12
    04841 9106      ELPM	R16,Z
    04842 A1EE      LDD	R30,Y+38
    04843 A1FF      LDD	R31,Y+39
    04844 940E 4B54 CALL	xicallx
    04846 898E      LDD	R24,Y+22
    04847 899F      LDD	R25,Y+23
    04848 9601      ADIW	R24,1
    04849 8B9F      STD	Y+23,R25
    0484A 8B8E      STD	Y+22,R24
    0484B 01C6      MOVW	R24,R12
    0484C 9601      ADIW	R24,1
    0484D 016C      MOVW	R12,R24
    0484E 01F6      MOVW	R30,R12
    0484F 9026      ELPM	R2,Z
    04850 2022      TST	R2
    04851 F049      BEQ	0x485B
    04852 8D48      LDD	R20,Y+24
    04853 8D59      LDD	R21,Y+25
    04854 01CA      MOVW	R24,R20
    04855 9701      SBIW	R24,1
    04856 8F99      STD	Y+25,R25
    04857 8F88      STD	Y+24,R24
    04858 3040      CPI	R20,0
    04859 0745      CPC	R20,R21
    0485A F729      BNE	0x4840
    0485B FEA2      SBRS	R10,2
    0485C C12F      RJMP	0x498C
    0485D C00F      RJMP	0x486D
    0485E E200      LDI	R16,0x20
    0485F A1EE      LDD	R30,Y+38
    04860 A1FF      LDD	R31,Y+39
    04861 940E 4B54 CALL	xicallx
    04863 898E      LDD	R24,Y+22
    04864 899F      LDD	R25,Y+23
    04865 9601      ADIW	R24,1
    04866 8B9F      STD	Y+23,R25
    04867 8B8E      STD	Y+22,R24
    04868 898C      LDD	R24,Y+20
    04869 899D      LDD	R25,Y+21
    0486A 9701      SBIW	R24,1
    0486B 8B9D      STD	Y+21,R25
    0486C 8B8C      STD	Y+20,R24
    0486D 2422      CLR	R2
    0486E 2433      CLR	R3
    0486F 880C      LDD	R0,Y+20
    04870 881D      LDD	R1,Y+21
    04871 1420      CP	R2,R0
    04872 0431      CPC	R3,R1
    04873 F354      BLT	0x485E
    04874 C117      RJMP	0x498C
    04875 A58A      LDD	R24,Y+42
    04876 A59B      LDD	R25,Y+43
    04877 9602      ADIW	R24,2
    04878 A79B      STD	Y+43,R25
    04879 A78A      STD	Y+42,R24
    0487A 01FC      MOVW	R30,R24
    0487B 9732      SBIW	R30,2
    0487C 80E0      LD	R14,Z
    0487D 80F1      LDD	R15,Z+1
    0487E 20EE      TST	R14
    0487F F431      BNE	0x4886
    04880 20FF      TST	R15
    04881 F421      BNE	0x4886
    04882 EC8E      LDI	R24,0xCE
    04883 E090      LDI	R25,0
    04884 016C      MOVW	R12,R24
    04885 CF3A      RJMP	0x47C0
    04886 8D88      LDD	R24,Y+24
    04887 8D99      LDD	R25,Y+25
    04888 3F8F      CPI	R24,0xFF
    04889 EFEF      LDI	R30,0xFF
    0488A 079E      CPC	R25,R30
    0488B F421      BNE	0x4890
    0488C 2400      CLR	R0
    0488D 2411      CLR	R1
    0488E 8E19      STD	Y+25,R1
    0488F 8E08      STD	Y+24,R0
    04890 880C      LDD	R0,Y+20
    04891 881D      LDD	R1,Y+21
    04892 2000      TST	R0
    04893 F411      BNE	0x4896
    04894 2011      TST	R1
    04895 F051      BEQ	0x48A0
    04896 0187      MOVW	R16,R14
    04897 940E 49B6 CALL	_strlen
    04899 0168      MOVW	R12,R16
    0489A 882C      LDD	R2,Y+20
    0489B 883D      LDD	R3,Y+21
    0489C 1A20      SUB	R2,R16
    0489D 0A31      SBC	R3,R17
    0489E 8A3D      STD	Y+21,R3
    0489F 8A2C      STD	Y+20,R2
    048A0 8C08      LDD	R0,Y+24
    048A1 8C19      LDD	R1,Y+25
    048A2 2000      TST	R0
    048A3 F441      BNE	0x48AC
    048A4 2011      TST	R1
    048A5 F431      BNE	0x48AC
    048A6 0187      MOVW	R16,R14
    048A7 940E 49B6 CALL	_strlen
    048A9 0168      MOVW	R12,R16
    048AA 8ED9      STD	Y+25,R13
    048AB 8EC8      STD	Y+24,R12
    048AC 880C      LDD	R0,Y+20
    048AD 881D      LDD	R1,Y+21
    048AE 2000      TST	R0
    048AF F411      BNE	0x48B2
    048B0 2011      TST	R1
    048B1 F031      BEQ	0x48B8
    048B2 FEA3      SBRS	R10,3
    048B3 C004      RJMP	0x48B8
    048B4 01C0      MOVW	R24,R0
    048B5 9701      SBIW	R24,1
    048B6 8B9D      STD	Y+21,R25
    048B7 8B8C      STD	Y+20,R24
    048B8 FEA4      SBRS	R10,4
    048B9 C026      RJMP	0x48E0
    048BA FEA3      SBRS	R10,3
    048BB C00A      RJMP	0x48C6
    048BC 2F06      MOV	R16,R22
    048BD A1EE      LDD	R30,Y+38
    048BE A1FF      LDD	R31,Y+39
    048BF 940E 4B54 CALL	xicallx
    048C1 898E      LDD	R24,Y+22
    048C2 899F      LDD	R25,Y+23
    048C3 9601      ADIW	R24,1
    048C4 8B9F      STD	Y+23,R25
    048C5 8B8E      STD	Y+22,R24
    048C6 FCA2      SBRC	R10,2
    048C7 C04C      RJMP	0x4914
    048C8 C00F      RJMP	0x48D8
    048C9 E300      LDI	R16,0x30
    048CA A1EE      LDD	R30,Y+38
    048CB A1FF      LDD	R31,Y+39
    048CC 940E 4B54 CALL	xicallx
    048CE 898E      LDD	R24,Y+22
    048CF 899F      LDD	R25,Y+23
    048D0 9601      ADIW	R24,1
    048D1 8B9F      STD	Y+23,R25
    048D2 8B8E      STD	Y+22,R24
    048D3 898C      LDD	R24,Y+20
    048D4 899D      LDD	R25,Y+21
    048D5 9701      SBIW	R24,1
    048D6 8B9D      STD	Y+21,R25
    048D7 8B8C      STD	Y+20,R24
    048D8 2422      CLR	R2
    048D9 2433      CLR	R3
    048DA 880C      LDD	R0,Y+20
    048DB 881D      LDD	R1,Y+21
    048DC 1420      CP	R2,R0
    048DD 0431      CPC	R3,R1
    048DE F354      BLT	0x48C9
    048DF C034      RJMP	0x4914
    048E0 FCA2      SBRC	R10,2
    048E1 C017      RJMP	0x48F9
    048E2 C00F      RJMP	0x48F2
    048E3 E200      LDI	R16,0x20
    048E4 A1EE      LDD	R30,Y+38
    048E5 A1FF      LDD	R31,Y+39
    048E6 940E 4B54 CALL	xicallx
    048E8 898E      LDD	R24,Y+22
    048E9 899F      LDD	R25,Y+23
    048EA 9601      ADIW	R24,1
    048EB 8B9F      STD	Y+23,R25
    048EC 8B8E      STD	Y+22,R24
    048ED 898C      LDD	R24,Y+20
    048EE 899D      LDD	R25,Y+21
    048EF 9701      SBIW	R24,1
    048F0 8B9D      STD	Y+21,R25
    048F1 8B8C      STD	Y+20,R24
    048F2 2422      CLR	R2
    048F3 2433      CLR	R3
    048F4 880C      LDD	R0,Y+20
    048F5 881D      LDD	R1,Y+21
    048F6 1420      CP	R2,R0
    048F7 0431      CPC	R3,R1
    048F8 F354      BLT	0x48E3
    048F9 FEA3      SBRS	R10,3
    048FA C019      RJMP	0x4914
    048FB 2F06      MOV	R16,R22
    048FC A1EE      LDD	R30,Y+38
    048FD A1FF      LDD	R31,Y+39
    048FE 940E 4B54 CALL	xicallx
    04900 898E      LDD	R24,Y+22
    04901 899F      LDD	R25,Y+23
    04902 9601      ADIW	R24,1
    04903 8B9F      STD	Y+23,R25
    04904 8B8E      STD	Y+22,R24
    04905 C00E      RJMP	0x4914
    04906 01F7      MOVW	R30,R14
    04907 8100      LD	R16,Z
    04908 A1EE      LDD	R30,Y+38
    04909 A1FF      LDD	R31,Y+39
    0490A 940E 4B54 CALL	xicallx
    0490C 898E      LDD	R24,Y+22
    0490D 899F      LDD	R25,Y+23
    0490E 9601      ADIW	R24,1
    0490F 8B9F      STD	Y+23,R25
    04910 8B8E      STD	Y+22,R24
    04911 01C7      MOVW	R24,R14
    04912 9601      ADIW	R24,1
    04913 017C      MOVW	R14,R24
    04914 01F7      MOVW	R30,R14
    04915 8020      LD	R2,Z
    04916 2022      TST	R2
    04917 F049      BEQ	0x4921
    04918 8D68      LDD	R22,Y+24
    04919 8D79      LDD	R23,Y+25
    0491A 01CB      MOVW	R24,R22
    0491B 9701      SBIW	R24,1
    0491C 8F99      STD	Y+25,R25
    0491D 8F88      STD	Y+24,R24
    0491E 3060      CPI	R22,0
    0491F 0767      CPC	R22,R23
    04920 F729      BNE	0x4906
    04921 FEA2      SBRS	R10,2
    04922 C069      RJMP	0x498C
    04923 C00F      RJMP	0x4933
    04924 E200      LDI	R16,0x20
    04925 A1EE      LDD	R30,Y+38
    04926 A1FF      LDD	R31,Y+39
    04927 940E 4B54 CALL	xicallx
    04929 898E      LDD	R24,Y+22
    0492A 899F      LDD	R25,Y+23
    0492B 9601      ADIW	R24,1
    0492C 8B9F      STD	Y+23,R25
    0492D 8B8E      STD	Y+22,R24
    0492E 898C      LDD	R24,Y+20
    0492F 899D      LDD	R25,Y+21
    04930 9701      SBIW	R24,1
    04931 8B9D      STD	Y+21,R25
    04932 8B8C      STD	Y+20,R24
    04933 2422      CLR	R2
    04934 2433      CLR	R3
    04935 880C      LDD	R0,Y+20
    04936 881D      LDD	R1,Y+21
    04937 1420      CP	R2,R0
    04938 0431      CPC	R3,R1
    04939 F354      BLT	0x4924
    0493A C051      RJMP	0x498C
    0493B E061      LDI	R22,1
    0493C E070      LDI	R23,0
    0493D C00B      RJMP	0x4949
    0493E E062      LDI	R22,2
    0493F E070      LDI	R23,0
    04940 C008      RJMP	0x4949
    04941 2766      CLR	R22
    04942 2777      CLR	R23
    04943 C005      RJMP	0x4949
    04944 E063      LDI	R22,3
    04945 E070      LDI	R23,0
    04946 C002      RJMP	0x4949
    04947 E064      LDI	R22,4
    04948 E070      LDI	R23,0
    04949 A58A      LDD	R24,Y+42
    0494A A59B      LDD	R25,Y+43
    0494B 9604      ADIW	R24,4
    0494C A79B      STD	Y+43,R25
    0494D A78A      STD	Y+42,R24
    0494E 01FC      MOVW	R30,R24
    0494F 9734      SBIW	R30,4
    04950 8020      LD	R2,Z
    04951 8031      LDD	R3,Z+1
    04952 8042      LDD	R4,Z+2
    04953 8053      LDD	R5,Z+3
    04954 8A28      STD	Y+16,R2
    04955 8A39      STD	Y+17,R3
    04956 8A4A      STD	Y+18,R4
    04957 8A5B      STD	Y+19,R5
    04958 8D88      LDD	R24,Y+24
    04959 8D99      LDD	R25,Y+25
    0495A 3F8F      CPI	R24,0xFF
    0495B EFEF      LDI	R30,0xFF
    0495C 079E      CPC	R25,R30
    0495D F421      BNE	0x4962
    0495E E086      LDI	R24,6
    0495F E090      LDI	R25,0
    04960 8F99      STD	Y+25,R25
    04961 8F88      STD	Y+24,R24
    04962 8C08      LDD	R0,Y+24
    04963 8C19      LDD	R1,Y+25
    04964 8619      STD	Y+9,R1
    04965 8608      STD	Y+8,R0
    04966 880C      LDD	R0,Y+20
    04967 881D      LDD	R1,Y+21
    04968 821F      STD	Y+7,R1
    04969 820E      STD	Y+6,R0
    0496A 82BD      STD	Y+5,R11
    0496B 82AC      STD	Y+4,R10
    0496C 8828      LDD	R2,Y+16
    0496D 8839      LDD	R3,Y+17
    0496E 884A      LDD	R4,Y+18
    0496F 885B      LDD	R5,Y+19
    04970 8228      ST	Y,R2
    04971 8239      STD	Y+1,R3
    04972 824A      STD	Y+2,R4
    04973 825B      STD	Y+3,R5
    04974 019B      MOVW	R18,R22
    04975 E202      LDI	R16,0x22
    04976 E019      LDI	R17,0x9
    04977 940E 52C8 CALL	__FormatFP_1
    04979 01B8      MOVW	R22,R16
    0497A 017B      MOVW	R14,R22
    0497B C00C      RJMP	0x4988
    0497C 01F7      MOVW	R30,R14
    0497D 9101      LD	R16,Z+
    0497E 017F      MOVW	R14,R30
    0497F A1EE      LDD	R30,Y+38
    04980 A1FF      LDD	R31,Y+39
    04981 940E 4B54 CALL	xicallx
    04983 898E      LDD	R24,Y+22
    04984 899F      LDD	R25,Y+23
    04985 9601      ADIW	R24,1
    04986 8B9F      STD	Y+23,R25
    04987 8B8E      STD	Y+22,R24
    04988 01F7      MOVW	R30,R14
    04989 8020      LD	R2,Z
    0498A 2022      TST	R2
    0498B F781      BNE	0x497C
    0498C A588      LDD	R24,Y+40
    0498D A599      LDD	R25,Y+41
    0498E 9601      ADIW	R24,1
    0498F A799      STD	Y+41,R25
    04990 A788      STD	Y+40,R24
    04991 A5E8      LDD	R30,Y+40
    04992 A5F9      LDD	R31,Y+41
    04993 8020      LD	R2,Z
    04994 2022      TST	R2
    04995 F009      BEQ	0x4997
    04996 CBA4      RJMP	0x453B
    04997 890E      LDD	R16,Y+22
    04998 891F      LDD	R17,Y+23
    04999 966C      ADIW	R28,0x1C
    0499A 940E 4AFC CALL	pop_xgsetF0FC
    0499C 9624      ADIW	R28,4
    0499D 9508      RET
_memset:
    0499E 8188      LD	R24,Y
    0499F 8199      LDD	R25,Y+1
    049A0 3080      CPI	R24,0
    049A1 0789      CPC	R24,R25
    049A2 F029      BEQ	0x49A8
    049A3 2FE0      MOV	R30,R16
    049A4 2FF1      MOV	R31,R17
    049A5 9321      ST	Z+,R18
    049A6 9701      SBIW	R24,1
    049A7 F7E9      BNE	0x49A5
    049A8 9508      RET
_strcat:
    049A9 2FA0      MOV	R26,R16
    049AA 2FB1      MOV	R27,R17
    049AB 2FE2      MOV	R30,R18
    049AC 2FF3      MOV	R31,R19
    049AD 912D      LD	R18,X+
    049AE 2322      TST	R18
    049AF F7E9      BNE	0x49AD
    049B0 9711      SBIW	R26,1
    049B1 9121      LD	R18,Z+
    049B2 932D      ST	X+,R18
    049B3 2322      TST	R18
    049B4 F7E1      BNE	0x49B1
    049B5 9508      RET
_strlen:
    049B6 2FE0      MOV	R30,R16
    049B7 2FF1      MOV	R31,R17
    049B8 27AA      CLR	R26
    049B9 27BB      CLR	R27
    049BA 9001      LD	R0,Z+
    049BB 2000      TST	R0
    049BC F011      BEQ	0x49BF
    049BD 9611      ADIW	R26,1
    049BE CFFB      RJMP	0x49BA
    049BF 2F0A      MOV	R16,R26
    049C0 2F1B      MOV	R17,R27
    049C1 9508      RET
push_arg4:
    049C2 933A      ST	-Y,R19
    049C3 932A      ST	-Y,R18
push_arg2:
    049C4 931A      ST	-Y,R17
    049C5 930A      ST	-Y,R16
    049C6 9508      RET
asr32:
    049C7 920F      PUSH	R0
    049C8 9009      LD	R0,Y+
    049C9 2000      TST	R0
    049CA F031      BEQ	0x49D1
    049CB 9535      ASR	R19
    049CC 9527      ROR	R18
    049CD 9517      ROR	R17
    049CE 9507      ROR	R16
    049CF 940A      DEC	R0
    049D0 CFF8      RJMP	0x49C9
    049D1 900F      POP	R0
    049D2 9508      RET
mod16s:
    049D3 9468      BSET	6
    049D4 92DA      ST	-Y,R13
    049D5 2ED1      MOV	R13,R17
    049D6 C004      RJMP	0x49DB
div16s:
    049D7 94E8      BCLR	6
    049D8 92DA      ST	-Y,R13
    049D9 2ED1      MOV	R13,R17
    049DA 26D3      EOR	R13,R19
    049DB FF17      SBRS	R17,7
    049DC C004      RJMP	0x49E1
    049DD 9510      COM	R17
    049DE 9500      COM	R16
    049DF 5F0F      SUBI	R16,0xFF
    049E0 4F1F      SBCI	R17,0xFF
    049E1 FF37      SBRS	R19,7
    049E2 C004      RJMP	0x49E7
    049E3 9530      COM	R19
    049E4 9520      COM	R18
    049E5 5F2F      SUBI	R18,0xFF
    049E6 4F3F      SBCI	R19,0xFF
    049E7 940E 49F4 CALL	xdiv16u
    049E9 FED7      SBRS	R13,7
    049EA C004      RJMP	0x49EF
    049EB 9510      COM	R17
    049EC 9500      COM	R16
    049ED 5F0F      SUBI	R16,0xFF
    049EE 4F1F      SBCI	R17,0xFF
    049EF 90D9      LD	R13,Y+
    049F0 9508      RET
mod16u:
    049F1 9468      BSET	6
    049F2 C001      RJMP	xdiv16u
div16u:
    049F3 94E8      BCLR	6
xdiv16u:
    049F4 92EA      ST	-Y,R14
    049F5 92FA      ST	-Y,R15
    049F6 938A      ST	-Y,R24
    049F7 24EE      CLR	R14
    049F8 24FF      CLR	R15
    049F9 E180      LDI	R24,0x10
    049FA 0F00      LSL	R16
    049FB 1F11      ROL	R17
    049FC 1CEE      ROL	R14
    049FD 1CFF      ROL	R15
    049FE 16E2      CP	R14,R18
    049FF 06F3      CPC	R15,R19
    04A00 F018      BCS	0x4A04
    04A01 1AE2      SUB	R14,R18
    04A02 0AF3      SBC	R15,R19
    04A03 9503      INC	R16
    04A04 958A      DEC	R24
    04A05 F7A1      BNE	0x49FA
    04A06 F416      BRTC	0x4A09
    04A07 2D0E      MOV	R16,R14
    04A08 2D1F      MOV	R17,R15
    04A09 9189      LD	R24,Y+
    04A0A 90F9      LD	R15,Y+
    04A0B 90E9      LD	R14,Y+
    04A0C 9508      RET
div32u:
    04A0D 94E8      BCLR	6
    04A0E C001      RJMP	0x4A10
mod32u:
    04A0F 9468      BSET	6
    04A10 D030      RCALL	long_div_prolog
    04A11 24CC      CLR	R12
    04A12 C009      RJMP	0x4A1C
div32s:
    04A13 94E8      BCLR	6
    04A14 C001      RJMP	0x4A16
mod32s:
    04A15 9468      BSET	6
    04A16 D02A      RCALL	long_div_prolog
    04A17 FD37      SBRC	R19,7
    04A18 940E 4B5D CALL	neg32
    04A1A FDB7      SBRC	R27,7
    04A1B D052      RCALL	neg_R24_R27
    04A1C 2477      CLR	R7
    04A1D 2488      CLR	R8
    04A1E 2499      CLR	R9
    04A1F 24AA      CLR	R10
    04A20 24BB      CLR	R11
    04A21 D042      RCALL	tst_R16_R19
    04A22 F0C1      BEQ	0x4A3B
    04A23 D045      RCALL	tst_R24_R27
    04A24 F0B1      BEQ	0x4A3B
    04A25 E2E8      LDI	R30,0x28
    04A26 0F00      LSL	R16
    04A27 1F11      ROL	R17
    04A28 1F22      ROL	R18
    04A29 1F33      ROL	R19
    04A2A 1C77      ROL	R7
    04A2B 1C88      ROL	R8
    04A2C 1C99      ROL	R9
    04A2D 1CAA      ROL	R10
    04A2E 1CBB      ROL	R11
    04A2F 1688      CP	R8,R24
    04A30 0699      CPC	R9,R25
    04A31 06AA      CPC	R10,R26
    04A32 06BB      CPC	R11,R27
    04A33 F028      BCS	0x4A39
    04A34 1A88      SUB	R8,R24
    04A35 0A99      SBC	R9,R25
    04A36 0AAA      SBC	R10,R26
    04A37 0ABB      SBC	R11,R27
    04A38 9503      INC	R16
    04A39 95EA      DEC	R30
    04A3A F759      BNE	0x4A26
    04A3B F426      BRTC	0x4A40
    04A3C 2D08      MOV	R16,R8
    04A3D 2D19      MOV	R17,R9
    04A3E 2D2A      MOV	R18,R10
    04A3F 2D3B      MOV	R19,R11
    04A40 C013      RJMP	long_div_epilog
long_div_prolog:
    04A41 927A      ST	-Y,R7
    04A42 928A      ST	-Y,R8
    04A43 929A      ST	-Y,R9
    04A44 92AA      ST	-Y,R10
    04A45 92BA      ST	-Y,R11
    04A46 92CA      ST	-Y,R12
    04A47 93EA      ST	-Y,R30
    04A48 938A      ST	-Y,R24
    04A49 939A      ST	-Y,R25
    04A4A 93AA      ST	-Y,R26
    04A4B 93BA      ST	-Y,R27
    04A4C 858B      LDD	R24,Y+11
    04A4D 859C      LDD	R25,Y+12
    04A4E 85AD      LDD	R26,Y+13
    04A4F 85BE      LDD	R27,Y+14
    04A50 2EC3      MOV	R12,R19
    04A51 F00E      BRTS	0x4A53
    04A52 26CB      EOR	R12,R27
    04A53 9508      RET
long_div_epilog:
    04A54 FCC7      SBRC	R12,7
    04A55 940E 4B5D CALL	neg32
    04A57 91B9      LD	R27,Y+
    04A58 91A9      LD	R26,Y+
    04A59 9199      LD	R25,Y+
    04A5A 9189      LD	R24,Y+
    04A5B 91E9      LD	R30,Y+
    04A5C 90C9      LD	R12,Y+
    04A5D 90B9      LD	R11,Y+
    04A5E 90A9      LD	R10,Y+
    04A5F 9099      LD	R9,Y+
    04A60 9089      LD	R8,Y+
    04A61 9079      LD	R7,Y+
    04A62 9624      ADIW	R28,4
    04A63 9508      RET
tst_R16_R19:
    04A64 2FE0      MOV	R30,R16
    04A65 2BE1      OR	R30,R17
    04A66 2BE2      OR	R30,R18
    04A67 2BE3      OR	R30,R19
    04A68 9508      RET
tst_R24_R27:
    04A69 2FE8      MOV	R30,R24
    04A6A 2BE9      OR	R30,R25
    04A6B 2BEA      OR	R30,R26
    04A6C 2BEB      OR	R30,R27
    04A6D 9508      RET
neg_R24_R27:
    04A6E 9580      COM	R24
    04A6F 9590      COM	R25
    04A70 95A0      COM	R26
    04A71 95B0      COM	R27
    04A72 5F8F      SUBI	R24,0xFF
    04A73 4F9F      SBCI	R25,0xFF
    04A74 4FAF      SBCI	R26,0xFF
    04A75 4FBF      SBCI	R27,0xFF
    04A76 9508      RET
mod8u:
    04A77 9468      BSET	6
    04A78 C001      RJMP	xdiv8u
div8u:
    04A79 94E8      BCLR	6
xdiv8u:
    04A7A 932A      ST	-Y,R18
    04A7B 92FA      ST	-Y,R15
    04A7C 92EA      ST	-Y,R14
    04A7D 24FF      CLR	R15
    04A7E 24EE      CLR	R14
    04A7F E120      LDI	R18,0x10
    04A80 0F00      LSL	R16
    04A81 1CFF      ROL	R15
    04A82 1CEE      ROL	R14
    04A83 16E1      CP	R14,R17
    04A84 F010      BCS	0x4A87
    04A85 1AE1      SUB	R14,R17
    04A86 9503      INC	R16
    04A87 952A      DEC	R18
    04A88 F7B9      BNE	0x4A80
    04A89 F40E      BRTC	0x4A8B
    04A8A 2D0E      MOV	R16,R14
    04A8B 90E9      LD	R14,Y+
    04A8C 90F9      LD	R15,Y+
    04A8D 9129      LD	R18,Y+
    04A8E 9508      RET
elpm32:
    04A8F 93EA      ST	-Y,R30
    04A90 93FA      ST	-Y,R31
    04A91 920A      ST	-Y,R0
    04A92 2FE0      MOV	R30,R16
    04A93 2FF1      MOV	R31,R17
    04A94 95D8      ELPM
    04A95 2D00      MOV	R16,R0
    04A96 9631      ADIW	R30,1
    04A97 95D8      ELPM
    04A98 2D10      MOV	R17,R0
    04A99 9631      ADIW	R30,1
    04A9A 95D8      ELPM
    04A9B 2D20      MOV	R18,R0
    04A9C 9631      ADIW	R30,1
    04A9D 95D8      ELPM
    04A9E 2D30      MOV	R19,R0
    04A9F 9009      LD	R0,Y+
    04AA0 91F9      LD	R31,Y+
    04AA1 91E9      LD	R30,Y+
    04AA2 9508      RET
empy16s:
    04AA3 920A      ST	-Y,R0
    04AA4 921A      ST	-Y,R1
    04AA5 938A      ST	-Y,R24
    04AA6 939A      ST	-Y,R25
    04AA7 9F02      MUL	R16,R18
    04AA8 01C0      MOVW	R24,R0
    04AA9 9F12      MUL	R17,R18
    04AAA 0D90      ADD	R25,R0
    04AAB 9F03      MUL	R16,R19
    04AAC 0D90      ADD	R25,R0
    04AAD 018C      MOVW	R16,R24
    04AAE 9199      LD	R25,Y+
    04AAF 9189      LD	R24,Y+
    04AB0 9019      LD	R1,Y+
    04AB1 9009      LD	R0,Y+
    04AB2 9508      RET
empy32s|empy32u:
    04AB3 940E 4B66 CALL	long_prolog
    04AB5 927A      ST	-Y,R7
    04AB6 940E 4B7F CALL	tstzero1
    04AB8 F159      BEQ	0x4AE4
    04AB9 2477      CLR	R7
    04ABA 940E 4B85 CALL	tstzero2
    04ABC F419      BNE	0x4AC0
    04ABD 018C      MOVW	R16,R24
    04ABE 019D      MOVW	R18,R26
    04ABF C024      RJMP	0x4AE4
    04AC0 920A      ST	-Y,R0
    04AC1 921A      ST	-Y,R1
    04AC2 9F08      MUL	R16,R24
    04AC3 2CB0      MOV	R11,R0
    04AC4 2CA1      MOV	R10,R1
    04AC5 9F28      MUL	R18,R24
    04AC6 2C90      MOV	R9,R0
    04AC7 2C81      MOV	R8,R1
    04AC8 9F18      MUL	R17,R24
    04AC9 0CA0      ADD	R10,R0
    04ACA 1C91      ADC	R9,R1
    04ACB 1C87      ADC	R8,R7
    04ACC 9F09      MUL	R16,R25
    04ACD 0CA0      ADD	R10,R0
    04ACE 1C91      ADC	R9,R1
    04ACF 1C87      ADC	R8,R7
    04AD0 9F19      MUL	R17,R25
    04AD1 0C90      ADD	R9,R0
    04AD2 1C81      ADC	R8,R1
    04AD3 9F0A      MUL	R16,R26
    04AD4 0C90      ADD	R9,R0
    04AD5 1C81      ADC	R8,R1
    04AD6 9F38      MUL	R19,R24
    04AD7 0C80      ADD	R8,R0
    04AD8 9F29      MUL	R18,R25
    04AD9 0C80      ADD	R8,R0
    04ADA 9F1A      MUL	R17,R26
    04ADB 0C80      ADD	R8,R0
    04ADC 9F0B      MUL	R16,R27
    04ADD 0C80      ADD	R8,R0
    04ADE 9019      LD	R1,Y+
    04ADF 9009      LD	R0,Y+
    04AE0 2D0B      MOV	R16,R11
    04AE1 2D1A      MOV	R17,R10
    04AE2 2D29      MOV	R18,R9
    04AE3 2D38      MOV	R19,R8
    04AE4 9079      LD	R7,Y+
    04AE5 940C 4B74 JMP	long_epilog
pop_xgset003C:
    04AE7 90A9      LD	R10,Y+
    04AE8 90B9      LD	R11,Y+
    04AE9 90C9      LD	R12,Y+
    04AEA 90D9      LD	R13,Y+
    04AEB 9508      RET
pop_xgset00FC:
    04AEC 90A9      LD	R10,Y+
    04AED 90B9      LD	R11,Y+
    04AEE 90C9      LD	R12,Y+
    04AEF 90D9      LD	R13,Y+
    04AF0 90E9      LD	R14,Y+
    04AF1 90F9      LD	R15,Y+
    04AF2 9508      RET
pop_xgset30FC:
    04AF3 90A9      LD	R10,Y+
    04AF4 90B9      LD	R11,Y+
    04AF5 90C9      LD	R12,Y+
    04AF6 90D9      LD	R13,Y+
    04AF7 90E9      LD	R14,Y+
    04AF8 90F9      LD	R15,Y+
    04AF9 9149      LD	R20,Y+
    04AFA 9159      LD	R21,Y+
    04AFB 9508      RET
pop_xgsetF0FC:
    04AFC 90A9      LD	R10,Y+
    04AFD 90B9      LD	R11,Y+
    04AFE 90C9      LD	R12,Y+
    04AFF 90D9      LD	R13,Y+
    04B00 90E9      LD	R14,Y+
    04B01 90F9      LD	R15,Y+
    04B02 9149      LD	R20,Y+
    04B03 9159      LD	R21,Y+
    04B04 9169      LD	R22,Y+
    04B05 9179      LD	R23,Y+
    04B06 9508      RET
push_xgsetF0FC:
    04B07 937A      ST	-Y,R23
    04B08 936A      ST	-Y,R22
push_xgset30FC:
    04B09 935A      ST	-Y,R21
    04B0A 934A      ST	-Y,R20
push_xgset00FC:
    04B0B 92FA      ST	-Y,R15
    04B0C 92EA      ST	-Y,R14
push_xgset003C:
    04B0D 92DA      ST	-Y,R13
    04B0E 92CA      ST	-Y,R12
    04B0F 92BA      ST	-Y,R11
    04B10 92AA      ST	-Y,R10
    04B11 9508      RET
push_xgset300C:
    04B12 935A      ST	-Y,R21
    04B13 934A      ST	-Y,R20
    04B14 92BA      ST	-Y,R11
    04B15 92AA      ST	-Y,R10
    04B16 9508      RET
pop_xgset300C:
    04B17 90A9      LD	R10,Y+
    04B18 90B9      LD	R11,Y+
    04B19 9149      LD	R20,Y+
    04B1A 9159      LD	R21,Y+
    04B1B 9508      RET
push_xgsetF000:
    04B1C 937A      ST	-Y,R23
    04B1D 936A      ST	-Y,R22
    04B1E 935A      ST	-Y,R21
    04B1F 934A      ST	-Y,R20
    04B20 9508      RET
pop_xgsetF000:
    04B21 9149      LD	R20,Y+
    04B22 9159      LD	R21,Y+
    04B23 9169      LD	R22,Y+
    04B24 9179      LD	R23,Y+
    04B25 9508      RET
push_xgsetF00C:
    04B26 937A      ST	-Y,R23
    04B27 936A      ST	-Y,R22
    04B28 935A      ST	-Y,R21
    04B29 934A      ST	-Y,R20
    04B2A 92BA      ST	-Y,R11
    04B2B 92AA      ST	-Y,R10
    04B2C 9508      RET
pop_xgsetF00C:
    04B2D 90A9      LD	R10,Y+
    04B2E 90B9      LD	R11,Y+
    04B2F 9149      LD	R20,Y+
    04B30 9159      LD	R21,Y+
    04B31 9169      LD	R22,Y+
    04B32 9179      LD	R23,Y+
    04B33 9508      RET
push_xgset303C:
    04B34 935A      ST	-Y,R21
    04B35 934A      ST	-Y,R20
    04B36 92DA      ST	-Y,R13
    04B37 92CA      ST	-Y,R12
    04B38 92BA      ST	-Y,R11
    04B39 92AA      ST	-Y,R10
    04B3A 9508      RET
pop_xgset303C:
    04B3B 90A9      LD	R10,Y+
    04B3C 90B9      LD	R11,Y+
    04B3D 90C9      LD	R12,Y+
    04B3E 90D9      LD	R13,Y+
    04B3F 9149      LD	R20,Y+
    04B40 9159      LD	R21,Y+
    04B41 9508      RET
push_xgsetF03C:
    04B42 937A      ST	-Y,R23
    04B43 936A      ST	-Y,R22
    04B44 935A      ST	-Y,R21
    04B45 934A      ST	-Y,R20
    04B46 92DA      ST	-Y,R13
    04B47 92CA      ST	-Y,R12
    04B48 92BA      ST	-Y,R11
    04B49 92AA      ST	-Y,R10
    04B4A 9508      RET
pop_xgsetF03C:
    04B4B 90A9      LD	R10,Y+
    04B4C 90B9      LD	R11,Y+
    04B4D 90C9      LD	R12,Y+
    04B4E 90D9      LD	R13,Y+
    04B4F 9149      LD	R20,Y+
    04B50 9159      LD	R21,Y+
    04B51 9169      LD	R22,Y+
    04B52 9179      LD	R23,Y+
    04B53 9508      RET
xicallx:
    04B54 920A      ST	-Y,R0
    04B55 95D8      ELPM
    04B56 920A      ST	-Y,R0
    04B57 9631      ADIW	R30,1
    04B58 95D8      ELPM
    04B59 2DF0      MOV	R31,R0
    04B5A 91E9      LD	R30,Y+
    04B5B 9009      LD	R0,Y+
    04B5C 9409      IJMP
neg32:
    04B5D 9500      COM	R16
    04B5E 9510      COM	R17
    04B5F 9520      COM	R18
    04B60 9530      COM	R19
    04B61 5F0F      SUBI	R16,0xFF
    04B62 4F1F      SBCI	R17,0xFF
    04B63 4F2F      SBCI	R18,0xFF
    04B64 4F3F      SBCI	R19,0xFF
    04B65 9508      RET
long_prolog:
    04B66 928A      ST	-Y,R8
    04B67 929A      ST	-Y,R9
    04B68 92AA      ST	-Y,R10
    04B69 92BA      ST	-Y,R11
    04B6A 93EA      ST	-Y,R30
    04B6B 938A      ST	-Y,R24
    04B6C 939A      ST	-Y,R25
    04B6D 93AA      ST	-Y,R26
    04B6E 93BA      ST	-Y,R27
    04B6F 8589      LDD	R24,Y+9
    04B70 859A      LDD	R25,Y+10
    04B71 85AB      LDD	R26,Y+11
    04B72 85BC      LDD	R27,Y+12
    04B73 9508      RET
long_epilog:
    04B74 91B9      LD	R27,Y+
    04B75 91A9      LD	R26,Y+
    04B76 9199      LD	R25,Y+
    04B77 9189      LD	R24,Y+
    04B78 91E9      LD	R30,Y+
    04B79 90B9      LD	R11,Y+
    04B7A 90A9      LD	R10,Y+
    04B7B 9099      LD	R9,Y+
    04B7C 9089      LD	R8,Y+
    04B7D 9624      ADIW	R28,4
    04B7E 9508      RET
tstzero1:
    04B7F 27EE      CLR	R30
    04B80 2BE0      OR	R30,R16
    04B81 2BE1      OR	R30,R17
    04B82 2BE2      OR	R30,R18
    04B83 2BE3      OR	R30,R19
    04B84 9508      RET
tstzero2:
    04B85 27EE      CLR	R30
    04B86 2BE8      OR	R30,R24
    04B87 2BE9      OR	R30,R25
    04B88 2BEA      OR	R30,R26
    04B89 2BEB      OR	R30,R27
    04B8A 9508      RET
lsl16:
    04B8B 2322      TST	R18
    04B8C F021      BEQ	0x4B91
    04B8D 0F00      LSL	R16
    04B8E 1F11      ROL	R17
    04B8F 952A      DEC	R18
    04B90 CFFA      RJMP	lsl16
    04B91 9508      RET
lsl32:
    04B92 920F      PUSH	R0
    04B93 9009      LD	R0,Y+
    04B94 2000      TST	R0
    04B95 F031      BEQ	0x4B9C
    04B96 0F00      LSL	R16
    04B97 1F11      ROL	R17
    04B98 1F22      ROL	R18
    04B99 1F33      ROL	R19
    04B9A 940A      DEC	R0
    04B9B CFF8      RJMP	0x4B94
    04B9C 900F      POP	R0
    04B9D 9508      RET
lsl8:
    04B9E 2311      TST	R17
    04B9F F019      BEQ	0x4BA3
    04BA0 0F00      LSL	R16
    04BA1 951A      DEC	R17
    04BA2 CFFB      RJMP	lsl8
    04BA3 9508      RET
lsr16:
    04BA4 2322      TST	R18
    04BA5 F021      BEQ	0x4BAA
    04BA6 9516      LSR	R17
    04BA7 9507      ROR	R16
    04BA8 952A      DEC	R18
    04BA9 CFFA      RJMP	lsr16
    04BAA 9508      RET
lsr32:
    04BAB 920F      PUSH	R0
    04BAC 9009      LD	R0,Y+
    04BAD 2000      TST	R0
    04BAE F031      BEQ	0x4BB5
    04BAF 9536      LSR	R19
    04BB0 9527      ROR	R18
    04BB1 9517      ROR	R17
    04BB2 9507      ROR	R16
    04BB3 940A      DEC	R0
    04BB4 CFF8      RJMP	0x4BAD
    04BB5 900F      POP	R0
    04BB6 9508      RET
asgnblk:
    04BB7 93AA      ST	-Y,R26
    04BB8 93BA      ST	-Y,R27
    04BB9 93EA      ST	-Y,R30
    04BBA 93FA      ST	-Y,R31
    04BBB 920A      ST	-Y,R0
    04BBC 81AF      LDD	R26,Y+7
    04BBD 85B8      LDD	R27,Y+8
    04BBE 81ED      LDD	R30,Y+5
    04BBF 81FE      LDD	R31,Y+6
    04BC0 3000      CPI	R16,0
    04BC1 0701      CPC	R16,R17
    04BC2 F029      BEQ	0x4BC8
    04BC3 9001      LD	R0,Z+
    04BC4 920D      ST	X+,R0
    04BC5 5001      SUBI	R16,1
    04BC6 4010      SBCI	R17,0
    04BC7 CFF8      RJMP	0x4BC0
    04BC8 9009      LD	R0,Y+
    04BC9 91F9      LD	R31,Y+
    04BCA 91E9      LD	R30,Y+
    04BCB 91B9      LD	R27,Y+
    04BCC 91A9      LD	R26,Y+
    04BCD 9624      ADIW	R28,4
    04BCE 9508      RET
fpsub:
    04BCF 9468      BSET	6
    04BD0 C001      RJMP	fpadd_alt
fpadd:
    04BD1 94E8      BCLR	6
fpadd_alt:
    04BD2 940E 4DDC CALL	saveFPRegs
    04BD4 940E 4D6E CALL	unpacks
    04BD6 F409      BNE	0x4BD8
    04BD7 C048      RJMP	0x4C20
    04BD8 2CE6      MOV	R14,R6
    04BD9 2CD5      MOV	R13,R5
    04BDA 2CC4      MOV	R12,R4
    04BDB 2EB3      MOV	R11,R19
    04BDC 2EA2      MOV	R10,R18
    04BDD 2E91      MOV	R9,R17
    04BDE 2E80      MOV	R8,R16
    04BDF 8100      LD	R16,Z
    04BE0 8111      LDD	R17,Z+1
    04BE1 8122      LDD	R18,Z+2
    04BE2 8133      LDD	R19,Z+3
    04BE3 940E 4D6E CALL	unpacks
    04BE5 F409      BNE	0x4BE7
    04BE6 C044      RJMP	0x4C2B
    04BE7 2D84      MOV	R24,R4
    04BE8 2D95      MOV	R25,R5
    04BE9 198C      SUB	R24,R12
    04BEA 099D      SBC	R25,R13
    04BEB F0B9      BEQ	0x4C03
    04BEC F472      BPL	0x4BFB
    04BED 9590      COM	R25
    04BEE 9580      COM	R24
    04BEF 9601      ADIW	R24,1
    04BF0 2C4C      MOV	R4,R12
    04BF1 2C5D      MOV	R5,R13
    04BF2 3188      CPI	R24,0x18
    04BF3 F5B8      BCC	0x4C2B
    04BF4 9535      ASR	R19
    04BF5 9527      ROR	R18
    04BF6 9517      ROR	R17
    04BF7 9507      ROR	R16
    04BF8 9701      SBIW	R24,1
    04BF9 F7D1      BNE	0x4BF4
    04BFA C008      RJMP	0x4C03
    04BFB 3188      CPI	R24,0x18
    04BFC F518      BCC	0x4C20
    04BFD 94B5      ASR	R11
    04BFE 94A7      ROR	R10
    04BFF 9497      ROR	R9
    04C00 9487      ROR	R8
    04C01 9701      SBIW	R24,1
    04C02 F7D1      BNE	0x4BFD
    04C03 2466      CLR	R6
    04C04 F02E      BRTS	0x4C0A
    04C05 0D08      ADD	R16,R8
    04C06 1D19      ADC	R17,R9
    04C07 1D2A      ADC	R18,R10
    04C08 1D3B      ADC	R19,R11
    04C09 C009      RJMP	0x4C13
    04C0A 1A80      SUB	R8,R16
    04C0B 0A91      SBC	R9,R17
    04C0C 0AA2      SBC	R10,R18
    04C0D 0AB3      SBC	R11,R19
    04C0E 2D08      MOV	R16,R8
    04C0F 2D19      MOV	R17,R9
    04C10 2D2A      MOV	R18,R10
    04C11 2D3B      MOV	R19,R11
    04C12 2333      TST	R19
    04C13 F422      BPL	0x4C18
    04C14 940E 4B5D CALL	neg32
    04C16 E880      LDI	R24,0x80
    04C17 2E68      MOV	R6,R24
    04C18 940E 4D97 CALL	normalize_and_pack
    04C1A C002      RJMP	0x4C1D
    04C1B 940E 4DCC CALL	pack
    04C1D 940E 4DEB CALL	restoreFPRegs
    04C1F 9508      RET
    04C20 8100      LD	R16,Z
    04C21 8111      LDD	R17,Z+1
    04C22 8122      LDD	R18,Z+2
    04C23 8133      LDD	R19,Z+3
    04C24 F7C6      BRTC	0x4C1D
    04C25 940E 4D76 CALL	tstR16_R19
    04C27 F3A9      BEQ	0x4C1D
    04C28 E880      LDI	R24,0x80
    04C29 2738      EOR	R19,R24
    04C2A CFF2      RJMP	0x4C1D
    04C2B 2D08      MOV	R16,R8
    04C2C 2D19      MOV	R17,R9
    04C2D 2D2A      MOV	R18,R10
    04C2E 2D3B      MOV	R19,R11
    04C2F 2C4C      MOV	R4,R12
    04C30 2C5D      MOV	R5,R13
    04C31 2C6E      MOV	R6,R14
    04C32 2333      TST	R19
    04C33 F73A      BPL	0x4C1B
    04C34 940E 4B5D CALL	neg32
    04C36 E880      LDI	R24,0x80
    04C37 2E68      MOV	R6,R24
    04C38 CFE2      RJMP	0x4C1B
fpadd1:
    04C39 93FA      ST	-Y,R31
    04C3A 93EA      ST	-Y,R30
    04C3B 81EA      LDD	R30,Y+2
    04C3C 81FB      LDD	R31,Y+3
    04C3D 940E 4BD1 CALL	fpadd
    04C3F 91E9      LD	R30,Y+
    04C40 91F9      LD	R31,Y+
    04C41 9622      ADIW	R28,2
    04C42 9508      RET
fpadd2:
    04C43 93FA      ST	-Y,R31
    04C44 93EA      ST	-Y,R30
    04C45 2FEC      MOV	R30,R28
    04C46 2FFD      MOV	R31,R29
    04C47 9632      ADIW	R30,2
    04C48 940E 4BD1 CALL	fpadd
    04C4A 91E9      LD	R30,Y+
    04C4B 91F9      LD	R31,Y+
    04C4C 9624      ADIW	R28,4
    04C4D 9508      RET
fpsub1:
    04C4E 93FA      ST	-Y,R31
    04C4F 93EA      ST	-Y,R30
    04C50 81EA      LDD	R30,Y+2
    04C51 81FB      LDD	R31,Y+3
    04C52 940E 4BCF CALL	fpsub
    04C54 91E9      LD	R30,Y+
    04C55 91F9      LD	R31,Y+
    04C56 9622      ADIW	R28,2
    04C57 9508      RET
fpsub2:
    04C58 93FA      ST	-Y,R31
    04C59 93EA      ST	-Y,R30
    04C5A 2FEC      MOV	R30,R28
    04C5B 2FFD      MOV	R31,R29
    04C5C 9632      ADIW	R30,2
    04C5D 940E 4BCF CALL	fpsub
    04C5F 91E9      LD	R30,Y+
    04C60 91F9      LD	R31,Y+
    04C61 9624      ADIW	R28,4
    04C62 9508      RET
fpsub1x:
    04C63 93FA      ST	-Y,R31
    04C64 93EA      ST	-Y,R30
    04C65 81EA      LDD	R30,Y+2
    04C66 81FB      LDD	R31,Y+3
    04C67 940E 4BCF CALL	fpsub
    04C69 91E9      LD	R30,Y+
    04C6A 91F9      LD	R31,Y+
    04C6B 8339      STD	Y+1,R19
    04C6C 8328      ST	Y,R18
    04C6D 931A      ST	-Y,R17
    04C6E 930A      ST	-Y,R16
    04C6F 9508      RET
fpsub2x:
    04C70 93FA      ST	-Y,R31
    04C71 93EA      ST	-Y,R30
    04C72 2FEC      MOV	R30,R28
    04C73 2FFD      MOV	R31,R29
    04C74 9632      ADIW	R30,2
    04C75 940E 4BCF CALL	fpsub
    04C77 91E9      LD	R30,Y+
    04C78 91F9      LD	R31,Y+
    04C79 833B      STD	Y+3,R19
    04C7A 832A      STD	Y+2,R18
    04C7B 8319      STD	Y+1,R17
    04C7C 8308      ST	Y,R16
    04C7D 9508      RET
fpint:
    04C7E 924A      ST	-Y,R4
    04C7F 925A      ST	-Y,R5
    04C80 926A      ST	-Y,R6
    04C81 938A      ST	-Y,R24
    04C82 940E 4D7E CALL	unpacku
    04C84 F111      BEQ	0x4CA7
    04C85 2055      TST	R5
    04C86 F0E2      BMI	0x4CA3
    04C87 E18F      LDI	R24,0x1F
    04C88 1648      CP	R4,R24
    04C89 F4C0      BCC	0x4CA2
    04C8A E187      LDI	R24,0x17
    04C8B 1648      CP	R4,R24
    04C8C F0D1      BEQ	0x4CA7
    04C8D F458      BCC	0x4C99
    04C8E 9441      NEG	R4
    04C8F EE89      LDI	R24,0xE9
    04C90 1A48      SUB	R4,R24
    04C91 C005      RJMP	0x4C97
    04C92 9535      ASR	R19
    04C93 9527      ROR	R18
    04C94 9517      ROR	R17
    04C95 9507      ROR	R16
    04C96 944A      DEC	R4
    04C97 F7D1      BNE	0x4C92
    04C98 C00E      RJMP	0x4CA7
    04C99 E187      LDI	R24,0x17
    04C9A 1A48      SUB	R4,R24
    04C9B 0F00      LSL	R16
    04C9C 1F11      ROL	R17
    04C9D 1F22      ROL	R18
    04C9E 1F33      ROL	R19
    04C9F 944A      DEC	R4
    04CA0 F7D1      BNE	0x4C9B
    04CA1 C005      RJMP	0x4CA7
    04CA2 E73F      LDI	R19,0x7F
    04CA3 2F23      MOV	R18,R19
    04CA4 2F13      MOV	R17,R19
    04CA5 2F03      MOV	R16,R19
    04CA6 C004      RJMP	0x4CAB
    04CA7 2066      TST	R6
    04CA8 F011      BEQ	0x4CAB
    04CA9 940E 4B5D CALL	neg32
    04CAB 9189      LD	R24,Y+
    04CAC 9069      LD	R6,Y+
    04CAD 9059      LD	R5,Y+
    04CAE 9049      LD	R4,Y+
    04CAF 9508      RET
uint2fp:
    04CB0 9468      BSET	6
    04CB1 C001      RJMP	0x4CB3
int2fp:
    04CB2 94E8      BCLR	6
    04CB3 2722      CLR	R18
    04CB4 2733      CLR	R19
    04CB5 F046      BRTS	0x4CBE
    04CB6 FD17      SBRC	R17,7
    04CB7 9520      COM	R18
    04CB8 FD17      SBRC	R17,7
    04CB9 9530      COM	R19
    04CBA C003      RJMP	0x4CBE
ulong2fp:
    04CBB 9468      BSET	6
    04CBC C001      RJMP	0x4CBE
long2fp:
    04CBD 94E8      BCLR	6
    04CBE 924A      ST	-Y,R4
    04CBF 925A      ST	-Y,R5
    04CC0 926A      ST	-Y,R6
    04CC1 938A      ST	-Y,R24
    04CC2 E187      LDI	R24,0x17
    04CC3 2E48      MOV	R4,R24
    04CC4 2455      CLR	R5
    04CC5 2466      CLR	R6
    04CC6 F036      BRTS	0x4CCD
    04CC7 2333      TST	R19
    04CC8 F422      BPL	0x4CCD
    04CC9 940E 4B5D CALL	neg32
    04CCB E880      LDI	R24,0x80
    04CCC 2E68      MOV	R6,R24
    04CCD 940E 4D97 CALL	normalize_and_pack
    04CCF 9189      LD	R24,Y+
    04CD0 9069      LD	R6,Y+
    04CD1 9059      LD	R5,Y+
    04CD2 9049      LD	R4,Y+
    04CD3 9508      RET
fpdiv1:
    04CD4 93FA      ST	-Y,R31
    04CD5 93EA      ST	-Y,R30
    04CD6 81EA      LDD	R30,Y+2
    04CD7 81FB      LDD	R31,Y+3
    04CD8 D027      RCALL	0x4D00
    04CD9 91E9      LD	R30,Y+
    04CDA 91F9      LD	R31,Y+
    04CDB 9622      ADIW	R28,2
    04CDC 9508      RET
fpdiv2:
    04CDD 93FA      ST	-Y,R31
    04CDE 93EA      ST	-Y,R30
    04CDF 2FEC      MOV	R30,R28
    04CE0 2FFD      MOV	R31,R29
    04CE1 9632      ADIW	R30,2
    04CE2 D01D      RCALL	0x4D00
    04CE3 91E9      LD	R30,Y+
    04CE4 91F9      LD	R31,Y+
    04CE5 9624      ADIW	R28,4
    04CE6 9508      RET
fpdiv1x:
    04CE7 93FA      ST	-Y,R31
    04CE8 93EA      ST	-Y,R30
    04CE9 81EA      LDD	R30,Y+2
    04CEA 81FB      LDD	R31,Y+3
    04CEB D014      RCALL	0x4D00
    04CEC 91E9      LD	R30,Y+
    04CED 91F9      LD	R31,Y+
    04CEE 8339      STD	Y+1,R19
    04CEF 8328      ST	Y,R18
    04CF0 931A      ST	-Y,R17
    04CF1 930A      ST	-Y,R16
    04CF2 9508      RET
fpdiv2x:
    04CF3 93FA      ST	-Y,R31
    04CF4 93EA      ST	-Y,R30
    04CF5 2FEC      MOV	R30,R28
    04CF6 2FFD      MOV	R31,R29
    04CF7 9632      ADIW	R30,2
    04CF8 D007      RCALL	0x4D00
    04CF9 91E9      LD	R30,Y+
    04CFA 91F9      LD	R31,Y+
    04CFB 833B      STD	Y+3,R19
    04CFC 832A      STD	Y+2,R18
    04CFD 8319      STD	Y+1,R17
    04CFE 8308      ST	Y,R16
    04CFF 9508      RET
    04D00 920A      ST	-Y,R0
    04D01 921A      ST	-Y,R1
    04D02 922A      ST	-Y,R2
    04D03 923A      ST	-Y,R3
    04D04 940E 4DDC CALL	saveFPRegs
    04D06 933A      ST	-Y,R19
    04D07 932A      ST	-Y,R18
    04D08 931A      ST	-Y,R17
    04D09 930A      ST	-Y,R16
    04D0A 8100      LD	R16,Z
    04D0B 8111      LDD	R17,Z+1
    04D0C 8122      LDD	R18,Z+2
    04D0D 8133      LDD	R19,Z+3
    04D0E 940E 4D7E CALL	unpacku
    04D10 F409      BNE	0x4D12
    04D11 C057      RJMP	0x4D69
    04D12 2CE6      MOV	R14,R6
    04D13 2CD5      MOV	R13,R5
    04D14 2CC4      MOV	R12,R4
    04D15 2EB3      MOV	R11,R19
    04D16 2EA2      MOV	R10,R18
    04D17 2E91      MOV	R9,R17
    04D18 2E80      MOV	R8,R16
    04D19 9109      LD	R16,Y+
    04D1A 9119      LD	R17,Y+
    04D1B 9129      LD	R18,Y+
    04D1C 9139      LD	R19,Y+
    04D1D 940E 4D7E CALL	unpacku
    04D1F F1A1      BEQ	0x4D54
    04D20 246E      EOR	R6,R14
    04D21 184C      SUB	R4,R12
    04D22 085D      SBC	R5,R13
    04D23 E880      LDI	R24,0x80
    04D24 1648      CP	R4,R24
    04D25 0653      CPC	R5,R19
    04D26 F00C      BLT	0x4D28
    04D27 C033      RJMP	0x4D5B
    04D28 E881      LDI	R24,0x81
    04D29 1648      CP	R4,R24
    04D2A EF8F      LDI	R24,0xFF
    04D2B 0658      CPC	R5,R24
    04D2C F40C      BGE	0x4D2E
    04D2D C036      RJMP	0x4D64
    04D2E E280      LDI	R24,0x20
    04D2F 2433      CLR	R3
    04D30 2E23      MOV	R2,R19
    04D31 2E12      MOV	R1,R18
    04D32 2E01      MOV	R0,R17
    04D33 2F30      MOV	R19,R16
    04D34 2722      CLR	R18
    04D35 2711      CLR	R17
    04D36 2700      CLR	R16
    04D37 9426      LSR	R2
    04D38 9417      ROR	R1
    04D39 9407      ROR	R0
    04D3A 9537      ROR	R19
    04D3B 9527      ROR	R18
    04D3C 0F00      LSL	R16
    04D3D 1F11      ROL	R17
    04D3E 1F22      ROL	R18
    04D3F 1F33      ROL	R19
    04D40 1C00      ROL	R0
    04D41 1C11      ROL	R1
    04D42 1C22      ROL	R2
    04D43 1C33      ROL	R3
    04D44 F028      BCS	0x4D4A
    04D45 1808      SUB	R0,R8
    04D46 0819      SBC	R1,R9
    04D47 082A      SBC	R2,R10
    04D48 083B      SBC	R3,R11
    04D49 C004      RJMP	0x4D4E
    04D4A 0C08      ADD	R0,R8
    04D4B 1C19      ADC	R1,R9
    04D4C 1C2A      ADC	R2,R10
    04D4D 1C3B      ADC	R3,R11
    04D4E F00A      BMI	0x4D50
    04D4F 6001      ORI	R16,1
    04D50 958A      DEC	R24
    04D51 F751      BNE	0x4D3C
    04D52 940E 4D97 CALL	normalize_and_pack
    04D54 940E 4DEB CALL	restoreFPRegs
    04D56 9039      LD	R3,Y+
    04D57 9029      LD	R2,Y+
    04D58 9019      LD	R1,Y+
    04D59 9009      LD	R0,Y+
    04D5A 9508      RET
    04D5B EF0F      LDI	R16,0xFF
    04D5C 2F10      MOV	R17,R16
    04D5D E72F      LDI	R18,0x7F
    04D5E E73F      LDI	R19,0x7F
    04D5F 2066      TST	R6
    04D60 F399      BEQ	0x4D54
    04D61 940E 4B5D CALL	neg32
    04D63 CFF0      RJMP	0x4D54
    04D64 2700      CLR	R16
    04D65 2F10      MOV	R17,R16
    04D66 2F20      MOV	R18,R16
    04D67 2F30      MOV	R19,R16
    04D68 CFEB      RJMP	0x4D54
    04D69 9109      LD	R16,Y+
    04D6A 9119      LD	R17,Y+
    04D6B 9129      LD	R18,Y+
    04D6C 9139      LD	R19,Y+
    04D6D CFED      RJMP	0x4D5B
unpacks:
    04D6E D00F      RCALL	unpacku
    04D6F F029      BEQ	0x4D75
    04D70 2066      TST	R6
    04D71 F011      BEQ	0x4D74
    04D72 940E 4B5D CALL	neg32
    04D74 9498      BCLR	1
    04D75 9508      RET
tstR16_R19:
    04D76 2300      TST	R16
    04D77 F429      BNE	0x4D7D
    04D78 2311      TST	R17
    04D79 F419      BNE	0x4D7D
    04D7A 2322      TST	R18
    04D7B F409      BNE	0x4D7D
    04D7C 2333      TST	R19
    04D7D 9508      RET
unpacku:
    04D7E DFF7      RCALL	tstR16_R19
    04D7F F099      BEQ	0x4D93
    04D80 938A      ST	-Y,R24
    04D81 2E63      MOV	R6,R19
    04D82 E880      LDI	R24,0x80
    04D83 2268      AND	R6,R24
    04D84 0F22      LSL	R18
    04D85 1F33      ROL	R19
    04D86 2E43      MOV	R4,R19
    04D87 E78F      LDI	R24,0x7F
    04D88 1A48      SUB	R4,R24
    04D89 2455      CLR	R5
    04D8A 2788      CLR	R24
    04D8B 0A58      SBC	R5,R24
    04D8C 9526      LSR	R18
    04D8D E830      LDI	R19,0x80
    04D8E 2B23      OR	R18,R19
    04D8F 2733      CLR	R19
    04D90 9189      LD	R24,Y+
    04D91 9498      BCLR	1
    04D92 9508      RET
    04D93 2444      CLR	R4
    04D94 2455      CLR	R5
    04D95 2466      CLR	R6
    04D96 9508      RET
normalize_and_pack:
    04D97 DFDE      RCALL	tstR16_R19
    04D98 F409      BNE	0x4D9A
    04D99 9508      RET
    04D9A 93AA      ST	-Y,R26
    04D9B 93BA      ST	-Y,R27
    04D9C 01D2      MOVW	R26,R4
    04D9D 939A      ST	-Y,R25
    04D9E 938A      ST	-Y,R24
    04D9F E78E      LDI	R24,0x7E
    04DA0 E090      LDI	R25,0
    04DA1 2333      TST	R19
    04DA2 F049      BEQ	0x4DAC
    04DA3 9536      LSR	R19
    04DA4 9527      ROR	R18
    04DA5 9517      ROR	R17
    04DA6 9507      ROR	R16
    04DA7 17A8      CP	R26,R24
    04DA8 07B9      CPC	R27,R25
    04DA9 F4CC      BGE	0x4DC3
    04DAA 9611      ADIW	R26,1
    04DAB CFF5      RJMP	0x4DA1
    04DAC 9580      COM	R24
    04DAD 9590      COM	R25
    04DAE 9601      ADIW	R24,1
    04DAF 2322      TST	R18
    04DB0 F0BA      BMI	0x4DC8
    04DB1 0F00      LSL	R16
    04DB2 1F11      ROL	R17
    04DB3 1F22      ROL	R18
    04DB4 17A8      CP	R26,R24
    04DB5 07B9      CPC	R27,R25
    04DB6 F014      BLT	0x4DB9
    04DB7 9711      SBIW	R26,1
    04DB8 CFF6      RJMP	0x4DAF
    04DB9 2700      CLR	R16
    04DBA 2711      CLR	R17
    04DBB 2722      CLR	R18
    04DBC 2733      CLR	R19
    04DBD 9189      LD	R24,Y+
    04DBE 9199      LD	R25,Y+
    04DBF 012D      MOVW	R4,R26
    04DC0 91B9      LD	R27,Y+
    04DC1 91A9      LD	R26,Y+
    04DC2 9508      RET
    04DC3 2733      CLR	R19
    04DC4 EF0F      LDI	R16,0xFF
    04DC5 2F10      MOV	R17,R16
    04DC6 E72F      LDI	R18,0x7F
    04DC7 2F32      MOV	R19,R18
    04DC8 9189      LD	R24,Y+
    04DC9 9199      LD	R25,Y+
    04DCA 012D      MOVW	R4,R26
    04DCB C002      RJMP	0x4DCE
pack:
    04DCC 93AA      ST	-Y,R26
    04DCD 93BA      ST	-Y,R27
    04DCE DFA7      RCALL	tstR16_R19
    04DCF F049      BEQ	0x4DD9
    04DD0 01D2      MOVW	R26,R4
    04DD1 58A1      SUBI	R26,0x81
    04DD2 4FBF      SBCI	R27,0xFF
    04DD3 012D      MOVW	R4,R26
    04DD4 2D34      MOV	R19,R4
    04DD5 0F22      LSL	R18
    04DD6 9536      LSR	R19
    04DD7 9527      ROR	R18
    04DD8 2936      OR	R19,R6
    04DD9 91B9      LD	R27,Y+
    04DDA 91A9      LD	R26,Y+
    04DDB 9508      RET
saveFPRegs:
    04DDC 924A      ST	-Y,R4
    04DDD 925A      ST	-Y,R5
    04DDE 926A      ST	-Y,R6
    04DDF 927A      ST	-Y,R7
    04DE0 928A      ST	-Y,R8
    04DE1 929A      ST	-Y,R9
    04DE2 92AA      ST	-Y,R10
    04DE3 92BA      ST	-Y,R11
    04DE4 92CA      ST	-Y,R12
    04DE5 92DA      ST	-Y,R13
    04DE6 92EA      ST	-Y,R14
    04DE7 92FA      ST	-Y,R15
    04DE8 938A      ST	-Y,R24
    04DE9 939A      ST	-Y,R25
    04DEA 9508      RET
restoreFPRegs:
    04DEB 9199      LD	R25,Y+
    04DEC 9189      LD	R24,Y+
    04DED 90F9      LD	R15,Y+
    04DEE 90E9      LD	R14,Y+
    04DEF 90D9      LD	R13,Y+
    04DF0 90C9      LD	R12,Y+
    04DF1 90B9      LD	R11,Y+
    04DF2 90A9      LD	R10,Y+
    04DF3 9099      LD	R9,Y+
    04DF4 9089      LD	R8,Y+
    04DF5 9079      LD	R7,Y+
    04DF6 9069      LD	R6,Y+
    04DF7 9059      LD	R5,Y+
    04DF8 9049      LD	R4,Y+
    04DF9 9508      RET
fpmule:
    04DFA 940E 4DDC CALL	saveFPRegs
    04DFC 93AA      ST	-Y,R26
    04DFD 93BA      ST	-Y,R27
    04DFE 940E 4D7E CALL	unpacku
    04E00 F1E1      BEQ	0x4E3D
    04E01 2CE6      MOV	R14,R6
    04E02 2CD5      MOV	R13,R5
    04E03 2CC4      MOV	R12,R4
    04E04 2EB3      MOV	R11,R19
    04E05 2EA2      MOV	R10,R18
    04E06 2E91      MOV	R9,R17
    04E07 2E80      MOV	R8,R16
    04E08 8100      LD	R16,Z
    04E09 8111      LDD	R17,Z+1
    04E0A 8122      LDD	R18,Z+2
    04E0B 8133      LDD	R19,Z+3
    04E0C 940E 4D7E CALL	unpacku
    04E0E F171      BEQ	0x4E3D
    04E0F 246E      EOR	R6,R14
    04E10 0C4C      ADD	R4,R12
    04E11 1C5D      ADC	R5,R13
    04E12 E880      LDI	R24,0x80
    04E13 1648      CP	R4,R24
    04E14 0653      CPC	R5,R19
    04E15 F564      BGE	0x4E42
    04E16 E881      LDI	R24,0x81
    04E17 1648      CP	R4,R24
    04E18 EF8F      LDI	R24,0xFF
    04E19 0658      CPC	R5,R24
    04E1A F16C      BLT	0x4E48
    04E1B 9EA2      MUL	R10,R18
    04E1C 2DB1      MOV	R27,R1
    04E1D 2DA0      MOV	R26,R0
    04E1E 9E91      MUL	R9,R17
    04E1F 2D91      MOV	R25,R1
    04E20 2D80      MOV	R24,R0
    04E21 9EA0      MUL	R10,R16
    04E22 0D80      ADD	R24,R0
    04E23 1D91      ADC	R25,R1
    04E24 1FA3      ADC	R26,R19
    04E25 1FB3      ADC	R27,R19
    04E26 9E82      MUL	R8,R18
    04E27 0D80      ADD	R24,R0
    04E28 1D91      ADC	R25,R1
    04E29 1FA3      ADC	R26,R19
    04E2A 1FB3      ADC	R27,R19
    04E2B 9E92      MUL	R9,R18
    04E2C 0D90      ADD	R25,R0
    04E2D 1DA1      ADC	R26,R1
    04E2E 1FB3      ADC	R27,R19
    04E2F 9EA1      MUL	R10,R17
    04E30 0D90      ADD	R25,R0
    04E31 1DA1      ADC	R26,R1
    04E32 1FB3      ADC	R27,R19
    04E33 2F2B      MOV	R18,R27
    04E34 2F1A      MOV	R17,R26
    04E35 2F09      MOV	R16,R25
    04E36 0F88      LSL	R24
    04E37 1F00      ROL	R16
    04E38 1F11      ROL	R17
    04E39 1F22      ROL	R18
    04E3A 1F33      ROL	R19
    04E3B 940E 4D97 CALL	normalize_and_pack
    04E3D 91B9      LD	R27,Y+
    04E3E 91A9      LD	R26,Y+
    04E3F 940E 4DEB CALL	restoreFPRegs
    04E41 9508      RET
    04E42 EF0F      LDI	R16,0xFF
    04E43 2F10      MOV	R17,R16
    04E44 E72F      LDI	R18,0x7F
    04E45 E78F      LDI	R24,0x7F
    04E46 2E48      MOV	R4,R24
    04E47 CFF5      RJMP	0x4E3D
    04E48 2700      CLR	R16
    04E49 2F10      MOV	R17,R16
    04E4A 2F20      MOV	R18,R16
    04E4B 2F30      MOV	R19,R16
    04E4C CFF0      RJMP	0x4E3D
fpmule1:
    04E4D 93FA      ST	-Y,R31
    04E4E 93EA      ST	-Y,R30
    04E4F 81EA      LDD	R30,Y+2
    04E50 81FB      LDD	R31,Y+3
    04E51 940E 4DFA CALL	fpmule
    04E53 91E9      LD	R30,Y+
    04E54 91F9      LD	R31,Y+
    04E55 9622      ADIW	R28,2
    04E56 9508      RET
fpmule2:
    04E57 93FA      ST	-Y,R31
    04E58 93EA      ST	-Y,R30
    04E59 2FEC      MOV	R30,R28
    04E5A 2FFD      MOV	R31,R29
    04E5B 9632      ADIW	R30,2
    04E5C 940E 4DFA CALL	fpmule
    04E5E 91E9      LD	R30,Y+
    04E5F 91F9      LD	R31,Y+
    04E60 9624      ADIW	R28,4
    04E61 9508      RET
fpmule1x:
    04E62 93FA      ST	-Y,R31
    04E63 93EA      ST	-Y,R30
    04E64 81EA      LDD	R30,Y+2
    04E65 81FB      LDD	R31,Y+3
    04E66 940E 4DFA CALL	fpmule
    04E68 91E9      LD	R30,Y+
    04E69 91F9      LD	R31,Y+
    04E6A 8339      STD	Y+1,R19
    04E6B 8328      ST	Y,R18
    04E6C 931A      ST	-Y,R17
    04E6D 930A      ST	-Y,R16
    04E6E 9508      RET
fpcmp:
    04E6F 940E 4BCF CALL	fpsub
    04E71 2333      TST	R19
    04E72 F03A      BMI	0x4E7A
    04E73 940E 4D76 CALL	tstR16_R19
    04E75 F011      BEQ	0x4E78
    04E76 E001      LDI	R16,1
    04E77 9508      RET
    04E78 2700      CLR	R16
    04E79 9508      RET
    04E7A EF0F      LDI	R16,0xFF
    04E7B 9508      RET
fpcmp1:
    04E7C 93FA      ST	-Y,R31
    04E7D 93EA      ST	-Y,R30
    04E7E 81EA      LDD	R30,Y+2
    04E7F 81FB      LDD	R31,Y+3
    04E80 940E 4E6F CALL	fpcmp
    04E82 91E9      LD	R30,Y+
    04E83 91F9      LD	R31,Y+
    04E84 9622      ADIW	R28,2
    04E85 2300      TST	R16
    04E86 9508      RET
fpcmp2:
    04E87 93FA      ST	-Y,R31
    04E88 93EA      ST	-Y,R30
    04E89 2FEC      MOV	R30,R28
    04E8A 2FFD      MOV	R31,R29
    04E8B 9632      ADIW	R30,2
    04E8C 940E 4E6F CALL	fpcmp
    04E8E 91E9      LD	R30,Y+
    04E8F 91F9      LD	R31,Y+
    04E90 9624      ADIW	R28,4
    04E91 2300      TST	R16
    04E92 9508      RET
_cstrcpy:
    04E93 2FA0      MOV	R26,R16
    04E94 2FB1      MOV	R27,R17
    04E95 2FE2      MOV	R30,R18
    04E96 2FF3      MOV	R31,R19
    04E97 95C8      LPM
    04E98 9631      ADIW	R30,1
    04E99 920D      ST	X+,R0
    04E9A 2000      TST	R0
    04E9B F7D9      BNE	0x4E97
    04E9C 9508      RET
_cstrlen:
    04E9D 2FE0      MOV	R30,R16
    04E9E 2FF1      MOV	R31,R17
    04E9F 27AA      CLR	R26
    04EA0 27BB      CLR	R27
    04EA1 95C8      LPM
    04EA2 2000      TST	R0
    04EA3 F019      BEQ	0x4EA7
    04EA4 9631      ADIW	R30,1
    04EA5 9611      ADIW	R26,1
    04EA6 CFFA      RJMP	0x4EA1
    04EA7 2F0A      MOV	R16,R26
    04EA8 2F1B      MOV	R17,R27
    04EA9 9508      RET
_atoi:
    04EAA 940E 4B26 CALL	push_xgsetF00C
    04EAC 0158      MOVW	R10,R16
    04EAD C003      RJMP	0x4EB1
    04EAE 01C5      MOVW	R24,R10
    04EAF 9601      ADIW	R24,1
    04EB0 015C      MOVW	R10,R24
    04EB1 01F5      MOVW	R30,R10
    04EB2 8100      LD	R16,Z
    04EB3 2711      CLR	R17
    04EB4 940E 525D CALL	_isspace
    04EB6 3000      CPI	R16,0
    04EB7 0701      CPC	R16,R17
    04EB8 F7A9      BNE	0x4EAE
    04EB9 2766      CLR	R22
    04EBA 2777      CLR	R23
    04EBB 01F5      MOVW	R30,R10
    04EBC 8180      LD	R24,Z
    04EBD 328D      CPI	R24,0x2D
    04EBE F429      BNE	0x4EC4
    04EBF E061      LDI	R22,1
    04EC0 01CF      MOVW	R24,R30
    04EC1 9601      ADIW	R24,1
    04EC2 015C      MOVW	R10,R24
    04EC3 C007      RJMP	0x4ECB
    04EC4 01F5      MOVW	R30,R10
    04EC5 8180      LD	R24,Z
    04EC6 328B      CPI	R24,0x2B
    04EC7 F419      BNE	0x4ECB
    04EC8 01CF      MOVW	R24,R30
    04EC9 9601      ADIW	R24,1
    04ECA 015C      MOVW	R10,R24
    04ECB 2744      CLR	R20
    04ECC 2755      CLR	R21
    04ECD C00E      RJMP	0x4EDC
    04ECE E00A      LDI	R16,0xA
    04ECF E010      LDI	R17,0
    04ED0 019A      MOVW	R18,R20
    04ED1 940E 4AA3 CALL	empy16s
    04ED3 01A8      MOVW	R20,R16
    04ED4 01F5      MOVW	R30,R10
    04ED5 9021      LD	R2,Z+
    04ED6 015F      MOVW	R10,R30
    04ED7 2433      CLR	R3
    04ED8 0D42      ADD	R20,R2
    04ED9 1D53      ADC	R21,R3
    04EDA 5340      SUBI	R20,0x30
    04EDB 4050      SBCI	R21,0
    04EDC 01F5      MOVW	R30,R10
    04EDD 8100      LD	R16,Z
    04EDE 2711      CLR	R17
    04EDF 940E 5249 CALL	_isdigit
    04EE1 3000      CPI	R16,0
    04EE2 0701      CPC	R16,R17
    04EE3 F751      BNE	0x4ECE
    04EE4 3060      CPI	R22,0
    04EE5 0767      CPC	R22,R23
    04EE6 F031      BEQ	0x4EED
    04EE7 018A      MOVW	R16,R20
    04EE8 9500      COM	R16
    04EE9 9510      COM	R17
    04EEA 5F0F      SUBI	R16,0xFF
    04EEB 4F1F      SBCI	R17,0xFF
    04EEC C001      RJMP	0x4EEE
    04EED 018A      MOVW	R16,R20
    04EEE 940C 4B2D JMP	pop_xgsetF00C
_itoa:
    04EF0 940E 49C2 CALL	push_arg4
    04EF2 940E 4B07 CALL	push_xgsetF0FC
    04EF4 01A9      MOVW	R20,R18
    04EF5 84EE      LDD	R14,Y+14
    04EF6 84FF      LDD	R15,Y+15
    04EF7 015A      MOVW	R10,R20
    04EF8 20AA      TST	R10
    04EF9 F451      BNE	0x4F04
    04EFA 20BB      TST	R11
    04EFB F441      BNE	0x4F04
    04EFC E380      LDI	R24,0x30
    04EFD 85EA      LDD	R30,Y+10
    04EFE 85FB      LDD	R31,Y+11
    04EFF 8380      ST	Z,R24
    04F00 2422      CLR	R2
    04F01 8221      STD	Z+1,R2
    04F02 018F      MOVW	R16,R30
    04F03 C053      RJMP	0x4F57
    04F04 3040      CPI	R20,0
    04F05 E0E0      LDI	R30,0
    04F06 075E      CPC	R21,R30
    04F07 F46C      BGE	0x4F15
    04F08 01C7      MOVW	R24,R14
    04F09 308A      CPI	R24,0xA
    04F0A E0E0      LDI	R30,0
    04F0B 079E      CPC	R25,R30
    04F0C F441      BNE	0x4F15
    04F0D 24CC      CLR	R12
    04F0E 94C3      INC	R12
    04F0F 01C5      MOVW	R24,R10
    04F10 9580      COM	R24
    04F11 9590      COM	R25
    04F12 9601      ADIW	R24,1
    04F13 015C      MOVW	R10,R24
    04F14 C001      RJMP	0x4F16
    04F15 24CC      CLR	R12
    04F16 856A      LDD	R22,Y+10
    04F17 857B      LDD	R23,Y+11
    04F18 0197      MOVW	R18,R14
    04F19 0185      MOVW	R16,R10
    04F1A 940E 49F1 CALL	mod16u
    04F1C 01A8      MOVW	R20,R16
    04F1D E089      LDI	R24,0x9
    04F1E E090      LDI	R25,0
    04F1F 1780      CP	R24,R16
    04F20 0791      CPC	R25,R17
    04F21 F034      BLT	0x4F28
    04F22 01CA      MOVW	R24,R20
    04F23 96C0      ADIW	R24,0x30
    04F24 01FB      MOVW	R30,R22
    04F25 9381      ST	Z+,R24
    04F26 01BF      MOVW	R22,R30
    04F27 C006      RJMP	0x4F2E
    04F28 01CA      MOVW	R24,R20
    04F29 5A89      SUBI	R24,0xA9
    04F2A 4F9F      SBCI	R25,0xFF
    04F2B 01FB      MOVW	R30,R22
    04F2C 9381      ST	Z+,R24
    04F2D 01BF      MOVW	R22,R30
    04F2E 0197      MOVW	R18,R14
    04F2F 0185      MOVW	R16,R10
    04F30 940E 49F3 CALL	div16u
    04F32 0158      MOVW	R10,R16
    04F33 20AA      TST	R10
    04F34 F719      BNE	0x4F18
    04F35 20BB      TST	R11
    04F36 F709      BNE	0x4F18
    04F37 20CC      TST	R12
    04F38 F021      BEQ	0x4F3D
    04F39 E28D      LDI	R24,0x2D
    04F3A 01FB      MOVW	R30,R22
    04F3B 9381      ST	Z+,R24
    04F3C 01BF      MOVW	R22,R30
    04F3D 012B      MOVW	R4,R22
    04F3E 5061      SUBI	R22,1
    04F3F 4070      SBCI	R23,0
    04F40 2422      CLR	R2
    04F41 01F2      MOVW	R30,R4
    04F42 8220      ST	Z,R2
    04F43 84AA      LDD	R10,Y+10
    04F44 84BB      LDD	R11,Y+11
    04F45 C00C      RJMP	0x4F52
    04F46 01F5      MOVW	R30,R10
    04F47 80C0      LD	R12,Z
    04F48 01FB      MOVW	R30,R22
    04F49 8020      LD	R2,Z
    04F4A 01F5      MOVW	R30,R10
    04F4B 9221      ST	Z+,R2
    04F4C 015F      MOVW	R10,R30
    04F4D 011B      MOVW	R2,R22
    04F4E 5061      SUBI	R22,1
    04F4F 4070      SBCI	R23,0
    04F50 01F1      MOVW	R30,R2
    04F51 82C0      ST	Z,R12
    04F52 16A6      CP	R10,R22
    04F53 06B7      CPC	R11,R23
    04F54 F388      BCS	0x4F46
    04F55 850A      LDD	R16,Y+10
    04F56 851B      LDD	R17,Y+11
    04F57 940E 4AFC CALL	pop_xgsetF0FC
    04F59 9624      ADIW	R28,4
    04F5A 9508      RET
_ltoa:
    04F5B 940E 49C2 CALL	push_arg4
    04F5D 940E 4B07 CALL	push_xgsetF0FC
    04F5F 9724      SBIW	R28,4
    04F60 8828      LDD	R2,Y+16
    04F61 8839      LDD	R3,Y+17
    04F62 884A      LDD	R4,Y+18
    04F63 885B      LDD	R5,Y+19
    04F64 8228      ST	Y,R2
    04F65 8239      STD	Y+1,R3
    04F66 824A      STD	Y+2,R4
    04F67 825B      STD	Y+3,R5
    04F68 8828      LDD	R2,Y+16
    04F69 8839      LDD	R3,Y+17
    04F6A 884A      LDD	R4,Y+18
    04F6B 885B      LDD	R5,Y+19
    04F6C 9488      BCLR	0
    04F6D 2022      TST	R2
    04F6E 0432      CPC	R3,R2
    04F6F 0442      CPC	R4,R2
    04F70 0452      CPC	R5,R2
    04F71 F441      BNE	0x4F7A
    04F72 E380      LDI	R24,0x30
    04F73 85EE      LDD	R30,Y+14
    04F74 85FF      LDD	R31,Y+15
    04F75 8380      ST	Z,R24
    04F76 2422      CLR	R2
    04F77 8221      STD	Z+1,R2
    04F78 018F      MOVW	R16,R30
    04F79 C094      RJMP	0x500E
    04F7A E040      LDI	R20,0
    04F7B E050      LDI	R21,0
    04F7C E060      LDI	R22,0
    04F7D E070      LDI	R23,0
    04F7E 8828      LDD	R2,Y+16
    04F7F 8839      LDD	R3,Y+17
    04F80 884A      LDD	R4,Y+18
    04F81 885B      LDD	R5,Y+19
    04F82 1624      CP	R2,R20
    04F83 0635      CPC	R3,R21
    04F84 0646      CPC	R4,R22
    04F85 0657      CPC	R5,R23
    04F86 F4EC      BGE	0x4FA4
    04F87 898C      LDD	R24,Y+20
    04F88 899D      LDD	R25,Y+21
    04F89 308A      CPI	R24,0xA
    04F8A E0A0      LDI	R26,0
    04F8B 079A      CPC	R25,R26
    04F8C F4B9      BNE	0x4FA4
    04F8D 24AA      CLR	R10
    04F8E 94A3      INC	R10
    04F8F E041      LDI	R20,1
    04F90 E050      LDI	R21,0
    04F91 E060      LDI	R22,0
    04F92 E070      LDI	R23,0
    04F93 8028      LD	R2,Y
    04F94 8039      LDD	R3,Y+1
    04F95 804A      LDD	R4,Y+2
    04F96 805B      LDD	R5,Y+3
    04F97 9420      COM	R2
    04F98 9430      COM	R3
    04F99 9440      COM	R4
    04F9A 9450      COM	R5
    04F9B 0E24      ADD	R2,R20
    04F9C 1E35      ADC	R3,R21
    04F9D 1E46      ADC	R4,R22
    04F9E 1E57      ADC	R5,R23
    04F9F 8228      ST	Y,R2
    04FA0 8239      STD	Y+1,R3
    04FA1 824A      STD	Y+2,R4
    04FA2 825B      STD	Y+3,R5
    04FA3 C001      RJMP	0x4FA5
    04FA4 24AA      CLR	R10
    04FA5 84CE      LDD	R12,Y+14
    04FA6 84DF      LDD	R13,Y+15
    04FA7 882C      LDD	R2,Y+20
    04FA8 883D      LDD	R3,Y+21
    04FA9 2444      CLR	R4
    04FAA FC37      SBRC	R3,7
    04FAB 9440      COM	R4
    04FAC 2455      CLR	R5
    04FAD FC47      SBRC	R4,7
    04FAE 9450      COM	R5
    04FAF 8108      LD	R16,Y
    04FB0 8119      LDD	R17,Y+1
    04FB1 812A      LDD	R18,Y+2
    04FB2 813B      LDD	R19,Y+3
    04FB3 925A      ST	-Y,R5
    04FB4 924A      ST	-Y,R4
    04FB5 923A      ST	-Y,R3
    04FB6 922A      ST	-Y,R2
    04FB7 940E 4A0F CALL	mod32u
    04FB9 0178      MOVW	R14,R16
    04FBA E089      LDI	R24,0x9
    04FBB E090      LDI	R25,0
    04FBC 1780      CP	R24,R16
    04FBD 0791      CPC	R25,R17
    04FBE F034      BLT	0x4FC5
    04FBF 01C7      MOVW	R24,R14
    04FC0 96C0      ADIW	R24,0x30
    04FC1 01F6      MOVW	R30,R12
    04FC2 9381      ST	Z+,R24
    04FC3 016F      MOVW	R12,R30
    04FC4 C006      RJMP	0x4FCB
    04FC5 01C7      MOVW	R24,R14
    04FC6 5A89      SUBI	R24,0xA9
    04FC7 4F9F      SBCI	R25,0xFF
    04FC8 01F6      MOVW	R30,R12
    04FC9 9381      ST	Z+,R24
    04FCA 016F      MOVW	R12,R30
    04FCB 882C      LDD	R2,Y+20
    04FCC 883D      LDD	R3,Y+21
    04FCD 2444      CLR	R4
    04FCE FC37      SBRC	R3,7
    04FCF 9440      COM	R4
    04FD0 2455      CLR	R5
    04FD1 FC47      SBRC	R4,7
    04FD2 9450      COM	R5
    04FD3 8108      LD	R16,Y
    04FD4 8119      LDD	R17,Y+1
    04FD5 812A      LDD	R18,Y+2
    04FD6 813B      LDD	R19,Y+3
    04FD7 925A      ST	-Y,R5
    04FD8 924A      ST	-Y,R4
    04FD9 923A      ST	-Y,R3
    04FDA 922A      ST	-Y,R2
    04FDB 940E 4A0D CALL	div32u
    04FDD 8308      ST	Y,R16
    04FDE 8319      STD	Y+1,R17
    04FDF 832A      STD	Y+2,R18
    04FE0 833B      STD	Y+3,R19
    04FE1 8028      LD	R2,Y
    04FE2 8039      LDD	R3,Y+1
    04FE3 804A      LDD	R4,Y+2
    04FE4 805B      LDD	R5,Y+3
    04FE5 9488      BCLR	0
    04FE6 2022      TST	R2
    04FE7 0432      CPC	R3,R2
    04FE8 0442      CPC	R4,R2
    04FE9 0452      CPC	R5,R2
    04FEA F009      BEQ	0x4FEC
    04FEB CFBB      RJMP	0x4FA7
    04FEC 20AA      TST	R10
    04FED F021      BEQ	0x4FF2
    04FEE E28D      LDI	R24,0x2D
    04FEF 01F6      MOVW	R30,R12
    04FF0 9381      ST	Z+,R24
    04FF1 016F      MOVW	R12,R30
    04FF2 0126      MOVW	R4,R12
    04FF3 01C2      MOVW	R24,R4
    04FF4 9701      SBIW	R24,1
    04FF5 016C      MOVW	R12,R24
    04FF6 2422      CLR	R2
    04FF7 01F2      MOVW	R30,R4
    04FF8 8220      ST	Z,R2
    04FF9 84EE      LDD	R14,Y+14
    04FFA 84FF      LDD	R15,Y+15
    04FFB C00D      RJMP	0x5009
    04FFC 01F7      MOVW	R30,R14
    04FFD 80A0      LD	R10,Z
    04FFE 01F6      MOVW	R30,R12
    04FFF 8020      LD	R2,Z
    05000 01F7      MOVW	R30,R14
    05001 9221      ST	Z+,R2
    05002 017F      MOVW	R14,R30
    05003 0116      MOVW	R2,R12
    05004 01C1      MOVW	R24,R2
    05005 9701      SBIW	R24,1
    05006 016C      MOVW	R12,R24
    05007 01F1      MOVW	R30,R2
    05008 82A0      ST	Z,R10
    05009 14EC      CP	R14,R12
    0500A 04FD      CPC	R15,R13
    0500B F380      BCS	0x4FFC
    0500C 850E      LDD	R16,Y+14
    0500D 851F      LDD	R17,Y+15
    0500E 9624      ADIW	R28,4
    0500F 940E 4AFC CALL	pop_xgsetF0FC
    05011 9624      ADIW	R28,4
    05012 9508      RET
_ultoa:
    05013 933A      ST	-Y,R19
    05014 932A      ST	-Y,R18
    05015 940E 4B07 CALL	push_xgsetF0FC
    05017 0158      MOVW	R10,R16
    05018 84CE      LDD	R12,Y+14
    05019 84DF      LDD	R13,Y+15
    0501A 01A5      MOVW	R20,R10
    0501B 0116      MOVW	R2,R12
    0501C 2444      CLR	R4
    0501D FC37      SBRC	R3,7
    0501E 9440      COM	R4
    0501F 2455      CLR	R5
    05020 FC47      SBRC	R4,7
    05021 9450      COM	R5
    05022 850A      LDD	R16,Y+10
    05023 851B      LDD	R17,Y+11
    05024 852C      LDD	R18,Y+12
    05025 853D      LDD	R19,Y+13
    05026 925A      ST	-Y,R5
    05027 924A      ST	-Y,R4
    05028 923A      ST	-Y,R3
    05029 922A      ST	-Y,R2
    0502A 940E 4A0F CALL	mod32u
    0502C 01B8      MOVW	R22,R16
    0502D E089      LDI	R24,0x9
    0502E E090      LDI	R25,0
    0502F 1780      CP	R24,R16
    05030 0791      CPC	R25,R17
    05031 F034      BLT	0x5038
    05032 01CB      MOVW	R24,R22
    05033 96C0      ADIW	R24,0x30
    05034 01FA      MOVW	R30,R20
    05035 9381      ST	Z+,R24
    05036 01AF      MOVW	R20,R30
    05037 C006      RJMP	0x503E
    05038 01CB      MOVW	R24,R22
    05039 5A89      SUBI	R24,0xA9
    0503A 4F9F      SBCI	R25,0xFF
    0503B 01FA      MOVW	R30,R20
    0503C 9381      ST	Z+,R24
    0503D 01AF      MOVW	R20,R30
    0503E 0116      MOVW	R2,R12
    0503F 2444      CLR	R4
    05040 FC37      SBRC	R3,7
    05041 9440      COM	R4
    05042 2455      CLR	R5
    05043 FC47      SBRC	R4,7
    05044 9450      COM	R5
    05045 850A      LDD	R16,Y+10
    05046 851B      LDD	R17,Y+11
    05047 852C      LDD	R18,Y+12
    05048 853D      LDD	R19,Y+13
    05049 925A      ST	-Y,R5
    0504A 924A      ST	-Y,R4
    0504B 923A      ST	-Y,R3
    0504C 922A      ST	-Y,R2
    0504D 940E 4A0D CALL	div32u
    0504F 870A      STD	Y+10,R16
    05050 871B      STD	Y+11,R17
    05051 872C      STD	Y+12,R18
    05052 873D      STD	Y+13,R19
    05053 842A      LDD	R2,Y+10
    05054 843B      LDD	R3,Y+11
    05055 844C      LDD	R4,Y+12
    05056 845D      LDD	R5,Y+13
    05057 9488      BCLR	0
    05058 2022      TST	R2
    05059 0432      CPC	R3,R2
    0505A 0442      CPC	R4,R2
    0505B 0452      CPC	R5,R2
    0505C F009      BEQ	0x505E
    0505D CFBD      RJMP	0x501B
    0505E 012A      MOVW	R4,R20
    0505F 5041      SUBI	R20,1
    05060 4050      SBCI	R21,0
    05061 2422      CLR	R2
    05062 01F2      MOVW	R30,R4
    05063 8220      ST	Z,R2
    05064 0165      MOVW	R12,R10
    05065 C00C      RJMP	0x5072
    05066 01F6      MOVW	R30,R12
    05067 80E0      LD	R14,Z
    05068 01FA      MOVW	R30,R20
    05069 8020      LD	R2,Z
    0506A 01F6      MOVW	R30,R12
    0506B 9221      ST	Z+,R2
    0506C 016F      MOVW	R12,R30
    0506D 011A      MOVW	R2,R20
    0506E 5041      SUBI	R20,1
    0506F 4050      SBCI	R21,0
    05070 01F1      MOVW	R30,R2
    05071 82E0      ST	Z,R14
    05072 16C4      CP	R12,R20
    05073 06D5      CPC	R13,R21
    05074 F388      BCS	0x5066
    05075 0185      MOVW	R16,R10
    05076 940E 4AFC CALL	pop_xgsetF0FC
    05078 9622      ADIW	R28,2
    05079 9508      RET
_utoa:
    0507A 940E 4B07 CALL	push_xgsetF0FC
    0507C 0169      MOVW	R12,R18
    0507D 0158      MOVW	R10,R16
    0507E 84EA      LDD	R14,Y+10
    0507F 84FB      LDD	R15,Y+11
    05080 01A5      MOVW	R20,R10
    05081 0197      MOVW	R18,R14
    05082 0186      MOVW	R16,R12
    05083 940E 49F1 CALL	mod16u
    05085 01B8      MOVW	R22,R16
    05086 E089      LDI	R24,0x9
    05087 E090      LDI	R25,0
    05088 1780      CP	R24,R16
    05089 0791      CPC	R25,R17
    0508A F034      BLT	0x5091
    0508B 01CB      MOVW	R24,R22
    0508C 96C0      ADIW	R24,0x30
    0508D 01FA      MOVW	R30,R20
    0508E 9381      ST	Z+,R24
    0508F 01AF      MOVW	R20,R30
    05090 C006      RJMP	0x5097
    05091 01CB      MOVW	R24,R22
    05092 5A89      SUBI	R24,0xA9
    05093 4F9F      SBCI	R25,0xFF
    05094 01FA      MOVW	R30,R20
    05095 9381      ST	Z+,R24
    05096 01AF      MOVW	R20,R30
    05097 0197      MOVW	R18,R14
    05098 0186      MOVW	R16,R12
    05099 940E 49F3 CALL	div16u
    0509B 0168      MOVW	R12,R16
    0509C 20CC      TST	R12
    0509D F719      BNE	0x5081
    0509E 20DD      TST	R13
    0509F F709      BNE	0x5081
    050A0 012A      MOVW	R4,R20
    050A1 5041      SUBI	R20,1
    050A2 4050      SBCI	R21,0
    050A3 2422      CLR	R2
    050A4 01F2      MOVW	R30,R4
    050A5 8220      ST	Z,R2
    050A6 0165      MOVW	R12,R10
    050A7 C00C      RJMP	0x50B4
    050A8 01F6      MOVW	R30,R12
    050A9 80E0      LD	R14,Z
    050AA 01FA      MOVW	R30,R20
    050AB 8020      LD	R2,Z
    050AC 01F6      MOVW	R30,R12
    050AD 9221      ST	Z+,R2
    050AE 016F      MOVW	R12,R30
    050AF 011A      MOVW	R2,R20
    050B0 5041      SUBI	R20,1
    050B1 4050      SBCI	R21,0
    050B2 01F1      MOVW	R30,R2
    050B3 82E0      ST	Z,R14
    050B4 16C4      CP	R12,R20
    050B5 06D5      CPC	R13,R21
    050B6 F388      BCS	0x50A8
    050B7 0185      MOVW	R16,R10
    050B8 940C 4AFC JMP	pop_xgsetF0FC
_ftoa:
    050BA 940E 49C2 CALL	push_arg4
    050BC 940E 4B07 CALL	push_xgsetF0FC
    050BE 9764      SBIW	R28,0x14
    050BF A0CA      LDD	R12,Y+34
    050C0 A0DB      LDD	R13,Y+35
    050C1 2422      CLR	R2
    050C2 2433      CLR	R3
    050C3 01F6      MOVW	R30,R12
    050C4 8231      STD	Z+1,R3
    050C5 8220      ST	Z,R2
    050C6 8C2E      LDD	R2,Y+30
    050C7 8C3F      LDD	R3,Y+31
    050C8 A048      LDD	R4,Y+32
    050C9 A059      LDD	R5,Y+33
    050CA EE00      LDI	R16,0xE0
    050CB E010      LDI	R17,0
    050CC 940E 4A8F CALL	elpm32
    050CE 933A      ST	-Y,R19
    050CF 932A      ST	-Y,R18
    050D0 931A      ST	-Y,R17
    050D1 930A      ST	-Y,R16
    050D2 0181      MOVW	R16,R2
    050D3 0192      MOVW	R18,R4
    050D4 940E 4E87 CALL	fpcmp2
    050D6 F479      BNE	0x50E6
    050D7 E380      LDI	R24,0x30
    050D8 9380 093B STS	Rec+118,R24
    050DA E28E      LDI	R24,0x2E
    050DB 9380 093C STS	Rec+119,R24
    050DD E380      LDI	R24,0x30
    050DE 9380 093D STS	Rec+120,R24
    050E0 2422      CLR	R2
    050E1 9220 093E STS	Rec+121,R2
    050E3 E30B      LDI	R16,0x3B
    050E4 E019      LDI	R17,0x9
    050E5 C15E      RJMP	0x5244
    050E6 8C2E      LDD	R2,Y+30
    050E7 8C3F      LDD	R3,Y+31
    050E8 A048      LDD	R4,Y+32
    050E9 A059      LDD	R5,Y+33
    050EA 8628      STD	Y+8,R2
    050EB 8639      STD	Y+9,R3
    050EC 864A      STD	Y+10,R4
    050ED 865B      STD	Y+11,R5
    050EE E187      LDI	R24,0x17
    050EF E090      LDI	R25,0
    050F0 8508      LDD	R16,Y+8
    050F1 8519      LDD	R17,Y+9
    050F2 852A      LDD	R18,Y+10
    050F3 853B      LDD	R19,Y+11
    050F4 938A      ST	-Y,R24
    050F5 940E 49C7 CALL	asr32
    050F7 2F80      MOV	R24,R16
    050F8 2799      CLR	R25
    050F9 578F      SUBI	R24,0x7F
    050FA 4090      SBCI	R25,0
    050FB 015C      MOVW	R10,R24
    050FC EF4F      LDI	R20,0xFF
    050FD EF5F      LDI	R21,0xFF
    050FE EF6F      LDI	R22,0xFF
    050FF E070      LDI	R23,0
    05100 8428      LDD	R2,Y+8
    05101 8439      LDD	R3,Y+9
    05102 844A      LDD	R4,Y+10
    05103 845B      LDD	R5,Y+11
    05104 2224      AND	R2,R20
    05105 2235      AND	R3,R21
    05106 2246      AND	R4,R22
    05107 2257      AND	R5,R23
    05108 93EF      PUSH	R30
    05109 2DE4      MOV	R30,R4
    0510A 68E0      ORI	R30,0x80
    0510B 2E4E      MOV	R4,R30
    0510C 91EF      POP	R30
    0510D 8A28      STD	Y+16,R2
    0510E 8A39      STD	Y+17,R3
    0510F 8A4A      STD	Y+18,R4
    05110 8A5B      STD	Y+19,R5
    05111 E080      LDI	R24,0
    05112 838C      STD	Y+4,R24
    05113 838D      STD	Y+5,R24
    05114 838E      STD	Y+6,R24
    05115 838F      STD	Y+7,R24
    05116 E080      LDI	R24,0
    05117 878C      STD	Y+12,R24
    05118 878D      STD	Y+13,R24
    05119 878E      STD	Y+14,R24
    0511A 878F      STD	Y+15,R24
    0511B 01C5      MOVW	R24,R10
    0511C 318F      CPI	R24,0x1F
    0511D E0E0      LDI	R30,0
    0511E 079E      CPC	R25,R30
    0511F F044      BLT	0x5128
    05120 EF8E      LDI	R24,0xFE
    05121 EF9F      LDI	R25,0xFF
    05122 01F6      MOVW	R30,R12
    05123 8391      STD	Z+1,R25
    05124 8380      ST	Z,R24
    05125 2700      CLR	R16
    05126 2711      CLR	R17
    05127 C11C      RJMP	0x5244
    05128 01C5      MOVW	R24,R10
    05129 3E89      CPI	R24,0xE9
    0512A EFEF      LDI	R30,0xFF
    0512B 079E      CPC	R25,R30
    0512C F444      BGE	0x5135
    0512D EF8F      LDI	R24,0xFF
    0512E EF9F      LDI	R25,0xFF
    0512F 01F6      MOVW	R30,R12
    05130 8391      STD	Z+1,R25
    05131 8380      ST	Z,R24
    05132 2700      CLR	R16
    05133 2711      CLR	R17
    05134 C10F      RJMP	0x5244
    05135 01C5      MOVW	R24,R10
    05136 3187      CPI	R24,0x17
    05137 E0A0      LDI	R26,0
    05138 079A      CPC	R25,R26
    05139 F06C      BLT	0x5147
    0513A 9747      SBIW	R24,0x17
    0513B 8908      LDD	R16,Y+16
    0513C 8919      LDD	R17,Y+17
    0513D 892A      LDD	R18,Y+18
    0513E 893B      LDD	R19,Y+19
    0513F 938A      ST	-Y,R24
    05140 940E 4B92 CALL	lsl32
    05142 870C      STD	Y+12,R16
    05143 871D      STD	Y+13,R17
    05144 872E      STD	Y+14,R18
    05145 873F      STD	Y+15,R19
    05146 C045      RJMP	0x518C
    05147 01C5      MOVW	R24,R10
    05148 3080      CPI	R24,0
    05149 E0A0      LDI	R26,0
    0514A 079A      CPC	R25,R26
    0514B F13C      BLT	0x5173
    0514C E187      LDI	R24,0x17
    0514D E090      LDI	R25,0
    0514E 198A      SUB	R24,R10
    0514F 099B      SBC	R25,R11
    05150 8908      LDD	R16,Y+16
    05151 8919      LDD	R17,Y+17
    05152 892A      LDD	R18,Y+18
    05153 893B      LDD	R19,Y+19
    05154 938A      ST	-Y,R24
    05155 940E 49C7 CALL	asr32
    05157 870C      STD	Y+12,R16
    05158 871D      STD	Y+13,R17
    05159 872E      STD	Y+14,R18
    0515A 873F      STD	Y+15,R19
    0515B 01C5      MOVW	R24,R10
    0515C 9601      ADIW	R24,1
    0515D 8908      LDD	R16,Y+16
    0515E 8919      LDD	R17,Y+17
    0515F 892A      LDD	R18,Y+18
    05160 893B      LDD	R19,Y+19
    05161 938A      ST	-Y,R24
    05162 940E 4B92 CALL	lsl32
    05164 0118      MOVW	R2,R16
    05165 0129      MOVW	R4,R18
    05166 EF4F      LDI	R20,0xFF
    05167 EF5F      LDI	R21,0xFF
    05168 EF6F      LDI	R22,0xFF
    05169 E070      LDI	R23,0
    0516A 2224      AND	R2,R20
    0516B 2235      AND	R3,R21
    0516C 2246      AND	R4,R22
    0516D 2257      AND	R5,R23
    0516E 822C      STD	Y+4,R2
    0516F 823D      STD	Y+5,R3
    05170 824E      STD	Y+6,R4
    05171 825F      STD	Y+7,R5
    05172 C019      RJMP	0x518C
    05173 EF4F      LDI	R20,0xFF
    05174 EF5F      LDI	R21,0xFF
    05175 EF6F      LDI	R22,0xFF
    05176 E070      LDI	R23,0
    05177 8908      LDD	R16,Y+16
    05178 8919      LDD	R17,Y+17
    05179 892A      LDD	R18,Y+18
    0517A 893B      LDD	R19,Y+19
    0517B 2304      AND	R16,R20
    0517C 2315      AND	R17,R21
    0517D 2326      AND	R18,R22
    0517E 2337      AND	R19,R23
    0517F 01C5      MOVW	R24,R10
    05180 9601      ADIW	R24,1
    05181 9580      COM	R24
    05182 9590      COM	R25
    05183 5F8F      SUBI	R24,0xFF
    05184 4F9F      SBCI	R25,0xFF
    05185 938A      ST	-Y,R24
    05186 940E 49C7 CALL	asr32
    05188 830C      STD	Y+4,R16
    05189 831D      STD	Y+5,R17
    0518A 832E      STD	Y+6,R18
    0518B 833F      STD	Y+7,R19
    0518C E38B      LDI	R24,0x3B
    0518D E099      LDI	R25,0x9
    0518E 015C      MOVW	R10,R24
    0518F E040      LDI	R20,0
    05190 E050      LDI	R21,0
    05191 E060      LDI	R22,0
    05192 E070      LDI	R23,0
    05193 8428      LDD	R2,Y+8
    05194 8439      LDD	R3,Y+9
    05195 844A      LDD	R4,Y+10
    05196 845B      LDD	R5,Y+11
    05197 1624      CP	R2,R20
    05198 0635      CPC	R3,R21
    05199 0646      CPC	R4,R22
    0519A 0657      CPC	R5,R23
    0519B F424      BGE	0x51A0
    0519C E28D      LDI	R24,0x2D
    0519D 01F5      MOVW	R30,R10
    0519E 9381      ST	Z+,R24
    0519F 015F      MOVW	R10,R30
    051A0 842C      LDD	R2,Y+12
    051A1 843D      LDD	R3,Y+13
    051A2 844E      LDD	R4,Y+14
    051A3 845F      LDD	R5,Y+15
    051A4 9488      BCLR	0
    051A5 2022      TST	R2
    051A6 0432      CPC	R3,R2
    051A7 0442      CPC	R4,R2
    051A8 0452      CPC	R5,R2
    051A9 F429      BNE	0x51AF
    051AA E380      LDI	R24,0x30
    051AB 01F5      MOVW	R30,R10
    051AC 9381      ST	Z+,R24
    051AD 015F      MOVW	R10,R30
    051AE C016      RJMP	0x51C5
    051AF E08A      LDI	R24,0xA
    051B0 E090      LDI	R25,0
    051B1 839B      STD	Y+3,R25
    051B2 838A      STD	Y+2,R24
    051B3 842C      LDD	R2,Y+12
    051B4 843D      LDD	R3,Y+13
    051B5 844E      LDD	R4,Y+14
    051B6 845F      LDD	R5,Y+15
    051B7 8248      ST	Y,R4
    051B8 8259      STD	Y+1,R5
    051B9 0191      MOVW	R18,R2
    051BA 0185      MOVW	R16,R10
    051BB 940E 4F5B CALL	_ltoa
    051BD C003      RJMP	0x51C1
    051BE 01C5      MOVW	R24,R10
    051BF 9601      ADIW	R24,1
    051C0 015C      MOVW	R10,R24
    051C1 01F5      MOVW	R30,R10
    051C2 8020      LD	R2,Z
    051C3 2022      TST	R2
    051C4 F7C9      BNE	0x51BE
    051C5 E28E      LDI	R24,0x2E
    051C6 01F5      MOVW	R30,R10
    051C7 9381      ST	Z+,R24
    051C8 015F      MOVW	R10,R30
    051C9 802C      LDD	R2,Y+4
    051CA 803D      LDD	R3,Y+5
    051CB 804E      LDD	R4,Y+6
    051CC 805F      LDD	R5,Y+7
    051CD 9488      BCLR	0
    051CE 2022      TST	R2
    051CF 0432      CPC	R3,R2
    051D0 0442      CPC	R4,R2
    051D1 0452      CPC	R5,R2
    051D2 F421      BNE	0x51D7
    051D3 E380      LDI	R24,0x30
    051D4 9381      ST	Z+,R24
    051D5 015F      MOVW	R10,R30
    051D6 C068      RJMP	0x523F
    051D7 E38B      LDI	R24,0x3B
    051D8 E099      LDI	R25,0x9
    051D9 0115      MOVW	R2,R10
    051DA 1A28      SUB	R2,R24
    051DB 0A39      SBC	R3,R25
    051DC E08F      LDI	R24,0xF
    051DD E090      LDI	R25,0
    051DE 1982      SUB	R24,R2
    051DF 0993      SBC	R25,R3
    051E0 9701      SBIW	R24,1
    051E1 2EC8      MOV	R12,R24
    051E2 E087      LDI	R24,7
    051E3 158C      CP	R24,R12
    051E4 F408      BCC	0x51E6
    051E5 2EC8      MOV	R12,R24
    051E6 24EE      CLR	R14
    051E7 C042      RJMP	0x522A
    051E8 E083      LDI	R24,3
    051E9 E090      LDI	R25,0
    051EA 810C      LDD	R16,Y+4
    051EB 811D      LDD	R17,Y+5
    051EC 812E      LDD	R18,Y+6
    051ED 813F      LDD	R19,Y+7
    051EE 938A      ST	-Y,R24
    051EF 940E 4B92 CALL	lsl32
    051F1 0118      MOVW	R2,R16
    051F2 0129      MOVW	R4,R18
    051F3 806C      LDD	R6,Y+4
    051F4 807D      LDD	R7,Y+5
    051F5 808E      LDD	R8,Y+6
    051F6 809F      LDD	R9,Y+7
    051F7 0C66      LSL	R6
    051F8 1C77      ROL	R7
    051F9 1C88      ROL	R8
    051FA 1C99      ROL	R9
    051FB 0C26      ADD	R2,R6
    051FC 1C37      ADC	R3,R7
    051FD 1C48      ADC	R4,R8
    051FE 1C59      ADC	R5,R9
    051FF 822C      STD	Y+4,R2
    05200 823D      STD	Y+5,R3
    05201 824E      STD	Y+6,R4
    05202 825F      STD	Y+7,R5
    05203 E188      LDI	R24,0x18
    05204 E090      LDI	R25,0
    05205 810C      LDD	R16,Y+4
    05206 811D      LDD	R17,Y+5
    05207 812E      LDD	R18,Y+6
    05208 813F      LDD	R19,Y+7
    05209 938A      ST	-Y,R24
    0520A 940E 49C7 CALL	asr32
    0520C 0118      MOVW	R2,R16
    0520D 0129      MOVW	R4,R18
    0520E E340      LDI	R20,0x30
    0520F E050      LDI	R21,0
    05210 E060      LDI	R22,0
    05211 E070      LDI	R23,0
    05212 0E24      ADD	R2,R20
    05213 1E35      ADC	R3,R21
    05214 1E46      ADC	R4,R22
    05215 1E57      ADC	R5,R23
    05216 01F5      MOVW	R30,R10
    05217 9221      ST	Z+,R2
    05218 015F      MOVW	R10,R30
    05219 EF4F      LDI	R20,0xFF
    0521A EF5F      LDI	R21,0xFF
    0521B EF6F      LDI	R22,0xFF
    0521C E070      LDI	R23,0
    0521D 802C      LDD	R2,Y+4
    0521E 803D      LDD	R3,Y+5
    0521F 804E      LDD	R4,Y+6
    05220 805F      LDD	R5,Y+7
    05221 2224      AND	R2,R20
    05222 2235      AND	R3,R21
    05223 2246      AND	R4,R22
    05224 2257      AND	R5,R23
    05225 822C      STD	Y+4,R2
    05226 823D      STD	Y+5,R3
    05227 824E      STD	Y+6,R4
    05228 825F      STD	Y+7,R5
    05229 94E3      INC	R14
    0522A 14EC      CP	R14,R12
    0522B F408      BCC	0x522D
    0522C CFBB      RJMP	0x51E8
    0522D 01C5      MOVW	R24,R10
    0522E 9701      SBIW	R24,1
    0522F 015C      MOVW	R10,R24
    05230 C003      RJMP	0x5234
    05231 01C5      MOVW	R24,R10
    05232 9701      SBIW	R24,1
    05233 015C      MOVW	R10,R24
    05234 01F5      MOVW	R30,R10
    05235 8180      LD	R24,Z
    05236 3380      CPI	R24,0x30
    05237 F421      BNE	0x523C
    05238 9731      SBIW	R30,1
    05239 8180      LD	R24,Z
    0523A 328E      CPI	R24,0x2E
    0523B F7A9      BNE	0x5231
    0523C 01C5      MOVW	R24,R10
    0523D 9601      ADIW	R24,1
    0523E 015C      MOVW	R10,R24
    0523F 2422      CLR	R2
    05240 01F5      MOVW	R30,R10
    05241 8220      ST	Z,R2
    05242 E30B      LDI	R16,0x3B
    05243 E019      LDI	R17,0x9
    05244 9664      ADIW	R28,0x14
    05245 940E 4AFC CALL	pop_xgsetF0FC
    05247 9624      ADIW	R28,4
    05248 9508      RET
_isdigit:
    05249 EE85      LDI	R24,0xE5
    0524A E090      LDI	R25,0
    0524B 01F8      MOVW	R30,R16
    0524C 0FE8      ADD	R30,R24
    0524D 1FF9      ADC	R31,R25
    0524E 9106      ELPM	R16,Z
    0524F 2711      CLR	R17
    05250 7004      ANDI	R16,4
    05251 7010      ANDI	R17,0
    05252 9508      RET
_islower:
    05253 EE85      LDI	R24,0xE5
    05254 E090      LDI	R25,0
    05255 01F8      MOVW	R30,R16
    05256 0FE8      ADD	R30,R24
    05257 1FF9      ADC	R31,R25
    05258 9106      ELPM	R16,Z
    05259 2711      CLR	R17
    0525A 7002      ANDI	R16,2
    0525B 7010      ANDI	R17,0
    0525C 9508      RET
_isspace:
    0525D EE85      LDI	R24,0xE5
    0525E E090      LDI	R25,0
    0525F 01F8      MOVW	R30,R16
    05260 0FE8      ADD	R30,R24
    05261 1FF9      ADC	R31,R25
    05262 9106      ELPM	R16,Z
    05263 2711      CLR	R17
    05264 7100      ANDI	R16,0x10
    05265 7010      ANDI	R17,0
    05266 9508      RET
_toupper:
    05267 934A      ST	-Y,R20
    05268 935A      ST	-Y,R21
    05269 01A8      MOVW	R20,R16
    0526A 018A      MOVW	R16,R20
    0526B 940E 5253 CALL	_islower
    0526D 3000      CPI	R16,0
    0526E 0701      CPC	R16,R17
    0526F F031      BEQ	0x5276
    05270 018A      MOVW	R16,R20
    05271 5601      SUBI	R16,0x61
    05272 4010      SBCI	R17,0
    05273 5B0F      SUBI	R16,0xBF
    05274 4F1F      SBCI	R17,0xFF
    05275 C001      RJMP	0x5277
    05276 018A      MOVW	R16,R20
    05277 9159      LD	R21,Y+
    05278 9149      LD	R20,Y+
    05279 9508      RET
__sdepi:
    0527A 91E0 094A LDS	R30,Rec+133
    0527C 91F0 094B LDS	R31,Rec+134
    0527E 9301      ST	Z+,R16
    0527F 93F0 094B STS	Rec+134,R31
    05281 93E0 094A STS	Rec+133,R30
    05283 9508      RET
_sprintf:
    05284 940E 49C2 CALL	push_arg4
    05286 92AA      ST	-Y,R10
    05287 92BA      ST	-Y,R11
    05288 9722      SBIW	R28,2
    05289 802C      LDD	R2,Y+4
    0528A 803D      LDD	R3,Y+5
    0528B 9230 094B STS	Rec+134,R3
    0528D 9220 094A STS	Rec+133,R2
    0528F 01CE      MOVW	R24,R28
    05290 9608      ADIW	R24,0x8
    05291 015C      MOVW	R10,R24
    05292 82B9      STD	Y+1,R11
    05293 82A8      ST	Y,R10
    05294 812E      LDD	R18,Y+6
    05295 813F      LDD	R19,Y+7
    05296 E80C      LDI	R16,0x8C
    05297 E010      LDI	R17,0
    05298 940E 4531 CALL	__print
    0529A 2422      CLR	R2
    0529B 91E0 094A LDS	R30,Rec+133
    0529D 91F0 094B LDS	R31,Rec+134
    0529F 8220      ST	Z,R2
    052A0 802C      LDD	R2,Y+4
    052A1 803D      LDD	R3,Y+5
    052A2 9100 094A LDS	R16,Rec+133
    052A4 9110 094B LDS	R17,Rec+134
    052A6 1902      SUB	R16,R2
    052A7 0913      SBC	R17,R3
    052A8 9622      ADIW	R28,2
    052A9 90B9      LD	R11,Y+
    052AA 90A9      LD	R10,Y+
    052AB 9624      ADIW	R28,4
    052AC 9508      RET
    052AD 940E 4B26 CALL	push_xgsetF00C
    052AF 01B9      MOVW	R22,R18
    052B0 0158      MOVW	R10,R16
    052B1 3F6E      CPI	R22,0xFE
    052B2 EFEF      LDI	R30,0xFF
    052B3 077E      CPC	R23,R30
    052B4 F419      BNE	0x52B8
    052B5 EE45      LDI	R20,0xE5
    052B6 E051      LDI	R21,1
    052B7 C009      RJMP	0x52C1
    052B8 3F6F      CPI	R22,0xFF
    052B9 EFEF      LDI	R30,0xFF
    052BA 077E      CPC	R23,R30
    052BB F419      BNE	0x52BF
    052BC E040      LDI	R20,0
    052BD E052      LDI	R21,2
    052BE C002      RJMP	0x52C1
    052BF E14D      LDI	R20,0x1D
    052C0 E052      LDI	R21,2
    052C1 019A      MOVW	R18,R20
    052C2 0185      MOVW	R16,R10
    052C3 940E 4E93 CALL	_cstrcpy
    052C5 0185      MOVW	R16,R10
    052C6 940C 4B2D JMP	pop_xgsetF00C
__FormatFP_1:
    052C8 940E 49C2 CALL	push_arg4
    052CA 940E 4B07 CALL	push_xgsetF0FC
    052CC 01B9      MOVW	R22,R18
    052CD 97A2      SBIW	R28,0x22
    052CE EF8F      LDI	R24,0xFF
    052CF EF9F      LDI	R25,0xFF
    052D0 015C      MOVW	R10,R24
    052D1 879F      STD	Y+15,R25
    052D2 878E      STD	Y+14,R24
    052D3 8B9B      STD	Y+19,R25
    052D4 8B8A      STD	Y+18,R24
    052D5 8B99      STD	Y+17,R25
    052D6 8B88      STD	Y+16,R24
    052D7 8F9E      STD	Y+30,R25
    052D8 8F8D      STD	Y+29,R24
    052D9 8B9E      STD	Y+22,R25
    052DA 8B8D      STD	Y+21,R24
    052DB 2400      CLR	R0
    052DC 2411      CLR	R1
    052DD 8E19      STD	Y+25,R1
    052DE 8E08      STD	Y+24,R0
    052DF 2799      CLR	R25
    052E0 A398      STD	Y+32,R25
    052E1 8F8F      STD	Y+31,R24
    052E2 24EE      CLR	R14
    052E3 24FF      CLR	R15
    052E4 2744      CLR	R20
    052E5 2755      CLR	R21
    052E6 E280      LDI	R24,0x20
    052E7 8B8F      STD	Y+23,R24
    052E8 8F8C      STD	Y+28,R24
    052E9 E685      LDI	R24,0x65
    052EA A389      STD	Y+33,R24
    052EB E184      LDI	R24,0x14
    052EC A80E      LDD	R0,Y+54
    052ED A81F      LDD	R1,Y+55
    052EE 1580      CP	R24,R0
    052EF 0591      CPC	R25,R1
    052F0 F414      BGE	0x52F3
    052F1 AB9F      STD	Y+55,R25
    052F2 AB8E      STD	Y+54,R24
    052F3 E184      LDI	R24,0x14
    052F4 E090      LDI	R25,0
    052F5 AC08      LDD	R0,Y+56
    052F6 AC19      LDD	R1,Y+57
    052F7 1580      CP	R24,R0
    052F8 0591      CPC	R25,R1
    052F9 F414      BGE	0x52FC
    052FA AF99      STD	Y+57,R25
    052FB AF88      STD	Y+56,R24
    052FC 3060      CPI	R22,0
    052FD 0767      CPC	R22,R23
    052FE F409      BNE	0x5300
    052FF C084      RJMP	0x5384
    05300 3061      CPI	R22,1
    05301 E0E0      LDI	R30,0
    05302 077E      CPC	R23,R30
    05303 F079      BEQ	0x5313
    05304 3062      CPI	R22,2
    05305 E0E0      LDI	R30,0
    05306 077E      CPC	R23,R30
    05307 F049      BEQ	0x5311
    05308 3063      CPI	R22,3
    05309 E0E0      LDI	R30,0
    0530A 077E      CPC	R23,R30
    0530B F061      BEQ	0x5318
    0530C 3064      CPI	R22,4
    0530D E0E0      LDI	R30,0
    0530E 077E      CPC	R23,R30
    0530F F031      BEQ	0x5316
    05310 C073      RJMP	0x5384
    05311 E485      LDI	R24,0x45
    05312 A389      STD	Y+33,R24
    05313 E041      LDI	R20,1
    05314 E050      LDI	R21,0
    05315 C06E      RJMP	0x5384
    05316 E485      LDI	R24,0x45
    05317 A389      STD	Y+33,R24
    05318 A828      LDD	R2,Y+48
    05319 A839      LDD	R3,Y+49
    0531A A84A      LDD	R4,Y+50
    0531B A85B      LDD	R5,Y+51
    0531C 8628      STD	Y+8,R2
    0531D 8639      STD	Y+9,R3
    0531E 864A      STD	Y+10,R4
    0531F 865B      STD	Y+11,R5
    05320 A828      LDD	R2,Y+48
    05321 A839      LDD	R3,Y+49
    05322 A84A      LDD	R4,Y+50
    05323 A85B      LDD	R5,Y+51
    05324 E40E      LDI	R16,0x4E
    05325 E012      LDI	R17,2
    05326 940E 4A8F CALL	elpm32
    05328 933A      ST	-Y,R19
    05329 932A      ST	-Y,R18
    0532A 931A      ST	-Y,R17
    0532B 930A      ST	-Y,R16
    0532C 0181      MOVW	R16,R2
    0532D 0192      MOVW	R18,R4
    0532E 940E 4E87 CALL	fpcmp2
    05330 F474      BGE	0x533F
    05331 E40A      LDI	R16,0x4A
    05332 E012      LDI	R17,2
    05333 940E 4A8F CALL	elpm32
    05335 01CE      MOVW	R24,R28
    05336 96C0      ADIW	R24,0x30
    05337 939A      ST	-Y,R25
    05338 938A      ST	-Y,R24
    05339 940E 4E4D CALL	fpmule1
    0533B 8708      STD	Y+8,R16
    0533C 8719      STD	Y+9,R17
    0533D 872A      STD	Y+10,R18
    0533E 873B      STD	Y+11,R19
    0533F E406      LDI	R16,0x46
    05340 E012      LDI	R17,2
    05341 940E 4A8F CALL	elpm32
    05343 830A      STD	Y+2,R16
    05344 831B      STD	Y+3,R17
    05345 832C      STD	Y+4,R18
    05346 833D      STD	Y+5,R19
    05347 2400      CLR	R0
    05348 2411      CLR	R1
    05349 861D      STD	Y+13,R1
    0534A 860C      STD	Y+12,R0
    0534B C013      RJMP	0x535F
    0534C E402      LDI	R16,0x42
    0534D E012      LDI	R17,2
    0534E 940E 4A8F CALL	elpm32
    05350 01CE      MOVW	R24,R28
    05351 9602      ADIW	R24,2
    05352 939A      ST	-Y,R25
    05353 938A      ST	-Y,R24
    05354 940E 4E4D CALL	fpmule1
    05356 830A      STD	Y+2,R16
    05357 831B      STD	Y+3,R17
    05358 832C      STD	Y+4,R18
    05359 833D      STD	Y+5,R19
    0535A 858C      LDD	R24,Y+12
    0535B 859D      LDD	R25,Y+13
    0535C 9601      ADIW	R24,1
    0535D 879D      STD	Y+13,R25
    0535E 878C      STD	Y+12,R24
    0535F 840C      LDD	R0,Y+12
    05360 841D      LDD	R1,Y+13
    05361 AD08      LDD	R16,Y+56
    05362 AD19      LDD	R17,Y+57
    05363 1600      CP	R0,R16
    05364 0611      CPC	R1,R17
    05365 F334      BLT	0x534C
    05366 8428      LDD	R2,Y+8
    05367 8439      LDD	R3,Y+9
    05368 844A      LDD	R4,Y+10
    05369 845B      LDD	R5,Y+11
    0536A E30E      LDI	R16,0x3E
    0536B E012      LDI	R17,2
    0536C 940E 4A8F CALL	elpm32
    0536E 933A      ST	-Y,R19
    0536F 932A      ST	-Y,R18
    05370 931A      ST	-Y,R17
    05371 930A      ST	-Y,R16
    05372 0181      MOVW	R16,R2
    05373 0192      MOVW	R18,R4
    05374 940E 4E87 CALL	fpcmp2
    05376 F05C      BLT	0x5382
    05377 01CE      MOVW	R24,R28
    05378 9608      ADIW	R24,0x8
    05379 810A      LDD	R16,Y+2
    0537A 811B      LDD	R17,Y+3
    0537B 812C      LDD	R18,Y+4
    0537C 813D      LDD	R19,Y+5
    0537D 939A      ST	-Y,R25
    0537E 938A      ST	-Y,R24
    0537F 940E 4E7C CALL	fpcmp1
    05381 F414      BGE	0x5384
    05382 E041      LDI	R20,1
    05383 E050      LDI	R21,0
    05384 A80C      LDD	R0,Y+52
    05385 A81D      LDD	R1,Y+53
    05386 FE04      SBRS	R0,4
    05387 C002      RJMP	0x538A
    05388 E380      LDI	R24,0x30
    05389 8B8F      STD	Y+23,R24
    0538A 880F      LDD	R0,Y+23
    0538B 8A0C      STD	Y+20,R0
    0538C A80C      LDD	R0,Y+52
    0538D A81D      LDD	R1,Y+53
    0538E FE03      SBRS	R0,3
    0538F C002      RJMP	0x5392
    05390 E28B      LDI	R24,0x2B
    05391 8B8C      STD	Y+20,R24
    05392 3040      CPI	R20,0
    05393 0745      CPC	R20,R21
    05394 F061      BEQ	0x53A1
    05395 01CE      MOVW	R24,R28
    05396 9606      ADIW	R24,6
    05397 8399      STD	Y+1,R25
    05398 8388      ST	Y,R24
    05399 A908      LDD	R16,Y+48
    0539A A919      LDD	R17,Y+49
    0539B A92A      LDD	R18,Y+50
    0539C A93B      LDD	R19,Y+51
    0539D 940E 50BA CALL	_ftoa
    0539F 01B8      MOVW	R22,R16
    053A0 C062      RJMP	0x5403
    053A1 E30A      LDI	R16,0x3A
    053A2 E012      LDI	R17,2
    053A3 940E 4A8F CALL	elpm32
    053A5 830A      STD	Y+2,R16
    053A6 831B      STD	Y+3,R17
    053A7 832C      STD	Y+4,R18
    053A8 833D      STD	Y+5,R19
    053A9 2400      CLR	R0
    053AA 2411      CLR	R1
    053AB 861D      STD	Y+13,R1
    053AC 860C      STD	Y+12,R0
    053AD C019      RJMP	0x53C7
    053AE 802A      LDD	R2,Y+2
    053AF 803B      LDD	R3,Y+3
    053B0 804C      LDD	R4,Y+4
    053B1 805D      LDD	R5,Y+5
    053B2 E402      LDI	R16,0x42
    053B3 E012      LDI	R17,2
    053B4 940E 4A8F CALL	elpm32
    053B6 933A      ST	-Y,R19
    053B7 932A      ST	-Y,R18
    053B8 931A      ST	-Y,R17
    053B9 930A      ST	-Y,R16
    053BA 0181      MOVW	R16,R2
    053BB 0192      MOVW	R18,R4
    053BC 940E 4CDD CALL	fpdiv2
    053BE 830A      STD	Y+2,R16
    053BF 831B      STD	Y+3,R17
    053C0 832C      STD	Y+4,R18
    053C1 833D      STD	Y+5,R19
    053C2 858C      LDD	R24,Y+12
    053C3 859D      LDD	R25,Y+13
    053C4 9601      ADIW	R24,1
    053C5 879D      STD	Y+13,R25
    053C6 878C      STD	Y+12,R24
    053C7 840C      LDD	R0,Y+12
    053C8 841D      LDD	R1,Y+13
    053C9 AD08      LDD	R16,Y+56
    053CA AD19      LDD	R17,Y+57
    053CB 1600      CP	R0,R16
    053CC 0611      CPC	R1,R17
    053CD F304      BLT	0x53AE
    053CE A828      LDD	R2,Y+48
    053CF A839      LDD	R3,Y+49
    053D0 A84A      LDD	R4,Y+50
    053D1 A85B      LDD	R5,Y+51
    053D2 E40E      LDI	R16,0x4E
    053D3 E012      LDI	R17,2
    053D4 940E 4A8F CALL	elpm32
    053D6 933A      ST	-Y,R19
    053D7 932A      ST	-Y,R18
    053D8 931A      ST	-Y,R17
    053D9 930A      ST	-Y,R16
    053DA 0181      MOVW	R16,R2
    053DB 0192      MOVW	R18,R4
    053DC 940E 4E87 CALL	fpcmp2
    053DE F494      BGE	0x53F1
    053DF 01CE      MOVW	R24,R28
    053E0 9606      ADIW	R24,6
    053E1 8399      STD	Y+1,R25
    053E2 8388      ST	Y,R24
    053E3 A908      LDD	R16,Y+48
    053E4 A919      LDD	R17,Y+49
    053E5 A92A      LDD	R18,Y+50
    053E6 A93B      LDD	R19,Y+51
    053E7 01CE      MOVW	R24,R28
    053E8 9602      ADIW	R24,2
    053E9 939A      ST	-Y,R25
    053EA 938A      ST	-Y,R24
    053EB 940E 4C4E CALL	fpsub1
    053ED 940E 50BA CALL	_ftoa
    053EF 01B8      MOVW	R22,R16
    053F0 C012      RJMP	0x5403
    053F1 01CE      MOVW	R24,R28
    053F2 9606      ADIW	R24,6
    053F3 8399      STD	Y+1,R25
    053F4 8388      ST	Y,R24
    053F5 A908      LDD	R16,Y+48
    053F6 A919      LDD	R17,Y+49
    053F7 A92A      LDD	R18,Y+50
    053F8 A93B      LDD	R19,Y+51
    053F9 01CE      MOVW	R24,R28
    053FA 9602      ADIW	R24,2
    053FB 939A      ST	-Y,R25
    053FC 938A      ST	-Y,R24
    053FD 940E 4C39 CALL	fpadd1
    053FF 940E 50BA CALL	_ftoa
    05401 0168      MOVW	R12,R16
    05402 01B6      MOVW	R22,R12
    05403 802E      LDD	R2,Y+6
    05404 803F      LDD	R3,Y+7
    05405 2022      TST	R2
    05406 F411      BNE	0x5409
    05407 2033      TST	R3
    05408 F031      BEQ	0x540F
    05409 0191      MOVW	R18,R2
    0540A A50C      LDD	R16,Y+44
    0540B A51D      LDD	R17,Y+45
    0540C DEA0      RCALL	0x52AD
    0540D 0168      MOVW	R12,R16
    0540E C39E      RJMP	0x57AD
    0540F 2400      CLR	R0
    05410 2411      CLR	R1
    05411 861D      STD	Y+13,R1
    05412 860C      STD	Y+12,R0
    05413 3040      CPI	R20,0
    05414 0745      CPC	R20,R21
    05415 F481      BNE	0x5426
    05416 858E      LDD	R24,Y+14
    05417 859F      LDD	R25,Y+15
    05418 3080      CPI	R24,0
    05419 E0E0      LDI	R30,0
    0541A 079E      CPC	R25,R30
    0541B F054      BLT	0x5426
    0541C 842C      LDD	R2,Y+12
    0541D 843D      LDD	R3,Y+13
    0541E 1A28      SUB	R2,R24
    0541F 0A39      SBC	R3,R25
    05420 AC08      LDD	R0,Y+56
    05421 AC19      LDD	R1,Y+57
    05422 1402      CP	R0,R2
    05423 0413      CPC	R1,R3
    05424 F40C      BGE	0x5426
    05425 C060      RJMP	0x5486
    05426 85EC      LDD	R30,Y+12
    05427 85FD      LDD	R31,Y+13
    05428 0FE6      ADD	R30,R22
    05429 1FF7      ADC	R31,R23
    0542A 80C0      LD	R12,Z
    0542B 2D8C      MOV	R24,R12
    0542C 3380      CPI	R24,0x30
    0542D F1E0      BCS	0x546A
    0542E E389      LDI	R24,0x39
    0542F 158C      CP	R24,R12
    05430 F1C8      BCS	0x546A
    05431 84AC      LDD	R10,Y+12
    05432 84BD      LDD	R11,Y+13
    05433 E380      LDI	R24,0x30
    05434 158C      CP	R24,R12
    05435 F448      BCC	0x543F
    05436 8D8D      LDD	R24,Y+29
    05437 8D9E      LDD	R25,Y+30
    05438 3080      CPI	R24,0
    05439 E0E0      LDI	R30,0
    0543A 079E      CPC	R25,R30
    0543B F41C      BGE	0x543F
    0543C 0105      MOVW	R0,R10
    0543D 8E1E      STD	Y+30,R1
    0543E 8E0D      STD	Y+29,R0
    0543F 858E      LDD	R24,Y+14
    05440 859F      LDD	R25,Y+15
    05441 3080      CPI	R24,0
    05442 E0E0      LDI	R30,0
    05443 079E      CPC	R25,R30
    05444 F4C4      BGE	0x545D
    05445 8988      LDD	R24,Y+16
    05446 8999      LDD	R25,Y+17
    05447 3080      CPI	R24,0
    05448 E0E0      LDI	R30,0
    05449 079E      CPC	R25,R30
    0544A F43C      BGE	0x5452
    0544B E380      LDI	R24,0x30
    0544C 158C      CP	R24,R12
    0544D F420      BCC	0x5452
    0544E 840C      LDD	R0,Y+12
    0544F 841D      LDD	R1,Y+13
    05450 8A19      STD	Y+17,R1
    05451 8A08      STD	Y+16,R0
    05452 8988      LDD	R24,Y+16
    05453 8999      LDD	R25,Y+17
    05454 3080      CPI	R24,0
    05455 E0E0      LDI	R30,0
    05456 079E      CPC	R25,R30
    05457 F02C      BLT	0x545D
    05458 8D88      LDD	R24,Y+24
    05459 8D99      LDD	R25,Y+25
    0545A 9601      ADIW	R24,1
    0545B 8F99      STD	Y+25,R25
    0545C 8F88      STD	Y+24,R24
    0545D 858E      LDD	R24,Y+14
    0545E 859F      LDD	R25,Y+15
    0545F 3080      CPI	R24,0
    05460 E0E0      LDI	R30,0
    05461 079E      CPC	R25,R30
    05462 F03C      BLT	0x546A
    05463 E380      LDI	R24,0x30
    05464 158C      CP	R24,R12
    05465 F420      BCC	0x546A
    05466 840C      LDD	R0,Y+12
    05467 841D      LDD	R1,Y+13
    05468 8A1E      STD	Y+22,R1
    05469 8A0D      STD	Y+21,R0
    0546A 2D8C      MOV	R24,R12
    0546B 328E      CPI	R24,0x2E
    0546C F421      BNE	0x5471
    0546D 840C      LDD	R0,Y+12
    0546E 841D      LDD	R1,Y+13
    0546F 861F      STD	Y+15,R1
    05470 860E      STD	Y+14,R0
    05471 2D8C      MOV	R24,R12
    05472 328D      CPI	R24,0x2D
    05473 F429      BNE	0x5479
    05474 E081      LDI	R24,1
    05475 E090      LDI	R25,0
    05476 017C      MOVW	R14,R24
    05477 E28D      LDI	R24,0x2D
    05478 8B8C      STD	Y+20,R24
    05479 20CC      TST	R12
    0547A F409      BNE	0x547C
    0547B C00A      RJMP	0x5486
    0547C 858C      LDD	R24,Y+12
    0547D 859D      LDD	R25,Y+13
    0547E 9601      ADIW	R24,1
    0547F 879D      STD	Y+13,R25
    05480 878C      STD	Y+12,R24
    05481 3184      CPI	R24,0x14
    05482 E0E0      LDI	R30,0
    05483 079E      CPC	R25,R30
    05484 F40C      BGE	0x5486
    05485 CF8D      RJMP	0x5413
    05486 858E      LDD	R24,Y+14
    05487 859F      LDD	R25,Y+15
    05488 3080      CPI	R24,0
    05489 E0E0      LDI	R30,0
    0548A 079E      CPC	R25,R30
    0548B F43C      BGE	0x5493
    0548C 01C5      MOVW	R24,R10
    0548D 9601      ADIW	R24,1
    0548E 8B9B      STD	Y+19,R25
    0548F 8B8A      STD	Y+18,R24
    05490 9601      ADIW	R24,1
    05491 015C      MOVW	R10,R24
    05492 C012      RJMP	0x54A5
    05493 840E      LDD	R0,Y+14
    05494 841F      LDD	R1,Y+15
    05495 8A1B      STD	Y+19,R1
    05496 8A0A      STD	Y+18,R0
    05497 898D      LDD	R24,Y+21
    05498 899E      LDD	R25,Y+22
    05499 3080      CPI	R24,0
    0549A E0E0      LDI	R30,0
    0549B 079E      CPC	R25,R30
    0549C F424      BGE	0x54A1
    0549D 01C0      MOVW	R24,R0
    0549E 9601      ADIW	R24,1
    0549F 015C      MOVW	R10,R24
    054A0 C004      RJMP	0x54A5
    054A1 898D      LDD	R24,Y+21
    054A2 899E      LDD	R25,Y+22
    054A3 9601      ADIW	R24,1
    054A4 015C      MOVW	R10,R24
    054A5 8988      LDD	R24,Y+16
    054A6 8999      LDD	R25,Y+17
    054A7 3080      CPI	R24,0
    054A8 E0E0      LDI	R30,0
    054A9 079E      CPC	R25,R30
    054AA F42C      BGE	0x54B0
    054AB 898A      LDD	R24,Y+18
    054AC 899B      LDD	R25,Y+19
    054AD 9701      SBIW	R24,1
    054AE 8B99      STD	Y+17,R25
    054AF 8B88      STD	Y+16,R24
    054B0 3040      CPI	R20,0
    054B1 0745      CPC	R20,R21
    054B2 F409      BNE	0x54B4
    054B3 C1D2      RJMP	0x5686
    054B4 2400      CLR	R0
    054B5 2411      CLR	R1
    054B6 861D      STD	Y+13,R1
    054B7 860C      STD	Y+12,R0
    054B8 880C      LDD	R0,Y+20
    054B9 890F      LDD	R16,Y+23
    054BA 1600      CP	R0,R16
    054BB F069      BEQ	0x54C9
    054BC 854C      LDD	R20,Y+12
    054BD 855D      LDD	R21,Y+13
    054BE 01CA      MOVW	R24,R20
    054BF 9601      ADIW	R24,1
    054C0 879D      STD	Y+13,R25
    054C1 878C      STD	Y+12,R24
    054C2 01FA      MOVW	R30,R20
    054C3 A40C      LDD	R0,Y+44
    054C4 A41D      LDD	R1,Y+45
    054C5 0DE0      ADD	R30,R0
    054C6 1DF1      ADC	R31,R1
    054C7 880C      LDD	R0,Y+20
    054C8 8200      ST	Z,R0
    054C9 854C      LDD	R20,Y+12
    054CA 855D      LDD	R21,Y+13
    054CB 01CA      MOVW	R24,R20
    054CC 9601      ADIW	R24,1
    054CD 879D      STD	Y+13,R25
    054CE 878C      STD	Y+12,R24
    054CF 8DED      LDD	R30,Y+29
    054D0 8DFE      LDD	R31,Y+30
    054D1 0FE6      ADD	R30,R22
    054D2 1FF7      ADC	R31,R23
    054D3 8020      LD	R2,Z
    054D4 01FA      MOVW	R30,R20
    054D5 A40C      LDD	R0,Y+44
    054D6 A41D      LDD	R1,Y+45
    054D7 0DE0      ADD	R30,R0
    054D8 1DF1      ADC	R31,R1
    054D9 8220      ST	Z,R2
    054DA 01FC      MOVW	R30,R24
    054DB 0DE0      ADD	R30,R0
    054DC 1DF1      ADC	R31,R1
    054DD E28E      LDI	R24,0x2E
    054DE 8380      ST	Z,R24
    054DF 2422      CLR	R2
    054E0 2433      CLR	R3
    054E1 AC08      LDD	R0,Y+56
    054E2 AC19      LDD	R1,Y+57
    054E3 1420      CP	R2,R0
    054E4 0431      CPC	R3,R1
    054E5 F42C      BGE	0x54EB
    054E6 858C      LDD	R24,Y+12
    054E7 859D      LDD	R25,Y+13
    054E8 9601      ADIW	R24,1
    054E9 879D      STD	Y+13,R25
    054EA 878C      STD	Y+12,R24
    054EB 8D4D      LDD	R20,Y+29
    054EC 8D5E      LDD	R21,Y+30
    054ED 5F4F      SUBI	R20,0xFF
    054EE 4F5F      SBCI	R21,0xFF
    054EF 24CC      CLR	R12
    054F0 24DD      CLR	R13
    054F1 C034      RJMP	0x5526
    054F2 880A      LDD	R0,Y+18
    054F3 881B      LDD	R1,Y+19
    054F4 1540      CP	R20,R0
    054F5 0551      CPC	R21,R1
    054F6 F409      BNE	0x54F8
    054F7 C02C      RJMP	0x5524
    054F8 154A      CP	R20,R10
    054F9 055B      CPC	R21,R11
    054FA F48C      BGE	0x550C
    054FB 84EC      LDD	R14,Y+12
    054FC 84FD      LDD	R15,Y+13
    054FD 01C7      MOVW	R24,R14
    054FE 9601      ADIW	R24,1
    054FF 879D      STD	Y+13,R25
    05500 878C      STD	Y+12,R24
    05501 01FA      MOVW	R30,R20
    05502 0FE6      ADD	R30,R22
    05503 1FF7      ADC	R31,R23
    05504 8020      LD	R2,Z
    05505 01F7      MOVW	R30,R14
    05506 A40C      LDD	R0,Y+44
    05507 A41D      LDD	R1,Y+45
    05508 0DE0      ADD	R30,R0
    05509 1DF1      ADC	R31,R1
    0550A 8220      ST	Z,R2
    0550B C015      RJMP	0x5521
    0550C A80C      LDD	R0,Y+52
    0550D A81D      LDD	R1,Y+53
    0550E FC00      SBRC	R0,0
    0550F C004      RJMP	0x5514
    05510 20CC      TST	R12
    05511 F501      BNE	0x5532
    05512 20DD      TST	R13
    05513 F4F1      BNE	0x5532
    05514 84EC      LDD	R14,Y+12
    05515 84FD      LDD	R15,Y+13
    05516 01C7      MOVW	R24,R14
    05517 9601      ADIW	R24,1
    05518 879D      STD	Y+13,R25
    05519 878C      STD	Y+12,R24
    0551A 01F7      MOVW	R30,R14
    0551B A40C      LDD	R0,Y+44
    0551C A41D      LDD	R1,Y+45
    0551D 0DE0      ADD	R30,R0
    0551E 1DF1      ADC	R31,R1
    0551F E380      LDI	R24,0x30
    05520 8380      ST	Z,R24
    05521 01C6      MOVW	R24,R12
    05522 9601      ADIW	R24,1
    05523 016C      MOVW	R12,R24
    05524 5F4F      SUBI	R20,0xFF
    05525 4F5F      SBCI	R21,0xFF
    05526 AC08      LDD	R0,Y+56
    05527 AC19      LDD	R1,Y+57
    05528 14C0      CP	R12,R0
    05529 04D1      CPC	R13,R1
    0552A F43C      BGE	0x5532
    0552B 858C      LDD	R24,Y+12
    0552C 859D      LDD	R25,Y+13
    0552D 308E      CPI	R24,0xE
    0552E E0E0      LDI	R30,0
    0552F 079E      CPC	R25,R30
    05530 F40C      BGE	0x5532
    05531 CFC0      RJMP	0x54F2
    05532 858C      LDD	R24,Y+12
    05533 859D      LDD	R25,Y+13
    05534 9701      SBIW	R24,1
    05535 016C      MOVW	R12,R24
    05536 AC08      LDD	R0,Y+56
    05537 AC19      LDD	R1,Y+57
    05538 2000      TST	R0
    05539 F421      BNE	0x553E
    0553A 2011      TST	R1
    0553B F411      BNE	0x553E
    0553C 84CC      LDD	R12,Y+12
    0553D 84DD      LDD	R13,Y+13
    0553E 898A      LDD	R24,Y+18
    0553F 899B      LDD	R25,Y+19
    05540 8C0D      LDD	R0,Y+29
    05541 8C1E      LDD	R1,Y+30
    05542 1980      SUB	R24,R0
    05543 0991      SBC	R25,R1
    05544 9701      SBIW	R24,1
    05545 A398      STD	Y+32,R25
    05546 8F8F      STD	Y+31,R24
    05547 154A      CP	R20,R10
    05548 055B      CPC	R21,R11
    05549 F444      BGE	0x5552
    0554A 01FA      MOVW	R30,R20
    0554B 0FE6      ADD	R30,R22
    0554C 1FF7      ADC	R31,R23
    0554D 8180      LD	R24,Z
    0554E 328E      CPI	R24,0x2E
    0554F F411      BNE	0x5552
    05550 5F4F      SUBI	R20,0xFF
    05551 4F5F      SBCI	R21,0xFF
    05552 154A      CP	R20,R10
    05553 055B      CPC	R21,R11
    05554 F00C      BLT	0x5556
    05555 C06B      RJMP	0x55C1
    05556 01FA      MOVW	R30,R20
    05557 0FE6      ADD	R30,R22
    05558 1FF7      ADC	R31,R23
    05559 80E0      LD	R14,Z
    0555A 24FF      CLR	R15
    0555B 2D8E      MOV	R24,R14
    0555C 3385      CPI	R24,0x35
    0555D F408      BCC	0x555F
    0555E C062      RJMP	0x55C1
    0555F E389      LDI	R24,0x39
    05560 158E      CP	R24,R14
    05561 F408      BCC	0x5563
    05562 C05E      RJMP	0x55C1
    05563 C057      RJMP	0x55BB
    05564 01F6      MOVW	R30,R12
    05565 A40C      LDD	R0,Y+44
    05566 A41D      LDD	R1,Y+45
    05567 0DE0      ADD	R30,R0
    05568 1DF1      ADC	R31,R1
    05569 80E0      LD	R14,Z
    0556A 24FF      CLR	R15
    0556B 2D8E      MOV	R24,R14
    0556C 3380      CPI	R24,0x30
    0556D F058      BCS	0x5579
    0556E E388      LDI	R24,0x38
    0556F 158E      CP	R24,R14
    05570 F040      BCS	0x5579
    05571 0176      MOVW	R14,R12
    05572 0CE0      ADD	R14,R0
    05573 1CF1      ADC	R15,R1
    05574 01F7      MOVW	R30,R14
    05575 8180      LD	R24,Z
    05576 5F8F      SUBI	R24,0xFF
    05577 8380      ST	Z,R24
    05578 C048      RJMP	0x55C1
    05579 01F6      MOVW	R30,R12
    0557A A40C      LDD	R0,Y+44
    0557B A41D      LDD	R1,Y+45
    0557C 0DE0      ADD	R30,R0
    0557D 1DF1      ADC	R31,R1
    0557E 8180      LD	R24,Z
    0557F 328E      CPI	R24,0x2E
    05580 F009      BEQ	0x5582
    05581 C029      RJMP	0x55AB
    05582 01C6      MOVW	R24,R12
    05583 9701      SBIW	R24,1
    05584 016C      MOVW	R12,R24
    05585 01FC      MOVW	R30,R24
    05586 0DE0      ADD	R30,R0
    05587 1DF1      ADC	R31,R1
    05588 80E0      LD	R14,Z
    05589 24FF      CLR	R15
    0558A 2D8E      MOV	R24,R14
    0558B 3380      CPI	R24,0x30
    0558C F058      BCS	0x5598
    0558D E388      LDI	R24,0x38
    0558E 158E      CP	R24,R14
    0558F F040      BCS	0x5598
    05590 0176      MOVW	R14,R12
    05591 0CE0      ADD	R14,R0
    05592 1CF1      ADC	R15,R1
    05593 01F7      MOVW	R30,R14
    05594 8180      LD	R24,Z
    05595 5F8F      SUBI	R24,0xFF
    05596 8380      ST	Z,R24
    05597 C029      RJMP	0x55C1
    05598 01F6      MOVW	R30,R12
    05599 A40C      LDD	R0,Y+44
    0559A A41D      LDD	R1,Y+45
    0559B 0DE0      ADD	R30,R0
    0559C 1DF1      ADC	R31,R1
    0559D 8180      LD	R24,Z
    0559E 3389      CPI	R24,0x39
    0559F F459      BNE	0x55AB
    055A0 01F6      MOVW	R30,R12
    055A1 0DE0      ADD	R30,R0
    055A2 1DF1      ADC	R31,R1
    055A3 E381      LDI	R24,0x31
    055A4 8380      ST	Z,R24
    055A5 8D8F      LDD	R24,Y+31
    055A6 A198      LDD	R25,Y+32
    055A7 9601      ADIW	R24,1
    055A8 A398      STD	Y+32,R25
    055A9 8F8F      STD	Y+31,R24
    055AA C016      RJMP	0x55C1
    055AB 01F6      MOVW	R30,R12
    055AC A40C      LDD	R0,Y+44
    055AD A41D      LDD	R1,Y+45
    055AE 0DE0      ADD	R30,R0
    055AF 1DF1      ADC	R31,R1
    055B0 8180      LD	R24,Z
    055B1 3389      CPI	R24,0x39
    055B2 F429      BNE	0x55B8
    055B3 01F6      MOVW	R30,R12
    055B4 0DE0      ADD	R30,R0
    055B5 1DF1      ADC	R31,R1
    055B6 E380      LDI	R24,0x30
    055B7 8380      ST	Z,R24
    055B8 01C6      MOVW	R24,R12
    055B9 9701      SBIW	R24,1
    055BA 016C      MOVW	R12,R24
    055BB 01C6      MOVW	R24,R12
    055BC 3080      CPI	R24,0
    055BD E0E0      LDI	R30,0
    055BE 079E      CPC	R25,R30
    055BF F00C      BLT	0x55C1
    055C0 CFA3      RJMP	0x5564
    055C1 84CC      LDD	R12,Y+12
    055C2 84DD      LDD	R13,Y+13
    055C3 01C6      MOVW	R24,R12
    055C4 9601      ADIW	R24,1
    055C5 879D      STD	Y+13,R25
    055C6 878C      STD	Y+12,R24
    055C7 01F6      MOVW	R30,R12
    055C8 A40C      LDD	R0,Y+44
    055C9 A41D      LDD	R1,Y+45
    055CA 0DE0      ADD	R30,R0
    055CB 1DF1      ADC	R31,R1
    055CC A009      LDD	R0,Y+33
    055CD 8200      ST	Z,R0
    055CE 8D8F      LDD	R24,Y+31
    055CF A198      LDD	R25,Y+32
    055D0 3080      CPI	R24,0
    055D1 E0E0      LDI	R30,0
    055D2 079E      CPC	R25,R30
    055D3 F49C      BGE	0x55E7
    055D4 84CC      LDD	R12,Y+12
    055D5 84DD      LDD	R13,Y+13
    055D6 01C6      MOVW	R24,R12
    055D7 9601      ADIW	R24,1
    055D8 879D      STD	Y+13,R25
    055D9 878C      STD	Y+12,R24
    055DA 01F6      MOVW	R30,R12
    055DB A40C      LDD	R0,Y+44
    055DC A41D      LDD	R1,Y+45
    055DD 0DE0      ADD	R30,R0
    055DE 1DF1      ADC	R31,R1
    055DF E28D      LDI	R24,0x2D
    055E0 8380      ST	Z,R24
    055E1 8C0F      LDD	R0,Y+31
    055E2 A018      LDD	R1,Y+32
    055E3 9400      COM	R0
    055E4 9410      COM	R1
    055E5 A218      STD	Y+32,R1
    055E6 8E0F      STD	Y+31,R0
    055E7 E08A      LDI	R24,0xA
    055E8 E090      LDI	R25,0
    055E9 8399      STD	Y+1,R25
    055EA 8388      ST	Y,R24
    055EB 8D2F      LDD	R18,Y+31
    055EC A138      LDD	R19,Y+32
    055ED 850C      LDD	R16,Y+12
    055EE 851D      LDD	R17,Y+13
    055EF A40C      LDD	R0,Y+44
    055F0 A41D      LDD	R1,Y+45
    055F1 0D00      ADD	R16,R0
    055F2 1D11      ADC	R17,R1
    055F3 940E 4EF0 CALL	_itoa
    055F5 2400      CLR	R0
    055F6 2411      CLR	R1
    055F7 861D      STD	Y+13,R1
    055F8 860C      STD	Y+12,R0
    055F9 85EC      LDD	R30,Y+12
    055FA 85FD      LDD	R31,Y+13
    055FB A40C      LDD	R0,Y+44
    055FC A41D      LDD	R1,Y+45
    055FD 0DE0      ADD	R30,R0
    055FE 1DF1      ADC	R31,R1
    055FF 8020      LD	R2,Z
    05600 2022      TST	R2
    05601 F429      BNE	0x5607
    05602 840C      LDD	R0,Y+12
    05603 841D      LDD	R1,Y+13
    05604 8E1B      STD	Y+27,R1
    05605 8E0A      STD	Y+26,R0
    05606 C009      RJMP	0x5610
    05607 858C      LDD	R24,Y+12
    05608 859D      LDD	R25,Y+13
    05609 9601      ADIW	R24,1
    0560A 879D      STD	Y+13,R25
    0560B 878C      STD	Y+12,R24
    0560C 3184      CPI	R24,0x14
    0560D E0E0      LDI	R30,0
    0560E 079E      CPC	R25,R30
    0560F F34C      BLT	0x55F9
    05610 A80C      LDD	R0,Y+52
    05611 A81D      LDD	R1,Y+53
    05612 FE02      SBRS	R0,2
    05613 C021      RJMP	0x5635
    05614 8C0A      LDD	R0,Y+26
    05615 8C1B      LDD	R1,Y+27
    05616 A90E      LDD	R16,Y+54
    05617 A91F      LDD	R17,Y+55
    05618 1600      CP	R0,R16
    05619 0611      CPC	R1,R17
    0561A F00C      BLT	0x561C
    0561B C18F      RJMP	0x57AB
    0561C 01A0      MOVW	R20,R0
    0561D C009      RJMP	0x5627
    0561E 01FA      MOVW	R30,R20
    0561F A40C      LDD	R0,Y+44
    05620 A41D      LDD	R1,Y+45
    05621 0DE0      ADD	R30,R0
    05622 1DF1      ADC	R31,R1
    05623 8C0C      LDD	R0,Y+28
    05624 8200      ST	Z,R0
    05625 5F4F      SUBI	R20,0xFF
    05626 4F5F      SBCI	R21,0xFF
    05627 A80E      LDD	R0,Y+54
    05628 A81F      LDD	R1,Y+55
    05629 1540      CP	R20,R0
    0562A 0551      CPC	R21,R1
    0562B F394      BLT	0x561E
    0562C 01F0      MOVW	R30,R0
    0562D 9731      SBIW	R30,1
    0562E A40C      LDD	R0,Y+44
    0562F A41D      LDD	R1,Y+45
    05630 0DE0      ADD	R30,R0
    05631 1DF1      ADC	R31,R1
    05632 2422      CLR	R2
    05633 8220      ST	Z,R2
    05634 C176      RJMP	0x57AB
    05635 8C0A      LDD	R0,Y+26
    05636 8C1B      LDD	R1,Y+27
    05637 A90E      LDD	R16,Y+54
    05638 A91F      LDD	R17,Y+55
    05639 1600      CP	R0,R16
    0563A 0611      CPC	R1,R17
    0563B F00C      BLT	0x563D
    0563C C16E      RJMP	0x57AB
    0563D 01A0      MOVW	R20,R0
    0563E C014      RJMP	0x5653
    0563F 01FA      MOVW	R30,R20
    05640 A80E      LDD	R0,Y+54
    05641 A81F      LDD	R1,Y+55
    05642 0DE0      ADD	R30,R0
    05643 1DF1      ADC	R31,R1
    05644 8C0A      LDD	R0,Y+26
    05645 8C1B      LDD	R1,Y+27
    05646 19E0      SUB	R30,R0
    05647 09F1      SBC	R31,R1
    05648 A40C      LDD	R0,Y+44
    05649 A41D      LDD	R1,Y+45
    0564A 0DE0      ADD	R30,R0
    0564B 1DF1      ADC	R31,R1
    0564C 01DA      MOVW	R26,R20
    0564D 0DA0      ADD	R26,R0
    0564E 1DB1      ADC	R27,R1
    0564F 902C      LD	R2,X
    05650 8220      ST	Z,R2
    05651 5041      SUBI	R20,1
    05652 4050      SBCI	R21,0
    05653 3040      CPI	R20,0
    05654 E0E0      LDI	R30,0
    05655 075E      CPC	R21,R30
    05656 F744      BGE	0x563F
    05657 A94E      LDD	R20,Y+54
    05658 A95F      LDD	R21,Y+55
    05659 8C0A      LDD	R0,Y+26
    0565A 8C1B      LDD	R1,Y+27
    0565B 1940      SUB	R20,R0
    0565C 0951      SBC	R21,R1
    0565D 5041      SUBI	R20,1
    0565E 4050      SBCI	R21,0
    0565F C009      RJMP	0x5669
    05660 01FA      MOVW	R30,R20
    05661 A40C      LDD	R0,Y+44
    05662 A41D      LDD	R1,Y+45
    05663 0DE0      ADD	R30,R0
    05664 1DF1      ADC	R31,R1
    05665 880F      LDD	R0,Y+23
    05666 8200      ST	Z,R0
    05667 5041      SUBI	R20,1
    05668 4050      SBCI	R21,0
    05669 3040      CPI	R20,0
    0566A E0E0      LDI	R30,0
    0566B 075E      CPC	R21,R30
    0566C F79C      BGE	0x5660
    0566D A80C      LDD	R0,Y+52
    0566E A81D      LDD	R1,Y+53
    0566F FE04      SBRS	R0,4
    05670 C13A      RJMP	0x57AB
    05671 880C      LDD	R0,Y+20
    05672 890F      LDD	R16,Y+23
    05673 1600      CP	R0,R16
    05674 F409      BNE	0x5676
    05675 C135      RJMP	0x57AB
    05676 A5EC      LDD	R30,Y+44
    05677 A5FD      LDD	R31,Y+45
    05678 8200      ST	Z,R0
    05679 A9EE      LDD	R30,Y+54
    0567A A9FF      LDD	R31,Y+55
    0567B 8C0A      LDD	R0,Y+26
    0567C 8C1B      LDD	R1,Y+27
    0567D 19E0      SUB	R30,R0
    0567E 09F1      SBC	R31,R1
    0567F A40C      LDD	R0,Y+44
    05680 A41D      LDD	R1,Y+45
    05681 0DE0      ADD	R30,R0
    05682 1DF1      ADC	R31,R1
    05683 2E00      MOV	R0,R16
    05684 8200      ST	Z,R0
    05685 C125      RJMP	0x57AB
    05686 A80C      LDD	R0,Y+52
    05687 A81D      LDD	R1,Y+53
    05688 FE00      SBRS	R0,0
    05689 C010      RJMP	0x569A
    0568A 882A      LDD	R2,Y+18
    0568B 883B      LDD	R3,Y+19
    0568C AC08      LDD	R0,Y+56
    0568D AC19      LDD	R1,Y+57
    0568E 0C20      ADD	R2,R0
    0568F 1C31      ADC	R3,R1
    05690 142A      CP	R2,R10
    05691 043B      CPC	R3,R11
    05692 F07C      BLT	0x56A2
    05693 898A      LDD	R24,Y+18
    05694 899B      LDD	R25,Y+19
    05695 0D80      ADD	R24,R0
    05696 1D91      ADC	R25,R1
    05697 9601      ADIW	R24,1
    05698 015C      MOVW	R10,R24
    05699 C008      RJMP	0x56A2
    0569A 898A      LDD	R24,Y+18
    0569B 899B      LDD	R25,Y+19
    0569C 9601      ADIW	R24,1
    0569D 16A8      CP	R10,R24
    0569E 06B9      CPC	R11,R25
    0569F F411      BNE	0x56A2
    056A0 88AA      LDD	R10,Y+18
    056A1 88BB      LDD	R11,Y+19
    056A2 E184      LDI	R24,0x14
    056A3 E090      LDI	R25,0
    056A4 158A      CP	R24,R10
    056A5 059B      CPC	R25,R11
    056A6 F40C      BGE	0x56A8
    056A7 015C      MOVW	R10,R24
    056A8 0115      MOVW	R2,R10
    056A9 8808      LDD	R0,Y+16
    056AA 8819      LDD	R1,Y+17
    056AB 1820      SUB	R2,R0
    056AC 0831      SBC	R3,R1
    056AD 8E3B      STD	Y+27,R3
    056AE 8E2A      STD	Y+26,R2
    056AF 880C      LDD	R0,Y+20
    056B0 890F      LDD	R16,Y+23
    056B1 1600      CP	R0,R16
    056B2 F021      BEQ	0x56B7
    056B3 01C1      MOVW	R24,R2
    056B4 9601      ADIW	R24,1
    056B5 8F9B      STD	Y+27,R25
    056B6 8F8A      STD	Y+26,R24
    056B7 A80E      LDD	R0,Y+54
    056B8 A81F      LDD	R1,Y+55
    056B9 8D0A      LDD	R16,Y+26
    056BA 8D1B      LDD	R17,Y+27
    056BB 1600      CP	R0,R16
    056BC 0611      CPC	R1,R17
    056BD F41C      BGE	0x56C1
    056BE 0108      MOVW	R0,R16
    056BF AA1F      STD	Y+55,R1
    056C0 AA0E      STD	Y+54,R0
    056C1 E184      LDI	R24,0x14
    056C2 E090      LDI	R25,0
    056C3 A80E      LDD	R0,Y+54
    056C4 A81F      LDD	R1,Y+55
    056C5 1580      CP	R24,R0
    056C6 0591      CPC	R25,R1
    056C7 F414      BGE	0x56CA
    056C8 AB9F      STD	Y+55,R25
    056C9 AB8E      STD	Y+54,R24
    056CA E184      LDI	R24,0x14
    056CB E090      LDI	R25,0
    056CC 8C0A      LDD	R0,Y+26
    056CD 8C1B      LDD	R1,Y+27
    056CE 1580      CP	R24,R0
    056CF 0591      CPC	R25,R1
    056D0 F414      BGE	0x56D3
    056D1 8F9B      STD	Y+27,R25
    056D2 8F8A      STD	Y+26,R24
    056D3 A80C      LDD	R0,Y+52
    056D4 A81D      LDD	R1,Y+53
    056D5 FC02      SBRC	R0,2
    056D6 C007      RJMP	0x56DE
    056D7 A80E      LDD	R0,Y+54
    056D8 A81F      LDD	R1,Y+55
    056D9 8D0A      LDD	R16,Y+26
    056DA 8D1B      LDD	R17,Y+27
    056DB 1600      CP	R0,R16
    056DC 0611      CPC	R1,R17
    056DD F471      BNE	0x56EC
    056DE 24CC      CLR	R12
    056DF 24DD      CLR	R13
    056E0 880C      LDD	R0,Y+20
    056E1 890F      LDD	R16,Y+23
    056E2 1600      CP	R0,R16
    056E3 F409      BNE	0x56E5
    056E4 C033      RJMP	0x5718
    056E5 A5EC      LDD	R30,Y+44
    056E6 A5FD      LDD	R31,Y+45
    056E7 8200      ST	Z,R0
    056E8 E081      LDI	R24,1
    056E9 E090      LDI	R25,0
    056EA 016C      MOVW	R12,R24
    056EB C02C      RJMP	0x5718
    056EC A8CE      LDD	R12,Y+54
    056ED A8DF      LDD	R13,Y+55
    056EE 8C0A      LDD	R0,Y+26
    056EF 8C1B      LDD	R1,Y+27
    056F0 18C0      SUB	R12,R0
    056F1 08D1      SBC	R13,R1
    056F2 2744      CLR	R20
    056F3 2755      CLR	R21
    056F4 C009      RJMP	0x56FE
    056F5 01FA      MOVW	R30,R20
    056F6 A40C      LDD	R0,Y+44
    056F7 A41D      LDD	R1,Y+45
    056F8 0DE0      ADD	R30,R0
    056F9 1DF1      ADC	R31,R1
    056FA 880F      LDD	R0,Y+23
    056FB 8200      ST	Z,R0
    056FC 5F4F      SUBI	R20,0xFF
    056FD 4F5F      SBCI	R21,0xFF
    056FE 16C4      CP	R12,R20
    056FF 06D5      CPC	R13,R21
    05700 F7A4      BGE	0x56F5
    05701 880C      LDD	R0,Y+20
    05702 890F      LDD	R16,Y+23
    05703 1600      CP	R0,R16
    05704 F099      BEQ	0x5718
    05705 A80C      LDD	R0,Y+52
    05706 A81D      LDD	R1,Y+53
    05707 FE04      SBRS	R0,4
    05708 C005      RJMP	0x570E
    05709 A5EC      LDD	R30,Y+44
    0570A A5FD      LDD	R31,Y+45
    0570B 880C      LDD	R0,Y+20
    0570C 8200      ST	Z,R0
    0570D C007      RJMP	0x5715
    0570E 01F6      MOVW	R30,R12
    0570F A40C      LDD	R0,Y+44
    05710 A41D      LDD	R1,Y+45
    05711 0DE0      ADD	R30,R0
    05712 1DF1      ADC	R31,R1
    05713 880C      LDD	R0,Y+20
    05714 8200      ST	Z,R0
    05715 01C6      MOVW	R24,R12
    05716 9601      ADIW	R24,1
    05717 016C      MOVW	R12,R24
    05718 01A6      MOVW	R20,R12
    05719 8C08      LDD	R0,Y+24
    0571A 8C19      LDD	R1,Y+25
    0571B 2000      TST	R0
    0571C F459      BNE	0x5728
    0571D 2011      TST	R1
    0571E F449      BNE	0x5728
    0571F 01FA      MOVW	R30,R20
    05720 A40C      LDD	R0,Y+44
    05721 A41D      LDD	R1,Y+45
    05722 0DE0      ADD	R30,R0
    05723 1DF1      ADC	R31,R1
    05724 E380      LDI	R24,0x30
    05725 8380      ST	Z,R24
    05726 5F4F      SUBI	R20,0xFF
    05727 4F5F      SBCI	R21,0xFF
    05728 2400      CLR	R0
    05729 2411      CLR	R1
    0572A 861D      STD	Y+13,R1
    0572B 860C      STD	Y+12,R0
    0572C C016      RJMP	0x5743
    0572D 842C      LDD	R2,Y+12
    0572E 843D      LDD	R3,Y+13
    0572F 0E26      ADD	R2,R22
    05730 1E37      ADC	R3,R23
    05731 89E8      LDD	R30,Y+16
    05732 89F9      LDD	R31,Y+17
    05733 0DE2      ADD	R30,R2
    05734 1DF3      ADC	R31,R3
    05735 8020      LD	R2,Z
    05736 01FA      MOVW	R30,R20
    05737 A40C      LDD	R0,Y+44
    05738 A41D      LDD	R1,Y+45
    05739 0DE0      ADD	R30,R0
    0573A 1DF1      ADC	R31,R1
    0573B 8220      ST	Z,R2
    0573C 5F4F      SUBI	R20,0xFF
    0573D 4F5F      SBCI	R21,0xFF
    0573E 858C      LDD	R24,Y+12
    0573F 859D      LDD	R25,Y+13
    05740 9601      ADIW	R24,1
    05741 879D      STD	Y+13,R25
    05742 878C      STD	Y+12,R24
    05743 840C      LDD	R0,Y+12
    05744 841D      LDD	R1,Y+13
    05745 8D08      LDD	R16,Y+24
    05746 8D19      LDD	R17,Y+25
    05747 1600      CP	R0,R16
    05748 0611      CPC	R1,R17
    05749 F31C      BLT	0x572D
    0574A 880A      LDD	R0,Y+18
    0574B 881B      LDD	R1,Y+19
    0574C 140A      CP	R0,R10
    0574D 041B      CPC	R1,R11
    0574E F44C      BGE	0x5758
    0574F 01FA      MOVW	R30,R20
    05750 A40C      LDD	R0,Y+44
    05751 A41D      LDD	R1,Y+45
    05752 0DE0      ADD	R30,R0
    05753 1DF1      ADC	R31,R1
    05754 E28E      LDI	R24,0x2E
    05755 8380      ST	Z,R24
    05756 5F4F      SUBI	R20,0xFF
    05757 4F5F      SBCI	R21,0xFF
    05758 2400      CLR	R0
    05759 2411      CLR	R1
    0575A 861D      STD	Y+13,R1
    0575B 860C      STD	Y+12,R0
    0575C C02C      RJMP	0x5789
    0575D 882D      LDD	R2,Y+21
    0575E 883E      LDD	R3,Y+22
    0575F 840E      LDD	R0,Y+14
    05760 841F      LDD	R1,Y+15
    05761 1820      SUB	R2,R0
    05762 0831      SBC	R3,R1
    05763 840C      LDD	R0,Y+12
    05764 841D      LDD	R1,Y+13
    05765 1402      CP	R0,R2
    05766 0413      CPC	R1,R3
    05767 F47C      BGE	0x5777
    05768 0110      MOVW	R2,R0
    05769 0E26      ADD	R2,R22
    0576A 1E37      ADC	R3,R23
    0576B 85EE      LDD	R30,Y+14
    0576C 85FF      LDD	R31,Y+15
    0576D 0DE2      ADD	R30,R2
    0576E 1DF3      ADC	R31,R3
    0576F 8021      LDD	R2,Z+1
    05770 01FA      MOVW	R30,R20
    05771 A40C      LDD	R0,Y+44
    05772 A41D      LDD	R1,Y+45
    05773 0DE0      ADD	R30,R0
    05774 1DF1      ADC	R31,R1
    05775 8220      ST	Z,R2
    05776 C00B      RJMP	0x5782
    05777 A80C      LDD	R0,Y+52
    05778 A81D      LDD	R1,Y+53
    05779 FE00      SBRS	R0,0
    0577A C024      RJMP	0x579F
    0577B 01FA      MOVW	R30,R20
    0577C A40C      LDD	R0,Y+44
    0577D A41D      LDD	R1,Y+45
    0577E 0DE0      ADD	R30,R0
    0577F 1DF1      ADC	R31,R1
    05780 E380      LDI	R24,0x30
    05781 8380      ST	Z,R24
    05782 5F4F      SUBI	R20,0xFF
    05783 4F5F      SBCI	R21,0xFF
    05784 858C      LDD	R24,Y+12
    05785 859D      LDD	R25,Y+13
    05786 9601      ADIW	R24,1
    05787 879D      STD	Y+13,R25
    05788 878C      STD	Y+12,R24
    05789 840C      LDD	R0,Y+12
    0578A 841D      LDD	R1,Y+13
    0578B AD08      LDD	R16,Y+56
    0578C AD19      LDD	R17,Y+57
    0578D 1600      CP	R0,R16
    0578E 0611      CPC	R1,R17
    0578F F42C      BGE	0x5795
    05790 3144      CPI	R20,0x14
    05791 E0E0      LDI	R30,0
    05792 075E      CPC	R21,R30
    05793 F40C      BGE	0x5795
    05794 CFC8      RJMP	0x575D
    05795 C009      RJMP	0x579F
    05796 01FA      MOVW	R30,R20
    05797 A40C      LDD	R0,Y+44
    05798 A41D      LDD	R1,Y+45
    05799 0DE0      ADD	R30,R0
    0579A 1DF1      ADC	R31,R1
    0579B 8C0C      LDD	R0,Y+28
    0579C 8200      ST	Z,R0
    0579D 5F4F      SUBI	R20,0xFF
    0579E 4F5F      SBCI	R21,0xFF
    0579F A80E      LDD	R0,Y+54
    057A0 A81F      LDD	R1,Y+55
    057A1 1540      CP	R20,R0
    057A2 0551      CPC	R21,R1
    057A3 F394      BLT	0x5796
    057A4 01FA      MOVW	R30,R20
    057A5 A40C      LDD	R0,Y+44
    057A6 A41D      LDD	R1,Y+45
    057A7 0DE0      ADD	R30,R0
    057A8 1DF1      ADC	R31,R1
    057A9 2422      CLR	R2
    057AA 8220      ST	Z,R2
    057AB A50C      LDD	R16,Y+44
    057AC A51D      LDD	R17,Y+45
    057AD 96A2      ADIW	R28,0x22
    057AE 940E 4AFC CALL	pop_xgsetF0FC
    057B0 9624      ADIW	R28,4
    057B1 9508      RET
