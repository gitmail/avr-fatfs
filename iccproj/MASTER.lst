Interrupt Vectors
    00000 940C 0395 JMP	__start|__text_start
    0003C 940C 3A81 JMP	_uart1_rx_isr

Program Code (text area)
__start|__text_start:
    00395 EFCF      LDI	R28,0xFF
    00396 E1D0      LDI	R29,0x10
    00397 BFCD      OUT	0x3D,R28
    00398 BFDE      OUT	0x3E,R29
    00399 50C0      SUBI	R28,0
    0039A 40D1      SBCI	R29,1
    0039B EA0A      LDI	R16,0xAA
    0039C 8308      ST	Y,R16
    0039D 2400      CLR	R0
    0039E EDE8      LDI	R30,0xD8
    0039F E0F5      LDI	R31,5
    003A0 E018      LDI	R17,0x8
    003A1 3DEF      CPI	R30,0xDF
    003A2 07F1      CPC	R31,R17
    003A3 F011      BEQ	0x03A6
    003A4 9201      ST	Z+,R0
    003A5 CFFB      RJMP	0x03A1
    003A6 8300      ST	Z,R16
    003A7 E5E2      LDI	R30,0x52
    003A8 E0F2      LDI	R31,2
    003A9 E0A0      LDI	R26,0
    003AA E0B1      LDI	R27,1
    003AB E017      LDI	R17,7
    003AC E000      LDI	R16,0
    003AD BF0B      OUT	0x3B,R16
    003AE 32EA      CPI	R30,0x2A
    003AF 07F1      CPC	R31,R17
    003B0 F021      BEQ	0x03B5
    003B1 95C8      LPM
    003B2 9631      ADIW	R30,1
    003B3 920D      ST	X+,R0
    003B4 CFF9      RJMP	0x03AE
    003B5 940E 2589 CALL	_main
_exit:
    003B7 CFFF      RJMP	_exit
_disk_initialize:
  state                --> R20
  drv                  --> R10
    003B8 92AA      ST	-Y,R10
    003B9 934A      ST	-Y,R20
    003BA 2EA0      MOV	R10,R16
FILE: D:\LQD\software\software_src\diskio.c
(0001) 
(0002) 
(0003) /*-----------------------------------------------------------------------*/
(0004) /* Low level disk I/O module skeleton for FatFs     (C)ChaN, 2007        */
(0005) /*-----------------------------------------------------------------------*/
(0006) /* This is a stub disk I/O module that acts as front end of the existing */
(0007) /* disk I/O modules and attach it to FatFs module with common interface. */
(0008) /*-----------------------------------------------------------------------*/
(0009) 
(0010) #include "diskio.h"
(0011) #include "sd.h"
(0012) 
(0013) 
(0014) /*-----------------------------------------------------------------------*/
(0015) /* Correspondence between physical drive number and physical drive.      */
(0016) /* Note that Tiny-FatFs supports only single drive and always            */
(0017)                                       
(0018) 
(0019) ////////////////////////////
(0020) /*
(0021)    struct tm {
(0022)    	int tm_sec;   // 秒 seconds after the minute, 0 to 60
(0023)    	int tm_min;   // 分 minutes after the hour, 0 to 59
(0024) 	int tm_hour;  // 时 hours since midnight, 0 to 23*
(0025) 	int tm_mday;  // 日 day of the month, 1 to 31
(0026) 	int tm_mon;   // 月 months since January, 0 to 11
(0027) 	int tm_year;  // 年 years since 1900
(0028) 	int tm_wday;  // 星期 days since Sunday, 0 to 6
(0029) 	int tm_yday;  // 从元旦起的天数 days since January 1, 0 to 365
(0030)  	int tm_isdst; // 夏令时？？Daylight Savings Time flag
(0031)  	};
(0032) */
(0033) /*-----------------------------------------------------------------------*/
(0034) /* Inidialize a Drive                                                    */
(0035) 
(0036) DSTATUS disk_initialize ( 
(0037) BYTE drv				/* Physical drive nmuber (0..) */
(0038) )
(0039) {
(0040)     unsigned char state;
(0041) 
(0042)     if(drv)
    003BB 20AA      TST	R10
    003BC F011      BEQ	0x03BF
(0043)     {
(0044)         return STA_NOINIT;  //仅支持磁盘0的操作
    003BD E001      LDI	R16,1
    003BE C00C      RJMP	0x03CB
(0045)     }
(0046) 
(0047)     state = SD_Init();
    003BF 940E 2D7B CALL	_SD_Init
    003C1 2F40      MOV	R20,R16
(0048)     if(state == STA_NODISK)
    003C2 3002      CPI	R16,2
    003C3 F411      BNE	0x03C6
(0049)     {
(0050)         return STA_NODISK;
    003C4 E002      LDI	R16,2
    003C5 C005      RJMP	0x03CB
(0051)     }
(0052)     else if(state != 0)
    003C6 2344      TST	R20
    003C7 F011      BEQ	0x03CA
(0053)     {
(0054)         return STA_NOINIT;  //其他错误：初始化失败
    003C8 E001      LDI	R16,1
    003C9 C001      RJMP	0x03CB
(0055)     }
(0056)     else
(0057)     {
(0058)         return 0;           //初始化成功
    003CA 2700      CLR	R16
    003CB 9149      LD	R20,Y+
    003CC 90A9      LD	R10,Y+
    003CD 9508      RET
(0059)     }
(0060) }
(0061) 
(0062) 
(0063) 
(0064) /*-----------------------------------------------------------------------*/
(0065) /* Return Disk Status                                                    */
(0066) 
(0067) DSTATUS disk_status (
(0068) 	BYTE drv		/* Physical drive nmuber (0..) */
(0069) )
(0070) {
(0071)     if(drv)
_disk_status:
  drv                  --> R16
    003CE 2300      TST	R16
    003CF F011      BEQ	0x03D2
(0072)     {
(0073)         return STA_NOINIT;  //仅支持磁盘0操作
    003D0 E001      LDI	R16,1
    003D1 C001      RJMP	0x03D3
(0074)     }
(0075)     return 0;
    003D2 2700      CLR	R16
    003D3 9508      RET
_disk_read:
  res                  --> R10
  count                --> R20
  sector               --> Y,+10
  buff                 --> R12
  drv                  --> R14
    003D4 940E 48B5 CALL	push_xgset30FC
    003D6 0169      MOVW	R12,R18
    003D7 2EE0      MOV	R14,R16
    003D8 9722      SBIW	R28,2
    003D9 854E      LDD	R20,Y+14
(0076) }
(0077) 
(0078) 
(0079) 
(0080) /*-----------------------------------------------------------------------*/
(0081) /* Read Sector(s)                                                        */
(0082) 
(0083) DRESULT disk_read (
(0084) 	BYTE drv,		/* Physical drive nmuber (0..) */
(0085) 	BYTE *buff,		/* Data buffer to store read data */
(0086) 	DWORD sector,	/* Sector address (LBA) */
(0087) 	BYTE count		/* Number of sectors to read (1..255) */
(0088) )
(0089) {
(0090) 	unsigned char res=0;
    003DA 24AA      CLR	R10
(0091)     if (drv || !count)
    003DB 20EE      TST	R14
    003DC F411      BNE	0x03DF
    003DD 2344      TST	R20
    003DE F411      BNE	0x03E1
(0092)     {    
(0093)         return RES_PARERR;  //仅支持单磁盘操作，count不能等于0，否则返回参数错误
    003DF E004      LDI	R16,4
    003E0 C010      RJMP	0x03F1
(0094)     }
(0095) 
(0096)     if(count==1)            //1个sector的读操作      
    003E1 3041      CPI	R20,1
    003E2 F449      BNE	0x03EC
(0097)     {                                                
(0098)         res = SD_Read_Sector(sector, buff);      
    003E3 82D9      STD	Y+1,R13
    003E4 82C8      ST	Y,R12
    003E5 850A      LDD	R16,Y+10
    003E6 851B      LDD	R17,Y+11
    003E7 852C      LDD	R18,Y+12
    003E8 853D      LDD	R19,Y+13
    003E9 940E 2E61 CALL	_SD_Read_Sector
    003EB 2EA0      MOV	R10,R16
(0099)     }                                                                                                 
(0100) 
(0101)     //处理返回值，将SD_driver.c的返回值转成ff.c的返回值
(0102)     if(res == 0x00)
    003EC 20AA      TST	R10
    003ED F411      BNE	0x03F0
(0103)     {
(0104)         return RES_OK;
    003EE 2700      CLR	R16
    003EF C001      RJMP	0x03F1
(0105)     }
(0106)     else
(0107)     {
(0108)         return RES_ERROR;
    003F0 E001      LDI	R16,1
    003F1 9622      ADIW	R28,2
    003F2 940C 489F JMP	pop_xgset30FC
_disk_write:
  count                --> R12
  sector               --> Y,+8
  buff                 --> R10
  drv                  --> R14
    003F4 940E 48B7 CALL	push_xgset00FC
    003F6 0159      MOVW	R10,R18
    003F7 2EE0      MOV	R14,R16
    003F8 9722      SBIW	R28,2
    003F9 84CC      LDD	R12,Y+12
(0109)     }
(0110) }
(0111) 
(0112) 
(0113) 
(0114) /*-----------------------------------------------------------------------*/
(0115) /* Write Sector(s)                                                       */
(0116) 
(0117) #if _READONLY == 0
(0118) DRESULT disk_write (
(0119) 	BYTE drv,			/* Physical drive nmuber (0..) */
(0120) 	BYTE *buff,	        /* Data to be written */
(0121) 	DWORD sector,		/* Sector address (LBA) */
(0122) 	BYTE count			/* Number of sectors to write (1..255) */
(0123) )
(0124) {
(0125)     if (drv || !count)
    003FA 20EE      TST	R14
    003FB F411      BNE	0x03FE
    003FC 20CC      TST	R12
    003FD F411      BNE	0x0400
(0126)     {    
(0127)         return RES_PARERR;  //仅支持单磁盘操作，count不能等于0，否则返回参数错误
    003FE E004      LDI	R16,4
    003FF C009      RJMP	0x0409
(0128)     }   
(0129)    // 读写操作
(0130)     SD_Write_Sector(sector,buff);
    00400 82B9      STD	Y+1,R11
    00401 82A8      ST	Y,R10
    00402 8508      LDD	R16,Y+8
    00403 8519      LDD	R17,Y+9
    00404 852A      LDD	R18,Y+10
    00405 853B      LDD	R19,Y+11
    00406 940E 2DDB CALL	_SD_Write_Sector
(0131) 	  
(0132)     return RES_OK;
    00408 2700      CLR	R16
    00409 9622      ADIW	R28,2
    0040A 940C 4898 JMP	pop_xgset00FC
_disk_ioctl:
  buff                 --> Y,+4
  ctrl                 --> Y,+2
  drv                  --> Y,+0
    0040C 940E 476E CALL	push_arg4
(0133) }
(0134) #endif /* _READONLY */
(0135) 
(0136) 
(0137) 
(0138) /*-----------------------------------------------------------------------*/
(0139) /* Miscellaneous Functions                                               */
(0140) DRESULT disk_ioctl (
(0141) 	BYTE drv,		/* Physical drive nmuber (0..) */
(0142) 	BYTE ctrl,		/* Control code */
(0143) 	void *buff		/* Buffer to send/receive control data */
(0144) )
(0145) {
(0146)  	drv=drv;
(0147) 	ctrl=ctrl;
(0148) 	buff=buff;
(0149) 	return 0;
    0040E 2700      CLR	R16
    0040F 9624      ADIW	R28,4
    00410 9508      RET
(0150) }
(0151) DWORD get_fattime (void)
(0152) {
(0153) 
(0154)   return 1950466005;
_get_fattime:
    00411 ED05      LDI	R16,0xD5
    00412 EB1F      LDI	R17,0xBF
    00413 E421      LDI	R18,0x41
    00414 E734      LDI	R19,0x74
    00415 9508      RET
ff.c:mem_cpy:
  s                    --> R12
  d                    --> R10
  cnt                  --> R20
  src                  --> R18
  dst                  --> R16
    00416 940E 48E0 CALL	push_xgset303C
    00418 814E      LDD	R20,Y+6
    00419 815F      LDD	R21,Y+7
FILE: D:\LQD\software\software_src\ff.c
(0001) /*----------------------------------------------------------------------------/
(0002) /  FatFs - FAT file system module  R0.09                  (C)ChaN, 2011
(0003) /-----------------------------------------------------------------------------/
(0004) / FatFs module is a generic FAT file system module for small embedded systems.
(0005) / This is a free software that opened for education, research and commercial
(0006) / developments under license policy of following terms.
(0007) /
(0008) /  Copyright (C) 2011, ChaN, all right reserved.
(0009) /
(0010) / * The FatFs module is a free software and there is NO WARRANTY.
(0011) / * No restriction on use. You can use, modify and redistribute it for
(0012) /   personal, non-profit or commercial products UNDER YOUR RESPONSIBILITY.
(0013) / * Redistributions of source code must retain the above copyright notice.
(0014) /
(0015) /-----------------------------------------------------------------------------/
(0016) / Feb 26,'06 R0.00  Prototype.
(0017) /
(0018) / Apr 29,'06 R0.01  First stable version.
(0019) /
(0020) / Jun 01,'06 R0.02  Added FAT12 support.
(0021) /                   Removed unbuffered mode.
(0022) /                   Fixed a problem on small (<32M) partition.
(0023) / Jun 10,'06 R0.02a Added a configuration option (_FS_MINIMUM).
(0024) /
(0025) / Sep 22,'06 R0.03  Added f_rename().
(0026) /                   Changed option _FS_MINIMUM to _FS_MINIMIZE.
(0027) / Dec 11,'06 R0.03a Improved cluster scan algorithm to write files fast.
(0028) /                   Fixed f_mkdir() creates incorrect directory on FAT32.
(0029) /
(0030) / Feb 04,'07 R0.04  Supported multiple drive system.
(0031) /                   Changed some interfaces for multiple drive system.
(0032) /                   Changed f_mountdrv() to f_mount().
(0033) /                   Added f_mkfs().
(0034) / Apr 01,'07 R0.04a Supported multiple partitions on a physical drive.
(0035) /                   Added a capability of extending file size to f_lseek().
(0036) /                   Added minimization level 3.
(0037) /                   Fixed an endian sensitive code in f_mkfs().
(0038) / May 05,'07 R0.04b Added a configuration option _USE_NTFLAG.
(0039) /                   Added FSInfo support.
(0040) /                   Fixed DBCS name can result FR_INVALID_NAME.
(0041) /                   Fixed short seek (<= csize) collapses the file object.
(0042) /
(0043) / Aug 25,'07 R0.05  Changed arguments of f_read(), f_write() and f_mkfs().
(0044) /                   Fixed f_mkfs() on FAT32 creates incorrect FSInfo.
(0045) /                   Fixed f_mkdir() on FAT32 creates incorrect directory.
(0046) / Feb 03,'08 R0.05a Added f_truncate() and f_utime().
(0047) /                   Fixed off by one error at FAT sub-type determination.
(0048) /                   Fixed btr in f_read() can be mistruncated.
(0049) /                   Fixed cached sector is not flushed when create and close without write.
(0050) /
(0051) / Apr 01,'08 R0.06  Added fputc(), fputs(), fprintf() and fgets().
(0052) /                   Improved performance of f_lseek() on moving to the same or following cluster.
(0053) /
(0054) / Apr 01,'09 R0.07  Merged Tiny-FatFs as a configuration option. (_FS_TINY)
(0055) /                   Added long file name feature.
(0056) /                   Added multiple code page feature.
(0057) /                   Added re-entrancy for multitask operation.
(0058) /                   Added auto cluster size selection to f_mkfs().
(0059) /                   Added rewind option to f_readdir().
(0060) /                   Changed result code of critical errors.
(0061) /                   Renamed string functions to avoid name collision.
(0062) / Apr 14,'09 R0.07a Separated out OS dependent code on reentrant cfg.
(0063) /                   Added multiple sector size feature.
(0064) / Jun 21,'09 R0.07c Fixed f_unlink() can return FR_OK on error.
(0065) /                   Fixed wrong cache control in f_lseek().
(0066) /                   Added relative path feature.
(0067) /                   Added f_chdir() and f_chdrive().
(0068) /                   Added proper case conversion to extended char.
(0069) / Nov 03,'09 R0.07e Separated out configuration options from ff.h to ffconf.h.
(0070) /                   Fixed f_unlink() fails to remove a sub-dir on _FS_RPATH.
(0071) /                   Fixed name matching error on the 13 char boundary.
(0072) /                   Added a configuration option, _LFN_UNICODE.
(0073) /                   Changed f_readdir() to return the SFN with always upper case on non-LFN cfg.
(0074) /
(0075) / May 15,'10 R0.08  Added a memory configuration option. (_USE_LFN = 3)
(0076) /                   Added file lock feature. (_FS_SHARE)
(0077) /                   Added fast seek feature. (_USE_FASTSEEK)
(0078) /                   Changed some types on the API, XCHAR->TCHAR.
(0079) /                   Changed fname member in the FILINFO structure on Unicode cfg.
(0080) /                   String functions support UTF-8 encoding files on Unicode cfg.
(0081) / Aug 16,'10 R0.08a Added f_getcwd(). (_FS_RPATH = 2)
(0082) /                   Added sector erase feature. (_USE_ERASE)
(0083) /                   Moved file lock semaphore table from fs object to the bss.
(0084) /                   Fixed a wrong directory entry is created on non-LFN cfg when the given name contains ';'.
(0085) /                   Fixed f_mkfs() creates wrong FAT32 volume.
(0086) / Jan 15,'11 R0.08b Fast seek feature is also applied to f_read() and f_write().
(0087) /                   f_lseek() reports required table size on creating CLMP.
(0088) /                   Extended format syntax of f_printf function.
(0089) /                   Ignores duplicated directory separators in given path names.
(0090) /
(0091) / Sep 06,'11 R0.09  f_mkfs() supports multiple partition to finish the multiple partition feature.
(0092) /                   Added f_fdisk(). (_MULTI_PARTITION = 2)
(0093) /---------------------------------------------------------------------------*/
(0094) 
(0095) #include "ff.h"			/* FatFs configurations and declarations */
(0096) #include "diskio.h"		/* Declarations of low level disk I/O functions */
(0097) #include <string.h>
(0098) 
(0099) /*--------------------------------------------------------------------------
(0100) 
(0101)    Module Private Definitions
(0102) 
(0103) ---------------------------------------------------------------------------*/
(0104) 
(0105) #if _FATFS != 6502	/* Revision ID */
(0106) #error Wrong include file (ff.h).
(0107) #endif
(0108) 
(0109) 
(0110) /* Definitions on sector size */
(0111) #if _MAX_SS != 512 && _MAX_SS != 1024 && _MAX_SS != 2048 && _MAX_SS != 4096
(0112) #error Wrong sector size.
(0113) #endif
(0114) #if _MAX_SS != 512
(0115) #define	SS(fs)	((fs)->ssize)	/* Variable sector size */
(0116) #else
(0117) #define	SS(fs)	512U			/* Fixed sector size */
(0118) #endif
(0119) 
(0120) 
(0121) /* Reentrancy related */
(0122) #if _FS_REENTRANT
(0123) #if _USE_LFN == 1
(0124) #error Static LFN work area must not be used in re-entrant configuration.
(0125) #endif
(0126) #define	ENTER_FF(fs)		{ if (!lock_fs(fs)) return FR_TIMEOUT; }
(0127) #define	LEAVE_FF(fs, res)	{ unlock_fs(fs, res); return res; }
(0128) #else
(0129) #define	ENTER_FF(fs)
(0130) #define LEAVE_FF(fs, res)	return res
(0131) #endif
(0132) 
(0133) #define	ABORT(fs, res)		{ fp->flag |= FA__ERROR; LEAVE_FF(fs, res); }
(0134) 
(0135) 
(0136) /* File shareing feature */
(0137) #if _FS_SHARE
(0138) #if _FS_READONLY
(0139) #error _FS_SHARE must be 0 on read-only cfg.
(0140) #endif
(0141) typedef struct {
(0142) 	FATFS *fs;				/* File ID 1, volume (NULL:blank entry) */
(0143) 	DWORD clu;				/* File ID 2, directory */
(0144) 	WORD idx;				/* File ID 3, directory index */
(0145) 	WORD ctr;				/* File open counter, 0:none, 0x01..0xFF:read open count, 0x100:write mode */
(0146) } FILESEM;
(0147) #endif
(0148) 
(0149) 
(0150) /* Misc definitions */
(0151) #define LD_CLUST(dir)	(((DWORD)LD_WORD(dir+DIR_FstClusHI)<<16) | LD_WORD(dir+DIR_FstClusLO))
(0152) #define ST_CLUST(dir,cl) {ST_WORD(dir+DIR_FstClusLO, cl); ST_WORD(dir+DIR_FstClusHI, (DWORD)cl>>16);}
(0153) 
(0154) 
(0155) /* DBCS code ranges and SBCS extend char conversion table */
(0156) 
(0157) #if _CODE_PAGE == 932	/* Japanese Shift-JIS */
(0158) #define _DF1S	0x81	/* DBC 1st byte range 1 start */
(0159) #define _DF1E	0x9F	/* DBC 1st byte range 1 end */
(0160) #define _DF2S	0xE0	/* DBC 1st byte range 2 start */
(0161) #define _DF2E	0xFC	/* DBC 1st byte range 2 end */
(0162) #define _DS1S	0x40	/* DBC 2nd byte range 1 start */
(0163) #define _DS1E	0x7E	/* DBC 2nd byte range 1 end */
(0164) #define _DS2S	0x80	/* DBC 2nd byte range 2 start */
(0165) #define _DS2E	0xFC	/* DBC 2nd byte range 2 end */
(0166) 
(0167) #elif _CODE_PAGE == 936	/* Simplified Chinese GBK */
(0168) #define _DF1S	0x81
(0169) #define _DF1E	0xFE
(0170) #define _DS1S	0x40
(0171) #define _DS1E	0x7E
(0172) #define _DS2S	0x80
(0173) #define _DS2E	0xFE
(0174) 
(0175) #elif _CODE_PAGE == 949	/* Korean */
(0176) #define _DF1S	0x81
(0177) #define _DF1E	0xFE
(0178) #define _DS1S	0x41
(0179) #define _DS1E	0x5A
(0180) #define _DS2S	0x61
(0181) #define _DS2E	0x7A
(0182) #define _DS3S	0x81
(0183) #define _DS3E	0xFE
(0184) 
(0185) #elif _CODE_PAGE == 950	/* Traditional Chinese Big5 */
(0186) #define _DF1S	0x81
(0187) #define _DF1E	0xFE
(0188) #define _DS1S	0x40
(0189) #define _DS1E	0x7E
(0190) #define _DS2S	0xA1
(0191) #define _DS2E	0xFE
(0192) 
(0193) #elif _CODE_PAGE == 437	/* U.S. (OEM) */
(0194) #define _DF1S	0
(0195) #define _EXCVT {0x80,0x9A,0x90,0x41,0x8E,0x41,0x8F,0x80,0x45,0x45,0x45,0x49,0x49,0x49,0x8E,0x8F,0x90,0x92,0x92,0x4F,0x99,0x4F,0x55,0x55,0x59,0x99,0x9A,0x9B,0x9C,0x9D,0x9E,0x9F, \
(0196) 				0x41,0x49,0x4F,0x55,0xA5,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0x21,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0197) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0198) 				0xE0,0xE1,0xE2,0xE3,0xE4,0xE5,0xE6,0xE7,0xE8,0xE9,0xEA,0xEB,0xEC,0xED,0xEE,0xEF,0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}
(0199) 
(0200) #elif _CODE_PAGE == 720	/* Arabic (OEM) */
(0201) #define _DF1S	0
(0202) #define _EXCVT {0x80,0x81,0x45,0x41,0x84,0x41,0x86,0x43,0x45,0x45,0x45,0x49,0x49,0x8D,0x8E,0x8F,0x90,0x92,0x92,0x93,0x94,0x95,0x49,0x49,0x98,0x99,0x9A,0x9B,0x9C,0x9D,0x9E,0x9F, \
(0203) 				0xA0,0xA1,0xA2,0xA3,0xA4,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0204) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0205) 				0xE0,0xE1,0xE2,0xE3,0xE4,0xE5,0xE6,0xE7,0xE8,0xE9,0xEA,0xEB,0xEC,0xED,0xEE,0xEF,0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}
(0206) 
(0207) #elif _CODE_PAGE == 737	/* Greek (OEM) */
(0208) #define _DF1S	0
(0209) #define _EXCVT {0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x92,0x92,0x93,0x94,0x95,0x96,0x97,0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87, \
(0210) 				0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x91,0xAA,0x92,0x93,0x94,0x95,0x96,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0211) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0212) 				0x97,0xEA,0xEB,0xEC,0xE4,0xED,0xEE,0xE7,0xE8,0xF1,0xEA,0xEB,0xEC,0xED,0xEE,0xEF,0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}
(0213) 
(0214) #elif _CODE_PAGE == 775	/* Baltic (OEM) */
(0215) #define _DF1S	0
(0216) #define _EXCVT {0x80,0x9A,0x91,0xA0,0x8E,0x95,0x8F,0x80,0xAD,0xED,0x8A,0x8A,0xA1,0x8D,0x8E,0x8F,0x90,0x92,0x92,0xE2,0x99,0x95,0x96,0x97,0x97,0x99,0x9A,0x9D,0x9C,0x9D,0x9E,0x9F, \
(0217) 				0xA0,0xA1,0xE0,0xA3,0xA3,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0218) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xB5,0xB6,0xB7,0xB8,0xBD,0xBE,0xC6,0xC7,0xA5,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0219) 				0xE0,0xE1,0xE2,0xE3,0xE5,0xE5,0xE6,0xE3,0xE8,0xE8,0xEA,0xEA,0xEE,0xED,0xEE,0xEF,0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}
(0220) 
(0221) #elif _CODE_PAGE == 850	/* Multilingual Latin 1 (OEM) */
(0222) #define _DF1S	0
(0223) #define _EXCVT {0x80,0x9A,0x90,0xB6,0x8E,0xB7,0x8F,0x80,0xD2,0xD3,0xD4,0xD8,0xD7,0xDE,0x8E,0x8F,0x90,0x92,0x92,0xE2,0x99,0xE3,0xEA,0xEB,0x59,0x99,0x9A,0x9D,0x9C,0x9D,0x9E,0x9F, \
(0224) 				0xB5,0xD6,0xE0,0xE9,0xA5,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0x21,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0225) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC7,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0226) 				0xE0,0xE1,0xE2,0xE3,0xE5,0xE5,0xE6,0xE7,0xE7,0xE9,0xEA,0xEB,0xED,0xED,0xEE,0xEF,0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}
(0227) 
(0228) #elif _CODE_PAGE == 852	/* Latin 2 (OEM) */
(0229) #define _DF1S	0
(0230) #define _EXCVT {0x80,0x9A,0x90,0xB6,0x8E,0xDE,0x8F,0x80,0x9D,0xD3,0x8A,0x8A,0xD7,0x8D,0x8E,0x8F,0x90,0x91,0x91,0xE2,0x99,0x95,0x95,0x97,0x97,0x99,0x9A,0x9B,0x9B,0x9D,0x9E,0x9F, \
(0231) 				0xB5,0xD6,0xE0,0xE9,0xA4,0xA4,0xA6,0xA6,0xA8,0xA8,0xAA,0x8D,0xAC,0xB8,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBD,0xBF, \
(0232) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC6,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD1,0xD1,0xD2,0xD3,0xD2,0xD5,0xD6,0xD7,0xB7,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0233) 				0xE0,0xE1,0xE2,0xE3,0xE3,0xD5,0xE6,0xE6,0xE8,0xE9,0xE8,0xEB,0xED,0xED,0xDD,0xEF,0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xEB,0xFC,0xFC,0xFE,0xFF}
(0234) 
(0235) #elif _CODE_PAGE == 855	/* Cyrillic (OEM) */
(0236) #define _DF1S	0
(0237) #define _EXCVT {0x81,0x81,0x83,0x83,0x85,0x85,0x87,0x87,0x89,0x89,0x8B,0x8B,0x8D,0x8D,0x8F,0x8F,0x91,0x91,0x93,0x93,0x95,0x95,0x97,0x97,0x99,0x99,0x9B,0x9B,0x9D,0x9D,0x9F,0x9F, \
(0238) 				0xA1,0xA1,0xA3,0xA3,0xA5,0xA5,0xA7,0xA7,0xA9,0xA9,0xAB,0xAB,0xAD,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB6,0xB6,0xB8,0xB8,0xB9,0xBA,0xBB,0xBC,0xBE,0xBE,0xBF, \
(0239) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC7,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD1,0xD1,0xD3,0xD3,0xD5,0xD5,0xD7,0xD7,0xDD,0xD9,0xDA,0xDB,0xDC,0xDD,0xE0,0xDF, \
(0240) 				0xE0,0xE2,0xE2,0xE4,0xE4,0xE6,0xE6,0xE8,0xE8,0xEA,0xEA,0xEC,0xEC,0xEE,0xEE,0xEF,0xF0,0xF2,0xF2,0xF4,0xF4,0xF6,0xF6,0xF8,0xF8,0xFA,0xFA,0xFC,0xFC,0xFD,0xFE,0xFF}
(0241) 
(0242) #elif _CODE_PAGE == 857	/* Turkish (OEM) */
(0243) #define _DF1S	0
(0244) #define _EXCVT {0x80,0x9A,0x90,0xB6,0x8E,0xB7,0x8F,0x80,0xD2,0xD3,0xD4,0xD8,0xD7,0x98,0x8E,0x8F,0x90,0x92,0x92,0xE2,0x99,0xE3,0xEA,0xEB,0x98,0x99,0x9A,0x9D,0x9C,0x9D,0x9E,0x9E, \
(0245) 				0xB5,0xD6,0xE0,0xE9,0xA5,0xA5,0xA6,0xA6,0xA8,0xA9,0xAA,0xAB,0xAC,0x21,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0246) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC7,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0247) 				0xE0,0xE1,0xE2,0xE3,0xE5,0xE5,0xE6,0xE7,0xE8,0xE9,0xEA,0xEB,0xDE,0x59,0xEE,0xEF,0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}
(0248) 
(0249) #elif _CODE_PAGE == 858	/* Multilingual Latin 1 + Euro (OEM) */
(0250) #define _DF1S	0
(0251) #define _EXCVT {0x80,0x9A,0x90,0xB6,0x8E,0xB7,0x8F,0x80,0xD2,0xD3,0xD4,0xD8,0xD7,0xDE,0x8E,0x8F,0x90,0x92,0x92,0xE2,0x99,0xE3,0xEA,0xEB,0x59,0x99,0x9A,0x9D,0x9C,0x9D,0x9E,0x9F, \
(0252) 				0xB5,0xD6,0xE0,0xE9,0xA5,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0x21,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0253) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC7,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD1,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0254) 				0xE0,0xE1,0xE2,0xE3,0xE5,0xE5,0xE6,0xE7,0xE7,0xE9,0xEA,0xEB,0xED,0xED,0xEE,0xEF,0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}
(0255) 
(0256) #elif _CODE_PAGE == 862	/* Hebrew (OEM) */
(0257) #define _DF1S	0
(0258) #define _EXCVT {0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x9A,0x9B,0x9C,0x9D,0x9E,0x9F, \
(0259) 				0x41,0x49,0x4F,0x55,0xA5,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0x21,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0260) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0261) 				0xE0,0xE1,0xE2,0xE3,0xE4,0xE5,0xE6,0xE7,0xE8,0xE9,0xEA,0xEB,0xEC,0xED,0xEE,0xEF,0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}
(0262) 
(0263) #elif _CODE_PAGE == 866	/* Russian (OEM) */
(0264) #define _DF1S	0
(0265) #define _EXCVT {0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x9A,0x9B,0x9C,0x9D,0x9E,0x9F, \
(0266) 				0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0267) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0268) 				0x90,0x91,0x92,0x93,0x9d,0x95,0x96,0x97,0x98,0x99,0x9A,0x9B,0x9C,0x9D,0x9E,0x9F,0xF0,0xF0,0xF2,0xF2,0xF4,0xF4,0xF6,0xF6,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}
(0269) 
(0270) #elif _CODE_PAGE == 874	/* Thai (OEM, Windows) */
(0271) #define _DF1S	0
(0272) #define _EXCVT {0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x9A,0x9B,0x9C,0x9D,0x9E,0x9F, \
(0273) 				0xA0,0xA1,0xA2,0xA3,0xA4,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0274) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0275) 				0xE0,0xE1,0xE2,0xE3,0xE4,0xE5,0xE6,0xE7,0xE8,0xE9,0xEA,0xEB,0xEC,0xED,0xEE,0xEF,0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}
(0276) 
(0277) #elif _CODE_PAGE == 1250 /* Central Europe (Windows) */
(0278) #define _DF1S	0
(0279) #define _EXCVT {0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x8A,0x9B,0x8C,0x8D,0x8E,0x8F, \
(0280) 				0xA0,0xA1,0xA2,0xA3,0xA4,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xA3,0xB4,0xB5,0xB6,0xB7,0xB8,0xA5,0xAA,0xBB,0xBC,0xBD,0xBC,0xAF, \
(0281) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0282) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xF7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xFF}
(0283) 
(0284) #elif _CODE_PAGE == 1251 /* Cyrillic (Windows) */
(0285) #define _DF1S	0
(0286) #define _EXCVT {0x80,0x81,0x82,0x82,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x80,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x8A,0x9B,0x8C,0x8D,0x8E,0x8F, \
(0287) 				0xA0,0xA2,0xA2,0xA3,0xA4,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xB2,0xA5,0xB5,0xB6,0xB7,0xA8,0xB9,0xAA,0xBB,0xA3,0xBD,0xBD,0xAF, \
(0288) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0289) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF}
(0290) 
(0291) #elif _CODE_PAGE == 1252 /* Latin 1 (Windows) */
(0292) #define _DF1S	0
(0293) #define _EXCVT {0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0xAd,0x9B,0x8C,0x9D,0xAE,0x9F, \
(0294) 				0xA0,0x21,0xA2,0xA3,0xA4,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0295) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0296) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xF7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0x9F}
(0297) 
(0298) #elif _CODE_PAGE == 1253 /* Greek (Windows) */
(0299) #define _DF1S	0
(0300) #define _EXCVT {0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x9A,0x9B,0x9C,0x9D,0x9E,0x9F, \
(0301) 				0xA0,0xA1,0xA2,0xA3,0xA4,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0302) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xA2,0xB8,0xB9,0xBA, \
(0303) 				0xE0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xF2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xFB,0xBC,0xFD,0xBF,0xFF}
(0304) 
(0305) #elif _CODE_PAGE == 1254 /* Turkish (Windows) */
(0306) #define _DF1S	0
(0307) #define _EXCVT {0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x8A,0x9B,0x8C,0x9D,0x9E,0x9F, \
(0308) 				0xA0,0x21,0xA2,0xA3,0xA4,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0309) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0310) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xF7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0x9F}
(0311) 
(0312) #elif _CODE_PAGE == 1255 /* Hebrew (Windows) */
(0313) #define _DF1S	0
(0314) #define _EXCVT {0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x9A,0x9B,0x9C,0x9D,0x9E,0x9F, \
(0315) 				0xA0,0x21,0xA2,0xA3,0xA4,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0316) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0317) 				0xE0,0xE1,0xE2,0xE3,0xE4,0xE5,0xE6,0xE7,0xE8,0xE9,0xEA,0xEB,0xEC,0xED,0xEE,0xEF,0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}
(0318) 
(0319) #elif _CODE_PAGE == 1256 /* Arabic (Windows) */
(0320) #define _DF1S	0
(0321) #define _EXCVT {0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x9A,0x9B,0x8C,0x9D,0x9E,0x9F, \
(0322) 				0xA0,0xA1,0xA2,0xA3,0xA4,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0323) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0324) 				0x41,0xE1,0x41,0xE3,0xE4,0xE5,0xE6,0x43,0x45,0x45,0x45,0x45,0xEC,0xED,0x49,0x49,0xF0,0xF1,0xF2,0xF3,0x4F,0xF5,0xF6,0xF7,0xF8,0x55,0xFA,0x55,0x55,0xFD,0xFE,0xFF}
(0325) 
(0326) #elif _CODE_PAGE == 1257 /* Baltic (Windows) */
(0327) #define _DF1S	0
(0328) #define _EXCVT {0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x9A,0x9B,0x9C,0x9D,0x9E,0x9F, \
(0329) 				0xA0,0xA1,0xA2,0xA3,0xA4,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xA8,0xB9,0xAA,0xBB,0xBC,0xBD,0xBE,0xAF, \
(0330) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0331) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xF7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xFF}
(0332) 
(0333) #elif _CODE_PAGE == 1258 /* Vietnam (OEM, Windows) */
(0334) #define _DF1S	0
(0335) #define _EXCVT {0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x9A,0x9B,0xAC,0x9D,0x9E,0x9F, \
(0336) 				0xA0,0x21,0xA2,0xA3,0xA4,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0337) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0338) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xEC,0xCD,0xCE,0xCF,0xD0,0xD1,0xF2,0xD3,0xD4,0xD5,0xD6,0xF7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xFE,0x9F}
(0339) 
(0340) #elif _CODE_PAGE == 1	/* ASCII (for only non-LFN cfg) */
(0341) #if _USE_LFN
(0342) #error Cannot use LFN feature without valid code page.
(0343) #endif
(0344) #define _DF1S	0
(0345) 
(0346) #else
(0347) #error Unknown code page
(0348) 
(0349) #endif
(0350) 
(0351) 
(0352) /* Character code support macros */
(0353) #define IsUpper(c)	(((c)>='A')&&((c)<='Z'))
(0354) #define IsLower(c)	(((c)>='a')&&((c)<='z'))
(0355) #define IsDigit(c)	(((c)>='0')&&((c)<='9'))
(0356) 
(0357) #if _DF1S		/* Code page is DBCS */
(0358) 
(0359) #ifdef _DF2S	/* Two 1st byte areas */
(0360) #define IsDBCS1(c)	(((BYTE)(c) >= _DF1S && (BYTE)(c) <= _DF1E) || ((BYTE)(c) >= _DF2S && (BYTE)(c) <= _DF2E))
(0361) #else			/* One 1st byte area */
(0362) #define IsDBCS1(c)	((BYTE)(c) >= _DF1S && (BYTE)(c) <= _DF1E)
(0363) #endif
(0364) 
(0365) #ifdef _DS3S	/* Three 2nd byte areas */
(0366) #define IsDBCS2(c)	(((BYTE)(c) >= _DS1S && (BYTE)(c) <= _DS1E) || ((BYTE)(c) >= _DS2S && (BYTE)(c) <= _DS2E) || ((BYTE)(c) >= _DS3S && (BYTE)(c) <= _DS3E))
(0367) #else			/* Two 2nd byte areas */
(0368) #define IsDBCS2(c)	(((BYTE)(c) >= _DS1S && (BYTE)(c) <= _DS1E) || ((BYTE)(c) >= _DS2S && (BYTE)(c) <= _DS2E))
(0369) #endif
(0370) 
(0371) #else			/* Code page is SBCS */
(0372) 
(0373) #define IsDBCS1(c)	0
(0374) #define IsDBCS2(c)	0
(0375) 
(0376) #endif /* _DF1S */
(0377) 
(0378) 
(0379) /* Name status flags */
(0380) #define NS			11		/* Index of name status byte in fn[] */
(0381) #define NS_LOSS		0x01	/* Out of 8.3 format */
(0382) #define NS_LFN		0x02	/* Force to create LFN entry */
(0383) #define NS_LAST		0x04	/* Last segment */
(0384) #define NS_BODY		0x08	/* Lower case flag (body) */
(0385) #define NS_EXT		0x10	/* Lower case flag (ext) */
(0386) #define NS_DOT		0x20	/* Dot entry */
(0387) 
(0388) 
(0389) /* FAT sub-type boundaries */
(0390) /* Note that the FAT spec by Microsoft says 4085 but Windows works with 4087! */
(0391) #define MIN_FAT16	4086	/* Minimum number of clusters for FAT16 */
(0392) #define	MIN_FAT32	65526	/* Minimum number of clusters for FAT32 */
(0393) 
(0394) 
(0395) /* FatFs refers the members in the FAT structures as byte array instead of
(0396) / structure member because the structure is not binary compatible between
(0397) / different platforms */
(0398) 
(0399) #define BS_jmpBoot			0	/* Jump instruction (3) */
(0400) #define BS_OEMName			3	/* OEM name (8) */
(0401) #define BPB_BytsPerSec		11	/* Sector size [byte] (2) */
(0402) #define BPB_SecPerClus		13	/* Cluster size [sector] (1) */
(0403) #define BPB_RsvdSecCnt		14	/* Size of reserved area [sector] (2) */
(0404) #define BPB_NumFATs			16	/* Number of FAT copies (1) */
(0405) #define BPB_RootEntCnt		17	/* Number of root dir entries for FAT12/16 (2) */
(0406) #define BPB_TotSec16		19	/* Volume size [sector] (2) */
(0407) #define BPB_Media			21	/* Media descriptor (1) */
(0408) #define BPB_FATSz16			22	/* FAT size [sector] (2) */
(0409) #define BPB_SecPerTrk		24	/* Track size [sector] (2) */
(0410) #define BPB_NumHeads		26	/* Number of heads (2) */
(0411) #define BPB_HiddSec			28	/* Number of special hidden sectors (4) */
(0412) #define BPB_TotSec32		32	/* Volume size [sector] (4) */
(0413) #define BS_DrvNum			36	/* Physical drive number (2) */
(0414) #define BS_BootSig			38	/* Extended boot signature (1) */
(0415) #define BS_VolID			39	/* Volume serial number (4) */
(0416) #define BS_VolLab			43	/* Volume label (8) */
(0417) #define BS_FilSysType		54	/* File system type (1) */
(0418) #define BPB_FATSz32			36	/* FAT size [sector] (4) */
(0419) #define BPB_ExtFlags		40	/* Extended flags (2) */
(0420) #define BPB_FSVer			42	/* File system version (2) */
(0421) #define BPB_RootClus		44	/* Root dir first cluster (4) */
(0422) #define BPB_FSInfo			48	/* Offset of FSInfo sector (2) */
(0423) #define BPB_BkBootSec		50	/* Offset of backup boot sectot (2) */
(0424) #define BS_DrvNum32			64	/* Physical drive number (2) */
(0425) #define BS_BootSig32		66	/* Extended boot signature (1) */
(0426) #define BS_VolID32			67	/* Volume serial number (4) */
(0427) #define BS_VolLab32			71	/* Volume label (8) */
(0428) #define BS_FilSysType32		82	/* File system type (1) */
(0429) #define	FSI_LeadSig			0	/* FSI: Leading signature (4) */
(0430) #define	FSI_StrucSig		484	/* FSI: Structure signature (4) */
(0431) #define	FSI_Free_Count		488	/* FSI: Number of free clusters (4) */
(0432) #define	FSI_Nxt_Free		492	/* FSI: Last allocated cluster (4) */
(0433) #define MBR_Table			446	/* MBR: Partition table offset (2) */
(0434) #define	SZ_PTE				16	/* MBR: Size of a partition table entry */
(0435) #define BS_55AA				510	/* Boot sector signature (2) */
(0436) 
(0437) #define	DIR_Name			0	/* Short file name (11) */
(0438) #define	DIR_Attr			11	/* Attribute (1) */
(0439) #define	DIR_NTres			12	/* NT flag (1) */
(0440) #define	DIR_CrtTime			14	/* Created time (2) */
(0441) #define	DIR_CrtDate			16	/* Created date (2) */
(0442) #define	DIR_FstClusHI		20	/* Higher 16-bit of first cluster (2) */
(0443) #define	DIR_WrtTime			22	/* Modified time (2) */
(0444) #define	DIR_WrtDate			24	/* Modified date (2) */
(0445) #define	DIR_FstClusLO		26	/* Lower 16-bit of first cluster (2) */
(0446) #define	DIR_FileSize		28	/* File size (4) */
(0447) #define	LDIR_Ord			0	/* LFN entry order and LLE flag (1) */
(0448) #define	LDIR_Attr			11	/* LFN attribute (1) */
(0449) #define	LDIR_Type			12	/* LFN type (1) */
(0450) #define	LDIR_Chksum			13	/* Sum of corresponding SFN entry */
(0451) #define	LDIR_FstClusLO		26	/* Filled by zero (0) */
(0452) #define	SZ_DIR				32		/* Size of a directory entry */
(0453) #define	LLE					0x40	/* Last long entry flag in LDIR_Ord */
(0454) #define	DDE					0xE5	/* Deleted directory enrty mark in DIR_Name[0] */
(0455) #define	NDDE				0x05	/* Replacement of a character collides with DDE */
(0456) 
(0457) 
(0458) /*------------------------------------------------------------*/
(0459) /* Module private work area                                   */
(0460) /*------------------------------------------------------------*/
(0461) /* Note that uninitialized variables with static duration are
(0462) /  zeroed/nulled at start-up. If not, the compiler or start-up
(0463) /  routine is out of ANSI-C standard.
(0464) */
(0465) 
(0466) #if _VOLUMES
(0467) static
(0468) FATFS *FatFs[_VOLUMES];	/* Pointer to the file system objects (logical drives) */
(0469) #else
(0470) #error Number of volumes must not be 0.
(0471) #endif
(0472) 
(0473) static
(0474) WORD Fsid;				/* File system mount ID */
(0475) 
(0476) #if _FS_RPATH
(0477) static
(0478) BYTE CurrVol;			/* Current drive */
(0479) #endif
(0480) 
(0481) #if _FS_SHARE
(0482) static
(0483) FILESEM	Files[_FS_SHARE];	/* File lock semaphores */
(0484) #endif
(0485) 
(0486) #if _USE_LFN == 0			/* No LFN feature */
(0487) #define	DEF_NAMEBUF			BYTE sfn[12]
(0488) #define INIT_BUF(dobj)		(dobj).fn = sfn
(0489) #define	FREE_BUF()
(0490) 
(0491) #elif _USE_LFN == 1			/* LFN feature with static working buffer */
(0492) static WCHAR LfnBuf[_MAX_LFN+1];
(0493) #define	DEF_NAMEBUF			BYTE sfn[12]
(0494) #define INIT_BUF(dobj)		{ (dobj).fn = sfn; (dobj).lfn = LfnBuf; }
(0495) #define	FREE_BUF()
(0496) 
(0497) #elif _USE_LFN == 2 		/* LFN feature with dynamic working buffer on the stack */
(0498) #define	DEF_NAMEBUF			BYTE sfn[12]; WCHAR lbuf[_MAX_LFN+1]
(0499) #define INIT_BUF(dobj)		{ (dobj).fn = sfn; (dobj).lfn = lbuf; }
(0500) #define	FREE_BUF()
(0501) 
(0502) #elif _USE_LFN == 3 		/* LFN feature with dynamic working buffer on the heap */
(0503) #define	DEF_NAMEBUF			BYTE sfn[12]; WCHAR *lfn
(0504) #define INIT_BUF(dobj)		{ lfn = ff_memalloc((_MAX_LFN + 1) * 2); \
(0505) 							  if (!lfn) LEAVE_FF((dobj).fs, FR_NOT_ENOUGH_CORE); \
(0506) 							  (dobj).lfn = lfn;	(dobj).fn = sfn; }
(0507) #define	FREE_BUF()			ff_memfree(lfn)
(0508) 
(0509) #else
(0510) #error Wrong LFN configuration.
(0511) #endif
(0512) 
(0513) 
(0514) 
(0515) 
(0516) /*--------------------------------------------------------------------------
(0517) 
(0518)    Module Private Functions
(0519) 
(0520) ---------------------------------------------------------------------------*/
(0521) 
(0522) 
(0523) /*-----------------------------------------------------------------------*/
(0524) /* String functions                                                      */
(0525) /*-----------------------------------------------------------------------*/
(0526) 
(0527) /* Copy memory to memory */
(0528) static
(0529) void mem_cpy (void* dst, const void* src, UINT cnt) {
(0530) 	BYTE *d = (BYTE*)dst;
    0041A 0158      MOVW	R10,R16
(0531) 	const BYTE *s = (const BYTE*)src;
    0041B 0169      MOVW	R12,R18
    0041C C006      RJMP	0x0423
(0532) 
(0533) #if _WORD_ACCESS == 1
(0534) 	while (cnt >= sizeof(int)) {
(0535) 		*(int*)d = *(int*)s;
(0536) 		d += sizeof(int); s += sizeof(int);
(0537) 		cnt -= sizeof(int);
(0538) 	}
(0539) #endif
(0540) 	while (cnt--)
(0541) 		*d++ = *s++;
    0041D 01F6      MOVW	R30,R12
    0041E 01D5      MOVW	R26,R10
    0041F 9001      LD	R0,Z+
    00420 016F      MOVW	R12,R30
    00421 920D      ST	X+,R0
    00422 015D      MOVW	R10,R26
    00423 011A      MOVW	R2,R20
    00424 5041      SUBI	R20,1
    00425 4050      SBCI	R21,0
    00426 2022      TST	R2
    00427 F7A9      BNE	0x041D
    00428 2033      TST	R3
    00429 F799      BNE	0x041D
    0042A 940C 48E7 JMP	pop_xgset303C
ff.c:mem_set:
  d                    --> R10
  cnt                  --> R20
  val                  --> R18
  dst                  --> R16
    0042C 940E 48BE CALL	push_xgset300C
    0042E 814C      LDD	R20,Y+4
    0042F 815D      LDD	R21,Y+5
(0542) }
(0543) 
(0544) /* Fill memory */
(0545) static
(0546) void mem_set (void* dst, int val, UINT cnt) {
(0547) 	BYTE *d = (BYTE*)dst;
    00430 0158      MOVW	R10,R16
    00431 C003      RJMP	0x0435
(0548) 
(0549) 	while (cnt--)
(0550) 		*d++ = (BYTE)val;
    00432 01F5      MOVW	R30,R10
    00433 9321      ST	Z+,R18
    00434 015F      MOVW	R10,R30
    00435 011A      MOVW	R2,R20
    00436 5041      SUBI	R20,1
    00437 4050      SBCI	R21,0
    00438 2022      TST	R2
    00439 F7C1      BNE	0x0432
    0043A 2033      TST	R3
    0043B F7B1      BNE	0x0432
    0043C 940C 48C3 JMP	pop_xgset300C
ff.c:mem_cmp:
  s                    --> R14
  d                    --> R12
  r                    --> R10
  cnt                  --> R20
  src                  --> R18
  dst                  --> R16
    0043E 940E 48B5 CALL	push_xgset30FC
    00440 8548      LDD	R20,Y+8
    00441 8559      LDD	R21,Y+9
(0551) }
(0552) 
(0553) /* Compare memory to memory */
(0554) static
(0555) int mem_cmp (const void* dst, const void* src, UINT cnt) {
(0556) 	const BYTE *d = (const BYTE *)dst, *s = (const BYTE *)src;
    00442 0168      MOVW	R12,R16
    00443 0179      MOVW	R14,R18
(0557) 	int r = 0;
    00444 24AA      CLR	R10
    00445 24BB      CLR	R11
(0558) 
(0559) 	while (cnt-- && (r = *d++ - *s++) == 0) ;
    00446 011A      MOVW	R2,R20
    00447 5041      SUBI	R20,1
    00448 4050      SBCI	R21,0
    00449 2022      TST	R2
    0044A F411      BNE	0x044D
    0044B 2033      TST	R3
    0044C F079      BEQ	0x045C
    0044D 01F7      MOVW	R30,R14
    0044E 9021      LD	R2,Z+
    0044F 017F      MOVW	R14,R30
    00450 2433      CLR	R3
    00451 01F6      MOVW	R30,R12
    00452 9041      LD	R4,Z+
    00453 016F      MOVW	R12,R30
    00454 2455      CLR	R5
    00455 1842      SUB	R4,R2
    00456 0853      SBC	R5,R3
    00457 0152      MOVW	R10,R4
    00458 20AA      TST	R10
    00459 F411      BNE	0x045C
    0045A 20BB      TST	R11
    0045B F351      BEQ	0x0446
(0560) 	return r;
    0045C 0185      MOVW	R16,R10
    0045D 940C 489F JMP	pop_xgset30FC
(0561) }
(0562) 
(0563) /* Check if chr is contained in the string */
(0564) static
(0565) int chk_chr (const char* str, int chr) {
ff.c:chk_chr:
  chr                  --> R18
  str                  --> R16
    0045F C002      RJMP	0x0462
(0566) 	while (*str && *str != chr) str++;
    00460 5F0F      SUBI	R16,0xFF
    00461 4F1F      SBCI	R17,0xFF
    00462 01F8      MOVW	R30,R16
    00463 8020      LD	R2,Z
    00464 2433      CLR	R3
    00465 2022      TST	R2
    00466 F021      BEQ	0x046B
    00467 2433      CLR	R3
    00468 1622      CP	R2,R18
    00469 0633      CPC	R3,R19
    0046A F7A9      BNE	0x0460
(0567) 	return *str;
    0046B 01F8      MOVW	R30,R16
    0046C 8100      LD	R16,Z
    0046D 2711      CLR	R17
    0046E 9508      RET
ff.c:move_window:
  nf                   --> R10
  wsect                --> Y,+5
  sector               --> Y,+13
  fs                   --> R20
    0046F 933A      ST	-Y,R19
    00470 932A      ST	-Y,R18
    00471 940E 48BE CALL	push_xgset300C
    00473 01A8      MOVW	R20,R16
    00474 9729      SBIW	R28,0x9
(0568) }
(0569) 
(0570) 
(0571) 
(0572) /*-----------------------------------------------------------------------*/
(0573) /* Request/Release grant to access the volume                            */
(0574) /*-----------------------------------------------------------------------*/
(0575) #if _FS_REENTRANT
(0576) 
(0577) static
(0578) int lock_fs (
(0579) 	FATFS *fs		/* File system object */
(0580) )
(0581) {
(0582) 	return ff_req_grant(fs->sobj);
(0583) }
(0584) 
(0585) 
(0586) static
(0587) void unlock_fs (
(0588) 	FATFS *fs,		/* File system object */
(0589) 	FRESULT res		/* Result code to be returned */
(0590) )
(0591) {
(0592) 	if (res != FR_NOT_ENABLED &&
(0593) 		res != FR_INVALID_DRIVE &&
(0594) 		res != FR_INVALID_OBJECT &&
(0595) 		res != FR_TIMEOUT) {
(0596) 		ff_rel_grant(fs->sobj);
(0597) 	}
(0598) }
(0599) #endif
(0600) 
(0601) 
(0602) 
(0603) /*-----------------------------------------------------------------------*/
(0604) /* File shareing control functions                                       */
(0605) /*-----------------------------------------------------------------------*/
(0606) #if _FS_SHARE
(0607) 
(0608) static
(0609) FRESULT chk_lock (	/* Check if the file can be accessed */
(0610) 	DIR* dj,		/* Directory object pointing the file to be checked */
(0611) 	int acc			/* Desired access (0:Read, 1:Write, 2:Delete/Rename) */
(0612) )
(0613) {
(0614) 	UINT i, be;
(0615) 
(0616) 	/* Search file semaphore table */
(0617) 	for (i = be = 0; i < _FS_SHARE; i++) {
(0618) 		if (Files[i].fs) {	/* Existing entry */
(0619) 			if (Files[i].fs == dj->fs &&	 	/* Check if the file matched with an open file */
(0620) 				Files[i].clu == dj->sclust &&
(0621) 				Files[i].idx == dj->index) break;
(0622) 		} else {			/* Blank entry */
(0623) 			be++;
(0624) 		}
(0625) 	}
(0626) 	if (i == _FS_SHARE)	/* The file is not opened */
(0627) 		return (be || acc == 2) ? FR_OK : FR_TOO_MANY_OPEN_FILES;	/* Is there a blank entry for new file? */
(0628) 
(0629) 	/* The file has been opened. Reject any open against writing file and all write mode open */
(0630) 	return (acc || Files[i].ctr == 0x100) ? FR_LOCKED : FR_OK;
(0631) }
(0632) 
(0633) 
(0634) static
(0635) int enq_lock (void)	/* Check if an entry is available for a new file */
(0636) {
(0637) 	UINT i;
(0638) 
(0639) 	for (i = 0; i < _FS_SHARE && Files[i].fs; i++) ;
(0640) 	return (i == _FS_SHARE) ? 0 : 1;
(0641) }
(0642) 
(0643) 
(0644) static
(0645) UINT inc_lock (	/* Increment file open counter and returns its index (0:int error) */
(0646) 	DIR* dj,	/* Directory object pointing the file to register or increment */
(0647) 	int acc		/* Desired access mode (0:Read, !0:Write) */
(0648) )
(0649) {
(0650) 	UINT i;
(0651) 
(0652) 
(0653) 	for (i = 0; i < _FS_SHARE; i++) {	/* Find the file */
(0654) 		if (Files[i].fs == dj->fs &&
(0655) 			Files[i].clu == dj->sclust &&
(0656) 			Files[i].idx == dj->index) break;
(0657) 	}
(0658) 
(0659) 	if (i == _FS_SHARE) {				/* Not opened. Register it as new. */
(0660) 		for (i = 0; i < _FS_SHARE && Files[i].fs; i++) ;
(0661) 		if (i == _FS_SHARE) return 0;	/* No space to register (int err) */
(0662) 		Files[i].fs = dj->fs;
(0663) 		Files[i].clu = dj->sclust;
(0664) 		Files[i].idx = dj->index;
(0665) 		Files[i].ctr = 0;
(0666) 	}
(0667) 
(0668) 	if (acc && Files[i].ctr) return 0;	/* Access violation (int err) */
(0669) 
(0670) 	Files[i].ctr = acc ? 0x100 : Files[i].ctr + 1;	/* Set semaphore value */
(0671) 
(0672) 	return i + 1;
(0673) }
(0674) 
(0675) 
(0676) static
(0677) FRESULT dec_lock (	/* Decrement file open counter */
(0678) 	UINT i			/* Semaphore index */
(0679) )
(0680) {
(0681) 	WORD n;
(0682) 	FRESULT res;
(0683) 
(0684) 
(0685) 	if (--i < _FS_SHARE) {
(0686) 		n = Files[i].ctr;
(0687) 		if (n == 0x100) n = 0;
(0688) 		if (n) n--;
(0689) 		Files[i].ctr = n;
(0690) 		if (!n) Files[i].fs = 0;
(0691) 		res = FR_OK;
(0692) 	} else {
(0693) 		res = FR_INT_ERR;
(0694) 	}
(0695) 	return res;
(0696) }
(0697) 
(0698) 
(0699) static
(0700) void clear_lock (	/* Clear lock entries of the volume */
(0701) 	FATFS *fs
(0702) )
(0703) {
(0704) 	UINT i;
(0705) 
(0706) 	for (i = 0; i < _FS_SHARE; i++) {
(0707) 		if (Files[i].fs == fs) Files[i].fs = 0;
(0708) 	}
(0709) }
(0710) #endif
(0711) 
(0712) 
(0713) 
(0714) /*-----------------------------------------------------------------------*/
(0715) /* Change window offset                                                  */
(0716) /*-----------------------------------------------------------------------*/
(0717) 
(0718) static
(0719) FRESULT move_window (
(0720) 	FATFS *fs,		/* File system object */
(0721) 	DWORD sector	/* Sector number to make appearance in the fs->win[] */
(0722) )					/* Move to zero only writes back dirty window */
(0723) {
(0724) 	DWORD wsect;
(0725) 
(0726) 
(0727) 	wsect = fs->winsect;
    00475 01FA      MOVW	R30,R20
    00476 96BA      ADIW	R30,0x2A
    00477 8020      LD	R2,Z
    00478 8031      LDD	R3,Z+1
    00479 8042      LDD	R4,Z+2
    0047A 8053      LDD	R5,Z+3
    0047B 822D      STD	Y+5,R2
    0047C 823E      STD	Y+6,R3
    0047D 824F      STD	Y+7,R4
    0047E 8658      STD	Y+8,R5
(0728) 	if (wsect != sector) {	/* Changed current window */
    0047F 842D      LDD	R2,Y+13
    00480 843E      LDD	R3,Y+14
    00481 844F      LDD	R4,Y+15
    00482 8858      LDD	R5,Y+16
    00483 806D      LDD	R6,Y+5
    00484 807E      LDD	R7,Y+6
    00485 808F      LDD	R8,Y+7
    00486 8498      LDD	R9,Y+8
    00487 1462      CP	R6,R2
    00488 0473      CPC	R7,R3
    00489 0484      CPC	R8,R4
    0048A 0495      CPC	R9,R5
    0048B F409      BNE	0x048D
    0048C C07E      RJMP	0x050B
(0729) #if !_FS_READONLY
(0730) 		if (fs->wflag) {	/* Write back dirty window if needed */
    0048D 01FA      MOVW	R30,R20
    0048E 8024      LDD	R2,Z+4
    0048F 2022      TST	R2
    00490 F409      BNE	0x0492
    00491 C055      RJMP	0x04E7
(0731) 			if (disk_write(fs->drv, fs->win, wsect, 1) != RES_OK)
    00492 E081      LDI	R24,1
    00493 838C      STD	Y+4,R24
    00494 0113      MOVW	R2,R6
    00495 0124      MOVW	R4,R8
    00496 8228      ST	Y,R2
    00497 8239      STD	Y+1,R3
    00498 824A      STD	Y+2,R4
    00499 825B      STD	Y+3,R5
    0049A 019A      MOVW	R18,R20
    0049B 5D22      SUBI	R18,0xD2
    0049C 4F3F      SBCI	R19,0xFF
    0049D 8101      LDD	R16,Z+1
    0049E 940E 03F4 CALL	_disk_write
    004A0 2300      TST	R16
    004A1 F011      BEQ	0x04A4
(0732) 				return FR_DISK_ERR;
    004A2 E001      LDI	R16,1
    004A3 C068      RJMP	0x050C
(0733) 			fs->wflag = 0;
    004A4 2422      CLR	R2
    004A5 01FA      MOVW	R30,R20
    004A6 8224      STD	Z+4,R2
(0734) 			if (wsect < (fs->fatbase + fs->fsize)) {	/* In FAT area */
    004A7 8C22      LDD	R2,Z+26
    004A8 8C33      LDD	R3,Z+27
    004A9 8C44      LDD	R4,Z+28
    004AA 8C55      LDD	R5,Z+29
    004AB 967E      ADIW	R30,0x1E
    004AC 8060      LD	R6,Z
    004AD 8071      LDD	R7,Z+1
    004AE 8082      LDD	R8,Z+2
    004AF 8093      LDD	R9,Z+3
    004B0 0C62      ADD	R6,R2
    004B1 1C73      ADC	R7,R3
    004B2 1C84      ADC	R8,R4
    004B3 1C95      ADC	R9,R5
    004B4 802D      LDD	R2,Y+5
    004B5 803E      LDD	R3,Y+6
    004B6 804F      LDD	R4,Y+7
    004B7 8458      LDD	R5,Y+8
    004B8 1426      CP	R2,R6
    004B9 0437      CPC	R3,R7
    004BA 0448      CPC	R4,R8
    004BB 0459      CPC	R5,R9
    004BC F550      BCC	0x04E7
(0735) 				BYTE nf;
(0736) 				for (nf = fs->n_fats; nf > 1; nf--) {	/* Reflect the change to all FAT copies */
    004BD 01FA      MOVW	R30,R20
    004BE 80A3      LDD	R10,Z+3
    004BF C024      RJMP	0x04E4
(0737) 					wsect += fs->fsize;
    004C0 01FA      MOVW	R30,R20
    004C1 967A      ADIW	R30,0x1A
    004C2 8020      LD	R2,Z
    004C3 8031      LDD	R3,Z+1
    004C4 8042      LDD	R4,Z+2
    004C5 8053      LDD	R5,Z+3
    004C6 806D      LDD	R6,Y+5
    004C7 807E      LDD	R7,Y+6
    004C8 808F      LDD	R8,Y+7
    004C9 8498      LDD	R9,Y+8
    004CA 0C62      ADD	R6,R2
    004CB 1C73      ADC	R7,R3
    004CC 1C84      ADC	R8,R4
    004CD 1C95      ADC	R9,R5
    004CE 826D      STD	Y+5,R6
    004CF 827E      STD	Y+6,R7
    004D0 828F      STD	Y+7,R8
    004D1 8698      STD	Y+8,R9
(0738) 					disk_write(fs->drv, fs->win, wsect, 1);
    004D2 E081      LDI	R24,1
    004D3 838C      STD	Y+4,R24
    004D4 802D      LDD	R2,Y+5
    004D5 803E      LDD	R3,Y+6
    004D6 804F      LDD	R4,Y+7
    004D7 8458      LDD	R5,Y+8
    004D8 8228      ST	Y,R2
    004D9 8239      STD	Y+1,R3
    004DA 824A      STD	Y+2,R4
    004DB 825B      STD	Y+3,R5
    004DC 019A      MOVW	R18,R20
    004DD 5D22      SUBI	R18,0xD2
    004DE 4F3F      SBCI	R19,0xFF
    004DF 01FA      MOVW	R30,R20
    004E0 8101      LDD	R16,Z+1
    004E1 940E 03F4 CALL	_disk_write
    004E3 94AA      DEC	R10
    004E4 E081      LDI	R24,1
    004E5 158A      CP	R24,R10
    004E6 F2C8      BCS	0x04C0
(0739) 				}
(0740) 			}
(0741) 		}
(0742) #endif
(0743) 		if (sector) {
    004E7 842D      LDD	R2,Y+13
    004E8 843E      LDD	R3,Y+14
    004E9 844F      LDD	R4,Y+15
    004EA 8858      LDD	R5,Y+16
    004EB 9488      BCLR	0
    004EC 2022      TST	R2
    004ED 0432      CPC	R3,R2
    004EE 0442      CPC	R4,R2
    004EF 0452      CPC	R5,R2
    004F0 F0D1      BEQ	0x050B
(0744) 			if (disk_read(fs->drv, fs->win, sector, 1) != RES_OK)
    004F1 E081      LDI	R24,1
    004F2 838C      STD	Y+4,R24
    004F3 8228      ST	Y,R2
    004F4 8239      STD	Y+1,R3
    004F5 824A      STD	Y+2,R4
    004F6 825B      STD	Y+3,R5
    004F7 019A      MOVW	R18,R20
    004F8 5D22      SUBI	R18,0xD2
    004F9 4F3F      SBCI	R19,0xFF
    004FA 01FA      MOVW	R30,R20
    004FB 8101      LDD	R16,Z+1
    004FC 940E 03D4 CALL	_disk_read
    004FE 2300      TST	R16
    004FF F011      BEQ	0x0502
(0745) 				return FR_DISK_ERR;
    00500 E001      LDI	R16,1
    00501 C00A      RJMP	0x050C
(0746) 			fs->winsect = sector;
    00502 842D      LDD	R2,Y+13
    00503 843E      LDD	R3,Y+14
    00504 844F      LDD	R4,Y+15
    00505 8858      LDD	R5,Y+16
    00506 01FA      MOVW	R30,R20
    00507 A622      STD	Z+42,R2
    00508 A633      STD	Z+43,R3
    00509 A644      STD	Z+44,R4
    0050A A655      STD	Z+45,R5
(0747) 		}
(0748) 	}
(0749) 
(0750) 	return FR_OK;
    0050B 2700      CLR	R16
    0050C 9629      ADIW	R28,0x9
    0050D 940E 48C3 CALL	pop_xgset300C
    0050F 9622      ADIW	R28,2
    00510 9508      RET
ff.c:sync:
  res                  --> R20
  fs                   --> R22
    00511 940E 48C8 CALL	push_xgsetF000
    00513 01B8      MOVW	R22,R16
    00514 9725      SBIW	R28,5
(0751) }
(0752) 
(0753) 
(0754) 
(0755) 
(0756) /*-----------------------------------------------------------------------*/
(0757) /* Clean-up cached data                                                  */
(0758) /*-----------------------------------------------------------------------*/
(0759) #if !_FS_READONLY
(0760) static
(0761) FRESULT sync (	/* FR_OK: successful, FR_DISK_ERR: failed */
(0762) 	FATFS *fs	/* File system object */
(0763) )
(0764) {
(0765) 	FRESULT res;
(0766) 
(0767) 
(0768) 	res = move_window(fs, 0);
    00515 E080      LDI	R24,0
    00516 E090      LDI	R25,0
    00517 E0A0      LDI	R26,0
    00518 E0B0      LDI	R27,0
    00519 83A8      ST	Y,R26
    0051A 83B9      STD	Y+1,R27
    0051B 019C      MOVW	R18,R24
    0051C 018B      MOVW	R16,R22
    0051D DF51      RCALL	ff.c:move_window
    0051E 2F40      MOV	R20,R16
(0769) 	if (res == FR_OK) {
    0051F 2300      TST	R16
    00520 F009      BEQ	0x0522
    00521 C0C0      RJMP	0x05E2
(0770) 		/* Update FSInfo sector if needed */
(0771) 		if (fs->fs_type == FS_FAT32 && fs->fsi_flag) {
    00522 01FB      MOVW	R30,R22
    00523 8180      LD	R24,Z
    00524 3083      CPI	R24,3
    00525 F009      BEQ	0x0527
    00526 C0AC      RJMP	0x05D3
    00527 8025      LDD	R2,Z+5
    00528 2022      TST	R2
    00529 F409      BNE	0x052B
    0052A C0A8      RJMP	0x05D3
(0772) 			fs->winsect = 0;
    0052B 96BA      ADIW	R30,0x2A
    0052C E080      LDI	R24,0
    0052D 8380      ST	Z,R24
    0052E 8381      STD	Z+1,R24
    0052F 8382      STD	Z+2,R24
    00530 8383      STD	Z+3,R24
(0773) 			/* Create FSInfo structure */
(0774) 			mem_set(fs->win, 0, 512);
    00531 E080      LDI	R24,0
    00532 E092      LDI	R25,2
    00533 8399      STD	Y+1,R25
    00534 8388      ST	Y,R24
    00535 2722      CLR	R18
    00536 2733      CLR	R19
    00537 018B      MOVW	R16,R22
    00538 5D02      SUBI	R16,0xD2
    00539 4F1F      SBCI	R17,0xFF
    0053A DEF1      RCALL	ff.c:mem_set
(0775) 			ST_WORD(fs->win+BS_55AA, 0xAA55);
    0053B E585      LDI	R24,0x55
    0053C 01FB      MOVW	R30,R22
    0053D 5DE4      SUBI	R30,0xD4
    0053E 4FFD      SBCI	R31,0xFD
    0053F 8380      ST	Z,R24
    00540 52EC      SUBI	R30,0x2C
    00541 40F2      SBCI	R31,2
    00542 EA8A      LDI	R24,0xAA
    00543 5DE3      SUBI	R30,0xD3
    00544 4FFD      SBCI	R31,0xFD
    00545 8380      ST	Z,R24
    00546 52ED      SUBI	R30,0x2D
    00547 40F2      SBCI	R31,2
(0776) 			ST_DWORD(fs->win+FSI_LeadSig, 0x41615252);
    00548 E582      LDI	R24,0x52
    00549 A786      STD	Z+46,R24
    0054A A787      STD	Z+47,R24
    0054B E681      LDI	R24,0x61
    0054C AB80      STD	Z+48,R24
    0054D E481      LDI	R24,0x41
    0054E AB81      STD	Z+49,R24
(0777) 			ST_DWORD(fs->win+FSI_StrucSig, 0x61417272);
    0054F E782      LDI	R24,0x72
    00550 5EEE      SUBI	R30,0xEE
    00551 4FFD      SBCI	R31,0xFD
    00552 8380      ST	Z,R24
    00553 51E2      SUBI	R30,0x12
    00554 40F2      SBCI	R31,2
    00555 5EED      SUBI	R30,0xED
    00556 4FFD      SBCI	R31,0xFD
    00557 8380      ST	Z,R24
    00558 51E3      SUBI	R30,0x13
    00559 40F2      SBCI	R31,2
    0055A E481      LDI	R24,0x41
    0055B 5EEC      SUBI	R30,0xEC
    0055C 4FFD      SBCI	R31,0xFD
    0055D 8380      ST	Z,R24
    0055E 51E4      SUBI	R30,0x14
    0055F 40F2      SBCI	R31,2
    00560 E681      LDI	R24,0x61
    00561 5EEB      SUBI	R30,0xEB
    00562 4FFD      SBCI	R31,0xFD
    00563 8380      ST	Z,R24
    00564 51E5      SUBI	R30,0x15
    00565 40F2      SBCI	R31,2
(0778) 			ST_DWORD(fs->win+FSI_Free_Count, fs->free_clust);
    00566 8426      LDD	R2,Z+14
    00567 8437      LDD	R3,Z+15
    00568 8840      LDD	R4,Z+16
    00569 8851      LDD	R5,Z+17
    0056A 5EEA      SUBI	R30,0xEA
    0056B 4FFD      SBCI	R31,0xFD
    0056C 8220      ST	Z,R2
    0056D 51E6      SUBI	R30,0x16
    0056E 40F2      SBCI	R31,2
    0056F 8426      LDD	R2,Z+14
    00570 8437      LDD	R3,Z+15
    00571 2C23      MOV	R2,R3
    00572 2433      CLR	R3
    00573 5EE9      SUBI	R30,0xE9
    00574 4FFD      SBCI	R31,0xFD
    00575 8220      ST	Z,R2
    00576 51E7      SUBI	R30,0x17
    00577 40F2      SBCI	R31,2
    00578 8426      LDD	R2,Z+14
    00579 8437      LDD	R3,Z+15
    0057A 8840      LDD	R4,Z+16
    0057B 8851      LDD	R5,Z+17
    0057C 0112      MOVW	R2,R4
    0057D 2444      CLR	R4
    0057E 2455      CLR	R5
    0057F 5EE8      SUBI	R30,0xE8
    00580 4FFD      SBCI	R31,0xFD
    00581 8220      ST	Z,R2
    00582 51E8      SUBI	R30,0x18
    00583 40F2      SBCI	R31,2
    00584 E188      LDI	R24,0x18
    00585 E090      LDI	R25,0
    00586 8506      LDD	R16,Z+14
    00587 8517      LDD	R17,Z+15
    00588 8920      LDD	R18,Z+16
    00589 8931      LDD	R19,Z+17
    0058A 938A      ST	-Y,R24
    0058B 940E 4957 CALL	lsr32
    0058D 01FB      MOVW	R30,R22
    0058E 5EE7      SUBI	R30,0xE7
    0058F 4FFD      SBCI	R31,0xFD
    00590 8300      ST	Z,R16
    00591 51E9      SUBI	R30,0x19
    00592 40F2      SBCI	R31,2
(0779) 			ST_DWORD(fs->win+FSI_Nxt_Free, fs->last_clust);
    00593 8422      LDD	R2,Z+10
    00594 8433      LDD	R3,Z+11
    00595 8444      LDD	R4,Z+12
    00596 8455      LDD	R5,Z+13
    00597 5EE6      SUBI	R30,0xE6
    00598 4FFD      SBCI	R31,0xFD
    00599 8220      ST	Z,R2
    0059A 51EA      SUBI	R30,0x1A
    0059B 40F2      SBCI	R31,2
    0059C 8422      LDD	R2,Z+10
    0059D 8433      LDD	R3,Z+11
    0059E 2C23      MOV	R2,R3
    0059F 2433      CLR	R3
    005A0 5EE5      SUBI	R30,0xE5
    005A1 4FFD      SBCI	R31,0xFD
    005A2 8220      ST	Z,R2
    005A3 51EB      SUBI	R30,0x1B
    005A4 40F2      SBCI	R31,2
    005A5 8422      LDD	R2,Z+10
    005A6 8433      LDD	R3,Z+11
    005A7 8444      LDD	R4,Z+12
    005A8 8455      LDD	R5,Z+13
    005A9 0112      MOVW	R2,R4
    005AA 2444      CLR	R4
    005AB 2455      CLR	R5
    005AC 5EE4      SUBI	R30,0xE4
    005AD 4FFD      SBCI	R31,0xFD
    005AE 8220      ST	Z,R2
    005AF 51EC      SUBI	R30,0x1C
    005B0 40F2      SBCI	R31,2
    005B1 E188      LDI	R24,0x18
    005B2 E090      LDI	R25,0
    005B3 8502      LDD	R16,Z+10
    005B4 8513      LDD	R17,Z+11
    005B5 8524      LDD	R18,Z+12
    005B6 8535      LDD	R19,Z+13
    005B7 938A      ST	-Y,R24
    005B8 940E 4957 CALL	lsr32
    005BA 01FB      MOVW	R30,R22
    005BB 5EE3      SUBI	R30,0xE3
    005BC 4FFD      SBCI	R31,0xFD
    005BD 8300      ST	Z,R16
    005BE 51ED      SUBI	R30,0x1D
    005BF 40F2      SBCI	R31,2
(0780) 			/* Write it into the FSInfo sector */
(0781) 			disk_write(fs->drv, fs->win, fs->fsi_sector, 1);
    005C0 E081      LDI	R24,1
    005C1 838C      STD	Y+4,R24
    005C2 8822      LDD	R2,Z+18
    005C3 8833      LDD	R3,Z+19
    005C4 8844      LDD	R4,Z+20
    005C5 8855      LDD	R5,Z+21
    005C6 8228      ST	Y,R2
    005C7 8239      STD	Y+1,R3
    005C8 824A      STD	Y+2,R4
    005C9 825B      STD	Y+3,R5
    005CA 019F      MOVW	R18,R30
    005CB 5D22      SUBI	R18,0xD2
    005CC 4F3F      SBCI	R19,0xFF
    005CD 8101      LDD	R16,Z+1
    005CE 940E 03F4 CALL	_disk_write
(0782) 			fs->fsi_flag = 0;
    005D0 2422      CLR	R2
    005D1 01FB      MOVW	R30,R22
    005D2 8225      STD	Z+5,R2
(0783) 		}
(0784) 		/* Make sure that no pending write process in the physical drive */
(0785) 		if (disk_ioctl(fs->drv, CTRL_SYNC, 0) != RES_OK)
    005D3 2422      CLR	R2
    005D4 2433      CLR	R3
    005D5 8239      STD	Y+1,R3
    005D6 8228      ST	Y,R2
    005D7 2722      CLR	R18
    005D8 2733      CLR	R19
    005D9 01FB      MOVW	R30,R22
    005DA 8101      LDD	R16,Z+1
    005DB 2711      CLR	R17
    005DC 940E 040C CALL	_disk_ioctl
    005DE 3000      CPI	R16,0
    005DF 0701      CPC	R16,R17
    005E0 F009      BEQ	0x05E2
(0786) 			res = FR_DISK_ERR;
    005E1 E041      LDI	R20,1
(0787) 	}
(0788) 
(0789) 	return res;
    005E2 2F04      MOV	R16,R20
    005E3 9625      ADIW	R28,5
    005E4 940C 48CD JMP	pop_xgsetF000
_clust2sect:
  clst                 --> Y,+6
  fs                   --> R10
    005E6 933A      ST	-Y,R19
    005E7 932A      ST	-Y,R18
    005E8 940E 48D2 CALL	push_xgsetF00C
    005EA 0158      MOVW	R10,R16
(0790) }
(0791) #endif
(0792) 
(0793) 
(0794) 
(0795) 
(0796) /*-----------------------------------------------------------------------*/
(0797) /* Get sector# from cluster#                                             */
(0798) /*-----------------------------------------------------------------------*/
(0799) 
(0800) 
(0801) DWORD clust2sect (	/* !=0: Sector number, 0: Failed - invalid cluster# */
(0802) 	FATFS *fs,		/* File system object */
(0803) 	DWORD clst		/* Cluster# to be converted */
(0804) )
(0805) {
(0806) 	clst -= 2;
    005EB E042      LDI	R20,2
    005EC E050      LDI	R21,0
    005ED E060      LDI	R22,0
    005EE E070      LDI	R23,0
    005EF 802E      LDD	R2,Y+6
    005F0 803F      LDD	R3,Y+7
    005F1 8448      LDD	R4,Y+8
    005F2 8459      LDD	R5,Y+9
    005F3 1A24      SUB	R2,R20
    005F4 0A35      SBC	R3,R21
    005F5 0A46      SBC	R4,R22
    005F6 0A57      SBC	R5,R23
    005F7 822E      STD	Y+6,R2
    005F8 823F      STD	Y+7,R3
    005F9 8648      STD	Y+8,R4
    005FA 8659      STD	Y+9,R5
(0807) 	if (clst >= (fs->n_fatent - 2)) return 0;		/* Invalid cluster# */
    005FB E042      LDI	R20,2
    005FC E050      LDI	R21,0
    005FD E060      LDI	R22,0
    005FE E070      LDI	R23,0
    005FF 01F5      MOVW	R30,R10
    00600 9676      ADIW	R30,0x16
    00601 8020      LD	R2,Z
    00602 8031      LDD	R3,Z+1
    00603 8042      LDD	R4,Z+2
    00604 8053      LDD	R5,Z+3
    00605 1A24      SUB	R2,R20
    00606 0A35      SBC	R3,R21
    00607 0A46      SBC	R4,R22
    00608 0A57      SBC	R5,R23
    00609 806E      LDD	R6,Y+6
    0060A 807F      LDD	R7,Y+7
    0060B 8488      LDD	R8,Y+8
    0060C 8499      LDD	R9,Y+9
    0060D 1462      CP	R6,R2
    0060E 0473      CPC	R7,R3
    0060F 0484      CPC	R8,R4
    00610 0495      CPC	R9,R5
    00611 F028      BCS	0x0617
    00612 E000      LDI	R16,0
    00613 E010      LDI	R17,0
    00614 E020      LDI	R18,0
    00615 E030      LDI	R19,0
    00616 C01D      RJMP	0x0634
(0808) 	return clst * fs->csize + fs->database;
    00617 01F5      MOVW	R30,R10
    00618 9632      ADIW	R30,2
    00619 8020      LD	R2,Z
    0061A 2433      CLR	R3
    0061B 2444      CLR	R4
    0061C 2455      CLR	R5
    0061D 810E      LDD	R16,Y+6
    0061E 811F      LDD	R17,Y+7
    0061F 8528      LDD	R18,Y+8
    00620 8539      LDD	R19,Y+9
    00621 925A      ST	-Y,R5
    00622 924A      ST	-Y,R4
    00623 923A      ST	-Y,R3
    00624 922A      ST	-Y,R2
    00625 940E 485F CALL	empy32u|empy32s
    00627 0118      MOVW	R2,R16
    00628 0129      MOVW	R4,R18
    00629 01F5      MOVW	R30,R10
    0062A A066      LDD	R6,Z+38
    0062B A077      LDD	R7,Z+39
    0062C A480      LDD	R8,Z+40
    0062D A491      LDD	R9,Z+41
    0062E 0C26      ADD	R2,R6
    0062F 1C37      ADC	R3,R7
    00630 1C48      ADC	R4,R8
    00631 1C59      ADC	R5,R9
    00632 0181      MOVW	R16,R2
    00633 0192      MOVW	R18,R4
    00634 940E 48D9 CALL	pop_xgsetF00C
    00636 9622      ADIW	R28,2
    00637 9508      RET
_get_fat:
  wc                   --> R14
  p                    --> R10
  bc                   --> R10
  clst                 --> Y,+12
  fs                   --> R12
    00638 933A      ST	-Y,R19
    00639 932A      ST	-Y,R18
    0063A 940E 48B3 CALL	push_xgsetF0FC
    0063C 0168      MOVW	R12,R16
    0063D 9722      SBIW	R28,2
(0809) }
(0810) 
(0811) 
(0812) 
(0813) 
(0814) /*-----------------------------------------------------------------------*/
(0815) /* FAT access - Read value of a FAT entry                                */
(0816) /*-----------------------------------------------------------------------*/
(0817) 
(0818) 
(0819) DWORD get_fat (	/* 0xFFFFFFFF:Disk error, 1:Internal error, Else:Cluster status */
(0820) 	FATFS *fs,	/* File system object */
(0821) 	DWORD clst	/* Cluster# to get the link information */
(0822) )
(0823) {
(0824) 	UINT wc, bc;
(0825) 	BYTE *p;
(0826) 
(0827) 
(0828) 	if (clst < 2 || clst >= fs->n_fatent)	/* Chack range */
    0063E E042      LDI	R20,2
    0063F E050      LDI	R21,0
    00640 E060      LDI	R22,0
    00641 E070      LDI	R23,0
    00642 842C      LDD	R2,Y+12
    00643 843D      LDD	R3,Y+13
    00644 844E      LDD	R4,Y+14
    00645 845F      LDD	R5,Y+15
    00646 1624      CP	R2,R20
    00647 0635      CPC	R3,R21
    00648 0646      CPC	R4,R22
    00649 0657      CPC	R5,R23
    0064A F078      BCS	0x065A
    0064B 01F6      MOVW	R30,R12
    0064C 9676      ADIW	R30,0x16
    0064D 8020      LD	R2,Z
    0064E 8031      LDD	R3,Z+1
    0064F 8042      LDD	R4,Z+2
    00650 8053      LDD	R5,Z+3
    00651 846C      LDD	R6,Y+12
    00652 847D      LDD	R7,Y+13
    00653 848E      LDD	R8,Y+14
    00654 849F      LDD	R9,Y+15
    00655 1462      CP	R6,R2
    00656 0473      CPC	R7,R3
    00657 0484      CPC	R8,R4
    00658 0495      CPC	R9,R5
    00659 F028      BCS	0x065F
(0829) 		return 1;
    0065A E001      LDI	R16,1
    0065B E010      LDI	R17,0
    0065C E020      LDI	R18,0
    0065D E030      LDI	R19,0
    0065E C124      RJMP	0x0783
(0830) 
(0831) 	switch (fs->fs_type) {
    0065F 01F6      MOVW	R30,R12
    00660 80A0      LD	R10,Z
    00661 24BB      CLR	R11
    00662 01C5      MOVW	R24,R10
    00663 3081      CPI	R24,1
    00664 E0E0      LDI	R30,0
    00665 079E      CPC	R25,R30
    00666 F059      BEQ	0x0672
    00667 3082      CPI	R24,2
    00668 E0E0      LDI	R30,0
    00669 079E      CPC	R25,R30
    0066A F409      BNE	0x066C
    0066B C06F      RJMP	0x06DB
    0066C 3083      CPI	R24,3
    0066D E0E0      LDI	R30,0
    0066E 079E      CPC	R25,R30
    0066F F409      BNE	0x0671
    00670 C0A6      RJMP	0x0717
    00671 C10D      RJMP	0x077F
(0832) 	case FS_FAT12 :
(0833) 		bc = (UINT)clst; bc += bc / 2;
    00672 84AC      LDD	R10,Y+12
    00673 84BD      LDD	R11,Y+13
    00674 0115      MOVW	R2,R10
    00675 9436      LSR	R3
    00676 9427      ROR	R2
    00677 0CA2      ADD	R10,R2
    00678 1CB3      ADC	R11,R3
(0834) 		if (move_window(fs, fs->fatbase + (bc / SS(fs)))) break;
    00679 E029      LDI	R18,0x9
    0067A E030      LDI	R19,0
    0067B 0185      MOVW	R16,R10
    0067C 940E 4950 CALL	lsr16
    0067E 0118      MOVW	R2,R16
    0067F 2444      CLR	R4
    00680 2455      CLR	R5
    00681 01F6      MOVW	R30,R12
    00682 8C66      LDD	R6,Z+30
    00683 8C77      LDD	R7,Z+31
    00684 A080      LDD	R8,Z+32
    00685 A091      LDD	R9,Z+33
    00686 0C62      ADD	R6,R2
    00687 1C73      ADC	R7,R3
    00688 1C84      ADC	R8,R4
    00689 1C95      ADC	R9,R5
    0068A 8288      ST	Y,R8
    0068B 8299      STD	Y+1,R9
    0068C 0193      MOVW	R18,R6
    0068D 018F      MOVW	R16,R30
    0068E DDE0      RCALL	ff.c:move_window
    0068F 2300      TST	R16
    00690 F009      BEQ	0x0692
    00691 C0ED      RJMP	0x077F
(0835) 		wc = fs->win[bc % SS(fs)]; bc++;
    00692 01C6      MOVW	R24,R12
    00693 968E      ADIW	R24,0x2E
    00694 01F5      MOVW	R30,R10
    00695 70F1      ANDI	R31,1
    00696 0FE8      ADD	R30,R24
    00697 1FF9      ADC	R31,R25
    00698 80E0      LD	R14,Z
    00699 24FF      CLR	R15
    0069A 01C5      MOVW	R24,R10
    0069B 9601      ADIW	R24,1
    0069C 015C      MOVW	R10,R24
(0836) 		if (move_window(fs, fs->fatbase + (bc / SS(fs)))) break;
    0069D E029      LDI	R18,0x9
    0069E E030      LDI	R19,0
    0069F 018C      MOVW	R16,R24
    006A0 940E 4950 CALL	lsr16
    006A2 0118      MOVW	R2,R16
    006A3 2444      CLR	R4
    006A4 2455      CLR	R5
    006A5 01F6      MOVW	R30,R12
    006A6 8C66      LDD	R6,Z+30
    006A7 8C77      LDD	R7,Z+31
    006A8 A080      LDD	R8,Z+32
    006A9 A091      LDD	R9,Z+33
    006AA 0C62      ADD	R6,R2
    006AB 1C73      ADC	R7,R3
    006AC 1C84      ADC	R8,R4
    006AD 1C95      ADC	R9,R5
    006AE 8288      ST	Y,R8
    006AF 8299      STD	Y+1,R9
    006B0 0193      MOVW	R18,R6
    006B1 018F      MOVW	R16,R30
    006B2 DDBC      RCALL	ff.c:move_window
    006B3 2300      TST	R16
    006B4 F009      BEQ	0x06B6
    006B5 C0C9      RJMP	0x077F
(0837) 		wc |= fs->win[bc % SS(fs)] << 8;
    006B6 01C6      MOVW	R24,R12
    006B7 968E      ADIW	R24,0x2E
    006B8 01F5      MOVW	R30,R10
    006B9 70F1      ANDI	R31,1
    006BA 0FE8      ADD	R30,R24
    006BB 1FF9      ADC	R31,R25
    006BC 8020      LD	R2,Z
    006BD 2433      CLR	R3
    006BE 2C32      MOV	R3,R2
    006BF 2422      CLR	R2
    006C0 28E2      OR	R14,R2
    006C1 28F3      OR	R15,R3
(0838) 		return (clst & 1) ? (wc >> 4) : (wc & 0xFFF);
    006C2 842C      LDD	R2,Y+12
    006C3 843D      LDD	R3,Y+13
    006C4 844E      LDD	R4,Y+14
    006C5 845F      LDD	R5,Y+15
    006C6 2DE2      MOV	R30,R2
    006C7 70E1      ANDI	R30,1
    006C8 F051      BEQ	0x06D3
    006C9 0157      MOVW	R10,R14
    006CA 94B6      LSR	R11
    006CB 94A7      ROR	R10
    006CC 94B6      LSR	R11
    006CD 94A7      ROR	R10
    006CE 94B6      LSR	R11
    006CF 94A7      ROR	R10
    006D0 94B6      LSR	R11
    006D1 94A7      ROR	R10
    006D2 C003      RJMP	0x06D6
    006D3 01C7      MOVW	R24,R14
    006D4 709F      ANDI	R25,0xF
    006D5 015C      MOVW	R10,R24
    006D6 0185      MOVW	R16,R10
    006D7 0196      MOVW	R18,R12
    006D8 2722      CLR	R18
    006D9 2733      CLR	R19
    006DA C0A8      RJMP	0x0783
(0839) 
(0840) 	case FS_FAT16 :
(0841) 		if (move_window(fs, fs->fatbase + (clst / (SS(fs) / 2)))) break;
    006DB E088      LDI	R24,0x8
    006DC E090      LDI	R25,0
    006DD 850C      LDD	R16,Y+12
    006DE 851D      LDD	R17,Y+13
    006DF 852E      LDD	R18,Y+14
    006E0 853F      LDD	R19,Y+15
    006E1 938A      ST	-Y,R24
    006E2 940E 4957 CALL	lsr32
    006E4 01F6      MOVW	R30,R12
    006E5 8C26      LDD	R2,Z+30
    006E6 8C37      LDD	R3,Z+31
    006E7 A040      LDD	R4,Z+32
    006E8 A051      LDD	R5,Z+33
    006E9 0E20      ADD	R2,R16
    006EA 1E31      ADC	R3,R17
    006EB 1E42      ADC	R4,R18
    006EC 1E53      ADC	R5,R19
    006ED 8248      ST	Y,R4
    006EE 8259      STD	Y+1,R5
    006EF 0191      MOVW	R18,R2
    006F0 018F      MOVW	R16,R30
    006F1 DD7D      RCALL	ff.c:move_window
    006F2 2EA0      MOV	R10,R16
    006F3 2300      TST	R16
    006F4 F009      BEQ	0x06F6
    006F5 C089      RJMP	0x077F
(0842) 		p = &fs->win[clst * 2 % SS(fs)];
    006F6 EF4F      LDI	R20,0xFF
    006F7 E051      LDI	R21,1
    006F8 E060      LDI	R22,0
    006F9 E070      LDI	R23,0
    006FA 842C      LDD	R2,Y+12
    006FB 843D      LDD	R3,Y+13
    006FC 844E      LDD	R4,Y+14
    006FD 845F      LDD	R5,Y+15
    006FE 0C22      LSL	R2
    006FF 1C33      ROL	R3
    00700 1C44      ROL	R4
    00701 1C55      ROL	R5
    00702 2224      AND	R2,R20
    00703 2235      AND	R3,R21
    00704 2246      AND	R4,R22
    00705 2257      AND	R5,R23
    00706 0151      MOVW	R10,R2
    00707 01C6      MOVW	R24,R12
    00708 968E      ADIW	R24,0x2E
    00709 0EA8      ADD	R10,R24
    0070A 1EB9      ADC	R11,R25
(0843) 		return LD_WORD(p);
    0070B 01F5      MOVW	R30,R10
    0070C 8020      LD	R2,Z
    0070D 2433      CLR	R3
    0070E 8101      LDD	R16,Z+1
    0070F 2711      CLR	R17
    00710 2F10      MOV	R17,R16
    00711 2700      CLR	R16
    00712 2902      OR	R16,R2
    00713 2913      OR	R17,R3
    00714 2722      CLR	R18
    00715 2733      CLR	R19
    00716 C06C      RJMP	0x0783
(0844) 
(0845) 	case FS_FAT32 :
(0846) 		if (move_window(fs, fs->fatbase + (clst / (SS(fs) / 4)))) break;
    00717 E087      LDI	R24,7
    00718 E090      LDI	R25,0
    00719 850C      LDD	R16,Y+12
    0071A 851D      LDD	R17,Y+13
    0071B 852E      LDD	R18,Y+14
    0071C 853F      LDD	R19,Y+15
    0071D 938A      ST	-Y,R24
    0071E 940E 4957 CALL	lsr32
    00720 01F6      MOVW	R30,R12
    00721 8C26      LDD	R2,Z+30
    00722 8C37      LDD	R3,Z+31
    00723 A040      LDD	R4,Z+32
    00724 A051      LDD	R5,Z+33
    00725 0E20      ADD	R2,R16
    00726 1E31      ADC	R3,R17
    00727 1E42      ADC	R4,R18
    00728 1E53      ADC	R5,R19
    00729 8248      ST	Y,R4
    0072A 8259      STD	Y+1,R5
    0072B 0191      MOVW	R18,R2
    0072C 018F      MOVW	R16,R30
    0072D DD41      RCALL	ff.c:move_window
    0072E 2EE0      MOV	R14,R16
    0072F 2300      TST	R16
    00730 F009      BEQ	0x0732
    00731 C04D      RJMP	0x077F
(0847) 		p = &fs->win[clst * 4 % SS(fs)];
    00732 E082      LDI	R24,2
    00733 E090      LDI	R25,0
    00734 850C      LDD	R16,Y+12
    00735 851D      LDD	R17,Y+13
    00736 852E      LDD	R18,Y+14
    00737 853F      LDD	R19,Y+15
    00738 938A      ST	-Y,R24
    00739 940E 493E CALL	lsl32
    0073B 0118      MOVW	R2,R16
    0073C 0129      MOVW	R4,R18
    0073D EF4F      LDI	R20,0xFF
    0073E E051      LDI	R21,1
    0073F E060      LDI	R22,0
    00740 E070      LDI	R23,0
    00741 2224      AND	R2,R20
    00742 2235      AND	R3,R21
    00743 2246      AND	R4,R22
    00744 2257      AND	R5,R23
    00745 0151      MOVW	R10,R2
    00746 01C6      MOVW	R24,R12
    00747 968E      ADIW	R24,0x2E
    00748 0EA8      ADD	R10,R24
    00749 1EB9      ADC	R11,R25
(0848) 		return LD_DWORD(p) & 0x0FFFFFFF;
    0074A E188      LDI	R24,0x18
    0074B E090      LDI	R25,0
    0074C 01F5      MOVW	R30,R10
    0074D 8103      LDD	R16,Z+3
    0074E 2711      CLR	R17
    0074F 2722      CLR	R18
    00750 2733      CLR	R19
    00751 938A      ST	-Y,R24
    00752 940E 493E CALL	lsl32
    00754 0118      MOVW	R2,R16
    00755 0129      MOVW	R4,R18
    00756 01F5      MOVW	R30,R10
    00757 8062      LDD	R6,Z+2
    00758 2477      CLR	R7
    00759 2488      CLR	R8
    0075A 2499      CLR	R9
    0075B 0143      MOVW	R8,R6
    0075C 2466      CLR	R6
    0075D 2477      CLR	R7
    0075E 2826      OR	R2,R6
    0075F 2837      OR	R3,R7
    00760 2848      OR	R4,R8
    00761 2859      OR	R5,R9
    00762 8061      LDD	R6,Z+1
    00763 2477      CLR	R7
    00764 2C76      MOV	R7,R6
    00765 2466      CLR	R6
    00766 2488      CLR	R8
    00767 2499      CLR	R9
    00768 2826      OR	R2,R6
    00769 2837      OR	R3,R7
    0076A 2848      OR	R4,R8
    0076B 2859      OR	R5,R9
    0076C 8060      LD	R6,Z
    0076D 2477      CLR	R7
    0076E 2488      CLR	R8
    0076F 2499      CLR	R9
    00770 2826      OR	R2,R6
    00771 2837      OR	R3,R7
    00772 2848      OR	R4,R8
    00773 2859      OR	R5,R9
    00774 EF4F      LDI	R20,0xFF
    00775 EF5F      LDI	R21,0xFF
    00776 EF6F      LDI	R22,0xFF
    00777 E07F      LDI	R23,0xF
    00778 2224      AND	R2,R20
    00779 2235      AND	R3,R21
    0077A 2246      AND	R4,R22
    0077B 2257      AND	R5,R23
    0077C 0181      MOVW	R16,R2
    0077D 0192      MOVW	R18,R4
    0077E C004      RJMP	0x0783
(0849) 	}
(0850) 
(0851) 	return 0xFFFFFFFF;	/* An error occurred at the disk I/O layer */
    0077F EF0F      LDI	R16,0xFF
    00780 EF1F      LDI	R17,0xFF
    00781 EF2F      LDI	R18,0xFF
    00782 EF3F      LDI	R19,0xFF
    00783 9622      ADIW	R28,2
    00784 940E 48A8 CALL	pop_xgsetF0FC
    00786 9622      ADIW	R28,2
    00787 9508      RET
_put_fat:
  bc                   --> R12
  p                    --> R14
  res                  --> Y,+2
  val                  --> Y,+19
  clst                 --> Y,+15
  fs                   --> Y,+13
    00788 940E 476E CALL	push_arg4
    0078A 940E 48B3 CALL	push_xgsetF0FC
    0078C 9723      SBIW	R28,3
(0852) }
(0853) 
(0854) 
(0855) 
(0856) 
(0857) /*-----------------------------------------------------------------------*/
(0858) /* FAT access - Change value of a FAT entry                              */
(0859) /*-----------------------------------------------------------------------*/
(0860) #if !_FS_READONLY
(0861) 
(0862) FRESULT put_fat (
(0863) 	FATFS *fs,	/* File system object */
(0864) 	DWORD clst,	/* Cluster# to be changed in range of 2 to fs->n_fatent - 1 */
(0865) 	DWORD val	/* New value to mark the cluster */
(0866) )
(0867) {
(0868) 	UINT bc;
(0869) 	BYTE *p;
(0870) 	FRESULT res;
(0871) 
(0872) 
(0873) 	if (clst < 2 || clst >= fs->n_fatent) {	/* Check range */
    0078D E042      LDI	R20,2
    0078E E050      LDI	R21,0
    0078F E060      LDI	R22,0
    00790 E070      LDI	R23,0
    00791 842F      LDD	R2,Y+15
    00792 8838      LDD	R3,Y+16
    00793 8849      LDD	R4,Y+17
    00794 885A      LDD	R5,Y+18
    00795 1624      CP	R2,R20
    00796 0635      CPC	R3,R21
    00797 0646      CPC	R4,R22
    00798 0657      CPC	R5,R23
    00799 F080      BCS	0x07AA
    0079A 85ED      LDD	R30,Y+13
    0079B 85FE      LDD	R31,Y+14
    0079C 9676      ADIW	R30,0x16
    0079D 8020      LD	R2,Z
    0079E 8031      LDD	R3,Z+1
    0079F 8042      LDD	R4,Z+2
    007A0 8053      LDD	R5,Z+3
    007A1 846F      LDD	R6,Y+15
    007A2 8878      LDD	R7,Y+16
    007A3 8889      LDD	R8,Y+17
    007A4 889A      LDD	R9,Y+18
    007A5 1462      CP	R6,R2
    007A6 0473      CPC	R7,R3
    007A7 0484      CPC	R8,R4
    007A8 0495      CPC	R9,R5
    007A9 F018      BCS	0x07AD
(0874) 		res = FR_INT_ERR;
    007AA E082      LDI	R24,2
    007AB 838A      STD	Y+2,R24
(0875) 
(0876) 	} else {
    007AC C194      RJMP	0x0941
(0877) 		switch (fs->fs_type) {
    007AD 85ED      LDD	R30,Y+13
    007AE 85FE      LDD	R31,Y+14
    007AF 80A0      LD	R10,Z
    007B0 24BB      CLR	R11
    007B1 01C5      MOVW	R24,R10
    007B2 3081      CPI	R24,1
    007B3 E0E0      LDI	R30,0
    007B4 079E      CPC	R25,R30
    007B5 F059      BEQ	0x07C1
    007B6 3082      CPI	R24,2
    007B7 E0E0      LDI	R30,0
    007B8 079E      CPC	R25,R30
    007B9 F409      BNE	0x07BB
    007BA C0B0      RJMP	0x086B
    007BB 3083      CPI	R24,3
    007BC E0E0      LDI	R30,0
    007BD 079E      CPC	R25,R30
    007BE F409      BNE	0x07C0
    007BF C0E7      RJMP	0x08A7
    007C0 C17A      RJMP	0x093B
(0878) 		case FS_FAT12 :
(0879) 			bc = clst; bc += bc / 2;
    007C1 84CF      LDD	R12,Y+15
    007C2 88D8      LDD	R13,Y+16
    007C3 0116      MOVW	R2,R12
    007C4 9436      LSR	R3
    007C5 9427      ROR	R2
    007C6 0CC2      ADD	R12,R2
    007C7 1CD3      ADC	R13,R3
(0880) 			res = move_window(fs, fs->fatbase + (bc / SS(fs)));
    007C8 E029      LDI	R18,0x9
    007C9 E030      LDI	R19,0
    007CA 0186      MOVW	R16,R12
    007CB 940E 4950 CALL	lsr16
    007CD 0118      MOVW	R2,R16
    007CE 2444      CLR	R4
    007CF 2455      CLR	R5
    007D0 85ED      LDD	R30,Y+13
    007D1 85FE      LDD	R31,Y+14
    007D2 8C66      LDD	R6,Z+30
    007D3 8C77      LDD	R7,Z+31
    007D4 A080      LDD	R8,Z+32
    007D5 A091      LDD	R9,Z+33
    007D6 0C62      ADD	R6,R2
    007D7 1C73      ADC	R7,R3
    007D8 1C84      ADC	R8,R4
    007D9 1C95      ADC	R9,R5
    007DA 8288      ST	Y,R8
    007DB 8299      STD	Y+1,R9
    007DC 0193      MOVW	R18,R6
    007DD 018F      MOVW	R16,R30
    007DE DC90      RCALL	ff.c:move_window
    007DF 830A      STD	Y+2,R16
(0881) 			if (res != FR_OK) break;
    007E0 2E00      MOV	R0,R16
    007E1 2300      TST	R16
    007E2 F009      BEQ	0x07E4
    007E3 C159      RJMP	0x093D
(0882) 			p = &fs->win[bc % SS(fs)];
    007E4 858D      LDD	R24,Y+13
    007E5 859E      LDD	R25,Y+14
    007E6 968E      ADIW	R24,0x2E
    007E7 01F6      MOVW	R30,R12
    007E8 70F1      ANDI	R31,1
    007E9 017F      MOVW	R14,R30
    007EA 0EE8      ADD	R14,R24
    007EB 1EF9      ADC	R15,R25
(0883) 			*p = (clst & 1) ? ((*p & 0x0F) | ((BYTE)val << 4)) : (BYTE)val;
    007EC 842F      LDD	R2,Y+15
    007ED 8838      LDD	R3,Y+16
    007EE 8849      LDD	R4,Y+17
    007EF 885A      LDD	R5,Y+18
    007F0 93EF      PUSH	R30
    007F1 2DE2      MOV	R30,R2
    007F2 70E1      ANDI	R30,1
    007F3 91EF      POP	R30
    007F4 F0B1      BEQ	0x080B
    007F5 882B      LDD	R2,Y+19
    007F6 883C      LDD	R3,Y+20
    007F7 884D      LDD	R4,Y+21
    007F8 885E      LDD	R5,Y+22
    007F9 2433      CLR	R3
    007FA 0C22      LSL	R2
    007FB 1C33      ROL	R3
    007FC 0C22      LSL	R2
    007FD 1C33      ROL	R3
    007FE 0C22      LSL	R2
    007FF 1C33      ROL	R3
    00800 0C22      LSL	R2
    00801 1C33      ROL	R3
    00802 01F7      MOVW	R30,R14
    00803 8180      LD	R24,Z
    00804 2799      CLR	R25
    00805 708F      ANDI	R24,0xF
    00806 7090      ANDI	R25,0
    00807 015C      MOVW	R10,R24
    00808 28A2      OR	R10,R2
    00809 28B3      OR	R11,R3
    0080A C006      RJMP	0x0811
    0080B 882B      LDD	R2,Y+19
    0080C 883C      LDD	R3,Y+20
    0080D 884D      LDD	R4,Y+21
    0080E 885E      LDD	R5,Y+22
    0080F 2CA2      MOV	R10,R2
    00810 24BB      CLR	R11
    00811 01F7      MOVW	R30,R14
    00812 82A0      ST	Z,R10
(0884) 			bc++;
    00813 01C6      MOVW	R24,R12
    00814 9601      ADIW	R24,1
    00815 016C      MOVW	R12,R24
(0885) 			fs->wflag = 1;
    00816 E081      LDI	R24,1
    00817 85ED      LDD	R30,Y+13
    00818 85FE      LDD	R31,Y+14
    00819 8384      STD	Z+4,R24
(0886) 			res = move_window(fs, fs->fatbase + (bc / SS(fs)));
    0081A E029      LDI	R18,0x9
    0081B E030      LDI	R19,0
    0081C 0186      MOVW	R16,R12
    0081D 940E 4950 CALL	lsr16
    0081F 0118      MOVW	R2,R16
    00820 2444      CLR	R4
    00821 2455      CLR	R5
    00822 85ED      LDD	R30,Y+13
    00823 85FE      LDD	R31,Y+14
    00824 8C66      LDD	R6,Z+30
    00825 8C77      LDD	R7,Z+31
    00826 A080      LDD	R8,Z+32
    00827 A091      LDD	R9,Z+33
    00828 0C62      ADD	R6,R2
    00829 1C73      ADC	R7,R3
    0082A 1C84      ADC	R8,R4
    0082B 1C95      ADC	R9,R5
    0082C 8288      ST	Y,R8
    0082D 8299      STD	Y+1,R9
    0082E 0193      MOVW	R18,R6
    0082F 018F      MOVW	R16,R30
    00830 DC3E      RCALL	ff.c:move_window
    00831 830A      STD	Y+2,R16
(0887) 			if (res != FR_OK) break;
    00832 2E00      MOV	R0,R16
    00833 2300      TST	R16
    00834 F009      BEQ	0x0836
    00835 C107      RJMP	0x093D
(0888) 			p = &fs->win[bc % SS(fs)];
    00836 858D      LDD	R24,Y+13
    00837 859E      LDD	R25,Y+14
    00838 968E      ADIW	R24,0x2E
    00839 01F6      MOVW	R30,R12
    0083A 70F1      ANDI	R31,1
    0083B 017F      MOVW	R14,R30
    0083C 0EE8      ADD	R14,R24
    0083D 1EF9      ADC	R15,R25
(0889) 			*p = (clst & 1) ? (BYTE)(val >> 4) : ((*p & 0xF0) | ((BYTE)(val >> 8) & 0x0F));
    0083E 842F      LDD	R2,Y+15
    0083F 8838      LDD	R3,Y+16
    00840 8849      LDD	R4,Y+17
    00841 885A      LDD	R5,Y+18
    00842 93EF      PUSH	R30
    00843 2DE2      MOV	R30,R2
    00844 70E1      ANDI	R30,1
    00845 91EF      POP	R30
    00846 F061      BEQ	0x0853
    00847 E084      LDI	R24,4
    00848 E090      LDI	R25,0
    00849 890B      LDD	R16,Y+19
    0084A 891C      LDD	R17,Y+20
    0084B 892D      LDD	R18,Y+21
    0084C 893E      LDD	R19,Y+22
    0084D 938A      ST	-Y,R24
    0084E 940E 4957 CALL	lsr32
    00850 2EC0      MOV	R12,R16
    00851 24DD      CLR	R13
    00852 C015      RJMP	0x0868
    00853 E088      LDI	R24,0x8
    00854 E090      LDI	R25,0
    00855 890B      LDD	R16,Y+19
    00856 891C      LDD	R17,Y+20
    00857 892D      LDD	R18,Y+21
    00858 893E      LDD	R19,Y+22
    00859 938A      ST	-Y,R24
    0085A 940E 4957 CALL	lsr32
    0085C 2F80      MOV	R24,R16
    0085D 2799      CLR	R25
    0085E 708F      ANDI	R24,0xF
    0085F 7090      ANDI	R25,0
    00860 01F7      MOVW	R30,R14
    00861 81E0      LD	R30,Z
    00862 27FF      CLR	R31
    00863 7FE0      ANDI	R30,0xF0
    00864 70F0      ANDI	R31,0
    00865 016F      MOVW	R12,R30
    00866 2AC8      OR	R12,R24
    00867 2AD9      OR	R13,R25
    00868 01F7      MOVW	R30,R14
    00869 82C0      ST	Z,R12
(0890) 			break;
    0086A C0D2      RJMP	0x093D
(0891) 
(0892) 		case FS_FAT16 :
(0893) 			res = move_window(fs, fs->fatbase + (clst / (SS(fs) / 2)));
    0086B E088      LDI	R24,0x8
    0086C E090      LDI	R25,0
    0086D 850F      LDD	R16,Y+15
    0086E 8918      LDD	R17,Y+16
    0086F 8929      LDD	R18,Y+17
    00870 893A      LDD	R19,Y+18
    00871 938A      ST	-Y,R24
    00872 940E 4957 CALL	lsr32
    00874 85ED      LDD	R30,Y+13
    00875 85FE      LDD	R31,Y+14
    00876 8C26      LDD	R2,Z+30
    00877 8C37      LDD	R3,Z+31
    00878 A040      LDD	R4,Z+32
    00879 A051      LDD	R5,Z+33
    0087A 0E20      ADD	R2,R16
    0087B 1E31      ADC	R3,R17
    0087C 1E42      ADC	R4,R18
    0087D 1E53      ADC	R5,R19
    0087E 8248      ST	Y,R4
    0087F 8259      STD	Y+1,R5
    00880 0191      MOVW	R18,R2
    00881 018F      MOVW	R16,R30
    00882 DBEC      RCALL	ff.c:move_window
    00883 2EC0      MOV	R12,R16
    00884 82CA      STD	Y+2,R12
(0894) 			if (res != FR_OK) break;
    00885 2C0C      MOV	R0,R12
    00886 2300      TST	R16
    00887 F009      BEQ	0x0889
    00888 C0B4      RJMP	0x093D
(0895) 			p = &fs->win[clst * 2 % SS(fs)];
    00889 EF4F      LDI	R20,0xFF
    0088A E051      LDI	R21,1
    0088B E060      LDI	R22,0
    0088C E070      LDI	R23,0
    0088D 842F      LDD	R2,Y+15
    0088E 8838      LDD	R3,Y+16
    0088F 8849      LDD	R4,Y+17
    00890 885A      LDD	R5,Y+18
    00891 0C22      LSL	R2
    00892 1C33      ROL	R3
    00893 1C44      ROL	R4
    00894 1C55      ROL	R5
    00895 2224      AND	R2,R20
    00896 2235      AND	R3,R21
    00897 2246      AND	R4,R22
    00898 2257      AND	R5,R23
    00899 0171      MOVW	R14,R2
    0089A 858D      LDD	R24,Y+13
    0089B 859E      LDD	R25,Y+14
    0089C 968E      ADIW	R24,0x2E
    0089D 0EE8      ADD	R14,R24
    0089E 1EF9      ADC	R15,R25
(0896) 			ST_WORD(p, (WORD)val);
    0089F 882B      LDD	R2,Y+19
    008A0 883C      LDD	R3,Y+20
    008A1 01F7      MOVW	R30,R14
    008A2 8220      ST	Z,R2
    008A3 2C23      MOV	R2,R3
    008A4 2433      CLR	R3
    008A5 8221      STD	Z+1,R2
(0897) 			break;
    008A6 C096      RJMP	0x093D
(0898) 
(0899) 		case FS_FAT32 :
(0900) 			res = move_window(fs, fs->fatbase + (clst / (SS(fs) / 4)));
    008A7 E087      LDI	R24,7
    008A8 E090      LDI	R25,0
    008A9 850F      LDD	R16,Y+15
    008AA 8918      LDD	R17,Y+16
    008AB 8929      LDD	R18,Y+17
    008AC 893A      LDD	R19,Y+18
    008AD 938A      ST	-Y,R24
    008AE 940E 4957 CALL	lsr32
    008B0 85ED      LDD	R30,Y+13
    008B1 85FE      LDD	R31,Y+14
    008B2 8C26      LDD	R2,Z+30
    008B3 8C37      LDD	R3,Z+31
    008B4 A040      LDD	R4,Z+32
    008B5 A051      LDD	R5,Z+33
    008B6 0E20      ADD	R2,R16
    008B7 1E31      ADC	R3,R17
    008B8 1E42      ADC	R4,R18
    008B9 1E53      ADC	R5,R19
    008BA 8248      ST	Y,R4
    008BB 8259      STD	Y+1,R5
    008BC 0191      MOVW	R18,R2
    008BD 018F      MOVW	R16,R30
    008BE DBB0      RCALL	ff.c:move_window
    008BF 2EC0      MOV	R12,R16
    008C0 82CA      STD	Y+2,R12
(0901) 			if (res != FR_OK) break;
    008C1 2C0C      MOV	R0,R12
    008C2 2300      TST	R16
    008C3 F009      BEQ	0x08C5
    008C4 C078      RJMP	0x093D
(0902) 			p = &fs->win[clst * 4 % SS(fs)];
    008C5 E082      LDI	R24,2
    008C6 E090      LDI	R25,0
    008C7 850F      LDD	R16,Y+15
    008C8 8918      LDD	R17,Y+16
    008C9 8929      LDD	R18,Y+17
    008CA 893A      LDD	R19,Y+18
    008CB 938A      ST	-Y,R24
    008CC 940E 493E CALL	lsl32
    008CE 0118      MOVW	R2,R16
    008CF 0129      MOVW	R4,R18
    008D0 EF4F      LDI	R20,0xFF
    008D1 E051      LDI	R21,1
    008D2 E060      LDI	R22,0
    008D3 E070      LDI	R23,0
    008D4 2224      AND	R2,R20
    008D5 2235      AND	R3,R21
    008D6 2246      AND	R4,R22
    008D7 2257      AND	R5,R23
    008D8 0171      MOVW	R14,R2
    008D9 858D      LDD	R24,Y+13
    008DA 859E      LDD	R25,Y+14
    008DB 968E      ADIW	R24,0x2E
    008DC 0EE8      ADD	R14,R24
    008DD 1EF9      ADC	R15,R25
(0903) 			val |= LD_DWORD(p) & 0xF0000000;
    008DE E188      LDI	R24,0x18
    008DF E090      LDI	R25,0
    008E0 01F7      MOVW	R30,R14
    008E1 8103      LDD	R16,Z+3
    008E2 2711      CLR	R17
    008E3 2722      CLR	R18
    008E4 2733      CLR	R19
    008E5 938A      ST	-Y,R24
    008E6 940E 493E CALL	lsl32
    008E8 0118      MOVW	R2,R16
    008E9 0129      MOVW	R4,R18
    008EA 01F7      MOVW	R30,R14
    008EB 8062      LDD	R6,Z+2
    008EC 2477      CLR	R7
    008ED 2488      CLR	R8
    008EE 2499      CLR	R9
    008EF 0143      MOVW	R8,R6
    008F0 2466      CLR	R6
    008F1 2477      CLR	R7
    008F2 2826      OR	R2,R6
    008F3 2837      OR	R3,R7
    008F4 2848      OR	R4,R8
    008F5 2859      OR	R5,R9
    008F6 8061      LDD	R6,Z+1
    008F7 2477      CLR	R7
    008F8 2C76      MOV	R7,R6
    008F9 2466      CLR	R6
    008FA 2488      CLR	R8
    008FB 2499      CLR	R9
    008FC 2826      OR	R2,R6
    008FD 2837      OR	R3,R7
    008FE 2848      OR	R4,R8
    008FF 2859      OR	R5,R9
    00900 8060      LD	R6,Z
    00901 2477      CLR	R7
    00902 2488      CLR	R8
    00903 2499      CLR	R9
    00904 2826      OR	R2,R6
    00905 2837      OR	R3,R7
    00906 2848      OR	R4,R8
    00907 2859      OR	R5,R9
    00908 E040      LDI	R20,0
    00909 E050      LDI	R21,0
    0090A E060      LDI	R22,0
    0090B EF70      LDI	R23,0xF0
    0090C 2224      AND	R2,R20
    0090D 2235      AND	R3,R21
    0090E 2246      AND	R4,R22
    0090F 2257      AND	R5,R23
    00910 886B      LDD	R6,Y+19
    00911 887C      LDD	R7,Y+20
    00912 888D      LDD	R8,Y+21
    00913 889E      LDD	R9,Y+22
    00914 2862      OR	R6,R2
    00915 2873      OR	R7,R3
    00916 2884      OR	R8,R4
    00917 2895      OR	R9,R5
    00918 8A6B      STD	Y+19,R6
    00919 8A7C      STD	Y+20,R7
    0091A 8A8D      STD	Y+21,R8
    0091B 8A9E      STD	Y+22,R9
(0904) 			ST_DWORD(p, val);
    0091C 882B      LDD	R2,Y+19
    0091D 883C      LDD	R3,Y+20
    0091E 884D      LDD	R4,Y+21
    0091F 885E      LDD	R5,Y+22
    00920 8220      ST	Z,R2
    00921 2C23      MOV	R2,R3
    00922 2433      CLR	R3
    00923 9631      ADIW	R30,1
    00924 8220      ST	Z,R2
    00925 882B      LDD	R2,Y+19
    00926 883C      LDD	R3,Y+20
    00927 884D      LDD	R4,Y+21
    00928 885E      LDD	R5,Y+22
    00929 0112      MOVW	R2,R4
    0092A 2444      CLR	R4
    0092B 2455      CLR	R5
    0092C 01F7      MOVW	R30,R14
    0092D 9632      ADIW	R30,2
    0092E 8220      ST	Z,R2
    0092F E188      LDI	R24,0x18
    00930 E090      LDI	R25,0
    00931 890B      LDD	R16,Y+19
    00932 891C      LDD	R17,Y+20
    00933 892D      LDD	R18,Y+21
    00934 893E      LDD	R19,Y+22
    00935 938A      ST	-Y,R24
    00936 940E 4957 CALL	lsr32
    00938 01F7      MOVW	R30,R14
    00939 8303      STD	Z+3,R16
(0905) 			break;
    0093A C002      RJMP	0x093D
(0906) 
(0907) 		default :
(0908) 			res = FR_INT_ERR;
    0093B E082      LDI	R24,2
    0093C 838A      STD	Y+2,R24
(0909) 		}
(0910) 		fs->wflag = 1;
    0093D E081      LDI	R24,1
    0093E 85ED      LDD	R30,Y+13
    0093F 85FE      LDD	R31,Y+14
    00940 8384      STD	Z+4,R24
(0911) 	}
(0912) 
(0913) 	return res;
    00941 810A      LDD	R16,Y+2
    00942 9623      ADIW	R28,3
    00943 940E 48A8 CALL	pop_xgsetF0FC
    00945 9624      ADIW	R28,4
    00946 9508      RET
ff.c:remove_chain:
  res                  --> R10
  nxt                  --> Y,+6
  clst                 --> Y,+18
  fs                   --> R12
    00947 933A      ST	-Y,R19
    00948 932A      ST	-Y,R18
    00949 940E 48EE CALL	push_xgsetF03C
    0094B 0168      MOVW	R12,R16
    0094C 972A      SBIW	R28,0xA
(0914) }
(0915) #endif /* !_FS_READONLY */
(0916) 
(0917) 
(0918) 
(0919) 
(0920) /*-----------------------------------------------------------------------*/
(0921) /* FAT handling - Remove a cluster chain                                 */
(0922) /*-----------------------------------------------------------------------*/
(0923) #if !_FS_READONLY
(0924) static
(0925) FRESULT remove_chain (
(0926) 	FATFS *fs,			/* File system object */
(0927) 	DWORD clst			/* Cluster# to remove a chain from */
(0928) )
(0929) {
(0930) 	FRESULT res;
(0931) 	DWORD nxt;
(0932) #if _USE_ERASE
(0933) 	DWORD scl = clst, ecl = clst, resion[2];
(0934) #endif
(0935) 
(0936) 	if (clst < 2 || clst >= fs->n_fatent) {	/* Check range */
    0094D E042      LDI	R20,2
    0094E E050      LDI	R21,0
    0094F E060      LDI	R22,0
    00950 E070      LDI	R23,0
    00951 882A      LDD	R2,Y+18
    00952 883B      LDD	R3,Y+19
    00953 884C      LDD	R4,Y+20
    00954 885D      LDD	R5,Y+21
    00955 1624      CP	R2,R20
    00956 0635      CPC	R3,R21
    00957 0646      CPC	R4,R22
    00958 0657      CPC	R5,R23
    00959 F078      BCS	0x0969
    0095A 01F6      MOVW	R30,R12
    0095B 9676      ADIW	R30,0x16
    0095C 8020      LD	R2,Z
    0095D 8031      LDD	R3,Z+1
    0095E 8042      LDD	R4,Z+2
    0095F 8053      LDD	R5,Z+3
    00960 886A      LDD	R6,Y+18
    00961 887B      LDD	R7,Y+19
    00962 888C      LDD	R8,Y+20
    00963 889D      LDD	R9,Y+21
    00964 1462      CP	R6,R2
    00965 0473      CPC	R7,R3
    00966 0484      CPC	R8,R4
    00967 0495      CPC	R9,R5
    00968 F018      BCS	0x096C
(0937) 		res = FR_INT_ERR;
    00969 E082      LDI	R24,2
    0096A 2EA8      MOV	R10,R24
(0938) 
(0939) 	} else {
    0096B C088      RJMP	0x09F4
(0940) 		res = FR_OK;
    0096C 24AA      CLR	R10
    0096D C076      RJMP	0x09E4
(0941) 		while (clst < fs->n_fatent) {			/* Not a last link? */
(0942) 			nxt = get_fat(fs, clst);			/* Get cluster status */
    0096E 882A      LDD	R2,Y+18
    0096F 883B      LDD	R3,Y+19
    00970 884C      LDD	R4,Y+20
    00971 885D      LDD	R5,Y+21
    00972 8248      ST	Y,R4
    00973 8259      STD	Y+1,R5
    00974 0191      MOVW	R18,R2
    00975 0186      MOVW	R16,R12
    00976 DCC1      RCALL	_get_fat
    00977 830E      STD	Y+6,R16
    00978 831F      STD	Y+7,R17
    00979 8728      STD	Y+8,R18
    0097A 8739      STD	Y+9,R19
(0943) 			if (nxt == 0) break;				/* Empty cluster? */
    0097B 802E      LDD	R2,Y+6
    0097C 803F      LDD	R3,Y+7
    0097D 8448      LDD	R4,Y+8
    0097E 8459      LDD	R5,Y+9
    0097F 9488      BCLR	0
    00980 2022      TST	R2
    00981 0432      CPC	R3,R2
    00982 0442      CPC	R4,R2
    00983 0452      CPC	R5,R2
    00984 F409      BNE	0x0986
    00985 C06E      RJMP	0x09F4
(0944) 			if (nxt == 1) { res = FR_INT_ERR; break; }	/* Internal error? */
    00986 E041      LDI	R20,1
    00987 E050      LDI	R21,0
    00988 E060      LDI	R22,0
    00989 E070      LDI	R23,0
    0098A 802E      LDD	R2,Y+6
    0098B 803F      LDD	R3,Y+7
    0098C 8448      LDD	R4,Y+8
    0098D 8459      LDD	R5,Y+9
    0098E 1624      CP	R2,R20
    0098F 0635      CPC	R3,R21
    00990 0646      CPC	R4,R22
    00991 0657      CPC	R5,R23
    00992 F419      BNE	0x0996
    00993 E082      LDI	R24,2
    00994 2EA8      MOV	R10,R24
    00995 C05E      RJMP	0x09F4
(0945) 			if (nxt == 0xFFFFFFFF) { res = FR_DISK_ERR; break; }	/* Disk error? */
    00996 EF4F      LDI	R20,0xFF
    00997 EF5F      LDI	R21,0xFF
    00998 EF6F      LDI	R22,0xFF
    00999 EF7F      LDI	R23,0xFF
    0099A 802E      LDD	R2,Y+6
    0099B 803F      LDD	R3,Y+7
    0099C 8448      LDD	R4,Y+8
    0099D 8459      LDD	R5,Y+9
    0099E 1624      CP	R2,R20
    0099F 0635      CPC	R3,R21
    009A0 0646      CPC	R4,R22
    009A1 0657      CPC	R5,R23
    009A2 F419      BNE	0x09A6
    009A3 24AA      CLR	R10
    009A4 94A3      INC	R10
    009A5 C04E      RJMP	0x09F4
(0946) 			res = put_fat(fs, clst, 0);			/* Mark the cluster "empty" */
    009A6 E080      LDI	R24,0
    009A7 838A      STD	Y+2,R24
    009A8 838B      STD	Y+3,R24
    009A9 838C      STD	Y+4,R24
    009AA 838D      STD	Y+5,R24
    009AB 882A      LDD	R2,Y+18
    009AC 883B      LDD	R3,Y+19
    009AD 884C      LDD	R4,Y+20
    009AE 885D      LDD	R5,Y+21
    009AF 8248      ST	Y,R4
    009B0 8259      STD	Y+1,R5
    009B1 0191      MOVW	R18,R2
    009B2 0186      MOVW	R16,R12
    009B3 DDD4      RCALL	_put_fat
    009B4 2EA0      MOV	R10,R16
(0947) 			if (res != FR_OK) break;
    009B5 2300      TST	R16
    009B6 F009      BEQ	0x09B8
    009B7 C03C      RJMP	0x09F4
(0948) 			if (fs->free_clust != 0xFFFFFFFF) {	/* Update FSInfo */
    009B8 EF4F      LDI	R20,0xFF
    009B9 EF5F      LDI	R21,0xFF
    009BA EF6F      LDI	R22,0xFF
    009BB EF7F      LDI	R23,0xFF
    009BC 01F6      MOVW	R30,R12
    009BD 8426      LDD	R2,Z+14
    009BE 8437      LDD	R3,Z+15
    009BF 8840      LDD	R4,Z+16
    009C0 8851      LDD	R5,Z+17
    009C1 1624      CP	R2,R20
    009C2 0635      CPC	R3,R21
    009C3 0646      CPC	R4,R22
    009C4 0657      CPC	R5,R23
    009C5 F0B1      BEQ	0x09DC
(0949) 				fs->free_clust++;
    009C6 01CF      MOVW	R24,R30
    009C7 960E      ADIW	R24,0xE
    009C8 E041      LDI	R20,1
    009C9 E050      LDI	R21,0
    009CA E060      LDI	R22,0
    009CB E070      LDI	R23,0
    009CC 01FC      MOVW	R30,R24
    009CD 8020      LD	R2,Z
    009CE 8031      LDD	R3,Z+1
    009CF 8042      LDD	R4,Z+2
    009D0 8053      LDD	R5,Z+3
    009D1 0E24      ADD	R2,R20
    009D2 1E35      ADC	R3,R21
    009D3 1E46      ADC	R4,R22
    009D4 1E57      ADC	R5,R23
    009D5 8220      ST	Z,R2
    009D6 8231      STD	Z+1,R3
    009D7 8242      STD	Z+2,R4
    009D8 8253      STD	Z+3,R5
(0950) 				fs->fsi_flag = 1;
    009D9 E081      LDI	R24,1
    009DA 01F6      MOVW	R30,R12
    009DB 8385      STD	Z+5,R24
(0951) 			}
(0952) #if _USE_ERASE
(0953) 			if (ecl + 1 == nxt) {	/* Next cluster is contiguous */
(0954) 				ecl = nxt;
(0955) 			} else {				/* End of contiguous clusters */ 
(0956) 				resion[0] = clust2sect(fs, scl);					/* Start sector */
(0957) 				resion[1] = clust2sect(fs, ecl) + fs->csize - 1;	/* End sector */
(0958) 				disk_ioctl(fs->drv, CTRL_ERASE_SECTOR, resion);		/* Erase the block */
(0959) 				scl = ecl = nxt;
(0960) 			}
(0961) #endif
(0962) 			clst = nxt;	/* Next cluster */
    009DC 802E      LDD	R2,Y+6
    009DD 803F      LDD	R3,Y+7
    009DE 8448      LDD	R4,Y+8
    009DF 8459      LDD	R5,Y+9
    009E0 8A2A      STD	Y+18,R2
    009E1 8A3B      STD	Y+19,R3
    009E2 8A4C      STD	Y+20,R4
    009E3 8A5D      STD	Y+21,R5
    009E4 01F6      MOVW	R30,R12
    009E5 9676      ADIW	R30,0x16
    009E6 8020      LD	R2,Z
    009E7 8031      LDD	R3,Z+1
    009E8 8042      LDD	R4,Z+2
    009E9 8053      LDD	R5,Z+3
    009EA 886A      LDD	R6,Y+18
    009EB 887B      LDD	R7,Y+19
    009EC 888C      LDD	R8,Y+20
    009ED 889D      LDD	R9,Y+21
    009EE 1462      CP	R6,R2
    009EF 0473      CPC	R7,R3
    009F0 0484      CPC	R8,R4
    009F1 0495      CPC	R9,R5
    009F2 F408      BCC	0x09F4
    009F3 CF7A      RJMP	0x096E
(0963) 		}
(0964) 	}
(0965) 
(0966) 	return res;
    009F4 2D0A      MOV	R16,R10
    009F5 962A      ADIW	R28,0xA
    009F6 940E 48F7 CALL	pop_xgsetF03C
    009F8 9622      ADIW	R28,2
    009F9 9508      RET
ff.c:create_chain:
  res                  --> R10
  scl                  --> Y,+14
  cs                   --> Y,+10
  ncl                  --> Y,+6
  clst                 --> Y,+32
  fs                   --> R12
    009FA 933A      ST	-Y,R19
    009FB 932A      ST	-Y,R18
    009FC 940E 48B3 CALL	push_xgsetF0FC
    009FE 0168      MOVW	R12,R16
    009FF 9766      SBIW	R28,0x16
(0967) }
(0968) #endif
(0969) 
(0970) 
(0971) 
(0972) 
(0973) /*-----------------------------------------------------------------------*/
(0974) /* FAT handling - Stretch or Create a cluster chain                      */
(0975) /*-----------------------------------------------------------------------*/
(0976) #if !_FS_READONLY
(0977) static
(0978) DWORD create_chain (	/* 0:No free cluster, 1:Internal error, 0xFFFFFFFF:Disk error, >=2:New cluster# */
(0979) 	FATFS *fs,			/* File system object */
(0980) 	DWORD clst			/* Cluster# to stretch. 0 means create a new chain. */
(0981) )
(0982) {
(0983) 	DWORD cs, ncl, scl;
(0984) 	FRESULT res;
(0985) 
(0986) 
(0987) 	if (clst == 0) {		/* Create a new chain */
    00A00 A028      LDD	R2,Y+32
    00A01 A039      LDD	R3,Y+33
    00A02 A04A      LDD	R4,Y+34
    00A03 A05B      LDD	R5,Y+35
    00A04 9488      BCLR	0
    00A05 2022      TST	R2
    00A06 0432      CPC	R3,R2
    00A07 0442      CPC	R4,R2
    00A08 0452      CPC	R5,R2
    00A09 F559      BNE	0x0A35
(0988) 		scl = fs->last_clust;			/* Get suggested start point */
    00A0A 01F6      MOVW	R30,R12
    00A0B 963A      ADIW	R30,0xA
    00A0C 8020      LD	R2,Z
    00A0D 8031      LDD	R3,Z+1
    00A0E 8042      LDD	R4,Z+2
    00A0F 8053      LDD	R5,Z+3
    00A10 862E      STD	Y+14,R2
    00A11 863F      STD	Y+15,R3
    00A12 8A48      STD	Y+16,R4
    00A13 8A59      STD	Y+17,R5
(0989) 		if (!scl || scl >= fs->n_fatent) scl = 1;
    00A14 842E      LDD	R2,Y+14
    00A15 843F      LDD	R3,Y+15
    00A16 8848      LDD	R4,Y+16
    00A17 8859      LDD	R5,Y+17
    00A18 9488      BCLR	0
    00A19 2022      TST	R2
    00A1A 0432      CPC	R3,R2
    00A1B 0442      CPC	R4,R2
    00A1C 0452      CPC	R5,R2
    00A1D F081      BEQ	0x0A2E
    00A1E 01F6      MOVW	R30,R12
    00A1F 9676      ADIW	R30,0x16
    00A20 8020      LD	R2,Z
    00A21 8031      LDD	R3,Z+1
    00A22 8042      LDD	R4,Z+2
    00A23 8053      LDD	R5,Z+3
    00A24 846E      LDD	R6,Y+14
    00A25 847F      LDD	R7,Y+15
    00A26 8888      LDD	R8,Y+16
    00A27 8899      LDD	R9,Y+17
    00A28 1462      CP	R6,R2
    00A29 0473      CPC	R7,R3
    00A2A 0484      CPC	R8,R4
    00A2B 0495      CPC	R9,R5
    00A2C F408      BCC	0x0A2E
    00A2D C040      RJMP	0x0A6E
    00A2E E081      LDI	R24,1
    00A2F 878E      STD	Y+14,R24
    00A30 E080      LDI	R24,0
    00A31 878F      STD	Y+15,R24
    00A32 8B88      STD	Y+16,R24
    00A33 8B89      STD	Y+17,R24
(0990) 	}
    00A34 C039      RJMP	0x0A6E
(0991) 	else {					/* Stretch the current chain */
(0992) 		cs = get_fat(fs, clst);			/* Check the cluster status */
    00A35 A028      LDD	R2,Y+32
    00A36 A039      LDD	R3,Y+33
    00A37 A04A      LDD	R4,Y+34
    00A38 A05B      LDD	R5,Y+35
    00A39 8248      ST	Y,R4
    00A3A 8259      STD	Y+1,R5
    00A3B 0191      MOVW	R18,R2
    00A3C 0186      MOVW	R16,R12
    00A3D DBFA      RCALL	_get_fat
    00A3E 870A      STD	Y+10,R16
    00A3F 871B      STD	Y+11,R17
    00A40 872C      STD	Y+12,R18
    00A41 873D      STD	Y+13,R19
(0993) 		if (cs < 2) return 1;			/* It is an invalid cluster */
    00A42 E042      LDI	R20,2
    00A43 E050      LDI	R21,0
    00A44 E060      LDI	R22,0
    00A45 E070      LDI	R23,0
    00A46 842A      LDD	R2,Y+10
    00A47 843B      LDD	R3,Y+11
    00A48 844C      LDD	R4,Y+12
    00A49 845D      LDD	R5,Y+13
    00A4A 1624      CP	R2,R20
    00A4B 0635      CPC	R3,R21
    00A4C 0646      CPC	R4,R22
    00A4D 0657      CPC	R5,R23
    00A4E F428      BCC	0x0A54
    00A4F E001      LDI	R16,1
    00A50 E010      LDI	R17,0
    00A51 E020      LDI	R18,0
    00A52 E030      LDI	R19,0
    00A53 C119      RJMP	0x0B6D
(0994) 		if (cs < fs->n_fatent) return cs;	/* It is already followed by next cluster */
    00A54 01F6      MOVW	R30,R12
    00A55 9676      ADIW	R30,0x16
    00A56 8020      LD	R2,Z
    00A57 8031      LDD	R3,Z+1
    00A58 8042      LDD	R4,Z+2
    00A59 8053      LDD	R5,Z+3
    00A5A 846A      LDD	R6,Y+10
    00A5B 847B      LDD	R7,Y+11
    00A5C 848C      LDD	R8,Y+12
    00A5D 849D      LDD	R9,Y+13
    00A5E 1462      CP	R6,R2
    00A5F 0473      CPC	R7,R3
    00A60 0484      CPC	R8,R4
    00A61 0495      CPC	R9,R5
    00A62 F418      BCC	0x0A66
    00A63 0183      MOVW	R16,R6
    00A64 0194      MOVW	R18,R8
    00A65 C107      RJMP	0x0B6D
(0995) 		scl = clst;
    00A66 A028      LDD	R2,Y+32
    00A67 A039      LDD	R3,Y+33
    00A68 A04A      LDD	R4,Y+34
    00A69 A05B      LDD	R5,Y+35
    00A6A 862E      STD	Y+14,R2
    00A6B 863F      STD	Y+15,R3
    00A6C 8A48      STD	Y+16,R4
    00A6D 8A59      STD	Y+17,R5
(0996) 	}
(0997) 
(0998) 	ncl = scl;				/* Start cluster */
    00A6E 842E      LDD	R2,Y+14
    00A6F 843F      LDD	R3,Y+15
    00A70 8848      LDD	R4,Y+16
    00A71 8859      LDD	R5,Y+17
    00A72 822E      STD	Y+6,R2
    00A73 823F      STD	Y+7,R3
    00A74 8648      STD	Y+8,R4
    00A75 8659      STD	Y+9,R5
(0999) 	for (;;) {
(1000) 		ncl++;							/* Next cluster */
    00A76 E041      LDI	R20,1
    00A77 E050      LDI	R21,0
    00A78 E060      LDI	R22,0
    00A79 E070      LDI	R23,0
    00A7A 802E      LDD	R2,Y+6
    00A7B 803F      LDD	R3,Y+7
    00A7C 8448      LDD	R4,Y+8
    00A7D 8459      LDD	R5,Y+9
    00A7E 0E24      ADD	R2,R20
    00A7F 1E35      ADC	R3,R21
    00A80 1E46      ADC	R4,R22
    00A81 1E57      ADC	R5,R23
    00A82 822E      STD	Y+6,R2
    00A83 823F      STD	Y+7,R3
    00A84 8648      STD	Y+8,R4
    00A85 8659      STD	Y+9,R5
(1001) 		if (ncl >= fs->n_fatent) {		/* Wrap around */
    00A86 01F6      MOVW	R30,R12
    00A87 9676      ADIW	R30,0x16
    00A88 8020      LD	R2,Z
    00A89 8031      LDD	R3,Z+1
    00A8A 8042      LDD	R4,Z+2
    00A8B 8053      LDD	R5,Z+3
    00A8C 806E      LDD	R6,Y+6
    00A8D 807F      LDD	R7,Y+7
    00A8E 8488      LDD	R8,Y+8
    00A8F 8499      LDD	R9,Y+9
    00A90 1462      CP	R6,R2
    00A91 0473      CPC	R7,R3
    00A92 0484      CPC	R8,R4
    00A93 0495      CPC	R9,R5
    00A94 F0C0      BCS	0x0AAD
(1002) 			ncl = 2;
    00A95 E082      LDI	R24,2
    00A96 838E      STD	Y+6,R24
    00A97 E080      LDI	R24,0
    00A98 838F      STD	Y+7,R24
    00A99 8788      STD	Y+8,R24
    00A9A 8789      STD	Y+9,R24
(1003) 			if (ncl > scl) return 0;	/* No free cluster */
    00A9B 842E      LDD	R2,Y+14
    00A9C 843F      LDD	R3,Y+15
    00A9D 8848      LDD	R4,Y+16
    00A9E 8859      LDD	R5,Y+17
    00A9F 806E      LDD	R6,Y+6
    00AA0 807F      LDD	R7,Y+7
    00AA1 8488      LDD	R8,Y+8
    00AA2 8499      LDD	R9,Y+9
    00AA3 1426      CP	R2,R6
    00AA4 0437      CPC	R3,R7
    00AA5 0448      CPC	R4,R8
    00AA6 0459      CPC	R5,R9
    00AA7 F428      BCC	0x0AAD
    00AA8 E000      LDI	R16,0
    00AA9 E010      LDI	R17,0
    00AAA E020      LDI	R18,0
    00AAB E030      LDI	R19,0
    00AAC C0C0      RJMP	0x0B6D
(1004) 		}
(1005) 		cs = get_fat(fs, ncl);			/* Get the cluster status */
    00AAD 802E      LDD	R2,Y+6
    00AAE 803F      LDD	R3,Y+7
    00AAF 8448      LDD	R4,Y+8
    00AB0 8459      LDD	R5,Y+9
    00AB1 8248      ST	Y,R4
    00AB2 8259      STD	Y+1,R5
    00AB3 0191      MOVW	R18,R2
    00AB4 0186      MOVW	R16,R12
    00AB5 DB82      RCALL	_get_fat
    00AB6 870A      STD	Y+10,R16
    00AB7 871B      STD	Y+11,R17
    00AB8 872C      STD	Y+12,R18
    00AB9 873D      STD	Y+13,R19
(1006) 		if (cs == 0) break;				/* Found a free cluster */
    00ABA 842A      LDD	R2,Y+10
    00ABB 843B      LDD	R3,Y+11
    00ABC 844C      LDD	R4,Y+12
    00ABD 845D      LDD	R5,Y+13
    00ABE 9488      BCLR	0
    00ABF 2022      TST	R2
    00AC0 0432      CPC	R3,R2
    00AC1 0442      CPC	R4,R2
    00AC2 0452      CPC	R5,R2
    00AC3 F409      BNE	0x0AC5
    00AC4 C02E      RJMP	0x0AF3
(1007) 		if (cs == 0xFFFFFFFF || cs == 1)/* An error occurred */
    00AC5 EF4F      LDI	R20,0xFF
    00AC6 EF5F      LDI	R21,0xFF
    00AC7 EF6F      LDI	R22,0xFF
    00AC8 EF7F      LDI	R23,0xFF
    00AC9 842A      LDD	R2,Y+10
    00ACA 843B      LDD	R3,Y+11
    00ACB 844C      LDD	R4,Y+12
    00ACC 845D      LDD	R5,Y+13
    00ACD 1624      CP	R2,R20
    00ACE 0635      CPC	R3,R21
    00ACF 0646      CPC	R4,R22
    00AD0 0657      CPC	R5,R23
    00AD1 F049      BEQ	0x0ADB
    00AD2 E041      LDI	R20,1
    00AD3 E050      LDI	R21,0
    00AD4 E060      LDI	R22,0
    00AD5 E070      LDI	R23,0
    00AD6 1624      CP	R2,R20
    00AD7 0635      CPC	R3,R21
    00AD8 0646      CPC	R4,R22
    00AD9 0657      CPC	R5,R23
    00ADA F429      BNE	0x0AE0
(1008) 			return cs;
    00ADB 850A      LDD	R16,Y+10
    00ADC 851B      LDD	R17,Y+11
    00ADD 852C      LDD	R18,Y+12
    00ADE 853D      LDD	R19,Y+13
    00ADF C08D      RJMP	0x0B6D
(1009) 		if (ncl == scl) return 0;		/* No free cluster */
    00AE0 842E      LDD	R2,Y+14
    00AE1 843F      LDD	R3,Y+15
    00AE2 8848      LDD	R4,Y+16
    00AE3 8859      LDD	R5,Y+17
    00AE4 806E      LDD	R6,Y+6
    00AE5 807F      LDD	R7,Y+7
    00AE6 8488      LDD	R8,Y+8
    00AE7 8499      LDD	R9,Y+9
    00AE8 1462      CP	R6,R2
    00AE9 0473      CPC	R7,R3
    00AEA 0484      CPC	R8,R4
    00AEB 0495      CPC	R9,R5
    00AEC F009      BEQ	0x0AEE
    00AED CF88      RJMP	0x0A76
    00AEE E000      LDI	R16,0
    00AEF E010      LDI	R17,0
    00AF0 E020      LDI	R18,0
    00AF1 E030      LDI	R19,0
    00AF2 C07A      RJMP	0x0B6D
(1010) 	}
(1011) 
(1012) 	res = put_fat(fs, ncl, 0x0FFFFFFF);	/* Mark the new cluster "last link" */
    00AF3 EF8F      LDI	R24,0xFF
    00AF4 838A      STD	Y+2,R24
    00AF5 838B      STD	Y+3,R24
    00AF6 838C      STD	Y+4,R24
    00AF7 E08F      LDI	R24,0xF
    00AF8 838D      STD	Y+5,R24
    00AF9 802E      LDD	R2,Y+6
    00AFA 803F      LDD	R3,Y+7
    00AFB 8448      LDD	R4,Y+8
    00AFC 8459      LDD	R5,Y+9
    00AFD 8248      ST	Y,R4
    00AFE 8259      STD	Y+1,R5
    00AFF 0191      MOVW	R18,R2
    00B00 0186      MOVW	R16,R12
    00B01 DC86      RCALL	_put_fat
    00B02 2EA0      MOV	R10,R16
(1013) 	if (res == FR_OK && clst != 0) {
    00B03 2300      TST	R16
    00B04 F4E1      BNE	0x0B21
    00B05 A028      LDD	R2,Y+32
    00B06 A039      LDD	R3,Y+33
    00B07 A04A      LDD	R4,Y+34
    00B08 A05B      LDD	R5,Y+35
    00B09 9488      BCLR	0
    00B0A 2022      TST	R2
    00B0B 0432      CPC	R3,R2
    00B0C 0442      CPC	R4,R2
    00B0D 0452      CPC	R5,R2
    00B0E F091      BEQ	0x0B21
(1014) 		res = put_fat(fs, clst, ncl);	/* Link it to the previous one if needed */
    00B0F 802E      LDD	R2,Y+6
    00B10 803F      LDD	R3,Y+7
    00B11 8448      LDD	R4,Y+8
    00B12 8459      LDD	R5,Y+9
    00B13 822A      STD	Y+2,R2
    00B14 823B      STD	Y+3,R3
    00B15 824C      STD	Y+4,R4
    00B16 825D      STD	Y+5,R5
    00B17 A028      LDD	R2,Y+32
    00B18 A039      LDD	R3,Y+33
    00B19 A04A      LDD	R4,Y+34
    00B1A A05B      LDD	R5,Y+35
    00B1B 8248      ST	Y,R4
    00B1C 8259      STD	Y+1,R5
    00B1D 0191      MOVW	R18,R2
    00B1E 0186      MOVW	R16,R12
    00B1F DC68      RCALL	_put_fat
    00B20 2EA0      MOV	R10,R16
(1015) 	}
(1016) 	if (res == FR_OK) {
    00B21 20AA      TST	R10
    00B22 F009      BEQ	0x0B24
    00B23 C02E      RJMP	0x0B52
(1017) 		fs->last_clust = ncl;			/* Update FSINFO */
    00B24 802E      LDD	R2,Y+6
    00B25 803F      LDD	R3,Y+7
    00B26 8448      LDD	R4,Y+8
    00B27 8459      LDD	R5,Y+9
    00B28 01F6      MOVW	R30,R12
    00B29 8622      STD	Z+10,R2
    00B2A 8633      STD	Z+11,R3
    00B2B 8644      STD	Z+12,R4
    00B2C 8655      STD	Z+13,R5
(1018) 		if (fs->free_clust != 0xFFFFFFFF) {
    00B2D EF4F      LDI	R20,0xFF
    00B2E EF5F      LDI	R21,0xFF
    00B2F EF6F      LDI	R22,0xFF
    00B30 EF7F      LDI	R23,0xFF
    00B31 8426      LDD	R2,Z+14
    00B32 8437      LDD	R3,Z+15
    00B33 8840      LDD	R4,Z+16
    00B34 8851      LDD	R5,Z+17
    00B35 1624      CP	R2,R20
    00B36 0635      CPC	R3,R21
    00B37 0646      CPC	R4,R22
    00B38 0657      CPC	R5,R23
    00B39 F179      BEQ	0x0B69
(1019) 			fs->free_clust--;
    00B3A 01CF      MOVW	R24,R30
    00B3B 960E      ADIW	R24,0xE
    00B3C 017C      MOVW	R14,R24
    00B3D E041      LDI	R20,1
    00B3E E050      LDI	R21,0
    00B3F E060      LDI	R22,0
    00B40 E070      LDI	R23,0
    00B41 01FC      MOVW	R30,R24
    00B42 8020      LD	R2,Z
    00B43 8031      LDD	R3,Z+1
    00B44 8042      LDD	R4,Z+2
    00B45 8053      LDD	R5,Z+3
    00B46 1A24      SUB	R2,R20
    00B47 0A35      SBC	R3,R21
    00B48 0A46      SBC	R4,R22
    00B49 0A57      SBC	R5,R23
    00B4A 8220      ST	Z,R2
    00B4B 8231      STD	Z+1,R3
    00B4C 8242      STD	Z+2,R4
    00B4D 8253      STD	Z+3,R5
(1020) 			fs->fsi_flag = 1;
    00B4E E081      LDI	R24,1
    00B4F 01F6      MOVW	R30,R12
    00B50 8385      STD	Z+5,R24
(1021) 		}
(1022) 	} else {
    00B51 C017      RJMP	0x0B69
(1023) 		ncl = (res == FR_DISK_ERR) ? 0xFFFFFFFF : 1;
    00B52 2D8A      MOV	R24,R10
    00B53 3081      CPI	R24,1
    00B54 F431      BNE	0x0B5B
    00B55 EF8F      LDI	R24,0xFF
    00B56 8B8A      STD	Y+18,R24
    00B57 8B8B      STD	Y+19,R24
    00B58 8B8C      STD	Y+20,R24
    00B59 8B8D      STD	Y+21,R24
    00B5A C006      RJMP	0x0B61
    00B5B E081      LDI	R24,1
    00B5C 8B8A      STD	Y+18,R24
    00B5D E080      LDI	R24,0
    00B5E 8B8B      STD	Y+19,R24
    00B5F 8B8C      STD	Y+20,R24
    00B60 8B8D      STD	Y+21,R24
    00B61 882A      LDD	R2,Y+18
    00B62 883B      LDD	R3,Y+19
    00B63 884C      LDD	R4,Y+20
    00B64 885D      LDD	R5,Y+21
    00B65 822E      STD	Y+6,R2
    00B66 823F      STD	Y+7,R3
    00B67 8648      STD	Y+8,R4
    00B68 8659      STD	Y+9,R5
(1024) 	}
(1025) 
(1026) 	return ncl;		/* Return new cluster number or error code */
    00B69 810E      LDD	R16,Y+6
    00B6A 811F      LDD	R17,Y+7
    00B6B 8528      LDD	R18,Y+8
    00B6C 8539      LDD	R19,Y+9
    00B6D 9666      ADIW	R28,0x16
    00B6E 940E 48A8 CALL	pop_xgsetF0FC
    00B70 9622      ADIW	R28,2
    00B71 9508      RET
ff.c:clmt_clust:
  tbl                  --> R10
  cl                   --> Y,+4
  ncl                  --> Y,+0
  ofs                  --> Y,+12
  fp                   --> R12
    00B72 933A      ST	-Y,R19
    00B73 932A      ST	-Y,R18
    00B74 940E 48B9 CALL	push_xgset003C
    00B76 0168      MOVW	R12,R16
    00B77 9728      SBIW	R28,0x8
(1027) }
(1028) #endif /* !_FS_READONLY */
(1029) 
(1030) 
(1031) 
(1032) /*-----------------------------------------------------------------------*/
(1033) /* FAT handling - Convert offset into cluster with link map table        */
(1034) /*-----------------------------------------------------------------------*/
(1035) 
(1036) #if _USE_FASTSEEK
(1037) static
(1038) DWORD clmt_clust (	/* <2:Error, >=2:Cluster number */
(1039) 	FIL* fp,		/* Pointer to the file object */
(1040) 	DWORD ofs		/* File offset to be converted to cluster# */
(1041) )
(1042) {
(1043) 	DWORD cl, ncl, *tbl;
(1044) 
(1045) 
(1046) 	tbl = fp->cltbl + 1;	/* Top of CLMT */
    00B78 01F6      MOVW	R30,R12
    00B79 96B0      ADIW	R30,0x20
    00B7A 8180      LD	R24,Z
    00B7B 8191      LDD	R25,Z+1
    00B7C 9604      ADIW	R24,4
    00B7D 015C      MOVW	R10,R24
(1047) 	cl = ofs / SS(fp->fs) / fp->fs->csize;	/* Cluster order from top of the file */
    00B7E E089      LDI	R24,0x9
    00B7F E090      LDI	R25,0
    00B80 850C      LDD	R16,Y+12
    00B81 851D      LDD	R17,Y+13
    00B82 852E      LDD	R18,Y+14
    00B83 853F      LDD	R19,Y+15
    00B84 938A      ST	-Y,R24
    00B85 940E 4957 CALL	lsr32
    00B87 01F6      MOVW	R30,R12
    00B88 93AF      PUSH	R26
    00B89 93BF      PUSH	R27
    00B8A 81A0      LD	R26,Z
    00B8B 81B1      LDD	R27,Z+1
    00B8C 01FD      MOVW	R30,R26
    00B8D 91BF      POP	R27
    00B8E 91AF      POP	R26
    00B8F 9632      ADIW	R30,2
    00B90 8020      LD	R2,Z
    00B91 2433      CLR	R3
    00B92 2444      CLR	R4
    00B93 2455      CLR	R5
    00B94 925A      ST	-Y,R5
    00B95 924A      ST	-Y,R4
    00B96 923A      ST	-Y,R3
    00B97 922A      ST	-Y,R2
    00B98 940E 47B9 CALL	div32u
    00B9A 830C      STD	Y+4,R16
    00B9B 831D      STD	Y+5,R17
    00B9C 832E      STD	Y+6,R18
    00B9D 833F      STD	Y+7,R19
(1048) 	for (;;) {
(1049) 		ncl = *tbl++;			/* Number of cluters in the fragment */
    00B9E 01F5      MOVW	R30,R10
    00B9F 9021      LD	R2,Z+
    00BA0 9031      LD	R3,Z+
    00BA1 9041      LD	R4,Z+
    00BA2 9051      LD	R5,Z+
    00BA3 015F      MOVW	R10,R30
    00BA4 8228      ST	Y,R2
    00BA5 8239      STD	Y+1,R3
    00BA6 824A      STD	Y+2,R4
    00BA7 825B      STD	Y+3,R5
(1050) 		if (!ncl) return 0;		/* End of table? (error) */
    00BA8 8028      LD	R2,Y
    00BA9 8039      LDD	R3,Y+1
    00BAA 804A      LDD	R4,Y+2
    00BAB 805B      LDD	R5,Y+3
    00BAC 9488      BCLR	0
    00BAD 2022      TST	R2
    00BAE 0432      CPC	R3,R2
    00BAF 0442      CPC	R4,R2
    00BB0 0452      CPC	R5,R2
    00BB1 F429      BNE	0x0BB7
    00BB2 E000      LDI	R16,0
    00BB3 E010      LDI	R17,0
    00BB4 E020      LDI	R18,0
    00BB5 E030      LDI	R19,0
    00BB6 C02F      RJMP	0x0BE6
(1051) 		if (cl < ncl) break;	/* In this fragment? */
    00BB7 8028      LD	R2,Y
    00BB8 8039      LDD	R3,Y+1
    00BB9 804A      LDD	R4,Y+2
    00BBA 805B      LDD	R5,Y+3
    00BBB 806C      LDD	R6,Y+4
    00BBC 807D      LDD	R7,Y+5
    00BBD 808E      LDD	R8,Y+6
    00BBE 809F      LDD	R9,Y+7
    00BBF 1462      CP	R6,R2
    00BC0 0473      CPC	R7,R3
    00BC1 0484      CPC	R8,R4
    00BC2 0495      CPC	R9,R5
    00BC3 F408      BCC	0x0BC5
    00BC4 C014      RJMP	0x0BD9
(1052) 		cl -= ncl; tbl++;		/* Next fragment */
    00BC5 8028      LD	R2,Y
    00BC6 8039      LDD	R3,Y+1
    00BC7 804A      LDD	R4,Y+2
    00BC8 805B      LDD	R5,Y+3
    00BC9 806C      LDD	R6,Y+4
    00BCA 807D      LDD	R7,Y+5
    00BCB 808E      LDD	R8,Y+6
    00BCC 809F      LDD	R9,Y+7
    00BCD 1862      SUB	R6,R2
    00BCE 0873      SBC	R7,R3
    00BCF 0884      SBC	R8,R4
    00BD0 0895      SBC	R9,R5
    00BD1 826C      STD	Y+4,R6
    00BD2 827D      STD	Y+5,R7
    00BD3 828E      STD	Y+6,R8
    00BD4 829F      STD	Y+7,R9
    00BD5 01C5      MOVW	R24,R10
    00BD6 9604      ADIW	R24,4
    00BD7 015C      MOVW	R10,R24
    00BD8 CFC5      RJMP	0x0B9E
(1053) 	}
(1054) 	return cl + *tbl;	/* Return the cluster number */
    00BD9 01F5      MOVW	R30,R10
    00BDA 8020      LD	R2,Z
    00BDB 8031      LDD	R3,Z+1
    00BDC 8042      LDD	R4,Z+2
    00BDD 8053      LDD	R5,Z+3
    00BDE 810C      LDD	R16,Y+4
    00BDF 811D      LDD	R17,Y+5
    00BE0 812E      LDD	R18,Y+6
    00BE1 813F      LDD	R19,Y+7
    00BE2 0D02      ADD	R16,R2
    00BE3 1D13      ADC	R17,R3
    00BE4 1D24      ADC	R18,R4
    00BE5 1D35      ADC	R19,R5
    00BE6 9628      ADIW	R28,0x8
    00BE7 940E 4893 CALL	pop_xgset003C
    00BE9 9622      ADIW	R28,2
    00BEA 9508      RET
ff.c:dir_sdi:
  ic                   --> R14
  clst                 --> Y,+2
  idx                  --> R12
  dj                   --> R10
    00BEB 940E 48B3 CALL	push_xgsetF0FC
    00BED 0169      MOVW	R12,R18
    00BEE 0158      MOVW	R10,R16
    00BEF 9726      SBIW	R28,6
(1055) }
(1056) #endif	/* _USE_FASTSEEK */
(1057) 
(1058) 
(1059) 
(1060) /*-----------------------------------------------------------------------*/
(1061) /* Directory handling - Set directory index                              */
(1062) /*-----------------------------------------------------------------------*/
(1063) 
(1064) static
(1065) FRESULT dir_sdi (
(1066) 	DIR *dj,		/* Pointer to directory object */
(1067) 	WORD idx		/* Directory index number */
(1068) )
(1069) {
(1070) 	DWORD clst;
(1071) 	WORD ic;
(1072) 
(1073) 
(1074) 	dj->index = idx;
    00BF0 01F5      MOVW	R30,R10
    00BF1 82D5      STD	Z+5,R13
    00BF2 82C4      STD	Z+4,R12
(1075) 	clst = dj->sclust;
    00BF3 9636      ADIW	R30,6
    00BF4 8020      LD	R2,Z
    00BF5 8031      LDD	R3,Z+1
    00BF6 8042      LDD	R4,Z+2
    00BF7 8053      LDD	R5,Z+3
    00BF8 822A      STD	Y+2,R2
    00BF9 823B      STD	Y+3,R3
    00BFA 824C      STD	Y+4,R4
    00BFB 825D      STD	Y+5,R5
(1076) 	if (clst == 1 || clst >= dj->fs->n_fatent)	/* Check start cluster range */
    00BFC E041      LDI	R20,1
    00BFD E050      LDI	R21,0
    00BFE E060      LDI	R22,0
    00BFF E070      LDI	R23,0
    00C00 802A      LDD	R2,Y+2
    00C01 803B      LDD	R3,Y+3
    00C02 804C      LDD	R4,Y+4
    00C03 805D      LDD	R5,Y+5
    00C04 1624      CP	R2,R20
    00C05 0635      CPC	R3,R21
    00C06 0646      CPC	R4,R22
    00C07 0657      CPC	R5,R23
    00C08 F089      BEQ	0x0C1A
    00C09 01F5      MOVW	R30,R10
    00C0A 81A0      LD	R26,Z
    00C0B 81B1      LDD	R27,Z+1
    00C0C 9656      ADIW	R26,0x16
    00C0D 902D      LD	R2,X+
    00C0E 903D      LD	R3,X+
    00C0F 904D      LD	R4,X+
    00C10 905C      LD	R5,X
    00C11 806A      LDD	R6,Y+2
    00C12 807B      LDD	R7,Y+3
    00C13 808C      LDD	R8,Y+4
    00C14 809D      LDD	R9,Y+5
    00C15 1462      CP	R6,R2
    00C16 0473      CPC	R7,R3
    00C17 0484      CPC	R8,R4
    00C18 0495      CPC	R9,R5
    00C19 F010      BCS	0x0C1C
(1077) 		return FR_INT_ERR;
    00C1A E002      LDI	R16,2
    00C1B C0D6      RJMP	0x0CF2
(1078) 	if (!clst && dj->fs->fs_type == FS_FAT32)	/* Replace cluster# 0 with root cluster# if in FAT32 */
    00C1C 802A      LDD	R2,Y+2
    00C1D 803B      LDD	R3,Y+3
    00C1E 804C      LDD	R4,Y+4
    00C1F 805D      LDD	R5,Y+5
    00C20 9488      BCLR	0
    00C21 2022      TST	R2
    00C22 0432      CPC	R3,R2
    00C23 0442      CPC	R4,R2
    00C24 0452      CPC	R5,R2
    00C25 F479      BNE	0x0C35
    00C26 01F5      MOVW	R30,R10
    00C27 81A0      LD	R26,Z
    00C28 81B1      LDD	R27,Z+1
    00C29 918C      LD	R24,X
    00C2A 3083      CPI	R24,3
    00C2B F449      BNE	0x0C35
(1079) 		clst = dj->fs->dirbase;
    00C2C 9692      ADIW	R26,0x22
    00C2D 902D      LD	R2,X+
    00C2E 903D      LD	R3,X+
    00C2F 904D      LD	R4,X+
    00C30 905C      LD	R5,X
    00C31 822A      STD	Y+2,R2
    00C32 823B      STD	Y+3,R3
    00C33 824C      STD	Y+4,R4
    00C34 825D      STD	Y+5,R5
(1080) 
(1081) 	if (clst == 0) {	/* Static table (root-dir in FAT12/16) */
    00C35 802A      LDD	R2,Y+2
    00C36 803B      LDD	R3,Y+3
    00C37 804C      LDD	R4,Y+4
    00C38 805D      LDD	R5,Y+5
    00C39 9488      BCLR	0
    00C3A 2022      TST	R2
    00C3B 0432      CPC	R3,R2
    00C3C 0442      CPC	R4,R2
    00C3D 0452      CPC	R5,R2
    00C3E F009      BEQ	0x0C40
    00C3F C02B      RJMP	0x0C6B
(1082) 		dj->clust = clst;
    00C40 01F5      MOVW	R30,R10
    00C41 8622      STD	Z+10,R2
    00C42 8633      STD	Z+11,R3
    00C43 8644      STD	Z+12,R4
    00C44 8655      STD	Z+13,R5
(1083) 		if (idx >= dj->fs->n_rootdir)		/* Index is out of range */
    00C45 81A0      LD	R26,Z
    00C46 81B1      LDD	R27,Z+1
    00C47 9618      ADIW	R26,0x8
    00C48 902D      LD	R2,X+
    00C49 903C      LD	R3,X
    00C4A 14C2      CP	R12,R2
    00C4B 04D3      CPC	R13,R3
    00C4C F010      BCS	0x0C4F
(1084) 			return FR_INT_ERR;
    00C4D E002      LDI	R16,2
    00C4E C0A3      RJMP	0x0CF2
(1085) 		dj->sect = dj->fs->dirbase + idx / (SS(dj->fs) / SZ_DIR);	/* Sector# */
    00C4F 0116      MOVW	R2,R12
    00C50 9436      LSR	R3
    00C51 9427      ROR	R2
    00C52 9436      LSR	R3
    00C53 9427      ROR	R2
    00C54 9436      LSR	R3
    00C55 9427      ROR	R2
    00C56 9436      LSR	R3
    00C57 9427      ROR	R2
    00C58 2444      CLR	R4
    00C59 2455      CLR	R5
    00C5A 01F5      MOVW	R30,R10
    00C5B 81A0      LD	R26,Z
    00C5C 81B1      LDD	R27,Z+1
    00C5D 9692      ADIW	R26,0x22
    00C5E 906D      LD	R6,X+
    00C5F 907D      LD	R7,X+
    00C60 908D      LD	R8,X+
    00C61 909C      LD	R9,X
    00C62 0C62      ADD	R6,R2
    00C63 1C73      ADC	R7,R3
    00C64 1C84      ADC	R8,R4
    00C65 1C95      ADC	R9,R5
    00C66 8666      STD	Z+14,R6
    00C67 8677      STD	Z+15,R7
    00C68 8A80      STD	Z+16,R8
    00C69 8A91      STD	Z+17,R9
(1086) 	}
    00C6A C076      RJMP	0x0CE1
(1087) 	else {				/* Dynamic table (sub-dirs or root-dir in FAT32) */
(1088) 		ic = SS(dj->fs) / SZ_DIR * dj->fs->csize;	/* Entries per cluster */
    00C6B 01F5      MOVW	R30,R10
    00C6C 93AF      PUSH	R26
    00C6D 93BF      PUSH	R27
    00C6E 81A0      LD	R26,Z
    00C6F 81B1      LDD	R27,Z+1
    00C70 01FD      MOVW	R30,R26
    00C71 91BF      POP	R27
    00C72 91AF      POP	R26
    00C73 8022      LDD	R2,Z+2
    00C74 E180      LDI	R24,0x10
    00C75 9D82      MUL	R24,R2
    00C76 0170      MOVW	R14,R0
    00C77 C040      RJMP	0x0CB8
(1089) 		while (idx >= ic) {	/* Follow cluster chain */
(1090) 			clst = get_fat(dj->fs, clst);				/* Get next cluster */
    00C78 802A      LDD	R2,Y+2
    00C79 803B      LDD	R3,Y+3
    00C7A 804C      LDD	R4,Y+4
    00C7B 805D      LDD	R5,Y+5
    00C7C 8248      ST	Y,R4
    00C7D 8259      STD	Y+1,R5
    00C7E 0191      MOVW	R18,R2
    00C7F 01F5      MOVW	R30,R10
    00C80 8100      LD	R16,Z
    00C81 8111      LDD	R17,Z+1
    00C82 D9B5      RCALL	_get_fat
    00C83 830A      STD	Y+2,R16
    00C84 831B      STD	Y+3,R17
    00C85 832C      STD	Y+4,R18
    00C86 833D      STD	Y+5,R19
(1091) 			if (clst == 0xFFFFFFFF) return FR_DISK_ERR;	/* Disk error */
    00C87 EF4F      LDI	R20,0xFF
    00C88 EF5F      LDI	R21,0xFF
    00C89 EF6F      LDI	R22,0xFF
    00C8A EF7F      LDI	R23,0xFF
    00C8B 802A      LDD	R2,Y+2
    00C8C 803B      LDD	R3,Y+3
    00C8D 804C      LDD	R4,Y+4
    00C8E 805D      LDD	R5,Y+5
    00C8F 1624      CP	R2,R20
    00C90 0635      CPC	R3,R21
    00C91 0646      CPC	R4,R22
    00C92 0657      CPC	R5,R23
    00C93 F411      BNE	0x0C96
    00C94 E001      LDI	R16,1
    00C95 C05C      RJMP	0x0CF2
(1092) 			if (clst < 2 || clst >= dj->fs->n_fatent)	/* Reached to end of table or int error */
    00C96 E042      LDI	R20,2
    00C97 E050      LDI	R21,0
    00C98 E060      LDI	R22,0
    00C99 E070      LDI	R23,0
    00C9A 802A      LDD	R2,Y+2
    00C9B 803B      LDD	R3,Y+3
    00C9C 804C      LDD	R4,Y+4
    00C9D 805D      LDD	R5,Y+5
    00C9E 1624      CP	R2,R20
    00C9F 0635      CPC	R3,R21
    00CA0 0646      CPC	R4,R22
    00CA1 0657      CPC	R5,R23
    00CA2 F088      BCS	0x0CB4
    00CA3 01F5      MOVW	R30,R10
    00CA4 81A0      LD	R26,Z
    00CA5 81B1      LDD	R27,Z+1
    00CA6 9656      ADIW	R26,0x16
    00CA7 902D      LD	R2,X+
    00CA8 903D      LD	R3,X+
    00CA9 904D      LD	R4,X+
    00CAA 905C      LD	R5,X
    00CAB 806A      LDD	R6,Y+2
    00CAC 807B      LDD	R7,Y+3
    00CAD 808C      LDD	R8,Y+4
    00CAE 809D      LDD	R9,Y+5
    00CAF 1462      CP	R6,R2
    00CB0 0473      CPC	R7,R3
    00CB1 0484      CPC	R8,R4
    00CB2 0495      CPC	R9,R5
    00CB3 F010      BCS	0x0CB6
(1093) 				return FR_INT_ERR;
    00CB4 E002      LDI	R16,2
    00CB5 C03C      RJMP	0x0CF2
(1094) 			idx -= ic;
    00CB6 18CE      SUB	R12,R14
    00CB7 08DF      SBC	R13,R15
    00CB8 14CE      CP	R12,R14
    00CB9 04DF      CPC	R13,R15
    00CBA F008      BCS	0x0CBC
    00CBB CFBC      RJMP	0x0C78
(1095) 		}
(1096) 		dj->clust = clst;
    00CBC 802A      LDD	R2,Y+2
    00CBD 803B      LDD	R3,Y+3
    00CBE 804C      LDD	R4,Y+4
    00CBF 805D      LDD	R5,Y+5
    00CC0 01F5      MOVW	R30,R10
    00CC1 8622      STD	Z+10,R2
    00CC2 8633      STD	Z+11,R3
    00CC3 8644      STD	Z+12,R4
    00CC4 8655      STD	Z+13,R5
(1097) 		dj->sect = clust2sect(dj->fs, clst) + idx / (SS(dj->fs) / SZ_DIR);	/* Sector# */
    00CC5 8248      ST	Y,R4
    00CC6 8259      STD	Y+1,R5
    00CC7 0191      MOVW	R18,R2
    00CC8 8100      LD	R16,Z
    00CC9 8111      LDD	R17,Z+1
    00CCA D91B      RCALL	_clust2sect
    00CCB 0116      MOVW	R2,R12
    00CCC 9436      LSR	R3
    00CCD 9427      ROR	R2
    00CCE 9436      LSR	R3
    00CCF 9427      ROR	R2
    00CD0 9436      LSR	R3
    00CD1 9427      ROR	R2
    00CD2 9436      LSR	R3
    00CD3 9427      ROR	R2
    00CD4 2444      CLR	R4
    00CD5 2455      CLR	R5
    00CD6 0138      MOVW	R6,R16
    00CD7 0149      MOVW	R8,R18
    00CD8 0C62      ADD	R6,R2
    00CD9 1C73      ADC	R7,R3
    00CDA 1C84      ADC	R8,R4
    00CDB 1C95      ADC	R9,R5
    00CDC 01F5      MOVW	R30,R10
    00CDD 8666      STD	Z+14,R6
    00CDE 8677      STD	Z+15,R7
    00CDF 8A80      STD	Z+16,R8
    00CE0 8A91      STD	Z+17,R9
(1098) 	}
(1099) 
(1100) 	dj->dir = dj->fs->win + (idx % (SS(dj->fs) / SZ_DIR)) * SZ_DIR;	/* Ptr to the entry in the sector */
    00CE1 0196      MOVW	R18,R12
    00CE2 702F      ANDI	R18,0xF
    00CE3 7030      ANDI	R19,0
    00CE4 E200      LDI	R16,0x20
    00CE5 E010      LDI	R17,0
    00CE6 940E 484F CALL	empy16s
    00CE8 0118      MOVW	R2,R16
    00CE9 01F5      MOVW	R30,R10
    00CEA 8180      LD	R24,Z
    00CEB 8191      LDD	R25,Z+1
    00CEC 968E      ADIW	R24,0x2E
    00CED 0E28      ADD	R2,R24
    00CEE 1E39      ADC	R3,R25
    00CEF 8A33      STD	Z+19,R3
    00CF0 8A22      STD	Z+18,R2
(1101) 
(1102) 	return FR_OK;	/* Seek succeeded */
    00CF1 2700      CLR	R16
    00CF2 9626      ADIW	R28,6
    00CF3 940C 48A8 JMP	pop_xgsetF0FC
ff.c:dir_next:
  c                    --> R10
  clst                 --> Y,+2
  i                    --> R12
  stretch              --> R10
  dj                   --> Y,+16
    00CF5 940E 476E CALL	push_arg4
    00CF7 940E 48B3 CALL	push_xgsetF0FC
    00CF9 0159      MOVW	R10,R18
    00CFA 9726      SBIW	R28,6
(1103) }
(1104) 
(1105) 
(1106) 
(1107) 
(1108) /*-----------------------------------------------------------------------*/
(1109) /* Directory handling - Move directory index next                        */
(1110) /*-----------------------------------------------------------------------*/
(1111) 
(1112) static
(1113) FRESULT dir_next (	/* FR_OK:Succeeded, FR_NO_FILE:End of table, FR_DENIED:EOT and could not stretch */
(1114) 	DIR *dj,		/* Pointer to directory object */
(1115) 	int stretch		/* 0: Do not stretch table, 1: Stretch table if needed */
(1116) )
(1117) {
(1118) 	DWORD clst;
(1119) 	WORD i;
(1120) 
(1121) 
(1122) 	stretch = stretch;		/* To suppress warning on read-only cfg. */
(1123) 	i = dj->index + 1;
    00CFB 89E8      LDD	R30,Y+16
    00CFC 89F9      LDD	R31,Y+17
    00CFD 8184      LDD	R24,Z+4
    00CFE 8195      LDD	R25,Z+5
    00CFF 9601      ADIW	R24,1
    00D00 016C      MOVW	R12,R24
(1124) 	if (!i || !dj->sect)	/* Report EOT when index has reached 65535 */
    00D01 3080      CPI	R24,0
    00D02 0789      CPC	R24,R25
    00D03 F059      BEQ	0x0D0F
    00D04 963E      ADIW	R30,0xE
    00D05 8020      LD	R2,Z
    00D06 8031      LDD	R3,Z+1
    00D07 8042      LDD	R4,Z+2
    00D08 8053      LDD	R5,Z+3
    00D09 9488      BCLR	0
    00D0A 2022      TST	R2
    00D0B 0432      CPC	R3,R2
    00D0C 0442      CPC	R4,R2
    00D0D 0452      CPC	R5,R2
    00D0E F411      BNE	0x0D11
(1125) 		return FR_NO_FILE;
    00D0F E004      LDI	R16,4
    00D10 C18D      RJMP	0x0E9E
(1126) 
(1127) 	if (!(i % (SS(dj->fs) / SZ_DIR))) {	/* Sector changed? */
    00D11 01C6      MOVW	R24,R12
    00D12 708F      ANDI	R24,0xF
    00D13 7090      ANDI	R25,0
    00D14 3080      CPI	R24,0
    00D15 0789      CPC	R24,R25
    00D16 F009      BEQ	0x0D18
    00D17 C170      RJMP	0x0E88
(1128) 		dj->sect++;					/* Next sector */
    00D18 8988      LDD	R24,Y+16
    00D19 8999      LDD	R25,Y+17
    00D1A 960E      ADIW	R24,0xE
    00D1B E041      LDI	R20,1
    00D1C E050      LDI	R21,0
    00D1D E060      LDI	R22,0
    00D1E E070      LDI	R23,0
    00D1F 01FC      MOVW	R30,R24
    00D20 8020      LD	R2,Z
    00D21 8031      LDD	R3,Z+1
    00D22 8042      LDD	R4,Z+2
    00D23 8053      LDD	R5,Z+3
    00D24 0E24      ADD	R2,R20
    00D25 1E35      ADC	R3,R21
    00D26 1E46      ADC	R4,R22
    00D27 1E57      ADC	R5,R23
    00D28 8220      ST	Z,R2
    00D29 8231      STD	Z+1,R3
    00D2A 8242      STD	Z+2,R4
    00D2B 8253      STD	Z+3,R5
(1129) 
(1130) 		if (dj->clust == 0) {	/* Static table */
    00D2C 89E8      LDD	R30,Y+16
    00D2D 89F9      LDD	R31,Y+17
    00D2E 963A      ADIW	R30,0xA
    00D2F 8020      LD	R2,Z
    00D30 8031      LDD	R3,Z+1
    00D31 8042      LDD	R4,Z+2
    00D32 8053      LDD	R5,Z+3
    00D33 9488      BCLR	0
    00D34 2022      TST	R2
    00D35 0432      CPC	R3,R2
    00D36 0442      CPC	R4,R2
    00D37 0452      CPC	R5,R2
    00D38 F469      BNE	0x0D46
(1131) 			if (i >= dj->fs->n_rootdir)	/* Report EOT when end of table */
    00D39 89E8      LDD	R30,Y+16
    00D3A 89F9      LDD	R31,Y+17
    00D3B 81A0      LD	R26,Z
    00D3C 81B1      LDD	R27,Z+1
    00D3D 9618      ADIW	R26,0x8
    00D3E 902D      LD	R2,X+
    00D3F 903C      LD	R3,X
    00D40 14C2      CP	R12,R2
    00D41 04D3      CPC	R13,R3
    00D42 F408      BCC	0x0D44
    00D43 C144      RJMP	0x0E88
(1132) 				return FR_NO_FILE;
    00D44 E004      LDI	R16,4
    00D45 C158      RJMP	0x0E9E
(1133) 		}
(1134) 		else {					/* Dynamic table */
(1135) 			if (((i / (SS(dj->fs) / SZ_DIR)) & (dj->fs->csize - 1)) == 0) {	/* Cluster changed? */
    00D46 89E8      LDD	R30,Y+16
    00D47 89F9      LDD	R31,Y+17
    00D48 93AF      PUSH	R26
    00D49 93BF      PUSH	R27
    00D4A 81A0      LD	R26,Z
    00D4B 81B1      LDD	R27,Z+1
    00D4C 01FD      MOVW	R30,R26
    00D4D 91BF      POP	R27
    00D4E 91AF      POP	R26
    00D4F 8182      LDD	R24,Z+2
    00D50 2799      CLR	R25
    00D51 9701      SBIW	R24,1
    00D52 0116      MOVW	R2,R12
    00D53 9436      LSR	R3
    00D54 9427      ROR	R2
    00D55 9436      LSR	R3
    00D56 9427      ROR	R2
    00D57 9436      LSR	R3
    00D58 9427      ROR	R2
    00D59 9436      LSR	R3
    00D5A 9427      ROR	R2
    00D5B 2228      AND	R2,R24
    00D5C 2239      AND	R3,R25
    00D5D 2022      TST	R2
    00D5E F009      BEQ	0x0D60
    00D5F C128      RJMP	0x0E88
    00D60 2033      TST	R3
    00D61 F009      BEQ	0x0D63
    00D62 C125      RJMP	0x0E88
(1136) 				clst = get_fat(dj->fs, dj->clust);				/* Get next cluster */
    00D63 89E8      LDD	R30,Y+16
    00D64 89F9      LDD	R31,Y+17
    00D65 8422      LDD	R2,Z+10
    00D66 8433      LDD	R3,Z+11
    00D67 8444      LDD	R4,Z+12
    00D68 8455      LDD	R5,Z+13
    00D69 8248      ST	Y,R4
    00D6A 8259      STD	Y+1,R5
    00D6B 0191      MOVW	R18,R2
    00D6C 8100      LD	R16,Z
    00D6D 8111      LDD	R17,Z+1
    00D6E D8C9      RCALL	_get_fat
    00D6F 830A      STD	Y+2,R16
    00D70 831B      STD	Y+3,R17
    00D71 832C      STD	Y+4,R18
    00D72 833D      STD	Y+5,R19
(1137) 				if (clst <= 1) return FR_INT_ERR;
    00D73 E041      LDI	R20,1
    00D74 E050      LDI	R21,0
    00D75 E060      LDI	R22,0
    00D76 E070      LDI	R23,0
    00D77 802A      LDD	R2,Y+2
    00D78 803B      LDD	R3,Y+3
    00D79 804C      LDD	R4,Y+4
    00D7A 805D      LDD	R5,Y+5
    00D7B 1542      CP	R20,R2
    00D7C 0553      CPC	R21,R3
    00D7D 0564      CPC	R22,R4
    00D7E 0575      CPC	R23,R5
    00D7F F010      BCS	0x0D82
    00D80 E002      LDI	R16,2
    00D81 C11C      RJMP	0x0E9E
(1138) 				if (clst == 0xFFFFFFFF) return FR_DISK_ERR;
    00D82 EF4F      LDI	R20,0xFF
    00D83 EF5F      LDI	R21,0xFF
    00D84 EF6F      LDI	R22,0xFF
    00D85 EF7F      LDI	R23,0xFF
    00D86 802A      LDD	R2,Y+2
    00D87 803B      LDD	R3,Y+3
    00D88 804C      LDD	R4,Y+4
    00D89 805D      LDD	R5,Y+5
    00D8A 1624      CP	R2,R20
    00D8B 0635      CPC	R3,R21
    00D8C 0646      CPC	R4,R22
    00D8D 0657      CPC	R5,R23
    00D8E F411      BNE	0x0D91
    00D8F E001      LDI	R16,1
    00D90 C10D      RJMP	0x0E9E
(1139) 				if (clst >= dj->fs->n_fatent) {					/* When it reached end of dynamic table */
    00D91 89E8      LDD	R30,Y+16
    00D92 89F9      LDD	R31,Y+17
    00D93 81A0      LD	R26,Z
    00D94 81B1      LDD	R27,Z+1
    00D95 9656      ADIW	R26,0x16
    00D96 902D      LD	R2,X+
    00D97 903D      LD	R3,X+
    00D98 904D      LD	R4,X+
    00D99 905C      LD	R5,X
    00D9A 806A      LDD	R6,Y+2
    00D9B 807B      LDD	R7,Y+3
    00D9C 808C      LDD	R8,Y+4
    00D9D 809D      LDD	R9,Y+5
    00D9E 1462      CP	R6,R2
    00D9F 0473      CPC	R7,R3
    00DA0 0484      CPC	R8,R4
    00DA1 0495      CPC	R9,R5
    00DA2 F408      BCC	0x0DA4
    00DA3 C0CD      RJMP	0x0E71
(1140) #if !_FS_READONLY
(1141) 					BYTE c;
(1142) 					if (!stretch) return FR_NO_FILE;			/* When do not stretch, report EOT */
    00DA4 20AA      TST	R10
    00DA5 F421      BNE	0x0DAA
    00DA6 20BB      TST	R11
    00DA7 F411      BNE	0x0DAA
    00DA8 E004      LDI	R16,4
    00DA9 C0F4      RJMP	0x0E9E
(1143) 					clst = create_chain(dj->fs, dj->clust);		/* Stretch cluster chain */
    00DAA 89E8      LDD	R30,Y+16
    00DAB 89F9      LDD	R31,Y+17
    00DAC 8422      LDD	R2,Z+10
    00DAD 8433      LDD	R3,Z+11
    00DAE 8444      LDD	R4,Z+12
    00DAF 8455      LDD	R5,Z+13
    00DB0 8248      ST	Y,R4
    00DB1 8259      STD	Y+1,R5
    00DB2 0191      MOVW	R18,R2
    00DB3 8100      LD	R16,Z
    00DB4 8111      LDD	R17,Z+1
    00DB5 DC44      RCALL	ff.c:create_chain
    00DB6 830A      STD	Y+2,R16
    00DB7 831B      STD	Y+3,R17
    00DB8 832C      STD	Y+4,R18
    00DB9 833D      STD	Y+5,R19
(1144) 					if (clst == 0) return FR_DENIED;			/* No free cluster */
    00DBA 802A      LDD	R2,Y+2
    00DBB 803B      LDD	R3,Y+3
    00DBC 804C      LDD	R4,Y+4
    00DBD 805D      LDD	R5,Y+5
    00DBE 9488      BCLR	0
    00DBF 2022      TST	R2
    00DC0 0432      CPC	R3,R2
    00DC1 0442      CPC	R4,R2
    00DC2 0452      CPC	R5,R2
    00DC3 F411      BNE	0x0DC6
    00DC4 E007      LDI	R16,7
    00DC5 C0D8      RJMP	0x0E9E
(1145) 					if (clst == 1) return FR_INT_ERR;
    00DC6 E041      LDI	R20,1
    00DC7 E050      LDI	R21,0
    00DC8 E060      LDI	R22,0
    00DC9 E070      LDI	R23,0
    00DCA 802A      LDD	R2,Y+2
    00DCB 803B      LDD	R3,Y+3
    00DCC 804C      LDD	R4,Y+4
    00DCD 805D      LDD	R5,Y+5
    00DCE 1624      CP	R2,R20
    00DCF 0635      CPC	R3,R21
    00DD0 0646      CPC	R4,R22
    00DD1 0657      CPC	R5,R23
    00DD2 F411      BNE	0x0DD5
    00DD3 E002      LDI	R16,2
    00DD4 C0C9      RJMP	0x0E9E
(1146) 					if (clst == 0xFFFFFFFF) return FR_DISK_ERR;
    00DD5 EF4F      LDI	R20,0xFF
    00DD6 EF5F      LDI	R21,0xFF
    00DD7 EF6F      LDI	R22,0xFF
    00DD8 EF7F      LDI	R23,0xFF
    00DD9 802A      LDD	R2,Y+2
    00DDA 803B      LDD	R3,Y+3
    00DDB 804C      LDD	R4,Y+4
    00DDC 805D      LDD	R5,Y+5
    00DDD 1624      CP	R2,R20
    00DDE 0635      CPC	R3,R21
    00DDF 0646      CPC	R4,R22
    00DE0 0657      CPC	R5,R23
    00DE1 F411      BNE	0x0DE4
    00DE2 E001      LDI	R16,1
    00DE3 C0BA      RJMP	0x0E9E
(1147) 					/* Clean-up stretched table */
(1148) 					if (move_window(dj->fs, 0)) return FR_DISK_ERR;	/* Flush active window */
    00DE4 E040      LDI	R20,0
    00DE5 E050      LDI	R21,0
    00DE6 E060      LDI	R22,0
    00DE7 E070      LDI	R23,0
    00DE8 8368      ST	Y,R22
    00DE9 8379      STD	Y+1,R23
    00DEA 019A      MOVW	R18,R20
    00DEB 89E8      LDD	R30,Y+16
    00DEC 89F9      LDD	R31,Y+17
    00DED 8100      LD	R16,Z
    00DEE 8111      LDD	R17,Z+1
    00DEF 940E 046F CALL	ff.c:move_window
    00DF1 2300      TST	R16
    00DF2 F011      BEQ	0x0DF5
    00DF3 E001      LDI	R16,1
    00DF4 C0A9      RJMP	0x0E9E
(1149) 					mem_set(dj->fs->win, 0, SS(dj->fs));			/* Clear window buffer */
    00DF5 E080      LDI	R24,0
    00DF6 E092      LDI	R25,2
    00DF7 8399      STD	Y+1,R25
    00DF8 8388      ST	Y,R24
    00DF9 2722      CLR	R18
    00DFA 2733      CLR	R19
    00DFB 89E8      LDD	R30,Y+16
    00DFC 89F9      LDD	R31,Y+17
    00DFD 8100      LD	R16,Z
    00DFE 8111      LDD	R17,Z+1
    00DFF 5D02      SUBI	R16,0xD2
    00E00 4F1F      SBCI	R17,0xFF
    00E01 940E 042C CALL	ff.c:mem_set
(1150) 					dj->fs->winsect = clust2sect(dj->fs, clst);	/* Cluster start sector */
    00E03 802A      LDD	R2,Y+2
    00E04 803B      LDD	R3,Y+3
    00E05 804C      LDD	R4,Y+4
    00E06 805D      LDD	R5,Y+5
    00E07 8248      ST	Y,R4
    00E08 8259      STD	Y+1,R5
    00E09 0191      MOVW	R18,R2
    00E0A 89E8      LDD	R30,Y+16
    00E0B 89F9      LDD	R31,Y+17
    00E0C 80A0      LD	R10,Z
    00E0D 80B1      LDD	R11,Z+1
    00E0E 0185      MOVW	R16,R10
    00E0F 940E 05E6 CALL	_clust2sect
    00E11 01F5      MOVW	R30,R10
    00E12 A702      STD	Z+42,R16
    00E13 A713      STD	Z+43,R17
    00E14 A724      STD	Z+44,R18
    00E15 A735      STD	Z+45,R19
(1151) 					for (c = 0; c < dj->fs->csize; c++) {		/* Fill the new cluster with 0 */
    00E16 24AA      CLR	R10
    00E17 C035      RJMP	0x0E4D
(1152) 						dj->fs->wflag = 1;
    00E18 E081      LDI	R24,1
    00E19 89E8      LDD	R30,Y+16
    00E1A 89F9      LDD	R31,Y+17
    00E1B 93AF      PUSH	R26
    00E1C 93BF      PUSH	R27
    00E1D 81A0      LD	R26,Z
    00E1E 81B1      LDD	R27,Z+1
    00E1F 01FD      MOVW	R30,R26
    00E20 91BF      POP	R27
    00E21 91AF      POP	R26
    00E22 8384      STD	Z+4,R24
(1153) 						if (move_window(dj->fs, 0)) return FR_DISK_ERR;
    00E23 E040      LDI	R20,0
    00E24 E050      LDI	R21,0
    00E25 E060      LDI	R22,0
    00E26 E070      LDI	R23,0
    00E27 8368      ST	Y,R22
    00E28 8379      STD	Y+1,R23
    00E29 019A      MOVW	R18,R20
    00E2A 89E8      LDD	R30,Y+16
    00E2B 89F9      LDD	R31,Y+17
    00E2C 8100      LD	R16,Z
    00E2D 8111      LDD	R17,Z+1
    00E2E 940E 046F CALL	ff.c:move_window
    00E30 2EE0      MOV	R14,R16
    00E31 2300      TST	R16
    00E32 F011      BEQ	0x0E35
    00E33 E001      LDI	R16,1
    00E34 C069      RJMP	0x0E9E
(1154) 						dj->fs->winsect++;
    00E35 89E8      LDD	R30,Y+16
    00E36 89F9      LDD	R31,Y+17
    00E37 8180      LD	R24,Z
    00E38 8191      LDD	R25,Z+1
    00E39 968A      ADIW	R24,0x2A
    00E3A 017C      MOVW	R14,R24
    00E3B E041      LDI	R20,1
    00E3C E050      LDI	R21,0
    00E3D E060      LDI	R22,0
    00E3E E070      LDI	R23,0
    00E3F 01FC      MOVW	R30,R24
    00E40 8020      LD	R2,Z
    00E41 8031      LDD	R3,Z+1
    00E42 8042      LDD	R4,Z+2
    00E43 8053      LDD	R5,Z+3
    00E44 0E24      ADD	R2,R20
    00E45 1E35      ADC	R3,R21
    00E46 1E46      ADC	R4,R22
    00E47 1E57      ADC	R5,R23
    00E48 8220      ST	Z,R2
    00E49 8231      STD	Z+1,R3
    00E4A 8242      STD	Z+2,R4
    00E4B 8253      STD	Z+3,R5
    00E4C 94A3      INC	R10
    00E4D 89E8      LDD	R30,Y+16
    00E4E 89F9      LDD	R31,Y+17
    00E4F 93AF      PUSH	R26
    00E50 93BF      PUSH	R27
    00E51 81A0      LD	R26,Z
    00E52 81B1      LDD	R27,Z+1
    00E53 01FD      MOVW	R30,R26
    00E54 91BF      POP	R27
    00E55 91AF      POP	R26
    00E56 8022      LDD	R2,Z+2
    00E57 14A2      CP	R10,R2
    00E58 F408      BCC	0x0E5A
    00E59 CFBE      RJMP	0x0E18
(1155) 					}
(1156) 					dj->fs->winsect -= c;						/* Rewind window address */
    00E5A 89E8      LDD	R30,Y+16
    00E5B 89F9      LDD	R31,Y+17
    00E5C 8180      LD	R24,Z
    00E5D 8191      LDD	R25,Z+1
    00E5E 968A      ADIW	R24,0x2A
    00E5F 017C      MOVW	R14,R24
    00E60 2C2A      MOV	R2,R10
    00E61 2433      CLR	R3
    00E62 2444      CLR	R4
    00E63 2455      CLR	R5
    00E64 01FC      MOVW	R30,R24
    00E65 8060      LD	R6,Z
    00E66 8071      LDD	R7,Z+1
    00E67 8082      LDD	R8,Z+2
    00E68 8093      LDD	R9,Z+3
    00E69 1862      SUB	R6,R2
    00E6A 0873      SBC	R7,R3
    00E6B 0884      SBC	R8,R4
    00E6C 0895      SBC	R9,R5
    00E6D 8260      ST	Z,R6
    00E6E 8271      STD	Z+1,R7
    00E6F 8282      STD	Z+2,R8
    00E70 8293      STD	Z+3,R9
(1157) #else
(1158) 					return FR_NO_FILE;			/* Report EOT */
(1159) #endif
(1160) 				}
(1161) 				dj->clust = clst;				/* Initialize data for new cluster */
    00E71 802A      LDD	R2,Y+2
    00E72 803B      LDD	R3,Y+3
    00E73 804C      LDD	R4,Y+4
    00E74 805D      LDD	R5,Y+5
    00E75 89E8      LDD	R30,Y+16
    00E76 89F9      LDD	R31,Y+17
    00E77 8622      STD	Z+10,R2
    00E78 8633      STD	Z+11,R3
    00E79 8644      STD	Z+12,R4
    00E7A 8655      STD	Z+13,R5
(1162) 				dj->sect = clust2sect(dj->fs, clst);
    00E7B 8248      ST	Y,R4
    00E7C 8259      STD	Y+1,R5
    00E7D 0191      MOVW	R18,R2
    00E7E 8100      LD	R16,Z
    00E7F 8111      LDD	R17,Z+1
    00E80 940E 05E6 CALL	_clust2sect
    00E82 89E8      LDD	R30,Y+16
    00E83 89F9      LDD	R31,Y+17
    00E84 8706      STD	Z+14,R16
    00E85 8717      STD	Z+15,R17
    00E86 8B20      STD	Z+16,R18
    00E87 8B31      STD	Z+17,R19
(1163) 			}
(1164) 		}
(1165) 	}
(1166) 
(1167) 	dj->index = i;
    00E88 89E8      LDD	R30,Y+16
    00E89 89F9      LDD	R31,Y+17
    00E8A 82D5      STD	Z+5,R13
    00E8B 82C4      STD	Z+4,R12
(1168) 	dj->dir = dj->fs->win + (i % (SS(dj->fs) / SZ_DIR)) * SZ_DIR;
    00E8C 0196      MOVW	R18,R12
    00E8D 702F      ANDI	R18,0xF
    00E8E 7030      ANDI	R19,0
    00E8F E200      LDI	R16,0x20
    00E90 E010      LDI	R17,0
    00E91 940E 484F CALL	empy16s
    00E93 0118      MOVW	R2,R16
    00E94 89E8      LDD	R30,Y+16
    00E95 89F9      LDD	R31,Y+17
    00E96 8180      LD	R24,Z
    00E97 8191      LDD	R25,Z+1
    00E98 968E      ADIW	R24,0x2E
    00E99 0E28      ADD	R2,R24
    00E9A 1E39      ADC	R3,R25
    00E9B 8A33      STD	Z+19,R3
    00E9C 8A22      STD	Z+18,R2
(1169) 
(1170) 	return FR_OK;
    00E9D 2700      CLR	R16
    00E9E 9626      ADIW	R28,6
    00E9F 940E 48A8 CALL	pop_xgsetF0FC
    00EA1 9624      ADIW	R28,4
    00EA2 9508      RET
ff.c:dir_find:
  c                    --> R12
  dir                  --> R10
  res                  --> R20
  dj                   --> R22
    00EA3 940E 48EE CALL	push_xgsetF03C
    00EA5 01B8      MOVW	R22,R16
    00EA6 9722      SBIW	R28,2
(1171) }
(1172) 
(1173) 
(1174) 
(1175) 
(1176) /*-----------------------------------------------------------------------*/
(1177) /* LFN handling - Test/Pick/Fit an LFN segment from/to directory entry   */
(1178) /*-----------------------------------------------------------------------*/
(1179) #if _USE_LFN
(1180) static
(1181) const BYTE LfnOfs[] = {1,3,5,7,9,14,16,18,20,22,24,28,30};	/* Offset of LFN chars in the directory entry */
(1182) 
(1183) 
(1184) static
(1185) int cmp_lfn (			/* 1:Matched, 0:Not matched */
(1186) 	WCHAR *lfnbuf,		/* Pointer to the LFN to be compared */
(1187) 	BYTE *dir			/* Pointer to the directory entry containing a part of LFN */
(1188) )
(1189) {
(1190) 	UINT i, s;
(1191) 	WCHAR wc, uc;
(1192) 
(1193) 
(1194) 	i = ((dir[LDIR_Ord] & ~LLE) - 1) * 13;	/* Get offset in the LFN buffer */
(1195) 	s = 0; wc = 1;
(1196) 	do {
(1197) 		uc = LD_WORD(dir+LfnOfs[s]);	/* Pick an LFN character from the entry */
(1198) 		if (wc) {	/* Last char has not been processed */
(1199) 			wc = ff_wtoupper(uc);		/* Convert it to upper case */
(1200) 			if (i >= _MAX_LFN || wc != ff_wtoupper(lfnbuf[i++]))	/* Compare it */
(1201) 				return 0;				/* Not matched */
(1202) 		} else {
(1203) 			if (uc != 0xFFFF) return 0;	/* Check filler */
(1204) 		}
(1205) 	} while (++s < 13);				/* Repeat until all chars in the entry are checked */
(1206) 
(1207) 	if ((dir[LDIR_Ord] & LLE) && wc && lfnbuf[i])	/* Last segment matched but different length */
(1208) 		return 0;
(1209) 
(1210) 	return 1;						/* The part of LFN matched */
(1211) }
(1212) 
(1213) 
(1214) 
(1215) static
(1216) int pick_lfn (			/* 1:Succeeded, 0:Buffer overflow */
(1217) 	WCHAR *lfnbuf,		/* Pointer to the Unicode-LFN buffer */
(1218) 	BYTE *dir			/* Pointer to the directory entry */
(1219) )
(1220) {
(1221) 	UINT i, s;
(1222) 	WCHAR wc, uc;
(1223) 
(1224) 
(1225) 	i = ((dir[LDIR_Ord] & 0x3F) - 1) * 13;	/* Offset in the LFN buffer */
(1226) 
(1227) 	s = 0; wc = 1;
(1228) 	do {
(1229) 		uc = LD_WORD(dir+LfnOfs[s]);		/* Pick an LFN character from the entry */
(1230) 		if (wc) {	/* Last char has not been processed */
(1231) 			if (i >= _MAX_LFN) return 0;	/* Buffer overflow? */
(1232) 			lfnbuf[i++] = wc = uc;			/* Store it */
(1233) 		} else {
(1234) 			if (uc != 0xFFFF) return 0;		/* Check filler */
(1235) 		}
(1236) 	} while (++s < 13);						/* Read all character in the entry */
(1237) 
(1238) 	if (dir[LDIR_Ord] & LLE) {				/* Put terminator if it is the last LFN part */
(1239) 		if (i >= _MAX_LFN) return 0;		/* Buffer overflow? */
(1240) 		lfnbuf[i] = 0;
(1241) 	}
(1242) 
(1243) 	return 1;
(1244) }
(1245) 
(1246) 
(1247) #if !_FS_READONLY
(1248) static
(1249) void fit_lfn (
(1250) 	const WCHAR *lfnbuf,	/* Pointer to the LFN buffer */
(1251) 	BYTE *dir,				/* Pointer to the directory entry */
(1252) 	BYTE ord,				/* LFN order (1-20) */
(1253) 	BYTE sum				/* SFN sum */
(1254) )
(1255) {
(1256) 	UINT i, s;
(1257) 	WCHAR wc;
(1258) 
(1259) 
(1260) 	dir[LDIR_Chksum] = sum;			/* Set check sum */
(1261) 	dir[LDIR_Attr] = AM_LFN;		/* Set attribute. LFN entry */
(1262) 	dir[LDIR_Type] = 0;
(1263) 	ST_WORD(dir+LDIR_FstClusLO, 0);
(1264) 
(1265) 	i = (ord - 1) * 13;				/* Get offset in the LFN buffer */
(1266) 	s = wc = 0;
(1267) 	do {
(1268) 		if (wc != 0xFFFF) wc = lfnbuf[i++];	/* Get an effective char */
(1269) 		ST_WORD(dir+LfnOfs[s], wc);	/* Put it */
(1270) 		if (!wc) wc = 0xFFFF;		/* Padding chars following last char */
(1271) 	} while (++s < 13);
(1272) 	if (wc == 0xFFFF || !lfnbuf[i]) ord |= LLE;	/* Bottom LFN part is the start of LFN sequence */
(1273) 	dir[LDIR_Ord] = ord;			/* Set the LFN order */
(1274) }
(1275) 
(1276) #endif
(1277) #endif
(1278) 
(1279) 
(1280) 
(1281) /*-----------------------------------------------------------------------*/
(1282) /* Create numbered name                                                  */
(1283) /*-----------------------------------------------------------------------*/
(1284) #if _USE_LFN
(1285) void gen_numname (
(1286) 	BYTE *dst,			/* Pointer to generated SFN */
(1287) 	const BYTE *src,	/* Pointer to source SFN to be modified */
(1288) 	const WCHAR *lfn,	/* Pointer to LFN */
(1289) 	WORD seq			/* Sequence number */
(1290) )
(1291) {
(1292) 	BYTE ns[8], c;
(1293) 	UINT i, j;
(1294) 
(1295) 
(1296) 	mem_cpy(dst, src, 11);
(1297) 
(1298) 	if (seq > 5) {	/* On many collisions, generate a hash number instead of sequential number */
(1299) 		do seq = (seq >> 1) + (seq << 15) + (WORD)*lfn++; while (*lfn);
(1300) 	}
(1301) 
(1302) 	/* itoa (hexdecimal) */
(1303) 	i = 7;
(1304) 	do {
(1305) 		c = (seq % 16) + '0';
(1306) 		if (c > '9') c += 7;
(1307) 		ns[i--] = c;
(1308) 		seq /= 16;
(1309) 	} while (seq);
(1310) 	ns[i] = '~';
(1311) 
(1312) 	/* Append the number */
(1313) 	for (j = 0; j < i && dst[j] != ' '; j++) {
(1314) 		if (IsDBCS1(dst[j])) {
(1315) 			if (j == i - 1) break;
(1316) 			j++;
(1317) 		}
(1318) 	}
(1319) 	do {
(1320) 		dst[j++] = (i < 8) ? ns[i++] : ' ';
(1321) 	} while (j < 8);
(1322) }
(1323) #endif
(1324) 
(1325) 
(1326) 
(1327) 
(1328) /*-----------------------------------------------------------------------*/
(1329) /* Calculate sum of an SFN                                               */
(1330) /*-----------------------------------------------------------------------*/
(1331) #if _USE_LFN
(1332) static
(1333) BYTE sum_sfn (
(1334) 	const BYTE *dir		/* Ptr to directory entry */
(1335) )
(1336) {
(1337) 	BYTE sum = 0;
(1338) 	UINT n = 11;
(1339) 
(1340) 	do sum = (sum >> 1) + (sum << 7) + *dir++; while (--n);
(1341) 	return sum;
(1342) }
(1343) #endif
(1344) 
(1345) 
(1346) 
(1347) 
(1348) /*-----------------------------------------------------------------------*/
(1349) /* Directory handling - Find an object in the directory                  */
(1350) /*-----------------------------------------------------------------------*/
(1351) 
(1352) static
(1353) FRESULT dir_find (
(1354) 	DIR *dj			/* Pointer to the directory object linked to the file name */
(1355) )
(1356) {
(1357) 	FRESULT res;
(1358) 	BYTE c, *dir;
(1359) #if _USE_LFN
(1360) 	BYTE a, ord, sum;
(1361) #endif
(1362) 
(1363) 	res = dir_sdi(dj, 0);			/* Rewind directory object */
    00EA7 2722      CLR	R18
    00EA8 2733      CLR	R19
    00EA9 018B      MOVW	R16,R22
    00EAA DD40      RCALL	ff.c:dir_sdi
    00EAB 2F40      MOV	R20,R16
(1364) 	if (res != FR_OK) return res;
    00EAC 2300      TST	R16
    00EAD F009      BEQ	0x0EAF
    00EAE C036      RJMP	0x0EE5
(1365) 
(1366) #if _USE_LFN
(1367) 	ord = sum = 0xFF;
(1368) #endif
(1369) 	do {
(1370) 		res = move_window(dj->fs, dj->sect);
    00EAF 01FB      MOVW	R30,R22
    00EB0 8426      LDD	R2,Z+14
    00EB1 8437      LDD	R3,Z+15
    00EB2 8840      LDD	R4,Z+16
    00EB3 8851      LDD	R5,Z+17
    00EB4 8248      ST	Y,R4
    00EB5 8259      STD	Y+1,R5
    00EB6 0191      MOVW	R18,R2
    00EB7 8100      LD	R16,Z
    00EB8 8111      LDD	R17,Z+1
    00EB9 940E 046F CALL	ff.c:move_window
    00EBB 2F40      MOV	R20,R16
(1371) 		if (res != FR_OK) break;
    00EBC 2300      TST	R16
    00EBD F009      BEQ	0x0EBF
    00EBE C025      RJMP	0x0EE4
(1372) 		dir = dj->dir;					/* Ptr to the directory entry of current index */
    00EBF 01FB      MOVW	R30,R22
    00EC0 88A2      LDD	R10,Z+18
    00EC1 88B3      LDD	R11,Z+19
(1373) 		c = dir[DIR_Name];
    00EC2 01F5      MOVW	R30,R10
    00EC3 80C0      LD	R12,Z
(1374) 		if (c == 0) { res = FR_NO_FILE; break; }	/* Reached to end of table */
    00EC4 20CC      TST	R12
    00EC5 F411      BNE	0x0EC8
    00EC6 E044      LDI	R20,4
    00EC7 C01C      RJMP	0x0EE4
(1375) #if _USE_LFN	/* LFN configuration */
(1376) 		a = dir[DIR_Attr] & AM_MASK;
(1377) 		if (c == DDE || ((a & AM_VOL) && a != AM_LFN)) {	/* An entry without valid data */
(1378) 			ord = 0xFF;
(1379) 		} else {
(1380) 			if (a == AM_LFN) {			/* An LFN entry is found */
(1381) 				if (dj->lfn) {
(1382) 					if (c & LLE) {		/* Is it start of LFN sequence? */
(1383) 						sum = dir[LDIR_Chksum];
(1384) 						c &= ~LLE; ord = c;	/* LFN start order */
(1385) 						dj->lfn_idx = dj->index;
(1386) 					}
(1387) 					/* Check validity of the LFN entry and compare it with given name */
(1388) 					ord = (c == ord && sum == dir[LDIR_Chksum] && cmp_lfn(dj->lfn, dir)) ? ord - 1 : 0xFF;
(1389) 				}
(1390) 			} else {					/* An SFN entry is found */
(1391) 				if (!ord && sum == sum_sfn(dir)) break;	/* LFN matched? */
(1392) 				ord = 0xFF; dj->lfn_idx = 0xFFFF;	/* Reset LFN sequence */
(1393) 				if (!(dj->fn[NS] & NS_LOSS) && !mem_cmp(dir, dj->fn, 11)) break;	/* SFN matched? */
(1394) 			}
(1395) 		}
(1396) #else		/* Non LFN configuration */
(1397) 		if (!(dir[DIR_Attr] & AM_VOL) && !mem_cmp(dir, dj->fn, 11)) /* Is it a valid entry? */
    00EC8 01F5      MOVW	R30,R10
    00EC9 8423      LDD	R2,Z+11
    00ECA FC23      SBRC	R2,3
    00ECB C00F      RJMP	0x0EDB
    00ECC E08B      LDI	R24,0xB
    00ECD E090      LDI	R25,0
    00ECE 8399      STD	Y+1,R25
    00ECF 8388      ST	Y,R24
    00ED0 01FB      MOVW	R30,R22
    00ED1 8924      LDD	R18,Z+20
    00ED2 8935      LDD	R19,Z+21
    00ED3 0185      MOVW	R16,R10
    00ED4 940E 043E CALL	ff.c:mem_cmp
    00ED6 0158      MOVW	R10,R16
    00ED7 3000      CPI	R16,0
    00ED8 0701      CPC	R16,R17
    00ED9 F409      BNE	0x0EDB
(1398) 			break;
    00EDA C009      RJMP	0x0EE4
(1399) #endif
(1400) 		res = dir_next(dj, 0);		/* Next entry */
    00EDB 2722      CLR	R18
    00EDC 2733      CLR	R19
    00EDD 018B      MOVW	R16,R22
    00EDE DE16      RCALL	ff.c:dir_next
    00EDF 2EA0      MOV	R10,R16
    00EE0 2D4A      MOV	R20,R10
(1401) 	} while (res == FR_OK);
    00EE1 2344      TST	R20
    00EE2 F409      BNE	0x0EE4
    00EE3 CFCB      RJMP	0x0EAF
(1402) 
(1403) 	return res;
    00EE4 2F04      MOV	R16,R20
    00EE5 9622      ADIW	R28,2
    00EE6 940C 48F7 JMP	pop_xgsetF03C
ff.c:dir_read:
  dir                  --> R10
  c                    --> R12
  res                  --> R20
  dj                   --> R22
    00EE8 940E 48EE CALL	push_xgsetF03C
    00EEA 01B8      MOVW	R22,R16
    00EEB 9722      SBIW	R28,2
(1404) }
(1405) 
(1406) 
(1407) 
(1408) 
(1409) /*-----------------------------------------------------------------------*/
(1410) /* Read an object from the directory                                     */
(1411) /*-----------------------------------------------------------------------*/
(1412) #if _FS_MINIMIZE <= 1
(1413) static
(1414) FRESULT dir_read (
(1415) 	DIR *dj			/* Pointer to the directory object that pointing the entry to be read */
(1416) )
(1417) {
(1418) 	FRESULT res;
(1419) 	BYTE c, *dir;
(1420) #if _USE_LFN
(1421) 	BYTE a, ord = 0xFF, sum = 0xFF;
(1422) #endif
(1423) 
(1424) 	res = FR_NO_FILE;
    00EEC E044      LDI	R20,4
    00EED C02B      RJMP	0x0F19
(1425) 	while (dj->sect) {
(1426) 		res = move_window(dj->fs, dj->sect);
    00EEE 01FB      MOVW	R30,R22
    00EEF 8426      LDD	R2,Z+14
    00EF0 8437      LDD	R3,Z+15
    00EF1 8840      LDD	R4,Z+16
    00EF2 8851      LDD	R5,Z+17
    00EF3 8248      ST	Y,R4
    00EF4 8259      STD	Y+1,R5
    00EF5 0191      MOVW	R18,R2
    00EF6 8100      LD	R16,Z
    00EF7 8111      LDD	R17,Z+1
    00EF8 940E 046F CALL	ff.c:move_window
    00EFA 2F40      MOV	R20,R16
(1427) 		if (res != FR_OK) break;
    00EFB 2300      TST	R16
    00EFC F009      BEQ	0x0EFE
    00EFD C028      RJMP	0x0F26
(1428) 		dir = dj->dir;					/* Ptr to the directory entry of current index */
    00EFE 01FB      MOVW	R30,R22
    00EFF 88A2      LDD	R10,Z+18
    00F00 88B3      LDD	R11,Z+19
(1429) 		c = dir[DIR_Name];
    00F01 01F5      MOVW	R30,R10
    00F02 80C0      LD	R12,Z
(1430) 		if (c == 0) { res = FR_NO_FILE; break; }	/* Reached to end of table */
    00F03 20CC      TST	R12
    00F04 F411      BNE	0x0F07
    00F05 E044      LDI	R20,4
    00F06 C01F      RJMP	0x0F26
(1431) #if _USE_LFN	/* LFN configuration */
(1432) 		a = dir[DIR_Attr] & AM_MASK;
(1433) 		if (c == DDE || (!_FS_RPATH && c == '.') || ((a & AM_VOL) && a != AM_LFN)) {	/* An entry without valid data */
(1434) 			ord = 0xFF;
(1435) 		} else {
(1436) 			if (a == AM_LFN) {			/* An LFN entry is found */
(1437) 				if (c & LLE) {			/* Is it start of LFN sequence? */
(1438) 					sum = dir[LDIR_Chksum];
(1439) 					c &= ~LLE; ord = c;
(1440) 					dj->lfn_idx = dj->index;
(1441) 				}
(1442) 				/* Check LFN validity and capture it */
(1443) 				ord = (c == ord && sum == dir[LDIR_Chksum] && pick_lfn(dj->lfn, dir)) ? ord - 1 : 0xFF;
(1444) 			} else {					/* An SFN entry is found */
(1445) 				if (ord || sum != sum_sfn(dir))	/* Is there a valid LFN? */
(1446) 					dj->lfn_idx = 0xFFFF;		/* It has no LFN. */
(1447) 				break;
(1448) 			}
(1449) 		}
(1450) #else		/* Non LFN configuration */
(1451) 		if (c != DDE && (_FS_RPATH || c != '.') && !(dir[DIR_Attr] & AM_VOL))	/* Is it a valid entry? */
    00F07 2D8C      MOV	R24,R12
    00F08 3E85      CPI	R24,0xE5
    00F09 F039      BEQ	0x0F11
    00F0A 328E      CPI	R24,0x2E
    00F0B F029      BEQ	0x0F11
    00F0C 01F5      MOVW	R30,R10
    00F0D 8423      LDD	R2,Z+11
    00F0E FC23      SBRC	R2,3
    00F0F C001      RJMP	0x0F11
(1452) 			break;
    00F10 C015      RJMP	0x0F26
(1453) #endif
(1454) 		res = dir_next(dj, 0);				/* Next entry */
    00F11 2722      CLR	R18
    00F12 2733      CLR	R19
    00F13 018B      MOVW	R16,R22
    00F14 DDE0      RCALL	ff.c:dir_next
    00F15 2F40      MOV	R20,R16
(1455) 		if (res != FR_OK) break;
    00F16 2300      TST	R16
    00F17 F009      BEQ	0x0F19
    00F18 C00D      RJMP	0x0F26
    00F19 01FB      MOVW	R30,R22
    00F1A 963E      ADIW	R30,0xE
    00F1B 8020      LD	R2,Z
    00F1C 8031      LDD	R3,Z+1
    00F1D 8042      LDD	R4,Z+2
    00F1E 8053      LDD	R5,Z+3
    00F1F 9488      BCLR	0
    00F20 2022      TST	R2
    00F21 0432      CPC	R3,R2
    00F22 0442      CPC	R4,R2
    00F23 0452      CPC	R5,R2
    00F24 F009      BEQ	0x0F26
    00F25 CFC8      RJMP	0x0EEE
(1456) 	}
(1457) 
(1458) 	if (res != FR_OK) dj->sect = 0;
    00F26 2344      TST	R20
    00F27 F039      BEQ	0x0F2F
    00F28 01FB      MOVW	R30,R22
    00F29 963E      ADIW	R30,0xE
    00F2A E080      LDI	R24,0
    00F2B 8380      ST	Z,R24
    00F2C 8381      STD	Z+1,R24
    00F2D 8382      STD	Z+2,R24
    00F2E 8383      STD	Z+3,R24
(1459) 
(1460) 	return res;
    00F2F 2F04      MOV	R16,R20
    00F30 9622      ADIW	R28,2
    00F31 940C 48F7 JMP	pop_xgsetF03C
ff.c:dir_register:
  dir                  --> R12
  c                    --> R22
  res                  --> R10
  dj                   --> R20
    00F33 940E 48EE CALL	push_xgsetF03C
    00F35 01A8      MOVW	R20,R16
    00F36 9722      SBIW	R28,2
(1461) }
(1462) #endif
(1463) 
(1464) 
(1465) 
(1466) /*-----------------------------------------------------------------------*/
(1467) /* Register an object to the directory                                   */
(1468) /*-----------------------------------------------------------------------*/
(1469) #if !_FS_READONLY
(1470) static
(1471) FRESULT dir_register (	/* FR_OK:Successful, FR_DENIED:No free entry or too many SFN collision, FR_DISK_ERR:Disk error */
(1472) 	DIR *dj				/* Target directory with object name to be created */
(1473) )
(1474) {
(1475) 	FRESULT res;
(1476) 	BYTE c, *dir;
(1477) #if _USE_LFN	/* LFN configuration */
(1478) 	WORD n, ne, is;
(1479) 	BYTE sn[12], *fn, sum;
(1480) 	WCHAR *lfn;
(1481) 
(1482) 
(1483) 	fn = dj->fn; lfn = dj->lfn;
(1484) 	mem_cpy(sn, fn, 12);
(1485) 
(1486) 	if (_FS_RPATH && (sn[NS] & NS_DOT))		/* Cannot create dot entry */
(1487) 		return FR_INVALID_NAME;
(1488) 
(1489) 	if (sn[NS] & NS_LOSS) {			/* When LFN is out of 8.3 format, generate a numbered name */
(1490) 		fn[NS] = 0; dj->lfn = 0;			/* Find only SFN */
(1491) 		for (n = 1; n < 100; n++) {
(1492) 			gen_numname(fn, sn, lfn, n);	/* Generate a numbered name */
(1493) 			res = dir_find(dj);				/* Check if the name collides with existing SFN */
(1494) 			if (res != FR_OK) break;
(1495) 		}
(1496) 		if (n == 100) return FR_DENIED;		/* Abort if too many collisions */
(1497) 		if (res != FR_NO_FILE) return res;	/* Abort if the result is other than 'not collided' */
(1498) 		fn[NS] = sn[NS]; dj->lfn = lfn;
(1499) 	}
(1500) 
(1501) 	if (sn[NS] & NS_LFN) {			/* When LFN is to be created, reserve an SFN + LFN entries. */
(1502) 		for (ne = 0; lfn[ne]; ne++) ;
(1503) 		ne = (ne + 25) / 13;
(1504) 	} else {						/* Otherwise reserve only an SFN entry. */
(1505) 		ne = 1;
(1506) 	}
(1507) 
(1508) 	/* Reserve contiguous entries */
(1509) 	res = dir_sdi(dj, 0);
(1510) 	if (res != FR_OK) return res;
(1511) 	n = is = 0;
(1512) 	do {
(1513) 		res = move_window(dj->fs, dj->sect);
(1514) 		if (res != FR_OK) break;
(1515) 		c = *dj->dir;				/* Check the entry status */
(1516) 		if (c == DDE || c == 0) {	/* Is it a blank entry? */
(1517) 			if (n == 0) is = dj->index;	/* First index of the contiguous entry */
(1518) 			if (++n == ne) break;	/* A contiguous entry that required count is found */
(1519) 		} else {
(1520) 			n = 0;					/* Not a blank entry. Restart to search */
(1521) 		}
(1522) 		res = dir_next(dj, 1);		/* Next entry with table stretch */
(1523) 	} while (res == FR_OK);
(1524) 
(1525) 	if (res == FR_OK && ne > 1) {	/* Initialize LFN entry if needed */
(1526) 		res = dir_sdi(dj, is);
(1527) 		if (res == FR_OK) {
(1528) 			sum = sum_sfn(dj->fn);	/* Sum of the SFN tied to the LFN */
(1529) 			ne--;
(1530) 			do {					/* Store LFN entries in bottom first */
(1531) 				res = move_window(dj->fs, dj->sect);
(1532) 				if (res != FR_OK) break;
(1533) 				fit_lfn(dj->lfn, dj->dir, (BYTE)ne, sum);
(1534) 				dj->fs->wflag = 1;
(1535) 				res = dir_next(dj, 0);	/* Next entry */
(1536) 			} while (res == FR_OK && --ne);
(1537) 		}
(1538) 	}
(1539) 
(1540) #else	/* Non LFN configuration */
(1541) 	res = dir_sdi(dj, 0);
    00F37 2722      CLR	R18
    00F38 2733      CLR	R19
    00F39 018A      MOVW	R16,R20
    00F3A DCB0      RCALL	ff.c:dir_sdi
    00F3B 2EA0      MOV	R10,R16
(1542) 	if (res == FR_OK) {
    00F3C 2300      TST	R16
    00F3D F509      BNE	0x0F5F
(1543) 		do {	/* Find a blank entry for the SFN */
(1544) 			res = move_window(dj->fs, dj->sect);
    00F3E 01FA      MOVW	R30,R20
    00F3F 8426      LDD	R2,Z+14
    00F40 8437      LDD	R3,Z+15
    00F41 8840      LDD	R4,Z+16
    00F42 8851      LDD	R5,Z+17
    00F43 8248      ST	Y,R4
    00F44 8259      STD	Y+1,R5
    00F45 0191      MOVW	R18,R2
    00F46 8100      LD	R16,Z
    00F47 8111      LDD	R17,Z+1
    00F48 940E 046F CALL	ff.c:move_window
    00F4A 2EA0      MOV	R10,R16
(1545) 			if (res != FR_OK) break;
    00F4B 2300      TST	R16
    00F4C F009      BEQ	0x0F4E
    00F4D C011      RJMP	0x0F5F
(1546) 			c = *dj->dir;
    00F4E 01FA      MOVW	R30,R20
    00F4F 89A2      LDD	R26,Z+18
    00F50 89B3      LDD	R27,Z+19
    00F51 916C      LD	R22,X
(1547) 			if (c == DDE || c == 0) break;	/* Is it a blank entry? */
    00F52 3E65      CPI	R22,0xE5
    00F53 F011      BEQ	0x0F56
    00F54 2366      TST	R22
    00F55 F409      BNE	0x0F57
    00F56 C008      RJMP	0x0F5F
(1548) 			res = dir_next(dj, 1);			/* Next entry with table stretch */
    00F57 E021      LDI	R18,1
    00F58 E030      LDI	R19,0
    00F59 018A      MOVW	R16,R20
    00F5A DD9A      RCALL	ff.c:dir_next
    00F5B 2EC0      MOV	R12,R16
    00F5C 2CAC      MOV	R10,R12
(1549) 		} while (res == FR_OK);
    00F5D 20AA      TST	R10
    00F5E F2F9      BEQ	0x0F3E
(1550) 	}
(1551) #endif
(1552) 
(1553) 	if (res == FR_OK) {		/* Initialize the SFN entry */
    00F5F 20AA      TST	R10
    00F60 F009      BEQ	0x0F62
    00F61 C030      RJMP	0x0F92
(1554) 		res = move_window(dj->fs, dj->sect);
    00F62 01FA      MOVW	R30,R20
    00F63 8426      LDD	R2,Z+14
    00F64 8437      LDD	R3,Z+15
    00F65 8840      LDD	R4,Z+16
    00F66 8851      LDD	R5,Z+17
    00F67 8248      ST	Y,R4
    00F68 8259      STD	Y+1,R5
    00F69 0191      MOVW	R18,R2
    00F6A 8100      LD	R16,Z
    00F6B 8111      LDD	R17,Z+1
    00F6C 940E 046F CALL	ff.c:move_window
    00F6E 2EC0      MOV	R12,R16
    00F6F 2CAC      MOV	R10,R12
(1555) 		if (res == FR_OK) {
    00F70 2300      TST	R16
    00F71 F501      BNE	0x0F92
(1556) 			dir = dj->dir;
    00F72 01FA      MOVW	R30,R20
    00F73 88C2      LDD	R12,Z+18
    00F74 88D3      LDD	R13,Z+19
(1557) 			mem_set(dir, 0, SZ_DIR);	/* Clean the entry */
    00F75 E280      LDI	R24,0x20
    00F76 E090      LDI	R25,0
    00F77 8399      STD	Y+1,R25
    00F78 8388      ST	Y,R24
    00F79 2722      CLR	R18
    00F7A 2733      CLR	R19
    00F7B 0186      MOVW	R16,R12
    00F7C 940E 042C CALL	ff.c:mem_set
(1558) 			mem_cpy(dir, dj->fn, 11);	/* Put SFN */
    00F7E E08B      LDI	R24,0xB
    00F7F E090      LDI	R25,0
    00F80 8399      STD	Y+1,R25
    00F81 8388      ST	Y,R24
    00F82 01FA      MOVW	R30,R20
    00F83 8924      LDD	R18,Z+20
    00F84 8935      LDD	R19,Z+21
    00F85 0186      MOVW	R16,R12
    00F86 940E 0416 CALL	ff.c:mem_cpy
(1559) #if _USE_LFN
(1560) 			dir[DIR_NTres] = *(dj->fn+NS) & (NS_BODY | NS_EXT);	/* Put NT flag */
(1561) #endif
(1562) 			dj->fs->wflag = 1;
    00F88 E081      LDI	R24,1
    00F89 01FA      MOVW	R30,R20
    00F8A 93AF      PUSH	R26
    00F8B 93BF      PUSH	R27
    00F8C 81A0      LD	R26,Z
    00F8D 81B1      LDD	R27,Z+1
    00F8E 01FD      MOVW	R30,R26
    00F8F 91BF      POP	R27
    00F90 91AF      POP	R26
    00F91 8384      STD	Z+4,R24
(1563) 		}
(1564) 	}
(1565) 
(1566) 	return res;
    00F92 2D0A      MOV	R16,R10
    00F93 9622      ADIW	R28,2
    00F94 940C 48F7 JMP	pop_xgsetF03C
ff.c:create_name:
  si                   --> R22
  b                    --> Y,+8
  sfn                  --> Y,+6
  ni                   --> R12
  d                    --> R10
  i                    --> Y,+4
  p                    --> Y,+2
  c                    --> R20
  path                 --> Y,+19
  dj                   --> R20
    00F96 933A      ST	-Y,R19
    00F97 932A      ST	-Y,R18
    00F98 940E 48B3 CALL	push_xgsetF0FC
    00F9A 01A8      MOVW	R20,R16
    00F9B 9729      SBIW	R28,0x9
(1567) }
(1568) #endif /* !_FS_READONLY */
(1569) 
(1570) 
(1571) 
(1572) 
(1573) /*-----------------------------------------------------------------------*/
(1574) /* Remove an object from the directory                                   */
(1575) /*-----------------------------------------------------------------------*/
(1576) #if !_FS_READONLY && !_FS_MINIMIZE
(1577) static
(1578) FRESULT dir_remove (	/* FR_OK: Successful, FR_DISK_ERR: A disk error */
(1579) 	DIR *dj				/* Directory object pointing the entry to be removed */
(1580) )
(1581) {
(1582) 	FRESULT res;
(1583) #if _USE_LFN	/* LFN configuration */
(1584) 	WORD i;
(1585) 
(1586) 	i = dj->index;	/* SFN index */
(1587) 	res = dir_sdi(dj, (WORD)((dj->lfn_idx == 0xFFFF) ? i : dj->lfn_idx));	/* Goto the SFN or top of the LFN entries */
(1588) 	if (res == FR_OK) {
(1589) 		do {
(1590) 			res = move_window(dj->fs, dj->sect);
(1591) 			if (res != FR_OK) break;
(1592) 			*dj->dir = DDE;			/* Mark the entry "deleted" */
(1593) 			dj->fs->wflag = 1;
(1594) 			if (dj->index >= i) break;	/* When reached SFN, all entries of the object has been deleted. */
(1595) 			res = dir_next(dj, 0);		/* Next entry */
(1596) 		} while (res == FR_OK);
(1597) 		if (res == FR_NO_FILE) res = FR_INT_ERR;
(1598) 	}
(1599) 
(1600) #else			/* Non LFN configuration */
(1601) 	res = dir_sdi(dj, dj->index);
(1602) 	if (res == FR_OK) {
(1603) 		res = move_window(dj->fs, dj->sect);
(1604) 		if (res == FR_OK) {
(1605) 			*dj->dir = DDE;			/* Mark the entry "deleted" */
(1606) 			dj->fs->wflag = 1;
(1607) 		}
(1608) 	}
(1609) #endif
(1610) 
(1611) 	return res;
(1612) }
(1613) #endif /* !_FS_READONLY */
(1614) 
(1615) 
(1616) 
(1617) 
(1618) /*-----------------------------------------------------------------------*/
(1619) /* Pick a segment and create the object name in directory form           */
(1620) /*-----------------------------------------------------------------------*/
(1621) 
(1622) static
(1623) FRESULT create_name (
(1624) 	DIR *dj,			/* Pointer to the directory object */
(1625) 	const TCHAR **path	/* Pointer to pointer to the segment in the path string */
(1626) )
(1627) {
(1628) #ifdef _EXCVT
(1629) 	static const BYTE excvt[] = _EXCVT;	/* Upper conversion table for extended chars */
(1630) #endif
(1631) 
(1632) #if _USE_LFN	/* LFN configuration */
(1633) 	BYTE b, cf;
(1634) 	WCHAR w, *lfn;
(1635) 	UINT i, ni, si, di;
(1636) 	const TCHAR *p;
(1637) 
(1638) 	/* Create LFN in Unicode */
(1639) 	for (p = *path; *p == '/' || *p == '\\'; p++) ;	/* Strip duplicated separator */
(1640) 	lfn = dj->lfn;
(1641) 	si = di = 0;
(1642) 	for (;;) {
(1643) 		w = p[si++];					/* Get a character */
(1644) 		if (w < ' ' || w == '/' || w == '\\') break;	/* Break on end of segment */
(1645) 		if (di >= _MAX_LFN)				/* Reject too long name */
(1646) 			return FR_INVALID_NAME;
(1647) #if !_LFN_UNICODE
(1648) 		w &= 0xFF;
(1649) 		if (IsDBCS1(w)) {				/* Check if it is a DBC 1st byte (always false on SBCS cfg) */
(1650) 			b = (BYTE)p[si++];			/* Get 2nd byte */
(1651) 			if (!IsDBCS2(b))
(1652) 				return FR_INVALID_NAME;	/* Reject invalid sequence */
(1653) 			w = (w << 8) + b;			/* Create a DBC */
(1654) 		}
(1655) 		w = ff_convert(w, 1);			/* Convert ANSI/OEM to Unicode */
(1656) 		if (!w) return FR_INVALID_NAME;	/* Reject invalid code */
(1657) #endif
(1658) 		if (w < 0x80 && chk_chr("\"*:<>\?|\x7F", w)) /* Reject illegal chars for LFN */
(1659) 			return FR_INVALID_NAME;
(1660) 		lfn[di++] = w;					/* Store the Unicode char */
(1661) 	}
(1662) 	*path = &p[si];						/* Return pointer to the next segment */
(1663) 	cf = (w < ' ') ? NS_LAST : 0;		/* Set last segment flag if end of path */
(1664) #if _FS_RPATH
(1665) 	if ((di == 1 && lfn[di-1] == '.') || /* Is this a dot entry? */
(1666) 		(di == 2 && lfn[di-1] == '.' && lfn[di-2] == '.')) {
(1667) 		lfn[di] = 0;
(1668) 		for (i = 0; i < 11; i++)
(1669) 			dj->fn[i] = (i < di) ? '.' : ' ';
(1670) 		dj->fn[i] = cf | NS_DOT;		/* This is a dot entry */
(1671) 		return FR_OK;
(1672) 	}
(1673) #endif
(1674) 	while (di) {						/* Strip trailing spaces and dots */
(1675) 		w = lfn[di-1];
(1676) 		if (w != ' ' && w != '.') break;
(1677) 		di--;
(1678) 	}
(1679) 	if (!di) return FR_INVALID_NAME;	/* Reject nul string */
(1680) 
(1681) 	lfn[di] = 0;						/* LFN is created */
(1682) 
(1683) 	/* Create SFN in directory form */
(1684) 	mem_set(dj->fn, ' ', 11);
(1685) 	for (si = 0; lfn[si] == ' ' || lfn[si] == '.'; si++) ;	/* Strip leading spaces and dots */
(1686) 	if (si) cf |= NS_LOSS | NS_LFN;
(1687) 	while (di && lfn[di - 1] != '.') di--;	/* Find extension (di<=si: no extension) */
(1688) 
(1689) 	b = i = 0; ni = 8;
(1690) 	for (;;) {
(1691) 		w = lfn[si++];					/* Get an LFN char */
(1692) 		if (!w) break;					/* Break on end of the LFN */
(1693) 		if (w == ' ' || (w == '.' && si != di)) {	/* Remove spaces and dots */
(1694) 			cf |= NS_LOSS | NS_LFN; continue;
(1695) 		}
(1696) 
(1697) 		if (i >= ni || si == di) {		/* Extension or end of SFN */
(1698) 			if (ni == 11) {				/* Long extension */
(1699) 				cf |= NS_LOSS | NS_LFN; break;
(1700) 			}
(1701) 			if (si != di) cf |= NS_LOSS | NS_LFN;	/* Out of 8.3 format */
(1702) 			if (si > di) break;			/* No extension */
(1703) 			si = di; i = 8; ni = 11;	/* Enter extension section */
(1704) 			b <<= 2; continue;
(1705) 		}
(1706) 
(1707) 		if (w >= 0x80) {				/* Non ASCII char */
(1708) #ifdef _EXCVT
(1709) 			w = ff_convert(w, 0);		/* Unicode -> OEM code */
(1710) 			if (w) w = excvt[w - 0x80];	/* Convert extended char to upper (SBCS) */
(1711) #else
(1712) 			w = ff_convert(ff_wtoupper(w), 0);	/* Upper converted Unicode -> OEM code */
(1713) #endif
(1714) 			cf |= NS_LFN;				/* Force create LFN entry */
(1715) 		}
(1716) 
(1717) 		if (_DF1S && w >= 0x100) {		/* Double byte char (always false on SBCS cfg) */
(1718) 			if (i >= ni - 1) {
(1719) 				cf |= NS_LOSS | NS_LFN; i = ni; continue;
(1720) 			}
(1721) 			dj->fn[i++] = (BYTE)(w >> 8);
(1722) 		} else {						/* Single byte char */
(1723) 			if (!w || chk_chr("+,;=[]", w)) {	/* Replace illegal chars for SFN */
(1724) 				w = '_'; cf |= NS_LOSS | NS_LFN;/* Lossy conversion */
(1725) 			} else {
(1726) 				if (IsUpper(w)) {		/* ASCII large capital */
(1727) 					b |= 2;
(1728) 				} else {
(1729) 					if (IsLower(w)) {	/* ASCII small capital */
(1730) 						b |= 1; w -= 0x20;
(1731) 					}
(1732) 				}
(1733) 			}
(1734) 		}
(1735) 		dj->fn[i++] = (BYTE)w;
(1736) 	}
(1737) 
(1738) 	if (dj->fn[0] == DDE) dj->fn[0] = NDDE;	/* If the first char collides with deleted mark, replace it with 0x05 */
(1739) 
(1740) 	if (ni == 8) b <<= 2;
(1741) 	if ((b & 0x0C) == 0x0C || (b & 0x03) == 0x03)	/* Create LFN entry when there are composite capitals */
(1742) 		cf |= NS_LFN;
(1743) 	if (!(cf & NS_LFN)) {						/* When LFN is in 8.3 format without extended char, NT flags are created */
(1744) 		if ((b & 0x03) == 0x01) cf |= NS_EXT;	/* NT flag (Extension has only small capital) */
(1745) 		if ((b & 0x0C) == 0x04) cf |= NS_BODY;	/* NT flag (Filename has only small capital) */
(1746) 	}
(1747) 
(1748) 	dj->fn[NS] = cf;	/* SFN is created */
(1749) 
(1750) 	return FR_OK;
(1751) 
(1752) 
(1753) #else	/* Non-LFN configuration */
(1754) 	BYTE b, c, d, *sfn;
(1755) 	UINT ni, si, i;
(1756) 	const char *p;
(1757) 
(1758) 	/* Create file name in directory form */
(1759) 	for (p = *path; *p == '/' || *p == '\\'; p++) ;	/* Strip duplicated separator */
    00F9C 89EB      LDD	R30,Y+19
    00F9D 89FC      LDD	R31,Y+20
    00F9E 8020      LD	R2,Z
    00F9F 8031      LDD	R3,Z+1
    00FA0 823B      STD	Y+3,R3
    00FA1 822A      STD	Y+2,R2
    00FA2 C005      RJMP	0x0FA8
    00FA3 818A      LDD	R24,Y+2
    00FA4 819B      LDD	R25,Y+3
    00FA5 9601      ADIW	R24,1
    00FA6 839B      STD	Y+3,R25
    00FA7 838A      STD	Y+2,R24
    00FA8 81EA      LDD	R30,Y+2
    00FA9 81FB      LDD	R31,Y+3
    00FAA 8020      LD	R2,Z
    00FAB 2433      CLR	R3
    00FAC 2D82      MOV	R24,R2
    00FAD 328F      CPI	R24,0x2F
    00FAE F3A1      BEQ	0x0FA3
    00FAF 358C      CPI	R24,0x5C
    00FB0 F391      BEQ	0x0FA3
(1760) 	sfn = dj->fn;
    00FB1 01FA      MOVW	R30,R20
    00FB2 8824      LDD	R2,Z+20
    00FB3 8835      LDD	R3,Z+21
    00FB4 823F      STD	Y+7,R3
    00FB5 822E      STD	Y+6,R2
(1761) 	mem_set(sfn, ' ', 11);
    00FB6 E08B      LDI	R24,0xB
    00FB7 E090      LDI	R25,0
    00FB8 8399      STD	Y+1,R25
    00FB9 8388      ST	Y,R24
    00FBA E220      LDI	R18,0x20
    00FBB E030      LDI	R19,0
    00FBC 0181      MOVW	R16,R2
    00FBD 940E 042C CALL	ff.c:mem_set
(1762) 	si = i = b = 0; ni = 8;
    00FBF 2400      CLR	R0
    00FC0 8608      STD	Y+8,R0
    00FC1 2422      CLR	R2
    00FC2 2433      CLR	R3
    00FC3 823D      STD	Y+5,R3
    00FC4 822C      STD	Y+4,R2
    00FC5 01B1      MOVW	R22,R2
    00FC6 E088      LDI	R24,0x8
    00FC7 E090      LDI	R25,0
    00FC8 016C      MOVW	R12,R24
(1763) #if _FS_RPATH
(1764) 	if (p[si] == '.') { /* Is this a dot entry? */
(1765) 		for (;;) {
(1766) 			c = (BYTE)p[si++];
(1767) 			if (c != '.' || si >= 3) break;
(1768) 			sfn[i++] = c;
(1769) 		}
(1770) 		if (c != '/' && c != '\\' && c > ' ') return FR_INVALID_NAME;
(1771) 		*path = &p[si];									/* Return pointer to the next segment */
(1772) 		sfn[NS] = (c <= ' ') ? NS_LAST | NS_DOT : NS_DOT;	/* Set last segment flag if end of path */
(1773) 		return FR_OK;
(1774) 	}
(1775) #endif
(1776) 	for (;;) {
(1777) 		c = (BYTE)p[si++];
    00FC9 01AB      MOVW	R20,R22
    00FCA 5F6F      SUBI	R22,0xFF
    00FCB 4F7F      SBCI	R23,0xFF
    00FCC 01FA      MOVW	R30,R20
    00FCD 800A      LDD	R0,Y+2
    00FCE 801B      LDD	R1,Y+3
    00FCF 0DE0      ADD	R30,R0
    00FD0 1DF1      ADC	R31,R1
    00FD1 8140      LD	R20,Z
(1778) 		if (c <= ' ' || c == '/' || c == '\\') break;	/* Break on end of segment */
    00FD2 E280      LDI	R24,0x20
    00FD3 1784      CP	R24,R20
    00FD4 F420      BCC	0x0FD9
    00FD5 324F      CPI	R20,0x2F
    00FD6 F011      BEQ	0x0FD9
    00FD7 354C      CPI	R20,0x5C
    00FD8 F409      BNE	0x0FDA
    00FD9 C087      RJMP	0x1061
(1779) 		if (c == '.' || i >= ni) {
    00FDA 324E      CPI	R20,0x2E
    00FDB F029      BEQ	0x0FE1
    00FDC 800C      LDD	R0,Y+4
    00FDD 801D      LDD	R1,Y+5
    00FDE 140C      CP	R0,R12
    00FDF 041D      CPC	R1,R13
    00FE0 F0A0      BCS	0x0FF5
(1780) 			if (ni != 8 || c != '.') return FR_INVALID_NAME;
    00FE1 01C6      MOVW	R24,R12
    00FE2 3088      CPI	R24,0x8
    00FE3 E0E0      LDI	R30,0
    00FE4 079E      CPC	R25,R30
    00FE5 F411      BNE	0x0FE8
    00FE6 324E      CPI	R20,0x2E
    00FE7 F011      BEQ	0x0FEA
    00FE8 E006      LDI	R16,6
    00FE9 C0AF      RJMP	0x1099
(1781) 			i = 8; ni = 11;
    00FEA E088      LDI	R24,0x8
    00FEB E090      LDI	R25,0
    00FEC 839D      STD	Y+5,R25
    00FED 838C      STD	Y+4,R24
    00FEE E08B      LDI	R24,0xB
    00FEF 016C      MOVW	R12,R24
(1782) 			b <<= 2; continue;
    00FF0 8408      LDD	R0,Y+8
    00FF1 0C00      LSL	R0
    00FF2 0C00      LSL	R0
    00FF3 8608      STD	Y+8,R0
    00FF4 CFD4      RJMP	0x0FC9
(1783) 		}
(1784) 		if (c >= 0x80) {				/* Extended char? */
    00FF5 3840      CPI	R20,0x80
    00FF6 F018      BCS	0x0FFA
(1785) 			b |= 3;						/* Eliminate NT flag */
    00FF7 8588      LDD	R24,Y+8
    00FF8 6083      ORI	R24,3
    00FF9 8788      STD	Y+8,R24
(1786) #ifdef _EXCVT
(1787) 			c = excvt[c-0x80];			/* Upper conversion (SBCS) */
(1788) #else
(1789) #if !_DF1S	/* ASCII only cfg */
(1790) 			return FR_INVALID_NAME;
(1791) #endif
(1792) #endif
(1793) 		}
(1794) 		if (IsDBCS1(c)) {				/* Check if it is a DBC 1st byte (always false on SBCS cfg) */
    00FFA 3841      CPI	R20,0x81
    00FFB F408      BCC	0x0FFD
    00FFC C039      RJMP	0x1036
    00FFD EF8E      LDI	R24,0xFE
    00FFE 1784      CP	R24,R20
    00FFF F408      BCC	0x1001
    01000 C035      RJMP	0x1036
(1795) 			d = (BYTE)p[si++];			/* Get 2nd byte */
    01001 015B      MOVW	R10,R22
    01002 5F6F      SUBI	R22,0xFF
    01003 4F7F      SBCI	R23,0xFF
    01004 01F5      MOVW	R30,R10
    01005 800A      LDD	R0,Y+2
    01006 801B      LDD	R1,Y+3
    01007 0DE0      ADD	R30,R0
    01008 1DF1      ADC	R31,R1
    01009 80A0      LD	R10,Z
(1796) 			if (!IsDBCS2(d) || i >= ni - 1)	/* Reject invalid DBC */
    0100A 2D8A      MOV	R24,R10
    0100B 3480      CPI	R24,0x40
    0100C F018      BCS	0x1010
    0100D E78E      LDI	R24,0x7E
    0100E 158A      CP	R24,R10
    0100F F430      BCC	0x1016
    01010 2D8A      MOV	R24,R10
    01011 3880      CPI	R24,0x80
    01012 F050      BCS	0x101D
    01013 EF8E      LDI	R24,0xFE
    01014 158A      CP	R24,R10
    01015 F038      BCS	0x101D
    01016 01C6      MOVW	R24,R12
    01017 9701      SBIW	R24,1
    01018 800C      LDD	R0,Y+4
    01019 801D      LDD	R1,Y+5
    0101A 1608      CP	R0,R24
    0101B 0619      CPC	R1,R25
    0101C F010      BCS	0x101F
(1797) 				return FR_INVALID_NAME;
    0101D E006      LDI	R16,6
    0101E C07A      RJMP	0x1099
(1798) 			sfn[i++] = c;
    0101F 80EC      LDD	R14,Y+4
    01020 80FD      LDD	R15,Y+5
    01021 01C7      MOVW	R24,R14
    01022 9601      ADIW	R24,1
    01023 839D      STD	Y+5,R25
    01024 838C      STD	Y+4,R24
    01025 01F7      MOVW	R30,R14
    01026 800E      LDD	R0,Y+6
    01027 801F      LDD	R1,Y+7
    01028 0DE0      ADD	R30,R0
    01029 1DF1      ADC	R31,R1
    0102A 8340      ST	Z,R20
(1799) 			sfn[i++] = d;
    0102B 017C      MOVW	R14,R24
    0102C 9601      ADIW	R24,1
    0102D 839D      STD	Y+5,R25
    0102E 838C      STD	Y+4,R24
    0102F 01F7      MOVW	R30,R14
    01030 800E      LDD	R0,Y+6
    01031 801F      LDD	R1,Y+7
    01032 0DE0      ADD	R30,R0
    01033 1DF1      ADC	R31,R1
    01034 82A0      ST	Z,R10
(1800) 		} else {						/* Single byte code */
    01035 CF93      RJMP	0x0FC9
(1801) 			if (chk_chr("\"*+,:;<=>\?[]|\x7F", c))	/* Reject illegal chrs for SFN */
    01036 2F24      MOV	R18,R20
    01037 2733      CLR	R19
    01038 E000      LDI	R16,0
    01039 E011      LDI	R17,1
    0103A 940E 045F CALL	ff.c:chk_chr
    0103C 0158      MOVW	R10,R16
    0103D 3000      CPI	R16,0
    0103E 0701      CPC	R16,R17
    0103F F011      BEQ	0x1042
(1802) 				return FR_INVALID_NAME;
    01040 E006      LDI	R16,6
    01041 C057      RJMP	0x1099
(1803) 			if (IsUpper(c)) {			/* ASCII large capital? */
    01042 3441      CPI	R20,0x41
    01043 F038      BCS	0x104B
    01044 E58A      LDI	R24,0x5A
    01045 1784      CP	R24,R20
    01046 F020      BCS	0x104B
(1804) 				b |= 2;
    01047 8588      LDD	R24,Y+8
    01048 6082      ORI	R24,2
    01049 8788      STD	Y+8,R24
(1805) 			} else {
    0104A C009      RJMP	0x1054
(1806) 				if (IsLower(c)) {		/* ASCII small capital? */
    0104B 3641      CPI	R20,0x61
    0104C F038      BCS	0x1054
    0104D E78A      LDI	R24,0x7A
    0104E 1784      CP	R24,R20
    0104F F020      BCS	0x1054
(1807) 					b |= 1; c -= 0x20;
    01050 8588      LDD	R24,Y+8
    01051 6081      ORI	R24,1
    01052 8788      STD	Y+8,R24
    01053 5240      SUBI	R20,0x20
(1808) 				}
(1809) 			}
(1810) 			sfn[i++] = c;
    01054 80AC      LDD	R10,Y+4
    01055 80BD      LDD	R11,Y+5
    01056 01C5      MOVW	R24,R10
    01057 9601      ADIW	R24,1
    01058 839D      STD	Y+5,R25
    01059 838C      STD	Y+4,R24
    0105A 01F5      MOVW	R30,R10
    0105B 800E      LDD	R0,Y+6
    0105C 801F      LDD	R1,Y+7
    0105D 0DE0      ADD	R30,R0
    0105E 1DF1      ADC	R31,R1
    0105F 8340      ST	Z,R20
    01060 CF68      RJMP	0x0FC9
(1811) 		}
(1812) 	}
(1813) 	*path = &p[si];						/* Return pointer to the next segment */
    01061 011B      MOVW	R2,R22
    01062 800A      LDD	R0,Y+2
    01063 801B      LDD	R1,Y+3
    01064 0C20      ADD	R2,R0
    01065 1C31      ADC	R3,R1
    01066 89EB      LDD	R30,Y+19
    01067 89FC      LDD	R31,Y+20
    01068 8231      STD	Z+1,R3
    01069 8220      ST	Z,R2
(1814) 	c = (c <= ' ') ? NS_LAST : 0;		/* Set last segment flag if end of path */
    0106A E280      LDI	R24,0x20
    0106B 1784      CP	R24,R20
    0106C F018      BCS	0x1070
    0106D E064      LDI	R22,4
    0106E E070      LDI	R23,0
    0106F C002      RJMP	0x1072
    01070 2766      CLR	R22
    01071 2777      CLR	R23
    01072 2F46      MOV	R20,R22
(1815) 
(1816) 	if (!i) return FR_INVALID_NAME;		/* Reject nul string */
    01073 800C      LDD	R0,Y+4
    01074 801D      LDD	R1,Y+5
    01075 2000      TST	R0
    01076 F421      BNE	0x107B
    01077 2011      TST	R1
    01078 F411      BNE	0x107B
    01079 E006      LDI	R16,6
    0107A C01E      RJMP	0x1099
(1817) 	if (sfn[0] == DDE) sfn[0] = NDDE;	/* When first char collides with DDE, replace it with 0x05 */
    0107B 81EE      LDD	R30,Y+6
    0107C 81FF      LDD	R31,Y+7
    0107D 8180      LD	R24,Z
    0107E 3E85      CPI	R24,0xE5
    0107F F411      BNE	0x1082
    01080 E085      LDI	R24,5
    01081 8380      ST	Z,R24
(1818) 
(1819) 	if (ni == 8) b <<= 2;
    01082 01C6      MOVW	R24,R12
    01083 3088      CPI	R24,0x8
    01084 E0E0      LDI	R30,0
    01085 079E      CPC	R25,R30
    01086 F421      BNE	0x108B
    01087 8408      LDD	R0,Y+8
    01088 0C00      LSL	R0
    01089 0C00      LSL	R0
    0108A 8608      STD	Y+8,R0
(1820) 	if ((b & 0x03) == 0x01) c |= NS_EXT;	/* NT flag (Name extension has only small capital) */
    0108B 8588      LDD	R24,Y+8
    0108C 7083      ANDI	R24,3
    0108D 3081      CPI	R24,1
    0108E F409      BNE	0x1090
    0108F 6140      ORI	R20,0x10
(1821) 	if ((b & 0x0C) == 0x04) c |= NS_BODY;	/* NT flag (Name body has only small capital) */
    01090 8588      LDD	R24,Y+8
    01091 708C      ANDI	R24,0xC
    01092 3084      CPI	R24,4
    01093 F409      BNE	0x1095
    01094 6048      ORI	R20,0x8
(1822) 
(1823) 	sfn[NS] = c;		/* Store NT flag, File name is created */
    01095 81EE      LDD	R30,Y+6
    01096 81FF      LDD	R31,Y+7
    01097 8743      STD	Z+11,R20
(1824) 
(1825) 	return FR_OK;
    01098 2700      CLR	R16
    01099 9629      ADIW	R28,0x9
    0109A 940E 48A8 CALL	pop_xgsetF0FC
    0109C 9622      ADIW	R28,2
    0109D 9508      RET
ff.c:get_fileinfo:
  nt                   --> R12
  p                    --> R20
  dir                  --> R10
  i                    --> R12
  c                    --> R14
  fno                  --> R22
  dj                   --> R10
    0109E 940E 48B3 CALL	push_xgsetF0FC
    010A0 01B9      MOVW	R22,R18
    010A1 0158      MOVW	R10,R16
(1826) #endif
(1827) }
(1828) 
(1829) 
(1830) 
(1831) 
(1832) /*-----------------------------------------------------------------------*/
(1833) /* Get file information from directory entry                             */
(1834) /*-----------------------------------------------------------------------*/
(1835) #if _FS_MINIMIZE <= 1
(1836) static
(1837) void get_fileinfo (		/* No return code */
(1838) 	DIR *dj,			/* Pointer to the directory object */
(1839) 	FILINFO *fno	 	/* Pointer to the file information to be filled */
(1840) )
(1841) {
(1842) 	UINT i;
(1843) 	BYTE nt, *dir;
(1844) 	TCHAR *p, c;
(1845) 
(1846) 
(1847) 	p = fno->fname;
    010A2 01AB      MOVW	R20,R22
    010A3 5F47      SUBI	R20,0xF7
    010A4 4F5F      SBCI	R21,0xFF
(1848) 	if (dj->sect) {
    010A5 01F5      MOVW	R30,R10
    010A6 963E      ADIW	R30,0xE
    010A7 8020      LD	R2,Z
    010A8 8031      LDD	R3,Z+1
    010A9 8042      LDD	R4,Z+2
    010AA 8053      LDD	R5,Z+3
    010AB 9488      BCLR	0
    010AC 2022      TST	R2
    010AD 0432      CPC	R3,R2
    010AE 0442      CPC	R4,R2
    010AF 0452      CPC	R5,R2
    010B0 F409      BNE	0x10B2
    010B1 C08A      RJMP	0x113C
(1849) 		dir = dj->dir;
    010B2 01F5      MOVW	R30,R10
    010B3 88A2      LDD	R10,Z+18
    010B4 88B3      LDD	R11,Z+19
(1850) 		nt = dir[DIR_NTres];		/* NT flag */
(1851) 		for (i = 0; i < 8; i++) {	/* Copy name body */
    010B5 24CC      CLR	R12
    010B6 24DD      CLR	R13
    010B7 C014      RJMP	0x10CC
(1852) 			c = dir[i];
    010B8 01F6      MOVW	R30,R12
    010B9 0DEA      ADD	R30,R10
    010BA 1DFB      ADC	R31,R11
    010BB 80E0      LD	R14,Z
(1853) 			if (c == ' ') break;
    010BC 2D8E      MOV	R24,R14
    010BD 3280      CPI	R24,0x20
    010BE F409      BNE	0x10C0
    010BF C011      RJMP	0x10D1
(1854) 			if (c == NDDE) c = (TCHAR)DDE;
    010C0 2D8E      MOV	R24,R14
    010C1 3085      CPI	R24,5
    010C2 F411      BNE	0x10C5
    010C3 EE85      LDI	R24,0xE5
    010C4 2EE8      MOV	R14,R24
(1855) 			if (_USE_LFN && (nt & NS_BODY) && IsUpper(c)) c += 0x20;
    010C5 C000      RJMP	0x10C6
(1856) #if _LFN_UNICODE
(1857) 			if (IsDBCS1(c) && i < 7 && IsDBCS2(dir[i+1]))
(1858) 				c = (c << 8) | dir[++i];
(1859) 			c = ff_convert(c, 1);
(1860) 			if (!c) c = '?';
(1861) #endif
(1862) 			*p++ = c;
    010C6 01FA      MOVW	R30,R20
    010C7 92E1      ST	Z+,R14
    010C8 01AF      MOVW	R20,R30
    010C9 01C6      MOVW	R24,R12
    010CA 9601      ADIW	R24,1
    010CB 016C      MOVW	R12,R24
    010CC 01C6      MOVW	R24,R12
    010CD 3088      CPI	R24,0x8
    010CE E0E0      LDI	R30,0
    010CF 079E      CPC	R25,R30
    010D0 F338      BCS	0x10B8
(1863) 		}
(1864) 		if (dir[8] != ' ') {		/* Copy name extension */
    010D1 01F5      MOVW	R30,R10
    010D2 8580      LDD	R24,Z+8
    010D3 3280      CPI	R24,0x20
    010D4 F0E1      BEQ	0x10F1
(1865) 			*p++ = '.';
    010D5 E28E      LDI	R24,0x2E
    010D6 01FA      MOVW	R30,R20
    010D7 9381      ST	Z+,R24
    010D8 01AF      MOVW	R20,R30
(1866) 			for (i = 8; i < 11; i++) {
    010D9 E088      LDI	R24,0x8
    010DA E090      LDI	R25,0
    010DB 016C      MOVW	R12,R24
    010DC C00F      RJMP	0x10EC
(1867) 				c = dir[i];
    010DD 01F6      MOVW	R30,R12
    010DE 0DEA      ADD	R30,R10
    010DF 1DFB      ADC	R31,R11
    010E0 80E0      LD	R14,Z
(1868) 				if (c == ' ') break;
    010E1 2D8E      MOV	R24,R14
    010E2 3280      CPI	R24,0x20
    010E3 F409      BNE	0x10E5
    010E4 C00C      RJMP	0x10F1
(1869) 				if (_USE_LFN && (nt & NS_EXT) && IsUpper(c)) c += 0x20;
    010E5 C000      RJMP	0x10E6
(1870) #if _LFN_UNICODE
(1871) 				if (IsDBCS1(c) && i < 10 && IsDBCS2(dir[i+1]))
(1872) 					c = (c << 8) | dir[++i];
(1873) 				c = ff_convert(c, 1);
(1874) 				if (!c) c = '?';
(1875) #endif
(1876) 				*p++ = c;
    010E6 01FA      MOVW	R30,R20
    010E7 92E1      ST	Z+,R14
    010E8 01AF      MOVW	R20,R30
    010E9 01C6      MOVW	R24,R12
    010EA 9601      ADIW	R24,1
    010EB 016C      MOVW	R12,R24
    010EC 01C6      MOVW	R24,R12
    010ED 308B      CPI	R24,0xB
    010EE E0E0      LDI	R30,0
    010EF 079E      CPC	R25,R30
    010F0 F360      BCS	0x10DD
(1877) 			}
(1878) 		}
(1879) 		fno->fattrib = dir[DIR_Attr];				/* Attribute */
    010F1 01F5      MOVW	R30,R10
    010F2 8423      LDD	R2,Z+11
    010F3 01FB      MOVW	R30,R22
    010F4 8620      STD	Z+8,R2
(1880) 		fno->fsize = LD_DWORD(dir+DIR_FileSize);	/* Size */
    010F5 E188      LDI	R24,0x18
    010F6 E090      LDI	R25,0
    010F7 01F5      MOVW	R30,R10
    010F8 8D07      LDD	R16,Z+31
    010F9 2711      CLR	R17
    010FA 2722      CLR	R18
    010FB 2733      CLR	R19
    010FC 938A      ST	-Y,R24
    010FD 940E 493E CALL	lsl32
    010FF 0118      MOVW	R2,R16
    01100 0129      MOVW	R4,R18
    01101 01F5      MOVW	R30,R10
    01102 8C66      LDD	R6,Z+30
    01103 2477      CLR	R7
    01104 2488      CLR	R8
    01105 2499      CLR	R9
    01106 0143      MOVW	R8,R6
    01107 2466      CLR	R6
    01108 2477      CLR	R7
    01109 2826      OR	R2,R6
    0110A 2837      OR	R3,R7
    0110B 2848      OR	R4,R8
    0110C 2859      OR	R5,R9
    0110D 8C65      LDD	R6,Z+29
    0110E 2477      CLR	R7
    0110F 2C76      MOV	R7,R6
    01110 2466      CLR	R6
    01111 2488      CLR	R8
    01112 2499      CLR	R9
    01113 2826      OR	R2,R6
    01114 2837      OR	R3,R7
    01115 2848      OR	R4,R8
    01116 2859      OR	R5,R9
    01117 8C64      LDD	R6,Z+28
    01118 2477      CLR	R7
    01119 2488      CLR	R8
    0111A 2499      CLR	R9
    0111B 2826      OR	R2,R6
    0111C 2837      OR	R3,R7
    0111D 2848      OR	R4,R8
    0111E 2859      OR	R5,R9
    0111F 01FB      MOVW	R30,R22
    01120 8220      ST	Z,R2
    01121 8231      STD	Z+1,R3
    01122 8242      STD	Z+2,R4
    01123 8253      STD	Z+3,R5
(1881) 		fno->fdate = LD_WORD(dir+DIR_WrtDate);		/* Date */
    01124 01F5      MOVW	R30,R10
    01125 8C20      LDD	R2,Z+24
    01126 2433      CLR	R3
    01127 8C41      LDD	R4,Z+25
    01128 2455      CLR	R5
    01129 2C54      MOV	R5,R4
    0112A 2444      CLR	R4
    0112B 2842      OR	R4,R2
    0112C 2853      OR	R5,R3
    0112D 01FB      MOVW	R30,R22
    0112E 8255      STD	Z+5,R5
    0112F 8244      STD	Z+4,R4
(1882) 		fno->ftime = LD_WORD(dir+DIR_WrtTime);		/* Time */
    01130 01F5      MOVW	R30,R10
    01131 8826      LDD	R2,Z+22
    01132 2433      CLR	R3
    01133 8847      LDD	R4,Z+23
    01134 2455      CLR	R5
    01135 2C54      MOV	R5,R4
    01136 2444      CLR	R4
    01137 2842      OR	R4,R2
    01138 2853      OR	R5,R3
    01139 01FB      MOVW	R30,R22
    0113A 8257      STD	Z+7,R5
    0113B 8246      STD	Z+6,R4
(1883) 	}
(1884) 	*p = 0;		/* Terminate SFN str by a \0 */
    0113C 2422      CLR	R2
    0113D 01FA      MOVW	R30,R20
    0113E 8220      ST	Z,R2
    0113F 940C 48A8 JMP	pop_xgsetF0FC
ff.c:follow_path:
  ns                   --> R10
  res                  --> R20
  dir                  --> R10
  path                 --> Y,+6
  dj                   --> R22
    01141 933A      ST	-Y,R19
    01142 932A      ST	-Y,R18
    01143 940E 48D2 CALL	push_xgsetF00C
    01145 01B8      MOVW	R22,R16
(1885) 
(1886) #if _USE_LFN
(1887) 	if (fno->lfname && fno->lfsize) {
(1888) 		TCHAR *tp = fno->lfname;
(1889) 		WCHAR w, *lfn;
(1890) 
(1891) 		i = 0;
(1892) 		if (dj->sect && dj->lfn_idx != 0xFFFF) {/* Get LFN if available */
(1893) 			lfn = dj->lfn;
(1894) 			while ((w = *lfn++) != 0) {			/* Get an LFN char */
(1895) #if !_LFN_UNICODE
(1896) 				w = ff_convert(w, 0);			/* Unicode -> OEM conversion */
(1897) 				if (!w) { i = 0; break; }		/* Could not convert, no LFN */
(1898) 				if (_DF1S && w >= 0x100)		/* Put 1st byte if it is a DBC (always false on SBCS cfg) */
(1899) 					tp[i++] = (TCHAR)(w >> 8);
(1900) #endif
(1901) 				if (i >= fno->lfsize - 1) { i = 0; break; }	/* Buffer overflow, no LFN */
(1902) 				tp[i++] = (TCHAR)w;
(1903) 			}
(1904) 		}
(1905) 		tp[i] = 0;	/* Terminate the LFN str by a \0 */
(1906) 	}
(1907) #endif
(1908) }
(1909) #endif /* _FS_MINIMIZE <= 1 */
(1910) 
(1911) 
(1912) 
(1913) 
(1914) /*-----------------------------------------------------------------------*/
(1915) /* Follow a file path                                                    */
(1916) /*-----------------------------------------------------------------------*/
(1917) 
(1918) static
(1919) FRESULT follow_path (	/* FR_OK(0): successful, !=0: error code */
(1920) 	DIR *dj,			/* Directory object to return last directory and found object */
(1921) 	const TCHAR *path	/* Full-path string to find a file or directory */
(1922) )
(1923) {
(1924) 	FRESULT res;
(1925) 	BYTE *dir, ns;
(1926) 
(1927) 
(1928) #if _FS_RPATH
(1929) 	if (*path == '/' || *path == '\\') { /* There is a heading separator */
(1930) 		path++;	dj->sclust = 0;		/* Strip it and start from the root dir */
(1931) 	} else {							/* No heading separator */
(1932) 		dj->sclust = dj->fs->cdir;	/* Start from the current dir */
(1933) 	}
(1934) #else
(1935) 	if (*path == '/' || *path == '\\')	/* Strip heading separator if exist */
    01146 81EE      LDD	R30,Y+6
    01147 81FF      LDD	R31,Y+7
    01148 8020      LD	R2,Z
    01149 2433      CLR	R3
    0114A 2D82      MOV	R24,R2
    0114B 328F      CPI	R24,0x2F
    0114C F011      BEQ	0x114F
    0114D 358C      CPI	R24,0x5C
    0114E F429      BNE	0x1154
(1936) 		path++;
    0114F 818E      LDD	R24,Y+6
    01150 819F      LDD	R25,Y+7
    01151 9601      ADIW	R24,1
    01152 839F      STD	Y+7,R25
    01153 838E      STD	Y+6,R24
(1937) 	dj->sclust = 0;						/* Start from the root dir */
    01154 01FB      MOVW	R30,R22
    01155 9636      ADIW	R30,6
    01156 E080      LDI	R24,0
    01157 8380      ST	Z,R24
    01158 8381      STD	Z+1,R24
    01159 8382      STD	Z+2,R24
    0115A 8383      STD	Z+3,R24
(1938) #endif
(1939) 
(1940) 	if ((UINT)*path < ' ') {			/* Nul path means the start directory itself */
    0115B 81EE      LDD	R30,Y+6
    0115C 81FF      LDD	R31,Y+7
    0115D 8180      LD	R24,Z
    0115E 2799      CLR	R25
    0115F 3280      CPI	R24,0x20
    01160 E0E0      LDI	R30,0
    01161 079E      CPC	R25,R30
    01162 F458      BCC	0x116E
(1941) 		res = dir_sdi(dj, 0);
    01163 2722      CLR	R18
    01164 2733      CLR	R19
    01165 018B      MOVW	R16,R22
    01166 DA84      RCALL	ff.c:dir_sdi
    01167 2F40      MOV	R20,R16
(1942) 		dj->dir = 0;
    01168 2422      CLR	R2
    01169 2433      CLR	R3
    0116A 01FB      MOVW	R30,R22
    0116B 8A33      STD	Z+19,R3
    0116C 8A22      STD	Z+18,R2
(1943) 
(1944) 	} else {							/* Follow path */
    0116D C052      RJMP	0x11C0
(1945) 		for (;;) {
(1946) 			res = create_name(dj, &path);	/* Get a segment */
    0116E 019E      MOVW	R18,R28
    0116F 5F2A      SUBI	R18,0xFA
    01170 4F3F      SBCI	R19,0xFF
    01171 018B      MOVW	R16,R22
    01172 DE23      RCALL	ff.c:create_name
    01173 2EA0      MOV	R10,R16
    01174 2D4A      MOV	R20,R10
(1947) 			if (res != FR_OK) break;
    01175 2300      TST	R16
    01176 F009      BEQ	0x1178
    01177 C048      RJMP	0x11C0
(1948) 			res = dir_find(dj);				/* Find it */
    01178 018B      MOVW	R16,R22
    01179 DD29      RCALL	ff.c:dir_find
    0117A 2EA0      MOV	R10,R16
    0117B 2D4A      MOV	R20,R10
(1949) 			ns = *(dj->fn+NS);
    0117C 01FB      MOVW	R30,R22
    0117D 93AF      PUSH	R26
    0117E 93BF      PUSH	R27
    0117F 89A4      LDD	R26,Z+20
    01180 89B5      LDD	R27,Z+21
    01181 01FD      MOVW	R30,R26
    01182 91BF      POP	R27
    01183 91AF      POP	R26
    01184 84A3      LDD	R10,Z+11
(1950) 			if (res != FR_OK) {				/* Failed to find the object */
    01185 2300      TST	R16
    01186 F049      BEQ	0x1190
(1951) 				if (res != FR_NO_FILE) break;	/* Abort if any hard error occured */
    01187 3004      CPI	R16,4
    01188 F009      BEQ	0x118A
    01189 C036      RJMP	0x11C0
(1952) 				/* Object not found */
(1953) 				if (_FS_RPATH && (ns & NS_DOT)) {	/* If dot entry is not exit */
    0118A C001      RJMP	0x118C
(1954) 					dj->sclust = 0; dj->dir = 0;	/* It is the root dir */
(1955) 					res = FR_OK;
(1956) 					if (!(ns & NS_LAST)) continue;
    0118B CFE2      RJMP	0x116E
(1957) 				} else {							/* Could not find the object */
(1958) 					if (!(ns & NS_LAST)) res = FR_NO_PATH;
    0118C FCA2      SBRC	R10,2
    0118D C032      RJMP	0x11C0
    0118E E045      LDI	R20,5
(1959) 				}
(1960) 				break;
    0118F C030      RJMP	0x11C0
(1961) 			}
(1962) 			if (ns & NS_LAST) break;			/* Last segment match. Function completed. */
    01190 FEA2      SBRS	R10,2
    01191 C001      RJMP	0x1193
    01192 C02D      RJMP	0x11C0
(1963) 			dir = dj->dir;						/* There is next segment. Follow the sub directory */
    01193 01FB      MOVW	R30,R22
    01194 88A2      LDD	R10,Z+18
    01195 88B3      LDD	R11,Z+19
(1964) 			if (!(dir[DIR_Attr] & AM_DIR)) {	/* Cannot follow because it is a file */
    01196 01F5      MOVW	R30,R10
    01197 8423      LDD	R2,Z+11
    01198 FC24      SBRC	R2,4
    01199 C002      RJMP	0x119C
(1965) 				res = FR_NO_PATH; break;
    0119A E045      LDI	R20,5
    0119B C024      RJMP	0x11C0
(1966) 			}
(1967) 			dj->sclust = LD_CLUST(dir);
    0119C 01F5      MOVW	R30,R10
    0119D 8C22      LDD	R2,Z+26
    0119E 2433      CLR	R3
    0119F 8C43      LDD	R4,Z+27
    011A0 2455      CLR	R5
    011A1 2C54      MOV	R5,R4
    011A2 2444      CLR	R4
    011A3 2842      OR	R4,R2
    011A4 2853      OR	R5,R3
    011A5 0112      MOVW	R2,R4
    011A6 2444      CLR	R4
    011A7 2455      CLR	R5
    011A8 8864      LDD	R6,Z+20
    011A9 2477      CLR	R7
    011AA 8885      LDD	R8,Z+21
    011AB 2499      CLR	R9
    011AC 2C98      MOV	R9,R8
    011AD 2488      CLR	R8
    011AE 2886      OR	R8,R6
    011AF 2897      OR	R9,R7
    011B0 0134      MOVW	R6,R8
    011B1 2488      CLR	R8
    011B2 2499      CLR	R9
    011B3 0143      MOVW	R8,R6
    011B4 2466      CLR	R6
    011B5 2477      CLR	R7
    011B6 2862      OR	R6,R2
    011B7 2873      OR	R7,R3
    011B8 2884      OR	R8,R4
    011B9 2895      OR	R9,R5
    011BA 01FB      MOVW	R30,R22
    011BB 8266      STD	Z+6,R6
    011BC 8277      STD	Z+7,R7
    011BD 8680      STD	Z+8,R8
    011BE 8691      STD	Z+9,R9
    011BF CFAE      RJMP	0x116E
(1968) 		}
(1969) 	}
(1970) 
(1971) 	return res;
    011C0 2F04      MOV	R16,R20
    011C1 940E 48D9 CALL	pop_xgsetF00C
    011C3 9622      ADIW	R28,2
    011C4 9508      RET
ff.c:check_fs:
  sect                 --> Y,+11
  fs                   --> R10
    011C5 933A      ST	-Y,R19
    011C6 932A      ST	-Y,R18
    011C7 940E 48D2 CALL	push_xgsetF00C
    011C9 0158      MOVW	R10,R16
    011CA 9725      SBIW	R28,5
(1972) }
(1973) 
(1974) 
(1975) 
(1976) 
(1977) /*-----------------------------------------------------------------------*/
(1978) /* Load a sector and check if it is an FAT Volume Boot Record            */
(1979) /*-----------------------------------------------------------------------*/
(1980) 
(1981) static
(1982) BYTE check_fs (	/* 0:FAT-VBR, 1:Valid BR but not FAT, 2:Not a BR, 3:Disk error */
(1983) 	FATFS *fs,	/* File system object */
(1984) 	DWORD sect	/* Sector# (lba) to check if it is an FAT boot record or not */
(1985) )
(1986) {
(1987) 	if (disk_read(fs->drv, fs->win, sect, 1) != RES_OK)	/* Load boot record */
    011CB E081      LDI	R24,1
    011CC 838C      STD	Y+4,R24
    011CD 842B      LDD	R2,Y+11
    011CE 843C      LDD	R3,Y+12
    011CF 844D      LDD	R4,Y+13
    011D0 845E      LDD	R5,Y+14
    011D1 8228      ST	Y,R2
    011D2 8239      STD	Y+1,R3
    011D3 824A      STD	Y+2,R4
    011D4 825B      STD	Y+3,R5
    011D5 0195      MOVW	R18,R10
    011D6 5D22      SUBI	R18,0xD2
    011D7 4F3F      SBCI	R19,0xFF
    011D8 01F5      MOVW	R30,R10
    011D9 8101      LDD	R16,Z+1
    011DA 940E 03D4 CALL	_disk_read
    011DC 2300      TST	R16
    011DD F011      BEQ	0x11E0
(1988) 		return 3;
    011DE E003      LDI	R16,3
    011DF C0A8      RJMP	0x1288
(1989) 	if (LD_WORD(&fs->win[BS_55AA]) != 0xAA55)		/* Check record signature (always placed at offset 510 even if the sector size is >512) */
    011E0 01F5      MOVW	R30,R10
    011E1 5DE4      SUBI	R30,0xD4
    011E2 4FFD      SBCI	R31,0xFD
    011E3 8020      LD	R2,Z
    011E4 52EC      SUBI	R30,0x2C
    011E5 40F2      SBCI	R31,2
    011E6 2433      CLR	R3
    011E7 5DE3      SUBI	R30,0xD3
    011E8 4FFD      SBCI	R31,0xFD
    011E9 8180      LD	R24,Z
    011EA 2799      CLR	R25
    011EB 2F98      MOV	R25,R24
    011EC 2788      CLR	R24
    011ED 2982      OR	R24,R2
    011EE 2993      OR	R25,R3
    011EF 3585      CPI	R24,0x55
    011F0 EAEA      LDI	R30,0xAA
    011F1 079E      CPC	R25,R30
    011F2 F011      BEQ	0x11F5
(1990) 		return 2;
    011F3 E002      LDI	R16,2
    011F4 C093      RJMP	0x1288
(1991) 
(1992) 	if ((LD_DWORD(&fs->win[BS_FilSysType]) & 0xFFFFFF) == 0x544146)	/* Check "FAT" string */
    011F5 E188      LDI	R24,0x18
    011F6 E090      LDI	R25,0
    011F7 01F5      MOVW	R30,R10
    011F8 59E9      SUBI	R30,0x99
    011F9 4FFF      SBCI	R31,0xFF
    011FA 8100      LD	R16,Z
    011FB 2711      CLR	R17
    011FC 2722      CLR	R18
    011FD 2733      CLR	R19
    011FE 938A      ST	-Y,R24
    011FF 940E 493E CALL	lsl32
    01201 0118      MOVW	R2,R16
    01202 0129      MOVW	R4,R18
    01203 01F5      MOVW	R30,R10
    01204 59EA      SUBI	R30,0x9A
    01205 4FFF      SBCI	R31,0xFF
    01206 8060      LD	R6,Z
    01207 56E6      SUBI	R30,0x66
    01208 40F0      SBCI	R31,0
    01209 2477      CLR	R7
    0120A 2488      CLR	R8
    0120B 2499      CLR	R9
    0120C 0143      MOVW	R8,R6
    0120D 2466      CLR	R6
    0120E 2477      CLR	R7
    0120F 2826      OR	R2,R6
    01210 2837      OR	R3,R7
    01211 2848      OR	R4,R8
    01212 2859      OR	R5,R9
    01213 59EB      SUBI	R30,0x9B
    01214 4FFF      SBCI	R31,0xFF
    01215 8060      LD	R6,Z
    01216 56E5      SUBI	R30,0x65
    01217 40F0      SBCI	R31,0
    01218 2477      CLR	R7
    01219 2C76      MOV	R7,R6
    0121A 2466      CLR	R6
    0121B 2488      CLR	R8
    0121C 2499      CLR	R9
    0121D 2826      OR	R2,R6
    0121E 2837      OR	R3,R7
    0121F 2848      OR	R4,R8
    01220 2859      OR	R5,R9
    01221 59EC      SUBI	R30,0x9C
    01222 4FFF      SBCI	R31,0xFF
    01223 8060      LD	R6,Z
    01224 2477      CLR	R7
    01225 2488      CLR	R8
    01226 2499      CLR	R9
    01227 2826      OR	R2,R6
    01228 2837      OR	R3,R7
    01229 2848      OR	R4,R8
    0122A 2859      OR	R5,R9
    0122B EF4F      LDI	R20,0xFF
    0122C EF5F      LDI	R21,0xFF
    0122D EF6F      LDI	R22,0xFF
    0122E E070      LDI	R23,0
    0122F 2224      AND	R2,R20
    01230 2235      AND	R3,R21
    01231 2246      AND	R4,R22
    01232 2257      AND	R5,R23
    01233 E446      LDI	R20,0x46
    01234 E451      LDI	R21,0x41
    01235 E564      LDI	R22,0x54
    01236 E070      LDI	R23,0
    01237 1624      CP	R2,R20
    01238 0635      CPC	R3,R21
    01239 0646      CPC	R4,R22
    0123A 0657      CPC	R5,R23
    0123B F411      BNE	0x123E
(1993) 		return 0;
    0123C 2700      CLR	R16
    0123D C04A      RJMP	0x1288
(1994) 	if ((LD_DWORD(&fs->win[BS_FilSysType32]) & 0xFFFFFF) == 0x544146)
    0123E E188      LDI	R24,0x18
    0123F E090      LDI	R25,0
    01240 01F5      MOVW	R30,R10
    01241 57ED      SUBI	R30,0x7D
    01242 4FFF      SBCI	R31,0xFF
    01243 8100      LD	R16,Z
    01244 2711      CLR	R17
    01245 2722      CLR	R18
    01246 2733      CLR	R19
    01247 938A      ST	-Y,R24
    01248 940E 493E CALL	lsl32
    0124A 0118      MOVW	R2,R16
    0124B 0129      MOVW	R4,R18
    0124C 01F5      MOVW	R30,R10
    0124D 57EE      SUBI	R30,0x7E
    0124E 4FFF      SBCI	R31,0xFF
    0124F 8060      LD	R6,Z
    01250 58E2      SUBI	R30,0x82
    01251 40F0      SBCI	R31,0
    01252 2477      CLR	R7
    01253 2488      CLR	R8
    01254 2499      CLR	R9
    01255 0143      MOVW	R8,R6
    01256 2466      CLR	R6
    01257 2477      CLR	R7
    01258 2826      OR	R2,R6
    01259 2837      OR	R3,R7
    0125A 2848      OR	R4,R8
    0125B 2859      OR	R5,R9
    0125C 57EF      SUBI	R30,0x7F
    0125D 4FFF      SBCI	R31,0xFF
    0125E 8060      LD	R6,Z
    0125F 58E1      SUBI	R30,0x81
    01260 40F0      SBCI	R31,0
    01261 2477      CLR	R7
    01262 2C76      MOV	R7,R6
    01263 2466      CLR	R6
    01264 2488      CLR	R8
    01265 2499      CLR	R9
    01266 2826      OR	R2,R6
    01267 2837      OR	R3,R7
    01268 2848      OR	R4,R8
    01269 2859      OR	R5,R9
    0126A 58E0      SUBI	R30,0x80
    0126B 4FFF      SBCI	R31,0xFF
    0126C 8060      LD	R6,Z
    0126D 2477      CLR	R7
    0126E 2488      CLR	R8
    0126F 2499      CLR	R9
    01270 2826      OR	R2,R6
    01271 2837      OR	R3,R7
    01272 2848      OR	R4,R8
    01273 2859      OR	R5,R9
    01274 EF4F      LDI	R20,0xFF
    01275 EF5F      LDI	R21,0xFF
    01276 EF6F      LDI	R22,0xFF
    01277 E070      LDI	R23,0
    01278 2224      AND	R2,R20
    01279 2235      AND	R3,R21
    0127A 2246      AND	R4,R22
    0127B 2257      AND	R5,R23
    0127C E446      LDI	R20,0x46
    0127D E451      LDI	R21,0x41
    0127E E564      LDI	R22,0x54
    0127F E070      LDI	R23,0
    01280 1624      CP	R2,R20
    01281 0635      CPC	R3,R21
    01282 0646      CPC	R4,R22
    01283 0657      CPC	R5,R23
    01284 F411      BNE	0x1287
(1995) 		return 0;
    01285 2700      CLR	R16
    01286 C001      RJMP	0x1288
(1996) 
(1997) 	return 1;
    01287 E001      LDI	R16,1
    01288 9625      ADIW	R28,5
    01289 940E 48D9 CALL	pop_xgsetF00C
    0128B 9622      ADIW	R28,2
    0128C 9508      RET
ff.c:chk_mounted:
  pi                   --> R10
  szbfat               --> Y,+25
  tbl                  --> R10
  p                    --> R10
  nrsv                 --> R14
  sysect               --> Y,+21
  bsect                --> Y,+17
  stat                 --> R10
  tsect                --> Y,+13
  nclst                --> Y,+9
  vol                  --> R14
  fasize               --> Y,+5
  b                    --> R14
  fmt                  --> R12
  fs                   --> Y,+37
  chk_wp               --> Y,+51
  rfs                  --> Y,+49
  path                 --> R12
    0128D 933A      ST	-Y,R19
    0128E 932A      ST	-Y,R18
    0128F 940E 48B3 CALL	push_xgsetF0FC
    01291 0168      MOVW	R12,R16
    01292 97A7      SBIW	R28,0x27
(1998) }
(1999) 
(2000) 
(2001) 
(2002) 
(2003) /*-----------------------------------------------------------------------*/
(2004) /* Check if the file system object is valid or not                       */
(2005) /*-----------------------------------------------------------------------*/
(2006) 
(2007) static
(2008) FRESULT chk_mounted (	/* FR_OK(0): successful, !=0: any error occurred */
(2009) 	const TCHAR **path,	/* Pointer to pointer to the path name (drive number) */
(2010) 	FATFS **rfs,		/* Pointer to pointer to the found file system object */
(2011) 	BYTE chk_wp			/* !=0: Check media write protection for write access */
(2012) )
(2013) {
(2014) 	BYTE fmt, b, pi, *tbl;
(2015) 	UINT vol;
(2016) 	DSTATUS stat;
(2017) 	DWORD bsect, fasize, tsect, sysect, nclst, szbfat;
(2018) 	WORD nrsv;
(2019) 	const TCHAR *p = *path;
    01293 01F6      MOVW	R30,R12
    01294 80A0      LD	R10,Z
    01295 80B1      LDD	R11,Z+1
(2020) 	FATFS *fs;
(2021) 
(2022) 	/* Get logical drive number from the path name */
(2023) 	vol = p[0] - '0';					/* Is there a drive number? */
    01296 01F5      MOVW	R30,R10
    01297 8180      LD	R24,Z
    01298 2799      CLR	R25
    01299 97C0      SBIW	R24,0x30
    0129A 017C      MOVW	R14,R24
(2024) 	if (vol <= 9 && p[1] == ':') {		/* Found a drive number, get and strip it */
    0129B E089      LDI	R24,0x9
    0129C E090      LDI	R25,0
    0129D 158E      CP	R24,R14
    0129E 059F      CPC	R25,R15
    0129F F050      BCS	0x12AA
    012A0 8181      LDD	R24,Z+1
    012A1 338A      CPI	R24,0x3A
    012A2 F439      BNE	0x12AA
(2025) 		p += 2; *path = p;				/* Return pointer to the path name */
    012A3 01CF      MOVW	R24,R30
    012A4 9602      ADIW	R24,2
    012A5 015C      MOVW	R10,R24
    012A6 01F6      MOVW	R30,R12
    012A7 82B1      STD	Z+1,R11
    012A8 82A0      ST	Z,R10
(2026) 	} else {							/* No drive number is given */
    012A9 C002      RJMP	0x12AC
(2027) #if _FS_RPATH
(2028) 		vol = CurrVol;					/* Use current drive */
(2029) #else
(2030) 		vol = 0;						/* Use drive 0 */
    012AA 24EE      CLR	R14
    012AB 24FF      CLR	R15
(2031) #endif
(2032) 	}
(2033) 
(2034) 	/* Check if the file system object is valid or not */
(2035) 	if (vol >= _VOLUMES) 				/* Is the drive number valid? */
    012AC 01C7      MOVW	R24,R14
    012AD 3081      CPI	R24,1
    012AE E0E0      LDI	R30,0
    012AF 079E      CPC	R25,R30
    012B0 F010      BCS	0x12B3
(2036) 		return FR_INVALID_DRIVE;
    012B1 E00B      LDI	R16,0xB
    012B2 C4CF      RJMP	0x1782
(2037) 	*rfs = fs = FatFs[vol];				/* Return pointer to the corresponding file system object */
    012B3 ED8A      LDI	R24,0xDA
    012B4 E095      LDI	R25,5
    012B5 01F7      MOVW	R30,R14
    012B6 0FEE      LSL	R30
    012B7 1FFF      ROL	R31
    012B8 0FE8      ADD	R30,R24
    012B9 1FF9      ADC	R31,R25
    012BA 8020      LD	R2,Z
    012BB 8031      LDD	R3,Z+1
    012BC A23E      STD	Y+38,R3
    012BD A22D      STD	Y+37,R2
    012BE A9E9      LDD	R30,Y+49
    012BF A9FA      LDD	R31,Y+50
    012C0 8231      STD	Z+1,R3
    012C1 8220      ST	Z,R2
(2038) 	if (!fs) return FR_NOT_ENABLED;		/* Is the file system object available? */
    012C2 0101      MOVW	R0,R2
    012C3 2022      TST	R2
    012C4 F421      BNE	0x12C9
    012C5 2033      TST	R3
    012C6 F411      BNE	0x12C9
    012C7 E00C      LDI	R16,0xC
    012C8 C4B9      RJMP	0x1782
(2039) 
(2040) 	ENTER_FF(fs);						/* Lock file system */
(2041) 
(2042) 	if (fs->fs_type) {					/* If the logical drive has been mounted */
    012C9 A1ED      LDD	R30,Y+37
    012CA A1FE      LDD	R31,Y+38
    012CB 8020      LD	R2,Z
    012CC 2022      TST	R2
    012CD F079      BEQ	0x12DD
(2043) 		stat = disk_status(fs->drv);
    012CE 8101      LDD	R16,Z+1
    012CF 940E 03CE CALL	_disk_status
    012D1 2EA0      MOV	R10,R16
(2044) 		if (!(stat & STA_NOINIT)) {		/* and the physical drive is kept initialized (has not been changed), */
    012D2 FD00      SBRC	R16,0
    012D3 C009      RJMP	0x12DD
(2045) 			if (!_FS_READONLY && chk_wp && (stat & STA_PROTECT))	/* Check write protection if needed */
    012D4 A80B      LDD	R0,Y+51
    012D5 2000      TST	R0
    012D6 F021      BEQ	0x12DB
    012D7 FF02      SBRS	R16,2
    012D8 C002      RJMP	0x12DB
(2046) 				return FR_WRITE_PROTECTED;
    012D9 E00A      LDI	R16,0xA
    012DA C4A7      RJMP	0x1782
(2047) 			return FR_OK;				/* The file system object is valid */
    012DB 2700      CLR	R16
    012DC C4A5      RJMP	0x1782
(2048) 		}
(2049) 	}
(2050) 
(2051) 	/* The file system object is not valid. */
(2052) 	/* Following code attempts to mount the volume. (analyze BPB and initialize the fs object) */
(2053) 
(2054) 	fs->fs_type = 0;					/* Clear the file system object */
    012DD 2422      CLR	R2
    012DE A1ED      LDD	R30,Y+37
    012DF A1FE      LDD	R31,Y+38
    012E0 8220      ST	Z,R2
(2055) 	fs->drv = LD2PD(vol);				/* Bind the logical drive and a physical drive */
    012E1 82E1      STD	Z+1,R14
(2056) 	stat = disk_initialize(fs->drv);	/* Initialize low level disk I/O layer */
    012E2 8101      LDD	R16,Z+1
    012E3 940E 03B8 CALL	_disk_initialize
    012E5 2EE0      MOV	R14,R16
    012E6 2CAE      MOV	R10,R14
(2057) 	if (stat & STA_NOINIT)				/* Check if the initialization succeeded */
    012E7 FF00      SBRS	R16,0
    012E8 C002      RJMP	0x12EB
(2058) 		return FR_NOT_READY;			/* Failed to initialize due to no media or hard error */
    012E9 E003      LDI	R16,3
    012EA C497      RJMP	0x1782
(2059) 	if (!_FS_READONLY && chk_wp && (stat & STA_PROTECT))	/* Check disk write protection if needed */
    012EB A80B      LDD	R0,Y+51
    012EC 2000      TST	R0
    012ED F021      BEQ	0x12F2
    012EE FEA2      SBRS	R10,2
    012EF C002      RJMP	0x12F2
(2060) 		return FR_WRITE_PROTECTED;
    012F0 E00A      LDI	R16,0xA
    012F1 C490      RJMP	0x1782
(2061) #if _MAX_SS != 512						/* Get disk sector size (variable sector size cfg only) */
(2062) 	if (disk_ioctl(fs->drv, GET_SECTOR_SIZE, &fs->ssize) != RES_OK)
(2063) 		return FR_DISK_ERR;
(2064) #endif
(2065) 	/* Search FAT partition on the drive. Supports only generic partitionings, FDISK and SFD. */
(2066) 	fmt = check_fs(fs, bsect = 0);		/* Load sector 0 and check if it is an FAT-VBR (in SFD) */
    012F2 E080      LDI	R24,0
    012F3 8B89      STD	Y+17,R24
    012F4 8B8A      STD	Y+18,R24
    012F5 8B8B      STD	Y+19,R24
    012F6 8B8C      STD	Y+20,R24
    012F7 E040      LDI	R20,0
    012F8 E050      LDI	R21,0
    012F9 E060      LDI	R22,0
    012FA E070      LDI	R23,0
    012FB 8368      ST	Y,R22
    012FC 8379      STD	Y+1,R23
    012FD 019A      MOVW	R18,R20
    012FE A10D      LDD	R16,Y+37
    012FF A11E      LDD	R17,Y+38
    01300 DEC4      RCALL	ff.c:check_fs
    01301 2EA0      MOV	R10,R16
    01302 2CCA      MOV	R12,R10
(2067) 	if (LD2PT(vol) && !fmt) fmt = 1;	/* Force non-SFD if the volume is forced partition */
    01303 C000      RJMP	0x1304
(2068) 	if (fmt == 1) {						/* Not an FAT-VBR, the physical drive can be partitioned */
    01304 2D8C      MOV	R24,R12
    01305 3081      CPI	R24,1
    01306 F009      BEQ	0x1308
    01307 C04C      RJMP	0x1354
(2069) 		/* Check the partition listed in the partition table */
(2070) 		pi = LD2PT(vol);
    01308 24AA      CLR	R10
(2071) 		if (pi) pi--;
    01309 F009      BEQ	0x130B
    0130A 94AA      DEC	R10
(2072) 		tbl = &fs->win[MBR_Table + pi * SZ_PTE];/* Partition table */
    0130B E100      LDI	R16,0x10
    0130C 2D1A      MOV	R17,R10
    0130D 0301      MULSU	R16,R17
    0130E 0150      MOVW	R10,R0
    0130F A18D      LDD	R24,Y+37
    01310 A19E      LDD	R25,Y+38
    01311 5184      SUBI	R24,0x14
    01312 4F9E      SBCI	R25,0xFE
    01313 0EA8      ADD	R10,R24
    01314 1EB9      ADC	R11,R25
(2073) 		if (tbl[4]) {						/* Is the partition existing? */
    01315 01F5      MOVW	R30,R10
    01316 8024      LDD	R2,Z+4
    01317 2022      TST	R2
    01318 F409      BNE	0x131A
    01319 C03A      RJMP	0x1354
(2074) 			bsect = LD_DWORD(&tbl[8]);		/* Partition offset in LBA */
    0131A E188      LDI	R24,0x18
    0131B E090      LDI	R25,0
    0131C 8503      LDD	R16,Z+11
    0131D 2711      CLR	R17
    0131E 2722      CLR	R18
    0131F 2733      CLR	R19
    01320 938A      ST	-Y,R24
    01321 940E 493E CALL	lsl32
    01323 0118      MOVW	R2,R16
    01324 0129      MOVW	R4,R18
    01325 01F5      MOVW	R30,R10
    01326 8462      LDD	R6,Z+10
    01327 2477      CLR	R7
    01328 2488      CLR	R8
    01329 2499      CLR	R9
    0132A 0143      MOVW	R8,R6
    0132B 2466      CLR	R6
    0132C 2477      CLR	R7
    0132D 2826      OR	R2,R6
    0132E 2837      OR	R3,R7
    0132F 2848      OR	R4,R8
    01330 2859      OR	R5,R9
    01331 8461      LDD	R6,Z+9
    01332 2477      CLR	R7
    01333 2C76      MOV	R7,R6
    01334 2466      CLR	R6
    01335 2488      CLR	R8
    01336 2499      CLR	R9
    01337 2826      OR	R2,R6
    01338 2837      OR	R3,R7
    01339 2848      OR	R4,R8
    0133A 2859      OR	R5,R9
    0133B 9638      ADIW	R30,0x8
    0133C 8060      LD	R6,Z
    0133D 2477      CLR	R7
    0133E 2488      CLR	R8
    0133F 2499      CLR	R9
    01340 2826      OR	R2,R6
    01341 2837      OR	R3,R7
    01342 2848      OR	R4,R8
    01343 2859      OR	R5,R9
    01344 8A29      STD	Y+17,R2
    01345 8A3A      STD	Y+18,R3
    01346 8A4B      STD	Y+19,R4
    01347 8A5C      STD	Y+20,R5
(2075) 			fmt = check_fs(fs, bsect);		/* Check the partition */
    01348 8829      LDD	R2,Y+17
    01349 883A      LDD	R3,Y+18
    0134A 884B      LDD	R4,Y+19
    0134B 885C      LDD	R5,Y+20
    0134C 8248      ST	Y,R4
    0134D 8259      STD	Y+1,R5
    0134E 0191      MOVW	R18,R2
    0134F A10D      LDD	R16,Y+37
    01350 A11E      LDD	R17,Y+38
    01351 DE73      RCALL	ff.c:check_fs
    01352 2EA0      MOV	R10,R16
    01353 2CCA      MOV	R12,R10
(2076) 		}
(2077) 	}
(2078) 	if (fmt == 3) return FR_DISK_ERR;
    01354 2D8C      MOV	R24,R12
    01355 3083      CPI	R24,3
    01356 F411      BNE	0x1359
    01357 E001      LDI	R16,1
    01358 C429      RJMP	0x1782
(2079) 	if (fmt) return FR_NO_FILESYSTEM;		/* No FAT volume is found */
    01359 20CC      TST	R12
    0135A F011      BEQ	0x135D
    0135B E00D      LDI	R16,0xD
    0135C C425      RJMP	0x1782
(2080) 
(2081) 	/* An FAT volume is found. Following code initializes the file system object */
(2082) 
(2083) 	if (LD_WORD(fs->win+BPB_BytsPerSec) != SS(fs))		/* (BPB_BytsPerSec must be equal to the physical sector size) */
    0135D A1ED      LDD	R30,Y+37
    0135E A1FE      LDD	R31,Y+38
    0135F AC21      LDD	R2,Z+57
    01360 2433      CLR	R3
    01361 AD82      LDD	R24,Z+58
    01362 2799      CLR	R25
    01363 2F98      MOV	R25,R24
    01364 2788      CLR	R24
    01365 2982      OR	R24,R2
    01366 2993      OR	R25,R3
    01367 3080      CPI	R24,0
    01368 E0E2      LDI	R30,2
    01369 079E      CPC	R25,R30
    0136A F011      BEQ	0x136D
(2084) 		return FR_NO_FILESYSTEM;
    0136B E00D      LDI	R16,0xD
    0136C C415      RJMP	0x1782
(2085) 
(2086) 	fasize = LD_WORD(fs->win+BPB_FATSz16);				/* Number of sectors per FAT */
    0136D A1ED      LDD	R30,Y+37
    0136E A1FE      LDD	R31,Y+38
    0136F 5BEC      SUBI	R30,0xBC
    01370 4FFF      SBCI	R31,0xFF
    01371 8020      LD	R2,Z
    01372 54E4      SUBI	R30,0x44
    01373 40F0      SBCI	R31,0
    01374 2433      CLR	R3
    01375 5BEB      SUBI	R30,0xBB
    01376 4FFF      SBCI	R31,0xFF
    01377 8040      LD	R4,Z
    01378 2455      CLR	R5
    01379 2C54      MOV	R5,R4
    0137A 2444      CLR	R4
    0137B 2842      OR	R4,R2
    0137C 2853      OR	R5,R3
    0137D 0112      MOVW	R2,R4
    0137E 2444      CLR	R4
    0137F 2455      CLR	R5
    01380 822D      STD	Y+5,R2
    01381 823E      STD	Y+6,R3
    01382 824F      STD	Y+7,R4
    01383 8658      STD	Y+8,R5
(2087) 	if (!fasize) fasize = LD_DWORD(fs->win+BPB_FATSz32);
    01384 802D      LDD	R2,Y+5
    01385 803E      LDD	R3,Y+6
    01386 804F      LDD	R4,Y+7
    01387 8458      LDD	R5,Y+8
    01388 9488      BCLR	0
    01389 2022      TST	R2
    0138A 0432      CPC	R3,R2
    0138B 0442      CPC	R4,R2
    0138C 0452      CPC	R5,R2
    0138D F009      BEQ	0x138F
    0138E C03C      RJMP	0x13CB
    0138F E188      LDI	R24,0x18
    01390 E090      LDI	R25,0
    01391 A1ED      LDD	R30,Y+37
    01392 A1FE      LDD	R31,Y+38
    01393 5AEB      SUBI	R30,0xAB
    01394 4FFF      SBCI	R31,0xFF
    01395 8100      LD	R16,Z
    01396 2711      CLR	R17
    01397 2722      CLR	R18
    01398 2733      CLR	R19
    01399 938A      ST	-Y,R24
    0139A 940E 493E CALL	lsl32
    0139C 0118      MOVW	R2,R16
    0139D 0129      MOVW	R4,R18
    0139E A1ED      LDD	R30,Y+37
    0139F A1FE      LDD	R31,Y+38
    013A0 5AEC      SUBI	R30,0xAC
    013A1 4FFF      SBCI	R31,0xFF
    013A2 8060      LD	R6,Z
    013A3 55E4      SUBI	R30,0x54
    013A4 40F0      SBCI	R31,0
    013A5 2477      CLR	R7
    013A6 2488      CLR	R8
    013A7 2499      CLR	R9
    013A8 0143      MOVW	R8,R6
    013A9 2466      CLR	R6
    013AA 2477      CLR	R7
    013AB 2826      OR	R2,R6
    013AC 2837      OR	R3,R7
    013AD 2848      OR	R4,R8
    013AE 2859      OR	R5,R9
    013AF 5AED      SUBI	R30,0xAD
    013B0 4FFF      SBCI	R31,0xFF
    013B1 8060      LD	R6,Z
    013B2 55E3      SUBI	R30,0x53
    013B3 40F0      SBCI	R31,0
    013B4 2477      CLR	R7
    013B5 2C76      MOV	R7,R6
    013B6 2466      CLR	R6
    013B7 2488      CLR	R8
    013B8 2499      CLR	R9
    013B9 2826      OR	R2,R6
    013BA 2837      OR	R3,R7
    013BB 2848      OR	R4,R8
    013BC 2859      OR	R5,R9
    013BD 5AEE      SUBI	R30,0xAE
    013BE 4FFF      SBCI	R31,0xFF
    013BF 8060      LD	R6,Z
    013C0 2477      CLR	R7
    013C1 2488      CLR	R8
    013C2 2499      CLR	R9
    013C3 2826      OR	R2,R6
    013C4 2837      OR	R3,R7
    013C5 2848      OR	R4,R8
    013C6 2859      OR	R5,R9
    013C7 822D      STD	Y+5,R2
    013C8 823E      STD	Y+6,R3
    013C9 824F      STD	Y+7,R4
    013CA 8658      STD	Y+8,R5
(2088) 	fs->fsize = fasize;
    013CB 802D      LDD	R2,Y+5
    013CC 803E      LDD	R3,Y+6
    013CD 804F      LDD	R4,Y+7
    013CE 8458      LDD	R5,Y+8
    013CF A1ED      LDD	R30,Y+37
    013D0 A1FE      LDD	R31,Y+38
    013D1 8E22      STD	Z+26,R2
    013D2 8E33      STD	Z+27,R3
    013D3 8E44      STD	Z+28,R4
    013D4 8E55      STD	Z+29,R5
(2089) 
(2090) 	fs->n_fats = b = fs->win[BPB_NumFATs];				/* Number of FAT copies */
    013D5 ACA6      LDD	R10,Z+62
    013D6 2CEA      MOV	R14,R10
    013D7 82A3      STD	Z+3,R10
(2091) 	if (b != 1 && b != 2) return FR_NO_FILESYSTEM;		/* (Must be 1 or 2) */
    013D8 2D8E      MOV	R24,R14
    013D9 3081      CPI	R24,1
    013DA F021      BEQ	0x13DF
    013DB 3082      CPI	R24,2
    013DC F011      BEQ	0x13DF
    013DD E00D      LDI	R16,0xD
    013DE C3A3      RJMP	0x1782
(2092) 	fasize *= b;										/* Number of sectors for FAT area */
    013DF 2C2E      MOV	R2,R14
    013E0 2433      CLR	R3
    013E1 2444      CLR	R4
    013E2 2455      CLR	R5
    013E3 810D      LDD	R16,Y+5
    013E4 811E      LDD	R17,Y+6
    013E5 812F      LDD	R18,Y+7
    013E6 8538      LDD	R19,Y+8
    013E7 925A      ST	-Y,R5
    013E8 924A      ST	-Y,R4
    013E9 923A      ST	-Y,R3
    013EA 922A      ST	-Y,R2
    013EB 940E 485F CALL	empy32u|empy32s
    013ED 830D      STD	Y+5,R16
    013EE 831E      STD	Y+6,R17
    013EF 832F      STD	Y+7,R18
    013F0 8738      STD	Y+8,R19
(2093) 
(2094) 	fs->csize = b = fs->win[BPB_SecPerClus];			/* Number of sectors per cluster */
    013F1 A1ED      LDD	R30,Y+37
    013F2 A1FE      LDD	R31,Y+38
    013F3 ACA3      LDD	R10,Z+59
    013F4 2CEA      MOV	R14,R10
    013F5 82A2      STD	Z+2,R10
(2095) 	if (!b || (b & (b - 1))) return FR_NO_FILESYSTEM;	/* (Must be power of 2) */
    013F6 20AA      TST	R10
    013F7 F029      BEQ	0x13FD
    013F8 2D8E      MOV	R24,R14
    013F9 5081      SUBI	R24,1
    013FA 2C2E      MOV	R2,R14
    013FB 2228      AND	R2,R24
    013FC F011      BEQ	0x13FF
    013FD E00D      LDI	R16,0xD
    013FE C383      RJMP	0x1782
(2096) 
(2097) 	fs->n_rootdir = LD_WORD(fs->win+BPB_RootEntCnt);	/* Number of root directory entries */
    013FF A1ED      LDD	R30,Y+37
    01400 A1FE      LDD	R31,Y+38
    01401 AC27      LDD	R2,Z+63
    01402 2433      CLR	R3
    01403 5CE0      SUBI	R30,0xC0
    01404 4FFF      SBCI	R31,0xFF
    01405 8040      LD	R4,Z
    01406 54E0      SUBI	R30,0x40
    01407 40F0      SBCI	R31,0
    01408 2455      CLR	R5
    01409 2C54      MOV	R5,R4
    0140A 2444      CLR	R4
    0140B 2842      OR	R4,R2
    0140C 2853      OR	R5,R3
    0140D 8651      STD	Z+9,R5
    0140E 8640      STD	Z+8,R4
(2098) 	if (fs->n_rootdir % (SS(fs) / SZ_DIR)) return FR_NO_FILESYSTEM;	/* (BPB_RootEntCnt must be sector aligned) */
    0140F 8580      LDD	R24,Z+8
    01410 8591      LDD	R25,Z+9
    01411 708F      ANDI	R24,0xF
    01412 7090      ANDI	R25,0
    01413 3080      CPI	R24,0
    01414 0789      CPC	R24,R25
    01415 F011      BEQ	0x1418
    01416 E00D      LDI	R16,0xD
    01417 C36A      RJMP	0x1782
(2099) 
(2100) 	tsect = LD_WORD(fs->win+BPB_TotSec16);				/* Number of sectors on the volume */
    01418 A1ED      LDD	R30,Y+37
    01419 A1FE      LDD	R31,Y+38
    0141A 5BEF      SUBI	R30,0xBF
    0141B 4FFF      SBCI	R31,0xFF
    0141C 8020      LD	R2,Z
    0141D 54E1      SUBI	R30,0x41
    0141E 40F0      SBCI	R31,0
    0141F 2433      CLR	R3
    01420 5BEE      SUBI	R30,0xBE
    01421 4FFF      SBCI	R31,0xFF
    01422 8040      LD	R4,Z
    01423 2455      CLR	R5
    01424 2C54      MOV	R5,R4
    01425 2444      CLR	R4
    01426 2842      OR	R4,R2
    01427 2853      OR	R5,R3
    01428 0112      MOVW	R2,R4
    01429 2444      CLR	R4
    0142A 2455      CLR	R5
    0142B 862D      STD	Y+13,R2
    0142C 863E      STD	Y+14,R3
    0142D 864F      STD	Y+15,R4
    0142E 8A58      STD	Y+16,R5
(2101) 	if (!tsect) tsect = LD_DWORD(fs->win+BPB_TotSec32);
    0142F 842D      LDD	R2,Y+13
    01430 843E      LDD	R3,Y+14
    01431 844F      LDD	R4,Y+15
    01432 8858      LDD	R5,Y+16
    01433 9488      BCLR	0
    01434 2022      TST	R2
    01435 0432      CPC	R3,R2
    01436 0442      CPC	R4,R2
    01437 0452      CPC	R5,R2
    01438 F009      BEQ	0x143A
    01439 C03C      RJMP	0x1476
    0143A E188      LDI	R24,0x18
    0143B E090      LDI	R25,0
    0143C A1ED      LDD	R30,Y+37
    0143D A1FE      LDD	R31,Y+38
    0143E 5AEF      SUBI	R30,0xAF
    0143F 4FFF      SBCI	R31,0xFF
    01440 8100      LD	R16,Z
    01441 2711      CLR	R17
    01442 2722      CLR	R18
    01443 2733      CLR	R19
    01444 938A      ST	-Y,R24
    01445 940E 493E CALL	lsl32
    01447 0118      MOVW	R2,R16
    01448 0129      MOVW	R4,R18
    01449 A1ED      LDD	R30,Y+37
    0144A A1FE      LDD	R31,Y+38
    0144B 5BE0      SUBI	R30,0xB0
    0144C 4FFF      SBCI	R31,0xFF
    0144D 8060      LD	R6,Z
    0144E 55E0      SUBI	R30,0x50
    0144F 40F0      SBCI	R31,0
    01450 2477      CLR	R7
    01451 2488      CLR	R8
    01452 2499      CLR	R9
    01453 0143      MOVW	R8,R6
    01454 2466      CLR	R6
    01455 2477      CLR	R7
    01456 2826      OR	R2,R6
    01457 2837      OR	R3,R7
    01458 2848      OR	R4,R8
    01459 2859      OR	R5,R9
    0145A 5BE1      SUBI	R30,0xB1
    0145B 4FFF      SBCI	R31,0xFF
    0145C 8060      LD	R6,Z
    0145D 54EF      SUBI	R30,0x4F
    0145E 40F0      SBCI	R31,0
    0145F 2477      CLR	R7
    01460 2C76      MOV	R7,R6
    01461 2466      CLR	R6
    01462 2488      CLR	R8
    01463 2499      CLR	R9
    01464 2826      OR	R2,R6
    01465 2837      OR	R3,R7
    01466 2848      OR	R4,R8
    01467 2859      OR	R5,R9
    01468 5BE2      SUBI	R30,0xB2
    01469 4FFF      SBCI	R31,0xFF
    0146A 8060      LD	R6,Z
    0146B 2477      CLR	R7
    0146C 2488      CLR	R8
    0146D 2499      CLR	R9
    0146E 2826      OR	R2,R6
    0146F 2837      OR	R3,R7
    01470 2848      OR	R4,R8
    01471 2859      OR	R5,R9
    01472 862D      STD	Y+13,R2
    01473 863E      STD	Y+14,R3
    01474 864F      STD	Y+15,R4
    01475 8A58      STD	Y+16,R5
(2102) 
(2103) 	nrsv = LD_WORD(fs->win+BPB_RsvdSecCnt);				/* Number of reserved sectors */
    01476 A1ED      LDD	R30,Y+37
    01477 A1FE      LDD	R31,Y+38
    01478 AC24      LDD	R2,Z+60
    01479 2433      CLR	R3
    0147A ACE5      LDD	R14,Z+61
    0147B 24FF      CLR	R15
    0147C 2CFE      MOV	R15,R14
    0147D 24EE      CLR	R14
    0147E 28E2      OR	R14,R2
    0147F 28F3      OR	R15,R3
(2104) 	if (!nrsv) return FR_NO_FILESYSTEM;					/* (BPB_RsvdSecCnt must not be 0) */
    01480 20EE      TST	R14
    01481 F421      BNE	0x1486
    01482 20FF      TST	R15
    01483 F411      BNE	0x1486
    01484 E00D      LDI	R16,0xD
    01485 C2FC      RJMP	0x1782
(2105) 
(2106) 	/* Determine the FAT sub type */
(2107) 	sysect = nrsv + fasize + fs->n_rootdir / (SS(fs) / SZ_DIR);	/* RSV+FAT+DIR */
    01486 802D      LDD	R2,Y+5
    01487 803E      LDD	R3,Y+6
    01488 804F      LDD	R4,Y+7
    01489 8458      LDD	R5,Y+8
    0148A 0137      MOVW	R6,R14
    0148B 2488      CLR	R8
    0148C 2499      CLR	R9
    0148D 0C62      ADD	R6,R2
    0148E 1C73      ADC	R7,R3
    0148F 1C84      ADC	R8,R4
    01490 1C95      ADC	R9,R5
    01491 A1ED      LDD	R30,Y+37
    01492 A1FE      LDD	R31,Y+38
    01493 9638      ADIW	R30,0x8
    01494 8020      LD	R2,Z
    01495 8031      LDD	R3,Z+1
    01496 9436      LSR	R3
    01497 9427      ROR	R2
    01498 9436      LSR	R3
    01499 9427      ROR	R2
    0149A 9436      LSR	R3
    0149B 9427      ROR	R2
    0149C 9436      LSR	R3
    0149D 9427      ROR	R2
    0149E 2444      CLR	R4
    0149F 2455      CLR	R5
    014A0 0C62      ADD	R6,R2
    014A1 1C73      ADC	R7,R3
    014A2 1C84      ADC	R8,R4
    014A3 1C95      ADC	R9,R5
    014A4 8A6D      STD	Y+21,R6
    014A5 8A7E      STD	Y+22,R7
    014A6 8A8F      STD	Y+23,R8
    014A7 8E98      STD	Y+24,R9
(2108) 	if (tsect < sysect) return FR_NO_FILESYSTEM;		/* (Invalid volume size) */
    014A8 882D      LDD	R2,Y+21
    014A9 883E      LDD	R3,Y+22
    014AA 884F      LDD	R4,Y+23
    014AB 8C58      LDD	R5,Y+24
    014AC 846D      LDD	R6,Y+13
    014AD 847E      LDD	R7,Y+14
    014AE 848F      LDD	R8,Y+15
    014AF 8898      LDD	R9,Y+16
    014B0 1462      CP	R6,R2
    014B1 0473      CPC	R7,R3
    014B2 0484      CPC	R8,R4
    014B3 0495      CPC	R9,R5
    014B4 F410      BCC	0x14B7
    014B5 E00D      LDI	R16,0xD
    014B6 C2CB      RJMP	0x1782
(2109) 	nclst = (tsect - sysect) / fs->csize;				/* Number of clusters */
    014B7 882D      LDD	R2,Y+21
    014B8 883E      LDD	R3,Y+22
    014B9 884F      LDD	R4,Y+23
    014BA 8C58      LDD	R5,Y+24
    014BB 850D      LDD	R16,Y+13
    014BC 851E      LDD	R17,Y+14
    014BD 852F      LDD	R18,Y+15
    014BE 8938      LDD	R19,Y+16
    014BF 1902      SUB	R16,R2
    014C0 0913      SBC	R17,R3
    014C1 0924      SBC	R18,R4
    014C2 0935      SBC	R19,R5
    014C3 A1ED      LDD	R30,Y+37
    014C4 A1FE      LDD	R31,Y+38
    014C5 9632      ADIW	R30,2
    014C6 8020      LD	R2,Z
    014C7 2433      CLR	R3
    014C8 2444      CLR	R4
    014C9 2455      CLR	R5
    014CA 925A      ST	-Y,R5
    014CB 924A      ST	-Y,R4
    014CC 923A      ST	-Y,R3
    014CD 922A      ST	-Y,R2
    014CE 940E 47B9 CALL	div32u
    014D0 8709      STD	Y+9,R16
    014D1 871A      STD	Y+10,R17
    014D2 872B      STD	Y+11,R18
    014D3 873C      STD	Y+12,R19
(2110) 	if (!nclst) return FR_NO_FILESYSTEM;				/* (Invalid volume size) */
    014D4 8429      LDD	R2,Y+9
    014D5 843A      LDD	R3,Y+10
    014D6 844B      LDD	R4,Y+11
    014D7 845C      LDD	R5,Y+12
    014D8 9488      BCLR	0
    014D9 2022      TST	R2
    014DA 0432      CPC	R3,R2
    014DB 0442      CPC	R4,R2
    014DC 0452      CPC	R5,R2
    014DD F411      BNE	0x14E0
    014DE E00D      LDI	R16,0xD
    014DF C2A2      RJMP	0x1782
(2111) 	fmt = FS_FAT12;
    014E0 24CC      CLR	R12
    014E1 94C3      INC	R12
(2112) 	if (nclst >= MIN_FAT16) fmt = FS_FAT16;
    014E2 EF46      LDI	R20,0xF6
    014E3 E05F      LDI	R21,0xF
    014E4 E060      LDI	R22,0
    014E5 E070      LDI	R23,0
    014E6 8429      LDD	R2,Y+9
    014E7 843A      LDD	R3,Y+10
    014E8 844B      LDD	R4,Y+11
    014E9 845C      LDD	R5,Y+12
    014EA 1624      CP	R2,R20
    014EB 0635      CPC	R3,R21
    014EC 0646      CPC	R4,R22
    014ED 0657      CPC	R5,R23
    014EE F010      BCS	0x14F1
    014EF E082      LDI	R24,2
    014F0 2EC8      MOV	R12,R24
(2113) 	if (nclst >= MIN_FAT32) fmt = FS_FAT32;
    014F1 EF46      LDI	R20,0xF6
    014F2 EF5F      LDI	R21,0xFF
    014F3 E060      LDI	R22,0
    014F4 E070      LDI	R23,0
    014F5 8429      LDD	R2,Y+9
    014F6 843A      LDD	R3,Y+10
    014F7 844B      LDD	R4,Y+11
    014F8 845C      LDD	R5,Y+12
    014F9 1624      CP	R2,R20
    014FA 0635      CPC	R3,R21
    014FB 0646      CPC	R4,R22
    014FC 0657      CPC	R5,R23
    014FD F010      BCS	0x1500
    014FE E083      LDI	R24,3
    014FF 2EC8      MOV	R12,R24
(2114) 
(2115) 	/* Boundaries and Limits */
(2116) 	fs->n_fatent = nclst + 2;							/* Number of FAT entries */
    01500 E042      LDI	R20,2
    01501 E050      LDI	R21,0
    01502 E060      LDI	R22,0
    01503 E070      LDI	R23,0
    01504 8429      LDD	R2,Y+9
    01505 843A      LDD	R3,Y+10
    01506 844B      LDD	R4,Y+11
    01507 845C      LDD	R5,Y+12
    01508 0E24      ADD	R2,R20
    01509 1E35      ADC	R3,R21
    0150A 1E46      ADC	R4,R22
    0150B 1E57      ADC	R5,R23
    0150C A1ED      LDD	R30,Y+37
    0150D A1FE      LDD	R31,Y+38
    0150E 9676      ADIW	R30,0x16
    0150F 8220      ST	Z,R2
    01510 8231      STD	Z+1,R3
    01511 8242      STD	Z+2,R4
    01512 8253      STD	Z+3,R5
(2117) 	fs->database = bsect + sysect;						/* Data start sector */
    01513 882D      LDD	R2,Y+21
    01514 883E      LDD	R3,Y+22
    01515 884F      LDD	R4,Y+23
    01516 8C58      LDD	R5,Y+24
    01517 8869      LDD	R6,Y+17
    01518 887A      LDD	R7,Y+18
    01519 888B      LDD	R8,Y+19
    0151A 889C      LDD	R9,Y+20
    0151B 0C62      ADD	R6,R2
    0151C 1C73      ADC	R7,R3
    0151D 1C84      ADC	R8,R4
    0151E 1C95      ADC	R9,R5
    0151F A1ED      LDD	R30,Y+37
    01520 A1FE      LDD	R31,Y+38
    01521 96B6      ADIW	R30,0x26
    01522 8260      ST	Z,R6
    01523 8271      STD	Z+1,R7
    01524 8282      STD	Z+2,R8
    01525 8293      STD	Z+3,R9
(2118) 	fs->fatbase = bsect + nrsv; 						/* FAT start sector */
    01526 0117      MOVW	R2,R14
    01527 2444      CLR	R4
    01528 2455      CLR	R5
    01529 8869      LDD	R6,Y+17
    0152A 887A      LDD	R7,Y+18
    0152B 888B      LDD	R8,Y+19
    0152C 889C      LDD	R9,Y+20
    0152D 0C62      ADD	R6,R2
    0152E 1C73      ADC	R7,R3
    0152F 1C84      ADC	R8,R4
    01530 1C95      ADC	R9,R5
    01531 A1ED      LDD	R30,Y+37
    01532 A1FE      LDD	R31,Y+38
    01533 8E66      STD	Z+30,R6
    01534 8E77      STD	Z+31,R7
    01535 A280      STD	Z+32,R8
    01536 A291      STD	Z+33,R9
(2119) 	if (fmt == FS_FAT32) {
    01537 2D8C      MOV	R24,R12
    01538 3083      CPI	R24,3
    01539 F009      BEQ	0x153B
    0153A C055      RJMP	0x1590
(2120) 		if (fs->n_rootdir) return FR_NO_FILESYSTEM;		/* (BPB_RootEntCnt must be 0) */
    0153B 8420      LDD	R2,Z+8
    0153C 8431      LDD	R3,Z+9
    0153D 2022      TST	R2
    0153E F411      BNE	0x1541
    0153F 2033      TST	R3
    01540 F011      BEQ	0x1543
    01541 E00D      LDI	R16,0xD
    01542 C23F      RJMP	0x1782
(2121) 		fs->dirbase = LD_DWORD(fs->win+BPB_RootClus);	/* Root directory start cluster */
    01543 E188      LDI	R24,0x18
    01544 E090      LDI	R25,0
    01545 A1ED      LDD	R30,Y+37
    01546 A1FE      LDD	R31,Y+38
    01547 5AE3      SUBI	R30,0xA3
    01548 4FFF      SBCI	R31,0xFF
    01549 8100      LD	R16,Z
    0154A 2711      CLR	R17
    0154B 2722      CLR	R18
    0154C 2733      CLR	R19
    0154D 938A      ST	-Y,R24
    0154E 940E 493E CALL	lsl32
    01550 0118      MOVW	R2,R16
    01551 0129      MOVW	R4,R18
    01552 A1ED      LDD	R30,Y+37
    01553 A1FE      LDD	R31,Y+38
    01554 5AE4      SUBI	R30,0xA4
    01555 4FFF      SBCI	R31,0xFF
    01556 8060      LD	R6,Z
    01557 55EC      SUBI	R30,0x5C
    01558 40F0      SBCI	R31,0
    01559 2477      CLR	R7
    0155A 2488      CLR	R8
    0155B 2499      CLR	R9
    0155C 0143      MOVW	R8,R6
    0155D 2466      CLR	R6
    0155E 2477      CLR	R7
    0155F 2826      OR	R2,R6
    01560 2837      OR	R3,R7
    01561 2848      OR	R4,R8
    01562 2859      OR	R5,R9
    01563 5AE5      SUBI	R30,0xA5
    01564 4FFF      SBCI	R31,0xFF
    01565 8060      LD	R6,Z
    01566 55EB      SUBI	R30,0x5B
    01567 40F0      SBCI	R31,0
    01568 2477      CLR	R7
    01569 2C76      MOV	R7,R6
    0156A 2466      CLR	R6
    0156B 2488      CLR	R8
    0156C 2499      CLR	R9
    0156D 2826      OR	R2,R6
    0156E 2837      OR	R3,R7
    0156F 2848      OR	R4,R8
    01570 2859      OR	R5,R9
    01571 5AE6      SUBI	R30,0xA6
    01572 4FFF      SBCI	R31,0xFF
    01573 8060      LD	R6,Z
    01574 55EA      SUBI	R30,0x5A
    01575 40F0      SBCI	R31,0
    01576 2477      CLR	R7
    01577 2488      CLR	R8
    01578 2499      CLR	R9
    01579 2826      OR	R2,R6
    0157A 2837      OR	R3,R7
    0157B 2848      OR	R4,R8
    0157C 2859      OR	R5,R9
    0157D A222      STD	Z+34,R2
    0157E A233      STD	Z+35,R3
    0157F A244      STD	Z+36,R4
    01580 A255      STD	Z+37,R5
(2122) 		szbfat = fs->n_fatent * 4;						/* (Required FAT size) */
    01581 E082      LDI	R24,2
    01582 E090      LDI	R25,0
    01583 9676      ADIW	R30,0x16
    01584 8100      LD	R16,Z
    01585 8111      LDD	R17,Z+1
    01586 8122      LDD	R18,Z+2
    01587 8133      LDD	R19,Z+3
    01588 938A      ST	-Y,R24
    01589 940E 493E CALL	lsl32
    0158B 8F09      STD	Y+25,R16
    0158C 8F1A      STD	Y+26,R17
    0158D 8F2B      STD	Y+27,R18
    0158E 8F3C      STD	Y+28,R19
(2123) 	} else {
    0158F C06A      RJMP	0x15FA
(2124) 		if (!fs->n_rootdir)	return FR_NO_FILESYSTEM;	/* (BPB_RootEntCnt must not be 0) */
    01590 A1ED      LDD	R30,Y+37
    01591 A1FE      LDD	R31,Y+38
    01592 8420      LDD	R2,Z+8
    01593 8431      LDD	R3,Z+9
    01594 2022      TST	R2
    01595 F421      BNE	0x159A
    01596 2033      TST	R3
    01597 F411      BNE	0x159A
    01598 E00D      LDI	R16,0xD
    01599 C1E8      RJMP	0x1782
(2125) 		fs->dirbase = fs->fatbase + fasize;				/* Root directory start sector */
    0159A 802D      LDD	R2,Y+5
    0159B 803E      LDD	R3,Y+6
    0159C 804F      LDD	R4,Y+7
    0159D 8458      LDD	R5,Y+8
    0159E A1ED      LDD	R30,Y+37
    0159F A1FE      LDD	R31,Y+38
    015A0 8C66      LDD	R6,Z+30
    015A1 8C77      LDD	R7,Z+31
    015A2 A080      LDD	R8,Z+32
    015A3 A091      LDD	R9,Z+33
    015A4 0C62      ADD	R6,R2
    015A5 1C73      ADC	R7,R3
    015A6 1C84      ADC	R8,R4
    015A7 1C95      ADC	R9,R5
    015A8 A262      STD	Z+34,R6
    015A9 A273      STD	Z+35,R7
    015AA A284      STD	Z+36,R8
    015AB A295      STD	Z+37,R9
(2126) 		szbfat = (fmt == FS_FAT16) ?					/* (Required FAT size) */
    015AC 2D8C      MOV	R24,R12
    015AD 3082      CPI	R24,2
    015AE F471      BNE	0x15BD
    015AF 9676      ADIW	R30,0x16
    015B0 8020      LD	R2,Z
    015B1 8031      LDD	R3,Z+1
    015B2 8042      LDD	R4,Z+2
    015B3 8053      LDD	R5,Z+3
    015B4 0C22      LSL	R2
    015B5 1C33      ROL	R3
    015B6 1C44      ROL	R4
    015B7 1C55      ROL	R5
    015B8 8E2D      STD	Y+29,R2
    015B9 8E3E      STD	Y+30,R3
    015BA 8E4F      STD	Y+31,R4
    015BB A258      STD	Y+32,R5
    015BC C035      RJMP	0x15F2
    015BD A1ED      LDD	R30,Y+37
    015BE A1FE      LDD	R31,Y+38
    015BF 9676      ADIW	R30,0x16
    015C0 8020      LD	R2,Z
    015C1 8031      LDD	R3,Z+1
    015C2 8042      LDD	R4,Z+2
    015C3 8053      LDD	R5,Z+3
    015C4 A229      STD	Y+33,R2
    015C5 A23A      STD	Y+34,R3
    015C6 A24B      STD	Y+35,R4
    015C7 A25C      STD	Y+36,R5
    015C8 E041      LDI	R20,1
    015C9 E050      LDI	R21,0
    015CA E060      LDI	R22,0
    015CB E070      LDI	R23,0
    015CC A029      LDD	R2,Y+33
    015CD A03A      LDD	R3,Y+34
    015CE A04B      LDD	R4,Y+35
    015CF A05C      LDD	R5,Y+36
    015D0 2224      AND	R2,R20
    015D1 2235      AND	R3,R21
    015D2 2246      AND	R4,R22
    015D3 2257      AND	R5,R23
    015D4 A069      LDD	R6,Y+33
    015D5 A07A      LDD	R7,Y+34
    015D6 A08B      LDD	R8,Y+35
    015D7 A09C      LDD	R9,Y+36
    015D8 E043      LDI	R20,3
    015D9 E050      LDI	R21,0
    015DA E060      LDI	R22,0
    015DB E070      LDI	R23,0
    015DC 929A      ST	-Y,R9
    015DD 928A      ST	-Y,R8
    015DE 927A      ST	-Y,R7
    015DF 926A      ST	-Y,R6
    015E0 018A      MOVW	R16,R20
    015E1 019B      MOVW	R18,R22
    015E2 940E 485F CALL	empy32u|empy32s
    015E4 0138      MOVW	R6,R16
    015E5 0149      MOVW	R8,R18
    015E6 9496      LSR	R9
    015E7 9487      ROR	R8
    015E8 9477      ROR	R7
    015E9 9467      ROR	R6
    015EA 0C62      ADD	R6,R2
    015EB 1C73      ADC	R7,R3
    015EC 1C84      ADC	R8,R4
    015ED 1C95      ADC	R9,R5
    015EE 8E6D      STD	Y+29,R6
    015EF 8E7E      STD	Y+30,R7
    015F0 8E8F      STD	Y+31,R8
    015F1 A298      STD	Y+32,R9
    015F2 8C2D      LDD	R2,Y+29
    015F3 8C3E      LDD	R3,Y+30
    015F4 8C4F      LDD	R4,Y+31
    015F5 A058      LDD	R5,Y+32
    015F6 8E29      STD	Y+25,R2
    015F7 8E3A      STD	Y+26,R3
    015F8 8E4B      STD	Y+27,R4
    015F9 8E5C      STD	Y+28,R5
(2127) 			fs->n_fatent * 2 : fs->n_fatent * 3 / 2 + (fs->n_fatent & 1);
(2128) 	}
(2129) 	if (fs->fsize < (szbfat + (SS(fs) - 1)) / SS(fs))	/* (BPB_FATSz must not be less than required) */
    015FA EF4F      LDI	R20,0xFF
    015FB E051      LDI	R21,1
    015FC E060      LDI	R22,0
    015FD E070      LDI	R23,0
    015FE 8D09      LDD	R16,Y+25
    015FF 8D1A      LDD	R17,Y+26
    01600 8D2B      LDD	R18,Y+27
    01601 8D3C      LDD	R19,Y+28
    01602 0F04      ADD	R16,R20
    01603 1F15      ADC	R17,R21
    01604 1F26      ADC	R18,R22
    01605 1F37      ADC	R19,R23
    01606 E089      LDI	R24,0x9
    01607 E090      LDI	R25,0
    01608 938A      ST	-Y,R24
    01609 940E 4957 CALL	lsr32
    0160B A1ED      LDD	R30,Y+37
    0160C A1FE      LDD	R31,Y+38
    0160D 8C22      LDD	R2,Z+26
    0160E 8C33      LDD	R3,Z+27
    0160F 8C44      LDD	R4,Z+28
    01610 8C55      LDD	R5,Z+29
    01611 1620      CP	R2,R16
    01612 0631      CPC	R3,R17
    01613 0642      CPC	R4,R18
    01614 0653      CPC	R5,R19
    01615 F410      BCC	0x1618
(2130) 		return FR_NO_FILESYSTEM;
    01616 E00D      LDI	R16,0xD
    01617 C16A      RJMP	0x1782
(2131) 
(2132) #if !_FS_READONLY
(2133) 	/* Initialize cluster allocation information */
(2134) 	fs->free_clust = 0xFFFFFFFF;
    01618 A1ED      LDD	R30,Y+37
    01619 A1FE      LDD	R31,Y+38
    0161A 963E      ADIW	R30,0xE
    0161B EF8F      LDI	R24,0xFF
    0161C 8380      ST	Z,R24
    0161D 8381      STD	Z+1,R24
    0161E 8382      STD	Z+2,R24
    0161F 8383      STD	Z+3,R24
(2135) 	fs->last_clust = 0;
    01620 A1ED      LDD	R30,Y+37
    01621 A1FE      LDD	R31,Y+38
    01622 963A      ADIW	R30,0xA
    01623 E080      LDI	R24,0
    01624 8380      ST	Z,R24
    01625 8381      STD	Z+1,R24
    01626 8382      STD	Z+2,R24
    01627 8383      STD	Z+3,R24
(2136) 
(2137) 	/* Get fsinfo if available */
(2138) 	if (fmt == FS_FAT32) {
    01628 2D8C      MOV	R24,R12
    01629 3083      CPI	R24,3
    0162A F009      BEQ	0x162C
    0162B C13C      RJMP	0x1768
(2139) 	 	fs->fsi_flag = 0;
    0162C 2422      CLR	R2
    0162D A1ED      LDD	R30,Y+37
    0162E A1FE      LDD	R31,Y+38
    0162F 8225      STD	Z+5,R2
(2140) 		fs->fsi_sector = bsect + LD_WORD(fs->win+BPB_FSInfo);
    01630 5AE2      SUBI	R30,0xA2
    01631 4FFF      SBCI	R31,0xFF
    01632 8020      LD	R2,Z
    01633 55EE      SUBI	R30,0x5E
    01634 40F0      SBCI	R31,0
    01635 2433      CLR	R3
    01636 5AE1      SUBI	R30,0xA1
    01637 4FFF      SBCI	R31,0xFF
    01638 8040      LD	R4,Z
    01639 2455      CLR	R5
    0163A 2C54      MOV	R5,R4
    0163B 2444      CLR	R4
    0163C 2842      OR	R4,R2
    0163D 2853      OR	R5,R3
    0163E 0112      MOVW	R2,R4
    0163F 2444      CLR	R4
    01640 2455      CLR	R5
    01641 8869      LDD	R6,Y+17
    01642 887A      LDD	R7,Y+18
    01643 888B      LDD	R8,Y+19
    01644 889C      LDD	R9,Y+20
    01645 0C62      ADD	R6,R2
    01646 1C73      ADC	R7,R3
    01647 1C84      ADC	R8,R4
    01648 1C95      ADC	R9,R5
    01649 A1ED      LDD	R30,Y+37
    0164A A1FE      LDD	R31,Y+38
    0164B 8A62      STD	Z+18,R6
    0164C 8A73      STD	Z+19,R7
    0164D 8A84      STD	Z+20,R8
    0164E 8A95      STD	Z+21,R9
(2141) 		if (disk_read(fs->drv, fs->win, fs->fsi_sector, 1) == RES_OK &&
    0164F E081      LDI	R24,1
    01650 838C      STD	Y+4,R24
    01651 8822      LDD	R2,Z+18
    01652 8833      LDD	R3,Z+19
    01653 8844      LDD	R4,Z+20
    01654 8855      LDD	R5,Z+21
    01655 8228      ST	Y,R2
    01656 8239      STD	Y+1,R3
    01657 824A      STD	Y+2,R4
    01658 825B      STD	Y+3,R5
    01659 019F      MOVW	R18,R30
    0165A 5D22      SUBI	R18,0xD2
    0165B 4F3F      SBCI	R19,0xFF
    0165C 8101      LDD	R16,Z+1
    0165D 940E 03D4 CALL	_disk_read
    0165F 2EE0      MOV	R14,R16
    01660 2300      TST	R16
    01661 F009      BEQ	0x1663
    01662 C105      RJMP	0x1768
    01663 A1ED      LDD	R30,Y+37
    01664 A1FE      LDD	R31,Y+38
    01665 5DE4      SUBI	R30,0xD4
    01666 4FFD      SBCI	R31,0xFD
    01667 8020      LD	R2,Z
    01668 52EC      SUBI	R30,0x2C
    01669 40F2      SBCI	R31,2
    0166A 2433      CLR	R3
    0166B 5DE3      SUBI	R30,0xD3
    0166C 4FFD      SBCI	R31,0xFD
    0166D 8180      LD	R24,Z
    0166E 52ED      SUBI	R30,0x2D
    0166F 40F2      SBCI	R31,2
    01670 2799      CLR	R25
    01671 2F98      MOV	R25,R24
    01672 2788      CLR	R24
    01673 2982      OR	R24,R2
    01674 2993      OR	R25,R3
    01675 3585      CPI	R24,0x55
    01676 EAAA      LDI	R26,0xAA
    01677 079A      CPC	R25,R26
    01678 F009      BEQ	0x167A
    01679 C0EE      RJMP	0x1768
    0167A E188      LDI	R24,0x18
    0167B E090      LDI	R25,0
    0167C A901      LDD	R16,Z+49
    0167D 2711      CLR	R17
    0167E 2722      CLR	R18
    0167F 2733      CLR	R19
    01680 938A      ST	-Y,R24
    01681 940E 493E CALL	lsl32
    01683 0118      MOVW	R2,R16
    01684 0129      MOVW	R4,R18
    01685 A1ED      LDD	R30,Y+37
    01686 A1FE      LDD	R31,Y+38
    01687 A860      LDD	R6,Z+48
    01688 2477      CLR	R7
    01689 2488      CLR	R8
    0168A 2499      CLR	R9
    0168B 0143      MOVW	R8,R6
    0168C 2466      CLR	R6
    0168D 2477      CLR	R7
    0168E 2826      OR	R2,R6
    0168F 2837      OR	R3,R7
    01690 2848      OR	R4,R8
    01691 2859      OR	R5,R9
    01692 A467      LDD	R6,Z+47
    01693 2477      CLR	R7
    01694 2C76      MOV	R7,R6
    01695 2466      CLR	R6
    01696 2488      CLR	R8
    01697 2499      CLR	R9
    01698 2826      OR	R2,R6
    01699 2837      OR	R3,R7
    0169A 2848      OR	R4,R8
    0169B 2859      OR	R5,R9
    0169C A466      LDD	R6,Z+46
    0169D 2477      CLR	R7
    0169E 2488      CLR	R8
    0169F 2499      CLR	R9
    016A0 2826      OR	R2,R6
    016A1 2837      OR	R3,R7
    016A2 2848      OR	R4,R8
    016A3 2859      OR	R5,R9
    016A4 E542      LDI	R20,0x52
    016A5 E552      LDI	R21,0x52
    016A6 E661      LDI	R22,0x61
    016A7 E471      LDI	R23,0x41
    016A8 1624      CP	R2,R20
    016A9 0635      CPC	R3,R21
    016AA 0646      CPC	R4,R22
    016AB 0657      CPC	R5,R23
    016AC F009      BEQ	0x16AE
    016AD C0BA      RJMP	0x1768
    016AE E188      LDI	R24,0x18
    016AF E090      LDI	R25,0
    016B0 5EEB      SUBI	R30,0xEB
    016B1 4FFD      SBCI	R31,0xFD
    016B2 8100      LD	R16,Z
    016B3 2711      CLR	R17
    016B4 2722      CLR	R18
    016B5 2733      CLR	R19
    016B6 938A      ST	-Y,R24
    016B7 940E 493E CALL	lsl32
    016B9 0118      MOVW	R2,R16
    016BA 0129      MOVW	R4,R18
    016BB A1ED      LDD	R30,Y+37
    016BC A1FE      LDD	R31,Y+38
    016BD 5EEC      SUBI	R30,0xEC
    016BE 4FFD      SBCI	R31,0xFD
    016BF 8060      LD	R6,Z
    016C0 51E4      SUBI	R30,0x14
    016C1 40F2      SBCI	R31,2
    016C2 2477      CLR	R7
    016C3 2488      CLR	R8
    016C4 2499      CLR	R9
    016C5 0143      MOVW	R8,R6
    016C6 2466      CLR	R6
    016C7 2477      CLR	R7
    016C8 2826      OR	R2,R6
    016C9 2837      OR	R3,R7
    016CA 2848      OR	R4,R8
    016CB 2859      OR	R5,R9
    016CC 5EED      SUBI	R30,0xED
    016CD 4FFD      SBCI	R31,0xFD
    016CE 8060      LD	R6,Z
    016CF 51E3      SUBI	R30,0x13
    016D0 40F2      SBCI	R31,2
    016D1 2477      CLR	R7
    016D2 2C76      MOV	R7,R6
    016D3 2466      CLR	R6
    016D4 2488      CLR	R8
    016D5 2499      CLR	R9
    016D6 2826      OR	R2,R6
    016D7 2837      OR	R3,R7
    016D8 2848      OR	R4,R8
    016D9 2859      OR	R5,R9
    016DA 5EEE      SUBI	R30,0xEE
    016DB 4FFD      SBCI	R31,0xFD
    016DC 8060      LD	R6,Z
    016DD 51E2      SUBI	R30,0x12
    016DE 40F2      SBCI	R31,2
    016DF 2477      CLR	R7
    016E0 2488      CLR	R8
    016E1 2499      CLR	R9
    016E2 2826      OR	R2,R6
    016E3 2837      OR	R3,R7
    016E4 2848      OR	R4,R8
    016E5 2859      OR	R5,R9
    016E6 E742      LDI	R20,0x72
    016E7 E752      LDI	R21,0x72
    016E8 E461      LDI	R22,0x41
    016E9 E671      LDI	R23,0x61
    016EA 1624      CP	R2,R20
    016EB 0635      CPC	R3,R21
    016EC 0646      CPC	R4,R22
    016ED 0657      CPC	R5,R23
    016EE F009      BEQ	0x16F0
    016EF C078      RJMP	0x1768
(2142) 			LD_WORD(fs->win+BS_55AA) == 0xAA55 &&
(2143) 			LD_DWORD(fs->win+FSI_LeadSig) == 0x41615252 &&
(2144) 			LD_DWORD(fs->win+FSI_StrucSig) == 0x61417272) {
(2145) 				fs->last_clust = LD_DWORD(fs->win+FSI_Nxt_Free);
    016F0 E188      LDI	R24,0x18
    016F1 E090      LDI	R25,0
    016F2 5EE3      SUBI	R30,0xE3
    016F3 4FFD      SBCI	R31,0xFD
    016F4 8100      LD	R16,Z
    016F5 2711      CLR	R17
    016F6 2722      CLR	R18
    016F7 2733      CLR	R19
    016F8 938A      ST	-Y,R24
    016F9 940E 493E CALL	lsl32
    016FB 0118      MOVW	R2,R16
    016FC 0129      MOVW	R4,R18
    016FD A1ED      LDD	R30,Y+37
    016FE A1FE      LDD	R31,Y+38
    016FF 5EE4      SUBI	R30,0xE4
    01700 4FFD      SBCI	R31,0xFD
    01701 8060      LD	R6,Z
    01702 51EC      SUBI	R30,0x1C
    01703 40F2      SBCI	R31,2
    01704 2477      CLR	R7
    01705 2488      CLR	R8
    01706 2499      CLR	R9
    01707 0143      MOVW	R8,R6
    01708 2466      CLR	R6
    01709 2477      CLR	R7
    0170A 2826      OR	R2,R6
    0170B 2837      OR	R3,R7
    0170C 2848      OR	R4,R8
    0170D 2859      OR	R5,R9
    0170E 5EE5      SUBI	R30,0xE5
    0170F 4FFD      SBCI	R31,0xFD
    01710 8060      LD	R6,Z
    01711 51EB      SUBI	R30,0x1B
    01712 40F2      SBCI	R31,2
    01713 2477      CLR	R7
    01714 2C76      MOV	R7,R6
    01715 2466      CLR	R6
    01716 2488      CLR	R8
    01717 2499      CLR	R9
    01718 2826      OR	R2,R6
    01719 2837      OR	R3,R7
    0171A 2848      OR	R4,R8
    0171B 2859      OR	R5,R9
    0171C 5EE6      SUBI	R30,0xE6
    0171D 4FFD      SBCI	R31,0xFD
    0171E 8060      LD	R6,Z
    0171F 51EA      SUBI	R30,0x1A
    01720 40F2      SBCI	R31,2
    01721 2477      CLR	R7
    01722 2488      CLR	R8
    01723 2499      CLR	R9
    01724 2826      OR	R2,R6
    01725 2837      OR	R3,R7
    01726 2848      OR	R4,R8
    01727 2859      OR	R5,R9
    01728 8622      STD	Z+10,R2
    01729 8633      STD	Z+11,R3
    0172A 8644      STD	Z+12,R4
    0172B 8655      STD	Z+13,R5
(2146) 				fs->free_clust = LD_DWORD(fs->win+FSI_Free_Count);
    0172C E188      LDI	R24,0x18
    0172D E090      LDI	R25,0
    0172E 5EE7      SUBI	R30,0xE7
    0172F 4FFD      SBCI	R31,0xFD
    01730 8100      LD	R16,Z
    01731 2711      CLR	R17
    01732 2722      CLR	R18
    01733 2733      CLR	R19
    01734 938A      ST	-Y,R24
    01735 940E 493E CALL	lsl32
    01737 0118      MOVW	R2,R16
    01738 0129      MOVW	R4,R18
    01739 A1ED      LDD	R30,Y+37
    0173A A1FE      LDD	R31,Y+38
    0173B 5EE8      SUBI	R30,0xE8
    0173C 4FFD      SBCI	R31,0xFD
    0173D 8060      LD	R6,Z
    0173E 51E8      SUBI	R30,0x18
    0173F 40F2      SBCI	R31,2
    01740 2477      CLR	R7
    01741 2488      CLR	R8
    01742 2499      CLR	R9
    01743 0143      MOVW	R8,R6
    01744 2466      CLR	R6
    01745 2477      CLR	R7
    01746 2826      OR	R2,R6
    01747 2837      OR	R3,R7
    01748 2848      OR	R4,R8
    01749 2859      OR	R5,R9
    0174A 5EE9      SUBI	R30,0xE9
    0174B 4FFD      SBCI	R31,0xFD
    0174C 8060      LD	R6,Z
    0174D 51E7      SUBI	R30,0x17
    0174E 40F2      SBCI	R31,2
    0174F 2477      CLR	R7
    01750 2C76      MOV	R7,R6
    01751 2466      CLR	R6
    01752 2488      CLR	R8
    01753 2499      CLR	R9
    01754 2826      OR	R2,R6
    01755 2837      OR	R3,R7
    01756 2848      OR	R4,R8
    01757 2859      OR	R5,R9
    01758 5EEA      SUBI	R30,0xEA
    01759 4FFD      SBCI	R31,0xFD
    0175A 8060      LD	R6,Z
    0175B 51E6      SUBI	R30,0x16
    0175C 40F2      SBCI	R31,2
    0175D 2477      CLR	R7
    0175E 2488      CLR	R8
    0175F 2499      CLR	R9
    01760 2826      OR	R2,R6
    01761 2837      OR	R3,R7
    01762 2848      OR	R4,R8
    01763 2859      OR	R5,R9
    01764 8626      STD	Z+14,R2
    01765 8637      STD	Z+15,R3
    01766 8A40      STD	Z+16,R4
    01767 8A51      STD	Z+17,R5
(2147) 		}
(2148) 	}
(2149) #endif
(2150) 	fs->fs_type = fmt;		/* FAT sub-type */
    01768 A1ED      LDD	R30,Y+37
    01769 A1FE      LDD	R31,Y+38
    0176A 82C0      ST	Z,R12
(2151) 	fs->id = ++Fsid;		/* File system mount ID */
    0176B 9180 05D8 LDS	R24,ff.c:Fsid
    0176D 9190 05D9 LDS	R25,ff.c:Fsid+1
    0176F 9601      ADIW	R24,1
    01770 016C      MOVW	R12,R24
    01771 92D0 05D9 STS	ff.c:Fsid+1,R13
    01773 92C0 05D8 STS	ff.c:Fsid,R12
    01775 82D7      STD	Z+7,R13
    01776 82C6      STD	Z+6,R12
(2152) 	fs->winsect = 0;		/* Invalidate sector cache */
    01777 96BA      ADIW	R30,0x2A
    01778 E080      LDI	R24,0
    01779 8380      ST	Z,R24
    0177A 8381      STD	Z+1,R24
    0177B 8382      STD	Z+2,R24
    0177C 8383      STD	Z+3,R24
(2153) 	fs->wflag = 0;
    0177D 2422      CLR	R2
    0177E A1ED      LDD	R30,Y+37
    0177F A1FE      LDD	R31,Y+38
    01780 8224      STD	Z+4,R2
(2154) #if _FS_RPATH
(2155) 	fs->cdir = 0;			/* Current directory (root dir) */
(2156) #endif
(2157) #if _FS_SHARE				/* Clear file lock semaphores */
(2158) 	clear_lock(fs);
(2159) #endif
(2160) 
(2161) 	return FR_OK;
    01781 2700      CLR	R16
    01782 96A7      ADIW	R28,0x27
    01783 940E 48A8 CALL	pop_xgsetF0FC
    01785 9622      ADIW	R28,2
    01786 9508      RET
ff.c:validate:
  id                   --> R10
  fs                   --> R20
    01787 940E 48BE CALL	push_xgset300C
    01789 0159      MOVW	R10,R18
    0178A 01A8      MOVW	R20,R16
(2162) }
(2163) 
(2164) 
(2165) 
(2166) 
(2167) /*-----------------------------------------------------------------------*/
(2168) /* Check if the file/dir object is valid or not                          */
(2169) /*-----------------------------------------------------------------------*/
(2170) 
(2171) static
(2172) FRESULT validate (	/* FR_OK(0): The object is valid, !=0: Invalid */
(2173) 	FATFS *fs,		/* Pointer to the file system object */
(2174) 	WORD id			/* Member id of the target object to be checked */
(2175) )
(2176) {
(2177) 	if (!fs || !fs->fs_type || fs->id != id)
    0178B 3040      CPI	R20,0
    0178C 0745      CPC	R20,R21
    0178D F049      BEQ	0x1797
    0178E 01FA      MOVW	R30,R20
    0178F 8020      LD	R2,Z
    01790 2022      TST	R2
    01791 F029      BEQ	0x1797
    01792 8026      LDD	R2,Z+6
    01793 8037      LDD	R3,Z+7
    01794 142A      CP	R2,R10
    01795 043B      CPC	R3,R11
    01796 F011      BEQ	0x1799
(2178) 		return FR_INVALID_OBJECT;
    01797 E009      LDI	R16,0x9
    01798 C009      RJMP	0x17A2
(2179) 
(2180) 	ENTER_FF(fs);		/* Lock file system */
(2181) 
(2182) 	if (disk_status(fs->drv) & STA_NOINIT)
    01799 01FA      MOVW	R30,R20
    0179A 8101      LDD	R16,Z+1
    0179B 940E 03CE CALL	_disk_status
    0179D FF00      SBRS	R16,0
    0179E C002      RJMP	0x17A1
(2183) 		return FR_NOT_READY;
    0179F E003      LDI	R16,3
    017A0 C001      RJMP	0x17A2
(2184) 
(2185) 	return FR_OK;
    017A1 2700      CLR	R16
    017A2 940C 48C3 JMP	pop_xgset300C
_f_mount:
  rfs                  --> R10
  fs                   --> R18
  vol                  --> R16
    017A4 92AA      ST	-Y,R10
    017A5 92BA      ST	-Y,R11
(2186) }
(2187) 
(2188) 
(2189) 
(2190) 
(2191) /*--------------------------------------------------------------------------
(2192) 
(2193)    Public Functions
(2194) 
(2195) --------------------------------------------------------------------------*/
(2196) 
(2197) 
(2198) 
(2199) /*-----------------------------------------------------------------------*/
(2200) /* Mount/Unmount a Logical Drive                                         */
(2201) /*-----------------------------------------------------------------------*/
(2202) 
(2203) FRESULT f_mount (
(2204) 	BYTE vol,		/* Logical drive number to be mounted/unmounted */
(2205) 	FATFS *fs		/* Pointer to new file system object (NULL for unmount)*/
(2206) )
(2207) {
(2208) 	FATFS *rfs;
(2209) 
(2210) 
(2211) 	if (vol >= _VOLUMES)		/* Check if the drive number is valid */
    017A6 3001      CPI	R16,1
    017A7 F010      BCS	0x17AA
(2212) 		return FR_INVALID_DRIVE;
    017A8 E00B      LDI	R16,0xB
    017A9 C022      RJMP	0x17CC
(2213) 	rfs = FatFs[vol];			/* Get current fs object */
    017AA ED8A      LDI	R24,0xDA
    017AB E095      LDI	R25,5
    017AC 2FE0      MOV	R30,R16
    017AD 27FF      CLR	R31
    017AE 0FEE      LSL	R30
    017AF 1FFF      ROL	R31
    017B0 0FE8      ADD	R30,R24
    017B1 1FF9      ADC	R31,R25
    017B2 80A0      LD	R10,Z
    017B3 80B1      LDD	R11,Z+1
(2214) 
(2215) 	if (rfs) {
    017B4 20AA      TST	R10
    017B5 F411      BNE	0x17B8
    017B6 20BB      TST	R11
    017B7 F019      BEQ	0x17BB
(2216) #if _FS_SHARE
(2217) 		clear_lock(rfs);
(2218) #endif
(2219) #if _FS_REENTRANT				/* Discard sync object of the current volume */
(2220) 		if (!ff_del_syncobj(rfs->sobj)) return FR_INT_ERR;
(2221) #endif
(2222) 		rfs->fs_type = 0;		/* Clear old fs object */
    017B8 2422      CLR	R2
    017B9 01F5      MOVW	R30,R10
    017BA 8220      ST	Z,R2
(2223) 	}
(2224) 
(2225) 	if (fs) {
    017BB 3020      CPI	R18,0
    017BC 0723      CPC	R18,R19
    017BD F019      BEQ	0x17C1
(2226) 		fs->fs_type = 0;		/* Clear new fs object */
    017BE 2422      CLR	R2
    017BF 01F9      MOVW	R30,R18
    017C0 8220      ST	Z,R2
(2227) #if _FS_REENTRANT				/* Create sync object for the new volume */
(2228) 		if (!ff_cre_syncobj(vol, &fs->sobj)) return FR_INT_ERR;
(2229) #endif
(2230) 	}
(2231) 	FatFs[vol] = fs;			/* Register new fs object */
    017C1 ED8A      LDI	R24,0xDA
    017C2 E095      LDI	R25,5
    017C3 2FE0      MOV	R30,R16
    017C4 27FF      CLR	R31
    017C5 0FEE      LSL	R30
    017C6 1FFF      ROL	R31
    017C7 0FE8      ADD	R30,R24
    017C8 1FF9      ADC	R31,R25
    017C9 8331      STD	Z+1,R19
    017CA 8320      ST	Z,R18
(2232) 
(2233) 	return FR_OK;
    017CB 2700      CLR	R16
    017CC 90B9      LD	R11,Y+
    017CD 90A9      LD	R10,Y+
    017CE 9508      RET
_f_open:
  cl                   --> Y,+40
  dw                   --> Y,+36
  sfn                  --> Y,+24
  dj                   --> Y,+2
  res                  --> R10
  dir                  --> R14
  mode                 --> Y,+58
  path                 --> Y,+56
  fp                   --> Y,+54
    017CF 940E 476E CALL	push_arg4
    017D1 940E 48B3 CALL	push_xgsetF0FC
    017D3 97AC      SBIW	R28,0x2C
(2234) }
(2235) 
(2236) 
(2237) 
(2238) 
(2239) /*-----------------------------------------------------------------------*/
(2240) /* Open or Create a File                                                 */
(2241) /*-----------------------------------------------------------------------*/
(2242) 
(2243) FRESULT f_open (
(2244) 	FIL *fp,			/* Pointer to the blank file object */
(2245) 	const TCHAR *path,	/* Pointer to the file name */
(2246) 	BYTE mode			/* Access mode and file open mode flags */
(2247) )
(2248) {
(2249) 	FRESULT res;
(2250) 	DIR dj;
(2251) 	BYTE *dir;
(2252) 	DEF_NAMEBUF;
(2253) 
(2254) 
(2255) 	fp->fs = 0;			/* Clear file object */
    017D4 2422      CLR	R2
    017D5 2433      CLR	R3
    017D6 A9EE      LDD	R30,Y+54
    017D7 A9FF      LDD	R31,Y+55
    017D8 8231      STD	Z+1,R3
    017D9 8220      ST	Z,R2
(2256) 
(2257) #if !_FS_READONLY
(2258) 	mode &= FA_READ | FA_WRITE | FA_CREATE_ALWAYS | FA_OPEN_ALWAYS | FA_CREATE_NEW;
    017DA AD8A      LDD	R24,Y+58
    017DB 718F      ANDI	R24,0x1F
    017DC AF8A      STD	Y+58,R24
(2259) 	res = chk_mounted(&path, &dj.fs, (BYTE)(mode & ~FA_READ));
    017DD 2799      CLR	R25
    017DE 7F8E      ANDI	R24,0xFE
    017DF 8388      ST	Y,R24
    017E0 019E      MOVW	R18,R28
    017E1 5F2E      SUBI	R18,0xFE
    017E2 4F3F      SBCI	R19,0xFF
    017E3 018E      MOVW	R16,R28
    017E4 5C08      SUBI	R16,0xC8
    017E5 4F1F      SBCI	R17,0xFF
    017E6 DAA6      RCALL	ff.c:chk_mounted
    017E7 2EA0      MOV	R10,R16
(2260) #else
(2261) 	mode &= FA_READ;
(2262) 	res = chk_mounted(&path, &dj.fs, 0);
(2263) #endif
(2264) 	INIT_BUF(dj);
    017E8 01CE      MOVW	R24,R28
    017E9 9648      ADIW	R24,0x18
    017EA 8B9F      STD	Y+23,R25
    017EB 8B8E      STD	Y+22,R24
(2265) 	if (res == FR_OK)
    017EC 2300      TST	R16
    017ED F439      BNE	0x17F5
(2266) 		res = follow_path(&dj, path);	/* Follow the file path */
    017EE AD28      LDD	R18,Y+56
    017EF AD39      LDD	R19,Y+57
    017F0 018E      MOVW	R16,R28
    017F1 5F0E      SUBI	R16,0xFE
    017F2 4F1F      SBCI	R17,0xFF
    017F3 D94D      RCALL	ff.c:follow_path
    017F4 2EA0      MOV	R10,R16
(2267) 	dir = dj.dir;
    017F5 88EC      LDD	R14,Y+20
    017F6 88FD      LDD	R15,Y+21
(2268) 
(2269) #if !_FS_READONLY	/* R/W configuration */
(2270) 	if (res == FR_OK) {
    017F7 20AA      TST	R10
    017F8 F431      BNE	0x17FF
(2271) 		if (!dir)	/* Current dir itself */
    017F9 20EE      TST	R14
    017FA F421      BNE	0x17FF
    017FB 20FF      TST	R15
    017FC F411      BNE	0x17FF
(2272) 			res = FR_INVALID_NAME;
    017FD E086      LDI	R24,6
    017FE 2EA8      MOV	R10,R24
(2273) #if _FS_SHARE
(2274) 		else
(2275) 			res = chk_lock(&dj, (mode & ~FA_READ) ? 1 : 0);
(2276) #endif
(2277) 	}
(2278) 	/* Create or Open a file */
(2279) 	if (mode & (FA_CREATE_ALWAYS | FA_OPEN_ALWAYS | FA_CREATE_NEW)) {
    017FF AD8A      LDD	R24,Y+58
    01800 718C      ANDI	R24,0x1C
    01801 F409      BNE	0x1803
    01802 C0C0      RJMP	0x18C3
(2280) 		DWORD dw, cl;
(2281) 
(2282) 		if (res != FR_OK) {					/* No file, create new */
    01803 20AA      TST	R10
    01804 F081      BEQ	0x1815
(2283) 			if (res == FR_NO_FILE)			/* There is no file to open, create a new entry */
    01805 2D8A      MOV	R24,R10
    01806 3084      CPI	R24,4
    01807 F439      BNE	0x180F
(2284) #if _FS_SHARE
(2285) 				res = enq_lock() ? dir_register(&dj) : FR_TOO_MANY_OPEN_FILES;
(2286) #else
(2287) 				res = dir_register(&dj);
    01808 018E      MOVW	R16,R28
    01809 5F0E      SUBI	R16,0xFE
    0180A 4F1F      SBCI	R17,0xFF
    0180B 940E 0F33 CALL	ff.c:dir_register
    0180D 2EC0      MOV	R12,R16
    0180E 2CAC      MOV	R10,R12
(2288) #endif
(2289) 			mode |= FA_CREATE_ALWAYS;		/* File is created */
    0180F AD8A      LDD	R24,Y+58
    01810 6088      ORI	R24,0x8
    01811 AF8A      STD	Y+58,R24
(2290) 			dir = dj.dir;					/* New entry */
    01812 88EC      LDD	R14,Y+20
    01813 88FD      LDD	R15,Y+21
(2291) 		}
    01814 C00C      RJMP	0x1821
(2292) 		else {								/* Any object is already existing */
(2293) 			if (dir[DIR_Attr] & (AM_RDO | AM_DIR)) {	/* Cannot overwrite it (R/O or DIR) */
    01815 01F7      MOVW	R30,R14
    01816 8583      LDD	R24,Z+11
    01817 7181      ANDI	R24,0x11
    01818 F019      BEQ	0x181C
(2294) 				res = FR_DENIED;
    01819 E087      LDI	R24,7
    0181A 2EA8      MOV	R10,R24
(2295) 			} else {
    0181B C005      RJMP	0x1821
(2296) 				if (mode & FA_CREATE_NEW)	/* Cannot create as new file */
    0181C AC0A      LDD	R0,Y+58
    0181D FE02      SBRS	R0,2
    0181E C002      RJMP	0x1821
(2297) 					res = FR_EXIST;
    0181F E088      LDI	R24,0x8
    01820 2EA8      MOV	R10,R24
(2298) 			}
(2299) 		}
(2300) 		if (res == FR_OK && (mode & FA_CREATE_ALWAYS)) {	/* Truncate it if overwrite mode */
    01821 20AA      TST	R10
    01822 F009      BEQ	0x1824
    01823 C0B1      RJMP	0x18D5
    01824 AC0A      LDD	R0,Y+58
    01825 FE03      SBRS	R0,3
    01826 C0AE      RJMP	0x18D5
(2301) 			dw = get_fattime();					/* Created time */
    01827 940E 0411 CALL	_get_fattime
    01829 A30C      STD	Y+36,R16
    0182A A31D      STD	Y+37,R17
    0182B A32E      STD	Y+38,R18
    0182C A33F      STD	Y+39,R19
(2302) 			ST_DWORD(dir+DIR_CrtTime, dw);
    0182D A02C      LDD	R2,Y+36
    0182E A03D      LDD	R3,Y+37
    0182F A04E      LDD	R4,Y+38
    01830 A05F      LDD	R5,Y+39
    01831 01F7      MOVW	R30,R14
    01832 8626      STD	Z+14,R2
    01833 2C23      MOV	R2,R3
    01834 2433      CLR	R3
    01835 963F      ADIW	R30,0xF
    01836 8220      ST	Z,R2
    01837 A02C      LDD	R2,Y+36
    01838 A03D      LDD	R3,Y+37
    01839 A04E      LDD	R4,Y+38
    0183A A05F      LDD	R5,Y+39
    0183B 0112      MOVW	R2,R4
    0183C 2444      CLR	R4
    0183D 2455      CLR	R5
    0183E 01F7      MOVW	R30,R14
    0183F 9670      ADIW	R30,0x10
    01840 8220      ST	Z,R2
    01841 E188      LDI	R24,0x18
    01842 E090      LDI	R25,0
    01843 A10C      LDD	R16,Y+36
    01844 A11D      LDD	R17,Y+37
    01845 A12E      LDD	R18,Y+38
    01846 A13F      LDD	R19,Y+39
    01847 938A      ST	-Y,R24
    01848 940E 4957 CALL	lsr32
    0184A 01F7      MOVW	R30,R14
    0184B 8B01      STD	Z+17,R16
(2303) 			dir[DIR_Attr] = 0;					/* Reset attribute */
    0184C 2422      CLR	R2
    0184D 8623      STD	Z+11,R2
(2304) 			ST_DWORD(dir+DIR_FileSize, 0);		/* size = 0 */
    0184E 8E24      STD	Z+28,R2
    0184F 8E25      STD	Z+29,R2
    01850 8E26      STD	Z+30,R2
    01851 8E27      STD	Z+31,R2
(2305) 			cl = LD_CLUST(dir);					/* Get start cluster */
    01852 8C22      LDD	R2,Z+26
    01853 2433      CLR	R3
    01854 8C43      LDD	R4,Z+27
    01855 2455      CLR	R5
    01856 2C54      MOV	R5,R4
    01857 2444      CLR	R4
    01858 2842      OR	R4,R2
    01859 2853      OR	R5,R3
    0185A 0112      MOVW	R2,R4
    0185B 2444      CLR	R4
    0185C 2455      CLR	R5
    0185D 8864      LDD	R6,Z+20
    0185E 2477      CLR	R7
    0185F 9675      ADIW	R30,0x15
    01860 8080      LD	R8,Z
    01861 2499      CLR	R9
    01862 2C98      MOV	R9,R8
    01863 2488      CLR	R8
    01864 2886      OR	R8,R6
    01865 2897      OR	R9,R7
    01866 0134      MOVW	R6,R8
    01867 2488      CLR	R8
    01868 2499      CLR	R9
    01869 0143      MOVW	R8,R6
    0186A 2466      CLR	R6
    0186B 2477      CLR	R7
    0186C 2862      OR	R6,R2
    0186D 2873      OR	R7,R3
    0186E 2884      OR	R8,R4
    0186F 2895      OR	R9,R5
    01870 A668      STD	Y+40,R6
    01871 A679      STD	Y+41,R7
    01872 A68A      STD	Y+42,R8
    01873 A69B      STD	Y+43,R9
(2306) 			ST_CLUST(dir, 0);					/* cluster = 0 */
    01874 2422      CLR	R2
    01875 01F7      MOVW	R30,R14
    01876 8E22      STD	Z+26,R2
    01877 8E23      STD	Z+27,R2
    01878 8A24      STD	Z+20,R2
    01879 8A25      STD	Z+21,R2
(2307) 			dj.fs->wflag = 1;
    0187A E081      LDI	R24,1
    0187B 81EA      LDD	R30,Y+2
    0187C 81FB      LDD	R31,Y+3
    0187D 9634      ADIW	R30,4
    0187E 8380      ST	Z,R24
(2308) 			if (cl) {							/* Remove the cluster chain if exist */
    0187F A428      LDD	R2,Y+40
    01880 A439      LDD	R3,Y+41
    01881 A44A      LDD	R4,Y+42
    01882 A45B      LDD	R5,Y+43
    01883 9488      BCLR	0
    01884 2022      TST	R2
    01885 0432      CPC	R3,R2
    01886 0442      CPC	R4,R2
    01887 0452      CPC	R5,R2
    01888 F409      BNE	0x188A
    01889 C04B      RJMP	0x18D5
(2309) 				dw = dj.fs->winsect;
    0188A 81EA      LDD	R30,Y+2
    0188B 81FB      LDD	R31,Y+3
    0188C A422      LDD	R2,Z+42
    0188D A433      LDD	R3,Z+43
    0188E A444      LDD	R4,Z+44
    0188F A455      LDD	R5,Z+45
    01890 A22C      STD	Y+36,R2
    01891 A23D      STD	Y+37,R3
    01892 A24E      STD	Y+38,R4
    01893 A25F      STD	Y+39,R5
(2310) 				res = remove_chain(dj.fs, cl);
    01894 A428      LDD	R2,Y+40
    01895 A439      LDD	R3,Y+41
    01896 A44A      LDD	R4,Y+42
    01897 A45B      LDD	R5,Y+43
    01898 8248      ST	Y,R4
    01899 8259      STD	Y+1,R5
    0189A 0191      MOVW	R18,R2
    0189B 810A      LDD	R16,Y+2
    0189C 811B      LDD	R17,Y+3
    0189D 940E 0947 CALL	ff.c:remove_chain
    0189F 2EC0      MOV	R12,R16
    018A0 2CAC      MOV	R10,R12
(2311) 				if (res == FR_OK) {
    018A1 2300      TST	R16
    018A2 F591      BNE	0x18D5
(2312) 					dj.fs->last_clust = cl - 1;	/* Reuse the cluster hole */
    018A3 E041      LDI	R20,1
    018A4 E050      LDI	R21,0
    018A5 E060      LDI	R22,0
    018A6 E070      LDI	R23,0
    018A7 A428      LDD	R2,Y+40
    018A8 A439      LDD	R3,Y+41
    018A9 A44A      LDD	R4,Y+42
    018AA A45B      LDD	R5,Y+43
    018AB 1A24      SUB	R2,R20
    018AC 0A35      SBC	R3,R21
    018AD 0A46      SBC	R4,R22
    018AE 0A57      SBC	R5,R23
    018AF 81EA      LDD	R30,Y+2
    018B0 81FB      LDD	R31,Y+3
    018B1 8622      STD	Z+10,R2
    018B2 8633      STD	Z+11,R3
    018B3 8644      STD	Z+12,R4
    018B4 8655      STD	Z+13,R5
(2313) 					res = move_window(dj.fs, dw);
    018B5 A02C      LDD	R2,Y+36
    018B6 A03D      LDD	R3,Y+37
    018B7 A04E      LDD	R4,Y+38
    018B8 A05F      LDD	R5,Y+39
    018B9 8248      ST	Y,R4
    018BA 8259      STD	Y+1,R5
    018BB 0191      MOVW	R18,R2
    018BC 810A      LDD	R16,Y+2
    018BD 811B      LDD	R17,Y+3
    018BE 940E 046F CALL	ff.c:move_window
    018C0 2EC0      MOV	R12,R16
    018C1 2CAC      MOV	R10,R12
(2314) 				}
(2315) 			}
(2316) 		}
(2317) 	}
    018C2 C012      RJMP	0x18D5
(2318) 	else {	/* Open an existing file */
(2319) 		if (res == FR_OK) {						/* Follow succeeded */
    018C3 20AA      TST	R10
    018C4 F481      BNE	0x18D5
(2320) 			if (dir[DIR_Attr] & AM_DIR) {		/* It is a directory */
    018C5 01F7      MOVW	R30,R14
    018C6 8423      LDD	R2,Z+11
    018C7 FE24      SBRS	R2,4
    018C8 C003      RJMP	0x18CC
(2321) 				res = FR_NO_FILE;
    018C9 E084      LDI	R24,4
    018CA 2EA8      MOV	R10,R24
(2322) 			} else {
    018CB C009      RJMP	0x18D5
(2323) 				if ((mode & FA_WRITE) && (dir[DIR_Attr] & AM_RDO)) /* R/O violation */
    018CC AC0A      LDD	R0,Y+58
    018CD FE01      SBRS	R0,1
    018CE C006      RJMP	0x18D5
    018CF 01F7      MOVW	R30,R14
    018D0 8423      LDD	R2,Z+11
    018D1 FE20      SBRS	R2,0
    018D2 C002      RJMP	0x18D5
(2324) 					res = FR_DENIED;
    018D3 E087      LDI	R24,7
    018D4 2EA8      MOV	R10,R24
(2325) 			}
(2326) 		}
(2327) 	}
(2328) 	if (res == FR_OK) {
    018D5 20AA      TST	R10
    018D6 F4A1      BNE	0x18EB
(2329) 		if (mode & FA_CREATE_ALWAYS)			/* Set file change flag if created or overwritten */
    018D7 AC0A      LDD	R0,Y+58
    018D8 FE03      SBRS	R0,3
    018D9 C003      RJMP	0x18DD
(2330) 			mode |= FA__WRITTEN;
    018DA 2D80      MOV	R24,R0
    018DB 6280      ORI	R24,0x20
    018DC AF8A      STD	Y+58,R24
(2331) 		fp->dir_sect = dj.fs->winsect;			/* Pointer to the directory entry */
    018DD 81EA      LDD	R30,Y+2
    018DE 81FB      LDD	R31,Y+3
    018DF A422      LDD	R2,Z+42
    018E0 A433      LDD	R3,Z+43
    018E1 A444      LDD	R4,Z+44
    018E2 A455      LDD	R5,Z+45
    018E3 A9EE      LDD	R30,Y+54
    018E4 A9FF      LDD	R31,Y+55
    018E5 8E22      STD	Z+26,R2
    018E6 8E33      STD	Z+27,R3
    018E7 8E44      STD	Z+28,R4
    018E8 8E55      STD	Z+29,R5
(2332) 		fp->dir_ptr = dir;
    018E9 8EF7      STD	Z+31,R15
    018EA 8EE6      STD	Z+30,R14
(2333) #if _FS_SHARE
(2334) 		fp->lockid = inc_lock(&dj, (mode & ~FA_READ) ? 1 : 0);
(2335) 		if (!fp->lockid) res = FR_INT_ERR;
(2336) #endif
(2337) 	}
(2338) 
(2339) #else				/* R/O configuration */
(2340) 	if (res == FR_OK) {					/* Follow succeeded */
(2341) 		if (!dir) {						/* Current dir itself */
(2342) 			res = FR_INVALID_NAME;
(2343) 		} else {
(2344) 			if (dir[DIR_Attr] & AM_DIR)	/* It is a directory */
(2345) 				res = FR_NO_FILE;
(2346) 		}
(2347) 	}
(2348) #endif
(2349) 	FREE_BUF();
(2350) 
(2351) 	if (res == FR_OK) {
    018EB 20AA      TST	R10
    018EC F009      BEQ	0x18EE
    018ED C077      RJMP	0x1965
(2352) 		fp->flag = mode;					/* File access mode */
    018EE A9EE      LDD	R30,Y+54
    018EF A9FF      LDD	R31,Y+55
    018F0 AC0A      LDD	R0,Y+58
    018F1 8204      STD	Z+4,R0
(2353) 		fp->sclust = LD_CLUST(dir);			/* File start cluster */
    018F2 01F7      MOVW	R30,R14
    018F3 8C22      LDD	R2,Z+26
    018F4 2433      CLR	R3
    018F5 8C43      LDD	R4,Z+27
    018F6 2455      CLR	R5
    018F7 2C54      MOV	R5,R4
    018F8 2444      CLR	R4
    018F9 2842      OR	R4,R2
    018FA 2853      OR	R5,R3
    018FB 0112      MOVW	R2,R4
    018FC 2444      CLR	R4
    018FD 2455      CLR	R5
    018FE 8864      LDD	R6,Z+20
    018FF 2477      CLR	R7
    01900 8885      LDD	R8,Z+21
    01901 2499      CLR	R9
    01902 2C98      MOV	R9,R8
    01903 2488      CLR	R8
    01904 2886      OR	R8,R6
    01905 2897      OR	R9,R7
    01906 0134      MOVW	R6,R8
    01907 2488      CLR	R8
    01908 2499      CLR	R9
    01909 0143      MOVW	R8,R6
    0190A 2466      CLR	R6
    0190B 2477      CLR	R7
    0190C 2862      OR	R6,R2
    0190D 2873      OR	R7,R3
    0190E 2884      OR	R8,R4
    0190F 2895      OR	R9,R5
    01910 A9EE      LDD	R30,Y+54
    01911 A9FF      LDD	R31,Y+55
    01912 8666      STD	Z+14,R6
    01913 8677      STD	Z+15,R7
    01914 8A80      STD	Z+16,R8
    01915 8A91      STD	Z+17,R9
(2354) 		fp->fsize = LD_DWORD(dir+DIR_FileSize);	/* File size */
    01916 E188      LDI	R24,0x18
    01917 E090      LDI	R25,0
    01918 01F7      MOVW	R30,R14
    01919 8D07      LDD	R16,Z+31
    0191A 2711      CLR	R17
    0191B 2722      CLR	R18
    0191C 2733      CLR	R19
    0191D 938A      ST	-Y,R24
    0191E 940E 493E CALL	lsl32
    01920 0118      MOVW	R2,R16
    01921 0129      MOVW	R4,R18
    01922 01F7      MOVW	R30,R14
    01923 8C66      LDD	R6,Z+30
    01924 2477      CLR	R7
    01925 2488      CLR	R8
    01926 2499      CLR	R9
    01927 0143      MOVW	R8,R6
    01928 2466      CLR	R6
    01929 2477      CLR	R7
    0192A 2826      OR	R2,R6
    0192B 2837      OR	R3,R7
    0192C 2848      OR	R4,R8
    0192D 2859      OR	R5,R9
    0192E 8C65      LDD	R6,Z+29
    0192F 2477      CLR	R7
    01930 2C76      MOV	R7,R6
    01931 2466      CLR	R6
    01932 2488      CLR	R8
    01933 2499      CLR	R9
    01934 2826      OR	R2,R6
    01935 2837      OR	R3,R7
    01936 2848      OR	R4,R8
    01937 2859      OR	R5,R9
    01938 8C64      LDD	R6,Z+28
    01939 2477      CLR	R7
    0193A 2488      CLR	R8
    0193B 2499      CLR	R9
    0193C 2826      OR	R2,R6
    0193D 2837      OR	R3,R7
    0193E 2848      OR	R4,R8
    0193F 2859      OR	R5,R9
    01940 A9EE      LDD	R30,Y+54
    01941 A9FF      LDD	R31,Y+55
    01942 8622      STD	Z+10,R2
    01943 8633      STD	Z+11,R3
    01944 8644      STD	Z+12,R4
    01945 8655      STD	Z+13,R5
(2355) 		fp->fptr = 0;						/* File pointer */
    01946 9636      ADIW	R30,6
    01947 E080      LDI	R24,0
    01948 8380      ST	Z,R24
    01949 8381      STD	Z+1,R24
    0194A 8382      STD	Z+2,R24
    0194B 8383      STD	Z+3,R24
(2356) 		fp->dsect = 0;
    0194C A9EE      LDD	R30,Y+54
    0194D A9FF      LDD	R31,Y+55
    0194E 9676      ADIW	R30,0x16
    0194F E080      LDI	R24,0
    01950 8380      ST	Z,R24
    01951 8381      STD	Z+1,R24
    01952 8382      STD	Z+2,R24
    01953 8383      STD	Z+3,R24
(2357) #if _USE_FASTSEEK
(2358) 		fp->cltbl = 0;						/* Normal seek mode */
    01954 2422      CLR	R2
    01955 2433      CLR	R3
    01956 A9EE      LDD	R30,Y+54
    01957 A9FF      LDD	R31,Y+55
    01958 A231      STD	Z+33,R3
    01959 A220      STD	Z+32,R2
(2359) #endif
(2360) 		fp->fs = dj.fs; fp->id = dj.fs->id;	/* Validate file object */
    0195A 802A      LDD	R2,Y+2
    0195B 803B      LDD	R3,Y+3
    0195C 8231      STD	Z+1,R3
    0195D 8220      ST	Z,R2
    0195E 01F1      MOVW	R30,R2
    0195F 8026      LDD	R2,Z+6
    01960 8037      LDD	R3,Z+7
    01961 A9EE      LDD	R30,Y+54
    01962 A9FF      LDD	R31,Y+55
    01963 8233      STD	Z+3,R3
    01964 8222      STD	Z+2,R2
(2361) 	}
(2362) 
(2363) 	LEAVE_FF(dj.fs, res);
    01965 2D0A      MOV	R16,R10
    01966 96AC      ADIW	R28,0x2C
    01967 940E 48A8 CALL	pop_xgsetF0FC
    01969 9624      ADIW	R28,4
    0196A 9508      RET
_f_read:
  remain               --> Y,+13
  res                  --> R10
  clst                 --> Y,+9
  csect                --> R12
  cc                   --> R10
  rbuff                --> R14
  sect                 --> Y,+5
  rcnt                 --> R12
  br                   --> Y,+33
  btr                  --> Y,+31
  buff                 --> R10
  fp                   --> Y,+27
    0196B 940E 476E CALL	push_arg4
    0196D 940E 48B3 CALL	push_xgsetF0FC
    0196F 0159      MOVW	R10,R18
    01970 9761      SBIW	R28,0x11
(2364) }
(2365) 
(2366) 
(2367) 
(2368) 
(2369) /*-----------------------------------------------------------------------*/
(2370) /* Read File                                                             */
(2371) /*-----------------------------------------------------------------------*/
(2372) 
(2373) FRESULT f_read (
(2374) 	FIL *fp, 		/* Pointer to the file object */
(2375) 	void *buff,		/* Pointer to data buffer */
(2376) 	UINT btr,		/* Number of bytes to read */
(2377) 	UINT *br		/* Pointer to number of bytes read */
(2378) )
(2379) {
(2380) 	FRESULT res;
(2381) 	DWORD clst, sect, remain;
(2382) 	UINT rcnt, cc;
(2383) 	BYTE csect, *rbuff = buff;
    01971 0175      MOVW	R14,R10
(2384) 
(2385) 	memset(buff,0,512);
    01972 E080      LDI	R24,0
    01973 E092      LDI	R25,2
    01974 8399      STD	Y+1,R25
    01975 8388      ST	Y,R24
    01976 2722      CLR	R18
    01977 2733      CLR	R19
    01978 0185      MOVW	R16,R10
    01979 940E 474A CALL	_memset
(2386) 
(2387) 	*br = 0;	/* Initialize byte counter */
    0197B 2422      CLR	R2
    0197C 2433      CLR	R3
    0197D A1E9      LDD	R30,Y+33
    0197E A1FA      LDD	R31,Y+34
    0197F 8231      STD	Z+1,R3
    01980 8220      ST	Z,R2
(2388) 
(2389) 	res = validate(fp->fs, fp->id);				/* Check validity */
    01981 8DEB      LDD	R30,Y+27
    01982 8DFC      LDD	R31,Y+28
    01983 8122      LDD	R18,Z+2
    01984 8133      LDD	R19,Z+3
    01985 8100      LD	R16,Z
    01986 8111      LDD	R17,Z+1
    01987 DDFF      RCALL	ff.c:validate
    01988 2EA0      MOV	R10,R16
(2390) 	if (res != FR_OK) LEAVE_FF(fp->fs, res);
    01989 2300      TST	R16
    0198A F009      BEQ	0x198C
    0198B C245      RJMP	0x1BD1
(2391) 	if (fp->flag & FA__ERROR)					/* Aborted file? */
    0198C 8DEB      LDD	R30,Y+27
    0198D 8DFC      LDD	R31,Y+28
    0198E 8024      LDD	R2,Z+4
    0198F FE27      SBRS	R2,7
    01990 C002      RJMP	0x1993
(2392) 		LEAVE_FF(fp->fs, FR_INT_ERR);
    01991 E002      LDI	R16,2
    01992 C23E      RJMP	0x1BD1
(2393) 	if (!(fp->flag & FA_READ)) 					/* Check access mode */
    01993 8DEB      LDD	R30,Y+27
    01994 8DFC      LDD	R31,Y+28
    01995 8024      LDD	R2,Z+4
    01996 FC20      SBRC	R2,0
    01997 C002      RJMP	0x199A
(2394) 		LEAVE_FF(fp->fs, FR_DENIED);
    01998 E007      LDI	R16,7
    01999 C237      RJMP	0x1BD1
(2395) 	remain = fp->fsize - fp->fptr;
    0199A 8DEB      LDD	R30,Y+27
    0199B 8DFC      LDD	R31,Y+28
    0199C 8026      LDD	R2,Z+6
    0199D 8037      LDD	R3,Z+7
    0199E 8440      LDD	R4,Z+8
    0199F 8451      LDD	R5,Z+9
    019A0 963A      ADIW	R30,0xA
    019A1 8060      LD	R6,Z
    019A2 8071      LDD	R7,Z+1
    019A3 8082      LDD	R8,Z+2
    019A4 8093      LDD	R9,Z+3
    019A5 1862      SUB	R6,R2
    019A6 0873      SBC	R7,R3
    019A7 0884      SBC	R8,R4
    019A8 0895      SBC	R9,R5
    019A9 866D      STD	Y+13,R6
    019AA 867E      STD	Y+14,R7
    019AB 868F      STD	Y+15,R8
    019AC 8A98      STD	Y+16,R9
(2396) 	if (btr > remain) btr = (UINT)remain;		/* Truncate btr by remaining bytes */
    019AD 842D      LDD	R2,Y+13
    019AE 843E      LDD	R3,Y+14
    019AF 844F      LDD	R4,Y+15
    019B0 8858      LDD	R5,Y+16
    019B1 8C6F      LDD	R6,Y+31
    019B2 A078      LDD	R7,Y+32
    019B3 2488      CLR	R8
    019B4 2499      CLR	R9
    019B5 1426      CP	R2,R6
    019B6 0437      CPC	R3,R7
    019B7 0448      CPC	R4,R8
    019B8 0459      CPC	R5,R9
    019B9 F008      BCS	0x19BB
    019BA C20D      RJMP	0x1BC8
    019BB A238      STD	Y+32,R3
    019BC 8E2F      STD	Y+31,R2
(2397) 
(2398) 	for ( ;  btr;								/* Repeat until all data read */
    019BD C20A      RJMP	0x1BC8
(2399) 		rbuff += rcnt, fp->fptr += rcnt, *br += rcnt, btr -= rcnt) {
(2400) 		if ((fp->fptr % SS(fp->fs)) == 0) {		/* On the sector boundary? */
    019BE EF4F      LDI	R20,0xFF
    019BF E051      LDI	R21,1
    019C0 E060      LDI	R22,0
    019C1 E070      LDI	R23,0
    019C2 8DEB      LDD	R30,Y+27
    019C3 8DFC      LDD	R31,Y+28
    019C4 9636      ADIW	R30,6
    019C5 8020      LD	R2,Z
    019C6 8031      LDD	R3,Z+1
    019C7 8042      LDD	R4,Z+2
    019C8 8053      LDD	R5,Z+3
    019C9 2224      AND	R2,R20
    019CA 2235      AND	R3,R21
    019CB 2246      AND	R4,R22
    019CC 2257      AND	R5,R23
    019CD 9488      BCLR	0
    019CE 2022      TST	R2
    019CF 0432      CPC	R3,R2
    019D0 0442      CPC	R4,R2
    019D1 0452      CPC	R5,R2
    019D2 F009      BEQ	0x19D4
    019D3 C180      RJMP	0x1B54
(2401) 			csect = (BYTE)(fp->fptr / SS(fp->fs) & (fp->fs->csize - 1));	/* Sector offset in the cluster */
    019D4 E089      LDI	R24,0x9
    019D5 E090      LDI	R25,0
    019D6 8DEB      LDD	R30,Y+27
    019D7 8DFC      LDD	R31,Y+28
    019D8 8106      LDD	R16,Z+6
    019D9 8117      LDD	R17,Z+7
    019DA 8520      LDD	R18,Z+8
    019DB 8531      LDD	R19,Z+9
    019DC 938A      ST	-Y,R24
    019DD 940E 4957 CALL	lsr32
    019DF 0118      MOVW	R2,R16
    019E0 0129      MOVW	R4,R18
    019E1 8DEB      LDD	R30,Y+27
    019E2 8DFC      LDD	R31,Y+28
    019E3 93AF      PUSH	R26
    019E4 93BF      PUSH	R27
    019E5 81A0      LD	R26,Z
    019E6 81B1      LDD	R27,Z+1
    019E7 01FD      MOVW	R30,R26
    019E8 91BF      POP	R27
    019E9 91AF      POP	R26
    019EA 8182      LDD	R24,Z+2
    019EB 2799      CLR	R25
    019EC 9701      SBIW	R24,1
    019ED 013C      MOVW	R6,R24
    019EE 2488      CLR	R8
    019EF FC77      SBRC	R7,7
    019F0 9480      COM	R8
    019F1 2499      CLR	R9
    019F2 FC87      SBRC	R8,7
    019F3 9490      COM	R9
    019F4 2026      AND	R2,R6
    019F5 2037      AND	R3,R7
    019F6 2048      AND	R4,R8
    019F7 2059      AND	R5,R9
    019F8 2CC2      MOV	R12,R2
(2402) 			if (!csect) {						/* On the cluster boundary? */
    019F9 2022      TST	R2
    019FA F009      BEQ	0x19FC
    019FB C078      RJMP	0x1A74
(2403) 				if (fp->fptr == 0) {			/* On the top of the file? */
    019FC 8DEB      LDD	R30,Y+27
    019FD 8DFC      LDD	R31,Y+28
    019FE 9636      ADIW	R30,6
    019FF 8020      LD	R2,Z
    01A00 8031      LDD	R3,Z+1
    01A01 8042      LDD	R4,Z+2
    01A02 8053      LDD	R5,Z+3
    01A03 9488      BCLR	0
    01A04 2022      TST	R2
    01A05 0432      CPC	R3,R2
    01A06 0442      CPC	R4,R2
    01A07 0452      CPC	R5,R2
    01A08 F461      BNE	0x1A15
(2404) 					clst = fp->sclust;			/* Follow from the origin */
    01A09 8DEB      LDD	R30,Y+27
    01A0A 8DFC      LDD	R31,Y+28
    01A0B 963E      ADIW	R30,0xE
    01A0C 8020      LD	R2,Z
    01A0D 8031      LDD	R3,Z+1
    01A0E 8042      LDD	R4,Z+2
    01A0F 8053      LDD	R5,Z+3
    01A10 8629      STD	Y+9,R2
    01A11 863A      STD	Y+10,R3
    01A12 864B      STD	Y+11,R4
    01A13 865C      STD	Y+12,R5
(2405) 				} else {						/* Middle or end of the file */
    01A14 C028      RJMP	0x1A3D
(2406) #if _USE_FASTSEEK
(2407) 					if (fp->cltbl)
    01A15 8DEB      LDD	R30,Y+27
    01A16 8DFC      LDD	R31,Y+28
    01A17 A020      LDD	R2,Z+32
    01A18 A031      LDD	R3,Z+33
    01A19 2022      TST	R2
    01A1A F411      BNE	0x1A1D
    01A1B 2033      TST	R3
    01A1C F079      BEQ	0x1A2C
(2408) 						clst = clmt_clust(fp, fp->fptr);	/* Get cluster# from the CLMT */
    01A1D 8026      LDD	R2,Z+6
    01A1E 8037      LDD	R3,Z+7
    01A1F 8440      LDD	R4,Z+8
    01A20 8451      LDD	R5,Z+9
    01A21 8248      ST	Y,R4
    01A22 8259      STD	Y+1,R5
    01A23 0191      MOVW	R18,R2
    01A24 018F      MOVW	R16,R30
    01A25 940E 0B72 CALL	ff.c:clmt_clust
    01A27 8709      STD	Y+9,R16
    01A28 871A      STD	Y+10,R17
    01A29 872B      STD	Y+11,R18
    01A2A 873C      STD	Y+12,R19
    01A2B C011      RJMP	0x1A3D
(2409) 					else
(2410) #endif
(2411) 						clst = get_fat(fp->fs, fp->clust);	/* Follow cluster chain on the FAT */
    01A2C 8DEB      LDD	R30,Y+27
    01A2D 8DFC      LDD	R31,Y+28
    01A2E 8822      LDD	R2,Z+18
    01A2F 8833      LDD	R3,Z+19
    01A30 8844      LDD	R4,Z+20
    01A31 8855      LDD	R5,Z+21
    01A32 8248      ST	Y,R4
    01A33 8259      STD	Y+1,R5
    01A34 0191      MOVW	R18,R2
    01A35 8100      LD	R16,Z
    01A36 8111      LDD	R17,Z+1
    01A37 940E 0638 CALL	_get_fat
    01A39 8709      STD	Y+9,R16
    01A3A 871A      STD	Y+10,R17
    01A3B 872B      STD	Y+11,R18
    01A3C 873C      STD	Y+12,R19
(2412) 				}
(2413) 				if (clst < 2) ABORT(fp->fs, FR_INT_ERR);
    01A3D E042      LDI	R20,2
    01A3E E050      LDI	R21,0
    01A3F E060      LDI	R22,0
    01A40 E070      LDI	R23,0
    01A41 8429      LDD	R2,Y+9
    01A42 843A      LDD	R3,Y+10
    01A43 844B      LDD	R4,Y+11
    01A44 845C      LDD	R5,Y+12
    01A45 1624      CP	R2,R20
    01A46 0635      CPC	R3,R21
    01A47 0646      CPC	R4,R22
    01A48 0657      CPC	R5,R23
    01A49 F448      BCC	0x1A53
    01A4A 8D8B      LDD	R24,Y+27
    01A4B 8D9C      LDD	R25,Y+28
    01A4C 9604      ADIW	R24,4
    01A4D 01FC      MOVW	R30,R24
    01A4E 8180      LD	R24,Z
    01A4F 6880      ORI	R24,0x80
    01A50 8380      ST	Z,R24
    01A51 E002      LDI	R16,2
    01A52 C17E      RJMP	0x1BD1
(2414) 				if (clst == 0xFFFFFFFF) ABORT(fp->fs, FR_DISK_ERR);
    01A53 EF4F      LDI	R20,0xFF
    01A54 EF5F      LDI	R21,0xFF
    01A55 EF6F      LDI	R22,0xFF
    01A56 EF7F      LDI	R23,0xFF
    01A57 8429      LDD	R2,Y+9
    01A58 843A      LDD	R3,Y+10
    01A59 844B      LDD	R4,Y+11
    01A5A 845C      LDD	R5,Y+12
    01A5B 1624      CP	R2,R20
    01A5C 0635      CPC	R3,R21
    01A5D 0646      CPC	R4,R22
    01A5E 0657      CPC	R5,R23
    01A5F F451      BNE	0x1A6A
    01A60 8D8B      LDD	R24,Y+27
    01A61 8D9C      LDD	R25,Y+28
    01A62 9604      ADIW	R24,4
    01A63 015C      MOVW	R10,R24
    01A64 01FC      MOVW	R30,R24
    01A65 8180      LD	R24,Z
    01A66 6880      ORI	R24,0x80
    01A67 8380      ST	Z,R24
    01A68 E001      LDI	R16,1
    01A69 C167      RJMP	0x1BD1
(2415) 				fp->clust = clst;				/* Update current cluster */
    01A6A 8429      LDD	R2,Y+9
    01A6B 843A      LDD	R3,Y+10
    01A6C 844B      LDD	R4,Y+11
    01A6D 845C      LDD	R5,Y+12
    01A6E 8DEB      LDD	R30,Y+27
    01A6F 8DFC      LDD	R31,Y+28
    01A70 8A22      STD	Z+18,R2
    01A71 8A33      STD	Z+19,R3
    01A72 8A44      STD	Z+20,R4
    01A73 8A55      STD	Z+21,R5
(2416) 			}
(2417) 			sect = clust2sect(fp->fs, fp->clust);	/* Get current sector */
    01A74 8DEB      LDD	R30,Y+27
    01A75 8DFC      LDD	R31,Y+28
    01A76 8822      LDD	R2,Z+18
    01A77 8833      LDD	R3,Z+19
    01A78 8844      LDD	R4,Z+20
    01A79 8855      LDD	R5,Z+21
    01A7A 8248      ST	Y,R4
    01A7B 8259      STD	Y+1,R5
    01A7C 0191      MOVW	R18,R2
    01A7D 8100      LD	R16,Z
    01A7E 8111      LDD	R17,Z+1
    01A7F 940E 05E6 CALL	_clust2sect
    01A81 830D      STD	Y+5,R16
    01A82 831E      STD	Y+6,R17
    01A83 832F      STD	Y+7,R18
    01A84 8738      STD	Y+8,R19
(2418) 			if (!sect) ABORT(fp->fs, FR_INT_ERR);
    01A85 802D      LDD	R2,Y+5
    01A86 803E      LDD	R3,Y+6
    01A87 804F      LDD	R4,Y+7
    01A88 8458      LDD	R5,Y+8
    01A89 9488      BCLR	0
    01A8A 2022      TST	R2
    01A8B 0432      CPC	R3,R2
    01A8C 0442      CPC	R4,R2
    01A8D 0452      CPC	R5,R2
    01A8E F451      BNE	0x1A99
    01A8F 8D8B      LDD	R24,Y+27
    01A90 8D9C      LDD	R25,Y+28
    01A91 9604      ADIW	R24,4
    01A92 015C      MOVW	R10,R24
    01A93 01FC      MOVW	R30,R24
    01A94 8180      LD	R24,Z
    01A95 6880      ORI	R24,0x80
    01A96 8380      ST	Z,R24
    01A97 E002      LDI	R16,2
    01A98 C138      RJMP	0x1BD1
(2419) 			sect += csect;
    01A99 2C2C      MOV	R2,R12
    01A9A 2433      CLR	R3
    01A9B 2444      CLR	R4
    01A9C 2455      CLR	R5
    01A9D 806D      LDD	R6,Y+5
    01A9E 807E      LDD	R7,Y+6
    01A9F 808F      LDD	R8,Y+7
    01AA0 8498      LDD	R9,Y+8
    01AA1 0C62      ADD	R6,R2
    01AA2 1C73      ADC	R7,R3
    01AA3 1C84      ADC	R8,R4
    01AA4 1C95      ADC	R9,R5
    01AA5 826D      STD	Y+5,R6
    01AA6 827E      STD	Y+6,R7
    01AA7 828F      STD	Y+7,R8
    01AA8 8698      STD	Y+8,R9
(2420) 			cc = btr / SS(fp->fs);				/* When remaining bytes >= sector size, */
    01AA9 E029      LDI	R18,0x9
    01AAA E030      LDI	R19,0
    01AAB 8D0F      LDD	R16,Y+31
    01AAC A118      LDD	R17,Y+32
    01AAD 940E 4950 CALL	lsr16
    01AAF 0158      MOVW	R10,R16
(2421) 			if (cc) {							/* Read maximum contiguous sectors directly */
    01AB0 3000      CPI	R16,0
    01AB1 0701      CPC	R16,R17
    01AB2 F409      BNE	0x1AB4
    01AB3 C096      RJMP	0x1B4A
(2422) 				if (csect + cc > fp->fs->csize)	/* Clip at cluster boundary */
    01AB4 2C2C      MOV	R2,R12
    01AB5 2433      CLR	R3
    01AB6 0E20      ADD	R2,R16
    01AB7 1E31      ADC	R3,R17
    01AB8 8DEB      LDD	R30,Y+27
    01AB9 8DFC      LDD	R31,Y+28
    01ABA 93AF      PUSH	R26
    01ABB 93BF      PUSH	R27
    01ABC 81A0      LD	R26,Z
    01ABD 81B1      LDD	R27,Z+1
    01ABE 01FD      MOVW	R30,R26
    01ABF 91BF      POP	R27
    01AC0 91AF      POP	R26
    01AC1 8042      LDD	R4,Z+2
    01AC2 2455      CLR	R5
    01AC3 1442      CP	R4,R2
    01AC4 0453      CPC	R5,R3
    01AC5 F478      BCC	0x1AD5
(2423) 					cc = fp->fs->csize - csect;
    01AC6 2C2C      MOV	R2,R12
    01AC7 2433      CLR	R3
    01AC8 8DEB      LDD	R30,Y+27
    01AC9 8DFC      LDD	R31,Y+28
    01ACA 93AF      PUSH	R26
    01ACB 93BF      PUSH	R27
    01ACC 81A0      LD	R26,Z
    01ACD 81B1      LDD	R27,Z+1
    01ACE 01FD      MOVW	R30,R26
    01ACF 91BF      POP	R27
    01AD0 91AF      POP	R26
    01AD1 80A2      LDD	R10,Z+2
    01AD2 24BB      CLR	R11
    01AD3 18A2      SUB	R10,R2
    01AD4 08B3      SBC	R11,R3
(2424) 				if (disk_read(fp->fs->drv, rbuff, sect, (BYTE)cc) != RES_OK)
    01AD5 82AC      STD	Y+4,R10
    01AD6 802D      LDD	R2,Y+5
    01AD7 803E      LDD	R3,Y+6
    01AD8 804F      LDD	R4,Y+7
    01AD9 8458      LDD	R5,Y+8
    01ADA 8228      ST	Y,R2
    01ADB 8239      STD	Y+1,R3
    01ADC 824A      STD	Y+2,R4
    01ADD 825B      STD	Y+3,R5
    01ADE 0197      MOVW	R18,R14
    01ADF 8DEB      LDD	R30,Y+27
    01AE0 8DFC      LDD	R31,Y+28
    01AE1 93AF      PUSH	R26
    01AE2 93BF      PUSH	R27
    01AE3 81A0      LD	R26,Z
    01AE4 81B1      LDD	R27,Z+1
    01AE5 01FD      MOVW	R30,R26
    01AE6 91BF      POP	R27
    01AE7 91AF      POP	R26
    01AE8 8101      LDD	R16,Z+1
    01AE9 940E 03D4 CALL	_disk_read
    01AEB 2EC0      MOV	R12,R16
    01AEC 2300      TST	R16
    01AED F051      BEQ	0x1AF8
(2425) 					ABORT(fp->fs, FR_DISK_ERR);
    01AEE 8D8B      LDD	R24,Y+27
    01AEF 8D9C      LDD	R25,Y+28
    01AF0 9604      ADIW	R24,4
    01AF1 016C      MOVW	R12,R24
    01AF2 01FC      MOVW	R30,R24
    01AF3 8180      LD	R24,Z
    01AF4 6880      ORI	R24,0x80
    01AF5 8380      ST	Z,R24
    01AF6 E001      LDI	R16,1
    01AF7 C0D9      RJMP	0x1BD1
(2426) #if !_FS_READONLY && _FS_MINIMIZE <= 2			/* Replace one of the read sectors with cached data if it contains a dirty sector */
(2427) #if _FS_TINY
(2428) 				if (fp->fs->wflag && fp->fs->winsect - sect < cc)
    01AF8 8DEB      LDD	R30,Y+27
    01AF9 8DFC      LDD	R31,Y+28
    01AFA 80C0      LD	R12,Z
    01AFB 80D1      LDD	R13,Z+1
    01AFC 01F6      MOVW	R30,R12
    01AFD 9634      ADIW	R30,4
    01AFE 8020      LD	R2,Z
    01AFF 2022      TST	R2
    01B00 F409      BNE	0x1B02
    01B01 C041      RJMP	0x1B43
    01B02 802D      LDD	R2,Y+5
    01B03 803E      LDD	R3,Y+6
    01B04 804F      LDD	R4,Y+7
    01B05 8458      LDD	R5,Y+8
    01B06 01F6      MOVW	R30,R12
    01B07 A462      LDD	R6,Z+42
    01B08 A473      LDD	R7,Z+43
    01B09 A484      LDD	R8,Z+44
    01B0A A495      LDD	R9,Z+45
    01B0B 1862      SUB	R6,R2
    01B0C 0873      SBC	R7,R3
    01B0D 0884      SBC	R8,R4
    01B0E 0895      SBC	R9,R5
    01B0F 0115      MOVW	R2,R10
    01B10 2444      CLR	R4
    01B11 2455      CLR	R5
    01B12 1462      CP	R6,R2
    01B13 0473      CPC	R7,R3
    01B14 0484      CPC	R8,R4
    01B15 0495      CPC	R9,R5
    01B16 F560      BCC	0x1B43
(2429) 					mem_cpy(rbuff + ((fp->fs->winsect - sect) * SS(fp->fs)), fp->fs->win, SS(fp->fs));
    01B17 E080      LDI	R24,0
    01B18 E092      LDI	R25,2
    01B19 8399      STD	Y+1,R25
    01B1A 8388      ST	Y,R24
    01B1B 8DEB      LDD	R30,Y+27
    01B1C 8DFC      LDD	R31,Y+28
    01B1D 80C0      LD	R12,Z
    01B1E 80D1      LDD	R13,Z+1
    01B1F 0196      MOVW	R18,R12
    01B20 5D22      SUBI	R18,0xD2
    01B21 4F3F      SBCI	R19,0xFF
    01B22 802D      LDD	R2,Y+5
    01B23 803E      LDD	R3,Y+6
    01B24 804F      LDD	R4,Y+7
    01B25 8458      LDD	R5,Y+8
    01B26 01F6      MOVW	R30,R12
    01B27 A462      LDD	R6,Z+42
    01B28 A473      LDD	R7,Z+43
    01B29 A484      LDD	R8,Z+44
    01B2A A495      LDD	R9,Z+45
    01B2B 1862      SUB	R6,R2
    01B2C 0873      SBC	R7,R3
    01B2D 0884      SBC	R8,R4
    01B2E 0895      SBC	R9,R5
    01B2F E040      LDI	R20,0
    01B30 E052      LDI	R21,2
    01B31 E060      LDI	R22,0
    01B32 E070      LDI	R23,0
    01B33 932F      PUSH	R18
    01B34 933F      PUSH	R19
    01B35 929A      ST	-Y,R9
    01B36 928A      ST	-Y,R8
    01B37 927A      ST	-Y,R7
    01B38 926A      ST	-Y,R6
    01B39 018A      MOVW	R16,R20
    01B3A 019B      MOVW	R18,R22
    01B3B 940E 485F CALL	empy32u|empy32s
    01B3D 913F      POP	R19
    01B3E 912F      POP	R18
    01B3F 0D0E      ADD	R16,R14
    01B40 1D1F      ADC	R17,R15
    01B41 940E 0416 CALL	ff.c:mem_cpy
(2430) #else
(2431) 				if ((fp->flag & FA__DIRTY) && fp->dsect - sect < cc)
(2432) 					mem_cpy(rbuff + ((fp->dsect - sect) * SS(fp->fs)), fp->buf, SS(fp->fs));
(2433) #endif
(2434) #endif
(2435) 				rcnt = SS(fp->fs) * cc;			/* Number of bytes transferred */
    01B43 E000      LDI	R16,0
    01B44 E012      LDI	R17,2
    01B45 0195      MOVW	R18,R10
    01B46 940E 484F CALL	empy16s
    01B48 0168      MOVW	R12,R16
(2436) 				continue;
    01B49 C05A      RJMP	0x1BA4
(2437) 			}
(2438) #if !_FS_TINY
(2439) 			if (fp->dsect != sect) {			/* Load data sector if not in cache */
(2440) #if !_FS_READONLY
(2441) 				if (fp->flag & FA__DIRTY) {		/* Write-back dirty sector cache */
(2442) 					if (disk_write(fp->fs->drv, fp->buf, fp->dsect, 1) != RES_OK)
(2443) 						ABORT(fp->fs, FR_DISK_ERR);
(2444) 					fp->flag &= ~FA__DIRTY;
(2445) 				}
(2446) #endif
(2447) 				if (disk_read(fp->fs->drv, fp->buf, sect, 1) != RES_OK)	/* Fill sector cache */
(2448) 					ABORT(fp->fs, FR_DISK_ERR);
(2449) 			}
(2450) #endif
(2451) 			fp->dsect = sect;
    01B4A 802D      LDD	R2,Y+5
    01B4B 803E      LDD	R3,Y+6
    01B4C 804F      LDD	R4,Y+7
    01B4D 8458      LDD	R5,Y+8
    01B4E 8DEB      LDD	R30,Y+27
    01B4F 8DFC      LDD	R31,Y+28
    01B50 8A26      STD	Z+22,R2
    01B51 8A37      STD	Z+23,R3
    01B52 8E40      STD	Z+24,R4
    01B53 8E51      STD	Z+25,R5
(2452) 		}
(2453) 		rcnt = SS(fp->fs) - (fp->fptr % SS(fp->fs));	/* Get partial sector data from sector buffer */
    01B54 EF4F      LDI	R20,0xFF
    01B55 E051      LDI	R21,1
    01B56 E060      LDI	R22,0
    01B57 E070      LDI	R23,0
    01B58 8DEB      LDD	R30,Y+27
    01B59 8DFC      LDD	R31,Y+28
    01B5A 8026      LDD	R2,Z+6
    01B5B 8037      LDD	R3,Z+7
    01B5C 8440      LDD	R4,Z+8
    01B5D 8451      LDD	R5,Z+9
    01B5E 2224      AND	R2,R20
    01B5F 2235      AND	R3,R21
    01B60 2246      AND	R4,R22
    01B61 2257      AND	R5,R23
    01B62 E040      LDI	R20,0
    01B63 E052      LDI	R21,2
    01B64 E060      LDI	R22,0
    01B65 E070      LDI	R23,0
    01B66 1942      SUB	R20,R2
    01B67 0953      SBC	R21,R3
    01B68 0964      SBC	R22,R4
    01B69 0975      SBC	R23,R5
    01B6A 016A      MOVW	R12,R20
(2454) 		if (rcnt > btr) rcnt = btr;
    01B6B 8C0F      LDD	R0,Y+31
    01B6C A018      LDD	R1,Y+32
    01B6D 1604      CP	R0,R20
    01B6E 0615      CPC	R1,R21
    01B6F F408      BCC	0x1B71
    01B70 0160      MOVW	R12,R0
(2455) #if _FS_TINY
(2456) 		if (move_window(fp->fs, fp->dsect))		/* Move sector window */
    01B71 8DEB      LDD	R30,Y+27
    01B72 8DFC      LDD	R31,Y+28
    01B73 8826      LDD	R2,Z+22
    01B74 8837      LDD	R3,Z+23
    01B75 8C40      LDD	R4,Z+24
    01B76 8C51      LDD	R5,Z+25
    01B77 8248      ST	Y,R4
    01B78 8259      STD	Y+1,R5
    01B79 0191      MOVW	R18,R2
    01B7A 8100      LD	R16,Z
    01B7B 8111      LDD	R17,Z+1
    01B7C 940E 046F CALL	ff.c:move_window
    01B7E 2EA0      MOV	R10,R16
    01B7F 2300      TST	R16
    01B80 F051      BEQ	0x1B8B
(2457) 			ABORT(fp->fs, FR_DISK_ERR);
    01B81 8D8B      LDD	R24,Y+27
    01B82 8D9C      LDD	R25,Y+28
    01B83 9604      ADIW	R24,4
    01B84 015C      MOVW	R10,R24
    01B85 01FC      MOVW	R30,R24
    01B86 8180      LD	R24,Z
    01B87 6880      ORI	R24,0x80
    01B88 8380      ST	Z,R24
    01B89 E001      LDI	R16,1
    01B8A C046      RJMP	0x1BD1
(2458) 		mem_cpy(rbuff, &fp->fs->win[fp->fptr % SS(fp->fs)], rcnt);	/* Pick partial sector */
    01B8B 82D9      STD	Y+1,R13
    01B8C 82C8      ST	Y,R12
    01B8D EF4F      LDI	R20,0xFF
    01B8E E051      LDI	R21,1
    01B8F E060      LDI	R22,0
    01B90 E070      LDI	R23,0
    01B91 8DEB      LDD	R30,Y+27
    01B92 8DFC      LDD	R31,Y+28
    01B93 8026      LDD	R2,Z+6
    01B94 8037      LDD	R3,Z+7
    01B95 8440      LDD	R4,Z+8
    01B96 8451      LDD	R5,Z+9
    01B97 2224      AND	R2,R20
    01B98 2235      AND	R3,R21
    01B99 2246      AND	R4,R22
    01B9A 2257      AND	R5,R23
    01B9B 0191      MOVW	R18,R2
    01B9C 8180      LD	R24,Z
    01B9D 8191      LDD	R25,Z+1
    01B9E 968E      ADIW	R24,0x2E
    01B9F 0F28      ADD	R18,R24
    01BA0 1F39      ADC	R19,R25
    01BA1 0187      MOVW	R16,R14
    01BA2 940E 0416 CALL	ff.c:mem_cpy
    01BA4 0CEC      ADD	R14,R12
    01BA5 1CFD      ADC	R15,R13
    01BA6 8D8B      LDD	R24,Y+27
    01BA7 8D9C      LDD	R25,Y+28
    01BA8 9606      ADIW	R24,6
    01BA9 015C      MOVW	R10,R24
    01BAA 0116      MOVW	R2,R12
    01BAB 2444      CLR	R4
    01BAC 2455      CLR	R5
    01BAD 01FC      MOVW	R30,R24
    01BAE 8060      LD	R6,Z
    01BAF 8071      LDD	R7,Z+1
    01BB0 8082      LDD	R8,Z+2
    01BB1 8093      LDD	R9,Z+3
    01BB2 0C62      ADD	R6,R2
    01BB3 1C73      ADC	R7,R3
    01BB4 1C84      ADC	R8,R4
    01BB5 1C95      ADC	R9,R5
    01BB6 8260      ST	Z,R6
    01BB7 8271      STD	Z+1,R7
    01BB8 8282      STD	Z+2,R8
    01BB9 8293      STD	Z+3,R9
    01BBA A1E9      LDD	R30,Y+33
    01BBB A1FA      LDD	R31,Y+34
    01BBC 8020      LD	R2,Z
    01BBD 8031      LDD	R3,Z+1
    01BBE 0C2C      ADD	R2,R12
    01BBF 1C3D      ADC	R3,R13
    01BC0 8231      STD	Z+1,R3
    01BC1 8220      ST	Z,R2
    01BC2 8C0F      LDD	R0,Y+31
    01BC3 A018      LDD	R1,Y+32
    01BC4 180C      SUB	R0,R12
    01BC5 081D      SBC	R1,R13
    01BC6 A218      STD	Y+32,R1
    01BC7 8E0F      STD	Y+31,R0
    01BC8 8C0F      LDD	R0,Y+31
    01BC9 A018      LDD	R1,Y+32
    01BCA 2000      TST	R0
    01BCB F009      BEQ	0x1BCD
    01BCC CDF1      RJMP	0x19BE
    01BCD 2011      TST	R1
    01BCE F009      BEQ	0x1BD0
    01BCF CDEE      RJMP	0x19BE
(2459) #else
(2460) 		mem_cpy(rbuff, &fp->buf[fp->fptr % SS(fp->fs)], rcnt);	/* Pick partial sector */
(2461) #endif
(2462) 	}
(2463) 
(2464) 	LEAVE_FF(fp->fs, FR_OK);
    01BD0 2700      CLR	R16
    01BD1 9661      ADIW	R28,0x11
    01BD2 940E 48A8 CALL	pop_xgsetF0FC
    01BD4 9624      ADIW	R28,4
    01BD5 9508      RET
_f_write:
  res                  --> R10
  clst                 --> Y,+9
  csect                --> R12
  cc                   --> R10
  wbuff                --> R14
  sect                 --> Y,+5
  wcnt                 --> R12
  bw                   --> Y,+33
  btw                  --> Y,+31
  buff                 --> R10
  fp                   --> Y,+27
    01BD6 940E 476E CALL	push_arg4
    01BD8 940E 48B3 CALL	push_xgsetF0FC
    01BDA 0159      MOVW	R10,R18
    01BDB 9761      SBIW	R28,0x11
(2465) }
(2466) 
(2467) 
(2468) 
(2469) 
(2470) #if !_FS_READONLY
(2471) /*-----------------------------------------------------------------------*/
(2472) /* Write File                                                            */
(2473) /*-----------------------------------------------------------------------*/
(2474) 
(2475) FRESULT f_write (
(2476) 	FIL *fp,			/* Pointer to the file object */
(2477) 	const void *buff,	/* Pointer to the data to be written */
(2478) 	UINT btw,			/* Number of bytes to write */
(2479) 	UINT *bw			/* Pointer to number of bytes written */
(2480) )
(2481) {
(2482) 	FRESULT res;
(2483) 	DWORD clst, sect;
(2484) 	UINT wcnt, cc;
(2485) 	const BYTE *wbuff = buff;
    01BDC 0175      MOVW	R14,R10
(2486) 	BYTE csect;
(2487) 
(2488) 
(2489) 	*bw = 0;	/* Initialize byte counter */
    01BDD 2422      CLR	R2
    01BDE 2433      CLR	R3
    01BDF A1E9      LDD	R30,Y+33
    01BE0 A1FA      LDD	R31,Y+34
    01BE1 8231      STD	Z+1,R3
    01BE2 8220      ST	Z,R2
(2490) 
(2491) 	res = validate(fp->fs, fp->id);			/* Check validity */
    01BE3 8DEB      LDD	R30,Y+27
    01BE4 8DFC      LDD	R31,Y+28
    01BE5 8122      LDD	R18,Z+2
    01BE6 8133      LDD	R19,Z+3
    01BE7 8100      LD	R16,Z
    01BE8 8111      LDD	R17,Z+1
    01BE9 DB9D      RCALL	ff.c:validate
    01BEA 2EA0      MOV	R10,R16
(2492) 	if (res != FR_OK) LEAVE_FF(fp->fs, res);
    01BEB 2300      TST	R16
    01BEC F009      BEQ	0x1BEE
    01BED C2FC      RJMP	0x1EEA
(2493) 	if (fp->flag & FA__ERROR)				/* Aborted file? */
    01BEE 8DEB      LDD	R30,Y+27
    01BEF 8DFC      LDD	R31,Y+28
    01BF0 8024      LDD	R2,Z+4
    01BF1 FE27      SBRS	R2,7
    01BF2 C002      RJMP	0x1BF5
(2494) 		LEAVE_FF(fp->fs, FR_INT_ERR);
    01BF3 E002      LDI	R16,2
    01BF4 C2F5      RJMP	0x1EEA
(2495) 	if (!(fp->flag & FA_WRITE))				/* Check access mode */
    01BF5 8DEB      LDD	R30,Y+27
    01BF6 8DFC      LDD	R31,Y+28
    01BF7 8024      LDD	R2,Z+4
    01BF8 FC21      SBRC	R2,1
    01BF9 C002      RJMP	0x1BFC
(2496) 		LEAVE_FF(fp->fs, FR_DENIED);
    01BFA E007      LDI	R16,7
    01BFB C2EE      RJMP	0x1EEA
(2497) 	if ((DWORD)(fp->fsize + btw) < fp->fsize) btw = 0;	/* File size cannot reach 4GB */
    01BFC 8DEB      LDD	R30,Y+27
    01BFD 8DFC      LDD	R31,Y+28
    01BFE 963A      ADIW	R30,0xA
    01BFF 8020      LD	R2,Z
    01C00 8031      LDD	R3,Z+1
    01C01 8042      LDD	R4,Z+2
    01C02 8053      LDD	R5,Z+3
    01C03 862D      STD	Y+13,R2
    01C04 863E      STD	Y+14,R3
    01C05 864F      STD	Y+15,R4
    01C06 8A58      STD	Y+16,R5
    01C07 8C2F      LDD	R2,Y+31
    01C08 A038      LDD	R3,Y+32
    01C09 2444      CLR	R4
    01C0A 2455      CLR	R5
    01C0B 846D      LDD	R6,Y+13
    01C0C 847E      LDD	R7,Y+14
    01C0D 848F      LDD	R8,Y+15
    01C0E 8898      LDD	R9,Y+16
    01C0F 0C62      ADD	R6,R2
    01C10 1C73      ADC	R7,R3
    01C11 1C84      ADC	R8,R4
    01C12 1C95      ADC	R9,R5
    01C13 842D      LDD	R2,Y+13
    01C14 843E      LDD	R3,Y+14
    01C15 844F      LDD	R4,Y+15
    01C16 8858      LDD	R5,Y+16
    01C17 1462      CP	R6,R2
    01C18 0473      CPC	R7,R3
    01C19 0484      CPC	R8,R4
    01C1A 0495      CPC	R9,R5
    01C1B F008      BCS	0x1C1D
    01C1C C2A5      RJMP	0x1EC2
    01C1D 2400      CLR	R0
    01C1E 2411      CLR	R1
    01C1F A218      STD	Y+32,R1
    01C20 8E0F      STD	Y+31,R0
(2498) 
(2499) 	for ( ;  btw;							/* Repeat until all data written */
    01C21 C2A0      RJMP	0x1EC2
(2500) 		wbuff += wcnt, fp->fptr += wcnt, *bw += wcnt, btw -= wcnt) {
(2501) 		if ((fp->fptr % SS(fp->fs)) == 0) {	/* On the sector boundary? */
    01C22 EF4F      LDI	R20,0xFF
    01C23 E051      LDI	R21,1
    01C24 E060      LDI	R22,0
    01C25 E070      LDI	R23,0
    01C26 8DEB      LDD	R30,Y+27
    01C27 8DFC      LDD	R31,Y+28
    01C28 9636      ADIW	R30,6
    01C29 8020      LD	R2,Z
    01C2A 8031      LDD	R3,Z+1
    01C2B 8042      LDD	R4,Z+2
    01C2C 8053      LDD	R5,Z+3
    01C2D 2224      AND	R2,R20
    01C2E 2235      AND	R3,R21
    01C2F 2246      AND	R4,R22
    01C30 2257      AND	R5,R23
    01C31 9488      BCLR	0
    01C32 2022      TST	R2
    01C33 0432      CPC	R3,R2
    01C34 0442      CPC	R4,R2
    01C35 0452      CPC	R5,R2
    01C36 F009      BEQ	0x1C38
    01C37 C20B      RJMP	0x1E43
(2502) 			csect = (BYTE)(fp->fptr / SS(fp->fs) & (fp->fs->csize - 1));	/* Sector offset in the cluster */
    01C38 E089      LDI	R24,0x9
    01C39 E090      LDI	R25,0
    01C3A 8DEB      LDD	R30,Y+27
    01C3B 8DFC      LDD	R31,Y+28
    01C3C 8106      LDD	R16,Z+6
    01C3D 8117      LDD	R17,Z+7
    01C3E 8520      LDD	R18,Z+8
    01C3F 8531      LDD	R19,Z+9
    01C40 938A      ST	-Y,R24
    01C41 940E 4957 CALL	lsr32
    01C43 0118      MOVW	R2,R16
    01C44 0129      MOVW	R4,R18
    01C45 8DEB      LDD	R30,Y+27
    01C46 8DFC      LDD	R31,Y+28
    01C47 93AF      PUSH	R26
    01C48 93BF      PUSH	R27
    01C49 81A0      LD	R26,Z
    01C4A 81B1      LDD	R27,Z+1
    01C4B 01FD      MOVW	R30,R26
    01C4C 91BF      POP	R27
    01C4D 91AF      POP	R26
    01C4E 8182      LDD	R24,Z+2
    01C4F 2799      CLR	R25
    01C50 9701      SBIW	R24,1
    01C51 013C      MOVW	R6,R24
    01C52 2488      CLR	R8
    01C53 FC77      SBRC	R7,7
    01C54 9480      COM	R8
    01C55 2499      CLR	R9
    01C56 FC87      SBRC	R8,7
    01C57 9490      COM	R9
    01C58 2026      AND	R2,R6
    01C59 2037      AND	R3,R7
    01C5A 2048      AND	R4,R8
    01C5B 2059      AND	R5,R9
    01C5C 2CC2      MOV	R12,R2
(2503) 			if (!csect) {					/* On the cluster boundary? */
    01C5D 2022      TST	R2
    01C5E F009      BEQ	0x1C60
    01C5F C0A5      RJMP	0x1D05
(2504) 				if (fp->fptr == 0) {		/* On the top of the file? */
    01C60 8DEB      LDD	R30,Y+27
    01C61 8DFC      LDD	R31,Y+28
    01C62 9636      ADIW	R30,6
    01C63 8020      LD	R2,Z
    01C64 8031      LDD	R3,Z+1
    01C65 8042      LDD	R4,Z+2
    01C66 8053      LDD	R5,Z+3
    01C67 9488      BCLR	0
    01C68 2022      TST	R2
    01C69 0432      CPC	R3,R2
    01C6A 0442      CPC	R4,R2
    01C6B 0452      CPC	R5,R2
    01C6C F571      BNE	0x1C9B
(2505) 					clst = fp->sclust;		/* Follow from the origin */
    01C6D 8DEB      LDD	R30,Y+27
    01C6E 8DFC      LDD	R31,Y+28
    01C6F 963E      ADIW	R30,0xE
    01C70 8020      LD	R2,Z
    01C71 8031      LDD	R3,Z+1
    01C72 8042      LDD	R4,Z+2
    01C73 8053      LDD	R5,Z+3
    01C74 8629      STD	Y+9,R2
    01C75 863A      STD	Y+10,R3
    01C76 864B      STD	Y+11,R4
    01C77 865C      STD	Y+12,R5
(2506) 					if (clst == 0)			/* When no cluster is allocated, */
    01C78 8429      LDD	R2,Y+9
    01C79 843A      LDD	R3,Y+10
    01C7A 844B      LDD	R4,Y+11
    01C7B 845C      LDD	R5,Y+12
    01C7C 9488      BCLR	0
    01C7D 2022      TST	R2
    01C7E 0432      CPC	R3,R2
    01C7F 0442      CPC	R4,R2
    01C80 0452      CPC	R5,R2
    01C81 F009      BEQ	0x1C83
    01C82 C040      RJMP	0x1CC3
(2507) 						fp->sclust = clst = create_chain(fp->fs, 0);	/* Create a new cluster chain */
    01C83 E040      LDI	R20,0
    01C84 E050      LDI	R21,0
    01C85 E060      LDI	R22,0
    01C86 E070      LDI	R23,0
    01C87 8368      ST	Y,R22
    01C88 8379      STD	Y+1,R23
    01C89 019A      MOVW	R18,R20
    01C8A 8DEB      LDD	R30,Y+27
    01C8B 8DFC      LDD	R31,Y+28
    01C8C 8100      LD	R16,Z
    01C8D 8111      LDD	R17,Z+1
    01C8E 940E 09FA CALL	ff.c:create_chain
    01C90 8709      STD	Y+9,R16
    01C91 871A      STD	Y+10,R17
    01C92 872B      STD	Y+11,R18
    01C93 873C      STD	Y+12,R19
    01C94 8DEB      LDD	R30,Y+27
    01C95 8DFC      LDD	R31,Y+28
    01C96 8706      STD	Z+14,R16
    01C97 8717      STD	Z+15,R17
    01C98 8B20      STD	Z+16,R18
    01C99 8B31      STD	Z+17,R19
(2508) 				} else {					/* Middle or end of the file */
    01C9A C028      RJMP	0x1CC3
(2509) #if _USE_FASTSEEK
(2510) 					if (fp->cltbl)
    01C9B 8DEB      LDD	R30,Y+27
    01C9C 8DFC      LDD	R31,Y+28
    01C9D A020      LDD	R2,Z+32
    01C9E A031      LDD	R3,Z+33
    01C9F 2022      TST	R2
    01CA0 F411      BNE	0x1CA3
    01CA1 2033      TST	R3
    01CA2 F079      BEQ	0x1CB2
(2511) 						clst = clmt_clust(fp, fp->fptr);	/* Get cluster# from the CLMT */
    01CA3 8026      LDD	R2,Z+6
    01CA4 8037      LDD	R3,Z+7
    01CA5 8440      LDD	R4,Z+8
    01CA6 8451      LDD	R5,Z+9
    01CA7 8248      ST	Y,R4
    01CA8 8259      STD	Y+1,R5
    01CA9 0191      MOVW	R18,R2
    01CAA 018F      MOVW	R16,R30
    01CAB 940E 0B72 CALL	ff.c:clmt_clust
    01CAD 8709      STD	Y+9,R16
    01CAE 871A      STD	Y+10,R17
    01CAF 872B      STD	Y+11,R18
    01CB0 873C      STD	Y+12,R19
    01CB1 C011      RJMP	0x1CC3
(2512) 					else
(2513) #endif
(2514) 						clst = create_chain(fp->fs, fp->clust);	/* Follow or stretch cluster chain on the FAT */
    01CB2 8DEB      LDD	R30,Y+27
    01CB3 8DFC      LDD	R31,Y+28
    01CB4 8822      LDD	R2,Z+18
    01CB5 8833      LDD	R3,Z+19
    01CB6 8844      LDD	R4,Z+20
    01CB7 8855      LDD	R5,Z+21
    01CB8 8248      ST	Y,R4
    01CB9 8259      STD	Y+1,R5
    01CBA 0191      MOVW	R18,R2
    01CBB 8100      LD	R16,Z
    01CBC 8111      LDD	R17,Z+1
    01CBD 940E 09FA CALL	ff.c:create_chain
    01CBF 8709      STD	Y+9,R16
    01CC0 871A      STD	Y+10,R17
    01CC1 872B      STD	Y+11,R18
    01CC2 873C      STD	Y+12,R19
(2515) 				}
(2516) 				if (clst == 0) break;		/* Could not allocate a new cluster (disk full) */
    01CC3 8429      LDD	R2,Y+9
    01CC4 843A      LDD	R3,Y+10
    01CC5 844B      LDD	R4,Y+11
    01CC6 845C      LDD	R5,Y+12
    01CC7 9488      BCLR	0
    01CC8 2022      TST	R2
    01CC9 0432      CPC	R3,R2
    01CCA 0442      CPC	R4,R2
    01CCB 0452      CPC	R5,R2
    01CCC F409      BNE	0x1CCE
    01CCD C1FC      RJMP	0x1ECA
(2517) 				if (clst == 1) ABORT(fp->fs, FR_INT_ERR);
    01CCE E041      LDI	R20,1
    01CCF E050      LDI	R21,0
    01CD0 E060      LDI	R22,0
    01CD1 E070      LDI	R23,0
    01CD2 8429      LDD	R2,Y+9
    01CD3 843A      LDD	R3,Y+10
    01CD4 844B      LDD	R4,Y+11
    01CD5 845C      LDD	R5,Y+12
    01CD6 1624      CP	R2,R20
    01CD7 0635      CPC	R3,R21
    01CD8 0646      CPC	R4,R22
    01CD9 0657      CPC	R5,R23
    01CDA F449      BNE	0x1CE4
    01CDB 8D8B      LDD	R24,Y+27
    01CDC 8D9C      LDD	R25,Y+28
    01CDD 9604      ADIW	R24,4
    01CDE 01FC      MOVW	R30,R24
    01CDF 8180      LD	R24,Z
    01CE0 6880      ORI	R24,0x80
    01CE1 8380      ST	Z,R24
    01CE2 E002      LDI	R16,2
    01CE3 C206      RJMP	0x1EEA
(2518) 				if (clst == 0xFFFFFFFF) ABORT(fp->fs, FR_DISK_ERR);
    01CE4 EF4F      LDI	R20,0xFF
    01CE5 EF5F      LDI	R21,0xFF
    01CE6 EF6F      LDI	R22,0xFF
    01CE7 EF7F      LDI	R23,0xFF
    01CE8 8429      LDD	R2,Y+9
    01CE9 843A      LDD	R3,Y+10
    01CEA 844B      LDD	R4,Y+11
    01CEB 845C      LDD	R5,Y+12
    01CEC 1624      CP	R2,R20
    01CED 0635      CPC	R3,R21
    01CEE 0646      CPC	R4,R22
    01CEF 0657      CPC	R5,R23
    01CF0 F451      BNE	0x1CFB
    01CF1 8D8B      LDD	R24,Y+27
    01CF2 8D9C      LDD	R25,Y+28
    01CF3 9604      ADIW	R24,4
    01CF4 015C      MOVW	R10,R24
    01CF5 01FC      MOVW	R30,R24
    01CF6 8180      LD	R24,Z
    01CF7 6880      ORI	R24,0x80
    01CF8 8380      ST	Z,R24
    01CF9 E001      LDI	R16,1
    01CFA C1EF      RJMP	0x1EEA
(2519) 				fp->clust = clst;			/* Update current cluster */
    01CFB 8429      LDD	R2,Y+9
    01CFC 843A      LDD	R3,Y+10
    01CFD 844B      LDD	R4,Y+11
    01CFE 845C      LDD	R5,Y+12
    01CFF 8DEB      LDD	R30,Y+27
    01D00 8DFC      LDD	R31,Y+28
    01D01 8A22      STD	Z+18,R2
    01D02 8A33      STD	Z+19,R3
    01D03 8A44      STD	Z+20,R4
    01D04 8A55      STD	Z+21,R5
(2520) 			}
(2521) #if _FS_TINY
(2522) 			if (fp->fs->winsect == fp->dsect && move_window(fp->fs, 0))	/* Write-back sector cache */
    01D05 8DEB      LDD	R30,Y+27
    01D06 8DFC      LDD	R31,Y+28
    01D07 80A0      LD	R10,Z
    01D08 80B1      LDD	R11,Z+1
    01D09 8826      LDD	R2,Z+22
    01D0A 8837      LDD	R3,Z+23
    01D0B 8C40      LDD	R4,Z+24
    01D0C 8C51      LDD	R5,Z+25
    01D0D 01F5      MOVW	R30,R10
    01D0E A462      LDD	R6,Z+42
    01D0F A473      LDD	R7,Z+43
    01D10 A484      LDD	R8,Z+44
    01D11 A495      LDD	R9,Z+45
    01D12 1462      CP	R6,R2
    01D13 0473      CPC	R7,R3
    01D14 0484      CPC	R8,R4
    01D15 0495      CPC	R9,R5
    01D16 F4B9      BNE	0x1D2E
    01D17 E040      LDI	R20,0
    01D18 E050      LDI	R21,0
    01D19 E060      LDI	R22,0
    01D1A E070      LDI	R23,0
    01D1B 8368      ST	Y,R22
    01D1C 8379      STD	Y+1,R23
    01D1D 019A      MOVW	R18,R20
    01D1E 018F      MOVW	R16,R30
    01D1F 940E 046F CALL	ff.c:move_window
    01D21 2EA0      MOV	R10,R16
    01D22 2300      TST	R16
    01D23 F051      BEQ	0x1D2E
(2523) 				ABORT(fp->fs, FR_DISK_ERR);
    01D24 8D8B      LDD	R24,Y+27
    01D25 8D9C      LDD	R25,Y+28
    01D26 9604      ADIW	R24,4
    01D27 015C      MOVW	R10,R24
    01D28 01FC      MOVW	R30,R24
    01D29 8180      LD	R24,Z
    01D2A 6880      ORI	R24,0x80
    01D2B 8380      ST	Z,R24
    01D2C E001      LDI	R16,1
    01D2D C1BC      RJMP	0x1EEA
(2524) #else
(2525) 			if (fp->flag & FA__DIRTY) {		/* Write-back sector cache */
(2526) 				if (disk_write(fp->fs->drv, fp->buf, fp->dsect, 1) != RES_OK)
(2527) 					ABORT(fp->fs, FR_DISK_ERR);
(2528) 				fp->flag &= ~FA__DIRTY;
(2529) 			}
(2530) #endif
(2531) 			sect = clust2sect(fp->fs, fp->clust);	/* Get current sector */
    01D2E 8DEB      LDD	R30,Y+27
    01D2F 8DFC      LDD	R31,Y+28
    01D30 8822      LDD	R2,Z+18
    01D31 8833      LDD	R3,Z+19
    01D32 8844      LDD	R4,Z+20
    01D33 8855      LDD	R5,Z+21
    01D34 8248      ST	Y,R4
    01D35 8259      STD	Y+1,R5
    01D36 0191      MOVW	R18,R2
    01D37 8100      LD	R16,Z
    01D38 8111      LDD	R17,Z+1
    01D39 940E 05E6 CALL	_clust2sect
    01D3B 830D      STD	Y+5,R16
    01D3C 831E      STD	Y+6,R17
    01D3D 832F      STD	Y+7,R18
    01D3E 8738      STD	Y+8,R19
(2532) 			if (!sect) ABORT(fp->fs, FR_INT_ERR);
    01D3F 802D      LDD	R2,Y+5
    01D40 803E      LDD	R3,Y+6
    01D41 804F      LDD	R4,Y+7
    01D42 8458      LDD	R5,Y+8
    01D43 9488      BCLR	0
    01D44 2022      TST	R2
    01D45 0432      CPC	R3,R2
    01D46 0442      CPC	R4,R2
    01D47 0452      CPC	R5,R2
    01D48 F451      BNE	0x1D53
    01D49 8D8B      LDD	R24,Y+27
    01D4A 8D9C      LDD	R25,Y+28
    01D4B 9604      ADIW	R24,4
    01D4C 015C      MOVW	R10,R24
    01D4D 01FC      MOVW	R30,R24
    01D4E 8180      LD	R24,Z
    01D4F 6880      ORI	R24,0x80
    01D50 8380      ST	Z,R24
    01D51 E002      LDI	R16,2
    01D52 C197      RJMP	0x1EEA
(2533) 			sect += csect;
    01D53 2C2C      MOV	R2,R12
    01D54 2433      CLR	R3
    01D55 2444      CLR	R4
    01D56 2455      CLR	R5
    01D57 806D      LDD	R6,Y+5
    01D58 807E      LDD	R7,Y+6
    01D59 808F      LDD	R8,Y+7
    01D5A 8498      LDD	R9,Y+8
    01D5B 0C62      ADD	R6,R2
    01D5C 1C73      ADC	R7,R3
    01D5D 1C84      ADC	R8,R4
    01D5E 1C95      ADC	R9,R5
    01D5F 826D      STD	Y+5,R6
    01D60 827E      STD	Y+6,R7
    01D61 828F      STD	Y+7,R8
    01D62 8698      STD	Y+8,R9
(2534) 			cc = btw / SS(fp->fs);			/* When remaining bytes >= sector size, */
    01D63 E029      LDI	R18,0x9
    01D64 E030      LDI	R19,0
    01D65 8D0F      LDD	R16,Y+31
    01D66 A118      LDD	R17,Y+32
    01D67 940E 4950 CALL	lsr16
    01D69 0158      MOVW	R10,R16
(2535) 			if (cc) {						/* Write maximum contiguous sectors directly */
    01D6A 3000      CPI	R16,0
    01D6B 0701      CPC	R16,R17
    01D6C F409      BNE	0x1D6E
    01D6D C097      RJMP	0x1E05
(2536) 				if (csect + cc > fp->fs->csize)	/* Clip at cluster boundary */
    01D6E 2C2C      MOV	R2,R12
    01D6F 2433      CLR	R3
    01D70 0E20      ADD	R2,R16
    01D71 1E31      ADC	R3,R17
    01D72 8DEB      LDD	R30,Y+27
    01D73 8DFC      LDD	R31,Y+28
    01D74 93AF      PUSH	R26
    01D75 93BF      PUSH	R27
    01D76 81A0      LD	R26,Z
    01D77 81B1      LDD	R27,Z+1
    01D78 01FD      MOVW	R30,R26
    01D79 91BF      POP	R27
    01D7A 91AF      POP	R26
    01D7B 8042      LDD	R4,Z+2
    01D7C 2455      CLR	R5
    01D7D 1442      CP	R4,R2
    01D7E 0453      CPC	R5,R3
    01D7F F478      BCC	0x1D8F
(2537) 					cc = fp->fs->csize - csect;
    01D80 2C2C      MOV	R2,R12
    01D81 2433      CLR	R3
    01D82 8DEB      LDD	R30,Y+27
    01D83 8DFC      LDD	R31,Y+28
    01D84 93AF      PUSH	R26
    01D85 93BF      PUSH	R27
    01D86 81A0      LD	R26,Z
    01D87 81B1      LDD	R27,Z+1
    01D88 01FD      MOVW	R30,R26
    01D89 91BF      POP	R27
    01D8A 91AF      POP	R26
    01D8B 80A2      LDD	R10,Z+2
    01D8C 24BB      CLR	R11
    01D8D 18A2      SUB	R10,R2
    01D8E 08B3      SBC	R11,R3
(2538) 				if (disk_write(fp->fs->drv,(char*)wbuff, sect, (BYTE)cc) != RES_OK)
    01D8F 82AC      STD	Y+4,R10
    01D90 802D      LDD	R2,Y+5
    01D91 803E      LDD	R3,Y+6
    01D92 804F      LDD	R4,Y+7
    01D93 8458      LDD	R5,Y+8
    01D94 8228      ST	Y,R2
    01D95 8239      STD	Y+1,R3
    01D96 824A      STD	Y+2,R4
    01D97 825B      STD	Y+3,R5
    01D98 0197      MOVW	R18,R14
    01D99 8DEB      LDD	R30,Y+27
    01D9A 8DFC      LDD	R31,Y+28
    01D9B 93AF      PUSH	R26
    01D9C 93BF      PUSH	R27
    01D9D 81A0      LD	R26,Z
    01D9E 81B1      LDD	R27,Z+1
    01D9F 01FD      MOVW	R30,R26
    01DA0 91BF      POP	R27
    01DA1 91AF      POP	R26
    01DA2 8101      LDD	R16,Z+1
    01DA3 940E 03F4 CALL	_disk_write
    01DA5 2EC0      MOV	R12,R16
    01DA6 2300      TST	R16
    01DA7 F051      BEQ	0x1DB2
(2539) 					ABORT(fp->fs, FR_DISK_ERR);
    01DA8 8D8B      LDD	R24,Y+27
    01DA9 8D9C      LDD	R25,Y+28
    01DAA 9604      ADIW	R24,4
    01DAB 016C      MOVW	R12,R24
    01DAC 01FC      MOVW	R30,R24
    01DAD 8180      LD	R24,Z
    01DAE 6880      ORI	R24,0x80
    01DAF 8380      ST	Z,R24
    01DB0 E001      LDI	R16,1
    01DB1 C138      RJMP	0x1EEA
(2540) #if _FS_TINY
(2541) 				if (fp->fs->winsect - sect < cc) {	/* Refill sector cache if it gets invalidated by the direct write */
    01DB2 802D      LDD	R2,Y+5
    01DB3 803E      LDD	R3,Y+6
    01DB4 804F      LDD	R4,Y+7
    01DB5 8458      LDD	R5,Y+8
    01DB6 8DEB      LDD	R30,Y+27
    01DB7 8DFC      LDD	R31,Y+28
    01DB8 81A0      LD	R26,Z
    01DB9 81B1      LDD	R27,Z+1
    01DBA 969A      ADIW	R26,0x2A
    01DBB 906D      LD	R6,X+
    01DBC 907D      LD	R7,X+
    01DBD 908D      LD	R8,X+
    01DBE 909C      LD	R9,X
    01DBF 1862      SUB	R6,R2
    01DC0 0873      SBC	R7,R3
    01DC1 0884      SBC	R8,R4
    01DC2 0895      SBC	R9,R5
    01DC3 0115      MOVW	R2,R10
    01DC4 2444      CLR	R4
    01DC5 2455      CLR	R5
    01DC6 1462      CP	R6,R2
    01DC7 0473      CPC	R7,R3
    01DC8 0484      CPC	R8,R4
    01DC9 0495      CPC	R9,R5
    01DCA F008      BCS	0x1DCC
    01DCB C032      RJMP	0x1DFE
(2542) 					mem_cpy(fp->fs->win, wbuff + ((fp->fs->winsect - sect) * SS(fp->fs)), SS(fp->fs));
    01DCC E080      LDI	R24,0
    01DCD E092      LDI	R25,2
    01DCE 8399      STD	Y+1,R25
    01DCF 8388      ST	Y,R24
    01DD0 80C0      LD	R12,Z
    01DD1 80D1      LDD	R13,Z+1
    01DD2 802D      LDD	R2,Y+5
    01DD3 803E      LDD	R3,Y+6
    01DD4 804F      LDD	R4,Y+7
    01DD5 8458      LDD	R5,Y+8
    01DD6 01F6      MOVW	R30,R12
    01DD7 A462      LDD	R6,Z+42
    01DD8 A473      LDD	R7,Z+43
    01DD9 A484      LDD	R8,Z+44
    01DDA A495      LDD	R9,Z+45
    01DDB 1862      SUB	R6,R2
    01DDC 0873      SBC	R7,R3
    01DDD 0884      SBC	R8,R4
    01DDE 0895      SBC	R9,R5
    01DDF E040      LDI	R20,0
    01DE0 E052      LDI	R21,2
    01DE1 E060      LDI	R22,0
    01DE2 E070      LDI	R23,0
    01DE3 929A      ST	-Y,R9
    01DE4 928A      ST	-Y,R8
    01DE5 927A      ST	-Y,R7
    01DE6 926A      ST	-Y,R6
    01DE7 018A      MOVW	R16,R20
    01DE8 019B      MOVW	R18,R22
    01DE9 940E 485F CALL	empy32u|empy32s
    01DEB 0198      MOVW	R18,R16
    01DEC 0D2E      ADD	R18,R14
    01DED 1D3F      ADC	R19,R15
    01DEE 0186      MOVW	R16,R12
    01DEF 5D02      SUBI	R16,0xD2
    01DF0 4F1F      SBCI	R17,0xFF
    01DF1 940E 0416 CALL	ff.c:mem_cpy
(2543) 					fp->fs->wflag = 0;
    01DF3 2422      CLR	R2
    01DF4 8DEB      LDD	R30,Y+27
    01DF5 8DFC      LDD	R31,Y+28
    01DF6 93AF      PUSH	R26
    01DF7 93BF      PUSH	R27
    01DF8 81A0      LD	R26,Z
    01DF9 81B1      LDD	R27,Z+1
    01DFA 01FD      MOVW	R30,R26
    01DFB 91BF      POP	R27
    01DFC 91AF      POP	R26
    01DFD 8224      STD	Z+4,R2
(2544) 				}
(2545) #else
(2546) 				if (fp->dsect - sect < cc) { /* Refill sector cache if it gets invalidated by the direct write */
(2547) 					mem_cpy(fp->buf, wbuff + ((fp->dsect - sect) * SS(fp->fs)), SS(fp->fs));
(2548) 					fp->flag &= ~FA__DIRTY;
(2549) 				}
(2550) #endif
(2551) 				wcnt = SS(fp->fs) * cc;		/* Number of bytes transferred */
    01DFE E000      LDI	R16,0
    01DFF E012      LDI	R17,2
    01E00 0195      MOVW	R18,R10
    01E01 940E 484F CALL	empy16s
    01E03 0168      MOVW	R12,R16
(2552) 				continue;
    01E04 C099      RJMP	0x1E9E
(2553) 			}
(2554) #if _FS_TINY
(2555) 			if (fp->fptr >= fp->fsize) {	/* Avoid silly cache filling at growing edge */
    01E05 8DEB      LDD	R30,Y+27
    01E06 8DFC      LDD	R31,Y+28
    01E07 8422      LDD	R2,Z+10
    01E08 8433      LDD	R3,Z+11
    01E09 8444      LDD	R4,Z+12
    01E0A 8455      LDD	R5,Z+13
    01E0B 8066      LDD	R6,Z+6
    01E0C 8077      LDD	R7,Z+7
    01E0D 8480      LDD	R8,Z+8
    01E0E 8491      LDD	R9,Z+9
    01E0F 1462      CP	R6,R2
    01E10 0473      CPC	R7,R3
    01E11 0484      CPC	R8,R4
    01E12 0495      CPC	R9,R5
    01E13 F128      BCS	0x1E39
(2556) 				if (move_window(fp->fs, 0)) ABORT(fp->fs, FR_DISK_ERR);
    01E14 E040      LDI	R20,0
    01E15 E050      LDI	R21,0
    01E16 E060      LDI	R22,0
    01E17 E070      LDI	R23,0
    01E18 8368      ST	Y,R22
    01E19 8379      STD	Y+1,R23
    01E1A 019A      MOVW	R18,R20
    01E1B 8100      LD	R16,Z
    01E1C 8111      LDD	R17,Z+1
    01E1D 940E 046F CALL	ff.c:move_window
    01E1F 2EA0      MOV	R10,R16
    01E20 2300      TST	R16
    01E21 F051      BEQ	0x1E2C
    01E22 8D8B      LDD	R24,Y+27
    01E23 8D9C      LDD	R25,Y+28
    01E24 9604      ADIW	R24,4
    01E25 015C      MOVW	R10,R24
    01E26 01FC      MOVW	R30,R24
    01E27 8180      LD	R24,Z
    01E28 6880      ORI	R24,0x80
    01E29 8380      ST	Z,R24
    01E2A E001      LDI	R16,1
    01E2B C0BE      RJMP	0x1EEA
(2557) 				fp->fs->winsect = sect;
    01E2C 802D      LDD	R2,Y+5
    01E2D 803E      LDD	R3,Y+6
    01E2E 804F      LDD	R4,Y+7
    01E2F 8458      LDD	R5,Y+8
    01E30 8DEB      LDD	R30,Y+27
    01E31 8DFC      LDD	R31,Y+28
    01E32 81A0      LD	R26,Z
    01E33 81B1      LDD	R27,Z+1
    01E34 969A      ADIW	R26,0x2A
    01E35 922D      ST	X+,R2
    01E36 923D      ST	X+,R3
    01E37 924D      ST	X+,R4
    01E38 925C      ST	X,R5
(2558) 			}
(2559) #else
(2560) 			if (fp->dsect != sect) {		/* Fill sector cache with file data */
(2561) 				if (fp->fptr < fp->fsize &&
(2562) 					disk_read(fp->fs->drv, fp->buf, sect, 1) != RES_OK)
(2563) 						ABORT(fp->fs, FR_DISK_ERR);
(2564) 			}
(2565) #endif
(2566) 			fp->dsect = sect;
    01E39 802D      LDD	R2,Y+5
    01E3A 803E      LDD	R3,Y+6
    01E3B 804F      LDD	R4,Y+7
    01E3C 8458      LDD	R5,Y+8
    01E3D 8DEB      LDD	R30,Y+27
    01E3E 8DFC      LDD	R31,Y+28
    01E3F 8A26      STD	Z+22,R2
    01E40 8A37      STD	Z+23,R3
    01E41 8E40      STD	Z+24,R4
    01E42 8E51      STD	Z+25,R5
(2567) 		}
(2568) 		wcnt = SS(fp->fs) - (fp->fptr % SS(fp->fs));/* Put partial sector into file I/O buffer */
    01E43 EF4F      LDI	R20,0xFF
    01E44 E051      LDI	R21,1
    01E45 E060      LDI	R22,0
    01E46 E070      LDI	R23,0
    01E47 8DEB      LDD	R30,Y+27
    01E48 8DFC      LDD	R31,Y+28
    01E49 8026      LDD	R2,Z+6
    01E4A 8037      LDD	R3,Z+7
    01E4B 8440      LDD	R4,Z+8
    01E4C 8451      LDD	R5,Z+9
    01E4D 2224      AND	R2,R20
    01E4E 2235      AND	R3,R21
    01E4F 2246      AND	R4,R22
    01E50 2257      AND	R5,R23
    01E51 E040      LDI	R20,0
    01E52 E052      LDI	R21,2
    01E53 E060      LDI	R22,0
    01E54 E070      LDI	R23,0
    01E55 1942      SUB	R20,R2
    01E56 0953      SBC	R21,R3
    01E57 0964      SBC	R22,R4
    01E58 0975      SBC	R23,R5
    01E59 016A      MOVW	R12,R20
(2569) 		if (wcnt > btw) wcnt = btw;
    01E5A 8C0F      LDD	R0,Y+31
    01E5B A018      LDD	R1,Y+32
    01E5C 1604      CP	R0,R20
    01E5D 0615      CPC	R1,R21
    01E5E F408      BCC	0x1E60
    01E5F 0160      MOVW	R12,R0
(2570) #if _FS_TINY
(2571) 		if (move_window(fp->fs, fp->dsect))	/* Move sector window */
    01E60 8DEB      LDD	R30,Y+27
    01E61 8DFC      LDD	R31,Y+28
    01E62 8826      LDD	R2,Z+22
    01E63 8837      LDD	R3,Z+23
    01E64 8C40      LDD	R4,Z+24
    01E65 8C51      LDD	R5,Z+25
    01E66 8248      ST	Y,R4
    01E67 8259      STD	Y+1,R5
    01E68 0191      MOVW	R18,R2
    01E69 8100      LD	R16,Z
    01E6A 8111      LDD	R17,Z+1
    01E6B 940E 046F CALL	ff.c:move_window
    01E6D 2EA0      MOV	R10,R16
    01E6E 2300      TST	R16
    01E6F F051      BEQ	0x1E7A
(2572) 			ABORT(fp->fs, FR_DISK_ERR);
    01E70 8D8B      LDD	R24,Y+27
    01E71 8D9C      LDD	R25,Y+28
    01E72 9604      ADIW	R24,4
    01E73 015C      MOVW	R10,R24
    01E74 01FC      MOVW	R30,R24
    01E75 8180      LD	R24,Z
    01E76 6880      ORI	R24,0x80
    01E77 8380      ST	Z,R24
    01E78 E001      LDI	R16,1
    01E79 C070      RJMP	0x1EEA
(2573) 		mem_cpy(&fp->fs->win[fp->fptr % SS(fp->fs)], wbuff, wcnt);	/* Fit partial sector */
    01E7A 82D9      STD	Y+1,R13
    01E7B 82C8      ST	Y,R12
    01E7C 0197      MOVW	R18,R14
    01E7D EF4F      LDI	R20,0xFF
    01E7E E051      LDI	R21,1
    01E7F E060      LDI	R22,0
    01E80 E070      LDI	R23,0
    01E81 8DEB      LDD	R30,Y+27
    01E82 8DFC      LDD	R31,Y+28
    01E83 8026      LDD	R2,Z+6
    01E84 8037      LDD	R3,Z+7
    01E85 8440      LDD	R4,Z+8
    01E86 8451      LDD	R5,Z+9
    01E87 2224      AND	R2,R20
    01E88 2235      AND	R3,R21
    01E89 2246      AND	R4,R22
    01E8A 2257      AND	R5,R23
    01E8B 0181      MOVW	R16,R2
    01E8C 8180      LD	R24,Z
    01E8D 8191      LDD	R25,Z+1
    01E8E 968E      ADIW	R24,0x2E
    01E8F 0F08      ADD	R16,R24
    01E90 1F19      ADC	R17,R25
    01E91 940E 0416 CALL	ff.c:mem_cpy
(2574) 		fp->fs->wflag = 1;
    01E93 E081      LDI	R24,1
    01E94 8DEB      LDD	R30,Y+27
    01E95 8DFC      LDD	R31,Y+28
    01E96 93AF      PUSH	R26
    01E97 93BF      PUSH	R27
    01E98 81A0      LD	R26,Z
    01E99 81B1      LDD	R27,Z+1
    01E9A 01FD      MOVW	R30,R26
    01E9B 91BF      POP	R27
    01E9C 91AF      POP	R26
    01E9D 8384      STD	Z+4,R24
    01E9E 0CEC      ADD	R14,R12
    01E9F 1CFD      ADC	R15,R13
    01EA0 8D8B      LDD	R24,Y+27
    01EA1 8D9C      LDD	R25,Y+28
    01EA2 9606      ADIW	R24,6
    01EA3 015C      MOVW	R10,R24
    01EA4 0116      MOVW	R2,R12
    01EA5 2444      CLR	R4
    01EA6 2455      CLR	R5
    01EA7 01FC      MOVW	R30,R24
    01EA8 8060      LD	R6,Z
    01EA9 8071      LDD	R7,Z+1
    01EAA 8082      LDD	R8,Z+2
    01EAB 8093      LDD	R9,Z+3
    01EAC 0C62      ADD	R6,R2
    01EAD 1C73      ADC	R7,R3
    01EAE 1C84      ADC	R8,R4
    01EAF 1C95      ADC	R9,R5
    01EB0 8260      ST	Z,R6
    01EB1 8271      STD	Z+1,R7
    01EB2 8282      STD	Z+2,R8
    01EB3 8293      STD	Z+3,R9
    01EB4 A1E9      LDD	R30,Y+33
    01EB5 A1FA      LDD	R31,Y+34
    01EB6 8020      LD	R2,Z
    01EB7 8031      LDD	R3,Z+1
    01EB8 0C2C      ADD	R2,R12
    01EB9 1C3D      ADC	R3,R13
    01EBA 8231      STD	Z+1,R3
    01EBB 8220      ST	Z,R2
    01EBC 8C0F      LDD	R0,Y+31
    01EBD A018      LDD	R1,Y+32
    01EBE 180C      SUB	R0,R12
    01EBF 081D      SBC	R1,R13
    01EC0 A218      STD	Y+32,R1
    01EC1 8E0F      STD	Y+31,R0
    01EC2 8C0F      LDD	R0,Y+31
    01EC3 A018      LDD	R1,Y+32
    01EC4 2000      TST	R0
    01EC5 F009      BEQ	0x1EC7
    01EC6 CD5B      RJMP	0x1C22
    01EC7 2011      TST	R1
    01EC8 F009      BEQ	0x1ECA
    01EC9 CD58      RJMP	0x1C22
(2575) #else
(2576) 		mem_cpy(&fp->buf[fp->fptr % SS(fp->fs)], wbuff, wcnt);	/* Fit partial sector */
(2577) 		fp->flag |= FA__DIRTY;
(2578) #endif
(2579) 	}
(2580) 
(2581) 	if (fp->fptr > fp->fsize) fp->fsize = fp->fptr;	/* Update file size if needed */
    01ECA 8DEB      LDD	R30,Y+27
    01ECB 8DFC      LDD	R31,Y+28
    01ECC 8422      LDD	R2,Z+10
    01ECD 8433      LDD	R3,Z+11
    01ECE 8444      LDD	R4,Z+12
    01ECF 8455      LDD	R5,Z+13
    01ED0 8066      LDD	R6,Z+6
    01ED1 8077      LDD	R7,Z+7
    01ED2 8480      LDD	R8,Z+8
    01ED3 8491      LDD	R9,Z+9
    01ED4 1426      CP	R2,R6
    01ED5 0437      CPC	R3,R7
    01ED6 0448      CPC	R4,R8
    01ED7 0459      CPC	R5,R9
    01ED8 F440      BCC	0x1EE1
    01ED9 8026      LDD	R2,Z+6
    01EDA 8037      LDD	R3,Z+7
    01EDB 8440      LDD	R4,Z+8
    01EDC 8451      LDD	R5,Z+9
    01EDD 8622      STD	Z+10,R2
    01EDE 8633      STD	Z+11,R3
    01EDF 8644      STD	Z+12,R4
    01EE0 8655      STD	Z+13,R5
(2582) 	fp->flag |= FA__WRITTEN;						/* Set file change flag */
    01EE1 8D8B      LDD	R24,Y+27
    01EE2 8D9C      LDD	R25,Y+28
    01EE3 9604      ADIW	R24,4
    01EE4 015C      MOVW	R10,R24
    01EE5 01FC      MOVW	R30,R24
    01EE6 8180      LD	R24,Z
    01EE7 6280      ORI	R24,0x20
    01EE8 8380      ST	Z,R24
(2583) 
(2584) 	LEAVE_FF(fp->fs, FR_OK);
    01EE9 2700      CLR	R16
    01EEA 9661      ADIW	R28,0x11
    01EEB 940E 48A8 CALL	pop_xgsetF0FC
    01EED 9624      ADIW	R28,4
    01EEE 9508      RET
_f_sync:
  tim                  --> Y,+2
  dir                  --> R22
  res                  --> R10
  fp                   --> R20
    01EEF 940E 48EE CALL	push_xgsetF03C
    01EF1 01A8      MOVW	R20,R16
    01EF2 9726      SBIW	R28,6
(2585) }
(2586) 
(2587) 
(2588) 
(2589) 
(2590) /*-----------------------------------------------------------------------*/
(2591) /* Synchronize the File Object                                           */
(2592) /*-----------------------------------------------------------------------*/
(2593) 
(2594) FRESULT f_sync (
(2595) 	FIL *fp		/* Pointer to the file object */
(2596) )
(2597) {
(2598) 	FRESULT res;
(2599) 	DWORD tim;
(2600) 	BYTE *dir;
(2601) 
(2602) 
(2603) 	res = validate(fp->fs, fp->id);		/* Check validity of the object */
    01EF3 01FA      MOVW	R30,R20
    01EF4 8122      LDD	R18,Z+2
    01EF5 8133      LDD	R19,Z+3
    01EF6 8100      LD	R16,Z
    01EF7 8111      LDD	R17,Z+1
    01EF8 D88E      RCALL	ff.c:validate
    01EF9 2EA0      MOV	R10,R16
(2604) 	if (res == FR_OK) {
    01EFA 2300      TST	R16
    01EFB F009      BEQ	0x1EFD
    01EFC C09F      RJMP	0x1F9C
(2605) 		if (fp->flag & FA__WRITTEN) {	/* Has the file been written? */
    01EFD 01FA      MOVW	R30,R20
    01EFE 8024      LDD	R2,Z+4
    01EFF FE25      SBRS	R2,5
    01F00 C09B      RJMP	0x1F9C
(2606) #if !_FS_TINY	/* Write-back dirty buffer */
(2607) 			if (fp->flag & FA__DIRTY) {
(2608) 				if (disk_write(fp->fs->drv, fp->buf, fp->dsect, 1) != RES_OK)
(2609) 					LEAVE_FF(fp->fs, FR_DISK_ERR);
(2610) 				fp->flag &= ~FA__DIRTY;
(2611) 			}
(2612) #endif
(2613) 			/* Update the directory entry */
(2614) 			res = move_window(fp->fs, fp->dir_sect);
    01F01 8C22      LDD	R2,Z+26
    01F02 8C33      LDD	R3,Z+27
    01F03 8C44      LDD	R4,Z+28
    01F04 8C55      LDD	R5,Z+29
    01F05 8248      ST	Y,R4
    01F06 8259      STD	Y+1,R5
    01F07 0191      MOVW	R18,R2
    01F08 8100      LD	R16,Z
    01F09 8111      LDD	R17,Z+1
    01F0A 940E 046F CALL	ff.c:move_window
    01F0C 2EA0      MOV	R10,R16
(2615) 			if (res == FR_OK) {
    01F0D 2300      TST	R16
    01F0E F009      BEQ	0x1F10
    01F0F C08C      RJMP	0x1F9C
(2616) 				dir = fp->dir_ptr;
    01F10 01FA      MOVW	R30,R20
    01F11 8D66      LDD	R22,Z+30
    01F12 8D77      LDD	R23,Z+31
(2617) 				dir[DIR_Attr] |= AM_ARC;					/* Set archive bit */
    01F13 01CB      MOVW	R24,R22
    01F14 960B      ADIW	R24,0xB
    01F15 01FC      MOVW	R30,R24
    01F16 8180      LD	R24,Z
    01F17 6280      ORI	R24,0x20
    01F18 8380      ST	Z,R24
(2618) 				ST_DWORD(dir+DIR_FileSize, fp->fsize);		/* Update file size */
    01F19 01FA      MOVW	R30,R20
    01F1A 8422      LDD	R2,Z+10
    01F1B 8433      LDD	R3,Z+11
    01F1C 8444      LDD	R4,Z+12
    01F1D 8455      LDD	R5,Z+13
    01F1E 01FB      MOVW	R30,R22
    01F1F 8E24      STD	Z+28,R2
    01F20 01FA      MOVW	R30,R20
    01F21 8422      LDD	R2,Z+10
    01F22 8433      LDD	R3,Z+11
    01F23 2C23      MOV	R2,R3
    01F24 2433      CLR	R3
    01F25 01FB      MOVW	R30,R22
    01F26 8E25      STD	Z+29,R2
    01F27 01FA      MOVW	R30,R20
    01F28 8422      LDD	R2,Z+10
    01F29 8433      LDD	R3,Z+11
    01F2A 8444      LDD	R4,Z+12
    01F2B 8455      LDD	R5,Z+13
    01F2C 0112      MOVW	R2,R4
    01F2D 2444      CLR	R4
    01F2E 2455      CLR	R5
    01F2F 01FB      MOVW	R30,R22
    01F30 8E26      STD	Z+30,R2
    01F31 E188      LDI	R24,0x18
    01F32 E090      LDI	R25,0
    01F33 01FA      MOVW	R30,R20
    01F34 8502      LDD	R16,Z+10
    01F35 8513      LDD	R17,Z+11
    01F36 8524      LDD	R18,Z+12
    01F37 8535      LDD	R19,Z+13
    01F38 938A      ST	-Y,R24
    01F39 940E 4957 CALL	lsr32
    01F3B 01FB      MOVW	R30,R22
    01F3C 8F07      STD	Z+31,R16
(2619) 				ST_CLUST(dir, fp->sclust);					/* Update start cluster */
    01F3D 01FA      MOVW	R30,R20
    01F3E 8426      LDD	R2,Z+14
    01F3F 8437      LDD	R3,Z+15
    01F40 8840      LDD	R4,Z+16
    01F41 8851      LDD	R5,Z+17
    01F42 01FB      MOVW	R30,R22
    01F43 8E22      STD	Z+26,R2
    01F44 01FA      MOVW	R30,R20
    01F45 8426      LDD	R2,Z+14
    01F46 8437      LDD	R3,Z+15
    01F47 2C23      MOV	R2,R3
    01F48 2433      CLR	R3
    01F49 01FB      MOVW	R30,R22
    01F4A 8E23      STD	Z+27,R2
    01F4B 01FA      MOVW	R30,R20
    01F4C 8426      LDD	R2,Z+14
    01F4D 8437      LDD	R3,Z+15
    01F4E 8840      LDD	R4,Z+16
    01F4F 8851      LDD	R5,Z+17
    01F50 0112      MOVW	R2,R4
    01F51 2444      CLR	R4
    01F52 2455      CLR	R5
    01F53 01FB      MOVW	R30,R22
    01F54 8A24      STD	Z+20,R2
    01F55 01FA      MOVW	R30,R20
    01F56 8426      LDD	R2,Z+14
    01F57 8437      LDD	R3,Z+15
    01F58 8840      LDD	R4,Z+16
    01F59 8851      LDD	R5,Z+17
    01F5A 0112      MOVW	R2,R4
    01F5B 2C23      MOV	R2,R3
    01F5C 2433      CLR	R3
    01F5D 01FB      MOVW	R30,R22
    01F5E 8A25      STD	Z+21,R2
(2620) 				tim = get_fattime();						/* Update updated time */
    01F5F 940E 0411 CALL	_get_fattime
    01F61 830A      STD	Y+2,R16
    01F62 831B      STD	Y+3,R17
    01F63 832C      STD	Y+4,R18
    01F64 833D      STD	Y+5,R19
(2621) 				ST_DWORD(dir+DIR_WrtTime, tim);
    01F65 802A      LDD	R2,Y+2
    01F66 803B      LDD	R3,Y+3
    01F67 804C      LDD	R4,Y+4
    01F68 805D      LDD	R5,Y+5
    01F69 01FB      MOVW	R30,R22
    01F6A 8A26      STD	Z+22,R2
    01F6B 2C23      MOV	R2,R3
    01F6C 2433      CLR	R3
    01F6D 9677      ADIW	R30,0x17
    01F6E 8220      ST	Z,R2
    01F6F 802A      LDD	R2,Y+2
    01F70 803B      LDD	R3,Y+3
    01F71 804C      LDD	R4,Y+4
    01F72 805D      LDD	R5,Y+5
    01F73 0112      MOVW	R2,R4
    01F74 2444      CLR	R4
    01F75 2455      CLR	R5
    01F76 01FB      MOVW	R30,R22
    01F77 9678      ADIW	R30,0x18
    01F78 8220      ST	Z,R2
    01F79 E188      LDI	R24,0x18
    01F7A E090      LDI	R25,0
    01F7B 810A      LDD	R16,Y+2
    01F7C 811B      LDD	R17,Y+3
    01F7D 812C      LDD	R18,Y+4
    01F7E 813D      LDD	R19,Y+5
    01F7F 938A      ST	-Y,R24
    01F80 940E 4957 CALL	lsr32
    01F82 01FB      MOVW	R30,R22
    01F83 8F01      STD	Z+25,R16
(2622) 				fp->flag &= ~FA__WRITTEN;
    01F84 01BA      MOVW	R22,R20
    01F85 5F6C      SUBI	R22,0xFC
    01F86 4F7F      SBCI	R23,0xFF
    01F87 01FB      MOVW	R30,R22
    01F88 8180      LD	R24,Z
    01F89 7D8F      ANDI	R24,0xDF
    01F8A 8380      ST	Z,R24
(2623) 				fp->fs->wflag = 1;
    01F8B E081      LDI	R24,1
    01F8C 01FA      MOVW	R30,R20
    01F8D 93AF      PUSH	R26
    01F8E 93BF      PUSH	R27
    01F8F 81A0      LD	R26,Z
    01F90 81B1      LDD	R27,Z+1
    01F91 01FD      MOVW	R30,R26
    01F92 91BF      POP	R27
    01F93 91AF      POP	R26
    01F94 8384      STD	Z+4,R24
(2624) 				res = sync(fp->fs);
    01F95 01FA      MOVW	R30,R20
    01F96 8100      LD	R16,Z
    01F97 8111      LDD	R17,Z+1
    01F98 940E 0511 CALL	ff.c:sync
    01F9A 2EC0      MOV	R12,R16
    01F9B 2CAC      MOV	R10,R12
(2625) 			}
(2626) 		}
(2627) 	}
(2628) 
(2629) 	LEAVE_FF(fp->fs, res);
    01F9C 2D0A      MOV	R16,R10
    01F9D 9626      ADIW	R28,6
    01F9E 940C 48F7 JMP	pop_xgsetF03C
_f_close:
  res                  --> R10
  fp                   --> R12
    01FA0 940E 48B9 CALL	push_xgset003C
    01FA2 0168      MOVW	R12,R16
(2630) }
(2631) 
(2632) #endif /* !_FS_READONLY */
(2633) 
(2634) 
(2635) 
(2636) 
(2637) /*-----------------------------------------------------------------------*/
(2638) /* Close File                                                            */
(2639) /*-----------------------------------------------------------------------*/
(2640) 
(2641) FRESULT f_close (
(2642) 	FIL *fp		/* Pointer to the file object to be closed */
(2643) )
(2644) {
(2645) 	FRESULT res;
(2646) 
(2647) #if _FS_READONLY
(2648) 	FATFS *fs = fp->fs;
(2649) 	res = validate(fs, fp->id);
(2650) 	if (res == FR_OK) fp->fs = 0;	/* Discard file object */
(2651) 	LEAVE_FF(fs, res);
(2652) 
(2653) #else
(2654) 	res = f_sync(fp);		/* Flush cached data */
    01FA3 0186      MOVW	R16,R12
    01FA4 DF4A      RCALL	_f_sync
    01FA5 2EA0      MOV	R10,R16
(2655) #if _FS_SHARE
(2656) 	if (res == FR_OK) {		/* Decrement open counter */
(2657) #if _FS_REENTRANT
(2658) 		res = validate(fp->fs, fp->id);
(2659) 		if (res == FR_OK) {
(2660) 			res = dec_lock(fp->lockid);	
(2661) 			unlock_fs(fp->fs, FR_OK);
(2662) 		}
(2663) #else
(2664) 		res = dec_lock(fp->lockid);
(2665) #endif
(2666) 	}
(2667) #endif
(2668) 	if (res == FR_OK) fp->fs = 0;	/* Discard file object */
    01FA6 2300      TST	R16
    01FA7 F429      BNE	0x1FAD
    01FA8 2422      CLR	R2
    01FA9 2433      CLR	R3
    01FAA 01F6      MOVW	R30,R12
    01FAB 8231      STD	Z+1,R3
    01FAC 8220      ST	Z,R2
(2669) 	return res;
    01FAD 2D0A      MOV	R16,R10
    01FAE 940C 4893 JMP	pop_xgset003C
_f_lseek:
  ifptr                --> Y,+14
  nsect                --> Y,+10
  bcs                  --> Y,+6
  clst                 --> Y,+2
  dsc                  --> Y,+26
  tlen                 --> Y,+22
  tbl                  --> R14
  tcl                  --> Y,+18
  ulen                 --> Y,+14
  ncl                  --> Y,+10
  pcl                  --> Y,+6
  cl                   --> Y,+2
  res                  --> R10
  ofs                  --> Y,+42
  fp                   --> Y,+40
    01FB0 940E 476E CALL	push_arg4
    01FB2 940E 48B3 CALL	push_xgsetF0FC
    01FB4 976E      SBIW	R28,0x1E
(2670) #endif
(2671) }
(2672) 
(2673) 
(2674) 
(2675) 
(2676) /*-----------------------------------------------------------------------*/
(2677) /* Current Drive/Directory Handlings                                     */
(2678) /*-----------------------------------------------------------------------*/
(2679) 
(2680) #if _FS_RPATH >= 1
(2681) 
(2682) FRESULT f_chdrive (
(2683) 	BYTE drv		/* Drive number */
(2684) )
(2685) {
(2686) 	if (drv >= _VOLUMES) return FR_INVALID_DRIVE;
(2687) 
(2688) 	CurrVol = drv;
(2689) 
(2690) 	return FR_OK;
(2691) }
(2692) 
(2693) 
(2694) 
(2695) FRESULT f_chdir (
(2696) 	const TCHAR *path	/* Pointer to the directory path */
(2697) )
(2698) {
(2699) 	FRESULT res;
(2700) 	DIR dj;
(2701) 	DEF_NAMEBUF;
(2702) 
(2703) 
(2704) 	res = chk_mounted(&path, &dj.fs, 0);
(2705) 	if (res == FR_OK) {
(2706) 		INIT_BUF(dj);
(2707) 		res = follow_path(&dj, path);		/* Follow the path */
(2708) 		FREE_BUF();
(2709) 		if (res == FR_OK) {					/* Follow completed */
(2710) 			if (!dj.dir) {
(2711) 				dj.fs->cdir = dj.sclust;	/* Start directory itself */
(2712) 			} else {
(2713) 				if (dj.dir[DIR_Attr] & AM_DIR)	/* Reached to the directory */
(2714) 					dj.fs->cdir = LD_CLUST(dj.dir);
(2715) 				else
(2716) 					res = FR_NO_PATH;		/* Reached but a file */
(2717) 			}
(2718) 		}
(2719) 		if (res == FR_NO_FILE) res = FR_NO_PATH;
(2720) 	}
(2721) 
(2722) 	LEAVE_FF(dj.fs, res);
(2723) }
(2724) 
(2725) 
(2726) #if _FS_RPATH >= 2
(2727) FRESULT f_getcwd (
(2728) 	TCHAR *path,	/* Pointer to the directory path */
(2729) 	UINT sz_path	/* Size of path */
(2730) )
(2731) {
(2732) 	FRESULT res;
(2733) 	DIR dj;
(2734) 	UINT i, n;
(2735) 	DWORD ccl;
(2736) 	TCHAR *tp;
(2737) 	FILINFO fno;
(2738) 	DEF_NAMEBUF;
(2739) 
(2740) 
(2741) 	*path = 0;
(2742) 	res = chk_mounted((const TCHAR**)&path, &dj.fs, 0);	/* Get current volume */
(2743) 	if (res == FR_OK) {
(2744) 		INIT_BUF(dj);
(2745) 		i = sz_path;		/* Bottom of buffer (dir stack base) */
(2746) 		dj.sclust = dj.fs->cdir;			/* Start to follow upper dir from current dir */
(2747) 		while ((ccl = dj.sclust) != 0) {	/* Repeat while current dir is a sub-dir */
(2748) 			res = dir_sdi(&dj, 1);			/* Get parent dir */
(2749) 			if (res != FR_OK) break;
(2750) 			res = dir_read(&dj);
(2751) 			if (res != FR_OK) break;
(2752) 			dj.sclust = LD_CLUST(dj.dir);	/* Goto parent dir */
(2753) 			res = dir_sdi(&dj, 0);
(2754) 			if (res != FR_OK) break;
(2755) 			do {							/* Find the entry links to the child dir */
(2756) 				res = dir_read(&dj);
(2757) 				if (res != FR_OK) break;
(2758) 				if (ccl == LD_CLUST(dj.dir)) break;	/* Found the entry */
(2759) 				res = dir_next(&dj, 0);	
(2760) 			} while (res == FR_OK);
(2761) 			if (res == FR_NO_FILE) res = FR_INT_ERR;/* It cannot be 'not found'. */
(2762) 			if (res != FR_OK) break;
(2763) #if _USE_LFN
(2764) 			fno.lfname = path;
(2765) 			fno.lfsize = i;
(2766) #endif
(2767) 			get_fileinfo(&dj, &fno);		/* Get the dir name and push it to the buffer */
(2768) 			tp = fno.fname;
(2769) 			if (_USE_LFN && *path) tp = path;
(2770) 			for (n = 0; tp[n]; n++) ;
(2771) 			if (i < n + 3) {
(2772) 				res = FR_NOT_ENOUGH_CORE; break;
(2773) 			}
(2774) 			while (n) path[--i] = tp[--n];
(2775) 			path[--i] = '/';
(2776) 		}
(2777) 		tp = path;
(2778) 		if (res == FR_OK) {
(2779) 			*tp++ = '0' + CurrVol;			/* Put drive number */
(2780) 			*tp++ = ':';
(2781) 			if (i == sz_path) {				/* Root-dir */
(2782) 				*tp++ = '/';
(2783) 			} else {						/* Sub-dir */
(2784) 				do		/* Add stacked path str */
(2785) 					*tp++ = path[i++];
(2786) 				while (i < sz_path);
(2787) 			}
(2788) 		}
(2789) 		*tp = 0;
(2790) 		FREE_BUF();
(2791) 	}
(2792) 
(2793) 	LEAVE_FF(dj.fs, res);
(2794) }
(2795) #endif /* _FS_RPATH >= 2 */
(2796) #endif /* _FS_RPATH >= 1 */
(2797) 
(2798) 
(2799) 
(2800) #if _FS_MINIMIZE <= 2
(2801) /*-----------------------------------------------------------------------*/
(2802) /* Seek File R/W Pointer                                                 */
(2803) /*-----------------------------------------------------------------------*/
(2804) 
(2805) FRESULT f_lseek (
(2806) 	FIL *fp,		/* Pointer to the file object */
(2807) 	DWORD ofs		/* File pointer from top of file */
(2808) )
(2809) {
(2810) 	FRESULT res;
(2811) 
(2812) 
(2813) 	res = validate(fp->fs, fp->id);		/* Check validity of the object */
    01FB5 A5E8      LDD	R30,Y+40
    01FB6 A5F9      LDD	R31,Y+41
    01FB7 8122      LDD	R18,Z+2
    01FB8 8133      LDD	R19,Z+3
    01FB9 8100      LD	R16,Z
    01FBA 8111      LDD	R17,Z+1
    01FBB 940E 1787 CALL	ff.c:validate
    01FBD 2EA0      MOV	R10,R16
(2814) 	if (res != FR_OK) LEAVE_FF(fp->fs, res);
    01FBE 2300      TST	R16
    01FBF F009      BEQ	0x1FC1
    01FC0 C4A7      RJMP	0x2468
(2815) 	if (fp->flag & FA__ERROR)			/* Check abort flag */
    01FC1 A5E8      LDD	R30,Y+40
    01FC2 A5F9      LDD	R31,Y+41
    01FC3 8024      LDD	R2,Z+4
    01FC4 FE27      SBRS	R2,7
    01FC5 C002      RJMP	0x1FC8
(2816) 		LEAVE_FF(fp->fs, FR_INT_ERR);
    01FC6 E002      LDI	R16,2
    01FC7 C4A0      RJMP	0x2468
(2817) 
(2818) #if _USE_FASTSEEK
(2819) 	if (fp->cltbl) {	/* Fast seek */
    01FC8 A5E8      LDD	R30,Y+40
    01FC9 A5F9      LDD	R31,Y+41
    01FCA 96B0      ADIW	R30,0x20
    01FCB 8020      LD	R2,Z
    01FCC 8031      LDD	R3,Z+1
    01FCD 2022      TST	R2
    01FCE F419      BNE	0x1FD2
    01FCF 2033      TST	R3
    01FD0 F409      BNE	0x1FD2
    01FD1 C1E3      RJMP	0x21B5
(2820) 		DWORD cl, pcl, ncl, tcl, dsc, tlen, ulen, *tbl;
(2821) 
(2822) 		if (ofs == CREATE_LINKMAP) {	/* Create CLMT */
    01FD2 EF4F      LDI	R20,0xFF
    01FD3 EF5F      LDI	R21,0xFF
    01FD4 EF6F      LDI	R22,0xFF
    01FD5 EF7F      LDI	R23,0xFF
    01FD6 A42A      LDD	R2,Y+42
    01FD7 A43B      LDD	R3,Y+43
    01FD8 A44C      LDD	R4,Y+44
    01FD9 A45D      LDD	R5,Y+45
    01FDA 1624      CP	R2,R20
    01FDB 0635      CPC	R3,R21
    01FDC 0646      CPC	R4,R22
    01FDD 0657      CPC	R5,R23
    01FDE F009      BEQ	0x1FE0
    01FDF C109      RJMP	0x20E9
(2823) 			tbl = fp->cltbl;
    01FE0 A5E8      LDD	R30,Y+40
    01FE1 A5F9      LDD	R31,Y+41
    01FE2 A0E0      LDD	R14,Z+32
    01FE3 A0F1      LDD	R15,Z+33
(2824) 			tlen = *tbl++; ulen = 2;	/* Given table size and required table size */
    01FE4 01F7      MOVW	R30,R14
    01FE5 9021      LD	R2,Z+
    01FE6 9031      LD	R3,Z+
    01FE7 9041      LD	R4,Z+
    01FE8 9051      LD	R5,Z+
    01FE9 017F      MOVW	R14,R30
    01FEA 8A2E      STD	Y+22,R2
    01FEB 8A3F      STD	Y+23,R3
    01FEC 8E48      STD	Y+24,R4
    01FED 8E59      STD	Y+25,R5
    01FEE E082      LDI	R24,2
    01FEF 878E      STD	Y+14,R24
    01FF0 E080      LDI	R24,0
    01FF1 878F      STD	Y+15,R24
    01FF2 8B88      STD	Y+16,R24
    01FF3 8B89      STD	Y+17,R24
(2825) 			cl = fp->sclust;			/* Top of the chain */
    01FF4 A5E8      LDD	R30,Y+40
    01FF5 A5F9      LDD	R31,Y+41
    01FF6 963E      ADIW	R30,0xE
    01FF7 8020      LD	R2,Z
    01FF8 8031      LDD	R3,Z+1
    01FF9 8042      LDD	R4,Z+2
    01FFA 8053      LDD	R5,Z+3
    01FFB 822A      STD	Y+2,R2
    01FFC 823B      STD	Y+3,R3
    01FFD 824C      STD	Y+4,R4
    01FFE 825D      STD	Y+5,R5
(2826) 			if (cl) {
    01FFF 802A      LDD	R2,Y+2
    02000 803B      LDD	R3,Y+3
    02001 804C      LDD	R4,Y+4
    02002 805D      LDD	R5,Y+5
    02003 9488      BCLR	0
    02004 2022      TST	R2
    02005 0432      CPC	R3,R2
    02006 0442      CPC	R4,R2
    02007 0452      CPC	R5,R2
    02008 F409      BNE	0x200A
    02009 C0BB      RJMP	0x20C5
(2827) 				do {
(2828) 					/* Get a fragment */
(2829) 					tcl = cl; ncl = 0; ulen += 2;	/* Top, length and used items */
    0200A 802A      LDD	R2,Y+2
    0200B 803B      LDD	R3,Y+3
    0200C 804C      LDD	R4,Y+4
    0200D 805D      LDD	R5,Y+5
    0200E 8A2A      STD	Y+18,R2
    0200F 8A3B      STD	Y+19,R3
    02010 8A4C      STD	Y+20,R4
    02011 8A5D      STD	Y+21,R5
    02012 E080      LDI	R24,0
    02013 878A      STD	Y+10,R24
    02014 878B      STD	Y+11,R24
    02015 878C      STD	Y+12,R24
    02016 878D      STD	Y+13,R24
    02017 E042      LDI	R20,2
    02018 E050      LDI	R21,0
    02019 E060      LDI	R22,0
    0201A E070      LDI	R23,0
    0201B 842E      LDD	R2,Y+14
    0201C 843F      LDD	R3,Y+15
    0201D 8848      LDD	R4,Y+16
    0201E 8859      LDD	R5,Y+17
    0201F 0E24      ADD	R2,R20
    02020 1E35      ADC	R3,R21
    02021 1E46      ADC	R4,R22
    02022 1E57      ADC	R5,R23
    02023 862E      STD	Y+14,R2
    02024 863F      STD	Y+15,R3
    02025 8A48      STD	Y+16,R4
    02026 8A59      STD	Y+17,R5
(2830) 					do {
(2831) 						pcl = cl; ncl++;
    02027 802A      LDD	R2,Y+2
    02028 803B      LDD	R3,Y+3
    02029 804C      LDD	R4,Y+4
    0202A 805D      LDD	R5,Y+5
    0202B 822E      STD	Y+6,R2
    0202C 823F      STD	Y+7,R3
    0202D 8648      STD	Y+8,R4
    0202E 8659      STD	Y+9,R5
    0202F E041      LDI	R20,1
    02030 E050      LDI	R21,0
    02031 E060      LDI	R22,0
    02032 E070      LDI	R23,0
    02033 842A      LDD	R2,Y+10
    02034 843B      LDD	R3,Y+11
    02035 844C      LDD	R4,Y+12
    02036 845D      LDD	R5,Y+13
    02037 0E24      ADD	R2,R20
    02038 1E35      ADC	R3,R21
    02039 1E46      ADC	R4,R22
    0203A 1E57      ADC	R5,R23
    0203B 862A      STD	Y+10,R2
    0203C 863B      STD	Y+11,R3
    0203D 864C      STD	Y+12,R4
    0203E 865D      STD	Y+13,R5
(2832) 						cl = get_fat(fp->fs, cl);
    0203F 802A      LDD	R2,Y+2
    02040 803B      LDD	R3,Y+3
    02041 804C      LDD	R4,Y+4
    02042 805D      LDD	R5,Y+5
    02043 8248      ST	Y,R4
    02044 8259      STD	Y+1,R5
    02045 0191      MOVW	R18,R2
    02046 A5E8      LDD	R30,Y+40
    02047 A5F9      LDD	R31,Y+41
    02048 8100      LD	R16,Z
    02049 8111      LDD	R17,Z+1
    0204A 940E 0638 CALL	_get_fat
    0204C 830A      STD	Y+2,R16
    0204D 831B      STD	Y+3,R17
    0204E 832C      STD	Y+4,R18
    0204F 833D      STD	Y+5,R19
(2833) 						if (cl <= 1) ABORT(fp->fs, FR_INT_ERR);
    02050 E041      LDI	R20,1
    02051 E050      LDI	R21,0
    02052 E060      LDI	R22,0
    02053 E070      LDI	R23,0
    02054 802A      LDD	R2,Y+2
    02055 803B      LDD	R3,Y+3
    02056 804C      LDD	R4,Y+4
    02057 805D      LDD	R5,Y+5
    02058 1542      CP	R20,R2
    02059 0553      CPC	R21,R3
    0205A 0564      CPC	R22,R4
    0205B 0575      CPC	R23,R5
    0205C F048      BCS	0x2066
    0205D A588      LDD	R24,Y+40
    0205E A599      LDD	R25,Y+41
    0205F 9604      ADIW	R24,4
    02060 01FC      MOVW	R30,R24
    02061 8180      LD	R24,Z
    02062 6880      ORI	R24,0x80
    02063 8380      ST	Z,R24
    02064 E002      LDI	R16,2
    02065 C402      RJMP	0x2468
(2834) 						if (cl == 0xFFFFFFFF) ABORT(fp->fs, FR_DISK_ERR);
    02066 EF4F      LDI	R20,0xFF
    02067 EF5F      LDI	R21,0xFF
    02068 EF6F      LDI	R22,0xFF
    02069 EF7F      LDI	R23,0xFF
    0206A 802A      LDD	R2,Y+2
    0206B 803B      LDD	R3,Y+3
    0206C 804C      LDD	R4,Y+4
    0206D 805D      LDD	R5,Y+5
    0206E 1624      CP	R2,R20
    0206F 0635      CPC	R3,R21
    02070 0646      CPC	R4,R22
    02071 0657      CPC	R5,R23
    02072 F451      BNE	0x207D
    02073 A588      LDD	R24,Y+40
    02074 A599      LDD	R25,Y+41
    02075 9604      ADIW	R24,4
    02076 016C      MOVW	R12,R24
    02077 01FC      MOVW	R30,R24
    02078 8180      LD	R24,Z
    02079 6880      ORI	R24,0x80
    0207A 8380      ST	Z,R24
    0207B E001      LDI	R16,1
    0207C C3EB      RJMP	0x2468
(2835) 					} while (cl == pcl + 1);
    0207D E041      LDI	R20,1
    0207E E050      LDI	R21,0
    0207F E060      LDI	R22,0
    02080 E070      LDI	R23,0
    02081 802E      LDD	R2,Y+6
    02082 803F      LDD	R3,Y+7
    02083 8448      LDD	R4,Y+8
    02084 8459      LDD	R5,Y+9
    02085 0E24      ADD	R2,R20
    02086 1E35      ADC	R3,R21
    02087 1E46      ADC	R4,R22
    02088 1E57      ADC	R5,R23
    02089 806A      LDD	R6,Y+2
    0208A 807B      LDD	R7,Y+3
    0208B 808C      LDD	R8,Y+4
    0208C 809D      LDD	R9,Y+5
    0208D 1462      CP	R6,R2
    0208E 0473      CPC	R7,R3
    0208F 0484      CPC	R8,R4
    02090 0495      CPC	R9,R5
    02091 F409      BNE	0x2093
    02092 CF94      RJMP	0x2027
(2836) 					if (ulen <= tlen) {		/* Store the length and top of the fragment */
    02093 882E      LDD	R2,Y+22
    02094 883F      LDD	R3,Y+23
    02095 8C48      LDD	R4,Y+24
    02096 8C59      LDD	R5,Y+25
    02097 846E      LDD	R6,Y+14
    02098 847F      LDD	R7,Y+15
    02099 8888      LDD	R8,Y+16
    0209A 8899      LDD	R9,Y+17
    0209B 1426      CP	R2,R6
    0209C 0437      CPC	R3,R7
    0209D 0448      CPC	R4,R8
    0209E 0459      CPC	R5,R9
    0209F F090      BCS	0x20B2
(2837) 						*tbl++ = ncl; *tbl++ = tcl;
    020A0 842A      LDD	R2,Y+10
    020A1 843B      LDD	R3,Y+11
    020A2 844C      LDD	R4,Y+12
    020A3 845D      LDD	R5,Y+13
    020A4 01F7      MOVW	R30,R14
    020A5 9221      ST	Z+,R2
    020A6 9231      ST	Z+,R3
    020A7 9241      ST	Z+,R4
    020A8 9251      ST	Z+,R5
    020A9 882A      LDD	R2,Y+18
    020AA 883B      LDD	R3,Y+19
    020AB 884C      LDD	R4,Y+20
    020AC 885D      LDD	R5,Y+21
    020AD 9221      ST	Z+,R2
    020AE 9231      ST	Z+,R3
    020AF 9241      ST	Z+,R4
    020B0 9251      ST	Z+,R5
    020B1 017F      MOVW	R14,R30
(2838) 					}
(2839) 				} while (cl < fp->fs->n_fatent);	/* Repeat until end of chain */
    020B2 A5E8      LDD	R30,Y+40
    020B3 A5F9      LDD	R31,Y+41
    020B4 81A0      LD	R26,Z
    020B5 81B1      LDD	R27,Z+1
    020B6 9656      ADIW	R26,0x16
    020B7 902D      LD	R2,X+
    020B8 903D      LD	R3,X+
    020B9 904D      LD	R4,X+
    020BA 905C      LD	R5,X
    020BB 806A      LDD	R6,Y+2
    020BC 807B      LDD	R7,Y+3
    020BD 808C      LDD	R8,Y+4
    020BE 809D      LDD	R9,Y+5
    020BF 1462      CP	R6,R2
    020C0 0473      CPC	R7,R3
    020C1 0484      CPC	R8,R4
    020C2 0495      CPC	R9,R5
    020C3 F408      BCC	0x20C5
    020C4 CF45      RJMP	0x200A
(2840) 			}
(2841) 			*fp->cltbl = ulen;	/* Number of items used */
    020C5 842E      LDD	R2,Y+14
    020C6 843F      LDD	R3,Y+15
    020C7 8848      LDD	R4,Y+16
    020C8 8859      LDD	R5,Y+17
    020C9 A5E8      LDD	R30,Y+40
    020CA A5F9      LDD	R31,Y+41
    020CB 96B0      ADIW	R30,0x20
    020CC 81A0      LD	R26,Z
    020CD 81B1      LDD	R27,Z+1
    020CE 922D      ST	X+,R2
    020CF 923D      ST	X+,R3
    020D0 924D      ST	X+,R4
    020D1 925C      ST	X,R5
(2842) 			if (ulen <= tlen)
    020D2 882E      LDD	R2,Y+22
    020D3 883F      LDD	R3,Y+23
    020D4 8C48      LDD	R4,Y+24
    020D5 8C59      LDD	R5,Y+25
    020D6 846E      LDD	R6,Y+14
    020D7 847F      LDD	R7,Y+15
    020D8 8888      LDD	R8,Y+16
    020D9 8899      LDD	R9,Y+17
    020DA 1426      CP	R2,R6
    020DB 0437      CPC	R3,R7
    020DC 0448      CPC	R4,R8
    020DD 0459      CPC	R5,R9
    020DE F038      BCS	0x20E6
(2843) 				*tbl = 0;		/* Terminate table */
    020DF 01F7      MOVW	R30,R14
    020E0 E080      LDI	R24,0
    020E1 8380      ST	Z,R24
    020E2 8381      STD	Z+1,R24
    020E3 8382      STD	Z+2,R24
    020E4 8383      STD	Z+3,R24
    020E5 C381      RJMP	0x2467
(2844) 			else
(2845) 				res = FR_NOT_ENOUGH_CORE;	/* Given table size is smaller than required */
    020E6 E181      LDI	R24,0x11
    020E7 2EA8      MOV	R10,R24
(2846) 
(2847) 		} else {						/* Fast seek */
    020E8 C37E      RJMP	0x2467
(2848) 			if (ofs > fp->fsize)		/* Clip offset at the file size */
    020E9 A5E8      LDD	R30,Y+40
    020EA A5F9      LDD	R31,Y+41
    020EB 963A      ADIW	R30,0xA
    020EC 8020      LD	R2,Z
    020ED 8031      LDD	R3,Z+1
    020EE 8042      LDD	R4,Z+2
    020EF 8053      LDD	R5,Z+3
    020F0 A46A      LDD	R6,Y+42
    020F1 A47B      LDD	R7,Y+43
    020F2 A48C      LDD	R8,Y+44
    020F3 A49D      LDD	R9,Y+45
    020F4 1426      CP	R2,R6
    020F5 0437      CPC	R3,R7
    020F6 0448      CPC	R4,R8
    020F7 0459      CPC	R5,R9
    020F8 F458      BCC	0x2104
(2849) 				ofs = fp->fsize;
    020F9 A5E8      LDD	R30,Y+40
    020FA A5F9      LDD	R31,Y+41
    020FB 963A      ADIW	R30,0xA
    020FC 8020      LD	R2,Z
    020FD 8031      LDD	R3,Z+1
    020FE 8042      LDD	R4,Z+2
    020FF 8053      LDD	R5,Z+3
    02100 A62A      STD	Y+42,R2
    02101 A63B      STD	Y+43,R3
    02102 A64C      STD	Y+44,R4
    02103 A65D      STD	Y+45,R5
(2850) 			fp->fptr = ofs;				/* Set file pointer */
    02104 A42A      LDD	R2,Y+42
    02105 A43B      LDD	R3,Y+43
    02106 A44C      LDD	R4,Y+44
    02107 A45D      LDD	R5,Y+45
    02108 A5E8      LDD	R30,Y+40
    02109 A5F9      LDD	R31,Y+41
    0210A 9636      ADIW	R30,6
    0210B 8220      ST	Z,R2
    0210C 8231      STD	Z+1,R3
    0210D 8242      STD	Z+2,R4
    0210E 8253      STD	Z+3,R5
(2851) 			if (ofs) {
    0210F 9488      BCLR	0
    02110 2022      TST	R2
    02111 0432      CPC	R3,R2
    02112 0442      CPC	R4,R2
    02113 0452      CPC	R5,R2
    02114 F409      BNE	0x2116
    02115 C351      RJMP	0x2467
(2852) 				fp->clust = clmt_clust(fp, ofs - 1);
    02116 E041      LDI	R20,1
    02117 E050      LDI	R21,0
    02118 E060      LDI	R22,0
    02119 E070      LDI	R23,0
    0211A 1A24      SUB	R2,R20
    0211B 0A35      SBC	R3,R21
    0211C 0A46      SBC	R4,R22
    0211D 0A57      SBC	R5,R23
    0211E 8248      ST	Y,R4
    0211F 8259      STD	Y+1,R5
    02120 0191      MOVW	R18,R2
    02121 A508      LDD	R16,Y+40
    02122 A519      LDD	R17,Y+41
    02123 940E 0B72 CALL	ff.c:clmt_clust
    02125 A5E8      LDD	R30,Y+40
    02126 A5F9      LDD	R31,Y+41
    02127 8B02      STD	Z+18,R16
    02128 8B13      STD	Z+19,R17
    02129 8B24      STD	Z+20,R18
    0212A 8B35      STD	Z+21,R19
(2853) 				dsc = clust2sect(fp->fs, fp->clust);
    0212B 8822      LDD	R2,Z+18
    0212C 8833      LDD	R3,Z+19
    0212D 8844      LDD	R4,Z+20
    0212E 8855      LDD	R5,Z+21
    0212F 8248      ST	Y,R4
    02130 8259      STD	Y+1,R5
    02131 0191      MOVW	R18,R2
    02132 8100      LD	R16,Z
    02133 8111      LDD	R17,Z+1
    02134 940E 05E6 CALL	_clust2sect
    02136 8F0A      STD	Y+26,R16
    02137 8F1B      STD	Y+27,R17
    02138 8F2C      STD	Y+28,R18
    02139 8F3D      STD	Y+29,R19
(2854) 				if (!dsc) ABORT(fp->fs, FR_INT_ERR);
    0213A 8C2A      LDD	R2,Y+26
    0213B 8C3B      LDD	R3,Y+27
    0213C 8C4C      LDD	R4,Y+28
    0213D 8C5D      LDD	R5,Y+29
    0213E 9488      BCLR	0
    0213F 2022      TST	R2
    02140 0432      CPC	R3,R2
    02141 0442      CPC	R4,R2
    02142 0452      CPC	R5,R2
    02143 F451      BNE	0x214E
    02144 A588      LDD	R24,Y+40
    02145 A599      LDD	R25,Y+41
    02146 9604      ADIW	R24,4
    02147 017C      MOVW	R14,R24
    02148 01FC      MOVW	R30,R24
    02149 8180      LD	R24,Z
    0214A 6880      ORI	R24,0x80
    0214B 8380      ST	Z,R24
    0214C E002      LDI	R16,2
    0214D C31A      RJMP	0x2468
(2855) 				dsc += (ofs - 1) / SS(fp->fs) & (fp->fs->csize - 1);
    0214E E041      LDI	R20,1
    0214F E050      LDI	R21,0
    02150 E060      LDI	R22,0
    02151 E070      LDI	R23,0
    02152 A50A      LDD	R16,Y+42
    02153 A51B      LDD	R17,Y+43
    02154 A52C      LDD	R18,Y+44
    02155 A53D      LDD	R19,Y+45
    02156 1B04      SUB	R16,R20
    02157 0B15      SBC	R17,R21
    02158 0B26      SBC	R18,R22
    02159 0B37      SBC	R19,R23
    0215A E089      LDI	R24,0x9
    0215B E090      LDI	R25,0
    0215C 938A      ST	-Y,R24
    0215D 940E 4957 CALL	lsr32
    0215F 0118      MOVW	R2,R16
    02160 0129      MOVW	R4,R18
    02161 A5E8      LDD	R30,Y+40
    02162 A5F9      LDD	R31,Y+41
    02163 93AF      PUSH	R26
    02164 93BF      PUSH	R27
    02165 81A0      LD	R26,Z
    02166 81B1      LDD	R27,Z+1
    02167 01FD      MOVW	R30,R26
    02168 91BF      POP	R27
    02169 91AF      POP	R26
    0216A 9632      ADIW	R30,2
    0216B 8180      LD	R24,Z
    0216C 2799      CLR	R25
    0216D 9701      SBIW	R24,1
    0216E 013C      MOVW	R6,R24
    0216F 2488      CLR	R8
    02170 FC77      SBRC	R7,7
    02171 9480      COM	R8
    02172 2499      CLR	R9
    02173 FC87      SBRC	R8,7
    02174 9490      COM	R9
    02175 2026      AND	R2,R6
    02176 2037      AND	R3,R7
    02177 2048      AND	R4,R8
    02178 2059      AND	R5,R9
    02179 8C6A      LDD	R6,Y+26
    0217A 8C7B      LDD	R7,Y+27
    0217B 8C8C      LDD	R8,Y+28
    0217C 8C9D      LDD	R9,Y+29
    0217D 0C62      ADD	R6,R2
    0217E 1C73      ADC	R7,R3
    0217F 1C84      ADC	R8,R4
    02180 1C95      ADC	R9,R5
    02181 8E6A      STD	Y+26,R6
    02182 8E7B      STD	Y+27,R7
    02183 8E8C      STD	Y+28,R8
    02184 8E9D      STD	Y+29,R9
(2856) 				if (fp->fptr % SS(fp->fs) && dsc != fp->dsect) {	/* Refill sector cache if needed */
    02185 EF4F      LDI	R20,0xFF
    02186 E051      LDI	R21,1
    02187 E060      LDI	R22,0
    02188 E070      LDI	R23,0
    02189 A5E8      LDD	R30,Y+40
    0218A A5F9      LDD	R31,Y+41
    0218B 9636      ADIW	R30,6
    0218C 8020      LD	R2,Z
    0218D 8031      LDD	R3,Z+1
    0218E 8042      LDD	R4,Z+2
    0218F 8053      LDD	R5,Z+3
    02190 2224      AND	R2,R20
    02191 2235      AND	R3,R21
    02192 2246      AND	R4,R22
    02193 2257      AND	R5,R23
    02194 9488      BCLR	0
    02195 2022      TST	R2
    02196 0432      CPC	R3,R2
    02197 0442      CPC	R4,R2
    02198 0452      CPC	R5,R2
    02199 F409      BNE	0x219B
    0219A C2CC      RJMP	0x2467
    0219B A5E8      LDD	R30,Y+40
    0219C A5F9      LDD	R31,Y+41
    0219D 9676      ADIW	R30,0x16
    0219E 8020      LD	R2,Z
    0219F 8031      LDD	R3,Z+1
    021A0 8042      LDD	R4,Z+2
    021A1 8053      LDD	R5,Z+3
    021A2 8C6A      LDD	R6,Y+26
    021A3 8C7B      LDD	R7,Y+27
    021A4 8C8C      LDD	R8,Y+28
    021A5 8C9D      LDD	R9,Y+29
    021A6 1462      CP	R6,R2
    021A7 0473      CPC	R7,R3
    021A8 0484      CPC	R8,R4
    021A9 0495      CPC	R9,R5
    021AA F409      BNE	0x21AC
    021AB C2BB      RJMP	0x2467
(2857) #if !_FS_TINY
(2858) #if !_FS_READONLY
(2859) 					if (fp->flag & FA__DIRTY) {		/* Write-back dirty sector cache */
(2860) 						if (disk_write(fp->fs->drv, fp->buf, fp->dsect, 1) != RES_OK)
(2861) 							ABORT(fp->fs, FR_DISK_ERR);
(2862) 						fp->flag &= ~FA__DIRTY;
(2863) 					}
(2864) #endif
(2865) 					if (disk_read(fp->fs->drv, fp->buf, dsc, 1) != RES_OK)	/* Load current sector */
(2866) 						ABORT(fp->fs, FR_DISK_ERR);
(2867) #endif
(2868) 					fp->dsect = dsc;
    021AC 0113      MOVW	R2,R6
    021AD 0124      MOVW	R4,R8
    021AE A5E8      LDD	R30,Y+40
    021AF A5F9      LDD	R31,Y+41
    021B0 8A26      STD	Z+22,R2
    021B1 8A37      STD	Z+23,R3
    021B2 8E40      STD	Z+24,R4
    021B3 8E51      STD	Z+25,R5
(2869) 				}
(2870) 			}
(2871) 		}
(2872) 	} else
    021B4 C2B2      RJMP	0x2467
(2873) #endif
(2874) 
(2875) 	/* Normal Seek */
(2876) 	{
(2877) 		DWORD clst, bcs, nsect, ifptr;
(2878) 
(2879) 		if (ofs > fp->fsize					/* In read-only mode, clip offset with the file size */
    021B5 A5E8      LDD	R30,Y+40
    021B6 A5F9      LDD	R31,Y+41
    021B7 963A      ADIW	R30,0xA
    021B8 8020      LD	R2,Z
    021B9 8031      LDD	R3,Z+1
    021BA 8042      LDD	R4,Z+2
    021BB 8053      LDD	R5,Z+3
    021BC A46A      LDD	R6,Y+42
    021BD A47B      LDD	R7,Y+43
    021BE A48C      LDD	R8,Y+44
    021BF A49D      LDD	R9,Y+45
    021C0 1426      CP	R2,R6
    021C1 0437      CPC	R3,R7
    021C2 0448      CPC	R4,R8
    021C3 0459      CPC	R5,R9
    021C4 F470      BCC	0x21D3
    021C5 A5E8      LDD	R30,Y+40
    021C6 A5F9      LDD	R31,Y+41
    021C7 8024      LDD	R2,Z+4
    021C8 FC21      SBRC	R2,1
    021C9 C009      RJMP	0x21D3
(2880) #if !_FS_READONLY
(2881) 			 && !(fp->flag & FA_WRITE)
(2882) #endif
(2883) 			) ofs = fp->fsize;
    021CA 963A      ADIW	R30,0xA
    021CB 8020      LD	R2,Z
    021CC 8031      LDD	R3,Z+1
    021CD 8042      LDD	R4,Z+2
    021CE 8053      LDD	R5,Z+3
    021CF A62A      STD	Y+42,R2
    021D0 A63B      STD	Y+43,R3
    021D1 A64C      STD	Y+44,R4
    021D2 A65D      STD	Y+45,R5
(2884) 
(2885) 		ifptr = fp->fptr;
    021D3 A5E8      LDD	R30,Y+40
    021D4 A5F9      LDD	R31,Y+41
    021D5 9636      ADIW	R30,6
    021D6 8020      LD	R2,Z
    021D7 8031      LDD	R3,Z+1
    021D8 8042      LDD	R4,Z+2
    021D9 8053      LDD	R5,Z+3
    021DA 862E      STD	Y+14,R2
    021DB 863F      STD	Y+15,R3
    021DC 8A48      STD	Y+16,R4
    021DD 8A59      STD	Y+17,R5
(2886) 		fp->fptr = nsect = 0;
    021DE E080      LDI	R24,0
    021DF 878A      STD	Y+10,R24
    021E0 878B      STD	Y+11,R24
    021E1 878C      STD	Y+12,R24
    021E2 878D      STD	Y+13,R24
    021E3 A5E8      LDD	R30,Y+40
    021E4 A5F9      LDD	R31,Y+41
    021E5 9636      ADIW	R30,6
    021E6 E080      LDI	R24,0
    021E7 8380      ST	Z,R24
    021E8 8381      STD	Z+1,R24
    021E9 8382      STD	Z+2,R24
    021EA 8383      STD	Z+3,R24
(2887) 		if (ofs) {
    021EB A42A      LDD	R2,Y+42
    021EC A43B      LDD	R3,Y+43
    021ED A44C      LDD	R4,Y+44
    021EE A45D      LDD	R5,Y+45
    021EF 9488      BCLR	0
    021F0 2022      TST	R2
    021F1 0432      CPC	R3,R2
    021F2 0442      CPC	R4,R2
    021F3 0452      CPC	R5,R2
    021F4 F409      BNE	0x21F6
    021F5 C226      RJMP	0x241C
(2888) 			bcs = (DWORD)fp->fs->csize * SS(fp->fs);	/* Cluster size (byte) */
    021F6 A5E8      LDD	R30,Y+40
    021F7 A5F9      LDD	R31,Y+41
    021F8 93AF      PUSH	R26
    021F9 93BF      PUSH	R27
    021FA 81A0      LD	R26,Z
    021FB 81B1      LDD	R27,Z+1
    021FC 01FD      MOVW	R30,R26
    021FD 91BF      POP	R27
    021FE 91AF      POP	R26
    021FF 9632      ADIW	R30,2
    02200 8020      LD	R2,Z
    02201 2433      CLR	R3
    02202 2444      CLR	R4
    02203 2455      CLR	R5
    02204 E040      LDI	R20,0
    02205 E052      LDI	R21,2
    02206 E060      LDI	R22,0
    02207 E070      LDI	R23,0
    02208 925A      ST	-Y,R5
    02209 924A      ST	-Y,R4
    0220A 923A      ST	-Y,R3
    0220B 922A      ST	-Y,R2
    0220C 018A      MOVW	R16,R20
    0220D 019B      MOVW	R18,R22
    0220E 940E 485F CALL	empy32u|empy32s
    02210 830E      STD	Y+6,R16
    02211 831F      STD	Y+7,R17
    02212 8728      STD	Y+8,R18
    02213 8739      STD	Y+9,R19
(2889) 			if (ifptr > 0 &&
    02214 842E      LDD	R2,Y+14
    02215 843F      LDD	R3,Y+15
    02216 8848      LDD	R4,Y+16
    02217 8859      LDD	R5,Y+17
    02218 9488      BCLR	0
    02219 2022      TST	R2
    0221A 0432      CPC	R3,R2
    0221B 0442      CPC	R4,R2
    0221C 0452      CPC	R5,R2
    0221D F409      BNE	0x221F
    0221E C075      RJMP	0x2294
    0221F E041      LDI	R20,1
    02220 E050      LDI	R21,0
    02221 E060      LDI	R22,0
    02222 E070      LDI	R23,0
    02223 0181      MOVW	R16,R2
    02224 0192      MOVW	R18,R4
    02225 1B04      SUB	R16,R20
    02226 0B15      SBC	R17,R21
    02227 0B26      SBC	R18,R22
    02228 0B37      SBC	R19,R23
    02229 802E      LDD	R2,Y+6
    0222A 803F      LDD	R3,Y+7
    0222B 8448      LDD	R4,Y+8
    0222C 8459      LDD	R5,Y+9
    0222D 925A      ST	-Y,R5
    0222E 924A      ST	-Y,R4
    0222F 923A      ST	-Y,R3
    02230 922A      ST	-Y,R2
    02231 940E 47B9 CALL	div32u
    02233 0118      MOVW	R2,R16
    02234 0129      MOVW	R4,R18
    02235 E041      LDI	R20,1
    02236 E050      LDI	R21,0
    02237 E060      LDI	R22,0
    02238 E070      LDI	R23,0
    02239 A50A      LDD	R16,Y+42
    0223A A51B      LDD	R17,Y+43
    0223B A52C      LDD	R18,Y+44
    0223C A53D      LDD	R19,Y+45
    0223D 1B04      SUB	R16,R20
    0223E 0B15      SBC	R17,R21
    0223F 0B26      SBC	R18,R22
    02240 0B37      SBC	R19,R23
    02241 806E      LDD	R6,Y+6
    02242 807F      LDD	R7,Y+7
    02243 8488      LDD	R8,Y+8
    02244 8499      LDD	R9,Y+9
    02245 929A      ST	-Y,R9
    02246 928A      ST	-Y,R8
    02247 927A      ST	-Y,R7
    02248 926A      ST	-Y,R6
    02249 940E 47B9 CALL	div32u
    0224B 1502      CP	R16,R2
    0224C 0513      CPC	R17,R3
    0224D 0524      CPC	R18,R4
    0224E 0535      CPC	R19,R5
    0224F F408      BCC	0x2251
    02250 C043      RJMP	0x2294
(2890) 				(ofs - 1) / bcs >= (ifptr - 1) / bcs) {	/* When seek to same or following cluster, */
(2891) 				fp->fptr = (ifptr - 1) & ~(bcs - 1);	/* start from the current cluster */
    02251 E041      LDI	R20,1
    02252 E050      LDI	R21,0
    02253 E060      LDI	R22,0
    02254 E070      LDI	R23,0
    02255 802E      LDD	R2,Y+6
    02256 803F      LDD	R3,Y+7
    02257 8448      LDD	R4,Y+8
    02258 8459      LDD	R5,Y+9
    02259 1A24      SUB	R2,R20
    0225A 0A35      SBC	R3,R21
    0225B 0A46      SBC	R4,R22
    0225C 0A57      SBC	R5,R23
    0225D 9420      COM	R2
    0225E 9430      COM	R3
    0225F 9440      COM	R4
    02260 9450      COM	R5
    02261 E041      LDI	R20,1
    02262 E050      LDI	R21,0
    02263 E060      LDI	R22,0
    02264 E070      LDI	R23,0
    02265 846E      LDD	R6,Y+14
    02266 847F      LDD	R7,Y+15
    02267 8888      LDD	R8,Y+16
    02268 8899      LDD	R9,Y+17
    02269 1A64      SUB	R6,R20
    0226A 0A75      SBC	R7,R21
    0226B 0A86      SBC	R8,R22
    0226C 0A97      SBC	R9,R23
    0226D 2062      AND	R6,R2
    0226E 2073      AND	R7,R3
    0226F 2084      AND	R8,R4
    02270 2095      AND	R9,R5
    02271 A5E8      LDD	R30,Y+40
    02272 A5F9      LDD	R31,Y+41
    02273 8266      STD	Z+6,R6
    02274 8277      STD	Z+7,R7
    02275 8680      STD	Z+8,R8
    02276 8691      STD	Z+9,R9
(2892) 				ofs -= fp->fptr;
    02277 9636      ADIW	R30,6
    02278 8020      LD	R2,Z
    02279 8031      LDD	R3,Z+1
    0227A 8042      LDD	R4,Z+2
    0227B 8053      LDD	R5,Z+3
    0227C A46A      LDD	R6,Y+42
    0227D A47B      LDD	R7,Y+43
    0227E A48C      LDD	R8,Y+44
    0227F A49D      LDD	R9,Y+45
    02280 1862      SUB	R6,R2
    02281 0873      SBC	R7,R3
    02282 0884      SBC	R8,R4
    02283 0895      SBC	R9,R5
    02284 A66A      STD	Y+42,R6
    02285 A67B      STD	Y+43,R7
    02286 A68C      STD	Y+44,R8
    02287 A69D      STD	Y+45,R9
(2893) 				clst = fp->clust;
    02288 A5E8      LDD	R30,Y+40
    02289 A5F9      LDD	R31,Y+41
    0228A 9672      ADIW	R30,0x12
    0228B 8020      LD	R2,Z
    0228C 8031      LDD	R3,Z+1
    0228D 8042      LDD	R4,Z+2
    0228E 8053      LDD	R5,Z+3
    0228F 822A      STD	Y+2,R2
    02290 823B      STD	Y+3,R3
    02291 824C      STD	Y+4,R4
    02292 825D      STD	Y+5,R5
(2894) 			} else {									/* When seek to back cluster, */
    02293 C069      RJMP	0x22FD
(2895) 				clst = fp->sclust;						/* start from the first cluster */
    02294 A5E8      LDD	R30,Y+40
    02295 A5F9      LDD	R31,Y+41
    02296 963E      ADIW	R30,0xE
    02297 8020      LD	R2,Z
    02298 8031      LDD	R3,Z+1
    02299 8042      LDD	R4,Z+2
    0229A 8053      LDD	R5,Z+3
    0229B 822A      STD	Y+2,R2
    0229C 823B      STD	Y+3,R3
    0229D 824C      STD	Y+4,R4
    0229E 825D      STD	Y+5,R5
(2896) #if !_FS_READONLY
(2897) 				if (clst == 0) {						/* If no cluster chain, create a new chain */
    0229F 802A      LDD	R2,Y+2
    022A0 803B      LDD	R3,Y+3
    022A1 804C      LDD	R4,Y+4
    022A2 805D      LDD	R5,Y+5
    022A3 9488      BCLR	0
    022A4 2022      TST	R2
    022A5 0432      CPC	R3,R2
    022A6 0442      CPC	R4,R2
    022A7 0452      CPC	R5,R2
    022A8 F009      BEQ	0x22AA
    022A9 C049      RJMP	0x22F3
(2898) 					clst = create_chain(fp->fs, 0);
    022AA E040      LDI	R20,0
    022AB E050      LDI	R21,0
    022AC E060      LDI	R22,0
    022AD E070      LDI	R23,0
    022AE 8368      ST	Y,R22
    022AF 8379      STD	Y+1,R23
    022B0 019A      MOVW	R18,R20
    022B1 A5E8      LDD	R30,Y+40
    022B2 A5F9      LDD	R31,Y+41
    022B3 8100      LD	R16,Z
    022B4 8111      LDD	R17,Z+1
    022B5 940E 09FA CALL	ff.c:create_chain
    022B7 830A      STD	Y+2,R16
    022B8 831B      STD	Y+3,R17
    022B9 832C      STD	Y+4,R18
    022BA 833D      STD	Y+5,R19
(2899) 					if (clst == 1) ABORT(fp->fs, FR_INT_ERR);
    022BB E041      LDI	R20,1
    022BC E050      LDI	R21,0
    022BD E060      LDI	R22,0
    022BE E070      LDI	R23,0
    022BF 802A      LDD	R2,Y+2
    022C0 803B      LDD	R3,Y+3
    022C1 804C      LDD	R4,Y+4
    022C2 805D      LDD	R5,Y+5
    022C3 1624      CP	R2,R20
    022C4 0635      CPC	R3,R21
    022C5 0646      CPC	R4,R22
    022C6 0657      CPC	R5,R23
    022C7 F451      BNE	0x22D2
    022C8 A588      LDD	R24,Y+40
    022C9 A599      LDD	R25,Y+41
    022CA 9604      ADIW	R24,4
    022CB 017C      MOVW	R14,R24
    022CC 01FC      MOVW	R30,R24
    022CD 8180      LD	R24,Z
    022CE 6880      ORI	R24,0x80
    022CF 8380      ST	Z,R24
    022D0 E002      LDI	R16,2
    022D1 C196      RJMP	0x2468
(2900) 					if (clst == 0xFFFFFFFF) ABORT(fp->fs, FR_DISK_ERR);
    022D2 EF4F      LDI	R20,0xFF
    022D3 EF5F      LDI	R21,0xFF
    022D4 EF6F      LDI	R22,0xFF
    022D5 EF7F      LDI	R23,0xFF
    022D6 802A      LDD	R2,Y+2
    022D7 803B      LDD	R3,Y+3
    022D8 804C      LDD	R4,Y+4
    022D9 805D      LDD	R5,Y+5
    022DA 1624      CP	R2,R20
    022DB 0635      CPC	R3,R21
    022DC 0646      CPC	R4,R22
    022DD 0657      CPC	R5,R23
    022DE F451      BNE	0x22E9
    022DF A588      LDD	R24,Y+40
    022E0 A599      LDD	R25,Y+41
    022E1 9604      ADIW	R24,4
    022E2 017C      MOVW	R14,R24
    022E3 01FC      MOVW	R30,R24
    022E4 8180      LD	R24,Z
    022E5 6880      ORI	R24,0x80
    022E6 8380      ST	Z,R24
    022E7 E001      LDI	R16,1
    022E8 C17F      RJMP	0x2468
(2901) 					fp->sclust = clst;
    022E9 802A      LDD	R2,Y+2
    022EA 803B      LDD	R3,Y+3
    022EB 804C      LDD	R4,Y+4
    022EC 805D      LDD	R5,Y+5
    022ED A5E8      LDD	R30,Y+40
    022EE A5F9      LDD	R31,Y+41
    022EF 8626      STD	Z+14,R2
    022F0 8637      STD	Z+15,R3
    022F1 8A40      STD	Z+16,R4
    022F2 8A51      STD	Z+17,R5
(2902) 				}
(2903) #endif
(2904) 				fp->clust = clst;
    022F3 802A      LDD	R2,Y+2
    022F4 803B      LDD	R3,Y+3
    022F5 804C      LDD	R4,Y+4
    022F6 805D      LDD	R5,Y+5
    022F7 A5E8      LDD	R30,Y+40
    022F8 A5F9      LDD	R31,Y+41
    022F9 8A22      STD	Z+18,R2
    022FA 8A33      STD	Z+19,R3
    022FB 8A44      STD	Z+20,R4
    022FC 8A55      STD	Z+21,R5
(2905) 			}
(2906) 			if (clst != 0) {
    022FD 802A      LDD	R2,Y+2
    022FE 803B      LDD	R3,Y+3
    022FF 804C      LDD	R4,Y+4
    02300 805D      LDD	R5,Y+5
    02301 9488      BCLR	0
    02302 2022      TST	R2
    02303 0432      CPC	R3,R2
    02304 0442      CPC	R4,R2
    02305 0452      CPC	R5,R2
    02306 F409      BNE	0x2308
    02307 C114      RJMP	0x241C
    02308 C0A7      RJMP	0x23B0
(2907) 				while (ofs > bcs) {						/* Cluster following loop */
(2908) #if !_FS_READONLY
(2909) 					if (fp->flag & FA_WRITE) {			/* Check if in write mode or not */
    02309 A5E8      LDD	R30,Y+40
    0230A A5F9      LDD	R31,Y+41
    0230B 9634      ADIW	R30,4
    0230C 8020      LD	R2,Z
    0230D FE21      SBRS	R2,1
    0230E C024      RJMP	0x2333
(2910) 						clst = create_chain(fp->fs, clst);	/* Force stretch if in write mode */
    0230F 802A      LDD	R2,Y+2
    02310 803B      LDD	R3,Y+3
    02311 804C      LDD	R4,Y+4
    02312 805D      LDD	R5,Y+5
    02313 8248      ST	Y,R4
    02314 8259      STD	Y+1,R5
    02315 0191      MOVW	R18,R2
    02316 A5E8      LDD	R30,Y+40
    02317 A5F9      LDD	R31,Y+41
    02318 8100      LD	R16,Z
    02319 8111      LDD	R17,Z+1
    0231A 940E 09FA CALL	ff.c:create_chain
    0231C 830A      STD	Y+2,R16
    0231D 831B      STD	Y+3,R17
    0231E 832C      STD	Y+4,R18
    0231F 833D      STD	Y+5,R19
(2911) 						if (clst == 0) {				/* When disk gets full, clip file size */
    02320 802A      LDD	R2,Y+2
    02321 803B      LDD	R3,Y+3
    02322 804C      LDD	R4,Y+4
    02323 805D      LDD	R5,Y+5
    02324 9488      BCLR	0
    02325 2022      TST	R2
    02326 0432      CPC	R3,R2
    02327 0442      CPC	R4,R2
    02328 0452      CPC	R5,R2
    02329 F4D1      BNE	0x2344
(2912) 							ofs = bcs; break;
    0232A 802E      LDD	R2,Y+6
    0232B 803F      LDD	R3,Y+7
    0232C 8448      LDD	R4,Y+8
    0232D 8459      LDD	R5,Y+9
    0232E A62A      STD	Y+42,R2
    0232F A63B      STD	Y+43,R3
    02330 A64C      STD	Y+44,R4
    02331 A65D      STD	Y+45,R5
    02332 C08B      RJMP	0x23BE
(2913) 						}
(2914) 					} else
(2915) #endif
(2916) 						clst = get_fat(fp->fs, clst);	/* Follow cluster chain if not in write mode */
    02333 802A      LDD	R2,Y+2
    02334 803B      LDD	R3,Y+3
    02335 804C      LDD	R4,Y+4
    02336 805D      LDD	R5,Y+5
    02337 8248      ST	Y,R4
    02338 8259      STD	Y+1,R5
    02339 0191      MOVW	R18,R2
    0233A A5E8      LDD	R30,Y+40
    0233B A5F9      LDD	R31,Y+41
    0233C 8100      LD	R16,Z
    0233D 8111      LDD	R17,Z+1
    0233E 940E 0638 CALL	_get_fat
    02340 830A      STD	Y+2,R16
    02341 831B      STD	Y+3,R17
    02342 832C      STD	Y+4,R18
    02343 833D      STD	Y+5,R19
(2917) 					if (clst == 0xFFFFFFFF) ABORT(fp->fs, FR_DISK_ERR);
    02344 EF4F      LDI	R20,0xFF
    02345 EF5F      LDI	R21,0xFF
    02346 EF6F      LDI	R22,0xFF
    02347 EF7F      LDI	R23,0xFF
    02348 802A      LDD	R2,Y+2
    02349 803B      LDD	R3,Y+3
    0234A 804C      LDD	R4,Y+4
    0234B 805D      LDD	R5,Y+5
    0234C 1624      CP	R2,R20
    0234D 0635      CPC	R3,R21
    0234E 0646      CPC	R4,R22
    0234F 0657      CPC	R5,R23
    02350 F451      BNE	0x235B
    02351 A588      LDD	R24,Y+40
    02352 A599      LDD	R25,Y+41
    02353 9604      ADIW	R24,4
    02354 017C      MOVW	R14,R24
    02355 01FC      MOVW	R30,R24
    02356 8180      LD	R24,Z
    02357 6880      ORI	R24,0x80
    02358 8380      ST	Z,R24
    02359 E001      LDI	R16,1
    0235A C10D      RJMP	0x2468
(2918) 					if (clst <= 1 || clst >= fp->fs->n_fatent) ABORT(fp->fs, FR_INT_ERR);
    0235B E041      LDI	R20,1
    0235C E050      LDI	R21,0
    0235D E060      LDI	R22,0
    0235E E070      LDI	R23,0
    0235F 802A      LDD	R2,Y+2
    02360 803B      LDD	R3,Y+3
    02361 804C      LDD	R4,Y+4
    02362 805D      LDD	R5,Y+5
    02363 1542      CP	R20,R2
    02364 0553      CPC	R21,R3
    02365 0564      CPC	R22,R4
    02366 0575      CPC	R23,R5
    02367 F490      BCC	0x237A
    02368 A5E8      LDD	R30,Y+40
    02369 A5F9      LDD	R31,Y+41
    0236A 81A0      LD	R26,Z
    0236B 81B1      LDD	R27,Z+1
    0236C 9656      ADIW	R26,0x16
    0236D 902D      LD	R2,X+
    0236E 903D      LD	R3,X+
    0236F 904D      LD	R4,X+
    02370 905C      LD	R5,X
    02371 806A      LDD	R6,Y+2
    02372 807B      LDD	R7,Y+3
    02373 808C      LDD	R8,Y+4
    02374 809D      LDD	R9,Y+5
    02375 1462      CP	R6,R2
    02376 0473      CPC	R7,R3
    02377 0484      CPC	R8,R4
    02378 0495      CPC	R9,R5
    02379 F050      BCS	0x2384
    0237A A588      LDD	R24,Y+40
    0237B A599      LDD	R25,Y+41
    0237C 9604      ADIW	R24,4
    0237D 017C      MOVW	R14,R24
    0237E 01FC      MOVW	R30,R24
    0237F 8180      LD	R24,Z
    02380 6880      ORI	R24,0x80
    02381 8380      ST	Z,R24
    02382 E002      LDI	R16,2
    02383 C0E4      RJMP	0x2468
(2919) 					fp->clust = clst;
    02384 802A      LDD	R2,Y+2
    02385 803B      LDD	R3,Y+3
    02386 804C      LDD	R4,Y+4
    02387 805D      LDD	R5,Y+5
    02388 A5E8      LDD	R30,Y+40
    02389 A5F9      LDD	R31,Y+41
    0238A 9672      ADIW	R30,0x12
    0238B 8220      ST	Z,R2
    0238C 8231      STD	Z+1,R3
    0238D 8242      STD	Z+2,R4
    0238E 8253      STD	Z+3,R5
(2920) 					fp->fptr += bcs;
    0238F A588      LDD	R24,Y+40
    02390 A599      LDD	R25,Y+41
    02391 9606      ADIW	R24,6
    02392 017C      MOVW	R14,R24
    02393 802E      LDD	R2,Y+6
    02394 803F      LDD	R3,Y+7
    02395 8448      LDD	R4,Y+8
    02396 8459      LDD	R5,Y+9
    02397 01FC      MOVW	R30,R24
    02398 8060      LD	R6,Z
    02399 8071      LDD	R7,Z+1
    0239A 8082      LDD	R8,Z+2
    0239B 8093      LDD	R9,Z+3
    0239C 0C62      ADD	R6,R2
    0239D 1C73      ADC	R7,R3
    0239E 1C84      ADC	R8,R4
    0239F 1C95      ADC	R9,R5
    023A0 8260      ST	Z,R6
    023A1 8271      STD	Z+1,R7
    023A2 8282      STD	Z+2,R8
    023A3 8293      STD	Z+3,R9
(2921) 					ofs -= bcs;
    023A4 A46A      LDD	R6,Y+42
    023A5 A47B      LDD	R7,Y+43
    023A6 A48C      LDD	R8,Y+44
    023A7 A49D      LDD	R9,Y+45
    023A8 1862      SUB	R6,R2
    023A9 0873      SBC	R7,R3
    023AA 0884      SBC	R8,R4
    023AB 0895      SBC	R9,R5
    023AC A66A      STD	Y+42,R6
    023AD A67B      STD	Y+43,R7
    023AE A68C      STD	Y+44,R8
    023AF A69D      STD	Y+45,R9
    023B0 802E      LDD	R2,Y+6
    023B1 803F      LDD	R3,Y+7
    023B2 8448      LDD	R4,Y+8
    023B3 8459      LDD	R5,Y+9
    023B4 A46A      LDD	R6,Y+42
    023B5 A47B      LDD	R7,Y+43
    023B6 A48C      LDD	R8,Y+44
    023B7 A49D      LDD	R9,Y+45
    023B8 1426      CP	R2,R6
    023B9 0437      CPC	R3,R7
    023BA 0448      CPC	R4,R8
    023BB 0459      CPC	R5,R9
    023BC F408      BCC	0x23BE
    023BD CF4B      RJMP	0x2309
(2922) 				}
(2923) 				fp->fptr += ofs;
    023BE A588      LDD	R24,Y+40
    023BF A599      LDD	R25,Y+41
    023C0 9606      ADIW	R24,6
    023C1 017C      MOVW	R14,R24
    023C2 A42A      LDD	R2,Y+42
    023C3 A43B      LDD	R3,Y+43
    023C4 A44C      LDD	R4,Y+44
    023C5 A45D      LDD	R5,Y+45
    023C6 01FC      MOVW	R30,R24
    023C7 8060      LD	R6,Z
    023C8 8071      LDD	R7,Z+1
    023C9 8082      LDD	R8,Z+2
    023CA 8093      LDD	R9,Z+3
    023CB 0C62      ADD	R6,R2
    023CC 1C73      ADC	R7,R3
    023CD 1C84      ADC	R8,R4
    023CE 1C95      ADC	R9,R5
    023CF 8260      ST	Z,R6
    023D0 8271      STD	Z+1,R7
    023D1 8282      STD	Z+2,R8
    023D2 8293      STD	Z+3,R9
(2924) 				if (ofs % SS(fp->fs)) {
    023D3 EF4F      LDI	R20,0xFF
    023D4 E051      LDI	R21,1
    023D5 E060      LDI	R22,0
    023D6 E070      LDI	R23,0
    023D7 2224      AND	R2,R20
    023D8 2235      AND	R3,R21
    023D9 2246      AND	R4,R22
    023DA 2257      AND	R5,R23
    023DB 9488      BCLR	0
    023DC 2022      TST	R2
    023DD 0432      CPC	R3,R2
    023DE 0442      CPC	R4,R2
    023DF 0452      CPC	R5,R2
    023E0 F409      BNE	0x23E2
    023E1 C03A      RJMP	0x241C
(2925) 					nsect = clust2sect(fp->fs, clst);	/* Current sector */
    023E2 802A      LDD	R2,Y+2
    023E3 803B      LDD	R3,Y+3
    023E4 804C      LDD	R4,Y+4
    023E5 805D      LDD	R5,Y+5
    023E6 8248      ST	Y,R4
    023E7 8259      STD	Y+1,R5
    023E8 0191      MOVW	R18,R2
    023E9 A5E8      LDD	R30,Y+40
    023EA A5F9      LDD	R31,Y+41
    023EB 8100      LD	R16,Z
    023EC 8111      LDD	R17,Z+1
    023ED 940E 05E6 CALL	_clust2sect
    023EF 870A      STD	Y+10,R16
    023F0 871B      STD	Y+11,R17
    023F1 872C      STD	Y+12,R18
    023F2 873D      STD	Y+13,R19
(2926) 					if (!nsect) ABORT(fp->fs, FR_INT_ERR);
    023F3 842A      LDD	R2,Y+10
    023F4 843B      LDD	R3,Y+11
    023F5 844C      LDD	R4,Y+12
    023F6 845D      LDD	R5,Y+13
    023F7 9488      BCLR	0
    023F8 2022      TST	R2
    023F9 0432      CPC	R3,R2
    023FA 0442      CPC	R4,R2
    023FB 0452      CPC	R5,R2
    023FC F451      BNE	0x2407
    023FD A588      LDD	R24,Y+40
    023FE A599      LDD	R25,Y+41
    023FF 9604      ADIW	R24,4
    02400 017C      MOVW	R14,R24
    02401 01FC      MOVW	R30,R24
    02402 8180      LD	R24,Z
    02403 6880      ORI	R24,0x80
    02404 8380      ST	Z,R24
    02405 E002      LDI	R16,2
    02406 C061      RJMP	0x2468
(2927) 					nsect += ofs / SS(fp->fs);
    02407 E089      LDI	R24,0x9
    02408 E090      LDI	R25,0
    02409 A50A      LDD	R16,Y+42
    0240A A51B      LDD	R17,Y+43
    0240B A52C      LDD	R18,Y+44
    0240C A53D      LDD	R19,Y+45
    0240D 938A      ST	-Y,R24
    0240E 940E 4957 CALL	lsr32
    02410 842A      LDD	R2,Y+10
    02411 843B      LDD	R3,Y+11
    02412 844C      LDD	R4,Y+12
    02413 845D      LDD	R5,Y+13
    02414 0E20      ADD	R2,R16
    02415 1E31      ADC	R3,R17
    02416 1E42      ADC	R4,R18
    02417 1E53      ADC	R5,R19
    02418 862A      STD	Y+10,R2
    02419 863B      STD	Y+11,R3
    0241A 864C      STD	Y+12,R4
    0241B 865D      STD	Y+13,R5
(2928) 				}
(2929) 			}
(2930) 		}
(2931) 		if (fp->fptr % SS(fp->fs) && nsect != fp->dsect) {	/* Fill sector cache if needed */
    0241C EF4F      LDI	R20,0xFF
    0241D E051      LDI	R21,1
    0241E E060      LDI	R22,0
    0241F E070      LDI	R23,0
    02420 A5E8      LDD	R30,Y+40
    02421 A5F9      LDD	R31,Y+41
    02422 9636      ADIW	R30,6
    02423 8020      LD	R2,Z
    02424 8031      LDD	R3,Z+1
    02425 8042      LDD	R4,Z+2
    02426 8053      LDD	R5,Z+3
    02427 2224      AND	R2,R20
    02428 2235      AND	R3,R21
    02429 2246      AND	R4,R22
    0242A 2257      AND	R5,R23
    0242B 9488      BCLR	0
    0242C 2022      TST	R2
    0242D 0432      CPC	R3,R2
    0242E 0442      CPC	R4,R2
    0242F 0452      CPC	R5,R2
    02430 F0C1      BEQ	0x2449
    02431 A5E8      LDD	R30,Y+40
    02432 A5F9      LDD	R31,Y+41
    02433 9676      ADIW	R30,0x16
    02434 8020      LD	R2,Z
    02435 8031      LDD	R3,Z+1
    02436 8042      LDD	R4,Z+2
    02437 8053      LDD	R5,Z+3
    02438 846A      LDD	R6,Y+10
    02439 847B      LDD	R7,Y+11
    0243A 848C      LDD	R8,Y+12
    0243B 849D      LDD	R9,Y+13
    0243C 1462      CP	R6,R2
    0243D 0473      CPC	R7,R3
    0243E 0484      CPC	R8,R4
    0243F 0495      CPC	R9,R5
    02440 F041      BEQ	0x2449
(2932) #if !_FS_TINY
(2933) #if !_FS_READONLY
(2934) 			if (fp->flag & FA__DIRTY) {			/* Write-back dirty sector cache */
(2935) 				if (disk_write(fp->fs->drv, fp->buf, fp->dsect, 1) != RES_OK)
(2936) 					ABORT(fp->fs, FR_DISK_ERR);
(2937) 				fp->flag &= ~FA__DIRTY;
(2938) 			}
(2939) #endif
(2940) 			if (disk_read(fp->fs->drv, fp->buf, nsect, 1) != RES_OK)	/* Fill sector cache */
(2941) 				ABORT(fp->fs, FR_DISK_ERR);
(2942) #endif
(2943) 			fp->dsect = nsect;
    02441 0113      MOVW	R2,R6
    02442 0124      MOVW	R4,R8
    02443 A5E8      LDD	R30,Y+40
    02444 A5F9      LDD	R31,Y+41
    02445 8A26      STD	Z+22,R2
    02446 8A37      STD	Z+23,R3
    02447 8E40      STD	Z+24,R4
    02448 8E51      STD	Z+25,R5
(2944) 		}
(2945) #if !_FS_READONLY
(2946) 		if (fp->fptr > fp->fsize) {			/* Set file change flag if the file size is extended */
    02449 A5E8      LDD	R30,Y+40
    0244A A5F9      LDD	R31,Y+41
    0244B 8422      LDD	R2,Z+10
    0244C 8433      LDD	R3,Z+11
    0244D 8444      LDD	R4,Z+12
    0244E 8455      LDD	R5,Z+13
    0244F 8066      LDD	R6,Z+6
    02450 8077      LDD	R7,Z+7
    02451 8480      LDD	R8,Z+8
    02452 8491      LDD	R9,Z+9
    02453 1426      CP	R2,R6
    02454 0437      CPC	R3,R7
    02455 0448      CPC	R4,R8
    02456 0459      CPC	R5,R9
    02457 F478      BCC	0x2467
(2947) 			fp->fsize = fp->fptr;
    02458 8026      LDD	R2,Z+6
    02459 8037      LDD	R3,Z+7
    0245A 8440      LDD	R4,Z+8
    0245B 8451      LDD	R5,Z+9
    0245C 8622      STD	Z+10,R2
    0245D 8633      STD	Z+11,R3
    0245E 8644      STD	Z+12,R4
    0245F 8655      STD	Z+13,R5
(2948) 			fp->flag |= FA__WRITTEN;
    02460 01CF      MOVW	R24,R30
    02461 9604      ADIW	R24,4
    02462 016C      MOVW	R12,R24
    02463 01FC      MOVW	R30,R24
    02464 8180      LD	R24,Z
    02465 6280      ORI	R24,0x20
    02466 8380      ST	Z,R24
(2949) 		}
(2950) #endif
(2951) 	}
(2952) 
(2953) 	LEAVE_FF(fp->fs, res);
    02467 2D0A      MOV	R16,R10
    02468 966E      ADIW	R28,0x1E
    02469 940E 48A8 CALL	pop_xgsetF0FC
    0246B 9624      ADIW	R28,4
    0246C 9508      RET
_f_opendir:
  sfn                  --> Y,+1
  res                  --> R20
  path                 --> Y,+19
  dj                   --> R22
    0246D 933A      ST	-Y,R19
    0246E 932A      ST	-Y,R18
    0246F 940E 48D2 CALL	push_xgsetF00C
    02471 01B8      MOVW	R22,R16
    02472 972D      SBIW	R28,0xD
(2954) }
(2955) 
(2956) 
(2957) 
(2958) #if _FS_MINIMIZE <= 1
(2959) /*-----------------------------------------------------------------------*/
(2960) /* Create a Directroy Object                                             */
(2961) /*-----------------------------------------------------------------------*/
(2962) 
(2963) FRESULT f_opendir (
(2964) 	DIR *dj,			/* Pointer to directory object to create */
(2965) 	const TCHAR *path	/* Pointer to the directory path */
(2966) )
(2967) {
(2968) 	FRESULT res;
(2969) 	DEF_NAMEBUF;
(2970) 
(2971) 
(2972) 	res = chk_mounted(&path, &dj->fs, 0);
    02473 2422      CLR	R2
    02474 8228      ST	Y,R2
    02475 019B      MOVW	R18,R22
    02476 018E      MOVW	R16,R28
    02477 5E0D      SUBI	R16,0xED
    02478 4F1F      SBCI	R17,0xFF
    02479 940E 128D CALL	ff.c:chk_mounted
    0247B 2F40      MOV	R20,R16
(2973) 	if (res == FR_OK) {
    0247C 2300      TST	R16
    0247D F009      BEQ	0x247F
    0247E C05C      RJMP	0x24DB
(2974) 		INIT_BUF(*dj);
    0247F 01CE      MOVW	R24,R28
    02480 9601      ADIW	R24,1
    02481 01FB      MOVW	R30,R22
    02482 8B95      STD	Z+21,R25
    02483 8B84      STD	Z+20,R24
(2975) 		res = follow_path(dj, path);			/* Follow the path to the directory */
    02484 892B      LDD	R18,Y+19
    02485 893C      LDD	R19,Y+20
    02486 018F      MOVW	R16,R30
    02487 940E 1141 CALL	ff.c:follow_path
    02489 2F40      MOV	R20,R16
(2976) 		FREE_BUF();
(2977) 		if (res == FR_OK) {						/* Follow completed */
    0248A 2300      TST	R16
    0248B F009      BEQ	0x248D
    0248C C04B      RJMP	0x24D8
(2978) 			if (dj->dir) {						/* It is not the root dir */
    0248D 01FB      MOVW	R30,R22
    0248E 8822      LDD	R2,Z+18
    0248F 8833      LDD	R3,Z+19
    02490 2022      TST	R2
    02491 F419      BNE	0x2495
    02492 2033      TST	R3
    02493 F409      BNE	0x2495
    02494 C032      RJMP	0x24C7
(2979) 				if (dj->dir[DIR_Attr] & AM_DIR) {	/* The object is a directory */
    02495 93AF      PUSH	R26
    02496 93BF      PUSH	R27
    02497 89A2      LDD	R26,Z+18
    02498 89B3      LDD	R27,Z+19
    02499 01FD      MOVW	R30,R26
    0249A 91BF      POP	R27
    0249B 91AF      POP	R26
    0249C 8423      LDD	R2,Z+11
    0249D FE24      SBRS	R2,4
    0249E C027      RJMP	0x24C6
(2980) 					dj->sclust = LD_CLUST(dj->dir);
    0249F 01FB      MOVW	R30,R22
    024A0 88A2      LDD	R10,Z+18
    024A1 88B3      LDD	R11,Z+19
    024A2 01F5      MOVW	R30,R10
    024A3 8C22      LDD	R2,Z+26
    024A4 2433      CLR	R3
    024A5 8C43      LDD	R4,Z+27
    024A6 2455      CLR	R5
    024A7 2C54      MOV	R5,R4
    024A8 2444      CLR	R4
    024A9 2842      OR	R4,R2
    024AA 2853      OR	R5,R3
    024AB 0112      MOVW	R2,R4
    024AC 2444      CLR	R4
    024AD 2455      CLR	R5
    024AE 8864      LDD	R6,Z+20
    024AF 2477      CLR	R7
    024B0 8885      LDD	R8,Z+21
    024B1 2499      CLR	R9
    024B2 2C98      MOV	R9,R8
    024B3 2488      CLR	R8
    024B4 2886      OR	R8,R6
    024B5 2897      OR	R9,R7
    024B6 0134      MOVW	R6,R8
    024B7 2488      CLR	R8
    024B8 2499      CLR	R9
    024B9 0143      MOVW	R8,R6
    024BA 2466      CLR	R6
    024BB 2477      CLR	R7
    024BC 2862      OR	R6,R2
    024BD 2873      OR	R7,R3
    024BE 2884      OR	R8,R4
    024BF 2895      OR	R9,R5
    024C0 01FB      MOVW	R30,R22
    024C1 8266      STD	Z+6,R6
    024C2 8277      STD	Z+7,R7
    024C3 8680      STD	Z+8,R8
    024C4 8691      STD	Z+9,R9
(2981) 				} else {						/* The object is not a directory */
    024C5 C001      RJMP	0x24C7
(2982) 					res = FR_NO_PATH;
    024C6 E045      LDI	R20,5
(2983) 				}
(2984) 			}
(2985) 			if (res == FR_OK) {
    024C7 2344      TST	R20
    024C8 F479      BNE	0x24D8
(2986) 				dj->id = dj->fs->id;
    024C9 01FB      MOVW	R30,R22
    024CA 81A0      LD	R26,Z
    024CB 81B1      LDD	R27,Z+1
    024CC 9616      ADIW	R26,6
    024CD 902D      LD	R2,X+
    024CE 903C      LD	R3,X
    024CF 8233      STD	Z+3,R3
    024D0 8222      STD	Z+2,R2
(2987) 				res = dir_sdi(dj, 0);			/* Rewind dir */
    024D1 2722      CLR	R18
    024D2 2733      CLR	R19
    024D3 018F      MOVW	R16,R30
    024D4 940E 0BEB CALL	ff.c:dir_sdi
    024D6 2EA0      MOV	R10,R16
    024D7 2D4A      MOV	R20,R10
(2988) 			}
(2989) 		}
(2990) 		if (res == FR_NO_FILE) res = FR_NO_PATH;
    024D8 3044      CPI	R20,4
    024D9 F409      BNE	0x24DB
    024DA E045      LDI	R20,5
(2991) 	}
(2992) 
(2993) 	LEAVE_FF(dj->fs, res);
    024DB 2F04      MOV	R16,R20
    024DC 962D      ADIW	R28,0xD
    024DD 940E 48D9 CALL	pop_xgsetF00C
    024DF 9622      ADIW	R28,2
    024E0 9508      RET
_f_readdir:
  sfn                  --> Y,+0
  res                  --> R20
  fno                  --> R10
  dj                   --> R22
    024E1 940E 48EE CALL	push_xgsetF03C
    024E3 0159      MOVW	R10,R18
    024E4 01B8      MOVW	R22,R16
    024E5 972C      SBIW	R28,0xC
(2994) }
(2995) 
(2996) 
(2997) 
(2998) 
(2999) /*-----------------------------------------------------------------------*/
(3000) /* Read Directory Entry in Sequense                                      */
(3001) /*-----------------------------------------------------------------------*/
(3002) 
(3003) FRESULT f_readdir (
(3004) 	DIR *dj,			/* Pointer to the open directory object */
(3005) 	FILINFO *fno		/* Pointer to file information to return */
(3006) )
(3007) {
(3008) 	FRESULT res;
(3009) 	DEF_NAMEBUF;
(3010) 
(3011) 
(3012) 	res = validate(dj->fs, dj->id);			/* Check validity of the object */
    024E6 01FB      MOVW	R30,R22
    024E7 8122      LDD	R18,Z+2
    024E8 8133      LDD	R19,Z+3
    024E9 8100      LD	R16,Z
    024EA 8111      LDD	R17,Z+1
    024EB 940E 1787 CALL	ff.c:validate
    024ED 2F40      MOV	R20,R16
(3013) 	if (res == FR_OK) {
    024EE 2300      TST	R16
    024EF F009      BEQ	0x24F1
    024F0 C035      RJMP	0x2526
(3014) 		if (!fno) {
    024F1 20AA      TST	R10
    024F2 F449      BNE	0x24FC
    024F3 20BB      TST	R11
    024F4 F439      BNE	0x24FC
(3015) 			res = dir_sdi(dj, 0);			/* Rewind the directory object */
    024F5 2722      CLR	R18
    024F6 2733      CLR	R19
    024F7 018B      MOVW	R16,R22
    024F8 940E 0BEB CALL	ff.c:dir_sdi
    024FA 2F40      MOV	R20,R16
(3016) 		} else {
    024FB C02A      RJMP	0x2526
(3017) 			INIT_BUF(*dj);
    024FC 01CE      MOVW	R24,R28
    024FD 01FB      MOVW	R30,R22
    024FE 8B95      STD	Z+21,R25
    024FF 8B84      STD	Z+20,R24
(3018) 			res = dir_read(dj);				/* Read an directory item */
    02500 018F      MOVW	R16,R30
    02501 940E 0EE8 CALL	ff.c:dir_read
    02503 2EC0      MOV	R12,R16
    02504 2D4C      MOV	R20,R12
(3019) 			if (res == FR_NO_FILE) {		/* Reached end of dir */
    02505 3004      CPI	R16,4
    02506 F441      BNE	0x250F
(3020) 				dj->sect = 0;
    02507 01FB      MOVW	R30,R22
    02508 963E      ADIW	R30,0xE
    02509 E080      LDI	R24,0
    0250A 8380      ST	Z,R24
    0250B 8381      STD	Z+1,R24
    0250C 8382      STD	Z+2,R24
    0250D 8383      STD	Z+3,R24
(3021) 				res = FR_OK;
    0250E 2744      CLR	R20
(3022) 			}
(3023) 			if (res == FR_OK) {				/* A valid entry is found */
    0250F 2344      TST	R20
    02510 F4A9      BNE	0x2526
(3024) 				get_fileinfo(dj, fno);		/* Get the object information */
    02511 0195      MOVW	R18,R10
    02512 018B      MOVW	R16,R22
    02513 940E 109E CALL	ff.c:get_fileinfo
(3025) 				res = dir_next(dj, 0);		/* Increment index for next */
    02515 2722      CLR	R18
    02516 2733      CLR	R19
    02517 018B      MOVW	R16,R22
    02518 940E 0CF5 CALL	ff.c:dir_next
    0251A 2EA0      MOV	R10,R16
    0251B 2D4A      MOV	R20,R10
(3026) 				if (res == FR_NO_FILE) {
    0251C 3004      CPI	R16,4
    0251D F441      BNE	0x2526
(3027) 					dj->sect = 0;
    0251E 01FB      MOVW	R30,R22
    0251F 963E      ADIW	R30,0xE
    02520 E080      LDI	R24,0
    02521 8380      ST	Z,R24
    02522 8381      STD	Z+1,R24
    02523 8382      STD	Z+2,R24
    02524 8383      STD	Z+3,R24
(3028) 					res = FR_OK;
    02525 2744      CLR	R20
(3029) 				}
(3030) 			}
(3031) 			FREE_BUF();
(3032) 		}
(3033) 	}
(3034) 
(3035) 	LEAVE_FF(dj->fs, res);
    02526 2F04      MOV	R16,R20
    02527 962C      ADIW	R28,0xC
    02528 940C 48F7 JMP	pop_xgsetF03C
FILE: D:\LQD\software\software_src\delay.c
(0001) /*******************************
(0002)  function ：延时函数
(0003) Clock F  :7.3728M 
(0004) Software : ICCAVR7.14C
(0005) ********************************/
(0006) /*---------------------------------------------------------------------------------
(0007)      延时程序计算方法
(0008)      计数个数j = 延时时间/6*晶振频率 - 1
(0009) ---------------------------------------------------------------------------------*/
(0010) void delayus(unsigned int tttt)   // 1.2us 延时子函数   
(0011) { 
(0012)    do
(0013)    {
(0014)        tttt--;
_delayus:
  tttt                 --> R16
    0252A 5001      SUBI	R16,1
    0252B 4010      SBCI	R17,0
(0015)    }
(0016)    while(tttt>1);
    0252C E081      LDI	R24,1
    0252D E090      LDI	R25,0
    0252E 1780      CP	R24,R16
    0252F 0791      CPC	R25,R17
    02530 F3C8      BCS	0x252A
    02531 9508      RET
_delayms:
  j                    --> R20
  i                    --> R16
    02532 934A      ST	-Y,R20
    02533 935A      ST	-Y,R21
(0017) }
(0018) void delayms(unsigned int i)                 //1ms延时
(0019)    {
    02534 C00A      RJMP	0x253F
(0020)     while(i--)
(0021)     {                          
(0022) 	    unsigned int j;                
(0023)         for(j=1;j<=1227;j++)   
    02535 E041      LDI	R20,1
    02536 E050      LDI	R21,0
    02537 C002      RJMP	0x253A
    02538 5F4F      SUBI	R20,0xFF
    02539 4F5F      SBCI	R21,0xFF
    0253A EC8B      LDI	R24,0xCB
    0253B E094      LDI	R25,4
    0253C 1784      CP	R24,R20
    0253D 0795      CPC	R25,R21
    0253E F7C8      BCC	0x2538
    0253F 0118      MOVW	R2,R16
    02540 5001      SUBI	R16,1
    02541 4010      SBCI	R17,0
    02542 2022      TST	R2
    02543 F789      BNE	0x2535
    02544 2033      TST	R3
    02545 F779      BNE	0x2535
    02546 9159      LD	R21,Y+
    02547 9149      LD	R20,Y+
    02548 9508      RET
FILE: D:\LQD\software\software_src\main.c
(0001) #include "config.h"
(0002) #define  N_per_Second  (2.72*60)
(0003) const char tab[]="\t\0";
(0004) const char enter[]="\n\0";
(0005) char buffer[512];
(0006) char TempChar[80]; //存放临时字串
(0007) struct DATA Result;
(0008) struct tm t;
(0009) unsigned long now =0; 
(0010) void debug(UINT8 *str,UINT8 val);
(0011) void WriteSDFile(void);
(0012) struct CONFIG config;
(0013) void initDevices(void){
(0014)      CLI();
_initDevices:
    02549 94F8      BCLR	7
(0015) 	 DDRA=0XFF;
    0254A EF8F      LDI	R24,0xFF
    0254B BB8A      OUT	0x1A,R24
(0016) 	 PORTA=0XFF;
    0254C BB8B      OUT	0x1B,R24
(0017) 	 DDRB=0XFF;
    0254D BB87      OUT	0x17,R24
(0018) 	 PORTB=0XFF; 	 
    0254E BB88      OUT	0x18,R24
(0019) 	 DDRC=0XFF;
    0254F BB84      OUT	0x14,R24
(0020) 	 PORTC=0XFF;
    02550 BB85      OUT	0x15,R24
(0021) 	 DDRG=0XFF;
    02551 9380 0064 STS	0x64,R24
(0022) 	 PORTG=0XFF;	 
    02553 9380 0065 STS	0x65,R24
(0023) 	 SPI_IO_Init(); 
    02555 940E 3C46 CALL	_SPI_IO_Init
(0024) 	 SD_Init();
    02557 940E 2D7B CALL	_SD_Init
(0025) 	 uart1_init();
    02559 940E 3A70 CALL	_uart1_init
(0026) 	 LCD_INT();delayms(50);LCD_INT();
    0255B 940E 3C64 CALL	_LCD_INT
    0255D E302      LDI	R16,0x32
    0255E E010      LDI	R17,0
    0255F 940E 2532 CALL	_delayms
    02561 940E 3C64 CALL	_LCD_INT
(0027) 	 LCD_SW(1);
    02563 E001      LDI	R16,1
    02564 940E 3C5A CALL	_LCD_SW
(0028) 	 config.THRESHOLD_delta_sec=60; //一次检测用时
    02566 E38C      LDI	R24,0x3C
    02567 9380 08A4 STS	config+4,R24
    02569 E080      LDI	R24,0
    0256A 9380 08A5 STS	config+5,R24
    0256C 9380 08A6 STS	config+6,R24
    0256E 9380 08A7 STS	config+7,R24
(0029) 	 config.heatThreshold = 5; //继电器开启温度 
    02570 E085      LDI	R24,5
    02571 9380 08B4 STS	config+20,R24
(0030) 	 config.checkDeltaTime=20;  //自动检测模式 时间间隔	 
    02573 E184      LDI	R24,0x14
    02574 E090      LDI	R25,0
    02575 9390 08B2 STS	config+18,R25
    02577 9380 08B1 STS	config+17,R24
(0031) 	 config.autocheck=1;        //自动检测开关
    02579 E081      LDI	R24,1
    0257A 9380 08B0 STS	config+16,R24
(0032) 	 config.readMode = 0;      //读数据模式
    0257C 2422      CLR	R2
    0257D 9220 08B3 STS	config+19,R2
(0033) 	 #ifdef _FOR_FAST_TEST
(0034) 	 config.THRESHOLD_delta_sec=5; //一次检测用时
(0035) 	 config.heatThreshold = 20; //继电器开启温度 
(0036) 	 config.checkDeltaTime=5;  //自动检测模式 时间间隔	 
(0037) 	 #endif
(0038) 	 SEI();
    0257F 9478      BSET	7
    02580 9508      RET
(0039) }
(0040) void timer1_init(void)
(0041) {
(0042)  TCCR1B = 0x00; //stop
_timer1_init:
    02581 2422      CLR	R2
    02582 BC2E      OUT	0x2E,R2
(0043)  TCNT1H = 0x00 /*INVALID SETTING*/; //setup
    02583 BC2D      OUT	0x2D,R2
(0044)  TCNT1L = 0x00 /*INVALID SETTING*/;
    02584 BC2C      OUT	0x2C,R2
(0045)  TCCR1A = 0x00;
    02585 BC2F      OUT	0x2F,R2
(0046)  TCCR1B = 0x46; //start Timer
    02586 E486      LDI	R24,0x46
    02587 BD8E      OUT	0x2E,R24
    02588 9508      RET
_main:
  keycode              --> Y,+1
  i                    --> R10
  filename             --> Y,+513
  buf512               --> Y,+0
  tmp                  --> R10
    02589 97EF      SBIW	R28,0x3F
    0258A 97EF      SBIW	R28,0x3F
    0258B 97EF      SBIW	R28,0x3F
    0258C 97EF      SBIW	R28,0x3F
    0258D 97EF      SBIW	R28,0x3F
    0258E 97EF      SBIW	R28,0x3F
    0258F 97EF      SBIW	R28,0x3F
    02590 97EF      SBIW	R28,0x3F
    02591 9767      SBIW	R28,0x17
(0047) }
(0048) ////////////////////////////////////////////////////////////////
(0049) void main(void){
(0050) 	 UINT8 tmp,keycode;
(0051) 	 UINT8 buf512[513];
(0052) 	 char filename[]="201301.xls\0\0\0";
    02592 E189      LDI	R24,0x19
    02593 E091      LDI	R25,1
    02594 01FE      MOVW	R30,R28
    02595 5FEF      SUBI	R30,0xFF
    02596 4FFD      SBCI	R31,0xFD
    02597 E00E      LDI	R16,0xE
    02598 E010      LDI	R17,0
    02599 93FA      ST	-Y,R31
    0259A 93EA      ST	-Y,R30
    0259B 939A      ST	-Y,R25
    0259C 938A      ST	-Y,R24
    0259D 940E 4963 CALL	asgnblk
(0053) 	 int i=0;
    0259F 24AA      CLR	R10
    025A0 24BB      CLR	R11
(0054) 	 initDevices();
    025A1 DFA7      RCALL	_initDevices
(0055) 	 dateRefresh(1);
    025A2 E001      LDI	R16,1
    025A3 940E 3927 CALL	_dateRefresh
(0056) 	 WriteFileHead();
    025A5 D164      RCALL	_WriteFileHead
(0057)      Result.Index=findIndex(get_name(filename),buf512);
    025A6 018E      MOVW	R16,R28
    025A7 5F0F      SUBI	R16,0xFF
    025A8 4F1D      SBCI	R17,0xFD
    025A9 D6B4      RCALL	_get_name
    025AA 019E      MOVW	R18,R28
    025AB D2D9      RCALL	_findIndex
    025AC 0118      MOVW	R2,R16
    025AD 2444      CLR	R4
    025AE 2455      CLR	R5
    025AF 9230 0639 STS	Result+11,R3
    025B1 9220 0638 STS	Result+10,R2
    025B3 9250 063B STS	Result+13,R5
    025B5 9240 063A STS	Result+12,R4
(0058) 	 #ifdef _DBG_RD_  
(0059) 	 	 while(1){
(0060) 		     GUI_readback(buf512);
(0061) 	     }
(0062) 	 #endif
(0063) 	 //selfTest();
(0064) 	 GUI_welcome();
    025B7 940E 390A CALL	_GUI_welcome
    025B9 C026      RJMP	0x25E0
(0065) 	 while(1){
(0066) 	    tmp=GUI_mainmeu();
    025BA 940E 2F54 CALL	_GUI_mainmeu
    025BC 2EA0      MOV	R10,R16
(0067) 		switch(tmp){
    025BD 2D4A      MOV	R20,R10
    025BE 2755      CLR	R21
    025BF 3043      CPI	R20,3
    025C0 E0E0      LDI	R30,0
    025C1 075E      CPC	R21,R30
    025C2 F069      BEQ	0x25D0
    025C3 3044      CPI	R20,4
    025C4 E0E0      LDI	R30,0
    025C5 075E      CPC	R21,R30
    025C6 F061      BEQ	0x25D3
    025C7 3045      CPI	R20,5
    025C8 E0E0      LDI	R30,0
    025C9 075E      CPC	R21,R30
    025CA F059      BEQ	0x25D6
    025CB 3047      CPI	R20,7
    025CC E0E0      LDI	R30,0
    025CD 075E      CPC	R21,R30
    025CE F059      BEQ	0x25DA
    025CF C00B      RJMP	0x25DB
(0068) 		    case 3 : GUI_check(); break; 
    025D0 940E 3045 CALL	_GUI_check
    025D2 C008      RJMP	0x25DB
(0069) 			case 4 : GUI_set_time(); break ;
    025D3 940E 3512 CALL	_GUI_set_time
    025D5 C005      RJMP	0x25DB
(0070) 			case 5 : GUI_readback(buf512); break;
    025D6 018E      MOVW	R16,R28
    025D7 940E 3765 CALL	_GUI_readback
    025D9 C001      RJMP	0x25DB
(0071) 			//case 6 : GUI_send_date();
(0072) 			case 7 : selfTest(); break ;
    025DA D052      RCALL	_selfTest
(0073) 			default : break;
(0074) 	   }
(0075) 	   heaterSwitch();
    025DB D00F      RCALL	_heaterSwitch
(0076) 	   delayms(100);
    025DC E604      LDI	R16,0x64
    025DD E010      LDI	R17,0
    025DE 940E 2532 CALL	_delayms
    025E0 CFD9      RJMP	0x25BA
    025E1 96EF      ADIW	R28,0x3F
    025E2 96EF      ADIW	R28,0x3F
    025E3 96EF      ADIW	R28,0x3F
    025E4 96EF      ADIW	R28,0x3F
    025E5 96EF      ADIW	R28,0x3F
    025E6 96EF      ADIW	R28,0x3F
    025E7 96EF      ADIW	R28,0x3F
    025E8 96EF      ADIW	R28,0x3F
    025E9 9667      ADIW	R28,0x17
    025EA 9508      RET
_heaterSwitch:
  temp                 --> Y,+0
    025EB 940E 48C8 CALL	push_xgsetF000
    025ED 9724      SBIW	R28,4
(0077) 	 }
(0078) }
(0079) void heaterSwitch(void)
(0080) {
(0081)  static unsigned long last=0;
(0082)  float temp;
(0083)  if(config.now>last)
    025EE 9040 0129 LDS	R4,main.c:last+2
    025F0 9050 012A LDS	R5,main.c:last+3
    025F2 9020 0127 LDS	R2,main.c:last
    025F4 9030 0128 LDS	R3,main.c:last+1
    025F6 9080 08AE LDS	R8,config+14
    025F8 9090 08AF LDS	R9,config+15
    025FA 9060 08AC LDS	R6,config+12
    025FC 9070 08AD LDS	R7,config+13
    025FE 1426      CP	R2,R6
    025FF 0437      CPC	R3,R7
    02600 0448      CPC	R4,R8
    02601 0459      CPC	R5,R9
    02602 F538      BCC	0x262A
(0084)  {   
(0085)  	 last=config.now+5;
    02603 E045      LDI	R20,5
    02604 E050      LDI	R21,0
    02605 E060      LDI	R22,0
    02606 E070      LDI	R23,0
    02607 0113      MOVW	R2,R6
    02608 0124      MOVW	R4,R8
    02609 0E24      ADD	R2,R20
    0260A 1E35      ADC	R3,R21
    0260B 1E46      ADC	R4,R22
    0260C 1E57      ADC	R5,R23
    0260D 9230 0128 STS	main.c:last+1,R3
    0260F 9220 0127 STS	main.c:last,R2
    02611 9250 012A STS	main.c:last+3,R5
    02613 9240 0129 STS	main.c:last+2,R4
(0086)      temp= readWithoutDelay(INSIDE_SENSOR);
    02615 2700      CLR	R16
    02616 940E 41E1 CALL	_readWithoutDelay
    02618 8308      ST	Y,R16
    02619 8319      STD	Y+1,R17
    0261A 832A      STD	Y+2,R18
    0261B 833B      STD	Y+3,R19
(0087)      if (temp>config.heatThreshold) {
    0261C 01CE      MOVW	R24,R28
    0261D 9100 08B4 LDS	R16,config+20
    0261F 2711      CLR	R17
    02620 940E 4A5E CALL	int2fp
    02622 939A      ST	-Y,R25
    02623 938A      ST	-Y,R24
    02624 940E 4C28 CALL	fpcmp1
    02626 F414      BGE	0x2629
(0088)  	     RELAY_OFF(); //debug("off=",(int)temp);
    02627 98AD      CBI	0x15,5
(0089) 		// beep(0,1);
(0090) 		// LCD_SW(0);
(0091) 		 return ;
    02628 C001      RJMP	0x262A
(0092)  	  }
(0093)       else  {
(0094)    	     RELAY_ON();//debug("on=",(int)temp);
    02629 9AAD      SBI	0x15,5
(0095) 		// LCD_SW(1);
(0096) 		// beep(0,2);
(0097)  	  } 
(0098) }
    0262A 9624      ADIW	R28,4
    0262B 940C 48CD JMP	pop_xgsetF000
_selfTest:
  str2                 --> Y,+14
  str1                 --> Y,+8
  tmp                  --> Y,+4
    0262D 9764      SBIW	R28,0x14
(0099) }
(0100) void selfTest(void){
(0101) 	float tmp=0;                                                                
    0262E EB0A      LDI	R16,0xBA
    0262F E010      LDI	R17,0
    02630 940E 483B CALL	elpm32
    02632 830C      STD	Y+4,R16
    02633 831D      STD	Y+5,R17
    02634 832E      STD	Y+6,R18
    02635 833F      STD	Y+7,R19
(0102) 	char str1[6],str2[6];
(0103) 	lp("┌──────┐");
    02636 E705      LDI	R16,0x75
    02637 E012      LDI	R17,2
    02638 940E 3F93 CALL	_lp
(0104) 	lp("│  自检程序  │");
    0263A E604      LDI	R16,0x64
    0263B E012      LDI	R17,2
    0263C 940E 3F93 CALL	_lp
(0105) 	lp("│            │");
    0263E E503      LDI	R16,0x53
    0263F E012      LDI	R17,2
    02640 940E 3F93 CALL	_lp
(0106) 	lp("└──────┘");
    02642 E402      LDI	R16,0x42
    02643 E012      LDI	R17,2
    02644 940E 3F93 CALL	_lp
(0107) 	 //自检程序
(0108) 	delayms(500);
    02646 EF04      LDI	R16,0xF4
    02647 E011      LDI	R17,1
    02648 940E 2532 CALL	_delayms
(0109) 	lp("外部温度 ");
    0264A E308      LDI	R16,0x38
    0264B E012      LDI	R17,2
    0264C 940E 3F93 CALL	_lp
(0110) 	tmp=read_T_NUM(OUTSIDE_SENSOR);
    0264E E001      LDI	R16,1
    0264F 940E 41C3 CALL	_read_T_NUM
    02651 830C      STD	Y+4,R16
    02652 831D      STD	Y+5,R17
    02653 832E      STD	Y+6,R18
    02654 833F      STD	Y+7,R19
(0111) 	sprintf(str1,"%#0.1f",tmp);
    02655 802C      LDD	R2,Y+4
    02656 803D      LDD	R3,Y+5
    02657 804E      LDD	R4,Y+6
    02658 805F      LDD	R5,Y+7
    02659 8228      ST	Y,R2
    0265A 8239      STD	Y+1,R3
    0265B 824A      STD	Y+2,R4
    0265C 825B      STD	Y+3,R5
    0265D E321      LDI	R18,0x31
    0265E E032      LDI	R19,2
    0265F 018E      MOVW	R16,R28
    02660 5F08      SUBI	R16,0xF8
    02661 4F1F      SBCI	R17,0xFF
    02662 940E 5030 CALL	_sprintf
(0112) 	str1[6]=0;
    02664 2422      CLR	R2
    02665 862E      STD	Y+14,R2
(0113) 	lp(str1);
    02666 018E      MOVW	R16,R28
    02667 5F08      SUBI	R16,0xF8
    02668 4F1F      SBCI	R17,0xFF
    02669 940E 3F93 CALL	_lp
(0114) 	delayms(500);
    0266B EF04      LDI	R16,0xF4
    0266C E011      LDI	R17,1
    0266D 940E 2532 CALL	_delayms
(0115) 	lp("内部温度");
    0266F E208      LDI	R16,0x28
    02670 E012      LDI	R17,2
    02671 940E 3F93 CALL	_lp
(0116) 	tmp=read_T_NUM(INSIDE_SENSOR);
    02673 2700      CLR	R16
    02674 940E 41C3 CALL	_read_T_NUM
    02676 830C      STD	Y+4,R16
    02677 831D      STD	Y+5,R17
    02678 832E      STD	Y+6,R18
    02679 833F      STD	Y+7,R19
(0117) 	sprintf(str2,"%#0.1f",tmp);
    0267A 802C      LDD	R2,Y+4
    0267B 803D      LDD	R3,Y+5
    0267C 804E      LDD	R4,Y+6
    0267D 805F      LDD	R5,Y+7
    0267E 8228      ST	Y,R2
    0267F 8239      STD	Y+1,R3
    02680 824A      STD	Y+2,R4
    02681 825B      STD	Y+3,R5
    02682 E321      LDI	R18,0x31
    02683 E032      LDI	R19,2
    02684 018E      MOVW	R16,R28
    02685 5F02      SUBI	R16,0xF2
    02686 4F1F      SBCI	R17,0xFF
    02687 940E 5030 CALL	_sprintf
(0118) 	str2[6]=0;
    02689 2422      CLR	R2
    0268A 8A2C      STD	Y+20,R2
(0119) 	lp(str2);
    0268B 018E      MOVW	R16,R28
    0268C 5F02      SUBI	R16,0xF2
    0268D 4F1F      SBCI	R17,0xFF
    0268E 940E 3F93 CALL	_lp
(0120) 	delayms(500);
    02690 EF04      LDI	R16,0xF4
    02691 E011      LDI	R17,1
    02692 940E 2532 CALL	_delayms
(0121) 	lp("风速脉冲：");delayms(500);
    02694 E10D      LDI	R16,0x1D
    02695 E012      LDI	R17,2
    02696 940E 3F93 CALL	_lp
    02698 EF04      LDI	R16,0xF4
    02699 E011      LDI	R17,1
    0269A 940E 2532 CALL	_delayms
(0122) 	lp("蜂鸣器"); beep(2,2);delayms(500);
    0269C E106      LDI	R16,0x16
    0269D E012      LDI	R17,2
    0269E 940E 3F93 CALL	_lp
    026A0 E022      LDI	R18,2
    026A1 E002      LDI	R16,2
    026A2 940E 400B CALL	_beep
    026A4 EF04      LDI	R16,0xF4
    026A5 E011      LDI	R17,1
    026A6 940E 2532 CALL	_delayms
(0123) 	lp("power 指示灯");
    026A8 E009      LDI	R16,0x9
    026A9 E012      LDI	R17,2
    026AA 940E 3F93 CALL	_lp
(0124) 	LED_OFF();delayms(100);LED_ON();delayms(100);
    026AC 9AA7      SBI	0x14,7
    026AD 98AF      CBI	0x15,7
    026AE E604      LDI	R16,0x64
    026AF E010      LDI	R17,0
    026B0 940E 2532 CALL	_delayms
    026B2 9AA7      SBI	0x14,7
    026B3 9AAF      SBI	0x15,7
    026B4 E604      LDI	R16,0x64
    026B5 E010      LDI	R17,0
    026B6 940E 2532 CALL	_delayms
(0125) 	LED_OFF();delayms(100);LED_ON();delayms(100);
    026B8 9AA7      SBI	0x14,7
    026B9 98AF      CBI	0x15,7
    026BA E604      LDI	R16,0x64
    026BB E010      LDI	R17,0
    026BC 940E 2532 CALL	_delayms
    026BE 9AA7      SBI	0x14,7
    026BF 9AAF      SBI	0x15,7
    026C0 E604      LDI	R16,0x64
    026C1 E010      LDI	R17,0
    026C2 940E 2532 CALL	_delayms
(0126) 	LED_OFF();delayms(100);LED_ON();delayms(100);
    026C4 9AA7      SBI	0x14,7
    026C5 98AF      CBI	0x15,7
    026C6 E604      LDI	R16,0x64
    026C7 E010      LDI	R17,0
    026C8 940E 2532 CALL	_delayms
    026CA 9AA7      SBI	0x14,7
    026CB 9AAF      SBI	0x15,7
    026CC E604      LDI	R16,0x64
    026CD E010      LDI	R17,0
    026CE 940E 2532 CALL	_delayms
(0127) 	delayms(500);
    026D0 EF04      LDI	R16,0xF4
    026D1 E011      LDI	R17,1
    026D2 940E 2532 CALL	_delayms
(0128) 	lp("加热开关");
    026D4 E000      LDI	R16,0
    026D5 E012      LDI	R17,2
    026D6 940E 3F93 CALL	_lp
(0129) 	RELAY_ON();delayms(100);  
    026D8 9AAD      SBI	0x15,5
    026D9 E604      LDI	R16,0x64
    026DA E010      LDI	R17,0
    026DB 940E 2532 CALL	_delayms
(0130) 	RELAY_OFF();delayms(100);
    026DD 98AD      CBI	0x15,5
    026DE E604      LDI	R16,0x64
    026DF E010      LDI	R17,0
    026E0 940E 2532 CALL	_delayms
(0131) 	RELAY_ON();delayms(100);
    026E2 9AAD      SBI	0x15,5
    026E3 E604      LDI	R16,0x64
    026E4 E010      LDI	R17,0
    026E5 940E 2532 CALL	_delayms
(0132) 	RELAY_OFF();delayms(100);
    026E7 98AD      CBI	0x15,5
    026E8 E604      LDI	R16,0x64
    026E9 E010      LDI	R17,0
    026EA 940E 2532 CALL	_delayms
(0133) 	lp("  ");delayms(500);
    026EC EF0D      LDI	R16,0xFD
    026ED E011      LDI	R17,1
    026EE 940E 3F93 CALL	_lp
    026F0 EF04      LDI	R16,0xF4
    026F1 E011      LDI	R17,1
    026F2 940E 2532 CALL	_delayms
(0134) 	lp("                ");
    026F4 EE0C      LDI	R16,0xEC
    026F5 E011      LDI	R17,1
    026F6 940E 3F93 CALL	_lp
(0135) 	lp("                ");
    026F8 EE0C      LDI	R16,0xEC
    026F9 E011      LDI	R17,1
    026FA 940E 3F93 CALL	_lp
(0136) 	lp("                ");
    026FC EE0C      LDI	R16,0xEC
    026FD E011      LDI	R17,1
    026FE 940E 3F93 CALL	_lp
(0137) 	lp("                ");
    02700 EE0C      LDI	R16,0xEC
    02701 E011      LDI	R17,1
    02702 940E 3F93 CALL	_lp
(0138) 	delayms(100);
    02704 E604      LDI	R16,0x64
    02705 E010      LDI	R17,0
    02706 940E 2532 CALL	_delayms
    02708 9664      ADIW	R28,0x14
    02709 9508      RET
_WriteFileHead:
  fs                   --> Y,+177
  bw                   --> Y,+175
  itam                 --> Y,+52
  fnamep               --> Y,+38
  file                 --> Y,+4
  res                  --> R10
    0270A 940E 48B9 CALL	push_xgset003C
    0270C 97EF      SBIW	R28,0x3F
    0270D 97EF      SBIW	R28,0x3F
    0270E 97EF      SBIW	R28,0x3F
    0270F 97EF      SBIW	R28,0x3F
    02710 97EF      SBIW	R28,0x3F
    02711 97EF      SBIW	R28,0x3F
    02712 97EF      SBIW	R28,0x3F
    02713 97EF      SBIW	R28,0x3F
    02714 97EF      SBIW	R28,0x3F
    02715 97EF      SBIW	R28,0x3F
    02716 97EF      SBIW	R28,0x3F
    02717 97AA      SBIW	R28,0x2A
(0139) 	  
(0140) }
(0141) 
(0142) void WriteFileHead(void)   
(0143) {
(0144)  	 unsigned int bw;
(0145) 	 FRESULT res;
(0146) 	 FATFS fs;
(0147) 	 FIL file;
(0148) 	 char fnamep[]="201201.xls\0\0\0"; 
    02718 E28B      LDI	R24,0x2B
    02719 E091      LDI	R25,1
    0271A 01FE      MOVW	R30,R28
    0271B 96B6      ADIW	R30,0x26
    0271C E00E      LDI	R16,0xE
    0271D E010      LDI	R17,0
    0271E 93FA      ST	-Y,R31
    0271F 93EA      ST	-Y,R30
    02720 939A      ST	-Y,R25
    02721 938A      ST	-Y,R24
    02722 940E 4963 CALL	asgnblk
(0149) 	 UINT8 itam[]="DEV000001\t\t\t\t\t\t\t\t\t\t\r\n序号\t日期\t时分\t温度\t风速\t风冷指数\t等价制冷温度\t相当温度\t冻伤危害性\t安静作业\t中等强度作业\t高强度作业\n\0";
    02724 E389      LDI	R24,0x39
    02725 E091      LDI	R25,1
    02726 01FE      MOVW	R30,R28
    02727 96F4      ADIW	R30,0x34
    02728 E70B      LDI	R16,0x7B
    02729 E010      LDI	R17,0
    0272A 93FA      ST	-Y,R31
    0272B 93EA      ST	-Y,R30
    0272C 939A      ST	-Y,R25
    0272D 938A      ST	-Y,R24
    0272E 940E 4963 CALL	asgnblk
(0150) 	 res=disk_initialize(0);
    02730 2700      CLR	R16
    02731 940E 03B8 CALL	_disk_initialize
(0151) 	 #ifdef _DEBUG
(0152) 	 debug("dinit",res);
(0153) 	 #endif
(0154) 	 res = f_mount(0, &fs);
    02733 019E      MOVW	R18,R28
    02734 542F      SUBI	R18,0x4F
    02735 4F3F      SBCI	R19,0xFF
    02736 2700      CLR	R16
    02737 940E 17A4 CALL	_f_mount
(0155) 	 #ifdef _DEBUG
(0156)  	 debug("dmnt",res);
(0157) 	 #endif
(0158) 	 //get_name(fnamep)
(0159) 	 res = f_open(&file, get_name(fnamep) , FA_OPEN_ALWAYS | FA_WRITE );  //创建一个新的文件
    02739 018E      MOVW	R16,R28
    0273A 5D0A      SUBI	R16,0xDA
    0273B 4F1F      SBCI	R17,0xFF
    0273C D521      RCALL	_get_name
    0273D 0168      MOVW	R12,R16
    0273E E182      LDI	R24,0x12
    0273F 8388      ST	Y,R24
    02740 0196      MOVW	R18,R12
    02741 018E      MOVW	R16,R28
    02742 5F0C      SUBI	R16,0xFC
    02743 4F1F      SBCI	R17,0xFF
    02744 940E 17CF CALL	_f_open
(0160) 	 #ifdef _DEBUG
(0161) 	 debug("fopen",res);
(0162) 	 #endif
(0163) 	 res = f_write(&file,itam,128,&bw);   //bw 已写入字节数
    02746 01CE      MOVW	R24,R28
    02747 5581      SUBI	R24,0x51
    02748 4F9F      SBCI	R25,0xFF
    02749 839B      STD	Y+3,R25
    0274A 838A      STD	Y+2,R24
    0274B E880      LDI	R24,0x80
    0274C E090      LDI	R25,0
    0274D 8399      STD	Y+1,R25
    0274E 8388      ST	Y,R24
    0274F 019E      MOVW	R18,R28
    02750 5C2C      SUBI	R18,0xCC
    02751 4F3F      SBCI	R19,0xFF
    02752 018E      MOVW	R16,R28
    02753 5F0C      SUBI	R16,0xFC
    02754 4F1F      SBCI	R17,0xFF
    02755 940E 1BD6 CALL	_f_write
    02757 2EC0      MOV	R12,R16
    02758 2CAC      MOV	R10,R12
(0164) 	 #ifdef _DEBUG
(0165) 	 debug("fwrite",res);
(0166) 	 #endif
(0167) 	 f_close(&file);
    02759 018E      MOVW	R16,R28
    0275A 5F0C      SUBI	R16,0xFC
    0275B 4F1F      SBCI	R17,0xFF
    0275C 940E 1FA0 CALL	_f_close
(0168) 	 f_mount(0, NULL);
    0275E 2722      CLR	R18
    0275F 2733      CLR	R19
    02760 2700      CLR	R16
    02761 940E 17A4 CALL	_f_mount
    02763 96EF      ADIW	R28,0x3F
    02764 96EF      ADIW	R28,0x3F
    02765 96EF      ADIW	R28,0x3F
    02766 96EF      ADIW	R28,0x3F
    02767 96EF      ADIW	R28,0x3F
    02768 96EF      ADIW	R28,0x3F
    02769 96EF      ADIW	R28,0x3F
    0276A 96EF      ADIW	R28,0x3F
    0276B 96EF      ADIW	R28,0x3F
    0276C 96EF      ADIW	R28,0x3F
    0276D 96EF      ADIW	R28,0x3F
    0276E 96AA      ADIW	R28,0x2A
    0276F 940C 4893 JMP	pop_xgset003C
_WriteSDFile:
  fnamep               --> Y,+602
  fs                   --> Y,+44
  bw                   --> Y,+42
  lenth                --> Y,+38
  res                  --> R10
  file                 --> Y,+4
    02771 92AA      ST	-Y,R10
    02772 92CA      ST	-Y,R12
    02773 97EF      SBIW	R28,0x3F
    02774 97EF      SBIW	R28,0x3F
    02775 97EF      SBIW	R28,0x3F
    02776 97EF      SBIW	R28,0x3F
    02777 97EF      SBIW	R28,0x3F
    02778 97EF      SBIW	R28,0x3F
    02779 97EF      SBIW	R28,0x3F
    0277A 97EF      SBIW	R28,0x3F
    0277B 97EF      SBIW	R28,0x3F
    0277C 97E0      SBIW	R28,0x30
(0169) } /////////////////////////////////////////////////
(0170) //       写入文件函数 
(0171) //(创建)打开文件 
(0172) // data 指向欲写入的的字符串 64byt 
(0173) //////////////////////////////////////////////// 
(0174) void WriteSDFile(void)   
(0175) {
(0176)     unsigned int bw;
(0177) 	FRESULT res;
(0178) 	FATFS fs;
(0179)     FIL file;
(0180) 	char fnamep[13];
(0181) 	long lenth=0;
    0277D E080      LDI	R24,0
    0277E A38E      STD	Y+38,R24
    0277F A38F      STD	Y+39,R24
    02780 A788      STD	Y+40,R24
    02781 A789      STD	Y+41,R24
(0182) 	disk_initialize(0);
    02782 2700      CLR	R16
    02783 940E 03B8 CALL	_disk_initialize
(0183) 	res = f_mount(0, &fs);
    02785 019E      MOVW	R18,R28
    02786 5D24      SUBI	R18,0xD4
    02787 4F3F      SBCI	R19,0xFF
    02788 2700      CLR	R16
    02789 940E 17A4 CALL	_f_mount
(0184) 	res = f_open(&file,get_name(fnamep), FA_OPEN_ALWAYS | FA_WRITE );  //创建一个新的文件
    0278B 018E      MOVW	R16,R28
    0278C 5A06      SUBI	R16,0xA6
    0278D 4F1D      SBCI	R17,0xFD
    0278E D4CF      RCALL	_get_name
    0278F E182      LDI	R24,0x12
    02790 8388      ST	Y,R24
    02791 0198      MOVW	R18,R16
    02792 018E      MOVW	R16,R28
    02793 5F0C      SUBI	R16,0xFC
    02794 4F1F      SBCI	R17,0xFF
    02795 940E 17CF CALL	_f_open
(0185) 	lenth=file.fsize;   
    02797 842E      LDD	R2,Y+14
    02798 843F      LDD	R3,Y+15
    02799 8848      LDD	R4,Y+16
    0279A 8859      LDD	R5,Y+17
    0279B A22E      STD	Y+38,R2
    0279C A23F      STD	Y+39,R3
    0279D A648      STD	Y+40,R4
    0279E A659      STD	Y+41,R5
(0186) 	res = f_lseek (&file,lenth);	 
    0279F A02E      LDD	R2,Y+38
    027A0 A03F      LDD	R3,Y+39
    027A1 A448      LDD	R4,Y+40
    027A2 A459      LDD	R5,Y+41
    027A3 8248      ST	Y,R4
    027A4 8259      STD	Y+1,R5
    027A5 0191      MOVW	R18,R2
    027A6 018E      MOVW	R16,R28
    027A7 5F0C      SUBI	R16,0xFC
    027A8 4F1F      SBCI	R17,0xFF
    027A9 940E 1FB0 CALL	_f_lseek
(0187) 	res = f_write(&file,TempChar,SINGLE_ITEM_SIZE,&bw);   //bw 已写入字节数
    027AB 01CE      MOVW	R24,R28
    027AC 968A      ADIW	R24,0x2A
    027AD 839B      STD	Y+3,R25
    027AE 838A      STD	Y+2,R24
    027AF E480      LDI	R24,0x40
    027B0 E090      LDI	R25,0
    027B1 8399      STD	Y+1,R25
    027B2 8388      ST	Y,R24
    027B3 ED2E      LDI	R18,0xDE
    027B4 E035      LDI	R19,5
    027B5 018E      MOVW	R16,R28
    027B6 5F0C      SUBI	R16,0xFC
    027B7 4F1F      SBCI	R17,0xFF
    027B8 940E 1BD6 CALL	_f_write
    027BA 2EC0      MOV	R12,R16
    027BB 2CAC      MOV	R10,R12
(0188) 	f_close(&file);
    027BC 018E      MOVW	R16,R28
    027BD 5F0C      SUBI	R16,0xFC
    027BE 4F1F      SBCI	R17,0xFF
    027BF 940E 1FA0 CALL	_f_close
(0189) 	f_mount(0, NULL);
    027C1 2722      CLR	R18
    027C2 2733      CLR	R19
    027C3 2700      CLR	R16
    027C4 940E 17A4 CALL	_f_mount
    027C6 96EF      ADIW	R28,0x3F
    027C7 96EF      ADIW	R28,0x3F
    027C8 96EF      ADIW	R28,0x3F
    027C9 96EF      ADIW	R28,0x3F
    027CA 96EF      ADIW	R28,0x3F
    027CB 96EF      ADIW	R28,0x3F
    027CC 96EF      ADIW	R28,0x3F
    027CD 96EF      ADIW	R28,0x3F
    027CE 96EF      ADIW	R28,0x3F
    027CF 96E0      ADIW	R28,0x30
    027D0 90C9      LD	R12,Y+
    027D1 90A9      LD	R10,Y+
    027D2 9508      RET
_ReadSDFile:
  fs                   --> Y,+40
  bw                   --> Y,+38
  max                  --> R12
  file                 --> Y,+4
  res                  --> R20
  mode                 --> R22
  data                 --> R10
  index                --> R14
  fnamep               --> R12
    027D3 940E 48B3 CALL	push_xgsetF0FC
    027D5 0179      MOVW	R14,R18
    027D6 0168      MOVW	R12,R16
    027D7 97EF      SBIW	R28,0x3F
    027D8 97EF      SBIW	R28,0x3F
    027D9 97EF      SBIW	R28,0x3F
    027DA 97EF      SBIW	R28,0x3F
    027DB 97EF      SBIW	R28,0x3F
    027DC 97EF      SBIW	R28,0x3F
    027DD 97EF      SBIW	R28,0x3F
    027DE 97EF      SBIW	R28,0x3F
    027DF 97EF      SBIW	R28,0x3F
    027E0 976F      SBIW	R28,0x1F
    027E1 01FE      MOVW	R30,R28
    027E2 5AE0      SUBI	R30,0xA0
    027E3 4FFD      SBCI	R31,0xFD
    027E4 80A0      LD	R10,Z
    027E5 80B1      LDD	R11,Z+1
    027E6 01FE      MOVW	R30,R28
    027E7 59EE      SUBI	R30,0x9E
    027E8 4FFD      SBCI	R31,0xFD
    027E9 8160      LD	R22,Z
(0190) }
(0191) /////////////////////////////////////////////////
(0192) //       读取文件函数
(0193) //以64byte为一块 读取
(0194) //index数据偏移量   data读出后存放地
(0195) //////////////////////////////////////////////// 
(0196) char ReadSDFile(char *fnamep,int index, char *data, char mode)
(0197) {
(0198)  	unsigned int bw;
(0199) 	char res;
(0200) 	FATFS fs;
(0201)     FIL file;
(0202) 	static int indexoffset;
(0203) 	unsigned int max;
(0204) 	disk_initialize(0);
    027EA 2700      CLR	R16
    027EB 940E 03B8 CALL	_disk_initialize
(0205)     res = f_mount(0, &fs);
    027ED 019E      MOVW	R18,R28
    027EE 5D28      SUBI	R18,0xD8
    027EF 4F3F      SBCI	R19,0xFF
    027F0 2700      CLR	R16
    027F1 940E 17A4 CALL	_f_mount
(0206)     res = f_open(&file,fnamep,FA_READ);  
    027F3 E081      LDI	R24,1
    027F4 8388      ST	Y,R24
    027F5 0196      MOVW	R18,R12
    027F6 018E      MOVW	R16,R28
    027F7 5F0C      SUBI	R16,0xFC
    027F8 4F1F      SBCI	R17,0xFF
    027F9 940E 17CF CALL	_f_open
    027FB 2F40      MOV	R20,R16
(0207)     if(res==FR_NO_FILE) {
    027FC 3004      CPI	R16,4
    027FD F419      BNE	0x2801
(0208) 	data=NULL;
    027FE 24AA      CLR	R10
    027FF 24BB      CLR	R11
(0209)     #if _debug >= 1 
(0210)     debug_out("now file",255);
(0211) 	debug_out(filename,res);
(0212) 	debug_out("file is no exist....",255);
(0213)     #endif 
(0214)     return res;
    02800 C078      RJMP	0x2879
(0215)     }   
(0216)     max = (file.fsize-128)/SINGLE_ITEM_SIZE;
    02801 E880      LDI	R24,0x80
    02802 E090      LDI	R25,0
    02803 E0A0      LDI	R26,0
    02804 E0B0      LDI	R27,0
    02805 850E      LDD	R16,Y+14
    02806 851F      LDD	R17,Y+15
    02807 8928      LDD	R18,Y+16
    02808 8939      LDD	R19,Y+17
    02809 1B08      SUB	R16,R24
    0280A 0B19      SBC	R17,R25
    0280B 0B2A      SBC	R18,R26
    0280C 0B3B      SBC	R19,R27
    0280D E086      LDI	R24,6
    0280E E090      LDI	R25,0
    0280F 938A      ST	-Y,R24
    02810 940E 4957 CALL	lsr32
    02812 0168      MOVW	R12,R16
(0217) 	if(mode == 0){ //绝对位置模式
    02813 2366      TST	R22
    02814 F429      BNE	0x281A
(0218) 		indexoffset = index;
    02815 92F0 05DD STS	main.c:indexoffset+1,R15
    02817 92E0 05DC STS	main.c:indexoffset,R14
(0219) 	}
    02819 C00C      RJMP	0x2826
(0220) 	else if(mode == 1){ //位置偏移模式
    0281A 3061      CPI	R22,1
    0281B F451      BNE	0x2826
(0221) 		indexoffset+=index;
    0281C 9020 05DC LDS	R2,main.c:indexoffset
    0281E 9030 05DD LDS	R3,main.c:indexoffset+1
    02820 0C2E      ADD	R2,R14
    02821 1C3F      ADC	R3,R15
    02822 9230 05DD STS	main.c:indexoffset+1,R3
    02824 9220 05DC STS	main.c:indexoffset,R2
(0222) 	}
(0223) 	if(indexoffset >max){
    02826 9020 05DC LDS	R2,main.c:indexoffset
    02828 9030 05DD LDS	R3,main.c:indexoffset+1
    0282A 14C2      CP	R12,R2
    0282B 04D3      CPC	R13,R3
    0282C F428      BCC	0x2832
(0224) 	    indexoffset = max;
    0282D 92D0 05DD STS	main.c:indexoffset+1,R13
    0282F 92C0 05DC STS	main.c:indexoffset,R12
(0225) 	}
    02831 C00F      RJMP	0x2841
(0226) 	else if(indexoffset <=0){
    02832 2422      CLR	R2
    02833 2433      CLR	R3
    02834 9040 05DC LDS	R4,main.c:indexoffset
    02836 9050 05DD LDS	R5,main.c:indexoffset+1
    02838 1424      CP	R2,R4
    02839 0435      CPC	R3,R5
    0283A F034      BLT	0x2841
(0227) 		indexoffset = 1;
    0283B E081      LDI	R24,1
    0283C E090      LDI	R25,0
    0283D 9390 05DD STS	main.c:indexoffset+1,R25
    0283F 9380 05DC STS	main.c:indexoffset,R24
(0228) 	}
(0229) 	res = f_lseek (&file,(indexoffset-1)*SINGLE_ITEM_SIZE+128);	 //前两个字节数据为文件头空间 所以从第三块读/写起
    02841 9120 05DC LDS	R18,main.c:indexoffset
    02843 9130 05DD LDS	R19,main.c:indexoffset+1
    02845 E400      LDI	R16,0x40
    02846 E010      LDI	R17,0
    02847 940E 484F CALL	empy16s
    02849 01C8      MOVW	R24,R16
    0284A 5480      SUBI	R24,0x40
    0284B 4090      SBCI	R25,0
    0284C 5880      SUBI	R24,0x80
    0284D 4F9F      SBCI	R25,0xFF
    0284E 011C      MOVW	R2,R24
    0284F 2444      CLR	R4
    02850 FC37      SBRC	R3,7
    02851 9440      COM	R4
    02852 2455      CLR	R5
    02853 FC47      SBRC	R4,7
    02854 9450      COM	R5
    02855 8248      ST	Y,R4
    02856 8259      STD	Y+1,R5
    02857 0191      MOVW	R18,R2
    02858 018E      MOVW	R16,R28
    02859 5F0C      SUBI	R16,0xFC
    0285A 4F1F      SBCI	R17,0xFF
    0285B 940E 1FB0 CALL	_f_lseek
    0285D 2EC0      MOV	R12,R16
(0230)     res = f_read(&file,data,SINGLE_ITEM_SIZE,&bw);
    0285E 01CE      MOVW	R24,R28
    0285F 9686      ADIW	R24,0x26
    02860 839B      STD	Y+3,R25
    02861 838A      STD	Y+2,R24
    02862 E480      LDI	R24,0x40
    02863 E090      LDI	R25,0
    02864 8399      STD	Y+1,R25
    02865 8388      ST	Y,R24
    02866 0195      MOVW	R18,R10
    02867 018E      MOVW	R16,R28
    02868 5F0C      SUBI	R16,0xFC
    02869 4F1F      SBCI	R17,0xFF
    0286A 940E 196B CALL	_f_read
    0286C 2EA0      MOV	R10,R16
    0286D 2D4A      MOV	R20,R10
(0231)     f_close(&file);
    0286E 018E      MOVW	R16,R28
    0286F 5F0C      SUBI	R16,0xFC
    02870 4F1F      SBCI	R17,0xFF
    02871 940E 1FA0 CALL	_f_close
(0232) 	f_mount(0, NULL);
    02873 2722      CLR	R18
    02874 2733      CLR	R19
    02875 2700      CLR	R16
    02876 940E 17A4 CALL	_f_mount
(0233) 	return res;
    02878 2F04      MOV	R16,R20
    02879 96EF      ADIW	R28,0x3F
    0287A 96EF      ADIW	R28,0x3F
    0287B 96EF      ADIW	R28,0x3F
    0287C 96EF      ADIW	R28,0x3F
    0287D 96EF      ADIW	R28,0x3F
    0287E 96EF      ADIW	R28,0x3F
    0287F 96EF      ADIW	R28,0x3F
    02880 96EF      ADIW	R28,0x3F
    02881 96EF      ADIW	R28,0x3F
    02882 966F      ADIW	R28,0x1F
    02883 940C 48A8 JMP	pop_xgsetF0FC
_findIndex:
  fs                   --> Y,+48
  bw                   --> Y,+46
  fnamep               --> R14
  readsize             --> R10
  res                  --> R12
  file                 --> Y,+12
  lenth                --> Y,+8
  index                --> Y,+4
  is_first_end         --> Y,+606
  tmp                  --> R10
  buf                  --> Y,+617
  filename             --> R10
    02885 933A      ST	-Y,R19
    02886 932A      ST	-Y,R18
    02887 940E 48B3 CALL	push_xgsetF0FC
    02889 0158      MOVW	R10,R16
    0288A 97EF      SBIW	R28,0x3F
    0288B 97EF      SBIW	R28,0x3F
    0288C 97EF      SBIW	R28,0x3F
    0288D 97EF      SBIW	R28,0x3F
    0288E 97EF      SBIW	R28,0x3F
    0288F 97EF      SBIW	R28,0x3F
    02890 97EF      SBIW	R28,0x3F
    02891 97EF      SBIW	R28,0x3F
    02892 97EF      SBIW	R28,0x3F
    02893 97A8      SBIW	R28,0x28
(0234) } 
(0235) //////////////////////////////////
(0236) //   find index
(0237) // 检查当前文件尺寸，根据倒数第二个
(0238) //'\n'及其后面的index确定当前index值
(0239) //////////////////////////////////
(0240) unsigned int findIndex(char *filename,char *buf){
(0241)     unsigned int bw,tmp;
(0242) 	long index =0;
    02894 E080      LDI	R24,0
    02895 838C      STD	Y+4,R24
    02896 838D      STD	Y+5,R24
    02897 838E      STD	Y+6,R24
    02898 838F      STD	Y+7,R24
(0243) 	unsigned char is_first_end=0;
    02899 2400      CLR	R0
    0289A 01DE      MOVW	R26,R28
    0289B 5AA2      SUBI	R26,0xA2
    0289C 4FBD      SBCI	R27,0xFD
    0289D 920C      ST	X,R0
(0244) 	char *fnamep=filename;
    0289E 0175      MOVW	R14,R10
(0245) 	FRESULT res;
(0246) 	FATFS fs;
(0247) 	FIL file;
(0248) 	long lenth=0;
    0289F E080      LDI	R24,0
    028A0 8788      STD	Y+8,R24
    028A1 8789      STD	Y+9,R24
    028A2 878A      STD	Y+10,R24
    028A3 878B      STD	Y+11,R24
(0249) 	int readsize=0;
    028A4 24AA      CLR	R10
    028A5 24BB      CLR	R11
(0250) 	//PrintString_n(fnamep);
(0251) 	res = f_mount(0, &fs);
    028A6 019E      MOVW	R18,R28
    028A7 5D20      SUBI	R18,0xD0
    028A8 4F3F      SBCI	R19,0xFF
    028A9 2700      CLR	R16
    028AA 940E 17A4 CALL	_f_mount
(0252) 	res = f_open(&file,fnamep, FA_OPEN_ALWAYS | FA_READ );  //创建一个新的文件
    028AC E181      LDI	R24,0x11
    028AD 8388      ST	Y,R24
    028AE 0197      MOVW	R18,R14
    028AF 018E      MOVW	R16,R28
    028B0 5F04      SUBI	R16,0xF4
    028B1 4F1F      SBCI	R17,0xFF
    028B2 940E 17CF CALL	_f_open
    028B4 2EC0      MOV	R12,R16
(0253) 	if(res !=  FR_OK){ //openerror
    028B5 2300      TST	R16
    028B6 F011      BEQ	0x28B9
(0254) 	    return res;}
    028B7 2711      CLR	R17
    028B8 C110      RJMP	0x29C9
(0255) 	lenth=file.fsize;   //文件尾部为 file.size 
    028B9 882E      LDD	R2,Y+22
    028BA 883F      LDD	R3,Y+23
    028BB 8C48      LDD	R4,Y+24
    028BC 8C59      LDD	R5,Y+25
    028BD 8628      STD	Y+8,R2
    028BE 8639      STD	Y+9,R3
    028BF 864A      STD	Y+10,R4
    028C0 865B      STD	Y+11,R5
(0256) 	//debug("size=",0xff);
(0257) 	//PrintLong(lenth);
(0258) 	if(lenth > 512) {
    028C1 E040      LDI	R20,0
    028C2 E052      LDI	R21,2
    028C3 E060      LDI	R22,0
    028C4 E070      LDI	R23,0
    028C5 8428      LDD	R2,Y+8
    028C6 8439      LDD	R3,Y+9
    028C7 844A      LDD	R4,Y+10
    028C8 845B      LDD	R5,Y+11
    028C9 1542      CP	R20,R2
    028CA 0553      CPC	R21,R3
    028CB 0564      CPC	R22,R4
    028CC 0575      CPC	R23,R5
    028CD F464      BGE	0x28DA
(0259) 	    readsize=512;
    028CE E080      LDI	R24,0
    028CF E092      LDI	R25,2
    028D0 015C      MOVW	R10,R24
(0260) 		lenth=file.fsize;
    028D1 882E      LDD	R2,Y+22
    028D2 883F      LDD	R3,Y+23
    028D3 8C48      LDD	R4,Y+24
    028D4 8C59      LDD	R5,Y+25
    028D5 8628      STD	Y+8,R2
    028D6 8639      STD	Y+9,R3
    028D7 864A      STD	Y+10,R4
    028D8 865B      STD	Y+11,R5
(0261) 	}
    028D9 C007      RJMP	0x28E1
(0262) 	else {
(0263) 	    readsize =file.fsize;
    028DA 88AE      LDD	R10,Y+22
    028DB 88BF      LDD	R11,Y+23
(0264) 		lenth=0;
    028DC E080      LDI	R24,0
    028DD 8788      STD	Y+8,R24
    028DE 8789      STD	Y+9,R24
    028DF 878A      STD	Y+10,R24
    028E0 878B      STD	Y+11,R24
(0265) 	}
(0266) 	res = f_lseek (&file,file.fsize-readsize);
    028E1 0115      MOVW	R2,R10
    028E2 2444      CLR	R4
    028E3 FC37      SBRC	R3,7
    028E4 9440      COM	R4
    028E5 2455      CLR	R5
    028E6 FC47      SBRC	R4,7
    028E7 9450      COM	R5
    028E8 886E      LDD	R6,Y+22
    028E9 887F      LDD	R7,Y+23
    028EA 8C88      LDD	R8,Y+24
    028EB 8C99      LDD	R9,Y+25
    028EC 1862      SUB	R6,R2
    028ED 0873      SBC	R7,R3
    028EE 0884      SBC	R8,R4
    028EF 0895      SBC	R9,R5
    028F0 8288      ST	Y,R8
    028F1 8299      STD	Y+1,R9
    028F2 0193      MOVW	R18,R6
    028F3 018E      MOVW	R16,R28
    028F4 5F04      SUBI	R16,0xF4
    028F5 4F1F      SBCI	R17,0xFF
    028F6 940E 1FB0 CALL	_f_lseek
(0267) 	//debug("readSIZE=",0x00);
(0268) 	//PrintLong((file.fsize-readsize));
(0269) 	res = f_read(&file,buf,readsize,&bw);
    028F8 01CE      MOVW	R24,R28
    028F9 968E      ADIW	R24,0x2E
    028FA 839B      STD	Y+3,R25
    028FB 838A      STD	Y+2,R24
    028FC 82B9      STD	Y+1,R11
    028FD 82A8      ST	Y,R10
    028FE 01FE      MOVW	R30,R28
    028FF 59E7      SUBI	R30,0x97
    02900 4FFD      SBCI	R31,0xFD
    02901 8120      LD	R18,Z
    02902 8131      LDD	R19,Z+1
    02903 018E      MOVW	R16,R28
    02904 5F04      SUBI	R16,0xF4
    02905 4F1F      SBCI	R17,0xFF
    02906 940E 196B CALL	_f_read
    02908 2EE0      MOV	R14,R16
    02909 2CCE      MOV	R12,R14
(0270) 	f_close(&file);
    0290A 018E      MOVW	R16,R28
    0290B 5F04      SUBI	R16,0xF4
    0290C 4F1F      SBCI	R17,0xFF
    0290D 940E 1FA0 CALL	_f_close
(0271) 	//debug("readRES=",res);
(0272) 	//debug("readbw=",0X00);
(0273) 	//PrintLong(bw);
(0274) 	//PrintString_n(buf);
(0275) 	for(tmp=readsize;tmp>0;tmp--){
    0290F C040      RJMP	0x2950
(0276) 		//debug("buf index",buf[tmp]);
(0277) 		//PrintLong(tmp);
(0278) 		//if(buf[tmp] == '\n') Usart_Transmit('@');						  
(0279) 		if(buf[tmp] == '\n' && is_first_end== 0){
    02910 01F5      MOVW	R30,R10
    02911 01DE      MOVW	R26,R28
    02912 59A7      SUBI	R26,0x97
    02913 4FBD      SBCI	R27,0xFD
    02914 900D      LD	R0,X+
    02915 901C      LD	R1,X
    02916 0DE0      ADD	R30,R0
    02917 1DF1      ADC	R31,R1
    02918 8180      LD	R24,Z
    02919 308A      CPI	R24,0xA
    0291A F469      BNE	0x2928
    0291B 01FE      MOVW	R30,R28
    0291C 5AE2      SUBI	R30,0xA2
    0291D 4FFD      SBCI	R31,0xFD
    0291E 8000      LD	R0,Z
    0291F 2000      TST	R0
    02920 F439      BNE	0x2928
(0280) 		    is_first_end=1; 	
    02921 2400      CLR	R0
    02922 9403      INC	R0
    02923 01FE      MOVW	R30,R28
    02924 5AE2      SUBI	R30,0xA2
    02925 4FFD      SBCI	R31,0xFD
    02926 8200      ST	Z,R0
(0281) 			//debug("first=",0xf0);					      
(0282) 		}
    02927 C025      RJMP	0x294D
(0283) 		else if(buf[tmp] == '\n' && is_first_end== 1){
    02928 01F5      MOVW	R30,R10
    02929 01DE      MOVW	R26,R28
    0292A 59A7      SUBI	R26,0x97
    0292B 4FBD      SBCI	R27,0xFD
    0292C 900D      LD	R0,X+
    0292D 901C      LD	R1,X
    0292E 0DE0      ADD	R30,R0
    0292F 1DF1      ADC	R31,R1
    02930 8180      LD	R24,Z
    02931 308A      CPI	R24,0xA
    02932 F4D1      BNE	0x294D
    02933 01DE      MOVW	R26,R28
    02934 5AA2      SUBI	R26,0xA2
    02935 4FBD      SBCI	R27,0xFD
    02936 918C      LD	R24,X
    02937 3081      CPI	R24,1
    02938 F4A1      BNE	0x294D
(0284) 		    lenth -= (512-tmp);
    02939 E080      LDI	R24,0
    0293A E092      LDI	R25,2
    0293B 011C      MOVW	R2,R24
    0293C 182A      SUB	R2,R10
    0293D 083B      SBC	R3,R11
    0293E 2444      CLR	R4
    0293F 2455      CLR	R5
    02940 8468      LDD	R6,Y+8
    02941 8479      LDD	R7,Y+9
    02942 848A      LDD	R8,Y+10
    02943 849B      LDD	R9,Y+11
    02944 1862      SUB	R6,R2
    02945 0873      SBC	R7,R3
    02946 0884      SBC	R8,R4
    02947 0895      SBC	R9,R5
    02948 8668      STD	Y+8,R6
    02949 8679      STD	Y+9,R7
    0294A 868A      STD	Y+10,R8
    0294B 869B      STD	Y+11,R9
(0285) 			break;
    0294C C009      RJMP	0x2956
    0294D 01C5      MOVW	R24,R10
    0294E 9701      SBIW	R24,1
    0294F 015C      MOVW	R10,R24
    02950 20AA      TST	R10
    02951 F009      BEQ	0x2953
    02952 CFBD      RJMP	0x2910
    02953 20BB      TST	R11
    02954 F009      BEQ	0x2956
    02955 CFBA      RJMP	0x2910
(0286) 		} 						
(0287) 	}
(0288) 	//debug("start=",0X00); PrintLong(lenth);
(0289) 	if(lenth < 118 ){ 
    02956 E746      LDI	R20,0x76
    02957 E050      LDI	R21,0
    02958 E060      LDI	R22,0
    02959 E070      LDI	R23,0
    0295A 8428      LDD	R2,Y+8
    0295B 8439      LDD	R3,Y+9
    0295C 844A      LDD	R4,Y+10
    0295D 845B      LDD	R5,Y+11
    0295E 1624      CP	R2,R20
    0295F 0635      CPC	R3,R21
    02960 0646      CPC	R4,R22
    02961 0657      CPC	R5,R23
    02962 F434      BGE	0x2969
(0290)  		return 1;
    02963 E001      LDI	R16,1
    02964 E010      LDI	R17,0
    02965 C063      RJMP	0x29C9
(0291) 	}
(0292) 	else {
(0293) 		 //debug(">128 ",0X00);
(0294) 		 while(buf[tmp] <= '0' || buf[tmp] >= '9') tmp++;
    02966 01C5      MOVW	R24,R10
    02967 9601      ADIW	R24,1
    02968 015C      MOVW	R10,R24
    02969 01F5      MOVW	R30,R10
    0296A 01DE      MOVW	R26,R28
    0296B 59A7      SUBI	R26,0x97
    0296C 4FBD      SBCI	R27,0xFD
    0296D 900D      LD	R0,X+
    0296E 901C      LD	R1,X
    0296F 0DE0      ADD	R30,R0
    02970 1DF1      ADC	R31,R1
    02971 80E0      LD	R14,Z
    02972 24FF      CLR	R15
    02973 E380      LDI	R24,0x30
    02974 158E      CP	R24,R14
    02975 F780      BCC	0x2966
    02976 2D8E      MOV	R24,R14
    02977 3389      CPI	R24,0x39
    02978 F768      BCC	0x2966
    02979 C02F      RJMP	0x29A9
(0295) 		 //debug("nozero ",bw); PrintLong(tmp);
(0296) 		 while(buf[tmp] != 't' && buf[tmp] >= '0' && buf[tmp] <= '9'){
(0297) 		     index=index*10+(buf[tmp]-'0');
    0297A 01F5      MOVW	R30,R10
    0297B 01DE      MOVW	R26,R28
    0297C 59A7      SUBI	R26,0x97
    0297D 4FBD      SBCI	R27,0xFD
    0297E 900D      LD	R0,X+
    0297F 901C      LD	R1,X
    02980 0DE0      ADD	R30,R0
    02981 1DF1      ADC	R31,R1
    02982 8180      LD	R24,Z
    02983 2799      CLR	R25
    02984 97C0      SBIW	R24,0x30
    02985 011C      MOVW	R2,R24
    02986 2444      CLR	R4
    02987 FC37      SBRC	R3,7
    02988 9440      COM	R4
    02989 2455      CLR	R5
    0298A FC47      SBRC	R4,7
    0298B 9450      COM	R5
    0298C 806C      LDD	R6,Y+4
    0298D 807D      LDD	R7,Y+5
    0298E 808E      LDD	R8,Y+6
    0298F 809F      LDD	R9,Y+7
    02990 E04A      LDI	R20,0xA
    02991 E050      LDI	R21,0
    02992 E060      LDI	R22,0
    02993 E070      LDI	R23,0
    02994 929A      ST	-Y,R9
    02995 928A      ST	-Y,R8
    02996 927A      ST	-Y,R7
    02997 926A      ST	-Y,R6
    02998 018A      MOVW	R16,R20
    02999 019B      MOVW	R18,R22
    0299A 940E 485F CALL	empy32u|empy32s
    0299C 0138      MOVW	R6,R16
    0299D 0149      MOVW	R8,R18
    0299E 0C62      ADD	R6,R2
    0299F 1C73      ADC	R7,R3
    029A0 1C84      ADC	R8,R4
    029A1 1C95      ADC	R9,R5
    029A2 826C      STD	Y+4,R6
    029A3 827D      STD	Y+5,R7
    029A4 828E      STD	Y+6,R8
    029A5 829F      STD	Y+7,R9
(0298) 		 	 //Usart_Transmit(buf[tmp]);	
(0299) 		 	 tmp++;
    029A6 01C5      MOVW	R24,R10
    029A7 9601      ADIW	R24,1
    029A8 015C      MOVW	R10,R24
    029A9 01F5      MOVW	R30,R10
    029AA 01DE      MOVW	R26,R28
    029AB 59A7      SUBI	R26,0x97
    029AC 4FBD      SBCI	R27,0xFD
    029AD 900D      LD	R0,X+
    029AE 901C      LD	R1,X
    029AF 0DE0      ADD	R30,R0
    029B0 1DF1      ADC	R31,R1
    029B1 80E0      LD	R14,Z
    029B2 24FF      CLR	R15
    029B3 2D8E      MOV	R24,R14
    029B4 3784      CPI	R24,0x74
    029B5 F031      BEQ	0x29BC
    029B6 3380      CPI	R24,0x30
    029B7 F020      BCS	0x29BC
    029B8 E389      LDI	R24,0x39
    029B9 158E      CP	R24,R14
    029BA F008      BCS	0x29BC
    029BB CFBE      RJMP	0x297A
(0300) 		 }
(0301) 	}
(0302) 	//debug("index=",0X00);
(0303) 	//PrintLong(index+1);
(0304) 	return index+1;
    029BC E041      LDI	R20,1
    029BD E050      LDI	R21,0
    029BE E060      LDI	R22,0
    029BF E070      LDI	R23,0
    029C0 802C      LDD	R2,Y+4
    029C1 803D      LDD	R3,Y+5
    029C2 804E      LDD	R4,Y+6
    029C3 805F      LDD	R5,Y+7
    029C4 0E24      ADD	R2,R20
    029C5 1E35      ADC	R3,R21
    029C6 1E46      ADC	R4,R22
    029C7 1E57      ADC	R5,R23
    029C8 0181      MOVW	R16,R2
    029C9 96EF      ADIW	R28,0x3F
    029CA 96EF      ADIW	R28,0x3F
    029CB 96EF      ADIW	R28,0x3F
    029CC 96EF      ADIW	R28,0x3F
    029CD 96EF      ADIW	R28,0x3F
    029CE 96EF      ADIW	R28,0x3F
    029CF 96EF      ADIW	R28,0x3F
    029D0 96EF      ADIW	R28,0x3F
    029D1 96EF      ADIW	R28,0x3F
    029D2 96A8      ADIW	R28,0x28
    029D3 940E 48A8 CALL	pop_xgsetF0FC
    029D5 9622      ADIW	R28,2
    029D6 9508      RET
_Round:
  x                    --> Y,+0
    029D7 940E 476E CALL	push_arg4
(0305) }
(0306) float Round(float x){
(0307)     x=x*10;
    029D9 EB06      LDI	R16,0xB6
    029DA E010      LDI	R17,0
    029DB 940E 483B CALL	elpm32
    029DD 01CE      MOVW	R24,R28
    029DE 939A      ST	-Y,R25
    029DF 938A      ST	-Y,R24
    029E0 940E 4BF9 CALL	fpmule1
    029E2 8308      ST	Y,R16
    029E3 8319      STD	Y+1,R17
    029E4 832A      STD	Y+2,R18
    029E5 833B      STD	Y+3,R19
(0308) 	if(x >=0) x+=0.5;
    029E6 8028      LD	R2,Y
    029E7 8039      LDD	R3,Y+1
    029E8 804A      LDD	R4,Y+2
    029E9 805B      LDD	R5,Y+3
    029EA EB0A      LDI	R16,0xBA
    029EB E010      LDI	R17,0
    029EC 940E 483B CALL	elpm32
    029EE 933A      ST	-Y,R19
    029EF 932A      ST	-Y,R18
    029F0 931A      ST	-Y,R17
    029F1 930A      ST	-Y,R16
    029F2 0181      MOVW	R16,R2
    029F3 0192      MOVW	R18,R4
    029F4 940E 4C33 CALL	fpcmp2
    029F6 F0AC      BLT	0x2A0C
    029F7 8028      LD	R2,Y
    029F8 8039      LDD	R3,Y+1
    029F9 804A      LDD	R4,Y+2
    029FA 805B      LDD	R5,Y+3
    029FB EB02      LDI	R16,0xB2
    029FC E010      LDI	R17,0
    029FD 940E 483B CALL	elpm32
    029FF 933A      ST	-Y,R19
    02A00 932A      ST	-Y,R18
    02A01 931A      ST	-Y,R17
    02A02 930A      ST	-Y,R16
    02A03 0181      MOVW	R16,R2
    02A04 0192      MOVW	R18,R4
    02A05 940E 49EF CALL	fpadd2
    02A07 8308      ST	Y,R16
    02A08 8319      STD	Y+1,R17
    02A09 832A      STD	Y+2,R18
    02A0A 833B      STD	Y+3,R19
    02A0B C014      RJMP	0x2A20
(0309) 	else x-=0.5;
    02A0C 8028      LD	R2,Y
    02A0D 8039      LDD	R3,Y+1
    02A0E 804A      LDD	R4,Y+2
    02A0F 805B      LDD	R5,Y+3
    02A10 EB02      LDI	R16,0xB2
    02A11 E010      LDI	R17,0
    02A12 940E 483B CALL	elpm32
    02A14 933A      ST	-Y,R19
    02A15 932A      ST	-Y,R18
    02A16 931A      ST	-Y,R17
    02A17 930A      ST	-Y,R16
    02A18 0181      MOVW	R16,R2
    02A19 0192      MOVW	R18,R4
    02A1A 940E 4A04 CALL	fpsub2
    02A1C 8308      ST	Y,R16
    02A1D 8319      STD	Y+1,R17
    02A1E 832A      STD	Y+2,R18
    02A1F 833B      STD	Y+3,R19
(0310) 	x=(int)x;
    02A20 8108      LD	R16,Y
    02A21 8119      LDD	R17,Y+1
    02A22 812A      LDD	R18,Y+2
    02A23 813B      LDD	R19,Y+3
    02A24 940E 4A2A CALL	fpint
    02A26 940E 4A5E CALL	int2fp
    02A28 8308      ST	Y,R16
    02A29 8319      STD	Y+1,R17
    02A2A 832A      STD	Y+2,R18
    02A2B 833B      STD	Y+3,R19
(0311) 	x=x/10.0;
    02A2C 8028      LD	R2,Y
    02A2D 8039      LDD	R3,Y+1
    02A2E 804A      LDD	R4,Y+2
    02A2F 805B      LDD	R5,Y+3
    02A30 EA0E      LDI	R16,0xAE
    02A31 E010      LDI	R17,0
    02A32 940E 483B CALL	elpm32
    02A34 933A      ST	-Y,R19
    02A35 932A      ST	-Y,R18
    02A36 931A      ST	-Y,R17
    02A37 930A      ST	-Y,R16
    02A38 0181      MOVW	R16,R2
    02A39 0192      MOVW	R18,R4
    02A3A 940E 4A89 CALL	fpdiv2
    02A3C 8308      ST	Y,R16
    02A3D 8319      STD	Y+1,R17
    02A3E 832A      STD	Y+2,R18
    02A3F 833B      STD	Y+3,R19
(0312) 	return x;
    02A40 8108      LD	R16,Y
    02A41 8119      LDD	R17,Y+1
    02A42 812A      LDD	R18,Y+2
    02A43 813B      LDD	R19,Y+3
    02A44 9624      ADIW	R28,4
    02A45 9508      RET
_check:
  WScounter            --> R10
  tmp                  --> R12
    02A46 940E 48B9 CALL	push_xgset003C
    02A48 9724      SBIW	R28,4
(0313) }
(0314) 
(0315) void check( void )
(0316) {
(0317)  unsigned char tmp;
(0318)  unsigned int WScounter;
(0319)  //检测风速
(0320)  //读计数器1 此步需严格按手册进行。
(0321)  tmp=SREG;
    02A49 B6CF      IN	R12,0x3F
(0322)  CLI();
    02A4A 94F8      BCLR	7
(0323)  WScounter=TCNT1H*256+TCNT1L;
    02A4B B52D      IN	R18,0x2D
    02A4C 2733      CLR	R19
    02A4D E000      LDI	R16,0
    02A4E E011      LDI	R17,1
    02A4F 940E 484F CALL	empy16s
    02A51 0158      MOVW	R10,R16
    02A52 B42C      IN	R2,0x2C
    02A53 2433      CLR	R3
    02A54 0CA2      ADD	R10,R2
    02A55 1CB3      ADC	R11,R3
(0324)  SREG=tmp;
    02A56 BECF      OUT	0x3F,R12
(0325)  SEI();
    02A57 9478      BSET	7
(0326)  //计算风速
(0327)  Result.WindSpeed=WScounter/N_per_Second;
    02A58 0185      MOVW	R16,R10
    02A59 940E 4A5C CALL	uint2fp
    02A5B 0118      MOVW	R2,R16
    02A5C 0129      MOVW	R4,R18
    02A5D EA0A      LDI	R16,0xAA
    02A5E E010      LDI	R17,0
    02A5F 940E 483B CALL	elpm32
    02A61 933A      ST	-Y,R19
    02A62 932A      ST	-Y,R18
    02A63 931A      ST	-Y,R17
    02A64 930A      ST	-Y,R16
    02A65 0181      MOVW	R16,R2
    02A66 0192      MOVW	R18,R4
    02A67 940E 4A89 CALL	fpdiv2
    02A69 9310 0662 STS	Result+52,R17
    02A6B 9300 0661 STS	Result+51,R16
    02A6D 9330 0664 STS	Result+54,R19
    02A6F 9320 0663 STS	Result+53,R18
(0328)  //四舍五入
(0329)  Result.WindSpeed=Round(Result.WindSpeed);
    02A71 DF65      RCALL	_Round
    02A72 9310 0662 STS	Result+52,R17
    02A74 9300 0661 STS	Result+51,R16
    02A76 9330 0664 STS	Result+54,R19
    02A78 9320 0663 STS	Result+53,R18
(0330)   //温度
(0331)  Result.Temperature=read_T_NUM(OUTSIDE_SENSOR); //读两次 避免出错
    02A7A E001      LDI	R16,1
    02A7B 940E 41C3 CALL	_read_T_NUM
    02A7D 9310 0658 STS	Result+42,R17
    02A7F 9300 0657 STS	Result+41,R16
    02A81 9330 065A STS	Result+44,R19
    02A83 9320 0659 STS	Result+43,R18
(0332)  Result.Temperature=read_T_NUM(OUTSIDE_SENSOR);
    02A85 E001      LDI	R16,1
    02A86 940E 41C3 CALL	_read_T_NUM
    02A88 9310 0658 STS	Result+42,R17
    02A8A 9300 0657 STS	Result+41,R16
    02A8C 9330 065A STS	Result+44,R19
    02A8E 9320 0659 STS	Result+43,R18
(0333)  //四舍五入
(0334)  Result.Temperature=Round(Result.Temperature);
    02A90 DF46      RCALL	_Round
    02A91 9310 0658 STS	Result+42,R17
    02A93 9300 0657 STS	Result+41,R16
    02A95 9330 065A STS	Result+44,R19
    02A97 9320 0659 STS	Result+43,R18
(0335)  //WCI风冷指数
(0336)   Result.WCI = 4.18 *(10*SquareRootFloat(Result.WindSpeed) + 10.45 -  Result.WindSpeed  ) *( 33 - Result.Temperature );
    02A99 9120 0663 LDS	R18,Result+53
    02A9B 9130 0664 LDS	R19,Result+54
    02A9D 9100 0661 LDS	R16,Result+51
    02A9F 9110 0662 LDS	R17,Result+52
    02AA1 D1FB      RCALL	_SquareRootFloat
    02AA2 0118      MOVW	R2,R16
    02AA3 0129      MOVW	R4,R18
    02AA4 EA06      LDI	R16,0xA6
    02AA5 E010      LDI	R17,0
    02AA6 940E 483B CALL	elpm32
    02AA8 0138      MOVW	R6,R16
    02AA9 0149      MOVW	R8,R18
    02AAA EB06      LDI	R16,0xB6
    02AAB E010      LDI	R17,0
    02AAC 940E 483B CALL	elpm32
    02AAE 925A      ST	-Y,R5
    02AAF 924A      ST	-Y,R4
    02AB0 923A      ST	-Y,R3
    02AB1 922A      ST	-Y,R2
    02AB2 940E 4C03 CALL	fpmule2
    02AB4 0118      MOVW	R2,R16
    02AB5 0129      MOVW	R4,R18
    02AB6 EA02      LDI	R16,0xA2
    02AB7 E010      LDI	R17,0
    02AB8 940E 483B CALL	elpm32
    02ABA 933A      ST	-Y,R19
    02ABB 932A      ST	-Y,R18
    02ABC 931A      ST	-Y,R17
    02ABD 930A      ST	-Y,R16
    02ABE 0181      MOVW	R16,R2
    02ABF 0192      MOVW	R18,R4
    02AC0 940E 49EF CALL	fpadd2
    02AC2 E681      LDI	R24,0x61
    02AC3 E096      LDI	R25,6
    02AC4 939A      ST	-Y,R25
    02AC5 938A      ST	-Y,R24
    02AC6 940E 4A0F CALL	fpsub1x
    02AC8 0183      MOVW	R16,R6
    02AC9 0194      MOVW	R18,R8
    02ACA 940E 4C03 CALL	fpmule2
    02ACC 0118      MOVW	R2,R16
    02ACD 0129      MOVW	R4,R18
    02ACE E90E      LDI	R16,0x9E
    02ACF E010      LDI	R17,0
    02AD0 940E 483B CALL	elpm32
    02AD2 E587      LDI	R24,0x57
    02AD3 E096      LDI	R25,6
    02AD4 939A      ST	-Y,R25
    02AD5 938A      ST	-Y,R24
    02AD6 940E 4A0F CALL	fpsub1x
    02AD8 0181      MOVW	R16,R2
    02AD9 0192      MOVW	R18,R4
    02ADA 940E 4C03 CALL	fpmule2
    02ADC 9310 066B STS	Result+61,R17
    02ADE 9300 066A STS	Result+60,R16
    02AE0 9330 066D STS	Result+63,R19
    02AE2 9320 066C STS	Result+62,R18
(0337)  //ECT等价制冷温度
(0338)  Result.ECT=33.0f - 0.01085f*Result.WCI;
    02AE4 E90E      LDI	R16,0x9E
    02AE5 E010      LDI	R17,0
    02AE6 940E 483B CALL	elpm32
    02AE8 0118      MOVW	R2,R16
    02AE9 0129      MOVW	R4,R18
    02AEA E90A      LDI	R16,0x9A
    02AEB E010      LDI	R17,0
    02AEC 940E 483B CALL	elpm32
    02AEE E68A      LDI	R24,0x6A
    02AEF E096      LDI	R25,6
    02AF0 939A      ST	-Y,R25
    02AF1 938A      ST	-Y,R24
    02AF2 940E 4C0E CALL	fpmule1x
    02AF4 0181      MOVW	R16,R2
    02AF5 0192      MOVW	R18,R4
    02AF6 940E 4A04 CALL	fpsub2
    02AF8 9310 0677 STS	Result+73,R17
    02AFA 9300 0676 STS	Result+72,R16
    02AFC 9330 0679 STS	Result+75,R19
    02AFE 9320 0678 STS	Result+74,R18
(0339)  //TEQ 相当温度
(0340)  Result.Teq = Result.Temperature +( (Result.Temperature -36)/10 ) * Result.WindSpeed ;
    02B00 9040 0659 LDS	R4,Result+43
    02B02 9050 065A LDS	R5,Result+44
    02B04 9020 0657 LDS	R2,Result+41
    02B06 9030 0658 LDS	R3,Result+42
    02B08 0131      MOVW	R6,R2
    02B09 0142      MOVW	R8,R4
    02B0A E906      LDI	R16,0x96
    02B0B E010      LDI	R17,0
    02B0C 940E 483B CALL	elpm32
    02B0E 933A      ST	-Y,R19
    02B0F 932A      ST	-Y,R18
    02B10 931A      ST	-Y,R17
    02B11 930A      ST	-Y,R16
    02B12 0183      MOVW	R16,R6
    02B13 0194      MOVW	R18,R8
    02B14 940E 4A04 CALL	fpsub2
    02B16 0138      MOVW	R6,R16
    02B17 0149      MOVW	R8,R18
    02B18 EB06      LDI	R16,0xB6
    02B19 E010      LDI	R17,0
    02B1A 940E 483B CALL	elpm32
    02B1C 933A      ST	-Y,R19
    02B1D 932A      ST	-Y,R18
    02B1E 931A      ST	-Y,R17
    02B1F 930A      ST	-Y,R16
    02B20 0183      MOVW	R16,R6
    02B21 0194      MOVW	R18,R8
    02B22 940E 4A89 CALL	fpdiv2
    02B24 E681      LDI	R24,0x61
    02B25 E096      LDI	R25,6
    02B26 939A      ST	-Y,R25
    02B27 938A      ST	-Y,R24
    02B28 940E 4C0E CALL	fpmule1x
    02B2A 0181      MOVW	R16,R2
    02B2B 0192      MOVW	R18,R4
    02B2C 940E 49EF CALL	fpadd2
    02B2E 9310 0681 STS	Result+83,R17
    02B30 9300 0680 STS	Result+82,R16
    02B32 9330 0683 STS	Result+85,R19
    02B34 9320 0682 STS	Result+84,R18
(0341) //将数据转换成字符串
(0342) sprintf(Result.WSChar, "%#.1lf", (float)Result.WindSpeed);
    02B36 9040 0663 LDS	R4,Result+53
    02B38 9050 0664 LDS	R5,Result+54
    02B3A 9020 0661 LDS	R2,Result+51
    02B3C 9030 0662 LDS	R3,Result+52
    02B3E 8228      ST	Y,R2
    02B3F 8239      STD	Y+1,R3
    02B40 824A      STD	Y+2,R4
    02B41 825B      STD	Y+3,R5
    02B42 EE25      LDI	R18,0xE5
    02B43 E031      LDI	R19,1
    02B44 E605      LDI	R16,0x65
    02B45 E016      LDI	R17,6
    02B46 940E 5030 CALL	_sprintf
(0343) sprintf(Result.TempChar, "%#.1lf", (float)Result.Temperature); //PrintString_n(Result.TempChar);
    02B48 9040 0659 LDS	R4,Result+43
    02B4A 9050 065A LDS	R5,Result+44
    02B4C 9020 0657 LDS	R2,Result+41
    02B4E 9030 0658 LDS	R3,Result+42
    02B50 8228      ST	Y,R2
    02B51 8239      STD	Y+1,R3
    02B52 824A      STD	Y+2,R4
    02B53 825B      STD	Y+3,R5
    02B54 EE25      LDI	R18,0xE5
    02B55 E031      LDI	R19,1
    02B56 E50B      LDI	R16,0x5B
    02B57 E016      LDI	R17,6
    02B58 940E 5030 CALL	_sprintf
(0344) sprintf(Result.WCIChar, "%#.1lf",  (float)Result.WCI); //PrintString_n(Result.WCIChar);
    02B5A 9040 066C LDS	R4,Result+62
    02B5C 9050 066D LDS	R5,Result+63
    02B5E 9020 066A LDS	R2,Result+60
    02B60 9030 066B LDS	R3,Result+61
    02B62 8228      ST	Y,R2
    02B63 8239      STD	Y+1,R3
    02B64 824A      STD	Y+2,R4
    02B65 825B      STD	Y+3,R5
    02B66 EE25      LDI	R18,0xE5
    02B67 E031      LDI	R19,1
    02B68 E60E      LDI	R16,0x6E
    02B69 E016      LDI	R17,6
    02B6A 940E 5030 CALL	_sprintf
(0345) sprintf(Result.ECTChar, "%#.1lf", (float)Result.ECT);  //PrintString_n(Result.ECTChar);
    02B6C 9040 0678 LDS	R4,Result+74
    02B6E 9050 0679 LDS	R5,Result+75
    02B70 9020 0676 LDS	R2,Result+72
    02B72 9030 0677 LDS	R3,Result+73
    02B74 8228      ST	Y,R2
    02B75 8239      STD	Y+1,R3
    02B76 824A      STD	Y+2,R4
    02B77 825B      STD	Y+3,R5
    02B78 EE25      LDI	R18,0xE5
    02B79 E031      LDI	R19,1
    02B7A E70A      LDI	R16,0x7A
    02B7B E016      LDI	R17,6
    02B7C 940E 5030 CALL	_sprintf
(0346) sprintf(Result.TeqChar, "%#.1lf", (float)Result.Teq);
    02B7E 9040 0682 LDS	R4,Result+84
    02B80 9050 0683 LDS	R5,Result+85
    02B82 9020 0680 LDS	R2,Result+82
    02B84 9030 0681 LDS	R3,Result+83
    02B86 8228      ST	Y,R2
    02B87 8239      STD	Y+1,R3
    02B88 824A      STD	Y+2,R4
    02B89 825B      STD	Y+3,R5
    02B8A EE25      LDI	R18,0xE5
    02B8B E031      LDI	R19,1
    02B8C E804      LDI	R16,0x84
    02B8D E016      LDI	R17,6
    02B8E 940E 5030 CALL	_sprintf
(0347) sprintf(Result.IndexChar, "%d", Result.Index);
    02B90 9040 063A LDS	R4,Result+12
    02B92 9050 063B LDS	R5,Result+13
    02B94 9020 0638 LDS	R2,Result+10
    02B96 9030 0639 LDS	R3,Result+11
    02B98 8228      ST	Y,R2
    02B99 8239      STD	Y+1,R3
    02B9A 824A      STD	Y+2,R4
    02B9B 825B      STD	Y+3,R5
    02B9C EE22      LDI	R18,0xE2
    02B9D E031      LDI	R19,1
    02B9E E30C      LDI	R16,0x3C
    02B9F E016      LDI	R17,6
    02BA0 940E 5030 CALL	_sprintf
(0348) Result.TempChar[6]='\0';
    02BA2 2422      CLR	R2
    02BA3 9220 0661 STS	Result+51,R2
(0349) Result.WSChar[5]='\0';
    02BA5 9220 066A STS	Result+60,R2
(0350) Result.WCIChar[7]='\0';
    02BA7 9220 0675 STS	Result+71,R2
(0351) Result.ECTChar[6]='\0';
    02BA9 9220 0680 STS	Result+82,R2
(0352) Result.TeqChar[6]='\0';
    02BAB 9220 068A STS	Result+92,R2
(0353)  return ;
    02BAD 9624      ADIW	R28,4
    02BAE 940C 4893 JMP	pop_xgset003C
_StructToChar:
  otherbyte            --> Y,+16
  ary                  --> Y,+0
  i                    --> R10
    02BB0 92AA      ST	-Y,R10
    02BB1 9768      SBIW	R28,0x18
(0354) }
(0355) /*
(0356) ////////////////////////////////////////////
(0357) //				字符串转换函数
(0358) //   浮点 到  字符串
(0359) ////////////////////////////////////////////
(0360) void ftochr(float a,char * dest){//float
(0361) char i=0,j=0,lenth;
(0362) int status;
(0363) char *res;
(0364)  res=ftoa(a,&status);  //float to ascii
(0365) lenth=strlen(res);
(0366) 
(0367) for(i=0;i <lenth;i++) 
(0368)        {
(0369) 	   	dest[i]=res[i];
(0370) 
(0371) 		if( res[i]=='.'  ) 
(0372) 			{
(0373) 				dest[i+1]=res[i+1];
(0374) 					dest[i+2]='\0';
(0375) 						return ;    
(0376) 		    }
(0377)  
(0378)  		}
(0379) }
(0380) //////////////////////////////////////////////////////
(0381) //              整型数据变字符串
(0382) //    a  到  dest
(0383) ///////////////////////////////////////////////////////
(0384) void itochr(int a,char * dest){ //int to ascii
(0385) 	 itoa(dest,a,10); 
(0386) }
(0387) */
(0388) //////////////////////////////////////////////////////
(0389) //                  结构体 变字符串
(0390) // 将目前存于结构体的数据转换到Temp_Char中。
(0391) ///////////////////////////////////////////////////////
(0392) void  StructToChar(void)
(0393) { 
(0394)   unsigned char i;
(0395)   char otherbyte[]="0\t0\t0\t0";
    02BB2 EB84      LDI	R24,0xB4
    02BB3 E091      LDI	R25,1
    02BB4 01FE      MOVW	R30,R28
    02BB5 9670      ADIW	R30,0x10
    02BB6 E008      LDI	R16,0x8
    02BB7 E010      LDI	R17,0
    02BB8 93FA      ST	-Y,R31
    02BB9 93EA      ST	-Y,R30
    02BBA 939A      ST	-Y,R25
    02BBB 938A      ST	-Y,R24
    02BBC 940E 4963 CALL	asgnblk
(0396)   char *(ary[])={Result.IndexChar,Result.Date,Result.Time,
    02BBE EB8C      LDI	R24,0xBC
    02BBF E091      LDI	R25,1
    02BC0 01FE      MOVW	R30,R28
    02BC1 E100      LDI	R16,0x10
    02BC2 E010      LDI	R17,0
    02BC3 93FA      ST	-Y,R31
    02BC4 93EA      ST	-Y,R30
    02BC5 939A      ST	-Y,R25
    02BC6 938A      ST	-Y,R24
    02BC7 940E 4963 CALL	asgnblk
(0397)  	  			Result.TempChar,Result.WSChar,Result.WCIChar,Result.ECTChar,
(0398) 				Result.TeqChar
(0399) 			   };  //指向数组首地址的指针
(0400)   //strcat(Temp_Char,Result.Name);
(0401)   for(i=0;i<=80;i++) TempChar[i]='\0';  //清空数组
    02BC9 24AA      CLR	R10
    02BCA C009      RJMP	0x2BD4
    02BCB ED8E      LDI	R24,0xDE
    02BCC E095      LDI	R25,5
    02BCD 2DEA      MOV	R30,R10
    02BCE 27FF      CLR	R31
    02BCF 0FE8      ADD	R30,R24
    02BD0 1FF9      ADC	R31,R25
    02BD1 2422      CLR	R2
    02BD2 8220      ST	Z,R2
    02BD3 94A3      INC	R10
    02BD4 E580      LDI	R24,0x50
    02BD5 158A      CP	R24,R10
    02BD6 F7A0      BCC	0x2BCB
(0402)     for(i=0;i<=7;i++){
    02BD7 24AA      CLR	R10
    02BD8 C014      RJMP	0x2BED
(0403) 		strcat(TempChar,ary[i]);  // 按顺序复制字符串
    02BD9 01CE      MOVW	R24,R28
    02BDA 2DEA      MOV	R30,R10
    02BDB 27FF      CLR	R31
    02BDC 0FEE      LSL	R30
    02BDD 1FFF      ROL	R31
    02BDE 0FE8      ADD	R30,R24
    02BDF 1FF9      ADC	R31,R25
    02BE0 8120      LD	R18,Z
    02BE1 8131      LDD	R19,Z+1
    02BE2 ED0E      LDI	R16,0xDE
    02BE3 E015      LDI	R17,5
    02BE4 940E 4755 CALL	_strcat
(0404) 		strcat(TempChar,tab);     // 字串结尾加上制表符
    02BE6 E02F      LDI	R18,0xF
    02BE7 E031      LDI	R19,1
    02BE8 ED0E      LDI	R16,0xDE
    02BE9 E015      LDI	R17,5
    02BEA 940E 4755 CALL	_strcat
    02BEC 94A3      INC	R10
    02BED E087      LDI	R24,7
    02BEE 158A      CP	R24,R10
    02BEF F748      BCC	0x2BD9
(0405)     }
(0406) 				 
(0407) 				 otherbyte[0]=otherbyte[0]+Result.WeiHai;
    02BF0 9020 068A LDS	R2,Result+92
    02BF2 8838      LDD	R3,Y+16
    02BF3 0C32      ADD	R3,R2
    02BF4 8A38      STD	Y+16,R3
(0408) 				 otherbyte[2]=otherbyte[0]+Result.LowLabor;
    02BF5 9020 068B LDS	R2,Result+93
    02BF7 0C32      ADD	R3,R2
    02BF8 8A3A      STD	Y+18,R3
(0409) 				 otherbyte[4]=otherbyte[0]+Result.MidLabor;
    02BF9 9020 068C LDS	R2,Result+94
    02BFB 8838      LDD	R3,Y+16
    02BFC 0C32      ADD	R3,R2
    02BFD 8A3C      STD	Y+20,R3
(0410) 				 otherbyte[6]=otherbyte[0]+Result.HighLabor;
    02BFE 9020 068D LDS	R2,Result+95
    02C00 8838      LDD	R3,Y+16
    02C01 0C32      ADD	R3,R2
    02C02 8A3E      STD	Y+22,R3
(0411)  
(0412)   strcat(TempChar,otherbyte);  
    02C03 019E      MOVW	R18,R28
    02C04 5F20      SUBI	R18,0xF0
    02C05 4F3F      SBCI	R19,0xFF
    02C06 ED0E      LDI	R16,0xDE
    02C07 E015      LDI	R17,5
    02C08 940E 4755 CALL	_strcat
(0413)   strcat(TempChar,enter);  
    02C0A E122      LDI	R18,0x12
    02C0B E031      LDI	R19,1
    02C0C ED0E      LDI	R16,0xDE
    02C0D E015      LDI	R17,5
    02C0E 940E 4755 CALL	_strcat
(0414)   strcat(TempChar,"\0");
    02C10 EE20      LDI	R18,0xE0
    02C11 E031      LDI	R19,1
    02C12 ED0E      LDI	R16,0xDE
    02C13 E015      LDI	R17,5
    02C14 940E 4755 CALL	_strcat
    02C16 9668      ADIW	R28,0x18
    02C17 90A9      LD	R10,Y+
    02C18 9508      RET
_CharToStruct:
  ary                  --> Y,+0
  j                    --> R12
  p                    --> R10
  q                    --> R20
  buf                  --> R14
    02C19 940E 48B5 CALL	push_xgset30FC
    02C1B 0178      MOVW	R14,R16
    02C1C 9760      SBIW	R28,0x10
(0415) }
(0416) 
(0417) //////////////////////////////////////////////////////
(0418) //               字符串  变  结构体
(0419) // 
(0420) ///////////////////////////////////////////////////////
(0421) void CharToStruct(char *buf)
(0422) {
(0423)   unsigned char j=0;
    02C1D 24CC      CLR	R12
(0424)   unsigned char *p,*q;
(0425)   char *(ary[])={Result.IndexChar,Result.Date,Result.Time,
    02C1E EC8C      LDI	R24,0xCC
    02C1F E091      LDI	R25,1
    02C20 01FE      MOVW	R30,R28
    02C21 E100      LDI	R16,0x10
    02C22 E010      LDI	R17,0
    02C23 93FA      ST	-Y,R31
    02C24 93EA      ST	-Y,R30
    02C25 939A      ST	-Y,R25
    02C26 938A      ST	-Y,R24
    02C27 940E 4963 CALL	asgnblk
(0426)  	  			Result.TempChar,Result.WSChar,Result.WCIChar,Result.ECTChar,
(0427) 				Result.TeqChar
(0428) 			   };  //指向数组首地址的指针
(0429)     p=ary[j];
    02C29 01CE      MOVW	R24,R28
    02C2A 2DEC      MOV	R30,R12
    02C2B 27FF      CLR	R31
    02C2C 0FEE      LSL	R30
    02C2D 1FFF      ROL	R31
    02C2E 0FE8      ADD	R30,R24
    02C2F 1FF9      ADC	R31,R25
    02C30 80A0      LD	R10,Z
    02C31 80B1      LDD	R11,Z+1
(0430) 	q=buf;
    02C32 01A7      MOVW	R20,R14
    02C33 C026      RJMP	0x2C5A
(0431) 	
(0432) 	while(1){
(0433)     if(*q =='\n') {*p='\0'; return;} ;
    02C34 01FA      MOVW	R30,R20
    02C35 8180      LD	R24,Z
    02C36 308A      CPI	R24,0xA
    02C37 F421      BNE	0x2C3C
    02C38 2422      CLR	R2
    02C39 01F5      MOVW	R30,R10
    02C3A 8220      ST	Z,R2
    02C3B C01F      RJMP	0x2C5B
(0434) 	if(*q =='\t') {
    02C3C 01FA      MOVW	R30,R20
    02C3D 8180      LD	R24,Z
    02C3E 3089      CPI	R24,0x9
    02C3F F4A1      BNE	0x2C54
(0435) 		*p='\0';
    02C40 2422      CLR	R2
    02C41 01F5      MOVW	R30,R10
    02C42 8220      ST	Z,R2
(0436) 		q++;
    02C43 5F4F      SUBI	R20,0xFF
    02C44 4F5F      SBCI	R21,0xFF
(0437) 	    if(j>7) break ;
    02C45 E087      LDI	R24,7
    02C46 158C      CP	R24,R12
    02C47 F408      BCC	0x2C49
    02C48 C012      RJMP	0x2C5B
(0438) 		j++;
    02C49 94C3      INC	R12
(0439) 		p=ary[j];
    02C4A 01CE      MOVW	R24,R28
    02C4B 2DEC      MOV	R30,R12
    02C4C 27FF      CLR	R31
    02C4D 0FEE      LSL	R30
    02C4E 1FFF      ROL	R31
    02C4F 0FE8      ADD	R30,R24
    02C50 1FF9      ADC	R31,R25
    02C51 80A0      LD	R10,Z
    02C52 80B1      LDD	R11,Z+1
(0440) 		continue ;
    02C53 C006      RJMP	0x2C5A
(0441) 	}
(0442)     *p++=*q++;
    02C54 01FA      MOVW	R30,R20
    02C55 01D5      MOVW	R26,R10
    02C56 9001      LD	R0,Z+
    02C57 01AF      MOVW	R20,R30
    02C58 920D      ST	X+,R0
    02C59 015D      MOVW	R10,R26
    02C5A CFD9      RJMP	0x2C34
    02C5B 9660      ADIW	R28,0x10
    02C5C 940C 489F JMP	pop_xgset30FC
_get_name:
  i                    --> R20
  filenamep            --> R16
    02C5E 940E 48C8 CALL	push_xgsetF000
(0443) 	}
(0444) 	return ;
(0445) }
(0446)  
(0447)  ////////////////////////////////////////////
(0448) //				根据当前日期获取文件名
(0449) //   
(0450) ////////////////////////////////////////////
(0451) char *get_name( char filenamep[] ){     
(0452) 	  unsigned char i=0;
(0453)  	  for(i=0;i<6;i++) {
    02C60 2744      CLR	R20
    02C61 C00D      RJMP	0x2C6F
(0454) 	  				    *(filenamep+i)=Result.Date[i];
    02C62 E484      LDI	R24,0x44
    02C63 E096      LDI	R25,6
    02C64 2FE4      MOV	R30,R20
    02C65 27FF      CLR	R31
    02C66 0FE8      ADD	R30,R24
    02C67 1FF9      ADC	R31,R25
    02C68 8020      LD	R2,Z
    02C69 2FE4      MOV	R30,R20
    02C6A 27FF      CLR	R31
    02C6B 0FE0      ADD	R30,R16
    02C6C 1FF1      ADC	R31,R17
    02C6D 8220      ST	Z,R2
    02C6E 9543      INC	R20
    02C6F 3046      CPI	R20,6
    02C70 F388      BCS	0x2C62
(0455) 	  				   } 
(0456) 	 	*(filenamep+(i++))='.';
    02C71 2E24      MOV	R2,R20
    02C72 2433      CLR	R3
    02C73 5F4F      SUBI	R20,0xFF
    02C74 2DE2      MOV	R30,R2
    02C75 27FF      CLR	R31
    02C76 0FE0      ADD	R30,R16
    02C77 1FF1      ADC	R31,R17
    02C78 E28E      LDI	R24,0x2E
    02C79 8380      ST	Z,R24
(0457) 		*(filenamep+(i++))='x';
    02C7A 2E24      MOV	R2,R20
    02C7B 2433      CLR	R3
    02C7C 5F4F      SUBI	R20,0xFF
    02C7D 2DE2      MOV	R30,R2
    02C7E 27FF      CLR	R31
    02C7F 0FE0      ADD	R30,R16
    02C80 1FF1      ADC	R31,R17
    02C81 E788      LDI	R24,0x78
    02C82 8380      ST	Z,R24
(0458) 		*(filenamep+(i++))='l';
    02C83 2F64      MOV	R22,R20
    02C84 2777      CLR	R23
    02C85 5F4F      SUBI	R20,0xFF
    02C86 2FE6      MOV	R30,R22
    02C87 27FF      CLR	R31
    02C88 0FE0      ADD	R30,R16
    02C89 1FF1      ADC	R31,R17
    02C8A E68C      LDI	R24,0x6C
    02C8B 8380      ST	Z,R24
(0459) 		*(filenamep+(i++))='s';
    02C8C 2F64      MOV	R22,R20
    02C8D 2777      CLR	R23
    02C8E 5F4F      SUBI	R20,0xFF
    02C8F 2FE6      MOV	R30,R22
    02C90 27FF      CLR	R31
    02C91 0FE0      ADD	R30,R16
    02C92 1FF1      ADC	R31,R17
    02C93 E783      LDI	R24,0x73
    02C94 8380      ST	Z,R24
(0460) 		*(filenamep+(i))='\0';
    02C95 2FE4      MOV	R30,R20
    02C96 27FF      CLR	R31
    02C97 0FE0      ADD	R30,R16
    02C98 1FF1      ADC	R31,R17
    02C99 2422      CLR	R2
    02C9A 8220      ST	Z,R2
(0461) 					   
(0462)       return filenamep;
    02C9B 940C 48CD JMP	pop_xgsetF000
_SquareRootFloat:
  f                    --> Y,+12
  x                    --> Y,+8
  i                    --> Y,+4
  y                    --> Y,+0
  number               --> Y,+20
    02C9D 940E 476E CALL	push_arg4
    02C9F 940E 48C8 CALL	push_xgsetF000
    02CA1 9760      SBIW	R28,0x10
(0463) } 
(0464) float SquareRootFloat(float number)
(0465) {
(0466)     long i;
(0467)     float x, y;
(0468)     const float f = 1.5F;
    02CA2 E902      LDI	R16,0x92
    02CA3 E010      LDI	R17,0
    02CA4 940E 483B CALL	elpm32
    02CA6 870C      STD	Y+12,R16
    02CA7 871D      STD	Y+13,R17
    02CA8 872E      STD	Y+14,R18
    02CA9 873F      STD	Y+15,R19
(0469)     x = number * 0.5F;
    02CAA E80E      LDI	R16,0x8E
    02CAB E010      LDI	R17,0
    02CAC 940E 483B CALL	elpm32
    02CAE 01CE      MOVW	R24,R28
    02CAF 9644      ADIW	R24,0x14
    02CB0 939A      ST	-Y,R25
    02CB1 938A      ST	-Y,R24
    02CB2 940E 4BF9 CALL	fpmule1
    02CB4 8708      STD	Y+8,R16
    02CB5 8719      STD	Y+9,R17
    02CB6 872A      STD	Y+10,R18
    02CB7 873B      STD	Y+11,R19
(0470)     y  = number;
    02CB8 882C      LDD	R2,Y+20
    02CB9 883D      LDD	R3,Y+21
    02CBA 884E      LDD	R4,Y+22
    02CBB 885F      LDD	R5,Y+23
    02CBC 8228      ST	Y,R2
    02CBD 8239      STD	Y+1,R3
    02CBE 824A      STD	Y+2,R4
    02CBF 825B      STD	Y+3,R5
(0471)     i  = * ( long * ) &y;
    02CC0 01FE      MOVW	R30,R28
    02CC1 8020      LD	R2,Z
    02CC2 8031      LDD	R3,Z+1
    02CC3 8042      LDD	R4,Z+2
    02CC4 8053      LDD	R5,Z+3
    02CC5 822C      STD	Y+4,R2
    02CC6 823D      STD	Y+5,R3
    02CC7 824E      STD	Y+6,R4
    02CC8 825F      STD	Y+7,R5
(0472)     i  = 0x5f3759df - ( i >> 1 );  //卡马克
    02CC9 802C      LDD	R2,Y+4
    02CCA 803D      LDD	R3,Y+5
    02CCB 804E      LDD	R4,Y+6
    02CCC 805F      LDD	R5,Y+7
    02CCD 9455      ASR	R5
    02CCE 9447      ROR	R4
    02CCF 9437      ROR	R3
    02CD0 9427      ROR	R2
    02CD1 ED4F      LDI	R20,0xDF
    02CD2 E559      LDI	R21,0x59
    02CD3 E367      LDI	R22,0x37
    02CD4 E57F      LDI	R23,0x5F
    02CD5 1942      SUB	R20,R2
    02CD6 0953      SBC	R21,R3
    02CD7 0964      SBC	R22,R4
    02CD8 0975      SBC	R23,R5
    02CD9 834C      STD	Y+4,R20
    02CDA 835D      STD	Y+5,R21
    02CDB 836E      STD	Y+6,R22
    02CDC 837F      STD	Y+7,R23
(0473)   //i  = 0x5f375a86 - ( i >> 1 );  //Lomont
(0474)     y  = * ( float * ) &i;
    02CDD 01FE      MOVW	R30,R28
    02CDE 9634      ADIW	R30,4
    02CDF 8020      LD	R2,Z
    02CE0 8031      LDD	R3,Z+1
    02CE1 8042      LDD	R4,Z+2
    02CE2 8053      LDD	R5,Z+3
    02CE3 8228      ST	Y,R2
    02CE4 8239      STD	Y+1,R3
    02CE5 824A      STD	Y+2,R4
    02CE6 825B      STD	Y+3,R5
(0475)     y  = y * ( f - ( x * y * y ) );
    02CE7 8028      LD	R2,Y
    02CE8 8039      LDD	R3,Y+1
    02CE9 804A      LDD	R4,Y+2
    02CEA 805B      LDD	R5,Y+3
    02CEB 846C      LDD	R6,Y+12
    02CEC 847D      LDD	R7,Y+13
    02CED 848E      LDD	R8,Y+14
    02CEE 849F      LDD	R9,Y+15
    02CEF 8508      LDD	R16,Y+8
    02CF0 8519      LDD	R17,Y+9
    02CF1 852A      LDD	R18,Y+10
    02CF2 853B      LDD	R19,Y+11
    02CF3 01CE      MOVW	R24,R28
    02CF4 939A      ST	-Y,R25
    02CF5 938A      ST	-Y,R24
    02CF6 940E 4BF9 CALL	fpmule1
    02CF8 01CE      MOVW	R24,R28
    02CF9 939A      ST	-Y,R25
    02CFA 938A      ST	-Y,R24
    02CFB 940E 4C0E CALL	fpmule1x
    02CFD 0183      MOVW	R16,R6
    02CFE 0194      MOVW	R18,R8
    02CFF 940E 4A1C CALL	fpsub2x
    02D01 0181      MOVW	R16,R2
    02D02 0192      MOVW	R18,R4
    02D03 940E 4C03 CALL	fpmule2
    02D05 8308      ST	Y,R16
    02D06 8319      STD	Y+1,R17
    02D07 832A      STD	Y+2,R18
    02D08 833B      STD	Y+3,R19
(0476)     y  = y * ( f - ( x * y * y ) );
    02D09 8028      LD	R2,Y
    02D0A 8039      LDD	R3,Y+1
    02D0B 804A      LDD	R4,Y+2
    02D0C 805B      LDD	R5,Y+3
    02D0D 846C      LDD	R6,Y+12
    02D0E 847D      LDD	R7,Y+13
    02D0F 848E      LDD	R8,Y+14
    02D10 849F      LDD	R9,Y+15
    02D11 8508      LDD	R16,Y+8
    02D12 8519      LDD	R17,Y+9
    02D13 852A      LDD	R18,Y+10
    02D14 853B      LDD	R19,Y+11
    02D15 01CE      MOVW	R24,R28
    02D16 939A      ST	-Y,R25
    02D17 938A      ST	-Y,R24
    02D18 940E 4BF9 CALL	fpmule1
    02D1A 01CE      MOVW	R24,R28
    02D1B 939A      ST	-Y,R25
    02D1C 938A      ST	-Y,R24
    02D1D 940E 4C0E CALL	fpmule1x
    02D1F 0183      MOVW	R16,R6
    02D20 0194      MOVW	R18,R8
    02D21 940E 4A1C CALL	fpsub2x
    02D23 0181      MOVW	R16,R2
    02D24 0192      MOVW	R18,R4
    02D25 940E 4C03 CALL	fpmule2
    02D27 8308      ST	Y,R16
    02D28 8319      STD	Y+1,R17
    02D29 832A      STD	Y+2,R18
    02D2A 833B      STD	Y+3,R19
(0477)     return number * y;
    02D2B 890C      LDD	R16,Y+20
    02D2C 891D      LDD	R17,Y+21
    02D2D 892E      LDD	R18,Y+22
    02D2E 893F      LDD	R19,Y+23
    02D2F 01CE      MOVW	R24,R28
    02D30 939A      ST	-Y,R25
    02D31 938A      ST	-Y,R24
    02D32 940E 4BF9 CALL	fpmule1
    02D34 9660      ADIW	R28,0x10
    02D35 940E 48CD CALL	pop_xgsetF000
    02D37 9624      ADIW	R28,4
    02D38 9508      RET
_debug:
  str2                 --> Y,+0
  val                  --> Y,+6
  str                  --> Y,+4
    02D39 940E 476E CALL	push_arg4
    02D3B 9724      SBIW	R28,4
(0478) } 
(0479) //
(0480) //###############################################################//
(0481) //debug
(0482) void debug(UINT8 *str,UINT8 val)
(0483) {
(0484)  UINT8 str2[4]={0,0,0,0};
    02D3C ED8C      LDI	R24,0xDC
    02D3D E091      LDI	R25,1
    02D3E 01FE      MOVW	R30,R28
    02D3F E004      LDI	R16,4
    02D40 E010      LDI	R17,0
    02D41 93FA      ST	-Y,R31
    02D42 93EA      ST	-Y,R30
    02D43 939A      ST	-Y,R25
    02D44 938A      ST	-Y,R24
    02D45 940E 4963 CALL	asgnblk
(0485)  str=str;
(0486)  val=val;
    02D47 9628      ADIW	R28,0x8
    02D48 9508      RET
_SD_Write_cmd:
  k                    --> R22
  temp                 --> R20
  p                    --> R20
    02D49 940E 48C8 CALL	push_xgsetF000
    02D4B 01A8      MOVW	R20,R16
FILE: D:\LQD\software\software_src\sd.c
(0001) //*****************************************************************************//
(0002) //*								数码相框
(0003) //*控制芯片：ATmgea128
(0004) //*开发环境：AVR Studio+GCC
(0005) //*隶属模块：SD卡控制
(0006) //*修改者：  桃子
(0007) //*****************************************************************************//
(0008) #include "sd.h"
(0009) 
(0010) //****************************************************************
(0011) //*隶属模块：SD卡控制
(0012) //*函数功能：写6字节数据
(0013) //****************************************************************
(0014) UINT8 SD_Write_cmd(UINT8 *p)
(0015) {	
(0016) 	UINT16 temp,k=0;
    02D4C 2766      CLR	R22
    02D4D 2777      CLR	R23
(0017) 	SD_CS_DIS();//禁止SPI
    02D4E 9AC0      SBI	0x18,0
(0018) 	SPI_Read();//空读一字节
    02D4F 940E 3C54 CALL	_SPI_Read
(0019) 	SD_CS_EN();//使能SPI
    02D51 98C0      CBI	0x18,0
(0020) 
(0021) 	SPI_Write(p[0]);
    02D52 01FA      MOVW	R30,R20
    02D53 8100      LD	R16,Z
    02D54 940E 3C50 CALL	_SPI_Write
(0022) 	SPI_Write(p[1]);
    02D56 01FA      MOVW	R30,R20
    02D57 8101      LDD	R16,Z+1
    02D58 940E 3C50 CALL	_SPI_Write
(0023) 	SPI_Write(p[2]);
    02D5A 01FA      MOVW	R30,R20
    02D5B 8102      LDD	R16,Z+2
    02D5C 940E 3C50 CALL	_SPI_Write
(0024) 	SPI_Write(p[3]);
    02D5E 01FA      MOVW	R30,R20
    02D5F 8103      LDD	R16,Z+3
    02D60 940E 3C50 CALL	_SPI_Write
(0025) 	SPI_Write(p[4]);
    02D62 01FA      MOVW	R30,R20
    02D63 8104      LDD	R16,Z+4
    02D64 940E 3C50 CALL	_SPI_Write
(0026) 	SPI_Write(p[5]);
    02D66 01FA      MOVW	R30,R20
    02D67 8105      LDD	R16,Z+5
    02D68 940E 3C50 CALL	_SPI_Write
(0027) 
(0028) 	do 
(0029)  	{  
(0030)   		temp = SPI_Read();//一直读，直到读到的不是0xff或超时
    02D6A 940E 3C54 CALL	_SPI_Read
    02D6C 2F40      MOV	R20,R16
    02D6D 2755      CLR	R21
(0031)  		k++;
    02D6E 5F6F      SUBI	R22,0xFF
    02D6F 4F7F      SBCI	R23,0xFF
(0032)  	}while((temp==0xff)&&(k<TRY_TIME)); 
    02D70 3F4F      CPI	R20,0xFF
    02D71 E0E0      LDI	R30,0
    02D72 075E      CPC	R21,R30
    02D73 F421      BNE	0x2D78
    02D74 3164      CPI	R22,0x14
    02D75 E0E0      LDI	R30,0
    02D76 077E      CPC	R23,R30
    02D77 F390      BCS	0x2D6A
(0033) 
(0034) 	return temp;
    02D78 2F04      MOV	R16,R20
    02D79 940C 48CD JMP	pop_xgsetF000
_SD_Init:
  pcmd                 --> Y,+0
  temp                 --> R22
  time                 --> R20
    02D7B 940E 48D2 CALL	push_xgsetF00C
    02D7D 9726      SBIW	R28,6
(0035) }
(0036) //****************************************************************
(0037) //*隶属模块：SD卡控制
(0038) //*函数功能：初始化
(0039) //****************************************************************
(0040) UINT8 SD_Init(void)	
(0041) {  
(0042) 	UINT8 time=0,temp=0;
    02D7E 2744      CLR	R20
    02D7F 2766      CLR	R22
(0043) 	UINT8 pcmd[] = {0x40,0x00,0x00,0x00,0x00,0x95}; //命令0的字节序列
    02D80 E886      LDI	R24,0x86
    02D81 E092      LDI	R25,2
    02D82 01FE      MOVW	R30,R28
    02D83 E006      LDI	R16,6
    02D84 E010      LDI	R17,0
    02D85 93FA      ST	-Y,R31
    02D86 93EA      ST	-Y,R30
    02D87 939A      ST	-Y,R25
    02D88 938A      ST	-Y,R24
    02D89 940E 4963 CALL	asgnblk
(0044) 	if(SD_DET()==0) return 0x02; //no disk
    02D8B B181      IN	R24,0x01
    02D8C 9586      LSR	R24
    02D8D 9586      LSR	R24
    02D8E 9586      LSR	R24
    02D8F 9586      LSR	R24
    02D90 9586      LSR	R24
    02D91 7081      ANDI	R24,1
    02D92 F421      BNE	0x2D97
    02D93 E081      LDI	R24,1
    02D94 E090      LDI	R25,0
    02D95 015C      MOVW	R10,R24
    02D96 C002      RJMP	0x2D99
    02D97 24AA      CLR	R10
    02D98 24BB      CLR	R11
    02D99 20AA      TST	R10
    02D9A F421      BNE	0x2D9F
    02D9B 20BB      TST	R11
    02D9C F411      BNE	0x2D9F
    02D9D E002      LDI	R16,2
    02D9E C039      RJMP	0x2DD8
(0045) 	SD_PORT |= (1<<SD_CS);
    02D9F 9AC0      SBI	0x18,0
(0046) 	SD_DDR |= (1<<SD_CS);
    02DA0 9AB8      SBI	0x17,0
(0047) 
(0048) 	SPI_IO_Init();
    02DA1 940E 3C46 CALL	_SPI_IO_Init
(0049) 	SPI_Low();
    02DA3 E582      LDI	R24,0x52
    02DA4 B98D      OUT	0x0D,R24
    02DA5 B18E      IN	R24,0x0E
    02DA6 7F8F      ANDI	R24,0xFF
    02DA7 B98E      OUT	0x0E,R24
(0050) 
(0051) 	SD_CS_DIS();  //关闭片选 
    02DA8 9AC0      SBI	0x18,0
(0052) 	for(time=0;time<10;time++) //初始时，首先要发送最少74个时钟信号，这是必须的！！！
    02DA9 2744      CLR	R20
    02DAA C003      RJMP	0x2DAE
(0053) 	{
(0054)   		SPI_Read(); 
    02DAB 940E 3C54 CALL	_SPI_Read
    02DAD 9543      INC	R20
    02DAE 304A      CPI	R20,0xA
    02DAF F3D8      BCS	0x2DAB
(0055) 	}
(0056) 	SD_CS_EN(); //打开片选
    02DB0 98C0      CBI	0x18,0
(0057) 	time = 0;
    02DB1 2744      CLR	R20
(0058) 	do
(0059) 	{ 
(0060) 		temp=SD_Write_cmd(pcmd);//写入CMD0
    02DB2 018E      MOVW	R16,R28
    02DB3 DF95      RCALL	_SD_Write_cmd
    02DB4 2F60      MOV	R22,R16
(0061) 	 	time++;
    02DB5 9543      INC	R20
(0062) 	 	if(time==TRY_TIME) 
    02DB6 3144      CPI	R20,0x14
    02DB7 F419      BNE	0x2DBB
(0063) 	 	{ 
(0064) 	  		SD_CS_DIS(); //关闭片选
    02DB8 9AC0      SBI	0x18,0
(0065) 	  		return(INIT_CMD0_ERROR);//CMD0写入失败
    02DB9 E001      LDI	R16,1
    02DBA C01D      RJMP	0x2DD8
(0066) 	 	}
(0067) 	 }while(temp!=0x01);
    02DBB 3061      CPI	R22,1
    02DBC F7A9      BNE	0x2DB2
(0068) 
(0069) 	SD_CS_DIS(); //关闭片选
    02DBD 9AC0      SBI	0x18,0
(0070) 	SPI_Read(); //按照SD卡的操作时序在这里补8个时钟 
    02DBE 940E 3C54 CALL	_SPI_Read
(0071) 	SD_CS_EN(); //打开片选
    02DC0 98C0      CBI	0x18,0
(0072) 
(0073) 	pcmd[0]=0x41,pcmd[5]=0xff;
    02DC1 E481      LDI	R24,0x41
    02DC2 8388      ST	Y,R24
    02DC3 EF8F      LDI	R24,0xFF
    02DC4 838D      STD	Y+5,R24
(0074) 	time = 0;
    02DC5 2744      CLR	R20
(0075) 	do
(0076) 	{ 
(0077) 		temp=SD_Write_cmd(pcmd);
    02DC6 018E      MOVW	R16,R28
    02DC7 DF81      RCALL	_SD_Write_cmd
    02DC8 2F60      MOV	R22,R16
(0078) 		time++;
    02DC9 9543      INC	R20
(0079) 		if(time==TRY_TIME) 
    02DCA 3144      CPI	R20,0x14
    02DCB F419      BNE	0x2DCF
(0080) 		{ 
(0081) 		 	SD_CS_DIS(); //关闭片选
    02DCC 9AC0      SBI	0x18,0
(0082) 			 return(INIT_CMD1_ERROR);//CMD1写入失败
    02DCD E002      LDI	R16,2
    02DCE C009      RJMP	0x2DD8
(0083) 		 }
(0084) 	 }while(temp!=0);
    02DCF 2366      TST	R22
    02DD0 F7A9      BNE	0x2DC6
(0085)   
(0086) 	 SPI_High();  
    02DD1 E580      LDI	R24,0x50
    02DD2 B98D      OUT	0x0D,R24
    02DD3 9A70      SBI	0x0E,0
(0087) 	 SD_CS_DIS();  //关闭片选 
    02DD4 9AC0      SBI	0x18,0
(0088) 	 SPI_Read(); //按照SD卡的操作时序在这里补8个时钟
    02DD5 940E 3C54 CALL	_SPI_Read
(0089) 	 return SD_TURE; //返回0,说明初始化操作成功
    02DD7 2700      CLR	R16
    02DD8 9626      ADIW	R28,6
    02DD9 940C 48D9 JMP	pop_xgsetF00C
_SD_Write_Sector:
  pcmd                 --> Y,+0
  time                 --> R12
  temp                 --> R20
  i                    --> R22
  buffer               --> R10
  addr                 --> Y,+14
    02DDB 940E 476E CALL	push_arg4
    02DDD 940E 48EE CALL	push_xgsetF03C
    02DDF 9726      SBIW	R28,6
    02DE0 88AA      LDD	R10,Y+18
    02DE1 88BB      LDD	R11,Y+19
(0090) } 
(0091) //****************************************************************
(0092) //*隶属模块：SD卡控制
(0093) //*函数功能：写512字节数据（一扇区字节）
(0094) //****************************************************************
(0095) UINT16 SD_Write_Sector(UINT32 addr,UINT8 *buffer)
(0096) {  
(0097) 	UINT8 temp=0,time=0;
    02DE2 2744      CLR	R20
    02DE3 24CC      CLR	R12
(0098) 	UINT16 i=0;
    02DE4 2766      CLR	R22
    02DE5 2777      CLR	R23
(0099) 	UINT8 pcmd[] = {0x58,0x00,0x00,0x00,0x00,0xff}; //向SD卡中单个块（512字节，一个扇区）写入数据，用CMD24
    02DE6 E88C      LDI	R24,0x8C
    02DE7 E092      LDI	R25,2
    02DE8 01FE      MOVW	R30,R28
    02DE9 E006      LDI	R16,6
    02DEA E010      LDI	R17,0
    02DEB 93FA      ST	-Y,R31
    02DEC 93EA      ST	-Y,R30
    02DED 939A      ST	-Y,R25
    02DEE 938A      ST	-Y,R24
    02DEF 940E 4963 CALL	asgnblk
(0100) 
(0101) 	 addr<<=9; //将块地址（扇区地址）转为字节地址 ［这里就限制了SD卡的最大容量为4G］
    02DF1 E089      LDI	R24,0x9
    02DF2 E090      LDI	R25,0
    02DF3 850E      LDD	R16,Y+14
    02DF4 851F      LDD	R17,Y+15
    02DF5 8928      LDD	R18,Y+16
    02DF6 8939      LDD	R19,Y+17
    02DF7 938A      ST	-Y,R24
    02DF8 940E 493E CALL	lsl32
    02DFA 870E      STD	Y+14,R16
    02DFB 871F      STD	Y+15,R17
    02DFC 8B28      STD	Y+16,R18
    02DFD 8B39      STD	Y+17,R19
(0102) 
(0103) 	 pcmd[1]=(addr>>24); //将字节地址写入到CMD24字节序列中
    02DFE E188      LDI	R24,0x18
    02DFF E090      LDI	R25,0
    02E00 850E      LDD	R16,Y+14
    02E01 851F      LDD	R17,Y+15
    02E02 8928      LDD	R18,Y+16
    02E03 8939      LDD	R19,Y+17
    02E04 938A      ST	-Y,R24
    02E05 940E 4957 CALL	lsr32
    02E07 8309      STD	Y+1,R16
(0104) 	 pcmd[2]=(addr>>16);
    02E08 842E      LDD	R2,Y+14
    02E09 843F      LDD	R3,Y+15
    02E0A 8848      LDD	R4,Y+16
    02E0B 8859      LDD	R5,Y+17
    02E0C 0112      MOVW	R2,R4
    02E0D 2444      CLR	R4
    02E0E 2455      CLR	R5
    02E0F 822A      STD	Y+2,R2
(0105) 	 pcmd[3]=(addr>>8);
    02E10 E088      LDI	R24,0x8
    02E11 E090      LDI	R25,0
    02E12 850E      LDD	R16,Y+14
    02E13 851F      LDD	R17,Y+15
    02E14 8928      LDD	R18,Y+16
    02E15 8939      LDD	R19,Y+17
    02E16 938A      ST	-Y,R24
    02E17 940E 4957 CALL	lsr32
    02E19 830B      STD	Y+3,R16
(0106) 	// pcmd[4]=offset;	
(0107) 	 SD_CS_EN();//打开SD卡片选
    02E1A 98C0      CBI	0x18,0
(0108) 
(0109) 	 do
(0110) 	 {  
(0111) 		temp=SD_Write_cmd(pcmd);
    02E1B 018E      MOVW	R16,R28
    02E1C DF2C      RCALL	_SD_Write_cmd
    02E1D 2F40      MOV	R20,R16
(0112)   		time++;
    02E1E 94C3      INC	R12
(0113)   		if(time==TRY_TIME) 
    02E1F 2D8C      MOV	R24,R12
    02E20 3184      CPI	R24,0x14
    02E21 F419      BNE	0x2E25
(0114)   		{ 
(0115)    			SD_CS_DIS(); //关闭片选
    02E22 9AC0      SBI	0x18,0
(0116)    			return(temp); //命令写入失败
    02E23 2711      CLR	R17
    02E24 C037      RJMP	0x2E5C
(0117)   		}
(0118) 	}while(temp!=0); 
    02E25 2344      TST	R20
    02E26 F7A1      BNE	0x2E1B
(0119) 
(0120) 	for(i=0;i<100;i++) //这里要插入若干时钟信号
    02E27 2766      CLR	R22
    02E28 2777      CLR	R23
    02E29 C004      RJMP	0x2E2E
(0121)   		SPI_Read();
    02E2A 940E 3C54 CALL	_SPI_Read
    02E2C 5F6F      SUBI	R22,0xFF
    02E2D 4F7F      SBCI	R23,0xFF
    02E2E 3664      CPI	R22,0x64
    02E2F E0E0      LDI	R30,0
    02E30 077E      CPC	R23,R30
    02E31 F3C0      BCS	0x2E2A
(0122) 	
(0123) 	SPI_Write(0xfe);//写入开始字节 0xfe，后面就是要写入的512个字节的数据	
    02E32 EF0E      LDI	R16,0xFE
    02E33 940E 3C50 CALL	_SPI_Write
(0124) 	
(0125) 	for(i=0;i<512;i++) //将缓冲区中要写入的512个字节写入SD卡
    02E35 2766      CLR	R22
    02E36 2777      CLR	R23
    02E37 C007      RJMP	0x2E3F
(0126) 		SPI_Write(*buffer++);
    02E38 01F5      MOVW	R30,R10
    02E39 9101      LD	R16,Z+
    02E3A 015F      MOVW	R10,R30
    02E3B 940E 3C50 CALL	_SPI_Write
    02E3D 5F6F      SUBI	R22,0xFF
    02E3E 4F7F      SBCI	R23,0xFF
    02E3F 3060      CPI	R22,0
    02E40 E0E2      LDI	R30,2
    02E41 077E      CPC	R23,R30
    02E42 F3A8      BCS	0x2E38
(0127)   
(0128) 	SPI_Read(); 
    02E43 940E 3C54 CALL	_SPI_Read
(0129) 	SPI_Read(); //两个字节的CRC校验码，不用关心
    02E45 940E 3C54 CALL	_SPI_Read
(0130)    
(0131)     
(0132) 	temp=SPI_Read();   //读取返回值
    02E47 940E 3C54 CALL	_SPI_Read
    02E49 2F40      MOV	R20,R16
(0133) 	if((temp&0x1F)!=0x05) //如果返回值是 XXX00101说明数据已经被SD卡接受了
    02E4A 2F84      MOV	R24,R20
    02E4B 718F      ANDI	R24,0x1F
    02E4C 3085      CPI	R24,5
    02E4D F021      BEQ	0x2E52
(0134) 	{
(0135)  		SD_CS_DIS();
    02E4E 9AC0      SBI	0x18,0
(0136)  		return(WRITE_BLOCK_ERROR); //写块数据失败
    02E4F E003      LDI	R16,3
    02E50 E010      LDI	R17,0
    02E51 C00A      RJMP	0x2E5C
(0137) 	}
(0138)  
(0139) 	while(SPI_Read()!=0xff);//等到SD卡不忙（数据被接受以后，SD卡要将这些数据写入到自身的FLASH中，需要一个时间）
    02E52 940E 3C54 CALL	_SPI_Read
    02E54 2F40      MOV	R20,R16
    02E55 3F0F      CPI	R16,0xFF
    02E56 F7D9      BNE	0x2E52
(0140) 						    //忙时，读回来的值为0x00,不忙时，为0xff
(0141) 
(0142) 	SD_CS_DIS(); //关闭片选
    02E57 9AC0      SBI	0x18,0
(0143) 
(0144) 	SPI_Read();//按照SD卡的操作时序在这里补8个时钟
    02E58 940E 3C54 CALL	_SPI_Read
(0145) 	return SD_TURE;		 //返回0,说明写扇区操作成功
    02E5A 2700      CLR	R16
    02E5B 2711      CLR	R17
    02E5C 9626      ADIW	R28,6
    02E5D 940E 48F7 CALL	pop_xgsetF03C
    02E5F 9624      ADIW	R28,4
    02E60 9508      RET
_SD_Read_Sector:
  pcmd                 --> Y,+0
  temp                 --> R12
  time                 --> R22
  j                    --> R20
  buffer               --> R10
  addr                 --> Y,+14
    02E61 940E 476E CALL	push_arg4
    02E63 940E 48EE CALL	push_xgsetF03C
    02E65 9726      SBIW	R28,6
    02E66 88AA      LDD	R10,Y+18
    02E67 88BB      LDD	R11,Y+19
(0146) } 
(0147) //****************************************************************
(0148) //*隶属模块：SD卡控制
(0149) //*函数功能：读512字节数据（一扇区字节）
(0150) //****************************************************************
(0151) UINT16 SD_Read_Sector(UINT32 addr,UINT8 *buffer)//从SD卡的指定扇区中读出512个字节，使用CMD17（17号命令）
(0152) {
(0153) 
(0154) 	 UINT16 j=0;
    02E68 2744      CLR	R20
    02E69 2755      CLR	R21
(0155) 	 UINT8 time=0,temp=0;
    02E6A 2766      CLR	R22
    02E6B 24CC      CLR	R12
(0156) 	 UINT8 pcmd[]={0x51,0x00,0x00,0x00,0x00,0xff}; //CMD17的字节序列
    02E6C E982      LDI	R24,0x92
    02E6D E092      LDI	R25,2
    02E6E 01FE      MOVW	R30,R28
    02E6F E006      LDI	R16,6
    02E70 E010      LDI	R17,0
    02E71 93FA      ST	-Y,R31
    02E72 93EA      ST	-Y,R30
    02E73 939A      ST	-Y,R25
    02E74 938A      ST	-Y,R24
    02E75 940E 4963 CALL	asgnblk
(0157) 
(0158) 	 addr <<= 9; //将块地址（扇区地址）转为字节地址
    02E77 E089      LDI	R24,0x9
    02E78 E090      LDI	R25,0
    02E79 850E      LDD	R16,Y+14
    02E7A 851F      LDD	R17,Y+15
    02E7B 8928      LDD	R18,Y+16
    02E7C 8939      LDD	R19,Y+17
    02E7D 938A      ST	-Y,R24
    02E7E 940E 493E CALL	lsl32
    02E80 870E      STD	Y+14,R16
    02E81 871F      STD	Y+15,R17
    02E82 8B28      STD	Y+16,R18
    02E83 8B39      STD	Y+17,R19
(0159) 
(0160) 	 pcmd[1] = (addr>>24);//将字节地址写入到CMD17字节序列中
    02E84 E188      LDI	R24,0x18
    02E85 E090      LDI	R25,0
    02E86 850E      LDD	R16,Y+14
    02E87 851F      LDD	R17,Y+15
    02E88 8928      LDD	R18,Y+16
    02E89 8939      LDD	R19,Y+17
    02E8A 938A      ST	-Y,R24
    02E8B 940E 4957 CALL	lsr32
    02E8D 8309      STD	Y+1,R16
(0161) 	 pcmd[2] = (addr>>16);
    02E8E 842E      LDD	R2,Y+14
    02E8F 843F      LDD	R3,Y+15
    02E90 8848      LDD	R4,Y+16
    02E91 8859      LDD	R5,Y+17
    02E92 0112      MOVW	R2,R4
    02E93 2444      CLR	R4
    02E94 2455      CLR	R5
    02E95 822A      STD	Y+2,R2
(0162) 	 pcmd[3] =(addr>>8);
    02E96 E088      LDI	R24,0x8
    02E97 E090      LDI	R25,0
    02E98 850E      LDD	R16,Y+14
    02E99 851F      LDD	R17,Y+15
    02E9A 8928      LDD	R18,Y+16
    02E9B 8939      LDD	R19,Y+17
    02E9C 938A      ST	-Y,R24
    02E9D 940E 4957 CALL	lsr32
    02E9F 830B      STD	Y+3,R16
(0163) 	// pcmd[4] = offset;
(0164) 
(0165) 	 SD_CS_EN();//打开片选 
    02EA0 98C0      CBI	0x18,0
(0166) 
(0167) 	 do
(0168) 	 {  
(0169) 		  temp=SD_Write_cmd(pcmd); //写入CMD17
    02EA1 018E      MOVW	R16,R28
    02EA2 DEA6      RCALL	_SD_Write_cmd
    02EA3 2EC0      MOV	R12,R16
(0170) 		  time++;
    02EA4 9563      INC	R22
(0171) 		  if(time==TRY_TIME) 
    02EA5 3164      CPI	R22,0x14
    02EA6 F421      BNE	0x2EAB
(0172) 		  {
(0173) 		   SD_CS_DIS();
    02EA7 9AC0      SBI	0x18,0
(0174) 		   return(READ_BLOCK_ERROR); //读块失败
    02EA8 E004      LDI	R16,4
    02EA9 E010      LDI	R17,0
    02EAA C01F      RJMP	0x2ECA
(0175) 		  }
(0176) 	 }while(temp!=0); 
    02EAB 20CC      TST	R12
    02EAC F7A1      BNE	0x2EA1
(0177)    			
(0178) 	 while(SPI_Read()!= 0xfe); //一直读，当读到0xfe时，说明后面的是512字节的数据了
    02EAD 940E 3C54 CALL	_SPI_Read
    02EAF 3F0E      CPI	R16,0xFE
    02EB0 F7E1      BNE	0x2EAD
(0179)  		   	   	
(0180) 	 for(j=0;j<512;j++)	 //将数据写入到数据缓冲区中
    02EB1 2744      CLR	R20
    02EB2 2755      CLR	R21
    02EB3 C009      RJMP	0x2EBD
(0181) 	 {	
(0182) 	    buffer[j]=SPI_Read();
    02EB4 940E 3C54 CALL	_SPI_Read
    02EB6 2EC0      MOV	R12,R16
    02EB7 01FA      MOVW	R30,R20
    02EB8 0DEA      ADD	R30,R10
    02EB9 1DFB      ADC	R31,R11
    02EBA 82C0      ST	Z,R12
    02EBB 5F4F      SUBI	R20,0xFF
    02EBC 4F5F      SBCI	R21,0xFF
    02EBD 3040      CPI	R20,0
    02EBE E0E2      LDI	R30,2
    02EBF 075E      CPC	R21,R30
    02EC0 F398      BCS	0x2EB4
(0183) 	 }
(0184) 
(0185) 	 SPI_Read();//读取两个字节的CRC校验码，不用关心它们
    02EC1 940E 3C54 CALL	_SPI_Read
(0186) 	 SPI_Read();
    02EC3 940E 3C54 CALL	_SPI_Read
(0187) 
(0188) 	 SD_CS_DIS();  //SD卡关闭片选 
    02EC5 9AC0      SBI	0x18,0
(0189) 
(0190) 	 SPI_Read();//按照SD卡的操作时序在这里补8个时钟
    02EC6 940E 3C54 CALL	_SPI_Read
(0191) 
(0192) 	 return SD_TURE;
    02EC8 2700      CLR	R16
    02EC9 2711      CLR	R17
    02ECA 9626      ADIW	R28,6
    02ECB 940E 48F7 CALL	pop_xgsetF03C
    02ECD 9624      ADIW	R28,4
    02ECE 9508      RET
_SD_Read_Sector_ndata:
  pcmd                 --> Y,+0
  temp                 --> R12
  time                 --> R22
  j                    --> R20
  len                  --> R14
  offset               --> R10
  buffer               --> Y,+20
  addr                 --> Y,+16
    02ECF 940E 476E CALL	push_arg4
    02ED1 940E 48B3 CALL	push_xgsetF0FC
    02ED3 9726      SBIW	R28,6
    02ED4 88AE      LDD	R10,Y+22
    02ED5 88BF      LDD	R11,Y+23
    02ED6 8CE8      LDD	R14,Y+24
    02ED7 8CF9      LDD	R15,Y+25
(0193) }
(0194) //****************************************************************
(0195) //*隶属模块：SD卡控制
(0196) //*函数功能：写多扇区数据（多扇区字节）
(0197) //****************************************************************
(0198) UINT16 SD_Read_Sector_ndata(UINT32 addr,UINT8 *buffer,UINT16 offset,UINT16 len)//从SD卡的指定扇区中读出512个字节，使用CMD17（17号命令）
(0199) {
(0200) 
(0201) 	 UINT16 j=0;
    02ED8 2744      CLR	R20
    02ED9 2755      CLR	R21
(0202) 	 UINT8 time=0,temp=0;
    02EDA 2766      CLR	R22
    02EDB 24CC      CLR	R12
(0203) 	 UINT8 pcmd[]={0x51,0x00,0x00,0x00,0x00,0xff}; //CMD17的字节序列
    02EDC E988      LDI	R24,0x98
    02EDD E092      LDI	R25,2
    02EDE 01FE      MOVW	R30,R28
    02EDF E006      LDI	R16,6
    02EE0 E010      LDI	R17,0
    02EE1 93FA      ST	-Y,R31
    02EE2 93EA      ST	-Y,R30
    02EE3 939A      ST	-Y,R25
    02EE4 938A      ST	-Y,R24
    02EE5 940E 4963 CALL	asgnblk
(0204) 
(0205) 	 addr <<= 9; //将块地址（扇区地址）转为字节地址
    02EE7 E089      LDI	R24,0x9
    02EE8 E090      LDI	R25,0
    02EE9 8908      LDD	R16,Y+16
    02EEA 8919      LDD	R17,Y+17
    02EEB 892A      LDD	R18,Y+18
    02EEC 893B      LDD	R19,Y+19
    02EED 938A      ST	-Y,R24
    02EEE 940E 493E CALL	lsl32
    02EF0 8B08      STD	Y+16,R16
    02EF1 8B19      STD	Y+17,R17
    02EF2 8B2A      STD	Y+18,R18
    02EF3 8B3B      STD	Y+19,R19
(0206) 
(0207) 	 pcmd[1] = (addr>>24);//将字节地址写入到CMD17字节序列中
    02EF4 E188      LDI	R24,0x18
    02EF5 E090      LDI	R25,0
    02EF6 8908      LDD	R16,Y+16
    02EF7 8919      LDD	R17,Y+17
    02EF8 892A      LDD	R18,Y+18
    02EF9 893B      LDD	R19,Y+19
    02EFA 938A      ST	-Y,R24
    02EFB 940E 4957 CALL	lsr32
    02EFD 8309      STD	Y+1,R16
(0208) 	 pcmd[2] = (addr>>16);
    02EFE 8828      LDD	R2,Y+16
    02EFF 8839      LDD	R3,Y+17
    02F00 884A      LDD	R4,Y+18
    02F01 885B      LDD	R5,Y+19
    02F02 0112      MOVW	R2,R4
    02F03 2444      CLR	R4
    02F04 2455      CLR	R5
    02F05 822A      STD	Y+2,R2
(0209) 	 pcmd[3] =(addr>>8);
    02F06 E088      LDI	R24,0x8
    02F07 E090      LDI	R25,0
    02F08 8908      LDD	R16,Y+16
    02F09 8919      LDD	R17,Y+17
    02F0A 892A      LDD	R18,Y+18
    02F0B 893B      LDD	R19,Y+19
    02F0C 938A      ST	-Y,R24
    02F0D 940E 4957 CALL	lsr32
    02F0F 830B      STD	Y+3,R16
(0210) 	// pcmd[4] = offset;
(0211) 
(0212) 	 SD_CS_EN();//打开片选 
    02F10 98C0      CBI	0x18,0
(0213) 
(0214) 	 do
(0215) 	 {  
(0216) 		  temp=SD_Write_cmd(pcmd); //写入CMD17
    02F11 018E      MOVW	R16,R28
    02F12 DE36      RCALL	_SD_Write_cmd
    02F13 2EC0      MOV	R12,R16
(0217) 		  time++;
    02F14 9563      INC	R22
(0218) 		  if(time==TRY_TIME) 
    02F15 3164      CPI	R22,0x14
    02F16 F421      BNE	0x2F1B
(0219) 		  {
(0220) 		   SD_CS_DIS();
    02F17 9AC0      SBI	0x18,0
(0221) 		   return(READ_BLOCK_ERROR); //读块失败
    02F18 E004      LDI	R16,4
    02F19 E010      LDI	R17,0
    02F1A C034      RJMP	0x2F4F
(0222) 		  }
(0223) 	 }while(temp!=0); 
    02F1B 20CC      TST	R12
    02F1C F7A1      BNE	0x2F11
(0224)    			
(0225) 	 while(SPI_Read()!= 0xfe); //一直读，当读到0xfe时，说明后面的是512字节的数据了
    02F1D 940E 3C54 CALL	_SPI_Read
    02F1F 3F0E      CPI	R16,0xFE
    02F20 F7E1      BNE	0x2F1D
(0226)  		   	   	
(0227) 	 for(j=0;j<offset;j++)	 //将数据写入到数据缓冲区中
    02F21 2744      CLR	R20
    02F22 2755      CLR	R21
    02F23 C004      RJMP	0x2F28
(0228) 	    SPI_Read();
    02F24 940E 3C54 CALL	_SPI_Read
    02F26 5F4F      SUBI	R20,0xFF
    02F27 4F5F      SBCI	R21,0xFF
    02F28 154A      CP	R20,R10
    02F29 055B      CPC	R21,R11
    02F2A F3C8      BCS	0x2F24
(0229) 	 for(;j<offset+len;j++)	 
    02F2B C00B      RJMP	0x2F37
(0230) 		buffer[j]=SPI_Read();
    02F2C 940E 3C54 CALL	_SPI_Read
    02F2E 2F60      MOV	R22,R16
    02F2F 01FA      MOVW	R30,R20
    02F30 880C      LDD	R0,Y+20
    02F31 881D      LDD	R1,Y+21
    02F32 0DE0      ADD	R30,R0
    02F33 1DF1      ADC	R31,R1
    02F34 8360      ST	Z,R22
    02F35 5F4F      SUBI	R20,0xFF
    02F36 4F5F      SBCI	R21,0xFF
    02F37 0115      MOVW	R2,R10
    02F38 0C2E      ADD	R2,R14
    02F39 1C3F      ADC	R3,R15
    02F3A 1542      CP	R20,R2
    02F3B 0553      CPC	R21,R3
    02F3C F378      BCS	0x2F2C
(0231) 	 for(;j<512;j++)	 
    02F3D C004      RJMP	0x2F42
(0232) 		SPI_Read();
    02F3E 940E 3C54 CALL	_SPI_Read
    02F40 5F4F      SUBI	R20,0xFF
    02F41 4F5F      SBCI	R21,0xFF
    02F42 3040      CPI	R20,0
    02F43 E0E2      LDI	R30,2
    02F44 075E      CPC	R21,R30
    02F45 F3C0      BCS	0x2F3E
(0233) 
(0234) 	 SPI_Read();//读取两个字节的CRC校验码，不用关心它们
    02F46 940E 3C54 CALL	_SPI_Read
(0235) 	 SPI_Read();
    02F48 940E 3C54 CALL	_SPI_Read
(0236) 
(0237) 	 SD_CS_DIS();  //SD卡关闭片选 
    02F4A 9AC0      SBI	0x18,0
(0238) 
(0239) 	 SPI_Read();//按照SD卡的操作时序在这里补8个时钟
    02F4B 940E 3C54 CALL	_SPI_Read
(0240) 
(0241) 	 return SD_TURE;
    02F4D 2700      CLR	R16
    02F4E 2711      CLR	R17
    02F4F 9626      ADIW	R28,6
    02F50 940E 48A8 CALL	pop_xgsetF0FC
    02F52 9624      ADIW	R28,4
    02F53 9508      RET
_GUI_mainmeu:
  key                  --> R22
  select               --> R20
    02F54 940E 48D2 CALL	push_xgsetF00C
    02F56 9723      SBIW	R28,3
FILE: D:\LQD\software\software_src\gui.c
(0001) #include "config.h"
(0002) const char labelH[]="高强度作业：\0";
(0003) const char labelM[]="中等强度作业：\0";
(0004) const char labelL[]="低强度作业：\0";
(0005) const char H01[]="加强劳动监督；\0";
(0006) const char H02[]="增加饮水;\0" ;
(0007) const char H03[]="保持干燥禁裸露。\0";
(0008) #define M01 H01
(0009) #define M02 H03
(0010) const char M03[]="戴面罩。\0";
(0011) const char M04[]="禁油彩。\0";
(0012) #define L01 M03
(0013) #define L02 M04
(0014) const char L03[]="缩短作业时间。";
(0015) //-----//
(0016) #define H11 M04
(0017) #define H12 H03
(0018) const char H13[]="休息注意保暖。\0";
(0019) #define M11 H01
(0020) const char M12[]="减少非必须作业；\0";
(0021) const char M13[]="劳动时间<30min。\0";
(0022) const char L11[]="取消非必须的作业\0";
(0023) const char L12[]="劳动时间<15min；\0";
(0024) #define L13 H03
(0025) //-----//
(0026) #define H21 L11
(0027) #define H22 L12
(0028) #define H23 H03
(0029) const char M21[]="取消户外作业。"; 
(0030) #define L21 M21
(0031) const char str_blank[]="----------------"; 
(0032) //#define LEDON   PORTC&=~(1<<7)					   
(0033) //#define LEDOFF  PINC|=(1<<7)
(0034) char GUI_date[17]="09月19日18:00:00\0";
(0035) 
(0036) // 主菜单
(0037) unsigned char GUI_mainmeu( void ){
(0038)  	unsigned char key=0; //init= nokey
    02F57 2766      CLR	R22
(0039) 	unsigned char select=3;
    02F58 E043      LDI	R20,3
(0040) 	LCD_CLR();
    02F59 940E 3D34 CALL	_LCD_CLR
(0041) 	
(0042)  	Set_White(1,1,8,1);
    02F5B E081      LDI	R24,1
    02F5C 838A      STD	Y+2,R24
    02F5D E088      LDI	R24,0x8
    02F5E 8388      ST	Y,R24
    02F5F E021      LDI	R18,1
    02F60 E001      LDI	R16,1
    02F61 940E 3DBE CALL	_Set_White
(0043) 	Set_White(1,2,8,1);
    02F63 E081      LDI	R24,1
    02F64 838A      STD	Y+2,R24
    02F65 E088      LDI	R24,0x8
    02F66 8388      ST	Y,R24
    02F67 E022      LDI	R18,2
    02F68 E001      LDI	R16,1
    02F69 940E 3DBE CALL	_Set_White
(0044) 	Set_White(1,3,8,1);
    02F6B E081      LDI	R24,1
    02F6C 838A      STD	Y+2,R24
    02F6D E088      LDI	R24,0x8
    02F6E 8388      ST	Y,R24
    02F6F E023      LDI	R18,3
    02F70 E001      LDI	R16,1
    02F71 940E 3DBE CALL	_Set_White
(0045) 	Set_White(1,4,8,1);
    02F73 E081      LDI	R24,1
    02F74 838A      STD	Y+2,R24
    02F75 E088      LDI	R24,0x8
    02F76 8388      ST	Y,R24
    02F77 E024      LDI	R18,4
    02F78 E001      LDI	R16,1
    02F79 940E 3DBE CALL	_Set_White
(0046) 	dateRefresh(1); //更新系统时间
    02F7B E001      LDI	R16,1
    02F7C 940E 3927 CALL	_dateRefresh
(0047) 	LCD_const_disp(1,1,GUI_get_date()); //显示时间
    02F7E D565      RCALL	_GUI_get_date
    02F7F 8319      STD	Y+1,R17
    02F80 8308      ST	Y,R16
    02F81 E021      LDI	R18,1
    02F82 E001      LDI	R16,1
    02F83 940E 3C8E CALL	_LCD_const_disp
(0048) 	LCD_const_disp(2,1,"  检测  时钟调整");
    02F85 EA83      LDI	R24,0xA3
    02F86 E095      LDI	R25,5
    02F87 8399      STD	Y+1,R25
    02F88 8388      ST	Y,R24
    02F89 E021      LDI	R18,1
    02F8A E002      LDI	R16,2
    02F8B 940E 3C8E CALL	_LCD_const_disp
(0049) 	LCD_const_disp(3,1,"  查询  数据传输");
    02F8D E982      LDI	R24,0x92
    02F8E E095      LDI	R25,5
    02F8F 8399      STD	Y+1,R25
    02F90 8388      ST	Y,R24
    02F91 E021      LDI	R18,1
    02F92 E003      LDI	R16,3
    02F93 940E 3C8E CALL	_LCD_const_disp
(0050) 	LCD_const_disp(4,1,"  初始化");
    02F95 E889      LDI	R24,0x89
    02F96 E095      LDI	R25,5
    02F97 8399      STD	Y+1,R25
    02F98 8388      ST	Y,R24
    02F99 E021      LDI	R18,1
    02F9A E004      LDI	R16,4
    02F9B 940E 3C8E CALL	_LCD_const_disp
(0051) 	Set_White(1,1,8,1);
    02F9D E081      LDI	R24,1
    02F9E 838A      STD	Y+2,R24
    02F9F E088      LDI	R24,0x8
    02FA0 8388      ST	Y,R24
    02FA1 E021      LDI	R18,1
    02FA2 E001      LDI	R16,1
    02FA3 940E 3DBE CALL	_Set_White
(0052) 	Set_White(1,2,8,1);
    02FA5 E081      LDI	R24,1
    02FA6 838A      STD	Y+2,R24
    02FA7 E088      LDI	R24,0x8
    02FA8 8388      ST	Y,R24
    02FA9 E022      LDI	R18,2
    02FAA E001      LDI	R16,1
    02FAB 940E 3DBE CALL	_Set_White
(0053) 	Set_White(1,3,8,1);
    02FAD E081      LDI	R24,1
    02FAE 838A      STD	Y+2,R24
    02FAF E088      LDI	R24,0x8
    02FB0 8388      ST	Y,R24
    02FB1 E023      LDI	R18,3
    02FB2 E001      LDI	R16,1
    02FB3 940E 3DBE CALL	_Set_White
(0054) 	Set_White(1,4,8,1);
    02FB5 E081      LDI	R24,1
    02FB6 838A      STD	Y+2,R24
    02FB7 E088      LDI	R24,0x8
    02FB8 8388      ST	Y,R24
    02FB9 E024      LDI	R18,4
    02FBA E001      LDI	R16,1
    02FBB 940E 3DBE CALL	_Set_White
(0055) 	set_white_n(select,0);
    02FBD 2722      CLR	R18
    02FBE 2F04      MOV	R16,R20
    02FBF 940E 3E50 CALL	_set_white_n
    02FC1 C07F      RJMP	0x3041
(0056) 	while(1)
(0057) 	{
(0058) 	 	key=kbscan();
    02FC2 940E 4294 CALL	_kbscan
    02FC4 2F60      MOV	R22,R16
(0059) 		dateRefresh(1); //更新系统时间
    02FC5 E001      LDI	R16,1
    02FC6 940E 3927 CALL	_dateRefresh
(0060) 		heaterSwitch();
    02FC8 940E 25EB CALL	_heaterSwitch
(0061) 		LCD_const_disp(1,1,GUI_get_date()); //显示时间
    02FCA D519      RCALL	_GUI_get_date
    02FCB 0158      MOVW	R10,R16
    02FCC 82B9      STD	Y+1,R11
    02FCD 82A8      ST	Y,R10
    02FCE E021      LDI	R18,1
    02FCF E001      LDI	R16,1
    02FD0 940E 3C8E CALL	_LCD_const_disp
(0062) 		if((select>3) && ( key==up ) ){
    02FD2 E083      LDI	R24,3
    02FD3 1784      CP	R24,R20
    02FD4 F4F8      BCC	0x2FF4
    02FD5 316E      CPI	R22,0x1E
    02FD6 F4E9      BNE	0x2FF4
(0063) 		 Set_White(1,2,8,1);
    02FD7 E081      LDI	R24,1
    02FD8 838A      STD	Y+2,R24
    02FD9 E088      LDI	R24,0x8
    02FDA 8388      ST	Y,R24
    02FDB E022      LDI	R18,2
    02FDC E001      LDI	R16,1
    02FDD 940E 3DBE CALL	_Set_White
(0064) 		 Set_White(1,3,8,1);
    02FDF E081      LDI	R24,1
    02FE0 838A      STD	Y+2,R24
    02FE1 E088      LDI	R24,0x8
    02FE2 8388      ST	Y,R24
    02FE3 E023      LDI	R18,3
    02FE4 E001      LDI	R16,1
    02FE5 940E 3DBE CALL	_Set_White
(0065) 		 Set_White(1,4,8,1);
    02FE7 E081      LDI	R24,1
    02FE8 838A      STD	Y+2,R24
    02FE9 E088      LDI	R24,0x8
    02FEA 8388      ST	Y,R24
    02FEB E024      LDI	R18,4
    02FEC E001      LDI	R16,1
    02FED 940E 3DBE CALL	_Set_White
(0066) 		 select--;
    02FEF 954A      DEC	R20
(0067) 		 set_white_n(select,0);
    02FF0 2722      CLR	R18
    02FF1 2F04      MOV	R16,R20
    02FF2 940E 3E50 CALL	_set_white_n
(0068) 		}
(0069) 		if((select<7) && ( key==down ) ){
    02FF4 3047      CPI	R20,7
    02FF5 F538      BCC	0x301D
    02FF6 316D      CPI	R22,0x1D
    02FF7 F529      BNE	0x301D
(0070) 		 Set_White(1,1,8,1);
    02FF8 E081      LDI	R24,1
    02FF9 838A      STD	Y+2,R24
    02FFA E088      LDI	R24,0x8
    02FFB 8388      ST	Y,R24
    02FFC E021      LDI	R18,1
    02FFD E001      LDI	R16,1
    02FFE 940E 3DBE CALL	_Set_White
(0071) 		 Set_White(1,2,8,1);
    03000 E081      LDI	R24,1
    03001 838A      STD	Y+2,R24
    03002 E088      LDI	R24,0x8
    03003 8388      ST	Y,R24
    03004 E022      LDI	R18,2
    03005 E001      LDI	R16,1
    03006 940E 3DBE CALL	_Set_White
(0072) 		 Set_White(1,3,8,1);
    03008 E081      LDI	R24,1
    03009 838A      STD	Y+2,R24
    0300A E088      LDI	R24,0x8
    0300B 8388      ST	Y,R24
    0300C E023      LDI	R18,3
    0300D E001      LDI	R16,1
    0300E 940E 3DBE CALL	_Set_White
(0073) 		 Set_White(1,4,8,1);
    03010 E081      LDI	R24,1
    03011 838A      STD	Y+2,R24
    03012 E088      LDI	R24,0x8
    03013 8388      ST	Y,R24
    03014 E024      LDI	R18,4
    03015 E001      LDI	R16,1
    03016 940E 3DBE CALL	_Set_White
(0074) 		 select++;
    03018 9543      INC	R20
(0075) 		 set_white_n(select,0);
    03019 2722      CLR	R18
    0301A 2F04      MOV	R16,R20
    0301B 940E 3E50 CALL	_set_white_n
(0076) 		}
(0077) 		if(key == left ){
    0301D 316B      CPI	R22,0x1B
    0301E F511      BNE	0x3041
(0078) 		 Set_White(1,1,8,1);
    0301F E081      LDI	R24,1
    03020 838A      STD	Y+2,R24
    03021 E088      LDI	R24,0x8
    03022 8388      ST	Y,R24
    03023 E021      LDI	R18,1
    03024 E001      LDI	R16,1
    03025 940E 3DBE CALL	_Set_White
(0079) 		 Set_White(1,2,8,1);
    03027 E081      LDI	R24,1
    03028 838A      STD	Y+2,R24
    03029 E088      LDI	R24,0x8
    0302A 8388      ST	Y,R24
    0302B E022      LDI	R18,2
    0302C E001      LDI	R16,1
    0302D 940E 3DBE CALL	_Set_White
(0080) 		 Set_White(1,3,8,1);
    0302F E081      LDI	R24,1
    03030 838A      STD	Y+2,R24
    03031 E088      LDI	R24,0x8
    03032 8388      ST	Y,R24
    03033 E023      LDI	R18,3
    03034 E001      LDI	R16,1
    03035 940E 3DBE CALL	_Set_White
(0081) 		 Set_White(1,4,8,1);
    03037 E081      LDI	R24,1
    03038 838A      STD	Y+2,R24
    03039 E088      LDI	R24,0x8
    0303A 8388      ST	Y,R24
    0303B E024      LDI	R18,4
    0303C E001      LDI	R16,1
    0303D 940E 3DBE CALL	_Set_White
(0082) 		 //beep(3,select);
(0083) 		 return select;
    0303F 2F04      MOV	R16,R20
    03040 C001      RJMP	0x3042
    03041 CF80      RJMP	0x2FC2
    03042 9623      ADIW	R28,3
    03043 940C 48D9 JMP	pop_xgsetF00C
_GUI_check:
  windcounter          --> R10
  next_step_time       --> Y,+3
  selectCheckMode      --> R14
  is_on                --> Y,+8
  page                 --> Y,+7
  key                  --> R12
    03045 940E 48B3 CALL	push_xgsetF0FC
    03047 9729      SBIW	R28,0x9
(0084) 		}
(0085)     }
(0086) 	return 0xff; //error
(0087) 	
(0088) }
(0089) 
(0090) //”检测 “菜单
(0091) void GUI_check(void){
(0092)     char key;
(0093) 	char page=0,is_on=0;
    03048 2400      CLR	R0
    03049 820F      STD	Y+7,R0
    0304A 8608      STD	Y+8,R0
(0094) 	char windcounter=0;
    0304B 24AA      CLR	R10
(0095) 	unsigned long next_step_time=0;
    0304C E080      LDI	R24,0
    0304D 838B      STD	Y+3,R24
    0304E 838C      STD	Y+4,R24
    0304F 838D      STD	Y+5,R24
    03050 838E      STD	Y+6,R24
(0096) 	char selectCheckMode=config.autocheck; //自动检测开关
    03051 90E0 08B0 LDS	R14,config+16
(0097) RE_IN:
(0098) 	key=0;
    03053 24CC      CLR	R12
(0099) 	page=0;
    03054 2400      CLR	R0
    03055 820F      STD	Y+7,R0
(0100) 	is_on=0;
    03056 8608      STD	Y+8,R0
(0101) 	windcounter=0;
    03057 24AA      CLR	R10
(0102) 	next_step_time=0;
    03058 E080      LDI	R24,0
    03059 838B      STD	Y+3,R24
    0305A 838C      STD	Y+4,R24
    0305B 838D      STD	Y+5,R24
    0305C 838E      STD	Y+6,R24
(0103) 	
(0104) 	dateRefresh(1);
    0305D E001      LDI	R16,1
    0305E 940E 3927 CALL	_dateRefresh
(0105) 	LCD_CLR();
    03060 940E 3D34 CALL	_LCD_CLR
(0106) 	LCD_const_disp(1,1,"菜单/ 检测");
    03062 E78E      LDI	R24,0x7E
    03063 E095      LDI	R25,5
    03064 8399      STD	Y+1,R25
    03065 8388      ST	Y,R24
    03066 E021      LDI	R18,1
    03067 E001      LDI	R16,1
    03068 940E 3C8E CALL	_LCD_const_disp
(0107) 	LCD_const_disp(2,3,"自动");		 
    0306A E789      LDI	R24,0x79
    0306B E095      LDI	R25,5
    0306C 8399      STD	Y+1,R25
    0306D 8388      ST	Y,R24
    0306E E023      LDI	R18,3
    0306F E002      LDI	R16,2
    03070 940E 3C8E CALL	_LCD_const_disp
(0108) 	LCD_const_disp(3,3,"手动");
    03072 E784      LDI	R24,0x74
    03073 E095      LDI	R25,5
    03074 8399      STD	Y+1,R25
    03075 8388      ST	Y,R24
    03076 E023      LDI	R18,3
    03077 E003      LDI	R16,3
    03078 940E 3C8E CALL	_LCD_const_disp
(0109) 	if(selectCheckMode==1) {
    0307A 2D8E      MOV	R24,R14
    0307B 3081      CPI	R24,1
    0307C F489      BNE	0x308E
(0110) 	    Set_White(1,2,8,0);
    0307D 2422      CLR	R2
    0307E 822A      STD	Y+2,R2
    0307F E088      LDI	R24,0x8
    03080 8388      ST	Y,R24
    03081 E022      LDI	R18,2
    03082 E001      LDI	R16,1
    03083 940E 3DBE CALL	_Set_White
(0111) 		Set_White(1,3,8,1);
    03085 E081      LDI	R24,1
    03086 838A      STD	Y+2,R24
    03087 E088      LDI	R24,0x8
    03088 8388      ST	Y,R24
    03089 E023      LDI	R18,3
    0308A E001      LDI	R16,1
    0308B 940E 3DBE CALL	_Set_White
(0112) 	}
    0308D C060      RJMP	0x30EE
(0113) 	else {
(0114) 		 Set_White(1,2,8,1);
    0308E E081      LDI	R24,1
    0308F 838A      STD	Y+2,R24
    03090 E088      LDI	R24,0x8
    03091 8388      ST	Y,R24
    03092 E022      LDI	R18,2
    03093 E001      LDI	R16,1
    03094 940E 3DBE CALL	_Set_White
(0115) 		 Set_White(1,3,8,0);
    03096 2422      CLR	R2
    03097 822A      STD	Y+2,R2
    03098 E088      LDI	R24,0x8
    03099 8388      ST	Y,R24
    0309A E023      LDI	R18,3
    0309B E001      LDI	R16,1
    0309C 940E 3DBE CALL	_Set_White
(0116) 	}
    0309E C04F      RJMP	0x30EE
(0117) 	
(0118) //<<菜单/检测/手（自）动>>
(0119) 	while(1){
(0120) 	 	key=kbscan();
    0309F 940E 4294 CALL	_kbscan
    030A1 2EC0      MOV	R12,R16
(0121) 		heaterSwitch();
    030A2 940E 25EB CALL	_heaterSwitch
(0122) 		dateRefresh(0); //只刷新后台时间
    030A4 2700      CLR	R16
    030A5 940E 3927 CALL	_dateRefresh
(0123) 		//上键短按 选择
(0124) 		if(key==up || key ==down){
    030A7 2D8C      MOV	R24,R12
    030A8 318E      CPI	R24,0x1E
    030A9 F011      BEQ	0x30AC
    030AA 318D      CPI	R24,0x1D
    030AB F539      BNE	0x30D3
(0125) 		    if(selectCheckMode >0){
    030AC E080      LDI	R24,0
    030AD 158E      CP	R24,R14
    030AE F490      BCC	0x30C1
(0126) 			    selectCheckMode=0;
    030AF 24EE      CLR	R14
(0127) 				Set_White(1,2,8,1);
    030B0 E081      LDI	R24,1
    030B1 838A      STD	Y+2,R24
    030B2 E088      LDI	R24,0x8
    030B3 8388      ST	Y,R24
    030B4 E022      LDI	R18,2
    030B5 E001      LDI	R16,1
    030B6 940E 3DBE CALL	_Set_White
(0128) 	 			Set_White(1,3,8,0);
    030B8 2422      CLR	R2
    030B9 822A      STD	Y+2,R2
    030BA E088      LDI	R24,0x8
    030BB 8388      ST	Y,R24
    030BC E023      LDI	R18,3
    030BD E001      LDI	R16,1
    030BE 940E 3DBE CALL	_Set_White
(0129) 			}
    030C0 C012      RJMP	0x30D3
(0130) 			else {
(0131) 			    selectCheckMode=1;
    030C1 24EE      CLR	R14
    030C2 94E3      INC	R14
(0132) 				Set_White(1,2,8,0);
    030C3 2422      CLR	R2
    030C4 822A      STD	Y+2,R2
    030C5 E088      LDI	R24,0x8
    030C6 8388      ST	Y,R24
    030C7 E022      LDI	R18,2
    030C8 E001      LDI	R16,1
    030C9 940E 3DBE CALL	_Set_White
(0133) 	 			Set_White(1,3,8,1);
    030CB E081      LDI	R24,1
    030CC 838A      STD	Y+2,R24
    030CD E088      LDI	R24,0x8
    030CE 8388      ST	Y,R24
    030CF E023      LDI	R18,3
    030D0 E001      LDI	R16,1
    030D1 940E 3DBE CALL	_Set_White
(0134) 			}
(0135) 			
(0136) 		}
(0137) 		//左键短按  进入
(0138) 		if(key == left) {
    030D3 2D8C      MOV	R24,R12
    030D4 318B      CPI	R24,0x1B
    030D5 F499      BNE	0x30E9
(0139) 			config.autocheck=selectCheckMode; 
    030D6 92E0 08B0 STS	config+16,R14
(0140) 			Set_White(1,2,8,1);
    030D8 E081      LDI	R24,1
    030D9 838A      STD	Y+2,R24
    030DA E088      LDI	R24,0x8
    030DB 8388      ST	Y,R24
    030DC E022      LDI	R18,2
    030DD E001      LDI	R16,1
    030DE 940E 3DBE CALL	_Set_White
(0141) 	 		Set_White(1,3,8,1); 
    030E0 E081      LDI	R24,1
    030E1 838A      STD	Y+2,R24
    030E2 E088      LDI	R24,0x8
    030E3 8388      ST	Y,R24
    030E4 E023      LDI	R18,3
    030E5 E001      LDI	R16,1
    030E6 940E 3DBE CALL	_Set_White
(0142) 			break ;		
    030E8 C006      RJMP	0x30EF
(0143) 		}
(0144) 		//右键短按  返回
(0145) 		if(key == right) {
    030E9 2D8C      MOV	R24,R12
    030EA 3187      CPI	R24,0x17
    030EB F409      BNE	0x30ED
(0146) 			return ;		
    030EC C1E8      RJMP	0x32D5
(0147) 		}
(0148) 		key=0;
    030ED 24CC      CLR	R12
    030EE CFB0      RJMP	0x309F
(0149) 	} //end of while
(0150)     //自动开启检测
(0151) 	dateRefresh(0);
    030EF 2700      CLR	R16
    030F0 940E 3927 CALL	_dateRefresh
(0152) 	is_on =1 ;
    030F2 2400      CLR	R0
    030F3 9403      INC	R0
    030F4 8608      STD	Y+8,R0
(0153) 	config.time1=config.now+config.THRESHOLD_delta_sec;
    030F5 9040 08A6 LDS	R4,config+6
    030F7 9050 08A7 LDS	R5,config+7
    030F9 9020 08A4 LDS	R2,config+4
    030FB 9030 08A5 LDS	R3,config+5
    030FD 9080 08AE LDS	R8,config+14
    030FF 9090 08AF LDS	R9,config+15
    03101 9060 08AC LDS	R6,config+12
    03103 9070 08AD LDS	R7,config+13
    03105 0C62      ADD	R6,R2
    03106 1C73      ADC	R7,R3
    03107 1C84      ADC	R8,R4
    03108 1C95      ADC	R9,R5
    03109 9270 08A9 STS	config+9,R7
    0310B 9260 08A8 STS	config+8,R6
    0310D 9290 08AB STS	config+11,R9
    0310F 9280 08AA STS	config+10,R8
(0154) 	Result.TempChar[0]=0; //清除上次结果
    03111 2422      CLR	R2
    03112 9220 065B STS	Result+45,R2
(0155) 	Result.WSChar[0]=0;
    03114 9220 0665 STS	Result+55,R2
    03116 C1BD      RJMP	0x32D4
(0156) 	while(1){
(0157) 		key=kbscan();
    03117 940E 4294 CALL	_kbscan
    03119 2EC0      MOV	R12,R16
(0158) 		heaterSwitch();
    0311A 940E 25EB CALL	_heaterSwitch
(0159) 		dateRefresh(0); //只刷新后台时间
    0311C 2700      CLR	R16
    0311D 940E 3927 CALL	_dateRefresh
(0160) 		if(key != 0) beep(0,1);
    0311F 20CC      TST	R12
    03120 F021      BEQ	0x3125
    03121 E021      LDI	R18,1
    03122 2700      CLR	R16
    03123 940E 400B CALL	_beep
(0161) 		if(key==right){	//右键 退出
    03125 2D8C      MOV	R24,R12
    03126 3187      CPI	R24,0x17
    03127 F569      BNE	0x3155
(0162) 		    is_on=0;
    03128 2400      CLR	R0
    03129 8608      STD	Y+8,R0
(0163) 			LCD_CLR();
    0312A 940E 3D34 CALL	_LCD_CLR
(0164) 		 	LCD_Init();	  
    0312C 940E 3D02 CALL	_LCD_Init
(0165) 	 	 	LCD_const_disp(4,5,"退出    "); 
    0312E E68B      LDI	R24,0x6B
    0312F E095      LDI	R25,5
    03130 8399      STD	Y+1,R25
    03131 8388      ST	Y,R24
    03132 E025      LDI	R18,5
    03133 E004      LDI	R16,4
    03134 940E 3C8E CALL	_LCD_const_disp
(0166) 		 	delayms(200);
    03136 EC08      LDI	R16,0xC8
    03137 E010      LDI	R17,0
    03138 940E 2532 CALL	_delayms
(0167) 		 	LCD_const_disp(4,7,".."); 
    0313A E688      LDI	R24,0x68
    0313B E095      LDI	R25,5
    0313C 8399      STD	Y+1,R25
    0313D 8388      ST	Y,R24
    0313E E027      LDI	R18,7
    0313F E004      LDI	R16,4
    03140 940E 3C8E CALL	_LCD_const_disp
(0168) 		 	delayms(200);
    03142 EC08      LDI	R16,0xC8
    03143 E010      LDI	R17,0
    03144 940E 2532 CALL	_delayms
(0169) 		 	LCD_const_disp(4,8,".."); 	
    03146 E688      LDI	R24,0x68
    03147 E095      LDI	R25,5
    03148 8399      STD	Y+1,R25
    03149 8388      ST	Y,R24
    0314A E028      LDI	R18,0x8
    0314B E004      LDI	R16,4
    0314C 940E 3C8E CALL	_LCD_const_disp
(0170) 		 	delayms(500);
    0314E EF04      LDI	R16,0xF4
    0314F E011      LDI	R17,1
    03150 940E 2532 CALL	_delayms
(0171) 		 	LCD_CLR();
    03152 940E 3D34 CALL	_LCD_CLR
(0172) 		 	goto RE_IN;
    03154 CEFE      RJMP	0x3053
(0173) 		}
(0174) 		if(is_on==1){ 
    03155 8588      LDD	R24,Y+8
    03156 3081      CPI	R24,1
    03157 F009      BEQ	0x3159
    03158 C097      RJMP	0x31F0
(0175) 			dateRefresh(1); //更新时间
    03159 E001      LDI	R16,1
    0315A D7CC      RCALL	_dateRefresh
(0176) 		    _GUI_datashow(page); 
    0315B 810F      LDD	R16,Y+7
    0315C D17B      RCALL	__GUI_datashow
(0177) 		    if(config.now < config.time1) {
    0315D 9040 08AA LDS	R4,config+10
    0315F 9050 08AB LDS	R5,config+11
    03161 9020 08A8 LDS	R2,config+8
    03163 9030 08A9 LDS	R3,config+9
    03165 9080 08AE LDS	R8,config+14
    03167 9090 08AF LDS	R9,config+15
    03169 9060 08AC LDS	R6,config+12
    0316B 9070 08AD LDS	R7,config+13
    0316D 1462      CP	R6,R2
    0316E 0473      CPC	R7,R3
    0316F 0484      CPC	R8,R4
    03170 0495      CPC	R9,R5
    03171 F598      BCC	0x31A5
(0178) 				//时间更新 开启风速检测 等待检测 不支持翻页
(0179) 				if(windcounter==0){
    03172 20AA      TST	R10
    03173 F421      BNE	0x3178
(0180) 				    windcounter=1; //清零开启风速计数器
    03174 24AA      CLR	R10
    03175 94A3      INC	R10
(0181) 					timer1_init(); //开启风速传感器技术
    03176 940E 2581 CALL	_timer1_init
(0182) 				}
(0183) 				if(page == 0 ){
    03178 800F      LDD	R0,Y+7
    03179 2000      TST	R0
    0317A F009      BEQ	0x317C
    0317B C154      RJMP	0x32D0
(0184) 				
(0185) 				    LCD_const_disp(4,1,"正在检测");
    0317C E58F      LDI	R24,0x5F
    0317D E095      LDI	R25,5
    0317E 8399      STD	Y+1,R25
    0317F 8388      ST	Y,R24
    03180 E021      LDI	R18,1
    03181 E004      LDI	R16,4
    03182 940E 3C8E CALL	_LCD_const_disp
(0186) 					LCD_print4num(4,5,config.time1-config.now);
    03184 9020 08AC LDS	R2,config+12
    03186 9030 08AD LDS	R3,config+13
    03188 9040 08A8 LDS	R4,config+8
    0318A 9050 08A9 LDS	R5,config+9
    0318C 1842      SUB	R4,R2
    0318D 0853      SBC	R5,R3
    0318E 8259      STD	Y+1,R5
    0318F 8248      ST	Y,R4
    03190 E025      LDI	R18,5
    03191 E004      LDI	R16,4
    03192 940E 3F50 CALL	_LCD_print4num
(0187) 					LCD_const_disp(2,6,"      ");
    03194 E588      LDI	R24,0x58
    03195 E095      LDI	R25,5
    03196 8399      STD	Y+1,R25
    03197 8388      ST	Y,R24
    03198 E026      LDI	R18,6
    03199 E002      LDI	R16,2
    0319A 940E 3C8E CALL	_LCD_const_disp
(0188) 					LCD_const_disp(3,6,"      ");
    0319C E588      LDI	R24,0x58
    0319D E095      LDI	R25,5
    0319E 8399      STD	Y+1,R25
    0319F 8388      ST	Y,R24
    031A0 E026      LDI	R18,6
    031A1 E003      LDI	R16,3
    031A2 940E 3C8E CALL	_LCD_const_disp
(0189) 				}
(0190) 			} 
    031A4 C12B      RJMP	0x32D0
(0191) 			else {
(0192) 			   //检测完成 获得数据 转换数据 存储数据 切换到非检测状态
(0193) 			    windcounter =0 ; //关闭风速传感器计数器
    031A5 24AA      CLR	R10
(0194) 				beep(1,1);
    031A6 E021      LDI	R18,1
    031A7 E001      LDI	R16,1
    031A8 940E 400B CALL	_beep
(0195) 				LCD_const_disp(4,1,"--计算并存储--       ");
    031AA E482      LDI	R24,0x42
    031AB E095      LDI	R25,5
    031AC 8399      STD	Y+1,R25
    031AD 8388      ST	Y,R24
    031AE E021      LDI	R18,1
    031AF E004      LDI	R16,4
    031B0 940E 3C8E CALL	_LCD_const_disp
(0196) 				check();
    031B2 940E 2A46 CALL	_check
(0197) 				StructToChar(); //转成字符串
    031B4 940E 2BB0 CALL	_StructToChar
(0198) 				WriteFileHead();//重写文件头
    031B6 940E 270A CALL	_WriteFileHead
(0199) 				WriteSDFile();  //写入sd卡
    031B8 940E 2771 CALL	_WriteSDFile
(0200) 				//zigbee_send(); //发送
(0201) 				Result.Index++; //索引自增一
    031BA E041      LDI	R20,1
    031BB E050      LDI	R21,0
    031BC E060      LDI	R22,0
    031BD E070      LDI	R23,0
    031BE 9040 063A LDS	R4,Result+12
    031C0 9050 063B LDS	R5,Result+13
    031C2 9020 0638 LDS	R2,Result+10
    031C4 9030 0639 LDS	R3,Result+11
    031C6 0E24      ADD	R2,R20
    031C7 1E35      ADC	R3,R21
    031C8 1E46      ADC	R4,R22
    031C9 1E57      ADC	R5,R23
    031CA 9230 0639 STS	Result+11,R3
    031CC 9220 0638 STS	Result+10,R2
    031CE 9250 063B STS	Result+13,R5
    031D0 9240 063A STS	Result+12,R4
(0202) 				is_on=0; //切换到非检测状态
    031D2 2400      CLR	R0
    031D3 8608      STD	Y+8,R0
(0203) 				next_step_time=config.now+config.checkDeltaTime;//自动翻页时间更新
    031D4 9020 08B1 LDS	R2,config+17
    031D6 9030 08B2 LDS	R3,config+18
    031D8 2444      CLR	R4
    031D9 FC37      SBRC	R3,7
    031DA 9440      COM	R4
    031DB 2455      CLR	R5
    031DC FC47      SBRC	R4,7
    031DD 9450      COM	R5
    031DE 9080 08AE LDS	R8,config+14
    031E0 9090 08AF LDS	R9,config+15
    031E2 9060 08AC LDS	R6,config+12
    031E4 9070 08AD LDS	R7,config+13
    031E6 0C62      ADD	R6,R2
    031E7 1C73      ADC	R7,R3
    031E8 1C84      ADC	R8,R4
    031E9 1C95      ADC	R9,R5
    031EA 826B      STD	Y+3,R6
    031EB 827C      STD	Y+4,R7
    031EC 828D      STD	Y+5,R8
    031ED 829E      STD	Y+6,R9
(0204) 				page=0;
    031EE 820F      STD	Y+7,R0
(0205) 		   }
(0206) 		}
    031EF C0E0      RJMP	0x32D0
(0207) 		else { //is_on == 0 非检测状态 手动翻页/自动翻页
(0208) 		    dateRefresh(0);//不更新时间
    031F0 2700      CLR	R16
    031F1 D735      RCALL	_dateRefresh
(0209) 			_GUI_datashow(page); 
    031F2 810F      LDD	R16,Y+7
    031F3 D0E4      RCALL	__GUI_datashow
(0210) 			if(page == 0 ){
    031F4 800F      LDD	R0,Y+7
    031F5 2000      TST	R0
    031F6 F4E9      BNE	0x3214
(0211) 				
(0212) 				    LCD_const_disp(4,1,"完成检测        ");
    031F7 E381      LDI	R24,0x31
    031F8 E095      LDI	R25,5
    031F9 8399      STD	Y+1,R25
    031FA 8388      ST	Y,R24
    031FB E021      LDI	R18,1
    031FC E004      LDI	R16,4
    031FD 940E 3C8E CALL	_LCD_const_disp
(0213) 					if(config.autocheck == 1){
    031FF 9180 08B0 LDS	R24,config+16
    03201 3081      CPI	R24,1
    03202 F449      BNE	0x320C
(0214) 					    LCD_const_disp(4,7,"自动");
    03203 E789      LDI	R24,0x79
    03204 E095      LDI	R25,5
    03205 8399      STD	Y+1,R25
    03206 8388      ST	Y,R24
    03207 E027      LDI	R18,7
    03208 E004      LDI	R16,4
    03209 940E 3C8E CALL	_LCD_const_disp
(0215) 					}
    0320B C008      RJMP	0x3214
(0216) 					else {
(0217) 					    LCD_const_disp(4,7,"手动");
    0320C E784      LDI	R24,0x74
    0320D E095      LDI	R25,5
    0320E 8399      STD	Y+1,R25
    0320F 8388      ST	Y,R24
    03210 E027      LDI	R18,7
    03211 E004      LDI	R16,4
    03212 940E 3C8E CALL	_LCD_const_disp
(0218) 					}
(0219) 					
(0220) 				}
(0221) 						//手动翻页 
(0222) 			if(key==up){ //上键 : 页面减 
    03214 2D8C      MOV	R24,R12
    03215 318E      CPI	R24,0x1E
    03216 F539      BNE	0x323E
(0223) 		        if(page>0) page--;
    03217 E080      LDI	R24,0
    03218 800F      LDD	R0,Y+7
    03219 1580      CP	R24,R0
    0321A F418      BCC	0x321E
    0321B 940A      DEC	R0
    0321C 820F      STD	Y+7,R0
    0321D C01C      RJMP	0x323A
(0224) 				else{
(0225) 				page =5;
    0321E E085      LDI	R24,5
    0321F 838F      STD	Y+7,R24
(0226) 				next_step_time = config.now + config.checkDeltaTime;
    03220 9020 08B1 LDS	R2,config+17
    03222 9030 08B2 LDS	R3,config+18
    03224 2444      CLR	R4
    03225 FC37      SBRC	R3,7
    03226 9440      COM	R4
    03227 2455      CLR	R5
    03228 FC47      SBRC	R4,7
    03229 9450      COM	R5
    0322A 9080 08AE LDS	R8,config+14
    0322C 9090 08AF LDS	R9,config+15
    0322E 9060 08AC LDS	R6,config+12
    03230 9070 08AD LDS	R7,config+13
    03232 0C62      ADD	R6,R2
    03233 1C73      ADC	R7,R3
    03234 1C84      ADC	R8,R4
    03235 1C95      ADC	R9,R5
    03236 826B      STD	Y+3,R6
    03237 827C      STD	Y+4,R7
    03238 828D      STD	Y+5,R8
    03239 829E      STD	Y+6,R9
(0227) 				}
(0228) 		    	LCD_CLR();
    0323A 940E 3D34 CALL	_LCD_CLR
(0229) 		    	LCD_Init();
    0323C 940E 3D02 CALL	_LCD_Init
(0230) 			}
(0231) 			if(key==down){//下键 ： 页面加
    0323E 2D8C      MOV	R24,R12
    0323F 318D      CPI	R24,0x1D
    03240 F539      BNE	0x3268
(0232) 		        page++;
    03241 800F      LDD	R0,Y+7
    03242 9403      INC	R0
    03243 820F      STD	Y+7,R0
(0233) 				next_step_time = config.now + config.checkDeltaTime;
    03244 9020 08B1 LDS	R2,config+17
    03246 9030 08B2 LDS	R3,config+18
    03248 2444      CLR	R4
    03249 FC37      SBRC	R3,7
    0324A 9440      COM	R4
    0324B 2455      CLR	R5
    0324C FC47      SBRC	R4,7
    0324D 9450      COM	R5
    0324E 9080 08AE LDS	R8,config+14
    03250 9090 08AF LDS	R9,config+15
    03252 9060 08AC LDS	R6,config+12
    03254 9070 08AD LDS	R7,config+13
    03256 0C62      ADD	R6,R2
    03257 1C73      ADC	R7,R3
    03258 1C84      ADC	R8,R4
    03259 1C95      ADC	R9,R5
    0325A 826B      STD	Y+3,R6
    0325B 827C      STD	Y+4,R7
    0325C 828D      STD	Y+5,R8
    0325D 829E      STD	Y+6,R9
(0234) 		  		LCD_CLR();
    0325E 940E 3D34 CALL	_LCD_CLR
(0235) 		    	LCD_Init();
    03260 940E 3D02 CALL	_LCD_Init
(0236) 				if(page >= 6 ) {
    03262 818F      LDD	R24,Y+7
    03263 3086      CPI	R24,6
    03264 F018      BCS	0x3268
(0237) 					page=0;
    03265 2400      CLR	R0
    03266 820F      STD	Y+7,R0
(0238) 					continue ;
    03267 C06C      RJMP	0x32D4
(0239) 				}
(0240) 			} 	
(0241) 			//LCD_print2num(4,1,page);
(0242) 			//LCD_print4num(4,3,config.now);
(0243) 			//LCD_print4num(4,6,next_step_time);
(0244) 			if( config.autocheck == 1 ){  //如果开启自动翻页
    03268 9180 08B0 LDS	R24,config+16
    0326A 3081      CPI	R24,1
    0326B F5A1      BNE	0x32A0
(0245) 			      if(config.now >= next_step_time || page >=6 )	{
    0326C 802B      LDD	R2,Y+3
    0326D 803C      LDD	R3,Y+4
    0326E 804D      LDD	R4,Y+5
    0326F 805E      LDD	R5,Y+6
    03270 9080 08AE LDS	R8,config+14
    03272 9090 08AF LDS	R9,config+15
    03274 9060 08AC LDS	R6,config+12
    03276 9070 08AD LDS	R7,config+13
    03278 1462      CP	R6,R2
    03279 0473      CPC	R7,R3
    0327A 0484      CPC	R8,R4
    0327B 0495      CPC	R9,R5
    0327C F418      BCC	0x3280
    0327D 818F      LDD	R24,Y+7
    0327E 3086      CPI	R24,6
    0327F F100      BCS	0x32A0
(0246) 				      next_step_time = config.now + config.checkDeltaTime;
    03280 9020 08B1 LDS	R2,config+17
    03282 9030 08B2 LDS	R3,config+18
    03284 2444      CLR	R4
    03285 FC37      SBRC	R3,7
    03286 9440      COM	R4
    03287 2455      CLR	R5
    03288 FC47      SBRC	R4,7
    03289 9450      COM	R5
    0328A 9080 08AE LDS	R8,config+14
    0328C 9090 08AF LDS	R9,config+15
    0328E 9060 08AC LDS	R6,config+12
    03290 9070 08AD LDS	R7,config+13
    03292 0C62      ADD	R6,R2
    03293 1C73      ADC	R7,R3
    03294 1C84      ADC	R8,R4
    03295 1C95      ADC	R9,R5
    03296 826B      STD	Y+3,R6
    03297 827C      STD	Y+4,R7
    03298 828D      STD	Y+5,R8
    03299 829E      STD	Y+6,R9
(0247) 					  page++;
    0329A 800F      LDD	R0,Y+7
    0329B 9403      INC	R0
    0329C 820F      STD	Y+7,R0
(0248) 					  LCD_CLR(); 
    0329D 940E 3D34 CALL	_LCD_CLR
(0249) 					  key=0;
    0329F 24CC      CLR	R12
(0250) 				  }  
(0251) 			}
(0252) 			if( page>=6 || key == left){
    032A0 818F      LDD	R24,Y+7
    032A1 3086      CPI	R24,6
    032A2 F418      BCC	0x32A6
    032A3 2D8C      MOV	R24,R12
    032A4 318B      CPI	R24,0x1B
    032A5 F551      BNE	0x32D0
(0253) 					      //翻到最后页，页面清零开启下次检测
(0254) 					      page = 0;
    032A6 2400      CLR	R0
    032A7 820F      STD	Y+7,R0
(0255) 						  dateRefresh(1); //刷新时间
    032A8 E001      LDI	R16,1
    032A9 D67D      RCALL	_dateRefresh
(0256) 						  is_on =1 ; //开启检测
    032AA 2400      CLR	R0
    032AB 9403      INC	R0
    032AC 8608      STD	Y+8,R0
(0257) 						  config.time1=config.now+config.THRESHOLD_delta_sec; //更新下次检测时间
    032AD 9040 08A6 LDS	R4,config+6
    032AF 9050 08A7 LDS	R5,config+7
    032B1 9020 08A4 LDS	R2,config+4
    032B3 9030 08A5 LDS	R3,config+5
    032B5 9080 08AE LDS	R8,config+14
    032B7 9090 08AF LDS	R9,config+15
    032B9 9060 08AC LDS	R6,config+12
    032BB 9070 08AD LDS	R7,config+13
    032BD 0C62      ADD	R6,R2
    032BE 1C73      ADC	R7,R3
    032BF 1C84      ADC	R8,R4
    032C0 1C95      ADC	R9,R5
    032C1 9270 08A9 STS	config+9,R7
    032C3 9260 08A8 STS	config+8,R6
    032C5 9290 08AB STS	config+11,R9
    032C7 9280 08AA STS	config+10,R8
(0258) 						  Result.TempChar[0]=0; //清除上次结果
    032C9 2422      CLR	R2
    032CA 9220 065B STS	Result+45,R2
(0259) 						  Result.WSChar[0]=0;
    032CC 9220 0665 STS	Result+55,R2
(0260) 					   	  LCD_CLR();  
    032CE 940E 3D34 CALL	_LCD_CLR
(0261) 					  }
(0262) 				         
(0263) 				
(0264) 
(0265) 		} 
(0266) 	    delayms(10); 
    032D0 E00A      LDI	R16,0xA
    032D1 E010      LDI	R17,0
    032D2 940E 2532 CALL	_delayms
    032D4 CE42      RJMP	0x3117
    032D5 9629      ADIW	R28,0x9
    032D6 940C 48A8 JMP	pop_xgsetF0FC
__GUI_datashow:
  page                 --> R20
    032D8 940E 48D2 CALL	push_xgsetF00C
    032DA 2F40      MOV	R20,R16
    032DB 9722      SBIW	R28,2
(0267) 	}//end while
(0268) }//end function
(0269) void _GUI_datashow(char page){
(0270) 	if(page == 0){
    032DC 2344      TST	R20
    032DD F539      BNE	0x3305
(0271)  	//显示日期时间
(0272) 	    LCD_var_disp(1,1,GUI_get_date());
    032DE D205      RCALL	_GUI_get_date
    032DF 8319      STD	Y+1,R17
    032E0 8308      ST	Y,R16
    032E1 E021      LDI	R18,1
    032E2 E001      LDI	R16,1
    032E3 940E 3CBB CALL	_LCD_var_disp
(0273) 	//显示温度
(0274) 	 	LCD_const_disp(2,1,"温度 (℃):      ");
    032E5 E280      LDI	R24,0x20
    032E6 E095      LDI	R25,5
    032E7 8399      STD	Y+1,R25
    032E8 8388      ST	Y,R24
    032E9 E021      LDI	R18,1
    032EA E002      LDI	R16,2
    032EB 940E 3C8E CALL	_LCD_const_disp
(0275) 	 	LCD_var_disp(2,6,Result.TempChar);
    032ED E58B      LDI	R24,0x5B
    032EE E096      LDI	R25,6
    032EF 8399      STD	Y+1,R25
    032F0 8388      ST	Y,R24
    032F1 E026      LDI	R18,6
    032F2 E002      LDI	R16,2
    032F3 940E 3CBB CALL	_LCD_var_disp
(0276) 	//显示风速
(0277) 	    LCD_const_disp(3,1,"风速(m/s):      ");
    032F5 E08F      LDI	R24,0xF
    032F6 E095      LDI	R25,5
    032F7 8399      STD	Y+1,R25
    032F8 8388      ST	Y,R24
    032F9 E021      LDI	R18,1
    032FA E003      LDI	R16,3
    032FB 940E 3C8E CALL	_LCD_const_disp
(0278) 	 	LCD_const_disp(3,6,Result.WSChar);
    032FD E685      LDI	R24,0x65
    032FE E096      LDI	R25,6
    032FF 8399      STD	Y+1,R25
    03300 8388      ST	Y,R24
    03301 E026      LDI	R18,6
    03302 E003      LDI	R16,3
    03303 940E 3C8E CALL	_LCD_const_disp
(0279) 
(0280) 	 } 
(0281) 	 if(page == 1){
    03305 3041      CPI	R20,1
    03306 F5B9      BNE	0x333E
(0282) 	     LCD_var_disp(1,1,GUI_get_date());
    03307 D1DC      RCALL	_GUI_get_date
    03308 8319      STD	Y+1,R17
    03309 8308      ST	Y,R16
    0330A E021      LDI	R18,1
    0330B E001      LDI	R16,1
    0330C 940E 3CBB CALL	_LCD_var_disp
(0283) 		 LCD_const_disp(2,1,"风冷指数: ");
    0330E E084      LDI	R24,4
    0330F E095      LDI	R25,5
    03310 8399      STD	Y+1,R25
    03311 8388      ST	Y,R24
    03312 E021      LDI	R18,1
    03313 E002      LDI	R16,2
    03314 940E 3C8E CALL	_LCD_const_disp
(0284) 		 LCD_var_disp(2,6,Result.WCIChar);						
    03316 E68E      LDI	R24,0x6E
    03317 E096      LDI	R25,6
    03318 8399      STD	Y+1,R25
    03319 8388      ST	Y,R24
    0331A E026      LDI	R18,6
    0331B E002      LDI	R16,2
    0331C 940E 3CBB CALL	_LCD_var_disp
(0285) 		 LCD_const_disp(3,1,"等价温度: ");
    0331E EF89      LDI	R24,0xF9
    0331F E094      LDI	R25,4
    03320 8399      STD	Y+1,R25
    03321 8388      ST	Y,R24
    03322 E021      LDI	R18,1
    03323 E003      LDI	R16,3
    03324 940E 3C8E CALL	_LCD_const_disp
(0286) 		 LCD_var_disp(3,6,Result.ECTChar);	 
    03326 E78A      LDI	R24,0x7A
    03327 E096      LDI	R25,6
    03328 8399      STD	Y+1,R25
    03329 8388      ST	Y,R24
    0332A E026      LDI	R18,6
    0332B E003      LDI	R16,3
    0332C 940E 3CBB CALL	_LCD_var_disp
(0287) 		 LCD_const_disp(4,1,"相当温度: ");
    0332E EE8E      LDI	R24,0xEE
    0332F E094      LDI	R25,4
    03330 8399      STD	Y+1,R25
    03331 8388      ST	Y,R24
    03332 E021      LDI	R18,1
    03333 E004      LDI	R16,4
    03334 940E 3C8E CALL	_LCD_const_disp
(0288) 		 LCD_var_disp(4,6,Result.TeqChar);	
    03336 E884      LDI	R24,0x84
    03337 E096      LDI	R25,6
    03338 8399      STD	Y+1,R25
    03339 8388      ST	Y,R24
    0333A E026      LDI	R18,6
    0333B E004      LDI	R16,4
    0333C 940E 3CBB CALL	_LCD_var_disp
(0289) 	 }
(0290) 	 if(page == 2){
    0333E 3042      CPI	R20,2
    0333F F009      BEQ	0x3341
    03340 C03F      RJMP	0x3380
(0291) 	     LCD_var_disp(1,1,GUI_get_date());
    03341 D1A2      RCALL	_GUI_get_date
    03342 0158      MOVW	R10,R16
    03343 82B9      STD	Y+1,R11
    03344 82A8      ST	Y,R10
    03345 E021      LDI	R18,1
    03346 E001      LDI	R16,1
    03347 940E 3CBB CALL	_LCD_var_disp
(0292) 		 LCD_const_disp(2,1,"冻伤危害性:");
    03349 EE82      LDI	R24,0xE2
    0334A E094      LDI	R25,4
    0334B 8399      STD	Y+1,R25
    0334C 8388      ST	Y,R24
    0334D E021      LDI	R18,1
    0334E E002      LDI	R16,2
    0334F 940E 3C8E CALL	_LCD_const_disp
(0293) 	 if(Result.WeiHai==0){LCD_const_disp(3,1,"  冻伤危害性小");			 }
    03351 9020 068A LDS	R2,Result+92
    03353 2022      TST	R2
    03354 F449      BNE	0x335E
    03355 ED83      LDI	R24,0xD3
    03356 E094      LDI	R25,4
    03357 8399      STD	Y+1,R25
    03358 8388      ST	Y,R24
    03359 E021      LDI	R18,1
    0335A E003      LDI	R16,3
    0335B 940E 3C8E CALL	_LCD_const_disp
    0335D C022      RJMP	0x3380
(0294) 	 else if(Result.WeiHai==1){	LCD_const_disp(3,1,"  冻伤危害性较大");	 }
    0335E 9180 068A LDS	R24,Result+92
    03360 3081      CPI	R24,1
    03361 F449      BNE	0x336B
    03362 EC82      LDI	R24,0xC2
    03363 E094      LDI	R25,4
    03364 8399      STD	Y+1,R25
    03365 8388      ST	Y,R24
    03366 E021      LDI	R18,1
    03367 E003      LDI	R16,3
    03368 940E 3C8E CALL	_LCD_const_disp
    0336A C015      RJMP	0x3380
(0295) 	 else if(Result.WeiHai==2){	LCD_const_disp(3,1,"  冻伤危害性很大");	 }
    0336B 9180 068A LDS	R24,Result+92
    0336D 3082      CPI	R24,2
    0336E F449      BNE	0x3378
    0336F EB81      LDI	R24,0xB1
    03370 E094      LDI	R25,4
    03371 8399      STD	Y+1,R25
    03372 8388      ST	Y,R24
    03373 E021      LDI	R18,1
    03374 E003      LDI	R16,3
    03375 940E 3C8E CALL	_LCD_const_disp
    03377 C008      RJMP	0x3380
(0296) 	 else LCD_const_disp(3,1,"冻伤危害性小。");
    03378 EA82      LDI	R24,0xA2
    03379 E094      LDI	R25,4
    0337A 8399      STD	Y+1,R25
    0337B 8388      ST	Y,R24
    0337C E021      LDI	R18,1
    0337D E003      LDI	R16,3
    0337E 940E 3C8E CALL	_LCD_const_disp
(0297) 	 }	  
(0298) 	 if(page==3){
    03380 3043      CPI	R20,3
    03381 F009      BEQ	0x3383
    03382 C061      RJMP	0x33E4
(0299) 	     LCD_const_disp(1,1,labelH);		
    03383 E98E      LDI	R24,0x9E
    03384 E092      LDI	R25,2
    03385 8399      STD	Y+1,R25
    03386 8388      ST	Y,R24
    03387 E021      LDI	R18,1
    03388 E001      LDI	R16,1
    03389 940E 3C8E CALL	_LCD_const_disp
(0300) 	 	 switch( Result.WeiHai ){
    0338B 9160 068A LDS	R22,Result+92
    0338D 2777      CLR	R23
    0338E 3060      CPI	R22,0
    0338F 0767      CPC	R22,R23
    03390 F049      BEQ	0x339A
    03391 3061      CPI	R22,1
    03392 E0E0      LDI	R30,0
    03393 077E      CPC	R23,R30
    03394 F0F1      BEQ	0x33B3
    03395 3062      CPI	R22,2
    03396 E0E0      LDI	R30,0
    03397 077E      CPC	R23,R30
    03398 F199      BEQ	0x33CC
    03399 C04A      RJMP	0x33E4
(0301) 			case 0 :
(0302) 			LCD_const_disp(2,1,H01);
    0339A EC8A      LDI	R24,0xCA
    0339B E092      LDI	R25,2
    0339C 8399      STD	Y+1,R25
    0339D 8388      ST	Y,R24
    0339E E021      LDI	R18,1
    0339F E002      LDI	R16,2
    033A0 940E 3C8E CALL	_LCD_const_disp
(0303) 			LCD_const_disp(3,1,H02);
    033A2 ED8A      LDI	R24,0xDA
    033A3 E092      LDI	R25,2
    033A4 8399      STD	Y+1,R25
    033A5 8388      ST	Y,R24
    033A6 E021      LDI	R18,1
    033A7 E003      LDI	R16,3
    033A8 940E 3C8E CALL	_LCD_const_disp
(0304) 			LCD_const_disp(4,1,H03);
    033AA EE85      LDI	R24,0xE5
    033AB E092      LDI	R25,2
    033AC 8399      STD	Y+1,R25
    033AD 8388      ST	Y,R24
    033AE E021      LDI	R18,1
    033AF E004      LDI	R16,4
    033B0 940E 3C8E CALL	_LCD_const_disp
(0305) 			break;
    033B2 C031      RJMP	0x33E4
(0306) 			case 1 : 
(0307) 			LCD_const_disp(2,1,H11);
    033B3 E081      LDI	R24,1
    033B4 E093      LDI	R25,3
    033B5 8399      STD	Y+1,R25
    033B6 8388      ST	Y,R24
    033B7 E021      LDI	R18,1
    033B8 E002      LDI	R16,2
    033B9 940E 3C8E CALL	_LCD_const_disp
(0308) 			LCD_const_disp(3,1,H12);
    033BB EE85      LDI	R24,0xE5
    033BC E092      LDI	R25,2
    033BD 8399      STD	Y+1,R25
    033BE 8388      ST	Y,R24
    033BF E021      LDI	R18,1
    033C0 E003      LDI	R16,3
    033C1 940E 3C8E CALL	_LCD_const_disp
(0309) 			LCD_const_disp(4,1,H13);
    033C3 E18A      LDI	R24,0x1A
    033C4 E093      LDI	R25,3
    033C5 8399      STD	Y+1,R25
    033C6 8388      ST	Y,R24
    033C7 E021      LDI	R18,1
    033C8 E004      LDI	R16,4
    033C9 940E 3C8E CALL	_LCD_const_disp
(0310) 			break ;	
    033CB C018      RJMP	0x33E4
(0311) 			case 2 :
(0312) 			LCD_const_disp(2,1,H21);
    033CC E48E      LDI	R24,0x4E
    033CD E093      LDI	R25,3
    033CE 8399      STD	Y+1,R25
    033CF 8388      ST	Y,R24
    033D0 E021      LDI	R18,1
    033D1 E002      LDI	R16,2
    033D2 940E 3C8E CALL	_LCD_const_disp
(0313) 			LCD_const_disp(3,1,H22);
    033D4 E680      LDI	R24,0x60
    033D5 E093      LDI	R25,3
    033D6 8399      STD	Y+1,R25
    033D7 8388      ST	Y,R24
    033D8 E021      LDI	R18,1
    033D9 E003      LDI	R16,3
    033DA 940E 3C8E CALL	_LCD_const_disp
(0314) 			LCD_const_disp(4,1,H23);
    033DC EE85      LDI	R24,0xE5
    033DD E092      LDI	R25,2
    033DE 8399      STD	Y+1,R25
    033DF 8388      ST	Y,R24
    033E0 E021      LDI	R18,1
    033E1 E004      LDI	R16,4
    033E2 940E 3C8E CALL	_LCD_const_disp
(0315) 			break;
(0316) 			default : ;
(0317) 		}
(0318) 	 } 
(0319) 	 if(page==4){
    033E4 3044      CPI	R20,4
    033E5 F009      BEQ	0x33E7
    033E6 C086      RJMP	0x346D
(0320) 	 		LCD_const_disp(1,1,labelM);		
    033E7 EA8C      LDI	R24,0xAC
    033E8 E092      LDI	R25,2
    033E9 8399      STD	Y+1,R25
    033EA 8388      ST	Y,R24
    033EB E021      LDI	R18,1
    033EC E001      LDI	R16,1
    033ED 940E 3C8E CALL	_LCD_const_disp
(0321) 	 		switch( Result.WeiHai ){
    033EF 9160 068A LDS	R22,Result+92
    033F1 2777      CLR	R23
    033F2 3060      CPI	R22,0
    033F3 0767      CPC	R22,R23
    033F4 F059      BEQ	0x3400
    033F5 3061      CPI	R22,1
    033F6 E0E0      LDI	R30,0
    033F7 077E      CPC	R23,R30
    033F8 F409      BNE	0x33FA
    033F9 C052      RJMP	0x344C
    033FA 3062      CPI	R22,2
    033FB E0E0      LDI	R30,0
    033FC 077E      CPC	R23,R30
    033FD F409      BNE	0x33FF
    033FE C066      RJMP	0x3465
    033FF C06D      RJMP	0x346D
(0322) 	 			case 0 :
(0323) 				LCD_const_disp(2,1,M01);
    03400 EC8A      LDI	R24,0xCA
    03401 E092      LDI	R25,2
    03402 8399      STD	Y+1,R25
    03403 8388      ST	Y,R24
    03404 E021      LDI	R18,1
    03405 E002      LDI	R16,2
    03406 940E 3C8E CALL	_LCD_const_disp
(0324) 				LCD_const_disp(3,1,M02);
    03408 EE85      LDI	R24,0xE5
    03409 E092      LDI	R25,2
    0340A 8399      STD	Y+1,R25
    0340B 8388      ST	Y,R24
    0340C E021      LDI	R18,1
    0340D E003      LDI	R16,3
    0340E 940E 3C8E CALL	_LCD_const_disp
(0325) 				if(Result.Temperature < -17.7){
    03410 9040 0659 LDS	R4,Result+43
    03412 9050 065A LDS	R5,Result+44
    03414 9020 0657 LDS	R2,Result+41
    03416 9030 0658 LDS	R3,Result+42
    03418 EC02      LDI	R16,0xC2
    03419 E010      LDI	R17,0
    0341A 940E 483B CALL	elpm32
    0341C 933A      ST	-Y,R19
    0341D 932A      ST	-Y,R18
    0341E 931A      ST	-Y,R17
    0341F 930A      ST	-Y,R16
    03420 0181      MOVW	R16,R2
    03421 0192      MOVW	R18,R4
    03422 940E 4C33 CALL	fpcmp2
    03424 F44C      BGE	0x342E
(0326) 				    LCD_const_disp(4,1,"戴面罩；禁油彩。");
    03425 E981      LDI	R24,0x91
    03426 E094      LDI	R25,4
    03427 8399      STD	Y+1,R25
    03428 8388      ST	Y,R24
    03429 E021      LDI	R18,1
    0342A E004      LDI	R16,4
    0342B 940E 3C8E CALL	_LCD_const_disp
(0327) 				}
    0342D C03F      RJMP	0x346D
(0328) 				else if(Result.Temperature < -12){
    0342E 9040 0659 LDS	R4,Result+43
    03430 9050 065A LDS	R5,Result+44
    03432 9020 0657 LDS	R2,Result+41
    03434 9030 0658 LDS	R3,Result+42
    03436 EB0E      LDI	R16,0xBE
    03437 E010      LDI	R17,0
    03438 940E 483B CALL	elpm32
    0343A 933A      ST	-Y,R19
    0343B 932A      ST	-Y,R18
    0343C 931A      ST	-Y,R17
    0343D 930A      ST	-Y,R16
    0343E 0181      MOVW	R16,R2
    0343F 0192      MOVW	R18,R4
    03440 940E 4C33 CALL	fpcmp2
    03442 F554      BGE	0x346D
(0329) 				    LCD_const_disp(4,1,"禁油彩。        \0");
    03443 E78F      LDI	R24,0x7F
    03444 E094      LDI	R25,4
    03445 8399      STD	Y+1,R25
    03446 8388      ST	Y,R24
    03447 E021      LDI	R18,1
    03448 E004      LDI	R16,4
    03449 940E 3C8E CALL	_LCD_const_disp
(0330) 				}
(0331) 				break;
    0344B C021      RJMP	0x346D
(0332) 				case 1 : 
(0333) 			    LCD_const_disp(2,1,M11);
    0344C EC8A      LDI	R24,0xCA
    0344D E092      LDI	R25,2
    0344E 8399      STD	Y+1,R25
    0344F 8388      ST	Y,R24
    03450 E021      LDI	R18,1
    03451 E002      LDI	R16,2
    03452 940E 3C8E CALL	_LCD_const_disp
(0334) 				LCD_const_disp(3,1,M12);
    03454 E28A      LDI	R24,0x2A
    03455 E093      LDI	R25,3
    03456 8399      STD	Y+1,R25
    03457 8388      ST	Y,R24
    03458 E021      LDI	R18,1
    03459 E003      LDI	R16,3
    0345A 940E 3C8E CALL	_LCD_const_disp
(0335) 				LCD_const_disp(4,1,M13);
    0345C E38C      LDI	R24,0x3C
    0345D E093      LDI	R25,3
    0345E 8399      STD	Y+1,R25
    0345F 8388      ST	Y,R24
    03460 E021      LDI	R18,1
    03461 E004      LDI	R16,4
    03462 940E 3C8E CALL	_LCD_const_disp
(0336) 				break ;
    03464 C008      RJMP	0x346D
(0337) 				case 2 :
(0338) 				LCD_const_disp(2,1,M21);
    03465 E782      LDI	R24,0x72
    03466 E093      LDI	R25,3
    03467 8399      STD	Y+1,R25
    03468 8388      ST	Y,R24
    03469 E021      LDI	R18,1
    0346A E002      LDI	R16,2
    0346B 940E 3C8E CALL	_LCD_const_disp
(0339) 				break ;
(0340) 				default :;
(0341) 	 		}
(0342) 	 }
(0343) 	 if(page==5){
    0346D 3045      CPI	R20,5
    0346E F009      BEQ	0x3470
    0346F C071      RJMP	0x34E1
(0344) 	     LCD_const_disp(1,1,labelL);		
    03470 EB8C      LDI	R24,0xBC
    03471 E092      LDI	R25,2
    03472 8399      STD	Y+1,R25
    03473 8388      ST	Y,R24
    03474 E021      LDI	R18,1
    03475 E001      LDI	R16,1
    03476 940E 3C8E CALL	_LCD_const_disp
(0345) 	 	 switch( Result.WeiHai ){	
    03478 9140 068A LDS	R20,Result+92
    0347A 2755      CLR	R21
    0347B 3040      CPI	R20,0
    0347C 0745      CPC	R20,R21
    0347D F059      BEQ	0x3489
    0347E 3041      CPI	R20,1
    0347F E0E0      LDI	R30,0
    03480 075E      CPC	R21,R30
    03481 F409      BNE	0x3483
    03482 C03D      RJMP	0x34C0
    03483 3042      CPI	R20,2
    03484 E0E0      LDI	R30,0
    03485 075E      CPC	R21,R30
    03486 F409      BNE	0x3488
    03487 C051      RJMP	0x34D9
    03488 C058      RJMP	0x34E1
(0346) 		     case 0 :
(0347) 			 LCD_const_disp(2,1,L01);
    03489 EF87      LDI	R24,0xF7
    0348A E092      LDI	R25,2
    0348B 8399      STD	Y+1,R25
    0348C 8388      ST	Y,R24
    0348D E021      LDI	R18,1
    0348E E002      LDI	R16,2
    0348F 940E 3C8E CALL	_LCD_const_disp
(0348) 			 if(Result.Temperature < -12) {
    03491 9040 0659 LDS	R4,Result+43
    03493 9050 065A LDS	R5,Result+44
    03495 9020 0657 LDS	R2,Result+41
    03497 9030 0658 LDS	R3,Result+42
    03499 EB0E      LDI	R16,0xBE
    0349A E010      LDI	R17,0
    0349B 940E 483B CALL	elpm32
    0349D 933A      ST	-Y,R19
    0349E 932A      ST	-Y,R18
    0349F 931A      ST	-Y,R17
    034A0 930A      ST	-Y,R16
    034A1 0181      MOVW	R16,R2
    034A2 0192      MOVW	R18,R4
    034A3 940E 4C33 CALL	fpcmp2
    034A5 F48C      BGE	0x34B7
(0349) 			 LCD_const_disp(3,1,L02);
    034A6 E081      LDI	R24,1
    034A7 E093      LDI	R25,3
    034A8 8399      STD	Y+1,R25
    034A9 8388      ST	Y,R24
    034AA E021      LDI	R18,1
    034AB E003      LDI	R16,3
    034AC 940E 3C8E CALL	_LCD_const_disp
(0350) 			 LCD_const_disp(4,1,L03);
    034AE E08B      LDI	R24,0xB
    034AF E093      LDI	R25,3
    034B0 8399      STD	Y+1,R25
    034B1 8388      ST	Y,R24
    034B2 E021      LDI	R18,1
    034B3 E004      LDI	R16,4
    034B4 940E 3C8E CALL	_LCD_const_disp
(0351) 			 } 
    034B6 C02A      RJMP	0x34E1
(0352) 			 else {
(0353) 			 LCD_const_disp(3,1,L03);
    034B7 E08B      LDI	R24,0xB
    034B8 E093      LDI	R25,3
    034B9 8399      STD	Y+1,R25
    034BA 8388      ST	Y,R24
    034BB E021      LDI	R18,1
    034BC E003      LDI	R16,3
    034BD 940E 3C8E CALL	_LCD_const_disp
(0354) 			 }
(0355) 			 break;
    034BF C021      RJMP	0x34E1
(0356) 			 case 1: 
(0357) 			 LCD_const_disp(2,1,L11);
    034C0 E48E      LDI	R24,0x4E
    034C1 E093      LDI	R25,3
    034C2 8399      STD	Y+1,R25
    034C3 8388      ST	Y,R24
    034C4 E021      LDI	R18,1
    034C5 E002      LDI	R16,2
    034C6 940E 3C8E CALL	_LCD_const_disp
(0358) 			 LCD_const_disp(3,1,L12);
    034C8 E680      LDI	R24,0x60
    034C9 E093      LDI	R25,3
    034CA 8399      STD	Y+1,R25
    034CB 8388      ST	Y,R24
    034CC E021      LDI	R18,1
    034CD E003      LDI	R16,3
    034CE 940E 3C8E CALL	_LCD_const_disp
(0359) 			 LCD_const_disp(3,1,L13);
    034D0 EE85      LDI	R24,0xE5
    034D1 E092      LDI	R25,2
    034D2 8399      STD	Y+1,R25
    034D3 8388      ST	Y,R24
    034D4 E021      LDI	R18,1
    034D5 E003      LDI	R16,3
    034D6 940E 3C8E CALL	_LCD_const_disp
(0360) 			 break ;
    034D8 C008      RJMP	0x34E1
(0361) 			 case 2 :
(0362) 			 LCD_const_disp(2,1,L21);
    034D9 E782      LDI	R24,0x72
    034DA E093      LDI	R25,3
    034DB 8399      STD	Y+1,R25
    034DC 8388      ST	Y,R24
    034DD E021      LDI	R18,1
    034DE E002      LDI	R16,2
    034DF 940E 3C8E CALL	_LCD_const_disp
(0363) 			 break;
(0364) 			 default : ;
(0365) 		} //end switch
(0366) 	}  //end if
    034E1 9622      ADIW	R28,2
    034E2 940C 48D9 JMP	pop_xgsetF00C
(0367) }
(0368) char * GUI_get_date(void) {  
(0369)   //格式:12月11日19:00:00
(0370)     GUI_date[0]=Result.Date[4]; 
_GUI_get_date:
    034E4 9020 0648 LDS	R2,Result+26
    034E6 9220 0392 STS	GUI_date,R2
(0371)     GUI_date[1]=Result.Date[5];
    034E8 9020 0649 LDS	R2,Result+27
    034EA 9220 0393 STS	GUI_date+1,R2
(0372)     GUI_date[4]=Result.Date[6];
    034EC 9020 064A LDS	R2,Result+28
    034EE 9220 0396 STS	GUI_date+4,R2
(0373)     GUI_date[5]=Result.Date[7];
    034F0 9020 064B LDS	R2,Result+29
    034F2 9220 0397 STS	GUI_date+5,R2
(0374)     GUI_date[8]=Result.Time[0];
    034F4 9020 064D LDS	R2,Result+31
    034F6 9220 039A STS	GUI_date+8,R2
(0375)     GUI_date[9]=Result.Time[1];
    034F8 9020 064E LDS	R2,Result+32
    034FA 9220 039B STS	GUI_date+9,R2
(0376)     GUI_date[11]=Result.Time[3];
    034FC 9020 0650 LDS	R2,Result+34
    034FE 9220 039D STS	GUI_date+11,R2
(0377)     GUI_date[12]=Result.Time[4];
    03500 9020 0651 LDS	R2,Result+35
    03502 9220 039E STS	GUI_date+12,R2
(0378)     GUI_date[14]=Result.Time[6];
    03504 9020 0653 LDS	R2,Result+37
    03506 9220 03A0 STS	GUI_date+14,R2
(0379)     GUI_date[15]=Result.Time[7];
    03508 9020 0654 LDS	R2,Result+38
    0350A 9220 03A1 STS	GUI_date+15,R2
(0380)     GUI_date[16]='\0';
    0350C 2422      CLR	R2
    0350D 9220 03A2 STS	GUI_date+16,R2
(0381)     return GUI_date;
    0350F E902      LDI	R16,0x92
    03510 E013      LDI	R17,3
    03511 9508      RET
_GUI_set_time:
  GUI_down             --> Y,+5
  GUI_up               --> Y,+2
  ary                  --> R12
  p                    --> Y,+10
  i                    --> R14
  keyc                 --> R20
  pT                   --> R10
  pD                   --> Y,+8
    03512 940E 48B3 CALL	push_xgsetF0FC
    03514 972B      SBIW	R28,0xB
(0382) }
(0383) //设置时间 菜单 
(0384) void GUI_set_time(void){
(0385)     unsigned char p=2;
    03515 E082      LDI	R24,2
    03516 878A      STD	Y+10,R24
(0386) 	char GUI_up[]= "↑";
    03517 EA83      LDI	R24,0xA3
    03518 E093      LDI	R25,3
    03519 01FE      MOVW	R30,R28
    0351A 9632      ADIW	R30,2
    0351B E003      LDI	R16,3
    0351C E010      LDI	R17,0
    0351D 93FA      ST	-Y,R31
    0351E 93EA      ST	-Y,R30
    0351F 939A      ST	-Y,R25
    03520 938A      ST	-Y,R24
    03521 940E 4963 CALL	asgnblk
(0387) 	char GUI_down[]= "↓";
    03523 EA86      LDI	R24,0xA6
    03524 E093      LDI	R25,3
    03525 01FE      MOVW	R30,R28
    03526 9635      ADIW	R30,5
    03527 E003      LDI	R16,3
    03528 E010      LDI	R17,0
    03529 93FA      ST	-Y,R31
    0352A 93EA      ST	-Y,R30
    0352B 939A      ST	-Y,R25
    0352C 938A      ST	-Y,R24
    0352D 940E 4963 CALL	asgnblk
(0388) 	char *pD=NULL,*pT=NULL;
    0352F 2400      CLR	R0
    03530 2411      CLR	R1
    03531 8619      STD	Y+9,R1
    03532 8608      STD	Y+8,R0
(0389) 	char *ary=GUI_up;
    03533 01CE      MOVW	R24,R28
    03534 9602      ADIW	R24,2
    03535 016C      MOVW	R12,R24
(0390) 	unsigned char i=0,keyc=NO_KEY;
    03536 24EE      CLR	R14
    03537 2744      CLR	R20
(0391) 	LCD_CLR(); //清屏
    03538 940E 3D34 CALL	_LCD_CLR
(0392) 	pD="2012年12月31日\0";
    0353A E68F      LDI	R24,0x6F
    0353B E094      LDI	R25,4
    0353C 8799      STD	Y+9,R25
    0353D 8788      STD	Y+8,R24
(0393) 	pT="12: 30: 59\0";
    0353E E683      LDI	R24,0x63
    0353F E094      LDI	R25,4
    03540 015C      MOVW	R10,R24
(0394) 	LCD_const_disp(1,1,"时间设置:       ");
    03541 E582      LDI	R24,0x52
    03542 E094      LDI	R25,4
    03543 8399      STD	Y+1,R25
    03544 8388      ST	Y,R24
    03545 E021      LDI	R18,1
    03546 E001      LDI	R16,1
    03547 940E 3C8E CALL	_LCD_const_disp
(0395) 	LCD_const_disp(4,7,"保存");
    03549 E48D      LDI	R24,0x4D
    0354A E094      LDI	R25,4
    0354B 8399      STD	Y+1,R25
    0354C 8388      ST	Y,R24
    0354D E027      LDI	R18,7
    0354E E004      LDI	R16,4
    0354F 940E 3C8E CALL	_LCD_const_disp
(0396) 	LCD_var_disp(3,p,ary);
    03551 82D9      STD	Y+1,R13
    03552 82C8      ST	Y,R12
    03553 852A      LDD	R18,Y+10
    03554 E003      LDI	R16,3
    03555 940E 3CBB CALL	_LCD_var_disp
(0397) 	LCD_var_disp(2,1,pD);
    03557 8408      LDD	R0,Y+8
    03558 8419      LDD	R1,Y+9
    03559 8219      STD	Y+1,R1
    0355A 8208      ST	Y,R0
    0355B E021      LDI	R18,1
    0355C E002      LDI	R16,2
    0355D 940E 3CBB CALL	_LCD_var_disp
(0398) 	LCD_var_disp(4,1,pT);
    0355F 82B9      STD	Y+1,R11
    03560 82A8      ST	Y,R10
    03561 E021      LDI	R18,1
    03562 E004      LDI	R16,4
    03563 940E 3CBB CALL	_LCD_var_disp
(0399) 	delayms(250);
    03565 EF0A      LDI	R16,0xFA
    03566 E010      LDI	R17,0
    03567 940E 2532 CALL	_delayms
    03569 C1F7      RJMP	0x3761
(0400) 	while(1){
(0401) 	    keyc=kbscan();
    0356A 940E 4294 CALL	_kbscan
    0356C 2F40      MOV	R20,R16
(0402) 		heaterSwitch();
    0356D 940E 25EB CALL	_heaterSwitch
(0403) 		pD[2]=Result.Date[2];
    0356F 9020 0646 LDS	R2,Result+24
    03571 85E8      LDD	R30,Y+8
    03572 85F9      LDD	R31,Y+9
    03573 8222      STD	Z+2,R2
(0404) 		pD[3]=Result.Date[3];
    03574 9020 0647 LDS	R2,Result+25
    03576 8223      STD	Z+3,R2
(0405) 		pD[6]=Result.Date[4];
    03577 9020 0648 LDS	R2,Result+26
    03579 8226      STD	Z+6,R2
(0406) 		pD[7]=Result.Date[5];
    0357A 9020 0649 LDS	R2,Result+27
    0357C 8227      STD	Z+7,R2
(0407) 		pD[10]=Result.Date[6];
    0357D 9020 064A LDS	R2,Result+28
    0357F 8622      STD	Z+10,R2
(0408) 		pD[11]=Result.Date[7];  
    03580 9020 064B LDS	R2,Result+29
    03582 8623      STD	Z+11,R2
(0409) 		pT[0] = Result.Time[0];
    03583 9020 064D LDS	R2,Result+31
    03585 01F5      MOVW	R30,R10
    03586 8220      ST	Z,R2
(0410) 		pT[1] = Result.Time[1];
    03587 9020 064E LDS	R2,Result+32
    03589 8221      STD	Z+1,R2
(0411) 		pT[4] = Result.Time[3];
    0358A 9020 0650 LDS	R2,Result+34
    0358C 8224      STD	Z+4,R2
(0412) 		pT[5] = Result.Time[4];
    0358D 9020 0651 LDS	R2,Result+35
    0358F 8225      STD	Z+5,R2
(0413) 		pT[8] = Result.Time[6];
    03590 9020 0653 LDS	R2,Result+37
    03592 8620      STD	Z+8,R2
(0414) 		pT[9] = Result.Time[7];
    03593 9020 0654 LDS	R2,Result+38
    03595 8621      STD	Z+9,R2
(0415) 		
(0416) 		switch(i){
    03596 2D6E      MOV	R22,R14
    03597 2777      CLR	R23
    03598 3060      CPI	R22,0
    03599 0767      CPC	R22,R23
    0359A F0D1      BEQ	0x35B5
    0359B 3061      CPI	R22,1
    0359C E0E0      LDI	R30,0
    0359D 077E      CPC	R23,R30
    0359E F409      BNE	0x35A0
    0359F C04A      RJMP	0x35EA
    035A0 3062      CPI	R22,2
    035A1 E0E0      LDI	R30,0
    035A2 077E      CPC	R23,R30
    035A3 F409      BNE	0x35A5
    035A4 C07C      RJMP	0x3621
    035A5 3063      CPI	R22,3
    035A6 E0E0      LDI	R30,0
    035A7 077E      CPC	R23,R30
    035A8 F409      BNE	0x35AA
    035A9 C0BE      RJMP	0x3668
    035AA 3064      CPI	R22,4
    035AB E0E0      LDI	R30,0
    035AC 077E      CPC	R23,R30
    035AD F409      BNE	0x35AF
    035AE C0F1      RJMP	0x36A0
    035AF 3065      CPI	R22,5
    035B0 E0E0      LDI	R30,0
    035B1 077E      CPC	R23,R30
    035B2 F409      BNE	0x35B4
    035B3 C123      RJMP	0x36D7
    035B4 C15C      RJMP	0x3711
(0417)             case 0: p=2;ary=GUI_up;  //年
    035B5 E082      LDI	R24,2
    035B6 878A      STD	Y+10,R24
    035B7 01CE      MOVW	R24,R28
    035B8 9602      ADIW	R24,2
    035B9 016C      MOVW	R12,R24
(0418) 		 	  	 if(keyc==up){
    035BA 314E      CPI	R20,0x1E
    035BB F491      BNE	0x35CE
(0419) 				     if(time_buf[1]<0x99){ 
    035BC 9180 05D1 LDS	R24,time_buf+1
    035BE 3989      CPI	R24,0x99
    035BF F008      BCS	0x35C1
    035C0 C150      RJMP	0x3711
(0420) 					     time_buf[1]++;
    035C1 5F8F      SUBI	R24,0xFF
    035C2 9380 05D1 STS	time_buf+1,R24
(0421) 						 if((time_buf[1]&0x0f)==0x0a) 
    035C4 708F      ANDI	R24,0xF
    035C5 308A      CPI	R24,0xA
    035C6 F009      BEQ	0x35C8
    035C7 C149      RJMP	0x3711
(0422) 						     time_buf[1]=time_buf[1]+6;
    035C8 9180 05D1 LDS	R24,time_buf+1
    035CA 5F8A      SUBI	R24,0xFA
    035CB 9380 05D1 STS	time_buf+1,R24
(0423) 					 }
(0424) 												     
(0425) 				}				  
    035CD C143      RJMP	0x3711
(0426)  					        
(0427) 			    else if(keyc==down){ 
    035CE 314D      CPI	R20,0x1D
    035CF F4A1      BNE	0x35E4
(0428) 				    if(time_buf[1]>0x00){
    035D0 E080      LDI	R24,0
    035D1 9020 05D1 LDS	R2,time_buf+1
    035D3 1582      CP	R24,R2
    035D4 F008      BCS	0x35D6
    035D5 C13B      RJMP	0x3711
(0429) 				        time_buf[1]--;
    035D6 2D82      MOV	R24,R2
    035D7 5081      SUBI	R24,1
    035D8 9380 05D1 STS	time_buf+1,R24
(0430) 						if((time_buf[1]&0x0f)==0x0f) 
    035DA 708F      ANDI	R24,0xF
    035DB 308F      CPI	R24,0xF
    035DC F009      BEQ	0x35DE
    035DD C133      RJMP	0x3711
(0431) 						    time_buf[1]=time_buf[1]-6;
    035DE 9180 05D1 LDS	R24,time_buf+1
    035E0 5086      SUBI	R24,6
    035E1 9380 05D1 STS	time_buf+1,R24
(0432) 		 	  	 		 }
(0433) 												   
(0434) 					}			   		
    035E3 C12D      RJMP	0x3711
(0435) 				else if(keyc==left) {i=1;}
    035E4 314B      CPI	R20,0x1B
    035E5 F009      BEQ	0x35E7
    035E6 C12A      RJMP	0x3711
    035E7 24EE      CLR	R14
    035E8 94E3      INC	R14
(0436) 				break;
    035E9 C127      RJMP	0x3711
(0437) 		 case 1:p=4;ary=GUI_up;  //月
    035EA E084      LDI	R24,4
    035EB 878A      STD	Y+10,R24
    035EC 01CE      MOVW	R24,R28
    035ED 9602      ADIW	R24,2
    035EE 016C      MOVW	R12,R24
(0438) 		  	  	if(keyc==up){
    035EF 314E      CPI	R20,0x1E
    035F0 F499      BNE	0x3604
(0439) 				    if(time_buf[2]<0x12){  
    035F1 9180 05D2 LDS	R24,time_buf+2
    035F3 3182      CPI	R24,0x12
    035F4 F460      BCC	0x3601
(0440) 					    time_buf[2]++;	
    035F5 5F8F      SUBI	R24,0xFF
    035F6 9380 05D2 STS	time_buf+2,R24
(0441) 						if((time_buf[2]&0x0f)==0x0a) time_buf[2]+=6;
    035F8 708F      ANDI	R24,0xF
    035F9 308A      CPI	R24,0xA
    035FA F449      BNE	0x3604
    035FB 9180 05D2 LDS	R24,time_buf+2
    035FD 5F8A      SUBI	R24,0xFA
    035FE 9380 05D2 STS	time_buf+2,R24
(0442) 					}
    03600 C003      RJMP	0x3604
(0443) 					else 
(0444) 					    time_buf[2]=0x01;
    03601 E081      LDI	R24,1
    03602 9380 05D2 STS	time_buf+2,R24
(0445) 				}						 
(0446) 				if(keyc==down){ 
    03604 314D      CPI	R20,0x1D
    03605 F4A9      BNE	0x361B
(0447) 				    if(time_buf[2]>0x01){  
    03606 E081      LDI	R24,1
    03607 9020 05D2 LDS	R2,time_buf+2
    03609 1582      CP	R24,R2
    0360A F468      BCC	0x3618
(0448) 					    time_buf[2]--;	
    0360B 2D82      MOV	R24,R2
    0360C 5081      SUBI	R24,1
    0360D 9380 05D2 STS	time_buf+2,R24
(0449) 						if((time_buf[2]&0x0f)==0x0f) 
    0360F 708F      ANDI	R24,0xF
    03610 308F      CPI	R24,0xF
    03611 F449      BNE	0x361B
(0450) 						    time_buf[2]-=6;
    03612 9180 05D2 LDS	R24,time_buf+2
    03614 5086      SUBI	R24,6
    03615 9380 05D2 STS	time_buf+2,R24
(0451) 			  		}
    03617 C003      RJMP	0x361B
(0452) 				    else 
(0453) 					    time_buf[2]=0x12;						
    03618 E182      LDI	R24,0x12
    03619 9380 05D2 STS	time_buf+2,R24
(0454) 				}						 							
(0455)  								
(0456) 				if(keyc==left){
    0361B 314B      CPI	R20,0x1B
    0361C F009      BEQ	0x361E
    0361D C0F3      RJMP	0x3711
(0457) 				    i=2;   
    0361E E082      LDI	R24,2
    0361F 2EE8      MOV	R14,R24
(0458) 				}  
(0459) 				break;
    03620 C0F0      RJMP	0x3711
(0460) 	 	 case 2: p=6;ary=GUI_up;
    03621 E086      LDI	R24,6
    03622 878A      STD	Y+10,R24
    03623 01CE      MOVW	R24,R28
    03624 9602      ADIW	R24,2
    03625 016C      MOVW	R12,R24
(0461) 		 	  	 if(keyc==up){ 
    03626 314E      CPI	R20,0x1E
    03627 F519      BNE	0x364B
(0462) 				     if(time_buf[3]<0x31){ 
    03628 9180 05D3 LDS	R24,time_buf+3
    0362A 3381      CPI	R24,0x31
    0362B F5B0      BCC	0x3662
(0463) 				         time_buf[3]++;
    0362C 5F8F      SUBI	R24,0xFF
    0362D 9380 05D3 STS	time_buf+3,R24
(0464) 						 if ((time_buf[3]&0x0f)==0x0a) time_buf[3]=time_buf[3]+6;
    0362F 708F      ANDI	R24,0xF
    03630 308A      CPI	R24,0xA
    03631 F429      BNE	0x3637
    03632 9180 05D3 LDS	R24,time_buf+3
    03634 5F8A      SUBI	R24,0xFA
    03635 9380 05D3 STS	time_buf+3,R24
(0465) 						 if(  //2 4 6 9 11 月最大30天
(0466) 						  ( ((time_buf[2]==0x02) || (time_buf[2]==0x04)|| (time_buf[2]==0x06)||
    03637 9180 05D2 LDS	R24,time_buf+2
    03639 3082      CPI	R24,2
    0363A F041      BEQ	0x3643
    0363B 3084      CPI	R24,4
    0363C F031      BEQ	0x3643
    0363D 3086      CPI	R24,6
    0363E F021      BEQ	0x3643
    0363F 3089      CPI	R24,0x9
    03640 F011      BEQ	0x3643
    03641 3181      CPI	R24,0x11
    03642 F4F9      BNE	0x3662
    03643 9180 05D3 LDS	R24,time_buf+3
    03645 3381      CPI	R24,0x31
    03646 F4D9      BNE	0x3662
(0467) 						  (time_buf[2]==0x09)||(time_buf[2]==0x11))&&(time_buf[3]==0x31))){
(0468) 						      time_buf[3]=0x30;
    03647 E380      LDI	R24,0x30
    03648 9380 05D3 STS	time_buf+3,R24
(0469) 						}
(0470) 				     }
(0471)  									  
(0472)  				 }
    0364A C017      RJMP	0x3662
(0473) 			     else if(keyc==down){ 
    0364B 314D      CPI	R20,0x1D
    0364C F4A9      BNE	0x3662
(0474) 				      if(time_buf[3]>0x01){  
    0364D E081      LDI	R24,1
    0364E 9020 05D3 LDS	R2,time_buf+3
    03650 1582      CP	R24,R2
    03651 F468      BCC	0x365F
(0475) 					     time_buf[3]--;
    03652 2D82      MOV	R24,R2
    03653 5081      SUBI	R24,1
    03654 9380 05D3 STS	time_buf+3,R24
(0476) 				 	  	 if((time_buf[3]&0x0f)==0x0f) time_buf[3]=time_buf[3]-6;
    03656 708F      ANDI	R24,0xF
    03657 308F      CPI	R24,0xF
    03658 F449      BNE	0x3662
    03659 9180 05D3 LDS	R24,time_buf+3
    0365B 5086      SUBI	R24,6
    0365C 9380 05D3 STS	time_buf+3,R24
(0477) 		 	  	 	 }
    0365E C003      RJMP	0x3662
(0478) 					 else time_buf[3]=0x31;						
    0365F E381      LDI	R24,0x31
    03660 9380 05D3 STS	time_buf+3,R24
(0479) 											   
(0480) 				}
(0481) 				if(keyc==left) {i=3;  }						 			   		
    03662 314B      CPI	R20,0x1B
    03663 F009      BEQ	0x3665
    03664 C0AC      RJMP	0x3711
    03665 E083      LDI	R24,3
    03666 2EE8      MOV	R14,R24
(0482) 				break;
    03667 C0A9      RJMP	0x3711
(0483) 		case 3:p=1;ary=GUI_down;
    03668 2400      CLR	R0
    03669 9403      INC	R0
    0366A 860A      STD	Y+10,R0
    0366B 01CE      MOVW	R24,R28
    0366C 9605      ADIW	R24,5
    0366D 016C      MOVW	R12,R24
(0484)  	  	if(keyc==up){ if(time_buf[4]<0x23){  time_buf[4]++;	
    0366E 314E      CPI	R20,0x1E
    0366F F499      BNE	0x3683
    03670 9180 05D4 LDS	R24,time_buf+4
    03672 3283      CPI	R24,0x23
    03673 F460      BCC	0x3680
    03674 5F8F      SUBI	R24,0xFF
    03675 9380 05D4 STS	time_buf+4,R24
(0485) 													if((time_buf[4]&0x0f)==0x0a) time_buf[4]+=6;
    03677 708F      ANDI	R24,0xF
    03678 308A      CPI	R24,0xA
    03679 F449      BNE	0x3683
    0367A 9180 05D4 LDS	R24,time_buf+4
    0367C 5F8A      SUBI	R24,0xFA
    0367D 9380 05D4 STS	time_buf+4,R24
(0486) 													 
(0487) 													
(0488) 												 }
    0367F C003      RJMP	0x3683
(0489) 							else time_buf[4]=0x00;
    03680 2422      CLR	R2
    03681 9220 05D4 STS	time_buf+4,R2
(0490) 						  }						 
(0491) 				if(keyc==down){ if(time_buf[4]>0x00){  time_buf[4]--;	
    03683 314D      CPI	R20,0x1D
    03684 F4A9      BNE	0x369A
    03685 E080      LDI	R24,0
    03686 9020 05D4 LDS	R2,time_buf+4
    03688 1582      CP	R24,R2
    03689 F468      BCC	0x3697
    0368A 2D82      MOV	R24,R2
    0368B 5081      SUBI	R24,1
    0368C 9380 05D4 STS	time_buf+4,R24
(0492) 													if((time_buf[4]&0x0f)==0x0f) time_buf[4]-=6;
    0368E 708F      ANDI	R24,0xF
    0368F 308F      CPI	R24,0xF
    03690 F449      BNE	0x369A
    03691 9180 05D4 LDS	R24,time_buf+4
    03693 5086      SUBI	R24,6
    03694 9380 05D4 STS	time_buf+4,R24
(0493) 													
(0494) 												 }
    03696 C003      RJMP	0x369A
(0495) 							 else time_buf[4]=0x23;						
    03697 E283      LDI	R24,0x23
    03698 9380 05D4 STS	time_buf+4,R24
(0496) 						  }	
(0497) 		if(keyc==left) {i=4;    } 
    0369A 314B      CPI	R20,0x1B
    0369B F009      BEQ	0x369D
    0369C C074      RJMP	0x3711
    0369D E084      LDI	R24,4
    0369E 2EE8      MOV	R14,R24
(0498) 		break;						  					 			
    0369F C071      RJMP	0x3711
(0499)  case 4:p=3;ary=GUI_down;
    036A0 E083      LDI	R24,3
    036A1 878A      STD	Y+10,R24
    036A2 01CE      MOVW	R24,R28
    036A3 9605      ADIW	R24,5
    036A4 016C      MOVW	R12,R24
(0500)  	  	if(keyc==up){ if(time_buf[5]<0x59){  time_buf[5]++;	
    036A5 314E      CPI	R20,0x1E
    036A6 F499      BNE	0x36BA
    036A7 9180 05D5 LDS	R24,time_buf+5
    036A9 3589      CPI	R24,0x59
    036AA F460      BCC	0x36B7
    036AB 5F8F      SUBI	R24,0xFF
    036AC 9380 05D5 STS	time_buf+5,R24
(0501) 											 if((time_buf[5]&0x0f)==0x0a) time_buf[5]+=6;
    036AE 708F      ANDI	R24,0xF
    036AF 308A      CPI	R24,0xA
    036B0 F449      BNE	0x36BA
    036B1 9180 05D5 LDS	R24,time_buf+5
    036B3 5F8A      SUBI	R24,0xFA
    036B4 9380 05D5 STS	time_buf+5,R24
(0502) 										  }
    036B6 C003      RJMP	0x36BA
(0503) 					  else time_buf[5]=0x00;
    036B7 2422      CLR	R2
    036B8 9220 05D5 STS	time_buf+5,R2
(0504) 					}						 
(0505) 		if(keyc==down){ if(time_buf[5]>0x00){  time_buf[5]--;	
    036BA 314D      CPI	R20,0x1D
    036BB F4A9      BNE	0x36D1
    036BC E080      LDI	R24,0
    036BD 9020 05D5 LDS	R2,time_buf+5
    036BF 1582      CP	R24,R2
    036C0 F468      BCC	0x36CE
    036C1 2D82      MOV	R24,R2
    036C2 5081      SUBI	R24,1
    036C3 9380 05D5 STS	time_buf+5,R24
(0506) 												if((time_buf[5]&0x0f)==0x0f) time_buf[5]-=6;
    036C5 708F      ANDI	R24,0xF
    036C6 308F      CPI	R24,0xF
    036C7 F449      BNE	0x36D1
    036C8 9180 05D5 LDS	R24,time_buf+5
    036CA 5086      SUBI	R24,6
    036CB 9380 05D5 STS	time_buf+5,R24
(0507) 											}
    036CD C003      RJMP	0x36D1
(0508) 						else time_buf[5]=0x59;						
    036CE E589      LDI	R24,0x59
    036CF 9380 05D5 STS	time_buf+5,R24
(0509) 					  }
(0510) 		if(keyc==left ) {i=5;    } 		  						 								  			
    036D1 314B      CPI	R20,0x1B
    036D2 F009      BEQ	0x36D4
    036D3 C03D      RJMP	0x3711
    036D4 E085      LDI	R24,5
    036D5 2EE8      MOV	R14,R24
(0511) 		break;			   
    036D6 C03A      RJMP	0x3711
(0512)  case 5:p=5;ary=GUI_down;
    036D7 E085      LDI	R24,5
    036D8 878A      STD	Y+10,R24
    036D9 01CE      MOVW	R24,R28
    036DA 9605      ADIW	R24,5
    036DB 016C      MOVW	R12,R24
(0513)  	  	if(keyc==up){ if(time_buf[6]<0x59){  time_buf[6]++;	
    036DC 314E      CPI	R20,0x1E
    036DD F499      BNE	0x36F1
    036DE 9180 05D6 LDS	R24,time_buf+6
    036E0 3589      CPI	R24,0x59
    036E1 F460      BCC	0x36EE
    036E2 5F8F      SUBI	R24,0xFF
    036E3 9380 05D6 STS	time_buf+6,R24
(0514) 											 if((time_buf[6]&0x0f)==0x0a) time_buf[6]+=6;
    036E5 708F      ANDI	R24,0xF
    036E6 308A      CPI	R24,0xA
    036E7 F449      BNE	0x36F1
    036E8 9180 05D6 LDS	R24,time_buf+6
    036EA 5F8A      SUBI	R24,0xFA
    036EB 9380 05D6 STS	time_buf+6,R24
(0515) 										 }
    036ED C003      RJMP	0x36F1
(0516) 					  else time_buf[6]=0x00;
    036EE 2422      CLR	R2
    036EF 9220 05D6 STS	time_buf+6,R2
(0517) 					}						 
(0518) 		if(keyc==down){ if(time_buf[6]>0x00){  time_buf[6]--;	
    036F1 314D      CPI	R20,0x1D
    036F2 F4A9      BNE	0x3708
    036F3 E080      LDI	R24,0
    036F4 9020 05D6 LDS	R2,time_buf+6
    036F6 1582      CP	R24,R2
    036F7 F468      BCC	0x3705
    036F8 2D82      MOV	R24,R2
    036F9 5081      SUBI	R24,1
    036FA 9380 05D6 STS	time_buf+6,R24
(0519) 						if((time_buf[6]&0x0f)==0x0f) time_buf[6]-=6;
    036FC 708F      ANDI	R24,0xF
    036FD 308F      CPI	R24,0xF
    036FE F449      BNE	0x3708
    036FF 9180 05D6 LDS	R24,time_buf+6
    03701 5086      SUBI	R24,6
    03702 9380 05D6 STS	time_buf+6,R24
(0520) 					  }
    03704 C003      RJMP	0x3708
(0521) 		else time_buf[6]=0x59;		}				
    03705 E589      LDI	R24,0x59
    03706 9380 05D6 STS	time_buf+6,R24
(0522) 		if(keyc==left) {i=6;p=1;ary=NULL;}  
    03708 314B      CPI	R20,0x1B
    03709 F439      BNE	0x3711
    0370A E086      LDI	R24,6
    0370B 2EE8      MOV	R14,R24
    0370C 2400      CLR	R0
    0370D 9403      INC	R0
    0370E 860A      STD	Y+10,R0
    0370F 24CC      CLR	R12
    03710 24DD      CLR	R13
(0523) 		break;           
(0524) 							 
(0525) 		 }//endcase
(0526)  		 dateRefresh(88); //set clock mode
    03711 E508      LDI	R16,0x58
    03712 D214      RCALL	_dateRefresh
(0527) 		 
(0528) 		 LCD_const_disp(3,1,"                "); //清空箭头 
    03713 E38C      LDI	R24,0x3C
    03714 E094      LDI	R25,4
    03715 8399      STD	Y+1,R25
    03716 8388      ST	Y,R24
    03717 E021      LDI	R18,1
    03718 E003      LDI	R16,3
    03719 940E 3C8E CALL	_LCD_const_disp
(0529)  		 LCD_var_disp(3,p,ary); //显示箭头 
    0371B 82D9      STD	Y+1,R13
    0371C 82C8      ST	Y,R12
    0371D 852A      LDD	R18,Y+10
    0371E E003      LDI	R16,3
    0371F 940E 3CBB CALL	_LCD_var_disp
(0530)  		 LCD_var_disp(2,1,pD);  //显示日期
    03721 8408      LDD	R0,Y+8
    03722 8419      LDD	R1,Y+9
    03723 8219      STD	Y+1,R1
    03724 8208      ST	Y,R0
    03725 E021      LDI	R18,1
    03726 E002      LDI	R16,2
    03727 940E 3CBB CALL	_LCD_var_disp
(0531)  		 LCD_var_disp(4,1,pT);  //显示时间
    03729 82B9      STD	Y+1,R11
    0372A 82A8      ST	Y,R10
    0372B E021      LDI	R18,1
    0372C E004      LDI	R16,4
    0372D 940E 3CBB CALL	_LCD_var_disp
(0532)  if(keyc==right) {		  
    0372F 3147      CPI	R20,0x17
    03730 F479      BNE	0x3740
(0533)  		  LCD_const_disp(3,1,"        放弃修改"); 
    03731 E28B      LDI	R24,0x2B
    03732 E094      LDI	R25,4
    03733 8399      STD	Y+1,R25
    03734 8388      ST	Y,R24
    03735 E021      LDI	R18,1
    03736 E003      LDI	R16,3
    03737 940E 3C8E CALL	_LCD_const_disp
(0534) 		  delayms(500);
    03739 EF04      LDI	R16,0xF4
    0373A E011      LDI	R17,1
    0373B 940E 2532 CALL	_delayms
(0535) 		  LCD_CLR(); //清屏
    0373D 940E 3D34 CALL	_LCD_CLR
(0536) 		  return ;} 
    0373F C022      RJMP	0x3762
(0537)  keyc=NO_KEY;
    03740 2744      CLR	R20
(0538)  if(i==6){    //各值改变完成后 显示已保存 清屏 返回
    03741 2D8E      MOV	R24,R14
    03742 3086      CPI	R24,6
    03743 F4C9      BNE	0x375D
(0539) 		  ds1302_write_time(); 
    03744 940E 4247 CALL	_ds1302_write_time
(0540)           LCD_const_disp(4,7,"    ");		  
    03746 E286      LDI	R24,0x26
    03747 E094      LDI	R25,4
    03748 8399      STD	Y+1,R25
    03749 8388      ST	Y,R24
    0374A E027      LDI	R18,7
    0374B E004      LDI	R16,4
    0374C 940E 3C8E CALL	_LCD_const_disp
(0541) 		  LCD_const_disp(3,1,"          已保存"); 
    0374E E185      LDI	R24,0x15
    0374F E094      LDI	R25,4
    03750 8399      STD	Y+1,R25
    03751 8388      ST	Y,R24
    03752 E021      LDI	R18,1
    03753 E003      LDI	R16,3
    03754 940E 3C8E CALL	_LCD_const_disp
(0542) 		  delayms(300);
    03756 E20C      LDI	R16,0x2C
    03757 E011      LDI	R17,1
    03758 940E 2532 CALL	_delayms
(0543) 		  LCD_CLR(); //清屏
    0375A 940E 3D34 CALL	_LCD_CLR
(0544) 		  return ;
    0375C C005      RJMP	0x3762
(0545) 		  }
(0546)  delayms(2);	  
    0375D E002      LDI	R16,2
    0375E E010      LDI	R17,0
    0375F 940E 2532 CALL	_delayms
    03761 CE08      RJMP	0x356A
    03762 962B      ADIW	R28,0xB
    03763 940C 48A8 JMP	pop_xgsetF0FC
_GUI_readback:
  res                  --> R12
  file_buf             --> Y,+3
  page                 --> R20
  key                  --> R22
  buf                  --> R10
    03765 940E 48B3 CALL	push_xgsetF0FC
    03767 0158      MOVW	R10,R16
    03768 9760      SBIW	R28,0x10
(0547) }//endwhile(1)
(0548) }
(0549) void GUI_readback(char *buf){
(0550)     char key=0;
    03769 2766      CLR	R22
(0551) 	char page=0;
    0376A 2744      CLR	R20
(0552) 	char res=0;
    0376B 24CC      CLR	R12
(0553) 	char file_buf[]="201201.xls\0\0";
    0376C EA89      LDI	R24,0xA9
    0376D E093      LDI	R25,3
    0376E 01FE      MOVW	R30,R28
    0376F 9633      ADIW	R30,3
    03770 E00D      LDI	R16,0xD
    03771 E010      LDI	R17,0
    03772 93FA      ST	-Y,R31
    03773 93EA      ST	-Y,R30
    03774 939A      ST	-Y,R25
    03775 938A      ST	-Y,R24
    03776 940E 4963 CALL	asgnblk
(0554) 	LCD_CLR(); //清屏
    03778 940E 3D34 CALL	_LCD_CLR
(0555) 	//1 检测SD状态
(0556) 		//无SD卡 显示无卡 退出
(0557) 	if((SD_DET()==0)) {
    0377A B181      IN	R24,0x01
    0377B 9586      LSR	R24
    0377C 9586      LSR	R24
    0377D 9586      LSR	R24
    0377E 9586      LSR	R24
    0377F 9586      LSR	R24
    03780 7081      ANDI	R24,1
    03781 F421      BNE	0x3786
    03782 E081      LDI	R24,1
    03783 E090      LDI	R25,0
    03784 017C      MOVW	R14,R24
    03785 C002      RJMP	0x3788
    03786 24EE      CLR	R14
    03787 24FF      CLR	R15
    03788 20EE      TST	R14
    03789 F479      BNE	0x3799
    0378A 20FF      TST	R15
    0378B F469      BNE	0x3799
(0558) 		LCD_const_disp(2,1,"未检测到SD卡..");
    0378C E086      LDI	R24,6
    0378D E094      LDI	R25,4
    0378E 8399      STD	Y+1,R25
    0378F 8388      ST	Y,R24
    03790 E021      LDI	R18,1
    03791 E002      LDI	R16,2
    03792 940E 3C8E CALL	_LCD_const_disp
(0559) 			#ifdef _DBG_RD_
(0560) 		   PrintString_n("not find sd");
(0561) 		   #endif
(0562) 		delayms(500);
    03794 EF04      LDI	R16,0xF4
    03795 E011      LDI	R17,1
    03796 940E 2532 CALL	_delayms
(0563) 		return ;
    03798 C16E      RJMP	0x3907
(0564) 	}
(0565) 	//2 显示当前月份
(0566) 	get_name(file_buf);
    03799 018E      MOVW	R16,R28
    0379A 5F0D      SUBI	R16,0xFD
    0379B 4F1F      SBCI	R17,0xFF
    0379C 940E 2C5E CALL	_get_name
(0567) 	LCD_const_disp(1,1,"查找数据:");
    0379E EF8C      LDI	R24,0xFC
    0379F E093      LDI	R25,3
    037A0 8399      STD	Y+1,R25
    037A1 8388      ST	Y,R24
    037A2 E021      LDI	R18,1
    037A3 E001      LDI	R16,1
    037A4 940E 3C8E CALL	_LCD_const_disp
(0568) 	LCD_const_disp(2,2,file_buf);
    037A6 01CE      MOVW	R24,R28
    037A7 9603      ADIW	R24,3
    037A8 8399      STD	Y+1,R25
    037A9 8388      ST	Y,R24
    037AA E022      LDI	R18,2
    037AB E002      LDI	R16,2
    037AC 940E 3C8E CALL	_LCD_const_disp
(0569) 	#ifdef _DBG_RD_
(0570) 		   PrintString_n(file_buf);
(0571) 	#endif
(0572) 	//3 查找文件是否存在
(0573) 		//存在-> 进入读取顺序的选择
(0574) 		//不存在 -> 询问查找上月
(0575) 	//4 选择 查询顺序
(0576) 		//计算总条数
(0577) 		//顺序 增量为1， 查询第一条 
(0578) 		//逆序 增量为-1，查询最后一条
(0579) 	//5 读取	
(0580) 	//6 显示
(0581) 	//7 上一条 下一条  退出
(0582) 		//设置条数 判断边界 进入5
(0583) 		//退出 返回主程序	
(0584) 	//!!res=checkFile(file_buf);
(0585) label_recheck:	
(0586) 	LCD_Init(); //清屏
    037AE 940E 3D02 CALL	_LCD_Init
(0587) 	LCD_CLR();  
    037B0 940E 3D34 CALL	_LCD_CLR
(0588) 	if(res == 0){ //找到并已经确认文件
    037B2 20CC      TST	R12
    037B3 F009      BEQ	0x37B5
    037B4 C152      RJMP	0x3907
(0589) 		   LCD_const_disp(1,1,"菜单/ 查询");
    037B5 EF81      LDI	R24,0xF1
    037B6 E093      LDI	R25,3
    037B7 8399      STD	Y+1,R25
    037B8 8388      ST	Y,R24
    037B9 E021      LDI	R18,1
    037BA E001      LDI	R16,1
    037BB 940E 3C8E CALL	_LCD_const_disp
(0590)    		   LCD_const_disp(2,3,"按顺序");
    037BD EE8A      LDI	R24,0xEA
    037BE E093      LDI	R25,3
    037BF 8399      STD	Y+1,R25
    037C0 8388      ST	Y,R24
    037C1 E023      LDI	R18,3
    037C2 E002      LDI	R16,2
    037C3 940E 3C8E CALL	_LCD_const_disp
(0591) 		   LCD_const_disp(3,3,"最后一次");		 
    037C5 EE81      LDI	R24,0xE1
    037C6 E093      LDI	R25,3
    037C7 8399      STD	Y+1,R25
    037C8 8388      ST	Y,R24
    037C9 E023      LDI	R18,3
    037CA E003      LDI	R16,3
    037CB 940E 3C8E CALL	_LCD_const_disp
(0592) 	       if(config.readMode == READ_MODE_LAST){
    037CD 9020 08B3 LDS	R2,config+19
    037CF 2022      TST	R2
    037D0 F4A1      BNE	0x37E5
(0593) 		       config.readMode=READ_MODE_FIRST;
    037D1 E081      LDI	R24,1
    037D2 9380 08B3 STS	config+19,R24
(0594) 			   Set_White(1,2,8,0);
    037D4 2422      CLR	R2
    037D5 822A      STD	Y+2,R2
    037D6 E088      LDI	R24,0x8
    037D7 8388      ST	Y,R24
    037D8 E022      LDI	R18,2
    037D9 E001      LDI	R16,1
    037DA 940E 3DBE CALL	_Set_White
(0595)  			   Set_White(1,3,8,1);
    037DC E081      LDI	R24,1
    037DD 838A      STD	Y+2,R24
    037DE E088      LDI	R24,0x8
    037DF 8388      ST	Y,R24
    037E0 E023      LDI	R18,3
    037E1 E001      LDI	R16,1
    037E2 940E 3DBE CALL	_Set_White
(0596) 		  }
    037E4 C069      RJMP	0x384E
(0597) 		  else {
(0598) 		       config.readMode=READ_MODE_LAST;
    037E5 2422      CLR	R2
    037E6 9220 08B3 STS	config+19,R2
(0599) 			   Set_White(1,2,8,1);
    037E8 E081      LDI	R24,1
    037E9 838A      STD	Y+2,R24
    037EA E088      LDI	R24,0x8
    037EB 8388      ST	Y,R24
    037EC E022      LDI	R18,2
    037ED E001      LDI	R16,1
    037EE 940E 3DBE CALL	_Set_White
(0600)  			   Set_White(1,3,8,0);
    037F0 2422      CLR	R2
    037F1 822A      STD	Y+2,R2
    037F2 E088      LDI	R24,0x8
    037F3 8388      ST	Y,R24
    037F4 E023      LDI	R18,3
    037F5 E001      LDI	R16,1
    037F6 940E 3DBE CALL	_Set_White
(0601) 		 }
    037F8 C055      RJMP	0x384E
(0602) 		   // 菜单/查询   按顺序/最后一次
(0603) 		   while(1){
(0604)  		       key=kbscan();
    037F9 940E 4294 CALL	_kbscan
    037FB 2F60      MOV	R22,R16
(0605) 			   heaterSwitch();
    037FC 940E 25EB CALL	_heaterSwitch
(0606) 			   dateRefresh(0); //只刷新后台时间
    037FE 2700      CLR	R16
    037FF D127      RCALL	_dateRefresh
(0607) 			   //上键短按 选择
(0608) 			   if(key==up || key ==down){
    03800 316E      CPI	R22,0x1E
    03801 F011      BEQ	0x3804
    03802 316D      CPI	R22,0x1D
    03803 F559      BNE	0x382F
(0609) 	    	       if(config.readMode == READ_MODE_LAST){
    03804 9020 08B3 LDS	R2,config+19
    03806 2022      TST	R2
    03807 F4A1      BNE	0x381C
(0610) 		    	       config.readMode=READ_MODE_FIRST;
    03808 E081      LDI	R24,1
    03809 9380 08B3 STS	config+19,R24
(0611) 					   Set_White(1,2,8,0);
    0380B 2422      CLR	R2
    0380C 822A      STD	Y+2,R2
    0380D E088      LDI	R24,0x8
    0380E 8388      ST	Y,R24
    0380F E022      LDI	R18,2
    03810 E001      LDI	R16,1
    03811 940E 3DBE CALL	_Set_White
(0612)  					   Set_White(1,3,8,1);
    03813 E081      LDI	R24,1
    03814 838A      STD	Y+2,R24
    03815 E088      LDI	R24,0x8
    03816 8388      ST	Y,R24
    03817 E023      LDI	R18,3
    03818 E001      LDI	R16,1
    03819 940E 3DBE CALL	_Set_White
(0613) 				   }
    0381B C013      RJMP	0x382F
(0614) 				   else {
(0615) 		    	       config.readMode=READ_MODE_LAST;
    0381C 2422      CLR	R2
    0381D 9220 08B3 STS	config+19,R2
(0616) 					   Set_White(1,2,8,1);
    0381F E081      LDI	R24,1
    03820 838A      STD	Y+2,R24
    03821 E088      LDI	R24,0x8
    03822 8388      ST	Y,R24
    03823 E022      LDI	R18,2
    03824 E001      LDI	R16,1
    03825 940E 3DBE CALL	_Set_White
(0617)  					   Set_White(1,3,8,0);
    03827 2422      CLR	R2
    03828 822A      STD	Y+2,R2
    03829 E088      LDI	R24,0x8
    0382A 8388      ST	Y,R24
    0382B E023      LDI	R18,3
    0382C E001      LDI	R16,1
    0382D 940E 3DBE CALL	_Set_White
(0618) 				   }
(0619) 				}      
(0620) 				//左键短按  进入
(0621) 				if(key == left) {
    0382F 316B      CPI	R22,0x1B
    03830 F4A9      BNE	0x3846
(0622) 				    Set_White(1,2,8,1);
    03831 E081      LDI	R24,1
    03832 838A      STD	Y+2,R24
    03833 E088      LDI	R24,0x8
    03834 8388      ST	Y,R24
    03835 E022      LDI	R18,2
    03836 E001      LDI	R16,1
    03837 940E 3DBE CALL	_Set_White
(0623)  				    Set_White(1,3,8,1);
    03839 E081      LDI	R24,1
    0383A 838A      STD	Y+2,R24
    0383B E088      LDI	R24,0x8
    0383C 8388      ST	Y,R24
    0383D E023      LDI	R18,3
    0383E E001      LDI	R16,1
    0383F 940E 3DBE CALL	_Set_White
(0624) 					delayms(100);
    03841 E604      LDI	R16,0x64
    03842 E010      LDI	R17,0
    03843 940E 2532 CALL	_delayms
(0625) 				break ;		
    03845 C009      RJMP	0x384F
(0626) 				}
(0627) 				//右键短按  返回
(0628) 				if(key == right) {
    03846 3167      CPI	R22,0x17
    03847 F429      BNE	0x384D
(0629) 				    LCD_CLR();
    03848 940E 3D34 CALL	_LCD_CLR
(0630) 	    			LCD_Init(); //清屏
    0384A 940E 3D02 CALL	_LCD_Init
(0631) 					return ;	//返回主界面	
    0384C C0BA      RJMP	0x3907
(0632) 				}
(0633) 				key=0;
    0384D 2766      CLR	R22
    0384E CFAA      RJMP	0x37F9
(0634) 		    } //end of while
(0635) 			if(config.readMode==READ_MODE_LAST){
    0384F 9020 08B3 LDS	R2,config+19
    03851 2022      TST	R2
    03852 F461      BNE	0x385F
(0636) 			    ReadSDFile(file_buf,65535,buf,0); //最后一条
    03853 2422      CLR	R2
    03854 822A      STD	Y+2,R2
    03855 82B9      STD	Y+1,R11
    03856 82A8      ST	Y,R10
    03857 EF2F      LDI	R18,0xFF
    03858 EF3F      LDI	R19,0xFF
    03859 018E      MOVW	R16,R28
    0385A 5F0D      SUBI	R16,0xFD
    0385B 4F1F      SBCI	R17,0xFF
    0385C 940E 27D3 CALL	_ReadSDFile
(0637) 			}
    0385E C00B      RJMP	0x386A
(0638) 			else {
(0639) 			    ReadSDFile(file_buf,1,buf,0); //读第一条
    0385F 2422      CLR	R2
    03860 822A      STD	Y+2,R2
    03861 82B9      STD	Y+1,R11
    03862 82A8      ST	Y,R10
    03863 E021      LDI	R18,1
    03864 E030      LDI	R19,0
    03865 018E      MOVW	R16,R28
    03866 5F0D      SUBI	R16,0xFD
    03867 4F1F      SBCI	R17,0xFF
    03868 940E 27D3 CALL	_ReadSDFile
(0640) 			}
(0641) 			CharToStruct(buf);      //转换
    0386A 0185      MOVW	R16,R10
    0386B 940E 2C19 CALL	_CharToStruct
    0386D C098      RJMP	0x3906
(0642) 			while(1){
(0643) 			    key=kbscan();     //键盘扫描
    0386E 940E 4294 CALL	_kbscan
    03870 2F60      MOV	R22,R16
(0644) 				heaterSwitch();
    03871 940E 25EB CALL	_heaterSwitch
(0645) 				dateRefresh(0); //只刷新后台时间
    03873 2700      CLR	R16
    03874 D0B2      RCALL	_dateRefresh
(0646) 				if(key != 0){ 
    03875 2366      TST	R22
    03876 F021      BEQ	0x387B
(0647) 					   beep(0,1);
    03877 E021      LDI	R18,1
    03878 2700      CLR	R16
    03879 940E 400B CALL	_beep
(0648) 				}
(0649) 				//dateRefresh(0);  //刷新
(0650) 				_GUI_datashow(page); //显示
    0387B 2F04      MOV	R16,R20
    0387C DA5B      RCALL	__GUI_datashow
(0651) 				if( key==left ){ //按left键下一条
    0387D 316B      CPI	R22,0x1B
    0387E F4A1      BNE	0x3893
(0652) 					next_item:  //下一条
(0653) 				    ReadSDFile(file_buf,1,buf,1); //偏移到下一条
    0387F E081      LDI	R24,1
    03880 838A      STD	Y+2,R24
    03881 82B9      STD	Y+1,R11
    03882 82A8      ST	Y,R10
    03883 E021      LDI	R18,1
    03884 E030      LDI	R19,0
    03885 018E      MOVW	R16,R28
    03886 5F0D      SUBI	R16,0xFD
    03887 4F1F      SBCI	R17,0xFF
    03888 940E 27D3 CALL	_ReadSDFile
(0654) 					CharToStruct(buf);
    0388A 0185      MOVW	R16,R10
    0388B 940E 2C19 CALL	_CharToStruct
(0655) 					LCD_CLR();
    0388D 940E 3D34 CALL	_LCD_CLR
(0656) 		    		LCD_Init();
    0388F 940E 3D02 CALL	_LCD_Init
(0657) 					page = 0;
    03891 2744      CLR	R20
(0658) 					key=0;
    03892 2766      CLR	R22
(0659) 				}
(0660) 				if( key==lleft ){ //长按left键上一条
    03893 396B      CPI	R22,0x9B
    03894 F4A1      BNE	0x38A9
(0661) 		    	    pre_item: //上一条
(0662) 					ReadSDFile(file_buf,-1,buf,1); //偏移到上一条
    03895 E081      LDI	R24,1
    03896 838A      STD	Y+2,R24
    03897 82B9      STD	Y+1,R11
    03898 82A8      ST	Y,R10
    03899 EF2F      LDI	R18,0xFF
    0389A EF3F      LDI	R19,0xFF
    0389B 018E      MOVW	R16,R28
    0389C 5F0D      SUBI	R16,0xFD
    0389D 4F1F      SBCI	R17,0xFF
    0389E 940E 27D3 CALL	_ReadSDFile
(0663) 					CharToStruct(buf);
    038A0 0185      MOVW	R16,R10
    038A1 940E 2C19 CALL	_CharToStruct
(0664) 					LCD_CLR();
    038A3 940E 3D34 CALL	_LCD_CLR
(0665) 		    		LCD_Init();
    038A5 940E 3D02 CALL	_LCD_Init
(0666) 					page = 0;
    038A7 2744      CLR	R20
(0667) 					key=0;
    038A8 2766      CLR	R22
(0668) 				}
(0669) 				if(key==up){ //上键 : 页面减 
    038A9 316E      CPI	R22,0x1E
    038AA F441      BNE	0x38B3
(0670) 	    		     LCD_CLR();
    038AB 940E 3D34 CALL	_LCD_CLR
(0671) 		    		 LCD_Init();
    038AD 940E 3D02 CALL	_LCD_Init
(0672) 					 if(page>0) page--;
    038AF E080      LDI	R24,0
    038B0 1784      CP	R24,R20
    038B1 F718      BCC	0x3895
    038B2 954A      DEC	R20
(0673) 	    			 else{ 
(0674) 					    goto pre_item;
(0675) 					 }
(0676) 				}
(0677) 				if(key==lup){ //长按上键 : -10 条 
    038B3 396E      CPI	R22,0x9E
    038B4 F4A1      BNE	0x38C9
(0678) 	    		     LCD_CLR();
    038B5 940E 3D34 CALL	_LCD_CLR
(0679) 		    		 LCD_Init();
    038B7 940E 3D02 CALL	_LCD_Init
(0680) 					 ReadSDFile(file_buf,-10,buf,1); //偏移到下10条
    038B9 E081      LDI	R24,1
    038BA 838A      STD	Y+2,R24
    038BB 82B9      STD	Y+1,R11
    038BC 82A8      ST	Y,R10
    038BD EF26      LDI	R18,0xF6
    038BE EF3F      LDI	R19,0xFF
    038BF 018E      MOVW	R16,R28
    038C0 5F0D      SUBI	R16,0xFD
    038C1 4F1F      SBCI	R17,0xFF
    038C2 940E 27D3 CALL	_ReadSDFile
(0681) 					 CharToStruct(buf);
    038C4 0185      MOVW	R16,R10
    038C5 940E 2C19 CALL	_CharToStruct
(0682) 					 page = 0;
    038C7 2744      CLR	R20
(0683) 					 key = 0;
    038C8 2766      CLR	R22
(0684) 				}
(0685) 				if(key==down){ //下键 ： 页面加
    038C9 316D      CPI	R22,0x1D
    038CA F441      BNE	0x38D3
(0686) 					LCD_CLR();
    038CB 940E 3D34 CALL	_LCD_CLR
(0687) 		    		LCD_Init();
    038CD 940E 3D02 CALL	_LCD_Init
(0688) 					if(page<5) page++;
    038CF 3045      CPI	R20,5
    038D0 F008      BCS	0x38D2
    038D1 CFAD      RJMP	0x387F
    038D2 9543      INC	R20
(0689) 	  				else{
(0690) 						goto next_item;
(0691) 					}
(0692) 				}
(0693) 				if(key==ldown){ //长按下键 ： 页面加10条・
    038D3 396D      CPI	R22,0x9D
    038D4 F4A1      BNE	0x38E9
(0694) 					LCD_CLR();
    038D5 940E 3D34 CALL	_LCD_CLR
(0695) 		    		LCD_Init();
    038D7 940E 3D02 CALL	_LCD_Init
(0696) 					page = 0;
    038D9 2744      CLR	R20
(0697) 					key = 0;
    038DA 2766      CLR	R22
(0698) 	 				ReadSDFile(file_buf,10,buf,1); //偏移到下10条
    038DB E081      LDI	R24,1
    038DC 838A      STD	Y+2,R24
    038DD 82B9      STD	Y+1,R11
    038DE 82A8      ST	Y,R10
    038DF E02A      LDI	R18,0xA
    038E0 E030      LDI	R19,0
    038E1 018E      MOVW	R16,R28
    038E2 5F0D      SUBI	R16,0xFD
    038E3 4F1F      SBCI	R17,0xFF
    038E4 940E 27D3 CALL	_ReadSDFile
(0699) 					CharToStruct(buf);
    038E6 0185      MOVW	R16,R10
    038E7 940E 2C19 CALL	_CharToStruct
(0700) 				}
(0701) 				//右键短按  返回
(0702) 				if(key == right) {
    038E9 3167      CPI	R22,0x17
    038EA F429      BNE	0x38F0
(0703) 				    LCD_CLR();
    038EB 940E 3D34 CALL	_LCD_CLR
(0704) 		    		LCD_Init();
    038ED 940E 3D02 CALL	_LCD_Init
(0705) 					goto label_recheck;	   
    038EF CEBE      RJMP	0x37AE
(0706) 				}
(0707) 				if(page == 0 ){
    038F0 2344      TST	R20
    038F1 F481      BNE	0x3902
(0708) 					LCD_const_disp(4,1,"ID:             ");
    038F2 ED80      LDI	R24,0xD0
    038F3 E093      LDI	R25,3
    038F4 8399      STD	Y+1,R25
    038F5 8388      ST	Y,R24
    038F6 E021      LDI	R18,1
    038F7 E004      LDI	R16,4
    038F8 940E 3C8E CALL	_LCD_const_disp
(0709) 					LCD_const_disp(4,3,Result.IndexChar);
    038FA E38C      LDI	R24,0x3C
    038FB E096      LDI	R25,6
    038FC 8399      STD	Y+1,R25
    038FD 8388      ST	Y,R24
    038FE E023      LDI	R18,3
    038FF E004      LDI	R16,4
    03900 940E 3C8E CALL	_LCD_const_disp
(0710) 				}
(0711) 
(0712)     			delayms(30); 
    03902 E10E      LDI	R16,0x1E
    03903 E010      LDI	R17,0
    03904 940E 2532 CALL	_delayms
    03906 CF67      RJMP	0x386E
(0713) 		 }//end while
(0714) 		   
(0715) 	}
(0716) 	else { //未找到或未确认文件
(0717) 		 //逆序查找文件，直到月份小于 200001.xls
(0718) 		 //或是手工确认的方式
(0719) 	}
    03907 9660      ADIW	R28,0x10
    03908 940C 48A8 JMP	pop_xgsetF0FC
_GUI_welcome:
    0390A 9722      SBIW	R28,2
(0720) 
(0721) }
(0722) void GUI_welcome(void){
(0723)     LCD_CLR(); //清屏
    0390B 940E 3D34 CALL	_LCD_CLR
(0724) 	LCD_const_disp(2,3,"欢迎使用");
    0390D EC87      LDI	R24,0xC7
    0390E E093      LDI	R25,3
    0390F 8399      STD	Y+1,R25
    03910 8388      ST	Y,R24
    03911 E023      LDI	R18,3
    03912 E002      LDI	R16,2
    03913 940E 3C8E CALL	_LCD_const_disp
(0725) 	LCD_const_disp(3,1,"环境冷强度检测仪");
    03915 EB86      LDI	R24,0xB6
    03916 E093      LDI	R25,3
    03917 8399      STD	Y+1,R25
    03918 8388      ST	Y,R24
    03919 E021      LDI	R18,1
    0391A E003      LDI	R16,3
    0391B 940E 3C8E CALL	_LCD_const_disp
(0726) 	delayms(800);
    0391D E200      LDI	R16,0x20
    0391E E013      LDI	R17,3
    0391F 940E 2532 CALL	_delayms
(0727) 	beep(0,1);
    03921 E021      LDI	R18,1
    03922 2700      CLR	R16
    03923 940E 400B CALL	_beep
    03925 9622      ADIW	R28,2
    03926 9508      RET
_dateRefresh:
  readhardware         --> R20
    03927 934A      ST	-Y,R20
    03928 2F40      MOV	R20,R16
(0728) 	
(0729) }
(0730) 
(0731) ////////////////////////////////////
(0732) //  函数作用
(0733) //   将ds1302中缓存的时钟数据转换进结构体中
(0734) ////////////////////////////////////
(0735) void dateRefresh(unsigned char readhardware)
(0736) {	//readhardware = 0 not refresh, =1 refresh
(0737) 
(0738)  if( readhardware!=88 )	ds1302_read_time();
    03929 3548      CPI	R20,0x58
    0392A F011      BEQ	0x392D
    0392B 940E 426C CALL	_ds1302_read_time
(0739) 	t.tm_sec=(((time_buf[6]&0x70)>>4)*10)+(time_buf[6]&0x0f);
    0392D 9110 05D6 LDS	R17,time_buf+6
    0392F 7710      ANDI	R17,0x70
    03930 9512      SWAP	R17
    03931 701F      ANDI	R17,0xF
    03932 E00A      LDI	R16,0xA
    03933 0301      MULSU	R16,R17
    03934 0110      MOVW	R2,R0
    03935 9180 05D6 LDS	R24,time_buf+6
    03937 2799      CLR	R25
    03938 708F      ANDI	R24,0xF
    03939 7090      ANDI	R25,0
    0393A 0E28      ADD	R2,R24
    0393B 1E39      ADC	R3,R25
    0393C 9230 088F STS	t+1,R3
    0393E 9220 088E STS	t,R2
(0740) 	t.tm_min=  (((time_buf[5]&0x70)>>4)*10)+(time_buf[5]&0x0f);
    03940 9110 05D5 LDS	R17,time_buf+5
    03942 7710      ANDI	R17,0x70
    03943 9512      SWAP	R17
    03944 701F      ANDI	R17,0xF
    03945 0301      MULSU	R16,R17
    03946 0110      MOVW	R2,R0
    03947 9180 05D5 LDS	R24,time_buf+5
    03949 2799      CLR	R25
    0394A 708F      ANDI	R24,0xF
    0394B 7090      ANDI	R25,0
    0394C 0E28      ADD	R2,R24
    0394D 1E39      ADC	R3,R25
    0394E 9230 0891 STS	t+3,R3
    03950 9220 0890 STS	t+2,R2
(0741) 	t.tm_hour=  (((time_buf[4]&0x70)>>4)*10)+(time_buf[4]&0x0f);
    03952 9110 05D4 LDS	R17,time_buf+4
    03954 7710      ANDI	R17,0x70
    03955 9512      SWAP	R17
    03956 701F      ANDI	R17,0xF
    03957 0301      MULSU	R16,R17
    03958 0110      MOVW	R2,R0
    03959 9180 05D4 LDS	R24,time_buf+4
    0395B 2799      CLR	R25
    0395C 708F      ANDI	R24,0xF
    0395D 7090      ANDI	R25,0
    0395E 0E28      ADD	R2,R24
    0395F 1E39      ADC	R3,R25
    03960 9230 0893 STS	t+5,R3
    03962 9220 0892 STS	t+4,R2
(0742) 	t.tm_mday=	(((time_buf[3]&0x70)>>4)*10)+(time_buf[3]&0x0f);
    03964 9110 05D3 LDS	R17,time_buf+3
    03966 7710      ANDI	R17,0x70
    03967 9512      SWAP	R17
    03968 701F      ANDI	R17,0xF
    03969 0301      MULSU	R16,R17
    0396A 0110      MOVW	R2,R0
    0396B 9180 05D3 LDS	R24,time_buf+3
    0396D 2799      CLR	R25
    0396E 708F      ANDI	R24,0xF
    0396F 7090      ANDI	R25,0
    03970 0E28      ADD	R2,R24
    03971 1E39      ADC	R3,R25
    03972 9230 0895 STS	t+7,R3
    03974 9220 0894 STS	t+6,R2
(0743) 	t.tm_mon= (((time_buf[2]&0x70)>>4)*10)+(time_buf[2]&0x0f);
    03976 9110 05D2 LDS	R17,time_buf+2
    03978 7710      ANDI	R17,0x70
    03979 9512      SWAP	R17
    0397A 701F      ANDI	R17,0xF
    0397B 0301      MULSU	R16,R17
    0397C 0110      MOVW	R2,R0
    0397D 9180 05D2 LDS	R24,time_buf+2
    0397F 2799      CLR	R25
    03980 708F      ANDI	R24,0xF
    03981 7090      ANDI	R25,0
    03982 0E28      ADD	R2,R24
    03983 1E39      ADC	R3,R25
    03984 9230 0897 STS	t+9,R3
    03986 9220 0896 STS	t+8,R2
(0744) 	t.tm_wday=	(time_buf[7]&0x0f);
    03988 9180 05D7 LDS	R24,time_buf+7
    0398A 2799      CLR	R25
    0398B 708F      ANDI	R24,0xF
    0398C 7090      ANDI	R25,0
    0398D 9390 089B STS	t+13,R25
    0398F 9380 089A STS	t+12,R24
(0745)     t.tm_year=	(((time_buf[1]&0x70)>>4)*10)+(time_buf[1]&0x0f);
    03991 9110 05D1 LDS	R17,time_buf+1
    03993 7710      ANDI	R17,0x70
    03994 9512      SWAP	R17
    03995 701F      ANDI	R17,0xF
    03996 0301      MULSU	R16,R17
    03997 0110      MOVW	R2,R0
    03998 9180 05D1 LDS	R24,time_buf+1
    0399A 2799      CLR	R25
    0399B 708F      ANDI	R24,0xF
    0399C 7090      ANDI	R25,0
    0399D 0E28      ADD	R2,R24
    0399E 1E39      ADC	R3,R25
    0399F 9230 0899 STS	t+11,R3
    039A1 9220 0898 STS	t+10,R2
(0746) 	if(readhardware != 0){
    039A3 2344      TST	R20
    039A4 F409      BNE	0x39A6
    039A5 C09F      RJMP	0x3A45
(0747) 	Result.Date[0]='2';
    039A6 E382      LDI	R24,0x32
    039A7 9380 0644 STS	Result+22,R24
(0748) 	Result.Date[1]='0';
    039A9 E380      LDI	R24,0x30
    039AA 9380 0645 STS	Result+23,R24
(0749) 	Result.Date[2]=t.tm_year/10+'0';
    039AC E02A      LDI	R18,0xA
    039AD E030      LDI	R19,0
    039AE 0181      MOVW	R16,R2
    039AF 940E 4783 CALL	div16s
    039B1 01C8      MOVW	R24,R16
    039B2 96C0      ADIW	R24,0x30
    039B3 9380 0646 STS	Result+24,R24
(0750) 	Result.Date[3]=t.tm_year%10+'0';
    039B5 E02A      LDI	R18,0xA
    039B6 E030      LDI	R19,0
    039B7 9100 0898 LDS	R16,t+10
    039B9 9110 0899 LDS	R17,t+11
    039BB 940E 477F CALL	mod16s
    039BD 01C8      MOVW	R24,R16
    039BE 96C0      ADIW	R24,0x30
    039BF 9380 0647 STS	Result+25,R24
(0751) 	Result.Date[4]=t.tm_mon/10+'0';
    039C1 E02A      LDI	R18,0xA
    039C2 E030      LDI	R19,0
    039C3 9100 0896 LDS	R16,t+8
    039C5 9110 0897 LDS	R17,t+9
    039C7 940E 4783 CALL	div16s
    039C9 01C8      MOVW	R24,R16
    039CA 96C0      ADIW	R24,0x30
    039CB 9380 0648 STS	Result+26,R24
(0752) 	Result.Date[5]=t.tm_mon%10+'0';
    039CD E02A      LDI	R18,0xA
    039CE E030      LDI	R19,0
    039CF 9100 0896 LDS	R16,t+8
    039D1 9110 0897 LDS	R17,t+9
    039D3 940E 477F CALL	mod16s
    039D5 01C8      MOVW	R24,R16
    039D6 96C0      ADIW	R24,0x30
    039D7 9380 0649 STS	Result+27,R24
(0753) 	Result.Date[6]=t.tm_mday/10+'0';
    039D9 E02A      LDI	R18,0xA
    039DA E030      LDI	R19,0
    039DB 9100 0894 LDS	R16,t+6
    039DD 9110 0895 LDS	R17,t+7
    039DF 940E 4783 CALL	div16s
    039E1 01C8      MOVW	R24,R16
    039E2 96C0      ADIW	R24,0x30
    039E3 9380 064A STS	Result+28,R24
(0754) 	Result.Date[7]=t.tm_mday%10+'0';
    039E5 E02A      LDI	R18,0xA
    039E6 E030      LDI	R19,0
    039E7 9100 0894 LDS	R16,t+6
    039E9 9110 0895 LDS	R17,t+7
    039EB 940E 477F CALL	mod16s
    039ED 01C8      MOVW	R24,R16
    039EE 96C0      ADIW	R24,0x30
    039EF 9380 064B STS	Result+29,R24
(0755)     Result.Date[8]='\0';
    039F1 2422      CLR	R2
    039F2 9220 064C STS	Result+30,R2
(0756) 
(0757) 	Result.Time[0]=t.tm_hour/10+'0';
    039F4 E02A      LDI	R18,0xA
    039F5 E030      LDI	R19,0
    039F6 9100 0892 LDS	R16,t+4
    039F8 9110 0893 LDS	R17,t+5
    039FA 940E 4783 CALL	div16s
    039FC 01C8      MOVW	R24,R16
    039FD 96C0      ADIW	R24,0x30
    039FE 9380 064D STS	Result+31,R24
(0758) 	Result.Time[1]=t.tm_hour%10+'0';
    03A00 E02A      LDI	R18,0xA
    03A01 E030      LDI	R19,0
    03A02 9100 0892 LDS	R16,t+4
    03A04 9110 0893 LDS	R17,t+5
    03A06 940E 477F CALL	mod16s
    03A08 01C8      MOVW	R24,R16
    03A09 96C0      ADIW	R24,0x30
    03A0A 9380 064E STS	Result+32,R24
(0759) 	Result.Time[2]=':';
    03A0C E38A      LDI	R24,0x3A
    03A0D 9380 064F STS	Result+33,R24
(0760) 	//Result.Time[3]=' ';
(0761) 	Result.Time[3]=t.tm_min/10+'0';
    03A0F E02A      LDI	R18,0xA
    03A10 E030      LDI	R19,0
    03A11 9100 0890 LDS	R16,t+2
    03A13 9110 0891 LDS	R17,t+3
    03A15 940E 4783 CALL	div16s
    03A17 01C8      MOVW	R24,R16
    03A18 96C0      ADIW	R24,0x30
    03A19 9380 0650 STS	Result+34,R24
(0762) 	Result.Time[4]=t.tm_min%10+'0';
    03A1B E02A      LDI	R18,0xA
    03A1C E030      LDI	R19,0
    03A1D 9100 0890 LDS	R16,t+2
    03A1F 9110 0891 LDS	R17,t+3
    03A21 940E 477F CALL	mod16s
    03A23 01C8      MOVW	R24,R16
    03A24 96C0      ADIW	R24,0x30
    03A25 9380 0651 STS	Result+35,R24
(0763) 	Result.Time[5]=':';
    03A27 E38A      LDI	R24,0x3A
    03A28 9380 0652 STS	Result+36,R24
(0764) 	//Result.Time[7]=' ';
(0765) 	Result.Time[6]=t.tm_sec/10+'0';
    03A2A E02A      LDI	R18,0xA
    03A2B E030      LDI	R19,0
    03A2C 9100 088E LDS	R16,t
    03A2E 9110 088F LDS	R17,t+1
    03A30 940E 4783 CALL	div16s
    03A32 01C8      MOVW	R24,R16
    03A33 96C0      ADIW	R24,0x30
    03A34 9380 0653 STS	Result+37,R24
(0766) 	Result.Time[7]=t.tm_sec%10+'0';
    03A36 E02A      LDI	R18,0xA
    03A37 E030      LDI	R19,0
    03A38 9100 088E LDS	R16,t
    03A3A 9110 088F LDS	R17,t+1
    03A3C 940E 477F CALL	mod16s
    03A3E 01C8      MOVW	R24,R16
    03A3F 96C0      ADIW	R24,0x30
    03A40 9380 0654 STS	Result+38,R24
(0767) 	Result.Time[8]='\0'; 
    03A42 2422      CLR	R2
    03A43 9220 0655 STS	Result+39,R2
(0768) 	}
(0769)     config.now =t.tm_hour*3600 + t.tm_min*60 + t.tm_sec; //更新系统心跳
    03A45 9120 0890 LDS	R18,t+2
    03A47 9130 0891 LDS	R19,t+3
    03A49 E30C      LDI	R16,0x3C
    03A4A E010      LDI	R17,0
    03A4B 940E 484F CALL	empy16s
    03A4D 0118      MOVW	R2,R16
    03A4E 9120 0892 LDS	R18,t+4
    03A50 9130 0893 LDS	R19,t+5
    03A52 E100      LDI	R16,0x10
    03A53 E01E      LDI	R17,0xE
    03A54 940E 484F CALL	empy16s
    03A56 0128      MOVW	R4,R16
    03A57 0C42      ADD	R4,R2
    03A58 1C53      ADC	R5,R3
    03A59 9020 088E LDS	R2,t
    03A5B 9030 088F LDS	R3,t+1
    03A5D 0C42      ADD	R4,R2
    03A5E 1C53      ADC	R5,R3
    03A5F 0112      MOVW	R2,R4
    03A60 2444      CLR	R4
    03A61 FC37      SBRC	R3,7
    03A62 9440      COM	R4
    03A63 2455      CLR	R5
    03A64 FC47      SBRC	R4,7
    03A65 9450      COM	R5
    03A66 9230 08AD STS	config+13,R3
    03A68 9220 08AC STS	config+12,R2
    03A6A 9250 08AF STS	config+15,R5
    03A6C 9240 08AE STS	config+14,R4
    03A6E 9149      LD	R20,Y+
    03A6F 9508      RET
FILE: D:\LQD\software\software_src\usart.c
(0001) #include "config.h"
(0002) 
(0003) 
(0004) #define fosc 7372800UL //晶振7.3728MHZ
(0005) #define baud 38400  //波特率
(0006) //串口通信初始化  MEGA128
(0007) //UART1 initialize
(0008) // desired baud rate:38400
(0009) // actual baud rate:38400 (0.0%)
(0010) // char size: 8 bit
(0011) // parity: Disabled
(0012) void uart1_init(void)
(0013) {
(0014)  	 UCSR1B = 0x00; //disable while setting baud rate
_uart1_init:
    03A70 2422      CLR	R2
    03A71 9220 009A STS	0x9A,R2
(0015)      UCSR1A = 0x00;
    03A73 9220 009B STS	0x9B,R2
(0016)      UCSR1C = (1<<UCSZ11)|(1<<UCSZ10);//8bit+1bit stop
    03A75 E086      LDI	R24,6
    03A76 9380 009D STS	0x9D,R24
(0017)      UBRR1L=(fosc/16/(baud+1))%256;
    03A78 E08B      LDI	R24,0xB
    03A79 9380 0099 STS	0x99,R24
(0018)      UBRR1H=(fosc/16/(baud+1))/256;
    03A7B 9220 0098 STS	0x98,R2
(0019)      UCSR1B =(1<<RXEN1)|(1<<TXEN1);//RXCEN TXCEN
    03A7D E188      LDI	R24,0x18
    03A7E 9380 009A STS	0x9A,R24
    03A80 9508      RET
_uart1_rx_isr:
  tmp                  --> R16
    03A81 930A      ST	-Y,R16
    03A82 B70F      IN	R16,0x3F
    03A83 930A      ST	-Y,R16
(0020) }
(0021) 
(0022) #pragma interrupt_handler uart1_rx_isr:iv_USART1_RXC
(0023) void uart1_rx_isr(void){   
(0024) 	 char tmp;
(0025) 	 tmp=UDR1;
    03A84 9100 009C LDS	R16,0x9C
    03A86 9109      LD	R16,Y+
    03A87 BF0F      OUT	0x3F,R16
    03A88 9109      LD	R16,Y+
    03A89 9518      RETI
(0026) }
(0027) 
(0028) void Usart_Transmit(char c)
(0029) {
(0030)  	 while (!(UCSR1A&(1<<UDRE1)));//表明发送器一准备就绪
_Usart_Transmit:
  c                    --> R16
    03A8A 9020 009B LDS	R2,0x9B
    03A8C FE25      SBRS	R2,5
    03A8D CFFC      RJMP	_Usart_Transmit
(0031) 	 UDR1=c;
    03A8E 9300 009C STS	0x9C,R16
    03A90 9508      RET
_Puts:
  s                    --> R20
    03A91 934A      ST	-Y,R20
    03A92 935A      ST	-Y,R21
    03A93 01A8      MOVW	R20,R16
(0032) }
(0033) 
(0034) //串口输出字符串
(0035) void Puts( unsigned char *s)
(0036) { 
    03A94 C00B      RJMP	0x3AA0
(0037) 	 while (*s) 
(0038)       { 
(0039) 	  //为数据间的隔断创造一个串口能显示的隔断字符 即'/t'  ->  ' '
(0040) 	  if(*s==0x09)  
    03A95 01FA      MOVW	R30,R20
    03A96 8180      LD	R24,Z
    03A97 3089      CPI	R24,0x9
    03A98 F411      BNE	0x3A9B
(0041) 	  {   Usart_Transmit(' ');    }
    03A99 E200      LDI	R16,0x20
    03A9A DFEF      RCALL	_Usart_Transmit
(0042) 	 Usart_Transmit(*s);
    03A9B 01FA      MOVW	R30,R20
    03A9C 8100      LD	R16,Z
    03A9D DFEC      RCALL	_Usart_Transmit
(0043) 	 s++;
    03A9E 5F4F      SUBI	R20,0xFF
    03A9F 4F5F      SBCI	R21,0xFF
    03AA0 01FA      MOVW	R30,R20
    03AA1 8020      LD	R2,Z
    03AA2 2022      TST	R2
    03AA3 F789      BNE	0x3A95
    03AA4 9159      LD	R21,Y+
    03AA5 9149      LD	R20,Y+
    03AA6 9508      RET
_Send_nByte:
  i                    --> R20
  len                  --> R10
  p                    --> R12
    03AA7 940E 48E0 CALL	push_xgset303C
    03AA9 2EA2      MOV	R10,R18
    03AAA 0168      MOVW	R12,R16
(0044) 	
(0045) 	
(0046)       }
(0047) }
(0048) 
(0049) 
(0050) 
(0051) void Send_nByte(unsigned char *p, unsigned char len)
(0052) { 
(0053)   int i = 0;
(0054)   for(i=0;i<len;i++)
    03AAB 2744      CLR	R20
    03AAC 2755      CLR	R21
    03AAD C007      RJMP	0x3AB5
(0055)   {
(0056)    	Usart_Transmit(*(p+i));
    03AAE 01FA      MOVW	R30,R20
    03AAF 0DEC      ADD	R30,R12
    03AB0 1DFD      ADC	R31,R13
    03AB1 8100      LD	R16,Z
    03AB2 DFD7      RCALL	_Usart_Transmit
    03AB3 5F4F      SUBI	R20,0xFF
    03AB4 4F5F      SBCI	R21,0xFF
    03AB5 2C2A      MOV	R2,R10
    03AB6 2433      CLR	R3
    03AB7 1542      CP	R20,R2
    03AB8 0553      CPC	R21,R3
    03AB9 F3A4      BLT	0x3AAE
    03ABA 940C 48E7 JMP	pop_xgset303C
_PrintString:
  str                  --> R10
    03ABC 92AA      ST	-Y,R10
    03ABD 92BA      ST	-Y,R11
    03ABE 0158      MOVW	R10,R16
(0057)   }
(0058) }
(0059) 
(0060) void  PrintString(const unsigned char *str)
(0061) {    
    03ABF C004      RJMP	0x3AC4
(0062) 	while(*str!=0)	Usart_Transmit(*str++);
    03AC0 01F5      MOVW	R30,R10
    03AC1 9101      LD	R16,Z+
    03AC2 015F      MOVW	R10,R30
    03AC3 DFC6      RCALL	_Usart_Transmit
    03AC4 01F5      MOVW	R30,R10
    03AC5 8020      LD	R2,Z
    03AC6 2022      TST	R2
    03AC7 F7C1      BNE	0x3AC0
    03AC8 90B9      LD	R11,Y+
    03AC9 90A9      LD	R10,Y+
    03ACA 9508      RET
_PrintString_n:
  str                  --> R10
    03ACB 92AA      ST	-Y,R10
    03ACC 92BA      ST	-Y,R11
    03ACD 0158      MOVW	R10,R16
(0063) }
(0064) void  PrintString_n(const unsigned char *str)
(0065) {   
(0066) 	Usart_Transmit('\r');
    03ACE E00D      LDI	R16,0xD
    03ACF DFBA      RCALL	_Usart_Transmit
(0067) 	Usart_Transmit('\n'); 
    03AD0 E00A      LDI	R16,0xA
    03AD1 DFB8      RCALL	_Usart_Transmit
    03AD2 C004      RJMP	0x3AD7
(0068) 	while(*str!=0)	Usart_Transmit(*str++);
    03AD3 01F5      MOVW	R30,R10
    03AD4 9101      LD	R16,Z+
    03AD5 015F      MOVW	R10,R30
    03AD6 DFB3      RCALL	_Usart_Transmit
    03AD7 01F5      MOVW	R30,R10
    03AD8 8020      LD	R2,Z
    03AD9 2022      TST	R2
    03ADA F7C1      BNE	0x3AD3
    03ADB 90B9      LD	R11,Y+
    03ADC 90A9      LD	R10,Y+
    03ADD 9508      RET
_PrintLong:
  i                    --> R20
  da                   --> Y,+0
  data                 --> Y,+9
    03ADE 940E 476E CALL	push_arg4
    03AE0 934A      ST	-Y,R20
    03AE1 9728      SBIW	R28,0x8
(0069) 
(0070) } 
(0071)  
(0072) void PrintLong(unsigned long data)
(0073) {
(0074)  
(0075) 	unsigned char da[8];
(0076) 	unsigned char i;
(0077) 	for(i=0;i<8;i++)	da[i]=0;
    03AE2 2744      CLR	R20
    03AE3 C008      RJMP	0x3AEC
    03AE4 01CE      MOVW	R24,R28
    03AE5 2FE4      MOV	R30,R20
    03AE6 27FF      CLR	R31
    03AE7 0FE8      ADD	R30,R24
    03AE8 1FF9      ADC	R31,R25
    03AE9 2422      CLR	R2
    03AEA 8220      ST	Z,R2
    03AEB 9543      INC	R20
    03AEC 3048      CPI	R20,0x8
    03AED F3B0      BCS	0x3AE4
    03AEE C013      RJMP	0x3B02
(0078) 	while(data>=10000000L){ ++da[7];data-=10000000L;}
    03AEF 818F      LDD	R24,Y+7
    03AF0 5F8F      SUBI	R24,0xFF
    03AF1 838F      STD	Y+7,R24
    03AF2 E880      LDI	R24,0x80
    03AF3 E996      LDI	R25,0x96
    03AF4 E9A8      LDI	R26,0x98
    03AF5 E0B0      LDI	R27,0
    03AF6 8429      LDD	R2,Y+9
    03AF7 843A      LDD	R3,Y+10
    03AF8 844B      LDD	R4,Y+11
    03AF9 845C      LDD	R5,Y+12
    03AFA 1A28      SUB	R2,R24
    03AFB 0A39      SBC	R3,R25
    03AFC 0A4A      SBC	R4,R26
    03AFD 0A5B      SBC	R5,R27
    03AFE 8629      STD	Y+9,R2
    03AFF 863A      STD	Y+10,R3
    03B00 864B      STD	Y+11,R4
    03B01 865C      STD	Y+12,R5
    03B02 E880      LDI	R24,0x80
    03B03 E996      LDI	R25,0x96
    03B04 E9A8      LDI	R26,0x98
    03B05 E0B0      LDI	R27,0
    03B06 8429      LDD	R2,Y+9
    03B07 843A      LDD	R3,Y+10
    03B08 844B      LDD	R4,Y+11
    03B09 845C      LDD	R5,Y+12
    03B0A 1628      CP	R2,R24
    03B0B 0639      CPC	R3,R25
    03B0C 064A      CPC	R4,R26
    03B0D 065B      CPC	R5,R27
    03B0E F700      BCC	0x3AEF
(0079) 	if(da[7])	i=0;
    03B0F 802F      LDD	R2,Y+7
    03B10 2022      TST	R2
    03B11 F009      BEQ	0x3B13
    03B12 2744      CLR	R20
(0080) 	if(i==0)	Usart_Transmit('0'+da[7]);
    03B13 2344      TST	R20
    03B14 F4B9      BNE	0x3B2C
    03B15 810F      LDD	R16,Y+7
    03B16 5D00      SUBI	R16,0xD0
    03B17 DF72      RCALL	_Usart_Transmit
    03B18 C013      RJMP	0x3B2C
(0081) 	while(data>=1000000L) { ++da[6];data-=1000000L;}
    03B19 818E      LDD	R24,Y+6
    03B1A 5F8F      SUBI	R24,0xFF
    03B1B 838E      STD	Y+6,R24
    03B1C E480      LDI	R24,0x40
    03B1D E492      LDI	R25,0x42
    03B1E E0AF      LDI	R26,0xF
    03B1F E0B0      LDI	R27,0
    03B20 8429      LDD	R2,Y+9
    03B21 843A      LDD	R3,Y+10
    03B22 844B      LDD	R4,Y+11
    03B23 845C      LDD	R5,Y+12
    03B24 1A28      SUB	R2,R24
    03B25 0A39      SBC	R3,R25
    03B26 0A4A      SBC	R4,R26
    03B27 0A5B      SBC	R5,R27
    03B28 8629      STD	Y+9,R2
    03B29 863A      STD	Y+10,R3
    03B2A 864B      STD	Y+11,R4
    03B2B 865C      STD	Y+12,R5
    03B2C E480      LDI	R24,0x40
    03B2D E492      LDI	R25,0x42
    03B2E E0AF      LDI	R26,0xF
    03B2F E0B0      LDI	R27,0
    03B30 8429      LDD	R2,Y+9
    03B31 843A      LDD	R3,Y+10
    03B32 844B      LDD	R4,Y+11
    03B33 845C      LDD	R5,Y+12
    03B34 1628      CP	R2,R24
    03B35 0639      CPC	R3,R25
    03B36 064A      CPC	R4,R26
    03B37 065B      CPC	R5,R27
    03B38 F700      BCC	0x3B19
(0082) 	if(da[6])	i=0;
    03B39 802E      LDD	R2,Y+6
    03B3A 2022      TST	R2
    03B3B F009      BEQ	0x3B3D
    03B3C 2744      CLR	R20
(0083) 	if(i==0)	Usart_Transmit('0'+da[6]);
    03B3D 2344      TST	R20
    03B3E F4B9      BNE	0x3B56
    03B3F 810E      LDD	R16,Y+6
    03B40 5D00      SUBI	R16,0xD0
    03B41 DF48      RCALL	_Usart_Transmit
    03B42 C013      RJMP	0x3B56
(0084) 	while(data>=100000L)  { ++da[5];data-=100000L;}
    03B43 818D      LDD	R24,Y+5
    03B44 5F8F      SUBI	R24,0xFF
    03B45 838D      STD	Y+5,R24
    03B46 EA80      LDI	R24,0xA0
    03B47 E896      LDI	R25,0x86
    03B48 E0A1      LDI	R26,1
    03B49 E0B0      LDI	R27,0
    03B4A 8429      LDD	R2,Y+9
    03B4B 843A      LDD	R3,Y+10
    03B4C 844B      LDD	R4,Y+11
    03B4D 845C      LDD	R5,Y+12
    03B4E 1A28      SUB	R2,R24
    03B4F 0A39      SBC	R3,R25
    03B50 0A4A      SBC	R4,R26
    03B51 0A5B      SBC	R5,R27
    03B52 8629      STD	Y+9,R2
    03B53 863A      STD	Y+10,R3
    03B54 864B      STD	Y+11,R4
    03B55 865C      STD	Y+12,R5
    03B56 EA80      LDI	R24,0xA0
    03B57 E896      LDI	R25,0x86
    03B58 E0A1      LDI	R26,1
    03B59 E0B0      LDI	R27,0
    03B5A 8429      LDD	R2,Y+9
    03B5B 843A      LDD	R3,Y+10
    03B5C 844B      LDD	R4,Y+11
    03B5D 845C      LDD	R5,Y+12
    03B5E 1628      CP	R2,R24
    03B5F 0639      CPC	R3,R25
    03B60 064A      CPC	R4,R26
    03B61 065B      CPC	R5,R27
    03B62 F700      BCC	0x3B43
(0085) 	if(da[5])	i=0;
    03B63 802D      LDD	R2,Y+5
    03B64 2022      TST	R2
    03B65 F009      BEQ	0x3B67
    03B66 2744      CLR	R20
(0086) 	if(i==0)	Usart_Transmit('0'+da[5]);
    03B67 2344      TST	R20
    03B68 F4B9      BNE	0x3B80
    03B69 810D      LDD	R16,Y+5
    03B6A 5D00      SUBI	R16,0xD0
    03B6B DF1E      RCALL	_Usart_Transmit
    03B6C C013      RJMP	0x3B80
(0087) 	while(data>=10000L)   { ++da[4];data-=10000L;}
    03B6D 818C      LDD	R24,Y+4
    03B6E 5F8F      SUBI	R24,0xFF
    03B6F 838C      STD	Y+4,R24
    03B70 E180      LDI	R24,0x10
    03B71 E297      LDI	R25,0x27
    03B72 E0A0      LDI	R26,0
    03B73 E0B0      LDI	R27,0
    03B74 8429      LDD	R2,Y+9
    03B75 843A      LDD	R3,Y+10
    03B76 844B      LDD	R4,Y+11
    03B77 845C      LDD	R5,Y+12
    03B78 1A28      SUB	R2,R24
    03B79 0A39      SBC	R3,R25
    03B7A 0A4A      SBC	R4,R26
    03B7B 0A5B      SBC	R5,R27
    03B7C 8629      STD	Y+9,R2
    03B7D 863A      STD	Y+10,R3
    03B7E 864B      STD	Y+11,R4
    03B7F 865C      STD	Y+12,R5
    03B80 E180      LDI	R24,0x10
    03B81 E297      LDI	R25,0x27
    03B82 E0A0      LDI	R26,0
    03B83 E0B0      LDI	R27,0
    03B84 8429      LDD	R2,Y+9
    03B85 843A      LDD	R3,Y+10
    03B86 844B      LDD	R4,Y+11
    03B87 845C      LDD	R5,Y+12
    03B88 1628      CP	R2,R24
    03B89 0639      CPC	R3,R25
    03B8A 064A      CPC	R4,R26
    03B8B 065B      CPC	R5,R27
    03B8C F700      BCC	0x3B6D
(0088) 	if(da[4])	i=0;
    03B8D 802C      LDD	R2,Y+4
    03B8E 2022      TST	R2
    03B8F F009      BEQ	0x3B91
    03B90 2744      CLR	R20
(0089) 	if(i==0)	Usart_Transmit('0'+da[4]);
    03B91 2344      TST	R20
    03B92 F4B9      BNE	0x3BAA
    03B93 810C      LDD	R16,Y+4
    03B94 5D00      SUBI	R16,0xD0
    03B95 DEF4      RCALL	_Usart_Transmit
    03B96 C013      RJMP	0x3BAA
(0090) 	while(data>=1000L)    { ++da[3];data-=1000L;}
    03B97 818B      LDD	R24,Y+3
    03B98 5F8F      SUBI	R24,0xFF
    03B99 838B      STD	Y+3,R24
    03B9A EE88      LDI	R24,0xE8
    03B9B E093      LDI	R25,3
    03B9C E0A0      LDI	R26,0
    03B9D E0B0      LDI	R27,0
    03B9E 8429      LDD	R2,Y+9
    03B9F 843A      LDD	R3,Y+10
    03BA0 844B      LDD	R4,Y+11
    03BA1 845C      LDD	R5,Y+12
    03BA2 1A28      SUB	R2,R24
    03BA3 0A39      SBC	R3,R25
    03BA4 0A4A      SBC	R4,R26
    03BA5 0A5B      SBC	R5,R27
    03BA6 8629      STD	Y+9,R2
    03BA7 863A      STD	Y+10,R3
    03BA8 864B      STD	Y+11,R4
    03BA9 865C      STD	Y+12,R5
    03BAA EE88      LDI	R24,0xE8
    03BAB E093      LDI	R25,3
    03BAC E0A0      LDI	R26,0
    03BAD E0B0      LDI	R27,0
    03BAE 8429      LDD	R2,Y+9
    03BAF 843A      LDD	R3,Y+10
    03BB0 844B      LDD	R4,Y+11
    03BB1 845C      LDD	R5,Y+12
    03BB2 1628      CP	R2,R24
    03BB3 0639      CPC	R3,R25
    03BB4 064A      CPC	R4,R26
    03BB5 065B      CPC	R5,R27
    03BB6 F700      BCC	0x3B97
(0091) 	if(da[3])	i=0;
    03BB7 802B      LDD	R2,Y+3
    03BB8 2022      TST	R2
    03BB9 F009      BEQ	0x3BBB
    03BBA 2744      CLR	R20
(0092) 	if(i==0)	Usart_Transmit('0'+da[3]);
    03BBB 2344      TST	R20
    03BBC F4B9      BNE	0x3BD4
    03BBD 810B      LDD	R16,Y+3
    03BBE 5D00      SUBI	R16,0xD0
    03BBF DECA      RCALL	_Usart_Transmit
    03BC0 C013      RJMP	0x3BD4
(0093) 	while(data>=100L)     { ++da[2];data-=100L;}
    03BC1 818A      LDD	R24,Y+2
    03BC2 5F8F      SUBI	R24,0xFF
    03BC3 838A      STD	Y+2,R24
    03BC4 E684      LDI	R24,0x64
    03BC5 E090      LDI	R25,0
    03BC6 E0A0      LDI	R26,0
    03BC7 E0B0      LDI	R27,0
    03BC8 8429      LDD	R2,Y+9
    03BC9 843A      LDD	R3,Y+10
    03BCA 844B      LDD	R4,Y+11
    03BCB 845C      LDD	R5,Y+12
    03BCC 1A28      SUB	R2,R24
    03BCD 0A39      SBC	R3,R25
    03BCE 0A4A      SBC	R4,R26
    03BCF 0A5B      SBC	R5,R27
    03BD0 8629      STD	Y+9,R2
    03BD1 863A      STD	Y+10,R3
    03BD2 864B      STD	Y+11,R4
    03BD3 865C      STD	Y+12,R5
    03BD4 E684      LDI	R24,0x64
    03BD5 E090      LDI	R25,0
    03BD6 E0A0      LDI	R26,0
    03BD7 E0B0      LDI	R27,0
    03BD8 8429      LDD	R2,Y+9
    03BD9 843A      LDD	R3,Y+10
    03BDA 844B      LDD	R4,Y+11
    03BDB 845C      LDD	R5,Y+12
    03BDC 1628      CP	R2,R24
    03BDD 0639      CPC	R3,R25
    03BDE 064A      CPC	R4,R26
    03BDF 065B      CPC	R5,R27
    03BE0 F700      BCC	0x3BC1
(0094) 	if(da[2])	i=0;
    03BE1 802A      LDD	R2,Y+2
    03BE2 2022      TST	R2
    03BE3 F009      BEQ	0x3BE5
    03BE4 2744      CLR	R20
(0095) 	if(i==0)	Usart_Transmit('0'+da[2]);
    03BE5 2344      TST	R20
    03BE6 F4B9      BNE	0x3BFE
    03BE7 810A      LDD	R16,Y+2
    03BE8 5D00      SUBI	R16,0xD0
    03BE9 DEA0      RCALL	_Usart_Transmit
    03BEA C013      RJMP	0x3BFE
(0096) 	while(data>=10L)      { ++da[1];data-=10L;}
    03BEB 8189      LDD	R24,Y+1
    03BEC 5F8F      SUBI	R24,0xFF
    03BED 8389      STD	Y+1,R24
    03BEE E08A      LDI	R24,0xA
    03BEF E090      LDI	R25,0
    03BF0 E0A0      LDI	R26,0
    03BF1 E0B0      LDI	R27,0
    03BF2 8429      LDD	R2,Y+9
    03BF3 843A      LDD	R3,Y+10
    03BF4 844B      LDD	R4,Y+11
    03BF5 845C      LDD	R5,Y+12
    03BF6 1A28      SUB	R2,R24
    03BF7 0A39      SBC	R3,R25
    03BF8 0A4A      SBC	R4,R26
    03BF9 0A5B      SBC	R5,R27
    03BFA 8629      STD	Y+9,R2
    03BFB 863A      STD	Y+10,R3
    03BFC 864B      STD	Y+11,R4
    03BFD 865C      STD	Y+12,R5
    03BFE E08A      LDI	R24,0xA
    03BFF E090      LDI	R25,0
    03C00 E0A0      LDI	R26,0
    03C01 E0B0      LDI	R27,0
    03C02 8429      LDD	R2,Y+9
    03C03 843A      LDD	R3,Y+10
    03C04 844B      LDD	R4,Y+11
    03C05 845C      LDD	R5,Y+12
    03C06 1628      CP	R2,R24
    03C07 0639      CPC	R3,R25
    03C08 064A      CPC	R4,R26
    03C09 065B      CPC	R5,R27
    03C0A F700      BCC	0x3BEB
(0097) 	if(da[1])	i=0;
    03C0B 8029      LDD	R2,Y+1
    03C0C 2022      TST	R2
    03C0D F009      BEQ	0x3C0F
    03C0E 2744      CLR	R20
(0098) 	if(i==0)	Usart_Transmit('0'+da[1]);
    03C0F 2344      TST	R20
    03C10 F419      BNE	0x3C14
    03C11 8109      LDD	R16,Y+1
    03C12 5D00      SUBI	R16,0xD0
    03C13 DE76      RCALL	_Usart_Transmit
(0099) 	Usart_Transmit('0'+data);
    03C14 E380      LDI	R24,0x30
    03C15 E090      LDI	R25,0
    03C16 E0A0      LDI	R26,0
    03C17 E0B0      LDI	R27,0
    03C18 8429      LDD	R2,Y+9
    03C19 843A      LDD	R3,Y+10
    03C1A 844B      LDD	R4,Y+11
    03C1B 845C      LDD	R5,Y+12
    03C1C 0E28      ADD	R2,R24
    03C1D 1E39      ADC	R3,R25
    03C1E 1E4A      ADC	R4,R26
    03C1F 1E5B      ADC	R5,R27
    03C20 2D02      MOV	R16,R2
    03C21 DE68      RCALL	_Usart_Transmit
    03C22 9628      ADIW	R28,0x8
    03C23 9149      LD	R20,Y+
    03C24 9624      ADIW	R28,4
    03C25 9508      RET
_PrintChar:
  h                    --> R20
  d                    --> R22
    03C26 934A      ST	-Y,R20
    03C27 936A      ST	-Y,R22
    03C28 2F60      MOV	R22,R16
(0100)  
(0101) }
(0102)  
(0103) void PrintChar(unsigned char d)
(0104) {
(0105) 	unsigned char h=(d&0xF0)>>4;
    03C29 2F46      MOV	R20,R22
    03C2A 7F40      ANDI	R20,0xF0
    03C2B 9542      SWAP	R20
    03C2C 704F      ANDI	R20,0xF
(0106) 	if(h<10)	Usart_Transmit('0'+h);
    03C2D 304A      CPI	R20,0xA
    03C2E F420      BCC	0x3C33
    03C2F 2F04      MOV	R16,R20
    03C30 5D00      SUBI	R16,0xD0
    03C31 DE58      RCALL	_Usart_Transmit
    03C32 C003      RJMP	0x3C36
(0107) 	else		Usart_Transmit('A'-10+h);
    03C33 2F04      MOV	R16,R20
    03C34 5C09      SUBI	R16,0xC9
    03C35 DE54      RCALL	_Usart_Transmit
(0108) 	h=d&0x0f;
    03C36 2F46      MOV	R20,R22
    03C37 704F      ANDI	R20,0xF
(0109) 	if(h<10)	Usart_Transmit('0'+h);
    03C38 304A      CPI	R20,0xA
    03C39 F420      BCC	0x3C3E
    03C3A 2F04      MOV	R16,R20
    03C3B 5D00      SUBI	R16,0xD0
    03C3C DE4D      RCALL	_Usart_Transmit
    03C3D C003      RJMP	0x3C41
(0110) 	else		Usart_Transmit('A'-10+h);
    03C3E 2F04      MOV	R16,R20
    03C3F 5C09      SUBI	R16,0xC9
    03C40 DE49      RCALL	_Usart_Transmit
(0111) 	Usart_Transmit(' ');
    03C41 E200      LDI	R16,0x20
    03C42 DE47      RCALL	_Usart_Transmit
    03C43 9169      LD	R22,Y+
    03C44 9149      LD	R20,Y+
    03C45 9508      RET
FILE: D:\LQD\software\software_src\SPI.c
(0001) //*****************************************************************************//
(0002) //*								 
(0003) //*控制芯片：ATmgea128
(0004) //*开发环境：AVR Studio+GCC
(0005) //*隶属模块：SPI接口控制
(0006) //*****************************************************************************//
(0007) #include "SPI.h"
(0008) 
(0009) /******************************************************************
(0010) SPI接口函数初始化
(0011) ******************************************************************/
(0012) void SPI_IO_Init(void)
(0013) {
(0014) 	SPI_PORT |= (1<<SS);////拉高CS
_SPI_IO_Init:
    03C46 9AC0      SBI	0x18,0
(0015) 	SPI_DDR |= (1<<SCLK)|(1<<MOSI)|(1<<SS);////CS,CLK,MOSI设为输出
    03C47 B387      IN	R24,0x17
    03C48 6087      ORI	R24,7
    03C49 BB87      OUT	0x17,R24
(0016) 	SPI_DDR &=~(1<<MISO);//MISO设为输入
    03C4A 98BB      CBI	0x17,3
(0017) 	SPI_PORT |= (1<<SCLK);//拉高CLK
    03C4B 9AC1      SBI	0x18,1
(0018) 	SPI_High();//SPI高通
    03C4C E580      LDI	R24,0x50
    03C4D B98D      OUT	0x0D,R24
    03C4E 9A70      SBI	0x0E,0
    03C4F 9508      RET
(0019) }
(0020) /******************************************************************
(0021) SPI写一个字节
(0022) ******************************************************************/
(0023) void SPI_Write(UINT8 data)
(0024) {
(0025) 	SPDR = data;
_SPI_Write:
  data                 --> R16
    03C50 B90F      OUT	0x0F,R16
(0026) 	while ((SPSR&(1<<SPIF))==0);
    03C51 9B77      SBIS	0x0E,7
    03C52 CFFE      RJMP	0x3C51
    03C53 9508      RET
(0027) 	//loop_until_bit_is_set(SPSR,SPIF);
(0028) }
(0029) /******************************************************************
(0030) SPI读一个字节
(0031) ******************************************************************/
(0032) unsigned char SPI_Read(void)
(0033) {
(0034) 	SPDR = 0xFF;//写0xFF启动SPI
_SPI_Read:
    03C54 EF8F      LDI	R24,0xFF
    03C55 B98F      OUT	0x0F,R24
(0035) 	while ((SPSR&(1<<SPIF))==0);
    03C56 9B77      SBIS	0x0E,7
    03C57 CFFE      RJMP	0x3C56
(0036) 	//loop_until_bit_is_set(SPSR,SPIF);//等待SPIF为高电平
(0037) 	return  SPDR;//返回读取值
    03C58 B10F      IN	R16,0x0F
    03C59 9508      RET
FILE: D:\LQD\software\software_src\lcd.c
(0001) #include "config.h"
(0002) 
(0003) //此硬件引脚适合冷强度检测仪第2版电路  mega128
(0004) #define LCD_PIN_CS   4
(0005) #define LCD_PIN_SID  3
(0006) #define LCD_PIN_SCLK 2
(0007) #define LCD_PIN_RST  1
(0008) #define LCD_BACKLIGHT_SW		0
(0009) #define LCD_PORT PORTC
(0010) #define LCD_PIN_DDR DDRC
(0011) #define Set_CS()     LCD_PIN_DDR |= (1<<LCD_PIN_CS)  ;LCD_PORT |= (1<<LCD_PIN_CS) 
(0012) #define Set_SID()    LCD_PIN_DDR |= (1<<LCD_PIN_SID) ;LCD_PORT |= (1<<LCD_PIN_SID) 
(0013) #define Set_SCLK()   LCD_PIN_DDR |= (1<<LCD_PIN_SCLK);LCD_PORT |= (1<<LCD_PIN_SCLK) 
(0014) #define LCD_LIGHT_ON()   LCD_PIN_DDR |= (1<<LCD_BACKLIGHT_SW);LCD_PORT |= (1<<LCD_BACKLIGHT_SW) 
(0015) #define Set_RST()   LCD_PIN_DDR |= (1<<LCD_PIN_RST);LCD_PORT |= (1<<LCD_PIN_RST) 
(0016) 
(0017) #define Clr_CS()     LCD_PIN_DDR |= (1<<LCD_PIN_CS)  ;LCD_PORT &=~(1<<LCD_PIN_CS) 
(0018) #define Clr_SID()    LCD_PIN_DDR |= (1<<LCD_PIN_SID) ;LCD_PORT &=~(1<<LCD_PIN_SID) 
(0019) #define Clr_SCLK()   LCD_PIN_DDR |= (1<<LCD_PIN_SCLK);LCD_PORT &=~(1<<LCD_PIN_SCLK) 
(0020) #define LCD_LIGHT_OFF()   LCD_PIN_DDR |= (1<<LCD_BACKLIGHT_SW);LCD_PORT &=~(1<<LCD_BACKLIGHT_SW) 
(0021) #define Clr_RST()   LCD_PIN_DDR |= (1<<LCD_PIN_RST);LCD_PORT &=~(1<<LCD_PIN_RST) 
(0022)  
(0023) void W_1byte(unsigned char RW, unsigned char RS, unsigned char W_data); 
(0024) void Write_8bits(unsigned int W_bits); 
(0025) void LCD_Init(void); 
(0026) unsigned char LCD_INT(void); 
(0027) 
(0028) unsigned char LCD_SW(unsigned char i)
(0029) {
(0030)  if(i==0){
_LCD_SW:
  i                    --> R16
    03C5A 2300      TST	R16
    03C5B F421      BNE	0x3C60
(0031)  LCD_LIGHT_OFF();
    03C5C 9AA0      SBI	0x14,0
    03C5D 98A8      CBI	0x15,0
(0032)  return 0;
    03C5E 2700      CLR	R16
    03C5F C003      RJMP	0x3C63
(0033)  }
(0034)  else{
(0035)  LCD_LIGHT_ON();
    03C60 9AA0      SBI	0x14,0
    03C61 9AA8      SBI	0x15,0
(0036)  return 1;
    03C62 E001      LDI	R16,1
    03C63 9508      RET
(0037)  }
(0038)  
(0039) }
(0040)  
(0041) unsigned char LCD_INT(void) 
(0042) { 
(0043)   Clr_CS(); 
_LCD_INT:
    03C64 9AA4      SBI	0x14,4
    03C65 98AC      CBI	0x15,4
(0044)   Clr_SID(); 
    03C66 9AA3      SBI	0x14,3
    03C67 98AB      CBI	0x15,3
(0045)   Clr_SCLK(); 
    03C68 9AA2      SBI	0x14,2
    03C69 98AA      CBI	0x15,2
(0046)   LCD_Init(); 
    03C6A D097      RCALL	_LCD_Init
(0047)   return (0);
    03C6B 2700      CLR	R16
    03C6C 9508      RET
_address:
  a                    --> R20
  y                    --> R18
  x                    --> R16
    03C6D 940E 48C8 CALL	push_xgsetF000
(0048) } 
(0049)   
(0050) /******************************************************************** 
(0051) 函数 名：address
(0052) 入口参数：地址转换
(0053) 出口参数：无 
(0054) 函数作用： 
(0055) 说        明： 
(0056) ********************************************************************/ 
(0057) unsigned char address(unsigned char x,unsigned char y)
(0058) {  
(0059)  unsigned char a;
(0060) 
(0061) switch(x) 
    03C6F 2F60      MOV	R22,R16
    03C70 2777      CLR	R23
    03C71 3061      CPI	R22,1
    03C72 E0E0      LDI	R30,0
    03C73 077E      CPC	R23,R30
    03C74 F069      BEQ	0x3C82
    03C75 3062      CPI	R22,2
    03C76 E0E0      LDI	R30,0
    03C77 077E      CPC	R23,R30
    03C78 F059      BEQ	0x3C84
    03C79 3063      CPI	R22,3
    03C7A E0E0      LDI	R30,0
    03C7B 077E      CPC	R23,R30
    03C7C F049      BEQ	0x3C86
    03C7D 3064      CPI	R22,4
    03C7E E0E0      LDI	R30,0
    03C7F 077E      CPC	R23,R30
    03C80 F039      BEQ	0x3C88
    03C81 C007      RJMP	0x3C89
(0062) { 
(0063) case 1: 
(0064) {a=0x80;break;} 
    03C82 E840      LDI	R20,0x80
    03C83 C005      RJMP	0x3C89
(0065) case 2: 
(0066) {a=0x90;break;} 
    03C84 E940      LDI	R20,0x90
    03C85 C003      RJMP	0x3C89
(0067)   case 3: 
(0068) {a=0x88;break;} 
    03C86 E848      LDI	R20,0x88
    03C87 C001      RJMP	0x3C89
(0069)   case 4: 
(0070) {a=0x98;break;} 
    03C88 E948      LDI	R20,0x98
(0071) } 
(0072) a=a+y-1;
    03C89 0F42      ADD	R20,R18
    03C8A 5041      SUBI	R20,1
(0073) 
(0074) return a;
    03C8B 2F04      MOV	R16,R20
    03C8C 940C 48CD JMP	pop_xgsetF000
_LCD_const_disp:
  a                    --> R12
  i                    --> R20
  single_data          --> R10
  y                    --> R14
  x                    --> R12
    03C8E 940E 48B5 CALL	push_xgset30FC
    03C90 2EE2      MOV	R14,R18
    03C91 2EC0      MOV	R12,R16
    03C92 9721      SBIW	R28,1
    03C93 84A9      LDD	R10,Y+9
    03C94 84BA      LDD	R11,Y+10
(0075) }
(0076)  
(0077) //////////////////////////////////////////////////////////////
(0078) 
(0079) /******************************************************************** 
(0080) 函数 名：LCD_const_disp
(0081) 入口参数：x y  *single_data
(0082) 出口参数：无 
(0083) 函数作用：负责 显示一串常量
(0084) 说        明： 
(0085) ********************************************************************/ 
(0086) void LCD_const_disp(unsigned char x, unsigned char y, const unsigned char *single_data) 
(0087) { 
(0088) unsigned char  a,i; 
(0089) a=address(x,y);
    03C95 2D2E      MOV	R18,R14
    03C96 2D0C      MOV	R16,R12
    03C97 DFD5      RCALL	_address
    03C98 2EC0      MOV	R12,R16
(0090) W_1byte(0,0,a);     //显示的地址 
    03C99 82C8      ST	Y,R12
    03C9A 2722      CLR	R18
    03C9B 2700      CLR	R16
    03C9C D0B7      RCALL	_W_1byte
(0091)    for(i=0; single_data[i]!='\0';i++) 
    03C9D 2744      CLR	R20
    03C9E C00D      RJMP	0x3CAC
(0092)    {
(0093)     if(i>=16) break; 
    03C9F 3140      CPI	R20,0x10
    03CA0 F008      BCS	0x3CA2
    03CA1 C011      RJMP	0x3CB3
(0094)     W_1byte(0,1,single_data[i]); 
    03CA2 2FE4      MOV	R30,R20
    03CA3 27FF      CLR	R31
    03CA4 0DEA      ADD	R30,R10
    03CA5 1DFB      ADC	R31,R11
    03CA6 8020      LD	R2,Z
    03CA7 8228      ST	Y,R2
    03CA8 E021      LDI	R18,1
    03CA9 2700      CLR	R16
    03CAA D0A9      RCALL	_W_1byte
    03CAB 9543      INC	R20
    03CAC 2FE4      MOV	R30,R20
    03CAD 27FF      CLR	R31
    03CAE 0DEA      ADD	R30,R10
    03CAF 1DFB      ADC	R31,R11
    03CB0 8020      LD	R2,Z
    03CB1 2022      TST	R2
    03CB2 F761      BNE	0x3C9F
(0095)     
(0096)    } 
(0097)    W_1byte(0,0,0XFF); // 移走地址指针 防止下一输入内容的干扰
    03CB3 EF8F      LDI	R24,0xFF
    03CB4 8388      ST	Y,R24
    03CB5 2722      CLR	R18
    03CB6 2700      CLR	R16
    03CB7 D09C      RCALL	_W_1byte
    03CB8 9621      ADIW	R28,1
    03CB9 940C 489F JMP	pop_xgset30FC
_LCD_var_disp:
  a                    --> R12
  i                    --> R20
  single_data          --> R10
  y                    --> R14
  x                    --> R12
    03CBB 940E 48B5 CALL	push_xgset30FC
    03CBD 2EE2      MOV	R14,R18
    03CBE 2EC0      MOV	R12,R16
    03CBF 9721      SBIW	R28,1
    03CC0 84A9      LDD	R10,Y+9
    03CC1 84BA      LDD	R11,Y+10
(0098)  
(0099) } 
(0100) 
(0101) /******************************************************************** 
(0102) 函数 名：LCD_var_disp
(0103) 入口参数：single_row single_line  *single_data
(0104) 出口参数：无 
(0105) 函数作用：负责 显示一串变量
(0106) 说        明： 
(0107) ********************************************************************/ 
(0108) 
(0109) void LCD_var_disp(unsigned char x, unsigned char y, unsigned char *single_data) 
(0110) { 
(0111) unsigned char  a,i; 
(0112) 
(0113) #if _debug == 1 
(0114) 	PrintString_n(single_data);
(0115) #endif 
(0116) 
(0117) a=address( x,y);
    03CC2 2D2E      MOV	R18,R14
    03CC3 2D0C      MOV	R16,R12
    03CC4 DFA8      RCALL	_address
    03CC5 2EC0      MOV	R12,R16
(0118) W_1byte(0,0,a);     //显示的地址0x88 
    03CC6 82C8      ST	Y,R12
    03CC7 2722      CLR	R18
    03CC8 2700      CLR	R16
    03CC9 D08A      RCALL	_W_1byte
(0119) 
(0120) for(i=0; single_data[i]!='\0';i++) 
    03CCA 2744      CLR	R20
    03CCB C00D      RJMP	0x3CD9
(0121)    { 
(0122)     if(i>=16) break;
    03CCC 3140      CPI	R20,0x10
    03CCD F008      BCS	0x3CCF
    03CCE C011      RJMP	0x3CE0
(0123)     W_1byte(0,1,single_data[i]); 
    03CCF 2FE4      MOV	R30,R20
    03CD0 27FF      CLR	R31
    03CD1 0DEA      ADD	R30,R10
    03CD2 1DFB      ADC	R31,R11
    03CD3 8020      LD	R2,Z
    03CD4 8228      ST	Y,R2
    03CD5 E021      LDI	R18,1
    03CD6 2700      CLR	R16
    03CD7 D07C      RCALL	_W_1byte
    03CD8 9543      INC	R20
    03CD9 2FE4      MOV	R30,R20
    03CDA 27FF      CLR	R31
    03CDB 0DEA      ADD	R30,R10
    03CDC 1DFB      ADC	R31,R11
    03CDD 8020      LD	R2,Z
    03CDE 2022      TST	R2
    03CDF F761      BNE	0x3CCC
(0124) 	} 
(0125)   W_1byte(0,0,0XFF); // 移走地址指针 防止下一输入内容的干扰
    03CE0 EF8F      LDI	R24,0xFF
    03CE1 8388      ST	Y,R24
    03CE2 2722      CLR	R18
    03CE3 2700      CLR	R16
    03CE4 D06F      RCALL	_W_1byte
    03CE5 9621      ADIW	R28,1
    03CE6 940C 489F JMP	pop_xgset30FC
_LCD_char_disp:
  a                    --> R12
  data                 --> R10
  y                    --> R14
  x                    --> R12
    03CE8 940E 48B7 CALL	push_xgset00FC
    03CEA 2EE2      MOV	R14,R18
    03CEB 2EC0      MOV	R12,R16
    03CEC 9721      SBIW	R28,1
    03CED 80AF      LDD	R10,Y+7
(0126) } 
(0127) /******************************************************************** 
(0128) 函数 名：LCD_char_disp
(0129) 入口参数：single_row single_line  data
(0130) 出口参数：无 
(0131) 函数作用：负责 显示一个 变量
(0132) 说        明： 
(0133) ********************************************************************/ 
(0134) 
(0135) void LCD_char_disp(unsigned char x, unsigned char y, unsigned char data) 
(0136) { 
(0137) unsigned char a; 
(0138) a=address(x,y);
    03CEE 2D2E      MOV	R18,R14
    03CEF 2D0C      MOV	R16,R12
    03CF0 DF7C      RCALL	_address
    03CF1 2EC0      MOV	R12,R16
(0139) W_1byte(0,0,a);     //显示的地址 
    03CF2 82C8      ST	Y,R12
    03CF3 2722      CLR	R18
    03CF4 2700      CLR	R16
    03CF5 D05E      RCALL	_W_1byte
(0140) W_1byte(0,1,data);  //显示内容
    03CF6 82A8      ST	Y,R10
    03CF7 E021      LDI	R18,1
    03CF8 2700      CLR	R16
    03CF9 D05A      RCALL	_W_1byte
(0141)  
(0142)   W_1byte(0,0,0XFF); // 移走地址指针 防止下一输入内容的干扰
    03CFA EF8F      LDI	R24,0xFF
    03CFB 8388      ST	Y,R24
    03CFC 2722      CLR	R18
    03CFD 2700      CLR	R16
    03CFE D055      RCALL	_W_1byte
    03CFF 9621      ADIW	R28,1
    03D00 940C 4898 JMP	pop_xgset00FC
_LCD_Init:
  cmd                  --> R20
    03D02 934A      ST	-Y,R20
    03D03 9721      SBIW	R28,1
(0143) } 
(0144) 
(0145) /******************************************************************** 
(0146) 函数 名：LCD_Init
(0147) 入口参数：无
(0148) 出口参数：unsigned char  0/1
(0149) 函数作用：负责 清空液晶显示
(0150) 说        明： 
(0151) ********************************************************************/ 
(0152) void LCD_Init(void) 
(0153) { 
(0154)    unsigned char cmd; 
(0155)    cmd=0x30;      //功能设置 8 位数据，基本指令 
    03D04 E340      LDI	R20,0x30
(0156)   W_1byte(0,0,cmd); 
    03D05 8348      ST	Y,R20
    03D06 2722      CLR	R18
    03D07 2700      CLR	R16
    03D08 D04B      RCALL	_W_1byte
(0157)   delayms(2); 
    03D09 E002      LDI	R16,2
    03D0A E010      LDI	R17,0
    03D0B 940E 2532 CALL	_delayms
(0158)   cmd=0x0C;      //显示状态 ON，游标OFF，反白OFF 
    03D0D E04C      LDI	R20,0xC
(0159)   W_1byte(0,0,cmd); //写指令 
    03D0E 8348      ST	Y,R20
    03D0F 2722      CLR	R18
    03D10 2700      CLR	R16
    03D11 D042      RCALL	_W_1byte
(0160)   delayms(2); 
    03D12 E002      LDI	R16,2
    03D13 E010      LDI	R17,0
    03D14 940E 2532 CALL	_delayms
(0161)   cmd=0x01;      //清除显示 
    03D16 E041      LDI	R20,1
(0162)   W_1byte(0,0,cmd); //写指令 
    03D17 8348      ST	Y,R20
    03D18 2722      CLR	R18
    03D19 2700      CLR	R16
    03D1A D039      RCALL	_W_1byte
(0163)   delayms(2); 
    03D1B E002      LDI	R16,2
    03D1C E010      LDI	R17,0
    03D1D 940E 2532 CALL	_delayms
(0164)   cmd=0x02;      //地址归位 
    03D1F E042      LDI	R20,2
(0165)   W_1byte(0,0,cmd); //写指令 
    03D20 8348      ST	Y,R20
    03D21 2722      CLR	R18
    03D22 2700      CLR	R16
    03D23 D030      RCALL	_W_1byte
(0166)   delayms(2); 
    03D24 E002      LDI	R16,2
    03D25 E010      LDI	R17,0
    03D26 940E 2532 CALL	_delayms
(0167)   cmd=0x80;      //设置DDRAM 地址 
    03D28 E840      LDI	R20,0x80
(0168)   W_1byte(0,0,cmd); //写指令 
    03D29 8348      ST	Y,R20
    03D2A 2722      CLR	R18
    03D2B 2700      CLR	R16
    03D2C D027      RCALL	_W_1byte
(0169)   delayms(2);     //延时 
    03D2D E002      LDI	R16,2
    03D2E E010      LDI	R17,0
    03D2F 940E 2532 CALL	_delayms
    03D31 9621      ADIW	R28,1
    03D32 9149      LD	R20,Y+
    03D33 9508      RET
_LCD_CLR:
  cmd                  --> R20
    03D34 934A      ST	-Y,R20
    03D35 9721      SBIW	R28,1
(0170) } 
(0171) 
(0172) void LCD_CLR(void)
(0173) {
(0174) unsigned char cmd;
(0175)   cmd=0x01;      //清除显示 
    03D36 E041      LDI	R20,1
(0176)   W_1byte(0,0,cmd); //写指令 
    03D37 8348      ST	Y,R20
    03D38 2722      CLR	R18
    03D39 2700      CLR	R16
    03D3A D019      RCALL	_W_1byte
(0177)   delayms(1); 
    03D3B E001      LDI	R16,1
    03D3C E010      LDI	R17,0
    03D3D 940E 2532 CALL	_delayms
(0178)   cmd=0x02;      //地址归位 
    03D3F E042      LDI	R20,2
(0179)   W_1byte(0,0,cmd); //写指令 
    03D40 8348      ST	Y,R20
    03D41 2722      CLR	R18
    03D42 2700      CLR	R16
    03D43 D010      RCALL	_W_1byte
(0180)   delayms(1); 
    03D44 E001      LDI	R16,1
    03D45 E010      LDI	R17,0
    03D46 940E 2532 CALL	_delayms
(0181)   cmd=0x80;      //设置DDRAM 地址 
    03D48 E840      LDI	R20,0x80
(0182)   W_1byte(0,0,cmd); //写指令 
    03D49 8348      ST	Y,R20
    03D4A 2722      CLR	R18
    03D4B 2700      CLR	R16
    03D4C D007      RCALL	_W_1byte
(0183)   delayms(1);     //延时
    03D4D E001      LDI	R16,1
    03D4E E010      LDI	R17,0
    03D4F 940E 2532 CALL	_delayms
    03D51 9621      ADIW	R28,1
    03D52 9149      LD	R20,Y+
    03D53 9508      RET
_W_1byte:
  H_data               --> R22
  S_ID                 --> R10
  L_data               --> R20
  W_data               --> R12
  RS                   --> R14
  RW                   --> R20
    03D54 940E 48B3 CALL	push_xgsetF0FC
    03D56 2EE2      MOV	R14,R18
    03D57 2F40      MOV	R20,R16
    03D58 84CA      LDD	R12,Y+10
(0184) 
(0185) }
(0186)  
(0187) /*******************************************************************
(0188) 函 数 名：W_1byte
(0189) 入口参数：RW、RS、W_data
(0190) 出口参数：无
(0191) 建立日期：2007年3月3日
(0192) 修改日期：
(0193) 函数作用：写一个字节的数据到12864液晶，包括指令和数据
(0194) 说    明：RW=1，从液晶读数据到MCU；RW=0，写一个数据到液晶；
(0195) 		 （一般RW都设为0，即只向液晶写数据，不读数据）
(0196)           RS=1，写入的是数据；RS=0，写入的是指令；
(0197) 		  一般模式：RW=0，RS=1;写数据
(0198) 		  			RW=0，RS=0;写指令
(0199) ********************************************************************/
(0200) void W_1byte(unsigned char RW, unsigned char RS, unsigned char W_data)
(0201) {
(0202) 	unsigned int H_data,L_data,S_ID = 0xf8;	 //11111RWRS0
    03D59 EF88      LDI	R24,0xF8
    03D5A E090      LDI	R25,0
    03D5B 015C      MOVW	R10,R24
(0203) 	if(RW == 0)
    03D5C 2344      TST	R20
    03D5D F419      BNE	0x3D61
(0204) 	{
(0205) 	 	S_ID &=~ 0x04;
    03D5E 7F8B      ANDI	R24,0xFB
    03D5F 015C      MOVW	R10,R24
(0206) 	}
    03D60 C003      RJMP	0x3D64
(0207) 	else					//if(RW==1)
(0208) 	{
(0209) 	 	S_ID |= 0X04;
    03D61 01C5      MOVW	R24,R10
    03D62 6084      ORI	R24,4
    03D63 015C      MOVW	R10,R24
(0210) 	}
(0211) 	if(RS == 0)
    03D64 20EE      TST	R14
    03D65 F421      BNE	0x3D6A
(0212) 	{
(0213) 	 	S_ID &=~ 0x02;
    03D66 01C5      MOVW	R24,R10
    03D67 7F8D      ANDI	R24,0xFD
    03D68 015C      MOVW	R10,R24
(0214) 	}
    03D69 C003      RJMP	0x3D6D
(0215) 	else					//if(RS==1)
(0216) 	{
(0217) 	 	S_ID |= 0X02;
    03D6A 01C5      MOVW	R24,R10
    03D6B 6082      ORI	R24,2
    03D6C 015C      MOVW	R10,R24
(0218) 	}
(0219) 	H_data = W_data;
    03D6D 2D6C      MOV	R22,R12
    03D6E 2777      CLR	R23
(0220) 	H_data &= 0xf0;			//屏蔽低4位的数据
    03D6F 7F60      ANDI	R22,0xF0
    03D70 7070      ANDI	R23,0
(0221) 	L_data = W_data;	   	//xxxx0000格式
    03D71 2D4C      MOV	R20,R12
    03D72 2755      CLR	R21
(0222) 	L_data &= 0x0f;			//屏蔽高4位的数据
    03D73 704F      ANDI	R20,0xF
    03D74 7050      ANDI	R21,0
(0223) 	L_data <<= 4;			//xxxx0000格式
    03D75 0F44      LSL	R20
    03D76 1F55      ROL	R21
    03D77 0F44      LSL	R20
    03D78 1F55      ROL	R21
    03D79 0F44      LSL	R20
    03D7A 1F55      ROL	R21
    03D7B 0F44      LSL	R20
    03D7C 1F55      ROL	R21
(0224) 	Set_CS();
    03D7D 9AA4      SBI	0x14,4
    03D7E 9AAC      SBI	0x15,4
(0225) 	Write_8bits(S_ID); 		//发送S_ID
    03D7F 0185      MOVW	R16,R10
    03D80 D00C      RCALL	_Write_8bits
(0226) 	Write_8bits(H_data);	//发送H_data
    03D81 018B      MOVW	R16,R22
    03D82 D00A      RCALL	_Write_8bits
(0227) 	Write_8bits(L_data);	//发送L_data
    03D83 018A      MOVW	R16,R20
    03D84 D008      RCALL	_Write_8bits
(0228) 	Clr_CS();	Clr_CS();	Clr_CS();	
    03D85 9AA4      SBI	0x14,4
    03D86 98AC      CBI	0x15,4
    03D87 9AA4      SBI	0x14,4
    03D88 98AC      CBI	0x15,4
    03D89 9AA4      SBI	0x14,4
    03D8A 98AC      CBI	0x15,4
    03D8B 940C 48A8 JMP	pop_xgsetF0FC
_Write_8bits:
  Temp_data            --> R12
  i                    --> R20
  W_bits               --> R10
    03D8D 940E 48E0 CALL	push_xgset303C
    03D8F 0158      MOVW	R10,R16
(0229) 	 
(0230) 
(0231) }
(0232) /********************************************************************
(0233) 函 数 名：Write_8bits
(0234) 入口参数：W_bits
(0235) 出口参数：无
(0236) 建立日期：2007年3月3日
(0237) 修改日期：
(0238) 函数作用：负责串行输出8个bit位
(0239) 说    明：
(0240) ********************************************************************/
(0241) void Write_8bits(unsigned int W_bits)
(0242) {
(0243) 	unsigned int i,Temp_data;
(0244) 	for(i=0; i<8; i++)
    03D90 2744      CLR	R20
    03D91 2755      CLR	R21
    03D92 C019      RJMP	0x3DAC
(0245) 	{
(0246) 		Temp_data = W_bits;
    03D93 0165      MOVW	R12,R10
(0247) 		Temp_data <<= i;
    03D94 019A      MOVW	R18,R20
    03D95 0186      MOVW	R16,R12
    03D96 940E 4937 CALL	lsl16
    03D98 0168      MOVW	R12,R16
(0248) 		if((Temp_data&0x80)==0) 
    03D99 FD07      SBRC	R16,7
    03D9A C003      RJMP	0x3D9E
(0249) 		{
(0250) 		 	Clr_SID();
    03D9B 9AA3      SBI	0x14,3
    03D9C 98AB      CBI	0x15,3
(0251) 		}
    03D9D C002      RJMP	0x3DA0
(0252) 		else
(0253) 		{
(0254) 		 	Set_SID();
    03D9E 9AA3      SBI	0x14,3
    03D9F 9AAB      SBI	0x15,3
(0255) 		} 
(0256) 		NOP();
    03DA0 0000      NOP
(0257) 		Set_SCLK();
    03DA1 9AA2      SBI	0x14,2
    03DA2 9AAA      SBI	0x15,2
(0258) 		NOP();
    03DA3 0000      NOP
(0259) 		NOP();
    03DA4 0000      NOP
(0260) 		Clr_SCLK();
    03DA5 9AA2      SBI	0x14,2
    03DA6 98AA      CBI	0x15,2
(0261) 		NOP();
    03DA7 0000      NOP
(0262) 		Clr_SID();
    03DA8 9AA3      SBI	0x14,3
    03DA9 98AB      CBI	0x15,3
    03DAA 5F4F      SUBI	R20,0xFF
    03DAB 4F5F      SBCI	R21,0xFF
    03DAC 3048      CPI	R20,0x8
    03DAD E0E0      LDI	R30,0
    03DAE 075E      CPC	R21,R30
    03DAF F318      BCS	0x3D93
    03DB0 940C 48E7 JMP	pop_xgset303C
_Set_Draw:
    03DB2 9721      SBIW	R28,1
(0263) 	}
(0264) }
(0265)  
(0266) /********************************************************************
(0267) 函 数 名：Set_Draw(
(0268) 入口参数：无
(0269) 出口参数：无
(0270) 函数作用：设置为绘图模式
(0271) 说    明：
(0272) ********************************************************************/
(0273) void Set_Draw(void)
(0274) {  	
(0275) 	//W_1byte(0,0,0x34);			//8BIT控制界面，扩充指令集,，绘图显示OFF
(0276) 	W_1byte(0,0,0x36);
    03DB3 E386      LDI	R24,0x36
    03DB4 8388      ST	Y,R24
    03DB5 2722      CLR	R18
    03DB6 2700      CLR	R16
    03DB7 DF9C      RCALL	_W_1byte
(0277) 	delayms(1);					//延时
    03DB8 E001      LDI	R16,1
    03DB9 E010      LDI	R17,0
    03DBA 940E 2532 CALL	_delayms
    03DBC 9621      ADIW	R28,1
    03DBD 9508      RET
_Set_White:
  clr_y                --> R10
  clr_x                --> R20
  white_y              --> Y,+2
  white_x              --> Y,+1
  i                    --> R22
  white_end_x          --> R12
  j                    --> R14
  clear                --> Y,+15
  end_x                --> R12
  y                    --> R14
  x                    --> R22
    03DBE 940E 48B3 CALL	push_xgsetF0FC
    03DC0 2EE2      MOV	R14,R18
    03DC1 2F60      MOV	R22,R16
    03DC2 9723      SBIW	R28,3
    03DC3 84CD      LDD	R12,Y+13
(0278) } 
(0279)  
(0280) 
(0281) /******************************************************************** 
(0282) 函数 名：Set_White 
(0283) 入口参数：  x,   y,  end_x,  clear
(0284) 出口参数：无 
(0285) 函数作用： 设置反显
(0286) 说        明： 
(0287) ********************************************************************/ 
(0288) void Set_White(unsigned char x,unsigned char y,unsigned char end_x,unsigned char clear)
(0289) {
(0290)  
(0291) 	unsigned char i, j, white_x, white_y,white_end_x,clr_x,clr_y ;		//
(0292)   
(0293) 	W_1byte(0,0,0x36);	  //8BIT控制界面，扩充指令集,，绘图显示ON
    03DC4 E386      LDI	R24,0x36
    03DC5 8388      ST	Y,R24
    03DC6 2722      CLR	R18
    03DC7 2700      CLR	R16
    03DC8 DF8B      RCALL	_W_1byte
(0294) 	delayus(20);					//延时
    03DC9 E104      LDI	R16,0x14
    03DCA E010      LDI	R17,0
    03DCB 940E 252A CALL	_delayus
(0295)  
(0296) 	white_end_x = (end_x-x+1);
    03DCD 2D8C      MOV	R24,R12
    03DCE 1B86      SUB	R24,R22
    03DCF 5F8F      SUBI	R24,0xFF
    03DD0 2EC8      MOV	R12,R24
(0297) 	white_end_x <<= 1;
    03DD1 0CCC      LSL	R12
(0298) 	if(y==1)   //x,1  a=80+x-1                   
    03DD2 2D8E      MOV	R24,R14
    03DD3 3081      CPI	R24,1
    03DD4 F449      BNE	0x3DDE
(0299) 	{
(0300) 	 	white_x = (0x80+x-1); 
    03DD5 2F86      MOV	R24,R22
    03DD6 5880      SUBI	R24,0x80
    03DD7 5081      SUBI	R24,1
    03DD8 8389      STD	Y+1,R24
(0301) 		white_y = 0x80;
    03DD9 E880      LDI	R24,0x80
    03DDA 838A      STD	Y+2,R24
(0302) 		clr_x = 0x80;
    03DDB E840      LDI	R20,0x80
(0303) 		clr_y = 0x80;
    03DDC 2EA8      MOV	R10,R24
(0304) 	}
    03DDD C023      RJMP	0x3E01
(0305) 	else if(y==2)
    03DDE 2D8E      MOV	R24,R14
    03DDF 3082      CPI	R24,2
    03DE0 F449      BNE	0x3DEA
(0306) 	{
(0307) 	 	white_x = (0x80+x-1);
    03DE1 2F86      MOV	R24,R22
    03DE2 5880      SUBI	R24,0x80
    03DE3 5081      SUBI	R24,1
    03DE4 8389      STD	Y+1,R24
(0308) 		white_y = 0x90;
    03DE5 E980      LDI	R24,0x90
    03DE6 838A      STD	Y+2,R24
(0309) 		clr_x = 0x80;
    03DE7 E840      LDI	R20,0x80
(0310) 		clr_y = 0x90;
    03DE8 2EA8      MOV	R10,R24
(0311) 	}
    03DE9 C017      RJMP	0x3E01
(0312) 	else if(y==3)
    03DEA 2D8E      MOV	R24,R14
    03DEB 3083      CPI	R24,3
    03DEC F449      BNE	0x3DF6
(0313) 	{
(0314) 	 	white_x = (0x88+x-1);
    03DED 2F86      MOV	R24,R22
    03DEE 5788      SUBI	R24,0x78
    03DEF 5081      SUBI	R24,1
    03DF0 8389      STD	Y+1,R24
(0315) 		white_y = 0x80;
    03DF1 E880      LDI	R24,0x80
    03DF2 838A      STD	Y+2,R24
(0316) 		clr_x = 0x88;
    03DF3 E848      LDI	R20,0x88
(0317) 		clr_y = 0x80;
    03DF4 2EA8      MOV	R10,R24
(0318) 	}
    03DF5 C00B      RJMP	0x3E01
(0319) 	else if(y==4)
    03DF6 2D8E      MOV	R24,R14
    03DF7 3084      CPI	R24,4
    03DF8 F441      BNE	0x3E01
(0320) 	{
(0321) 	 	white_x = (0x88+x-1);
    03DF9 2F86      MOV	R24,R22
    03DFA 5788      SUBI	R24,0x78
    03DFB 5081      SUBI	R24,1
    03DFC 8389      STD	Y+1,R24
(0322) 		white_y = 0x90;
    03DFD E980      LDI	R24,0x90
    03DFE 838A      STD	Y+2,R24
(0323) 		clr_x = 0x88;
    03DFF E848      LDI	R20,0x88
(0324) 		clr_y = 0x90;
    03E00 2EA8      MOV	R10,R24
(0325) 	}
(0326)   if(clear==0)//要反白时，先将整行的液晶全部清成不反白（此处行指y）
    03E01 840F      LDD	R0,Y+15
    03E02 2000      TST	R0
    03E03 F4E9      BNE	0x3E21
(0327) 	{
(0328) 	 	for(i=0;i<16;i++ )			//16行
    03E04 2766      CLR	R22
    03E05 C019      RJMP	0x3E1F
(0329) 		{
(0330) 		 	W_1byte(0,0,clr_y++);	//设置绘图区的Y地址坐标0
    03E06 2C2A      MOV	R2,R10
    03E07 2D82      MOV	R24,R2
    03E08 5F8F      SUBI	R24,0xFF
    03E09 2EA8      MOV	R10,R24
    03E0A 8228      ST	Y,R2
    03E0B 2722      CLR	R18
    03E0C 2700      CLR	R16
    03E0D DF46      RCALL	_W_1byte
(0331) 			W_1byte(0,0,clr_x);		//设置绘图区的X地址坐标0
    03E0E 8348      ST	Y,R20
    03E0F 2722      CLR	R18
    03E10 2700      CLR	R16
    03E11 DF42      RCALL	_W_1byte
(0332) 			for(j=0;j<16;j++)		//
    03E12 24EE      CLR	R14
    03E13 C007      RJMP	0x3E1B
(0333) 			{
(0334) 			 	W_1byte(0,1,0x00);	//清成不反白
    03E14 2422      CLR	R2
    03E15 8228      ST	Y,R2
    03E16 E021      LDI	R18,1
    03E17 2700      CLR	R16
    03E18 DF3B      RCALL	_W_1byte
(0335) 			 	nop();
    03E19 0000      NOP
    03E1A 94E3      INC	R14
    03E1B 2D8E      MOV	R24,R14
    03E1C 3180      CPI	R24,0x10
    03E1D F3B0      BCS	0x3E14
    03E1E 9563      INC	R22
    03E1F 3160      CPI	R22,0x10
    03E20 F328      BCS	0x3E06
(0336) 			}
(0337) 		}
(0338) 	}
(0339) 	nop();
    03E21 0000      NOP
(0340) //	
(0341) 	for(i=0;i<16;i++ )				//16行，因为是16*16汉字
    03E22 2766      CLR	R22
    03E23 C022      RJMP	0x3E46
(0342) 	{
(0343) 		W_1byte(0,0,white_y++);		//设置绘图区的Y地址坐标0
    03E24 802A      LDD	R2,Y+2
    03E25 2D82      MOV	R24,R2
    03E26 5F8F      SUBI	R24,0xFF
    03E27 838A      STD	Y+2,R24
    03E28 8228      ST	Y,R2
    03E29 2722      CLR	R18
    03E2A 2700      CLR	R16
    03E2B DF28      RCALL	_W_1byte
(0344) 		W_1byte(0,0,white_x);		//设置绘图区的X地址坐标0
    03E2C 8009      LDD	R0,Y+1
    03E2D 8208      ST	Y,R0
    03E2E 2722      CLR	R18
    03E2F 2700      CLR	R16
    03E30 DF23      RCALL	_W_1byte
(0345) 		for(j=0;j<white_end_x;j++)	//
    03E31 24EE      CLR	R14
    03E32 C010      RJMP	0x3E43
(0346) 		{
(0347) 			 if(clear==1)
    03E33 858F      LDD	R24,Y+15
    03E34 3081      CPI	R24,1
    03E35 F431      BNE	0x3E3C
(0348) 			 {
(0349) 			  	W_1byte(0,1,0x00); //取消这一行的8个点的反白，液晶地址自动加1
    03E36 2422      CLR	R2
    03E37 8228      ST	Y,R2
    03E38 E021      LDI	R18,1
    03E39 2700      CLR	R16
    03E3A DF19      RCALL	_W_1byte
(0350) 								   //（此处行指一个一个液晶点所组成的行）
(0351) 			 }
    03E3B C005      RJMP	0x3E41
(0352) 			 else
(0353) 			 {
(0354) 				W_1byte(0,1,0xff); //反白这一行的8个点，液晶地址自动加1
    03E3C EF8F      LDI	R24,0xFF
    03E3D 8388      ST	Y,R24
    03E3E E021      LDI	R18,1
    03E3F 2700      CLR	R16
    03E40 DF13      RCALL	_W_1byte
(0355) 								   //（此处行指一个一个液晶点所组成的行）
(0356) 			 }
(0357) 			nop();
    03E41 0000      NOP
    03E42 94E3      INC	R14
    03E43 14EC      CP	R14,R12
    03E44 F370      BCS	0x3E33
    03E45 9563      INC	R22
    03E46 3160      CPI	R22,0x10
    03E47 F2E0      BCS	0x3E24
(0358) 		}
(0359) 	}
(0360) 	W_1byte(0,0,0x30);		//基本指令集,，绘图显示OFF
    03E48 E380      LDI	R24,0x30
    03E49 8388      ST	Y,R24
    03E4A 2722      CLR	R18
    03E4B 2700      CLR	R16
    03E4C DF07      RCALL	_W_1byte
    03E4D 9623      ADIW	R28,3
    03E4E 940C 48A8 JMP	pop_xgsetF0FC
_set_white_n:
  tempendx             --> R10
  tempy                --> R22
  tempx                --> R20
  clear                --> R12
  n                    --> R14
    03E50 940E 48B3 CALL	push_xgsetF0FC
    03E52 2EC2      MOV	R12,R18
    03E53 2EE0      MOV	R14,R16
    03E54 9723      SBIW	R28,3
(0361)  }
(0362) 
(0363) /******************************************************************** 
(0364) 函数 名：set_white_n
(0365) 入口参数： n ,  clear
(0366) 出口参数：无 
(0367) 函数作用：   将四行分成八个位置。n代表位置1-8。本函数用于反显或取消反显
(0368)           某一位置的文字。
(0369) 说        明： 例如 set_white_n(1,0); 表示反显第一行前四个字
(0370) ********************************************************************/ 
(0371) void set_white_n(unsigned char n,unsigned char clear)
(0372) {
(0373) unsigned char tempx,tempy,tempendx;
(0374) if(n==1) {tempx=1;tempy=1;tempendx=4;}
    03E55 2D8E      MOV	R24,R14
    03E56 3081      CPI	R24,1
    03E57 F429      BNE	0x3E5D
    03E58 E041      LDI	R20,1
    03E59 E061      LDI	R22,1
    03E5A E084      LDI	R24,4
    03E5B 2EA8      MOV	R10,R24
    03E5C C037      RJMP	0x3E94
(0375) else if(n==2) {tempx=5;tempy=1;tempendx=8;}
    03E5D 2D8E      MOV	R24,R14
    03E5E 3082      CPI	R24,2
    03E5F F429      BNE	0x3E65
    03E60 E045      LDI	R20,5
    03E61 E061      LDI	R22,1
    03E62 E088      LDI	R24,0x8
    03E63 2EA8      MOV	R10,R24
    03E64 C02F      RJMP	0x3E94
(0376) else if(n==3) {tempx=1;tempy=2;tempendx=4;}
    03E65 2D8E      MOV	R24,R14
    03E66 3083      CPI	R24,3
    03E67 F429      BNE	0x3E6D
    03E68 E041      LDI	R20,1
    03E69 E062      LDI	R22,2
    03E6A E084      LDI	R24,4
    03E6B 2EA8      MOV	R10,R24
    03E6C C027      RJMP	0x3E94
(0377) else if(n==4) {tempx=5;tempy=2;tempendx=8;}
    03E6D 2D8E      MOV	R24,R14
    03E6E 3084      CPI	R24,4
    03E6F F429      BNE	0x3E75
    03E70 E045      LDI	R20,5
    03E71 E062      LDI	R22,2
    03E72 E088      LDI	R24,0x8
    03E73 2EA8      MOV	R10,R24
    03E74 C01F      RJMP	0x3E94
(0378) else if(n==5) {tempx=1;tempy=3;tempendx=4;}
    03E75 2D8E      MOV	R24,R14
    03E76 3085      CPI	R24,5
    03E77 F429      BNE	0x3E7D
    03E78 E041      LDI	R20,1
    03E79 E063      LDI	R22,3
    03E7A E084      LDI	R24,4
    03E7B 2EA8      MOV	R10,R24
    03E7C C017      RJMP	0x3E94
(0379) else if(n==6) {tempx=5;tempy=3;tempendx=8;}
    03E7D 2D8E      MOV	R24,R14
    03E7E 3086      CPI	R24,6
    03E7F F429      BNE	0x3E85
    03E80 E045      LDI	R20,5
    03E81 E063      LDI	R22,3
    03E82 E088      LDI	R24,0x8
    03E83 2EA8      MOV	R10,R24
    03E84 C00F      RJMP	0x3E94
(0380) else if(n==7) {tempx=1;tempy=4;tempendx=4;}
    03E85 2D8E      MOV	R24,R14
    03E86 3087      CPI	R24,7
    03E87 F429      BNE	0x3E8D
    03E88 E041      LDI	R20,1
    03E89 E064      LDI	R22,4
    03E8A E084      LDI	R24,4
    03E8B 2EA8      MOV	R10,R24
    03E8C C007      RJMP	0x3E94
(0381) else if(n==8) {tempx=5;tempy=4;tempendx=8;}
    03E8D 2D8E      MOV	R24,R14
    03E8E 3088      CPI	R24,0x8
    03E8F F421      BNE	0x3E94
    03E90 E045      LDI	R20,5
    03E91 E064      LDI	R22,4
    03E92 E088      LDI	R24,0x8
    03E93 2EA8      MOV	R10,R24
(0382) Set_White(tempx,tempy,tempendx,clear);
    03E94 82CA      STD	Y+2,R12
    03E95 82A8      ST	Y,R10
    03E96 2F26      MOV	R18,R22
    03E97 2F04      MOV	R16,R20
    03E98 DF25      RCALL	_Set_White
    03E99 9623      ADIW	R28,3
    03E9A 940C 48A8 JMP	pop_xgsetF0FC
_clr_white:
  clr_x                --> R10
  clr_y                --> R20
  i                    --> R22
  j                    --> R12
    03E9C 940E 48B3 CALL	push_xgsetF0FC
    03E9E 9721      SBIW	R28,1
(0383) 
(0384) }
(0385)  
(0386) /******************************************************************** 
(0387) 函数 名：clr_white
(0388) 入口参数： 清所有 反白
(0389) 出口参数：无 
(0390) 函数作用： 
(0391) 说        明： 
(0392) ********************************************************************/ 
(0393) void clr_white(void)
(0394) {      unsigned char i,j;
(0395) 
(0396)        unsigned char  clr_y=0x80;
    03E9F E840      LDI	R20,0x80
(0397) 	   unsigned char  clr_x=0x80;
    03EA0 E880      LDI	R24,0x80
    03EA1 2EA8      MOV	R10,R24
(0398) 	   W_1byte(0,0,0x36);	  //8BIT控制界面，扩充指令集,，绘图显示ON
    03EA2 E386      LDI	R24,0x36
    03EA3 8388      ST	Y,R24
    03EA4 2722      CLR	R18
    03EA5 2700      CLR	R16
    03EA6 DEAD      RCALL	_W_1byte
(0399) 	 	for(i=0;i<16;i++ )			//16行
    03EA7 2766      CLR	R22
    03EA8 C017      RJMP	0x3EC0
(0400) 		{
(0401) 		 	W_1byte(0,0,clr_y++);	//设置绘图区的Y地址坐标0
    03EA9 2E24      MOV	R2,R20
    03EAA 5F4F      SUBI	R20,0xFF
    03EAB 8228      ST	Y,R2
    03EAC 2722      CLR	R18
    03EAD 2700      CLR	R16
    03EAE DEA5      RCALL	_W_1byte
(0402) 			W_1byte(0,0,clr_x);		//设置绘图区的X地址坐标0
    03EAF 82A8      ST	Y,R10
    03EB0 2722      CLR	R18
    03EB1 2700      CLR	R16
    03EB2 DEA1      RCALL	_W_1byte
(0403) 			for(j=0;j<16;j++)		//
    03EB3 24CC      CLR	R12
    03EB4 C007      RJMP	0x3EBC
(0404) 			{
(0405) 			 	W_1byte(0,1,0x00);	//清成不反白
    03EB5 2422      CLR	R2
    03EB6 8228      ST	Y,R2
    03EB7 E021      LDI	R18,1
    03EB8 2700      CLR	R16
    03EB9 DE9A      RCALL	_W_1byte
(0406) 			 	nop();
    03EBA 0000      NOP
    03EBB 94C3      INC	R12
    03EBC 2D8C      MOV	R24,R12
    03EBD 3180      CPI	R24,0x10
    03EBE F3B0      BCS	0x3EB5
    03EBF 9563      INC	R22
    03EC0 3160      CPI	R22,0x10
    03EC1 F338      BCS	0x3EA9
(0407) 			}
(0408) 		}
(0409) 	
(0410) 	    clr_y=0x80;
    03EC2 E840      LDI	R20,0x80
(0411) 	    clr_x=0x90;
    03EC3 E980      LDI	R24,0x90
    03EC4 2EA8      MOV	R10,R24
(0412) 		 	for(i=0;i<16;i++ )			//16行
    03EC5 2766      CLR	R22
    03EC6 C017      RJMP	0x3EDE
(0413) 		{
(0414) 		 	W_1byte(0,0,clr_y++);	//设置绘图区的Y地址坐标0
    03EC7 2E24      MOV	R2,R20
    03EC8 5F4F      SUBI	R20,0xFF
    03EC9 8228      ST	Y,R2
    03ECA 2722      CLR	R18
    03ECB 2700      CLR	R16
    03ECC DE87      RCALL	_W_1byte
(0415) 			W_1byte(0,0,clr_x);		//设置绘图区的X地址坐标0
    03ECD 82A8      ST	Y,R10
    03ECE 2722      CLR	R18
    03ECF 2700      CLR	R16
    03ED0 DE83      RCALL	_W_1byte
(0416) 			for(j=0;j<16;j++)		//
    03ED1 24CC      CLR	R12
    03ED2 C007      RJMP	0x3EDA
(0417) 			{
(0418) 			 	W_1byte(0,1,0x00);	//清成不反白
    03ED3 2422      CLR	R2
    03ED4 8228      ST	Y,R2
    03ED5 E021      LDI	R18,1
    03ED6 2700      CLR	R16
    03ED7 DE7C      RCALL	_W_1byte
(0419) 			 	nop();
    03ED8 0000      NOP
    03ED9 94C3      INC	R12
    03EDA 2D8C      MOV	R24,R12
    03EDB 3180      CPI	R24,0x10
    03EDC F3B0      BCS	0x3ED3
    03EDD 9563      INC	R22
    03EDE 3160      CPI	R22,0x10
    03EDF F338      BCS	0x3EC7
(0420) 			}
(0421) 		}   
(0422) 	   
(0423) 	     clr_y=0x88;
    03EE0 E848      LDI	R20,0x88
(0424) 	     clr_x=0x80;
    03EE1 E880      LDI	R24,0x80
    03EE2 2EA8      MOV	R10,R24
(0425) 		 	for(i=0;i<16;i++ )			//16行
    03EE3 2766      CLR	R22
    03EE4 C017      RJMP	0x3EFC
(0426) 		{
(0427) 		 	W_1byte(0,0,clr_y++);	//设置绘图区的Y地址坐标0
    03EE5 2EE4      MOV	R14,R20
    03EE6 5F4F      SUBI	R20,0xFF
    03EE7 82E8      ST	Y,R14
    03EE8 2722      CLR	R18
    03EE9 2700      CLR	R16
    03EEA DE69      RCALL	_W_1byte
(0428) 			W_1byte(0,0,clr_x);		//设置绘图区的X地址坐标0
    03EEB 82A8      ST	Y,R10
    03EEC 2722      CLR	R18
    03EED 2700      CLR	R16
    03EEE DE65      RCALL	_W_1byte
(0429) 			for(j=0;j<16;j++)		//
    03EEF 24CC      CLR	R12
    03EF0 C007      RJMP	0x3EF8
(0430) 			{
(0431) 			 	W_1byte(0,1,0x00);	//清成不反白
    03EF1 2422      CLR	R2
    03EF2 8228      ST	Y,R2
    03EF3 E021      LDI	R18,1
    03EF4 2700      CLR	R16
    03EF5 DE5E      RCALL	_W_1byte
(0432) 			 	nop();
    03EF6 0000      NOP
    03EF7 94C3      INC	R12
    03EF8 2D8C      MOV	R24,R12
    03EF9 3180      CPI	R24,0x10
    03EFA F3B0      BCS	0x3EF1
    03EFB 9563      INC	R22
    03EFC 3160      CPI	R22,0x10
    03EFD F338      BCS	0x3EE5
(0433) 			}
(0434) 		} 
(0435) 	     clr_y=0x88;
    03EFE E848      LDI	R20,0x88
(0436) 	     clr_x=0x90;
    03EFF E980      LDI	R24,0x90
    03F00 2EA8      MOV	R10,R24
(0437) 		 	for(i=0;i<16;i++ )			//16行
    03F01 2766      CLR	R22
    03F02 C017      RJMP	0x3F1A
(0438) 		{
(0439) 		 	W_1byte(0,0,clr_y++);	//设置绘图区的Y地址坐标0
    03F03 2EE4      MOV	R14,R20
    03F04 5F4F      SUBI	R20,0xFF
    03F05 82E8      ST	Y,R14
    03F06 2722      CLR	R18
    03F07 2700      CLR	R16
    03F08 DE4B      RCALL	_W_1byte
(0440) 			W_1byte(0,0,clr_x);		//设置绘图区的X地址坐标0
    03F09 82A8      ST	Y,R10
    03F0A 2722      CLR	R18
    03F0B 2700      CLR	R16
    03F0C DE47      RCALL	_W_1byte
(0441) 			for(j=0;j<16;j++)		//
    03F0D 24CC      CLR	R12
    03F0E C007      RJMP	0x3F16
(0442) 			{
(0443) 			 	W_1byte(0,1,0x00);	//清成不反白
    03F0F 2422      CLR	R2
    03F10 8228      ST	Y,R2
    03F11 E021      LDI	R18,1
    03F12 2700      CLR	R16
    03F13 DE40      RCALL	_W_1byte
(0444) 			 	nop();
    03F14 0000      NOP
    03F15 94C3      INC	R12
    03F16 2D8C      MOV	R24,R12
    03F17 3180      CPI	R24,0x10
    03F18 F3B0      BCS	0x3F0F
    03F19 9563      INC	R22
    03F1A 3160      CPI	R22,0x10
    03F1B F338      BCS	0x3F03
(0445) 			}
(0446) 		} 		
(0447)   W_1byte(0,0,0x30);	  //8BIT控制界面，扩充指令集,，绘图显示ON
    03F1C E380      LDI	R24,0x30
    03F1D 8388      ST	Y,R24
    03F1E 2722      CLR	R18
    03F1F 2700      CLR	R16
    03F20 DE33      RCALL	_W_1byte
    03F21 9621      ADIW	R28,1
    03F22 940C 48A8 JMP	pop_xgsetF0FC
_LCD_print2num:
  a                    --> R12
  tem                  --> R20
  num                  --> R10
  y                    --> R14
  x                    --> R12
    03F24 940E 48B5 CALL	push_xgset30FC
    03F26 2EE2      MOV	R14,R18
    03F27 2EC0      MOV	R12,R16
    03F28 9721      SBIW	R28,1
    03F29 84A9      LDD	R10,Y+9
(0448) 	}
(0449) /******************************************************************** 
(0450) 函数 名：LCD_print2num
(0451) 入口参数： 显示2数字
(0452) 出口参数：无 
(0453) 函数作用： 
(0454) 说        明： 
(0455) ********************************************************************/ 
(0456) void LCD_print2num(unsigned char x,unsigned char y,unsigned char num){
(0457) unsigned char tem;
(0458) unsigned char a; 
(0459) 
(0460) a=address(x,y);
    03F2A 2D2E      MOV	R18,R14
    03F2B 2D0C      MOV	R16,R12
    03F2C DD40      RCALL	_address
    03F2D 2EC0      MOV	R12,R16
(0461) W_1byte(0,0,a);     //显示的地址 
    03F2E 82C8      ST	Y,R12
    03F2F 2722      CLR	R18
    03F30 2700      CLR	R16
    03F31 DE22      RCALL	_W_1byte
(0462) tem=num/10;
    03F32 E01A      LDI	R17,0xA
    03F33 2D0A      MOV	R16,R10
    03F34 940E 4825 CALL	div8u
    03F36 2F40      MOV	R20,R16
(0463) W_1byte(0,1,tem+0x30);
    03F37 2F84      MOV	R24,R20
    03F38 5D80      SUBI	R24,0xD0
    03F39 8388      ST	Y,R24
    03F3A E021      LDI	R18,1
    03F3B 2700      CLR	R16
    03F3C DE17      RCALL	_W_1byte
(0464) tem=num%10;
    03F3D E01A      LDI	R17,0xA
    03F3E 2D0A      MOV	R16,R10
    03F3F 940E 4823 CALL	mod8u
    03F41 2F40      MOV	R20,R16
(0465) W_1byte(0,1,tem+0x30); 
    03F42 2F84      MOV	R24,R20
    03F43 5D80      SUBI	R24,0xD0
    03F44 8388      ST	Y,R24
    03F45 E021      LDI	R18,1
    03F46 2700      CLR	R16
    03F47 DE0C      RCALL	_W_1byte
(0466) W_1byte(0,0,0XFF); // 移走地址指针 防止下一输入内容的干扰
    03F48 EF8F      LDI	R24,0xFF
    03F49 8388      ST	Y,R24
    03F4A 2722      CLR	R18
    03F4B 2700      CLR	R16
    03F4C DE07      RCALL	_W_1byte
    03F4D 9621      ADIW	R28,1
    03F4E 940C 489F JMP	pop_xgset30FC
_LCD_print4num:
  tem                  --> R12
  num                  --> R14
  y                    --> R20
  x                    --> R10
    03F50 940E 48B5 CALL	push_xgset30FC
    03F52 2F42      MOV	R20,R18
    03F53 2EA0      MOV	R10,R16
    03F54 9721      SBIW	R28,1
    03F55 84E9      LDD	R14,Y+9
    03F56 84FA      LDD	R15,Y+10
(0467) }
(0468)  
(0469) /******************************************************************** 
(0470) 函数 名：LCD_print4num
(0471) 入口参数： 显示4数字
(0472) 出口参数：无 
(0473) 函数作用： 
(0474) 说        明： 
(0475) ********************************************************************/ 
(0476) void LCD_print4num(unsigned char x,unsigned char y,unsigned int num){
(0477) unsigned char tem;
(0478) tem=num/100;
    03F57 E624      LDI	R18,0x64
    03F58 E030      LDI	R19,0
    03F59 0187      MOVW	R16,R14
    03F5A 940E 479F CALL	div16u
    03F5C 2EC0      MOV	R12,R16
(0479) LCD_print2num(x,y,tem);
    03F5D 82C8      ST	Y,R12
    03F5E 2F24      MOV	R18,R20
    03F5F 2D0A      MOV	R16,R10
    03F60 DFC3      RCALL	_LCD_print2num
(0480) 
(0481) tem=num%100;   
    03F61 E624      LDI	R18,0x64
    03F62 E030      LDI	R19,0
    03F63 0187      MOVW	R16,R14
    03F64 940E 479D CALL	mod16u
    03F66 2EC0      MOV	R12,R16
(0482) LCD_print2num(x,y+1,tem);
    03F67 82C8      ST	Y,R12
    03F68 2F24      MOV	R18,R20
    03F69 5F2F      SUBI	R18,0xFF
    03F6A 2D0A      MOV	R16,R10
    03F6B DFB8      RCALL	_LCD_print2num
(0483) 
(0484) 
(0485)   W_1byte(0,0,0XFF); // 移走地址指针 防止下一输入内容的干扰
    03F6C EF8F      LDI	R24,0xFF
    03F6D 8388      ST	Y,R24
    03F6E 2722      CLR	R18
    03F6F 2700      CLR	R16
    03F70 DDE3      RCALL	_W_1byte
    03F71 9621      ADIW	R28,1
    03F72 940C 489F JMP	pop_xgset30FC
_LCD_print:
  a                    --> R12
  ch                   --> R10
  y                    --> R14
  x                    --> R12
    03F74 940E 48B7 CALL	push_xgset00FC
    03F76 2EE2      MOV	R14,R18
    03F77 2EC0      MOV	R12,R16
    03F78 9721      SBIW	R28,1
    03F79 80AF      LDD	R10,Y+7
(0486) }
(0487)  
(0488) //////////////////////////////////////////////////////////////
(0489) 
(0490) /******************************************************************** 
(0491) 函数 名：LCD_print 
(0492) 入口参数： 显示1 ascii
(0493) 出口参数：无 
(0494) 函数作用： 
(0495) 说        明： 
(0496) ********************************************************************/ 
(0497) void LCD_print(unsigned char x,unsigned char y,unsigned char ch)
(0498) {  
(0499) unsigned char a; 
(0500) a=address(x,y);
    03F7A 2D2E      MOV	R18,R14
    03F7B 2D0C      MOV	R16,R12
    03F7C DCF0      RCALL	_address
    03F7D 2EC0      MOV	R12,R16
(0501) W_1byte(0,0,a);     //显示的地址 
    03F7E 82C8      ST	Y,R12
    03F7F 2722      CLR	R18
    03F80 2700      CLR	R16
    03F81 DDD2      RCALL	_W_1byte
(0502) W_1byte(0,1,ch); 
    03F82 82A8      ST	Y,R10
    03F83 E021      LDI	R18,1
    03F84 2700      CLR	R16
    03F85 DDCE      RCALL	_W_1byte
    03F86 9621      ADIW	R28,1
    03F87 940C 4898 JMP	pop_xgset00FC
_LCD_print1:
  ch                   --> R10
    03F89 92AA      ST	-Y,R10
    03F8A 2EA0      MOV	R10,R16
    03F8B 9721      SBIW	R28,1
(0503) 
(0504) 
(0505) 
(0506) }
(0507) /******************************************************************** 
(0508) 函数 名：LCD_print1 
(0509) 入口参数： 显示1 ascii
(0510) 出口参数：无 
(0511) 函数作用：接着上文地址显示，不重设地址 
(0512) 说        明： 
(0513) ********************************************************************/ 
(0514) void LCD_print1(char ch)
(0515) {  
(0516) W_1byte(0,1,ch); 
    03F8C 82A8      ST	Y,R10
    03F8D E021      LDI	R18,1
    03F8E 2700      CLR	R16
    03F8F DDC4      RCALL	_W_1byte
    03F90 9621      ADIW	R28,1
    03F91 90A9      LD	R10,Y+
    03F92 9508      RET
_lp:
  p                    --> R10
    03F93 92AA      ST	-Y,R10
    03F94 92BA      ST	-Y,R11
    03F95 0158      MOVW	R10,R16
    03F96 9722      SBIW	R28,2
(0517) }
(0518) //////////////////////////////////////////////////////////////
(0519) 
(0520) 
(0521) 
(0522)  void lp(unsigned char *p)
(0523)  {
(0524)  static unsigned char *p1=" ",*p2=" ",*p3=" ",*p4=" ";
(0525)  p4=p3;
    03F97 9020 05B8 LDS	R2,lcd.c:p3
    03F99 9030 05B9 LDS	R3,lcd.c:p3+1
    03F9B 9230 05BB STS	lcd.c:p4+1,R3
    03F9D 9220 05BA STS	lcd.c:p4,R2
(0526)  p3=p2;
    03F9F 9020 05B6 LDS	R2,lcd.c:p2
    03FA1 9030 05B7 LDS	R3,lcd.c:p2+1
    03FA3 9230 05B9 STS	lcd.c:p3+1,R3
    03FA5 9220 05B8 STS	lcd.c:p3,R2
(0527)  p2=p1;
    03FA7 9020 05B4 LDS	R2,lcd.c:p1
    03FA9 9030 05B5 LDS	R3,lcd.c:p1+1
    03FAB 9230 05B7 STS	lcd.c:p2+1,R3
    03FAD 9220 05B6 STS	lcd.c:p2,R2
(0528)  p1=p;
    03FAF 92B0 05B5 STS	lcd.c:p1+1,R11
    03FB1 92A0 05B4 STS	lcd.c:p1,R10
(0529)   LCD_const_disp(1,1,"                ");
    03FB3 EB8C      LDI	R24,0xBC
    03FB4 E095      LDI	R25,5
    03FB5 8399      STD	Y+1,R25
    03FB6 8388      ST	Y,R24
    03FB7 E021      LDI	R18,1
    03FB8 E001      LDI	R16,1
    03FB9 DCD4      RCALL	_LCD_const_disp
(0530)   LCD_const_disp(2,1,"                ");
    03FBA EB8C      LDI	R24,0xBC
    03FBB E095      LDI	R25,5
    03FBC 8399      STD	Y+1,R25
    03FBD 8388      ST	Y,R24
    03FBE E021      LDI	R18,1
    03FBF E002      LDI	R16,2
    03FC0 DCCD      RCALL	_LCD_const_disp
(0531)   LCD_const_disp(3,1,"                ");
    03FC1 EB8C      LDI	R24,0xBC
    03FC2 E095      LDI	R25,5
    03FC3 8399      STD	Y+1,R25
    03FC4 8388      ST	Y,R24
    03FC5 E021      LDI	R18,1
    03FC6 E003      LDI	R16,3
    03FC7 DCC6      RCALL	_LCD_const_disp
(0532)   LCD_const_disp(4,1,"                ");
    03FC8 EB8C      LDI	R24,0xBC
    03FC9 E095      LDI	R25,5
    03FCA 8399      STD	Y+1,R25
    03FCB 8388      ST	Y,R24
    03FCC E021      LDI	R18,1
    03FCD E004      LDI	R16,4
    03FCE DCBF      RCALL	_LCD_const_disp
(0533)   LCD_var_disp(1,1,p4);
    03FCF 9020 05BA LDS	R2,lcd.c:p4
    03FD1 9030 05BB LDS	R3,lcd.c:p4+1
    03FD3 8239      STD	Y+1,R3
    03FD4 8228      ST	Y,R2
    03FD5 E021      LDI	R18,1
    03FD6 E001      LDI	R16,1
    03FD7 DCE3      RCALL	_LCD_var_disp
(0534)   LCD_var_disp(2,1,p3);
    03FD8 9020 05B8 LDS	R2,lcd.c:p3
    03FDA 9030 05B9 LDS	R3,lcd.c:p3+1
    03FDC 8239      STD	Y+1,R3
    03FDD 8228      ST	Y,R2
    03FDE E021      LDI	R18,1
    03FDF E002      LDI	R16,2
    03FE0 DCDA      RCALL	_LCD_var_disp
(0535)   LCD_var_disp(3,1,p2);
    03FE1 9020 05B6 LDS	R2,lcd.c:p2
    03FE3 9030 05B7 LDS	R3,lcd.c:p2+1
    03FE5 8239      STD	Y+1,R3
    03FE6 8228      ST	Y,R2
    03FE7 E021      LDI	R18,1
    03FE8 E003      LDI	R16,3
    03FE9 DCD1      RCALL	_LCD_var_disp
(0536)   LCD_var_disp(4,1,p1);
    03FEA 9020 05B4 LDS	R2,lcd.c:p1
    03FEC 9030 05B5 LDS	R3,lcd.c:p1+1
    03FEE 8239      STD	Y+1,R3
    03FEF 8228      ST	Y,R2
    03FF0 E021      LDI	R18,1
    03FF1 E004      LDI	R16,4
    03FF2 DCC8      RCALL	_LCD_var_disp
(0537)   delayms(300);
    03FF3 E20C      LDI	R16,0x2C
    03FF4 E011      LDI	R17,1
    03FF5 940E 2532 CALL	_delayms
    03FF7 9622      ADIW	R28,2
    03FF8 90B9      LD	R11,Y+
    03FF9 90A9      LD	R10,Y+
    03FFA 9508      RET
FILE: D:\LQD\software\software_src\relay.c
(0001) #include "config.h"
(0002) /*继电器初始化
(0003) *设置端口
(0004) *初始化关闭
(0005) */
(0006) void relay_init(void){
(0007) 	
(0008) 		RELAY_DDR_SET() ;
_relay_init:
    03FFB 9AA5      SBI	0x14,5
(0009) 		RELAY_OFF();
    03FFC 98AD      CBI	0x15,5
    03FFD 9508      RET
(0010) 		//state.Relay = 0;
(0011) 	}	
(0012) 
(0013) /*继电器控制
(0014) *传入 ： 温度
(0015) *传出 ： 当前继电器状态
(0016) *
(0017) */
(0018) unsigned char  relay(int temp)
(0019) {
(0020) 	if(temp<config.heatThreshold)
_relay:
  temp                 --> R16
    03FFE 9020 08B4 LDS	R2,config+20
    04000 2433      CLR	R3
    04001 1502      CP	R16,R2
    04002 0513      CPC	R17,R3
    04003 F41C      BGE	0x4007
(0021) 	{
(0022) 	 		RELAY_DDR_SET();
    04004 9AA5      SBI	0x14,5
(0023) 			RELAY_ON();
    04005 9AAD      SBI	0x15,5
(0024) 			//state.Relay = 1 ;
(0025) 	}
    04006 C002      RJMP	0x4009
(0026) 	else
(0027) 	{
(0028) 	 	RELAY_DDR_SET();
    04007 9AA5      SBI	0x14,5
(0029) 		RELAY_OFF();
    04008 98AD      CBI	0x15,5
(0030) 		//state.Relay = 0 ;
(0031) 	}		
(0032) 	//return state.Relay;
(0033) 	return 0;
    04009 2700      CLR	R16
    0400A 9508      RET
_beep:
  i                    --> R10
  short_beep           --> R12
  long_beep            --> R14
    0400B 940E 48B7 CALL	push_xgset00FC
    0400D 2EC2      MOV	R12,R18
    0400E 2EE0      MOV	R14,R16
FILE: D:\LQD\software\software_src\beep.c
(0001) #include "config.h"
(0002) 
(0003) #define BEEP_PORT	PORTC
(0004) #define BEEP_PIN	6
(0005) #define BEEP_OFF() BEEP_PORT|=(1<<BEEP_PIN)
(0006) #define BEEP_ON()  BEEP_PORT&=~(1<<BEEP_PIN)
(0007) //楦ｅ
(0008) void beep(unsigned char long_beep,unsigned char short_beep)
(0009) { 
(0010) unsigned char i;
(0011) DDRB|=(1<<0);
    0400F 9AB8      SBI	0x17,0
(0012) for(i=0;i<long_beep;i++)
    04010 24AA      CLR	R10
    04011 C00B      RJMP	0x401D
(0013) {
(0014) BEEP_ON();  delayms(200);
    04012 98AE      CBI	0x15,6
    04013 EC08      LDI	R16,0xC8
    04014 E010      LDI	R17,0
    04015 940E 2532 CALL	_delayms
(0015) BEEP_OFF(); delayms(50);
    04017 9AAE      SBI	0x15,6
    04018 E302      LDI	R16,0x32
    04019 E010      LDI	R17,0
    0401A 940E 2532 CALL	_delayms
    0401C 94A3      INC	R10
    0401D 14AE      CP	R10,R14
    0401E F398      BCS	0x4012
(0016) }
(0017) delayms(100);
    0401F E604      LDI	R16,0x64
    04020 E010      LDI	R17,0
    04021 940E 2532 CALL	_delayms
(0018) for(i=0;i<short_beep;i++)
    04023 24AA      CLR	R10
    04024 C00B      RJMP	0x4030
(0019) {
(0020) BEEP_ON();  delayms(80);
    04025 98AE      CBI	0x15,6
    04026 E500      LDI	R16,0x50
    04027 E010      LDI	R17,0
    04028 940E 2532 CALL	_delayms
(0021) BEEP_OFF(); delayms(50);
    0402A 9AAE      SBI	0x15,6
    0402B E302      LDI	R16,0x32
    0402C E010      LDI	R17,0
    0402D 940E 2532 CALL	_delayms
    0402F 94A3      INC	R10
    04030 14AC      CP	R10,R12
    04031 F398      BCS	0x4025
    04032 940C 4898 JMP	pop_xgset00FC
_Delay_nus:
  i                    --> R20
  n                    --> R16
    04034 934A      ST	-Y,R20
    04035 935A      ST	-Y,R21
FILE: D:\LQD\software\software_src\DS18B20_driver.c
(0001) //------------------------------------------------------------------------------
(0002) // 文件名：DS18B20_driver.c
(0003) // 说明：  DS18B20驱动头文件
(0004) // 功能：  实现1-wire器件的读写
(0005) // 使用方法：   void Delay_nus(unsigned int n);             //延时n微秒函数
(0006) //              unsigned char reset_18B20(void);            //18B20复位
(0007) //              void write_bit_18B20(char bitval);          //写一位到18B20
(0008) //              unsigned char read_bit_18B20(void);         //读一位从18B20
(0009) //              void write_byte_18B20(unsigned char data);  //写一字节到18B20
(0010) //              unsigned char read_18B20(void);             //读一字节到18B20
(0011) //
(0012) // 运行平台：   AVR 8bit (M16已验证)
(0013) // 依存关系：   DS18B20_driver.h    DS18B20基本驱动头文件（函数声明）
(0014) // 移植人：     
(0015) // 最后修改：   
(0016) //------------------------------------------------------------------------------
(0017) 
(0018) #include "config.h"
(0019) #define DS18B20_PORT PORTG
(0020) #define DS18B20_PIN  PING
(0021) #define DS18B20_DDR  DDRG
(0022) #define CL_DQ   DS18B20_PORT&=~(1<<T_NUM)					   
(0023) #define SET_DQ  DS18B20_PORT|=(1<<T_NUM)			   
(0024) #define SET_OUT DS18B20_DDR|=(1<<T_NUM)				   
(0025) #define SET_IN  DS18B20_DDR&=~(1<<T_NUM)			   
(0026) #define IN_DQ   DS18B20_PIN&(1<<T_NUM)				  
(0027) unsigned char T_NUM=0;
(0028) 
(0029) 
(0030) //------------------------------------------------------------------------------
(0031) // 延时N微秒程序 供控制读写DS18B20时序使用
(0032) //------------------------------------------------------------------------------
(0033) void Delay_nus(unsigned int n)   
(0034) {  unsigned int i;
(0035) 	  for (i=0;i<n;i++) 
    04036 2744      CLR	R20
    04037 2755      CLR	R21
    04038 C005      RJMP	0x403E
(0036) 	  		{NOP();
    04039 0000      NOP
(0037) 						NOP();
    0403A 0000      NOP
(0038) 						NOP();				        //20--300//比较接近
    0403B 0000      NOP
    0403C 5F4F      SUBI	R20,0xFF
    0403D 4F5F      SBCI	R21,0xFF
    0403E 1740      CP	R20,R16
    0403F 0751      CPC	R21,R17
    04040 F3C0      BCS	0x4039
    04041 9159      LD	R21,Y+
    04042 9149      LD	R20,Y+
    04043 9508      RET
_reset_18B20:
  bus_flag             --> R10
    04044 92AA      ST	-Y,R10
(0039) 					}
(0040) }
(0041) 
(0042) 
(0043) //------------------------------------------------------------------------------
(0044) // 1-wire总线复位
(0045) //------------------------------------------------------------------------------
(0046) unsigned char reset_18B20(void)
(0047) {
(0048) 	char bus_flag;
(0049) 	CLI();
    04045 94F8      BCLR	7
(0050) 	SET_DQ;
    04046 9110 05CF LDS	R17,T_NUM
    04048 E001      LDI	R16,1
    04049 940E 494A CALL	lsl8
    0404B 9020 0065 LDS	R2,0x65
    0404D 2A20      OR	R2,R16
    0404E 9220 0065 STS	0x65,R2
(0051) 	SET_OUT;
    04050 9110 05CF LDS	R17,T_NUM
    04052 E001      LDI	R16,1
    04053 940E 494A CALL	lsl8
    04055 9020 0064 LDS	R2,0x64
    04057 2A20      OR	R2,R16
    04058 9220 0064 STS	0x64,R2
(0052)  	
(0053)   	Delay_nus(1);
    0405A E001      LDI	R16,1
    0405B E010      LDI	R17,0
    0405C DFD7      RCALL	_Delay_nus
(0054)   	CL_DQ;
    0405D 9110 05CF LDS	R17,T_NUM
    0405F E001      LDI	R16,1
    04060 940E 494A CALL	lsl8
    04062 2E20      MOV	R2,R16
    04063 9420      COM	R2
    04064 9030 0065 LDS	R3,0x65
    04066 2032      AND	R3,R2
    04067 9230 0065 STS	0x65,R3
(0055)   	Delay_nus(550);		//拉低至少480us时间
    04069 E206      LDI	R16,0x26
    0406A E012      LDI	R17,2
    0406B DFC8      RCALL	_Delay_nus
(0056)   	SET_DQ;				//释放
    0406C 9110 05CF LDS	R17,T_NUM
    0406E E001      LDI	R16,1
    0406F 940E 494A CALL	lsl8
    04071 9020 0065 LDS	R2,0x65
    04073 2A20      OR	R2,R16
    04074 9220 0065 STS	0x65,R2
(0057) 					NOP();
    04076 0000      NOP
(0058) 					NOP();
    04077 0000      NOP
(0059)   	SET_IN;				//输入
    04078 9110 05CF LDS	R17,T_NUM
    0407A E001      LDI	R16,1
    0407B 940E 494A CALL	lsl8
    0407D 2E20      MOV	R2,R16
    0407E 9420      COM	R2
    0407F 9030 0064 LDS	R3,0x64
    04081 2032      AND	R3,R2
    04082 9230 0064 STS	0x64,R3
(0060)   	Delay_nus(60);
    04084 E30C      LDI	R16,0x3C
    04085 E010      LDI	R17,0
    04086 DFAD      RCALL	_Delay_nus
(0061)   	
(0062) 						//等待回复
(0063)   	bus_flag = IN_DQ;
    04087 9110 05CF LDS	R17,T_NUM
    04089 E001      LDI	R16,1
    0408A 940E 494A CALL	lsl8
    0408C 90A0 0063 LDS	R10,0x63
    0408E 22A0      AND	R10,R16
(0064)   	
(0065)   	Delay_nus(240);		//回复的低电平在60到240US
    0408F EF00      LDI	R16,0xF0
    04090 E010      LDI	R17,0
    04091 DFA2      RCALL	_Delay_nus
(0066)   	SET_OUT;
    04092 9110 05CF LDS	R17,T_NUM
    04094 E001      LDI	R16,1
    04095 940E 494A CALL	lsl8
    04097 9020 0064 LDS	R2,0x64
    04099 2A20      OR	R2,R16
    0409A 9220 0064 STS	0x64,R2
(0067) 					NOP();
    0409C 0000      NOP
(0068) 					NOP();
    0409D 0000      NOP
(0069)   	SET_DQ;				//回到初始DQ=1；
    0409E 9110 05CF LDS	R17,T_NUM
    040A0 E001      LDI	R16,1
    040A1 940E 494A CALL	lsl8
    040A3 9020 0065 LDS	R2,0x65
    040A5 2A20      OR	R2,R16
    040A6 9220 0065 STS	0x65,R2
(0070) 
(0071)   	SEI();
    040A8 9478      BSET	7
(0072) 	if(bus_flag){
    040A9 20AA      TST	R10
    040AA F011      BEQ	0x40AD
(0073) 		return FALSE;
    040AB 2700      CLR	R16
    040AC C001      RJMP	0x40AE
(0074) 	}else{
(0075) 		return TRUE;
    040AD E001      LDI	R16,1
    040AE 90A9      LD	R10,Y+
    040AF 9508      RET
_write_bit_18B20:
  bitval               --> R10
    040B0 92AA      ST	-Y,R10
    040B1 2EA0      MOV	R10,R16
(0076) 	}
(0077) 
(0078) }
(0079) 
(0080) //------------------------------------------------------------------------------
(0081) // 写一位到总线
(0082) //------------------------------------------------------------------------------
(0083) void write_bit_18B20(char bitval)
(0084) {
(0085)     SET_OUT;
    040B2 9110 05CF LDS	R17,T_NUM
    040B4 E001      LDI	R16,1
    040B5 940E 494A CALL	lsl8
    040B7 9020 0064 LDS	R2,0x64
    040B9 2A20      OR	R2,R16
    040BA 9220 0064 STS	0x64,R2
(0086) 					NOP();
    040BC 0000      NOP
(0087) 					NOP();
    040BD 0000      NOP
(0088) 			 CL_DQ;
    040BE 9110 05CF LDS	R17,T_NUM
    040C0 E001      LDI	R16,1
    040C1 940E 494A CALL	lsl8
    040C3 2E20      MOV	R2,R16
    040C4 9420      COM	R2
    040C5 9030 0065 LDS	R3,0x65
    040C7 2032      AND	R3,R2
    040C8 9230 0065 STS	0x65,R3
(0089) 	   Delay_nus(1);
    040CA E001      LDI	R16,1
    040CB E010      LDI	R17,0
    040CC DF67      RCALL	_Delay_nus
(0090) 	   if(bitval){    //写数据，从低位开始
    040CD 20AA      TST	R10
    040CE F059      BEQ	0x40DA
(0091) 		     SET_DQ;
    040CF 9110 05CF LDS	R17,T_NUM
    040D1 E001      LDI	R16,1
    040D2 940E 494A CALL	lsl8
    040D4 9020 0065 LDS	R2,0x65
    040D6 2A20      OR	R2,R16
    040D7 9220 0065 STS	0x65,R2
(0092) 	  }else{
    040D9 C00C      RJMP	0x40E6
(0093) 		     CL_DQ;
    040DA 9110 05CF LDS	R17,T_NUM
    040DC E001      LDI	R16,1
    040DD 940E 494A CALL	lsl8
    040DF 2E20      MOV	R2,R16
    040E0 9420      COM	R2
    040E1 9030 0065 LDS	R3,0x65
    040E3 2032      AND	R3,R2
    040E4 9230 0065 STS	0x65,R3
(0094) 	  }
(0095) 	Delay_nus(40);		//15~60us
    040E6 E208      LDI	R16,0x28
    040E7 E010      LDI	R17,0
    040E8 DF4B      RCALL	_Delay_nus
(0096) 	SET_DQ;
    040E9 9110 05CF LDS	R17,T_NUM
    040EB E001      LDI	R16,1
    040EC 940E 494A CALL	lsl8
    040EE 9020 0065 LDS	R2,0x65
    040F0 2A20      OR	R2,R16
    040F1 9220 0065 STS	0x65,R2
(0097) 	Delay_nus(10);
    040F3 E00A      LDI	R16,0xA
    040F4 E010      LDI	R17,0
    040F5 DF3E      RCALL	_Delay_nus
    040F6 90A9      LD	R10,Y+
    040F7 9508      RET
_read_bit_18B20:
  k                    --> R10
    040F8 92AA      ST	-Y,R10
(0098) }
(0099) 
(0100) //------------------------------------------------------------------------------
(0101) // 读一位从总线
(0102) //------------------------------------------------------------------------------
(0103) unsigned char read_bit_18B20(void)
(0104) {
(0105) 	unsigned char k;
(0106) 	SET_OUT;
    040F9 9110 05CF LDS	R17,T_NUM
    040FB E001      LDI	R16,1
    040FC 940E 494A CALL	lsl8
    040FE 9020 0064 LDS	R2,0x64
    04100 2A20      OR	R2,R16
    04101 9220 0064 STS	0x64,R2
(0107) 	CL_DQ;			//读时间片开始，拉低总线至少1us
    04103 9110 05CF LDS	R17,T_NUM
    04105 E001      LDI	R16,1
    04106 940E 494A CALL	lsl8
    04108 2E20      MOV	R2,R16
    04109 9420      COM	R2
    0410A 9030 0065 LDS	R3,0x65
    0410C 2032      AND	R3,R2
    0410D 9230 0065 STS	0x65,R3
(0108) 	Delay_nus(1);
    0410F E001      LDI	R16,1
    04110 E010      LDI	R17,0
    04111 DF22      RCALL	_Delay_nus
(0109) 	
(0110) 					//SET_DQ;	
(0111) 	SET_IN;
    04112 9110 05CF LDS	R17,T_NUM
    04114 E001      LDI	R16,1
    04115 940E 494A CALL	lsl8
    04117 2E20      MOV	R2,R16
    04118 9420      COM	R2
    04119 9030 0064 LDS	R3,0x64
    0411B 2032      AND	R3,R2
    0411C 9230 0064 STS	0x64,R3
(0112) 	Delay_nus(4);
    0411E E004      LDI	R16,4
    0411F E010      LDI	R17,0
    04120 DF13      RCALL	_Delay_nus
(0113) 	k=IN_DQ;    	//读数据,从低位开始
    04121 9110 05CF LDS	R17,T_NUM
    04123 E001      LDI	R16,1
    04124 940E 494A CALL	lsl8
    04126 90A0 0063 LDS	R10,0x63
    04128 22A0      AND	R10,R16
(0114) 	Delay_nus(10);
    04129 E00A      LDI	R16,0xA
    0412A E010      LDI	R17,0
    0412B DF08      RCALL	_Delay_nus
(0115) 	SET_DQ;	
    0412C 9110 05CF LDS	R17,T_NUM
    0412E E001      LDI	R16,1
    0412F 940E 494A CALL	lsl8
    04131 9020 0065 LDS	R2,0x65
    04133 2A20      OR	R2,R16
    04134 9220 0065 STS	0x65,R2
(0116) 				NOP();
    04136 0000      NOP
(0117) 				NOP();
    04137 0000      NOP
(0118) 	SET_OUT;
    04138 9110 05CF LDS	R17,T_NUM
    0413A E001      LDI	R16,1
    0413B 940E 494A CALL	lsl8
    0413D 9020 0064 LDS	R2,0x64
    0413F 2A20      OR	R2,R16
    04140 9220 0064 STS	0x64,R2
(0119) 	    NOP();
    04142 0000      NOP
(0120) 					NOP();
    04143 0000      NOP
(0121) 	if(k){
    04144 20AA      TST	R10
    04145 F011      BEQ	0x4148
(0122) 	    return 1;
    04146 E001      LDI	R16,1
    04147 C001      RJMP	0x4149
(0123) 	}else{
(0124) 	    return 0;
    04148 2700      CLR	R16
    04149 90A9      LD	R10,Y+
    0414A 9508      RET
_write_byte_18B20:
  i                    --> R20
  data                 --> R10
    0414B 92AA      ST	-Y,R10
    0414C 934A      ST	-Y,R20
    0414D 2EA0      MOV	R10,R16
(0125) 	}
(0126) 	
(0127) }
(0128) 
(0129) //------------------------------------------------------------------------------
(0130) // 写一个字节到总线
(0131) //------------------------------------------------------------------------------
(0132) void write_byte_18B20(unsigned char data)
(0133) {
(0134) 	unsigned char i;
(0135)    CLI();
    0414E 94F8      BCLR	7
(0136)     for(i=0;i<8;i++)
    0414F 2744      CLR	R20
    04150 C009      RJMP	0x415A
(0137)     {
(0138)         write_bit_18B20(data&(1<<i));
    04151 E001      LDI	R16,1
    04152 2F14      MOV	R17,R20
    04153 940E 494A CALL	lsl8
    04155 2E20      MOV	R2,R16
    04156 2D0A      MOV	R16,R10
    04157 2102      AND	R16,R2
    04158 DF57      RCALL	_write_bit_18B20
    04159 9543      INC	R20
    0415A 3048      CPI	R20,0x8
    0415B F3A8      BCS	0x4151
(0139)         
(0140)     }
(0141)     SET_DQ;
    0415C 9110 05CF LDS	R17,T_NUM
    0415E E001      LDI	R16,1
    0415F 940E 494A CALL	lsl8
    04161 9020 0065 LDS	R2,0x65
    04163 2A20      OR	R2,R16
    04164 9220 0065 STS	0x65,R2
(0142) 				  NOP();
    04166 0000      NOP
(0143) 					 NOP();
    04167 0000      NOP
(0144)     SEI();
    04168 9478      BSET	7
    04169 9149      LD	R20,Y+
    0416A 90A9      LD	R10,Y+
    0416B 9508      RET
_read_byte_18B20:
  temp                 --> R10
  n                    --> R20
    0416C 92AA      ST	-Y,R10
    0416D 934A      ST	-Y,R20
(0145)     
(0146)     //return;
(0147) }
(0148) 
(0149) //------------------------------------------------------------------------------
(0150) // 读一个字节
(0151) //------------------------------------------------------------------------------
(0152) unsigned char read_byte_18B20(void)
(0153) {
(0154) 	unsigned char temp,n;
(0155)     CLI();
    0416E 94F8      BCLR	7
(0156)   	temp=0;
    0416F 24AA      CLR	R10
(0157)     for(n=0;n<8;n++)
    04170 2744      CLR	R20
    04171 C014      RJMP	0x4186
(0158)     {
(0159)       	if(read_bit_18B20()){
    04172 DF85      RCALL	_read_bit_18B20
    04173 2300      TST	R16
    04174 F031      BEQ	0x417B
(0160)       		temp|=(1<<n);
    04175 E001      LDI	R16,1
    04176 2F14      MOV	R17,R20
    04177 940E 494A CALL	lsl8
    04179 2AA0      OR	R10,R16
(0161)       	}else{
    0417A C007      RJMP	0x4182
(0162)       		temp&=~(1<<n);
    0417B E001      LDI	R16,1
    0417C 2F14      MOV	R17,R20
    0417D 940E 494A CALL	lsl8
    0417F 2E20      MOV	R2,R16
    04180 9420      COM	R2
    04181 20A2      AND	R10,R2
(0163)       	}
(0164)       	Delay_nus(70); //60~120us
    04182 E406      LDI	R16,0x46
    04183 E010      LDI	R17,0
    04184 DEAF      RCALL	_Delay_nus
    04185 9543      INC	R20
    04186 3048      CPI	R20,0x8
    04187 F350      BCS	0x4172
(0165)       	
(0166)    }
(0167)    SEI();
    04188 9478      BSET	7
(0168) 
(0169)    return temp;
    04189 2D0A      MOV	R16,R10
    0418A 9149      LD	R20,Y+
    0418B 90A9      LD	R10,Y+
    0418C 9508      RET
(0170) }
(0171) 
(0172) 
(0173) 
(0174) //------------------------------------------------------------------------------
(0175) // 应用函数部分！ 供外部调用
(0176) //------------------------------------------------------------------------------
(0177) //------------------------------------------------------------------------------
(0178) // 单器件/多器件：开始转换
(0179) //------------------------------------------------------------------------------
(0180) void convert_T(void)
(0181) {
(0182) 					if(reset_18B20()){
_convert_T:
    0418D DEB6      RCALL	_reset_18B20
    0418E 2300      TST	R16
    0418F F021      BEQ	0x4194
(0183) 					write_byte_18B20(0xcc);
    04190 EC0C      LDI	R16,0xCC
    04191 DFB9      RCALL	_write_byte_18B20
(0184) 					write_byte_18B20(0x44);
    04192 E404      LDI	R16,0x44
    04193 DFB7      RCALL	_write_byte_18B20
(0185) 					}
    04194 9508      RET
_read_T:
  tmp                  --> Y,+0
  tl                   --> R12
  th                   --> R10
    04195 940E 48B7 CALL	push_xgset00FC
    04197 9724      SBIW	R28,4
(0186) }
(0187) 
(0188) //------------------------------------------------------------------------------
(0189) // 单器件：读温度，返回INIT8U型温度数据（原始数据）
(0190) //------------------------------------------------------------------------------
(0191) float read_T(void)
(0192) {
(0193)     unsigned char th=0,tl=0;
    04198 24AA      CLR	R10
    04199 24CC      CLR	R12
(0194) 	float tmp;
(0195)     if(reset_18B20()){
    0419A DEA9      RCALL	_reset_18B20
    0419B 2300      TST	R16
    0419C F021      BEQ	0x41A1
(0196)     	write_byte_18B20(0xcc);
    0419D EC0C      LDI	R16,0xCC
    0419E DFAC      RCALL	_write_byte_18B20
(0197)     	write_byte_18B20(0xbe);
    0419F EB0E      LDI	R16,0xBE
    041A0 DFAA      RCALL	_write_byte_18B20
(0198)     }
(0199)     
(0200)     tl = read_byte_18B20();
    041A1 DFCA      RCALL	_read_byte_18B20
    041A2 2EC0      MOV	R12,R16
(0201)     th = read_byte_18B20();
    041A3 DFC8      RCALL	_read_byte_18B20
    041A4 2EE0      MOV	R14,R16
    041A5 2CAE      MOV	R10,R14
(0202)  	tmp= ((float)(th<<8|tl))*0.0625;
    041A6 EC0A      LDI	R16,0xCA
    041A7 E010      LDI	R17,0
    041A8 940E 483B CALL	elpm32
    041AA 0118      MOVW	R2,R16
    041AB 0129      MOVW	R4,R18
    041AC 2D1A      MOV	R17,R10
    041AD 2D0C      MOV	R16,R12
    041AE 940E 4A5E CALL	int2fp
    041B0 933A      ST	-Y,R19
    041B1 932A      ST	-Y,R18
    041B2 931A      ST	-Y,R17
    041B3 930A      ST	-Y,R16
    041B4 0181      MOVW	R16,R2
    041B5 0192      MOVW	R18,R4
    041B6 940E 4C03 CALL	fpmule2
    041B8 8308      ST	Y,R16
    041B9 8319      STD	Y+1,R17
    041BA 832A      STD	Y+2,R18
    041BB 833B      STD	Y+3,R19
(0203)     return( tmp);
    041BC 8108      LD	R16,Y
    041BD 8119      LDD	R17,Y+1
    041BE 812A      LDD	R18,Y+2
    041BF 813B      LDD	R19,Y+3
    041C0 9624      ADIW	R28,4
    041C1 940C 4898 JMP	pop_xgset00FC
_read_T_NUM:
  ttemp                --> Y,+0
  NUM                  --> R10
    041C3 92AA      ST	-Y,R10
    041C4 2EA0      MOV	R10,R16
    041C5 9724      SBIW	R28,4
(0204) }
(0205) 
(0206) float read_T_NUM(unsigned char NUM){
(0207) float ttemp;
(0208) if ( NUM >1) return 123.45;
    041C6 E081      LDI	R24,1
    041C7 158A      CP	R24,R10
    041C8 F428      BCC	0x41CE
    041C9 EC06      LDI	R16,0xC6
    041CA E010      LDI	R17,0
    041CB 940E 483B CALL	elpm32
    041CD C010      RJMP	0x41DE
(0209) T_NUM=NUM;//设置访问器件
    041CE 92A0 05CF STS	T_NUM,R10
(0210) convert_T();//温度转换
    041D0 DFBC      RCALL	_convert_T
(0211) delayms(800);
    041D1 E200      LDI	R16,0x20
    041D2 E013      LDI	R17,3
    041D3 940E 2532 CALL	_delayms
(0212) ttemp=read_T();
    041D5 DFBF      RCALL	_read_T
    041D6 8308      ST	Y,R16
    041D7 8319      STD	Y+1,R17
    041D8 832A      STD	Y+2,R18
    041D9 833B      STD	Y+3,R19
(0213) return ttemp;
    041DA 8108      LD	R16,Y
    041DB 8119      LDD	R17,Y+1
    041DC 812A      LDD	R18,Y+2
    041DD 813B      LDD	R19,Y+3
    041DE 9624      ADIW	R28,4
    041DF 90A9      LD	R10,Y+
    041E0 9508      RET
_readWithoutDelay:
  ttemp                --> Y,+0
  NUM                  --> R10
    041E1 92AA      ST	-Y,R10
    041E2 2EA0      MOV	R10,R16
    041E3 9724      SBIW	R28,4
(0214) }
(0215) float readWithoutDelay(unsigned char NUM)
(0216) {
(0217) float ttemp;
(0218) if ( NUM >1) return 123.45;
    041E4 E081      LDI	R24,1
    041E5 158A      CP	R24,R10
    041E6 F428      BCC	0x41EC
    041E7 EC06      LDI	R16,0xC6
    041E8 E010      LDI	R17,0
    041E9 940E 483B CALL	elpm32
    041EB C00C      RJMP	0x41F8
(0219) T_NUM=NUM;//设置访问器件
    041EC 92A0 05CF STS	T_NUM,R10
(0220) ttemp=read_T();
    041EE DFA6      RCALL	_read_T
    041EF 8308      ST	Y,R16
    041F0 8319      STD	Y+1,R17
    041F1 832A      STD	Y+2,R18
    041F2 833B      STD	Y+3,R19
(0221) convert_T();//温度转换
    041F3 DF99      RCALL	_convert_T
(0222) return ttemp;
    041F4 8108      LD	R16,Y
    041F5 8119      LDD	R17,Y+1
    041F6 812A      LDD	R18,Y+2
    041F7 813B      LDD	R19,Y+3
    041F8 9624      ADIW	R28,4
    041F9 90A9      LD	R10,Y+
    041FA 9508      RET
FILE: D:\LQD\software\software_src\ds1302.c
(0001) #include "config.h"
(0002) 
(0003) #define TPORT PORTB
(0004) #define TDDR DDRB
(0005) #define TPIN PINB
(0006) #define PIN_RST	 4
(0007) #define PIN_IO	 5
(0008) #define PIN_SCK	 6
(0009) /******************复位脚*********************/
(0010) #define RST_CLR	TPORT &= ~(1 << PIN_RST)   /*电平置低*/
(0011) #define RST_SET	TPORT |= (1 << PIN_RST)    /*电平置高*/
(0012) #define RST_IN	TDDR &= ~(1 << PIN_RST)    /*方向输入*/
(0013) #define RST_OUT	TDDR |= (1 << PIN_RST)     /*方向输出*/
(0014) 
(0015) /*****************双向数据********************/
(0016) #define IO_CLR	TPORT &= ~(1 << PIN_IO)  /*电平置低*/
(0017) #define IO_SET	TPORT |= (1 << PIN_IO)   /*电平置高*/
(0018) #define IO_R	TPIN & (1 << PIN_IO)     /*电平读取*/
(0019) #define IO_IN	TDDR &= ~(1 << PIN_IO)   /*方向输入*/
(0020) #define IO_OUT	TDDR |= (1 << PIN_IO)    /*方向输出*/
(0021) 
(0022) /*****************时钟信号*******************/
(0023) #define SCK_CLR	TPORT &= ~(1 << PIN_SCK)  /*时钟信号*/
(0024) #define SCK_SET	TPORT |= (1 << PIN_SCK)   /*电平置高*/
(0025) #define SCK_IN	TDDR &= ~(1 << PIN_SCK)   /*方向输入*/
(0026) #define SCK_OUT	TDDR |= (1 << PIN_SCK)    /*方向输出*/
(0027) 
(0028) #define ds1302_sec_add			0x80		//秒数据地址
(0029) #define ds1302_min_add			0x82		//分数据地址
(0030) #define ds1302_hr_add			0x84		//时数据地址
(0031) #define ds1302_date_add			0x86		//日数据地址
(0032) #define ds1302_month_add		0x88		//月数据地址
(0033) #define ds1302_day_add			0x8a		//星期数据地址
(0034) #define ds1302_year_add			0x8c		//年数据地址
(0035) #define ds1302_control_add		0x8e		//控制数据地址
(0036) #define ds1302_charger_add		0x90 					 
(0037) #define ds1302_clkburst_add		0xbe
(0038) 
(0039) unsigned char time_buf[8] = {0x20,0x0c,0x0A,0x1c,0x22,0x46,0x00,0x06};
(0040) /*
(0041)  struct tm {
(0042)    	int tm_sec;   // 秒 seconds after the minute, 0 to 60
(0043)    	int tm_min;   // 分 minutes after the hour, 0 to 59
(0044) 	int tm_hour;  // 时 hours since midnight, 0 to 23*
(0045) 	int tm_mday;  // 日 day of the month, 1 to 31
(0046) 	int tm_mon;   // 月 months since January, 0 to 11
(0047) 	int tm_year;  // 年 years since 1900
(0048) 	int tm_wday;  // 星期 days since Sunday, 0 to 6
(0049) 	int tm_yday;  // 从元旦起的天数 days since January 1, 0 to 365
(0050)  	int tm_isdst; // 夏令时？？Daylight Savings Time flag
(0051)  	};	
(0052) 	*/
(0053) 
(0054) //DS1302初始化函数
(0055) void ds1302_init(void) 
(0056) {
(0057) 	RST_CLR;			/*RST脚置低*/
_ds1302_init:
    041FB 98C4      CBI	0x18,4
(0058) 	SCK_CLR;			/*SCK脚置低*/
    041FC 98C6      CBI	0x18,6
(0059) 	RST_OUT;			/*RST脚设置为输出*/
    041FD 9ABC      SBI	0x17,4
(0060) 	SCK_OUT;			/*SCK脚设置为输出*/
    041FE 9ABE      SBI	0x17,6
    041FF 9508      RET
_ds1302_write_byte:
  i                    --> R20
  d                    --> R18
  addr                 --> R16
    04200 934A      ST	-Y,R20
(0061) }
(0062) 
(0063) //向DS1302写入一字节数据
(0064) void ds1302_write_byte(unsigned char addr, unsigned char d) {
(0065) 
(0066) 	unsigned char i;
(0067) 	RST_SET;					/*启动DS1302总线*/
    04201 9AC4      SBI	0x18,4
(0068) 	
(0069) 	/*写入目标地址：addr*/
(0070) 	IO_OUT;
    04202 9ABD      SBI	0x17,5
(0071) 	addr = addr & 0xFE;   //最低位置零，寄存器0位为0时写，为1时读
    04203 7F0E      ANDI	R16,0xFE
(0072) 	for (i = 0; i < 8; i ++) {
    04204 2744      CLR	R20
    04205 C009      RJMP	0x420F
(0073) 		if (addr & 0x01) {
    04206 FF00      SBRS	R16,0
    04207 C002      RJMP	0x420A
(0074) 			IO_SET;
    04208 9AC5      SBI	0x18,5
(0075) 			}
    04209 C001      RJMP	0x420B
(0076) 		else {
(0077) 			IO_CLR;
    0420A 98C5      CBI	0x18,5
(0078) 			}
(0079) 		SCK_SET;      //产生时钟
    0420B 9AC6      SBI	0x18,6
(0080) 		SCK_CLR;
    0420C 98C6      CBI	0x18,6
(0081) 		addr = addr >> 1;
    0420D 9506      LSR	R16
    0420E 9543      INC	R20
    0420F 3048      CPI	R20,0x8
    04210 F3A8      BCS	0x4206
(0082) 		}
(0083) 	
(0084) 	/*写入数据：d*/
(0085) 	IO_OUT;
    04211 9ABD      SBI	0x17,5
(0086) 	for (i = 0; i < 8; i ++) {
    04212 2744      CLR	R20
    04213 C009      RJMP	0x421D
(0087) 		if (d & 0x01) {
    04214 FF20      SBRS	R18,0
    04215 C002      RJMP	0x4218
(0088) 			IO_SET;
    04216 9AC5      SBI	0x18,5
(0089) 			}
    04217 C001      RJMP	0x4219
(0090) 		else {
(0091) 			IO_CLR;
    04218 98C5      CBI	0x18,5
(0092) 			}
(0093) 		SCK_SET;    //产生时钟
    04219 9AC6      SBI	0x18,6
(0094) 		SCK_CLR;
    0421A 98C6      CBI	0x18,6
(0095) 		d = d >> 1;
    0421B 9526      LSR	R18
    0421C 9543      INC	R20
    0421D 3048      CPI	R20,0x8
    0421E F3A8      BCS	0x4214
(0096) 		}
(0097) 	RST_CLR;		//停止DS1302总线
    0421F 98C4      CBI	0x18,4
    04220 9149      LD	R20,Y+
    04221 9508      RET
_ds1302_read_byte:
  temp                 --> R20
  i                    --> R22
  addr                 --> R16
    04222 934A      ST	-Y,R20
    04223 936A      ST	-Y,R22
(0098) 	
(0099) }
(0100) 
(0101) //从DS1302读出一字节数据
(0102) unsigned char ds1302_read_byte(unsigned char addr) {
(0103) 
(0104) 	unsigned char i;
(0105) 	unsigned char temp;
(0106) 	RST_SET;					/*启动DS1302总线*/
    04224 9AC4      SBI	0x18,4
(0107) 
(0108) 	/*写入目标地址：addr*/
(0109) 	IO_OUT;
    04225 9ABD      SBI	0x17,5
(0110) 	addr = addr | 0x01;    //最低位置高，寄存器0位为0时写，为1时读
    04226 6001      ORI	R16,1
(0111) 	for (i = 0; i < 8; i ++) {
    04227 2766      CLR	R22
    04228 C009      RJMP	0x4232
(0112) 		if (addr & 0x01) {
    04229 FF00      SBRS	R16,0
    0422A C002      RJMP	0x422D
(0113) 			IO_SET;
    0422B 9AC5      SBI	0x18,5
(0114) 			}
    0422C C001      RJMP	0x422E
(0115) 		else {
(0116) 			IO_CLR;
    0422D 98C5      CBI	0x18,5
(0117) 			}
(0118) 		SCK_SET;
    0422E 9AC6      SBI	0x18,6
(0119) 		SCK_CLR;
    0422F 98C6      CBI	0x18,6
(0120) 		addr = addr >> 1;
    04230 9506      LSR	R16
    04231 9563      INC	R22
    04232 3068      CPI	R22,0x8
    04233 F3A8      BCS	0x4229
(0121) 		}
(0122) 	
(0123) 	/*输出数据：temp*/
(0124) 	IO_IN;
    04234 98BD      CBI	0x17,5
(0125) 	for (i = 0; i < 8; i ++) {
    04235 2766      CLR	R22
    04236 C009      RJMP	0x4240
(0126) 		temp = temp >> 1;
    04237 9546      LSR	R20
(0127) 		if (IO_R) {
    04238 9BB5      SBIS	0x16,5
    04239 C002      RJMP	0x423C
(0128) 			temp |= 0x80;
    0423A 6840      ORI	R20,0x80
(0129) 			}
    0423B C001      RJMP	0x423D
(0130) 		else {
(0131) 			temp &= 0x7F;
    0423C 774F      ANDI	R20,0x7F
(0132) 			}
(0133) 		SCK_SET;
    0423D 9AC6      SBI	0x18,6
(0134) 		SCK_CLR;
    0423E 98C6      CBI	0x18,6
    0423F 9563      INC	R22
    04240 3068      CPI	R22,0x8
    04241 F3A8      BCS	0x4237
(0135) 		}
(0136) 	
(0137) 	RST_CLR;					/*停止DS1302总线*/
    04242 98C4      CBI	0x18,4
(0138) 	return temp;
    04243 2F04      MOV	R16,R20
    04244 9169      LD	R22,Y+
    04245 9149      LD	R20,Y+
    04246 9508      RET
(0139) }
(0140) 
(0141) //向DS302写入时钟数据
(0142) void ds1302_write_time(void) {
(0143) 
(0144) 	ds1302_write_byte(ds1302_control_add,0x00);			//关闭写保护 
_ds1302_write_time:
    04247 2722      CLR	R18
    04248 E80E      LDI	R16,0x8E
    04249 DFB6      RCALL	_ds1302_write_byte
(0145) 	ds1302_write_byte(ds1302_sec_add,0x80);				//暂停时钟 
    0424A E820      LDI	R18,0x80
    0424B E800      LDI	R16,0x80
    0424C DFB3      RCALL	_ds1302_write_byte
(0146) 	//ds1302_write_byte(ds1302_charger_add,0xa9);	    //涓流充电 
(0147) 	ds1302_write_byte(ds1302_year_add,time_buf[1]);		//年 
    0424D 9120 05D1 LDS	R18,time_buf+1
    0424F E80C      LDI	R16,0x8C
    04250 DFAF      RCALL	_ds1302_write_byte
(0148) 	ds1302_write_byte(ds1302_month_add,time_buf[2]);	//月 
    04251 9120 05D2 LDS	R18,time_buf+2
    04253 E808      LDI	R16,0x88
    04254 DFAB      RCALL	_ds1302_write_byte
(0149) 	ds1302_write_byte(ds1302_date_add,time_buf[3]);		//日 
    04255 9120 05D3 LDS	R18,time_buf+3
    04257 E806      LDI	R16,0x86
    04258 DFA7      RCALL	_ds1302_write_byte
(0150) 	ds1302_write_byte(ds1302_hr_add,time_buf[4]);		//时 
    04259 9120 05D4 LDS	R18,time_buf+4
    0425B E804      LDI	R16,0x84
    0425C DFA3      RCALL	_ds1302_write_byte
(0151) 	ds1302_write_byte(ds1302_min_add,time_buf[5]);		//分
    0425D 9120 05D5 LDS	R18,time_buf+5
    0425F E802      LDI	R16,0x82
    04260 DF9F      RCALL	_ds1302_write_byte
(0152) 	ds1302_write_byte(ds1302_sec_add,time_buf[6]);		//秒
    04261 9120 05D6 LDS	R18,time_buf+6
    04263 E800      LDI	R16,0x80
    04264 DF9B      RCALL	_ds1302_write_byte
(0153) 	ds1302_write_byte(ds1302_day_add,time_buf[7]);		//周 
    04265 9120 05D7 LDS	R18,time_buf+7
    04267 E80A      LDI	R16,0x8A
    04268 DF97      RCALL	_ds1302_write_byte
(0154) 	ds1302_write_byte(ds1302_control_add,0x80);			//打开写保护 
    04269 E820      LDI	R18,0x80
    0426A E80E      LDI	R16,0x8E
    0426B CF94      RJMP	_ds1302_write_byte
_ds1302_read_time:
    0426C 92AA      ST	-Y,R10
    0426D 934A      ST	-Y,R20
(0155) }
(0156) 
(0157) //从DS302读出时钟数据
(0158) void ds1302_read_time(void)  { 
(0159) 	time_buf[1]=ds1302_read_byte(ds1302_year_add);		//年 
    0426E E80C      LDI	R16,0x8C
    0426F DFB2      RCALL	_ds1302_read_byte
    04270 9300 05D1 STS	time_buf+1,R16
(0160) 	time_buf[2]=ds1302_read_byte(ds1302_month_add);		//月 
    04272 E808      LDI	R16,0x88
    04273 DFAE      RCALL	_ds1302_read_byte
    04274 9300 05D2 STS	time_buf+2,R16
(0161) 	time_buf[3]=ds1302_read_byte(ds1302_date_add);		//日 
    04276 E806      LDI	R16,0x86
    04277 DFAA      RCALL	_ds1302_read_byte
    04278 2EA0      MOV	R10,R16
    04279 92A0 05D3 STS	time_buf+3,R10
(0162) 	time_buf[4]=ds1302_read_byte(ds1302_hr_add);		//时 
    0427B E804      LDI	R16,0x84
    0427C DFA5      RCALL	_ds1302_read_byte
    0427D 2EA0      MOV	R10,R16
    0427E 92A0 05D4 STS	time_buf+4,R10
(0163) 	time_buf[5]=ds1302_read_byte(ds1302_min_add);		//分 
    04280 E802      LDI	R16,0x82
    04281 DFA0      RCALL	_ds1302_read_byte
    04282 2EA0      MOV	R10,R16
    04283 92A0 05D5 STS	time_buf+5,R10
(0164) 	time_buf[6]=(ds1302_read_byte(ds1302_sec_add))&0x7F;//秒，屏蔽秒的第7位，避免超出59
    04285 E800      LDI	R16,0x80
    04286 DF9B      RCALL	_ds1302_read_byte
    04287 2F40      MOV	R20,R16
    04288 2F84      MOV	R24,R20
    04289 778F      ANDI	R24,0x7F
    0428A 9380 05D6 STS	time_buf+6,R24
(0165) 	time_buf[7]=ds1302_read_byte(ds1302_day_add);		//周 
    0428C E80A      LDI	R16,0x8A
    0428D DF94      RCALL	_ds1302_read_byte
    0428E 2EA0      MOV	R10,R16
    0428F 92A0 05D7 STS	time_buf+7,R10
    04291 9149      LD	R20,Y+
    04292 90A9      LD	R10,Y+
    04293 9508      RET
_kbscan:
  key                  --> R20
  temp                 --> Y,+0
    04294 934A      ST	-Y,R20
    04295 9724      SBIW	R28,4
FILE: D:\LQD\software\software_src\key.c
(0001) #include "config.h"
(0002) //键盘扫描函数
(0003) unsigned char kbscan(void)
(0004)   {
(0005)    unsigned char key;
(0006)    unsigned long temp=0;
    04296 E080      LDI	R24,0
    04297 8388      ST	Y,R24
    04298 8389      STD	Y+1,R24
    04299 838A      STD	Y+2,R24
    0429A 838B      STD	Y+3,R24
(0007)    DDR_SET;
    0429B B38A      IN	R24,0x1A
    0429C 7087      ANDI	R24,7
    0429D BB8A      OUT	0x1A,R24
(0008)    
(0009)    if((KEY_PIN) != KEY_MASK)         //检测A口按键引脚电平，如果全是高电平则退出
    0429E B389      IN	R24,0x19
    0429F 718F      ANDI	R24,0x1F
    042A0 318F      CPI	R24,0x1F
    042A1 F1A9      BEQ	0x42D7
(0010)     {
(0011)      delayms(20);           //防抖
    042A2 E104      LDI	R16,0x14
    042A3 E010      LDI	R17,0
    042A4 940E 2532 CALL	_delayms
(0012)      if((KEY_PIN) != KEY_MASK )      //再次检测A口电平，如果不全是高电平则继续执行程序
    042A6 B389      IN	R24,0x19
    042A7 718F      ANDI	R24,0x1F
    042A8 318F      CPI	R24,0x1F
    042A9 F179      BEQ	0x42D9
(0013)       {
(0014)        key = KEY_PIN ;          //读取PINA，将其存放在key中
    042AA B349      IN	R20,0x19
    042AB 714F      ANDI	R20,0x1F
    042AC C024      RJMP	0x42D1
(0015)         while((KEY_PIN) != KEY_MASK)
(0016) 		{
(0017) 		 temp++ ;
    042AD E081      LDI	R24,1
    042AE E090      LDI	R25,0
    042AF E0A0      LDI	R26,0
    042B0 E0B0      LDI	R27,0
    042B1 8028      LD	R2,Y
    042B2 8039      LDD	R3,Y+1
    042B3 804A      LDD	R4,Y+2
    042B4 805B      LDD	R5,Y+3
    042B5 0E28      ADD	R2,R24
    042B6 1E39      ADC	R3,R25
    042B7 1E4A      ADC	R4,R26
    042B8 1E5B      ADC	R5,R27
    042B9 8228      ST	Y,R2
    042BA 8239      STD	Y+1,R3
    042BB 824A      STD	Y+2,R4
    042BC 825B      STD	Y+3,R5
(0018) 		 if(temp>LONGKEY) {  
    042BD E880      LDI	R24,0x80
    042BE E398      LDI	R25,0x38
    042BF E0A1      LDI	R26,1
    042C0 E0B0      LDI	R27,0
    042C1 8028      LD	R2,Y
    042C2 8039      LDD	R3,Y+1
    042C3 804A      LDD	R4,Y+2
    042C4 805B      LDD	R5,Y+3
    042C5 1582      CP	R24,R2
    042C6 0593      CPC	R25,R3
    042C7 05A4      CPC	R26,R4
    042C8 05B5      CPC	R27,R5
    042C9 F438      BCC	0x42D1
(0019) 		     delayms(30);
    042CA E10E      LDI	R16,0x1E
    042CB E010      LDI	R17,0
    042CC 940E 2532 CALL	_delayms
(0020) 			 return key+0x80;  
    042CE 2F04      MOV	R16,R20
    042CF 5800      SUBI	R16,0x80
    042D0 C009      RJMP	0x42DA
    042D1 B389      IN	R24,0x19
    042D2 718F      ANDI	R24,0x1F
    042D3 318F      CPI	R24,0x1F
    042D4 F6C1      BNE	0x42AD
(0021) 		 };
(0022) 		}
(0023) 		; //当前有按键处于按下状态，再按其他按键时程序维持当前状态 
(0024)       	
(0025) 		return key;
    042D5 2F04      MOV	R16,R20
    042D6 C003      RJMP	0x42DA
(0026) 	  
(0027) 	  }
(0028)     }
(0029) 	else return NO_KEY;
    042D7 2700      CLR	R16
    042D8 C001      RJMP	0x42DA
(0030) 	
(0031) 	return NO_KEY;
FILE: <library>
    042D9 2700      CLR	R16
    042DA 9624      ADIW	R28,4
    042DB 9149      LD	R20,Y+
    042DC 9508      RET
__print:
    042DD 940E 476E CALL	push_arg4
    042DF 940E 48B3 CALL	push_xgsetF0FC
    042E1 976C      SBIW	R28,0x1C
    042E2 2400      CLR	R0
    042E3 2411      CLR	R1
    042E4 8A1F      STD	Y+23,R1
    042E5 8A0E      STD	Y+22,R0
    042E6 C456      RJMP	0x473D
    042E7 A5E8      LDD	R30,Y+40
    042E8 A5F9      LDD	R31,Y+41
    042E9 8180      LD	R24,Z
    042EA 3285      CPI	R24,0x25
    042EB F059      BEQ	0x42F7
    042EC 8100      LD	R16,Z
    042ED A1EE      LDD	R30,Y+38
    042EE A1FF      LDD	R31,Y+39
    042EF 940E 4900 CALL	xicallx
    042F1 898E      LDD	R24,Y+22
    042F2 899F      LDD	R25,Y+23
    042F3 9601      ADIW	R24,1
    042F4 8B9F      STD	Y+23,R25
    042F5 8B8E      STD	Y+22,R24
    042F6 C441      RJMP	0x4738
    042F7 2400      CLR	R0
    042F8 2411      CLR	R1
    042F9 8A1D      STD	Y+21,R1
    042FA 8A0C      STD	Y+20,R0
    042FB EF8F      LDI	R24,0xFF
    042FC EF9F      LDI	R25,0xFF
    042FD 8F99      STD	Y+25,R25
    042FE 8F88      STD	Y+24,R24
    042FF 24AA      CLR	R10
    04300 24BB      CLR	R11
    04301 EB45      LDI	R20,0xB5
    04302 E058      LDI	R21,0x8
    04303 E260      LDI	R22,0x20
    04304 A588      LDD	R24,Y+40
    04305 A599      LDD	R25,Y+41
    04306 9601      ADIW	R24,1
    04307 A799      STD	Y+41,R25
    04308 A788      STD	Y+40,R24
    04309 24CC      CLR	R12
    0430A 24DD      CLR	R13
    0430B A5E8      LDD	R30,Y+40
    0430C A5F9      LDD	R31,Y+41
    0430D 80E0      LD	R14,Z
    0430E 24FF      CLR	R15
    0430F 01C7      MOVW	R24,R14
    04310 3280      CPI	R24,0x20
    04311 E0E0      LDI	R30,0
    04312 079E      CPC	R25,R30
    04313 F119      BEQ	0x4337
    04314 3283      CPI	R24,0x23
    04315 E0E0      LDI	R30,0
    04316 079E      CPC	R25,R30
    04317 F091      BEQ	0x432A
    04318 3280      CPI	R24,0x20
    04319 E0E0      LDI	R30,0
    0431A 079E      CPC	R25,R30
    0431B F124      BLT	0x4340
    0431C 01C7      MOVW	R24,R14
    0431D 328B      CPI	R24,0x2B
    0431E E0E0      LDI	R30,0
    0431F 079E      CPC	R25,R30
    04320 F089      BEQ	0x4332
    04321 328D      CPI	R24,0x2D
    04322 E0E0      LDI	R30,0
    04323 079E      CPC	R25,R30
    04324 F049      BEQ	0x432E
    04325 3380      CPI	R24,0x30
    04326 E0E0      LDI	R30,0
    04327 079E      CPC	R25,R30
    04328 F099      BEQ	0x433C
    04329 C016      RJMP	0x4340
    0432A 01C5      MOVW	R24,R10
    0432B 6081      ORI	R24,1
    0432C 015C      MOVW	R10,R24
    0432D C015      RJMP	0x4343
    0432E 01C5      MOVW	R24,R10
    0432F 6084      ORI	R24,4
    04330 015C      MOVW	R10,R24
    04331 C011      RJMP	0x4343
    04332 01C5      MOVW	R24,R10
    04333 6088      ORI	R24,0x8
    04334 015C      MOVW	R10,R24
    04335 E26B      LDI	R22,0x2B
    04336 C00C      RJMP	0x4343
    04337 01C5      MOVW	R24,R10
    04338 6088      ORI	R24,0x8
    04339 015C      MOVW	R10,R24
    0433A E260      LDI	R22,0x20
    0433B C007      RJMP	0x4343
    0433C 01C5      MOVW	R24,R10
    0433D 6180      ORI	R24,0x10
    0433E 015C      MOVW	R10,R24
    0433F C003      RJMP	0x4343
    04340 E081      LDI	R24,1
    04341 E090      LDI	R25,0
    04342 016C      MOVW	R12,R24
    04343 20CC      TST	R12
    04344 F411      BNE	0x4347
    04345 20DD      TST	R13
    04346 F009      BEQ	0x4348
    04347 C006      RJMP	0x434E
    04348 A588      LDD	R24,Y+40
    04349 A599      LDD	R25,Y+41
    0434A 9601      ADIW	R24,1
    0434B A799      STD	Y+41,R25
    0434C A788      STD	Y+40,R24
    0434D CFBD      RJMP	0x430B
    0434E A5E8      LDD	R30,Y+40
    0434F A5F9      LDD	R31,Y+41
    04350 8100      LD	R16,Z
    04351 2711      CLR	R17
    04352 940E 4FF5 CALL	_isdigit
    04354 3000      CPI	R16,0
    04355 0701      CPC	R16,R17
    04356 F0B9      BEQ	0x436E
    04357 A508      LDD	R16,Y+40
    04358 A519      LDD	R17,Y+41
    04359 940E 4C56 CALL	_atoi
    0435B 8B1D      STD	Y+21,R17
    0435C 8B0C      STD	Y+20,R16
    0435D C005      RJMP	0x4363
    0435E A588      LDD	R24,Y+40
    0435F A599      LDD	R25,Y+41
    04360 9601      ADIW	R24,1
    04361 A799      STD	Y+41,R25
    04362 A788      STD	Y+40,R24
    04363 A5E8      LDD	R30,Y+40
    04364 A5F9      LDD	R31,Y+41
    04365 8100      LD	R16,Z
    04366 2711      CLR	R17
    04367 940E 4FF5 CALL	_isdigit
    04369 0168      MOVW	R12,R16
    0436A 3000      CPI	R16,0
    0436B 0701      CPC	R16,R17
    0436C F789      BNE	0x435E
    0436D C015      RJMP	0x4383
    0436E A5E8      LDD	R30,Y+40
    0436F A5F9      LDD	R31,Y+41
    04370 8180      LD	R24,Z
    04371 328A      CPI	R24,0x2A
    04372 F481      BNE	0x4383
    04373 A58A      LDD	R24,Y+42
    04374 A59B      LDD	R25,Y+43
    04375 9602      ADIW	R24,2
    04376 A79B      STD	Y+43,R25
    04377 A78A      STD	Y+42,R24
    04378 01FC      MOVW	R30,R24
    04379 9732      SBIW	R30,2
    0437A 8020      LD	R2,Z
    0437B 8031      LDD	R3,Z+1
    0437C 8A3D      STD	Y+21,R3
    0437D 8A2C      STD	Y+20,R2
    0437E A588      LDD	R24,Y+40
    0437F A599      LDD	R25,Y+41
    04380 9601      ADIW	R24,1
    04381 A799      STD	Y+41,R25
    04382 A788      STD	Y+40,R24
    04383 A5E8      LDD	R30,Y+40
    04384 A5F9      LDD	R31,Y+41
    04385 8180      LD	R24,Z
    04386 328E      CPI	R24,0x2E
    04387 F009      BEQ	0x4389
    04388 C03A      RJMP	0x43C3
    04389 01CF      MOVW	R24,R30
    0438A 9601      ADIW	R24,1
    0438B A799      STD	Y+41,R25
    0438C A788      STD	Y+40,R24
    0438D 01FC      MOVW	R30,R24
    0438E 8100      LD	R16,Z
    0438F 2711      CLR	R17
    04390 940E 4FF5 CALL	_isdigit
    04392 0168      MOVW	R12,R16
    04393 3000      CPI	R16,0
    04394 0701      CPC	R16,R17
    04395 F0C1      BEQ	0x43AE
    04396 A508      LDD	R16,Y+40
    04397 A519      LDD	R17,Y+41
    04398 940E 4C56 CALL	_atoi
    0439A 0168      MOVW	R12,R16
    0439B 8ED9      STD	Y+25,R13
    0439C 8EC8      STD	Y+24,R12
    0439D C005      RJMP	0x43A3
    0439E A588      LDD	R24,Y+40
    0439F A599      LDD	R25,Y+41
    043A0 9601      ADIW	R24,1
    043A1 A799      STD	Y+41,R25
    043A2 A788      STD	Y+40,R24
    043A3 A5E8      LDD	R30,Y+40
    043A4 A5F9      LDD	R31,Y+41
    043A5 8100      LD	R16,Z
    043A6 2711      CLR	R17
    043A7 940E 4FF5 CALL	_isdigit
    043A9 0168      MOVW	R12,R16
    043AA 3000      CPI	R16,0
    043AB 0701      CPC	R16,R17
    043AC F789      BNE	0x439E
    043AD C015      RJMP	0x43C3
    043AE A5E8      LDD	R30,Y+40
    043AF A5F9      LDD	R31,Y+41
    043B0 8180      LD	R24,Z
    043B1 328A      CPI	R24,0x2A
    043B2 F481      BNE	0x43C3
    043B3 A58A      LDD	R24,Y+42
    043B4 A59B      LDD	R25,Y+43
    043B5 9602      ADIW	R24,2
    043B6 A79B      STD	Y+43,R25
    043B7 A78A      STD	Y+42,R24
    043B8 01FC      MOVW	R30,R24
    043B9 9732      SBIW	R30,2
    043BA 8020      LD	R2,Z
    043BB 8031      LDD	R3,Z+1
    043BC 8E39      STD	Y+25,R3
    043BD 8E28      STD	Y+24,R2
    043BE A588      LDD	R24,Y+40
    043BF A599      LDD	R25,Y+41
    043C0 9601      ADIW	R24,1
    043C1 A799      STD	Y+41,R25
    043C2 A788      STD	Y+40,R24
    043C3 A5E8      LDD	R30,Y+40
    043C4 A5F9      LDD	R31,Y+41
    043C5 8180      LD	R24,Z
    043C6 368C      CPI	R24,0x6C
    043C7 F439      BNE	0x43CF
    043C8 01CF      MOVW	R24,R30
    043C9 9601      ADIW	R24,1
    043CA A799      STD	Y+41,R25
    043CB A788      STD	Y+40,R24
    043CC 01C5      MOVW	R24,R10
    043CD 6082      ORI	R24,2
    043CE 015C      MOVW	R10,R24
    043CF A5E8      LDD	R30,Y+40
    043D0 A5F9      LDD	R31,Y+41
    043D1 80C0      LD	R12,Z
    043D2 24DD      CLR	R13
    043D3 01C6      MOVW	R24,R12
    043D4 3583      CPI	R24,0x53
    043D5 E0E0      LDI	R30,0
    043D6 079E      CPC	R25,R30
    043D7 F409      BNE	0x43D9
    043D8 C18A      RJMP	0x4563
    043D9 E583      LDI	R24,0x53
    043DA 158C      CP	R24,R12
    043DB 059D      CPC	R25,R13
    043DC F064      BLT	0x43E9
    043DD 01C6      MOVW	R24,R12
    043DE 3485      CPI	R24,0x45
    043DF E0E0      LDI	R30,0
    043E0 079E      CPC	R25,R30
    043E1 F409      BNE	0x43E3
    043E2 C307      RJMP	0x46EA
    043E3 3487      CPI	R24,0x47
    043E4 E0E0      LDI	R30,0
    043E5 079E      CPC	R25,R30
    043E6 F409      BNE	0x43E8
    043E7 C30B      RJMP	0x46F3
    043E8 C043      RJMP	0x442C
    043E9 01C6      MOVW	R24,R12
    043EA 3588      CPI	R24,0x58
    043EB E0E0      LDI	R30,0
    043EC 079E      CPC	R25,R30
    043ED F409      BNE	0x43EF
    043EE C07E      RJMP	0x446D
    043EF 3588      CPI	R24,0x58
    043F0 E0E0      LDI	R30,0
    043F1 079E      CPC	R25,R30
    043F2 F40C      BGE	0x43F4
    043F3 C038      RJMP	0x442C
    043F4 01C6      MOVW	R24,R12
    043F5 3683      CPI	R24,0x63
    043F6 E0E0      LDI	R30,0
    043F7 079E      CPC	R25,R30
    043F8 F409      BNE	0x43FA
    043F9 C145      RJMP	0x453F
    043FA 3684      CPI	R24,0x64
    043FB E0E0      LDI	R30,0
    043FC 079E      CPC	R25,R30
    043FD F409      BNE	0x43FF
    043FE C03A      RJMP	0x4439
    043FF 3685      CPI	R24,0x65
    04400 E0E0      LDI	R30,0
    04401 079E      CPC	R25,R30
    04402 F409      BNE	0x4404
    04403 C2E3      RJMP	0x46E7
    04404 3686      CPI	R24,0x66
    04405 E0E0      LDI	R30,0
    04406 079E      CPC	R25,R30
    04407 F409      BNE	0x4409
    04408 C2E4      RJMP	0x46ED
    04409 3687      CPI	R24,0x67
    0440A E0E0      LDI	R30,0
    0440B 079E      CPC	R25,R30
    0440C F409      BNE	0x440E
    0440D C2E2      RJMP	0x46F0
    0440E 3689      CPI	R24,0x69
    0440F E0E0      LDI	R30,0
    04410 079E      CPC	R25,R30
    04411 F139      BEQ	0x4439
    04412 368F      CPI	R24,0x6F
    04413 E0E0      LDI	R30,0
    04414 079E      CPC	R25,R30
    04415 F409      BNE	0x4417
    04416 C056      RJMP	0x446D
    04417 3780      CPI	R24,0x70
    04418 E0E0      LDI	R30,0
    04419 079E      CPC	R25,R30
    0441A F409      BNE	0x441C
    0441B C051      RJMP	0x446D
    0441C 3783      CPI	R24,0x73
    0441D E0E0      LDI	R30,0
    0441E 079E      CPC	R25,R30
    0441F F409      BNE	0x4421
    04420 C200      RJMP	0x4621
    04421 3785      CPI	R24,0x75
    04422 E0E0      LDI	R30,0
    04423 079E      CPC	R25,R30
    04424 F409      BNE	0x4426
    04425 C047      RJMP	0x446D
    04426 3788      CPI	R24,0x78
    04427 E0E0      LDI	R30,0
    04428 079E      CPC	R25,R30
    04429 F409      BNE	0x442B
    0442A C042      RJMP	0x446D
    0442B C000      RJMP	0x442C
    0442C A5E8      LDD	R30,Y+40
    0442D A5F9      LDD	R31,Y+41
    0442E 8100      LD	R16,Z
    0442F A1EE      LDD	R30,Y+38
    04430 A1FF      LDD	R31,Y+39
    04431 940E 4900 CALL	xicallx
    04433 898E      LDD	R24,Y+22
    04434 899F      LDD	R25,Y+23
    04435 9601      ADIW	R24,1
    04436 8B9F      STD	Y+23,R25
    04437 8B8E      STD	Y+22,R24
    04438 C2FF      RJMP	0x4738
    04439 FEA1      SBRS	R10,1
    0443A C01E      RJMP	0x4459
    0443B A58A      LDD	R24,Y+42
    0443C A59B      LDD	R25,Y+43
    0443D 9604      ADIW	R24,4
    0443E A79B      STD	Y+43,R25
    0443F A78A      STD	Y+42,R24
    04440 01FC      MOVW	R30,R24
    04441 9734      SBIW	R30,4
    04442 8020      LD	R2,Z
    04443 8031      LDD	R3,Z+1
    04444 8042      LDD	R4,Z+2
    04445 8053      LDD	R5,Z+3
    04446 862C      STD	Y+12,R2
    04447 863D      STD	Y+13,R3
    04448 864E      STD	Y+14,R4
    04449 865F      STD	Y+15,R5
    0444A E08A      LDI	R24,0xA
    0444B E090      LDI	R25,0
    0444C 839B      STD	Y+3,R25
    0444D 838A      STD	Y+2,R24
    0444E 842C      LDD	R2,Y+12
    0444F 843D      LDD	R3,Y+13
    04450 844E      LDD	R4,Y+14
    04451 845F      LDD	R5,Y+15
    04452 8248      ST	Y,R4
    04453 8259      STD	Y+1,R5
    04454 0191      MOVW	R18,R2
    04455 018A      MOVW	R16,R20
    04456 940E 4D07 CALL	_ltoa
    04458 C0C1      RJMP	0x451A
    04459 A58A      LDD	R24,Y+42
    0445A A59B      LDD	R25,Y+43
    0445B 9602      ADIW	R24,2
    0445C A79B      STD	Y+43,R25
    0445D A78A      STD	Y+42,R24
    0445E 01FC      MOVW	R30,R24
    0445F 9732      SBIW	R30,2
    04460 8020      LD	R2,Z
    04461 8031      LDD	R3,Z+1
    04462 8E3B      STD	Y+27,R3
    04463 8E2A      STD	Y+26,R2
    04464 E08A      LDI	R24,0xA
    04465 E090      LDI	R25,0
    04466 8399      STD	Y+1,R25
    04467 8388      ST	Y,R24
    04468 0191      MOVW	R18,R2
    04469 018A      MOVW	R16,R20
    0446A 940E 4C9C CALL	_itoa
    0446C C0AD      RJMP	0x451A
    0446D FEA1      SBRS	R10,1
    0446E C010      RJMP	0x447F
    0446F A58A      LDD	R24,Y+42
    04470 A59B      LDD	R25,Y+43
    04471 9604      ADIW	R24,4
    04472 A79B      STD	Y+43,R25
    04473 A78A      STD	Y+42,R24
    04474 01FC      MOVW	R30,R24
    04475 9734      SBIW	R30,4
    04476 8020      LD	R2,Z
    04477 8031      LDD	R3,Z+1
    04478 8042      LDD	R4,Z+2
    04479 8053      LDD	R5,Z+3
    0447A 862C      STD	Y+12,R2
    0447B 863D      STD	Y+13,R3
    0447C 864E      STD	Y+14,R4
    0447D 865F      STD	Y+15,R5
    0447E C00B      RJMP	0x448A
    0447F A58A      LDD	R24,Y+42
    04480 A59B      LDD	R25,Y+43
    04481 9602      ADIW	R24,2
    04482 A79B      STD	Y+43,R25
    04483 A78A      STD	Y+42,R24
    04484 01FC      MOVW	R30,R24
    04485 9732      SBIW	R30,2
    04486 8020      LD	R2,Z
    04487 8031      LDD	R3,Z+1
    04488 8E3B      STD	Y+27,R3
    04489 8E2A      STD	Y+26,R2
    0448A A5E8      LDD	R30,Y+40
    0448B A5F9      LDD	R31,Y+41
    0448C 8180      LD	R24,Z
    0448D 3785      CPI	R24,0x75
    0448E F4D9      BNE	0x44AA
    0448F FEA1      SBRS	R10,1
    04490 C00F      RJMP	0x44A0
    04491 E08A      LDI	R24,0xA
    04492 E090      LDI	R25,0
    04493 839B      STD	Y+3,R25
    04494 838A      STD	Y+2,R24
    04495 842C      LDD	R2,Y+12
    04496 843D      LDD	R3,Y+13
    04497 844E      LDD	R4,Y+14
    04498 845F      LDD	R5,Y+15
    04499 8248      ST	Y,R4
    0449A 8259      STD	Y+1,R5
    0449B 0191      MOVW	R18,R2
    0449C 018A      MOVW	R16,R20
    0449D 940E 4DBF CALL	_ultoa
    0449F C07A      RJMP	0x451A
    044A0 E08A      LDI	R24,0xA
    044A1 E090      LDI	R25,0
    044A2 8399      STD	Y+1,R25
    044A3 8388      ST	Y,R24
    044A4 8D2A      LDD	R18,Y+26
    044A5 8D3B      LDD	R19,Y+27
    044A6 018A      MOVW	R16,R20
    044A7 940E 4E26 CALL	_utoa
    044A9 C070      RJMP	0x451A
    044AA A5E8      LDD	R30,Y+40
    044AB A5F9      LDD	R31,Y+41
    044AC 8180      LD	R24,Z
    044AD 368F      CPI	R24,0x6F
    044AE F509      BNE	0x44D0
    044AF FEA0      SBRS	R10,0
    044B0 C004      RJMP	0x44B5
    044B1 E380      LDI	R24,0x30
    044B2 01FA      MOVW	R30,R20
    044B3 9381      ST	Z+,R24
    044B4 01AF      MOVW	R20,R30
    044B5 FEA1      SBRS	R10,1
    044B6 C00F      RJMP	0x44C6
    044B7 E088      LDI	R24,0x8
    044B8 E090      LDI	R25,0
    044B9 839B      STD	Y+3,R25
    044BA 838A      STD	Y+2,R24
    044BB 842C      LDD	R2,Y+12
    044BC 843D      LDD	R3,Y+13
    044BD 844E      LDD	R4,Y+14
    044BE 845F      LDD	R5,Y+15
    044BF 8248      ST	Y,R4
    044C0 8259      STD	Y+1,R5
    044C1 0191      MOVW	R18,R2
    044C2 018A      MOVW	R16,R20
    044C3 940E 4DBF CALL	_ultoa
    044C5 C054      RJMP	0x451A
    044C6 E088      LDI	R24,0x8
    044C7 E090      LDI	R25,0
    044C8 8399      STD	Y+1,R25
    044C9 8388      ST	Y,R24
    044CA 8D2A      LDD	R18,Y+26
    044CB 8D3B      LDD	R19,Y+27
    044CC 018A      MOVW	R16,R20
    044CD 940E 4E26 CALL	_utoa
    044CF C04A      RJMP	0x451A
    044D0 A5E8      LDD	R30,Y+40
    044D1 A5F9      LDD	R31,Y+41
    044D2 8180      LD	R24,Z
    044D3 3780      CPI	R24,0x70
    044D4 F439      BNE	0x44DC
    044D5 E380      LDI	R24,0x30
    044D6 01FA      MOVW	R30,R20
    044D7 9381      ST	Z+,R24
    044D8 E788      LDI	R24,0x78
    044D9 9381      ST	Z+,R24
    044DA 01AF      MOVW	R20,R30
    044DB C00C      RJMP	0x44E8
    044DC FEA0      SBRS	R10,0
    044DD C00A      RJMP	0x44E8
    044DE E380      LDI	R24,0x30
    044DF 01FA      MOVW	R30,R20
    044E0 9381      ST	Z+,R24
    044E1 01AF      MOVW	R20,R30
    044E2 A5E8      LDD	R30,Y+40
    044E3 A5F9      LDD	R31,Y+41
    044E4 8020      LD	R2,Z
    044E5 01FA      MOVW	R30,R20
    044E6 9221      ST	Z+,R2
    044E7 01AF      MOVW	R20,R30
    044E8 FEA1      SBRS	R10,1
    044E9 C00F      RJMP	0x44F9
    044EA E180      LDI	R24,0x10
    044EB E090      LDI	R25,0
    044EC 839B      STD	Y+3,R25
    044ED 838A      STD	Y+2,R24
    044EE 842C      LDD	R2,Y+12
    044EF 843D      LDD	R3,Y+13
    044F0 844E      LDD	R4,Y+14
    044F1 845F      LDD	R5,Y+15
    044F2 8248      ST	Y,R4
    044F3 8259      STD	Y+1,R5
    044F4 0191      MOVW	R18,R2
    044F5 018A      MOVW	R16,R20
    044F6 940E 4DBF CALL	_ultoa
    044F8 C009      RJMP	0x4502
    044F9 E180      LDI	R24,0x10
    044FA E090      LDI	R25,0
    044FB 8399      STD	Y+1,R25
    044FC 8388      ST	Y,R24
    044FD 8D2A      LDD	R18,Y+26
    044FE 8D3B      LDD	R19,Y+27
    044FF 018A      MOVW	R16,R20
    04500 940E 4E26 CALL	_utoa
    04502 A5E8      LDD	R30,Y+40
    04503 A5F9      LDD	R31,Y+41
    04504 8180      LD	R24,Z
    04505 3588      CPI	R24,0x58
    04506 F499      BNE	0x451A
    04507 EB85      LDI	R24,0xB5
    04508 E098      LDI	R25,0x8
    04509 017C      MOVW	R14,R24
    0450A C00B      RJMP	0x4516
    0450B 01F7      MOVW	R30,R14
    0450C 8100      LD	R16,Z
    0450D 2711      CLR	R17
    0450E 940E 5013 CALL	_toupper
    04510 0168      MOVW	R12,R16
    04511 01F7      MOVW	R30,R14
    04512 82C0      ST	Z,R12
    04513 01C7      MOVW	R24,R14
    04514 9601      ADIW	R24,1
    04515 017C      MOVW	R14,R24
    04516 01F7      MOVW	R30,R14
    04517 8020      LD	R2,Z
    04518 2022      TST	R2
    04519 F789      BNE	0x450B
    0451A EB85      LDI	R24,0xB5
    0451B E098      LDI	R25,0x8
    0451C 017C      MOVW	R14,R24
    0451D 8D88      LDD	R24,Y+24
    0451E 8D99      LDD	R25,Y+25
    0451F 3F8F      CPI	R24,0xFF
    04520 EFEF      LDI	R30,0xFF
    04521 079E      CPC	R25,R30
    04522 F421      BNE	0x4527
    04523 2400      CLR	R0
    04524 2411      CLR	R1
    04525 8E19      STD	Y+25,R1
    04526 8E08      STD	Y+24,R0
    04527 8C08      LDD	R0,Y+24
    04528 8C19      LDD	R1,Y+25
    04529 2000      TST	R0
    0452A F419      BNE	0x452E
    0452B 2011      TST	R1
    0452C F409      BNE	0x452E
    0452D C104      RJMP	0x4632
    0452E EB05      LDI	R16,0xB5
    0452F E018      LDI	R17,0x8
    04530 940E 4762 CALL	_strlen
    04532 0168      MOVW	R12,R16
    04533 8EDB      STD	Y+27,R13
    04534 8ECA      STD	Y+26,R12
    04535 8C08      LDD	R0,Y+24
    04536 8C19      LDD	R1,Y+25
    04537 140C      CP	R0,R12
    04538 041D      CPC	R1,R13
    04539 F00C      BLT	0x453B
    0453A C0F7      RJMP	0x4632
    0453B 0106      MOVW	R0,R12
    0453C 8E19      STD	Y+25,R1
    0453D 8E08      STD	Y+24,R0
    0453E C0F3      RJMP	0x4632
    0453F A58A      LDD	R24,Y+42
    04540 A59B      LDD	R25,Y+43
    04541 9602      ADIW	R24,2
    04542 A79B      STD	Y+43,R25
    04543 A78A      STD	Y+42,R24
    04544 01FC      MOVW	R30,R24
    04545 9732      SBIW	R30,2
    04546 8020      LD	R2,Z
    04547 8031      LDD	R3,Z+1
    04548 862A      STD	Y+10,R2
    04549 E081      LDI	R24,1
    0454A E090      LDI	R25,0
    0454B 880C      LDD	R0,Y+20
    0454C 881D      LDD	R1,Y+21
    0454D 1580      CP	R24,R0
    0454E 0591      CPC	R25,R1
    0454F F444      BGE	0x4558
    04550 8E19      STD	Y+25,R1
    04551 8E08      STD	Y+24,R0
    04552 2422      CLR	R2
    04553 862B      STD	Y+11,R2
    04554 01CE      MOVW	R24,R28
    04555 960A      ADIW	R24,0xA
    04556 017C      MOVW	R14,R24
    04557 C0DA      RJMP	0x4632
    04558 850A      LDD	R16,Y+10
    04559 A1EE      LDD	R30,Y+38
    0455A A1FF      LDD	R31,Y+39
    0455B 940E 4900 CALL	xicallx
    0455D 898E      LDD	R24,Y+22
    0455E 899F      LDD	R25,Y+23
    0455F 9601      ADIW	R24,1
    04560 8B9F      STD	Y+23,R25
    04561 8B8E      STD	Y+22,R24
    04562 C1D5      RJMP	0x4738
    04563 A58A      LDD	R24,Y+42
    04564 A59B      LDD	R25,Y+43
    04565 9602      ADIW	R24,2
    04566 A79B      STD	Y+43,R25
    04567 A78A      STD	Y+42,R24
    04568 01FC      MOVW	R30,R24
    04569 9732      SBIW	R30,2
    0456A 80C0      LD	R12,Z
    0456B 80D1      LDD	R13,Z+1
    0456C 8D88      LDD	R24,Y+24
    0456D 8D99      LDD	R25,Y+25
    0456E 3F8F      CPI	R24,0xFF
    0456F EFEF      LDI	R30,0xFF
    04570 079E      CPC	R25,R30
    04571 F421      BNE	0x4576
    04572 2400      CLR	R0
    04573 2411      CLR	R1
    04574 8E19      STD	Y+25,R1
    04575 8E08      STD	Y+24,R0
    04576 880C      LDD	R0,Y+20
    04577 881D      LDD	R1,Y+21
    04578 2000      TST	R0
    04579 F411      BNE	0x457C
    0457A 2011      TST	R1
    0457B F051      BEQ	0x4586
    0457C 0186      MOVW	R16,R12
    0457D 940E 4C49 CALL	_cstrlen
    0457F 01A8      MOVW	R20,R16
    04580 882C      LDD	R2,Y+20
    04581 883D      LDD	R3,Y+21
    04582 1A20      SUB	R2,R16
    04583 0A31      SBC	R3,R17
    04584 8A3D      STD	Y+21,R3
    04585 8A2C      STD	Y+20,R2
    04586 8C08      LDD	R0,Y+24
    04587 8C19      LDD	R1,Y+25
    04588 2000      TST	R0
    04589 F441      BNE	0x4592
    0458A 2011      TST	R1
    0458B F431      BNE	0x4592
    0458C 0186      MOVW	R16,R12
    0458D 940E 4C49 CALL	_cstrlen
    0458F 01A8      MOVW	R20,R16
    04590 8F59      STD	Y+25,R21
    04591 8F48      STD	Y+24,R20
    04592 880C      LDD	R0,Y+20
    04593 881D      LDD	R1,Y+21
    04594 2000      TST	R0
    04595 F411      BNE	0x4598
    04596 2011      TST	R1
    04597 F031      BEQ	0x459E
    04598 FEA3      SBRS	R10,3
    04599 C004      RJMP	0x459E
    0459A 01C0      MOVW	R24,R0
    0459B 9701      SBIW	R24,1
    0459C 8B9D      STD	Y+21,R25
    0459D 8B8C      STD	Y+20,R24
    0459E FEA4      SBRS	R10,4
    0459F C026      RJMP	0x45C6
    045A0 FEA3      SBRS	R10,3
    045A1 C00A      RJMP	0x45AC
    045A2 2F06      MOV	R16,R22
    045A3 A1EE      LDD	R30,Y+38
    045A4 A1FF      LDD	R31,Y+39
    045A5 940E 4900 CALL	xicallx
    045A7 898E      LDD	R24,Y+22
    045A8 899F      LDD	R25,Y+23
    045A9 9601      ADIW	R24,1
    045AA 8B9F      STD	Y+23,R25
    045AB 8B8E      STD	Y+22,R24
    045AC FCA2      SBRC	R10,2
    045AD C04C      RJMP	0x45FA
    045AE C00F      RJMP	0x45BE
    045AF E300      LDI	R16,0x30
    045B0 A1EE      LDD	R30,Y+38
    045B1 A1FF      LDD	R31,Y+39
    045B2 940E 4900 CALL	xicallx
    045B4 898E      LDD	R24,Y+22
    045B5 899F      LDD	R25,Y+23
    045B6 9601      ADIW	R24,1
    045B7 8B9F      STD	Y+23,R25
    045B8 8B8E      STD	Y+22,R24
    045B9 898C      LDD	R24,Y+20
    045BA 899D      LDD	R25,Y+21
    045BB 9701      SBIW	R24,1
    045BC 8B9D      STD	Y+21,R25
    045BD 8B8C      STD	Y+20,R24
    045BE 2422      CLR	R2
    045BF 2433      CLR	R3
    045C0 880C      LDD	R0,Y+20
    045C1 881D      LDD	R1,Y+21
    045C2 1420      CP	R2,R0
    045C3 0431      CPC	R3,R1
    045C4 F354      BLT	0x45AF
    045C5 C034      RJMP	0x45FA
    045C6 FCA2      SBRC	R10,2
    045C7 C017      RJMP	0x45DF
    045C8 C00F      RJMP	0x45D8
    045C9 E200      LDI	R16,0x20
    045CA A1EE      LDD	R30,Y+38
    045CB A1FF      LDD	R31,Y+39
    045CC 940E 4900 CALL	xicallx
    045CE 898E      LDD	R24,Y+22
    045CF 899F      LDD	R25,Y+23
    045D0 9601      ADIW	R24,1
    045D1 8B9F      STD	Y+23,R25
    045D2 8B8E      STD	Y+22,R24
    045D3 898C      LDD	R24,Y+20
    045D4 899D      LDD	R25,Y+21
    045D5 9701      SBIW	R24,1
    045D6 8B9D      STD	Y+21,R25
    045D7 8B8C      STD	Y+20,R24
    045D8 2422      CLR	R2
    045D9 2433      CLR	R3
    045DA 880C      LDD	R0,Y+20
    045DB 881D      LDD	R1,Y+21
    045DC 1420      CP	R2,R0
    045DD 0431      CPC	R3,R1
    045DE F354      BLT	0x45C9
    045DF FEA3      SBRS	R10,3
    045E0 C019      RJMP	0x45FA
    045E1 2F06      MOV	R16,R22
    045E2 A1EE      LDD	R30,Y+38
    045E3 A1FF      LDD	R31,Y+39
    045E4 940E 4900 CALL	xicallx
    045E6 898E      LDD	R24,Y+22
    045E7 899F      LDD	R25,Y+23
    045E8 9601      ADIW	R24,1
    045E9 8B9F      STD	Y+23,R25
    045EA 8B8E      STD	Y+22,R24
    045EB C00E      RJMP	0x45FA
    045EC 01F6      MOVW	R30,R12
    045ED 9106      ELPM	R16,Z
    045EE A1EE      LDD	R30,Y+38
    045EF A1FF      LDD	R31,Y+39
    045F0 940E 4900 CALL	xicallx
    045F2 898E      LDD	R24,Y+22
    045F3 899F      LDD	R25,Y+23
    045F4 9601      ADIW	R24,1
    045F5 8B9F      STD	Y+23,R25
    045F6 8B8E      STD	Y+22,R24
    045F7 01C6      MOVW	R24,R12
    045F8 9601      ADIW	R24,1
    045F9 016C      MOVW	R12,R24
    045FA 01F6      MOVW	R30,R12
    045FB 9026      ELPM	R2,Z
    045FC 2022      TST	R2
    045FD F049      BEQ	0x4607
    045FE 8D48      LDD	R20,Y+24
    045FF 8D59      LDD	R21,Y+25
    04600 01CA      MOVW	R24,R20
    04601 9701      SBIW	R24,1
    04602 8F99      STD	Y+25,R25
    04603 8F88      STD	Y+24,R24
    04604 3040      CPI	R20,0
    04605 0745      CPC	R20,R21
    04606 F729      BNE	0x45EC
    04607 FEA2      SBRS	R10,2
    04608 C12F      RJMP	0x4738
    04609 C00F      RJMP	0x4619
    0460A E200      LDI	R16,0x20
    0460B A1EE      LDD	R30,Y+38
    0460C A1FF      LDD	R31,Y+39
    0460D 940E 4900 CALL	xicallx
    0460F 898E      LDD	R24,Y+22
    04610 899F      LDD	R25,Y+23
    04611 9601      ADIW	R24,1
    04612 8B9F      STD	Y+23,R25
    04613 8B8E      STD	Y+22,R24
    04614 898C      LDD	R24,Y+20
    04615 899D      LDD	R25,Y+21
    04616 9701      SBIW	R24,1
    04617 8B9D      STD	Y+21,R25
    04618 8B8C      STD	Y+20,R24
    04619 2422      CLR	R2
    0461A 2433      CLR	R3
    0461B 880C      LDD	R0,Y+20
    0461C 881D      LDD	R1,Y+21
    0461D 1420      CP	R2,R0
    0461E 0431      CPC	R3,R1
    0461F F354      BLT	0x460A
    04620 C117      RJMP	0x4738
    04621 A58A      LDD	R24,Y+42
    04622 A59B      LDD	R25,Y+43
    04623 9602      ADIW	R24,2
    04624 A79B      STD	Y+43,R25
    04625 A78A      STD	Y+42,R24
    04626 01FC      MOVW	R30,R24
    04627 9732      SBIW	R30,2
    04628 80E0      LD	R14,Z
    04629 80F1      LDD	R15,Z+1
    0462A 20EE      TST	R14
    0462B F431      BNE	0x4632
    0462C 20FF      TST	R15
    0462D F421      BNE	0x4632
    0462E EC8E      LDI	R24,0xCE
    0462F E090      LDI	R25,0
    04630 016C      MOVW	R12,R24
    04631 CF3A      RJMP	0x456C
    04632 8D88      LDD	R24,Y+24
    04633 8D99      LDD	R25,Y+25
    04634 3F8F      CPI	R24,0xFF
    04635 EFEF      LDI	R30,0xFF
    04636 079E      CPC	R25,R30
    04637 F421      BNE	0x463C
    04638 2400      CLR	R0
    04639 2411      CLR	R1
    0463A 8E19      STD	Y+25,R1
    0463B 8E08      STD	Y+24,R0
    0463C 880C      LDD	R0,Y+20
    0463D 881D      LDD	R1,Y+21
    0463E 2000      TST	R0
    0463F F411      BNE	0x4642
    04640 2011      TST	R1
    04641 F051      BEQ	0x464C
    04642 0187      MOVW	R16,R14
    04643 940E 4762 CALL	_strlen
    04645 0168      MOVW	R12,R16
    04646 882C      LDD	R2,Y+20
    04647 883D      LDD	R3,Y+21
    04648 1A20      SUB	R2,R16
    04649 0A31      SBC	R3,R17
    0464A 8A3D      STD	Y+21,R3
    0464B 8A2C      STD	Y+20,R2
    0464C 8C08      LDD	R0,Y+24
    0464D 8C19      LDD	R1,Y+25
    0464E 2000      TST	R0
    0464F F441      BNE	0x4658
    04650 2011      TST	R1
    04651 F431      BNE	0x4658
    04652 0187      MOVW	R16,R14
    04653 940E 4762 CALL	_strlen
    04655 0168      MOVW	R12,R16
    04656 8ED9      STD	Y+25,R13
    04657 8EC8      STD	Y+24,R12
    04658 880C      LDD	R0,Y+20
    04659 881D      LDD	R1,Y+21
    0465A 2000      TST	R0
    0465B F411      BNE	0x465E
    0465C 2011      TST	R1
    0465D F031      BEQ	0x4664
    0465E FEA3      SBRS	R10,3
    0465F C004      RJMP	0x4664
    04660 01C0      MOVW	R24,R0
    04661 9701      SBIW	R24,1
    04662 8B9D      STD	Y+21,R25
    04663 8B8C      STD	Y+20,R24
    04664 FEA4      SBRS	R10,4
    04665 C026      RJMP	0x468C
    04666 FEA3      SBRS	R10,3
    04667 C00A      RJMP	0x4672
    04668 2F06      MOV	R16,R22
    04669 A1EE      LDD	R30,Y+38
    0466A A1FF      LDD	R31,Y+39
    0466B 940E 4900 CALL	xicallx
    0466D 898E      LDD	R24,Y+22
    0466E 899F      LDD	R25,Y+23
    0466F 9601      ADIW	R24,1
    04670 8B9F      STD	Y+23,R25
    04671 8B8E      STD	Y+22,R24
    04672 FCA2      SBRC	R10,2
    04673 C04C      RJMP	0x46C0
    04674 C00F      RJMP	0x4684
    04675 E300      LDI	R16,0x30
    04676 A1EE      LDD	R30,Y+38
    04677 A1FF      LDD	R31,Y+39
    04678 940E 4900 CALL	xicallx
    0467A 898E      LDD	R24,Y+22
    0467B 899F      LDD	R25,Y+23
    0467C 9601      ADIW	R24,1
    0467D 8B9F      STD	Y+23,R25
    0467E 8B8E      STD	Y+22,R24
    0467F 898C      LDD	R24,Y+20
    04680 899D      LDD	R25,Y+21
    04681 9701      SBIW	R24,1
    04682 8B9D      STD	Y+21,R25
    04683 8B8C      STD	Y+20,R24
    04684 2422      CLR	R2
    04685 2433      CLR	R3
    04686 880C      LDD	R0,Y+20
    04687 881D      LDD	R1,Y+21
    04688 1420      CP	R2,R0
    04689 0431      CPC	R3,R1
    0468A F354      BLT	0x4675
    0468B C034      RJMP	0x46C0
    0468C FCA2      SBRC	R10,2
    0468D C017      RJMP	0x46A5
    0468E C00F      RJMP	0x469E
    0468F E200      LDI	R16,0x20
    04690 A1EE      LDD	R30,Y+38
    04691 A1FF      LDD	R31,Y+39
    04692 940E 4900 CALL	xicallx
    04694 898E      LDD	R24,Y+22
    04695 899F      LDD	R25,Y+23
    04696 9601      ADIW	R24,1
    04697 8B9F      STD	Y+23,R25
    04698 8B8E      STD	Y+22,R24
    04699 898C      LDD	R24,Y+20
    0469A 899D      LDD	R25,Y+21
    0469B 9701      SBIW	R24,1
    0469C 8B9D      STD	Y+21,R25
    0469D 8B8C      STD	Y+20,R24
    0469E 2422      CLR	R2
    0469F 2433      CLR	R3
    046A0 880C      LDD	R0,Y+20
    046A1 881D      LDD	R1,Y+21
    046A2 1420      CP	R2,R0
    046A3 0431      CPC	R3,R1
    046A4 F354      BLT	0x468F
    046A5 FEA3      SBRS	R10,3
    046A6 C019      RJMP	0x46C0
    046A7 2F06      MOV	R16,R22
    046A8 A1EE      LDD	R30,Y+38
    046A9 A1FF      LDD	R31,Y+39
    046AA 940E 4900 CALL	xicallx
    046AC 898E      LDD	R24,Y+22
    046AD 899F      LDD	R25,Y+23
    046AE 9601      ADIW	R24,1
    046AF 8B9F      STD	Y+23,R25
    046B0 8B8E      STD	Y+22,R24
    046B1 C00E      RJMP	0x46C0
    046B2 01F7      MOVW	R30,R14
    046B3 8100      LD	R16,Z
    046B4 A1EE      LDD	R30,Y+38
    046B5 A1FF      LDD	R31,Y+39
    046B6 940E 4900 CALL	xicallx
    046B8 898E      LDD	R24,Y+22
    046B9 899F      LDD	R25,Y+23
    046BA 9601      ADIW	R24,1
    046BB 8B9F      STD	Y+23,R25
    046BC 8B8E      STD	Y+22,R24
    046BD 01C7      MOVW	R24,R14
    046BE 9601      ADIW	R24,1
    046BF 017C      MOVW	R14,R24
    046C0 01F7      MOVW	R30,R14
    046C1 8020      LD	R2,Z
    046C2 2022      TST	R2
    046C3 F049      BEQ	0x46CD
    046C4 8D68      LDD	R22,Y+24
    046C5 8D79      LDD	R23,Y+25
    046C6 01CB      MOVW	R24,R22
    046C7 9701      SBIW	R24,1
    046C8 8F99      STD	Y+25,R25
    046C9 8F88      STD	Y+24,R24
    046CA 3060      CPI	R22,0
    046CB 0767      CPC	R22,R23
    046CC F729      BNE	0x46B2
    046CD FEA2      SBRS	R10,2
    046CE C069      RJMP	0x4738
    046CF C00F      RJMP	0x46DF
    046D0 E200      LDI	R16,0x20
    046D1 A1EE      LDD	R30,Y+38
    046D2 A1FF      LDD	R31,Y+39
    046D3 940E 4900 CALL	xicallx
    046D5 898E      LDD	R24,Y+22
    046D6 899F      LDD	R25,Y+23
    046D7 9601      ADIW	R24,1
    046D8 8B9F      STD	Y+23,R25
    046D9 8B8E      STD	Y+22,R24
    046DA 898C      LDD	R24,Y+20
    046DB 899D      LDD	R25,Y+21
    046DC 9701      SBIW	R24,1
    046DD 8B9D      STD	Y+21,R25
    046DE 8B8C      STD	Y+20,R24
    046DF 2422      CLR	R2
    046E0 2433      CLR	R3
    046E1 880C      LDD	R0,Y+20
    046E2 881D      LDD	R1,Y+21
    046E3 1420      CP	R2,R0
    046E4 0431      CPC	R3,R1
    046E5 F354      BLT	0x46D0
    046E6 C051      RJMP	0x4738
    046E7 E061      LDI	R22,1
    046E8 E070      LDI	R23,0
    046E9 C00B      RJMP	0x46F5
    046EA E062      LDI	R22,2
    046EB E070      LDI	R23,0
    046EC C008      RJMP	0x46F5
    046ED 2766      CLR	R22
    046EE 2777      CLR	R23
    046EF C005      RJMP	0x46F5
    046F0 E063      LDI	R22,3
    046F1 E070      LDI	R23,0
    046F2 C002      RJMP	0x46F5
    046F3 E064      LDI	R22,4
    046F4 E070      LDI	R23,0
    046F5 A58A      LDD	R24,Y+42
    046F6 A59B      LDD	R25,Y+43
    046F7 9604      ADIW	R24,4
    046F8 A79B      STD	Y+43,R25
    046F9 A78A      STD	Y+42,R24
    046FA 01FC      MOVW	R30,R24
    046FB 9734      SBIW	R30,4
    046FC 8020      LD	R2,Z
    046FD 8031      LDD	R3,Z+1
    046FE 8042      LDD	R4,Z+2
    046FF 8053      LDD	R5,Z+3
    04700 8A28      STD	Y+16,R2
    04701 8A39      STD	Y+17,R3
    04702 8A4A      STD	Y+18,R4
    04703 8A5B      STD	Y+19,R5
    04704 8D88      LDD	R24,Y+24
    04705 8D99      LDD	R25,Y+25
    04706 3F8F      CPI	R24,0xFF
    04707 EFEF      LDI	R30,0xFF
    04708 079E      CPC	R25,R30
    04709 F421      BNE	0x470E
    0470A E086      LDI	R24,6
    0470B E090      LDI	R25,0
    0470C 8F99      STD	Y+25,R25
    0470D 8F88      STD	Y+24,R24
    0470E 8C08      LDD	R0,Y+24
    0470F 8C19      LDD	R1,Y+25
    04710 8619      STD	Y+9,R1
    04711 8608      STD	Y+8,R0
    04712 880C      LDD	R0,Y+20
    04713 881D      LDD	R1,Y+21
    04714 821F      STD	Y+7,R1
    04715 820E      STD	Y+6,R0
    04716 82BD      STD	Y+5,R11
    04717 82AC      STD	Y+4,R10
    04718 8828      LDD	R2,Y+16
    04719 8839      LDD	R3,Y+17
    0471A 884A      LDD	R4,Y+18
    0471B 885B      LDD	R5,Y+19
    0471C 8228      ST	Y,R2
    0471D 8239      STD	Y+1,R3
    0471E 824A      STD	Y+2,R4
    0471F 825B      STD	Y+3,R5
    04720 019B      MOVW	R18,R22
    04721 EB05      LDI	R16,0xB5
    04722 E018      LDI	R17,0x8
    04723 940E 5074 CALL	__FormatFP_1
    04725 01B8      MOVW	R22,R16
    04726 017B      MOVW	R14,R22
    04727 C00C      RJMP	0x4734
    04728 01F7      MOVW	R30,R14
    04729 9101      LD	R16,Z+
    0472A 017F      MOVW	R14,R30
    0472B A1EE      LDD	R30,Y+38
    0472C A1FF      LDD	R31,Y+39
    0472D 940E 4900 CALL	xicallx
    0472F 898E      LDD	R24,Y+22
    04730 899F      LDD	R25,Y+23
    04731 9601      ADIW	R24,1
    04732 8B9F      STD	Y+23,R25
    04733 8B8E      STD	Y+22,R24
    04734 01F7      MOVW	R30,R14
    04735 8020      LD	R2,Z
    04736 2022      TST	R2
    04737 F781      BNE	0x4728
    04738 A588      LDD	R24,Y+40
    04739 A599      LDD	R25,Y+41
    0473A 9601      ADIW	R24,1
    0473B A799      STD	Y+41,R25
    0473C A788      STD	Y+40,R24
    0473D A5E8      LDD	R30,Y+40
    0473E A5F9      LDD	R31,Y+41
    0473F 8020      LD	R2,Z
    04740 2022      TST	R2
    04741 F009      BEQ	0x4743
    04742 CBA4      RJMP	0x42E7
    04743 890E      LDD	R16,Y+22
    04744 891F      LDD	R17,Y+23
    04745 966C      ADIW	R28,0x1C
    04746 940E 48A8 CALL	pop_xgsetF0FC
    04748 9624      ADIW	R28,4
    04749 9508      RET
_memset:
    0474A 8188      LD	R24,Y
    0474B 8199      LDD	R25,Y+1
    0474C 3080      CPI	R24,0
    0474D 0789      CPC	R24,R25
    0474E F029      BEQ	0x4754
    0474F 2FE0      MOV	R30,R16
    04750 2FF1      MOV	R31,R17
    04751 9321      ST	Z+,R18
    04752 9701      SBIW	R24,1
    04753 F7E9      BNE	0x4751
    04754 9508      RET
_strcat:
    04755 2FA0      MOV	R26,R16
    04756 2FB1      MOV	R27,R17
    04757 2FE2      MOV	R30,R18
    04758 2FF3      MOV	R31,R19
    04759 912D      LD	R18,X+
    0475A 2322      TST	R18
    0475B F7E9      BNE	0x4759
    0475C 9711      SBIW	R26,1
    0475D 9121      LD	R18,Z+
    0475E 932D      ST	X+,R18
    0475F 2322      TST	R18
    04760 F7E1      BNE	0x475D
    04761 9508      RET
_strlen:
    04762 2FE0      MOV	R30,R16
    04763 2FF1      MOV	R31,R17
    04764 27AA      CLR	R26
    04765 27BB      CLR	R27
    04766 9001      LD	R0,Z+
    04767 2000      TST	R0
    04768 F011      BEQ	0x476B
    04769 9611      ADIW	R26,1
    0476A CFFB      RJMP	0x4766
    0476B 2F0A      MOV	R16,R26
    0476C 2F1B      MOV	R17,R27
    0476D 9508      RET
push_arg4:
    0476E 933A      ST	-Y,R19
    0476F 932A      ST	-Y,R18
push_arg2:
    04770 931A      ST	-Y,R17
    04771 930A      ST	-Y,R16
    04772 9508      RET
asr32:
    04773 920F      PUSH	R0
    04774 9009      LD	R0,Y+
    04775 2000      TST	R0
    04776 F031      BEQ	0x477D
    04777 9535      ASR	R19
    04778 9527      ROR	R18
    04779 9517      ROR	R17
    0477A 9507      ROR	R16
    0477B 940A      DEC	R0
    0477C CFF8      RJMP	0x4775
    0477D 900F      POP	R0
    0477E 9508      RET
mod16s:
    0477F 9468      BSET	6
    04780 92DA      ST	-Y,R13
    04781 2ED1      MOV	R13,R17
    04782 C004      RJMP	0x4787
div16s:
    04783 94E8      BCLR	6
    04784 92DA      ST	-Y,R13
    04785 2ED1      MOV	R13,R17
    04786 26D3      EOR	R13,R19
    04787 FF17      SBRS	R17,7
    04788 C004      RJMP	0x478D
    04789 9510      COM	R17
    0478A 9500      COM	R16
    0478B 5F0F      SUBI	R16,0xFF
    0478C 4F1F      SBCI	R17,0xFF
    0478D FF37      SBRS	R19,7
    0478E C004      RJMP	0x4793
    0478F 9530      COM	R19
    04790 9520      COM	R18
    04791 5F2F      SUBI	R18,0xFF
    04792 4F3F      SBCI	R19,0xFF
    04793 940E 47A0 CALL	xdiv16u
    04795 FED7      SBRS	R13,7
    04796 C004      RJMP	0x479B
    04797 9510      COM	R17
    04798 9500      COM	R16
    04799 5F0F      SUBI	R16,0xFF
    0479A 4F1F      SBCI	R17,0xFF
    0479B 90D9      LD	R13,Y+
    0479C 9508      RET
mod16u:
    0479D 9468      BSET	6
    0479E C001      RJMP	xdiv16u
div16u:
    0479F 94E8      BCLR	6
xdiv16u:
    047A0 92EA      ST	-Y,R14
    047A1 92FA      ST	-Y,R15
    047A2 938A      ST	-Y,R24
    047A3 24EE      CLR	R14
    047A4 24FF      CLR	R15
    047A5 E180      LDI	R24,0x10
    047A6 0F00      LSL	R16
    047A7 1F11      ROL	R17
    047A8 1CEE      ROL	R14
    047A9 1CFF      ROL	R15
    047AA 16E2      CP	R14,R18
    047AB 06F3      CPC	R15,R19
    047AC F018      BCS	0x47B0
    047AD 1AE2      SUB	R14,R18
    047AE 0AF3      SBC	R15,R19
    047AF 9503      INC	R16
    047B0 958A      DEC	R24
    047B1 F7A1      BNE	0x47A6
    047B2 F416      BRTC	0x47B5
    047B3 2D0E      MOV	R16,R14
    047B4 2D1F      MOV	R17,R15
    047B5 9189      LD	R24,Y+
    047B6 90F9      LD	R15,Y+
    047B7 90E9      LD	R14,Y+
    047B8 9508      RET
div32u:
    047B9 94E8      BCLR	6
    047BA C001      RJMP	0x47BC
mod32u:
    047BB 9468      BSET	6
    047BC D030      RCALL	long_div_prolog
    047BD 24CC      CLR	R12
    047BE C009      RJMP	0x47C8
div32s:
    047BF 94E8      BCLR	6
    047C0 C001      RJMP	0x47C2
mod32s:
    047C1 9468      BSET	6
    047C2 D02A      RCALL	long_div_prolog
    047C3 FD37      SBRC	R19,7
    047C4 940E 4909 CALL	neg32
    047C6 FDB7      SBRC	R27,7
    047C7 D052      RCALL	neg_R24_R27
    047C8 2477      CLR	R7
    047C9 2488      CLR	R8
    047CA 2499      CLR	R9
    047CB 24AA      CLR	R10
    047CC 24BB      CLR	R11
    047CD D042      RCALL	tst_R16_R19
    047CE F0C1      BEQ	0x47E7
    047CF D045      RCALL	tst_R24_R27
    047D0 F0B1      BEQ	0x47E7
    047D1 E2E8      LDI	R30,0x28
    047D2 0F00      LSL	R16
    047D3 1F11      ROL	R17
    047D4 1F22      ROL	R18
    047D5 1F33      ROL	R19
    047D6 1C77      ROL	R7
    047D7 1C88      ROL	R8
    047D8 1C99      ROL	R9
    047D9 1CAA      ROL	R10
    047DA 1CBB      ROL	R11
    047DB 1688      CP	R8,R24
    047DC 0699      CPC	R9,R25
    047DD 06AA      CPC	R10,R26
    047DE 06BB      CPC	R11,R27
    047DF F028      BCS	0x47E5
    047E0 1A88      SUB	R8,R24
    047E1 0A99      SBC	R9,R25
    047E2 0AAA      SBC	R10,R26
    047E3 0ABB      SBC	R11,R27
    047E4 9503      INC	R16
    047E5 95EA      DEC	R30
    047E6 F759      BNE	0x47D2
    047E7 F426      BRTC	0x47EC
    047E8 2D08      MOV	R16,R8
    047E9 2D19      MOV	R17,R9
    047EA 2D2A      MOV	R18,R10
    047EB 2D3B      MOV	R19,R11
    047EC C013      RJMP	long_div_epilog
long_div_prolog:
    047ED 927A      ST	-Y,R7
    047EE 928A      ST	-Y,R8
    047EF 929A      ST	-Y,R9
    047F0 92AA      ST	-Y,R10
    047F1 92BA      ST	-Y,R11
    047F2 92CA      ST	-Y,R12
    047F3 93EA      ST	-Y,R30
    047F4 938A      ST	-Y,R24
    047F5 939A      ST	-Y,R25
    047F6 93AA      ST	-Y,R26
    047F7 93BA      ST	-Y,R27
    047F8 858B      LDD	R24,Y+11
    047F9 859C      LDD	R25,Y+12
    047FA 85AD      LDD	R26,Y+13
    047FB 85BE      LDD	R27,Y+14
    047FC 2EC3      MOV	R12,R19
    047FD F00E      BRTS	0x47FF
    047FE 26CB      EOR	R12,R27
    047FF 9508      RET
long_div_epilog:
    04800 FCC7      SBRC	R12,7
    04801 940E 4909 CALL	neg32
    04803 91B9      LD	R27,Y+
    04804 91A9      LD	R26,Y+
    04805 9199      LD	R25,Y+
    04806 9189      LD	R24,Y+
    04807 91E9      LD	R30,Y+
    04808 90C9      LD	R12,Y+
    04809 90B9      LD	R11,Y+
    0480A 90A9      LD	R10,Y+
    0480B 9099      LD	R9,Y+
    0480C 9089      LD	R8,Y+
    0480D 9079      LD	R7,Y+
    0480E 9624      ADIW	R28,4
    0480F 9508      RET
tst_R16_R19:
    04810 2FE0      MOV	R30,R16
    04811 2BE1      OR	R30,R17
    04812 2BE2      OR	R30,R18
    04813 2BE3      OR	R30,R19
    04814 9508      RET
tst_R24_R27:
    04815 2FE8      MOV	R30,R24
    04816 2BE9      OR	R30,R25
    04817 2BEA      OR	R30,R26
    04818 2BEB      OR	R30,R27
    04819 9508      RET
neg_R24_R27:
    0481A 9580      COM	R24
    0481B 9590      COM	R25
    0481C 95A0      COM	R26
    0481D 95B0      COM	R27
    0481E 5F8F      SUBI	R24,0xFF
    0481F 4F9F      SBCI	R25,0xFF
    04820 4FAF      SBCI	R26,0xFF
    04821 4FBF      SBCI	R27,0xFF
    04822 9508      RET
mod8u:
    04823 9468      BSET	6
    04824 C001      RJMP	xdiv8u
div8u:
    04825 94E8      BCLR	6
xdiv8u:
    04826 932A      ST	-Y,R18
    04827 92FA      ST	-Y,R15
    04828 92EA      ST	-Y,R14
    04829 24FF      CLR	R15
    0482A 24EE      CLR	R14
    0482B E120      LDI	R18,0x10
    0482C 0F00      LSL	R16
    0482D 1CFF      ROL	R15
    0482E 1CEE      ROL	R14
    0482F 16E1      CP	R14,R17
    04830 F010      BCS	0x4833
    04831 1AE1      SUB	R14,R17
    04832 9503      INC	R16
    04833 952A      DEC	R18
    04834 F7B9      BNE	0x482C
    04835 F40E      BRTC	0x4837
    04836 2D0E      MOV	R16,R14
    04837 90E9      LD	R14,Y+
    04838 90F9      LD	R15,Y+
    04839 9129      LD	R18,Y+
    0483A 9508      RET
elpm32:
    0483B 93EA      ST	-Y,R30
    0483C 93FA      ST	-Y,R31
    0483D 920A      ST	-Y,R0
    0483E 2FE0      MOV	R30,R16
    0483F 2FF1      MOV	R31,R17
    04840 95D8      ELPM
    04841 2D00      MOV	R16,R0
    04842 9631      ADIW	R30,1
    04843 95D8      ELPM
    04844 2D10      MOV	R17,R0
    04845 9631      ADIW	R30,1
    04846 95D8      ELPM
    04847 2D20      MOV	R18,R0
    04848 9631      ADIW	R30,1
    04849 95D8      ELPM
    0484A 2D30      MOV	R19,R0
    0484B 9009      LD	R0,Y+
    0484C 91F9      LD	R31,Y+
    0484D 91E9      LD	R30,Y+
    0484E 9508      RET
empy16s:
    0484F 920A      ST	-Y,R0
    04850 921A      ST	-Y,R1
    04851 938A      ST	-Y,R24
    04852 939A      ST	-Y,R25
    04853 9F02      MUL	R16,R18
    04854 01C0      MOVW	R24,R0
    04855 9F12      MUL	R17,R18
    04856 0D90      ADD	R25,R0
    04857 9F03      MUL	R16,R19
    04858 0D90      ADD	R25,R0
    04859 018C      MOVW	R16,R24
    0485A 9199      LD	R25,Y+
    0485B 9189      LD	R24,Y+
    0485C 9019      LD	R1,Y+
    0485D 9009      LD	R0,Y+
    0485E 9508      RET
empy32u|empy32s:
    0485F 940E 4912 CALL	long_prolog
    04861 927A      ST	-Y,R7
    04862 940E 492B CALL	tstzero1
    04864 F159      BEQ	0x4890
    04865 2477      CLR	R7
    04866 940E 4931 CALL	tstzero2
    04868 F419      BNE	0x486C
    04869 018C      MOVW	R16,R24
    0486A 019D      MOVW	R18,R26
    0486B C024      RJMP	0x4890
    0486C 920A      ST	-Y,R0
    0486D 921A      ST	-Y,R1
    0486E 9F08      MUL	R16,R24
    0486F 2CB0      MOV	R11,R0
    04870 2CA1      MOV	R10,R1
    04871 9F28      MUL	R18,R24
    04872 2C90      MOV	R9,R0
    04873 2C81      MOV	R8,R1
    04874 9F18      MUL	R17,R24
    04875 0CA0      ADD	R10,R0
    04876 1C91      ADC	R9,R1
    04877 1C87      ADC	R8,R7
    04878 9F09      MUL	R16,R25
    04879 0CA0      ADD	R10,R0
    0487A 1C91      ADC	R9,R1
    0487B 1C87      ADC	R8,R7
    0487C 9F19      MUL	R17,R25
    0487D 0C90      ADD	R9,R0
    0487E 1C81      ADC	R8,R1
    0487F 9F0A      MUL	R16,R26
    04880 0C90      ADD	R9,R0
    04881 1C81      ADC	R8,R1
    04882 9F38      MUL	R19,R24
    04883 0C80      ADD	R8,R0
    04884 9F29      MUL	R18,R25
    04885 0C80      ADD	R8,R0
    04886 9F1A      MUL	R17,R26
    04887 0C80      ADD	R8,R0
    04888 9F0B      MUL	R16,R27
    04889 0C80      ADD	R8,R0
    0488A 9019      LD	R1,Y+
    0488B 9009      LD	R0,Y+
    0488C 2D0B      MOV	R16,R11
    0488D 2D1A      MOV	R17,R10
    0488E 2D29      MOV	R18,R9
    0488F 2D38      MOV	R19,R8
    04890 9079      LD	R7,Y+
    04891 940C 4920 JMP	long_epilog
pop_xgset003C:
    04893 90A9      LD	R10,Y+
    04894 90B9      LD	R11,Y+
    04895 90C9      LD	R12,Y+
    04896 90D9      LD	R13,Y+
    04897 9508      RET
pop_xgset00FC:
    04898 90A9      LD	R10,Y+
    04899 90B9      LD	R11,Y+
    0489A 90C9      LD	R12,Y+
    0489B 90D9      LD	R13,Y+
    0489C 90E9      LD	R14,Y+
    0489D 90F9      LD	R15,Y+
    0489E 9508      RET
pop_xgset30FC:
    0489F 90A9      LD	R10,Y+
    048A0 90B9      LD	R11,Y+
    048A1 90C9      LD	R12,Y+
    048A2 90D9      LD	R13,Y+
    048A3 90E9      LD	R14,Y+
    048A4 90F9      LD	R15,Y+
    048A5 9149      LD	R20,Y+
    048A6 9159      LD	R21,Y+
    048A7 9508      RET
pop_xgsetF0FC:
    048A8 90A9      LD	R10,Y+
    048A9 90B9      LD	R11,Y+
    048AA 90C9      LD	R12,Y+
    048AB 90D9      LD	R13,Y+
    048AC 90E9      LD	R14,Y+
    048AD 90F9      LD	R15,Y+
    048AE 9149      LD	R20,Y+
    048AF 9159      LD	R21,Y+
    048B0 9169      LD	R22,Y+
    048B1 9179      LD	R23,Y+
    048B2 9508      RET
push_xgsetF0FC:
    048B3 937A      ST	-Y,R23
    048B4 936A      ST	-Y,R22
push_xgset30FC:
    048B5 935A      ST	-Y,R21
    048B6 934A      ST	-Y,R20
push_xgset00FC:
    048B7 92FA      ST	-Y,R15
    048B8 92EA      ST	-Y,R14
push_xgset003C:
    048B9 92DA      ST	-Y,R13
    048BA 92CA      ST	-Y,R12
    048BB 92BA      ST	-Y,R11
    048BC 92AA      ST	-Y,R10
    048BD 9508      RET
push_xgset300C:
    048BE 935A      ST	-Y,R21
    048BF 934A      ST	-Y,R20
    048C0 92BA      ST	-Y,R11
    048C1 92AA      ST	-Y,R10
    048C2 9508      RET
pop_xgset300C:
    048C3 90A9      LD	R10,Y+
    048C4 90B9      LD	R11,Y+
    048C5 9149      LD	R20,Y+
    048C6 9159      LD	R21,Y+
    048C7 9508      RET
push_xgsetF000:
    048C8 937A      ST	-Y,R23
    048C9 936A      ST	-Y,R22
    048CA 935A      ST	-Y,R21
    048CB 934A      ST	-Y,R20
    048CC 9508      RET
pop_xgsetF000:
    048CD 9149      LD	R20,Y+
    048CE 9159      LD	R21,Y+
    048CF 9169      LD	R22,Y+
    048D0 9179      LD	R23,Y+
    048D1 9508      RET
push_xgsetF00C:
    048D2 937A      ST	-Y,R23
    048D3 936A      ST	-Y,R22
    048D4 935A      ST	-Y,R21
    048D5 934A      ST	-Y,R20
    048D6 92BA      ST	-Y,R11
    048D7 92AA      ST	-Y,R10
    048D8 9508      RET
pop_xgsetF00C:
    048D9 90A9      LD	R10,Y+
    048DA 90B9      LD	R11,Y+
    048DB 9149      LD	R20,Y+
    048DC 9159      LD	R21,Y+
    048DD 9169      LD	R22,Y+
    048DE 9179      LD	R23,Y+
    048DF 9508      RET
push_xgset303C:
    048E0 935A      ST	-Y,R21
    048E1 934A      ST	-Y,R20
    048E2 92DA      ST	-Y,R13
    048E3 92CA      ST	-Y,R12
    048E4 92BA      ST	-Y,R11
    048E5 92AA      ST	-Y,R10
    048E6 9508      RET
pop_xgset303C:
    048E7 90A9      LD	R10,Y+
    048E8 90B9      LD	R11,Y+
    048E9 90C9      LD	R12,Y+
    048EA 90D9      LD	R13,Y+
    048EB 9149      LD	R20,Y+
    048EC 9159      LD	R21,Y+
    048ED 9508      RET
push_xgsetF03C:
    048EE 937A      ST	-Y,R23
    048EF 936A      ST	-Y,R22
    048F0 935A      ST	-Y,R21
    048F1 934A      ST	-Y,R20
    048F2 92DA      ST	-Y,R13
    048F3 92CA      ST	-Y,R12
    048F4 92BA      ST	-Y,R11
    048F5 92AA      ST	-Y,R10
    048F6 9508      RET
pop_xgsetF03C:
    048F7 90A9      LD	R10,Y+
    048F8 90B9      LD	R11,Y+
    048F9 90C9      LD	R12,Y+
    048FA 90D9      LD	R13,Y+
    048FB 9149      LD	R20,Y+
    048FC 9159      LD	R21,Y+
    048FD 9169      LD	R22,Y+
    048FE 9179      LD	R23,Y+
    048FF 9508      RET
xicallx:
    04900 920A      ST	-Y,R0
    04901 95D8      ELPM
    04902 920A      ST	-Y,R0
    04903 9631      ADIW	R30,1
    04904 95D8      ELPM
    04905 2DF0      MOV	R31,R0
    04906 91E9      LD	R30,Y+
    04907 9009      LD	R0,Y+
    04908 9409      IJMP
neg32:
    04909 9500      COM	R16
    0490A 9510      COM	R17
    0490B 9520      COM	R18
    0490C 9530      COM	R19
    0490D 5F0F      SUBI	R16,0xFF
    0490E 4F1F      SBCI	R17,0xFF
    0490F 4F2F      SBCI	R18,0xFF
    04910 4F3F      SBCI	R19,0xFF
    04911 9508      RET
long_prolog:
    04912 928A      ST	-Y,R8
    04913 929A      ST	-Y,R9
    04914 92AA      ST	-Y,R10
    04915 92BA      ST	-Y,R11
    04916 93EA      ST	-Y,R30
    04917 938A      ST	-Y,R24
    04918 939A      ST	-Y,R25
    04919 93AA      ST	-Y,R26
    0491A 93BA      ST	-Y,R27
    0491B 8589      LDD	R24,Y+9
    0491C 859A      LDD	R25,Y+10
    0491D 85AB      LDD	R26,Y+11
    0491E 85BC      LDD	R27,Y+12
    0491F 9508      RET
long_epilog:
    04920 91B9      LD	R27,Y+
    04921 91A9      LD	R26,Y+
    04922 9199      LD	R25,Y+
    04923 9189      LD	R24,Y+
    04924 91E9      LD	R30,Y+
    04925 90B9      LD	R11,Y+
    04926 90A9      LD	R10,Y+
    04927 9099      LD	R9,Y+
    04928 9089      LD	R8,Y+
    04929 9624      ADIW	R28,4
    0492A 9508      RET
tstzero1:
    0492B 27EE      CLR	R30
    0492C 2BE0      OR	R30,R16
    0492D 2BE1      OR	R30,R17
    0492E 2BE2      OR	R30,R18
    0492F 2BE3      OR	R30,R19
    04930 9508      RET
tstzero2:
    04931 27EE      CLR	R30
    04932 2BE8      OR	R30,R24
    04933 2BE9      OR	R30,R25
    04934 2BEA      OR	R30,R26
    04935 2BEB      OR	R30,R27
    04936 9508      RET
lsl16:
    04937 2322      TST	R18
    04938 F021      BEQ	0x493D
    04939 0F00      LSL	R16
    0493A 1F11      ROL	R17
    0493B 952A      DEC	R18
    0493C CFFA      RJMP	lsl16
    0493D 9508      RET
lsl32:
    0493E 920F      PUSH	R0
    0493F 9009      LD	R0,Y+
    04940 2000      TST	R0
    04941 F031      BEQ	0x4948
    04942 0F00      LSL	R16
    04943 1F11      ROL	R17
    04944 1F22      ROL	R18
    04945 1F33      ROL	R19
    04946 940A      DEC	R0
    04947 CFF8      RJMP	0x4940
    04948 900F      POP	R0
    04949 9508      RET
lsl8:
    0494A 2311      TST	R17
    0494B F019      BEQ	0x494F
    0494C 0F00      LSL	R16
    0494D 951A      DEC	R17
    0494E CFFB      RJMP	lsl8
    0494F 9508      RET
lsr16:
    04950 2322      TST	R18
    04951 F021      BEQ	0x4956
    04952 9516      LSR	R17
    04953 9507      ROR	R16
    04954 952A      DEC	R18
    04955 CFFA      RJMP	lsr16
    04956 9508      RET
lsr32:
    04957 920F      PUSH	R0
    04958 9009      LD	R0,Y+
    04959 2000      TST	R0
    0495A F031      BEQ	0x4961
    0495B 9536      LSR	R19
    0495C 9527      ROR	R18
    0495D 9517      ROR	R17
    0495E 9507      ROR	R16
    0495F 940A      DEC	R0
    04960 CFF8      RJMP	0x4959
    04961 900F      POP	R0
    04962 9508      RET
asgnblk:
    04963 93AA      ST	-Y,R26
    04964 93BA      ST	-Y,R27
    04965 93EA      ST	-Y,R30
    04966 93FA      ST	-Y,R31
    04967 920A      ST	-Y,R0
    04968 81AF      LDD	R26,Y+7
    04969 85B8      LDD	R27,Y+8
    0496A 81ED      LDD	R30,Y+5
    0496B 81FE      LDD	R31,Y+6
    0496C 3000      CPI	R16,0
    0496D 0701      CPC	R16,R17
    0496E F029      BEQ	0x4974
    0496F 9001      LD	R0,Z+
    04970 920D      ST	X+,R0
    04971 5001      SUBI	R16,1
    04972 4010      SBCI	R17,0
    04973 CFF8      RJMP	0x496C
    04974 9009      LD	R0,Y+
    04975 91F9      LD	R31,Y+
    04976 91E9      LD	R30,Y+
    04977 91B9      LD	R27,Y+
    04978 91A9      LD	R26,Y+
    04979 9624      ADIW	R28,4
    0497A 9508      RET
fpsub:
    0497B 9468      BSET	6
    0497C C001      RJMP	fpadd_alt
fpadd:
    0497D 94E8      BCLR	6
fpadd_alt:
    0497E 940E 4B88 CALL	saveFPRegs
    04980 940E 4B1A CALL	unpacks
    04982 F409      BNE	0x4984
    04983 C048      RJMP	0x49CC
    04984 2CE6      MOV	R14,R6
    04985 2CD5      MOV	R13,R5
    04986 2CC4      MOV	R12,R4
    04987 2EB3      MOV	R11,R19
    04988 2EA2      MOV	R10,R18
    04989 2E91      MOV	R9,R17
    0498A 2E80      MOV	R8,R16
    0498B 8100      LD	R16,Z
    0498C 8111      LDD	R17,Z+1
    0498D 8122      LDD	R18,Z+2
    0498E 8133      LDD	R19,Z+3
    0498F 940E 4B1A CALL	unpacks
    04991 F409      BNE	0x4993
    04992 C044      RJMP	0x49D7
    04993 2D84      MOV	R24,R4
    04994 2D95      MOV	R25,R5
    04995 198C      SUB	R24,R12
    04996 099D      SBC	R25,R13
    04997 F0B9      BEQ	0x49AF
    04998 F472      BPL	0x49A7
    04999 9590      COM	R25
    0499A 9580      COM	R24
    0499B 9601      ADIW	R24,1
    0499C 2C4C      MOV	R4,R12
    0499D 2C5D      MOV	R5,R13
    0499E 3188      CPI	R24,0x18
    0499F F5B8      BCC	0x49D7
    049A0 9535      ASR	R19
    049A1 9527      ROR	R18
    049A2 9517      ROR	R17
    049A3 9507      ROR	R16
    049A4 9701      SBIW	R24,1
    049A5 F7D1      BNE	0x49A0
    049A6 C008      RJMP	0x49AF
    049A7 3188      CPI	R24,0x18
    049A8 F518      BCC	0x49CC
    049A9 94B5      ASR	R11
    049AA 94A7      ROR	R10
    049AB 9497      ROR	R9
    049AC 9487      ROR	R8
    049AD 9701      SBIW	R24,1
    049AE F7D1      BNE	0x49A9
    049AF 2466      CLR	R6
    049B0 F02E      BRTS	0x49B6
    049B1 0D08      ADD	R16,R8
    049B2 1D19      ADC	R17,R9
    049B3 1D2A      ADC	R18,R10
    049B4 1D3B      ADC	R19,R11
    049B5 C009      RJMP	0x49BF
    049B6 1A80      SUB	R8,R16
    049B7 0A91      SBC	R9,R17
    049B8 0AA2      SBC	R10,R18
    049B9 0AB3      SBC	R11,R19
    049BA 2D08      MOV	R16,R8
    049BB 2D19      MOV	R17,R9
    049BC 2D2A      MOV	R18,R10
    049BD 2D3B      MOV	R19,R11
    049BE 2333      TST	R19
    049BF F422      BPL	0x49C4
    049C0 940E 4909 CALL	neg32
    049C2 E880      LDI	R24,0x80
    049C3 2E68      MOV	R6,R24
    049C4 940E 4B43 CALL	normalize_and_pack
    049C6 C002      RJMP	0x49C9
    049C7 940E 4B78 CALL	pack
    049C9 940E 4B97 CALL	restoreFPRegs
    049CB 9508      RET
    049CC 8100      LD	R16,Z
    049CD 8111      LDD	R17,Z+1
    049CE 8122      LDD	R18,Z+2
    049CF 8133      LDD	R19,Z+3
    049D0 F7C6      BRTC	0x49C9
    049D1 940E 4B22 CALL	tstR16_R19
    049D3 F3A9      BEQ	0x49C9
    049D4 E880      LDI	R24,0x80
    049D5 2738      EOR	R19,R24
    049D6 CFF2      RJMP	0x49C9
    049D7 2D08      MOV	R16,R8
    049D8 2D19      MOV	R17,R9
    049D9 2D2A      MOV	R18,R10
    049DA 2D3B      MOV	R19,R11
    049DB 2C4C      MOV	R4,R12
    049DC 2C5D      MOV	R5,R13
    049DD 2C6E      MOV	R6,R14
    049DE 2333      TST	R19
    049DF F73A      BPL	0x49C7
    049E0 940E 4909 CALL	neg32
    049E2 E880      LDI	R24,0x80
    049E3 2E68      MOV	R6,R24
    049E4 CFE2      RJMP	0x49C7
fpadd1:
    049E5 93FA      ST	-Y,R31
    049E6 93EA      ST	-Y,R30
    049E7 81EA      LDD	R30,Y+2
    049E8 81FB      LDD	R31,Y+3
    049E9 940E 497D CALL	fpadd
    049EB 91E9      LD	R30,Y+
    049EC 91F9      LD	R31,Y+
    049ED 9622      ADIW	R28,2
    049EE 9508      RET
fpadd2:
    049EF 93FA      ST	-Y,R31
    049F0 93EA      ST	-Y,R30
    049F1 2FEC      MOV	R30,R28
    049F2 2FFD      MOV	R31,R29
    049F3 9632      ADIW	R30,2
    049F4 940E 497D CALL	fpadd
    049F6 91E9      LD	R30,Y+
    049F7 91F9      LD	R31,Y+
    049F8 9624      ADIW	R28,4
    049F9 9508      RET
fpsub1:
    049FA 93FA      ST	-Y,R31
    049FB 93EA      ST	-Y,R30
    049FC 81EA      LDD	R30,Y+2
    049FD 81FB      LDD	R31,Y+3
    049FE 940E 497B CALL	fpsub
    04A00 91E9      LD	R30,Y+
    04A01 91F9      LD	R31,Y+
    04A02 9622      ADIW	R28,2
    04A03 9508      RET
fpsub2:
    04A04 93FA      ST	-Y,R31
    04A05 93EA      ST	-Y,R30
    04A06 2FEC      MOV	R30,R28
    04A07 2FFD      MOV	R31,R29
    04A08 9632      ADIW	R30,2
    04A09 940E 497B CALL	fpsub
    04A0B 91E9      LD	R30,Y+
    04A0C 91F9      LD	R31,Y+
    04A0D 9624      ADIW	R28,4
    04A0E 9508      RET
fpsub1x:
    04A0F 93FA      ST	-Y,R31
    04A10 93EA      ST	-Y,R30
    04A11 81EA      LDD	R30,Y+2
    04A12 81FB      LDD	R31,Y+3
    04A13 940E 497B CALL	fpsub
    04A15 91E9      LD	R30,Y+
    04A16 91F9      LD	R31,Y+
    04A17 8339      STD	Y+1,R19
    04A18 8328      ST	Y,R18
    04A19 931A      ST	-Y,R17
    04A1A 930A      ST	-Y,R16
    04A1B 9508      RET
fpsub2x:
    04A1C 93FA      ST	-Y,R31
    04A1D 93EA      ST	-Y,R30
    04A1E 2FEC      MOV	R30,R28
    04A1F 2FFD      MOV	R31,R29
    04A20 9632      ADIW	R30,2
    04A21 940E 497B CALL	fpsub
    04A23 91E9      LD	R30,Y+
    04A24 91F9      LD	R31,Y+
    04A25 833B      STD	Y+3,R19
    04A26 832A      STD	Y+2,R18
    04A27 8319      STD	Y+1,R17
    04A28 8308      ST	Y,R16
    04A29 9508      RET
fpint:
    04A2A 924A      ST	-Y,R4
    04A2B 925A      ST	-Y,R5
    04A2C 926A      ST	-Y,R6
    04A2D 938A      ST	-Y,R24
    04A2E 940E 4B2A CALL	unpacku
    04A30 F111      BEQ	0x4A53
    04A31 2055      TST	R5
    04A32 F0E2      BMI	0x4A4F
    04A33 E18F      LDI	R24,0x1F
    04A34 1648      CP	R4,R24
    04A35 F4C0      BCC	0x4A4E
    04A36 E187      LDI	R24,0x17
    04A37 1648      CP	R4,R24
    04A38 F0D1      BEQ	0x4A53
    04A39 F458      BCC	0x4A45
    04A3A 9441      NEG	R4
    04A3B EE89      LDI	R24,0xE9
    04A3C 1A48      SUB	R4,R24
    04A3D C005      RJMP	0x4A43
    04A3E 9535      ASR	R19
    04A3F 9527      ROR	R18
    04A40 9517      ROR	R17
    04A41 9507      ROR	R16
    04A42 944A      DEC	R4
    04A43 F7D1      BNE	0x4A3E
    04A44 C00E      RJMP	0x4A53
    04A45 E187      LDI	R24,0x17
    04A46 1A48      SUB	R4,R24
    04A47 0F00      LSL	R16
    04A48 1F11      ROL	R17
    04A49 1F22      ROL	R18
    04A4A 1F33      ROL	R19
    04A4B 944A      DEC	R4
    04A4C F7D1      BNE	0x4A47
    04A4D C005      RJMP	0x4A53
    04A4E E73F      LDI	R19,0x7F
    04A4F 2F23      MOV	R18,R19
    04A50 2F13      MOV	R17,R19
    04A51 2F03      MOV	R16,R19
    04A52 C004      RJMP	0x4A57
    04A53 2066      TST	R6
    04A54 F011      BEQ	0x4A57
    04A55 940E 4909 CALL	neg32
    04A57 9189      LD	R24,Y+
    04A58 9069      LD	R6,Y+
    04A59 9059      LD	R5,Y+
    04A5A 9049      LD	R4,Y+
    04A5B 9508      RET
uint2fp:
    04A5C 9468      BSET	6
    04A5D C001      RJMP	0x4A5F
int2fp:
    04A5E 94E8      BCLR	6
    04A5F 2722      CLR	R18
    04A60 2733      CLR	R19
    04A61 F046      BRTS	0x4A6A
    04A62 FD17      SBRC	R17,7
    04A63 9520      COM	R18
    04A64 FD17      SBRC	R17,7
    04A65 9530      COM	R19
    04A66 C003      RJMP	0x4A6A
ulong2fp:
    04A67 9468      BSET	6
    04A68 C001      RJMP	0x4A6A
long2fp:
    04A69 94E8      BCLR	6
    04A6A 924A      ST	-Y,R4
    04A6B 925A      ST	-Y,R5
    04A6C 926A      ST	-Y,R6
    04A6D 938A      ST	-Y,R24
    04A6E E187      LDI	R24,0x17
    04A6F 2E48      MOV	R4,R24
    04A70 2455      CLR	R5
    04A71 2466      CLR	R6
    04A72 F036      BRTS	0x4A79
    04A73 2333      TST	R19
    04A74 F422      BPL	0x4A79
    04A75 940E 4909 CALL	neg32
    04A77 E880      LDI	R24,0x80
    04A78 2E68      MOV	R6,R24
    04A79 940E 4B43 CALL	normalize_and_pack
    04A7B 9189      LD	R24,Y+
    04A7C 9069      LD	R6,Y+
    04A7D 9059      LD	R5,Y+
    04A7E 9049      LD	R4,Y+
    04A7F 9508      RET
fpdiv1:
    04A80 93FA      ST	-Y,R31
    04A81 93EA      ST	-Y,R30
    04A82 81EA      LDD	R30,Y+2
    04A83 81FB      LDD	R31,Y+3
    04A84 D027      RCALL	0x4AAC
    04A85 91E9      LD	R30,Y+
    04A86 91F9      LD	R31,Y+
    04A87 9622      ADIW	R28,2
    04A88 9508      RET
fpdiv2:
    04A89 93FA      ST	-Y,R31
    04A8A 93EA      ST	-Y,R30
    04A8B 2FEC      MOV	R30,R28
    04A8C 2FFD      MOV	R31,R29
    04A8D 9632      ADIW	R30,2
    04A8E D01D      RCALL	0x4AAC
    04A8F 91E9      LD	R30,Y+
    04A90 91F9      LD	R31,Y+
    04A91 9624      ADIW	R28,4
    04A92 9508      RET
fpdiv1x:
    04A93 93FA      ST	-Y,R31
    04A94 93EA      ST	-Y,R30
    04A95 81EA      LDD	R30,Y+2
    04A96 81FB      LDD	R31,Y+3
    04A97 D014      RCALL	0x4AAC
    04A98 91E9      LD	R30,Y+
    04A99 91F9      LD	R31,Y+
    04A9A 8339      STD	Y+1,R19
    04A9B 8328      ST	Y,R18
    04A9C 931A      ST	-Y,R17
    04A9D 930A      ST	-Y,R16
    04A9E 9508      RET
fpdiv2x:
    04A9F 93FA      ST	-Y,R31
    04AA0 93EA      ST	-Y,R30
    04AA1 2FEC      MOV	R30,R28
    04AA2 2FFD      MOV	R31,R29
    04AA3 9632      ADIW	R30,2
    04AA4 D007      RCALL	0x4AAC
    04AA5 91E9      LD	R30,Y+
    04AA6 91F9      LD	R31,Y+
    04AA7 833B      STD	Y+3,R19
    04AA8 832A      STD	Y+2,R18
    04AA9 8319      STD	Y+1,R17
    04AAA 8308      ST	Y,R16
    04AAB 9508      RET
    04AAC 920A      ST	-Y,R0
    04AAD 921A      ST	-Y,R1
    04AAE 922A      ST	-Y,R2
    04AAF 923A      ST	-Y,R3
    04AB0 940E 4B88 CALL	saveFPRegs
    04AB2 933A      ST	-Y,R19
    04AB3 932A      ST	-Y,R18
    04AB4 931A      ST	-Y,R17
    04AB5 930A      ST	-Y,R16
    04AB6 8100      LD	R16,Z
    04AB7 8111      LDD	R17,Z+1
    04AB8 8122      LDD	R18,Z+2
    04AB9 8133      LDD	R19,Z+3
    04ABA 940E 4B2A CALL	unpacku
    04ABC F409      BNE	0x4ABE
    04ABD C057      RJMP	0x4B15
    04ABE 2CE6      MOV	R14,R6
    04ABF 2CD5      MOV	R13,R5
    04AC0 2CC4      MOV	R12,R4
    04AC1 2EB3      MOV	R11,R19
    04AC2 2EA2      MOV	R10,R18
    04AC3 2E91      MOV	R9,R17
    04AC4 2E80      MOV	R8,R16
    04AC5 9109      LD	R16,Y+
    04AC6 9119      LD	R17,Y+
    04AC7 9129      LD	R18,Y+
    04AC8 9139      LD	R19,Y+
    04AC9 940E 4B2A CALL	unpacku
    04ACB F1A1      BEQ	0x4B00
    04ACC 246E      EOR	R6,R14
    04ACD 184C      SUB	R4,R12
    04ACE 085D      SBC	R5,R13
    04ACF E880      LDI	R24,0x80
    04AD0 1648      CP	R4,R24
    04AD1 0653      CPC	R5,R19
    04AD2 F00C      BLT	0x4AD4
    04AD3 C033      RJMP	0x4B07
    04AD4 E881      LDI	R24,0x81
    04AD5 1648      CP	R4,R24
    04AD6 EF8F      LDI	R24,0xFF
    04AD7 0658      CPC	R5,R24
    04AD8 F40C      BGE	0x4ADA
    04AD9 C036      RJMP	0x4B10
    04ADA E280      LDI	R24,0x20
    04ADB 2433      CLR	R3
    04ADC 2E23      MOV	R2,R19
    04ADD 2E12      MOV	R1,R18
    04ADE 2E01      MOV	R0,R17
    04ADF 2F30      MOV	R19,R16
    04AE0 2722      CLR	R18
    04AE1 2711      CLR	R17
    04AE2 2700      CLR	R16
    04AE3 9426      LSR	R2
    04AE4 9417      ROR	R1
    04AE5 9407      ROR	R0
    04AE6 9537      ROR	R19
    04AE7 9527      ROR	R18
    04AE8 0F00      LSL	R16
    04AE9 1F11      ROL	R17
    04AEA 1F22      ROL	R18
    04AEB 1F33      ROL	R19
    04AEC 1C00      ROL	R0
    04AED 1C11      ROL	R1
    04AEE 1C22      ROL	R2
    04AEF 1C33      ROL	R3
    04AF0 F028      BCS	0x4AF6
    04AF1 1808      SUB	R0,R8
    04AF2 0819      SBC	R1,R9
    04AF3 082A      SBC	R2,R10
    04AF4 083B      SBC	R3,R11
    04AF5 C004      RJMP	0x4AFA
    04AF6 0C08      ADD	R0,R8
    04AF7 1C19      ADC	R1,R9
    04AF8 1C2A      ADC	R2,R10
    04AF9 1C3B      ADC	R3,R11
    04AFA F00A      BMI	0x4AFC
    04AFB 6001      ORI	R16,1
    04AFC 958A      DEC	R24
    04AFD F751      BNE	0x4AE8
    04AFE 940E 4B43 CALL	normalize_and_pack
    04B00 940E 4B97 CALL	restoreFPRegs
    04B02 9039      LD	R3,Y+
    04B03 9029      LD	R2,Y+
    04B04 9019      LD	R1,Y+
    04B05 9009      LD	R0,Y+
    04B06 9508      RET
    04B07 EF0F      LDI	R16,0xFF
    04B08 2F10      MOV	R17,R16
    04B09 E72F      LDI	R18,0x7F
    04B0A E73F      LDI	R19,0x7F
    04B0B 2066      TST	R6
    04B0C F399      BEQ	0x4B00
    04B0D 940E 4909 CALL	neg32
    04B0F CFF0      RJMP	0x4B00
    04B10 2700      CLR	R16
    04B11 2F10      MOV	R17,R16
    04B12 2F20      MOV	R18,R16
    04B13 2F30      MOV	R19,R16
    04B14 CFEB      RJMP	0x4B00
    04B15 9109      LD	R16,Y+
    04B16 9119      LD	R17,Y+
    04B17 9129      LD	R18,Y+
    04B18 9139      LD	R19,Y+
    04B19 CFED      RJMP	0x4B07
unpacks:
    04B1A D00F      RCALL	unpacku
    04B1B F029      BEQ	0x4B21
    04B1C 2066      TST	R6
    04B1D F011      BEQ	0x4B20
    04B1E 940E 4909 CALL	neg32
    04B20 9498      BCLR	1
    04B21 9508      RET
tstR16_R19:
    04B22 2300      TST	R16
    04B23 F429      BNE	0x4B29
    04B24 2311      TST	R17
    04B25 F419      BNE	0x4B29
    04B26 2322      TST	R18
    04B27 F409      BNE	0x4B29
    04B28 2333      TST	R19
    04B29 9508      RET
unpacku:
    04B2A DFF7      RCALL	tstR16_R19
    04B2B F099      BEQ	0x4B3F
    04B2C 938A      ST	-Y,R24
    04B2D 2E63      MOV	R6,R19
    04B2E E880      LDI	R24,0x80
    04B2F 2268      AND	R6,R24
    04B30 0F22      LSL	R18
    04B31 1F33      ROL	R19
    04B32 2E43      MOV	R4,R19
    04B33 E78F      LDI	R24,0x7F
    04B34 1A48      SUB	R4,R24
    04B35 2455      CLR	R5
    04B36 2788      CLR	R24
    04B37 0A58      SBC	R5,R24
    04B38 9526      LSR	R18
    04B39 E830      LDI	R19,0x80
    04B3A 2B23      OR	R18,R19
    04B3B 2733      CLR	R19
    04B3C 9189      LD	R24,Y+
    04B3D 9498      BCLR	1
    04B3E 9508      RET
    04B3F 2444      CLR	R4
    04B40 2455      CLR	R5
    04B41 2466      CLR	R6
    04B42 9508      RET
normalize_and_pack:
    04B43 DFDE      RCALL	tstR16_R19
    04B44 F409      BNE	0x4B46
    04B45 9508      RET
    04B46 93AA      ST	-Y,R26
    04B47 93BA      ST	-Y,R27
    04B48 01D2      MOVW	R26,R4
    04B49 939A      ST	-Y,R25
    04B4A 938A      ST	-Y,R24
    04B4B E78E      LDI	R24,0x7E
    04B4C E090      LDI	R25,0
    04B4D 2333      TST	R19
    04B4E F049      BEQ	0x4B58
    04B4F 9536      LSR	R19
    04B50 9527      ROR	R18
    04B51 9517      ROR	R17
    04B52 9507      ROR	R16
    04B53 17A8      CP	R26,R24
    04B54 07B9      CPC	R27,R25
    04B55 F4CC      BGE	0x4B6F
    04B56 9611      ADIW	R26,1
    04B57 CFF5      RJMP	0x4B4D
    04B58 9580      COM	R24
    04B59 9590      COM	R25
    04B5A 9601      ADIW	R24,1
    04B5B 2322      TST	R18
    04B5C F0BA      BMI	0x4B74
    04B5D 0F00      LSL	R16
    04B5E 1F11      ROL	R17
    04B5F 1F22      ROL	R18
    04B60 17A8      CP	R26,R24
    04B61 07B9      CPC	R27,R25
    04B62 F014      BLT	0x4B65
    04B63 9711      SBIW	R26,1
    04B64 CFF6      RJMP	0x4B5B
    04B65 2700      CLR	R16
    04B66 2711      CLR	R17
    04B67 2722      CLR	R18
    04B68 2733      CLR	R19
    04B69 9189      LD	R24,Y+
    04B6A 9199      LD	R25,Y+
    04B6B 012D      MOVW	R4,R26
    04B6C 91B9      LD	R27,Y+
    04B6D 91A9      LD	R26,Y+
    04B6E 9508      RET
    04B6F 2733      CLR	R19
    04B70 EF0F      LDI	R16,0xFF
    04B71 2F10      MOV	R17,R16
    04B72 E72F      LDI	R18,0x7F
    04B73 2F32      MOV	R19,R18
    04B74 9189      LD	R24,Y+
    04B75 9199      LD	R25,Y+
    04B76 012D      MOVW	R4,R26
    04B77 C002      RJMP	0x4B7A
pack:
    04B78 93AA      ST	-Y,R26
    04B79 93BA      ST	-Y,R27
    04B7A DFA7      RCALL	tstR16_R19
    04B7B F049      BEQ	0x4B85
    04B7C 01D2      MOVW	R26,R4
    04B7D 58A1      SUBI	R26,0x81
    04B7E 4FBF      SBCI	R27,0xFF
    04B7F 012D      MOVW	R4,R26
    04B80 2D34      MOV	R19,R4
    04B81 0F22      LSL	R18
    04B82 9536      LSR	R19
    04B83 9527      ROR	R18
    04B84 2936      OR	R19,R6
    04B85 91B9      LD	R27,Y+
    04B86 91A9      LD	R26,Y+
    04B87 9508      RET
saveFPRegs:
    04B88 924A      ST	-Y,R4
    04B89 925A      ST	-Y,R5
    04B8A 926A      ST	-Y,R6
    04B8B 927A      ST	-Y,R7
    04B8C 928A      ST	-Y,R8
    04B8D 929A      ST	-Y,R9
    04B8E 92AA      ST	-Y,R10
    04B8F 92BA      ST	-Y,R11
    04B90 92CA      ST	-Y,R12
    04B91 92DA      ST	-Y,R13
    04B92 92EA      ST	-Y,R14
    04B93 92FA      ST	-Y,R15
    04B94 938A      ST	-Y,R24
    04B95 939A      ST	-Y,R25
    04B96 9508      RET
restoreFPRegs:
    04B97 9199      LD	R25,Y+
    04B98 9189      LD	R24,Y+
    04B99 90F9      LD	R15,Y+
    04B9A 90E9      LD	R14,Y+
    04B9B 90D9      LD	R13,Y+
    04B9C 90C9      LD	R12,Y+
    04B9D 90B9      LD	R11,Y+
    04B9E 90A9      LD	R10,Y+
    04B9F 9099      LD	R9,Y+
    04BA0 9089      LD	R8,Y+
    04BA1 9079      LD	R7,Y+
    04BA2 9069      LD	R6,Y+
    04BA3 9059      LD	R5,Y+
    04BA4 9049      LD	R4,Y+
    04BA5 9508      RET
fpmule:
    04BA6 940E 4B88 CALL	saveFPRegs
    04BA8 93AA      ST	-Y,R26
    04BA9 93BA      ST	-Y,R27
    04BAA 940E 4B2A CALL	unpacku
    04BAC F1E1      BEQ	0x4BE9
    04BAD 2CE6      MOV	R14,R6
    04BAE 2CD5      MOV	R13,R5
    04BAF 2CC4      MOV	R12,R4
    04BB0 2EB3      MOV	R11,R19
    04BB1 2EA2      MOV	R10,R18
    04BB2 2E91      MOV	R9,R17
    04BB3 2E80      MOV	R8,R16
    04BB4 8100      LD	R16,Z
    04BB5 8111      LDD	R17,Z+1
    04BB6 8122      LDD	R18,Z+2
    04BB7 8133      LDD	R19,Z+3
    04BB8 940E 4B2A CALL	unpacku
    04BBA F171      BEQ	0x4BE9
    04BBB 246E      EOR	R6,R14
    04BBC 0C4C      ADD	R4,R12
    04BBD 1C5D      ADC	R5,R13
    04BBE E880      LDI	R24,0x80
    04BBF 1648      CP	R4,R24
    04BC0 0653      CPC	R5,R19
    04BC1 F564      BGE	0x4BEE
    04BC2 E881      LDI	R24,0x81
    04BC3 1648      CP	R4,R24
    04BC4 EF8F      LDI	R24,0xFF
    04BC5 0658      CPC	R5,R24
    04BC6 F16C      BLT	0x4BF4
    04BC7 9EA2      MUL	R10,R18
    04BC8 2DB1      MOV	R27,R1
    04BC9 2DA0      MOV	R26,R0
    04BCA 9E91      MUL	R9,R17
    04BCB 2D91      MOV	R25,R1
    04BCC 2D80      MOV	R24,R0
    04BCD 9EA0      MUL	R10,R16
    04BCE 0D80      ADD	R24,R0
    04BCF 1D91      ADC	R25,R1
    04BD0 1FA3      ADC	R26,R19
    04BD1 1FB3      ADC	R27,R19
    04BD2 9E82      MUL	R8,R18
    04BD3 0D80      ADD	R24,R0
    04BD4 1D91      ADC	R25,R1
    04BD5 1FA3      ADC	R26,R19
    04BD6 1FB3      ADC	R27,R19
    04BD7 9E92      MUL	R9,R18
    04BD8 0D90      ADD	R25,R0
    04BD9 1DA1      ADC	R26,R1
    04BDA 1FB3      ADC	R27,R19
    04BDB 9EA1      MUL	R10,R17
    04BDC 0D90      ADD	R25,R0
    04BDD 1DA1      ADC	R26,R1
    04BDE 1FB3      ADC	R27,R19
    04BDF 2F2B      MOV	R18,R27
    04BE0 2F1A      MOV	R17,R26
    04BE1 2F09      MOV	R16,R25
    04BE2 0F88      LSL	R24
    04BE3 1F00      ROL	R16
    04BE4 1F11      ROL	R17
    04BE5 1F22      ROL	R18
    04BE6 1F33      ROL	R19
    04BE7 940E 4B43 CALL	normalize_and_pack
    04BE9 91B9      LD	R27,Y+
    04BEA 91A9      LD	R26,Y+
    04BEB 940E 4B97 CALL	restoreFPRegs
    04BED 9508      RET
    04BEE EF0F      LDI	R16,0xFF
    04BEF 2F10      MOV	R17,R16
    04BF0 E72F      LDI	R18,0x7F
    04BF1 E78F      LDI	R24,0x7F
    04BF2 2E48      MOV	R4,R24
    04BF3 CFF5      RJMP	0x4BE9
    04BF4 2700      CLR	R16
    04BF5 2F10      MOV	R17,R16
    04BF6 2F20      MOV	R18,R16
    04BF7 2F30      MOV	R19,R16
    04BF8 CFF0      RJMP	0x4BE9
fpmule1:
    04BF9 93FA      ST	-Y,R31
    04BFA 93EA      ST	-Y,R30
    04BFB 81EA      LDD	R30,Y+2
    04BFC 81FB      LDD	R31,Y+3
    04BFD 940E 4BA6 CALL	fpmule
    04BFF 91E9      LD	R30,Y+
    04C00 91F9      LD	R31,Y+
    04C01 9622      ADIW	R28,2
    04C02 9508      RET
fpmule2:
    04C03 93FA      ST	-Y,R31
    04C04 93EA      ST	-Y,R30
    04C05 2FEC      MOV	R30,R28
    04C06 2FFD      MOV	R31,R29
    04C07 9632      ADIW	R30,2
    04C08 940E 4BA6 CALL	fpmule
    04C0A 91E9      LD	R30,Y+
    04C0B 91F9      LD	R31,Y+
    04C0C 9624      ADIW	R28,4
    04C0D 9508      RET
fpmule1x:
    04C0E 93FA      ST	-Y,R31
    04C0F 93EA      ST	-Y,R30
    04C10 81EA      LDD	R30,Y+2
    04C11 81FB      LDD	R31,Y+3
    04C12 940E 4BA6 CALL	fpmule
    04C14 91E9      LD	R30,Y+
    04C15 91F9      LD	R31,Y+
    04C16 8339      STD	Y+1,R19
    04C17 8328      ST	Y,R18
    04C18 931A      ST	-Y,R17
    04C19 930A      ST	-Y,R16
    04C1A 9508      RET
fpcmp:
    04C1B 940E 497B CALL	fpsub
    04C1D 2333      TST	R19
    04C1E F03A      BMI	0x4C26
    04C1F 940E 4B22 CALL	tstR16_R19
    04C21 F011      BEQ	0x4C24
    04C22 E001      LDI	R16,1
    04C23 9508      RET
    04C24 2700      CLR	R16
    04C25 9508      RET
    04C26 EF0F      LDI	R16,0xFF
    04C27 9508      RET
fpcmp1:
    04C28 93FA      ST	-Y,R31
    04C29 93EA      ST	-Y,R30
    04C2A 81EA      LDD	R30,Y+2
    04C2B 81FB      LDD	R31,Y+3
    04C2C 940E 4C1B CALL	fpcmp
    04C2E 91E9      LD	R30,Y+
    04C2F 91F9      LD	R31,Y+
    04C30 9622      ADIW	R28,2
    04C31 2300      TST	R16
    04C32 9508      RET
fpcmp2:
    04C33 93FA      ST	-Y,R31
    04C34 93EA      ST	-Y,R30
    04C35 2FEC      MOV	R30,R28
    04C36 2FFD      MOV	R31,R29
    04C37 9632      ADIW	R30,2
    04C38 940E 4C1B CALL	fpcmp
    04C3A 91E9      LD	R30,Y+
    04C3B 91F9      LD	R31,Y+
    04C3C 9624      ADIW	R28,4
    04C3D 2300      TST	R16
    04C3E 9508      RET
_cstrcpy:
    04C3F 2FA0      MOV	R26,R16
    04C40 2FB1      MOV	R27,R17
    04C41 2FE2      MOV	R30,R18
    04C42 2FF3      MOV	R31,R19
    04C43 95C8      LPM
    04C44 9631      ADIW	R30,1
    04C45 920D      ST	X+,R0
    04C46 2000      TST	R0
    04C47 F7D9      BNE	0x4C43
    04C48 9508      RET
_cstrlen:
    04C49 2FE0      MOV	R30,R16
    04C4A 2FF1      MOV	R31,R17
    04C4B 27AA      CLR	R26
    04C4C 27BB      CLR	R27
    04C4D 95C8      LPM
    04C4E 2000      TST	R0
    04C4F F019      BEQ	0x4C53
    04C50 9631      ADIW	R30,1
    04C51 9611      ADIW	R26,1
    04C52 CFFA      RJMP	0x4C4D
    04C53 2F0A      MOV	R16,R26
    04C54 2F1B      MOV	R17,R27
    04C55 9508      RET
_atoi:
    04C56 940E 48D2 CALL	push_xgsetF00C
    04C58 0158      MOVW	R10,R16
    04C59 C003      RJMP	0x4C5D
    04C5A 01C5      MOVW	R24,R10
    04C5B 9601      ADIW	R24,1
    04C5C 015C      MOVW	R10,R24
    04C5D 01F5      MOVW	R30,R10
    04C5E 8100      LD	R16,Z
    04C5F 2711      CLR	R17
    04C60 940E 5009 CALL	_isspace
    04C62 3000      CPI	R16,0
    04C63 0701      CPC	R16,R17
    04C64 F7A9      BNE	0x4C5A
    04C65 2766      CLR	R22
    04C66 2777      CLR	R23
    04C67 01F5      MOVW	R30,R10
    04C68 8180      LD	R24,Z
    04C69 328D      CPI	R24,0x2D
    04C6A F429      BNE	0x4C70
    04C6B E061      LDI	R22,1
    04C6C 01CF      MOVW	R24,R30
    04C6D 9601      ADIW	R24,1
    04C6E 015C      MOVW	R10,R24
    04C6F C007      RJMP	0x4C77
    04C70 01F5      MOVW	R30,R10
    04C71 8180      LD	R24,Z
    04C72 328B      CPI	R24,0x2B
    04C73 F419      BNE	0x4C77
    04C74 01CF      MOVW	R24,R30
    04C75 9601      ADIW	R24,1
    04C76 015C      MOVW	R10,R24
    04C77 2744      CLR	R20
    04C78 2755      CLR	R21
    04C79 C00E      RJMP	0x4C88
    04C7A E00A      LDI	R16,0xA
    04C7B E010      LDI	R17,0
    04C7C 019A      MOVW	R18,R20
    04C7D 940E 484F CALL	empy16s
    04C7F 01A8      MOVW	R20,R16
    04C80 01F5      MOVW	R30,R10
    04C81 9021      LD	R2,Z+
    04C82 015F      MOVW	R10,R30
    04C83 2433      CLR	R3
    04C84 0D42      ADD	R20,R2
    04C85 1D53      ADC	R21,R3
    04C86 5340      SUBI	R20,0x30
    04C87 4050      SBCI	R21,0
    04C88 01F5      MOVW	R30,R10
    04C89 8100      LD	R16,Z
    04C8A 2711      CLR	R17
    04C8B 940E 4FF5 CALL	_isdigit
    04C8D 3000      CPI	R16,0
    04C8E 0701      CPC	R16,R17
    04C8F F751      BNE	0x4C7A
    04C90 3060      CPI	R22,0
    04C91 0767      CPC	R22,R23
    04C92 F031      BEQ	0x4C99
    04C93 018A      MOVW	R16,R20
    04C94 9500      COM	R16
    04C95 9510      COM	R17
    04C96 5F0F      SUBI	R16,0xFF
    04C97 4F1F      SBCI	R17,0xFF
    04C98 C001      RJMP	0x4C9A
    04C99 018A      MOVW	R16,R20
    04C9A 940C 48D9 JMP	pop_xgsetF00C
_itoa:
    04C9C 940E 476E CALL	push_arg4
    04C9E 940E 48B3 CALL	push_xgsetF0FC
    04CA0 01A9      MOVW	R20,R18
    04CA1 84EE      LDD	R14,Y+14
    04CA2 84FF      LDD	R15,Y+15
    04CA3 015A      MOVW	R10,R20
    04CA4 20AA      TST	R10
    04CA5 F451      BNE	0x4CB0
    04CA6 20BB      TST	R11
    04CA7 F441      BNE	0x4CB0
    04CA8 E380      LDI	R24,0x30
    04CA9 85EA      LDD	R30,Y+10
    04CAA 85FB      LDD	R31,Y+11
    04CAB 8380      ST	Z,R24
    04CAC 2422      CLR	R2
    04CAD 8221      STD	Z+1,R2
    04CAE 018F      MOVW	R16,R30
    04CAF C053      RJMP	0x4D03
    04CB0 3040      CPI	R20,0
    04CB1 E0E0      LDI	R30,0
    04CB2 075E      CPC	R21,R30
    04CB3 F46C      BGE	0x4CC1
    04CB4 01C7      MOVW	R24,R14
    04CB5 308A      CPI	R24,0xA
    04CB6 E0E0      LDI	R30,0
    04CB7 079E      CPC	R25,R30
    04CB8 F441      BNE	0x4CC1
    04CB9 24CC      CLR	R12
    04CBA 94C3      INC	R12
    04CBB 01C5      MOVW	R24,R10
    04CBC 9580      COM	R24
    04CBD 9590      COM	R25
    04CBE 9601      ADIW	R24,1
    04CBF 015C      MOVW	R10,R24
    04CC0 C001      RJMP	0x4CC2
    04CC1 24CC      CLR	R12
    04CC2 856A      LDD	R22,Y+10
    04CC3 857B      LDD	R23,Y+11
    04CC4 0197      MOVW	R18,R14
    04CC5 0185      MOVW	R16,R10
    04CC6 940E 479D CALL	mod16u
    04CC8 01A8      MOVW	R20,R16
    04CC9 E089      LDI	R24,0x9
    04CCA E090      LDI	R25,0
    04CCB 1780      CP	R24,R16
    04CCC 0791      CPC	R25,R17
    04CCD F034      BLT	0x4CD4
    04CCE 01CA      MOVW	R24,R20
    04CCF 96C0      ADIW	R24,0x30
    04CD0 01FB      MOVW	R30,R22
    04CD1 9381      ST	Z+,R24
    04CD2 01BF      MOVW	R22,R30
    04CD3 C006      RJMP	0x4CDA
    04CD4 01CA      MOVW	R24,R20
    04CD5 5A89      SUBI	R24,0xA9
    04CD6 4F9F      SBCI	R25,0xFF
    04CD7 01FB      MOVW	R30,R22
    04CD8 9381      ST	Z+,R24
    04CD9 01BF      MOVW	R22,R30
    04CDA 0197      MOVW	R18,R14
    04CDB 0185      MOVW	R16,R10
    04CDC 940E 479F CALL	div16u
    04CDE 0158      MOVW	R10,R16
    04CDF 20AA      TST	R10
    04CE0 F719      BNE	0x4CC4
    04CE1 20BB      TST	R11
    04CE2 F709      BNE	0x4CC4
    04CE3 20CC      TST	R12
    04CE4 F021      BEQ	0x4CE9
    04CE5 E28D      LDI	R24,0x2D
    04CE6 01FB      MOVW	R30,R22
    04CE7 9381      ST	Z+,R24
    04CE8 01BF      MOVW	R22,R30
    04CE9 012B      MOVW	R4,R22
    04CEA 5061      SUBI	R22,1
    04CEB 4070      SBCI	R23,0
    04CEC 2422      CLR	R2
    04CED 01F2      MOVW	R30,R4
    04CEE 8220      ST	Z,R2
    04CEF 84AA      LDD	R10,Y+10
    04CF0 84BB      LDD	R11,Y+11
    04CF1 C00C      RJMP	0x4CFE
    04CF2 01F5      MOVW	R30,R10
    04CF3 80C0      LD	R12,Z
    04CF4 01FB      MOVW	R30,R22
    04CF5 8020      LD	R2,Z
    04CF6 01F5      MOVW	R30,R10
    04CF7 9221      ST	Z+,R2
    04CF8 015F      MOVW	R10,R30
    04CF9 011B      MOVW	R2,R22
    04CFA 5061      SUBI	R22,1
    04CFB 4070      SBCI	R23,0
    04CFC 01F1      MOVW	R30,R2
    04CFD 82C0      ST	Z,R12
    04CFE 16A6      CP	R10,R22
    04CFF 06B7      CPC	R11,R23
    04D00 F388      BCS	0x4CF2
    04D01 850A      LDD	R16,Y+10
    04D02 851B      LDD	R17,Y+11
    04D03 940E 48A8 CALL	pop_xgsetF0FC
    04D05 9624      ADIW	R28,4
    04D06 9508      RET
_ltoa:
    04D07 940E 476E CALL	push_arg4
    04D09 940E 48B3 CALL	push_xgsetF0FC
    04D0B 9724      SBIW	R28,4
    04D0C 8828      LDD	R2,Y+16
    04D0D 8839      LDD	R3,Y+17
    04D0E 884A      LDD	R4,Y+18
    04D0F 885B      LDD	R5,Y+19
    04D10 8228      ST	Y,R2
    04D11 8239      STD	Y+1,R3
    04D12 824A      STD	Y+2,R4
    04D13 825B      STD	Y+3,R5
    04D14 8828      LDD	R2,Y+16
    04D15 8839      LDD	R3,Y+17
    04D16 884A      LDD	R4,Y+18
    04D17 885B      LDD	R5,Y+19
    04D18 9488      BCLR	0
    04D19 2022      TST	R2
    04D1A 0432      CPC	R3,R2
    04D1B 0442      CPC	R4,R2
    04D1C 0452      CPC	R5,R2
    04D1D F441      BNE	0x4D26
    04D1E E380      LDI	R24,0x30
    04D1F 85EE      LDD	R30,Y+14
    04D20 85FF      LDD	R31,Y+15
    04D21 8380      ST	Z,R24
    04D22 2422      CLR	R2
    04D23 8221      STD	Z+1,R2
    04D24 018F      MOVW	R16,R30
    04D25 C094      RJMP	0x4DBA
    04D26 E040      LDI	R20,0
    04D27 E050      LDI	R21,0
    04D28 E060      LDI	R22,0
    04D29 E070      LDI	R23,0
    04D2A 8828      LDD	R2,Y+16
    04D2B 8839      LDD	R3,Y+17
    04D2C 884A      LDD	R4,Y+18
    04D2D 885B      LDD	R5,Y+19
    04D2E 1624      CP	R2,R20
    04D2F 0635      CPC	R3,R21
    04D30 0646      CPC	R4,R22
    04D31 0657      CPC	R5,R23
    04D32 F4EC      BGE	0x4D50
    04D33 898C      LDD	R24,Y+20
    04D34 899D      LDD	R25,Y+21
    04D35 308A      CPI	R24,0xA
    04D36 E0A0      LDI	R26,0
    04D37 079A      CPC	R25,R26
    04D38 F4B9      BNE	0x4D50
    04D39 24AA      CLR	R10
    04D3A 94A3      INC	R10
    04D3B E041      LDI	R20,1
    04D3C E050      LDI	R21,0
    04D3D E060      LDI	R22,0
    04D3E E070      LDI	R23,0
    04D3F 8028      LD	R2,Y
    04D40 8039      LDD	R3,Y+1
    04D41 804A      LDD	R4,Y+2
    04D42 805B      LDD	R5,Y+3
    04D43 9420      COM	R2
    04D44 9430      COM	R3
    04D45 9440      COM	R4
    04D46 9450      COM	R5
    04D47 0E24      ADD	R2,R20
    04D48 1E35      ADC	R3,R21
    04D49 1E46      ADC	R4,R22
    04D4A 1E57      ADC	R5,R23
    04D4B 8228      ST	Y,R2
    04D4C 8239      STD	Y+1,R3
    04D4D 824A      STD	Y+2,R4
    04D4E 825B      STD	Y+3,R5
    04D4F C001      RJMP	0x4D51
    04D50 24AA      CLR	R10
    04D51 84CE      LDD	R12,Y+14
    04D52 84DF      LDD	R13,Y+15
    04D53 882C      LDD	R2,Y+20
    04D54 883D      LDD	R3,Y+21
    04D55 2444      CLR	R4
    04D56 FC37      SBRC	R3,7
    04D57 9440      COM	R4
    04D58 2455      CLR	R5
    04D59 FC47      SBRC	R4,7
    04D5A 9450      COM	R5
    04D5B 8108      LD	R16,Y
    04D5C 8119      LDD	R17,Y+1
    04D5D 812A      LDD	R18,Y+2
    04D5E 813B      LDD	R19,Y+3
    04D5F 925A      ST	-Y,R5
    04D60 924A      ST	-Y,R4
    04D61 923A      ST	-Y,R3
    04D62 922A      ST	-Y,R2
    04D63 940E 47BB CALL	mod32u
    04D65 0178      MOVW	R14,R16
    04D66 E089      LDI	R24,0x9
    04D67 E090      LDI	R25,0
    04D68 1780      CP	R24,R16
    04D69 0791      CPC	R25,R17
    04D6A F034      BLT	0x4D71
    04D6B 01C7      MOVW	R24,R14
    04D6C 96C0      ADIW	R24,0x30
    04D6D 01F6      MOVW	R30,R12
    04D6E 9381      ST	Z+,R24
    04D6F 016F      MOVW	R12,R30
    04D70 C006      RJMP	0x4D77
    04D71 01C7      MOVW	R24,R14
    04D72 5A89      SUBI	R24,0xA9
    04D73 4F9F      SBCI	R25,0xFF
    04D74 01F6      MOVW	R30,R12
    04D75 9381      ST	Z+,R24
    04D76 016F      MOVW	R12,R30
    04D77 882C      LDD	R2,Y+20
    04D78 883D      LDD	R3,Y+21
    04D79 2444      CLR	R4
    04D7A FC37      SBRC	R3,7
    04D7B 9440      COM	R4
    04D7C 2455      CLR	R5
    04D7D FC47      SBRC	R4,7
    04D7E 9450      COM	R5
    04D7F 8108      LD	R16,Y
    04D80 8119      LDD	R17,Y+1
    04D81 812A      LDD	R18,Y+2
    04D82 813B      LDD	R19,Y+3
    04D83 925A      ST	-Y,R5
    04D84 924A      ST	-Y,R4
    04D85 923A      ST	-Y,R3
    04D86 922A      ST	-Y,R2
    04D87 940E 47B9 CALL	div32u
    04D89 8308      ST	Y,R16
    04D8A 8319      STD	Y+1,R17
    04D8B 832A      STD	Y+2,R18
    04D8C 833B      STD	Y+3,R19
    04D8D 8028      LD	R2,Y
    04D8E 8039      LDD	R3,Y+1
    04D8F 804A      LDD	R4,Y+2
    04D90 805B      LDD	R5,Y+3
    04D91 9488      BCLR	0
    04D92 2022      TST	R2
    04D93 0432      CPC	R3,R2
    04D94 0442      CPC	R4,R2
    04D95 0452      CPC	R5,R2
    04D96 F009      BEQ	0x4D98
    04D97 CFBB      RJMP	0x4D53
    04D98 20AA      TST	R10
    04D99 F021      BEQ	0x4D9E
    04D9A E28D      LDI	R24,0x2D
    04D9B 01F6      MOVW	R30,R12
    04D9C 9381      ST	Z+,R24
    04D9D 016F      MOVW	R12,R30
    04D9E 0126      MOVW	R4,R12
    04D9F 01C2      MOVW	R24,R4
    04DA0 9701      SBIW	R24,1
    04DA1 016C      MOVW	R12,R24
    04DA2 2422      CLR	R2
    04DA3 01F2      MOVW	R30,R4
    04DA4 8220      ST	Z,R2
    04DA5 84EE      LDD	R14,Y+14
    04DA6 84FF      LDD	R15,Y+15
    04DA7 C00D      RJMP	0x4DB5
    04DA8 01F7      MOVW	R30,R14
    04DA9 80A0      LD	R10,Z
    04DAA 01F6      MOVW	R30,R12
    04DAB 8020      LD	R2,Z
    04DAC 01F7      MOVW	R30,R14
    04DAD 9221      ST	Z+,R2
    04DAE 017F      MOVW	R14,R30
    04DAF 0116      MOVW	R2,R12
    04DB0 01C1      MOVW	R24,R2
    04DB1 9701      SBIW	R24,1
    04DB2 016C      MOVW	R12,R24
    04DB3 01F1      MOVW	R30,R2
    04DB4 82A0      ST	Z,R10
    04DB5 14EC      CP	R14,R12
    04DB6 04FD      CPC	R15,R13
    04DB7 F380      BCS	0x4DA8
    04DB8 850E      LDD	R16,Y+14
    04DB9 851F      LDD	R17,Y+15
    04DBA 9624      ADIW	R28,4
    04DBB 940E 48A8 CALL	pop_xgsetF0FC
    04DBD 9624      ADIW	R28,4
    04DBE 9508      RET
_ultoa:
    04DBF 933A      ST	-Y,R19
    04DC0 932A      ST	-Y,R18
    04DC1 940E 48B3 CALL	push_xgsetF0FC
    04DC3 0158      MOVW	R10,R16
    04DC4 84CE      LDD	R12,Y+14
    04DC5 84DF      LDD	R13,Y+15
    04DC6 01A5      MOVW	R20,R10
    04DC7 0116      MOVW	R2,R12
    04DC8 2444      CLR	R4
    04DC9 FC37      SBRC	R3,7
    04DCA 9440      COM	R4
    04DCB 2455      CLR	R5
    04DCC FC47      SBRC	R4,7
    04DCD 9450      COM	R5
    04DCE 850A      LDD	R16,Y+10
    04DCF 851B      LDD	R17,Y+11
    04DD0 852C      LDD	R18,Y+12
    04DD1 853D      LDD	R19,Y+13
    04DD2 925A      ST	-Y,R5
    04DD3 924A      ST	-Y,R4
    04DD4 923A      ST	-Y,R3
    04DD5 922A      ST	-Y,R2
    04DD6 940E 47BB CALL	mod32u
    04DD8 01B8      MOVW	R22,R16
    04DD9 E089      LDI	R24,0x9
    04DDA E090      LDI	R25,0
    04DDB 1780      CP	R24,R16
    04DDC 0791      CPC	R25,R17
    04DDD F034      BLT	0x4DE4
    04DDE 01CB      MOVW	R24,R22
    04DDF 96C0      ADIW	R24,0x30
    04DE0 01FA      MOVW	R30,R20
    04DE1 9381      ST	Z+,R24
    04DE2 01AF      MOVW	R20,R30
    04DE3 C006      RJMP	0x4DEA
    04DE4 01CB      MOVW	R24,R22
    04DE5 5A89      SUBI	R24,0xA9
    04DE6 4F9F      SBCI	R25,0xFF
    04DE7 01FA      MOVW	R30,R20
    04DE8 9381      ST	Z+,R24
    04DE9 01AF      MOVW	R20,R30
    04DEA 0116      MOVW	R2,R12
    04DEB 2444      CLR	R4
    04DEC FC37      SBRC	R3,7
    04DED 9440      COM	R4
    04DEE 2455      CLR	R5
    04DEF FC47      SBRC	R4,7
    04DF0 9450      COM	R5
    04DF1 850A      LDD	R16,Y+10
    04DF2 851B      LDD	R17,Y+11
    04DF3 852C      LDD	R18,Y+12
    04DF4 853D      LDD	R19,Y+13
    04DF5 925A      ST	-Y,R5
    04DF6 924A      ST	-Y,R4
    04DF7 923A      ST	-Y,R3
    04DF8 922A      ST	-Y,R2
    04DF9 940E 47B9 CALL	div32u
    04DFB 870A      STD	Y+10,R16
    04DFC 871B      STD	Y+11,R17
    04DFD 872C      STD	Y+12,R18
    04DFE 873D      STD	Y+13,R19
    04DFF 842A      LDD	R2,Y+10
    04E00 843B      LDD	R3,Y+11
    04E01 844C      LDD	R4,Y+12
    04E02 845D      LDD	R5,Y+13
    04E03 9488      BCLR	0
    04E04 2022      TST	R2
    04E05 0432      CPC	R3,R2
    04E06 0442      CPC	R4,R2
    04E07 0452      CPC	R5,R2
    04E08 F009      BEQ	0x4E0A
    04E09 CFBD      RJMP	0x4DC7
    04E0A 012A      MOVW	R4,R20
    04E0B 5041      SUBI	R20,1
    04E0C 4050      SBCI	R21,0
    04E0D 2422      CLR	R2
    04E0E 01F2      MOVW	R30,R4
    04E0F 8220      ST	Z,R2
    04E10 0165      MOVW	R12,R10
    04E11 C00C      RJMP	0x4E1E
    04E12 01F6      MOVW	R30,R12
    04E13 80E0      LD	R14,Z
    04E14 01FA      MOVW	R30,R20
    04E15 8020      LD	R2,Z
    04E16 01F6      MOVW	R30,R12
    04E17 9221      ST	Z+,R2
    04E18 016F      MOVW	R12,R30
    04E19 011A      MOVW	R2,R20
    04E1A 5041      SUBI	R20,1
    04E1B 4050      SBCI	R21,0
    04E1C 01F1      MOVW	R30,R2
    04E1D 82E0      ST	Z,R14
    04E1E 16C4      CP	R12,R20
    04E1F 06D5      CPC	R13,R21
    04E20 F388      BCS	0x4E12
    04E21 0185      MOVW	R16,R10
    04E22 940E 48A8 CALL	pop_xgsetF0FC
    04E24 9622      ADIW	R28,2
    04E25 9508      RET
_utoa:
    04E26 940E 48B3 CALL	push_xgsetF0FC
    04E28 0169      MOVW	R12,R18
    04E29 0158      MOVW	R10,R16
    04E2A 84EA      LDD	R14,Y+10
    04E2B 84FB      LDD	R15,Y+11
    04E2C 01A5      MOVW	R20,R10
    04E2D 0197      MOVW	R18,R14
    04E2E 0186      MOVW	R16,R12
    04E2F 940E 479D CALL	mod16u
    04E31 01B8      MOVW	R22,R16
    04E32 E089      LDI	R24,0x9
    04E33 E090      LDI	R25,0
    04E34 1780      CP	R24,R16
    04E35 0791      CPC	R25,R17
    04E36 F034      BLT	0x4E3D
    04E37 01CB      MOVW	R24,R22
    04E38 96C0      ADIW	R24,0x30
    04E39 01FA      MOVW	R30,R20
    04E3A 9381      ST	Z+,R24
    04E3B 01AF      MOVW	R20,R30
    04E3C C006      RJMP	0x4E43
    04E3D 01CB      MOVW	R24,R22
    04E3E 5A89      SUBI	R24,0xA9
    04E3F 4F9F      SBCI	R25,0xFF
    04E40 01FA      MOVW	R30,R20
    04E41 9381      ST	Z+,R24
    04E42 01AF      MOVW	R20,R30
    04E43 0197      MOVW	R18,R14
    04E44 0186      MOVW	R16,R12
    04E45 940E 479F CALL	div16u
    04E47 0168      MOVW	R12,R16
    04E48 20CC      TST	R12
    04E49 F719      BNE	0x4E2D
    04E4A 20DD      TST	R13
    04E4B F709      BNE	0x4E2D
    04E4C 012A      MOVW	R4,R20
    04E4D 5041      SUBI	R20,1
    04E4E 4050      SBCI	R21,0
    04E4F 2422      CLR	R2
    04E50 01F2      MOVW	R30,R4
    04E51 8220      ST	Z,R2
    04E52 0165      MOVW	R12,R10
    04E53 C00C      RJMP	0x4E60
    04E54 01F6      MOVW	R30,R12
    04E55 80E0      LD	R14,Z
    04E56 01FA      MOVW	R30,R20
    04E57 8020      LD	R2,Z
    04E58 01F6      MOVW	R30,R12
    04E59 9221      ST	Z+,R2
    04E5A 016F      MOVW	R12,R30
    04E5B 011A      MOVW	R2,R20
    04E5C 5041      SUBI	R20,1
    04E5D 4050      SBCI	R21,0
    04E5E 01F1      MOVW	R30,R2
    04E5F 82E0      ST	Z,R14
    04E60 16C4      CP	R12,R20
    04E61 06D5      CPC	R13,R21
    04E62 F388      BCS	0x4E54
    04E63 0185      MOVW	R16,R10
    04E64 940C 48A8 JMP	pop_xgsetF0FC
_ftoa:
    04E66 940E 476E CALL	push_arg4
    04E68 940E 48B3 CALL	push_xgsetF0FC
    04E6A 9764      SBIW	R28,0x14
    04E6B A0CA      LDD	R12,Y+34
    04E6C A0DB      LDD	R13,Y+35
    04E6D 2422      CLR	R2
    04E6E 2433      CLR	R3
    04E6F 01F6      MOVW	R30,R12
    04E70 8231      STD	Z+1,R3
    04E71 8220      ST	Z,R2
    04E72 8C2E      LDD	R2,Y+30
    04E73 8C3F      LDD	R3,Y+31
    04E74 A048      LDD	R4,Y+32
    04E75 A059      LDD	R5,Y+33
    04E76 EE00      LDI	R16,0xE0
    04E77 E010      LDI	R17,0
    04E78 940E 483B CALL	elpm32
    04E7A 933A      ST	-Y,R19
    04E7B 932A      ST	-Y,R18
    04E7C 931A      ST	-Y,R17
    04E7D 930A      ST	-Y,R16
    04E7E 0181      MOVW	R16,R2
    04E7F 0192      MOVW	R18,R4
    04E80 940E 4C33 CALL	fpcmp2
    04E82 F479      BNE	0x4E92
    04E83 E380      LDI	R24,0x30
    04E84 9380 08CE STS	config+46,R24
    04E86 E28E      LDI	R24,0x2E
    04E87 9380 08CF STS	config+47,R24
    04E89 E380      LDI	R24,0x30
    04E8A 9380 08D0 STS	config+48,R24
    04E8C 2422      CLR	R2
    04E8D 9220 08D1 STS	config+49,R2
    04E8F EC0E      LDI	R16,0xCE
    04E90 E018      LDI	R17,0x8
    04E91 C15E      RJMP	0x4FF0
    04E92 8C2E      LDD	R2,Y+30
    04E93 8C3F      LDD	R3,Y+31
    04E94 A048      LDD	R4,Y+32
    04E95 A059      LDD	R5,Y+33
    04E96 8628      STD	Y+8,R2
    04E97 8639      STD	Y+9,R3
    04E98 864A      STD	Y+10,R4
    04E99 865B      STD	Y+11,R5
    04E9A E187      LDI	R24,0x17
    04E9B E090      LDI	R25,0
    04E9C 8508      LDD	R16,Y+8
    04E9D 8519      LDD	R17,Y+9
    04E9E 852A      LDD	R18,Y+10
    04E9F 853B      LDD	R19,Y+11
    04EA0 938A      ST	-Y,R24
    04EA1 940E 4773 CALL	asr32
    04EA3 2F80      MOV	R24,R16
    04EA4 2799      CLR	R25
    04EA5 578F      SUBI	R24,0x7F
    04EA6 4090      SBCI	R25,0
    04EA7 015C      MOVW	R10,R24
    04EA8 EF4F      LDI	R20,0xFF
    04EA9 EF5F      LDI	R21,0xFF
    04EAA EF6F      LDI	R22,0xFF
    04EAB E070      LDI	R23,0
    04EAC 8428      LDD	R2,Y+8
    04EAD 8439      LDD	R3,Y+9
    04EAE 844A      LDD	R4,Y+10
    04EAF 845B      LDD	R5,Y+11
    04EB0 2224      AND	R2,R20
    04EB1 2235      AND	R3,R21
    04EB2 2246      AND	R4,R22
    04EB3 2257      AND	R5,R23
    04EB4 93EF      PUSH	R30
    04EB5 2DE4      MOV	R30,R4
    04EB6 68E0      ORI	R30,0x80
    04EB7 2E4E      MOV	R4,R30
    04EB8 91EF      POP	R30
    04EB9 8A28      STD	Y+16,R2
    04EBA 8A39      STD	Y+17,R3
    04EBB 8A4A      STD	Y+18,R4
    04EBC 8A5B      STD	Y+19,R5
    04EBD E080      LDI	R24,0
    04EBE 838C      STD	Y+4,R24
    04EBF 838D      STD	Y+5,R24
    04EC0 838E      STD	Y+6,R24
    04EC1 838F      STD	Y+7,R24
    04EC2 E080      LDI	R24,0
    04EC3 878C      STD	Y+12,R24
    04EC4 878D      STD	Y+13,R24
    04EC5 878E      STD	Y+14,R24
    04EC6 878F      STD	Y+15,R24
    04EC7 01C5      MOVW	R24,R10
    04EC8 318F      CPI	R24,0x1F
    04EC9 E0E0      LDI	R30,0
    04ECA 079E      CPC	R25,R30
    04ECB F044      BLT	0x4ED4
    04ECC EF8E      LDI	R24,0xFE
    04ECD EF9F      LDI	R25,0xFF
    04ECE 01F6      MOVW	R30,R12
    04ECF 8391      STD	Z+1,R25
    04ED0 8380      ST	Z,R24
    04ED1 2700      CLR	R16
    04ED2 2711      CLR	R17
    04ED3 C11C      RJMP	0x4FF0
    04ED4 01C5      MOVW	R24,R10
    04ED5 3E89      CPI	R24,0xE9
    04ED6 EFEF      LDI	R30,0xFF
    04ED7 079E      CPC	R25,R30
    04ED8 F444      BGE	0x4EE1
    04ED9 EF8F      LDI	R24,0xFF
    04EDA EF9F      LDI	R25,0xFF
    04EDB 01F6      MOVW	R30,R12
    04EDC 8391      STD	Z+1,R25
    04EDD 8380      ST	Z,R24
    04EDE 2700      CLR	R16
    04EDF 2711      CLR	R17
    04EE0 C10F      RJMP	0x4FF0
    04EE1 01C5      MOVW	R24,R10
    04EE2 3187      CPI	R24,0x17
    04EE3 E0A0      LDI	R26,0
    04EE4 079A      CPC	R25,R26
    04EE5 F06C      BLT	0x4EF3
    04EE6 9747      SBIW	R24,0x17
    04EE7 8908      LDD	R16,Y+16
    04EE8 8919      LDD	R17,Y+17
    04EE9 892A      LDD	R18,Y+18
    04EEA 893B      LDD	R19,Y+19
    04EEB 938A      ST	-Y,R24
    04EEC 940E 493E CALL	lsl32
    04EEE 870C      STD	Y+12,R16
    04EEF 871D      STD	Y+13,R17
    04EF0 872E      STD	Y+14,R18
    04EF1 873F      STD	Y+15,R19
    04EF2 C045      RJMP	0x4F38
    04EF3 01C5      MOVW	R24,R10
    04EF4 3080      CPI	R24,0
    04EF5 E0A0      LDI	R26,0
    04EF6 079A      CPC	R25,R26
    04EF7 F13C      BLT	0x4F1F
    04EF8 E187      LDI	R24,0x17
    04EF9 E090      LDI	R25,0
    04EFA 198A      SUB	R24,R10
    04EFB 099B      SBC	R25,R11
    04EFC 8908      LDD	R16,Y+16
    04EFD 8919      LDD	R17,Y+17
    04EFE 892A      LDD	R18,Y+18
    04EFF 893B      LDD	R19,Y+19
    04F00 938A      ST	-Y,R24
    04F01 940E 4773 CALL	asr32
    04F03 870C      STD	Y+12,R16
    04F04 871D      STD	Y+13,R17
    04F05 872E      STD	Y+14,R18
    04F06 873F      STD	Y+15,R19
    04F07 01C5      MOVW	R24,R10
    04F08 9601      ADIW	R24,1
    04F09 8908      LDD	R16,Y+16
    04F0A 8919      LDD	R17,Y+17
    04F0B 892A      LDD	R18,Y+18
    04F0C 893B      LDD	R19,Y+19
    04F0D 938A      ST	-Y,R24
    04F0E 940E 493E CALL	lsl32
    04F10 0118      MOVW	R2,R16
    04F11 0129      MOVW	R4,R18
    04F12 EF4F      LDI	R20,0xFF
    04F13 EF5F      LDI	R21,0xFF
    04F14 EF6F      LDI	R22,0xFF
    04F15 E070      LDI	R23,0
    04F16 2224      AND	R2,R20
    04F17 2235      AND	R3,R21
    04F18 2246      AND	R4,R22
    04F19 2257      AND	R5,R23
    04F1A 822C      STD	Y+4,R2
    04F1B 823D      STD	Y+5,R3
    04F1C 824E      STD	Y+6,R4
    04F1D 825F      STD	Y+7,R5
    04F1E C019      RJMP	0x4F38
    04F1F EF4F      LDI	R20,0xFF
    04F20 EF5F      LDI	R21,0xFF
    04F21 EF6F      LDI	R22,0xFF
    04F22 E070      LDI	R23,0
    04F23 8908      LDD	R16,Y+16
    04F24 8919      LDD	R17,Y+17
    04F25 892A      LDD	R18,Y+18
    04F26 893B      LDD	R19,Y+19
    04F27 2304      AND	R16,R20
    04F28 2315      AND	R17,R21
    04F29 2326      AND	R18,R22
    04F2A 2337      AND	R19,R23
    04F2B 01C5      MOVW	R24,R10
    04F2C 9601      ADIW	R24,1
    04F2D 9580      COM	R24
    04F2E 9590      COM	R25
    04F2F 5F8F      SUBI	R24,0xFF
    04F30 4F9F      SBCI	R25,0xFF
    04F31 938A      ST	-Y,R24
    04F32 940E 4773 CALL	asr32
    04F34 830C      STD	Y+4,R16
    04F35 831D      STD	Y+5,R17
    04F36 832E      STD	Y+6,R18
    04F37 833F      STD	Y+7,R19
    04F38 EC8E      LDI	R24,0xCE
    04F39 E098      LDI	R25,0x8
    04F3A 015C      MOVW	R10,R24
    04F3B E040      LDI	R20,0
    04F3C E050      LDI	R21,0
    04F3D E060      LDI	R22,0
    04F3E E070      LDI	R23,0
    04F3F 8428      LDD	R2,Y+8
    04F40 8439      LDD	R3,Y+9
    04F41 844A      LDD	R4,Y+10
    04F42 845B      LDD	R5,Y+11
    04F43 1624      CP	R2,R20
    04F44 0635      CPC	R3,R21
    04F45 0646      CPC	R4,R22
    04F46 0657      CPC	R5,R23
    04F47 F424      BGE	0x4F4C
    04F48 E28D      LDI	R24,0x2D
    04F49 01F5      MOVW	R30,R10
    04F4A 9381      ST	Z+,R24
    04F4B 015F      MOVW	R10,R30
    04F4C 842C      LDD	R2,Y+12
    04F4D 843D      LDD	R3,Y+13
    04F4E 844E      LDD	R4,Y+14
    04F4F 845F      LDD	R5,Y+15
    04F50 9488      BCLR	0
    04F51 2022      TST	R2
    04F52 0432      CPC	R3,R2
    04F53 0442      CPC	R4,R2
    04F54 0452      CPC	R5,R2
    04F55 F429      BNE	0x4F5B
    04F56 E380      LDI	R24,0x30
    04F57 01F5      MOVW	R30,R10
    04F58 9381      ST	Z+,R24
    04F59 015F      MOVW	R10,R30
    04F5A C016      RJMP	0x4F71
    04F5B E08A      LDI	R24,0xA
    04F5C E090      LDI	R25,0
    04F5D 839B      STD	Y+3,R25
    04F5E 838A      STD	Y+2,R24
    04F5F 842C      LDD	R2,Y+12
    04F60 843D      LDD	R3,Y+13
    04F61 844E      LDD	R4,Y+14
    04F62 845F      LDD	R5,Y+15
    04F63 8248      ST	Y,R4
    04F64 8259      STD	Y+1,R5
    04F65 0191      MOVW	R18,R2
    04F66 0185      MOVW	R16,R10
    04F67 940E 4D07 CALL	_ltoa
    04F69 C003      RJMP	0x4F6D
    04F6A 01C5      MOVW	R24,R10
    04F6B 9601      ADIW	R24,1
    04F6C 015C      MOVW	R10,R24
    04F6D 01F5      MOVW	R30,R10
    04F6E 8020      LD	R2,Z
    04F6F 2022      TST	R2
    04F70 F7C9      BNE	0x4F6A
    04F71 E28E      LDI	R24,0x2E
    04F72 01F5      MOVW	R30,R10
    04F73 9381      ST	Z+,R24
    04F74 015F      MOVW	R10,R30
    04F75 802C      LDD	R2,Y+4
    04F76 803D      LDD	R3,Y+5
    04F77 804E      LDD	R4,Y+6
    04F78 805F      LDD	R5,Y+7
    04F79 9488      BCLR	0
    04F7A 2022      TST	R2
    04F7B 0432      CPC	R3,R2
    04F7C 0442      CPC	R4,R2
    04F7D 0452      CPC	R5,R2
    04F7E F421      BNE	0x4F83
    04F7F E380      LDI	R24,0x30
    04F80 9381      ST	Z+,R24
    04F81 015F      MOVW	R10,R30
    04F82 C068      RJMP	0x4FEB
    04F83 EC8E      LDI	R24,0xCE
    04F84 E098      LDI	R25,0x8
    04F85 0115      MOVW	R2,R10
    04F86 1A28      SUB	R2,R24
    04F87 0A39      SBC	R3,R25
    04F88 E08F      LDI	R24,0xF
    04F89 E090      LDI	R25,0
    04F8A 1982      SUB	R24,R2
    04F8B 0993      SBC	R25,R3
    04F8C 9701      SBIW	R24,1
    04F8D 2EC8      MOV	R12,R24
    04F8E E087      LDI	R24,7
    04F8F 158C      CP	R24,R12
    04F90 F408      BCC	0x4F92
    04F91 2EC8      MOV	R12,R24
    04F92 24EE      CLR	R14
    04F93 C042      RJMP	0x4FD6
    04F94 E083      LDI	R24,3
    04F95 E090      LDI	R25,0
    04F96 810C      LDD	R16,Y+4
    04F97 811D      LDD	R17,Y+5
    04F98 812E      LDD	R18,Y+6
    04F99 813F      LDD	R19,Y+7
    04F9A 938A      ST	-Y,R24
    04F9B 940E 493E CALL	lsl32
    04F9D 0118      MOVW	R2,R16
    04F9E 0129      MOVW	R4,R18
    04F9F 806C      LDD	R6,Y+4
    04FA0 807D      LDD	R7,Y+5
    04FA1 808E      LDD	R8,Y+6
    04FA2 809F      LDD	R9,Y+7
    04FA3 0C66      LSL	R6
    04FA4 1C77      ROL	R7
    04FA5 1C88      ROL	R8
    04FA6 1C99      ROL	R9
    04FA7 0C26      ADD	R2,R6
    04FA8 1C37      ADC	R3,R7
    04FA9 1C48      ADC	R4,R8
    04FAA 1C59      ADC	R5,R9
    04FAB 822C      STD	Y+4,R2
    04FAC 823D      STD	Y+5,R3
    04FAD 824E      STD	Y+6,R4
    04FAE 825F      STD	Y+7,R5
    04FAF E188      LDI	R24,0x18
    04FB0 E090      LDI	R25,0
    04FB1 810C      LDD	R16,Y+4
    04FB2 811D      LDD	R17,Y+5
    04FB3 812E      LDD	R18,Y+6
    04FB4 813F      LDD	R19,Y+7
    04FB5 938A      ST	-Y,R24
    04FB6 940E 4773 CALL	asr32
    04FB8 0118      MOVW	R2,R16
    04FB9 0129      MOVW	R4,R18
    04FBA E340      LDI	R20,0x30
    04FBB E050      LDI	R21,0
    04FBC E060      LDI	R22,0
    04FBD E070      LDI	R23,0
    04FBE 0E24      ADD	R2,R20
    04FBF 1E35      ADC	R3,R21
    04FC0 1E46      ADC	R4,R22
    04FC1 1E57      ADC	R5,R23
    04FC2 01F5      MOVW	R30,R10
    04FC3 9221      ST	Z+,R2
    04FC4 015F      MOVW	R10,R30
    04FC5 EF4F      LDI	R20,0xFF
    04FC6 EF5F      LDI	R21,0xFF
    04FC7 EF6F      LDI	R22,0xFF
    04FC8 E070      LDI	R23,0
    04FC9 802C      LDD	R2,Y+4
    04FCA 803D      LDD	R3,Y+5
    04FCB 804E      LDD	R4,Y+6
    04FCC 805F      LDD	R5,Y+7
    04FCD 2224      AND	R2,R20
    04FCE 2235      AND	R3,R21
    04FCF 2246      AND	R4,R22
    04FD0 2257      AND	R5,R23
    04FD1 822C      STD	Y+4,R2
    04FD2 823D      STD	Y+5,R3
    04FD3 824E      STD	Y+6,R4
    04FD4 825F      STD	Y+7,R5
    04FD5 94E3      INC	R14
    04FD6 14EC      CP	R14,R12
    04FD7 F408      BCC	0x4FD9
    04FD8 CFBB      RJMP	0x4F94
    04FD9 01C5      MOVW	R24,R10
    04FDA 9701      SBIW	R24,1
    04FDB 015C      MOVW	R10,R24
    04FDC C003      RJMP	0x4FE0
    04FDD 01C5      MOVW	R24,R10
    04FDE 9701      SBIW	R24,1
    04FDF 015C      MOVW	R10,R24
    04FE0 01F5      MOVW	R30,R10
    04FE1 8180      LD	R24,Z
    04FE2 3380      CPI	R24,0x30
    04FE3 F421      BNE	0x4FE8
    04FE4 9731      SBIW	R30,1
    04FE5 8180      LD	R24,Z
    04FE6 328E      CPI	R24,0x2E
    04FE7 F7A9      BNE	0x4FDD
    04FE8 01C5      MOVW	R24,R10
    04FE9 9601      ADIW	R24,1
    04FEA 015C      MOVW	R10,R24
    04FEB 2422      CLR	R2
    04FEC 01F5      MOVW	R30,R10
    04FED 8220      ST	Z,R2
    04FEE EC0E      LDI	R16,0xCE
    04FEF E018      LDI	R17,0x8
    04FF0 9664      ADIW	R28,0x14
    04FF1 940E 48A8 CALL	pop_xgsetF0FC
    04FF3 9624      ADIW	R28,4
    04FF4 9508      RET
_isdigit:
    04FF5 EE85      LDI	R24,0xE5
    04FF6 E090      LDI	R25,0
    04FF7 01F8      MOVW	R30,R16
    04FF8 0FE8      ADD	R30,R24
    04FF9 1FF9      ADC	R31,R25
    04FFA 9106      ELPM	R16,Z
    04FFB 2711      CLR	R17
    04FFC 7004      ANDI	R16,4
    04FFD 7010      ANDI	R17,0
    04FFE 9508      RET
_islower:
    04FFF EE85      LDI	R24,0xE5
    05000 E090      LDI	R25,0
    05001 01F8      MOVW	R30,R16
    05002 0FE8      ADD	R30,R24
    05003 1FF9      ADC	R31,R25
    05004 9106      ELPM	R16,Z
    05005 2711      CLR	R17
    05006 7002      ANDI	R16,2
    05007 7010      ANDI	R17,0
    05008 9508      RET
_isspace:
    05009 EE85      LDI	R24,0xE5
    0500A E090      LDI	R25,0
    0500B 01F8      MOVW	R30,R16
    0500C 0FE8      ADD	R30,R24
    0500D 1FF9      ADC	R31,R25
    0500E 9106      ELPM	R16,Z
    0500F 2711      CLR	R17
    05010 7100      ANDI	R16,0x10
    05011 7010      ANDI	R17,0
    05012 9508      RET
_toupper:
    05013 934A      ST	-Y,R20
    05014 935A      ST	-Y,R21
    05015 01A8      MOVW	R20,R16
    05016 018A      MOVW	R16,R20
    05017 940E 4FFF CALL	_islower
    05019 3000      CPI	R16,0
    0501A 0701      CPC	R16,R17
    0501B F031      BEQ	0x5022
    0501C 018A      MOVW	R16,R20
    0501D 5601      SUBI	R16,0x61
    0501E 4010      SBCI	R17,0
    0501F 5B0F      SUBI	R16,0xBF
    05020 4F1F      SBCI	R17,0xFF
    05021 C001      RJMP	0x5023
    05022 018A      MOVW	R16,R20
    05023 9159      LD	R21,Y+
    05024 9149      LD	R20,Y+
    05025 9508      RET
__sdepi:
    05026 91E0 08DD LDS	R30,config+61
    05028 91F0 08DE LDS	R31,config+62
    0502A 9301      ST	Z+,R16
    0502B 93F0 08DE STS	config+62,R31
    0502D 93E0 08DD STS	config+61,R30
    0502F 9508      RET
_sprintf:
    05030 940E 476E CALL	push_arg4
    05032 92AA      ST	-Y,R10
    05033 92BA      ST	-Y,R11
    05034 9722      SBIW	R28,2
    05035 802C      LDD	R2,Y+4
    05036 803D      LDD	R3,Y+5
    05037 9230 08DE STS	config+62,R3
    05039 9220 08DD STS	config+61,R2
    0503B 01CE      MOVW	R24,R28
    0503C 9608      ADIW	R24,0x8
    0503D 015C      MOVW	R10,R24
    0503E 82B9      STD	Y+1,R11
    0503F 82A8      ST	Y,R10
    05040 812E      LDD	R18,Y+6
    05041 813F      LDD	R19,Y+7
    05042 E80C      LDI	R16,0x8C
    05043 E010      LDI	R17,0
    05044 940E 42DD CALL	__print
    05046 2422      CLR	R2
    05047 91E0 08DD LDS	R30,config+61
    05049 91F0 08DE LDS	R31,config+62
    0504B 8220      ST	Z,R2
    0504C 802C      LDD	R2,Y+4
    0504D 803D      LDD	R3,Y+5
    0504E 9100 08DD LDS	R16,config+61
    05050 9110 08DE LDS	R17,config+62
    05052 1902      SUB	R16,R2
    05053 0913      SBC	R17,R3
    05054 9622      ADIW	R28,2
    05055 90B9      LD	R11,Y+
    05056 90A9      LD	R10,Y+
    05057 9624      ADIW	R28,4
    05058 9508      RET
    05059 940E 48D2 CALL	push_xgsetF00C
    0505B 01B9      MOVW	R22,R18
    0505C 0158      MOVW	R10,R16
    0505D 3F6E      CPI	R22,0xFE
    0505E EFEF      LDI	R30,0xFF
    0505F 077E      CPC	R23,R30
    05060 F419      BNE	0x5064
    05061 EE45      LDI	R20,0xE5
    05062 E051      LDI	R21,1
    05063 C009      RJMP	0x506D
    05064 3F6F      CPI	R22,0xFF
    05065 EFEF      LDI	R30,0xFF
    05066 077E      CPC	R23,R30
    05067 F419      BNE	0x506B
    05068 E040      LDI	R20,0
    05069 E052      LDI	R21,2
    0506A C002      RJMP	0x506D
    0506B E14D      LDI	R20,0x1D
    0506C E052      LDI	R21,2
    0506D 019A      MOVW	R18,R20
    0506E 0185      MOVW	R16,R10
    0506F 940E 4C3F CALL	_cstrcpy
    05071 0185      MOVW	R16,R10
    05072 940C 48D9 JMP	pop_xgsetF00C
__FormatFP_1:
    05074 940E 476E CALL	push_arg4
    05076 940E 48B3 CALL	push_xgsetF0FC
    05078 01B9      MOVW	R22,R18
    05079 97A2      SBIW	R28,0x22
    0507A EF8F      LDI	R24,0xFF
    0507B EF9F      LDI	R25,0xFF
    0507C 015C      MOVW	R10,R24
    0507D 879F      STD	Y+15,R25
    0507E 878E      STD	Y+14,R24
    0507F 8B9B      STD	Y+19,R25
    05080 8B8A      STD	Y+18,R24
    05081 8B99      STD	Y+17,R25
    05082 8B88      STD	Y+16,R24
    05083 8F9E      STD	Y+30,R25
    05084 8F8D      STD	Y+29,R24
    05085 8B9E      STD	Y+22,R25
    05086 8B8D      STD	Y+21,R24
    05087 2400      CLR	R0
    05088 2411      CLR	R1
    05089 8E19      STD	Y+25,R1
    0508A 8E08      STD	Y+24,R0
    0508B 2799      CLR	R25
    0508C A398      STD	Y+32,R25
    0508D 8F8F      STD	Y+31,R24
    0508E 24EE      CLR	R14
    0508F 24FF      CLR	R15
    05090 2744      CLR	R20
    05091 2755      CLR	R21
    05092 E280      LDI	R24,0x20
    05093 8B8F      STD	Y+23,R24
    05094 8F8C      STD	Y+28,R24
    05095 E685      LDI	R24,0x65
    05096 A389      STD	Y+33,R24
    05097 E184      LDI	R24,0x14
    05098 A80E      LDD	R0,Y+54
    05099 A81F      LDD	R1,Y+55
    0509A 1580      CP	R24,R0
    0509B 0591      CPC	R25,R1
    0509C F414      BGE	0x509F
    0509D AB9F      STD	Y+55,R25
    0509E AB8E      STD	Y+54,R24
    0509F E184      LDI	R24,0x14
    050A0 E090      LDI	R25,0
    050A1 AC08      LDD	R0,Y+56
    050A2 AC19      LDD	R1,Y+57
    050A3 1580      CP	R24,R0
    050A4 0591      CPC	R25,R1
    050A5 F414      BGE	0x50A8
    050A6 AF99      STD	Y+57,R25
    050A7 AF88      STD	Y+56,R24
    050A8 3060      CPI	R22,0
    050A9 0767      CPC	R22,R23
    050AA F409      BNE	0x50AC
    050AB C084      RJMP	0x5130
    050AC 3061      CPI	R22,1
    050AD E0E0      LDI	R30,0
    050AE 077E      CPC	R23,R30
    050AF F079      BEQ	0x50BF
    050B0 3062      CPI	R22,2
    050B1 E0E0      LDI	R30,0
    050B2 077E      CPC	R23,R30
    050B3 F049      BEQ	0x50BD
    050B4 3063      CPI	R22,3
    050B5 E0E0      LDI	R30,0
    050B6 077E      CPC	R23,R30
    050B7 F061      BEQ	0x50C4
    050B8 3064      CPI	R22,4
    050B9 E0E0      LDI	R30,0
    050BA 077E      CPC	R23,R30
    050BB F031      BEQ	0x50C2
    050BC C073      RJMP	0x5130
    050BD E485      LDI	R24,0x45
    050BE A389      STD	Y+33,R24
    050BF E041      LDI	R20,1
    050C0 E050      LDI	R21,0
    050C1 C06E      RJMP	0x5130
    050C2 E485      LDI	R24,0x45
    050C3 A389      STD	Y+33,R24
    050C4 A828      LDD	R2,Y+48
    050C5 A839      LDD	R3,Y+49
    050C6 A84A      LDD	R4,Y+50
    050C7 A85B      LDD	R5,Y+51
    050C8 8628      STD	Y+8,R2
    050C9 8639      STD	Y+9,R3
    050CA 864A      STD	Y+10,R4
    050CB 865B      STD	Y+11,R5
    050CC A828      LDD	R2,Y+48
    050CD A839      LDD	R3,Y+49
    050CE A84A      LDD	R4,Y+50
    050CF A85B      LDD	R5,Y+51
    050D0 E40E      LDI	R16,0x4E
    050D1 E012      LDI	R17,2
    050D2 940E 483B CALL	elpm32
    050D4 933A      ST	-Y,R19
    050D5 932A      ST	-Y,R18
    050D6 931A      ST	-Y,R17
    050D7 930A      ST	-Y,R16
    050D8 0181      MOVW	R16,R2
    050D9 0192      MOVW	R18,R4
    050DA 940E 4C33 CALL	fpcmp2
    050DC F474      BGE	0x50EB
    050DD E40A      LDI	R16,0x4A
    050DE E012      LDI	R17,2
    050DF 940E 483B CALL	elpm32
    050E1 01CE      MOVW	R24,R28
    050E2 96C0      ADIW	R24,0x30
    050E3 939A      ST	-Y,R25
    050E4 938A      ST	-Y,R24
    050E5 940E 4BF9 CALL	fpmule1
    050E7 8708      STD	Y+8,R16
    050E8 8719      STD	Y+9,R17
    050E9 872A      STD	Y+10,R18
    050EA 873B      STD	Y+11,R19
    050EB E406      LDI	R16,0x46
    050EC E012      LDI	R17,2
    050ED 940E 483B CALL	elpm32
    050EF 830A      STD	Y+2,R16
    050F0 831B      STD	Y+3,R17
    050F1 832C      STD	Y+4,R18
    050F2 833D      STD	Y+5,R19
    050F3 2400      CLR	R0
    050F4 2411      CLR	R1
    050F5 861D      STD	Y+13,R1
    050F6 860C      STD	Y+12,R0
    050F7 C013      RJMP	0x510B
    050F8 E402      LDI	R16,0x42
    050F9 E012      LDI	R17,2
    050FA 940E 483B CALL	elpm32
    050FC 01CE      MOVW	R24,R28
    050FD 9602      ADIW	R24,2
    050FE 939A      ST	-Y,R25
    050FF 938A      ST	-Y,R24
    05100 940E 4BF9 CALL	fpmule1
    05102 830A      STD	Y+2,R16
    05103 831B      STD	Y+3,R17
    05104 832C      STD	Y+4,R18
    05105 833D      STD	Y+5,R19
    05106 858C      LDD	R24,Y+12
    05107 859D      LDD	R25,Y+13
    05108 9601      ADIW	R24,1
    05109 879D      STD	Y+13,R25
    0510A 878C      STD	Y+12,R24
    0510B 840C      LDD	R0,Y+12
    0510C 841D      LDD	R1,Y+13
    0510D AD08      LDD	R16,Y+56
    0510E AD19      LDD	R17,Y+57
    0510F 1600      CP	R0,R16
    05110 0611      CPC	R1,R17
    05111 F334      BLT	0x50F8
    05112 8428      LDD	R2,Y+8
    05113 8439      LDD	R3,Y+9
    05114 844A      LDD	R4,Y+10
    05115 845B      LDD	R5,Y+11
    05116 E30E      LDI	R16,0x3E
    05117 E012      LDI	R17,2
    05118 940E 483B CALL	elpm32
    0511A 933A      ST	-Y,R19
    0511B 932A      ST	-Y,R18
    0511C 931A      ST	-Y,R17
    0511D 930A      ST	-Y,R16
    0511E 0181      MOVW	R16,R2
    0511F 0192      MOVW	R18,R4
    05120 940E 4C33 CALL	fpcmp2
    05122 F05C      BLT	0x512E
    05123 01CE      MOVW	R24,R28
    05124 9608      ADIW	R24,0x8
    05125 810A      LDD	R16,Y+2
    05126 811B      LDD	R17,Y+3
    05127 812C      LDD	R18,Y+4
    05128 813D      LDD	R19,Y+5
    05129 939A      ST	-Y,R25
    0512A 938A      ST	-Y,R24
    0512B 940E 4C28 CALL	fpcmp1
    0512D F414      BGE	0x5130
    0512E E041      LDI	R20,1
    0512F E050      LDI	R21,0
    05130 A80C      LDD	R0,Y+52
    05131 A81D      LDD	R1,Y+53
    05132 FE04      SBRS	R0,4
    05133 C002      RJMP	0x5136
    05134 E380      LDI	R24,0x30
    05135 8B8F      STD	Y+23,R24
    05136 880F      LDD	R0,Y+23
    05137 8A0C      STD	Y+20,R0
    05138 A80C      LDD	R0,Y+52
    05139 A81D      LDD	R1,Y+53
    0513A FE03      SBRS	R0,3
    0513B C002      RJMP	0x513E
    0513C E28B      LDI	R24,0x2B
    0513D 8B8C      STD	Y+20,R24
    0513E 3040      CPI	R20,0
    0513F 0745      CPC	R20,R21
    05140 F061      BEQ	0x514D
    05141 01CE      MOVW	R24,R28
    05142 9606      ADIW	R24,6
    05143 8399      STD	Y+1,R25
    05144 8388      ST	Y,R24
    05145 A908      LDD	R16,Y+48
    05146 A919      LDD	R17,Y+49
    05147 A92A      LDD	R18,Y+50
    05148 A93B      LDD	R19,Y+51
    05149 940E 4E66 CALL	_ftoa
    0514B 01B8      MOVW	R22,R16
    0514C C062      RJMP	0x51AF
    0514D E30A      LDI	R16,0x3A
    0514E E012      LDI	R17,2
    0514F 940E 483B CALL	elpm32
    05151 830A      STD	Y+2,R16
    05152 831B      STD	Y+3,R17
    05153 832C      STD	Y+4,R18
    05154 833D      STD	Y+5,R19
    05155 2400      CLR	R0
    05156 2411      CLR	R1
    05157 861D      STD	Y+13,R1
    05158 860C      STD	Y+12,R0
    05159 C019      RJMP	0x5173
    0515A 802A      LDD	R2,Y+2
    0515B 803B      LDD	R3,Y+3
    0515C 804C      LDD	R4,Y+4
    0515D 805D      LDD	R5,Y+5
    0515E E402      LDI	R16,0x42
    0515F E012      LDI	R17,2
    05160 940E 483B CALL	elpm32
    05162 933A      ST	-Y,R19
    05163 932A      ST	-Y,R18
    05164 931A      ST	-Y,R17
    05165 930A      ST	-Y,R16
    05166 0181      MOVW	R16,R2
    05167 0192      MOVW	R18,R4
    05168 940E 4A89 CALL	fpdiv2
    0516A 830A      STD	Y+2,R16
    0516B 831B      STD	Y+3,R17
    0516C 832C      STD	Y+4,R18
    0516D 833D      STD	Y+5,R19
    0516E 858C      LDD	R24,Y+12
    0516F 859D      LDD	R25,Y+13
    05170 9601      ADIW	R24,1
    05171 879D      STD	Y+13,R25
    05172 878C      STD	Y+12,R24
    05173 840C      LDD	R0,Y+12
    05174 841D      LDD	R1,Y+13
    05175 AD08      LDD	R16,Y+56
    05176 AD19      LDD	R17,Y+57
    05177 1600      CP	R0,R16
    05178 0611      CPC	R1,R17
    05179 F304      BLT	0x515A
    0517A A828      LDD	R2,Y+48
    0517B A839      LDD	R3,Y+49
    0517C A84A      LDD	R4,Y+50
    0517D A85B      LDD	R5,Y+51
    0517E E40E      LDI	R16,0x4E
    0517F E012      LDI	R17,2
    05180 940E 483B CALL	elpm32
    05182 933A      ST	-Y,R19
    05183 932A      ST	-Y,R18
    05184 931A      ST	-Y,R17
    05185 930A      ST	-Y,R16
    05186 0181      MOVW	R16,R2
    05187 0192      MOVW	R18,R4
    05188 940E 4C33 CALL	fpcmp2
    0518A F494      BGE	0x519D
    0518B 01CE      MOVW	R24,R28
    0518C 9606      ADIW	R24,6
    0518D 8399      STD	Y+1,R25
    0518E 8388      ST	Y,R24
    0518F A908      LDD	R16,Y+48
    05190 A919      LDD	R17,Y+49
    05191 A92A      LDD	R18,Y+50
    05192 A93B      LDD	R19,Y+51
    05193 01CE      MOVW	R24,R28
    05194 9602      ADIW	R24,2
    05195 939A      ST	-Y,R25
    05196 938A      ST	-Y,R24
    05197 940E 49FA CALL	fpsub1
    05199 940E 4E66 CALL	_ftoa
    0519B 01B8      MOVW	R22,R16
    0519C C012      RJMP	0x51AF
    0519D 01CE      MOVW	R24,R28
    0519E 9606      ADIW	R24,6
    0519F 8399      STD	Y+1,R25
    051A0 8388      ST	Y,R24
    051A1 A908      LDD	R16,Y+48
    051A2 A919      LDD	R17,Y+49
    051A3 A92A      LDD	R18,Y+50
    051A4 A93B      LDD	R19,Y+51
    051A5 01CE      MOVW	R24,R28
    051A6 9602      ADIW	R24,2
    051A7 939A      ST	-Y,R25
    051A8 938A      ST	-Y,R24
    051A9 940E 49E5 CALL	fpadd1
    051AB 940E 4E66 CALL	_ftoa
    051AD 0168      MOVW	R12,R16
    051AE 01B6      MOVW	R22,R12
    051AF 802E      LDD	R2,Y+6
    051B0 803F      LDD	R3,Y+7
    051B1 2022      TST	R2
    051B2 F411      BNE	0x51B5
    051B3 2033      TST	R3
    051B4 F031      BEQ	0x51BB
    051B5 0191      MOVW	R18,R2
    051B6 A50C      LDD	R16,Y+44
    051B7 A51D      LDD	R17,Y+45
    051B8 DEA0      RCALL	0x5059
    051B9 0168      MOVW	R12,R16
    051BA C39E      RJMP	0x5559
    051BB 2400      CLR	R0
    051BC 2411      CLR	R1
    051BD 861D      STD	Y+13,R1
    051BE 860C      STD	Y+12,R0
    051BF 3040      CPI	R20,0
    051C0 0745      CPC	R20,R21
    051C1 F481      BNE	0x51D2
    051C2 858E      LDD	R24,Y+14
    051C3 859F      LDD	R25,Y+15
    051C4 3080      CPI	R24,0
    051C5 E0E0      LDI	R30,0
    051C6 079E      CPC	R25,R30
    051C7 F054      BLT	0x51D2
    051C8 842C      LDD	R2,Y+12
    051C9 843D      LDD	R3,Y+13
    051CA 1A28      SUB	R2,R24
    051CB 0A39      SBC	R3,R25
    051CC AC08      LDD	R0,Y+56
    051CD AC19      LDD	R1,Y+57
    051CE 1402      CP	R0,R2
    051CF 0413      CPC	R1,R3
    051D0 F40C      BGE	0x51D2
    051D1 C060      RJMP	0x5232
    051D2 85EC      LDD	R30,Y+12
    051D3 85FD      LDD	R31,Y+13
    051D4 0FE6      ADD	R30,R22
    051D5 1FF7      ADC	R31,R23
    051D6 80C0      LD	R12,Z
    051D7 2D8C      MOV	R24,R12
    051D8 3380      CPI	R24,0x30
    051D9 F1E0      BCS	0x5216
    051DA E389      LDI	R24,0x39
    051DB 158C      CP	R24,R12
    051DC F1C8      BCS	0x5216
    051DD 84AC      LDD	R10,Y+12
    051DE 84BD      LDD	R11,Y+13
    051DF E380      LDI	R24,0x30
    051E0 158C      CP	R24,R12
    051E1 F448      BCC	0x51EB
    051E2 8D8D      LDD	R24,Y+29
    051E3 8D9E      LDD	R25,Y+30
    051E4 3080      CPI	R24,0
    051E5 E0E0      LDI	R30,0
    051E6 079E      CPC	R25,R30
    051E7 F41C      BGE	0x51EB
    051E8 0105      MOVW	R0,R10
    051E9 8E1E      STD	Y+30,R1
    051EA 8E0D      STD	Y+29,R0
    051EB 858E      LDD	R24,Y+14
    051EC 859F      LDD	R25,Y+15
    051ED 3080      CPI	R24,0
    051EE E0E0      LDI	R30,0
    051EF 079E      CPC	R25,R30
    051F0 F4C4      BGE	0x5209
    051F1 8988      LDD	R24,Y+16
    051F2 8999      LDD	R25,Y+17
    051F3 3080      CPI	R24,0
    051F4 E0E0      LDI	R30,0
    051F5 079E      CPC	R25,R30
    051F6 F43C      BGE	0x51FE
    051F7 E380      LDI	R24,0x30
    051F8 158C      CP	R24,R12
    051F9 F420      BCC	0x51FE
    051FA 840C      LDD	R0,Y+12
    051FB 841D      LDD	R1,Y+13
    051FC 8A19      STD	Y+17,R1
    051FD 8A08      STD	Y+16,R0
    051FE 8988      LDD	R24,Y+16
    051FF 8999      LDD	R25,Y+17
    05200 3080      CPI	R24,0
    05201 E0E0      LDI	R30,0
    05202 079E      CPC	R25,R30
    05203 F02C      BLT	0x5209
    05204 8D88      LDD	R24,Y+24
    05205 8D99      LDD	R25,Y+25
    05206 9601      ADIW	R24,1
    05207 8F99      STD	Y+25,R25
    05208 8F88      STD	Y+24,R24
    05209 858E      LDD	R24,Y+14
    0520A 859F      LDD	R25,Y+15
    0520B 3080      CPI	R24,0
    0520C E0E0      LDI	R30,0
    0520D 079E      CPC	R25,R30
    0520E F03C      BLT	0x5216
    0520F E380      LDI	R24,0x30
    05210 158C      CP	R24,R12
    05211 F420      BCC	0x5216
    05212 840C      LDD	R0,Y+12
    05213 841D      LDD	R1,Y+13
    05214 8A1E      STD	Y+22,R1
    05215 8A0D      STD	Y+21,R0
    05216 2D8C      MOV	R24,R12
    05217 328E      CPI	R24,0x2E
    05218 F421      BNE	0x521D
    05219 840C      LDD	R0,Y+12
    0521A 841D      LDD	R1,Y+13
    0521B 861F      STD	Y+15,R1
    0521C 860E      STD	Y+14,R0
    0521D 2D8C      MOV	R24,R12
    0521E 328D      CPI	R24,0x2D
    0521F F429      BNE	0x5225
    05220 E081      LDI	R24,1
    05221 E090      LDI	R25,0
    05222 017C      MOVW	R14,R24
    05223 E28D      LDI	R24,0x2D
    05224 8B8C      STD	Y+20,R24
    05225 20CC      TST	R12
    05226 F409      BNE	0x5228
    05227 C00A      RJMP	0x5232
    05228 858C      LDD	R24,Y+12
    05229 859D      LDD	R25,Y+13
    0522A 9601      ADIW	R24,1
    0522B 879D      STD	Y+13,R25
    0522C 878C      STD	Y+12,R24
    0522D 3184      CPI	R24,0x14
    0522E E0E0      LDI	R30,0
    0522F 079E      CPC	R25,R30
    05230 F40C      BGE	0x5232
    05231 CF8D      RJMP	0x51BF
    05232 858E      LDD	R24,Y+14
    05233 859F      LDD	R25,Y+15
    05234 3080      CPI	R24,0
    05235 E0E0      LDI	R30,0
    05236 079E      CPC	R25,R30
    05237 F43C      BGE	0x523F
    05238 01C5      MOVW	R24,R10
    05239 9601      ADIW	R24,1
    0523A 8B9B      STD	Y+19,R25
    0523B 8B8A      STD	Y+18,R24
    0523C 9601      ADIW	R24,1
    0523D 015C      MOVW	R10,R24
    0523E C012      RJMP	0x5251
    0523F 840E      LDD	R0,Y+14
    05240 841F      LDD	R1,Y+15
    05241 8A1B      STD	Y+19,R1
    05242 8A0A      STD	Y+18,R0
    05243 898D      LDD	R24,Y+21
    05244 899E      LDD	R25,Y+22
    05245 3080      CPI	R24,0
    05246 E0E0      LDI	R30,0
    05247 079E      CPC	R25,R30
    05248 F424      BGE	0x524D
    05249 01C0      MOVW	R24,R0
    0524A 9601      ADIW	R24,1
    0524B 015C      MOVW	R10,R24
    0524C C004      RJMP	0x5251
    0524D 898D      LDD	R24,Y+21
    0524E 899E      LDD	R25,Y+22
    0524F 9601      ADIW	R24,1
    05250 015C      MOVW	R10,R24
    05251 8988      LDD	R24,Y+16
    05252 8999      LDD	R25,Y+17
    05253 3080      CPI	R24,0
    05254 E0E0      LDI	R30,0
    05255 079E      CPC	R25,R30
    05256 F42C      BGE	0x525C
    05257 898A      LDD	R24,Y+18
    05258 899B      LDD	R25,Y+19
    05259 9701      SBIW	R24,1
    0525A 8B99      STD	Y+17,R25
    0525B 8B88      STD	Y+16,R24
    0525C 3040      CPI	R20,0
    0525D 0745      CPC	R20,R21
    0525E F409      BNE	0x5260
    0525F C1D2      RJMP	0x5432
    05260 2400      CLR	R0
    05261 2411      CLR	R1
    05262 861D      STD	Y+13,R1
    05263 860C      STD	Y+12,R0
    05264 880C      LDD	R0,Y+20
    05265 890F      LDD	R16,Y+23
    05266 1600      CP	R0,R16
    05267 F069      BEQ	0x5275
    05268 854C      LDD	R20,Y+12
    05269 855D      LDD	R21,Y+13
    0526A 01CA      MOVW	R24,R20
    0526B 9601      ADIW	R24,1
    0526C 879D      STD	Y+13,R25
    0526D 878C      STD	Y+12,R24
    0526E 01FA      MOVW	R30,R20
    0526F A40C      LDD	R0,Y+44
    05270 A41D      LDD	R1,Y+45
    05271 0DE0      ADD	R30,R0
    05272 1DF1      ADC	R31,R1
    05273 880C      LDD	R0,Y+20
    05274 8200      ST	Z,R0
    05275 854C      LDD	R20,Y+12
    05276 855D      LDD	R21,Y+13
    05277 01CA      MOVW	R24,R20
    05278 9601      ADIW	R24,1
    05279 879D      STD	Y+13,R25
    0527A 878C      STD	Y+12,R24
    0527B 8DED      LDD	R30,Y+29
    0527C 8DFE      LDD	R31,Y+30
    0527D 0FE6      ADD	R30,R22
    0527E 1FF7      ADC	R31,R23
    0527F 8020      LD	R2,Z
    05280 01FA      MOVW	R30,R20
    05281 A40C      LDD	R0,Y+44
    05282 A41D      LDD	R1,Y+45
    05283 0DE0      ADD	R30,R0
    05284 1DF1      ADC	R31,R1
    05285 8220      ST	Z,R2
    05286 01FC      MOVW	R30,R24
    05287 0DE0      ADD	R30,R0
    05288 1DF1      ADC	R31,R1
    05289 E28E      LDI	R24,0x2E
    0528A 8380      ST	Z,R24
    0528B 2422      CLR	R2
    0528C 2433      CLR	R3
    0528D AC08      LDD	R0,Y+56
    0528E AC19      LDD	R1,Y+57
    0528F 1420      CP	R2,R0
    05290 0431      CPC	R3,R1
    05291 F42C      BGE	0x5297
    05292 858C      LDD	R24,Y+12
    05293 859D      LDD	R25,Y+13
    05294 9601      ADIW	R24,1
    05295 879D      STD	Y+13,R25
    05296 878C      STD	Y+12,R24
    05297 8D4D      LDD	R20,Y+29
    05298 8D5E      LDD	R21,Y+30
    05299 5F4F      SUBI	R20,0xFF
    0529A 4F5F      SBCI	R21,0xFF
    0529B 24CC      CLR	R12
    0529C 24DD      CLR	R13
    0529D C034      RJMP	0x52D2
    0529E 880A      LDD	R0,Y+18
    0529F 881B      LDD	R1,Y+19
    052A0 1540      CP	R20,R0
    052A1 0551      CPC	R21,R1
    052A2 F409      BNE	0x52A4
    052A3 C02C      RJMP	0x52D0
    052A4 154A      CP	R20,R10
    052A5 055B      CPC	R21,R11
    052A6 F48C      BGE	0x52B8
    052A7 84EC      LDD	R14,Y+12
    052A8 84FD      LDD	R15,Y+13
    052A9 01C7      MOVW	R24,R14
    052AA 9601      ADIW	R24,1
    052AB 879D      STD	Y+13,R25
    052AC 878C      STD	Y+12,R24
    052AD 01FA      MOVW	R30,R20
    052AE 0FE6      ADD	R30,R22
    052AF 1FF7      ADC	R31,R23
    052B0 8020      LD	R2,Z
    052B1 01F7      MOVW	R30,R14
    052B2 A40C      LDD	R0,Y+44
    052B3 A41D      LDD	R1,Y+45
    052B4 0DE0      ADD	R30,R0
    052B5 1DF1      ADC	R31,R1
    052B6 8220      ST	Z,R2
    052B7 C015      RJMP	0x52CD
    052B8 A80C      LDD	R0,Y+52
    052B9 A81D      LDD	R1,Y+53
    052BA FC00      SBRC	R0,0
    052BB C004      RJMP	0x52C0
    052BC 20CC      TST	R12
    052BD F501      BNE	0x52DE
    052BE 20DD      TST	R13
    052BF F4F1      BNE	0x52DE
    052C0 84EC      LDD	R14,Y+12
    052C1 84FD      LDD	R15,Y+13
    052C2 01C7      MOVW	R24,R14
    052C3 9601      ADIW	R24,1
    052C4 879D      STD	Y+13,R25
    052C5 878C      STD	Y+12,R24
    052C6 01F7      MOVW	R30,R14
    052C7 A40C      LDD	R0,Y+44
    052C8 A41D      LDD	R1,Y+45
    052C9 0DE0      ADD	R30,R0
    052CA 1DF1      ADC	R31,R1
    052CB E380      LDI	R24,0x30
    052CC 8380      ST	Z,R24
    052CD 01C6      MOVW	R24,R12
    052CE 9601      ADIW	R24,1
    052CF 016C      MOVW	R12,R24
    052D0 5F4F      SUBI	R20,0xFF
    052D1 4F5F      SBCI	R21,0xFF
    052D2 AC08      LDD	R0,Y+56
    052D3 AC19      LDD	R1,Y+57
    052D4 14C0      CP	R12,R0
    052D5 04D1      CPC	R13,R1
    052D6 F43C      BGE	0x52DE
    052D7 858C      LDD	R24,Y+12
    052D8 859D      LDD	R25,Y+13
    052D9 308E      CPI	R24,0xE
    052DA E0E0      LDI	R30,0
    052DB 079E      CPC	R25,R30
    052DC F40C      BGE	0x52DE
    052DD CFC0      RJMP	0x529E
    052DE 858C      LDD	R24,Y+12
    052DF 859D      LDD	R25,Y+13
    052E0 9701      SBIW	R24,1
    052E1 016C      MOVW	R12,R24
    052E2 AC08      LDD	R0,Y+56
    052E3 AC19      LDD	R1,Y+57
    052E4 2000      TST	R0
    052E5 F421      BNE	0x52EA
    052E6 2011      TST	R1
    052E7 F411      BNE	0x52EA
    052E8 84CC      LDD	R12,Y+12
    052E9 84DD      LDD	R13,Y+13
    052EA 898A      LDD	R24,Y+18
    052EB 899B      LDD	R25,Y+19
    052EC 8C0D      LDD	R0,Y+29
    052ED 8C1E      LDD	R1,Y+30
    052EE 1980      SUB	R24,R0
    052EF 0991      SBC	R25,R1
    052F0 9701      SBIW	R24,1
    052F1 A398      STD	Y+32,R25
    052F2 8F8F      STD	Y+31,R24
    052F3 154A      CP	R20,R10
    052F4 055B      CPC	R21,R11
    052F5 F444      BGE	0x52FE
    052F6 01FA      MOVW	R30,R20
    052F7 0FE6      ADD	R30,R22
    052F8 1FF7      ADC	R31,R23
    052F9 8180      LD	R24,Z
    052FA 328E      CPI	R24,0x2E
    052FB F411      BNE	0x52FE
    052FC 5F4F      SUBI	R20,0xFF
    052FD 4F5F      SBCI	R21,0xFF
    052FE 154A      CP	R20,R10
    052FF 055B      CPC	R21,R11
    05300 F00C      BLT	0x5302
    05301 C06B      RJMP	0x536D
    05302 01FA      MOVW	R30,R20
    05303 0FE6      ADD	R30,R22
    05304 1FF7      ADC	R31,R23
    05305 80E0      LD	R14,Z
    05306 24FF      CLR	R15
    05307 2D8E      MOV	R24,R14
    05308 3385      CPI	R24,0x35
    05309 F408      BCC	0x530B
    0530A C062      RJMP	0x536D
    0530B E389      LDI	R24,0x39
    0530C 158E      CP	R24,R14
    0530D F408      BCC	0x530F
    0530E C05E      RJMP	0x536D
    0530F C057      RJMP	0x5367
    05310 01F6      MOVW	R30,R12
    05311 A40C      LDD	R0,Y+44
    05312 A41D      LDD	R1,Y+45
    05313 0DE0      ADD	R30,R0
    05314 1DF1      ADC	R31,R1
    05315 80E0      LD	R14,Z
    05316 24FF      CLR	R15
    05317 2D8E      MOV	R24,R14
    05318 3380      CPI	R24,0x30
    05319 F058      BCS	0x5325
    0531A E388      LDI	R24,0x38
    0531B 158E      CP	R24,R14
    0531C F040      BCS	0x5325
    0531D 0176      MOVW	R14,R12
    0531E 0CE0      ADD	R14,R0
    0531F 1CF1      ADC	R15,R1
    05320 01F7      MOVW	R30,R14
    05321 8180      LD	R24,Z
    05322 5F8F      SUBI	R24,0xFF
    05323 8380      ST	Z,R24
    05324 C048      RJMP	0x536D
    05325 01F6      MOVW	R30,R12
    05326 A40C      LDD	R0,Y+44
    05327 A41D      LDD	R1,Y+45
    05328 0DE0      ADD	R30,R0
    05329 1DF1      ADC	R31,R1
    0532A 8180      LD	R24,Z
    0532B 328E      CPI	R24,0x2E
    0532C F009      BEQ	0x532E
    0532D C029      RJMP	0x5357
    0532E 01C6      MOVW	R24,R12
    0532F 9701      SBIW	R24,1
    05330 016C      MOVW	R12,R24
    05331 01FC      MOVW	R30,R24
    05332 0DE0      ADD	R30,R0
    05333 1DF1      ADC	R31,R1
    05334 80E0      LD	R14,Z
    05335 24FF      CLR	R15
    05336 2D8E      MOV	R24,R14
    05337 3380      CPI	R24,0x30
    05338 F058      BCS	0x5344
    05339 E388      LDI	R24,0x38
    0533A 158E      CP	R24,R14
    0533B F040      BCS	0x5344
    0533C 0176      MOVW	R14,R12
    0533D 0CE0      ADD	R14,R0
    0533E 1CF1      ADC	R15,R1
    0533F 01F7      MOVW	R30,R14
    05340 8180      LD	R24,Z
    05341 5F8F      SUBI	R24,0xFF
    05342 8380      ST	Z,R24
    05343 C029      RJMP	0x536D
    05344 01F6      MOVW	R30,R12
    05345 A40C      LDD	R0,Y+44
    05346 A41D      LDD	R1,Y+45
    05347 0DE0      ADD	R30,R0
    05348 1DF1      ADC	R31,R1
    05349 8180      LD	R24,Z
    0534A 3389      CPI	R24,0x39
    0534B F459      BNE	0x5357
    0534C 01F6      MOVW	R30,R12
    0534D 0DE0      ADD	R30,R0
    0534E 1DF1      ADC	R31,R1
    0534F E381      LDI	R24,0x31
    05350 8380      ST	Z,R24
    05351 8D8F      LDD	R24,Y+31
    05352 A198      LDD	R25,Y+32
    05353 9601      ADIW	R24,1
    05354 A398      STD	Y+32,R25
    05355 8F8F      STD	Y+31,R24
    05356 C016      RJMP	0x536D
    05357 01F6      MOVW	R30,R12
    05358 A40C      LDD	R0,Y+44
    05359 A41D      LDD	R1,Y+45
    0535A 0DE0      ADD	R30,R0
    0535B 1DF1      ADC	R31,R1
    0535C 8180      LD	R24,Z
    0535D 3389      CPI	R24,0x39
    0535E F429      BNE	0x5364
    0535F 01F6      MOVW	R30,R12
    05360 0DE0      ADD	R30,R0
    05361 1DF1      ADC	R31,R1
    05362 E380      LDI	R24,0x30
    05363 8380      ST	Z,R24
    05364 01C6      MOVW	R24,R12
    05365 9701      SBIW	R24,1
    05366 016C      MOVW	R12,R24
    05367 01C6      MOVW	R24,R12
    05368 3080      CPI	R24,0
    05369 E0E0      LDI	R30,0
    0536A 079E      CPC	R25,R30
    0536B F00C      BLT	0x536D
    0536C CFA3      RJMP	0x5310
    0536D 84CC      LDD	R12,Y+12
    0536E 84DD      LDD	R13,Y+13
    0536F 01C6      MOVW	R24,R12
    05370 9601      ADIW	R24,1
    05371 879D      STD	Y+13,R25
    05372 878C      STD	Y+12,R24
    05373 01F6      MOVW	R30,R12
    05374 A40C      LDD	R0,Y+44
    05375 A41D      LDD	R1,Y+45
    05376 0DE0      ADD	R30,R0
    05377 1DF1      ADC	R31,R1
    05378 A009      LDD	R0,Y+33
    05379 8200      ST	Z,R0
    0537A 8D8F      LDD	R24,Y+31
    0537B A198      LDD	R25,Y+32
    0537C 3080      CPI	R24,0
    0537D E0E0      LDI	R30,0
    0537E 079E      CPC	R25,R30
    0537F F49C      BGE	0x5393
    05380 84CC      LDD	R12,Y+12
    05381 84DD      LDD	R13,Y+13
    05382 01C6      MOVW	R24,R12
    05383 9601      ADIW	R24,1
    05384 879D      STD	Y+13,R25
    05385 878C      STD	Y+12,R24
    05386 01F6      MOVW	R30,R12
    05387 A40C      LDD	R0,Y+44
    05388 A41D      LDD	R1,Y+45
    05389 0DE0      ADD	R30,R0
    0538A 1DF1      ADC	R31,R1
    0538B E28D      LDI	R24,0x2D
    0538C 8380      ST	Z,R24
    0538D 8C0F      LDD	R0,Y+31
    0538E A018      LDD	R1,Y+32
    0538F 9400      COM	R0
    05390 9410      COM	R1
    05391 A218      STD	Y+32,R1
    05392 8E0F      STD	Y+31,R0
    05393 E08A      LDI	R24,0xA
    05394 E090      LDI	R25,0
    05395 8399      STD	Y+1,R25
    05396 8388      ST	Y,R24
    05397 8D2F      LDD	R18,Y+31
    05398 A138      LDD	R19,Y+32
    05399 850C      LDD	R16,Y+12
    0539A 851D      LDD	R17,Y+13
    0539B A40C      LDD	R0,Y+44
    0539C A41D      LDD	R1,Y+45
    0539D 0D00      ADD	R16,R0
    0539E 1D11      ADC	R17,R1
    0539F 940E 4C9C CALL	_itoa
    053A1 2400      CLR	R0
    053A2 2411      CLR	R1
    053A3 861D      STD	Y+13,R1
    053A4 860C      STD	Y+12,R0
    053A5 85EC      LDD	R30,Y+12
    053A6 85FD      LDD	R31,Y+13
    053A7 A40C      LDD	R0,Y+44
    053A8 A41D      LDD	R1,Y+45
    053A9 0DE0      ADD	R30,R0
    053AA 1DF1      ADC	R31,R1
    053AB 8020      LD	R2,Z
    053AC 2022      TST	R2
    053AD F429      BNE	0x53B3
    053AE 840C      LDD	R0,Y+12
    053AF 841D      LDD	R1,Y+13
    053B0 8E1B      STD	Y+27,R1
    053B1 8E0A      STD	Y+26,R0
    053B2 C009      RJMP	0x53BC
    053B3 858C      LDD	R24,Y+12
    053B4 859D      LDD	R25,Y+13
    053B5 9601      ADIW	R24,1
    053B6 879D      STD	Y+13,R25
    053B7 878C      STD	Y+12,R24
    053B8 3184      CPI	R24,0x14
    053B9 E0E0      LDI	R30,0
    053BA 079E      CPC	R25,R30
    053BB F34C      BLT	0x53A5
    053BC A80C      LDD	R0,Y+52
    053BD A81D      LDD	R1,Y+53
    053BE FE02      SBRS	R0,2
    053BF C021      RJMP	0x53E1
    053C0 8C0A      LDD	R0,Y+26
    053C1 8C1B      LDD	R1,Y+27
    053C2 A90E      LDD	R16,Y+54
    053C3 A91F      LDD	R17,Y+55
    053C4 1600      CP	R0,R16
    053C5 0611      CPC	R1,R17
    053C6 F00C      BLT	0x53C8
    053C7 C18F      RJMP	0x5557
    053C8 01A0      MOVW	R20,R0
    053C9 C009      RJMP	0x53D3
    053CA 01FA      MOVW	R30,R20
    053CB A40C      LDD	R0,Y+44
    053CC A41D      LDD	R1,Y+45
    053CD 0DE0      ADD	R30,R0
    053CE 1DF1      ADC	R31,R1
    053CF 8C0C      LDD	R0,Y+28
    053D0 8200      ST	Z,R0
    053D1 5F4F      SUBI	R20,0xFF
    053D2 4F5F      SBCI	R21,0xFF
    053D3 A80E      LDD	R0,Y+54
    053D4 A81F      LDD	R1,Y+55
    053D5 1540      CP	R20,R0
    053D6 0551      CPC	R21,R1
    053D7 F394      BLT	0x53CA
    053D8 01F0      MOVW	R30,R0
    053D9 9731      SBIW	R30,1
    053DA A40C      LDD	R0,Y+44
    053DB A41D      LDD	R1,Y+45
    053DC 0DE0      ADD	R30,R0
    053DD 1DF1      ADC	R31,R1
    053DE 2422      CLR	R2
    053DF 8220      ST	Z,R2
    053E0 C176      RJMP	0x5557
    053E1 8C0A      LDD	R0,Y+26
    053E2 8C1B      LDD	R1,Y+27
    053E3 A90E      LDD	R16,Y+54
    053E4 A91F      LDD	R17,Y+55
    053E5 1600      CP	R0,R16
    053E6 0611      CPC	R1,R17
    053E7 F00C      BLT	0x53E9
    053E8 C16E      RJMP	0x5557
    053E9 01A0      MOVW	R20,R0
    053EA C014      RJMP	0x53FF
    053EB 01FA      MOVW	R30,R20
    053EC A80E      LDD	R0,Y+54
    053ED A81F      LDD	R1,Y+55
    053EE 0DE0      ADD	R30,R0
    053EF 1DF1      ADC	R31,R1
    053F0 8C0A      LDD	R0,Y+26
    053F1 8C1B      LDD	R1,Y+27
    053F2 19E0      SUB	R30,R0
    053F3 09F1      SBC	R31,R1
    053F4 A40C      LDD	R0,Y+44
    053F5 A41D      LDD	R1,Y+45
    053F6 0DE0      ADD	R30,R0
    053F7 1DF1      ADC	R31,R1
    053F8 01DA      MOVW	R26,R20
    053F9 0DA0      ADD	R26,R0
    053FA 1DB1      ADC	R27,R1
    053FB 902C      LD	R2,X
    053FC 8220      ST	Z,R2
    053FD 5041      SUBI	R20,1
    053FE 4050      SBCI	R21,0
    053FF 3040      CPI	R20,0
    05400 E0E0      LDI	R30,0
    05401 075E      CPC	R21,R30
    05402 F744      BGE	0x53EB
    05403 A94E      LDD	R20,Y+54
    05404 A95F      LDD	R21,Y+55
    05405 8C0A      LDD	R0,Y+26
    05406 8C1B      LDD	R1,Y+27
    05407 1940      SUB	R20,R0
    05408 0951      SBC	R21,R1
    05409 5041      SUBI	R20,1
    0540A 4050      SBCI	R21,0
    0540B C009      RJMP	0x5415
    0540C 01FA      MOVW	R30,R20
    0540D A40C      LDD	R0,Y+44
    0540E A41D      LDD	R1,Y+45
    0540F 0DE0      ADD	R30,R0
    05410 1DF1      ADC	R31,R1
    05411 880F      LDD	R0,Y+23
    05412 8200      ST	Z,R0
    05413 5041      SUBI	R20,1
    05414 4050      SBCI	R21,0
    05415 3040      CPI	R20,0
    05416 E0E0      LDI	R30,0
    05417 075E      CPC	R21,R30
    05418 F79C      BGE	0x540C
    05419 A80C      LDD	R0,Y+52
    0541A A81D      LDD	R1,Y+53
    0541B FE04      SBRS	R0,4
    0541C C13A      RJMP	0x5557
    0541D 880C      LDD	R0,Y+20
    0541E 890F      LDD	R16,Y+23
    0541F 1600      CP	R0,R16
    05420 F409      BNE	0x5422
    05421 C135      RJMP	0x5557
    05422 A5EC      LDD	R30,Y+44
    05423 A5FD      LDD	R31,Y+45
    05424 8200      ST	Z,R0
    05425 A9EE      LDD	R30,Y+54
    05426 A9FF      LDD	R31,Y+55
    05427 8C0A      LDD	R0,Y+26
    05428 8C1B      LDD	R1,Y+27
    05429 19E0      SUB	R30,R0
    0542A 09F1      SBC	R31,R1
    0542B A40C      LDD	R0,Y+44
    0542C A41D      LDD	R1,Y+45
    0542D 0DE0      ADD	R30,R0
    0542E 1DF1      ADC	R31,R1
    0542F 2E00      MOV	R0,R16
    05430 8200      ST	Z,R0
    05431 C125      RJMP	0x5557
    05432 A80C      LDD	R0,Y+52
    05433 A81D      LDD	R1,Y+53
    05434 FE00      SBRS	R0,0
    05435 C010      RJMP	0x5446
    05436 882A      LDD	R2,Y+18
    05437 883B      LDD	R3,Y+19
    05438 AC08      LDD	R0,Y+56
    05439 AC19      LDD	R1,Y+57
    0543A 0C20      ADD	R2,R0
    0543B 1C31      ADC	R3,R1
    0543C 142A      CP	R2,R10
    0543D 043B      CPC	R3,R11
    0543E F07C      BLT	0x544E
    0543F 898A      LDD	R24,Y+18
    05440 899B      LDD	R25,Y+19
    05441 0D80      ADD	R24,R0
    05442 1D91      ADC	R25,R1
    05443 9601      ADIW	R24,1
    05444 015C      MOVW	R10,R24
    05445 C008      RJMP	0x544E
    05446 898A      LDD	R24,Y+18
    05447 899B      LDD	R25,Y+19
    05448 9601      ADIW	R24,1
    05449 16A8      CP	R10,R24
    0544A 06B9      CPC	R11,R25
    0544B F411      BNE	0x544E
    0544C 88AA      LDD	R10,Y+18
    0544D 88BB      LDD	R11,Y+19
    0544E E184      LDI	R24,0x14
    0544F E090      LDI	R25,0
    05450 158A      CP	R24,R10
    05451 059B      CPC	R25,R11
    05452 F40C      BGE	0x5454
    05453 015C      MOVW	R10,R24
    05454 0115      MOVW	R2,R10
    05455 8808      LDD	R0,Y+16
    05456 8819      LDD	R1,Y+17
    05457 1820      SUB	R2,R0
    05458 0831      SBC	R3,R1
    05459 8E3B      STD	Y+27,R3
    0545A 8E2A      STD	Y+26,R2
    0545B 880C      LDD	R0,Y+20
    0545C 890F      LDD	R16,Y+23
    0545D 1600      CP	R0,R16
    0545E F021      BEQ	0x5463
    0545F 01C1      MOVW	R24,R2
    05460 9601      ADIW	R24,1
    05461 8F9B      STD	Y+27,R25
    05462 8F8A      STD	Y+26,R24
    05463 A80E      LDD	R0,Y+54
    05464 A81F      LDD	R1,Y+55
    05465 8D0A      LDD	R16,Y+26
    05466 8D1B      LDD	R17,Y+27
    05467 1600      CP	R0,R16
    05468 0611      CPC	R1,R17
    05469 F41C      BGE	0x546D
    0546A 0108      MOVW	R0,R16
    0546B AA1F      STD	Y+55,R1
    0546C AA0E      STD	Y+54,R0
    0546D E184      LDI	R24,0x14
    0546E E090      LDI	R25,0
    0546F A80E      LDD	R0,Y+54
    05470 A81F      LDD	R1,Y+55
    05471 1580      CP	R24,R0
    05472 0591      CPC	R25,R1
    05473 F414      BGE	0x5476
    05474 AB9F      STD	Y+55,R25
    05475 AB8E      STD	Y+54,R24
    05476 E184      LDI	R24,0x14
    05477 E090      LDI	R25,0
    05478 8C0A      LDD	R0,Y+26
    05479 8C1B      LDD	R1,Y+27
    0547A 1580      CP	R24,R0
    0547B 0591      CPC	R25,R1
    0547C F414      BGE	0x547F
    0547D 8F9B      STD	Y+27,R25
    0547E 8F8A      STD	Y+26,R24
    0547F A80C      LDD	R0,Y+52
    05480 A81D      LDD	R1,Y+53
    05481 FC02      SBRC	R0,2
    05482 C007      RJMP	0x548A
    05483 A80E      LDD	R0,Y+54
    05484 A81F      LDD	R1,Y+55
    05485 8D0A      LDD	R16,Y+26
    05486 8D1B      LDD	R17,Y+27
    05487 1600      CP	R0,R16
    05488 0611      CPC	R1,R17
    05489 F471      BNE	0x5498
    0548A 24CC      CLR	R12
    0548B 24DD      CLR	R13
    0548C 880C      LDD	R0,Y+20
    0548D 890F      LDD	R16,Y+23
    0548E 1600      CP	R0,R16
    0548F F409      BNE	0x5491
    05490 C033      RJMP	0x54C4
    05491 A5EC      LDD	R30,Y+44
    05492 A5FD      LDD	R31,Y+45
    05493 8200      ST	Z,R0
    05494 E081      LDI	R24,1
    05495 E090      LDI	R25,0
    05496 016C      MOVW	R12,R24
    05497 C02C      RJMP	0x54C4
    05498 A8CE      LDD	R12,Y+54
    05499 A8DF      LDD	R13,Y+55
    0549A 8C0A      LDD	R0,Y+26
    0549B 8C1B      LDD	R1,Y+27
    0549C 18C0      SUB	R12,R0
    0549D 08D1      SBC	R13,R1
    0549E 2744      CLR	R20
    0549F 2755      CLR	R21
    054A0 C009      RJMP	0x54AA
    054A1 01FA      MOVW	R30,R20
    054A2 A40C      LDD	R0,Y+44
    054A3 A41D      LDD	R1,Y+45
    054A4 0DE0      ADD	R30,R0
    054A5 1DF1      ADC	R31,R1
    054A6 880F      LDD	R0,Y+23
    054A7 8200      ST	Z,R0
    054A8 5F4F      SUBI	R20,0xFF
    054A9 4F5F      SBCI	R21,0xFF
    054AA 16C4      CP	R12,R20
    054AB 06D5      CPC	R13,R21
    054AC F7A4      BGE	0x54A1
    054AD 880C      LDD	R0,Y+20
    054AE 890F      LDD	R16,Y+23
    054AF 1600      CP	R0,R16
    054B0 F099      BEQ	0x54C4
    054B1 A80C      LDD	R0,Y+52
    054B2 A81D      LDD	R1,Y+53
    054B3 FE04      SBRS	R0,4
    054B4 C005      RJMP	0x54BA
    054B5 A5EC      LDD	R30,Y+44
    054B6 A5FD      LDD	R31,Y+45
    054B7 880C      LDD	R0,Y+20
    054B8 8200      ST	Z,R0
    054B9 C007      RJMP	0x54C1
    054BA 01F6      MOVW	R30,R12
    054BB A40C      LDD	R0,Y+44
    054BC A41D      LDD	R1,Y+45
    054BD 0DE0      ADD	R30,R0
    054BE 1DF1      ADC	R31,R1
    054BF 880C      LDD	R0,Y+20
    054C0 8200      ST	Z,R0
    054C1 01C6      MOVW	R24,R12
    054C2 9601      ADIW	R24,1
    054C3 016C      MOVW	R12,R24
    054C4 01A6      MOVW	R20,R12
    054C5 8C08      LDD	R0,Y+24
    054C6 8C19      LDD	R1,Y+25
    054C7 2000      TST	R0
    054C8 F459      BNE	0x54D4
    054C9 2011      TST	R1
    054CA F449      BNE	0x54D4
    054CB 01FA      MOVW	R30,R20
    054CC A40C      LDD	R0,Y+44
    054CD A41D      LDD	R1,Y+45
    054CE 0DE0      ADD	R30,R0
    054CF 1DF1      ADC	R31,R1
    054D0 E380      LDI	R24,0x30
    054D1 8380      ST	Z,R24
    054D2 5F4F      SUBI	R20,0xFF
    054D3 4F5F      SBCI	R21,0xFF
    054D4 2400      CLR	R0
    054D5 2411      CLR	R1
    054D6 861D      STD	Y+13,R1
    054D7 860C      STD	Y+12,R0
    054D8 C016      RJMP	0x54EF
    054D9 842C      LDD	R2,Y+12
    054DA 843D      LDD	R3,Y+13
    054DB 0E26      ADD	R2,R22
    054DC 1E37      ADC	R3,R23
    054DD 89E8      LDD	R30,Y+16
    054DE 89F9      LDD	R31,Y+17
    054DF 0DE2      ADD	R30,R2
    054E0 1DF3      ADC	R31,R3
    054E1 8020      LD	R2,Z
    054E2 01FA      MOVW	R30,R20
    054E3 A40C      LDD	R0,Y+44
    054E4 A41D      LDD	R1,Y+45
    054E5 0DE0      ADD	R30,R0
    054E6 1DF1      ADC	R31,R1
    054E7 8220      ST	Z,R2
    054E8 5F4F      SUBI	R20,0xFF
    054E9 4F5F      SBCI	R21,0xFF
    054EA 858C      LDD	R24,Y+12
    054EB 859D      LDD	R25,Y+13
    054EC 9601      ADIW	R24,1
    054ED 879D      STD	Y+13,R25
    054EE 878C      STD	Y+12,R24
    054EF 840C      LDD	R0,Y+12
    054F0 841D      LDD	R1,Y+13
    054F1 8D08      LDD	R16,Y+24
    054F2 8D19      LDD	R17,Y+25
    054F3 1600      CP	R0,R16
    054F4 0611      CPC	R1,R17
    054F5 F31C      BLT	0x54D9
    054F6 880A      LDD	R0,Y+18
    054F7 881B      LDD	R1,Y+19
    054F8 140A      CP	R0,R10
    054F9 041B      CPC	R1,R11
    054FA F44C      BGE	0x5504
    054FB 01FA      MOVW	R30,R20
    054FC A40C      LDD	R0,Y+44
    054FD A41D      LDD	R1,Y+45
    054FE 0DE0      ADD	R30,R0
    054FF 1DF1      ADC	R31,R1
    05500 E28E      LDI	R24,0x2E
    05501 8380      ST	Z,R24
    05502 5F4F      SUBI	R20,0xFF
    05503 4F5F      SBCI	R21,0xFF
    05504 2400      CLR	R0
    05505 2411      CLR	R1
    05506 861D      STD	Y+13,R1
    05507 860C      STD	Y+12,R0
    05508 C02C      RJMP	0x5535
    05509 882D      LDD	R2,Y+21
    0550A 883E      LDD	R3,Y+22
    0550B 840E      LDD	R0,Y+14
    0550C 841F      LDD	R1,Y+15
    0550D 1820      SUB	R2,R0
    0550E 0831      SBC	R3,R1
    0550F 840C      LDD	R0,Y+12
    05510 841D      LDD	R1,Y+13
    05511 1402      CP	R0,R2
    05512 0413      CPC	R1,R3
    05513 F47C      BGE	0x5523
    05514 0110      MOVW	R2,R0
    05515 0E26      ADD	R2,R22
    05516 1E37      ADC	R3,R23
    05517 85EE      LDD	R30,Y+14
    05518 85FF      LDD	R31,Y+15
    05519 0DE2      ADD	R30,R2
    0551A 1DF3      ADC	R31,R3
    0551B 8021      LDD	R2,Z+1
    0551C 01FA      MOVW	R30,R20
    0551D A40C      LDD	R0,Y+44
    0551E A41D      LDD	R1,Y+45
    0551F 0DE0      ADD	R30,R0
    05520 1DF1      ADC	R31,R1
    05521 8220      ST	Z,R2
    05522 C00B      RJMP	0x552E
    05523 A80C      LDD	R0,Y+52
    05524 A81D      LDD	R1,Y+53
    05525 FE00      SBRS	R0,0
    05526 C024      RJMP	0x554B
    05527 01FA      MOVW	R30,R20
    05528 A40C      LDD	R0,Y+44
    05529 A41D      LDD	R1,Y+45
    0552A 0DE0      ADD	R30,R0
    0552B 1DF1      ADC	R31,R1
    0552C E380      LDI	R24,0x30
    0552D 8380      ST	Z,R24
    0552E 5F4F      SUBI	R20,0xFF
    0552F 4F5F      SBCI	R21,0xFF
    05530 858C      LDD	R24,Y+12
    05531 859D      LDD	R25,Y+13
    05532 9601      ADIW	R24,1
    05533 879D      STD	Y+13,R25
    05534 878C      STD	Y+12,R24
    05535 840C      LDD	R0,Y+12
    05536 841D      LDD	R1,Y+13
    05537 AD08      LDD	R16,Y+56
    05538 AD19      LDD	R17,Y+57
    05539 1600      CP	R0,R16
    0553A 0611      CPC	R1,R17
    0553B F42C      BGE	0x5541
    0553C 3144      CPI	R20,0x14
    0553D E0E0      LDI	R30,0
    0553E 075E      CPC	R21,R30
    0553F F40C      BGE	0x5541
    05540 CFC8      RJMP	0x5509
    05541 C009      RJMP	0x554B
    05542 01FA      MOVW	R30,R20
    05543 A40C      LDD	R0,Y+44
    05544 A41D      LDD	R1,Y+45
    05545 0DE0      ADD	R30,R0
    05546 1DF1      ADC	R31,R1
    05547 8C0C      LDD	R0,Y+28
    05548 8200      ST	Z,R0
    05549 5F4F      SUBI	R20,0xFF
    0554A 4F5F      SBCI	R21,0xFF
    0554B A80E      LDD	R0,Y+54
    0554C A81F      LDD	R1,Y+55
    0554D 1540      CP	R20,R0
    0554E 0551      CPC	R21,R1
    0554F F394      BLT	0x5542
    05550 01FA      MOVW	R30,R20
    05551 A40C      LDD	R0,Y+44
    05552 A41D      LDD	R1,Y+45
    05553 0DE0      ADD	R30,R0
    05554 1DF1      ADC	R31,R1
    05555 2422      CLR	R2
    05556 8220      ST	Z,R2
    05557 A50C      LDD	R16,Y+44
    05558 A51D      LDD	R17,Y+45
    05559 96A2      ADIW	R28,0x22
    0555A 940E 48A8 CALL	pop_xgsetF0FC
    0555C 9624      ADIW	R28,4
    0555D 9508      RET
