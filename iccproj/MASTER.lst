Interrupt Vectors
    00000 940C 03C5 JMP	__text_start|__start
    0003C 940C 3D4E JMP	_uart1_rx_isr

Program Code (text area)
__text_start|__start:
    003C5 EFCF      LDI	R28,0xFF
    003C6 E1D0      LDI	R29,0x10
    003C7 BFCD      OUT	0x3D,R28
    003C8 BFDE      OUT	0x3E,R29
    003C9 50C0      SUBI	R28,0
    003CA 40D1      SBCI	R29,1
    003CB EA0A      LDI	R16,0xAA
    003CC 8308      ST	Y,R16
    003CD 2400      CLR	R0
    003CE E1E9      LDI	R30,0x19
    003CF E0F6      LDI	R31,6
    003D0 E019      LDI	R17,0x9
    003D1 37EE      CPI	R30,0x7E
    003D2 07F1      CPC	R31,R17
    003D3 F011      BEQ	0x03D6
    003D4 9201      ST	Z+,R0
    003D5 CFFB      RJMP	0x03D1
    003D6 8300      ST	Z,R16
    003D7 E7E0      LDI	R30,0x70
    003D8 E0F2      LDI	R31,2
    003D9 E0A0      LDI	R26,0
    003DA E0B1      LDI	R27,1
    003DB E017      LDI	R17,7
    003DC E000      LDI	R16,0
    003DD BF0B      OUT	0x3B,R16
    003DE 38E9      CPI	R30,0x89
    003DF 07F1      CPC	R31,R17
    003E0 F021      BEQ	0x03E5
    003E1 95C8      LPM
    003E2 9631      ADIW	R30,1
    003E3 920D      ST	X+,R0
    003E4 CFF9      RJMP	0x03DE
    003E5 940E 042E CALL	_main
_exit:
    003E7 CFFF      RJMP	_exit
FILE: D:\LQD\software\software_src\main.c
(0001) #include "config.h"
(0002) #define  N_per_Second  (2.72*60)
(0003) const char tab[]="\t\0";
(0004) const char enter[]="\n\0";
(0005) char buffer[512];
(0006) char TempChar[80]; //存放临时字串
(0007) struct DATA Result;
(0008) struct tm t;
(0009) unsigned long now =0; 
(0010) void debug(UINT8 *str,UINT8 val);
(0011) void WriteSDFile(void);
(0012) struct CONFIG config;
(0013) void initDevices(void){
(0014)      CLI();
_initDevices:
    003E8 94F8      BCLR	7
(0015) 	 DDRA=0XFF;
    003E9 EF8F      LDI	R24,0xFF
    003EA BB8A      OUT	0x1A,R24
(0016) 	 PORTA=0XFF;
    003EB BB8B      OUT	0x1B,R24
(0017) 	 DDRB=0XFF;
    003EC BB87      OUT	0x17,R24
(0018) 	 PORTB=0XFF; 	 
    003ED BB88      OUT	0x18,R24
(0019) 	 DDRC=0XFF;
    003EE BB84      OUT	0x14,R24
(0020) 	 PORTC=0XFF;
    003EF BB85      OUT	0x15,R24
(0021) 	 DDRG=0XFF;
    003F0 9380 0064 STS	0x64,R24
(0022) 	 PORTG=0XFF;	 
    003F2 9380 0065 STS	0x65,R24
(0023) 	 SPI_IO_Init(); 
    003F4 940E 3F3E CALL	_SPI_IO_Init
(0024) 	 SD_Init();
    003F6 940E 2DB9 CALL	_SD_Init
(0025) 	 uart1_init();
    003F8 940E 3D3D CALL	_uart1_init
(0026) 	 LCD_INT();delayms(50);LCD_INT();
    003FA 940E 3F5C CALL	_LCD_INT
    003FC E302      LDI	R16,0x32
    003FD E010      LDI	R17,0
    003FE 940E 2D70 CALL	_delayms
    00400 940E 3F5C CALL	_LCD_INT
(0027) 	 LCD_SW(1);
    00402 E001      LDI	R16,1
    00403 940E 3F52 CALL	_LCD_SW
(0028) 	 config.comCmd = 0; //无上位机命令
    00405 2422      CLR	R2
    00406 9220 08F2 STS	config+21,R2
(0029) 	 config.THRESHOLD_delta_sec=60; //一次检测用时
    00408 E38C      LDI	R24,0x3C
    00409 9380 08E0 STS	config+3,R24
    0040B E080      LDI	R24,0
    0040C 9380 08E1 STS	config+4,R24
    0040E 9380 08E2 STS	config+5,R24
    00410 9380 08E3 STS	config+6,R24
(0030) 	 config.heatThreshold = 5; //继电器开启温度 
    00412 E085      LDI	R24,5
    00413 9380 08F0 STS	config+19,R24
(0031) 	 config.checkDeltaTime=20;  //自动检测模式 时间间隔	 
    00415 E184      LDI	R24,0x14
    00416 E090      LDI	R25,0
    00417 9390 08EE STS	config+17,R25
    00419 9380 08ED STS	config+16,R24
(0032) 	 config.autocheck=1;        //自动检测开关
    0041B E081      LDI	R24,1
    0041C 9380 08EC STS	config+15,R24
(0033) 	 config.readMode = 0;      //读数据模式
    0041E 9220 08EF STS	config+18,R2
(0034) 	 config.autoSend = 1; //zigbee发送开关，不为0时，使能发送
    00420 9380 08F1 STS	config+20,R24
(0035) 	 config.Sd = 1;      //Sd存储开关， 不为0时，使能存储
    00422 9380 08DD STS	config,R24
(0036) 	 #ifdef _FOR_FAST_TEST
(0037) 	 config.THRESHOLD_delta_sec=5; //一次检测用时
(0038) 	 config.heatThreshold = 20; //继电器开启温度 
(0039) 	 config.checkDeltaTime=5;  //自动检测模式 时间间隔	 
(0040) 	 #endif
(0041) 	 
(0042) 	 SEI();
    00424 9478      BSET	7
    00425 9508      RET
(0043) }
(0044) void timer1_init(void)
(0045) {
(0046)  TCCR1B = 0x00; //stop
_timer1_init:
    00426 2422      CLR	R2
    00427 BC2E      OUT	0x2E,R2
(0047)  TCNT1H = 0x00 /*INVALID SETTING*/; //setup
    00428 BC2D      OUT	0x2D,R2
(0048)  TCNT1L = 0x00 /*INVALID SETTING*/;
    00429 BC2C      OUT	0x2C,R2
(0049)  TCCR1A = 0x00;
    0042A BC2F      OUT	0x2F,R2
(0050)  TCCR1B = 0x46; //start Timer
    0042B E486      LDI	R24,0x46
    0042C BD8E      OUT	0x2E,R24
    0042D 9508      RET
_main:
  keycode              --> Y,+1
  i                    --> R10
  filename             --> Y,+513
  buf512               --> Y,+0
  tmp                  --> R10
    0042E 97EF      SBIW	R28,0x3F
    0042F 97EF      SBIW	R28,0x3F
    00430 97EF      SBIW	R28,0x3F
    00431 97EF      SBIW	R28,0x3F
    00432 97EF      SBIW	R28,0x3F
    00433 97EF      SBIW	R28,0x3F
    00434 97EF      SBIW	R28,0x3F
    00435 97EF      SBIW	R28,0x3F
    00436 9767      SBIW	R28,0x17
(0051) }
(0052) ////////////////////////////////////////////////////////////////
(0053) void main(void){
(0054) 	 UINT8 tmp,keycode;
(0055) 	 UINT8 buf512[513];
(0056) 	 char filename[]="201301.xls\0\0\0";
    00437 E08A      LDI	R24,0xA
    00438 E091      LDI	R25,1
    00439 01FE      MOVW	R30,R28
    0043A 5FEF      SUBI	R30,0xFF
    0043B 4FFD      SBCI	R31,0xFD
    0043C E00E      LDI	R16,0xE
    0043D E010      LDI	R17,0
    0043E 93FA      ST	-Y,R31
    0043F 93EA      ST	-Y,R30
    00440 939A      ST	-Y,R25
    00441 938A      ST	-Y,R24
    00442 940E 4C5B CALL	asgnblk
(0057) 	 int i=0;
    00444 24AA      CLR	R10
    00445 24BB      CLR	R11
(0058) 	 initDevices();
    00446 DFA1      RCALL	_initDevices
(0059) 	 dateRefresh(1);
    00447 E001      LDI	R16,1
    00448 940E 39E7 CALL	_dateRefresh
(0060) 	 WriteFileHead();
    0044A D16C      RCALL	_WriteFileHead
(0061)      Result.Index=findIndex(get_name(filename),buf512);
    0044B 018E      MOVW	R16,R28
    0044C 5F0F      SUBI	R16,0xFF
    0044D 4F1D      SBCI	R17,0xFD
    0044E D6BC      RCALL	_get_name
    0044F 019E      MOVW	R18,R28
    00450 D2E1      RCALL	_findIndex
    00451 0118      MOVW	R2,R16
    00452 2444      CLR	R4
    00453 2455      CLR	R5
    00454 9230 0676 STS	Result+11,R3
    00456 9220 0675 STS	Result+10,R2
    00458 9250 0678 STS	Result+13,R5
    0045A 9240 0677 STS	Result+12,R4
(0062) 	 #ifdef _DBG_RD_  
(0063) 	 	 while(1){
(0064) 		     GUI_readback(buf512);
(0065) 	     }
(0066) 	 #endif
(0067) 	 //selfTest();
(0068) 	 GUI_welcome();
    0045C 940E 39CA CALL	_GUI_welcome
    0045E C025      RJMP	0x0484
(0069) 	 /* //FOR DEBUG
(0070) 	 while(alwaysCheck())
(0071) 	 {
(0072) 	   delayms(100);dateRefresh(1);StructToChar();
(0073) 	   check();
(0074) 	   zigbee_send_date();
(0075) 	 }
(0076) 	  */
(0077) 	 while(alwaysCheck()){
(0078) 	    tmp=GUI_mainmeu();
    0045F 940E 2F92 CALL	_GUI_mainmeu
    00461 2EA0      MOV	R10,R16
(0079) 		
(0080) 		switch(tmp){
    00462 2D4A      MOV	R20,R10
    00463 2755      CLR	R21
    00464 3043      CPI	R20,3
    00465 E0E0      LDI	R30,0
    00466 075E      CPC	R21,R30
    00467 F069      BEQ	0x0475
    00468 3044      CPI	R20,4
    00469 E0E0      LDI	R30,0
    0046A 075E      CPC	R21,R30
    0046B F061      BEQ	0x0478
    0046C 3045      CPI	R20,5
    0046D E0E0      LDI	R30,0
    0046E 075E      CPC	R21,R30
    0046F F059      BEQ	0x047B
    00470 3047      CPI	R20,7
    00471 E0E0      LDI	R30,0
    00472 075E      CPC	R21,R30
    00473 F059      BEQ	0x047F
    00474 C00B      RJMP	0x0480
(0081) 		    case 3 : GUI_check(); break; 
    00475 940E 308F CALL	_GUI_check
    00477 C008      RJMP	0x0480
(0082) 			case 4 : GUI_set_time(); break ;
    00478 940E 35CA CALL	_GUI_set_time
    0047A C005      RJMP	0x0480
(0083) 			case 5 : GUI_readback(buf512); break;
    0047B 018E      MOVW	R16,R28
    0047C 940E 381F CALL	_GUI_readback
    0047E C001      RJMP	0x0480
(0084) 			//case 6 : GUI_send_date();
(0085) 			case 7 : selfTest(); break ;
    0047F D05A      RCALL	_selfTest
(0086) 			default : break;
(0087) 	   }
(0088) 	   delayms(100);
    00480 E604      LDI	R16,0x64
    00481 E010      LDI	R17,0
    00482 940E 2D70 CALL	_delayms
    00484 D00D      RCALL	_alwaysCheck
    00485 2EA0      MOV	R10,R16
    00486 2300      TST	R16
    00487 F6B9      BNE	0x045F
    00488 96EF      ADIW	R28,0x3F
    00489 96EF      ADIW	R28,0x3F
    0048A 96EF      ADIW	R28,0x3F
    0048B 96EF      ADIW	R28,0x3F
    0048C 96EF      ADIW	R28,0x3F
    0048D 96EF      ADIW	R28,0x3F
    0048E 96EF      ADIW	R28,0x3F
    0048F 96EF      ADIW	R28,0x3F
    00490 9667      ADIW	R28,0x17
    00491 9508      RET
_alwaysCheck:
  temp                 --> Y,+0
    00492 940E 4BCA CALL	push_xgsetF00C
    00494 9724      SBIW	R28,4
(0089) 	 }
(0090) }
(0091) char alwaysCheck(void)
(0092) {
(0093)  static unsigned long last5s=0;
(0094)  static unsigned long next_sample_time = 0;
(0095)  float temp;
(0096)  RecDeal(); //zigbee data deal
    00495 940E 3BB3 CALL	_RecDeal
(0097)  //间隔5s 背温检测,发送本机ID
(0098)  if(config.now>last5s)
    00497 9040 011A LDS	R4,main.c:last5s+2
    00499 9050 011B LDS	R5,main.c:last5s+3
    0049B 9020 0118 LDS	R2,main.c:last5s
    0049D 9030 0119 LDS	R3,main.c:last5s+1
    0049F 9080 08EA LDS	R8,config+13
    004A1 9090 08EB LDS	R9,config+14
    004A3 9060 08E8 LDS	R6,config+11
    004A5 9070 08E9 LDS	R7,config+12
    004A7 1426      CP	R2,R6
    004A8 0437      CPC	R3,R7
    004A9 0448      CPC	R4,R8
    004AA 0459      CPC	R5,R9
    004AB F550      BCC	0x04D6
(0099)  {   
(0100)  	 last5s=config.now+5;
    004AC E045      LDI	R20,5
    004AD E050      LDI	R21,0
    004AE E060      LDI	R22,0
    004AF E070      LDI	R23,0
    004B0 0113      MOVW	R2,R6
    004B1 0124      MOVW	R4,R8
    004B2 0E24      ADD	R2,R20
    004B3 1E35      ADC	R3,R21
    004B4 1E46      ADC	R4,R22
    004B5 1E57      ADC	R5,R23
    004B6 9230 0119 STS	main.c:last5s+1,R3
    004B8 9220 0118 STS	main.c:last5s,R2
    004BA 9250 011B STS	main.c:last5s+3,R5
    004BC 9240 011A STS	main.c:last5s+2,R4
(0101) 	 zigbee_send_id(); //发送本机ID
    004BE 940E 3D34 CALL	_zigbee_send_id
(0102)      temp= readWithoutDelay(INSIDE_SENSOR);
    004C0 2700      CLR	R16
    004C1 940E 44D9 CALL	_readWithoutDelay
    004C3 8308      ST	Y,R16
    004C4 8319      STD	Y+1,R17
    004C5 832A      STD	Y+2,R18
    004C6 833B      STD	Y+3,R19
(0103)      if (temp>config.heatThreshold) {
    004C7 01CE      MOVW	R24,R28
    004C8 9100 08F0 LDS	R16,config+19
    004CA 2711      CLR	R17
    004CB 940E 4D56 CALL	int2fp
    004CD 939A      ST	-Y,R25
    004CE 938A      ST	-Y,R24
    004CF 940E 4F20 CALL	fpcmp1
    004D1 F41C      BGE	0x04D5
(0104)  	     RELAY_OFF(); //debug("off=",(int)temp);
    004D2 98AD      CBI	0x15,5
(0105) 		 return 1;
    004D3 E001      LDI	R16,1
    004D4 C002      RJMP	0x04D7
(0106)  	 }
(0107)      else  {
(0108)    	     RELAY_ON();//debug("on=",(int)temp);
    004D5 9AAD      SBI	0x15,5
(0109) 	 } 
(0110)  }
(0111)  
(0112)  
(0113)  return 1;
    004D6 E001      LDI	R16,1
    004D7 9624      ADIW	R28,4
    004D8 940C 4BD1 JMP	pop_xgsetF00C
_selfTest:
  str2                 --> Y,+14
  str1                 --> Y,+8
  tmp                  --> Y,+4
    004DA 9764      SBIW	R28,0x14
(0114) }
(0115) void selfTest(void){
(0116) 	float tmp=0;                                                                
    004DB ED08      LDI	R16,0xD8
    004DC E010      LDI	R17,0
    004DD 940E 4B33 CALL	elpm32
    004DF 830C      STD	Y+4,R16
    004E0 831D      STD	Y+5,R17
    004E1 832E      STD	Y+6,R18
    004E2 833F      STD	Y+7,R19
(0117) 	char str1[6],str2[6];
(0118) 	lp("┌──────┐");
    004E3 E60A      LDI	R16,0x6A
    004E4 E012      LDI	R17,2
    004E5 940E 428B CALL	_lp
(0119) 	lp("│  自检程序  │");
    004E7 E509      LDI	R16,0x59
    004E8 E012      LDI	R17,2
    004E9 940E 428B CALL	_lp
(0120) 	lp("│            │");
    004EB E408      LDI	R16,0x48
    004EC E012      LDI	R17,2
    004ED 940E 428B CALL	_lp
(0121) 	lp("└──────┘");
    004EF E307      LDI	R16,0x37
    004F0 E012      LDI	R17,2
    004F1 940E 428B CALL	_lp
(0122) 	 //自检程序
(0123) 	delayms(500);
    004F3 EF04      LDI	R16,0xF4
    004F4 E011      LDI	R17,1
    004F5 940E 2D70 CALL	_delayms
(0124) 	lp("外部温度 ");
    004F7 E20D      LDI	R16,0x2D
    004F8 E012      LDI	R17,2
    004F9 940E 428B CALL	_lp
(0125) 	tmp=read_T_NUM(OUTSIDE_SENSOR);
    004FB E001      LDI	R16,1
    004FC 940E 44BB CALL	_read_T_NUM
    004FE 830C      STD	Y+4,R16
    004FF 831D      STD	Y+5,R17
    00500 832E      STD	Y+6,R18
    00501 833F      STD	Y+7,R19
(0126) 	sprintf(str1,"%#0.1f",tmp);
    00502 802C      LDD	R2,Y+4
    00503 803D      LDD	R3,Y+5
    00504 804E      LDD	R4,Y+6
    00505 805F      LDD	R5,Y+7
    00506 8228      ST	Y,R2
    00507 8239      STD	Y+1,R3
    00508 824A      STD	Y+2,R4
    00509 825B      STD	Y+3,R5
    0050A E226      LDI	R18,0x26
    0050B E032      LDI	R19,2
    0050C 018E      MOVW	R16,R28
    0050D 5F08      SUBI	R16,0xF8
    0050E 4F1F      SBCI	R17,0xFF
    0050F 940E 5328 CALL	_sprintf
(0127) 	str1[6]=0;
    00511 2422      CLR	R2
    00512 862E      STD	Y+14,R2
(0128) 	lp(str1);
    00513 018E      MOVW	R16,R28
    00514 5F08      SUBI	R16,0xF8
    00515 4F1F      SBCI	R17,0xFF
    00516 940E 428B CALL	_lp
(0129) 	delayms(500);
    00518 EF04      LDI	R16,0xF4
    00519 E011      LDI	R17,1
    0051A 940E 2D70 CALL	_delayms
(0130) 	lp("内部温度");
    0051C E10D      LDI	R16,0x1D
    0051D E012      LDI	R17,2
    0051E 940E 428B CALL	_lp
(0131) 	tmp=read_T_NUM(INSIDE_SENSOR);
    00520 2700      CLR	R16
    00521 940E 44BB CALL	_read_T_NUM
    00523 830C      STD	Y+4,R16
    00524 831D      STD	Y+5,R17
    00525 832E      STD	Y+6,R18
    00526 833F      STD	Y+7,R19
(0132) 	sprintf(str2,"%#0.1f",tmp);
    00527 802C      LDD	R2,Y+4
    00528 803D      LDD	R3,Y+5
    00529 804E      LDD	R4,Y+6
    0052A 805F      LDD	R5,Y+7
    0052B 8228      ST	Y,R2
    0052C 8239      STD	Y+1,R3
    0052D 824A      STD	Y+2,R4
    0052E 825B      STD	Y+3,R5
    0052F E226      LDI	R18,0x26
    00530 E032      LDI	R19,2
    00531 018E      MOVW	R16,R28
    00532 5F02      SUBI	R16,0xF2
    00533 4F1F      SBCI	R17,0xFF
    00534 940E 5328 CALL	_sprintf
(0133) 	str2[6]=0;
    00536 2422      CLR	R2
    00537 8A2C      STD	Y+20,R2
(0134) 	lp(str2);
    00538 018E      MOVW	R16,R28
    00539 5F02      SUBI	R16,0xF2
    0053A 4F1F      SBCI	R17,0xFF
    0053B 940E 428B CALL	_lp
(0135) 	delayms(500);
    0053D EF04      LDI	R16,0xF4
    0053E E011      LDI	R17,1
    0053F 940E 2D70 CALL	_delayms
(0136) 	lp("风速脉冲：");delayms(500);
    00541 E102      LDI	R16,0x12
    00542 E012      LDI	R17,2
    00543 940E 428B CALL	_lp
    00545 EF04      LDI	R16,0xF4
    00546 E011      LDI	R17,1
    00547 940E 2D70 CALL	_delayms
(0137) 	lp("蜂鸣器"); beep(2,2);delayms(500);
    00549 E00B      LDI	R16,0xB
    0054A E012      LDI	R17,2
    0054B 940E 428B CALL	_lp
    0054D E022      LDI	R18,2
    0054E E002      LDI	R16,2
    0054F 940E 4303 CALL	_beep
    00551 EF04      LDI	R16,0xF4
    00552 E011      LDI	R17,1
    00553 940E 2D70 CALL	_delayms
(0138) 	lp("power 指示灯");
    00555 EF0E      LDI	R16,0xFE
    00556 E011      LDI	R17,1
    00557 940E 428B CALL	_lp
(0139) 	LED_OFF();delayms(100);LED_ON();delayms(100);
    00559 9AA7      SBI	0x14,7
    0055A 98AF      CBI	0x15,7
    0055B E604      LDI	R16,0x64
    0055C E010      LDI	R17,0
    0055D 940E 2D70 CALL	_delayms
    0055F 9AA7      SBI	0x14,7
    00560 9AAF      SBI	0x15,7
    00561 E604      LDI	R16,0x64
    00562 E010      LDI	R17,0
    00563 940E 2D70 CALL	_delayms
(0140) 	LED_OFF();delayms(100);LED_ON();delayms(100);
    00565 9AA7      SBI	0x14,7
    00566 98AF      CBI	0x15,7
    00567 E604      LDI	R16,0x64
    00568 E010      LDI	R17,0
    00569 940E 2D70 CALL	_delayms
    0056B 9AA7      SBI	0x14,7
    0056C 9AAF      SBI	0x15,7
    0056D E604      LDI	R16,0x64
    0056E E010      LDI	R17,0
    0056F 940E 2D70 CALL	_delayms
(0141) 	LED_OFF();delayms(100);LED_ON();delayms(100);
    00571 9AA7      SBI	0x14,7
    00572 98AF      CBI	0x15,7
    00573 E604      LDI	R16,0x64
    00574 E010      LDI	R17,0
    00575 940E 2D70 CALL	_delayms
    00577 9AA7      SBI	0x14,7
    00578 9AAF      SBI	0x15,7
    00579 E604      LDI	R16,0x64
    0057A E010      LDI	R17,0
    0057B 940E 2D70 CALL	_delayms
(0142) 	delayms(500);
    0057D EF04      LDI	R16,0xF4
    0057E E011      LDI	R17,1
    0057F 940E 2D70 CALL	_delayms
(0143) 	lp("加热开关");
    00581 EF05      LDI	R16,0xF5
    00582 E011      LDI	R17,1
    00583 940E 428B CALL	_lp
(0144) 	RELAY_ON();delayms(100);  
    00585 9AAD      SBI	0x15,5
    00586 E604      LDI	R16,0x64
    00587 E010      LDI	R17,0
    00588 940E 2D70 CALL	_delayms
(0145) 	RELAY_OFF();delayms(100);
    0058A 98AD      CBI	0x15,5
    0058B E604      LDI	R16,0x64
    0058C E010      LDI	R17,0
    0058D 940E 2D70 CALL	_delayms
(0146) 	RELAY_ON();delayms(100);
    0058F 9AAD      SBI	0x15,5
    00590 E604      LDI	R16,0x64
    00591 E010      LDI	R17,0
    00592 940E 2D70 CALL	_delayms
(0147) 	RELAY_OFF();delayms(100);
    00594 98AD      CBI	0x15,5
    00595 E604      LDI	R16,0x64
    00596 E010      LDI	R17,0
    00597 940E 2D70 CALL	_delayms
(0148) 	lp("  ");delayms(500);
    00599 EF02      LDI	R16,0xF2
    0059A E011      LDI	R17,1
    0059B 940E 428B CALL	_lp
    0059D EF04      LDI	R16,0xF4
    0059E E011      LDI	R17,1
    0059F 940E 2D70 CALL	_delayms
(0149) 	lp("                ");
    005A1 EE01      LDI	R16,0xE1
    005A2 E011      LDI	R17,1
    005A3 940E 428B CALL	_lp
(0150) 	lp("                ");
    005A5 EE01      LDI	R16,0xE1
    005A6 E011      LDI	R17,1
    005A7 940E 428B CALL	_lp
(0151) 	lp("                ");
    005A9 EE01      LDI	R16,0xE1
    005AA E011      LDI	R17,1
    005AB 940E 428B CALL	_lp
(0152) 	lp("                ");
    005AD EE01      LDI	R16,0xE1
    005AE E011      LDI	R17,1
    005AF 940E 428B CALL	_lp
(0153) 	delayms(100);
    005B1 E604      LDI	R16,0x64
    005B2 E010      LDI	R17,0
    005B3 940E 2D70 CALL	_delayms
    005B5 9664      ADIW	R28,0x14
    005B6 9508      RET
_WriteFileHead:
  fs                   --> Y,+177
  bw                   --> Y,+175
  itam                 --> Y,+52
  fnamep               --> Y,+38
  file                 --> Y,+4
  res                  --> R10
    005B7 940E 4BB1 CALL	push_xgset003C
    005B9 97EF      SBIW	R28,0x3F
    005BA 97EF      SBIW	R28,0x3F
    005BB 97EF      SBIW	R28,0x3F
    005BC 97EF      SBIW	R28,0x3F
    005BD 97EF      SBIW	R28,0x3F
    005BE 97EF      SBIW	R28,0x3F
    005BF 97EF      SBIW	R28,0x3F
    005C0 97EF      SBIW	R28,0x3F
    005C1 97EF      SBIW	R28,0x3F
    005C2 97EF      SBIW	R28,0x3F
    005C3 97EF      SBIW	R28,0x3F
    005C4 97AA      SBIW	R28,0x2A
(0154) 	  
(0155) }
(0156) 
(0157) void WriteFileHead(void)   
(0158) {
(0159)  	 unsigned int bw;
(0160) 	 FRESULT res;
(0161) 	 FATFS fs;
(0162) 	 FIL file;
(0163) 	 char fnamep[]="201201.xls\0\0\0"; 
    005C5 E280      LDI	R24,0x20
    005C6 E091      LDI	R25,1
    005C7 01FE      MOVW	R30,R28
    005C8 96B6      ADIW	R30,0x26
    005C9 E00E      LDI	R16,0xE
    005CA E010      LDI	R17,0
    005CB 93FA      ST	-Y,R31
    005CC 93EA      ST	-Y,R30
    005CD 939A      ST	-Y,R25
    005CE 938A      ST	-Y,R24
    005CF 940E 4C5B CALL	asgnblk
(0164) 	 UINT8 itam[]="DEV000001\t\t\t\t\t\t\t\t\t\t\r\n序号\t日期\t时分\t温度\t风速\t风冷指数\t等价制冷温度\t相当温度\t冻伤危害性\t安静作业\t中等强度作业\t高强度作业\n\0";
    005D1 E28E      LDI	R24,0x2E
    005D2 E091      LDI	R25,1
    005D3 01FE      MOVW	R30,R28
    005D4 96F4      ADIW	R30,0x34
    005D5 E70B      LDI	R16,0x7B
    005D6 E010      LDI	R17,0
    005D7 93FA      ST	-Y,R31
    005D8 93EA      ST	-Y,R30
    005D9 939A      ST	-Y,R25
    005DA 938A      ST	-Y,R24
    005DB 940E 4C5B CALL	asgnblk
(0165) 	 res=disk_initialize(0);
    005DD 2700      CLR	R16
    005DE 940E 0BF6 CALL	_disk_initialize
(0166) 	 res = f_mount(0, &fs);
    005E0 019E      MOVW	R18,R28
    005E1 542F      SUBI	R18,0x4F
    005E2 4F3F      SBCI	R19,0xFF
    005E3 2700      CLR	R16
    005E4 940E 1FE2 CALL	_f_mount
(0167) 	 //get_name(fnamep)
(0168) 	 res = f_open(&file, get_name(fnamep) , FA_OPEN_ALWAYS | FA_WRITE );  //创建一个新的文件
    005E6 018E      MOVW	R16,R28
    005E7 5D0A      SUBI	R16,0xDA
    005E8 4F1F      SBCI	R17,0xFF
    005E9 D521      RCALL	_get_name
    005EA 0168      MOVW	R12,R16
    005EB E182      LDI	R24,0x12
    005EC 8388      ST	Y,R24
    005ED 0196      MOVW	R18,R12
    005EE 018E      MOVW	R16,R28
    005EF 5F0C      SUBI	R16,0xFC
    005F0 4F1F      SBCI	R17,0xFF
    005F1 940E 200D CALL	_f_open
(0169) 	 res = f_write(&file,itam,128,&bw);   //bw 已写入字节数
    005F3 01CE      MOVW	R24,R28
    005F4 5581      SUBI	R24,0x51
    005F5 4F9F      SBCI	R25,0xFF
    005F6 839B      STD	Y+3,R25
    005F7 838A      STD	Y+2,R24
    005F8 E880      LDI	R24,0x80
    005F9 E090      LDI	R25,0
    005FA 8399      STD	Y+1,R25
    005FB 8388      ST	Y,R24
    005FC 019E      MOVW	R18,R28
    005FD 5C2C      SUBI	R18,0xCC
    005FE 4F3F      SBCI	R19,0xFF
    005FF 018E      MOVW	R16,R28
    00600 5F0C      SUBI	R16,0xFC
    00601 4F1F      SBCI	R17,0xFF
    00602 940E 2414 CALL	_f_write
    00604 2EC0      MOV	R12,R16
    00605 2CAC      MOV	R10,R12
(0170) 	 f_close(&file);
    00606 018E      MOVW	R16,R28
    00607 5F0C      SUBI	R16,0xFC
    00608 4F1F      SBCI	R17,0xFF
    00609 940E 27DE CALL	_f_close
(0171) 	 f_mount(0, NULL);
    0060B 2722      CLR	R18
    0060C 2733      CLR	R19
    0060D 2700      CLR	R16
    0060E 940E 1FE2 CALL	_f_mount
    00610 96EF      ADIW	R28,0x3F
    00611 96EF      ADIW	R28,0x3F
    00612 96EF      ADIW	R28,0x3F
    00613 96EF      ADIW	R28,0x3F
    00614 96EF      ADIW	R28,0x3F
    00615 96EF      ADIW	R28,0x3F
    00616 96EF      ADIW	R28,0x3F
    00617 96EF      ADIW	R28,0x3F
    00618 96EF      ADIW	R28,0x3F
    00619 96EF      ADIW	R28,0x3F
    0061A 96EF      ADIW	R28,0x3F
    0061B 96AA      ADIW	R28,0x2A
    0061C 940C 4B8B JMP	pop_xgset003C
_WriteSDFile:
  fnamep               --> Y,+602
  fs                   --> Y,+44
  bw                   --> Y,+42
  lenth                --> Y,+38
  res                  --> R10
  file                 --> Y,+4
    0061E 92AA      ST	-Y,R10
    0061F 92CA      ST	-Y,R12
    00620 97EF      SBIW	R28,0x3F
    00621 97EF      SBIW	R28,0x3F
    00622 97EF      SBIW	R28,0x3F
    00623 97EF      SBIW	R28,0x3F
    00624 97EF      SBIW	R28,0x3F
    00625 97EF      SBIW	R28,0x3F
    00626 97EF      SBIW	R28,0x3F
    00627 97EF      SBIW	R28,0x3F
    00628 97EF      SBIW	R28,0x3F
    00629 97E0      SBIW	R28,0x30
(0172) } /////////////////////////////////////////////////
(0173) //       写入文件函数 
(0174) //(创建)打开文件 
(0175) // data 指向欲写入的的字符串 64byt 
(0176) //////////////////////////////////////////////// 
(0177) void WriteSDFile(void)   
(0178) {
(0179)     unsigned int bw;
(0180) 	FRESULT res;
(0181) 	FATFS fs;
(0182)     FIL file;
(0183) 	char fnamep[13];
(0184) 	long lenth=0;
    0062A E080      LDI	R24,0
    0062B A38E      STD	Y+38,R24
    0062C A38F      STD	Y+39,R24
    0062D A788      STD	Y+40,R24
    0062E A789      STD	Y+41,R24
(0185) 	disk_initialize(0);
    0062F 2700      CLR	R16
    00630 940E 0BF6 CALL	_disk_initialize
(0186) 	res = f_mount(0, &fs);
    00632 019E      MOVW	R18,R28
    00633 5D24      SUBI	R18,0xD4
    00634 4F3F      SBCI	R19,0xFF
    00635 2700      CLR	R16
    00636 940E 1FE2 CALL	_f_mount
(0187) 	res = f_open(&file,get_name(fnamep), FA_OPEN_ALWAYS | FA_WRITE );  //创建一个新的文件
    00638 018E      MOVW	R16,R28
    00639 5A06      SUBI	R16,0xA6
    0063A 4F1D      SBCI	R17,0xFD
    0063B D4CF      RCALL	_get_name
    0063C E182      LDI	R24,0x12
    0063D 8388      ST	Y,R24
    0063E 0198      MOVW	R18,R16
    0063F 018E      MOVW	R16,R28
    00640 5F0C      SUBI	R16,0xFC
    00641 4F1F      SBCI	R17,0xFF
    00642 940E 200D CALL	_f_open
(0188) 	lenth=file.fsize;   
    00644 842E      LDD	R2,Y+14
    00645 843F      LDD	R3,Y+15
    00646 8848      LDD	R4,Y+16
    00647 8859      LDD	R5,Y+17
    00648 A22E      STD	Y+38,R2
    00649 A23F      STD	Y+39,R3
    0064A A648      STD	Y+40,R4
    0064B A659      STD	Y+41,R5
(0189) 	res = f_lseek (&file,lenth);	 
    0064C A02E      LDD	R2,Y+38
    0064D A03F      LDD	R3,Y+39
    0064E A448      LDD	R4,Y+40
    0064F A459      LDD	R5,Y+41
    00650 8248      ST	Y,R4
    00651 8259      STD	Y+1,R5
    00652 0191      MOVW	R18,R2
    00653 018E      MOVW	R16,R28
    00654 5F0C      SUBI	R16,0xFC
    00655 4F1F      SBCI	R17,0xFF
    00656 940E 27EE CALL	_f_lseek
(0190) 	res = f_write(&file,TempChar,SINGLE_ITEM_SIZE,&bw);   //bw 已写入字节数
    00658 01CE      MOVW	R24,R28
    00659 968A      ADIW	R24,0x2A
    0065A 839B      STD	Y+3,R25
    0065B 838A      STD	Y+2,R24
    0065C E480      LDI	R24,0x40
    0065D E090      LDI	R25,0
    0065E 8399      STD	Y+1,R25
    0065F 8388      ST	Y,R24
    00660 E12B      LDI	R18,0x1B
    00661 E036      LDI	R19,6
    00662 018E      MOVW	R16,R28
    00663 5F0C      SUBI	R16,0xFC
    00664 4F1F      SBCI	R17,0xFF
    00665 940E 2414 CALL	_f_write
    00667 2EC0      MOV	R12,R16
    00668 2CAC      MOV	R10,R12
(0191) 	f_close(&file);
    00669 018E      MOVW	R16,R28
    0066A 5F0C      SUBI	R16,0xFC
    0066B 4F1F      SBCI	R17,0xFF
    0066C 940E 27DE CALL	_f_close
(0192) 	f_mount(0, NULL);
    0066E 2722      CLR	R18
    0066F 2733      CLR	R19
    00670 2700      CLR	R16
    00671 940E 1FE2 CALL	_f_mount
    00673 96EF      ADIW	R28,0x3F
    00674 96EF      ADIW	R28,0x3F
    00675 96EF      ADIW	R28,0x3F
    00676 96EF      ADIW	R28,0x3F
    00677 96EF      ADIW	R28,0x3F
    00678 96EF      ADIW	R28,0x3F
    00679 96EF      ADIW	R28,0x3F
    0067A 96EF      ADIW	R28,0x3F
    0067B 96EF      ADIW	R28,0x3F
    0067C 96E0      ADIW	R28,0x30
    0067D 90C9      LD	R12,Y+
    0067E 90A9      LD	R10,Y+
    0067F 9508      RET
_ReadSDFile:
  fs                   --> Y,+40
  bw                   --> Y,+38
  max                  --> R12
  file                 --> Y,+4
  res                  --> R20
  mode                 --> R22
  data                 --> R10
  index                --> R14
  fnamep               --> R12
    00680 940E 4BAB CALL	push_xgsetF0FC
    00682 0179      MOVW	R14,R18
    00683 0168      MOVW	R12,R16
    00684 97EF      SBIW	R28,0x3F
    00685 97EF      SBIW	R28,0x3F
    00686 97EF      SBIW	R28,0x3F
    00687 97EF      SBIW	R28,0x3F
    00688 97EF      SBIW	R28,0x3F
    00689 97EF      SBIW	R28,0x3F
    0068A 97EF      SBIW	R28,0x3F
    0068B 97EF      SBIW	R28,0x3F
    0068C 97EF      SBIW	R28,0x3F
    0068D 976F      SBIW	R28,0x1F
    0068E 01FE      MOVW	R30,R28
    0068F 5AE0      SUBI	R30,0xA0
    00690 4FFD      SBCI	R31,0xFD
    00691 80A0      LD	R10,Z
    00692 80B1      LDD	R11,Z+1
    00693 01FE      MOVW	R30,R28
    00694 59EE      SUBI	R30,0x9E
    00695 4FFD      SBCI	R31,0xFD
    00696 8160      LD	R22,Z
(0193) }
(0194) /////////////////////////////////////////////////
(0195) //       读取文件函数
(0196) //以64byte为一块 读取
(0197) //index数据偏移量   data读出后存放地
(0198) //////////////////////////////////////////////// 
(0199) char ReadSDFile(char *fnamep,int index, char *data, char mode)
(0200) {
(0201)  	unsigned int bw;
(0202) 	char res;
(0203) 	FATFS fs;
(0204)     FIL file;
(0205) 	static int indexoffset;
(0206) 	unsigned int max;
(0207) 	disk_initialize(0);
    00697 2700      CLR	R16
    00698 940E 0BF6 CALL	_disk_initialize
(0208)     res = f_mount(0, &fs);
    0069A 019E      MOVW	R18,R28
    0069B 5D28      SUBI	R18,0xD8
    0069C 4F3F      SBCI	R19,0xFF
    0069D 2700      CLR	R16
    0069E 940E 1FE2 CALL	_f_mount
(0209)     res = f_open(&file,fnamep,FA_READ);  
    006A0 E081      LDI	R24,1
    006A1 8388      ST	Y,R24
    006A2 0196      MOVW	R18,R12
    006A3 018E      MOVW	R16,R28
    006A4 5F0C      SUBI	R16,0xFC
    006A5 4F1F      SBCI	R17,0xFF
    006A6 940E 200D CALL	_f_open
    006A8 2F40      MOV	R20,R16
(0210)     if(res==FR_NO_FILE) {
    006A9 3004      CPI	R16,4
    006AA F419      BNE	0x06AE
(0211) 	data=NULL;
    006AB 24AA      CLR	R10
    006AC 24BB      CLR	R11
(0212)     #if _debug >= 1 
(0213)     debug_out("now file",255);
(0214) 	debug_out(filename,res);
(0215) 	debug_out("file is no exist....",255);
(0216)     #endif 
(0217)     return res;
    006AD C078      RJMP	0x0726
(0218)     }   
(0219)     max = (file.fsize-128)/SINGLE_ITEM_SIZE;
    006AE E880      LDI	R24,0x80
    006AF E090      LDI	R25,0
    006B0 E0A0      LDI	R26,0
    006B1 E0B0      LDI	R27,0
    006B2 850E      LDD	R16,Y+14
    006B3 851F      LDD	R17,Y+15
    006B4 8928      LDD	R18,Y+16
    006B5 8939      LDD	R19,Y+17
    006B6 1B08      SUB	R16,R24
    006B7 0B19      SBC	R17,R25
    006B8 0B2A      SBC	R18,R26
    006B9 0B3B      SBC	R19,R27
    006BA E086      LDI	R24,6
    006BB E090      LDI	R25,0
    006BC 938A      ST	-Y,R24
    006BD 940E 4C4F CALL	lsr32
    006BF 0168      MOVW	R12,R16
(0220) 	if(mode == 0){ //绝对位置模式
    006C0 2366      TST	R22
    006C1 F429      BNE	0x06C7
(0221) 		indexoffset = index;
    006C2 92F0 061A STS	main.c:indexoffset+1,R15
    006C4 92E0 0619 STS	main.c:indexoffset,R14
(0222) 	}
    006C6 C00C      RJMP	0x06D3
(0223) 	else if(mode == 1){ //位置偏移模式
    006C7 3061      CPI	R22,1
    006C8 F451      BNE	0x06D3
(0224) 		indexoffset+=index;
    006C9 9020 0619 LDS	R2,main.c:indexoffset
    006CB 9030 061A LDS	R3,main.c:indexoffset+1
    006CD 0C2E      ADD	R2,R14
    006CE 1C3F      ADC	R3,R15
    006CF 9230 061A STS	main.c:indexoffset+1,R3
    006D1 9220 0619 STS	main.c:indexoffset,R2
(0225) 	}
(0226) 	if(indexoffset >max){
    006D3 9020 0619 LDS	R2,main.c:indexoffset
    006D5 9030 061A LDS	R3,main.c:indexoffset+1
    006D7 14C2      CP	R12,R2
    006D8 04D3      CPC	R13,R3
    006D9 F428      BCC	0x06DF
(0227) 	    indexoffset = max;
    006DA 92D0 061A STS	main.c:indexoffset+1,R13
    006DC 92C0 0619 STS	main.c:indexoffset,R12
(0228) 	}
    006DE C00F      RJMP	0x06EE
(0229) 	else if(indexoffset <=0){
    006DF 2422      CLR	R2
    006E0 2433      CLR	R3
    006E1 9040 0619 LDS	R4,main.c:indexoffset
    006E3 9050 061A LDS	R5,main.c:indexoffset+1
    006E5 1424      CP	R2,R4
    006E6 0435      CPC	R3,R5
    006E7 F034      BLT	0x06EE
(0230) 		indexoffset = 1;
    006E8 E081      LDI	R24,1
    006E9 E090      LDI	R25,0
    006EA 9390 061A STS	main.c:indexoffset+1,R25
    006EC 9380 0619 STS	main.c:indexoffset,R24
(0231) 	}
(0232) 	res = f_lseek (&file,(indexoffset-1)*SINGLE_ITEM_SIZE+128);	 //前两个字节数据为文件头空间 所以从第三块读/写起
    006EE 9120 0619 LDS	R18,main.c:indexoffset
    006F0 9130 061A LDS	R19,main.c:indexoffset+1
    006F2 E400      LDI	R16,0x40
    006F3 E010      LDI	R17,0
    006F4 940E 4B47 CALL	empy16s
    006F6 01C8      MOVW	R24,R16
    006F7 5480      SUBI	R24,0x40
    006F8 4090      SBCI	R25,0
    006F9 5880      SUBI	R24,0x80
    006FA 4F9F      SBCI	R25,0xFF
    006FB 011C      MOVW	R2,R24
    006FC 2444      CLR	R4
    006FD FC37      SBRC	R3,7
    006FE 9440      COM	R4
    006FF 2455      CLR	R5
    00700 FC47      SBRC	R4,7
    00701 9450      COM	R5
    00702 8248      ST	Y,R4
    00703 8259      STD	Y+1,R5
    00704 0191      MOVW	R18,R2
    00705 018E      MOVW	R16,R28
    00706 5F0C      SUBI	R16,0xFC
    00707 4F1F      SBCI	R17,0xFF
    00708 940E 27EE CALL	_f_lseek
    0070A 2EC0      MOV	R12,R16
(0233)     res = f_read(&file,data,SINGLE_ITEM_SIZE,&bw);
    0070B 01CE      MOVW	R24,R28
    0070C 9686      ADIW	R24,0x26
    0070D 839B      STD	Y+3,R25
    0070E 838A      STD	Y+2,R24
    0070F E480      LDI	R24,0x40
    00710 E090      LDI	R25,0
    00711 8399      STD	Y+1,R25
    00712 8388      ST	Y,R24
    00713 0195      MOVW	R18,R10
    00714 018E      MOVW	R16,R28
    00715 5F0C      SUBI	R16,0xFC
    00716 4F1F      SBCI	R17,0xFF
    00717 940E 21A9 CALL	_f_read
    00719 2EA0      MOV	R10,R16
    0071A 2D4A      MOV	R20,R10
(0234)     f_close(&file);
    0071B 018E      MOVW	R16,R28
    0071C 5F0C      SUBI	R16,0xFC
    0071D 4F1F      SBCI	R17,0xFF
    0071E 940E 27DE CALL	_f_close
(0235) 	f_mount(0, NULL);
    00720 2722      CLR	R18
    00721 2733      CLR	R19
    00722 2700      CLR	R16
    00723 940E 1FE2 CALL	_f_mount
(0236) 	return res;
    00725 2F04      MOV	R16,R20
    00726 96EF      ADIW	R28,0x3F
    00727 96EF      ADIW	R28,0x3F
    00728 96EF      ADIW	R28,0x3F
    00729 96EF      ADIW	R28,0x3F
    0072A 96EF      ADIW	R28,0x3F
    0072B 96EF      ADIW	R28,0x3F
    0072C 96EF      ADIW	R28,0x3F
    0072D 96EF      ADIW	R28,0x3F
    0072E 96EF      ADIW	R28,0x3F
    0072F 966F      ADIW	R28,0x1F
    00730 940C 4BA0 JMP	pop_xgsetF0FC
_findIndex:
  fs                   --> Y,+48
  bw                   --> Y,+46
  fnamep               --> R14
  readsize             --> R10
  res                  --> R12
  file                 --> Y,+12
  lenth                --> Y,+8
  index                --> Y,+4
  is_first_end         --> Y,+606
  tmp                  --> R10
  buf                  --> Y,+617
  filename             --> R10
    00732 933A      ST	-Y,R19
    00733 932A      ST	-Y,R18
    00734 940E 4BAB CALL	push_xgsetF0FC
    00736 0158      MOVW	R10,R16
    00737 97EF      SBIW	R28,0x3F
    00738 97EF      SBIW	R28,0x3F
    00739 97EF      SBIW	R28,0x3F
    0073A 97EF      SBIW	R28,0x3F
    0073B 97EF      SBIW	R28,0x3F
    0073C 97EF      SBIW	R28,0x3F
    0073D 97EF      SBIW	R28,0x3F
    0073E 97EF      SBIW	R28,0x3F
    0073F 97EF      SBIW	R28,0x3F
    00740 97A8      SBIW	R28,0x28
(0237) } 
(0238) //////////////////////////////////
(0239) //   find index
(0240) // 检查当前文件尺寸，根据倒数第二个
(0241) //'\n'及其后面的index确定当前index值
(0242) //////////////////////////////////
(0243) unsigned int findIndex(char *filename,char *buf){
(0244)     unsigned int bw,tmp;
(0245) 	long index =0;
    00741 E080      LDI	R24,0
    00742 838C      STD	Y+4,R24
    00743 838D      STD	Y+5,R24
    00744 838E      STD	Y+6,R24
    00745 838F      STD	Y+7,R24
(0246) 	unsigned char is_first_end=0;
    00746 2400      CLR	R0
    00747 01DE      MOVW	R26,R28
    00748 5AA2      SUBI	R26,0xA2
    00749 4FBD      SBCI	R27,0xFD
    0074A 920C      ST	X,R0
(0247) 	char *fnamep=filename;
    0074B 0175      MOVW	R14,R10
(0248) 	FRESULT res;
(0249) 	FATFS fs;
(0250) 	FIL file;
(0251) 	long lenth=0;
    0074C E080      LDI	R24,0
    0074D 8788      STD	Y+8,R24
    0074E 8789      STD	Y+9,R24
    0074F 878A      STD	Y+10,R24
    00750 878B      STD	Y+11,R24
(0252) 	int readsize=0;
    00751 24AA      CLR	R10
    00752 24BB      CLR	R11
(0253) 	//PrintString_n(fnamep);
(0254) 	res = f_mount(0, &fs);
    00753 019E      MOVW	R18,R28
    00754 5D20      SUBI	R18,0xD0
    00755 4F3F      SBCI	R19,0xFF
    00756 2700      CLR	R16
    00757 940E 1FE2 CALL	_f_mount
(0255) 	res = f_open(&file,fnamep, FA_OPEN_ALWAYS | FA_READ );  //创建一个新的文件
    00759 E181      LDI	R24,0x11
    0075A 8388      ST	Y,R24
    0075B 0197      MOVW	R18,R14
    0075C 018E      MOVW	R16,R28
    0075D 5F04      SUBI	R16,0xF4
    0075E 4F1F      SBCI	R17,0xFF
    0075F 940E 200D CALL	_f_open
    00761 2EC0      MOV	R12,R16
(0256) 	if(res !=  FR_OK){ //openerror
    00762 2300      TST	R16
    00763 F011      BEQ	0x0766
(0257) 	    return res;}
    00764 2711      CLR	R17
    00765 C110      RJMP	0x0876
(0258) 	lenth=file.fsize;   //文件尾部为 file.size 
    00766 882E      LDD	R2,Y+22
    00767 883F      LDD	R3,Y+23
    00768 8C48      LDD	R4,Y+24
    00769 8C59      LDD	R5,Y+25
    0076A 8628      STD	Y+8,R2
    0076B 8639      STD	Y+9,R3
    0076C 864A      STD	Y+10,R4
    0076D 865B      STD	Y+11,R5
(0259) 	//debug("size=",0xff);
(0260) 	//PrintLong(lenth);
(0261) 	if(lenth > 512) {
    0076E E040      LDI	R20,0
    0076F E052      LDI	R21,2
    00770 E060      LDI	R22,0
    00771 E070      LDI	R23,0
    00772 8428      LDD	R2,Y+8
    00773 8439      LDD	R3,Y+9
    00774 844A      LDD	R4,Y+10
    00775 845B      LDD	R5,Y+11
    00776 1542      CP	R20,R2
    00777 0553      CPC	R21,R3
    00778 0564      CPC	R22,R4
    00779 0575      CPC	R23,R5
    0077A F464      BGE	0x0787
(0262) 	    readsize=512;
    0077B E080      LDI	R24,0
    0077C E092      LDI	R25,2
    0077D 015C      MOVW	R10,R24
(0263) 		lenth=file.fsize;
    0077E 882E      LDD	R2,Y+22
    0077F 883F      LDD	R3,Y+23
    00780 8C48      LDD	R4,Y+24
    00781 8C59      LDD	R5,Y+25
    00782 8628      STD	Y+8,R2
    00783 8639      STD	Y+9,R3
    00784 864A      STD	Y+10,R4
    00785 865B      STD	Y+11,R5
(0264) 	}
    00786 C007      RJMP	0x078E
(0265) 	else {
(0266) 	    readsize =file.fsize;
    00787 88AE      LDD	R10,Y+22
    00788 88BF      LDD	R11,Y+23
(0267) 		lenth=0;
    00789 E080      LDI	R24,0
    0078A 8788      STD	Y+8,R24
    0078B 8789      STD	Y+9,R24
    0078C 878A      STD	Y+10,R24
    0078D 878B      STD	Y+11,R24
(0268) 	}
(0269) 	res = f_lseek (&file,file.fsize-readsize);
    0078E 0115      MOVW	R2,R10
    0078F 2444      CLR	R4
    00790 FC37      SBRC	R3,7
    00791 9440      COM	R4
    00792 2455      CLR	R5
    00793 FC47      SBRC	R4,7
    00794 9450      COM	R5
    00795 886E      LDD	R6,Y+22
    00796 887F      LDD	R7,Y+23
    00797 8C88      LDD	R8,Y+24
    00798 8C99      LDD	R9,Y+25
    00799 1862      SUB	R6,R2
    0079A 0873      SBC	R7,R3
    0079B 0884      SBC	R8,R4
    0079C 0895      SBC	R9,R5
    0079D 8288      ST	Y,R8
    0079E 8299      STD	Y+1,R9
    0079F 0193      MOVW	R18,R6
    007A0 018E      MOVW	R16,R28
    007A1 5F04      SUBI	R16,0xF4
    007A2 4F1F      SBCI	R17,0xFF
    007A3 940E 27EE CALL	_f_lseek
(0270) 	//debug("readSIZE=",0x00);
(0271) 	//PrintLong((file.fsize-readsize));
(0272) 	res = f_read(&file,buf,readsize,&bw);
    007A5 01CE      MOVW	R24,R28
    007A6 968E      ADIW	R24,0x2E
    007A7 839B      STD	Y+3,R25
    007A8 838A      STD	Y+2,R24
    007A9 82B9      STD	Y+1,R11
    007AA 82A8      ST	Y,R10
    007AB 01FE      MOVW	R30,R28
    007AC 59E7      SUBI	R30,0x97
    007AD 4FFD      SBCI	R31,0xFD
    007AE 8120      LD	R18,Z
    007AF 8131      LDD	R19,Z+1
    007B0 018E      MOVW	R16,R28
    007B1 5F04      SUBI	R16,0xF4
    007B2 4F1F      SBCI	R17,0xFF
    007B3 940E 21A9 CALL	_f_read
    007B5 2EE0      MOV	R14,R16
    007B6 2CCE      MOV	R12,R14
(0273) 	f_close(&file);
    007B7 018E      MOVW	R16,R28
    007B8 5F04      SUBI	R16,0xF4
    007B9 4F1F      SBCI	R17,0xFF
    007BA 940E 27DE CALL	_f_close
(0274) 	//debug("readRES=",res);
(0275) 	//debug("readbw=",0X00);
(0276) 	//PrintLong(bw);
(0277) 	//PrintString_n(buf);
(0278) 	for(tmp=readsize;tmp>0;tmp--){
    007BC C040      RJMP	0x07FD
(0279) 		//debug("buf index",buf[tmp]);
(0280) 		//PrintLong(tmp);
(0281) 		//if(buf[tmp] == '\n') Usart_Transmit('@');						  
(0282) 		if(buf[tmp] == '\n' && is_first_end== 0){
    007BD 01F5      MOVW	R30,R10
    007BE 01DE      MOVW	R26,R28
    007BF 59A7      SUBI	R26,0x97
    007C0 4FBD      SBCI	R27,0xFD
    007C1 900D      LD	R0,X+
    007C2 901C      LD	R1,X
    007C3 0DE0      ADD	R30,R0
    007C4 1DF1      ADC	R31,R1
    007C5 8180      LD	R24,Z
    007C6 308A      CPI	R24,0xA
    007C7 F469      BNE	0x07D5
    007C8 01FE      MOVW	R30,R28
    007C9 5AE2      SUBI	R30,0xA2
    007CA 4FFD      SBCI	R31,0xFD
    007CB 8000      LD	R0,Z
    007CC 2000      TST	R0
    007CD F439      BNE	0x07D5
(0283) 		    is_first_end=1; 	
    007CE 2400      CLR	R0
    007CF 9403      INC	R0
    007D0 01FE      MOVW	R30,R28
    007D1 5AE2      SUBI	R30,0xA2
    007D2 4FFD      SBCI	R31,0xFD
    007D3 8200      ST	Z,R0
(0284) 			//debug("first=",0xf0);					      
(0285) 		}
    007D4 C025      RJMP	0x07FA
(0286) 		else if(buf[tmp] == '\n' && is_first_end== 1){
    007D5 01F5      MOVW	R30,R10
    007D6 01DE      MOVW	R26,R28
    007D7 59A7      SUBI	R26,0x97
    007D8 4FBD      SBCI	R27,0xFD
    007D9 900D      LD	R0,X+
    007DA 901C      LD	R1,X
    007DB 0DE0      ADD	R30,R0
    007DC 1DF1      ADC	R31,R1
    007DD 8180      LD	R24,Z
    007DE 308A      CPI	R24,0xA
    007DF F4D1      BNE	0x07FA
    007E0 01DE      MOVW	R26,R28
    007E1 5AA2      SUBI	R26,0xA2
    007E2 4FBD      SBCI	R27,0xFD
    007E3 918C      LD	R24,X
    007E4 3081      CPI	R24,1
    007E5 F4A1      BNE	0x07FA
(0287) 		    lenth -= (512-tmp);
    007E6 E080      LDI	R24,0
    007E7 E092      LDI	R25,2
    007E8 011C      MOVW	R2,R24
    007E9 182A      SUB	R2,R10
    007EA 083B      SBC	R3,R11
    007EB 2444      CLR	R4
    007EC 2455      CLR	R5
    007ED 8468      LDD	R6,Y+8
    007EE 8479      LDD	R7,Y+9
    007EF 848A      LDD	R8,Y+10
    007F0 849B      LDD	R9,Y+11
    007F1 1862      SUB	R6,R2
    007F2 0873      SBC	R7,R3
    007F3 0884      SBC	R8,R4
    007F4 0895      SBC	R9,R5
    007F5 8668      STD	Y+8,R6
    007F6 8679      STD	Y+9,R7
    007F7 868A      STD	Y+10,R8
    007F8 869B      STD	Y+11,R9
(0288) 			break;
    007F9 C009      RJMP	0x0803
    007FA 01C5      MOVW	R24,R10
    007FB 9701      SBIW	R24,1
    007FC 015C      MOVW	R10,R24
    007FD 20AA      TST	R10
    007FE F009      BEQ	0x0800
    007FF CFBD      RJMP	0x07BD
    00800 20BB      TST	R11
    00801 F009      BEQ	0x0803
    00802 CFBA      RJMP	0x07BD
(0289) 		} 						
(0290) 	}
(0291) 	//debug("start=",0X00); PrintLong(lenth);
(0292) 	if(lenth < 118 ){ 
    00803 E746      LDI	R20,0x76
    00804 E050      LDI	R21,0
    00805 E060      LDI	R22,0
    00806 E070      LDI	R23,0
    00807 8428      LDD	R2,Y+8
    00808 8439      LDD	R3,Y+9
    00809 844A      LDD	R4,Y+10
    0080A 845B      LDD	R5,Y+11
    0080B 1624      CP	R2,R20
    0080C 0635      CPC	R3,R21
    0080D 0646      CPC	R4,R22
    0080E 0657      CPC	R5,R23
    0080F F434      BGE	0x0816
(0293)  		return 1;
    00810 E001      LDI	R16,1
    00811 E010      LDI	R17,0
    00812 C063      RJMP	0x0876
(0294) 	}
(0295) 	else {
(0296) 		 //debug(">128 ",0X00);
(0297) 		 while(buf[tmp] <= '0' || buf[tmp] >= '9') tmp++;
    00813 01C5      MOVW	R24,R10
    00814 9601      ADIW	R24,1
    00815 015C      MOVW	R10,R24
    00816 01F5      MOVW	R30,R10
    00817 01DE      MOVW	R26,R28
    00818 59A7      SUBI	R26,0x97
    00819 4FBD      SBCI	R27,0xFD
    0081A 900D      LD	R0,X+
    0081B 901C      LD	R1,X
    0081C 0DE0      ADD	R30,R0
    0081D 1DF1      ADC	R31,R1
    0081E 80E0      LD	R14,Z
    0081F 24FF      CLR	R15
    00820 E380      LDI	R24,0x30
    00821 158E      CP	R24,R14
    00822 F780      BCC	0x0813
    00823 2D8E      MOV	R24,R14
    00824 3389      CPI	R24,0x39
    00825 F768      BCC	0x0813
    00826 C02F      RJMP	0x0856
(0298) 		 //debug("nozero ",bw); PrintLong(tmp);
(0299) 		 while(buf[tmp] != 't' && buf[tmp] >= '0' && buf[tmp] <= '9'){
(0300) 		     index=index*10+(buf[tmp]-'0');
    00827 01F5      MOVW	R30,R10
    00828 01DE      MOVW	R26,R28
    00829 59A7      SUBI	R26,0x97
    0082A 4FBD      SBCI	R27,0xFD
    0082B 900D      LD	R0,X+
    0082C 901C      LD	R1,X
    0082D 0DE0      ADD	R30,R0
    0082E 1DF1      ADC	R31,R1
    0082F 8180      LD	R24,Z
    00830 2799      CLR	R25
    00831 97C0      SBIW	R24,0x30
    00832 011C      MOVW	R2,R24
    00833 2444      CLR	R4
    00834 FC37      SBRC	R3,7
    00835 9440      COM	R4
    00836 2455      CLR	R5
    00837 FC47      SBRC	R4,7
    00838 9450      COM	R5
    00839 806C      LDD	R6,Y+4
    0083A 807D      LDD	R7,Y+5
    0083B 808E      LDD	R8,Y+6
    0083C 809F      LDD	R9,Y+7
    0083D E04A      LDI	R20,0xA
    0083E E050      LDI	R21,0
    0083F E060      LDI	R22,0
    00840 E070      LDI	R23,0
    00841 929A      ST	-Y,R9
    00842 928A      ST	-Y,R8
    00843 927A      ST	-Y,R7
    00844 926A      ST	-Y,R6
    00845 018A      MOVW	R16,R20
    00846 019B      MOVW	R18,R22
    00847 940E 4B57 CALL	empy32s|empy32u
    00849 0138      MOVW	R6,R16
    0084A 0149      MOVW	R8,R18
    0084B 0C62      ADD	R6,R2
    0084C 1C73      ADC	R7,R3
    0084D 1C84      ADC	R8,R4
    0084E 1C95      ADC	R9,R5
    0084F 826C      STD	Y+4,R6
    00850 827D      STD	Y+5,R7
    00851 828E      STD	Y+6,R8
    00852 829F      STD	Y+7,R9
(0301) 		 	 //Usart_Transmit(buf[tmp]);	
(0302) 		 	 tmp++;
    00853 01C5      MOVW	R24,R10
    00854 9601      ADIW	R24,1
    00855 015C      MOVW	R10,R24
    00856 01F5      MOVW	R30,R10
    00857 01DE      MOVW	R26,R28
    00858 59A7      SUBI	R26,0x97
    00859 4FBD      SBCI	R27,0xFD
    0085A 900D      LD	R0,X+
    0085B 901C      LD	R1,X
    0085C 0DE0      ADD	R30,R0
    0085D 1DF1      ADC	R31,R1
    0085E 80E0      LD	R14,Z
    0085F 24FF      CLR	R15
    00860 2D8E      MOV	R24,R14
    00861 3784      CPI	R24,0x74
    00862 F031      BEQ	0x0869
    00863 3380      CPI	R24,0x30
    00864 F020      BCS	0x0869
    00865 E389      LDI	R24,0x39
    00866 158E      CP	R24,R14
    00867 F008      BCS	0x0869
    00868 CFBE      RJMP	0x0827
(0303) 		 }
(0304) 	}
(0305) 	//debug("index=",0X00);
(0306) 	//PrintLong(index+1);
(0307) 	return index+1;
    00869 E041      LDI	R20,1
    0086A E050      LDI	R21,0
    0086B E060      LDI	R22,0
    0086C E070      LDI	R23,0
    0086D 802C      LDD	R2,Y+4
    0086E 803D      LDD	R3,Y+5
    0086F 804E      LDD	R4,Y+6
    00870 805F      LDD	R5,Y+7
    00871 0E24      ADD	R2,R20
    00872 1E35      ADC	R3,R21
    00873 1E46      ADC	R4,R22
    00874 1E57      ADC	R5,R23
    00875 0181      MOVW	R16,R2
    00876 96EF      ADIW	R28,0x3F
    00877 96EF      ADIW	R28,0x3F
    00878 96EF      ADIW	R28,0x3F
    00879 96EF      ADIW	R28,0x3F
    0087A 96EF      ADIW	R28,0x3F
    0087B 96EF      ADIW	R28,0x3F
    0087C 96EF      ADIW	R28,0x3F
    0087D 96EF      ADIW	R28,0x3F
    0087E 96EF      ADIW	R28,0x3F
    0087F 96A8      ADIW	R28,0x28
    00880 940E 4BA0 CALL	pop_xgsetF0FC
    00882 9622      ADIW	R28,2
    00883 9508      RET
_Round:
  x                    --> Y,+0
    00884 940E 4A66 CALL	push_arg4
(0308) }
(0309) float Round(float x){
(0310)     x=x*10;
    00886 ED04      LDI	R16,0xD4
    00887 E010      LDI	R17,0
    00888 940E 4B33 CALL	elpm32
    0088A 01CE      MOVW	R24,R28
    0088B 939A      ST	-Y,R25
    0088C 938A      ST	-Y,R24
    0088D 940E 4EF1 CALL	fpmule1
    0088F 8308      ST	Y,R16
    00890 8319      STD	Y+1,R17
    00891 832A      STD	Y+2,R18
    00892 833B      STD	Y+3,R19
(0311) 	if(x >=0) x+=0.5;
    00893 8028      LD	R2,Y
    00894 8039      LDD	R3,Y+1
    00895 804A      LDD	R4,Y+2
    00896 805B      LDD	R5,Y+3
    00897 ED08      LDI	R16,0xD8
    00898 E010      LDI	R17,0
    00899 940E 4B33 CALL	elpm32
    0089B 933A      ST	-Y,R19
    0089C 932A      ST	-Y,R18
    0089D 931A      ST	-Y,R17
    0089E 930A      ST	-Y,R16
    0089F 0181      MOVW	R16,R2
    008A0 0192      MOVW	R18,R4
    008A1 940E 4F2B CALL	fpcmp2
    008A3 F0AC      BLT	0x08B9
    008A4 8028      LD	R2,Y
    008A5 8039      LDD	R3,Y+1
    008A6 804A      LDD	R4,Y+2
    008A7 805B      LDD	R5,Y+3
    008A8 ED00      LDI	R16,0xD0
    008A9 E010      LDI	R17,0
    008AA 940E 4B33 CALL	elpm32
    008AC 933A      ST	-Y,R19
    008AD 932A      ST	-Y,R18
    008AE 931A      ST	-Y,R17
    008AF 930A      ST	-Y,R16
    008B0 0181      MOVW	R16,R2
    008B1 0192      MOVW	R18,R4
    008B2 940E 4CE7 CALL	fpadd2
    008B4 8308      ST	Y,R16
    008B5 8319      STD	Y+1,R17
    008B6 832A      STD	Y+2,R18
    008B7 833B      STD	Y+3,R19
    008B8 C014      RJMP	0x08CD
(0312) 	else x-=0.5;
    008B9 8028      LD	R2,Y
    008BA 8039      LDD	R3,Y+1
    008BB 804A      LDD	R4,Y+2
    008BC 805B      LDD	R5,Y+3
    008BD ED00      LDI	R16,0xD0
    008BE E010      LDI	R17,0
    008BF 940E 4B33 CALL	elpm32
    008C1 933A      ST	-Y,R19
    008C2 932A      ST	-Y,R18
    008C3 931A      ST	-Y,R17
    008C4 930A      ST	-Y,R16
    008C5 0181      MOVW	R16,R2
    008C6 0192      MOVW	R18,R4
    008C7 940E 4CFC CALL	fpsub2
    008C9 8308      ST	Y,R16
    008CA 8319      STD	Y+1,R17
    008CB 832A      STD	Y+2,R18
    008CC 833B      STD	Y+3,R19
(0313) 	x=(int)x;
    008CD 8108      LD	R16,Y
    008CE 8119      LDD	R17,Y+1
    008CF 812A      LDD	R18,Y+2
    008D0 813B      LDD	R19,Y+3
    008D1 940E 4D22 CALL	fpint
    008D3 940E 4D56 CALL	int2fp
    008D5 8308      ST	Y,R16
    008D6 8319      STD	Y+1,R17
    008D7 832A      STD	Y+2,R18
    008D8 833B      STD	Y+3,R19
(0314) 	x=x/10.0;
    008D9 8028      LD	R2,Y
    008DA 8039      LDD	R3,Y+1
    008DB 804A      LDD	R4,Y+2
    008DC 805B      LDD	R5,Y+3
    008DD EC0C      LDI	R16,0xCC
    008DE E010      LDI	R17,0
    008DF 940E 4B33 CALL	elpm32
    008E1 933A      ST	-Y,R19
    008E2 932A      ST	-Y,R18
    008E3 931A      ST	-Y,R17
    008E4 930A      ST	-Y,R16
    008E5 0181      MOVW	R16,R2
    008E6 0192      MOVW	R18,R4
    008E7 940E 4D81 CALL	fpdiv2
    008E9 8308      ST	Y,R16
    008EA 8319      STD	Y+1,R17
    008EB 832A      STD	Y+2,R18
    008EC 833B      STD	Y+3,R19
(0315) 	return x;
    008ED 8108      LD	R16,Y
    008EE 8119      LDD	R17,Y+1
    008EF 812A      LDD	R18,Y+2
    008F0 813B      LDD	R19,Y+3
    008F1 9624      ADIW	R28,4
    008F2 9508      RET
_check:
  WScounter            --> R10
  tmp                  --> R12
    008F3 940E 4BB1 CALL	push_xgset003C
    008F5 9724      SBIW	R28,4
(0316) }
(0317) 
(0318) void check( void )
(0319) {
(0320)  unsigned char tmp;
(0321)  unsigned int WScounter;
(0322)  //检测风速
(0323)  //读计数器1 此步需严格按手册进行。
(0324)  tmp=SREG;
    008F6 B6CF      IN	R12,0x3F
(0325)  CLI();
    008F7 94F8      BCLR	7
(0326)  WScounter=TCNT1H*256+TCNT1L;
    008F8 B52D      IN	R18,0x2D
    008F9 2733      CLR	R19
    008FA E000      LDI	R16,0
    008FB E011      LDI	R17,1
    008FC 940E 4B47 CALL	empy16s
    008FE 0158      MOVW	R10,R16
    008FF B42C      IN	R2,0x2C
    00900 2433      CLR	R3
    00901 0CA2      ADD	R10,R2
    00902 1CB3      ADC	R11,R3
(0327)  SREG=tmp;
    00903 BECF      OUT	0x3F,R12
(0328)  SEI();
    00904 9478      BSET	7
(0329)  //计算风速
(0330)  Result.WindSpeed=WScounter/N_per_Second;
    00905 0185      MOVW	R16,R10
    00906 940E 4D54 CALL	uint2fp
    00908 0118      MOVW	R2,R16
    00909 0129      MOVW	R4,R18
    0090A EC08      LDI	R16,0xC8
    0090B E010      LDI	R17,0
    0090C 940E 4B33 CALL	elpm32
    0090E 933A      ST	-Y,R19
    0090F 932A      ST	-Y,R18
    00910 931A      ST	-Y,R17
    00911 930A      ST	-Y,R16
    00912 0181      MOVW	R16,R2
    00913 0192      MOVW	R18,R4
    00914 940E 4D81 CALL	fpdiv2
    00916 9310 069F STS	Result+52,R17
    00918 9300 069E STS	Result+51,R16
    0091A 9330 06A1 STS	Result+54,R19
    0091C 9320 06A0 STS	Result+53,R18
(0331)  //四舍五入
(0332)  Result.WindSpeed=Round(Result.WindSpeed);
    0091E DF65      RCALL	_Round
    0091F 9310 069F STS	Result+52,R17
    00921 9300 069E STS	Result+51,R16
    00923 9330 06A1 STS	Result+54,R19
    00925 9320 06A0 STS	Result+53,R18
(0333)   //温度
(0334)  Result.Temperature=read_T_NUM(OUTSIDE_SENSOR); //读两次 避免出错
    00927 E001      LDI	R16,1
    00928 940E 44BB CALL	_read_T_NUM
    0092A 9310 0695 STS	Result+42,R17
    0092C 9300 0694 STS	Result+41,R16
    0092E 9330 0697 STS	Result+44,R19
    00930 9320 0696 STS	Result+43,R18
(0335)  Result.Temperature=read_T_NUM(OUTSIDE_SENSOR);
    00932 E001      LDI	R16,1
    00933 940E 44BB CALL	_read_T_NUM
    00935 9310 0695 STS	Result+42,R17
    00937 9300 0694 STS	Result+41,R16
    00939 9330 0697 STS	Result+44,R19
    0093B 9320 0696 STS	Result+43,R18
(0336)  //四舍五入
(0337)  Result.Temperature=Round(Result.Temperature);
    0093D DF46      RCALL	_Round
    0093E 9310 0695 STS	Result+42,R17
    00940 9300 0694 STS	Result+41,R16
    00942 9330 0697 STS	Result+44,R19
    00944 9320 0696 STS	Result+43,R18
(0338)  //WCI风冷指数
(0339)  Result.WCI = 4.18 *(10*SquareRootFloat(Result.WindSpeed) + 10.45 -  Result.WindSpeed  ) *( 33 - Result.Temperature );
    00946 9120 06A0 LDS	R18,Result+53
    00948 9130 06A1 LDS	R19,Result+54
    0094A 9100 069E LDS	R16,Result+51
    0094C 9110 069F LDS	R17,Result+52
    0094E D1FB      RCALL	_SquareRootFloat
    0094F 0118      MOVW	R2,R16
    00950 0129      MOVW	R4,R18
    00951 EC04      LDI	R16,0xC4
    00952 E010      LDI	R17,0
    00953 940E 4B33 CALL	elpm32
    00955 0138      MOVW	R6,R16
    00956 0149      MOVW	R8,R18
    00957 ED04      LDI	R16,0xD4
    00958 E010      LDI	R17,0
    00959 940E 4B33 CALL	elpm32
    0095B 925A      ST	-Y,R5
    0095C 924A      ST	-Y,R4
    0095D 923A      ST	-Y,R3
    0095E 922A      ST	-Y,R2
    0095F 940E 4EFB CALL	fpmule2
    00961 0118      MOVW	R2,R16
    00962 0129      MOVW	R4,R18
    00963 EC00      LDI	R16,0xC0
    00964 E010      LDI	R17,0
    00965 940E 4B33 CALL	elpm32
    00967 933A      ST	-Y,R19
    00968 932A      ST	-Y,R18
    00969 931A      ST	-Y,R17
    0096A 930A      ST	-Y,R16
    0096B 0181      MOVW	R16,R2
    0096C 0192      MOVW	R18,R4
    0096D 940E 4CE7 CALL	fpadd2
    0096F E98E      LDI	R24,0x9E
    00970 E096      LDI	R25,6
    00971 939A      ST	-Y,R25
    00972 938A      ST	-Y,R24
    00973 940E 4D07 CALL	fpsub1x
    00975 0183      MOVW	R16,R6
    00976 0194      MOVW	R18,R8
    00977 940E 4EFB CALL	fpmule2
    00979 0118      MOVW	R2,R16
    0097A 0129      MOVW	R4,R18
    0097B EB0C      LDI	R16,0xBC
    0097C E010      LDI	R17,0
    0097D 940E 4B33 CALL	elpm32
    0097F E984      LDI	R24,0x94
    00980 E096      LDI	R25,6
    00981 939A      ST	-Y,R25
    00982 938A      ST	-Y,R24
    00983 940E 4D07 CALL	fpsub1x
    00985 0181      MOVW	R16,R2
    00986 0192      MOVW	R18,R4
    00987 940E 4EFB CALL	fpmule2
    00989 9310 06A8 STS	Result+61,R17
    0098B 9300 06A7 STS	Result+60,R16
    0098D 9330 06AA STS	Result+63,R19
    0098F 9320 06A9 STS	Result+62,R18
(0340)  //ECT等价制冷温度
(0341)  Result.ECT=33.0f - 0.01085f*Result.WCI;
    00991 EB0C      LDI	R16,0xBC
    00992 E010      LDI	R17,0
    00993 940E 4B33 CALL	elpm32
    00995 0118      MOVW	R2,R16
    00996 0129      MOVW	R4,R18
    00997 EB08      LDI	R16,0xB8
    00998 E010      LDI	R17,0
    00999 940E 4B33 CALL	elpm32
    0099B EA87      LDI	R24,0xA7
    0099C E096      LDI	R25,6
    0099D 939A      ST	-Y,R25
    0099E 938A      ST	-Y,R24
    0099F 940E 4F06 CALL	fpmule1x
    009A1 0181      MOVW	R16,R2
    009A2 0192      MOVW	R18,R4
    009A3 940E 4CFC CALL	fpsub2
    009A5 9310 06B4 STS	Result+73,R17
    009A7 9300 06B3 STS	Result+72,R16
    009A9 9330 06B6 STS	Result+75,R19
    009AB 9320 06B5 STS	Result+74,R18
(0342)  //TEQ 相当温度
(0343)  Result.Teq = Result.Temperature +( (Result.Temperature -36)/10 ) * Result.WindSpeed ;
    009AD 9040 0696 LDS	R4,Result+43
    009AF 9050 0697 LDS	R5,Result+44
    009B1 9020 0694 LDS	R2,Result+41
    009B3 9030 0695 LDS	R3,Result+42
    009B5 0131      MOVW	R6,R2
    009B6 0142      MOVW	R8,R4
    009B7 EB04      LDI	R16,0xB4
    009B8 E010      LDI	R17,0
    009B9 940E 4B33 CALL	elpm32
    009BB 933A      ST	-Y,R19
    009BC 932A      ST	-Y,R18
    009BD 931A      ST	-Y,R17
    009BE 930A      ST	-Y,R16
    009BF 0183      MOVW	R16,R6
    009C0 0194      MOVW	R18,R8
    009C1 940E 4CFC CALL	fpsub2
    009C3 0138      MOVW	R6,R16
    009C4 0149      MOVW	R8,R18
    009C5 ED04      LDI	R16,0xD4
    009C6 E010      LDI	R17,0
    009C7 940E 4B33 CALL	elpm32
    009C9 933A      ST	-Y,R19
    009CA 932A      ST	-Y,R18
    009CB 931A      ST	-Y,R17
    009CC 930A      ST	-Y,R16
    009CD 0183      MOVW	R16,R6
    009CE 0194      MOVW	R18,R8
    009CF 940E 4D81 CALL	fpdiv2
    009D1 E98E      LDI	R24,0x9E
    009D2 E096      LDI	R25,6
    009D3 939A      ST	-Y,R25
    009D4 938A      ST	-Y,R24
    009D5 940E 4F06 CALL	fpmule1x
    009D7 0181      MOVW	R16,R2
    009D8 0192      MOVW	R18,R4
    009D9 940E 4CE7 CALL	fpadd2
    009DB 9310 06BE STS	Result+83,R17
    009DD 9300 06BD STS	Result+82,R16
    009DF 9330 06C0 STS	Result+85,R19
    009E1 9320 06BF STS	Result+84,R18
(0344) //将数据转换成字符串
(0345) sprintf(Result.WSChar, "%#.1lf", (float)Result.WindSpeed);
    009E3 9040 06A0 LDS	R4,Result+53
    009E5 9050 06A1 LDS	R5,Result+54
    009E7 9020 069E LDS	R2,Result+51
    009E9 9030 069F LDS	R3,Result+52
    009EB 8228      ST	Y,R2
    009EC 8239      STD	Y+1,R3
    009ED 824A      STD	Y+2,R4
    009EE 825B      STD	Y+3,R5
    009EF ED2A      LDI	R18,0xDA
    009F0 E031      LDI	R19,1
    009F1 EA02      LDI	R16,0xA2
    009F2 E016      LDI	R17,6
    009F3 940E 5328 CALL	_sprintf
(0346) sprintf(Result.TempChar, "%#.1lf", (float)Result.Temperature); //PrintString_n(Result.TempChar);
    009F5 9040 0696 LDS	R4,Result+43
    009F7 9050 0697 LDS	R5,Result+44
    009F9 9020 0694 LDS	R2,Result+41
    009FB 9030 0695 LDS	R3,Result+42
    009FD 8228      ST	Y,R2
    009FE 8239      STD	Y+1,R3
    009FF 824A      STD	Y+2,R4
    00A00 825B      STD	Y+3,R5
    00A01 ED2A      LDI	R18,0xDA
    00A02 E031      LDI	R19,1
    00A03 E908      LDI	R16,0x98
    00A04 E016      LDI	R17,6
    00A05 940E 5328 CALL	_sprintf
(0347) sprintf(Result.WCIChar, "%#.1lf",  (float)Result.WCI); //PrintString_n(Result.WCIChar);
    00A07 9040 06A9 LDS	R4,Result+62
    00A09 9050 06AA LDS	R5,Result+63
    00A0B 9020 06A7 LDS	R2,Result+60
    00A0D 9030 06A8 LDS	R3,Result+61
    00A0F 8228      ST	Y,R2
    00A10 8239      STD	Y+1,R3
    00A11 824A      STD	Y+2,R4
    00A12 825B      STD	Y+3,R5
    00A13 ED2A      LDI	R18,0xDA
    00A14 E031      LDI	R19,1
    00A15 EA0B      LDI	R16,0xAB
    00A16 E016      LDI	R17,6
    00A17 940E 5328 CALL	_sprintf
(0348) sprintf(Result.ECTChar, "%#.1lf", (float)Result.ECT);  //PrintString_n(Result.ECTChar);
    00A19 9040 06B5 LDS	R4,Result+74
    00A1B 9050 06B6 LDS	R5,Result+75
    00A1D 9020 06B3 LDS	R2,Result+72
    00A1F 9030 06B4 LDS	R3,Result+73
    00A21 8228      ST	Y,R2
    00A22 8239      STD	Y+1,R3
    00A23 824A      STD	Y+2,R4
    00A24 825B      STD	Y+3,R5
    00A25 ED2A      LDI	R18,0xDA
    00A26 E031      LDI	R19,1
    00A27 EB07      LDI	R16,0xB7
    00A28 E016      LDI	R17,6
    00A29 940E 5328 CALL	_sprintf
(0349) sprintf(Result.TeqChar, "%#.1lf", (float)Result.Teq);
    00A2B 9040 06BF LDS	R4,Result+84
    00A2D 9050 06C0 LDS	R5,Result+85
    00A2F 9020 06BD LDS	R2,Result+82
    00A31 9030 06BE LDS	R3,Result+83
    00A33 8228      ST	Y,R2
    00A34 8239      STD	Y+1,R3
    00A35 824A      STD	Y+2,R4
    00A36 825B      STD	Y+3,R5
    00A37 ED2A      LDI	R18,0xDA
    00A38 E031      LDI	R19,1
    00A39 EC01      LDI	R16,0xC1
    00A3A E016      LDI	R17,6
    00A3B 940E 5328 CALL	_sprintf
(0350) sprintf(Result.IndexChar, "%d", Result.Index);
    00A3D 9040 0677 LDS	R4,Result+12
    00A3F 9050 0678 LDS	R5,Result+13
    00A41 9020 0675 LDS	R2,Result+10
    00A43 9030 0676 LDS	R3,Result+11
    00A45 8228      ST	Y,R2
    00A46 8239      STD	Y+1,R3
    00A47 824A      STD	Y+2,R4
    00A48 825B      STD	Y+3,R5
    00A49 ED27      LDI	R18,0xD7
    00A4A E031      LDI	R19,1
    00A4B E709      LDI	R16,0x79
    00A4C E016      LDI	R17,6
    00A4D 940E 5328 CALL	_sprintf
(0351) Result.TempChar[6]='\0';
    00A4F 2422      CLR	R2
    00A50 9220 069E STS	Result+51,R2
(0352) Result.WSChar[5]='\0';
    00A52 9220 06A7 STS	Result+60,R2
(0353) Result.WCIChar[7]='\0';
    00A54 9220 06B2 STS	Result+71,R2
(0354) Result.ECTChar[6]='\0';
    00A56 9220 06BD STS	Result+82,R2
(0355) Result.TeqChar[6]='\0';
    00A58 9220 06C7 STS	Result+92,R2
(0356)  return ;
    00A5A 9624      ADIW	R28,4
    00A5B 940C 4B8B JMP	pop_xgset003C
_StructToChar:
  otherbyte            --> Y,+16
  ary                  --> Y,+0
  i                    --> R10
    00A5D 92AA      ST	-Y,R10
    00A5E 9768      SBIW	R28,0x18
(0357) }
(0358) /*
(0359) ////////////////////////////////////////////
(0360) //				字符串转换函数
(0361) //   浮点 到  字符串
(0362) ////////////////////////////////////////////
(0363) void ftochr(float a,char * dest){//float
(0364) char i=0,j=0,lenth;
(0365) int status;
(0366) char *res;
(0367)  res=ftoa(a,&status);  //float to ascii
(0368) lenth=strlen(res);
(0369) 
(0370) for(i=0;i <lenth;i++) 
(0371)        {
(0372) 	   	dest[i]=res[i];
(0373) 
(0374) 		if( res[i]=='.'  ) 
(0375) 			{
(0376) 				dest[i+1]=res[i+1];
(0377) 					dest[i+2]='\0';
(0378) 						return ;    
(0379) 		    }
(0380)  
(0381)  		}
(0382) }
(0383) //////////////////////////////////////////////////////
(0384) //              整型数据变字符串
(0385) //    a  到  dest
(0386) ///////////////////////////////////////////////////////
(0387) void itochr(int a,char * dest){ //int to ascii
(0388) 	 itoa(dest,a,10); 
(0389) }
(0390) */
(0391) //////////////////////////////////////////////////////
(0392) //                  结构体 变字符串
(0393) // 将目前存于结构体的数据转换到Temp_Char中。
(0394) ///////////////////////////////////////////////////////
(0395) void  StructToChar(void)
(0396) { 
(0397)   unsigned char i;
(0398)   char otherbyte[]="0\t0\t0\t0";
    00A5F EA89      LDI	R24,0xA9
    00A60 E091      LDI	R25,1
    00A61 01FE      MOVW	R30,R28
    00A62 9670      ADIW	R30,0x10
    00A63 E008      LDI	R16,0x8
    00A64 E010      LDI	R17,0
    00A65 93FA      ST	-Y,R31
    00A66 93EA      ST	-Y,R30
    00A67 939A      ST	-Y,R25
    00A68 938A      ST	-Y,R24
    00A69 940E 4C5B CALL	asgnblk
(0399)   char *(ary[])={Result.IndexChar,Result.Date,Result.Time,
    00A6B EB81      LDI	R24,0xB1
    00A6C E091      LDI	R25,1
    00A6D 01FE      MOVW	R30,R28
    00A6E E100      LDI	R16,0x10
    00A6F E010      LDI	R17,0
    00A70 93FA      ST	-Y,R31
    00A71 93EA      ST	-Y,R30
    00A72 939A      ST	-Y,R25
    00A73 938A      ST	-Y,R24
    00A74 940E 4C5B CALL	asgnblk
(0400)  	  			Result.TempChar,Result.WSChar,Result.WCIChar,Result.ECTChar,
(0401) 				Result.TeqChar
(0402) 			   };  //指向数组首地址的指针
(0403)   //strcat(Temp_Char,Result.Name);
(0404)   for(i=0;i<=80;i++) TempChar[i]='\0';  //清空数组
    00A76 24AA      CLR	R10
    00A77 C009      RJMP	0x0A81
    00A78 E18B      LDI	R24,0x1B
    00A79 E096      LDI	R25,6
    00A7A 2DEA      MOV	R30,R10
    00A7B 27FF      CLR	R31
    00A7C 0FE8      ADD	R30,R24
    00A7D 1FF9      ADC	R31,R25
    00A7E 2422      CLR	R2
    00A7F 8220      ST	Z,R2
    00A80 94A3      INC	R10
    00A81 E580      LDI	R24,0x50
    00A82 158A      CP	R24,R10
    00A83 F7A0      BCC	0x0A78
(0405)     for(i=0;i<=7;i++){
    00A84 24AA      CLR	R10
    00A85 C014      RJMP	0x0A9A
(0406) 		strcat(TempChar,ary[i]);  // 按顺序复制字符串
    00A86 01CE      MOVW	R24,R28
    00A87 2DEA      MOV	R30,R10
    00A88 27FF      CLR	R31
    00A89 0FEE      LSL	R30
    00A8A 1FFF      ROL	R31
    00A8B 0FE8      ADD	R30,R24
    00A8C 1FF9      ADC	R31,R25
    00A8D 8120      LD	R18,Z
    00A8E 8131      LDD	R19,Z+1
    00A8F E10B      LDI	R16,0x1B
    00A90 E016      LDI	R17,6
    00A91 940E 4A4D CALL	_strcat
(0407) 		strcat(TempChar,tab);     // 字串结尾加上制表符
    00A93 E020      LDI	R18,0
    00A94 E031      LDI	R19,1
    00A95 E10B      LDI	R16,0x1B
    00A96 E016      LDI	R17,6
    00A97 940E 4A4D CALL	_strcat
    00A99 94A3      INC	R10
    00A9A E087      LDI	R24,7
    00A9B 158A      CP	R24,R10
    00A9C F748      BCC	0x0A86
(0408)     }
(0409) 				 
(0410) 				 otherbyte[0]=otherbyte[0]+Result.WeiHai;
    00A9D 9020 06C7 LDS	R2,Result+92
    00A9F 8838      LDD	R3,Y+16
    00AA0 0C32      ADD	R3,R2
    00AA1 8A38      STD	Y+16,R3
(0411) 				 otherbyte[2]=otherbyte[0]+Result.LowLabor;
    00AA2 9020 06C8 LDS	R2,Result+93
    00AA4 0C32      ADD	R3,R2
    00AA5 8A3A      STD	Y+18,R3
(0412) 				 otherbyte[4]=otherbyte[0]+Result.MidLabor;
    00AA6 9020 06C9 LDS	R2,Result+94
    00AA8 8838      LDD	R3,Y+16
    00AA9 0C32      ADD	R3,R2
    00AAA 8A3C      STD	Y+20,R3
(0413) 				 otherbyte[6]=otherbyte[0]+Result.HighLabor;
    00AAB 9020 06CA LDS	R2,Result+95
    00AAD 8838      LDD	R3,Y+16
    00AAE 0C32      ADD	R3,R2
    00AAF 8A3E      STD	Y+22,R3
(0414)  
(0415)   strcat(TempChar,otherbyte);  
    00AB0 019E      MOVW	R18,R28
    00AB1 5F20      SUBI	R18,0xF0
    00AB2 4F3F      SBCI	R19,0xFF
    00AB3 E10B      LDI	R16,0x1B
    00AB4 E016      LDI	R17,6
    00AB5 940E 4A4D CALL	_strcat
(0416)   strcat(TempChar,enter);  
    00AB7 E023      LDI	R18,3
    00AB8 E031      LDI	R19,1
    00AB9 E10B      LDI	R16,0x1B
    00ABA E016      LDI	R17,6
    00ABB 940E 4A4D CALL	_strcat
(0417)   strcat(TempChar,"\0");
    00ABD ED25      LDI	R18,0xD5
    00ABE E031      LDI	R19,1
    00ABF E10B      LDI	R16,0x1B
    00AC0 E016      LDI	R17,6
    00AC1 940E 4A4D CALL	_strcat
    00AC3 9668      ADIW	R28,0x18
    00AC4 90A9      LD	R10,Y+
    00AC5 9508      RET
_CharToStruct:
  ary                  --> Y,+0
  j                    --> R12
  p                    --> R10
  q                    --> R20
  buf                  --> R14
    00AC6 940E 4BAD CALL	push_xgset30FC
    00AC8 0178      MOVW	R14,R16
    00AC9 9760      SBIW	R28,0x10
(0418) }
(0419) 
(0420) //////////////////////////////////////////////////////
(0421) //               字符串  变  结构体
(0422) // 
(0423) ///////////////////////////////////////////////////////
(0424) void CharToStruct(char *buf)
(0425) {
(0426)   unsigned char j=0;
    00ACA 24CC      CLR	R12
(0427)   unsigned char *p,*q;
(0428)   char *(ary[])={Result.IndexChar,Result.Date,Result.Time,
    00ACB EC81      LDI	R24,0xC1
    00ACC E091      LDI	R25,1
    00ACD 01FE      MOVW	R30,R28
    00ACE E100      LDI	R16,0x10
    00ACF E010      LDI	R17,0
    00AD0 93FA      ST	-Y,R31
    00AD1 93EA      ST	-Y,R30
    00AD2 939A      ST	-Y,R25
    00AD3 938A      ST	-Y,R24
    00AD4 940E 4C5B CALL	asgnblk
(0429)  	  			Result.TempChar,Result.WSChar,Result.WCIChar,Result.ECTChar,
(0430) 				Result.TeqChar
(0431) 			   };  //指向数组首地址的指针
(0432)     p=ary[j];
    00AD6 01CE      MOVW	R24,R28
    00AD7 2DEC      MOV	R30,R12
    00AD8 27FF      CLR	R31
    00AD9 0FEE      LSL	R30
    00ADA 1FFF      ROL	R31
    00ADB 0FE8      ADD	R30,R24
    00ADC 1FF9      ADC	R31,R25
    00ADD 80A0      LD	R10,Z
    00ADE 80B1      LDD	R11,Z+1
(0433) 	q=buf;
    00ADF 01A7      MOVW	R20,R14
    00AE0 C026      RJMP	0x0B07
(0434) 	
(0435) 	while(1){
(0436)     if(*q =='\n') {*p='\0'; return;} ;
    00AE1 01FA      MOVW	R30,R20
    00AE2 8180      LD	R24,Z
    00AE3 308A      CPI	R24,0xA
    00AE4 F421      BNE	0x0AE9
    00AE5 2422      CLR	R2
    00AE6 01F5      MOVW	R30,R10
    00AE7 8220      ST	Z,R2
    00AE8 C01F      RJMP	0x0B08
(0437) 	if(*q =='\t') {
    00AE9 01FA      MOVW	R30,R20
    00AEA 8180      LD	R24,Z
    00AEB 3089      CPI	R24,0x9
    00AEC F4A1      BNE	0x0B01
(0438) 		*p='\0';
    00AED 2422      CLR	R2
    00AEE 01F5      MOVW	R30,R10
    00AEF 8220      ST	Z,R2
(0439) 		q++;
    00AF0 5F4F      SUBI	R20,0xFF
    00AF1 4F5F      SBCI	R21,0xFF
(0440) 	    if(j>7) break ;
    00AF2 E087      LDI	R24,7
    00AF3 158C      CP	R24,R12
    00AF4 F408      BCC	0x0AF6
    00AF5 C012      RJMP	0x0B08
(0441) 		j++;
    00AF6 94C3      INC	R12
(0442) 		p=ary[j];
    00AF7 01CE      MOVW	R24,R28
    00AF8 2DEC      MOV	R30,R12
    00AF9 27FF      CLR	R31
    00AFA 0FEE      LSL	R30
    00AFB 1FFF      ROL	R31
    00AFC 0FE8      ADD	R30,R24
    00AFD 1FF9      ADC	R31,R25
    00AFE 80A0      LD	R10,Z
    00AFF 80B1      LDD	R11,Z+1
(0443) 		continue ;
    00B00 C006      RJMP	0x0B07
(0444) 	}
(0445)     *p++=*q++;
    00B01 01FA      MOVW	R30,R20
    00B02 01D5      MOVW	R26,R10
    00B03 9001      LD	R0,Z+
    00B04 01AF      MOVW	R20,R30
    00B05 920D      ST	X+,R0
    00B06 015D      MOVW	R10,R26
    00B07 CFD9      RJMP	0x0AE1
    00B08 9660      ADIW	R28,0x10
    00B09 940C 4B97 JMP	pop_xgset30FC
_get_name:
  i                    --> R20
  filenamep            --> R16
    00B0B 940E 4BC0 CALL	push_xgsetF000
(0446) 	}
(0447) 	return ;
(0448) }
(0449)  
(0450)  ////////////////////////////////////////////
(0451) //				根据当前日期获取文件名
(0452) //   
(0453) ////////////////////////////////////////////
(0454) char *get_name( char filenamep[] ){     
(0455) 	  unsigned char i=0;
(0456)  	  for(i=0;i<6;i++) {
    00B0D 2744      CLR	R20
    00B0E C00D      RJMP	0x0B1C
(0457) 	  				    *(filenamep+i)=Result.Date[i];
    00B0F E881      LDI	R24,0x81
    00B10 E096      LDI	R25,6
    00B11 2FE4      MOV	R30,R20
    00B12 27FF      CLR	R31
    00B13 0FE8      ADD	R30,R24
    00B14 1FF9      ADC	R31,R25
    00B15 8020      LD	R2,Z
    00B16 2FE4      MOV	R30,R20
    00B17 27FF      CLR	R31
    00B18 0FE0      ADD	R30,R16
    00B19 1FF1      ADC	R31,R17
    00B1A 8220      ST	Z,R2
    00B1B 9543      INC	R20
    00B1C 3046      CPI	R20,6
    00B1D F388      BCS	0x0B0F
(0458) 	  				   } 
(0459) 	 	*(filenamep+(i++))='.';
    00B1E 2E24      MOV	R2,R20
    00B1F 2433      CLR	R3
    00B20 5F4F      SUBI	R20,0xFF
    00B21 2DE2      MOV	R30,R2
    00B22 27FF      CLR	R31
    00B23 0FE0      ADD	R30,R16
    00B24 1FF1      ADC	R31,R17
    00B25 E28E      LDI	R24,0x2E
    00B26 8380      ST	Z,R24
(0460) 		*(filenamep+(i++))='x';
    00B27 2E24      MOV	R2,R20
    00B28 2433      CLR	R3
    00B29 5F4F      SUBI	R20,0xFF
    00B2A 2DE2      MOV	R30,R2
    00B2B 27FF      CLR	R31
    00B2C 0FE0      ADD	R30,R16
    00B2D 1FF1      ADC	R31,R17
    00B2E E788      LDI	R24,0x78
    00B2F 8380      ST	Z,R24
(0461) 		*(filenamep+(i++))='l';
    00B30 2F64      MOV	R22,R20
    00B31 2777      CLR	R23
    00B32 5F4F      SUBI	R20,0xFF
    00B33 2FE6      MOV	R30,R22
    00B34 27FF      CLR	R31
    00B35 0FE0      ADD	R30,R16
    00B36 1FF1      ADC	R31,R17
    00B37 E68C      LDI	R24,0x6C
    00B38 8380      ST	Z,R24
(0462) 		*(filenamep+(i++))='s';
    00B39 2F64      MOV	R22,R20
    00B3A 2777      CLR	R23
    00B3B 5F4F      SUBI	R20,0xFF
    00B3C 2FE6      MOV	R30,R22
    00B3D 27FF      CLR	R31
    00B3E 0FE0      ADD	R30,R16
    00B3F 1FF1      ADC	R31,R17
    00B40 E783      LDI	R24,0x73
    00B41 8380      ST	Z,R24
(0463) 		*(filenamep+(i))='\0';
    00B42 2FE4      MOV	R30,R20
    00B43 27FF      CLR	R31
    00B44 0FE0      ADD	R30,R16
    00B45 1FF1      ADC	R31,R17
    00B46 2422      CLR	R2
    00B47 8220      ST	Z,R2
(0464) 					   
(0465)       return filenamep;
    00B48 940C 4BC5 JMP	pop_xgsetF000
_SquareRootFloat:
  f                    --> Y,+12
  x                    --> Y,+8
  i                    --> Y,+4
  y                    --> Y,+0
  number               --> Y,+20
    00B4A 940E 4A66 CALL	push_arg4
    00B4C 940E 4BC0 CALL	push_xgsetF000
    00B4E 9760      SBIW	R28,0x10
(0466) } 
(0467) float SquareRootFloat(float number)
(0468) {
(0469)     long i;
(0470)     float x, y;
(0471)     const float f = 1.5F;
    00B4F EB00      LDI	R16,0xB0
    00B50 E010      LDI	R17,0
    00B51 940E 4B33 CALL	elpm32
    00B53 870C      STD	Y+12,R16
    00B54 871D      STD	Y+13,R17
    00B55 872E      STD	Y+14,R18
    00B56 873F      STD	Y+15,R19
(0472)     x = number * 0.5F;
    00B57 EA0C      LDI	R16,0xAC
    00B58 E010      LDI	R17,0
    00B59 940E 4B33 CALL	elpm32
    00B5B 01CE      MOVW	R24,R28
    00B5C 9644      ADIW	R24,0x14
    00B5D 939A      ST	-Y,R25
    00B5E 938A      ST	-Y,R24
    00B5F 940E 4EF1 CALL	fpmule1
    00B61 8708      STD	Y+8,R16
    00B62 8719      STD	Y+9,R17
    00B63 872A      STD	Y+10,R18
    00B64 873B      STD	Y+11,R19
(0473)     y  = number;
    00B65 882C      LDD	R2,Y+20
    00B66 883D      LDD	R3,Y+21
    00B67 884E      LDD	R4,Y+22
    00B68 885F      LDD	R5,Y+23
    00B69 8228      ST	Y,R2
    00B6A 8239      STD	Y+1,R3
    00B6B 824A      STD	Y+2,R4
    00B6C 825B      STD	Y+3,R5
(0474)     i  = * ( long * ) &y;
    00B6D 01FE      MOVW	R30,R28
    00B6E 8020      LD	R2,Z
    00B6F 8031      LDD	R3,Z+1
    00B70 8042      LDD	R4,Z+2
    00B71 8053      LDD	R5,Z+3
    00B72 822C      STD	Y+4,R2
    00B73 823D      STD	Y+5,R3
    00B74 824E      STD	Y+6,R4
    00B75 825F      STD	Y+7,R5
(0475)     i  = 0x5f3759df - ( i >> 1 );  //卡马克
    00B76 802C      LDD	R2,Y+4
    00B77 803D      LDD	R3,Y+5
    00B78 804E      LDD	R4,Y+6
    00B79 805F      LDD	R5,Y+7
    00B7A 9455      ASR	R5
    00B7B 9447      ROR	R4
    00B7C 9437      ROR	R3
    00B7D 9427      ROR	R2
    00B7E ED4F      LDI	R20,0xDF
    00B7F E559      LDI	R21,0x59
    00B80 E367      LDI	R22,0x37
    00B81 E57F      LDI	R23,0x5F
    00B82 1942      SUB	R20,R2
    00B83 0953      SBC	R21,R3
    00B84 0964      SBC	R22,R4
    00B85 0975      SBC	R23,R5
    00B86 834C      STD	Y+4,R20
    00B87 835D      STD	Y+5,R21
    00B88 836E      STD	Y+6,R22
    00B89 837F      STD	Y+7,R23
(0476)   //i  = 0x5f375a86 - ( i >> 1 );  //Lomont
(0477)     y  = * ( float * ) &i;
    00B8A 01FE      MOVW	R30,R28
    00B8B 9634      ADIW	R30,4
    00B8C 8020      LD	R2,Z
    00B8D 8031      LDD	R3,Z+1
    00B8E 8042      LDD	R4,Z+2
    00B8F 8053      LDD	R5,Z+3
    00B90 8228      ST	Y,R2
    00B91 8239      STD	Y+1,R3
    00B92 824A      STD	Y+2,R4
    00B93 825B      STD	Y+3,R5
(0478)     y  = y * ( f - ( x * y * y ) );
    00B94 8028      LD	R2,Y
    00B95 8039      LDD	R3,Y+1
    00B96 804A      LDD	R4,Y+2
    00B97 805B      LDD	R5,Y+3
    00B98 846C      LDD	R6,Y+12
    00B99 847D      LDD	R7,Y+13
    00B9A 848E      LDD	R8,Y+14
    00B9B 849F      LDD	R9,Y+15
    00B9C 8508      LDD	R16,Y+8
    00B9D 8519      LDD	R17,Y+9
    00B9E 852A      LDD	R18,Y+10
    00B9F 853B      LDD	R19,Y+11
    00BA0 01CE      MOVW	R24,R28
    00BA1 939A      ST	-Y,R25
    00BA2 938A      ST	-Y,R24
    00BA3 940E 4EF1 CALL	fpmule1
    00BA5 01CE      MOVW	R24,R28
    00BA6 939A      ST	-Y,R25
    00BA7 938A      ST	-Y,R24
    00BA8 940E 4F06 CALL	fpmule1x
    00BAA 0183      MOVW	R16,R6
    00BAB 0194      MOVW	R18,R8
    00BAC 940E 4D14 CALL	fpsub2x
    00BAE 0181      MOVW	R16,R2
    00BAF 0192      MOVW	R18,R4
    00BB0 940E 4EFB CALL	fpmule2
    00BB2 8308      ST	Y,R16
    00BB3 8319      STD	Y+1,R17
    00BB4 832A      STD	Y+2,R18
    00BB5 833B      STD	Y+3,R19
(0479)     y  = y * ( f - ( x * y * y ) );
    00BB6 8028      LD	R2,Y
    00BB7 8039      LDD	R3,Y+1
    00BB8 804A      LDD	R4,Y+2
    00BB9 805B      LDD	R5,Y+3
    00BBA 846C      LDD	R6,Y+12
    00BBB 847D      LDD	R7,Y+13
    00BBC 848E      LDD	R8,Y+14
    00BBD 849F      LDD	R9,Y+15
    00BBE 8508      LDD	R16,Y+8
    00BBF 8519      LDD	R17,Y+9
    00BC0 852A      LDD	R18,Y+10
    00BC1 853B      LDD	R19,Y+11
    00BC2 01CE      MOVW	R24,R28
    00BC3 939A      ST	-Y,R25
    00BC4 938A      ST	-Y,R24
    00BC5 940E 4EF1 CALL	fpmule1
    00BC7 01CE      MOVW	R24,R28
    00BC8 939A      ST	-Y,R25
    00BC9 938A      ST	-Y,R24
    00BCA 940E 4F06 CALL	fpmule1x
    00BCC 0183      MOVW	R16,R6
    00BCD 0194      MOVW	R18,R8
    00BCE 940E 4D14 CALL	fpsub2x
    00BD0 0181      MOVW	R16,R2
    00BD1 0192      MOVW	R18,R4
    00BD2 940E 4EFB CALL	fpmule2
    00BD4 8308      ST	Y,R16
    00BD5 8319      STD	Y+1,R17
    00BD6 832A      STD	Y+2,R18
    00BD7 833B      STD	Y+3,R19
(0480)     return number * y;
    00BD8 890C      LDD	R16,Y+20
    00BD9 891D      LDD	R17,Y+21
    00BDA 892E      LDD	R18,Y+22
    00BDB 893F      LDD	R19,Y+23
    00BDC 01CE      MOVW	R24,R28
    00BDD 939A      ST	-Y,R25
    00BDE 938A      ST	-Y,R24
    00BDF 940E 4EF1 CALL	fpmule1
    00BE1 9660      ADIW	R28,0x10
    00BE2 940E 4BC5 CALL	pop_xgsetF000
    00BE4 9624      ADIW	R28,4
    00BE5 9508      RET
_debug:
  str2                 --> Y,+0
  val                  --> Y,+6
  str                  --> Y,+4
    00BE6 940E 4A66 CALL	push_arg4
    00BE8 9724      SBIW	R28,4
(0481) } 
(0482) //
(0483) //###############################################################//
(0484) //debug
(0485) void debug(UINT8 *str,UINT8 val)
(0486) {
(0487)  UINT8 str2[4]={0,0,0,0};
    00BE9 ED81      LDI	R24,0xD1
    00BEA E091      LDI	R25,1
    00BEB 01FE      MOVW	R30,R28
    00BEC E004      LDI	R16,4
    00BED E010      LDI	R17,0
    00BEE 93FA      ST	-Y,R31
    00BEF 93EA      ST	-Y,R30
    00BF0 939A      ST	-Y,R25
    00BF1 938A      ST	-Y,R24
    00BF2 940E 4C5B CALL	asgnblk
(0488)  str=str;
(0489)  val=val;
    00BF4 9628      ADIW	R28,0x8
    00BF5 9508      RET
_disk_initialize:
  state                --> R20
  drv                  --> R10
    00BF6 92AA      ST	-Y,R10
    00BF7 934A      ST	-Y,R20
    00BF8 2EA0      MOV	R10,R16
FILE: D:\LQD\software\software_src\diskio.c
(0001) 
(0002) 
(0003) /*-----------------------------------------------------------------------*/
(0004) /* Low level disk I/O module skeleton for FatFs     (C)ChaN, 2007        */
(0005) /*-----------------------------------------------------------------------*/
(0006) /* This is a stub disk I/O module that acts as front end of the existing */
(0007) /* disk I/O modules and attach it to FatFs module with common interface. */
(0008) /*-----------------------------------------------------------------------*/
(0009) 
(0010) #include "diskio.h"
(0011) #include "sd.h"
(0012) 
(0013) 
(0014) /*-----------------------------------------------------------------------*/
(0015) /* Correspondence between physical drive number and physical drive.      */
(0016) /* Note that Tiny-FatFs supports only single drive and always            */
(0017)                                       
(0018) 
(0019) ////////////////////////////
(0020) /*
(0021)    struct tm {
(0022)    	int tm_sec;   // 秒 seconds after the minute, 0 to 60
(0023)    	int tm_min;   // 分 minutes after the hour, 0 to 59
(0024) 	int tm_hour;  // 时 hours since midnight, 0 to 23*
(0025) 	int tm_mday;  // 日 day of the month, 1 to 31
(0026) 	int tm_mon;   // 月 months since January, 0 to 11
(0027) 	int tm_year;  // 年 years since 1900
(0028) 	int tm_wday;  // 星期 days since Sunday, 0 to 6
(0029) 	int tm_yday;  // 从元旦起的天数 days since January 1, 0 to 365
(0030)  	int tm_isdst; // 夏令时？？Daylight Savings Time flag
(0031)  	};
(0032) */
(0033) /*-----------------------------------------------------------------------*/
(0034) /* Inidialize a Drive                                                    */
(0035) 
(0036) DSTATUS disk_initialize ( 
(0037) BYTE drv				/* Physical drive nmuber (0..) */
(0038) )
(0039) {
(0040)     unsigned char state;
(0041) 
(0042)     if(drv)
    00BF9 20AA      TST	R10
    00BFA F011      BEQ	0x0BFD
(0043)     {
(0044)         return STA_NOINIT;  //仅支持磁盘0的操作
    00BFB E001      LDI	R16,1
    00BFC C00C      RJMP	0x0C09
(0045)     }
(0046) 
(0047)     state = SD_Init();
    00BFD 940E 2DB9 CALL	_SD_Init
    00BFF 2F40      MOV	R20,R16
(0048)     if(state == STA_NODISK)
    00C00 3002      CPI	R16,2
    00C01 F411      BNE	0x0C04
(0049)     {
(0050)         return STA_NODISK;
    00C02 E002      LDI	R16,2
    00C03 C005      RJMP	0x0C09
(0051)     }
(0052)     else if(state != 0)
    00C04 2344      TST	R20
    00C05 F011      BEQ	0x0C08
(0053)     {
(0054)         return STA_NOINIT;  //其他错误：初始化失败
    00C06 E001      LDI	R16,1
    00C07 C001      RJMP	0x0C09
(0055)     }
(0056)     else
(0057)     {
(0058)         return 0;           //初始化成功
    00C08 2700      CLR	R16
    00C09 9149      LD	R20,Y+
    00C0A 90A9      LD	R10,Y+
    00C0B 9508      RET
(0059)     }
(0060) }
(0061) 
(0062) 
(0063) 
(0064) /*-----------------------------------------------------------------------*/
(0065) /* Return Disk Status                                                    */
(0066) 
(0067) DSTATUS disk_status (
(0068) 	BYTE drv		/* Physical drive nmuber (0..) */
(0069) )
(0070) {
(0071)     if(drv)
_disk_status:
  drv                  --> R16
    00C0C 2300      TST	R16
    00C0D F011      BEQ	0x0C10
(0072)     {
(0073)         return STA_NOINIT;  //仅支持磁盘0操作
    00C0E E001      LDI	R16,1
    00C0F C001      RJMP	0x0C11
(0074)     }
(0075)     return 0;
    00C10 2700      CLR	R16
    00C11 9508      RET
_disk_read:
  res                  --> R10
  count                --> R20
  sector               --> Y,+10
  buff                 --> R12
  drv                  --> R14
    00C12 940E 4BAD CALL	push_xgset30FC
    00C14 0169      MOVW	R12,R18
    00C15 2EE0      MOV	R14,R16
    00C16 9722      SBIW	R28,2
    00C17 854E      LDD	R20,Y+14
(0076) }
(0077) 
(0078) 
(0079) 
(0080) /*-----------------------------------------------------------------------*/
(0081) /* Read Sector(s)                                                        */
(0082) 
(0083) DRESULT disk_read (
(0084) 	BYTE drv,		/* Physical drive nmuber (0..) */
(0085) 	BYTE *buff,		/* Data buffer to store read data */
(0086) 	DWORD sector,	/* Sector address (LBA) */
(0087) 	BYTE count		/* Number of sectors to read (1..255) */
(0088) )
(0089) {
(0090) 	unsigned char res=0;
    00C18 24AA      CLR	R10
(0091)     if (drv || !count)
    00C19 20EE      TST	R14
    00C1A F411      BNE	0x0C1D
    00C1B 2344      TST	R20
    00C1C F411      BNE	0x0C1F
(0092)     {    
(0093)         return RES_PARERR;  //仅支持单磁盘操作，count不能等于0，否则返回参数错误
    00C1D E004      LDI	R16,4
    00C1E C010      RJMP	0x0C2F
(0094)     }
(0095) 
(0096)     if(count==1)            //1个sector的读操作      
    00C1F 3041      CPI	R20,1
    00C20 F449      BNE	0x0C2A
(0097)     {                                                
(0098)         res = SD_Read_Sector(sector, buff);      
    00C21 82D9      STD	Y+1,R13
    00C22 82C8      ST	Y,R12
    00C23 850A      LDD	R16,Y+10
    00C24 851B      LDD	R17,Y+11
    00C25 852C      LDD	R18,Y+12
    00C26 853D      LDD	R19,Y+13
    00C27 940E 2E9F CALL	_SD_Read_Sector
    00C29 2EA0      MOV	R10,R16
(0099)     }                                                                                                 
(0100) 
(0101)     //处理返回值，将SD_driver.c的返回值转成ff.c的返回值
(0102)     if(res == 0x00)
    00C2A 20AA      TST	R10
    00C2B F411      BNE	0x0C2E
(0103)     {
(0104)         return RES_OK;
    00C2C 2700      CLR	R16
    00C2D C001      RJMP	0x0C2F
(0105)     }
(0106)     else
(0107)     {
(0108)         return RES_ERROR;
    00C2E E001      LDI	R16,1
    00C2F 9622      ADIW	R28,2
    00C30 940C 4B97 JMP	pop_xgset30FC
_disk_write:
  count                --> R12
  sector               --> Y,+8
  buff                 --> R10
  drv                  --> R14
    00C32 940E 4BAF CALL	push_xgset00FC
    00C34 0159      MOVW	R10,R18
    00C35 2EE0      MOV	R14,R16
    00C36 9722      SBIW	R28,2
    00C37 84CC      LDD	R12,Y+12
(0109)     }
(0110) }
(0111) 
(0112) 
(0113) 
(0114) /*-----------------------------------------------------------------------*/
(0115) /* Write Sector(s)                                                       */
(0116) 
(0117) #if _READONLY == 0
(0118) DRESULT disk_write (
(0119) 	BYTE drv,			/* Physical drive nmuber (0..) */
(0120) 	BYTE *buff,	        /* Data to be written */
(0121) 	DWORD sector,		/* Sector address (LBA) */
(0122) 	BYTE count			/* Number of sectors to write (1..255) */
(0123) )
(0124) {
(0125)     if (drv || !count)
    00C38 20EE      TST	R14
    00C39 F411      BNE	0x0C3C
    00C3A 20CC      TST	R12
    00C3B F411      BNE	0x0C3E
(0126)     {    
(0127)         return RES_PARERR;  //仅支持单磁盘操作，count不能等于0，否则返回参数错误
    00C3C E004      LDI	R16,4
    00C3D C009      RJMP	0x0C47
(0128)     }   
(0129)    // 读写操作
(0130)     SD_Write_Sector(sector,buff);
    00C3E 82B9      STD	Y+1,R11
    00C3F 82A8      ST	Y,R10
    00C40 8508      LDD	R16,Y+8
    00C41 8519      LDD	R17,Y+9
    00C42 852A      LDD	R18,Y+10
    00C43 853B      LDD	R19,Y+11
    00C44 940E 2E19 CALL	_SD_Write_Sector
(0131) 	  
(0132)     return RES_OK;
    00C46 2700      CLR	R16
    00C47 9622      ADIW	R28,2
    00C48 940C 4B90 JMP	pop_xgset00FC
_disk_ioctl:
  buff                 --> Y,+4
  ctrl                 --> Y,+2
  drv                  --> Y,+0
    00C4A 940E 4A66 CALL	push_arg4
(0133) }
(0134) #endif /* _READONLY */
(0135) 
(0136) 
(0137) 
(0138) /*-----------------------------------------------------------------------*/
(0139) /* Miscellaneous Functions                                               */
(0140) DRESULT disk_ioctl (
(0141) 	BYTE drv,		/* Physical drive nmuber (0..) */
(0142) 	BYTE ctrl,		/* Control code */
(0143) 	void *buff		/* Buffer to send/receive control data */
(0144) )
(0145) {
(0146)  	drv=drv;
(0147) 	ctrl=ctrl;
(0148) 	buff=buff;
(0149) 	return 0;
    00C4C 2700      CLR	R16
    00C4D 9624      ADIW	R28,4
    00C4E 9508      RET
(0150) }
(0151) DWORD get_fattime (void)
(0152) {
(0153) 
(0154)   return 1950466005;
_get_fattime:
    00C4F ED05      LDI	R16,0xD5
    00C50 EB1F      LDI	R17,0xBF
    00C51 E421      LDI	R18,0x41
    00C52 E734      LDI	R19,0x74
    00C53 9508      RET
ff.c:mem_cpy:
  s                    --> R12
  d                    --> R10
  cnt                  --> R20
  src                  --> R18
  dst                  --> R16
    00C54 940E 4BD8 CALL	push_xgset303C
    00C56 814E      LDD	R20,Y+6
    00C57 815F      LDD	R21,Y+7
FILE: D:\LQD\software\software_src\ff.c
(0001) /*----------------------------------------------------------------------------/
(0002) /  FatFs - FAT file system module  R0.09                  (C)ChaN, 2011
(0003) /-----------------------------------------------------------------------------/
(0004) / FatFs module is a generic FAT file system module for small embedded systems.
(0005) / This is a free software that opened for education, research and commercial
(0006) / developments under license policy of following terms.
(0007) /
(0008) /  Copyright (C) 2011, ChaN, all right reserved.
(0009) /
(0010) / * The FatFs module is a free software and there is NO WARRANTY.
(0011) / * No restriction on use. You can use, modify and redistribute it for
(0012) /   personal, non-profit or commercial products UNDER YOUR RESPONSIBILITY.
(0013) / * Redistributions of source code must retain the above copyright notice.
(0014) /
(0015) /-----------------------------------------------------------------------------/
(0016) / Feb 26,'06 R0.00  Prototype.
(0017) /
(0018) / Apr 29,'06 R0.01  First stable version.
(0019) /
(0020) / Jun 01,'06 R0.02  Added FAT12 support.
(0021) /                   Removed unbuffered mode.
(0022) /                   Fixed a problem on small (<32M) partition.
(0023) / Jun 10,'06 R0.02a Added a configuration option (_FS_MINIMUM).
(0024) /
(0025) / Sep 22,'06 R0.03  Added f_rename().
(0026) /                   Changed option _FS_MINIMUM to _FS_MINIMIZE.
(0027) / Dec 11,'06 R0.03a Improved cluster scan algorithm to write files fast.
(0028) /                   Fixed f_mkdir() creates incorrect directory on FAT32.
(0029) /
(0030) / Feb 04,'07 R0.04  Supported multiple drive system.
(0031) /                   Changed some interfaces for multiple drive system.
(0032) /                   Changed f_mountdrv() to f_mount().
(0033) /                   Added f_mkfs().
(0034) / Apr 01,'07 R0.04a Supported multiple partitions on a physical drive.
(0035) /                   Added a capability of extending file size to f_lseek().
(0036) /                   Added minimization level 3.
(0037) /                   Fixed an endian sensitive code in f_mkfs().
(0038) / May 05,'07 R0.04b Added a configuration option _USE_NTFLAG.
(0039) /                   Added FSInfo support.
(0040) /                   Fixed DBCS name can result FR_INVALID_NAME.
(0041) /                   Fixed short seek (<= csize) collapses the file object.
(0042) /
(0043) / Aug 25,'07 R0.05  Changed arguments of f_read(), f_write() and f_mkfs().
(0044) /                   Fixed f_mkfs() on FAT32 creates incorrect FSInfo.
(0045) /                   Fixed f_mkdir() on FAT32 creates incorrect directory.
(0046) / Feb 03,'08 R0.05a Added f_truncate() and f_utime().
(0047) /                   Fixed off by one error at FAT sub-type determination.
(0048) /                   Fixed btr in f_read() can be mistruncated.
(0049) /                   Fixed cached sector is not flushed when create and close without write.
(0050) /
(0051) / Apr 01,'08 R0.06  Added fputc(), fputs(), fprintf() and fgets().
(0052) /                   Improved performance of f_lseek() on moving to the same or following cluster.
(0053) /
(0054) / Apr 01,'09 R0.07  Merged Tiny-FatFs as a configuration option. (_FS_TINY)
(0055) /                   Added long file name feature.
(0056) /                   Added multiple code page feature.
(0057) /                   Added re-entrancy for multitask operation.
(0058) /                   Added auto cluster size selection to f_mkfs().
(0059) /                   Added rewind option to f_readdir().
(0060) /                   Changed result code of critical errors.
(0061) /                   Renamed string functions to avoid name collision.
(0062) / Apr 14,'09 R0.07a Separated out OS dependent code on reentrant cfg.
(0063) /                   Added multiple sector size feature.
(0064) / Jun 21,'09 R0.07c Fixed f_unlink() can return FR_OK on error.
(0065) /                   Fixed wrong cache control in f_lseek().
(0066) /                   Added relative path feature.
(0067) /                   Added f_chdir() and f_chdrive().
(0068) /                   Added proper case conversion to extended char.
(0069) / Nov 03,'09 R0.07e Separated out configuration options from ff.h to ffconf.h.
(0070) /                   Fixed f_unlink() fails to remove a sub-dir on _FS_RPATH.
(0071) /                   Fixed name matching error on the 13 char boundary.
(0072) /                   Added a configuration option, _LFN_UNICODE.
(0073) /                   Changed f_readdir() to return the SFN with always upper case on non-LFN cfg.
(0074) /
(0075) / May 15,'10 R0.08  Added a memory configuration option. (_USE_LFN = 3)
(0076) /                   Added file lock feature. (_FS_SHARE)
(0077) /                   Added fast seek feature. (_USE_FASTSEEK)
(0078) /                   Changed some types on the API, XCHAR->TCHAR.
(0079) /                   Changed fname member in the FILINFO structure on Unicode cfg.
(0080) /                   String functions support UTF-8 encoding files on Unicode cfg.
(0081) / Aug 16,'10 R0.08a Added f_getcwd(). (_FS_RPATH = 2)
(0082) /                   Added sector erase feature. (_USE_ERASE)
(0083) /                   Moved file lock semaphore table from fs object to the bss.
(0084) /                   Fixed a wrong directory entry is created on non-LFN cfg when the given name contains ';'.
(0085) /                   Fixed f_mkfs() creates wrong FAT32 volume.
(0086) / Jan 15,'11 R0.08b Fast seek feature is also applied to f_read() and f_write().
(0087) /                   f_lseek() reports required table size on creating CLMP.
(0088) /                   Extended format syntax of f_printf function.
(0089) /                   Ignores duplicated directory separators in given path names.
(0090) /
(0091) / Sep 06,'11 R0.09  f_mkfs() supports multiple partition to finish the multiple partition feature.
(0092) /                   Added f_fdisk(). (_MULTI_PARTITION = 2)
(0093) /---------------------------------------------------------------------------*/
(0094) 
(0095) #include "ff.h"			/* FatFs configurations and declarations */
(0096) #include "diskio.h"		/* Declarations of low level disk I/O functions */
(0097) #include <string.h>
(0098) 
(0099) /*--------------------------------------------------------------------------
(0100) 
(0101)    Module Private Definitions
(0102) 
(0103) ---------------------------------------------------------------------------*/
(0104) 
(0105) #if _FATFS != 6502	/* Revision ID */
(0106) #error Wrong include file (ff.h).
(0107) #endif
(0108) 
(0109) 
(0110) /* Definitions on sector size */
(0111) #if _MAX_SS != 512 && _MAX_SS != 1024 && _MAX_SS != 2048 && _MAX_SS != 4096
(0112) #error Wrong sector size.
(0113) #endif
(0114) #if _MAX_SS != 512
(0115) #define	SS(fs)	((fs)->ssize)	/* Variable sector size */
(0116) #else
(0117) #define	SS(fs)	512U			/* Fixed sector size */
(0118) #endif
(0119) 
(0120) 
(0121) /* Reentrancy related */
(0122) #if _FS_REENTRANT
(0123) #if _USE_LFN == 1
(0124) #error Static LFN work area must not be used in re-entrant configuration.
(0125) #endif
(0126) #define	ENTER_FF(fs)		{ if (!lock_fs(fs)) return FR_TIMEOUT; }
(0127) #define	LEAVE_FF(fs, res)	{ unlock_fs(fs, res); return res; }
(0128) #else
(0129) #define	ENTER_FF(fs)
(0130) #define LEAVE_FF(fs, res)	return res
(0131) #endif
(0132) 
(0133) #define	ABORT(fs, res)		{ fp->flag |= FA__ERROR; LEAVE_FF(fs, res); }
(0134) 
(0135) 
(0136) /* File shareing feature */
(0137) #if _FS_SHARE
(0138) #if _FS_READONLY
(0139) #error _FS_SHARE must be 0 on read-only cfg.
(0140) #endif
(0141) typedef struct {
(0142) 	FATFS *fs;				/* File ID 1, volume (NULL:blank entry) */
(0143) 	DWORD clu;				/* File ID 2, directory */
(0144) 	WORD idx;				/* File ID 3, directory index */
(0145) 	WORD ctr;				/* File open counter, 0:none, 0x01..0xFF:read open count, 0x100:write mode */
(0146) } FILESEM;
(0147) #endif
(0148) 
(0149) 
(0150) /* Misc definitions */
(0151) #define LD_CLUST(dir)	(((DWORD)LD_WORD(dir+DIR_FstClusHI)<<16) | LD_WORD(dir+DIR_FstClusLO))
(0152) #define ST_CLUST(dir,cl) {ST_WORD(dir+DIR_FstClusLO, cl); ST_WORD(dir+DIR_FstClusHI, (DWORD)cl>>16);}
(0153) 
(0154) 
(0155) /* DBCS code ranges and SBCS extend char conversion table */
(0156) 
(0157) #if _CODE_PAGE == 932	/* Japanese Shift-JIS */
(0158) #define _DF1S	0x81	/* DBC 1st byte range 1 start */
(0159) #define _DF1E	0x9F	/* DBC 1st byte range 1 end */
(0160) #define _DF2S	0xE0	/* DBC 1st byte range 2 start */
(0161) #define _DF2E	0xFC	/* DBC 1st byte range 2 end */
(0162) #define _DS1S	0x40	/* DBC 2nd byte range 1 start */
(0163) #define _DS1E	0x7E	/* DBC 2nd byte range 1 end */
(0164) #define _DS2S	0x80	/* DBC 2nd byte range 2 start */
(0165) #define _DS2E	0xFC	/* DBC 2nd byte range 2 end */
(0166) 
(0167) #elif _CODE_PAGE == 936	/* Simplified Chinese GBK */
(0168) #define _DF1S	0x81
(0169) #define _DF1E	0xFE
(0170) #define _DS1S	0x40
(0171) #define _DS1E	0x7E
(0172) #define _DS2S	0x80
(0173) #define _DS2E	0xFE
(0174) 
(0175) #elif _CODE_PAGE == 949	/* Korean */
(0176) #define _DF1S	0x81
(0177) #define _DF1E	0xFE
(0178) #define _DS1S	0x41
(0179) #define _DS1E	0x5A
(0180) #define _DS2S	0x61
(0181) #define _DS2E	0x7A
(0182) #define _DS3S	0x81
(0183) #define _DS3E	0xFE
(0184) 
(0185) #elif _CODE_PAGE == 950	/* Traditional Chinese Big5 */
(0186) #define _DF1S	0x81
(0187) #define _DF1E	0xFE
(0188) #define _DS1S	0x40
(0189) #define _DS1E	0x7E
(0190) #define _DS2S	0xA1
(0191) #define _DS2E	0xFE
(0192) 
(0193) #elif _CODE_PAGE == 437	/* U.S. (OEM) */
(0194) #define _DF1S	0
(0195) #define _EXCVT {0x80,0x9A,0x90,0x41,0x8E,0x41,0x8F,0x80,0x45,0x45,0x45,0x49,0x49,0x49,0x8E,0x8F,0x90,0x92,0x92,0x4F,0x99,0x4F,0x55,0x55,0x59,0x99,0x9A,0x9B,0x9C,0x9D,0x9E,0x9F, \
(0196) 				0x41,0x49,0x4F,0x55,0xA5,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0x21,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0197) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0198) 				0xE0,0xE1,0xE2,0xE3,0xE4,0xE5,0xE6,0xE7,0xE8,0xE9,0xEA,0xEB,0xEC,0xED,0xEE,0xEF,0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}
(0199) 
(0200) #elif _CODE_PAGE == 720	/* Arabic (OEM) */
(0201) #define _DF1S	0
(0202) #define _EXCVT {0x80,0x81,0x45,0x41,0x84,0x41,0x86,0x43,0x45,0x45,0x45,0x49,0x49,0x8D,0x8E,0x8F,0x90,0x92,0x92,0x93,0x94,0x95,0x49,0x49,0x98,0x99,0x9A,0x9B,0x9C,0x9D,0x9E,0x9F, \
(0203) 				0xA0,0xA1,0xA2,0xA3,0xA4,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0204) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0205) 				0xE0,0xE1,0xE2,0xE3,0xE4,0xE5,0xE6,0xE7,0xE8,0xE9,0xEA,0xEB,0xEC,0xED,0xEE,0xEF,0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}
(0206) 
(0207) #elif _CODE_PAGE == 737	/* Greek (OEM) */
(0208) #define _DF1S	0
(0209) #define _EXCVT {0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x92,0x92,0x93,0x94,0x95,0x96,0x97,0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87, \
(0210) 				0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x91,0xAA,0x92,0x93,0x94,0x95,0x96,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0211) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0212) 				0x97,0xEA,0xEB,0xEC,0xE4,0xED,0xEE,0xE7,0xE8,0xF1,0xEA,0xEB,0xEC,0xED,0xEE,0xEF,0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}
(0213) 
(0214) #elif _CODE_PAGE == 775	/* Baltic (OEM) */
(0215) #define _DF1S	0
(0216) #define _EXCVT {0x80,0x9A,0x91,0xA0,0x8E,0x95,0x8F,0x80,0xAD,0xED,0x8A,0x8A,0xA1,0x8D,0x8E,0x8F,0x90,0x92,0x92,0xE2,0x99,0x95,0x96,0x97,0x97,0x99,0x9A,0x9D,0x9C,0x9D,0x9E,0x9F, \
(0217) 				0xA0,0xA1,0xE0,0xA3,0xA3,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0218) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xB5,0xB6,0xB7,0xB8,0xBD,0xBE,0xC6,0xC7,0xA5,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0219) 				0xE0,0xE1,0xE2,0xE3,0xE5,0xE5,0xE6,0xE3,0xE8,0xE8,0xEA,0xEA,0xEE,0xED,0xEE,0xEF,0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}
(0220) 
(0221) #elif _CODE_PAGE == 850	/* Multilingual Latin 1 (OEM) */
(0222) #define _DF1S	0
(0223) #define _EXCVT {0x80,0x9A,0x90,0xB6,0x8E,0xB7,0x8F,0x80,0xD2,0xD3,0xD4,0xD8,0xD7,0xDE,0x8E,0x8F,0x90,0x92,0x92,0xE2,0x99,0xE3,0xEA,0xEB,0x59,0x99,0x9A,0x9D,0x9C,0x9D,0x9E,0x9F, \
(0224) 				0xB5,0xD6,0xE0,0xE9,0xA5,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0x21,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0225) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC7,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0226) 				0xE0,0xE1,0xE2,0xE3,0xE5,0xE5,0xE6,0xE7,0xE7,0xE9,0xEA,0xEB,0xED,0xED,0xEE,0xEF,0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}
(0227) 
(0228) #elif _CODE_PAGE == 852	/* Latin 2 (OEM) */
(0229) #define _DF1S	0
(0230) #define _EXCVT {0x80,0x9A,0x90,0xB6,0x8E,0xDE,0x8F,0x80,0x9D,0xD3,0x8A,0x8A,0xD7,0x8D,0x8E,0x8F,0x90,0x91,0x91,0xE2,0x99,0x95,0x95,0x97,0x97,0x99,0x9A,0x9B,0x9B,0x9D,0x9E,0x9F, \
(0231) 				0xB5,0xD6,0xE0,0xE9,0xA4,0xA4,0xA6,0xA6,0xA8,0xA8,0xAA,0x8D,0xAC,0xB8,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBD,0xBF, \
(0232) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC6,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD1,0xD1,0xD2,0xD3,0xD2,0xD5,0xD6,0xD7,0xB7,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0233) 				0xE0,0xE1,0xE2,0xE3,0xE3,0xD5,0xE6,0xE6,0xE8,0xE9,0xE8,0xEB,0xED,0xED,0xDD,0xEF,0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xEB,0xFC,0xFC,0xFE,0xFF}
(0234) 
(0235) #elif _CODE_PAGE == 855	/* Cyrillic (OEM) */
(0236) #define _DF1S	0
(0237) #define _EXCVT {0x81,0x81,0x83,0x83,0x85,0x85,0x87,0x87,0x89,0x89,0x8B,0x8B,0x8D,0x8D,0x8F,0x8F,0x91,0x91,0x93,0x93,0x95,0x95,0x97,0x97,0x99,0x99,0x9B,0x9B,0x9D,0x9D,0x9F,0x9F, \
(0238) 				0xA1,0xA1,0xA3,0xA3,0xA5,0xA5,0xA7,0xA7,0xA9,0xA9,0xAB,0xAB,0xAD,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB6,0xB6,0xB8,0xB8,0xB9,0xBA,0xBB,0xBC,0xBE,0xBE,0xBF, \
(0239) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC7,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD1,0xD1,0xD3,0xD3,0xD5,0xD5,0xD7,0xD7,0xDD,0xD9,0xDA,0xDB,0xDC,0xDD,0xE0,0xDF, \
(0240) 				0xE0,0xE2,0xE2,0xE4,0xE4,0xE6,0xE6,0xE8,0xE8,0xEA,0xEA,0xEC,0xEC,0xEE,0xEE,0xEF,0xF0,0xF2,0xF2,0xF4,0xF4,0xF6,0xF6,0xF8,0xF8,0xFA,0xFA,0xFC,0xFC,0xFD,0xFE,0xFF}
(0241) 
(0242) #elif _CODE_PAGE == 857	/* Turkish (OEM) */
(0243) #define _DF1S	0
(0244) #define _EXCVT {0x80,0x9A,0x90,0xB6,0x8E,0xB7,0x8F,0x80,0xD2,0xD3,0xD4,0xD8,0xD7,0x98,0x8E,0x8F,0x90,0x92,0x92,0xE2,0x99,0xE3,0xEA,0xEB,0x98,0x99,0x9A,0x9D,0x9C,0x9D,0x9E,0x9E, \
(0245) 				0xB5,0xD6,0xE0,0xE9,0xA5,0xA5,0xA6,0xA6,0xA8,0xA9,0xAA,0xAB,0xAC,0x21,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0246) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC7,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0247) 				0xE0,0xE1,0xE2,0xE3,0xE5,0xE5,0xE6,0xE7,0xE8,0xE9,0xEA,0xEB,0xDE,0x59,0xEE,0xEF,0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}
(0248) 
(0249) #elif _CODE_PAGE == 858	/* Multilingual Latin 1 + Euro (OEM) */
(0250) #define _DF1S	0
(0251) #define _EXCVT {0x80,0x9A,0x90,0xB6,0x8E,0xB7,0x8F,0x80,0xD2,0xD3,0xD4,0xD8,0xD7,0xDE,0x8E,0x8F,0x90,0x92,0x92,0xE2,0x99,0xE3,0xEA,0xEB,0x59,0x99,0x9A,0x9D,0x9C,0x9D,0x9E,0x9F, \
(0252) 				0xB5,0xD6,0xE0,0xE9,0xA5,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0x21,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0253) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC7,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD1,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0254) 				0xE0,0xE1,0xE2,0xE3,0xE5,0xE5,0xE6,0xE7,0xE7,0xE9,0xEA,0xEB,0xED,0xED,0xEE,0xEF,0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}
(0255) 
(0256) #elif _CODE_PAGE == 862	/* Hebrew (OEM) */
(0257) #define _DF1S	0
(0258) #define _EXCVT {0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x9A,0x9B,0x9C,0x9D,0x9E,0x9F, \
(0259) 				0x41,0x49,0x4F,0x55,0xA5,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0x21,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0260) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0261) 				0xE0,0xE1,0xE2,0xE3,0xE4,0xE5,0xE6,0xE7,0xE8,0xE9,0xEA,0xEB,0xEC,0xED,0xEE,0xEF,0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}
(0262) 
(0263) #elif _CODE_PAGE == 866	/* Russian (OEM) */
(0264) #define _DF1S	0
(0265) #define _EXCVT {0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x9A,0x9B,0x9C,0x9D,0x9E,0x9F, \
(0266) 				0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0267) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0268) 				0x90,0x91,0x92,0x93,0x9d,0x95,0x96,0x97,0x98,0x99,0x9A,0x9B,0x9C,0x9D,0x9E,0x9F,0xF0,0xF0,0xF2,0xF2,0xF4,0xF4,0xF6,0xF6,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}
(0269) 
(0270) #elif _CODE_PAGE == 874	/* Thai (OEM, Windows) */
(0271) #define _DF1S	0
(0272) #define _EXCVT {0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x9A,0x9B,0x9C,0x9D,0x9E,0x9F, \
(0273) 				0xA0,0xA1,0xA2,0xA3,0xA4,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0274) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0275) 				0xE0,0xE1,0xE2,0xE3,0xE4,0xE5,0xE6,0xE7,0xE8,0xE9,0xEA,0xEB,0xEC,0xED,0xEE,0xEF,0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}
(0276) 
(0277) #elif _CODE_PAGE == 1250 /* Central Europe (Windows) */
(0278) #define _DF1S	0
(0279) #define _EXCVT {0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x8A,0x9B,0x8C,0x8D,0x8E,0x8F, \
(0280) 				0xA0,0xA1,0xA2,0xA3,0xA4,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xA3,0xB4,0xB5,0xB6,0xB7,0xB8,0xA5,0xAA,0xBB,0xBC,0xBD,0xBC,0xAF, \
(0281) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0282) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xF7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xFF}
(0283) 
(0284) #elif _CODE_PAGE == 1251 /* Cyrillic (Windows) */
(0285) #define _DF1S	0
(0286) #define _EXCVT {0x80,0x81,0x82,0x82,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x80,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x8A,0x9B,0x8C,0x8D,0x8E,0x8F, \
(0287) 				0xA0,0xA2,0xA2,0xA3,0xA4,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xB2,0xA5,0xB5,0xB6,0xB7,0xA8,0xB9,0xAA,0xBB,0xA3,0xBD,0xBD,0xAF, \
(0288) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0289) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF}
(0290) 
(0291) #elif _CODE_PAGE == 1252 /* Latin 1 (Windows) */
(0292) #define _DF1S	0
(0293) #define _EXCVT {0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0xAd,0x9B,0x8C,0x9D,0xAE,0x9F, \
(0294) 				0xA0,0x21,0xA2,0xA3,0xA4,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0295) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0296) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xF7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0x9F}
(0297) 
(0298) #elif _CODE_PAGE == 1253 /* Greek (Windows) */
(0299) #define _DF1S	0
(0300) #define _EXCVT {0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x9A,0x9B,0x9C,0x9D,0x9E,0x9F, \
(0301) 				0xA0,0xA1,0xA2,0xA3,0xA4,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0302) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xA2,0xB8,0xB9,0xBA, \
(0303) 				0xE0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xF2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xFB,0xBC,0xFD,0xBF,0xFF}
(0304) 
(0305) #elif _CODE_PAGE == 1254 /* Turkish (Windows) */
(0306) #define _DF1S	0
(0307) #define _EXCVT {0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x8A,0x9B,0x8C,0x9D,0x9E,0x9F, \
(0308) 				0xA0,0x21,0xA2,0xA3,0xA4,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0309) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0310) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xF7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0x9F}
(0311) 
(0312) #elif _CODE_PAGE == 1255 /* Hebrew (Windows) */
(0313) #define _DF1S	0
(0314) #define _EXCVT {0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x9A,0x9B,0x9C,0x9D,0x9E,0x9F, \
(0315) 				0xA0,0x21,0xA2,0xA3,0xA4,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0316) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0317) 				0xE0,0xE1,0xE2,0xE3,0xE4,0xE5,0xE6,0xE7,0xE8,0xE9,0xEA,0xEB,0xEC,0xED,0xEE,0xEF,0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}
(0318) 
(0319) #elif _CODE_PAGE == 1256 /* Arabic (Windows) */
(0320) #define _DF1S	0
(0321) #define _EXCVT {0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x9A,0x9B,0x8C,0x9D,0x9E,0x9F, \
(0322) 				0xA0,0xA1,0xA2,0xA3,0xA4,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0323) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0324) 				0x41,0xE1,0x41,0xE3,0xE4,0xE5,0xE6,0x43,0x45,0x45,0x45,0x45,0xEC,0xED,0x49,0x49,0xF0,0xF1,0xF2,0xF3,0x4F,0xF5,0xF6,0xF7,0xF8,0x55,0xFA,0x55,0x55,0xFD,0xFE,0xFF}
(0325) 
(0326) #elif _CODE_PAGE == 1257 /* Baltic (Windows) */
(0327) #define _DF1S	0
(0328) #define _EXCVT {0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x9A,0x9B,0x9C,0x9D,0x9E,0x9F, \
(0329) 				0xA0,0xA1,0xA2,0xA3,0xA4,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xA8,0xB9,0xAA,0xBB,0xBC,0xBD,0xBE,0xAF, \
(0330) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0331) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xF7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xFF}
(0332) 
(0333) #elif _CODE_PAGE == 1258 /* Vietnam (OEM, Windows) */
(0334) #define _DF1S	0
(0335) #define _EXCVT {0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x9A,0x9B,0xAC,0x9D,0x9E,0x9F, \
(0336) 				0xA0,0x21,0xA2,0xA3,0xA4,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0337) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0338) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xEC,0xCD,0xCE,0xCF,0xD0,0xD1,0xF2,0xD3,0xD4,0xD5,0xD6,0xF7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xFE,0x9F}
(0339) 
(0340) #elif _CODE_PAGE == 1	/* ASCII (for only non-LFN cfg) */
(0341) #if _USE_LFN
(0342) #error Cannot use LFN feature without valid code page.
(0343) #endif
(0344) #define _DF1S	0
(0345) 
(0346) #else
(0347) #error Unknown code page
(0348) 
(0349) #endif
(0350) 
(0351) 
(0352) /* Character code support macros */
(0353) #define IsUpper(c)	(((c)>='A')&&((c)<='Z'))
(0354) #define IsLower(c)	(((c)>='a')&&((c)<='z'))
(0355) #define IsDigit(c)	(((c)>='0')&&((c)<='9'))
(0356) 
(0357) #if _DF1S		/* Code page is DBCS */
(0358) 
(0359) #ifdef _DF2S	/* Two 1st byte areas */
(0360) #define IsDBCS1(c)	(((BYTE)(c) >= _DF1S && (BYTE)(c) <= _DF1E) || ((BYTE)(c) >= _DF2S && (BYTE)(c) <= _DF2E))
(0361) #else			/* One 1st byte area */
(0362) #define IsDBCS1(c)	((BYTE)(c) >= _DF1S && (BYTE)(c) <= _DF1E)
(0363) #endif
(0364) 
(0365) #ifdef _DS3S	/* Three 2nd byte areas */
(0366) #define IsDBCS2(c)	(((BYTE)(c) >= _DS1S && (BYTE)(c) <= _DS1E) || ((BYTE)(c) >= _DS2S && (BYTE)(c) <= _DS2E) || ((BYTE)(c) >= _DS3S && (BYTE)(c) <= _DS3E))
(0367) #else			/* Two 2nd byte areas */
(0368) #define IsDBCS2(c)	(((BYTE)(c) >= _DS1S && (BYTE)(c) <= _DS1E) || ((BYTE)(c) >= _DS2S && (BYTE)(c) <= _DS2E))
(0369) #endif
(0370) 
(0371) #else			/* Code page is SBCS */
(0372) 
(0373) #define IsDBCS1(c)	0
(0374) #define IsDBCS2(c)	0
(0375) 
(0376) #endif /* _DF1S */
(0377) 
(0378) 
(0379) /* Name status flags */
(0380) #define NS			11		/* Index of name status byte in fn[] */
(0381) #define NS_LOSS		0x01	/* Out of 8.3 format */
(0382) #define NS_LFN		0x02	/* Force to create LFN entry */
(0383) #define NS_LAST		0x04	/* Last segment */
(0384) #define NS_BODY		0x08	/* Lower case flag (body) */
(0385) #define NS_EXT		0x10	/* Lower case flag (ext) */
(0386) #define NS_DOT		0x20	/* Dot entry */
(0387) 
(0388) 
(0389) /* FAT sub-type boundaries */
(0390) /* Note that the FAT spec by Microsoft says 4085 but Windows works with 4087! */
(0391) #define MIN_FAT16	4086	/* Minimum number of clusters for FAT16 */
(0392) #define	MIN_FAT32	65526	/* Minimum number of clusters for FAT32 */
(0393) 
(0394) 
(0395) /* FatFs refers the members in the FAT structures as byte array instead of
(0396) / structure member because the structure is not binary compatible between
(0397) / different platforms */
(0398) 
(0399) #define BS_jmpBoot			0	/* Jump instruction (3) */
(0400) #define BS_OEMName			3	/* OEM name (8) */
(0401) #define BPB_BytsPerSec		11	/* Sector size [byte] (2) */
(0402) #define BPB_SecPerClus		13	/* Cluster size [sector] (1) */
(0403) #define BPB_RsvdSecCnt		14	/* Size of reserved area [sector] (2) */
(0404) #define BPB_NumFATs			16	/* Number of FAT copies (1) */
(0405) #define BPB_RootEntCnt		17	/* Number of root dir entries for FAT12/16 (2) */
(0406) #define BPB_TotSec16		19	/* Volume size [sector] (2) */
(0407) #define BPB_Media			21	/* Media descriptor (1) */
(0408) #define BPB_FATSz16			22	/* FAT size [sector] (2) */
(0409) #define BPB_SecPerTrk		24	/* Track size [sector] (2) */
(0410) #define BPB_NumHeads		26	/* Number of heads (2) */
(0411) #define BPB_HiddSec			28	/* Number of special hidden sectors (4) */
(0412) #define BPB_TotSec32		32	/* Volume size [sector] (4) */
(0413) #define BS_DrvNum			36	/* Physical drive number (2) */
(0414) #define BS_BootSig			38	/* Extended boot signature (1) */
(0415) #define BS_VolID			39	/* Volume serial number (4) */
(0416) #define BS_VolLab			43	/* Volume label (8) */
(0417) #define BS_FilSysType		54	/* File system type (1) */
(0418) #define BPB_FATSz32			36	/* FAT size [sector] (4) */
(0419) #define BPB_ExtFlags		40	/* Extended flags (2) */
(0420) #define BPB_FSVer			42	/* File system version (2) */
(0421) #define BPB_RootClus		44	/* Root dir first cluster (4) */
(0422) #define BPB_FSInfo			48	/* Offset of FSInfo sector (2) */
(0423) #define BPB_BkBootSec		50	/* Offset of backup boot sectot (2) */
(0424) #define BS_DrvNum32			64	/* Physical drive number (2) */
(0425) #define BS_BootSig32		66	/* Extended boot signature (1) */
(0426) #define BS_VolID32			67	/* Volume serial number (4) */
(0427) #define BS_VolLab32			71	/* Volume label (8) */
(0428) #define BS_FilSysType32		82	/* File system type (1) */
(0429) #define	FSI_LeadSig			0	/* FSI: Leading signature (4) */
(0430) #define	FSI_StrucSig		484	/* FSI: Structure signature (4) */
(0431) #define	FSI_Free_Count		488	/* FSI: Number of free clusters (4) */
(0432) #define	FSI_Nxt_Free		492	/* FSI: Last allocated cluster (4) */
(0433) #define MBR_Table			446	/* MBR: Partition table offset (2) */
(0434) #define	SZ_PTE				16	/* MBR: Size of a partition table entry */
(0435) #define BS_55AA				510	/* Boot sector signature (2) */
(0436) 
(0437) #define	DIR_Name			0	/* Short file name (11) */
(0438) #define	DIR_Attr			11	/* Attribute (1) */
(0439) #define	DIR_NTres			12	/* NT flag (1) */
(0440) #define	DIR_CrtTime			14	/* Created time (2) */
(0441) #define	DIR_CrtDate			16	/* Created date (2) */
(0442) #define	DIR_FstClusHI		20	/* Higher 16-bit of first cluster (2) */
(0443) #define	DIR_WrtTime			22	/* Modified time (2) */
(0444) #define	DIR_WrtDate			24	/* Modified date (2) */
(0445) #define	DIR_FstClusLO		26	/* Lower 16-bit of first cluster (2) */
(0446) #define	DIR_FileSize		28	/* File size (4) */
(0447) #define	LDIR_Ord			0	/* LFN entry order and LLE flag (1) */
(0448) #define	LDIR_Attr			11	/* LFN attribute (1) */
(0449) #define	LDIR_Type			12	/* LFN type (1) */
(0450) #define	LDIR_Chksum			13	/* Sum of corresponding SFN entry */
(0451) #define	LDIR_FstClusLO		26	/* Filled by zero (0) */
(0452) #define	SZ_DIR				32		/* Size of a directory entry */
(0453) #define	LLE					0x40	/* Last long entry flag in LDIR_Ord */
(0454) #define	DDE					0xE5	/* Deleted directory enrty mark in DIR_Name[0] */
(0455) #define	NDDE				0x05	/* Replacement of a character collides with DDE */
(0456) 
(0457) 
(0458) /*------------------------------------------------------------*/
(0459) /* Module private work area                                   */
(0460) /*------------------------------------------------------------*/
(0461) /* Note that uninitialized variables with static duration are
(0462) /  zeroed/nulled at start-up. If not, the compiler or start-up
(0463) /  routine is out of ANSI-C standard.
(0464) */
(0465) 
(0466) #if _VOLUMES
(0467) static
(0468) FATFS *FatFs[_VOLUMES];	/* Pointer to the file system objects (logical drives) */
(0469) #else
(0470) #error Number of volumes must not be 0.
(0471) #endif
(0472) 
(0473) static
(0474) WORD Fsid;				/* File system mount ID */
(0475) 
(0476) #if _FS_RPATH
(0477) static
(0478) BYTE CurrVol;			/* Current drive */
(0479) #endif
(0480) 
(0481) #if _FS_SHARE
(0482) static
(0483) FILESEM	Files[_FS_SHARE];	/* File lock semaphores */
(0484) #endif
(0485) 
(0486) #if _USE_LFN == 0			/* No LFN feature */
(0487) #define	DEF_NAMEBUF			BYTE sfn[12]
(0488) #define INIT_BUF(dobj)		(dobj).fn = sfn
(0489) #define	FREE_BUF()
(0490) 
(0491) #elif _USE_LFN == 1			/* LFN feature with static working buffer */
(0492) static WCHAR LfnBuf[_MAX_LFN+1];
(0493) #define	DEF_NAMEBUF			BYTE sfn[12]
(0494) #define INIT_BUF(dobj)		{ (dobj).fn = sfn; (dobj).lfn = LfnBuf; }
(0495) #define	FREE_BUF()
(0496) 
(0497) #elif _USE_LFN == 2 		/* LFN feature with dynamic working buffer on the stack */
(0498) #define	DEF_NAMEBUF			BYTE sfn[12]; WCHAR lbuf[_MAX_LFN+1]
(0499) #define INIT_BUF(dobj)		{ (dobj).fn = sfn; (dobj).lfn = lbuf; }
(0500) #define	FREE_BUF()
(0501) 
(0502) #elif _USE_LFN == 3 		/* LFN feature with dynamic working buffer on the heap */
(0503) #define	DEF_NAMEBUF			BYTE sfn[12]; WCHAR *lfn
(0504) #define INIT_BUF(dobj)		{ lfn = ff_memalloc((_MAX_LFN + 1) * 2); \
(0505) 							  if (!lfn) LEAVE_FF((dobj).fs, FR_NOT_ENOUGH_CORE); \
(0506) 							  (dobj).lfn = lfn;	(dobj).fn = sfn; }
(0507) #define	FREE_BUF()			ff_memfree(lfn)
(0508) 
(0509) #else
(0510) #error Wrong LFN configuration.
(0511) #endif
(0512) 
(0513) 
(0514) 
(0515) 
(0516) /*--------------------------------------------------------------------------
(0517) 
(0518)    Module Private Functions
(0519) 
(0520) ---------------------------------------------------------------------------*/
(0521) 
(0522) 
(0523) /*-----------------------------------------------------------------------*/
(0524) /* String functions                                                      */
(0525) /*-----------------------------------------------------------------------*/
(0526) 
(0527) /* Copy memory to memory */
(0528) static
(0529) void mem_cpy (void* dst, const void* src, UINT cnt) {
(0530) 	BYTE *d = (BYTE*)dst;
    00C58 0158      MOVW	R10,R16
(0531) 	const BYTE *s = (const BYTE*)src;
    00C59 0169      MOVW	R12,R18
    00C5A C006      RJMP	0x0C61
(0532) 
(0533) #if _WORD_ACCESS == 1
(0534) 	while (cnt >= sizeof(int)) {
(0535) 		*(int*)d = *(int*)s;
(0536) 		d += sizeof(int); s += sizeof(int);
(0537) 		cnt -= sizeof(int);
(0538) 	}
(0539) #endif
(0540) 	while (cnt--)
(0541) 		*d++ = *s++;
    00C5B 01F6      MOVW	R30,R12
    00C5C 01D5      MOVW	R26,R10
    00C5D 9001      LD	R0,Z+
    00C5E 016F      MOVW	R12,R30
    00C5F 920D      ST	X+,R0
    00C60 015D      MOVW	R10,R26
    00C61 011A      MOVW	R2,R20
    00C62 5041      SUBI	R20,1
    00C63 4050      SBCI	R21,0
    00C64 2022      TST	R2
    00C65 F7A9      BNE	0x0C5B
    00C66 2033      TST	R3
    00C67 F799      BNE	0x0C5B
    00C68 940C 4BDF JMP	pop_xgset303C
ff.c:mem_set:
  d                    --> R10
  cnt                  --> R20
  val                  --> R18
  dst                  --> R16
    00C6A 940E 4BB6 CALL	push_xgset300C
    00C6C 814C      LDD	R20,Y+4
    00C6D 815D      LDD	R21,Y+5
(0542) }
(0543) 
(0544) /* Fill memory */
(0545) static
(0546) void mem_set (void* dst, int val, UINT cnt) {
(0547) 	BYTE *d = (BYTE*)dst;
    00C6E 0158      MOVW	R10,R16
    00C6F C003      RJMP	0x0C73
(0548) 
(0549) 	while (cnt--)
(0550) 		*d++ = (BYTE)val;
    00C70 01F5      MOVW	R30,R10
    00C71 9321      ST	Z+,R18
    00C72 015F      MOVW	R10,R30
    00C73 011A      MOVW	R2,R20
    00C74 5041      SUBI	R20,1
    00C75 4050      SBCI	R21,0
    00C76 2022      TST	R2
    00C77 F7C1      BNE	0x0C70
    00C78 2033      TST	R3
    00C79 F7B1      BNE	0x0C70
    00C7A 940C 4BBB JMP	pop_xgset300C
ff.c:mem_cmp:
  s                    --> R14
  d                    --> R12
  r                    --> R10
  cnt                  --> R20
  src                  --> R18
  dst                  --> R16
    00C7C 940E 4BAD CALL	push_xgset30FC
    00C7E 8548      LDD	R20,Y+8
    00C7F 8559      LDD	R21,Y+9
(0551) }
(0552) 
(0553) /* Compare memory to memory */
(0554) static
(0555) int mem_cmp (const void* dst, const void* src, UINT cnt) {
(0556) 	const BYTE *d = (const BYTE *)dst, *s = (const BYTE *)src;
    00C80 0168      MOVW	R12,R16
    00C81 0179      MOVW	R14,R18
(0557) 	int r = 0;
    00C82 24AA      CLR	R10
    00C83 24BB      CLR	R11
(0558) 
(0559) 	while (cnt-- && (r = *d++ - *s++) == 0) ;
    00C84 011A      MOVW	R2,R20
    00C85 5041      SUBI	R20,1
    00C86 4050      SBCI	R21,0
    00C87 2022      TST	R2
    00C88 F411      BNE	0x0C8B
    00C89 2033      TST	R3
    00C8A F079      BEQ	0x0C9A
    00C8B 01F7      MOVW	R30,R14
    00C8C 9021      LD	R2,Z+
    00C8D 017F      MOVW	R14,R30
    00C8E 2433      CLR	R3
    00C8F 01F6      MOVW	R30,R12
    00C90 9041      LD	R4,Z+
    00C91 016F      MOVW	R12,R30
    00C92 2455      CLR	R5
    00C93 1842      SUB	R4,R2
    00C94 0853      SBC	R5,R3
    00C95 0152      MOVW	R10,R4
    00C96 20AA      TST	R10
    00C97 F411      BNE	0x0C9A
    00C98 20BB      TST	R11
    00C99 F351      BEQ	0x0C84
(0560) 	return r;
    00C9A 0185      MOVW	R16,R10
    00C9B 940C 4B97 JMP	pop_xgset30FC
(0561) }
(0562) 
(0563) /* Check if chr is contained in the string */
(0564) static
(0565) int chk_chr (const char* str, int chr) {
ff.c:chk_chr:
  chr                  --> R18
  str                  --> R16
    00C9D C002      RJMP	0x0CA0
(0566) 	while (*str && *str != chr) str++;
    00C9E 5F0F      SUBI	R16,0xFF
    00C9F 4F1F      SBCI	R17,0xFF
    00CA0 01F8      MOVW	R30,R16
    00CA1 8020      LD	R2,Z
    00CA2 2433      CLR	R3
    00CA3 2022      TST	R2
    00CA4 F021      BEQ	0x0CA9
    00CA5 2433      CLR	R3
    00CA6 1622      CP	R2,R18
    00CA7 0633      CPC	R3,R19
    00CA8 F7A9      BNE	0x0C9E
(0567) 	return *str;
    00CA9 01F8      MOVW	R30,R16
    00CAA 8100      LD	R16,Z
    00CAB 2711      CLR	R17
    00CAC 9508      RET
ff.c:move_window:
  nf                   --> R10
  wsect                --> Y,+5
  sector               --> Y,+13
  fs                   --> R20
    00CAD 933A      ST	-Y,R19
    00CAE 932A      ST	-Y,R18
    00CAF 940E 4BB6 CALL	push_xgset300C
    00CB1 01A8      MOVW	R20,R16
    00CB2 9729      SBIW	R28,0x9
(0568) }
(0569) 
(0570) 
(0571) 
(0572) /*-----------------------------------------------------------------------*/
(0573) /* Request/Release grant to access the volume                            */
(0574) /*-----------------------------------------------------------------------*/
(0575) #if _FS_REENTRANT
(0576) 
(0577) static
(0578) int lock_fs (
(0579) 	FATFS *fs		/* File system object */
(0580) )
(0581) {
(0582) 	return ff_req_grant(fs->sobj);
(0583) }
(0584) 
(0585) 
(0586) static
(0587) void unlock_fs (
(0588) 	FATFS *fs,		/* File system object */
(0589) 	FRESULT res		/* Result code to be returned */
(0590) )
(0591) {
(0592) 	if (res != FR_NOT_ENABLED &&
(0593) 		res != FR_INVALID_DRIVE &&
(0594) 		res != FR_INVALID_OBJECT &&
(0595) 		res != FR_TIMEOUT) {
(0596) 		ff_rel_grant(fs->sobj);
(0597) 	}
(0598) }
(0599) #endif
(0600) 
(0601) 
(0602) 
(0603) /*-----------------------------------------------------------------------*/
(0604) /* File shareing control functions                                       */
(0605) /*-----------------------------------------------------------------------*/
(0606) #if _FS_SHARE
(0607) 
(0608) static
(0609) FRESULT chk_lock (	/* Check if the file can be accessed */
(0610) 	DIR* dj,		/* Directory object pointing the file to be checked */
(0611) 	int acc			/* Desired access (0:Read, 1:Write, 2:Delete/Rename) */
(0612) )
(0613) {
(0614) 	UINT i, be;
(0615) 
(0616) 	/* Search file semaphore table */
(0617) 	for (i = be = 0; i < _FS_SHARE; i++) {
(0618) 		if (Files[i].fs) {	/* Existing entry */
(0619) 			if (Files[i].fs == dj->fs &&	 	/* Check if the file matched with an open file */
(0620) 				Files[i].clu == dj->sclust &&
(0621) 				Files[i].idx == dj->index) break;
(0622) 		} else {			/* Blank entry */
(0623) 			be++;
(0624) 		}
(0625) 	}
(0626) 	if (i == _FS_SHARE)	/* The file is not opened */
(0627) 		return (be || acc == 2) ? FR_OK : FR_TOO_MANY_OPEN_FILES;	/* Is there a blank entry for new file? */
(0628) 
(0629) 	/* The file has been opened. Reject any open against writing file and all write mode open */
(0630) 	return (acc || Files[i].ctr == 0x100) ? FR_LOCKED : FR_OK;
(0631) }
(0632) 
(0633) 
(0634) static
(0635) int enq_lock (void)	/* Check if an entry is available for a new file */
(0636) {
(0637) 	UINT i;
(0638) 
(0639) 	for (i = 0; i < _FS_SHARE && Files[i].fs; i++) ;
(0640) 	return (i == _FS_SHARE) ? 0 : 1;
(0641) }
(0642) 
(0643) 
(0644) static
(0645) UINT inc_lock (	/* Increment file open counter and returns its index (0:int error) */
(0646) 	DIR* dj,	/* Directory object pointing the file to register or increment */
(0647) 	int acc		/* Desired access mode (0:Read, !0:Write) */
(0648) )
(0649) {
(0650) 	UINT i;
(0651) 
(0652) 
(0653) 	for (i = 0; i < _FS_SHARE; i++) {	/* Find the file */
(0654) 		if (Files[i].fs == dj->fs &&
(0655) 			Files[i].clu == dj->sclust &&
(0656) 			Files[i].idx == dj->index) break;
(0657) 	}
(0658) 
(0659) 	if (i == _FS_SHARE) {				/* Not opened. Register it as new. */
(0660) 		for (i = 0; i < _FS_SHARE && Files[i].fs; i++) ;
(0661) 		if (i == _FS_SHARE) return 0;	/* No space to register (int err) */
(0662) 		Files[i].fs = dj->fs;
(0663) 		Files[i].clu = dj->sclust;
(0664) 		Files[i].idx = dj->index;
(0665) 		Files[i].ctr = 0;
(0666) 	}
(0667) 
(0668) 	if (acc && Files[i].ctr) return 0;	/* Access violation (int err) */
(0669) 
(0670) 	Files[i].ctr = acc ? 0x100 : Files[i].ctr + 1;	/* Set semaphore value */
(0671) 
(0672) 	return i + 1;
(0673) }
(0674) 
(0675) 
(0676) static
(0677) FRESULT dec_lock (	/* Decrement file open counter */
(0678) 	UINT i			/* Semaphore index */
(0679) )
(0680) {
(0681) 	WORD n;
(0682) 	FRESULT res;
(0683) 
(0684) 
(0685) 	if (--i < _FS_SHARE) {
(0686) 		n = Files[i].ctr;
(0687) 		if (n == 0x100) n = 0;
(0688) 		if (n) n--;
(0689) 		Files[i].ctr = n;
(0690) 		if (!n) Files[i].fs = 0;
(0691) 		res = FR_OK;
(0692) 	} else {
(0693) 		res = FR_INT_ERR;
(0694) 	}
(0695) 	return res;
(0696) }
(0697) 
(0698) 
(0699) static
(0700) void clear_lock (	/* Clear lock entries of the volume */
(0701) 	FATFS *fs
(0702) )
(0703) {
(0704) 	UINT i;
(0705) 
(0706) 	for (i = 0; i < _FS_SHARE; i++) {
(0707) 		if (Files[i].fs == fs) Files[i].fs = 0;
(0708) 	}
(0709) }
(0710) #endif
(0711) 
(0712) 
(0713) 
(0714) /*-----------------------------------------------------------------------*/
(0715) /* Change window offset                                                  */
(0716) /*-----------------------------------------------------------------------*/
(0717) 
(0718) static
(0719) FRESULT move_window (
(0720) 	FATFS *fs,		/* File system object */
(0721) 	DWORD sector	/* Sector number to make appearance in the fs->win[] */
(0722) )					/* Move to zero only writes back dirty window */
(0723) {
(0724) 	DWORD wsect;
(0725) 
(0726) 
(0727) 	wsect = fs->winsect;
    00CB3 01FA      MOVW	R30,R20
    00CB4 96BA      ADIW	R30,0x2A
    00CB5 8020      LD	R2,Z
    00CB6 8031      LDD	R3,Z+1
    00CB7 8042      LDD	R4,Z+2
    00CB8 8053      LDD	R5,Z+3
    00CB9 822D      STD	Y+5,R2
    00CBA 823E      STD	Y+6,R3
    00CBB 824F      STD	Y+7,R4
    00CBC 8658      STD	Y+8,R5
(0728) 	if (wsect != sector) {	/* Changed current window */
    00CBD 842D      LDD	R2,Y+13
    00CBE 843E      LDD	R3,Y+14
    00CBF 844F      LDD	R4,Y+15
    00CC0 8858      LDD	R5,Y+16
    00CC1 806D      LDD	R6,Y+5
    00CC2 807E      LDD	R7,Y+6
    00CC3 808F      LDD	R8,Y+7
    00CC4 8498      LDD	R9,Y+8
    00CC5 1462      CP	R6,R2
    00CC6 0473      CPC	R7,R3
    00CC7 0484      CPC	R8,R4
    00CC8 0495      CPC	R9,R5
    00CC9 F409      BNE	0x0CCB
    00CCA C07E      RJMP	0x0D49
(0729) #if !_FS_READONLY
(0730) 		if (fs->wflag) {	/* Write back dirty window if needed */
    00CCB 01FA      MOVW	R30,R20
    00CCC 8024      LDD	R2,Z+4
    00CCD 2022      TST	R2
    00CCE F409      BNE	0x0CD0
    00CCF C055      RJMP	0x0D25
(0731) 			if (disk_write(fs->drv, fs->win, wsect, 1) != RES_OK)
    00CD0 E081      LDI	R24,1
    00CD1 838C      STD	Y+4,R24
    00CD2 0113      MOVW	R2,R6
    00CD3 0124      MOVW	R4,R8
    00CD4 8228      ST	Y,R2
    00CD5 8239      STD	Y+1,R3
    00CD6 824A      STD	Y+2,R4
    00CD7 825B      STD	Y+3,R5
    00CD8 019A      MOVW	R18,R20
    00CD9 5D22      SUBI	R18,0xD2
    00CDA 4F3F      SBCI	R19,0xFF
    00CDB 8101      LDD	R16,Z+1
    00CDC 940E 0C32 CALL	_disk_write
    00CDE 2300      TST	R16
    00CDF F011      BEQ	0x0CE2
(0732) 				return FR_DISK_ERR;
    00CE0 E001      LDI	R16,1
    00CE1 C068      RJMP	0x0D4A
(0733) 			fs->wflag = 0;
    00CE2 2422      CLR	R2
    00CE3 01FA      MOVW	R30,R20
    00CE4 8224      STD	Z+4,R2
(0734) 			if (wsect < (fs->fatbase + fs->fsize)) {	/* In FAT area */
    00CE5 8C22      LDD	R2,Z+26
    00CE6 8C33      LDD	R3,Z+27
    00CE7 8C44      LDD	R4,Z+28
    00CE8 8C55      LDD	R5,Z+29
    00CE9 967E      ADIW	R30,0x1E
    00CEA 8060      LD	R6,Z
    00CEB 8071      LDD	R7,Z+1
    00CEC 8082      LDD	R8,Z+2
    00CED 8093      LDD	R9,Z+3
    00CEE 0C62      ADD	R6,R2
    00CEF 1C73      ADC	R7,R3
    00CF0 1C84      ADC	R8,R4
    00CF1 1C95      ADC	R9,R5
    00CF2 802D      LDD	R2,Y+5
    00CF3 803E      LDD	R3,Y+6
    00CF4 804F      LDD	R4,Y+7
    00CF5 8458      LDD	R5,Y+8
    00CF6 1426      CP	R2,R6
    00CF7 0437      CPC	R3,R7
    00CF8 0448      CPC	R4,R8
    00CF9 0459      CPC	R5,R9
    00CFA F550      BCC	0x0D25
(0735) 				BYTE nf;
(0736) 				for (nf = fs->n_fats; nf > 1; nf--) {	/* Reflect the change to all FAT copies */
    00CFB 01FA      MOVW	R30,R20
    00CFC 80A3      LDD	R10,Z+3
    00CFD C024      RJMP	0x0D22
(0737) 					wsect += fs->fsize;
    00CFE 01FA      MOVW	R30,R20
    00CFF 967A      ADIW	R30,0x1A
    00D00 8020      LD	R2,Z
    00D01 8031      LDD	R3,Z+1
    00D02 8042      LDD	R4,Z+2
    00D03 8053      LDD	R5,Z+3
    00D04 806D      LDD	R6,Y+5
    00D05 807E      LDD	R7,Y+6
    00D06 808F      LDD	R8,Y+7
    00D07 8498      LDD	R9,Y+8
    00D08 0C62      ADD	R6,R2
    00D09 1C73      ADC	R7,R3
    00D0A 1C84      ADC	R8,R4
    00D0B 1C95      ADC	R9,R5
    00D0C 826D      STD	Y+5,R6
    00D0D 827E      STD	Y+6,R7
    00D0E 828F      STD	Y+7,R8
    00D0F 8698      STD	Y+8,R9
(0738) 					disk_write(fs->drv, fs->win, wsect, 1);
    00D10 E081      LDI	R24,1
    00D11 838C      STD	Y+4,R24
    00D12 802D      LDD	R2,Y+5
    00D13 803E      LDD	R3,Y+6
    00D14 804F      LDD	R4,Y+7
    00D15 8458      LDD	R5,Y+8
    00D16 8228      ST	Y,R2
    00D17 8239      STD	Y+1,R3
    00D18 824A      STD	Y+2,R4
    00D19 825B      STD	Y+3,R5
    00D1A 019A      MOVW	R18,R20
    00D1B 5D22      SUBI	R18,0xD2
    00D1C 4F3F      SBCI	R19,0xFF
    00D1D 01FA      MOVW	R30,R20
    00D1E 8101      LDD	R16,Z+1
    00D1F 940E 0C32 CALL	_disk_write
    00D21 94AA      DEC	R10
    00D22 E081      LDI	R24,1
    00D23 158A      CP	R24,R10
    00D24 F2C8      BCS	0x0CFE
(0739) 				}
(0740) 			}
(0741) 		}
(0742) #endif
(0743) 		if (sector) {
    00D25 842D      LDD	R2,Y+13
    00D26 843E      LDD	R3,Y+14
    00D27 844F      LDD	R4,Y+15
    00D28 8858      LDD	R5,Y+16
    00D29 9488      BCLR	0
    00D2A 2022      TST	R2
    00D2B 0432      CPC	R3,R2
    00D2C 0442      CPC	R4,R2
    00D2D 0452      CPC	R5,R2
    00D2E F0D1      BEQ	0x0D49
(0744) 			if (disk_read(fs->drv, fs->win, sector, 1) != RES_OK)
    00D2F E081      LDI	R24,1
    00D30 838C      STD	Y+4,R24
    00D31 8228      ST	Y,R2
    00D32 8239      STD	Y+1,R3
    00D33 824A      STD	Y+2,R4
    00D34 825B      STD	Y+3,R5
    00D35 019A      MOVW	R18,R20
    00D36 5D22      SUBI	R18,0xD2
    00D37 4F3F      SBCI	R19,0xFF
    00D38 01FA      MOVW	R30,R20
    00D39 8101      LDD	R16,Z+1
    00D3A 940E 0C12 CALL	_disk_read
    00D3C 2300      TST	R16
    00D3D F011      BEQ	0x0D40
(0745) 				return FR_DISK_ERR;
    00D3E E001      LDI	R16,1
    00D3F C00A      RJMP	0x0D4A
(0746) 			fs->winsect = sector;
    00D40 842D      LDD	R2,Y+13
    00D41 843E      LDD	R3,Y+14
    00D42 844F      LDD	R4,Y+15
    00D43 8858      LDD	R5,Y+16
    00D44 01FA      MOVW	R30,R20
    00D45 A622      STD	Z+42,R2
    00D46 A633      STD	Z+43,R3
    00D47 A644      STD	Z+44,R4
    00D48 A655      STD	Z+45,R5
(0747) 		}
(0748) 	}
(0749) 
(0750) 	return FR_OK;
    00D49 2700      CLR	R16
    00D4A 9629      ADIW	R28,0x9
    00D4B 940E 4BBB CALL	pop_xgset300C
    00D4D 9622      ADIW	R28,2
    00D4E 9508      RET
ff.c:sync:
  res                  --> R20
  fs                   --> R22
    00D4F 940E 4BC0 CALL	push_xgsetF000
    00D51 01B8      MOVW	R22,R16
    00D52 9725      SBIW	R28,5
(0751) }
(0752) 
(0753) 
(0754) 
(0755) 
(0756) /*-----------------------------------------------------------------------*/
(0757) /* Clean-up cached data                                                  */
(0758) /*-----------------------------------------------------------------------*/
(0759) #if !_FS_READONLY
(0760) static
(0761) FRESULT sync (	/* FR_OK: successful, FR_DISK_ERR: failed */
(0762) 	FATFS *fs	/* File system object */
(0763) )
(0764) {
(0765) 	FRESULT res;
(0766) 
(0767) 
(0768) 	res = move_window(fs, 0);
    00D53 E080      LDI	R24,0
    00D54 E090      LDI	R25,0
    00D55 E0A0      LDI	R26,0
    00D56 E0B0      LDI	R27,0
    00D57 83A8      ST	Y,R26
    00D58 83B9      STD	Y+1,R27
    00D59 019C      MOVW	R18,R24
    00D5A 018B      MOVW	R16,R22
    00D5B DF51      RCALL	ff.c:move_window
    00D5C 2F40      MOV	R20,R16
(0769) 	if (res == FR_OK) {
    00D5D 2300      TST	R16
    00D5E F009      BEQ	0x0D60
    00D5F C0C0      RJMP	0x0E20
(0770) 		/* Update FSInfo sector if needed */
(0771) 		if (fs->fs_type == FS_FAT32 && fs->fsi_flag) {
    00D60 01FB      MOVW	R30,R22
    00D61 8180      LD	R24,Z
    00D62 3083      CPI	R24,3
    00D63 F009      BEQ	0x0D65
    00D64 C0AC      RJMP	0x0E11
    00D65 8025      LDD	R2,Z+5
    00D66 2022      TST	R2
    00D67 F409      BNE	0x0D69
    00D68 C0A8      RJMP	0x0E11
(0772) 			fs->winsect = 0;
    00D69 96BA      ADIW	R30,0x2A
    00D6A E080      LDI	R24,0
    00D6B 8380      ST	Z,R24
    00D6C 8381      STD	Z+1,R24
    00D6D 8382      STD	Z+2,R24
    00D6E 8383      STD	Z+3,R24
(0773) 			/* Create FSInfo structure */
(0774) 			mem_set(fs->win, 0, 512);
    00D6F E080      LDI	R24,0
    00D70 E092      LDI	R25,2
    00D71 8399      STD	Y+1,R25
    00D72 8388      ST	Y,R24
    00D73 2722      CLR	R18
    00D74 2733      CLR	R19
    00D75 018B      MOVW	R16,R22
    00D76 5D02      SUBI	R16,0xD2
    00D77 4F1F      SBCI	R17,0xFF
    00D78 DEF1      RCALL	ff.c:mem_set
(0775) 			ST_WORD(fs->win+BS_55AA, 0xAA55);
    00D79 E585      LDI	R24,0x55
    00D7A 01FB      MOVW	R30,R22
    00D7B 5DE4      SUBI	R30,0xD4
    00D7C 4FFD      SBCI	R31,0xFD
    00D7D 8380      ST	Z,R24
    00D7E 52EC      SUBI	R30,0x2C
    00D7F 40F2      SBCI	R31,2
    00D80 EA8A      LDI	R24,0xAA
    00D81 5DE3      SUBI	R30,0xD3
    00D82 4FFD      SBCI	R31,0xFD
    00D83 8380      ST	Z,R24
    00D84 52ED      SUBI	R30,0x2D
    00D85 40F2      SBCI	R31,2
(0776) 			ST_DWORD(fs->win+FSI_LeadSig, 0x41615252);
    00D86 E582      LDI	R24,0x52
    00D87 A786      STD	Z+46,R24
    00D88 A787      STD	Z+47,R24
    00D89 E681      LDI	R24,0x61
    00D8A AB80      STD	Z+48,R24
    00D8B E481      LDI	R24,0x41
    00D8C AB81      STD	Z+49,R24
(0777) 			ST_DWORD(fs->win+FSI_StrucSig, 0x61417272);
    00D8D E782      LDI	R24,0x72
    00D8E 5EEE      SUBI	R30,0xEE
    00D8F 4FFD      SBCI	R31,0xFD
    00D90 8380      ST	Z,R24
    00D91 51E2      SUBI	R30,0x12
    00D92 40F2      SBCI	R31,2
    00D93 5EED      SUBI	R30,0xED
    00D94 4FFD      SBCI	R31,0xFD
    00D95 8380      ST	Z,R24
    00D96 51E3      SUBI	R30,0x13
    00D97 40F2      SBCI	R31,2
    00D98 E481      LDI	R24,0x41
    00D99 5EEC      SUBI	R30,0xEC
    00D9A 4FFD      SBCI	R31,0xFD
    00D9B 8380      ST	Z,R24
    00D9C 51E4      SUBI	R30,0x14
    00D9D 40F2      SBCI	R31,2
    00D9E E681      LDI	R24,0x61
    00D9F 5EEB      SUBI	R30,0xEB
    00DA0 4FFD      SBCI	R31,0xFD
    00DA1 8380      ST	Z,R24
    00DA2 51E5      SUBI	R30,0x15
    00DA3 40F2      SBCI	R31,2
(0778) 			ST_DWORD(fs->win+FSI_Free_Count, fs->free_clust);
    00DA4 8426      LDD	R2,Z+14
    00DA5 8437      LDD	R3,Z+15
    00DA6 8840      LDD	R4,Z+16
    00DA7 8851      LDD	R5,Z+17
    00DA8 5EEA      SUBI	R30,0xEA
    00DA9 4FFD      SBCI	R31,0xFD
    00DAA 8220      ST	Z,R2
    00DAB 51E6      SUBI	R30,0x16
    00DAC 40F2      SBCI	R31,2
    00DAD 8426      LDD	R2,Z+14
    00DAE 8437      LDD	R3,Z+15
    00DAF 2C23      MOV	R2,R3
    00DB0 2433      CLR	R3
    00DB1 5EE9      SUBI	R30,0xE9
    00DB2 4FFD      SBCI	R31,0xFD
    00DB3 8220      ST	Z,R2
    00DB4 51E7      SUBI	R30,0x17
    00DB5 40F2      SBCI	R31,2
    00DB6 8426      LDD	R2,Z+14
    00DB7 8437      LDD	R3,Z+15
    00DB8 8840      LDD	R4,Z+16
    00DB9 8851      LDD	R5,Z+17
    00DBA 0112      MOVW	R2,R4
    00DBB 2444      CLR	R4
    00DBC 2455      CLR	R5
    00DBD 5EE8      SUBI	R30,0xE8
    00DBE 4FFD      SBCI	R31,0xFD
    00DBF 8220      ST	Z,R2
    00DC0 51E8      SUBI	R30,0x18
    00DC1 40F2      SBCI	R31,2
    00DC2 E188      LDI	R24,0x18
    00DC3 E090      LDI	R25,0
    00DC4 8506      LDD	R16,Z+14
    00DC5 8517      LDD	R17,Z+15
    00DC6 8920      LDD	R18,Z+16
    00DC7 8931      LDD	R19,Z+17
    00DC8 938A      ST	-Y,R24
    00DC9 940E 4C4F CALL	lsr32
    00DCB 01FB      MOVW	R30,R22
    00DCC 5EE7      SUBI	R30,0xE7
    00DCD 4FFD      SBCI	R31,0xFD
    00DCE 8300      ST	Z,R16
    00DCF 51E9      SUBI	R30,0x19
    00DD0 40F2      SBCI	R31,2
(0779) 			ST_DWORD(fs->win+FSI_Nxt_Free, fs->last_clust);
    00DD1 8422      LDD	R2,Z+10
    00DD2 8433      LDD	R3,Z+11
    00DD3 8444      LDD	R4,Z+12
    00DD4 8455      LDD	R5,Z+13
    00DD5 5EE6      SUBI	R30,0xE6
    00DD6 4FFD      SBCI	R31,0xFD
    00DD7 8220      ST	Z,R2
    00DD8 51EA      SUBI	R30,0x1A
    00DD9 40F2      SBCI	R31,2
    00DDA 8422      LDD	R2,Z+10
    00DDB 8433      LDD	R3,Z+11
    00DDC 2C23      MOV	R2,R3
    00DDD 2433      CLR	R3
    00DDE 5EE5      SUBI	R30,0xE5
    00DDF 4FFD      SBCI	R31,0xFD
    00DE0 8220      ST	Z,R2
    00DE1 51EB      SUBI	R30,0x1B
    00DE2 40F2      SBCI	R31,2
    00DE3 8422      LDD	R2,Z+10
    00DE4 8433      LDD	R3,Z+11
    00DE5 8444      LDD	R4,Z+12
    00DE6 8455      LDD	R5,Z+13
    00DE7 0112      MOVW	R2,R4
    00DE8 2444      CLR	R4
    00DE9 2455      CLR	R5
    00DEA 5EE4      SUBI	R30,0xE4
    00DEB 4FFD      SBCI	R31,0xFD
    00DEC 8220      ST	Z,R2
    00DED 51EC      SUBI	R30,0x1C
    00DEE 40F2      SBCI	R31,2
    00DEF E188      LDI	R24,0x18
    00DF0 E090      LDI	R25,0
    00DF1 8502      LDD	R16,Z+10
    00DF2 8513      LDD	R17,Z+11
    00DF3 8524      LDD	R18,Z+12
    00DF4 8535      LDD	R19,Z+13
    00DF5 938A      ST	-Y,R24
    00DF6 940E 4C4F CALL	lsr32
    00DF8 01FB      MOVW	R30,R22
    00DF9 5EE3      SUBI	R30,0xE3
    00DFA 4FFD      SBCI	R31,0xFD
    00DFB 8300      ST	Z,R16
    00DFC 51ED      SUBI	R30,0x1D
    00DFD 40F2      SBCI	R31,2
(0780) 			/* Write it into the FSInfo sector */
(0781) 			disk_write(fs->drv, fs->win, fs->fsi_sector, 1);
    00DFE E081      LDI	R24,1
    00DFF 838C      STD	Y+4,R24
    00E00 8822      LDD	R2,Z+18
    00E01 8833      LDD	R3,Z+19
    00E02 8844      LDD	R4,Z+20
    00E03 8855      LDD	R5,Z+21
    00E04 8228      ST	Y,R2
    00E05 8239      STD	Y+1,R3
    00E06 824A      STD	Y+2,R4
    00E07 825B      STD	Y+3,R5
    00E08 019F      MOVW	R18,R30
    00E09 5D22      SUBI	R18,0xD2
    00E0A 4F3F      SBCI	R19,0xFF
    00E0B 8101      LDD	R16,Z+1
    00E0C 940E 0C32 CALL	_disk_write
(0782) 			fs->fsi_flag = 0;
    00E0E 2422      CLR	R2
    00E0F 01FB      MOVW	R30,R22
    00E10 8225      STD	Z+5,R2
(0783) 		}
(0784) 		/* Make sure that no pending write process in the physical drive */
(0785) 		if (disk_ioctl(fs->drv, CTRL_SYNC, 0) != RES_OK)
    00E11 2422      CLR	R2
    00E12 2433      CLR	R3
    00E13 8239      STD	Y+1,R3
    00E14 8228      ST	Y,R2
    00E15 2722      CLR	R18
    00E16 2733      CLR	R19
    00E17 01FB      MOVW	R30,R22
    00E18 8101      LDD	R16,Z+1
    00E19 2711      CLR	R17
    00E1A 940E 0C4A CALL	_disk_ioctl
    00E1C 3000      CPI	R16,0
    00E1D 0701      CPC	R16,R17
    00E1E F009      BEQ	0x0E20
(0786) 			res = FR_DISK_ERR;
    00E1F E041      LDI	R20,1
(0787) 	}
(0788) 
(0789) 	return res;
    00E20 2F04      MOV	R16,R20
    00E21 9625      ADIW	R28,5
    00E22 940C 4BC5 JMP	pop_xgsetF000
_clust2sect:
  clst                 --> Y,+6
  fs                   --> R10
    00E24 933A      ST	-Y,R19
    00E25 932A      ST	-Y,R18
    00E26 940E 4BCA CALL	push_xgsetF00C
    00E28 0158      MOVW	R10,R16
(0790) }
(0791) #endif
(0792) 
(0793) 
(0794) 
(0795) 
(0796) /*-----------------------------------------------------------------------*/
(0797) /* Get sector# from cluster#                                             */
(0798) /*-----------------------------------------------------------------------*/
(0799) 
(0800) 
(0801) DWORD clust2sect (	/* !=0: Sector number, 0: Failed - invalid cluster# */
(0802) 	FATFS *fs,		/* File system object */
(0803) 	DWORD clst		/* Cluster# to be converted */
(0804) )
(0805) {
(0806) 	clst -= 2;
    00E29 E042      LDI	R20,2
    00E2A E050      LDI	R21,0
    00E2B E060      LDI	R22,0
    00E2C E070      LDI	R23,0
    00E2D 802E      LDD	R2,Y+6
    00E2E 803F      LDD	R3,Y+7
    00E2F 8448      LDD	R4,Y+8
    00E30 8459      LDD	R5,Y+9
    00E31 1A24      SUB	R2,R20
    00E32 0A35      SBC	R3,R21
    00E33 0A46      SBC	R4,R22
    00E34 0A57      SBC	R5,R23
    00E35 822E      STD	Y+6,R2
    00E36 823F      STD	Y+7,R3
    00E37 8648      STD	Y+8,R4
    00E38 8659      STD	Y+9,R5
(0807) 	if (clst >= (fs->n_fatent - 2)) return 0;		/* Invalid cluster# */
    00E39 E042      LDI	R20,2
    00E3A E050      LDI	R21,0
    00E3B E060      LDI	R22,0
    00E3C E070      LDI	R23,0
    00E3D 01F5      MOVW	R30,R10
    00E3E 9676      ADIW	R30,0x16
    00E3F 8020      LD	R2,Z
    00E40 8031      LDD	R3,Z+1
    00E41 8042      LDD	R4,Z+2
    00E42 8053      LDD	R5,Z+3
    00E43 1A24      SUB	R2,R20
    00E44 0A35      SBC	R3,R21
    00E45 0A46      SBC	R4,R22
    00E46 0A57      SBC	R5,R23
    00E47 806E      LDD	R6,Y+6
    00E48 807F      LDD	R7,Y+7
    00E49 8488      LDD	R8,Y+8
    00E4A 8499      LDD	R9,Y+9
    00E4B 1462      CP	R6,R2
    00E4C 0473      CPC	R7,R3
    00E4D 0484      CPC	R8,R4
    00E4E 0495      CPC	R9,R5
    00E4F F028      BCS	0x0E55
    00E50 E000      LDI	R16,0
    00E51 E010      LDI	R17,0
    00E52 E020      LDI	R18,0
    00E53 E030      LDI	R19,0
    00E54 C01D      RJMP	0x0E72
(0808) 	return clst * fs->csize + fs->database;
    00E55 01F5      MOVW	R30,R10
    00E56 9632      ADIW	R30,2
    00E57 8020      LD	R2,Z
    00E58 2433      CLR	R3
    00E59 2444      CLR	R4
    00E5A 2455      CLR	R5
    00E5B 810E      LDD	R16,Y+6
    00E5C 811F      LDD	R17,Y+7
    00E5D 8528      LDD	R18,Y+8
    00E5E 8539      LDD	R19,Y+9
    00E5F 925A      ST	-Y,R5
    00E60 924A      ST	-Y,R4
    00E61 923A      ST	-Y,R3
    00E62 922A      ST	-Y,R2
    00E63 940E 4B57 CALL	empy32s|empy32u
    00E65 0118      MOVW	R2,R16
    00E66 0129      MOVW	R4,R18
    00E67 01F5      MOVW	R30,R10
    00E68 A066      LDD	R6,Z+38
    00E69 A077      LDD	R7,Z+39
    00E6A A480      LDD	R8,Z+40
    00E6B A491      LDD	R9,Z+41
    00E6C 0C26      ADD	R2,R6
    00E6D 1C37      ADC	R3,R7
    00E6E 1C48      ADC	R4,R8
    00E6F 1C59      ADC	R5,R9
    00E70 0181      MOVW	R16,R2
    00E71 0192      MOVW	R18,R4
    00E72 940E 4BD1 CALL	pop_xgsetF00C
    00E74 9622      ADIW	R28,2
    00E75 9508      RET
_get_fat:
  wc                   --> R14
  p                    --> R10
  bc                   --> R10
  clst                 --> Y,+12
  fs                   --> R12
    00E76 933A      ST	-Y,R19
    00E77 932A      ST	-Y,R18
    00E78 940E 4BAB CALL	push_xgsetF0FC
    00E7A 0168      MOVW	R12,R16
    00E7B 9722      SBIW	R28,2
(0809) }
(0810) 
(0811) 
(0812) 
(0813) 
(0814) /*-----------------------------------------------------------------------*/
(0815) /* FAT access - Read value of a FAT entry                                */
(0816) /*-----------------------------------------------------------------------*/
(0817) 
(0818) 
(0819) DWORD get_fat (	/* 0xFFFFFFFF:Disk error, 1:Internal error, Else:Cluster status */
(0820) 	FATFS *fs,	/* File system object */
(0821) 	DWORD clst	/* Cluster# to get the link information */
(0822) )
(0823) {
(0824) 	UINT wc, bc;
(0825) 	BYTE *p;
(0826) 
(0827) 
(0828) 	if (clst < 2 || clst >= fs->n_fatent)	/* Chack range */
    00E7C E042      LDI	R20,2
    00E7D E050      LDI	R21,0
    00E7E E060      LDI	R22,0
    00E7F E070      LDI	R23,0
    00E80 842C      LDD	R2,Y+12
    00E81 843D      LDD	R3,Y+13
    00E82 844E      LDD	R4,Y+14
    00E83 845F      LDD	R5,Y+15
    00E84 1624      CP	R2,R20
    00E85 0635      CPC	R3,R21
    00E86 0646      CPC	R4,R22
    00E87 0657      CPC	R5,R23
    00E88 F078      BCS	0x0E98
    00E89 01F6      MOVW	R30,R12
    00E8A 9676      ADIW	R30,0x16
    00E8B 8020      LD	R2,Z
    00E8C 8031      LDD	R3,Z+1
    00E8D 8042      LDD	R4,Z+2
    00E8E 8053      LDD	R5,Z+3
    00E8F 846C      LDD	R6,Y+12
    00E90 847D      LDD	R7,Y+13
    00E91 848E      LDD	R8,Y+14
    00E92 849F      LDD	R9,Y+15
    00E93 1462      CP	R6,R2
    00E94 0473      CPC	R7,R3
    00E95 0484      CPC	R8,R4
    00E96 0495      CPC	R9,R5
    00E97 F028      BCS	0x0E9D
(0829) 		return 1;
    00E98 E001      LDI	R16,1
    00E99 E010      LDI	R17,0
    00E9A E020      LDI	R18,0
    00E9B E030      LDI	R19,0
    00E9C C124      RJMP	0x0FC1
(0830) 
(0831) 	switch (fs->fs_type) {
    00E9D 01F6      MOVW	R30,R12
    00E9E 80A0      LD	R10,Z
    00E9F 24BB      CLR	R11
    00EA0 01C5      MOVW	R24,R10
    00EA1 3081      CPI	R24,1
    00EA2 E0E0      LDI	R30,0
    00EA3 079E      CPC	R25,R30
    00EA4 F059      BEQ	0x0EB0
    00EA5 3082      CPI	R24,2
    00EA6 E0E0      LDI	R30,0
    00EA7 079E      CPC	R25,R30
    00EA8 F409      BNE	0x0EAA
    00EA9 C06F      RJMP	0x0F19
    00EAA 3083      CPI	R24,3
    00EAB E0E0      LDI	R30,0
    00EAC 079E      CPC	R25,R30
    00EAD F409      BNE	0x0EAF
    00EAE C0A6      RJMP	0x0F55
    00EAF C10D      RJMP	0x0FBD
(0832) 	case FS_FAT12 :
(0833) 		bc = (UINT)clst; bc += bc / 2;
    00EB0 84AC      LDD	R10,Y+12
    00EB1 84BD      LDD	R11,Y+13
    00EB2 0115      MOVW	R2,R10
    00EB3 9436      LSR	R3
    00EB4 9427      ROR	R2
    00EB5 0CA2      ADD	R10,R2
    00EB6 1CB3      ADC	R11,R3
(0834) 		if (move_window(fs, fs->fatbase + (bc / SS(fs)))) break;
    00EB7 E029      LDI	R18,0x9
    00EB8 E030      LDI	R19,0
    00EB9 0185      MOVW	R16,R10
    00EBA 940E 4C48 CALL	lsr16
    00EBC 0118      MOVW	R2,R16
    00EBD 2444      CLR	R4
    00EBE 2455      CLR	R5
    00EBF 01F6      MOVW	R30,R12
    00EC0 8C66      LDD	R6,Z+30
    00EC1 8C77      LDD	R7,Z+31
    00EC2 A080      LDD	R8,Z+32
    00EC3 A091      LDD	R9,Z+33
    00EC4 0C62      ADD	R6,R2
    00EC5 1C73      ADC	R7,R3
    00EC6 1C84      ADC	R8,R4
    00EC7 1C95      ADC	R9,R5
    00EC8 8288      ST	Y,R8
    00EC9 8299      STD	Y+1,R9
    00ECA 0193      MOVW	R18,R6
    00ECB 018F      MOVW	R16,R30
    00ECC DDE0      RCALL	ff.c:move_window
    00ECD 2300      TST	R16
    00ECE F009      BEQ	0x0ED0
    00ECF C0ED      RJMP	0x0FBD
(0835) 		wc = fs->win[bc % SS(fs)]; bc++;
    00ED0 01C6      MOVW	R24,R12
    00ED1 968E      ADIW	R24,0x2E
    00ED2 01F5      MOVW	R30,R10
    00ED3 70F1      ANDI	R31,1
    00ED4 0FE8      ADD	R30,R24
    00ED5 1FF9      ADC	R31,R25
    00ED6 80E0      LD	R14,Z
    00ED7 24FF      CLR	R15
    00ED8 01C5      MOVW	R24,R10
    00ED9 9601      ADIW	R24,1
    00EDA 015C      MOVW	R10,R24
(0836) 		if (move_window(fs, fs->fatbase + (bc / SS(fs)))) break;
    00EDB E029      LDI	R18,0x9
    00EDC E030      LDI	R19,0
    00EDD 018C      MOVW	R16,R24
    00EDE 940E 4C48 CALL	lsr16
    00EE0 0118      MOVW	R2,R16
    00EE1 2444      CLR	R4
    00EE2 2455      CLR	R5
    00EE3 01F6      MOVW	R30,R12
    00EE4 8C66      LDD	R6,Z+30
    00EE5 8C77      LDD	R7,Z+31
    00EE6 A080      LDD	R8,Z+32
    00EE7 A091      LDD	R9,Z+33
    00EE8 0C62      ADD	R6,R2
    00EE9 1C73      ADC	R7,R3
    00EEA 1C84      ADC	R8,R4
    00EEB 1C95      ADC	R9,R5
    00EEC 8288      ST	Y,R8
    00EED 8299      STD	Y+1,R9
    00EEE 0193      MOVW	R18,R6
    00EEF 018F      MOVW	R16,R30
    00EF0 DDBC      RCALL	ff.c:move_window
    00EF1 2300      TST	R16
    00EF2 F009      BEQ	0x0EF4
    00EF3 C0C9      RJMP	0x0FBD
(0837) 		wc |= fs->win[bc % SS(fs)] << 8;
    00EF4 01C6      MOVW	R24,R12
    00EF5 968E      ADIW	R24,0x2E
    00EF6 01F5      MOVW	R30,R10
    00EF7 70F1      ANDI	R31,1
    00EF8 0FE8      ADD	R30,R24
    00EF9 1FF9      ADC	R31,R25
    00EFA 8020      LD	R2,Z
    00EFB 2433      CLR	R3
    00EFC 2C32      MOV	R3,R2
    00EFD 2422      CLR	R2
    00EFE 28E2      OR	R14,R2
    00EFF 28F3      OR	R15,R3
(0838) 		return (clst & 1) ? (wc >> 4) : (wc & 0xFFF);
    00F00 842C      LDD	R2,Y+12
    00F01 843D      LDD	R3,Y+13
    00F02 844E      LDD	R4,Y+14
    00F03 845F      LDD	R5,Y+15
    00F04 2DE2      MOV	R30,R2
    00F05 70E1      ANDI	R30,1
    00F06 F051      BEQ	0x0F11
    00F07 0157      MOVW	R10,R14
    00F08 94B6      LSR	R11
    00F09 94A7      ROR	R10
    00F0A 94B6      LSR	R11
    00F0B 94A7      ROR	R10
    00F0C 94B6      LSR	R11
    00F0D 94A7      ROR	R10
    00F0E 94B6      LSR	R11
    00F0F 94A7      ROR	R10
    00F10 C003      RJMP	0x0F14
    00F11 01C7      MOVW	R24,R14
    00F12 709F      ANDI	R25,0xF
    00F13 015C      MOVW	R10,R24
    00F14 0185      MOVW	R16,R10
    00F15 0196      MOVW	R18,R12
    00F16 2722      CLR	R18
    00F17 2733      CLR	R19
    00F18 C0A8      RJMP	0x0FC1
(0839) 
(0840) 	case FS_FAT16 :
(0841) 		if (move_window(fs, fs->fatbase + (clst / (SS(fs) / 2)))) break;
    00F19 E088      LDI	R24,0x8
    00F1A E090      LDI	R25,0
    00F1B 850C      LDD	R16,Y+12
    00F1C 851D      LDD	R17,Y+13
    00F1D 852E      LDD	R18,Y+14
    00F1E 853F      LDD	R19,Y+15
    00F1F 938A      ST	-Y,R24
    00F20 940E 4C4F CALL	lsr32
    00F22 01F6      MOVW	R30,R12
    00F23 8C26      LDD	R2,Z+30
    00F24 8C37      LDD	R3,Z+31
    00F25 A040      LDD	R4,Z+32
    00F26 A051      LDD	R5,Z+33
    00F27 0E20      ADD	R2,R16
    00F28 1E31      ADC	R3,R17
    00F29 1E42      ADC	R4,R18
    00F2A 1E53      ADC	R5,R19
    00F2B 8248      ST	Y,R4
    00F2C 8259      STD	Y+1,R5
    00F2D 0191      MOVW	R18,R2
    00F2E 018F      MOVW	R16,R30
    00F2F DD7D      RCALL	ff.c:move_window
    00F30 2EA0      MOV	R10,R16
    00F31 2300      TST	R16
    00F32 F009      BEQ	0x0F34
    00F33 C089      RJMP	0x0FBD
(0842) 		p = &fs->win[clst * 2 % SS(fs)];
    00F34 EF4F      LDI	R20,0xFF
    00F35 E051      LDI	R21,1
    00F36 E060      LDI	R22,0
    00F37 E070      LDI	R23,0
    00F38 842C      LDD	R2,Y+12
    00F39 843D      LDD	R3,Y+13
    00F3A 844E      LDD	R4,Y+14
    00F3B 845F      LDD	R5,Y+15
    00F3C 0C22      LSL	R2
    00F3D 1C33      ROL	R3
    00F3E 1C44      ROL	R4
    00F3F 1C55      ROL	R5
    00F40 2224      AND	R2,R20
    00F41 2235      AND	R3,R21
    00F42 2246      AND	R4,R22
    00F43 2257      AND	R5,R23
    00F44 0151      MOVW	R10,R2
    00F45 01C6      MOVW	R24,R12
    00F46 968E      ADIW	R24,0x2E
    00F47 0EA8      ADD	R10,R24
    00F48 1EB9      ADC	R11,R25
(0843) 		return LD_WORD(p);
    00F49 01F5      MOVW	R30,R10
    00F4A 8020      LD	R2,Z
    00F4B 2433      CLR	R3
    00F4C 8101      LDD	R16,Z+1
    00F4D 2711      CLR	R17
    00F4E 2F10      MOV	R17,R16
    00F4F 2700      CLR	R16
    00F50 2902      OR	R16,R2
    00F51 2913      OR	R17,R3
    00F52 2722      CLR	R18
    00F53 2733      CLR	R19
    00F54 C06C      RJMP	0x0FC1
(0844) 
(0845) 	case FS_FAT32 :
(0846) 		if (move_window(fs, fs->fatbase + (clst / (SS(fs) / 4)))) break;
    00F55 E087      LDI	R24,7
    00F56 E090      LDI	R25,0
    00F57 850C      LDD	R16,Y+12
    00F58 851D      LDD	R17,Y+13
    00F59 852E      LDD	R18,Y+14
    00F5A 853F      LDD	R19,Y+15
    00F5B 938A      ST	-Y,R24
    00F5C 940E 4C4F CALL	lsr32
    00F5E 01F6      MOVW	R30,R12
    00F5F 8C26      LDD	R2,Z+30
    00F60 8C37      LDD	R3,Z+31
    00F61 A040      LDD	R4,Z+32
    00F62 A051      LDD	R5,Z+33
    00F63 0E20      ADD	R2,R16
    00F64 1E31      ADC	R3,R17
    00F65 1E42      ADC	R4,R18
    00F66 1E53      ADC	R5,R19
    00F67 8248      ST	Y,R4
    00F68 8259      STD	Y+1,R5
    00F69 0191      MOVW	R18,R2
    00F6A 018F      MOVW	R16,R30
    00F6B DD41      RCALL	ff.c:move_window
    00F6C 2EE0      MOV	R14,R16
    00F6D 2300      TST	R16
    00F6E F009      BEQ	0x0F70
    00F6F C04D      RJMP	0x0FBD
(0847) 		p = &fs->win[clst * 4 % SS(fs)];
    00F70 E082      LDI	R24,2
    00F71 E090      LDI	R25,0
    00F72 850C      LDD	R16,Y+12
    00F73 851D      LDD	R17,Y+13
    00F74 852E      LDD	R18,Y+14
    00F75 853F      LDD	R19,Y+15
    00F76 938A      ST	-Y,R24
    00F77 940E 4C36 CALL	lsl32
    00F79 0118      MOVW	R2,R16
    00F7A 0129      MOVW	R4,R18
    00F7B EF4F      LDI	R20,0xFF
    00F7C E051      LDI	R21,1
    00F7D E060      LDI	R22,0
    00F7E E070      LDI	R23,0
    00F7F 2224      AND	R2,R20
    00F80 2235      AND	R3,R21
    00F81 2246      AND	R4,R22
    00F82 2257      AND	R5,R23
    00F83 0151      MOVW	R10,R2
    00F84 01C6      MOVW	R24,R12
    00F85 968E      ADIW	R24,0x2E
    00F86 0EA8      ADD	R10,R24
    00F87 1EB9      ADC	R11,R25
(0848) 		return LD_DWORD(p) & 0x0FFFFFFF;
    00F88 E188      LDI	R24,0x18
    00F89 E090      LDI	R25,0
    00F8A 01F5      MOVW	R30,R10
    00F8B 8103      LDD	R16,Z+3
    00F8C 2711      CLR	R17
    00F8D 2722      CLR	R18
    00F8E 2733      CLR	R19
    00F8F 938A      ST	-Y,R24
    00F90 940E 4C36 CALL	lsl32
    00F92 0118      MOVW	R2,R16
    00F93 0129      MOVW	R4,R18
    00F94 01F5      MOVW	R30,R10
    00F95 8062      LDD	R6,Z+2
    00F96 2477      CLR	R7
    00F97 2488      CLR	R8
    00F98 2499      CLR	R9
    00F99 0143      MOVW	R8,R6
    00F9A 2466      CLR	R6
    00F9B 2477      CLR	R7
    00F9C 2826      OR	R2,R6
    00F9D 2837      OR	R3,R7
    00F9E 2848      OR	R4,R8
    00F9F 2859      OR	R5,R9
    00FA0 8061      LDD	R6,Z+1
    00FA1 2477      CLR	R7
    00FA2 2C76      MOV	R7,R6
    00FA3 2466      CLR	R6
    00FA4 2488      CLR	R8
    00FA5 2499      CLR	R9
    00FA6 2826      OR	R2,R6
    00FA7 2837      OR	R3,R7
    00FA8 2848      OR	R4,R8
    00FA9 2859      OR	R5,R9
    00FAA 8060      LD	R6,Z
    00FAB 2477      CLR	R7
    00FAC 2488      CLR	R8
    00FAD 2499      CLR	R9
    00FAE 2826      OR	R2,R6
    00FAF 2837      OR	R3,R7
    00FB0 2848      OR	R4,R8
    00FB1 2859      OR	R5,R9
    00FB2 EF4F      LDI	R20,0xFF
    00FB3 EF5F      LDI	R21,0xFF
    00FB4 EF6F      LDI	R22,0xFF
    00FB5 E07F      LDI	R23,0xF
    00FB6 2224      AND	R2,R20
    00FB7 2235      AND	R3,R21
    00FB8 2246      AND	R4,R22
    00FB9 2257      AND	R5,R23
    00FBA 0181      MOVW	R16,R2
    00FBB 0192      MOVW	R18,R4
    00FBC C004      RJMP	0x0FC1
(0849) 	}
(0850) 
(0851) 	return 0xFFFFFFFF;	/* An error occurred at the disk I/O layer */
    00FBD EF0F      LDI	R16,0xFF
    00FBE EF1F      LDI	R17,0xFF
    00FBF EF2F      LDI	R18,0xFF
    00FC0 EF3F      LDI	R19,0xFF
    00FC1 9622      ADIW	R28,2
    00FC2 940E 4BA0 CALL	pop_xgsetF0FC
    00FC4 9622      ADIW	R28,2
    00FC5 9508      RET
_put_fat:
  bc                   --> R12
  p                    --> R14
  res                  --> Y,+2
  val                  --> Y,+19
  clst                 --> Y,+15
  fs                   --> Y,+13
    00FC6 940E 4A66 CALL	push_arg4
    00FC8 940E 4BAB CALL	push_xgsetF0FC
    00FCA 9723      SBIW	R28,3
(0852) }
(0853) 
(0854) 
(0855) 
(0856) 
(0857) /*-----------------------------------------------------------------------*/
(0858) /* FAT access - Change value of a FAT entry                              */
(0859) /*-----------------------------------------------------------------------*/
(0860) #if !_FS_READONLY
(0861) 
(0862) FRESULT put_fat (
(0863) 	FATFS *fs,	/* File system object */
(0864) 	DWORD clst,	/* Cluster# to be changed in range of 2 to fs->n_fatent - 1 */
(0865) 	DWORD val	/* New value to mark the cluster */
(0866) )
(0867) {
(0868) 	UINT bc;
(0869) 	BYTE *p;
(0870) 	FRESULT res;
(0871) 
(0872) 
(0873) 	if (clst < 2 || clst >= fs->n_fatent) {	/* Check range */
    00FCB E042      LDI	R20,2
    00FCC E050      LDI	R21,0
    00FCD E060      LDI	R22,0
    00FCE E070      LDI	R23,0
    00FCF 842F      LDD	R2,Y+15
    00FD0 8838      LDD	R3,Y+16
    00FD1 8849      LDD	R4,Y+17
    00FD2 885A      LDD	R5,Y+18
    00FD3 1624      CP	R2,R20
    00FD4 0635      CPC	R3,R21
    00FD5 0646      CPC	R4,R22
    00FD6 0657      CPC	R5,R23
    00FD7 F080      BCS	0x0FE8
    00FD8 85ED      LDD	R30,Y+13
    00FD9 85FE      LDD	R31,Y+14
    00FDA 9676      ADIW	R30,0x16
    00FDB 8020      LD	R2,Z
    00FDC 8031      LDD	R3,Z+1
    00FDD 8042      LDD	R4,Z+2
    00FDE 8053      LDD	R5,Z+3
    00FDF 846F      LDD	R6,Y+15
    00FE0 8878      LDD	R7,Y+16
    00FE1 8889      LDD	R8,Y+17
    00FE2 889A      LDD	R9,Y+18
    00FE3 1462      CP	R6,R2
    00FE4 0473      CPC	R7,R3
    00FE5 0484      CPC	R8,R4
    00FE6 0495      CPC	R9,R5
    00FE7 F018      BCS	0x0FEB
(0874) 		res = FR_INT_ERR;
    00FE8 E082      LDI	R24,2
    00FE9 838A      STD	Y+2,R24
(0875) 
(0876) 	} else {
    00FEA C194      RJMP	0x117F
(0877) 		switch (fs->fs_type) {
    00FEB 85ED      LDD	R30,Y+13
    00FEC 85FE      LDD	R31,Y+14
    00FED 80A0      LD	R10,Z
    00FEE 24BB      CLR	R11
    00FEF 01C5      MOVW	R24,R10
    00FF0 3081      CPI	R24,1
    00FF1 E0E0      LDI	R30,0
    00FF2 079E      CPC	R25,R30
    00FF3 F059      BEQ	0x0FFF
    00FF4 3082      CPI	R24,2
    00FF5 E0E0      LDI	R30,0
    00FF6 079E      CPC	R25,R30
    00FF7 F409      BNE	0x0FF9
    00FF8 C0B0      RJMP	0x10A9
    00FF9 3083      CPI	R24,3
    00FFA E0E0      LDI	R30,0
    00FFB 079E      CPC	R25,R30
    00FFC F409      BNE	0x0FFE
    00FFD C0E7      RJMP	0x10E5
    00FFE C17A      RJMP	0x1179
(0878) 		case FS_FAT12 :
(0879) 			bc = clst; bc += bc / 2;
    00FFF 84CF      LDD	R12,Y+15
    01000 88D8      LDD	R13,Y+16
    01001 0116      MOVW	R2,R12
    01002 9436      LSR	R3
    01003 9427      ROR	R2
    01004 0CC2      ADD	R12,R2
    01005 1CD3      ADC	R13,R3
(0880) 			res = move_window(fs, fs->fatbase + (bc / SS(fs)));
    01006 E029      LDI	R18,0x9
    01007 E030      LDI	R19,0
    01008 0186      MOVW	R16,R12
    01009 940E 4C48 CALL	lsr16
    0100B 0118      MOVW	R2,R16
    0100C 2444      CLR	R4
    0100D 2455      CLR	R5
    0100E 85ED      LDD	R30,Y+13
    0100F 85FE      LDD	R31,Y+14
    01010 8C66      LDD	R6,Z+30
    01011 8C77      LDD	R7,Z+31
    01012 A080      LDD	R8,Z+32
    01013 A091      LDD	R9,Z+33
    01014 0C62      ADD	R6,R2
    01015 1C73      ADC	R7,R3
    01016 1C84      ADC	R8,R4
    01017 1C95      ADC	R9,R5
    01018 8288      ST	Y,R8
    01019 8299      STD	Y+1,R9
    0101A 0193      MOVW	R18,R6
    0101B 018F      MOVW	R16,R30
    0101C DC90      RCALL	ff.c:move_window
    0101D 830A      STD	Y+2,R16
(0881) 			if (res != FR_OK) break;
    0101E 2E00      MOV	R0,R16
    0101F 2300      TST	R16
    01020 F009      BEQ	0x1022
    01021 C159      RJMP	0x117B
(0882) 			p = &fs->win[bc % SS(fs)];
    01022 858D      LDD	R24,Y+13
    01023 859E      LDD	R25,Y+14
    01024 968E      ADIW	R24,0x2E
    01025 01F6      MOVW	R30,R12
    01026 70F1      ANDI	R31,1
    01027 017F      MOVW	R14,R30
    01028 0EE8      ADD	R14,R24
    01029 1EF9      ADC	R15,R25
(0883) 			*p = (clst & 1) ? ((*p & 0x0F) | ((BYTE)val << 4)) : (BYTE)val;
    0102A 842F      LDD	R2,Y+15
    0102B 8838      LDD	R3,Y+16
    0102C 8849      LDD	R4,Y+17
    0102D 885A      LDD	R5,Y+18
    0102E 93EF      PUSH	R30
    0102F 2DE2      MOV	R30,R2
    01030 70E1      ANDI	R30,1
    01031 91EF      POP	R30
    01032 F0B1      BEQ	0x1049
    01033 882B      LDD	R2,Y+19
    01034 883C      LDD	R3,Y+20
    01035 884D      LDD	R4,Y+21
    01036 885E      LDD	R5,Y+22
    01037 2433      CLR	R3
    01038 0C22      LSL	R2
    01039 1C33      ROL	R3
    0103A 0C22      LSL	R2
    0103B 1C33      ROL	R3
    0103C 0C22      LSL	R2
    0103D 1C33      ROL	R3
    0103E 0C22      LSL	R2
    0103F 1C33      ROL	R3
    01040 01F7      MOVW	R30,R14
    01041 8180      LD	R24,Z
    01042 2799      CLR	R25
    01043 708F      ANDI	R24,0xF
    01044 7090      ANDI	R25,0
    01045 015C      MOVW	R10,R24
    01046 28A2      OR	R10,R2
    01047 28B3      OR	R11,R3
    01048 C006      RJMP	0x104F
    01049 882B      LDD	R2,Y+19
    0104A 883C      LDD	R3,Y+20
    0104B 884D      LDD	R4,Y+21
    0104C 885E      LDD	R5,Y+22
    0104D 2CA2      MOV	R10,R2
    0104E 24BB      CLR	R11
    0104F 01F7      MOVW	R30,R14
    01050 82A0      ST	Z,R10
(0884) 			bc++;
    01051 01C6      MOVW	R24,R12
    01052 9601      ADIW	R24,1
    01053 016C      MOVW	R12,R24
(0885) 			fs->wflag = 1;
    01054 E081      LDI	R24,1
    01055 85ED      LDD	R30,Y+13
    01056 85FE      LDD	R31,Y+14
    01057 8384      STD	Z+4,R24
(0886) 			res = move_window(fs, fs->fatbase + (bc / SS(fs)));
    01058 E029      LDI	R18,0x9
    01059 E030      LDI	R19,0
    0105A 0186      MOVW	R16,R12
    0105B 940E 4C48 CALL	lsr16
    0105D 0118      MOVW	R2,R16
    0105E 2444      CLR	R4
    0105F 2455      CLR	R5
    01060 85ED      LDD	R30,Y+13
    01061 85FE      LDD	R31,Y+14
    01062 8C66      LDD	R6,Z+30
    01063 8C77      LDD	R7,Z+31
    01064 A080      LDD	R8,Z+32
    01065 A091      LDD	R9,Z+33
    01066 0C62      ADD	R6,R2
    01067 1C73      ADC	R7,R3
    01068 1C84      ADC	R8,R4
    01069 1C95      ADC	R9,R5
    0106A 8288      ST	Y,R8
    0106B 8299      STD	Y+1,R9
    0106C 0193      MOVW	R18,R6
    0106D 018F      MOVW	R16,R30
    0106E DC3E      RCALL	ff.c:move_window
    0106F 830A      STD	Y+2,R16
(0887) 			if (res != FR_OK) break;
    01070 2E00      MOV	R0,R16
    01071 2300      TST	R16
    01072 F009      BEQ	0x1074
    01073 C107      RJMP	0x117B
(0888) 			p = &fs->win[bc % SS(fs)];
    01074 858D      LDD	R24,Y+13
    01075 859E      LDD	R25,Y+14
    01076 968E      ADIW	R24,0x2E
    01077 01F6      MOVW	R30,R12
    01078 70F1      ANDI	R31,1
    01079 017F      MOVW	R14,R30
    0107A 0EE8      ADD	R14,R24
    0107B 1EF9      ADC	R15,R25
(0889) 			*p = (clst & 1) ? (BYTE)(val >> 4) : ((*p & 0xF0) | ((BYTE)(val >> 8) & 0x0F));
    0107C 842F      LDD	R2,Y+15
    0107D 8838      LDD	R3,Y+16
    0107E 8849      LDD	R4,Y+17
    0107F 885A      LDD	R5,Y+18
    01080 93EF      PUSH	R30
    01081 2DE2      MOV	R30,R2
    01082 70E1      ANDI	R30,1
    01083 91EF      POP	R30
    01084 F061      BEQ	0x1091
    01085 E084      LDI	R24,4
    01086 E090      LDI	R25,0
    01087 890B      LDD	R16,Y+19
    01088 891C      LDD	R17,Y+20
    01089 892D      LDD	R18,Y+21
    0108A 893E      LDD	R19,Y+22
    0108B 938A      ST	-Y,R24
    0108C 940E 4C4F CALL	lsr32
    0108E 2EC0      MOV	R12,R16
    0108F 24DD      CLR	R13
    01090 C015      RJMP	0x10A6
    01091 E088      LDI	R24,0x8
    01092 E090      LDI	R25,0
    01093 890B      LDD	R16,Y+19
    01094 891C      LDD	R17,Y+20
    01095 892D      LDD	R18,Y+21
    01096 893E      LDD	R19,Y+22
    01097 938A      ST	-Y,R24
    01098 940E 4C4F CALL	lsr32
    0109A 2F80      MOV	R24,R16
    0109B 2799      CLR	R25
    0109C 708F      ANDI	R24,0xF
    0109D 7090      ANDI	R25,0
    0109E 01F7      MOVW	R30,R14
    0109F 81E0      LD	R30,Z
    010A0 27FF      CLR	R31
    010A1 7FE0      ANDI	R30,0xF0
    010A2 70F0      ANDI	R31,0
    010A3 016F      MOVW	R12,R30
    010A4 2AC8      OR	R12,R24
    010A5 2AD9      OR	R13,R25
    010A6 01F7      MOVW	R30,R14
    010A7 82C0      ST	Z,R12
(0890) 			break;
    010A8 C0D2      RJMP	0x117B
(0891) 
(0892) 		case FS_FAT16 :
(0893) 			res = move_window(fs, fs->fatbase + (clst / (SS(fs) / 2)));
    010A9 E088      LDI	R24,0x8
    010AA E090      LDI	R25,0
    010AB 850F      LDD	R16,Y+15
    010AC 8918      LDD	R17,Y+16
    010AD 8929      LDD	R18,Y+17
    010AE 893A      LDD	R19,Y+18
    010AF 938A      ST	-Y,R24
    010B0 940E 4C4F CALL	lsr32
    010B2 85ED      LDD	R30,Y+13
    010B3 85FE      LDD	R31,Y+14
    010B4 8C26      LDD	R2,Z+30
    010B5 8C37      LDD	R3,Z+31
    010B6 A040      LDD	R4,Z+32
    010B7 A051      LDD	R5,Z+33
    010B8 0E20      ADD	R2,R16
    010B9 1E31      ADC	R3,R17
    010BA 1E42      ADC	R4,R18
    010BB 1E53      ADC	R5,R19
    010BC 8248      ST	Y,R4
    010BD 8259      STD	Y+1,R5
    010BE 0191      MOVW	R18,R2
    010BF 018F      MOVW	R16,R30
    010C0 DBEC      RCALL	ff.c:move_window
    010C1 2EC0      MOV	R12,R16
    010C2 82CA      STD	Y+2,R12
(0894) 			if (res != FR_OK) break;
    010C3 2C0C      MOV	R0,R12
    010C4 2300      TST	R16
    010C5 F009      BEQ	0x10C7
    010C6 C0B4      RJMP	0x117B
(0895) 			p = &fs->win[clst * 2 % SS(fs)];
    010C7 EF4F      LDI	R20,0xFF
    010C8 E051      LDI	R21,1
    010C9 E060      LDI	R22,0
    010CA E070      LDI	R23,0
    010CB 842F      LDD	R2,Y+15
    010CC 8838      LDD	R3,Y+16
    010CD 8849      LDD	R4,Y+17
    010CE 885A      LDD	R5,Y+18
    010CF 0C22      LSL	R2
    010D0 1C33      ROL	R3
    010D1 1C44      ROL	R4
    010D2 1C55      ROL	R5
    010D3 2224      AND	R2,R20
    010D4 2235      AND	R3,R21
    010D5 2246      AND	R4,R22
    010D6 2257      AND	R5,R23
    010D7 0171      MOVW	R14,R2
    010D8 858D      LDD	R24,Y+13
    010D9 859E      LDD	R25,Y+14
    010DA 968E      ADIW	R24,0x2E
    010DB 0EE8      ADD	R14,R24
    010DC 1EF9      ADC	R15,R25
(0896) 			ST_WORD(p, (WORD)val);
    010DD 882B      LDD	R2,Y+19
    010DE 883C      LDD	R3,Y+20
    010DF 01F7      MOVW	R30,R14
    010E0 8220      ST	Z,R2
    010E1 2C23      MOV	R2,R3
    010E2 2433      CLR	R3
    010E3 8221      STD	Z+1,R2
(0897) 			break;
    010E4 C096      RJMP	0x117B
(0898) 
(0899) 		case FS_FAT32 :
(0900) 			res = move_window(fs, fs->fatbase + (clst / (SS(fs) / 4)));
    010E5 E087      LDI	R24,7
    010E6 E090      LDI	R25,0
    010E7 850F      LDD	R16,Y+15
    010E8 8918      LDD	R17,Y+16
    010E9 8929      LDD	R18,Y+17
    010EA 893A      LDD	R19,Y+18
    010EB 938A      ST	-Y,R24
    010EC 940E 4C4F CALL	lsr32
    010EE 85ED      LDD	R30,Y+13
    010EF 85FE      LDD	R31,Y+14
    010F0 8C26      LDD	R2,Z+30
    010F1 8C37      LDD	R3,Z+31
    010F2 A040      LDD	R4,Z+32
    010F3 A051      LDD	R5,Z+33
    010F4 0E20      ADD	R2,R16
    010F5 1E31      ADC	R3,R17
    010F6 1E42      ADC	R4,R18
    010F7 1E53      ADC	R5,R19
    010F8 8248      ST	Y,R4
    010F9 8259      STD	Y+1,R5
    010FA 0191      MOVW	R18,R2
    010FB 018F      MOVW	R16,R30
    010FC DBB0      RCALL	ff.c:move_window
    010FD 2EC0      MOV	R12,R16
    010FE 82CA      STD	Y+2,R12
(0901) 			if (res != FR_OK) break;
    010FF 2C0C      MOV	R0,R12
    01100 2300      TST	R16
    01101 F009      BEQ	0x1103
    01102 C078      RJMP	0x117B
(0902) 			p = &fs->win[clst * 4 % SS(fs)];
    01103 E082      LDI	R24,2
    01104 E090      LDI	R25,0
    01105 850F      LDD	R16,Y+15
    01106 8918      LDD	R17,Y+16
    01107 8929      LDD	R18,Y+17
    01108 893A      LDD	R19,Y+18
    01109 938A      ST	-Y,R24
    0110A 940E 4C36 CALL	lsl32
    0110C 0118      MOVW	R2,R16
    0110D 0129      MOVW	R4,R18
    0110E EF4F      LDI	R20,0xFF
    0110F E051      LDI	R21,1
    01110 E060      LDI	R22,0
    01111 E070      LDI	R23,0
    01112 2224      AND	R2,R20
    01113 2235      AND	R3,R21
    01114 2246      AND	R4,R22
    01115 2257      AND	R5,R23
    01116 0171      MOVW	R14,R2
    01117 858D      LDD	R24,Y+13
    01118 859E      LDD	R25,Y+14
    01119 968E      ADIW	R24,0x2E
    0111A 0EE8      ADD	R14,R24
    0111B 1EF9      ADC	R15,R25
(0903) 			val |= LD_DWORD(p) & 0xF0000000;
    0111C E188      LDI	R24,0x18
    0111D E090      LDI	R25,0
    0111E 01F7      MOVW	R30,R14
    0111F 8103      LDD	R16,Z+3
    01120 2711      CLR	R17
    01121 2722      CLR	R18
    01122 2733      CLR	R19
    01123 938A      ST	-Y,R24
    01124 940E 4C36 CALL	lsl32
    01126 0118      MOVW	R2,R16
    01127 0129      MOVW	R4,R18
    01128 01F7      MOVW	R30,R14
    01129 8062      LDD	R6,Z+2
    0112A 2477      CLR	R7
    0112B 2488      CLR	R8
    0112C 2499      CLR	R9
    0112D 0143      MOVW	R8,R6
    0112E 2466      CLR	R6
    0112F 2477      CLR	R7
    01130 2826      OR	R2,R6
    01131 2837      OR	R3,R7
    01132 2848      OR	R4,R8
    01133 2859      OR	R5,R9
    01134 8061      LDD	R6,Z+1
    01135 2477      CLR	R7
    01136 2C76      MOV	R7,R6
    01137 2466      CLR	R6
    01138 2488      CLR	R8
    01139 2499      CLR	R9
    0113A 2826      OR	R2,R6
    0113B 2837      OR	R3,R7
    0113C 2848      OR	R4,R8
    0113D 2859      OR	R5,R9
    0113E 8060      LD	R6,Z
    0113F 2477      CLR	R7
    01140 2488      CLR	R8
    01141 2499      CLR	R9
    01142 2826      OR	R2,R6
    01143 2837      OR	R3,R7
    01144 2848      OR	R4,R8
    01145 2859      OR	R5,R9
    01146 E040      LDI	R20,0
    01147 E050      LDI	R21,0
    01148 E060      LDI	R22,0
    01149 EF70      LDI	R23,0xF0
    0114A 2224      AND	R2,R20
    0114B 2235      AND	R3,R21
    0114C 2246      AND	R4,R22
    0114D 2257      AND	R5,R23
    0114E 886B      LDD	R6,Y+19
    0114F 887C      LDD	R7,Y+20
    01150 888D      LDD	R8,Y+21
    01151 889E      LDD	R9,Y+22
    01152 2862      OR	R6,R2
    01153 2873      OR	R7,R3
    01154 2884      OR	R8,R4
    01155 2895      OR	R9,R5
    01156 8A6B      STD	Y+19,R6
    01157 8A7C      STD	Y+20,R7
    01158 8A8D      STD	Y+21,R8
    01159 8A9E      STD	Y+22,R9
(0904) 			ST_DWORD(p, val);
    0115A 882B      LDD	R2,Y+19
    0115B 883C      LDD	R3,Y+20
    0115C 884D      LDD	R4,Y+21
    0115D 885E      LDD	R5,Y+22
    0115E 8220      ST	Z,R2
    0115F 2C23      MOV	R2,R3
    01160 2433      CLR	R3
    01161 9631      ADIW	R30,1
    01162 8220      ST	Z,R2
    01163 882B      LDD	R2,Y+19
    01164 883C      LDD	R3,Y+20
    01165 884D      LDD	R4,Y+21
    01166 885E      LDD	R5,Y+22
    01167 0112      MOVW	R2,R4
    01168 2444      CLR	R4
    01169 2455      CLR	R5
    0116A 01F7      MOVW	R30,R14
    0116B 9632      ADIW	R30,2
    0116C 8220      ST	Z,R2
    0116D E188      LDI	R24,0x18
    0116E E090      LDI	R25,0
    0116F 890B      LDD	R16,Y+19
    01170 891C      LDD	R17,Y+20
    01171 892D      LDD	R18,Y+21
    01172 893E      LDD	R19,Y+22
    01173 938A      ST	-Y,R24
    01174 940E 4C4F CALL	lsr32
    01176 01F7      MOVW	R30,R14
    01177 8303      STD	Z+3,R16
(0905) 			break;
    01178 C002      RJMP	0x117B
(0906) 
(0907) 		default :
(0908) 			res = FR_INT_ERR;
    01179 E082      LDI	R24,2
    0117A 838A      STD	Y+2,R24
(0909) 		}
(0910) 		fs->wflag = 1;
    0117B E081      LDI	R24,1
    0117C 85ED      LDD	R30,Y+13
    0117D 85FE      LDD	R31,Y+14
    0117E 8384      STD	Z+4,R24
(0911) 	}
(0912) 
(0913) 	return res;
    0117F 810A      LDD	R16,Y+2
    01180 9623      ADIW	R28,3
    01181 940E 4BA0 CALL	pop_xgsetF0FC
    01183 9624      ADIW	R28,4
    01184 9508      RET
ff.c:remove_chain:
  res                  --> R10
  nxt                  --> Y,+6
  clst                 --> Y,+18
  fs                   --> R12
    01185 933A      ST	-Y,R19
    01186 932A      ST	-Y,R18
    01187 940E 4BE6 CALL	push_xgsetF03C
    01189 0168      MOVW	R12,R16
    0118A 972A      SBIW	R28,0xA
(0914) }
(0915) #endif /* !_FS_READONLY */
(0916) 
(0917) 
(0918) 
(0919) 
(0920) /*-----------------------------------------------------------------------*/
(0921) /* FAT handling - Remove a cluster chain                                 */
(0922) /*-----------------------------------------------------------------------*/
(0923) #if !_FS_READONLY
(0924) static
(0925) FRESULT remove_chain (
(0926) 	FATFS *fs,			/* File system object */
(0927) 	DWORD clst			/* Cluster# to remove a chain from */
(0928) )
(0929) {
(0930) 	FRESULT res;
(0931) 	DWORD nxt;
(0932) #if _USE_ERASE
(0933) 	DWORD scl = clst, ecl = clst, resion[2];
(0934) #endif
(0935) 
(0936) 	if (clst < 2 || clst >= fs->n_fatent) {	/* Check range */
    0118B E042      LDI	R20,2
    0118C E050      LDI	R21,0
    0118D E060      LDI	R22,0
    0118E E070      LDI	R23,0
    0118F 882A      LDD	R2,Y+18
    01190 883B      LDD	R3,Y+19
    01191 884C      LDD	R4,Y+20
    01192 885D      LDD	R5,Y+21
    01193 1624      CP	R2,R20
    01194 0635      CPC	R3,R21
    01195 0646      CPC	R4,R22
    01196 0657      CPC	R5,R23
    01197 F078      BCS	0x11A7
    01198 01F6      MOVW	R30,R12
    01199 9676      ADIW	R30,0x16
    0119A 8020      LD	R2,Z
    0119B 8031      LDD	R3,Z+1
    0119C 8042      LDD	R4,Z+2
    0119D 8053      LDD	R5,Z+3
    0119E 886A      LDD	R6,Y+18
    0119F 887B      LDD	R7,Y+19
    011A0 888C      LDD	R8,Y+20
    011A1 889D      LDD	R9,Y+21
    011A2 1462      CP	R6,R2
    011A3 0473      CPC	R7,R3
    011A4 0484      CPC	R8,R4
    011A5 0495      CPC	R9,R5
    011A6 F018      BCS	0x11AA
(0937) 		res = FR_INT_ERR;
    011A7 E082      LDI	R24,2
    011A8 2EA8      MOV	R10,R24
(0938) 
(0939) 	} else {
    011A9 C088      RJMP	0x1232
(0940) 		res = FR_OK;
    011AA 24AA      CLR	R10
    011AB C076      RJMP	0x1222
(0941) 		while (clst < fs->n_fatent) {			/* Not a last link? */
(0942) 			nxt = get_fat(fs, clst);			/* Get cluster status */
    011AC 882A      LDD	R2,Y+18
    011AD 883B      LDD	R3,Y+19
    011AE 884C      LDD	R4,Y+20
    011AF 885D      LDD	R5,Y+21
    011B0 8248      ST	Y,R4
    011B1 8259      STD	Y+1,R5
    011B2 0191      MOVW	R18,R2
    011B3 0186      MOVW	R16,R12
    011B4 DCC1      RCALL	_get_fat
    011B5 830E      STD	Y+6,R16
    011B6 831F      STD	Y+7,R17
    011B7 8728      STD	Y+8,R18
    011B8 8739      STD	Y+9,R19
(0943) 			if (nxt == 0) break;				/* Empty cluster? */
    011B9 802E      LDD	R2,Y+6
    011BA 803F      LDD	R3,Y+7
    011BB 8448      LDD	R4,Y+8
    011BC 8459      LDD	R5,Y+9
    011BD 9488      BCLR	0
    011BE 2022      TST	R2
    011BF 0432      CPC	R3,R2
    011C0 0442      CPC	R4,R2
    011C1 0452      CPC	R5,R2
    011C2 F409      BNE	0x11C4
    011C3 C06E      RJMP	0x1232
(0944) 			if (nxt == 1) { res = FR_INT_ERR; break; }	/* Internal error? */
    011C4 E041      LDI	R20,1
    011C5 E050      LDI	R21,0
    011C6 E060      LDI	R22,0
    011C7 E070      LDI	R23,0
    011C8 802E      LDD	R2,Y+6
    011C9 803F      LDD	R3,Y+7
    011CA 8448      LDD	R4,Y+8
    011CB 8459      LDD	R5,Y+9
    011CC 1624      CP	R2,R20
    011CD 0635      CPC	R3,R21
    011CE 0646      CPC	R4,R22
    011CF 0657      CPC	R5,R23
    011D0 F419      BNE	0x11D4
    011D1 E082      LDI	R24,2
    011D2 2EA8      MOV	R10,R24
    011D3 C05E      RJMP	0x1232
(0945) 			if (nxt == 0xFFFFFFFF) { res = FR_DISK_ERR; break; }	/* Disk error? */
    011D4 EF4F      LDI	R20,0xFF
    011D5 EF5F      LDI	R21,0xFF
    011D6 EF6F      LDI	R22,0xFF
    011D7 EF7F      LDI	R23,0xFF
    011D8 802E      LDD	R2,Y+6
    011D9 803F      LDD	R3,Y+7
    011DA 8448      LDD	R4,Y+8
    011DB 8459      LDD	R5,Y+9
    011DC 1624      CP	R2,R20
    011DD 0635      CPC	R3,R21
    011DE 0646      CPC	R4,R22
    011DF 0657      CPC	R5,R23
    011E0 F419      BNE	0x11E4
    011E1 24AA      CLR	R10
    011E2 94A3      INC	R10
    011E3 C04E      RJMP	0x1232
(0946) 			res = put_fat(fs, clst, 0);			/* Mark the cluster "empty" */
    011E4 E080      LDI	R24,0
    011E5 838A      STD	Y+2,R24
    011E6 838B      STD	Y+3,R24
    011E7 838C      STD	Y+4,R24
    011E8 838D      STD	Y+5,R24
    011E9 882A      LDD	R2,Y+18
    011EA 883B      LDD	R3,Y+19
    011EB 884C      LDD	R4,Y+20
    011EC 885D      LDD	R5,Y+21
    011ED 8248      ST	Y,R4
    011EE 8259      STD	Y+1,R5
    011EF 0191      MOVW	R18,R2
    011F0 0186      MOVW	R16,R12
    011F1 DDD4      RCALL	_put_fat
    011F2 2EA0      MOV	R10,R16
(0947) 			if (res != FR_OK) break;
    011F3 2300      TST	R16
    011F4 F009      BEQ	0x11F6
    011F5 C03C      RJMP	0x1232
(0948) 			if (fs->free_clust != 0xFFFFFFFF) {	/* Update FSInfo */
    011F6 EF4F      LDI	R20,0xFF
    011F7 EF5F      LDI	R21,0xFF
    011F8 EF6F      LDI	R22,0xFF
    011F9 EF7F      LDI	R23,0xFF
    011FA 01F6      MOVW	R30,R12
    011FB 8426      LDD	R2,Z+14
    011FC 8437      LDD	R3,Z+15
    011FD 8840      LDD	R4,Z+16
    011FE 8851      LDD	R5,Z+17
    011FF 1624      CP	R2,R20
    01200 0635      CPC	R3,R21
    01201 0646      CPC	R4,R22
    01202 0657      CPC	R5,R23
    01203 F0B1      BEQ	0x121A
(0949) 				fs->free_clust++;
    01204 01CF      MOVW	R24,R30
    01205 960E      ADIW	R24,0xE
    01206 E041      LDI	R20,1
    01207 E050      LDI	R21,0
    01208 E060      LDI	R22,0
    01209 E070      LDI	R23,0
    0120A 01FC      MOVW	R30,R24
    0120B 8020      LD	R2,Z
    0120C 8031      LDD	R3,Z+1
    0120D 8042      LDD	R4,Z+2
    0120E 8053      LDD	R5,Z+3
    0120F 0E24      ADD	R2,R20
    01210 1E35      ADC	R3,R21
    01211 1E46      ADC	R4,R22
    01212 1E57      ADC	R5,R23
    01213 8220      ST	Z,R2
    01214 8231      STD	Z+1,R3
    01215 8242      STD	Z+2,R4
    01216 8253      STD	Z+3,R5
(0950) 				fs->fsi_flag = 1;
    01217 E081      LDI	R24,1
    01218 01F6      MOVW	R30,R12
    01219 8385      STD	Z+5,R24
(0951) 			}
(0952) #if _USE_ERASE
(0953) 			if (ecl + 1 == nxt) {	/* Next cluster is contiguous */
(0954) 				ecl = nxt;
(0955) 			} else {				/* End of contiguous clusters */ 
(0956) 				resion[0] = clust2sect(fs, scl);					/* Start sector */
(0957) 				resion[1] = clust2sect(fs, ecl) + fs->csize - 1;	/* End sector */
(0958) 				disk_ioctl(fs->drv, CTRL_ERASE_SECTOR, resion);		/* Erase the block */
(0959) 				scl = ecl = nxt;
(0960) 			}
(0961) #endif
(0962) 			clst = nxt;	/* Next cluster */
    0121A 802E      LDD	R2,Y+6
    0121B 803F      LDD	R3,Y+7
    0121C 8448      LDD	R4,Y+8
    0121D 8459      LDD	R5,Y+9
    0121E 8A2A      STD	Y+18,R2
    0121F 8A3B      STD	Y+19,R3
    01220 8A4C      STD	Y+20,R4
    01221 8A5D      STD	Y+21,R5
    01222 01F6      MOVW	R30,R12
    01223 9676      ADIW	R30,0x16
    01224 8020      LD	R2,Z
    01225 8031      LDD	R3,Z+1
    01226 8042      LDD	R4,Z+2
    01227 8053      LDD	R5,Z+3
    01228 886A      LDD	R6,Y+18
    01229 887B      LDD	R7,Y+19
    0122A 888C      LDD	R8,Y+20
    0122B 889D      LDD	R9,Y+21
    0122C 1462      CP	R6,R2
    0122D 0473      CPC	R7,R3
    0122E 0484      CPC	R8,R4
    0122F 0495      CPC	R9,R5
    01230 F408      BCC	0x1232
    01231 CF7A      RJMP	0x11AC
(0963) 		}
(0964) 	}
(0965) 
(0966) 	return res;
    01232 2D0A      MOV	R16,R10
    01233 962A      ADIW	R28,0xA
    01234 940E 4BEF CALL	pop_xgsetF03C
    01236 9622      ADIW	R28,2
    01237 9508      RET
ff.c:create_chain:
  res                  --> R10
  scl                  --> Y,+14
  cs                   --> Y,+10
  ncl                  --> Y,+6
  clst                 --> Y,+32
  fs                   --> R12
    01238 933A      ST	-Y,R19
    01239 932A      ST	-Y,R18
    0123A 940E 4BAB CALL	push_xgsetF0FC
    0123C 0168      MOVW	R12,R16
    0123D 9766      SBIW	R28,0x16
(0967) }
(0968) #endif
(0969) 
(0970) 
(0971) 
(0972) 
(0973) /*-----------------------------------------------------------------------*/
(0974) /* FAT handling - Stretch or Create a cluster chain                      */
(0975) /*-----------------------------------------------------------------------*/
(0976) #if !_FS_READONLY
(0977) static
(0978) DWORD create_chain (	/* 0:No free cluster, 1:Internal error, 0xFFFFFFFF:Disk error, >=2:New cluster# */
(0979) 	FATFS *fs,			/* File system object */
(0980) 	DWORD clst			/* Cluster# to stretch. 0 means create a new chain. */
(0981) )
(0982) {
(0983) 	DWORD cs, ncl, scl;
(0984) 	FRESULT res;
(0985) 
(0986) 
(0987) 	if (clst == 0) {		/* Create a new chain */
    0123E A028      LDD	R2,Y+32
    0123F A039      LDD	R3,Y+33
    01240 A04A      LDD	R4,Y+34
    01241 A05B      LDD	R5,Y+35
    01242 9488      BCLR	0
    01243 2022      TST	R2
    01244 0432      CPC	R3,R2
    01245 0442      CPC	R4,R2
    01246 0452      CPC	R5,R2
    01247 F559      BNE	0x1273
(0988) 		scl = fs->last_clust;			/* Get suggested start point */
    01248 01F6      MOVW	R30,R12
    01249 963A      ADIW	R30,0xA
    0124A 8020      LD	R2,Z
    0124B 8031      LDD	R3,Z+1
    0124C 8042      LDD	R4,Z+2
    0124D 8053      LDD	R5,Z+3
    0124E 862E      STD	Y+14,R2
    0124F 863F      STD	Y+15,R3
    01250 8A48      STD	Y+16,R4
    01251 8A59      STD	Y+17,R5
(0989) 		if (!scl || scl >= fs->n_fatent) scl = 1;
    01252 842E      LDD	R2,Y+14
    01253 843F      LDD	R3,Y+15
    01254 8848      LDD	R4,Y+16
    01255 8859      LDD	R5,Y+17
    01256 9488      BCLR	0
    01257 2022      TST	R2
    01258 0432      CPC	R3,R2
    01259 0442      CPC	R4,R2
    0125A 0452      CPC	R5,R2
    0125B F081      BEQ	0x126C
    0125C 01F6      MOVW	R30,R12
    0125D 9676      ADIW	R30,0x16
    0125E 8020      LD	R2,Z
    0125F 8031      LDD	R3,Z+1
    01260 8042      LDD	R4,Z+2
    01261 8053      LDD	R5,Z+3
    01262 846E      LDD	R6,Y+14
    01263 847F      LDD	R7,Y+15
    01264 8888      LDD	R8,Y+16
    01265 8899      LDD	R9,Y+17
    01266 1462      CP	R6,R2
    01267 0473      CPC	R7,R3
    01268 0484      CPC	R8,R4
    01269 0495      CPC	R9,R5
    0126A F408      BCC	0x126C
    0126B C040      RJMP	0x12AC
    0126C E081      LDI	R24,1
    0126D 878E      STD	Y+14,R24
    0126E E080      LDI	R24,0
    0126F 878F      STD	Y+15,R24
    01270 8B88      STD	Y+16,R24
    01271 8B89      STD	Y+17,R24
(0990) 	}
    01272 C039      RJMP	0x12AC
(0991) 	else {					/* Stretch the current chain */
(0992) 		cs = get_fat(fs, clst);			/* Check the cluster status */
    01273 A028      LDD	R2,Y+32
    01274 A039      LDD	R3,Y+33
    01275 A04A      LDD	R4,Y+34
    01276 A05B      LDD	R5,Y+35
    01277 8248      ST	Y,R4
    01278 8259      STD	Y+1,R5
    01279 0191      MOVW	R18,R2
    0127A 0186      MOVW	R16,R12
    0127B DBFA      RCALL	_get_fat
    0127C 870A      STD	Y+10,R16
    0127D 871B      STD	Y+11,R17
    0127E 872C      STD	Y+12,R18
    0127F 873D      STD	Y+13,R19
(0993) 		if (cs < 2) return 1;			/* It is an invalid cluster */
    01280 E042      LDI	R20,2
    01281 E050      LDI	R21,0
    01282 E060      LDI	R22,0
    01283 E070      LDI	R23,0
    01284 842A      LDD	R2,Y+10
    01285 843B      LDD	R3,Y+11
    01286 844C      LDD	R4,Y+12
    01287 845D      LDD	R5,Y+13
    01288 1624      CP	R2,R20
    01289 0635      CPC	R3,R21
    0128A 0646      CPC	R4,R22
    0128B 0657      CPC	R5,R23
    0128C F428      BCC	0x1292
    0128D E001      LDI	R16,1
    0128E E010      LDI	R17,0
    0128F E020      LDI	R18,0
    01290 E030      LDI	R19,0
    01291 C119      RJMP	0x13AB
(0994) 		if (cs < fs->n_fatent) return cs;	/* It is already followed by next cluster */
    01292 01F6      MOVW	R30,R12
    01293 9676      ADIW	R30,0x16
    01294 8020      LD	R2,Z
    01295 8031      LDD	R3,Z+1
    01296 8042      LDD	R4,Z+2
    01297 8053      LDD	R5,Z+3
    01298 846A      LDD	R6,Y+10
    01299 847B      LDD	R7,Y+11
    0129A 848C      LDD	R8,Y+12
    0129B 849D      LDD	R9,Y+13
    0129C 1462      CP	R6,R2
    0129D 0473      CPC	R7,R3
    0129E 0484      CPC	R8,R4
    0129F 0495      CPC	R9,R5
    012A0 F418      BCC	0x12A4
    012A1 0183      MOVW	R16,R6
    012A2 0194      MOVW	R18,R8
    012A3 C107      RJMP	0x13AB
(0995) 		scl = clst;
    012A4 A028      LDD	R2,Y+32
    012A5 A039      LDD	R3,Y+33
    012A6 A04A      LDD	R4,Y+34
    012A7 A05B      LDD	R5,Y+35
    012A8 862E      STD	Y+14,R2
    012A9 863F      STD	Y+15,R3
    012AA 8A48      STD	Y+16,R4
    012AB 8A59      STD	Y+17,R5
(0996) 	}
(0997) 
(0998) 	ncl = scl;				/* Start cluster */
    012AC 842E      LDD	R2,Y+14
    012AD 843F      LDD	R3,Y+15
    012AE 8848      LDD	R4,Y+16
    012AF 8859      LDD	R5,Y+17
    012B0 822E      STD	Y+6,R2
    012B1 823F      STD	Y+7,R3
    012B2 8648      STD	Y+8,R4
    012B3 8659      STD	Y+9,R5
(0999) 	for (;;) {
(1000) 		ncl++;							/* Next cluster */
    012B4 E041      LDI	R20,1
    012B5 E050      LDI	R21,0
    012B6 E060      LDI	R22,0
    012B7 E070      LDI	R23,0
    012B8 802E      LDD	R2,Y+6
    012B9 803F      LDD	R3,Y+7
    012BA 8448      LDD	R4,Y+8
    012BB 8459      LDD	R5,Y+9
    012BC 0E24      ADD	R2,R20
    012BD 1E35      ADC	R3,R21
    012BE 1E46      ADC	R4,R22
    012BF 1E57      ADC	R5,R23
    012C0 822E      STD	Y+6,R2
    012C1 823F      STD	Y+7,R3
    012C2 8648      STD	Y+8,R4
    012C3 8659      STD	Y+9,R5
(1001) 		if (ncl >= fs->n_fatent) {		/* Wrap around */
    012C4 01F6      MOVW	R30,R12
    012C5 9676      ADIW	R30,0x16
    012C6 8020      LD	R2,Z
    012C7 8031      LDD	R3,Z+1
    012C8 8042      LDD	R4,Z+2
    012C9 8053      LDD	R5,Z+3
    012CA 806E      LDD	R6,Y+6
    012CB 807F      LDD	R7,Y+7
    012CC 8488      LDD	R8,Y+8
    012CD 8499      LDD	R9,Y+9
    012CE 1462      CP	R6,R2
    012CF 0473      CPC	R7,R3
    012D0 0484      CPC	R8,R4
    012D1 0495      CPC	R9,R5
    012D2 F0C0      BCS	0x12EB
(1002) 			ncl = 2;
    012D3 E082      LDI	R24,2
    012D4 838E      STD	Y+6,R24
    012D5 E080      LDI	R24,0
    012D6 838F      STD	Y+7,R24
    012D7 8788      STD	Y+8,R24
    012D8 8789      STD	Y+9,R24
(1003) 			if (ncl > scl) return 0;	/* No free cluster */
    012D9 842E      LDD	R2,Y+14
    012DA 843F      LDD	R3,Y+15
    012DB 8848      LDD	R4,Y+16
    012DC 8859      LDD	R5,Y+17
    012DD 806E      LDD	R6,Y+6
    012DE 807F      LDD	R7,Y+7
    012DF 8488      LDD	R8,Y+8
    012E0 8499      LDD	R9,Y+9
    012E1 1426      CP	R2,R6
    012E2 0437      CPC	R3,R7
    012E3 0448      CPC	R4,R8
    012E4 0459      CPC	R5,R9
    012E5 F428      BCC	0x12EB
    012E6 E000      LDI	R16,0
    012E7 E010      LDI	R17,0
    012E8 E020      LDI	R18,0
    012E9 E030      LDI	R19,0
    012EA C0C0      RJMP	0x13AB
(1004) 		}
(1005) 		cs = get_fat(fs, ncl);			/* Get the cluster status */
    012EB 802E      LDD	R2,Y+6
    012EC 803F      LDD	R3,Y+7
    012ED 8448      LDD	R4,Y+8
    012EE 8459      LDD	R5,Y+9
    012EF 8248      ST	Y,R4
    012F0 8259      STD	Y+1,R5
    012F1 0191      MOVW	R18,R2
    012F2 0186      MOVW	R16,R12
    012F3 DB82      RCALL	_get_fat
    012F4 870A      STD	Y+10,R16
    012F5 871B      STD	Y+11,R17
    012F6 872C      STD	Y+12,R18
    012F7 873D      STD	Y+13,R19
(1006) 		if (cs == 0) break;				/* Found a free cluster */
    012F8 842A      LDD	R2,Y+10
    012F9 843B      LDD	R3,Y+11
    012FA 844C      LDD	R4,Y+12
    012FB 845D      LDD	R5,Y+13
    012FC 9488      BCLR	0
    012FD 2022      TST	R2
    012FE 0432      CPC	R3,R2
    012FF 0442      CPC	R4,R2
    01300 0452      CPC	R5,R2
    01301 F409      BNE	0x1303
    01302 C02E      RJMP	0x1331
(1007) 		if (cs == 0xFFFFFFFF || cs == 1)/* An error occurred */
    01303 EF4F      LDI	R20,0xFF
    01304 EF5F      LDI	R21,0xFF
    01305 EF6F      LDI	R22,0xFF
    01306 EF7F      LDI	R23,0xFF
    01307 842A      LDD	R2,Y+10
    01308 843B      LDD	R3,Y+11
    01309 844C      LDD	R4,Y+12
    0130A 845D      LDD	R5,Y+13
    0130B 1624      CP	R2,R20
    0130C 0635      CPC	R3,R21
    0130D 0646      CPC	R4,R22
    0130E 0657      CPC	R5,R23
    0130F F049      BEQ	0x1319
    01310 E041      LDI	R20,1
    01311 E050      LDI	R21,0
    01312 E060      LDI	R22,0
    01313 E070      LDI	R23,0
    01314 1624      CP	R2,R20
    01315 0635      CPC	R3,R21
    01316 0646      CPC	R4,R22
    01317 0657      CPC	R5,R23
    01318 F429      BNE	0x131E
(1008) 			return cs;
    01319 850A      LDD	R16,Y+10
    0131A 851B      LDD	R17,Y+11
    0131B 852C      LDD	R18,Y+12
    0131C 853D      LDD	R19,Y+13
    0131D C08D      RJMP	0x13AB
(1009) 		if (ncl == scl) return 0;		/* No free cluster */
    0131E 842E      LDD	R2,Y+14
    0131F 843F      LDD	R3,Y+15
    01320 8848      LDD	R4,Y+16
    01321 8859      LDD	R5,Y+17
    01322 806E      LDD	R6,Y+6
    01323 807F      LDD	R7,Y+7
    01324 8488      LDD	R8,Y+8
    01325 8499      LDD	R9,Y+9
    01326 1462      CP	R6,R2
    01327 0473      CPC	R7,R3
    01328 0484      CPC	R8,R4
    01329 0495      CPC	R9,R5
    0132A F009      BEQ	0x132C
    0132B CF88      RJMP	0x12B4
    0132C E000      LDI	R16,0
    0132D E010      LDI	R17,0
    0132E E020      LDI	R18,0
    0132F E030      LDI	R19,0
    01330 C07A      RJMP	0x13AB
(1010) 	}
(1011) 
(1012) 	res = put_fat(fs, ncl, 0x0FFFFFFF);	/* Mark the new cluster "last link" */
    01331 EF8F      LDI	R24,0xFF
    01332 838A      STD	Y+2,R24
    01333 838B      STD	Y+3,R24
    01334 838C      STD	Y+4,R24
    01335 E08F      LDI	R24,0xF
    01336 838D      STD	Y+5,R24
    01337 802E      LDD	R2,Y+6
    01338 803F      LDD	R3,Y+7
    01339 8448      LDD	R4,Y+8
    0133A 8459      LDD	R5,Y+9
    0133B 8248      ST	Y,R4
    0133C 8259      STD	Y+1,R5
    0133D 0191      MOVW	R18,R2
    0133E 0186      MOVW	R16,R12
    0133F DC86      RCALL	_put_fat
    01340 2EA0      MOV	R10,R16
(1013) 	if (res == FR_OK && clst != 0) {
    01341 2300      TST	R16
    01342 F4E1      BNE	0x135F
    01343 A028      LDD	R2,Y+32
    01344 A039      LDD	R3,Y+33
    01345 A04A      LDD	R4,Y+34
    01346 A05B      LDD	R5,Y+35
    01347 9488      BCLR	0
    01348 2022      TST	R2
    01349 0432      CPC	R3,R2
    0134A 0442      CPC	R4,R2
    0134B 0452      CPC	R5,R2
    0134C F091      BEQ	0x135F
(1014) 		res = put_fat(fs, clst, ncl);	/* Link it to the previous one if needed */
    0134D 802E      LDD	R2,Y+6
    0134E 803F      LDD	R3,Y+7
    0134F 8448      LDD	R4,Y+8
    01350 8459      LDD	R5,Y+9
    01351 822A      STD	Y+2,R2
    01352 823B      STD	Y+3,R3
    01353 824C      STD	Y+4,R4
    01354 825D      STD	Y+5,R5
    01355 A028      LDD	R2,Y+32
    01356 A039      LDD	R3,Y+33
    01357 A04A      LDD	R4,Y+34
    01358 A05B      LDD	R5,Y+35
    01359 8248      ST	Y,R4
    0135A 8259      STD	Y+1,R5
    0135B 0191      MOVW	R18,R2
    0135C 0186      MOVW	R16,R12
    0135D DC68      RCALL	_put_fat
    0135E 2EA0      MOV	R10,R16
(1015) 	}
(1016) 	if (res == FR_OK) {
    0135F 20AA      TST	R10
    01360 F009      BEQ	0x1362
    01361 C02E      RJMP	0x1390
(1017) 		fs->last_clust = ncl;			/* Update FSINFO */
    01362 802E      LDD	R2,Y+6
    01363 803F      LDD	R3,Y+7
    01364 8448      LDD	R4,Y+8
    01365 8459      LDD	R5,Y+9
    01366 01F6      MOVW	R30,R12
    01367 8622      STD	Z+10,R2
    01368 8633      STD	Z+11,R3
    01369 8644      STD	Z+12,R4
    0136A 8655      STD	Z+13,R5
(1018) 		if (fs->free_clust != 0xFFFFFFFF) {
    0136B EF4F      LDI	R20,0xFF
    0136C EF5F      LDI	R21,0xFF
    0136D EF6F      LDI	R22,0xFF
    0136E EF7F      LDI	R23,0xFF
    0136F 8426      LDD	R2,Z+14
    01370 8437      LDD	R3,Z+15
    01371 8840      LDD	R4,Z+16
    01372 8851      LDD	R5,Z+17
    01373 1624      CP	R2,R20
    01374 0635      CPC	R3,R21
    01375 0646      CPC	R4,R22
    01376 0657      CPC	R5,R23
    01377 F179      BEQ	0x13A7
(1019) 			fs->free_clust--;
    01378 01CF      MOVW	R24,R30
    01379 960E      ADIW	R24,0xE
    0137A 017C      MOVW	R14,R24
    0137B E041      LDI	R20,1
    0137C E050      LDI	R21,0
    0137D E060      LDI	R22,0
    0137E E070      LDI	R23,0
    0137F 01FC      MOVW	R30,R24
    01380 8020      LD	R2,Z
    01381 8031      LDD	R3,Z+1
    01382 8042      LDD	R4,Z+2
    01383 8053      LDD	R5,Z+3
    01384 1A24      SUB	R2,R20
    01385 0A35      SBC	R3,R21
    01386 0A46      SBC	R4,R22
    01387 0A57      SBC	R5,R23
    01388 8220      ST	Z,R2
    01389 8231      STD	Z+1,R3
    0138A 8242      STD	Z+2,R4
    0138B 8253      STD	Z+3,R5
(1020) 			fs->fsi_flag = 1;
    0138C E081      LDI	R24,1
    0138D 01F6      MOVW	R30,R12
    0138E 8385      STD	Z+5,R24
(1021) 		}
(1022) 	} else {
    0138F C017      RJMP	0x13A7
(1023) 		ncl = (res == FR_DISK_ERR) ? 0xFFFFFFFF : 1;
    01390 2D8A      MOV	R24,R10
    01391 3081      CPI	R24,1
    01392 F431      BNE	0x1399
    01393 EF8F      LDI	R24,0xFF
    01394 8B8A      STD	Y+18,R24
    01395 8B8B      STD	Y+19,R24
    01396 8B8C      STD	Y+20,R24
    01397 8B8D      STD	Y+21,R24
    01398 C006      RJMP	0x139F
    01399 E081      LDI	R24,1
    0139A 8B8A      STD	Y+18,R24
    0139B E080      LDI	R24,0
    0139C 8B8B      STD	Y+19,R24
    0139D 8B8C      STD	Y+20,R24
    0139E 8B8D      STD	Y+21,R24
    0139F 882A      LDD	R2,Y+18
    013A0 883B      LDD	R3,Y+19
    013A1 884C      LDD	R4,Y+20
    013A2 885D      LDD	R5,Y+21
    013A3 822E      STD	Y+6,R2
    013A4 823F      STD	Y+7,R3
    013A5 8648      STD	Y+8,R4
    013A6 8659      STD	Y+9,R5
(1024) 	}
(1025) 
(1026) 	return ncl;		/* Return new cluster number or error code */
    013A7 810E      LDD	R16,Y+6
    013A8 811F      LDD	R17,Y+7
    013A9 8528      LDD	R18,Y+8
    013AA 8539      LDD	R19,Y+9
    013AB 9666      ADIW	R28,0x16
    013AC 940E 4BA0 CALL	pop_xgsetF0FC
    013AE 9622      ADIW	R28,2
    013AF 9508      RET
ff.c:clmt_clust:
  tbl                  --> R10
  cl                   --> Y,+4
  ncl                  --> Y,+0
  ofs                  --> Y,+12
  fp                   --> R12
    013B0 933A      ST	-Y,R19
    013B1 932A      ST	-Y,R18
    013B2 940E 4BB1 CALL	push_xgset003C
    013B4 0168      MOVW	R12,R16
    013B5 9728      SBIW	R28,0x8
(1027) }
(1028) #endif /* !_FS_READONLY */
(1029) 
(1030) 
(1031) 
(1032) /*-----------------------------------------------------------------------*/
(1033) /* FAT handling - Convert offset into cluster with link map table        */
(1034) /*-----------------------------------------------------------------------*/
(1035) 
(1036) #if _USE_FASTSEEK
(1037) static
(1038) DWORD clmt_clust (	/* <2:Error, >=2:Cluster number */
(1039) 	FIL* fp,		/* Pointer to the file object */
(1040) 	DWORD ofs		/* File offset to be converted to cluster# */
(1041) )
(1042) {
(1043) 	DWORD cl, ncl, *tbl;
(1044) 
(1045) 
(1046) 	tbl = fp->cltbl + 1;	/* Top of CLMT */
    013B6 01F6      MOVW	R30,R12
    013B7 96B0      ADIW	R30,0x20
    013B8 8180      LD	R24,Z
    013B9 8191      LDD	R25,Z+1
    013BA 9604      ADIW	R24,4
    013BB 015C      MOVW	R10,R24
(1047) 	cl = ofs / SS(fp->fs) / fp->fs->csize;	/* Cluster order from top of the file */
    013BC E089      LDI	R24,0x9
    013BD E090      LDI	R25,0
    013BE 850C      LDD	R16,Y+12
    013BF 851D      LDD	R17,Y+13
    013C0 852E      LDD	R18,Y+14
    013C1 853F      LDD	R19,Y+15
    013C2 938A      ST	-Y,R24
    013C3 940E 4C4F CALL	lsr32
    013C5 01F6      MOVW	R30,R12
    013C6 93AF      PUSH	R26
    013C7 93BF      PUSH	R27
    013C8 81A0      LD	R26,Z
    013C9 81B1      LDD	R27,Z+1
    013CA 01FD      MOVW	R30,R26
    013CB 91BF      POP	R27
    013CC 91AF      POP	R26
    013CD 9632      ADIW	R30,2
    013CE 8020      LD	R2,Z
    013CF 2433      CLR	R3
    013D0 2444      CLR	R4
    013D1 2455      CLR	R5
    013D2 925A      ST	-Y,R5
    013D3 924A      ST	-Y,R4
    013D4 923A      ST	-Y,R3
    013D5 922A      ST	-Y,R2
    013D6 940E 4AB1 CALL	div32u
    013D8 830C      STD	Y+4,R16
    013D9 831D      STD	Y+5,R17
    013DA 832E      STD	Y+6,R18
    013DB 833F      STD	Y+7,R19
(1048) 	for (;;) {
(1049) 		ncl = *tbl++;			/* Number of cluters in the fragment */
    013DC 01F5      MOVW	R30,R10
    013DD 9021      LD	R2,Z+
    013DE 9031      LD	R3,Z+
    013DF 9041      LD	R4,Z+
    013E0 9051      LD	R5,Z+
    013E1 015F      MOVW	R10,R30
    013E2 8228      ST	Y,R2
    013E3 8239      STD	Y+1,R3
    013E4 824A      STD	Y+2,R4
    013E5 825B      STD	Y+3,R5
(1050) 		if (!ncl) return 0;		/* End of table? (error) */
    013E6 8028      LD	R2,Y
    013E7 8039      LDD	R3,Y+1
    013E8 804A      LDD	R4,Y+2
    013E9 805B      LDD	R5,Y+3
    013EA 9488      BCLR	0
    013EB 2022      TST	R2
    013EC 0432      CPC	R3,R2
    013ED 0442      CPC	R4,R2
    013EE 0452      CPC	R5,R2
    013EF F429      BNE	0x13F5
    013F0 E000      LDI	R16,0
    013F1 E010      LDI	R17,0
    013F2 E020      LDI	R18,0
    013F3 E030      LDI	R19,0
    013F4 C02F      RJMP	0x1424
(1051) 		if (cl < ncl) break;	/* In this fragment? */
    013F5 8028      LD	R2,Y
    013F6 8039      LDD	R3,Y+1
    013F7 804A      LDD	R4,Y+2
    013F8 805B      LDD	R5,Y+3
    013F9 806C      LDD	R6,Y+4
    013FA 807D      LDD	R7,Y+5
    013FB 808E      LDD	R8,Y+6
    013FC 809F      LDD	R9,Y+7
    013FD 1462      CP	R6,R2
    013FE 0473      CPC	R7,R3
    013FF 0484      CPC	R8,R4
    01400 0495      CPC	R9,R5
    01401 F408      BCC	0x1403
    01402 C014      RJMP	0x1417
(1052) 		cl -= ncl; tbl++;		/* Next fragment */
    01403 8028      LD	R2,Y
    01404 8039      LDD	R3,Y+1
    01405 804A      LDD	R4,Y+2
    01406 805B      LDD	R5,Y+3
    01407 806C      LDD	R6,Y+4
    01408 807D      LDD	R7,Y+5
    01409 808E      LDD	R8,Y+6
    0140A 809F      LDD	R9,Y+7
    0140B 1862      SUB	R6,R2
    0140C 0873      SBC	R7,R3
    0140D 0884      SBC	R8,R4
    0140E 0895      SBC	R9,R5
    0140F 826C      STD	Y+4,R6
    01410 827D      STD	Y+5,R7
    01411 828E      STD	Y+6,R8
    01412 829F      STD	Y+7,R9
    01413 01C5      MOVW	R24,R10
    01414 9604      ADIW	R24,4
    01415 015C      MOVW	R10,R24
    01416 CFC5      RJMP	0x13DC
(1053) 	}
(1054) 	return cl + *tbl;	/* Return the cluster number */
    01417 01F5      MOVW	R30,R10
    01418 8020      LD	R2,Z
    01419 8031      LDD	R3,Z+1
    0141A 8042      LDD	R4,Z+2
    0141B 8053      LDD	R5,Z+3
    0141C 810C      LDD	R16,Y+4
    0141D 811D      LDD	R17,Y+5
    0141E 812E      LDD	R18,Y+6
    0141F 813F      LDD	R19,Y+7
    01420 0D02      ADD	R16,R2
    01421 1D13      ADC	R17,R3
    01422 1D24      ADC	R18,R4
    01423 1D35      ADC	R19,R5
    01424 9628      ADIW	R28,0x8
    01425 940E 4B8B CALL	pop_xgset003C
    01427 9622      ADIW	R28,2
    01428 9508      RET
ff.c:dir_sdi:
  ic                   --> R14
  clst                 --> Y,+2
  idx                  --> R12
  dj                   --> R10
    01429 940E 4BAB CALL	push_xgsetF0FC
    0142B 0169      MOVW	R12,R18
    0142C 0158      MOVW	R10,R16
    0142D 9726      SBIW	R28,6
(1055) }
(1056) #endif	/* _USE_FASTSEEK */
(1057) 
(1058) 
(1059) 
(1060) /*-----------------------------------------------------------------------*/
(1061) /* Directory handling - Set directory index                              */
(1062) /*-----------------------------------------------------------------------*/
(1063) 
(1064) static
(1065) FRESULT dir_sdi (
(1066) 	DIR *dj,		/* Pointer to directory object */
(1067) 	WORD idx		/* Directory index number */
(1068) )
(1069) {
(1070) 	DWORD clst;
(1071) 	WORD ic;
(1072) 
(1073) 
(1074) 	dj->index = idx;
    0142E 01F5      MOVW	R30,R10
    0142F 82D5      STD	Z+5,R13
    01430 82C4      STD	Z+4,R12
(1075) 	clst = dj->sclust;
    01431 9636      ADIW	R30,6
    01432 8020      LD	R2,Z
    01433 8031      LDD	R3,Z+1
    01434 8042      LDD	R4,Z+2
    01435 8053      LDD	R5,Z+3
    01436 822A      STD	Y+2,R2
    01437 823B      STD	Y+3,R3
    01438 824C      STD	Y+4,R4
    01439 825D      STD	Y+5,R5
(1076) 	if (clst == 1 || clst >= dj->fs->n_fatent)	/* Check start cluster range */
    0143A E041      LDI	R20,1
    0143B E050      LDI	R21,0
    0143C E060      LDI	R22,0
    0143D E070      LDI	R23,0
    0143E 802A      LDD	R2,Y+2
    0143F 803B      LDD	R3,Y+3
    01440 804C      LDD	R4,Y+4
    01441 805D      LDD	R5,Y+5
    01442 1624      CP	R2,R20
    01443 0635      CPC	R3,R21
    01444 0646      CPC	R4,R22
    01445 0657      CPC	R5,R23
    01446 F089      BEQ	0x1458
    01447 01F5      MOVW	R30,R10
    01448 81A0      LD	R26,Z
    01449 81B1      LDD	R27,Z+1
    0144A 9656      ADIW	R26,0x16
    0144B 902D      LD	R2,X+
    0144C 903D      LD	R3,X+
    0144D 904D      LD	R4,X+
    0144E 905C      LD	R5,X
    0144F 806A      LDD	R6,Y+2
    01450 807B      LDD	R7,Y+3
    01451 808C      LDD	R8,Y+4
    01452 809D      LDD	R9,Y+5
    01453 1462      CP	R6,R2
    01454 0473      CPC	R7,R3
    01455 0484      CPC	R8,R4
    01456 0495      CPC	R9,R5
    01457 F010      BCS	0x145A
(1077) 		return FR_INT_ERR;
    01458 E002      LDI	R16,2
    01459 C0D6      RJMP	0x1530
(1078) 	if (!clst && dj->fs->fs_type == FS_FAT32)	/* Replace cluster# 0 with root cluster# if in FAT32 */
    0145A 802A      LDD	R2,Y+2
    0145B 803B      LDD	R3,Y+3
    0145C 804C      LDD	R4,Y+4
    0145D 805D      LDD	R5,Y+5
    0145E 9488      BCLR	0
    0145F 2022      TST	R2
    01460 0432      CPC	R3,R2
    01461 0442      CPC	R4,R2
    01462 0452      CPC	R5,R2
    01463 F479      BNE	0x1473
    01464 01F5      MOVW	R30,R10
    01465 81A0      LD	R26,Z
    01466 81B1      LDD	R27,Z+1
    01467 918C      LD	R24,X
    01468 3083      CPI	R24,3
    01469 F449      BNE	0x1473
(1079) 		clst = dj->fs->dirbase;
    0146A 9692      ADIW	R26,0x22
    0146B 902D      LD	R2,X+
    0146C 903D      LD	R3,X+
    0146D 904D      LD	R4,X+
    0146E 905C      LD	R5,X
    0146F 822A      STD	Y+2,R2
    01470 823B      STD	Y+3,R3
    01471 824C      STD	Y+4,R4
    01472 825D      STD	Y+5,R5
(1080) 
(1081) 	if (clst == 0) {	/* Static table (root-dir in FAT12/16) */
    01473 802A      LDD	R2,Y+2
    01474 803B      LDD	R3,Y+3
    01475 804C      LDD	R4,Y+4
    01476 805D      LDD	R5,Y+5
    01477 9488      BCLR	0
    01478 2022      TST	R2
    01479 0432      CPC	R3,R2
    0147A 0442      CPC	R4,R2
    0147B 0452      CPC	R5,R2
    0147C F009      BEQ	0x147E
    0147D C02B      RJMP	0x14A9
(1082) 		dj->clust = clst;
    0147E 01F5      MOVW	R30,R10
    0147F 8622      STD	Z+10,R2
    01480 8633      STD	Z+11,R3
    01481 8644      STD	Z+12,R4
    01482 8655      STD	Z+13,R5
(1083) 		if (idx >= dj->fs->n_rootdir)		/* Index is out of range */
    01483 81A0      LD	R26,Z
    01484 81B1      LDD	R27,Z+1
    01485 9618      ADIW	R26,0x8
    01486 902D      LD	R2,X+
    01487 903C      LD	R3,X
    01488 14C2      CP	R12,R2
    01489 04D3      CPC	R13,R3
    0148A F010      BCS	0x148D
(1084) 			return FR_INT_ERR;
    0148B E002      LDI	R16,2
    0148C C0A3      RJMP	0x1530
(1085) 		dj->sect = dj->fs->dirbase + idx / (SS(dj->fs) / SZ_DIR);	/* Sector# */
    0148D 0116      MOVW	R2,R12
    0148E 9436      LSR	R3
    0148F 9427      ROR	R2
    01490 9436      LSR	R3
    01491 9427      ROR	R2
    01492 9436      LSR	R3
    01493 9427      ROR	R2
    01494 9436      LSR	R3
    01495 9427      ROR	R2
    01496 2444      CLR	R4
    01497 2455      CLR	R5
    01498 01F5      MOVW	R30,R10
    01499 81A0      LD	R26,Z
    0149A 81B1      LDD	R27,Z+1
    0149B 9692      ADIW	R26,0x22
    0149C 906D      LD	R6,X+
    0149D 907D      LD	R7,X+
    0149E 908D      LD	R8,X+
    0149F 909C      LD	R9,X
    014A0 0C62      ADD	R6,R2
    014A1 1C73      ADC	R7,R3
    014A2 1C84      ADC	R8,R4
    014A3 1C95      ADC	R9,R5
    014A4 8666      STD	Z+14,R6
    014A5 8677      STD	Z+15,R7
    014A6 8A80      STD	Z+16,R8
    014A7 8A91      STD	Z+17,R9
(1086) 	}
    014A8 C076      RJMP	0x151F
(1087) 	else {				/* Dynamic table (sub-dirs or root-dir in FAT32) */
(1088) 		ic = SS(dj->fs) / SZ_DIR * dj->fs->csize;	/* Entries per cluster */
    014A9 01F5      MOVW	R30,R10
    014AA 93AF      PUSH	R26
    014AB 93BF      PUSH	R27
    014AC 81A0      LD	R26,Z
    014AD 81B1      LDD	R27,Z+1
    014AE 01FD      MOVW	R30,R26
    014AF 91BF      POP	R27
    014B0 91AF      POP	R26
    014B1 8022      LDD	R2,Z+2
    014B2 E180      LDI	R24,0x10
    014B3 9D82      MUL	R24,R2
    014B4 0170      MOVW	R14,R0
    014B5 C040      RJMP	0x14F6
(1089) 		while (idx >= ic) {	/* Follow cluster chain */
(1090) 			clst = get_fat(dj->fs, clst);				/* Get next cluster */
    014B6 802A      LDD	R2,Y+2
    014B7 803B      LDD	R3,Y+3
    014B8 804C      LDD	R4,Y+4
    014B9 805D      LDD	R5,Y+5
    014BA 8248      ST	Y,R4
    014BB 8259      STD	Y+1,R5
    014BC 0191      MOVW	R18,R2
    014BD 01F5      MOVW	R30,R10
    014BE 8100      LD	R16,Z
    014BF 8111      LDD	R17,Z+1
    014C0 D9B5      RCALL	_get_fat
    014C1 830A      STD	Y+2,R16
    014C2 831B      STD	Y+3,R17
    014C3 832C      STD	Y+4,R18
    014C4 833D      STD	Y+5,R19
(1091) 			if (clst == 0xFFFFFFFF) return FR_DISK_ERR;	/* Disk error */
    014C5 EF4F      LDI	R20,0xFF
    014C6 EF5F      LDI	R21,0xFF
    014C7 EF6F      LDI	R22,0xFF
    014C8 EF7F      LDI	R23,0xFF
    014C9 802A      LDD	R2,Y+2
    014CA 803B      LDD	R3,Y+3
    014CB 804C      LDD	R4,Y+4
    014CC 805D      LDD	R5,Y+5
    014CD 1624      CP	R2,R20
    014CE 0635      CPC	R3,R21
    014CF 0646      CPC	R4,R22
    014D0 0657      CPC	R5,R23
    014D1 F411      BNE	0x14D4
    014D2 E001      LDI	R16,1
    014D3 C05C      RJMP	0x1530
(1092) 			if (clst < 2 || clst >= dj->fs->n_fatent)	/* Reached to end of table or int error */
    014D4 E042      LDI	R20,2
    014D5 E050      LDI	R21,0
    014D6 E060      LDI	R22,0
    014D7 E070      LDI	R23,0
    014D8 802A      LDD	R2,Y+2
    014D9 803B      LDD	R3,Y+3
    014DA 804C      LDD	R4,Y+4
    014DB 805D      LDD	R5,Y+5
    014DC 1624      CP	R2,R20
    014DD 0635      CPC	R3,R21
    014DE 0646      CPC	R4,R22
    014DF 0657      CPC	R5,R23
    014E0 F088      BCS	0x14F2
    014E1 01F5      MOVW	R30,R10
    014E2 81A0      LD	R26,Z
    014E3 81B1      LDD	R27,Z+1
    014E4 9656      ADIW	R26,0x16
    014E5 902D      LD	R2,X+
    014E6 903D      LD	R3,X+
    014E7 904D      LD	R4,X+
    014E8 905C      LD	R5,X
    014E9 806A      LDD	R6,Y+2
    014EA 807B      LDD	R7,Y+3
    014EB 808C      LDD	R8,Y+4
    014EC 809D      LDD	R9,Y+5
    014ED 1462      CP	R6,R2
    014EE 0473      CPC	R7,R3
    014EF 0484      CPC	R8,R4
    014F0 0495      CPC	R9,R5
    014F1 F010      BCS	0x14F4
(1093) 				return FR_INT_ERR;
    014F2 E002      LDI	R16,2
    014F3 C03C      RJMP	0x1530
(1094) 			idx -= ic;
    014F4 18CE      SUB	R12,R14
    014F5 08DF      SBC	R13,R15
    014F6 14CE      CP	R12,R14
    014F7 04DF      CPC	R13,R15
    014F8 F008      BCS	0x14FA
    014F9 CFBC      RJMP	0x14B6
(1095) 		}
(1096) 		dj->clust = clst;
    014FA 802A      LDD	R2,Y+2
    014FB 803B      LDD	R3,Y+3
    014FC 804C      LDD	R4,Y+4
    014FD 805D      LDD	R5,Y+5
    014FE 01F5      MOVW	R30,R10
    014FF 8622      STD	Z+10,R2
    01500 8633      STD	Z+11,R3
    01501 8644      STD	Z+12,R4
    01502 8655      STD	Z+13,R5
(1097) 		dj->sect = clust2sect(dj->fs, clst) + idx / (SS(dj->fs) / SZ_DIR);	/* Sector# */
    01503 8248      ST	Y,R4
    01504 8259      STD	Y+1,R5
    01505 0191      MOVW	R18,R2
    01506 8100      LD	R16,Z
    01507 8111      LDD	R17,Z+1
    01508 D91B      RCALL	_clust2sect
    01509 0116      MOVW	R2,R12
    0150A 9436      LSR	R3
    0150B 9427      ROR	R2
    0150C 9436      LSR	R3
    0150D 9427      ROR	R2
    0150E 9436      LSR	R3
    0150F 9427      ROR	R2
    01510 9436      LSR	R3
    01511 9427      ROR	R2
    01512 2444      CLR	R4
    01513 2455      CLR	R5
    01514 0138      MOVW	R6,R16
    01515 0149      MOVW	R8,R18
    01516 0C62      ADD	R6,R2
    01517 1C73      ADC	R7,R3
    01518 1C84      ADC	R8,R4
    01519 1C95      ADC	R9,R5
    0151A 01F5      MOVW	R30,R10
    0151B 8666      STD	Z+14,R6
    0151C 8677      STD	Z+15,R7
    0151D 8A80      STD	Z+16,R8
    0151E 8A91      STD	Z+17,R9
(1098) 	}
(1099) 
(1100) 	dj->dir = dj->fs->win + (idx % (SS(dj->fs) / SZ_DIR)) * SZ_DIR;	/* Ptr to the entry in the sector */
    0151F 0196      MOVW	R18,R12
    01520 702F      ANDI	R18,0xF
    01521 7030      ANDI	R19,0
    01522 E200      LDI	R16,0x20
    01523 E010      LDI	R17,0
    01524 940E 4B47 CALL	empy16s
    01526 0118      MOVW	R2,R16
    01527 01F5      MOVW	R30,R10
    01528 8180      LD	R24,Z
    01529 8191      LDD	R25,Z+1
    0152A 968E      ADIW	R24,0x2E
    0152B 0E28      ADD	R2,R24
    0152C 1E39      ADC	R3,R25
    0152D 8A33      STD	Z+19,R3
    0152E 8A22      STD	Z+18,R2
(1101) 
(1102) 	return FR_OK;	/* Seek succeeded */
    0152F 2700      CLR	R16
    01530 9626      ADIW	R28,6
    01531 940C 4BA0 JMP	pop_xgsetF0FC
ff.c:dir_next:
  c                    --> R10
  clst                 --> Y,+2
  i                    --> R12
  stretch              --> R10
  dj                   --> Y,+16
    01533 940E 4A66 CALL	push_arg4
    01535 940E 4BAB CALL	push_xgsetF0FC
    01537 0159      MOVW	R10,R18
    01538 9726      SBIW	R28,6
(1103) }
(1104) 
(1105) 
(1106) 
(1107) 
(1108) /*-----------------------------------------------------------------------*/
(1109) /* Directory handling - Move directory index next                        */
(1110) /*-----------------------------------------------------------------------*/
(1111) 
(1112) static
(1113) FRESULT dir_next (	/* FR_OK:Succeeded, FR_NO_FILE:End of table, FR_DENIED:EOT and could not stretch */
(1114) 	DIR *dj,		/* Pointer to directory object */
(1115) 	int stretch		/* 0: Do not stretch table, 1: Stretch table if needed */
(1116) )
(1117) {
(1118) 	DWORD clst;
(1119) 	WORD i;
(1120) 
(1121) 
(1122) 	stretch = stretch;		/* To suppress warning on read-only cfg. */
(1123) 	i = dj->index + 1;
    01539 89E8      LDD	R30,Y+16
    0153A 89F9      LDD	R31,Y+17
    0153B 8184      LDD	R24,Z+4
    0153C 8195      LDD	R25,Z+5
    0153D 9601      ADIW	R24,1
    0153E 016C      MOVW	R12,R24
(1124) 	if (!i || !dj->sect)	/* Report EOT when index has reached 65535 */
    0153F 3080      CPI	R24,0
    01540 0789      CPC	R24,R25
    01541 F059      BEQ	0x154D
    01542 963E      ADIW	R30,0xE
    01543 8020      LD	R2,Z
    01544 8031      LDD	R3,Z+1
    01545 8042      LDD	R4,Z+2
    01546 8053      LDD	R5,Z+3
    01547 9488      BCLR	0
    01548 2022      TST	R2
    01549 0432      CPC	R3,R2
    0154A 0442      CPC	R4,R2
    0154B 0452      CPC	R5,R2
    0154C F411      BNE	0x154F
(1125) 		return FR_NO_FILE;
    0154D E004      LDI	R16,4
    0154E C18D      RJMP	0x16DC
(1126) 
(1127) 	if (!(i % (SS(dj->fs) / SZ_DIR))) {	/* Sector changed? */
    0154F 01C6      MOVW	R24,R12
    01550 708F      ANDI	R24,0xF
    01551 7090      ANDI	R25,0
    01552 3080      CPI	R24,0
    01553 0789      CPC	R24,R25
    01554 F009      BEQ	0x1556
    01555 C170      RJMP	0x16C6
(1128) 		dj->sect++;					/* Next sector */
    01556 8988      LDD	R24,Y+16
    01557 8999      LDD	R25,Y+17
    01558 960E      ADIW	R24,0xE
    01559 E041      LDI	R20,1
    0155A E050      LDI	R21,0
    0155B E060      LDI	R22,0
    0155C E070      LDI	R23,0
    0155D 01FC      MOVW	R30,R24
    0155E 8020      LD	R2,Z
    0155F 8031      LDD	R3,Z+1
    01560 8042      LDD	R4,Z+2
    01561 8053      LDD	R5,Z+3
    01562 0E24      ADD	R2,R20
    01563 1E35      ADC	R3,R21
    01564 1E46      ADC	R4,R22
    01565 1E57      ADC	R5,R23
    01566 8220      ST	Z,R2
    01567 8231      STD	Z+1,R3
    01568 8242      STD	Z+2,R4
    01569 8253      STD	Z+3,R5
(1129) 
(1130) 		if (dj->clust == 0) {	/* Static table */
    0156A 89E8      LDD	R30,Y+16
    0156B 89F9      LDD	R31,Y+17
    0156C 963A      ADIW	R30,0xA
    0156D 8020      LD	R2,Z
    0156E 8031      LDD	R3,Z+1
    0156F 8042      LDD	R4,Z+2
    01570 8053      LDD	R5,Z+3
    01571 9488      BCLR	0
    01572 2022      TST	R2
    01573 0432      CPC	R3,R2
    01574 0442      CPC	R4,R2
    01575 0452      CPC	R5,R2
    01576 F469      BNE	0x1584
(1131) 			if (i >= dj->fs->n_rootdir)	/* Report EOT when end of table */
    01577 89E8      LDD	R30,Y+16
    01578 89F9      LDD	R31,Y+17
    01579 81A0      LD	R26,Z
    0157A 81B1      LDD	R27,Z+1
    0157B 9618      ADIW	R26,0x8
    0157C 902D      LD	R2,X+
    0157D 903C      LD	R3,X
    0157E 14C2      CP	R12,R2
    0157F 04D3      CPC	R13,R3
    01580 F408      BCC	0x1582
    01581 C144      RJMP	0x16C6
(1132) 				return FR_NO_FILE;
    01582 E004      LDI	R16,4
    01583 C158      RJMP	0x16DC
(1133) 		}
(1134) 		else {					/* Dynamic table */
(1135) 			if (((i / (SS(dj->fs) / SZ_DIR)) & (dj->fs->csize - 1)) == 0) {	/* Cluster changed? */
    01584 89E8      LDD	R30,Y+16
    01585 89F9      LDD	R31,Y+17
    01586 93AF      PUSH	R26
    01587 93BF      PUSH	R27
    01588 81A0      LD	R26,Z
    01589 81B1      LDD	R27,Z+1
    0158A 01FD      MOVW	R30,R26
    0158B 91BF      POP	R27
    0158C 91AF      POP	R26
    0158D 8182      LDD	R24,Z+2
    0158E 2799      CLR	R25
    0158F 9701      SBIW	R24,1
    01590 0116      MOVW	R2,R12
    01591 9436      LSR	R3
    01592 9427      ROR	R2
    01593 9436      LSR	R3
    01594 9427      ROR	R2
    01595 9436      LSR	R3
    01596 9427      ROR	R2
    01597 9436      LSR	R3
    01598 9427      ROR	R2
    01599 2228      AND	R2,R24
    0159A 2239      AND	R3,R25
    0159B 2022      TST	R2
    0159C F009      BEQ	0x159E
    0159D C128      RJMP	0x16C6
    0159E 2033      TST	R3
    0159F F009      BEQ	0x15A1
    015A0 C125      RJMP	0x16C6
(1136) 				clst = get_fat(dj->fs, dj->clust);				/* Get next cluster */
    015A1 89E8      LDD	R30,Y+16
    015A2 89F9      LDD	R31,Y+17
    015A3 8422      LDD	R2,Z+10
    015A4 8433      LDD	R3,Z+11
    015A5 8444      LDD	R4,Z+12
    015A6 8455      LDD	R5,Z+13
    015A7 8248      ST	Y,R4
    015A8 8259      STD	Y+1,R5
    015A9 0191      MOVW	R18,R2
    015AA 8100      LD	R16,Z
    015AB 8111      LDD	R17,Z+1
    015AC D8C9      RCALL	_get_fat
    015AD 830A      STD	Y+2,R16
    015AE 831B      STD	Y+3,R17
    015AF 832C      STD	Y+4,R18
    015B0 833D      STD	Y+5,R19
(1137) 				if (clst <= 1) return FR_INT_ERR;
    015B1 E041      LDI	R20,1
    015B2 E050      LDI	R21,0
    015B3 E060      LDI	R22,0
    015B4 E070      LDI	R23,0
    015B5 802A      LDD	R2,Y+2
    015B6 803B      LDD	R3,Y+3
    015B7 804C      LDD	R4,Y+4
    015B8 805D      LDD	R5,Y+5
    015B9 1542      CP	R20,R2
    015BA 0553      CPC	R21,R3
    015BB 0564      CPC	R22,R4
    015BC 0575      CPC	R23,R5
    015BD F010      BCS	0x15C0
    015BE E002      LDI	R16,2
    015BF C11C      RJMP	0x16DC
(1138) 				if (clst == 0xFFFFFFFF) return FR_DISK_ERR;
    015C0 EF4F      LDI	R20,0xFF
    015C1 EF5F      LDI	R21,0xFF
    015C2 EF6F      LDI	R22,0xFF
    015C3 EF7F      LDI	R23,0xFF
    015C4 802A      LDD	R2,Y+2
    015C5 803B      LDD	R3,Y+3
    015C6 804C      LDD	R4,Y+4
    015C7 805D      LDD	R5,Y+5
    015C8 1624      CP	R2,R20
    015C9 0635      CPC	R3,R21
    015CA 0646      CPC	R4,R22
    015CB 0657      CPC	R5,R23
    015CC F411      BNE	0x15CF
    015CD E001      LDI	R16,1
    015CE C10D      RJMP	0x16DC
(1139) 				if (clst >= dj->fs->n_fatent) {					/* When it reached end of dynamic table */
    015CF 89E8      LDD	R30,Y+16
    015D0 89F9      LDD	R31,Y+17
    015D1 81A0      LD	R26,Z
    015D2 81B1      LDD	R27,Z+1
    015D3 9656      ADIW	R26,0x16
    015D4 902D      LD	R2,X+
    015D5 903D      LD	R3,X+
    015D6 904D      LD	R4,X+
    015D7 905C      LD	R5,X
    015D8 806A      LDD	R6,Y+2
    015D9 807B      LDD	R7,Y+3
    015DA 808C      LDD	R8,Y+4
    015DB 809D      LDD	R9,Y+5
    015DC 1462      CP	R6,R2
    015DD 0473      CPC	R7,R3
    015DE 0484      CPC	R8,R4
    015DF 0495      CPC	R9,R5
    015E0 F408      BCC	0x15E2
    015E1 C0CD      RJMP	0x16AF
(1140) #if !_FS_READONLY
(1141) 					BYTE c;
(1142) 					if (!stretch) return FR_NO_FILE;			/* When do not stretch, report EOT */
    015E2 20AA      TST	R10
    015E3 F421      BNE	0x15E8
    015E4 20BB      TST	R11
    015E5 F411      BNE	0x15E8
    015E6 E004      LDI	R16,4
    015E7 C0F4      RJMP	0x16DC
(1143) 					clst = create_chain(dj->fs, dj->clust);		/* Stretch cluster chain */
    015E8 89E8      LDD	R30,Y+16
    015E9 89F9      LDD	R31,Y+17
    015EA 8422      LDD	R2,Z+10
    015EB 8433      LDD	R3,Z+11
    015EC 8444      LDD	R4,Z+12
    015ED 8455      LDD	R5,Z+13
    015EE 8248      ST	Y,R4
    015EF 8259      STD	Y+1,R5
    015F0 0191      MOVW	R18,R2
    015F1 8100      LD	R16,Z
    015F2 8111      LDD	R17,Z+1
    015F3 DC44      RCALL	ff.c:create_chain
    015F4 830A      STD	Y+2,R16
    015F5 831B      STD	Y+3,R17
    015F6 832C      STD	Y+4,R18
    015F7 833D      STD	Y+5,R19
(1144) 					if (clst == 0) return FR_DENIED;			/* No free cluster */
    015F8 802A      LDD	R2,Y+2
    015F9 803B      LDD	R3,Y+3
    015FA 804C      LDD	R4,Y+4
    015FB 805D      LDD	R5,Y+5
    015FC 9488      BCLR	0
    015FD 2022      TST	R2
    015FE 0432      CPC	R3,R2
    015FF 0442      CPC	R4,R2
    01600 0452      CPC	R5,R2
    01601 F411      BNE	0x1604
    01602 E007      LDI	R16,7
    01603 C0D8      RJMP	0x16DC
(1145) 					if (clst == 1) return FR_INT_ERR;
    01604 E041      LDI	R20,1
    01605 E050      LDI	R21,0
    01606 E060      LDI	R22,0
    01607 E070      LDI	R23,0
    01608 802A      LDD	R2,Y+2
    01609 803B      LDD	R3,Y+3
    0160A 804C      LDD	R4,Y+4
    0160B 805D      LDD	R5,Y+5
    0160C 1624      CP	R2,R20
    0160D 0635      CPC	R3,R21
    0160E 0646      CPC	R4,R22
    0160F 0657      CPC	R5,R23
    01610 F411      BNE	0x1613
    01611 E002      LDI	R16,2
    01612 C0C9      RJMP	0x16DC
(1146) 					if (clst == 0xFFFFFFFF) return FR_DISK_ERR;
    01613 EF4F      LDI	R20,0xFF
    01614 EF5F      LDI	R21,0xFF
    01615 EF6F      LDI	R22,0xFF
    01616 EF7F      LDI	R23,0xFF
    01617 802A      LDD	R2,Y+2
    01618 803B      LDD	R3,Y+3
    01619 804C      LDD	R4,Y+4
    0161A 805D      LDD	R5,Y+5
    0161B 1624      CP	R2,R20
    0161C 0635      CPC	R3,R21
    0161D 0646      CPC	R4,R22
    0161E 0657      CPC	R5,R23
    0161F F411      BNE	0x1622
    01620 E001      LDI	R16,1
    01621 C0BA      RJMP	0x16DC
(1147) 					/* Clean-up stretched table */
(1148) 					if (move_window(dj->fs, 0)) return FR_DISK_ERR;	/* Flush active window */
    01622 E040      LDI	R20,0
    01623 E050      LDI	R21,0
    01624 E060      LDI	R22,0
    01625 E070      LDI	R23,0
    01626 8368      ST	Y,R22
    01627 8379      STD	Y+1,R23
    01628 019A      MOVW	R18,R20
    01629 89E8      LDD	R30,Y+16
    0162A 89F9      LDD	R31,Y+17
    0162B 8100      LD	R16,Z
    0162C 8111      LDD	R17,Z+1
    0162D 940E 0CAD CALL	ff.c:move_window
    0162F 2300      TST	R16
    01630 F011      BEQ	0x1633
    01631 E001      LDI	R16,1
    01632 C0A9      RJMP	0x16DC
(1149) 					mem_set(dj->fs->win, 0, SS(dj->fs));			/* Clear window buffer */
    01633 E080      LDI	R24,0
    01634 E092      LDI	R25,2
    01635 8399      STD	Y+1,R25
    01636 8388      ST	Y,R24
    01637 2722      CLR	R18
    01638 2733      CLR	R19
    01639 89E8      LDD	R30,Y+16
    0163A 89F9      LDD	R31,Y+17
    0163B 8100      LD	R16,Z
    0163C 8111      LDD	R17,Z+1
    0163D 5D02      SUBI	R16,0xD2
    0163E 4F1F      SBCI	R17,0xFF
    0163F 940E 0C6A CALL	ff.c:mem_set
(1150) 					dj->fs->winsect = clust2sect(dj->fs, clst);	/* Cluster start sector */
    01641 802A      LDD	R2,Y+2
    01642 803B      LDD	R3,Y+3
    01643 804C      LDD	R4,Y+4
    01644 805D      LDD	R5,Y+5
    01645 8248      ST	Y,R4
    01646 8259      STD	Y+1,R5
    01647 0191      MOVW	R18,R2
    01648 89E8      LDD	R30,Y+16
    01649 89F9      LDD	R31,Y+17
    0164A 80A0      LD	R10,Z
    0164B 80B1      LDD	R11,Z+1
    0164C 0185      MOVW	R16,R10
    0164D 940E 0E24 CALL	_clust2sect
    0164F 01F5      MOVW	R30,R10
    01650 A702      STD	Z+42,R16
    01651 A713      STD	Z+43,R17
    01652 A724      STD	Z+44,R18
    01653 A735      STD	Z+45,R19
(1151) 					for (c = 0; c < dj->fs->csize; c++) {		/* Fill the new cluster with 0 */
    01654 24AA      CLR	R10
    01655 C035      RJMP	0x168B
(1152) 						dj->fs->wflag = 1;
    01656 E081      LDI	R24,1
    01657 89E8      LDD	R30,Y+16
    01658 89F9      LDD	R31,Y+17
    01659 93AF      PUSH	R26
    0165A 93BF      PUSH	R27
    0165B 81A0      LD	R26,Z
    0165C 81B1      LDD	R27,Z+1
    0165D 01FD      MOVW	R30,R26
    0165E 91BF      POP	R27
    0165F 91AF      POP	R26
    01660 8384      STD	Z+4,R24
(1153) 						if (move_window(dj->fs, 0)) return FR_DISK_ERR;
    01661 E040      LDI	R20,0
    01662 E050      LDI	R21,0
    01663 E060      LDI	R22,0
    01664 E070      LDI	R23,0
    01665 8368      ST	Y,R22
    01666 8379      STD	Y+1,R23
    01667 019A      MOVW	R18,R20
    01668 89E8      LDD	R30,Y+16
    01669 89F9      LDD	R31,Y+17
    0166A 8100      LD	R16,Z
    0166B 8111      LDD	R17,Z+1
    0166C 940E 0CAD CALL	ff.c:move_window
    0166E 2EE0      MOV	R14,R16
    0166F 2300      TST	R16
    01670 F011      BEQ	0x1673
    01671 E001      LDI	R16,1
    01672 C069      RJMP	0x16DC
(1154) 						dj->fs->winsect++;
    01673 89E8      LDD	R30,Y+16
    01674 89F9      LDD	R31,Y+17
    01675 8180      LD	R24,Z
    01676 8191      LDD	R25,Z+1
    01677 968A      ADIW	R24,0x2A
    01678 017C      MOVW	R14,R24
    01679 E041      LDI	R20,1
    0167A E050      LDI	R21,0
    0167B E060      LDI	R22,0
    0167C E070      LDI	R23,0
    0167D 01FC      MOVW	R30,R24
    0167E 8020      LD	R2,Z
    0167F 8031      LDD	R3,Z+1
    01680 8042      LDD	R4,Z+2
    01681 8053      LDD	R5,Z+3
    01682 0E24      ADD	R2,R20
    01683 1E35      ADC	R3,R21
    01684 1E46      ADC	R4,R22
    01685 1E57      ADC	R5,R23
    01686 8220      ST	Z,R2
    01687 8231      STD	Z+1,R3
    01688 8242      STD	Z+2,R4
    01689 8253      STD	Z+3,R5
    0168A 94A3      INC	R10
    0168B 89E8      LDD	R30,Y+16
    0168C 89F9      LDD	R31,Y+17
    0168D 93AF      PUSH	R26
    0168E 93BF      PUSH	R27
    0168F 81A0      LD	R26,Z
    01690 81B1      LDD	R27,Z+1
    01691 01FD      MOVW	R30,R26
    01692 91BF      POP	R27
    01693 91AF      POP	R26
    01694 8022      LDD	R2,Z+2
    01695 14A2      CP	R10,R2
    01696 F408      BCC	0x1698
    01697 CFBE      RJMP	0x1656
(1155) 					}
(1156) 					dj->fs->winsect -= c;						/* Rewind window address */
    01698 89E8      LDD	R30,Y+16
    01699 89F9      LDD	R31,Y+17
    0169A 8180      LD	R24,Z
    0169B 8191      LDD	R25,Z+1
    0169C 968A      ADIW	R24,0x2A
    0169D 017C      MOVW	R14,R24
    0169E 2C2A      MOV	R2,R10
    0169F 2433      CLR	R3
    016A0 2444      CLR	R4
    016A1 2455      CLR	R5
    016A2 01FC      MOVW	R30,R24
    016A3 8060      LD	R6,Z
    016A4 8071      LDD	R7,Z+1
    016A5 8082      LDD	R8,Z+2
    016A6 8093      LDD	R9,Z+3
    016A7 1862      SUB	R6,R2
    016A8 0873      SBC	R7,R3
    016A9 0884      SBC	R8,R4
    016AA 0895      SBC	R9,R5
    016AB 8260      ST	Z,R6
    016AC 8271      STD	Z+1,R7
    016AD 8282      STD	Z+2,R8
    016AE 8293      STD	Z+3,R9
(1157) #else
(1158) 					return FR_NO_FILE;			/* Report EOT */
(1159) #endif
(1160) 				}
(1161) 				dj->clust = clst;				/* Initialize data for new cluster */
    016AF 802A      LDD	R2,Y+2
    016B0 803B      LDD	R3,Y+3
    016B1 804C      LDD	R4,Y+4
    016B2 805D      LDD	R5,Y+5
    016B3 89E8      LDD	R30,Y+16
    016B4 89F9      LDD	R31,Y+17
    016B5 8622      STD	Z+10,R2
    016B6 8633      STD	Z+11,R3
    016B7 8644      STD	Z+12,R4
    016B8 8655      STD	Z+13,R5
(1162) 				dj->sect = clust2sect(dj->fs, clst);
    016B9 8248      ST	Y,R4
    016BA 8259      STD	Y+1,R5
    016BB 0191      MOVW	R18,R2
    016BC 8100      LD	R16,Z
    016BD 8111      LDD	R17,Z+1
    016BE 940E 0E24 CALL	_clust2sect
    016C0 89E8      LDD	R30,Y+16
    016C1 89F9      LDD	R31,Y+17
    016C2 8706      STD	Z+14,R16
    016C3 8717      STD	Z+15,R17
    016C4 8B20      STD	Z+16,R18
    016C5 8B31      STD	Z+17,R19
(1163) 			}
(1164) 		}
(1165) 	}
(1166) 
(1167) 	dj->index = i;
    016C6 89E8      LDD	R30,Y+16
    016C7 89F9      LDD	R31,Y+17
    016C8 82D5      STD	Z+5,R13
    016C9 82C4      STD	Z+4,R12
(1168) 	dj->dir = dj->fs->win + (i % (SS(dj->fs) / SZ_DIR)) * SZ_DIR;
    016CA 0196      MOVW	R18,R12
    016CB 702F      ANDI	R18,0xF
    016CC 7030      ANDI	R19,0
    016CD E200      LDI	R16,0x20
    016CE E010      LDI	R17,0
    016CF 940E 4B47 CALL	empy16s
    016D1 0118      MOVW	R2,R16
    016D2 89E8      LDD	R30,Y+16
    016D3 89F9      LDD	R31,Y+17
    016D4 8180      LD	R24,Z
    016D5 8191      LDD	R25,Z+1
    016D6 968E      ADIW	R24,0x2E
    016D7 0E28      ADD	R2,R24
    016D8 1E39      ADC	R3,R25
    016D9 8A33      STD	Z+19,R3
    016DA 8A22      STD	Z+18,R2
(1169) 
(1170) 	return FR_OK;
    016DB 2700      CLR	R16
    016DC 9626      ADIW	R28,6
    016DD 940E 4BA0 CALL	pop_xgsetF0FC
    016DF 9624      ADIW	R28,4
    016E0 9508      RET
ff.c:dir_find:
  c                    --> R12
  dir                  --> R10
  res                  --> R20
  dj                   --> R22
    016E1 940E 4BE6 CALL	push_xgsetF03C
    016E3 01B8      MOVW	R22,R16
    016E4 9722      SBIW	R28,2
(1171) }
(1172) 
(1173) 
(1174) 
(1175) 
(1176) /*-----------------------------------------------------------------------*/
(1177) /* LFN handling - Test/Pick/Fit an LFN segment from/to directory entry   */
(1178) /*-----------------------------------------------------------------------*/
(1179) #if _USE_LFN
(1180) static
(1181) const BYTE LfnOfs[] = {1,3,5,7,9,14,16,18,20,22,24,28,30};	/* Offset of LFN chars in the directory entry */
(1182) 
(1183) 
(1184) static
(1185) int cmp_lfn (			/* 1:Matched, 0:Not matched */
(1186) 	WCHAR *lfnbuf,		/* Pointer to the LFN to be compared */
(1187) 	BYTE *dir			/* Pointer to the directory entry containing a part of LFN */
(1188) )
(1189) {
(1190) 	UINT i, s;
(1191) 	WCHAR wc, uc;
(1192) 
(1193) 
(1194) 	i = ((dir[LDIR_Ord] & ~LLE) - 1) * 13;	/* Get offset in the LFN buffer */
(1195) 	s = 0; wc = 1;
(1196) 	do {
(1197) 		uc = LD_WORD(dir+LfnOfs[s]);	/* Pick an LFN character from the entry */
(1198) 		if (wc) {	/* Last char has not been processed */
(1199) 			wc = ff_wtoupper(uc);		/* Convert it to upper case */
(1200) 			if (i >= _MAX_LFN || wc != ff_wtoupper(lfnbuf[i++]))	/* Compare it */
(1201) 				return 0;				/* Not matched */
(1202) 		} else {
(1203) 			if (uc != 0xFFFF) return 0;	/* Check filler */
(1204) 		}
(1205) 	} while (++s < 13);				/* Repeat until all chars in the entry are checked */
(1206) 
(1207) 	if ((dir[LDIR_Ord] & LLE) && wc && lfnbuf[i])	/* Last segment matched but different length */
(1208) 		return 0;
(1209) 
(1210) 	return 1;						/* The part of LFN matched */
(1211) }
(1212) 
(1213) 
(1214) 
(1215) static
(1216) int pick_lfn (			/* 1:Succeeded, 0:Buffer overflow */
(1217) 	WCHAR *lfnbuf,		/* Pointer to the Unicode-LFN buffer */
(1218) 	BYTE *dir			/* Pointer to the directory entry */
(1219) )
(1220) {
(1221) 	UINT i, s;
(1222) 	WCHAR wc, uc;
(1223) 
(1224) 
(1225) 	i = ((dir[LDIR_Ord] & 0x3F) - 1) * 13;	/* Offset in the LFN buffer */
(1226) 
(1227) 	s = 0; wc = 1;
(1228) 	do {
(1229) 		uc = LD_WORD(dir+LfnOfs[s]);		/* Pick an LFN character from the entry */
(1230) 		if (wc) {	/* Last char has not been processed */
(1231) 			if (i >= _MAX_LFN) return 0;	/* Buffer overflow? */
(1232) 			lfnbuf[i++] = wc = uc;			/* Store it */
(1233) 		} else {
(1234) 			if (uc != 0xFFFF) return 0;		/* Check filler */
(1235) 		}
(1236) 	} while (++s < 13);						/* Read all character in the entry */
(1237) 
(1238) 	if (dir[LDIR_Ord] & LLE) {				/* Put terminator if it is the last LFN part */
(1239) 		if (i >= _MAX_LFN) return 0;		/* Buffer overflow? */
(1240) 		lfnbuf[i] = 0;
(1241) 	}
(1242) 
(1243) 	return 1;
(1244) }
(1245) 
(1246) 
(1247) #if !_FS_READONLY
(1248) static
(1249) void fit_lfn (
(1250) 	const WCHAR *lfnbuf,	/* Pointer to the LFN buffer */
(1251) 	BYTE *dir,				/* Pointer to the directory entry */
(1252) 	BYTE ord,				/* LFN order (1-20) */
(1253) 	BYTE sum				/* SFN sum */
(1254) )
(1255) {
(1256) 	UINT i, s;
(1257) 	WCHAR wc;
(1258) 
(1259) 
(1260) 	dir[LDIR_Chksum] = sum;			/* Set check sum */
(1261) 	dir[LDIR_Attr] = AM_LFN;		/* Set attribute. LFN entry */
(1262) 	dir[LDIR_Type] = 0;
(1263) 	ST_WORD(dir+LDIR_FstClusLO, 0);
(1264) 
(1265) 	i = (ord - 1) * 13;				/* Get offset in the LFN buffer */
(1266) 	s = wc = 0;
(1267) 	do {
(1268) 		if (wc != 0xFFFF) wc = lfnbuf[i++];	/* Get an effective char */
(1269) 		ST_WORD(dir+LfnOfs[s], wc);	/* Put it */
(1270) 		if (!wc) wc = 0xFFFF;		/* Padding chars following last char */
(1271) 	} while (++s < 13);
(1272) 	if (wc == 0xFFFF || !lfnbuf[i]) ord |= LLE;	/* Bottom LFN part is the start of LFN sequence */
(1273) 	dir[LDIR_Ord] = ord;			/* Set the LFN order */
(1274) }
(1275) 
(1276) #endif
(1277) #endif
(1278) 
(1279) 
(1280) 
(1281) /*-----------------------------------------------------------------------*/
(1282) /* Create numbered name                                                  */
(1283) /*-----------------------------------------------------------------------*/
(1284) #if _USE_LFN
(1285) void gen_numname (
(1286) 	BYTE *dst,			/* Pointer to generated SFN */
(1287) 	const BYTE *src,	/* Pointer to source SFN to be modified */
(1288) 	const WCHAR *lfn,	/* Pointer to LFN */
(1289) 	WORD seq			/* Sequence number */
(1290) )
(1291) {
(1292) 	BYTE ns[8], c;
(1293) 	UINT i, j;
(1294) 
(1295) 
(1296) 	mem_cpy(dst, src, 11);
(1297) 
(1298) 	if (seq > 5) {	/* On many collisions, generate a hash number instead of sequential number */
(1299) 		do seq = (seq >> 1) + (seq << 15) + (WORD)*lfn++; while (*lfn);
(1300) 	}
(1301) 
(1302) 	/* itoa (hexdecimal) */
(1303) 	i = 7;
(1304) 	do {
(1305) 		c = (seq % 16) + '0';
(1306) 		if (c > '9') c += 7;
(1307) 		ns[i--] = c;
(1308) 		seq /= 16;
(1309) 	} while (seq);
(1310) 	ns[i] = '~';
(1311) 
(1312) 	/* Append the number */
(1313) 	for (j = 0; j < i && dst[j] != ' '; j++) {
(1314) 		if (IsDBCS1(dst[j])) {
(1315) 			if (j == i - 1) break;
(1316) 			j++;
(1317) 		}
(1318) 	}
(1319) 	do {
(1320) 		dst[j++] = (i < 8) ? ns[i++] : ' ';
(1321) 	} while (j < 8);
(1322) }
(1323) #endif
(1324) 
(1325) 
(1326) 
(1327) 
(1328) /*-----------------------------------------------------------------------*/
(1329) /* Calculate sum of an SFN                                               */
(1330) /*-----------------------------------------------------------------------*/
(1331) #if _USE_LFN
(1332) static
(1333) BYTE sum_sfn (
(1334) 	const BYTE *dir		/* Ptr to directory entry */
(1335) )
(1336) {
(1337) 	BYTE sum = 0;
(1338) 	UINT n = 11;
(1339) 
(1340) 	do sum = (sum >> 1) + (sum << 7) + *dir++; while (--n);
(1341) 	return sum;
(1342) }
(1343) #endif
(1344) 
(1345) 
(1346) 
(1347) 
(1348) /*-----------------------------------------------------------------------*/
(1349) /* Directory handling - Find an object in the directory                  */
(1350) /*-----------------------------------------------------------------------*/
(1351) 
(1352) static
(1353) FRESULT dir_find (
(1354) 	DIR *dj			/* Pointer to the directory object linked to the file name */
(1355) )
(1356) {
(1357) 	FRESULT res;
(1358) 	BYTE c, *dir;
(1359) #if _USE_LFN
(1360) 	BYTE a, ord, sum;
(1361) #endif
(1362) 
(1363) 	res = dir_sdi(dj, 0);			/* Rewind directory object */
    016E5 2722      CLR	R18
    016E6 2733      CLR	R19
    016E7 018B      MOVW	R16,R22
    016E8 DD40      RCALL	ff.c:dir_sdi
    016E9 2F40      MOV	R20,R16
(1364) 	if (res != FR_OK) return res;
    016EA 2300      TST	R16
    016EB F009      BEQ	0x16ED
    016EC C036      RJMP	0x1723
(1365) 
(1366) #if _USE_LFN
(1367) 	ord = sum = 0xFF;
(1368) #endif
(1369) 	do {
(1370) 		res = move_window(dj->fs, dj->sect);
    016ED 01FB      MOVW	R30,R22
    016EE 8426      LDD	R2,Z+14
    016EF 8437      LDD	R3,Z+15
    016F0 8840      LDD	R4,Z+16
    016F1 8851      LDD	R5,Z+17
    016F2 8248      ST	Y,R4
    016F3 8259      STD	Y+1,R5
    016F4 0191      MOVW	R18,R2
    016F5 8100      LD	R16,Z
    016F6 8111      LDD	R17,Z+1
    016F7 940E 0CAD CALL	ff.c:move_window
    016F9 2F40      MOV	R20,R16
(1371) 		if (res != FR_OK) break;
    016FA 2300      TST	R16
    016FB F009      BEQ	0x16FD
    016FC C025      RJMP	0x1722
(1372) 		dir = dj->dir;					/* Ptr to the directory entry of current index */
    016FD 01FB      MOVW	R30,R22
    016FE 88A2      LDD	R10,Z+18
    016FF 88B3      LDD	R11,Z+19
(1373) 		c = dir[DIR_Name];
    01700 01F5      MOVW	R30,R10
    01701 80C0      LD	R12,Z
(1374) 		if (c == 0) { res = FR_NO_FILE; break; }	/* Reached to end of table */
    01702 20CC      TST	R12
    01703 F411      BNE	0x1706
    01704 E044      LDI	R20,4
    01705 C01C      RJMP	0x1722
(1375) #if _USE_LFN	/* LFN configuration */
(1376) 		a = dir[DIR_Attr] & AM_MASK;
(1377) 		if (c == DDE || ((a & AM_VOL) && a != AM_LFN)) {	/* An entry without valid data */
(1378) 			ord = 0xFF;
(1379) 		} else {
(1380) 			if (a == AM_LFN) {			/* An LFN entry is found */
(1381) 				if (dj->lfn) {
(1382) 					if (c & LLE) {		/* Is it start of LFN sequence? */
(1383) 						sum = dir[LDIR_Chksum];
(1384) 						c &= ~LLE; ord = c;	/* LFN start order */
(1385) 						dj->lfn_idx = dj->index;
(1386) 					}
(1387) 					/* Check validity of the LFN entry and compare it with given name */
(1388) 					ord = (c == ord && sum == dir[LDIR_Chksum] && cmp_lfn(dj->lfn, dir)) ? ord - 1 : 0xFF;
(1389) 				}
(1390) 			} else {					/* An SFN entry is found */
(1391) 				if (!ord && sum == sum_sfn(dir)) break;	/* LFN matched? */
(1392) 				ord = 0xFF; dj->lfn_idx = 0xFFFF;	/* Reset LFN sequence */
(1393) 				if (!(dj->fn[NS] & NS_LOSS) && !mem_cmp(dir, dj->fn, 11)) break;	/* SFN matched? */
(1394) 			}
(1395) 		}
(1396) #else		/* Non LFN configuration */
(1397) 		if (!(dir[DIR_Attr] & AM_VOL) && !mem_cmp(dir, dj->fn, 11)) /* Is it a valid entry? */
    01706 01F5      MOVW	R30,R10
    01707 8423      LDD	R2,Z+11
    01708 FC23      SBRC	R2,3
    01709 C00F      RJMP	0x1719
    0170A E08B      LDI	R24,0xB
    0170B E090      LDI	R25,0
    0170C 8399      STD	Y+1,R25
    0170D 8388      ST	Y,R24
    0170E 01FB      MOVW	R30,R22
    0170F 8924      LDD	R18,Z+20
    01710 8935      LDD	R19,Z+21
    01711 0185      MOVW	R16,R10
    01712 940E 0C7C CALL	ff.c:mem_cmp
    01714 0158      MOVW	R10,R16
    01715 3000      CPI	R16,0
    01716 0701      CPC	R16,R17
    01717 F409      BNE	0x1719
(1398) 			break;
    01718 C009      RJMP	0x1722
(1399) #endif
(1400) 		res = dir_next(dj, 0);		/* Next entry */
    01719 2722      CLR	R18
    0171A 2733      CLR	R19
    0171B 018B      MOVW	R16,R22
    0171C DE16      RCALL	ff.c:dir_next
    0171D 2EA0      MOV	R10,R16
    0171E 2D4A      MOV	R20,R10
(1401) 	} while (res == FR_OK);
    0171F 2344      TST	R20
    01720 F409      BNE	0x1722
    01721 CFCB      RJMP	0x16ED
(1402) 
(1403) 	return res;
    01722 2F04      MOV	R16,R20
    01723 9622      ADIW	R28,2
    01724 940C 4BEF JMP	pop_xgsetF03C
ff.c:dir_read:
  dir                  --> R10
  c                    --> R12
  res                  --> R20
  dj                   --> R22
    01726 940E 4BE6 CALL	push_xgsetF03C
    01728 01B8      MOVW	R22,R16
    01729 9722      SBIW	R28,2
(1404) }
(1405) 
(1406) 
(1407) 
(1408) 
(1409) /*-----------------------------------------------------------------------*/
(1410) /* Read an object from the directory                                     */
(1411) /*-----------------------------------------------------------------------*/
(1412) #if _FS_MINIMIZE <= 1
(1413) static
(1414) FRESULT dir_read (
(1415) 	DIR *dj			/* Pointer to the directory object that pointing the entry to be read */
(1416) )
(1417) {
(1418) 	FRESULT res;
(1419) 	BYTE c, *dir;
(1420) #if _USE_LFN
(1421) 	BYTE a, ord = 0xFF, sum = 0xFF;
(1422) #endif
(1423) 
(1424) 	res = FR_NO_FILE;
    0172A E044      LDI	R20,4
    0172B C02B      RJMP	0x1757
(1425) 	while (dj->sect) {
(1426) 		res = move_window(dj->fs, dj->sect);
    0172C 01FB      MOVW	R30,R22
    0172D 8426      LDD	R2,Z+14
    0172E 8437      LDD	R3,Z+15
    0172F 8840      LDD	R4,Z+16
    01730 8851      LDD	R5,Z+17
    01731 8248      ST	Y,R4
    01732 8259      STD	Y+1,R5
    01733 0191      MOVW	R18,R2
    01734 8100      LD	R16,Z
    01735 8111      LDD	R17,Z+1
    01736 940E 0CAD CALL	ff.c:move_window
    01738 2F40      MOV	R20,R16
(1427) 		if (res != FR_OK) break;
    01739 2300      TST	R16
    0173A F009      BEQ	0x173C
    0173B C028      RJMP	0x1764
(1428) 		dir = dj->dir;					/* Ptr to the directory entry of current index */
    0173C 01FB      MOVW	R30,R22
    0173D 88A2      LDD	R10,Z+18
    0173E 88B3      LDD	R11,Z+19
(1429) 		c = dir[DIR_Name];
    0173F 01F5      MOVW	R30,R10
    01740 80C0      LD	R12,Z
(1430) 		if (c == 0) { res = FR_NO_FILE; break; }	/* Reached to end of table */
    01741 20CC      TST	R12
    01742 F411      BNE	0x1745
    01743 E044      LDI	R20,4
    01744 C01F      RJMP	0x1764
(1431) #if _USE_LFN	/* LFN configuration */
(1432) 		a = dir[DIR_Attr] & AM_MASK;
(1433) 		if (c == DDE || (!_FS_RPATH && c == '.') || ((a & AM_VOL) && a != AM_LFN)) {	/* An entry without valid data */
(1434) 			ord = 0xFF;
(1435) 		} else {
(1436) 			if (a == AM_LFN) {			/* An LFN entry is found */
(1437) 				if (c & LLE) {			/* Is it start of LFN sequence? */
(1438) 					sum = dir[LDIR_Chksum];
(1439) 					c &= ~LLE; ord = c;
(1440) 					dj->lfn_idx = dj->index;
(1441) 				}
(1442) 				/* Check LFN validity and capture it */
(1443) 				ord = (c == ord && sum == dir[LDIR_Chksum] && pick_lfn(dj->lfn, dir)) ? ord - 1 : 0xFF;
(1444) 			} else {					/* An SFN entry is found */
(1445) 				if (ord || sum != sum_sfn(dir))	/* Is there a valid LFN? */
(1446) 					dj->lfn_idx = 0xFFFF;		/* It has no LFN. */
(1447) 				break;
(1448) 			}
(1449) 		}
(1450) #else		/* Non LFN configuration */
(1451) 		if (c != DDE && (_FS_RPATH || c != '.') && !(dir[DIR_Attr] & AM_VOL))	/* Is it a valid entry? */
    01745 2D8C      MOV	R24,R12
    01746 3E85      CPI	R24,0xE5
    01747 F039      BEQ	0x174F
    01748 328E      CPI	R24,0x2E
    01749 F029      BEQ	0x174F
    0174A 01F5      MOVW	R30,R10
    0174B 8423      LDD	R2,Z+11
    0174C FC23      SBRC	R2,3
    0174D C001      RJMP	0x174F
(1452) 			break;
    0174E C015      RJMP	0x1764
(1453) #endif
(1454) 		res = dir_next(dj, 0);				/* Next entry */
    0174F 2722      CLR	R18
    01750 2733      CLR	R19
    01751 018B      MOVW	R16,R22
    01752 DDE0      RCALL	ff.c:dir_next
    01753 2F40      MOV	R20,R16
(1455) 		if (res != FR_OK) break;
    01754 2300      TST	R16
    01755 F009      BEQ	0x1757
    01756 C00D      RJMP	0x1764
    01757 01FB      MOVW	R30,R22
    01758 963E      ADIW	R30,0xE
    01759 8020      LD	R2,Z
    0175A 8031      LDD	R3,Z+1
    0175B 8042      LDD	R4,Z+2
    0175C 8053      LDD	R5,Z+3
    0175D 9488      BCLR	0
    0175E 2022      TST	R2
    0175F 0432      CPC	R3,R2
    01760 0442      CPC	R4,R2
    01761 0452      CPC	R5,R2
    01762 F009      BEQ	0x1764
    01763 CFC8      RJMP	0x172C
(1456) 	}
(1457) 
(1458) 	if (res != FR_OK) dj->sect = 0;
    01764 2344      TST	R20
    01765 F039      BEQ	0x176D
    01766 01FB      MOVW	R30,R22
    01767 963E      ADIW	R30,0xE
    01768 E080      LDI	R24,0
    01769 8380      ST	Z,R24
    0176A 8381      STD	Z+1,R24
    0176B 8382      STD	Z+2,R24
    0176C 8383      STD	Z+3,R24
(1459) 
(1460) 	return res;
    0176D 2F04      MOV	R16,R20
    0176E 9622      ADIW	R28,2
    0176F 940C 4BEF JMP	pop_xgsetF03C
ff.c:dir_register:
  dir                  --> R12
  c                    --> R22
  res                  --> R10
  dj                   --> R20
    01771 940E 4BE6 CALL	push_xgsetF03C
    01773 01A8      MOVW	R20,R16
    01774 9722      SBIW	R28,2
(1461) }
(1462) #endif
(1463) 
(1464) 
(1465) 
(1466) /*-----------------------------------------------------------------------*/
(1467) /* Register an object to the directory                                   */
(1468) /*-----------------------------------------------------------------------*/
(1469) #if !_FS_READONLY
(1470) static
(1471) FRESULT dir_register (	/* FR_OK:Successful, FR_DENIED:No free entry or too many SFN collision, FR_DISK_ERR:Disk error */
(1472) 	DIR *dj				/* Target directory with object name to be created */
(1473) )
(1474) {
(1475) 	FRESULT res;
(1476) 	BYTE c, *dir;
(1477) #if _USE_LFN	/* LFN configuration */
(1478) 	WORD n, ne, is;
(1479) 	BYTE sn[12], *fn, sum;
(1480) 	WCHAR *lfn;
(1481) 
(1482) 
(1483) 	fn = dj->fn; lfn = dj->lfn;
(1484) 	mem_cpy(sn, fn, 12);
(1485) 
(1486) 	if (_FS_RPATH && (sn[NS] & NS_DOT))		/* Cannot create dot entry */
(1487) 		return FR_INVALID_NAME;
(1488) 
(1489) 	if (sn[NS] & NS_LOSS) {			/* When LFN is out of 8.3 format, generate a numbered name */
(1490) 		fn[NS] = 0; dj->lfn = 0;			/* Find only SFN */
(1491) 		for (n = 1; n < 100; n++) {
(1492) 			gen_numname(fn, sn, lfn, n);	/* Generate a numbered name */
(1493) 			res = dir_find(dj);				/* Check if the name collides with existing SFN */
(1494) 			if (res != FR_OK) break;
(1495) 		}
(1496) 		if (n == 100) return FR_DENIED;		/* Abort if too many collisions */
(1497) 		if (res != FR_NO_FILE) return res;	/* Abort if the result is other than 'not collided' */
(1498) 		fn[NS] = sn[NS]; dj->lfn = lfn;
(1499) 	}
(1500) 
(1501) 	if (sn[NS] & NS_LFN) {			/* When LFN is to be created, reserve an SFN + LFN entries. */
(1502) 		for (ne = 0; lfn[ne]; ne++) ;
(1503) 		ne = (ne + 25) / 13;
(1504) 	} else {						/* Otherwise reserve only an SFN entry. */
(1505) 		ne = 1;
(1506) 	}
(1507) 
(1508) 	/* Reserve contiguous entries */
(1509) 	res = dir_sdi(dj, 0);
(1510) 	if (res != FR_OK) return res;
(1511) 	n = is = 0;
(1512) 	do {
(1513) 		res = move_window(dj->fs, dj->sect);
(1514) 		if (res != FR_OK) break;
(1515) 		c = *dj->dir;				/* Check the entry status */
(1516) 		if (c == DDE || c == 0) {	/* Is it a blank entry? */
(1517) 			if (n == 0) is = dj->index;	/* First index of the contiguous entry */
(1518) 			if (++n == ne) break;	/* A contiguous entry that required count is found */
(1519) 		} else {
(1520) 			n = 0;					/* Not a blank entry. Restart to search */
(1521) 		}
(1522) 		res = dir_next(dj, 1);		/* Next entry with table stretch */
(1523) 	} while (res == FR_OK);
(1524) 
(1525) 	if (res == FR_OK && ne > 1) {	/* Initialize LFN entry if needed */
(1526) 		res = dir_sdi(dj, is);
(1527) 		if (res == FR_OK) {
(1528) 			sum = sum_sfn(dj->fn);	/* Sum of the SFN tied to the LFN */
(1529) 			ne--;
(1530) 			do {					/* Store LFN entries in bottom first */
(1531) 				res = move_window(dj->fs, dj->sect);
(1532) 				if (res != FR_OK) break;
(1533) 				fit_lfn(dj->lfn, dj->dir, (BYTE)ne, sum);
(1534) 				dj->fs->wflag = 1;
(1535) 				res = dir_next(dj, 0);	/* Next entry */
(1536) 			} while (res == FR_OK && --ne);
(1537) 		}
(1538) 	}
(1539) 
(1540) #else	/* Non LFN configuration */
(1541) 	res = dir_sdi(dj, 0);
    01775 2722      CLR	R18
    01776 2733      CLR	R19
    01777 018A      MOVW	R16,R20
    01778 DCB0      RCALL	ff.c:dir_sdi
    01779 2EA0      MOV	R10,R16
(1542) 	if (res == FR_OK) {
    0177A 2300      TST	R16
    0177B F509      BNE	0x179D
(1543) 		do {	/* Find a blank entry for the SFN */
(1544) 			res = move_window(dj->fs, dj->sect);
    0177C 01FA      MOVW	R30,R20
    0177D 8426      LDD	R2,Z+14
    0177E 8437      LDD	R3,Z+15
    0177F 8840      LDD	R4,Z+16
    01780 8851      LDD	R5,Z+17
    01781 8248      ST	Y,R4
    01782 8259      STD	Y+1,R5
    01783 0191      MOVW	R18,R2
    01784 8100      LD	R16,Z
    01785 8111      LDD	R17,Z+1
    01786 940E 0CAD CALL	ff.c:move_window
    01788 2EA0      MOV	R10,R16
(1545) 			if (res != FR_OK) break;
    01789 2300      TST	R16
    0178A F009      BEQ	0x178C
    0178B C011      RJMP	0x179D
(1546) 			c = *dj->dir;
    0178C 01FA      MOVW	R30,R20
    0178D 89A2      LDD	R26,Z+18
    0178E 89B3      LDD	R27,Z+19
    0178F 916C      LD	R22,X
(1547) 			if (c == DDE || c == 0) break;	/* Is it a blank entry? */
    01790 3E65      CPI	R22,0xE5
    01791 F011      BEQ	0x1794
    01792 2366      TST	R22
    01793 F409      BNE	0x1795
    01794 C008      RJMP	0x179D
(1548) 			res = dir_next(dj, 1);			/* Next entry with table stretch */
    01795 E021      LDI	R18,1
    01796 E030      LDI	R19,0
    01797 018A      MOVW	R16,R20
    01798 DD9A      RCALL	ff.c:dir_next
    01799 2EC0      MOV	R12,R16
    0179A 2CAC      MOV	R10,R12
(1549) 		} while (res == FR_OK);
    0179B 20AA      TST	R10
    0179C F2F9      BEQ	0x177C
(1550) 	}
(1551) #endif
(1552) 
(1553) 	if (res == FR_OK) {		/* Initialize the SFN entry */
    0179D 20AA      TST	R10
    0179E F009      BEQ	0x17A0
    0179F C030      RJMP	0x17D0
(1554) 		res = move_window(dj->fs, dj->sect);
    017A0 01FA      MOVW	R30,R20
    017A1 8426      LDD	R2,Z+14
    017A2 8437      LDD	R3,Z+15
    017A3 8840      LDD	R4,Z+16
    017A4 8851      LDD	R5,Z+17
    017A5 8248      ST	Y,R4
    017A6 8259      STD	Y+1,R5
    017A7 0191      MOVW	R18,R2
    017A8 8100      LD	R16,Z
    017A9 8111      LDD	R17,Z+1
    017AA 940E 0CAD CALL	ff.c:move_window
    017AC 2EC0      MOV	R12,R16
    017AD 2CAC      MOV	R10,R12
(1555) 		if (res == FR_OK) {
    017AE 2300      TST	R16
    017AF F501      BNE	0x17D0
(1556) 			dir = dj->dir;
    017B0 01FA      MOVW	R30,R20
    017B1 88C2      LDD	R12,Z+18
    017B2 88D3      LDD	R13,Z+19
(1557) 			mem_set(dir, 0, SZ_DIR);	/* Clean the entry */
    017B3 E280      LDI	R24,0x20
    017B4 E090      LDI	R25,0
    017B5 8399      STD	Y+1,R25
    017B6 8388      ST	Y,R24
    017B7 2722      CLR	R18
    017B8 2733      CLR	R19
    017B9 0186      MOVW	R16,R12
    017BA 940E 0C6A CALL	ff.c:mem_set
(1558) 			mem_cpy(dir, dj->fn, 11);	/* Put SFN */
    017BC E08B      LDI	R24,0xB
    017BD E090      LDI	R25,0
    017BE 8399      STD	Y+1,R25
    017BF 8388      ST	Y,R24
    017C0 01FA      MOVW	R30,R20
    017C1 8924      LDD	R18,Z+20
    017C2 8935      LDD	R19,Z+21
    017C3 0186      MOVW	R16,R12
    017C4 940E 0C54 CALL	ff.c:mem_cpy
(1559) #if _USE_LFN
(1560) 			dir[DIR_NTres] = *(dj->fn+NS) & (NS_BODY | NS_EXT);	/* Put NT flag */
(1561) #endif
(1562) 			dj->fs->wflag = 1;
    017C6 E081      LDI	R24,1
    017C7 01FA      MOVW	R30,R20
    017C8 93AF      PUSH	R26
    017C9 93BF      PUSH	R27
    017CA 81A0      LD	R26,Z
    017CB 81B1      LDD	R27,Z+1
    017CC 01FD      MOVW	R30,R26
    017CD 91BF      POP	R27
    017CE 91AF      POP	R26
    017CF 8384      STD	Z+4,R24
(1563) 		}
(1564) 	}
(1565) 
(1566) 	return res;
    017D0 2D0A      MOV	R16,R10
    017D1 9622      ADIW	R28,2
    017D2 940C 4BEF JMP	pop_xgsetF03C
ff.c:create_name:
  si                   --> R22
  b                    --> Y,+8
  sfn                  --> Y,+6
  ni                   --> R12
  d                    --> R10
  i                    --> Y,+4
  p                    --> Y,+2
  c                    --> R20
  path                 --> Y,+19
  dj                   --> R20
    017D4 933A      ST	-Y,R19
    017D5 932A      ST	-Y,R18
    017D6 940E 4BAB CALL	push_xgsetF0FC
    017D8 01A8      MOVW	R20,R16
    017D9 9729      SBIW	R28,0x9
(1567) }
(1568) #endif /* !_FS_READONLY */
(1569) 
(1570) 
(1571) 
(1572) 
(1573) /*-----------------------------------------------------------------------*/
(1574) /* Remove an object from the directory                                   */
(1575) /*-----------------------------------------------------------------------*/
(1576) #if !_FS_READONLY && !_FS_MINIMIZE
(1577) static
(1578) FRESULT dir_remove (	/* FR_OK: Successful, FR_DISK_ERR: A disk error */
(1579) 	DIR *dj				/* Directory object pointing the entry to be removed */
(1580) )
(1581) {
(1582) 	FRESULT res;
(1583) #if _USE_LFN	/* LFN configuration */
(1584) 	WORD i;
(1585) 
(1586) 	i = dj->index;	/* SFN index */
(1587) 	res = dir_sdi(dj, (WORD)((dj->lfn_idx == 0xFFFF) ? i : dj->lfn_idx));	/* Goto the SFN or top of the LFN entries */
(1588) 	if (res == FR_OK) {
(1589) 		do {
(1590) 			res = move_window(dj->fs, dj->sect);
(1591) 			if (res != FR_OK) break;
(1592) 			*dj->dir = DDE;			/* Mark the entry "deleted" */
(1593) 			dj->fs->wflag = 1;
(1594) 			if (dj->index >= i) break;	/* When reached SFN, all entries of the object has been deleted. */
(1595) 			res = dir_next(dj, 0);		/* Next entry */
(1596) 		} while (res == FR_OK);
(1597) 		if (res == FR_NO_FILE) res = FR_INT_ERR;
(1598) 	}
(1599) 
(1600) #else			/* Non LFN configuration */
(1601) 	res = dir_sdi(dj, dj->index);
(1602) 	if (res == FR_OK) {
(1603) 		res = move_window(dj->fs, dj->sect);
(1604) 		if (res == FR_OK) {
(1605) 			*dj->dir = DDE;			/* Mark the entry "deleted" */
(1606) 			dj->fs->wflag = 1;
(1607) 		}
(1608) 	}
(1609) #endif
(1610) 
(1611) 	return res;
(1612) }
(1613) #endif /* !_FS_READONLY */
(1614) 
(1615) 
(1616) 
(1617) 
(1618) /*-----------------------------------------------------------------------*/
(1619) /* Pick a segment and create the object name in directory form           */
(1620) /*-----------------------------------------------------------------------*/
(1621) 
(1622) static
(1623) FRESULT create_name (
(1624) 	DIR *dj,			/* Pointer to the directory object */
(1625) 	const TCHAR **path	/* Pointer to pointer to the segment in the path string */
(1626) )
(1627) {
(1628) #ifdef _EXCVT
(1629) 	static const BYTE excvt[] = _EXCVT;	/* Upper conversion table for extended chars */
(1630) #endif
(1631) 
(1632) #if _USE_LFN	/* LFN configuration */
(1633) 	BYTE b, cf;
(1634) 	WCHAR w, *lfn;
(1635) 	UINT i, ni, si, di;
(1636) 	const TCHAR *p;
(1637) 
(1638) 	/* Create LFN in Unicode */
(1639) 	for (p = *path; *p == '/' || *p == '\\'; p++) ;	/* Strip duplicated separator */
(1640) 	lfn = dj->lfn;
(1641) 	si = di = 0;
(1642) 	for (;;) {
(1643) 		w = p[si++];					/* Get a character */
(1644) 		if (w < ' ' || w == '/' || w == '\\') break;	/* Break on end of segment */
(1645) 		if (di >= _MAX_LFN)				/* Reject too long name */
(1646) 			return FR_INVALID_NAME;
(1647) #if !_LFN_UNICODE
(1648) 		w &= 0xFF;
(1649) 		if (IsDBCS1(w)) {				/* Check if it is a DBC 1st byte (always false on SBCS cfg) */
(1650) 			b = (BYTE)p[si++];			/* Get 2nd byte */
(1651) 			if (!IsDBCS2(b))
(1652) 				return FR_INVALID_NAME;	/* Reject invalid sequence */
(1653) 			w = (w << 8) + b;			/* Create a DBC */
(1654) 		}
(1655) 		w = ff_convert(w, 1);			/* Convert ANSI/OEM to Unicode */
(1656) 		if (!w) return FR_INVALID_NAME;	/* Reject invalid code */
(1657) #endif
(1658) 		if (w < 0x80 && chk_chr("\"*:<>\?|\x7F", w)) /* Reject illegal chars for LFN */
(1659) 			return FR_INVALID_NAME;
(1660) 		lfn[di++] = w;					/* Store the Unicode char */
(1661) 	}
(1662) 	*path = &p[si];						/* Return pointer to the next segment */
(1663) 	cf = (w < ' ') ? NS_LAST : 0;		/* Set last segment flag if end of path */
(1664) #if _FS_RPATH
(1665) 	if ((di == 1 && lfn[di-1] == '.') || /* Is this a dot entry? */
(1666) 		(di == 2 && lfn[di-1] == '.' && lfn[di-2] == '.')) {
(1667) 		lfn[di] = 0;
(1668) 		for (i = 0; i < 11; i++)
(1669) 			dj->fn[i] = (i < di) ? '.' : ' ';
(1670) 		dj->fn[i] = cf | NS_DOT;		/* This is a dot entry */
(1671) 		return FR_OK;
(1672) 	}
(1673) #endif
(1674) 	while (di) {						/* Strip trailing spaces and dots */
(1675) 		w = lfn[di-1];
(1676) 		if (w != ' ' && w != '.') break;
(1677) 		di--;
(1678) 	}
(1679) 	if (!di) return FR_INVALID_NAME;	/* Reject nul string */
(1680) 
(1681) 	lfn[di] = 0;						/* LFN is created */
(1682) 
(1683) 	/* Create SFN in directory form */
(1684) 	mem_set(dj->fn, ' ', 11);
(1685) 	for (si = 0; lfn[si] == ' ' || lfn[si] == '.'; si++) ;	/* Strip leading spaces and dots */
(1686) 	if (si) cf |= NS_LOSS | NS_LFN;
(1687) 	while (di && lfn[di - 1] != '.') di--;	/* Find extension (di<=si: no extension) */
(1688) 
(1689) 	b = i = 0; ni = 8;
(1690) 	for (;;) {
(1691) 		w = lfn[si++];					/* Get an LFN char */
(1692) 		if (!w) break;					/* Break on end of the LFN */
(1693) 		if (w == ' ' || (w == '.' && si != di)) {	/* Remove spaces and dots */
(1694) 			cf |= NS_LOSS | NS_LFN; continue;
(1695) 		}
(1696) 
(1697) 		if (i >= ni || si == di) {		/* Extension or end of SFN */
(1698) 			if (ni == 11) {				/* Long extension */
(1699) 				cf |= NS_LOSS | NS_LFN; break;
(1700) 			}
(1701) 			if (si != di) cf |= NS_LOSS | NS_LFN;	/* Out of 8.3 format */
(1702) 			if (si > di) break;			/* No extension */
(1703) 			si = di; i = 8; ni = 11;	/* Enter extension section */
(1704) 			b <<= 2; continue;
(1705) 		}
(1706) 
(1707) 		if (w >= 0x80) {				/* Non ASCII char */
(1708) #ifdef _EXCVT
(1709) 			w = ff_convert(w, 0);		/* Unicode -> OEM code */
(1710) 			if (w) w = excvt[w - 0x80];	/* Convert extended char to upper (SBCS) */
(1711) #else
(1712) 			w = ff_convert(ff_wtoupper(w), 0);	/* Upper converted Unicode -> OEM code */
(1713) #endif
(1714) 			cf |= NS_LFN;				/* Force create LFN entry */
(1715) 		}
(1716) 
(1717) 		if (_DF1S && w >= 0x100) {		/* Double byte char (always false on SBCS cfg) */
(1718) 			if (i >= ni - 1) {
(1719) 				cf |= NS_LOSS | NS_LFN; i = ni; continue;
(1720) 			}
(1721) 			dj->fn[i++] = (BYTE)(w >> 8);
(1722) 		} else {						/* Single byte char */
(1723) 			if (!w || chk_chr("+,;=[]", w)) {	/* Replace illegal chars for SFN */
(1724) 				w = '_'; cf |= NS_LOSS | NS_LFN;/* Lossy conversion */
(1725) 			} else {
(1726) 				if (IsUpper(w)) {		/* ASCII large capital */
(1727) 					b |= 2;
(1728) 				} else {
(1729) 					if (IsLower(w)) {	/* ASCII small capital */
(1730) 						b |= 1; w -= 0x20;
(1731) 					}
(1732) 				}
(1733) 			}
(1734) 		}
(1735) 		dj->fn[i++] = (BYTE)w;
(1736) 	}
(1737) 
(1738) 	if (dj->fn[0] == DDE) dj->fn[0] = NDDE;	/* If the first char collides with deleted mark, replace it with 0x05 */
(1739) 
(1740) 	if (ni == 8) b <<= 2;
(1741) 	if ((b & 0x0C) == 0x0C || (b & 0x03) == 0x03)	/* Create LFN entry when there are composite capitals */
(1742) 		cf |= NS_LFN;
(1743) 	if (!(cf & NS_LFN)) {						/* When LFN is in 8.3 format without extended char, NT flags are created */
(1744) 		if ((b & 0x03) == 0x01) cf |= NS_EXT;	/* NT flag (Extension has only small capital) */
(1745) 		if ((b & 0x0C) == 0x04) cf |= NS_BODY;	/* NT flag (Filename has only small capital) */
(1746) 	}
(1747) 
(1748) 	dj->fn[NS] = cf;	/* SFN is created */
(1749) 
(1750) 	return FR_OK;
(1751) 
(1752) 
(1753) #else	/* Non-LFN configuration */
(1754) 	BYTE b, c, d, *sfn;
(1755) 	UINT ni, si, i;
(1756) 	const char *p;
(1757) 
(1758) 	/* Create file name in directory form */
(1759) 	for (p = *path; *p == '/' || *p == '\\'; p++) ;	/* Strip duplicated separator */
    017DA 89EB      LDD	R30,Y+19
    017DB 89FC      LDD	R31,Y+20
    017DC 8020      LD	R2,Z
    017DD 8031      LDD	R3,Z+1
    017DE 823B      STD	Y+3,R3
    017DF 822A      STD	Y+2,R2
    017E0 C005      RJMP	0x17E6
    017E1 818A      LDD	R24,Y+2
    017E2 819B      LDD	R25,Y+3
    017E3 9601      ADIW	R24,1
    017E4 839B      STD	Y+3,R25
    017E5 838A      STD	Y+2,R24
    017E6 81EA      LDD	R30,Y+2
    017E7 81FB      LDD	R31,Y+3
    017E8 8020      LD	R2,Z
    017E9 2433      CLR	R3
    017EA 2D82      MOV	R24,R2
    017EB 328F      CPI	R24,0x2F
    017EC F3A1      BEQ	0x17E1
    017ED 358C      CPI	R24,0x5C
    017EE F391      BEQ	0x17E1
(1760) 	sfn = dj->fn;
    017EF 01FA      MOVW	R30,R20
    017F0 8824      LDD	R2,Z+20
    017F1 8835      LDD	R3,Z+21
    017F2 823F      STD	Y+7,R3
    017F3 822E      STD	Y+6,R2
(1761) 	mem_set(sfn, ' ', 11);
    017F4 E08B      LDI	R24,0xB
    017F5 E090      LDI	R25,0
    017F6 8399      STD	Y+1,R25
    017F7 8388      ST	Y,R24
    017F8 E220      LDI	R18,0x20
    017F9 E030      LDI	R19,0
    017FA 0181      MOVW	R16,R2
    017FB 940E 0C6A CALL	ff.c:mem_set
(1762) 	si = i = b = 0; ni = 8;
    017FD 2400      CLR	R0
    017FE 8608      STD	Y+8,R0
    017FF 2422      CLR	R2
    01800 2433      CLR	R3
    01801 823D      STD	Y+5,R3
    01802 822C      STD	Y+4,R2
    01803 01B1      MOVW	R22,R2
    01804 E088      LDI	R24,0x8
    01805 E090      LDI	R25,0
    01806 016C      MOVW	R12,R24
(1763) #if _FS_RPATH
(1764) 	if (p[si] == '.') { /* Is this a dot entry? */
(1765) 		for (;;) {
(1766) 			c = (BYTE)p[si++];
(1767) 			if (c != '.' || si >= 3) break;
(1768) 			sfn[i++] = c;
(1769) 		}
(1770) 		if (c != '/' && c != '\\' && c > ' ') return FR_INVALID_NAME;
(1771) 		*path = &p[si];									/* Return pointer to the next segment */
(1772) 		sfn[NS] = (c <= ' ') ? NS_LAST | NS_DOT : NS_DOT;	/* Set last segment flag if end of path */
(1773) 		return FR_OK;
(1774) 	}
(1775) #endif
(1776) 	for (;;) {
(1777) 		c = (BYTE)p[si++];
    01807 01AB      MOVW	R20,R22
    01808 5F6F      SUBI	R22,0xFF
    01809 4F7F      SBCI	R23,0xFF
    0180A 01FA      MOVW	R30,R20
    0180B 800A      LDD	R0,Y+2
    0180C 801B      LDD	R1,Y+3
    0180D 0DE0      ADD	R30,R0
    0180E 1DF1      ADC	R31,R1
    0180F 8140      LD	R20,Z
(1778) 		if (c <= ' ' || c == '/' || c == '\\') break;	/* Break on end of segment */
    01810 E280      LDI	R24,0x20
    01811 1784      CP	R24,R20
    01812 F420      BCC	0x1817
    01813 324F      CPI	R20,0x2F
    01814 F011      BEQ	0x1817
    01815 354C      CPI	R20,0x5C
    01816 F409      BNE	0x1818
    01817 C087      RJMP	0x189F
(1779) 		if (c == '.' || i >= ni) {
    01818 324E      CPI	R20,0x2E
    01819 F029      BEQ	0x181F
    0181A 800C      LDD	R0,Y+4
    0181B 801D      LDD	R1,Y+5
    0181C 140C      CP	R0,R12
    0181D 041D      CPC	R1,R13
    0181E F0A0      BCS	0x1833
(1780) 			if (ni != 8 || c != '.') return FR_INVALID_NAME;
    0181F 01C6      MOVW	R24,R12
    01820 3088      CPI	R24,0x8
    01821 E0E0      LDI	R30,0
    01822 079E      CPC	R25,R30
    01823 F411      BNE	0x1826
    01824 324E      CPI	R20,0x2E
    01825 F011      BEQ	0x1828
    01826 E006      LDI	R16,6
    01827 C0AF      RJMP	0x18D7
(1781) 			i = 8; ni = 11;
    01828 E088      LDI	R24,0x8
    01829 E090      LDI	R25,0
    0182A 839D      STD	Y+5,R25
    0182B 838C      STD	Y+4,R24
    0182C E08B      LDI	R24,0xB
    0182D 016C      MOVW	R12,R24
(1782) 			b <<= 2; continue;
    0182E 8408      LDD	R0,Y+8
    0182F 0C00      LSL	R0
    01830 0C00      LSL	R0
    01831 8608      STD	Y+8,R0
    01832 CFD4      RJMP	0x1807
(1783) 		}
(1784) 		if (c >= 0x80) {				/* Extended char? */
    01833 3840      CPI	R20,0x80
    01834 F018      BCS	0x1838
(1785) 			b |= 3;						/* Eliminate NT flag */
    01835 8588      LDD	R24,Y+8
    01836 6083      ORI	R24,3
    01837 8788      STD	Y+8,R24
(1786) #ifdef _EXCVT
(1787) 			c = excvt[c-0x80];			/* Upper conversion (SBCS) */
(1788) #else
(1789) #if !_DF1S	/* ASCII only cfg */
(1790) 			return FR_INVALID_NAME;
(1791) #endif
(1792) #endif
(1793) 		}
(1794) 		if (IsDBCS1(c)) {				/* Check if it is a DBC 1st byte (always false on SBCS cfg) */
    01838 3841      CPI	R20,0x81
    01839 F408      BCC	0x183B
    0183A C039      RJMP	0x1874
    0183B EF8E      LDI	R24,0xFE
    0183C 1784      CP	R24,R20
    0183D F408      BCC	0x183F
    0183E C035      RJMP	0x1874
(1795) 			d = (BYTE)p[si++];			/* Get 2nd byte */
    0183F 015B      MOVW	R10,R22
    01840 5F6F      SUBI	R22,0xFF
    01841 4F7F      SBCI	R23,0xFF
    01842 01F5      MOVW	R30,R10
    01843 800A      LDD	R0,Y+2
    01844 801B      LDD	R1,Y+3
    01845 0DE0      ADD	R30,R0
    01846 1DF1      ADC	R31,R1
    01847 80A0      LD	R10,Z
(1796) 			if (!IsDBCS2(d) || i >= ni - 1)	/* Reject invalid DBC */
    01848 2D8A      MOV	R24,R10
    01849 3480      CPI	R24,0x40
    0184A F018      BCS	0x184E
    0184B E78E      LDI	R24,0x7E
    0184C 158A      CP	R24,R10
    0184D F430      BCC	0x1854
    0184E 2D8A      MOV	R24,R10
    0184F 3880      CPI	R24,0x80
    01850 F050      BCS	0x185B
    01851 EF8E      LDI	R24,0xFE
    01852 158A      CP	R24,R10
    01853 F038      BCS	0x185B
    01854 01C6      MOVW	R24,R12
    01855 9701      SBIW	R24,1
    01856 800C      LDD	R0,Y+4
    01857 801D      LDD	R1,Y+5
    01858 1608      CP	R0,R24
    01859 0619      CPC	R1,R25
    0185A F010      BCS	0x185D
(1797) 				return FR_INVALID_NAME;
    0185B E006      LDI	R16,6
    0185C C07A      RJMP	0x18D7
(1798) 			sfn[i++] = c;
    0185D 80EC      LDD	R14,Y+4
    0185E 80FD      LDD	R15,Y+5
    0185F 01C7      MOVW	R24,R14
    01860 9601      ADIW	R24,1
    01861 839D      STD	Y+5,R25
    01862 838C      STD	Y+4,R24
    01863 01F7      MOVW	R30,R14
    01864 800E      LDD	R0,Y+6
    01865 801F      LDD	R1,Y+7
    01866 0DE0      ADD	R30,R0
    01867 1DF1      ADC	R31,R1
    01868 8340      ST	Z,R20
(1799) 			sfn[i++] = d;
    01869 017C      MOVW	R14,R24
    0186A 9601      ADIW	R24,1
    0186B 839D      STD	Y+5,R25
    0186C 838C      STD	Y+4,R24
    0186D 01F7      MOVW	R30,R14
    0186E 800E      LDD	R0,Y+6
    0186F 801F      LDD	R1,Y+7
    01870 0DE0      ADD	R30,R0
    01871 1DF1      ADC	R31,R1
    01872 82A0      ST	Z,R10
(1800) 		} else {						/* Single byte code */
    01873 CF93      RJMP	0x1807
(1801) 			if (chk_chr("\"*+,:;<=>\?[]|\x7F", c))	/* Reject illegal chrs for SFN */
    01874 2F24      MOV	R18,R20
    01875 2733      CLR	R19
    01876 E70B      LDI	R16,0x7B
    01877 E012      LDI	R17,2
    01878 940E 0C9D CALL	ff.c:chk_chr
    0187A 0158      MOVW	R10,R16
    0187B 3000      CPI	R16,0
    0187C 0701      CPC	R16,R17
    0187D F011      BEQ	0x1880
(1802) 				return FR_INVALID_NAME;
    0187E E006      LDI	R16,6
    0187F C057      RJMP	0x18D7
(1803) 			if (IsUpper(c)) {			/* ASCII large capital? */
    01880 3441      CPI	R20,0x41
    01881 F038      BCS	0x1889
    01882 E58A      LDI	R24,0x5A
    01883 1784      CP	R24,R20
    01884 F020      BCS	0x1889
(1804) 				b |= 2;
    01885 8588      LDD	R24,Y+8
    01886 6082      ORI	R24,2
    01887 8788      STD	Y+8,R24
(1805) 			} else {
    01888 C009      RJMP	0x1892
(1806) 				if (IsLower(c)) {		/* ASCII small capital? */
    01889 3641      CPI	R20,0x61
    0188A F038      BCS	0x1892
    0188B E78A      LDI	R24,0x7A
    0188C 1784      CP	R24,R20
    0188D F020      BCS	0x1892
(1807) 					b |= 1; c -= 0x20;
    0188E 8588      LDD	R24,Y+8
    0188F 6081      ORI	R24,1
    01890 8788      STD	Y+8,R24
    01891 5240      SUBI	R20,0x20
(1808) 				}
(1809) 			}
(1810) 			sfn[i++] = c;
    01892 80AC      LDD	R10,Y+4
    01893 80BD      LDD	R11,Y+5
    01894 01C5      MOVW	R24,R10
    01895 9601      ADIW	R24,1
    01896 839D      STD	Y+5,R25
    01897 838C      STD	Y+4,R24
    01898 01F5      MOVW	R30,R10
    01899 800E      LDD	R0,Y+6
    0189A 801F      LDD	R1,Y+7
    0189B 0DE0      ADD	R30,R0
    0189C 1DF1      ADC	R31,R1
    0189D 8340      ST	Z,R20
    0189E CF68      RJMP	0x1807
(1811) 		}
(1812) 	}
(1813) 	*path = &p[si];						/* Return pointer to the next segment */
    0189F 011B      MOVW	R2,R22
    018A0 800A      LDD	R0,Y+2
    018A1 801B      LDD	R1,Y+3
    018A2 0C20      ADD	R2,R0
    018A3 1C31      ADC	R3,R1
    018A4 89EB      LDD	R30,Y+19
    018A5 89FC      LDD	R31,Y+20
    018A6 8231      STD	Z+1,R3
    018A7 8220      ST	Z,R2
(1814) 	c = (c <= ' ') ? NS_LAST : 0;		/* Set last segment flag if end of path */
    018A8 E280      LDI	R24,0x20
    018A9 1784      CP	R24,R20
    018AA F018      BCS	0x18AE
    018AB E064      LDI	R22,4
    018AC E070      LDI	R23,0
    018AD C002      RJMP	0x18B0
    018AE 2766      CLR	R22
    018AF 2777      CLR	R23
    018B0 2F46      MOV	R20,R22
(1815) 
(1816) 	if (!i) return FR_INVALID_NAME;		/* Reject nul string */
    018B1 800C      LDD	R0,Y+4
    018B2 801D      LDD	R1,Y+5
    018B3 2000      TST	R0
    018B4 F421      BNE	0x18B9
    018B5 2011      TST	R1
    018B6 F411      BNE	0x18B9
    018B7 E006      LDI	R16,6
    018B8 C01E      RJMP	0x18D7
(1817) 	if (sfn[0] == DDE) sfn[0] = NDDE;	/* When first char collides with DDE, replace it with 0x05 */
    018B9 81EE      LDD	R30,Y+6
    018BA 81FF      LDD	R31,Y+7
    018BB 8180      LD	R24,Z
    018BC 3E85      CPI	R24,0xE5
    018BD F411      BNE	0x18C0
    018BE E085      LDI	R24,5
    018BF 8380      ST	Z,R24
(1818) 
(1819) 	if (ni == 8) b <<= 2;
    018C0 01C6      MOVW	R24,R12
    018C1 3088      CPI	R24,0x8
    018C2 E0E0      LDI	R30,0
    018C3 079E      CPC	R25,R30
    018C4 F421      BNE	0x18C9
    018C5 8408      LDD	R0,Y+8
    018C6 0C00      LSL	R0
    018C7 0C00      LSL	R0
    018C8 8608      STD	Y+8,R0
(1820) 	if ((b & 0x03) == 0x01) c |= NS_EXT;	/* NT flag (Name extension has only small capital) */
    018C9 8588      LDD	R24,Y+8
    018CA 7083      ANDI	R24,3
    018CB 3081      CPI	R24,1
    018CC F409      BNE	0x18CE
    018CD 6140      ORI	R20,0x10
(1821) 	if ((b & 0x0C) == 0x04) c |= NS_BODY;	/* NT flag (Name body has only small capital) */
    018CE 8588      LDD	R24,Y+8
    018CF 708C      ANDI	R24,0xC
    018D0 3084      CPI	R24,4
    018D1 F409      BNE	0x18D3
    018D2 6048      ORI	R20,0x8
(1822) 
(1823) 	sfn[NS] = c;		/* Store NT flag, File name is created */
    018D3 81EE      LDD	R30,Y+6
    018D4 81FF      LDD	R31,Y+7
    018D5 8743      STD	Z+11,R20
(1824) 
(1825) 	return FR_OK;
    018D6 2700      CLR	R16
    018D7 9629      ADIW	R28,0x9
    018D8 940E 4BA0 CALL	pop_xgsetF0FC
    018DA 9622      ADIW	R28,2
    018DB 9508      RET
ff.c:get_fileinfo:
  nt                   --> R12
  p                    --> R20
  dir                  --> R10
  i                    --> R12
  c                    --> R14
  fno                  --> R22
  dj                   --> R10
    018DC 940E 4BAB CALL	push_xgsetF0FC
    018DE 01B9      MOVW	R22,R18
    018DF 0158      MOVW	R10,R16
(1826) #endif
(1827) }
(1828) 
(1829) 
(1830) 
(1831) 
(1832) /*-----------------------------------------------------------------------*/
(1833) /* Get file information from directory entry                             */
(1834) /*-----------------------------------------------------------------------*/
(1835) #if _FS_MINIMIZE <= 1
(1836) static
(1837) void get_fileinfo (		/* No return code */
(1838) 	DIR *dj,			/* Pointer to the directory object */
(1839) 	FILINFO *fno	 	/* Pointer to the file information to be filled */
(1840) )
(1841) {
(1842) 	UINT i;
(1843) 	BYTE nt, *dir;
(1844) 	TCHAR *p, c;
(1845) 
(1846) 
(1847) 	p = fno->fname;
    018E0 01AB      MOVW	R20,R22
    018E1 5F47      SUBI	R20,0xF7
    018E2 4F5F      SBCI	R21,0xFF
(1848) 	if (dj->sect) {
    018E3 01F5      MOVW	R30,R10
    018E4 963E      ADIW	R30,0xE
    018E5 8020      LD	R2,Z
    018E6 8031      LDD	R3,Z+1
    018E7 8042      LDD	R4,Z+2
    018E8 8053      LDD	R5,Z+3
    018E9 9488      BCLR	0
    018EA 2022      TST	R2
    018EB 0432      CPC	R3,R2
    018EC 0442      CPC	R4,R2
    018ED 0452      CPC	R5,R2
    018EE F409      BNE	0x18F0
    018EF C08A      RJMP	0x197A
(1849) 		dir = dj->dir;
    018F0 01F5      MOVW	R30,R10
    018F1 88A2      LDD	R10,Z+18
    018F2 88B3      LDD	R11,Z+19
(1850) 		nt = dir[DIR_NTres];		/* NT flag */
(1851) 		for (i = 0; i < 8; i++) {	/* Copy name body */
    018F3 24CC      CLR	R12
    018F4 24DD      CLR	R13
    018F5 C014      RJMP	0x190A
(1852) 			c = dir[i];
    018F6 01F6      MOVW	R30,R12
    018F7 0DEA      ADD	R30,R10
    018F8 1DFB      ADC	R31,R11
    018F9 80E0      LD	R14,Z
(1853) 			if (c == ' ') break;
    018FA 2D8E      MOV	R24,R14
    018FB 3280      CPI	R24,0x20
    018FC F409      BNE	0x18FE
    018FD C011      RJMP	0x190F
(1854) 			if (c == NDDE) c = (TCHAR)DDE;
    018FE 2D8E      MOV	R24,R14
    018FF 3085      CPI	R24,5
    01900 F411      BNE	0x1903
    01901 EE85      LDI	R24,0xE5
    01902 2EE8      MOV	R14,R24
(1855) 			if (_USE_LFN && (nt & NS_BODY) && IsUpper(c)) c += 0x20;
    01903 C000      RJMP	0x1904
(1856) #if _LFN_UNICODE
(1857) 			if (IsDBCS1(c) && i < 7 && IsDBCS2(dir[i+1]))
(1858) 				c = (c << 8) | dir[++i];
(1859) 			c = ff_convert(c, 1);
(1860) 			if (!c) c = '?';
(1861) #endif
(1862) 			*p++ = c;
    01904 01FA      MOVW	R30,R20
    01905 92E1      ST	Z+,R14
    01906 01AF      MOVW	R20,R30
    01907 01C6      MOVW	R24,R12
    01908 9601      ADIW	R24,1
    01909 016C      MOVW	R12,R24
    0190A 01C6      MOVW	R24,R12
    0190B 3088      CPI	R24,0x8
    0190C E0E0      LDI	R30,0
    0190D 079E      CPC	R25,R30
    0190E F338      BCS	0x18F6
(1863) 		}
(1864) 		if (dir[8] != ' ') {		/* Copy name extension */
    0190F 01F5      MOVW	R30,R10
    01910 8580      LDD	R24,Z+8
    01911 3280      CPI	R24,0x20
    01912 F0E1      BEQ	0x192F
(1865) 			*p++ = '.';
    01913 E28E      LDI	R24,0x2E
    01914 01FA      MOVW	R30,R20
    01915 9381      ST	Z+,R24
    01916 01AF      MOVW	R20,R30
(1866) 			for (i = 8; i < 11; i++) {
    01917 E088      LDI	R24,0x8
    01918 E090      LDI	R25,0
    01919 016C      MOVW	R12,R24
    0191A C00F      RJMP	0x192A
(1867) 				c = dir[i];
    0191B 01F6      MOVW	R30,R12
    0191C 0DEA      ADD	R30,R10
    0191D 1DFB      ADC	R31,R11
    0191E 80E0      LD	R14,Z
(1868) 				if (c == ' ') break;
    0191F 2D8E      MOV	R24,R14
    01920 3280      CPI	R24,0x20
    01921 F409      BNE	0x1923
    01922 C00C      RJMP	0x192F
(1869) 				if (_USE_LFN && (nt & NS_EXT) && IsUpper(c)) c += 0x20;
    01923 C000      RJMP	0x1924
(1870) #if _LFN_UNICODE
(1871) 				if (IsDBCS1(c) && i < 10 && IsDBCS2(dir[i+1]))
(1872) 					c = (c << 8) | dir[++i];
(1873) 				c = ff_convert(c, 1);
(1874) 				if (!c) c = '?';
(1875) #endif
(1876) 				*p++ = c;
    01924 01FA      MOVW	R30,R20
    01925 92E1      ST	Z+,R14
    01926 01AF      MOVW	R20,R30
    01927 01C6      MOVW	R24,R12
    01928 9601      ADIW	R24,1
    01929 016C      MOVW	R12,R24
    0192A 01C6      MOVW	R24,R12
    0192B 308B      CPI	R24,0xB
    0192C E0E0      LDI	R30,0
    0192D 079E      CPC	R25,R30
    0192E F360      BCS	0x191B
(1877) 			}
(1878) 		}
(1879) 		fno->fattrib = dir[DIR_Attr];				/* Attribute */
    0192F 01F5      MOVW	R30,R10
    01930 8423      LDD	R2,Z+11
    01931 01FB      MOVW	R30,R22
    01932 8620      STD	Z+8,R2
(1880) 		fno->fsize = LD_DWORD(dir+DIR_FileSize);	/* Size */
    01933 E188      LDI	R24,0x18
    01934 E090      LDI	R25,0
    01935 01F5      MOVW	R30,R10
    01936 8D07      LDD	R16,Z+31
    01937 2711      CLR	R17
    01938 2722      CLR	R18
    01939 2733      CLR	R19
    0193A 938A      ST	-Y,R24
    0193B 940E 4C36 CALL	lsl32
    0193D 0118      MOVW	R2,R16
    0193E 0129      MOVW	R4,R18
    0193F 01F5      MOVW	R30,R10
    01940 8C66      LDD	R6,Z+30
    01941 2477      CLR	R7
    01942 2488      CLR	R8
    01943 2499      CLR	R9
    01944 0143      MOVW	R8,R6
    01945 2466      CLR	R6
    01946 2477      CLR	R7
    01947 2826      OR	R2,R6
    01948 2837      OR	R3,R7
    01949 2848      OR	R4,R8
    0194A 2859      OR	R5,R9
    0194B 8C65      LDD	R6,Z+29
    0194C 2477      CLR	R7
    0194D 2C76      MOV	R7,R6
    0194E 2466      CLR	R6
    0194F 2488      CLR	R8
    01950 2499      CLR	R9
    01951 2826      OR	R2,R6
    01952 2837      OR	R3,R7
    01953 2848      OR	R4,R8
    01954 2859      OR	R5,R9
    01955 8C64      LDD	R6,Z+28
    01956 2477      CLR	R7
    01957 2488      CLR	R8
    01958 2499      CLR	R9
    01959 2826      OR	R2,R6
    0195A 2837      OR	R3,R7
    0195B 2848      OR	R4,R8
    0195C 2859      OR	R5,R9
    0195D 01FB      MOVW	R30,R22
    0195E 8220      ST	Z,R2
    0195F 8231      STD	Z+1,R3
    01960 8242      STD	Z+2,R4
    01961 8253      STD	Z+3,R5
(1881) 		fno->fdate = LD_WORD(dir+DIR_WrtDate);		/* Date */
    01962 01F5      MOVW	R30,R10
    01963 8C20      LDD	R2,Z+24
    01964 2433      CLR	R3
    01965 8C41      LDD	R4,Z+25
    01966 2455      CLR	R5
    01967 2C54      MOV	R5,R4
    01968 2444      CLR	R4
    01969 2842      OR	R4,R2
    0196A 2853      OR	R5,R3
    0196B 01FB      MOVW	R30,R22
    0196C 8255      STD	Z+5,R5
    0196D 8244      STD	Z+4,R4
(1882) 		fno->ftime = LD_WORD(dir+DIR_WrtTime);		/* Time */
    0196E 01F5      MOVW	R30,R10
    0196F 8826      LDD	R2,Z+22
    01970 2433      CLR	R3
    01971 8847      LDD	R4,Z+23
    01972 2455      CLR	R5
    01973 2C54      MOV	R5,R4
    01974 2444      CLR	R4
    01975 2842      OR	R4,R2
    01976 2853      OR	R5,R3
    01977 01FB      MOVW	R30,R22
    01978 8257      STD	Z+7,R5
    01979 8246      STD	Z+6,R4
(1883) 	}
(1884) 	*p = 0;		/* Terminate SFN str by a \0 */
    0197A 2422      CLR	R2
    0197B 01FA      MOVW	R30,R20
    0197C 8220      ST	Z,R2
    0197D 940C 4BA0 JMP	pop_xgsetF0FC
ff.c:follow_path:
  ns                   --> R10
  res                  --> R20
  dir                  --> R10
  path                 --> Y,+6
  dj                   --> R22
    0197F 933A      ST	-Y,R19
    01980 932A      ST	-Y,R18
    01981 940E 4BCA CALL	push_xgsetF00C
    01983 01B8      MOVW	R22,R16
(1885) 
(1886) #if _USE_LFN
(1887) 	if (fno->lfname && fno->lfsize) {
(1888) 		TCHAR *tp = fno->lfname;
(1889) 		WCHAR w, *lfn;
(1890) 
(1891) 		i = 0;
(1892) 		if (dj->sect && dj->lfn_idx != 0xFFFF) {/* Get LFN if available */
(1893) 			lfn = dj->lfn;
(1894) 			while ((w = *lfn++) != 0) {			/* Get an LFN char */
(1895) #if !_LFN_UNICODE
(1896) 				w = ff_convert(w, 0);			/* Unicode -> OEM conversion */
(1897) 				if (!w) { i = 0; break; }		/* Could not convert, no LFN */
(1898) 				if (_DF1S && w >= 0x100)		/* Put 1st byte if it is a DBC (always false on SBCS cfg) */
(1899) 					tp[i++] = (TCHAR)(w >> 8);
(1900) #endif
(1901) 				if (i >= fno->lfsize - 1) { i = 0; break; }	/* Buffer overflow, no LFN */
(1902) 				tp[i++] = (TCHAR)w;
(1903) 			}
(1904) 		}
(1905) 		tp[i] = 0;	/* Terminate the LFN str by a \0 */
(1906) 	}
(1907) #endif
(1908) }
(1909) #endif /* _FS_MINIMIZE <= 1 */
(1910) 
(1911) 
(1912) 
(1913) 
(1914) /*-----------------------------------------------------------------------*/
(1915) /* Follow a file path                                                    */
(1916) /*-----------------------------------------------------------------------*/
(1917) 
(1918) static
(1919) FRESULT follow_path (	/* FR_OK(0): successful, !=0: error code */
(1920) 	DIR *dj,			/* Directory object to return last directory and found object */
(1921) 	const TCHAR *path	/* Full-path string to find a file or directory */
(1922) )
(1923) {
(1924) 	FRESULT res;
(1925) 	BYTE *dir, ns;
(1926) 
(1927) 
(1928) #if _FS_RPATH
(1929) 	if (*path == '/' || *path == '\\') { /* There is a heading separator */
(1930) 		path++;	dj->sclust = 0;		/* Strip it and start from the root dir */
(1931) 	} else {							/* No heading separator */
(1932) 		dj->sclust = dj->fs->cdir;	/* Start from the current dir */
(1933) 	}
(1934) #else
(1935) 	if (*path == '/' || *path == '\\')	/* Strip heading separator if exist */
    01984 81EE      LDD	R30,Y+6
    01985 81FF      LDD	R31,Y+7
    01986 8020      LD	R2,Z
    01987 2433      CLR	R3
    01988 2D82      MOV	R24,R2
    01989 328F      CPI	R24,0x2F
    0198A F011      BEQ	0x198D
    0198B 358C      CPI	R24,0x5C
    0198C F429      BNE	0x1992
(1936) 		path++;
    0198D 818E      LDD	R24,Y+6
    0198E 819F      LDD	R25,Y+7
    0198F 9601      ADIW	R24,1
    01990 839F      STD	Y+7,R25
    01991 838E      STD	Y+6,R24
(1937) 	dj->sclust = 0;						/* Start from the root dir */
    01992 01FB      MOVW	R30,R22
    01993 9636      ADIW	R30,6
    01994 E080      LDI	R24,0
    01995 8380      ST	Z,R24
    01996 8381      STD	Z+1,R24
    01997 8382      STD	Z+2,R24
    01998 8383      STD	Z+3,R24
(1938) #endif
(1939) 
(1940) 	if ((UINT)*path < ' ') {			/* Nul path means the start directory itself */
    01999 81EE      LDD	R30,Y+6
    0199A 81FF      LDD	R31,Y+7
    0199B 8180      LD	R24,Z
    0199C 2799      CLR	R25
    0199D 3280      CPI	R24,0x20
    0199E E0E0      LDI	R30,0
    0199F 079E      CPC	R25,R30
    019A0 F458      BCC	0x19AC
(1941) 		res = dir_sdi(dj, 0);
    019A1 2722      CLR	R18
    019A2 2733      CLR	R19
    019A3 018B      MOVW	R16,R22
    019A4 DA84      RCALL	ff.c:dir_sdi
    019A5 2F40      MOV	R20,R16
(1942) 		dj->dir = 0;
    019A6 2422      CLR	R2
    019A7 2433      CLR	R3
    019A8 01FB      MOVW	R30,R22
    019A9 8A33      STD	Z+19,R3
    019AA 8A22      STD	Z+18,R2
(1943) 
(1944) 	} else {							/* Follow path */
    019AB C052      RJMP	0x19FE
(1945) 		for (;;) {
(1946) 			res = create_name(dj, &path);	/* Get a segment */
    019AC 019E      MOVW	R18,R28
    019AD 5F2A      SUBI	R18,0xFA
    019AE 4F3F      SBCI	R19,0xFF
    019AF 018B      MOVW	R16,R22
    019B0 DE23      RCALL	ff.c:create_name
    019B1 2EA0      MOV	R10,R16
    019B2 2D4A      MOV	R20,R10
(1947) 			if (res != FR_OK) break;
    019B3 2300      TST	R16
    019B4 F009      BEQ	0x19B6
    019B5 C048      RJMP	0x19FE
(1948) 			res = dir_find(dj);				/* Find it */
    019B6 018B      MOVW	R16,R22
    019B7 DD29      RCALL	ff.c:dir_find
    019B8 2EA0      MOV	R10,R16
    019B9 2D4A      MOV	R20,R10
(1949) 			ns = *(dj->fn+NS);
    019BA 01FB      MOVW	R30,R22
    019BB 93AF      PUSH	R26
    019BC 93BF      PUSH	R27
    019BD 89A4      LDD	R26,Z+20
    019BE 89B5      LDD	R27,Z+21
    019BF 01FD      MOVW	R30,R26
    019C0 91BF      POP	R27
    019C1 91AF      POP	R26
    019C2 84A3      LDD	R10,Z+11
(1950) 			if (res != FR_OK) {				/* Failed to find the object */
    019C3 2300      TST	R16
    019C4 F049      BEQ	0x19CE
(1951) 				if (res != FR_NO_FILE) break;	/* Abort if any hard error occured */
    019C5 3004      CPI	R16,4
    019C6 F009      BEQ	0x19C8
    019C7 C036      RJMP	0x19FE
(1952) 				/* Object not found */
(1953) 				if (_FS_RPATH && (ns & NS_DOT)) {	/* If dot entry is not exit */
    019C8 C001      RJMP	0x19CA
(1954) 					dj->sclust = 0; dj->dir = 0;	/* It is the root dir */
(1955) 					res = FR_OK;
(1956) 					if (!(ns & NS_LAST)) continue;
    019C9 CFE2      RJMP	0x19AC
(1957) 				} else {							/* Could not find the object */
(1958) 					if (!(ns & NS_LAST)) res = FR_NO_PATH;
    019CA FCA2      SBRC	R10,2
    019CB C032      RJMP	0x19FE
    019CC E045      LDI	R20,5
(1959) 				}
(1960) 				break;
    019CD C030      RJMP	0x19FE
(1961) 			}
(1962) 			if (ns & NS_LAST) break;			/* Last segment match. Function completed. */
    019CE FEA2      SBRS	R10,2
    019CF C001      RJMP	0x19D1
    019D0 C02D      RJMP	0x19FE
(1963) 			dir = dj->dir;						/* There is next segment. Follow the sub directory */
    019D1 01FB      MOVW	R30,R22
    019D2 88A2      LDD	R10,Z+18
    019D3 88B3      LDD	R11,Z+19
(1964) 			if (!(dir[DIR_Attr] & AM_DIR)) {	/* Cannot follow because it is a file */
    019D4 01F5      MOVW	R30,R10
    019D5 8423      LDD	R2,Z+11
    019D6 FC24      SBRC	R2,4
    019D7 C002      RJMP	0x19DA
(1965) 				res = FR_NO_PATH; break;
    019D8 E045      LDI	R20,5
    019D9 C024      RJMP	0x19FE
(1966) 			}
(1967) 			dj->sclust = LD_CLUST(dir);
    019DA 01F5      MOVW	R30,R10
    019DB 8C22      LDD	R2,Z+26
    019DC 2433      CLR	R3
    019DD 8C43      LDD	R4,Z+27
    019DE 2455      CLR	R5
    019DF 2C54      MOV	R5,R4
    019E0 2444      CLR	R4
    019E1 2842      OR	R4,R2
    019E2 2853      OR	R5,R3
    019E3 0112      MOVW	R2,R4
    019E4 2444      CLR	R4
    019E5 2455      CLR	R5
    019E6 8864      LDD	R6,Z+20
    019E7 2477      CLR	R7
    019E8 8885      LDD	R8,Z+21
    019E9 2499      CLR	R9
    019EA 2C98      MOV	R9,R8
    019EB 2488      CLR	R8
    019EC 2886      OR	R8,R6
    019ED 2897      OR	R9,R7
    019EE 0134      MOVW	R6,R8
    019EF 2488      CLR	R8
    019F0 2499      CLR	R9
    019F1 0143      MOVW	R8,R6
    019F2 2466      CLR	R6
    019F3 2477      CLR	R7
    019F4 2862      OR	R6,R2
    019F5 2873      OR	R7,R3
    019F6 2884      OR	R8,R4
    019F7 2895      OR	R9,R5
    019F8 01FB      MOVW	R30,R22
    019F9 8266      STD	Z+6,R6
    019FA 8277      STD	Z+7,R7
    019FB 8680      STD	Z+8,R8
    019FC 8691      STD	Z+9,R9
    019FD CFAE      RJMP	0x19AC
(1968) 		}
(1969) 	}
(1970) 
(1971) 	return res;
    019FE 2F04      MOV	R16,R20
    019FF 940E 4BD1 CALL	pop_xgsetF00C
    01A01 9622      ADIW	R28,2
    01A02 9508      RET
ff.c:check_fs:
  sect                 --> Y,+11
  fs                   --> R10
    01A03 933A      ST	-Y,R19
    01A04 932A      ST	-Y,R18
    01A05 940E 4BCA CALL	push_xgsetF00C
    01A07 0158      MOVW	R10,R16
    01A08 9725      SBIW	R28,5
(1972) }
(1973) 
(1974) 
(1975) 
(1976) 
(1977) /*-----------------------------------------------------------------------*/
(1978) /* Load a sector and check if it is an FAT Volume Boot Record            */
(1979) /*-----------------------------------------------------------------------*/
(1980) 
(1981) static
(1982) BYTE check_fs (	/* 0:FAT-VBR, 1:Valid BR but not FAT, 2:Not a BR, 3:Disk error */
(1983) 	FATFS *fs,	/* File system object */
(1984) 	DWORD sect	/* Sector# (lba) to check if it is an FAT boot record or not */
(1985) )
(1986) {
(1987) 	if (disk_read(fs->drv, fs->win, sect, 1) != RES_OK)	/* Load boot record */
    01A09 E081      LDI	R24,1
    01A0A 838C      STD	Y+4,R24
    01A0B 842B      LDD	R2,Y+11
    01A0C 843C      LDD	R3,Y+12
    01A0D 844D      LDD	R4,Y+13
    01A0E 845E      LDD	R5,Y+14
    01A0F 8228      ST	Y,R2
    01A10 8239      STD	Y+1,R3
    01A11 824A      STD	Y+2,R4
    01A12 825B      STD	Y+3,R5
    01A13 0195      MOVW	R18,R10
    01A14 5D22      SUBI	R18,0xD2
    01A15 4F3F      SBCI	R19,0xFF
    01A16 01F5      MOVW	R30,R10
    01A17 8101      LDD	R16,Z+1
    01A18 940E 0C12 CALL	_disk_read
    01A1A 2300      TST	R16
    01A1B F011      BEQ	0x1A1E
(1988) 		return 3;
    01A1C E003      LDI	R16,3
    01A1D C0A8      RJMP	0x1AC6
(1989) 	if (LD_WORD(&fs->win[BS_55AA]) != 0xAA55)		/* Check record signature (always placed at offset 510 even if the sector size is >512) */
    01A1E 01F5      MOVW	R30,R10
    01A1F 5DE4      SUBI	R30,0xD4
    01A20 4FFD      SBCI	R31,0xFD
    01A21 8020      LD	R2,Z
    01A22 52EC      SUBI	R30,0x2C
    01A23 40F2      SBCI	R31,2
    01A24 2433      CLR	R3
    01A25 5DE3      SUBI	R30,0xD3
    01A26 4FFD      SBCI	R31,0xFD
    01A27 8180      LD	R24,Z
    01A28 2799      CLR	R25
    01A29 2F98      MOV	R25,R24
    01A2A 2788      CLR	R24
    01A2B 2982      OR	R24,R2
    01A2C 2993      OR	R25,R3
    01A2D 3585      CPI	R24,0x55
    01A2E EAEA      LDI	R30,0xAA
    01A2F 079E      CPC	R25,R30
    01A30 F011      BEQ	0x1A33
(1990) 		return 2;
    01A31 E002      LDI	R16,2
    01A32 C093      RJMP	0x1AC6
(1991) 
(1992) 	if ((LD_DWORD(&fs->win[BS_FilSysType]) & 0xFFFFFF) == 0x544146)	/* Check "FAT" string */
    01A33 E188      LDI	R24,0x18
    01A34 E090      LDI	R25,0
    01A35 01F5      MOVW	R30,R10
    01A36 59E9      SUBI	R30,0x99
    01A37 4FFF      SBCI	R31,0xFF
    01A38 8100      LD	R16,Z
    01A39 2711      CLR	R17
    01A3A 2722      CLR	R18
    01A3B 2733      CLR	R19
    01A3C 938A      ST	-Y,R24
    01A3D 940E 4C36 CALL	lsl32
    01A3F 0118      MOVW	R2,R16
    01A40 0129      MOVW	R4,R18
    01A41 01F5      MOVW	R30,R10
    01A42 59EA      SUBI	R30,0x9A
    01A43 4FFF      SBCI	R31,0xFF
    01A44 8060      LD	R6,Z
    01A45 56E6      SUBI	R30,0x66
    01A46 40F0      SBCI	R31,0
    01A47 2477      CLR	R7
    01A48 2488      CLR	R8
    01A49 2499      CLR	R9
    01A4A 0143      MOVW	R8,R6
    01A4B 2466      CLR	R6
    01A4C 2477      CLR	R7
    01A4D 2826      OR	R2,R6
    01A4E 2837      OR	R3,R7
    01A4F 2848      OR	R4,R8
    01A50 2859      OR	R5,R9
    01A51 59EB      SUBI	R30,0x9B
    01A52 4FFF      SBCI	R31,0xFF
    01A53 8060      LD	R6,Z
    01A54 56E5      SUBI	R30,0x65
    01A55 40F0      SBCI	R31,0
    01A56 2477      CLR	R7
    01A57 2C76      MOV	R7,R6
    01A58 2466      CLR	R6
    01A59 2488      CLR	R8
    01A5A 2499      CLR	R9
    01A5B 2826      OR	R2,R6
    01A5C 2837      OR	R3,R7
    01A5D 2848      OR	R4,R8
    01A5E 2859      OR	R5,R9
    01A5F 59EC      SUBI	R30,0x9C
    01A60 4FFF      SBCI	R31,0xFF
    01A61 8060      LD	R6,Z
    01A62 2477      CLR	R7
    01A63 2488      CLR	R8
    01A64 2499      CLR	R9
    01A65 2826      OR	R2,R6
    01A66 2837      OR	R3,R7
    01A67 2848      OR	R4,R8
    01A68 2859      OR	R5,R9
    01A69 EF4F      LDI	R20,0xFF
    01A6A EF5F      LDI	R21,0xFF
    01A6B EF6F      LDI	R22,0xFF
    01A6C E070      LDI	R23,0
    01A6D 2224      AND	R2,R20
    01A6E 2235      AND	R3,R21
    01A6F 2246      AND	R4,R22
    01A70 2257      AND	R5,R23
    01A71 E446      LDI	R20,0x46
    01A72 E451      LDI	R21,0x41
    01A73 E564      LDI	R22,0x54
    01A74 E070      LDI	R23,0
    01A75 1624      CP	R2,R20
    01A76 0635      CPC	R3,R21
    01A77 0646      CPC	R4,R22
    01A78 0657      CPC	R5,R23
    01A79 F411      BNE	0x1A7C
(1993) 		return 0;
    01A7A 2700      CLR	R16
    01A7B C04A      RJMP	0x1AC6
(1994) 	if ((LD_DWORD(&fs->win[BS_FilSysType32]) & 0xFFFFFF) == 0x544146)
    01A7C E188      LDI	R24,0x18
    01A7D E090      LDI	R25,0
    01A7E 01F5      MOVW	R30,R10
    01A7F 57ED      SUBI	R30,0x7D
    01A80 4FFF      SBCI	R31,0xFF
    01A81 8100      LD	R16,Z
    01A82 2711      CLR	R17
    01A83 2722      CLR	R18
    01A84 2733      CLR	R19
    01A85 938A      ST	-Y,R24
    01A86 940E 4C36 CALL	lsl32
    01A88 0118      MOVW	R2,R16
    01A89 0129      MOVW	R4,R18
    01A8A 01F5      MOVW	R30,R10
    01A8B 57EE      SUBI	R30,0x7E
    01A8C 4FFF      SBCI	R31,0xFF
    01A8D 8060      LD	R6,Z
    01A8E 58E2      SUBI	R30,0x82
    01A8F 40F0      SBCI	R31,0
    01A90 2477      CLR	R7
    01A91 2488      CLR	R8
    01A92 2499      CLR	R9
    01A93 0143      MOVW	R8,R6
    01A94 2466      CLR	R6
    01A95 2477      CLR	R7
    01A96 2826      OR	R2,R6
    01A97 2837      OR	R3,R7
    01A98 2848      OR	R4,R8
    01A99 2859      OR	R5,R9
    01A9A 57EF      SUBI	R30,0x7F
    01A9B 4FFF      SBCI	R31,0xFF
    01A9C 8060      LD	R6,Z
    01A9D 58E1      SUBI	R30,0x81
    01A9E 40F0      SBCI	R31,0
    01A9F 2477      CLR	R7
    01AA0 2C76      MOV	R7,R6
    01AA1 2466      CLR	R6
    01AA2 2488      CLR	R8
    01AA3 2499      CLR	R9
    01AA4 2826      OR	R2,R6
    01AA5 2837      OR	R3,R7
    01AA6 2848      OR	R4,R8
    01AA7 2859      OR	R5,R9
    01AA8 58E0      SUBI	R30,0x80
    01AA9 4FFF      SBCI	R31,0xFF
    01AAA 8060      LD	R6,Z
    01AAB 2477      CLR	R7
    01AAC 2488      CLR	R8
    01AAD 2499      CLR	R9
    01AAE 2826      OR	R2,R6
    01AAF 2837      OR	R3,R7
    01AB0 2848      OR	R4,R8
    01AB1 2859      OR	R5,R9
    01AB2 EF4F      LDI	R20,0xFF
    01AB3 EF5F      LDI	R21,0xFF
    01AB4 EF6F      LDI	R22,0xFF
    01AB5 E070      LDI	R23,0
    01AB6 2224      AND	R2,R20
    01AB7 2235      AND	R3,R21
    01AB8 2246      AND	R4,R22
    01AB9 2257      AND	R5,R23
    01ABA E446      LDI	R20,0x46
    01ABB E451      LDI	R21,0x41
    01ABC E564      LDI	R22,0x54
    01ABD E070      LDI	R23,0
    01ABE 1624      CP	R2,R20
    01ABF 0635      CPC	R3,R21
    01AC0 0646      CPC	R4,R22
    01AC1 0657      CPC	R5,R23
    01AC2 F411      BNE	0x1AC5
(1995) 		return 0;
    01AC3 2700      CLR	R16
    01AC4 C001      RJMP	0x1AC6
(1996) 
(1997) 	return 1;
    01AC5 E001      LDI	R16,1
    01AC6 9625      ADIW	R28,5
    01AC7 940E 4BD1 CALL	pop_xgsetF00C
    01AC9 9622      ADIW	R28,2
    01ACA 9508      RET
ff.c:chk_mounted:
  pi                   --> R10
  szbfat               --> Y,+25
  tbl                  --> R10
  p                    --> R10
  nrsv                 --> R14
  sysect               --> Y,+21
  bsect                --> Y,+17
  stat                 --> R10
  tsect                --> Y,+13
  nclst                --> Y,+9
  vol                  --> R14
  fasize               --> Y,+5
  b                    --> R14
  fmt                  --> R12
  fs                   --> Y,+37
  chk_wp               --> Y,+51
  rfs                  --> Y,+49
  path                 --> R12
    01ACB 933A      ST	-Y,R19
    01ACC 932A      ST	-Y,R18
    01ACD 940E 4BAB CALL	push_xgsetF0FC
    01ACF 0168      MOVW	R12,R16
    01AD0 97A7      SBIW	R28,0x27
(1998) }
(1999) 
(2000) 
(2001) 
(2002) 
(2003) /*-----------------------------------------------------------------------*/
(2004) /* Check if the file system object is valid or not                       */
(2005) /*-----------------------------------------------------------------------*/
(2006) 
(2007) static
(2008) FRESULT chk_mounted (	/* FR_OK(0): successful, !=0: any error occurred */
(2009) 	const TCHAR **path,	/* Pointer to pointer to the path name (drive number) */
(2010) 	FATFS **rfs,		/* Pointer to pointer to the found file system object */
(2011) 	BYTE chk_wp			/* !=0: Check media write protection for write access */
(2012) )
(2013) {
(2014) 	BYTE fmt, b, pi, *tbl;
(2015) 	UINT vol;
(2016) 	DSTATUS stat;
(2017) 	DWORD bsect, fasize, tsect, sysect, nclst, szbfat;
(2018) 	WORD nrsv;
(2019) 	const TCHAR *p = *path;
    01AD1 01F6      MOVW	R30,R12
    01AD2 80A0      LD	R10,Z
    01AD3 80B1      LDD	R11,Z+1
(2020) 	FATFS *fs;
(2021) 
(2022) 	/* Get logical drive number from the path name */
(2023) 	vol = p[0] - '0';					/* Is there a drive number? */
    01AD4 01F5      MOVW	R30,R10
    01AD5 8180      LD	R24,Z
    01AD6 2799      CLR	R25
    01AD7 97C0      SBIW	R24,0x30
    01AD8 017C      MOVW	R14,R24
(2024) 	if (vol <= 9 && p[1] == ':') {		/* Found a drive number, get and strip it */
    01AD9 E089      LDI	R24,0x9
    01ADA E090      LDI	R25,0
    01ADB 158E      CP	R24,R14
    01ADC 059F      CPC	R25,R15
    01ADD F050      BCS	0x1AE8
    01ADE 8181      LDD	R24,Z+1
    01ADF 338A      CPI	R24,0x3A
    01AE0 F439      BNE	0x1AE8
(2025) 		p += 2; *path = p;				/* Return pointer to the path name */
    01AE1 01CF      MOVW	R24,R30
    01AE2 9602      ADIW	R24,2
    01AE3 015C      MOVW	R10,R24
    01AE4 01F6      MOVW	R30,R12
    01AE5 82B1      STD	Z+1,R11
    01AE6 82A0      ST	Z,R10
(2026) 	} else {							/* No drive number is given */
    01AE7 C002      RJMP	0x1AEA
(2027) #if _FS_RPATH
(2028) 		vol = CurrVol;					/* Use current drive */
(2029) #else
(2030) 		vol = 0;						/* Use drive 0 */
    01AE8 24EE      CLR	R14
    01AE9 24FF      CLR	R15
(2031) #endif
(2032) 	}
(2033) 
(2034) 	/* Check if the file system object is valid or not */
(2035) 	if (vol >= _VOLUMES) 				/* Is the drive number valid? */
    01AEA 01C7      MOVW	R24,R14
    01AEB 3081      CPI	R24,1
    01AEC E0E0      LDI	R30,0
    01AED 079E      CPC	R25,R30
    01AEE F010      BCS	0x1AF1
(2036) 		return FR_INVALID_DRIVE;
    01AEF E00B      LDI	R16,0xB
    01AF0 C4CF      RJMP	0x1FC0
(2037) 	*rfs = fs = FatFs[vol];				/* Return pointer to the corresponding file system object */
    01AF1 EF85      LDI	R24,0xF5
    01AF2 E098      LDI	R25,0x8
    01AF3 01F7      MOVW	R30,R14
    01AF4 0FEE      LSL	R30
    01AF5 1FFF      ROL	R31
    01AF6 0FE8      ADD	R30,R24
    01AF7 1FF9      ADC	R31,R25
    01AF8 8020      LD	R2,Z
    01AF9 8031      LDD	R3,Z+1
    01AFA A23E      STD	Y+38,R3
    01AFB A22D      STD	Y+37,R2
    01AFC A9E9      LDD	R30,Y+49
    01AFD A9FA      LDD	R31,Y+50
    01AFE 8231      STD	Z+1,R3
    01AFF 8220      ST	Z,R2
(2038) 	if (!fs) return FR_NOT_ENABLED;		/* Is the file system object available? */
    01B00 0101      MOVW	R0,R2
    01B01 2022      TST	R2
    01B02 F421      BNE	0x1B07
    01B03 2033      TST	R3
    01B04 F411      BNE	0x1B07
    01B05 E00C      LDI	R16,0xC
    01B06 C4B9      RJMP	0x1FC0
(2039) 
(2040) 	ENTER_FF(fs);						/* Lock file system */
(2041) 
(2042) 	if (fs->fs_type) {					/* If the logical drive has been mounted */
    01B07 A1ED      LDD	R30,Y+37
    01B08 A1FE      LDD	R31,Y+38
    01B09 8020      LD	R2,Z
    01B0A 2022      TST	R2
    01B0B F079      BEQ	0x1B1B
(2043) 		stat = disk_status(fs->drv);
    01B0C 8101      LDD	R16,Z+1
    01B0D 940E 0C0C CALL	_disk_status
    01B0F 2EA0      MOV	R10,R16
(2044) 		if (!(stat & STA_NOINIT)) {		/* and the physical drive is kept initialized (has not been changed), */
    01B10 FD00      SBRC	R16,0
    01B11 C009      RJMP	0x1B1B
(2045) 			if (!_FS_READONLY && chk_wp && (stat & STA_PROTECT))	/* Check write protection if needed */
    01B12 A80B      LDD	R0,Y+51
    01B13 2000      TST	R0
    01B14 F021      BEQ	0x1B19
    01B15 FF02      SBRS	R16,2
    01B16 C002      RJMP	0x1B19
(2046) 				return FR_WRITE_PROTECTED;
    01B17 E00A      LDI	R16,0xA
    01B18 C4A7      RJMP	0x1FC0
(2047) 			return FR_OK;				/* The file system object is valid */
    01B19 2700      CLR	R16
    01B1A C4A5      RJMP	0x1FC0
(2048) 		}
(2049) 	}
(2050) 
(2051) 	/* The file system object is not valid. */
(2052) 	/* Following code attempts to mount the volume. (analyze BPB and initialize the fs object) */
(2053) 
(2054) 	fs->fs_type = 0;					/* Clear the file system object */
    01B1B 2422      CLR	R2
    01B1C A1ED      LDD	R30,Y+37
    01B1D A1FE      LDD	R31,Y+38
    01B1E 8220      ST	Z,R2
(2055) 	fs->drv = LD2PD(vol);				/* Bind the logical drive and a physical drive */
    01B1F 82E1      STD	Z+1,R14
(2056) 	stat = disk_initialize(fs->drv);	/* Initialize low level disk I/O layer */
    01B20 8101      LDD	R16,Z+1
    01B21 940E 0BF6 CALL	_disk_initialize
    01B23 2EE0      MOV	R14,R16
    01B24 2CAE      MOV	R10,R14
(2057) 	if (stat & STA_NOINIT)				/* Check if the initialization succeeded */
    01B25 FF00      SBRS	R16,0
    01B26 C002      RJMP	0x1B29
(2058) 		return FR_NOT_READY;			/* Failed to initialize due to no media or hard error */
    01B27 E003      LDI	R16,3
    01B28 C497      RJMP	0x1FC0
(2059) 	if (!_FS_READONLY && chk_wp && (stat & STA_PROTECT))	/* Check disk write protection if needed */
    01B29 A80B      LDD	R0,Y+51
    01B2A 2000      TST	R0
    01B2B F021      BEQ	0x1B30
    01B2C FEA2      SBRS	R10,2
    01B2D C002      RJMP	0x1B30
(2060) 		return FR_WRITE_PROTECTED;
    01B2E E00A      LDI	R16,0xA
    01B2F C490      RJMP	0x1FC0
(2061) #if _MAX_SS != 512						/* Get disk sector size (variable sector size cfg only) */
(2062) 	if (disk_ioctl(fs->drv, GET_SECTOR_SIZE, &fs->ssize) != RES_OK)
(2063) 		return FR_DISK_ERR;
(2064) #endif
(2065) 	/* Search FAT partition on the drive. Supports only generic partitionings, FDISK and SFD. */
(2066) 	fmt = check_fs(fs, bsect = 0);		/* Load sector 0 and check if it is an FAT-VBR (in SFD) */
    01B30 E080      LDI	R24,0
    01B31 8B89      STD	Y+17,R24
    01B32 8B8A      STD	Y+18,R24
    01B33 8B8B      STD	Y+19,R24
    01B34 8B8C      STD	Y+20,R24
    01B35 E040      LDI	R20,0
    01B36 E050      LDI	R21,0
    01B37 E060      LDI	R22,0
    01B38 E070      LDI	R23,0
    01B39 8368      ST	Y,R22
    01B3A 8379      STD	Y+1,R23
    01B3B 019A      MOVW	R18,R20
    01B3C A10D      LDD	R16,Y+37
    01B3D A11E      LDD	R17,Y+38
    01B3E DEC4      RCALL	ff.c:check_fs
    01B3F 2EA0      MOV	R10,R16
    01B40 2CCA      MOV	R12,R10
(2067) 	if (LD2PT(vol) && !fmt) fmt = 1;	/* Force non-SFD if the volume is forced partition */
    01B41 C000      RJMP	0x1B42
(2068) 	if (fmt == 1) {						/* Not an FAT-VBR, the physical drive can be partitioned */
    01B42 2D8C      MOV	R24,R12
    01B43 3081      CPI	R24,1
    01B44 F009      BEQ	0x1B46
    01B45 C04C      RJMP	0x1B92
(2069) 		/* Check the partition listed in the partition table */
(2070) 		pi = LD2PT(vol);
    01B46 24AA      CLR	R10
(2071) 		if (pi) pi--;
    01B47 F009      BEQ	0x1B49
    01B48 94AA      DEC	R10
(2072) 		tbl = &fs->win[MBR_Table + pi * SZ_PTE];/* Partition table */
    01B49 E100      LDI	R16,0x10
    01B4A 2D1A      MOV	R17,R10
    01B4B 0301      MULSU	R16,R17
    01B4C 0150      MOVW	R10,R0
    01B4D A18D      LDD	R24,Y+37
    01B4E A19E      LDD	R25,Y+38
    01B4F 5184      SUBI	R24,0x14
    01B50 4F9E      SBCI	R25,0xFE
    01B51 0EA8      ADD	R10,R24
    01B52 1EB9      ADC	R11,R25
(2073) 		if (tbl[4]) {						/* Is the partition existing? */
    01B53 01F5      MOVW	R30,R10
    01B54 8024      LDD	R2,Z+4
    01B55 2022      TST	R2
    01B56 F409      BNE	0x1B58
    01B57 C03A      RJMP	0x1B92
(2074) 			bsect = LD_DWORD(&tbl[8]);		/* Partition offset in LBA */
    01B58 E188      LDI	R24,0x18
    01B59 E090      LDI	R25,0
    01B5A 8503      LDD	R16,Z+11
    01B5B 2711      CLR	R17
    01B5C 2722      CLR	R18
    01B5D 2733      CLR	R19
    01B5E 938A      ST	-Y,R24
    01B5F 940E 4C36 CALL	lsl32
    01B61 0118      MOVW	R2,R16
    01B62 0129      MOVW	R4,R18
    01B63 01F5      MOVW	R30,R10
    01B64 8462      LDD	R6,Z+10
    01B65 2477      CLR	R7
    01B66 2488      CLR	R8
    01B67 2499      CLR	R9
    01B68 0143      MOVW	R8,R6
    01B69 2466      CLR	R6
    01B6A 2477      CLR	R7
    01B6B 2826      OR	R2,R6
    01B6C 2837      OR	R3,R7
    01B6D 2848      OR	R4,R8
    01B6E 2859      OR	R5,R9
    01B6F 8461      LDD	R6,Z+9
    01B70 2477      CLR	R7
    01B71 2C76      MOV	R7,R6
    01B72 2466      CLR	R6
    01B73 2488      CLR	R8
    01B74 2499      CLR	R9
    01B75 2826      OR	R2,R6
    01B76 2837      OR	R3,R7
    01B77 2848      OR	R4,R8
    01B78 2859      OR	R5,R9
    01B79 9638      ADIW	R30,0x8
    01B7A 8060      LD	R6,Z
    01B7B 2477      CLR	R7
    01B7C 2488      CLR	R8
    01B7D 2499      CLR	R9
    01B7E 2826      OR	R2,R6
    01B7F 2837      OR	R3,R7
    01B80 2848      OR	R4,R8
    01B81 2859      OR	R5,R9
    01B82 8A29      STD	Y+17,R2
    01B83 8A3A      STD	Y+18,R3
    01B84 8A4B      STD	Y+19,R4
    01B85 8A5C      STD	Y+20,R5
(2075) 			fmt = check_fs(fs, bsect);		/* Check the partition */
    01B86 8829      LDD	R2,Y+17
    01B87 883A      LDD	R3,Y+18
    01B88 884B      LDD	R4,Y+19
    01B89 885C      LDD	R5,Y+20
    01B8A 8248      ST	Y,R4
    01B8B 8259      STD	Y+1,R5
    01B8C 0191      MOVW	R18,R2
    01B8D A10D      LDD	R16,Y+37
    01B8E A11E      LDD	R17,Y+38
    01B8F DE73      RCALL	ff.c:check_fs
    01B90 2EA0      MOV	R10,R16
    01B91 2CCA      MOV	R12,R10
(2076) 		}
(2077) 	}
(2078) 	if (fmt == 3) return FR_DISK_ERR;
    01B92 2D8C      MOV	R24,R12
    01B93 3083      CPI	R24,3
    01B94 F411      BNE	0x1B97
    01B95 E001      LDI	R16,1
    01B96 C429      RJMP	0x1FC0
(2079) 	if (fmt) return FR_NO_FILESYSTEM;		/* No FAT volume is found */
    01B97 20CC      TST	R12
    01B98 F011      BEQ	0x1B9B
    01B99 E00D      LDI	R16,0xD
    01B9A C425      RJMP	0x1FC0
(2080) 
(2081) 	/* An FAT volume is found. Following code initializes the file system object */
(2082) 
(2083) 	if (LD_WORD(fs->win+BPB_BytsPerSec) != SS(fs))		/* (BPB_BytsPerSec must be equal to the physical sector size) */
    01B9B A1ED      LDD	R30,Y+37
    01B9C A1FE      LDD	R31,Y+38
    01B9D AC21      LDD	R2,Z+57
    01B9E 2433      CLR	R3
    01B9F AD82      LDD	R24,Z+58
    01BA0 2799      CLR	R25
    01BA1 2F98      MOV	R25,R24
    01BA2 2788      CLR	R24
    01BA3 2982      OR	R24,R2
    01BA4 2993      OR	R25,R3
    01BA5 3080      CPI	R24,0
    01BA6 E0E2      LDI	R30,2
    01BA7 079E      CPC	R25,R30
    01BA8 F011      BEQ	0x1BAB
(2084) 		return FR_NO_FILESYSTEM;
    01BA9 E00D      LDI	R16,0xD
    01BAA C415      RJMP	0x1FC0
(2085) 
(2086) 	fasize = LD_WORD(fs->win+BPB_FATSz16);				/* Number of sectors per FAT */
    01BAB A1ED      LDD	R30,Y+37
    01BAC A1FE      LDD	R31,Y+38
    01BAD 5BEC      SUBI	R30,0xBC
    01BAE 4FFF      SBCI	R31,0xFF
    01BAF 8020      LD	R2,Z
    01BB0 54E4      SUBI	R30,0x44
    01BB1 40F0      SBCI	R31,0
    01BB2 2433      CLR	R3
    01BB3 5BEB      SUBI	R30,0xBB
    01BB4 4FFF      SBCI	R31,0xFF
    01BB5 8040      LD	R4,Z
    01BB6 2455      CLR	R5
    01BB7 2C54      MOV	R5,R4
    01BB8 2444      CLR	R4
    01BB9 2842      OR	R4,R2
    01BBA 2853      OR	R5,R3
    01BBB 0112      MOVW	R2,R4
    01BBC 2444      CLR	R4
    01BBD 2455      CLR	R5
    01BBE 822D      STD	Y+5,R2
    01BBF 823E      STD	Y+6,R3
    01BC0 824F      STD	Y+7,R4
    01BC1 8658      STD	Y+8,R5
(2087) 	if (!fasize) fasize = LD_DWORD(fs->win+BPB_FATSz32);
    01BC2 802D      LDD	R2,Y+5
    01BC3 803E      LDD	R3,Y+6
    01BC4 804F      LDD	R4,Y+7
    01BC5 8458      LDD	R5,Y+8
    01BC6 9488      BCLR	0
    01BC7 2022      TST	R2
    01BC8 0432      CPC	R3,R2
    01BC9 0442      CPC	R4,R2
    01BCA 0452      CPC	R5,R2
    01BCB F009      BEQ	0x1BCD
    01BCC C03C      RJMP	0x1C09
    01BCD E188      LDI	R24,0x18
    01BCE E090      LDI	R25,0
    01BCF A1ED      LDD	R30,Y+37
    01BD0 A1FE      LDD	R31,Y+38
    01BD1 5AEB      SUBI	R30,0xAB
    01BD2 4FFF      SBCI	R31,0xFF
    01BD3 8100      LD	R16,Z
    01BD4 2711      CLR	R17
    01BD5 2722      CLR	R18
    01BD6 2733      CLR	R19
    01BD7 938A      ST	-Y,R24
    01BD8 940E 4C36 CALL	lsl32
    01BDA 0118      MOVW	R2,R16
    01BDB 0129      MOVW	R4,R18
    01BDC A1ED      LDD	R30,Y+37
    01BDD A1FE      LDD	R31,Y+38
    01BDE 5AEC      SUBI	R30,0xAC
    01BDF 4FFF      SBCI	R31,0xFF
    01BE0 8060      LD	R6,Z
    01BE1 55E4      SUBI	R30,0x54
    01BE2 40F0      SBCI	R31,0
    01BE3 2477      CLR	R7
    01BE4 2488      CLR	R8
    01BE5 2499      CLR	R9
    01BE6 0143      MOVW	R8,R6
    01BE7 2466      CLR	R6
    01BE8 2477      CLR	R7
    01BE9 2826      OR	R2,R6
    01BEA 2837      OR	R3,R7
    01BEB 2848      OR	R4,R8
    01BEC 2859      OR	R5,R9
    01BED 5AED      SUBI	R30,0xAD
    01BEE 4FFF      SBCI	R31,0xFF
    01BEF 8060      LD	R6,Z
    01BF0 55E3      SUBI	R30,0x53
    01BF1 40F0      SBCI	R31,0
    01BF2 2477      CLR	R7
    01BF3 2C76      MOV	R7,R6
    01BF4 2466      CLR	R6
    01BF5 2488      CLR	R8
    01BF6 2499      CLR	R9
    01BF7 2826      OR	R2,R6
    01BF8 2837      OR	R3,R7
    01BF9 2848      OR	R4,R8
    01BFA 2859      OR	R5,R9
    01BFB 5AEE      SUBI	R30,0xAE
    01BFC 4FFF      SBCI	R31,0xFF
    01BFD 8060      LD	R6,Z
    01BFE 2477      CLR	R7
    01BFF 2488      CLR	R8
    01C00 2499      CLR	R9
    01C01 2826      OR	R2,R6
    01C02 2837      OR	R3,R7
    01C03 2848      OR	R4,R8
    01C04 2859      OR	R5,R9
    01C05 822D      STD	Y+5,R2
    01C06 823E      STD	Y+6,R3
    01C07 824F      STD	Y+7,R4
    01C08 8658      STD	Y+8,R5
(2088) 	fs->fsize = fasize;
    01C09 802D      LDD	R2,Y+5
    01C0A 803E      LDD	R3,Y+6
    01C0B 804F      LDD	R4,Y+7
    01C0C 8458      LDD	R5,Y+8
    01C0D A1ED      LDD	R30,Y+37
    01C0E A1FE      LDD	R31,Y+38
    01C0F 8E22      STD	Z+26,R2
    01C10 8E33      STD	Z+27,R3
    01C11 8E44      STD	Z+28,R4
    01C12 8E55      STD	Z+29,R5
(2089) 
(2090) 	fs->n_fats = b = fs->win[BPB_NumFATs];				/* Number of FAT copies */
    01C13 ACA6      LDD	R10,Z+62
    01C14 2CEA      MOV	R14,R10
    01C15 82A3      STD	Z+3,R10
(2091) 	if (b != 1 && b != 2) return FR_NO_FILESYSTEM;		/* (Must be 1 or 2) */
    01C16 2D8E      MOV	R24,R14
    01C17 3081      CPI	R24,1
    01C18 F021      BEQ	0x1C1D
    01C19 3082      CPI	R24,2
    01C1A F011      BEQ	0x1C1D
    01C1B E00D      LDI	R16,0xD
    01C1C C3A3      RJMP	0x1FC0
(2092) 	fasize *= b;										/* Number of sectors for FAT area */
    01C1D 2C2E      MOV	R2,R14
    01C1E 2433      CLR	R3
    01C1F 2444      CLR	R4
    01C20 2455      CLR	R5
    01C21 810D      LDD	R16,Y+5
    01C22 811E      LDD	R17,Y+6
    01C23 812F      LDD	R18,Y+7
    01C24 8538      LDD	R19,Y+8
    01C25 925A      ST	-Y,R5
    01C26 924A      ST	-Y,R4
    01C27 923A      ST	-Y,R3
    01C28 922A      ST	-Y,R2
    01C29 940E 4B57 CALL	empy32s|empy32u
    01C2B 830D      STD	Y+5,R16
    01C2C 831E      STD	Y+6,R17
    01C2D 832F      STD	Y+7,R18
    01C2E 8738      STD	Y+8,R19
(2093) 
(2094) 	fs->csize = b = fs->win[BPB_SecPerClus];			/* Number of sectors per cluster */
    01C2F A1ED      LDD	R30,Y+37
    01C30 A1FE      LDD	R31,Y+38
    01C31 ACA3      LDD	R10,Z+59
    01C32 2CEA      MOV	R14,R10
    01C33 82A2      STD	Z+2,R10
(2095) 	if (!b || (b & (b - 1))) return FR_NO_FILESYSTEM;	/* (Must be power of 2) */
    01C34 20AA      TST	R10
    01C35 F029      BEQ	0x1C3B
    01C36 2D8E      MOV	R24,R14
    01C37 5081      SUBI	R24,1
    01C38 2C2E      MOV	R2,R14
    01C39 2228      AND	R2,R24
    01C3A F011      BEQ	0x1C3D
    01C3B E00D      LDI	R16,0xD
    01C3C C383      RJMP	0x1FC0
(2096) 
(2097) 	fs->n_rootdir = LD_WORD(fs->win+BPB_RootEntCnt);	/* Number of root directory entries */
    01C3D A1ED      LDD	R30,Y+37
    01C3E A1FE      LDD	R31,Y+38
    01C3F AC27      LDD	R2,Z+63
    01C40 2433      CLR	R3
    01C41 5CE0      SUBI	R30,0xC0
    01C42 4FFF      SBCI	R31,0xFF
    01C43 8040      LD	R4,Z
    01C44 54E0      SUBI	R30,0x40
    01C45 40F0      SBCI	R31,0
    01C46 2455      CLR	R5
    01C47 2C54      MOV	R5,R4
    01C48 2444      CLR	R4
    01C49 2842      OR	R4,R2
    01C4A 2853      OR	R5,R3
    01C4B 8651      STD	Z+9,R5
    01C4C 8640      STD	Z+8,R4
(2098) 	if (fs->n_rootdir % (SS(fs) / SZ_DIR)) return FR_NO_FILESYSTEM;	/* (BPB_RootEntCnt must be sector aligned) */
    01C4D 8580      LDD	R24,Z+8
    01C4E 8591      LDD	R25,Z+9
    01C4F 708F      ANDI	R24,0xF
    01C50 7090      ANDI	R25,0
    01C51 3080      CPI	R24,0
    01C52 0789      CPC	R24,R25
    01C53 F011      BEQ	0x1C56
    01C54 E00D      LDI	R16,0xD
    01C55 C36A      RJMP	0x1FC0
(2099) 
(2100) 	tsect = LD_WORD(fs->win+BPB_TotSec16);				/* Number of sectors on the volume */
    01C56 A1ED      LDD	R30,Y+37
    01C57 A1FE      LDD	R31,Y+38
    01C58 5BEF      SUBI	R30,0xBF
    01C59 4FFF      SBCI	R31,0xFF
    01C5A 8020      LD	R2,Z
    01C5B 54E1      SUBI	R30,0x41
    01C5C 40F0      SBCI	R31,0
    01C5D 2433      CLR	R3
    01C5E 5BEE      SUBI	R30,0xBE
    01C5F 4FFF      SBCI	R31,0xFF
    01C60 8040      LD	R4,Z
    01C61 2455      CLR	R5
    01C62 2C54      MOV	R5,R4
    01C63 2444      CLR	R4
    01C64 2842      OR	R4,R2
    01C65 2853      OR	R5,R3
    01C66 0112      MOVW	R2,R4
    01C67 2444      CLR	R4
    01C68 2455      CLR	R5
    01C69 862D      STD	Y+13,R2
    01C6A 863E      STD	Y+14,R3
    01C6B 864F      STD	Y+15,R4
    01C6C 8A58      STD	Y+16,R5
(2101) 	if (!tsect) tsect = LD_DWORD(fs->win+BPB_TotSec32);
    01C6D 842D      LDD	R2,Y+13
    01C6E 843E      LDD	R3,Y+14
    01C6F 844F      LDD	R4,Y+15
    01C70 8858      LDD	R5,Y+16
    01C71 9488      BCLR	0
    01C72 2022      TST	R2
    01C73 0432      CPC	R3,R2
    01C74 0442      CPC	R4,R2
    01C75 0452      CPC	R5,R2
    01C76 F009      BEQ	0x1C78
    01C77 C03C      RJMP	0x1CB4
    01C78 E188      LDI	R24,0x18
    01C79 E090      LDI	R25,0
    01C7A A1ED      LDD	R30,Y+37
    01C7B A1FE      LDD	R31,Y+38
    01C7C 5AEF      SUBI	R30,0xAF
    01C7D 4FFF      SBCI	R31,0xFF
    01C7E 8100      LD	R16,Z
    01C7F 2711      CLR	R17
    01C80 2722      CLR	R18
    01C81 2733      CLR	R19
    01C82 938A      ST	-Y,R24
    01C83 940E 4C36 CALL	lsl32
    01C85 0118      MOVW	R2,R16
    01C86 0129      MOVW	R4,R18
    01C87 A1ED      LDD	R30,Y+37
    01C88 A1FE      LDD	R31,Y+38
    01C89 5BE0      SUBI	R30,0xB0
    01C8A 4FFF      SBCI	R31,0xFF
    01C8B 8060      LD	R6,Z
    01C8C 55E0      SUBI	R30,0x50
    01C8D 40F0      SBCI	R31,0
    01C8E 2477      CLR	R7
    01C8F 2488      CLR	R8
    01C90 2499      CLR	R9
    01C91 0143      MOVW	R8,R6
    01C92 2466      CLR	R6
    01C93 2477      CLR	R7
    01C94 2826      OR	R2,R6
    01C95 2837      OR	R3,R7
    01C96 2848      OR	R4,R8
    01C97 2859      OR	R5,R9
    01C98 5BE1      SUBI	R30,0xB1
    01C99 4FFF      SBCI	R31,0xFF
    01C9A 8060      LD	R6,Z
    01C9B 54EF      SUBI	R30,0x4F
    01C9C 40F0      SBCI	R31,0
    01C9D 2477      CLR	R7
    01C9E 2C76      MOV	R7,R6
    01C9F 2466      CLR	R6
    01CA0 2488      CLR	R8
    01CA1 2499      CLR	R9
    01CA2 2826      OR	R2,R6
    01CA3 2837      OR	R3,R7
    01CA4 2848      OR	R4,R8
    01CA5 2859      OR	R5,R9
    01CA6 5BE2      SUBI	R30,0xB2
    01CA7 4FFF      SBCI	R31,0xFF
    01CA8 8060      LD	R6,Z
    01CA9 2477      CLR	R7
    01CAA 2488      CLR	R8
    01CAB 2499      CLR	R9
    01CAC 2826      OR	R2,R6
    01CAD 2837      OR	R3,R7
    01CAE 2848      OR	R4,R8
    01CAF 2859      OR	R5,R9
    01CB0 862D      STD	Y+13,R2
    01CB1 863E      STD	Y+14,R3
    01CB2 864F      STD	Y+15,R4
    01CB3 8A58      STD	Y+16,R5
(2102) 
(2103) 	nrsv = LD_WORD(fs->win+BPB_RsvdSecCnt);				/* Number of reserved sectors */
    01CB4 A1ED      LDD	R30,Y+37
    01CB5 A1FE      LDD	R31,Y+38
    01CB6 AC24      LDD	R2,Z+60
    01CB7 2433      CLR	R3
    01CB8 ACE5      LDD	R14,Z+61
    01CB9 24FF      CLR	R15
    01CBA 2CFE      MOV	R15,R14
    01CBB 24EE      CLR	R14
    01CBC 28E2      OR	R14,R2
    01CBD 28F3      OR	R15,R3
(2104) 	if (!nrsv) return FR_NO_FILESYSTEM;					/* (BPB_RsvdSecCnt must not be 0) */
    01CBE 20EE      TST	R14
    01CBF F421      BNE	0x1CC4
    01CC0 20FF      TST	R15
    01CC1 F411      BNE	0x1CC4
    01CC2 E00D      LDI	R16,0xD
    01CC3 C2FC      RJMP	0x1FC0
(2105) 
(2106) 	/* Determine the FAT sub type */
(2107) 	sysect = nrsv + fasize + fs->n_rootdir / (SS(fs) / SZ_DIR);	/* RSV+FAT+DIR */
    01CC4 802D      LDD	R2,Y+5
    01CC5 803E      LDD	R3,Y+6
    01CC6 804F      LDD	R4,Y+7
    01CC7 8458      LDD	R5,Y+8
    01CC8 0137      MOVW	R6,R14
    01CC9 2488      CLR	R8
    01CCA 2499      CLR	R9
    01CCB 0C62      ADD	R6,R2
    01CCC 1C73      ADC	R7,R3
    01CCD 1C84      ADC	R8,R4
    01CCE 1C95      ADC	R9,R5
    01CCF A1ED      LDD	R30,Y+37
    01CD0 A1FE      LDD	R31,Y+38
    01CD1 9638      ADIW	R30,0x8
    01CD2 8020      LD	R2,Z
    01CD3 8031      LDD	R3,Z+1
    01CD4 9436      LSR	R3
    01CD5 9427      ROR	R2
    01CD6 9436      LSR	R3
    01CD7 9427      ROR	R2
    01CD8 9436      LSR	R3
    01CD9 9427      ROR	R2
    01CDA 9436      LSR	R3
    01CDB 9427      ROR	R2
    01CDC 2444      CLR	R4
    01CDD 2455      CLR	R5
    01CDE 0C62      ADD	R6,R2
    01CDF 1C73      ADC	R7,R3
    01CE0 1C84      ADC	R8,R4
    01CE1 1C95      ADC	R9,R5
    01CE2 8A6D      STD	Y+21,R6
    01CE3 8A7E      STD	Y+22,R7
    01CE4 8A8F      STD	Y+23,R8
    01CE5 8E98      STD	Y+24,R9
(2108) 	if (tsect < sysect) return FR_NO_FILESYSTEM;		/* (Invalid volume size) */
    01CE6 882D      LDD	R2,Y+21
    01CE7 883E      LDD	R3,Y+22
    01CE8 884F      LDD	R4,Y+23
    01CE9 8C58      LDD	R5,Y+24
    01CEA 846D      LDD	R6,Y+13
    01CEB 847E      LDD	R7,Y+14
    01CEC 848F      LDD	R8,Y+15
    01CED 8898      LDD	R9,Y+16
    01CEE 1462      CP	R6,R2
    01CEF 0473      CPC	R7,R3
    01CF0 0484      CPC	R8,R4
    01CF1 0495      CPC	R9,R5
    01CF2 F410      BCC	0x1CF5
    01CF3 E00D      LDI	R16,0xD
    01CF4 C2CB      RJMP	0x1FC0
(2109) 	nclst = (tsect - sysect) / fs->csize;				/* Number of clusters */
    01CF5 882D      LDD	R2,Y+21
    01CF6 883E      LDD	R3,Y+22
    01CF7 884F      LDD	R4,Y+23
    01CF8 8C58      LDD	R5,Y+24
    01CF9 850D      LDD	R16,Y+13
    01CFA 851E      LDD	R17,Y+14
    01CFB 852F      LDD	R18,Y+15
    01CFC 8938      LDD	R19,Y+16
    01CFD 1902      SUB	R16,R2
    01CFE 0913      SBC	R17,R3
    01CFF 0924      SBC	R18,R4
    01D00 0935      SBC	R19,R5
    01D01 A1ED      LDD	R30,Y+37
    01D02 A1FE      LDD	R31,Y+38
    01D03 9632      ADIW	R30,2
    01D04 8020      LD	R2,Z
    01D05 2433      CLR	R3
    01D06 2444      CLR	R4
    01D07 2455      CLR	R5
    01D08 925A      ST	-Y,R5
    01D09 924A      ST	-Y,R4
    01D0A 923A      ST	-Y,R3
    01D0B 922A      ST	-Y,R2
    01D0C 940E 4AB1 CALL	div32u
    01D0E 8709      STD	Y+9,R16
    01D0F 871A      STD	Y+10,R17
    01D10 872B      STD	Y+11,R18
    01D11 873C      STD	Y+12,R19
(2110) 	if (!nclst) return FR_NO_FILESYSTEM;				/* (Invalid volume size) */
    01D12 8429      LDD	R2,Y+9
    01D13 843A      LDD	R3,Y+10
    01D14 844B      LDD	R4,Y+11
    01D15 845C      LDD	R5,Y+12
    01D16 9488      BCLR	0
    01D17 2022      TST	R2
    01D18 0432      CPC	R3,R2
    01D19 0442      CPC	R4,R2
    01D1A 0452      CPC	R5,R2
    01D1B F411      BNE	0x1D1E
    01D1C E00D      LDI	R16,0xD
    01D1D C2A2      RJMP	0x1FC0
(2111) 	fmt = FS_FAT12;
    01D1E 24CC      CLR	R12
    01D1F 94C3      INC	R12
(2112) 	if (nclst >= MIN_FAT16) fmt = FS_FAT16;
    01D20 EF46      LDI	R20,0xF6
    01D21 E05F      LDI	R21,0xF
    01D22 E060      LDI	R22,0
    01D23 E070      LDI	R23,0
    01D24 8429      LDD	R2,Y+9
    01D25 843A      LDD	R3,Y+10
    01D26 844B      LDD	R4,Y+11
    01D27 845C      LDD	R5,Y+12
    01D28 1624      CP	R2,R20
    01D29 0635      CPC	R3,R21
    01D2A 0646      CPC	R4,R22
    01D2B 0657      CPC	R5,R23
    01D2C F010      BCS	0x1D2F
    01D2D E082      LDI	R24,2
    01D2E 2EC8      MOV	R12,R24
(2113) 	if (nclst >= MIN_FAT32) fmt = FS_FAT32;
    01D2F EF46      LDI	R20,0xF6
    01D30 EF5F      LDI	R21,0xFF
    01D31 E060      LDI	R22,0
    01D32 E070      LDI	R23,0
    01D33 8429      LDD	R2,Y+9
    01D34 843A      LDD	R3,Y+10
    01D35 844B      LDD	R4,Y+11
    01D36 845C      LDD	R5,Y+12
    01D37 1624      CP	R2,R20
    01D38 0635      CPC	R3,R21
    01D39 0646      CPC	R4,R22
    01D3A 0657      CPC	R5,R23
    01D3B F010      BCS	0x1D3E
    01D3C E083      LDI	R24,3
    01D3D 2EC8      MOV	R12,R24
(2114) 
(2115) 	/* Boundaries and Limits */
(2116) 	fs->n_fatent = nclst + 2;							/* Number of FAT entries */
    01D3E E042      LDI	R20,2
    01D3F E050      LDI	R21,0
    01D40 E060      LDI	R22,0
    01D41 E070      LDI	R23,0
    01D42 8429      LDD	R2,Y+9
    01D43 843A      LDD	R3,Y+10
    01D44 844B      LDD	R4,Y+11
    01D45 845C      LDD	R5,Y+12
    01D46 0E24      ADD	R2,R20
    01D47 1E35      ADC	R3,R21
    01D48 1E46      ADC	R4,R22
    01D49 1E57      ADC	R5,R23
    01D4A A1ED      LDD	R30,Y+37
    01D4B A1FE      LDD	R31,Y+38
    01D4C 9676      ADIW	R30,0x16
    01D4D 8220      ST	Z,R2
    01D4E 8231      STD	Z+1,R3
    01D4F 8242      STD	Z+2,R4
    01D50 8253      STD	Z+3,R5
(2117) 	fs->database = bsect + sysect;						/* Data start sector */
    01D51 882D      LDD	R2,Y+21
    01D52 883E      LDD	R3,Y+22
    01D53 884F      LDD	R4,Y+23
    01D54 8C58      LDD	R5,Y+24
    01D55 8869      LDD	R6,Y+17
    01D56 887A      LDD	R7,Y+18
    01D57 888B      LDD	R8,Y+19
    01D58 889C      LDD	R9,Y+20
    01D59 0C62      ADD	R6,R2
    01D5A 1C73      ADC	R7,R3
    01D5B 1C84      ADC	R8,R4
    01D5C 1C95      ADC	R9,R5
    01D5D A1ED      LDD	R30,Y+37
    01D5E A1FE      LDD	R31,Y+38
    01D5F 96B6      ADIW	R30,0x26
    01D60 8260      ST	Z,R6
    01D61 8271      STD	Z+1,R7
    01D62 8282      STD	Z+2,R8
    01D63 8293      STD	Z+3,R9
(2118) 	fs->fatbase = bsect + nrsv; 						/* FAT start sector */
    01D64 0117      MOVW	R2,R14
    01D65 2444      CLR	R4
    01D66 2455      CLR	R5
    01D67 8869      LDD	R6,Y+17
    01D68 887A      LDD	R7,Y+18
    01D69 888B      LDD	R8,Y+19
    01D6A 889C      LDD	R9,Y+20
    01D6B 0C62      ADD	R6,R2
    01D6C 1C73      ADC	R7,R3
    01D6D 1C84      ADC	R8,R4
    01D6E 1C95      ADC	R9,R5
    01D6F A1ED      LDD	R30,Y+37
    01D70 A1FE      LDD	R31,Y+38
    01D71 8E66      STD	Z+30,R6
    01D72 8E77      STD	Z+31,R7
    01D73 A280      STD	Z+32,R8
    01D74 A291      STD	Z+33,R9
(2119) 	if (fmt == FS_FAT32) {
    01D75 2D8C      MOV	R24,R12
    01D76 3083      CPI	R24,3
    01D77 F009      BEQ	0x1D79
    01D78 C055      RJMP	0x1DCE
(2120) 		if (fs->n_rootdir) return FR_NO_FILESYSTEM;		/* (BPB_RootEntCnt must be 0) */
    01D79 8420      LDD	R2,Z+8
    01D7A 8431      LDD	R3,Z+9
    01D7B 2022      TST	R2
    01D7C F411      BNE	0x1D7F
    01D7D 2033      TST	R3
    01D7E F011      BEQ	0x1D81
    01D7F E00D      LDI	R16,0xD
    01D80 C23F      RJMP	0x1FC0
(2121) 		fs->dirbase = LD_DWORD(fs->win+BPB_RootClus);	/* Root directory start cluster */
    01D81 E188      LDI	R24,0x18
    01D82 E090      LDI	R25,0
    01D83 A1ED      LDD	R30,Y+37
    01D84 A1FE      LDD	R31,Y+38
    01D85 5AE3      SUBI	R30,0xA3
    01D86 4FFF      SBCI	R31,0xFF
    01D87 8100      LD	R16,Z
    01D88 2711      CLR	R17
    01D89 2722      CLR	R18
    01D8A 2733      CLR	R19
    01D8B 938A      ST	-Y,R24
    01D8C 940E 4C36 CALL	lsl32
    01D8E 0118      MOVW	R2,R16
    01D8F 0129      MOVW	R4,R18
    01D90 A1ED      LDD	R30,Y+37
    01D91 A1FE      LDD	R31,Y+38
    01D92 5AE4      SUBI	R30,0xA4
    01D93 4FFF      SBCI	R31,0xFF
    01D94 8060      LD	R6,Z
    01D95 55EC      SUBI	R30,0x5C
    01D96 40F0      SBCI	R31,0
    01D97 2477      CLR	R7
    01D98 2488      CLR	R8
    01D99 2499      CLR	R9
    01D9A 0143      MOVW	R8,R6
    01D9B 2466      CLR	R6
    01D9C 2477      CLR	R7
    01D9D 2826      OR	R2,R6
    01D9E 2837      OR	R3,R7
    01D9F 2848      OR	R4,R8
    01DA0 2859      OR	R5,R9
    01DA1 5AE5      SUBI	R30,0xA5
    01DA2 4FFF      SBCI	R31,0xFF
    01DA3 8060      LD	R6,Z
    01DA4 55EB      SUBI	R30,0x5B
    01DA5 40F0      SBCI	R31,0
    01DA6 2477      CLR	R7
    01DA7 2C76      MOV	R7,R6
    01DA8 2466      CLR	R6
    01DA9 2488      CLR	R8
    01DAA 2499      CLR	R9
    01DAB 2826      OR	R2,R6
    01DAC 2837      OR	R3,R7
    01DAD 2848      OR	R4,R8
    01DAE 2859      OR	R5,R9
    01DAF 5AE6      SUBI	R30,0xA6
    01DB0 4FFF      SBCI	R31,0xFF
    01DB1 8060      LD	R6,Z
    01DB2 55EA      SUBI	R30,0x5A
    01DB3 40F0      SBCI	R31,0
    01DB4 2477      CLR	R7
    01DB5 2488      CLR	R8
    01DB6 2499      CLR	R9
    01DB7 2826      OR	R2,R6
    01DB8 2837      OR	R3,R7
    01DB9 2848      OR	R4,R8
    01DBA 2859      OR	R5,R9
    01DBB A222      STD	Z+34,R2
    01DBC A233      STD	Z+35,R3
    01DBD A244      STD	Z+36,R4
    01DBE A255      STD	Z+37,R5
(2122) 		szbfat = fs->n_fatent * 4;						/* (Required FAT size) */
    01DBF E082      LDI	R24,2
    01DC0 E090      LDI	R25,0
    01DC1 9676      ADIW	R30,0x16
    01DC2 8100      LD	R16,Z
    01DC3 8111      LDD	R17,Z+1
    01DC4 8122      LDD	R18,Z+2
    01DC5 8133      LDD	R19,Z+3
    01DC6 938A      ST	-Y,R24
    01DC7 940E 4C36 CALL	lsl32
    01DC9 8F09      STD	Y+25,R16
    01DCA 8F1A      STD	Y+26,R17
    01DCB 8F2B      STD	Y+27,R18
    01DCC 8F3C      STD	Y+28,R19
(2123) 	} else {
    01DCD C06A      RJMP	0x1E38
(2124) 		if (!fs->n_rootdir)	return FR_NO_FILESYSTEM;	/* (BPB_RootEntCnt must not be 0) */
    01DCE A1ED      LDD	R30,Y+37
    01DCF A1FE      LDD	R31,Y+38
    01DD0 8420      LDD	R2,Z+8
    01DD1 8431      LDD	R3,Z+9
    01DD2 2022      TST	R2
    01DD3 F421      BNE	0x1DD8
    01DD4 2033      TST	R3
    01DD5 F411      BNE	0x1DD8
    01DD6 E00D      LDI	R16,0xD
    01DD7 C1E8      RJMP	0x1FC0
(2125) 		fs->dirbase = fs->fatbase + fasize;				/* Root directory start sector */
    01DD8 802D      LDD	R2,Y+5
    01DD9 803E      LDD	R3,Y+6
    01DDA 804F      LDD	R4,Y+7
    01DDB 8458      LDD	R5,Y+8
    01DDC A1ED      LDD	R30,Y+37
    01DDD A1FE      LDD	R31,Y+38
    01DDE 8C66      LDD	R6,Z+30
    01DDF 8C77      LDD	R7,Z+31
    01DE0 A080      LDD	R8,Z+32
    01DE1 A091      LDD	R9,Z+33
    01DE2 0C62      ADD	R6,R2
    01DE3 1C73      ADC	R7,R3
    01DE4 1C84      ADC	R8,R4
    01DE5 1C95      ADC	R9,R5
    01DE6 A262      STD	Z+34,R6
    01DE7 A273      STD	Z+35,R7
    01DE8 A284      STD	Z+36,R8
    01DE9 A295      STD	Z+37,R9
(2126) 		szbfat = (fmt == FS_FAT16) ?					/* (Required FAT size) */
    01DEA 2D8C      MOV	R24,R12
    01DEB 3082      CPI	R24,2
    01DEC F471      BNE	0x1DFB
    01DED 9676      ADIW	R30,0x16
    01DEE 8020      LD	R2,Z
    01DEF 8031      LDD	R3,Z+1
    01DF0 8042      LDD	R4,Z+2
    01DF1 8053      LDD	R5,Z+3
    01DF2 0C22      LSL	R2
    01DF3 1C33      ROL	R3
    01DF4 1C44      ROL	R4
    01DF5 1C55      ROL	R5
    01DF6 8E2D      STD	Y+29,R2
    01DF7 8E3E      STD	Y+30,R3
    01DF8 8E4F      STD	Y+31,R4
    01DF9 A258      STD	Y+32,R5
    01DFA C035      RJMP	0x1E30
    01DFB A1ED      LDD	R30,Y+37
    01DFC A1FE      LDD	R31,Y+38
    01DFD 9676      ADIW	R30,0x16
    01DFE 8020      LD	R2,Z
    01DFF 8031      LDD	R3,Z+1
    01E00 8042      LDD	R4,Z+2
    01E01 8053      LDD	R5,Z+3
    01E02 A229      STD	Y+33,R2
    01E03 A23A      STD	Y+34,R3
    01E04 A24B      STD	Y+35,R4
    01E05 A25C      STD	Y+36,R5
    01E06 E041      LDI	R20,1
    01E07 E050      LDI	R21,0
    01E08 E060      LDI	R22,0
    01E09 E070      LDI	R23,0
    01E0A A029      LDD	R2,Y+33
    01E0B A03A      LDD	R3,Y+34
    01E0C A04B      LDD	R4,Y+35
    01E0D A05C      LDD	R5,Y+36
    01E0E 2224      AND	R2,R20
    01E0F 2235      AND	R3,R21
    01E10 2246      AND	R4,R22
    01E11 2257      AND	R5,R23
    01E12 A069      LDD	R6,Y+33
    01E13 A07A      LDD	R7,Y+34
    01E14 A08B      LDD	R8,Y+35
    01E15 A09C      LDD	R9,Y+36
    01E16 E043      LDI	R20,3
    01E17 E050      LDI	R21,0
    01E18 E060      LDI	R22,0
    01E19 E070      LDI	R23,0
    01E1A 929A      ST	-Y,R9
    01E1B 928A      ST	-Y,R8
    01E1C 927A      ST	-Y,R7
    01E1D 926A      ST	-Y,R6
    01E1E 018A      MOVW	R16,R20
    01E1F 019B      MOVW	R18,R22
    01E20 940E 4B57 CALL	empy32s|empy32u
    01E22 0138      MOVW	R6,R16
    01E23 0149      MOVW	R8,R18
    01E24 9496      LSR	R9
    01E25 9487      ROR	R8
    01E26 9477      ROR	R7
    01E27 9467      ROR	R6
    01E28 0C62      ADD	R6,R2
    01E29 1C73      ADC	R7,R3
    01E2A 1C84      ADC	R8,R4
    01E2B 1C95      ADC	R9,R5
    01E2C 8E6D      STD	Y+29,R6
    01E2D 8E7E      STD	Y+30,R7
    01E2E 8E8F      STD	Y+31,R8
    01E2F A298      STD	Y+32,R9
    01E30 8C2D      LDD	R2,Y+29
    01E31 8C3E      LDD	R3,Y+30
    01E32 8C4F      LDD	R4,Y+31
    01E33 A058      LDD	R5,Y+32
    01E34 8E29      STD	Y+25,R2
    01E35 8E3A      STD	Y+26,R3
    01E36 8E4B      STD	Y+27,R4
    01E37 8E5C      STD	Y+28,R5
(2127) 			fs->n_fatent * 2 : fs->n_fatent * 3 / 2 + (fs->n_fatent & 1);
(2128) 	}
(2129) 	if (fs->fsize < (szbfat + (SS(fs) - 1)) / SS(fs))	/* (BPB_FATSz must not be less than required) */
    01E38 EF4F      LDI	R20,0xFF
    01E39 E051      LDI	R21,1
    01E3A E060      LDI	R22,0
    01E3B E070      LDI	R23,0
    01E3C 8D09      LDD	R16,Y+25
    01E3D 8D1A      LDD	R17,Y+26
    01E3E 8D2B      LDD	R18,Y+27
    01E3F 8D3C      LDD	R19,Y+28
    01E40 0F04      ADD	R16,R20
    01E41 1F15      ADC	R17,R21
    01E42 1F26      ADC	R18,R22
    01E43 1F37      ADC	R19,R23
    01E44 E089      LDI	R24,0x9
    01E45 E090      LDI	R25,0
    01E46 938A      ST	-Y,R24
    01E47 940E 4C4F CALL	lsr32
    01E49 A1ED      LDD	R30,Y+37
    01E4A A1FE      LDD	R31,Y+38
    01E4B 8C22      LDD	R2,Z+26
    01E4C 8C33      LDD	R3,Z+27
    01E4D 8C44      LDD	R4,Z+28
    01E4E 8C55      LDD	R5,Z+29
    01E4F 1620      CP	R2,R16
    01E50 0631      CPC	R3,R17
    01E51 0642      CPC	R4,R18
    01E52 0653      CPC	R5,R19
    01E53 F410      BCC	0x1E56
(2130) 		return FR_NO_FILESYSTEM;
    01E54 E00D      LDI	R16,0xD
    01E55 C16A      RJMP	0x1FC0
(2131) 
(2132) #if !_FS_READONLY
(2133) 	/* Initialize cluster allocation information */
(2134) 	fs->free_clust = 0xFFFFFFFF;
    01E56 A1ED      LDD	R30,Y+37
    01E57 A1FE      LDD	R31,Y+38
    01E58 963E      ADIW	R30,0xE
    01E59 EF8F      LDI	R24,0xFF
    01E5A 8380      ST	Z,R24
    01E5B 8381      STD	Z+1,R24
    01E5C 8382      STD	Z+2,R24
    01E5D 8383      STD	Z+3,R24
(2135) 	fs->last_clust = 0;
    01E5E A1ED      LDD	R30,Y+37
    01E5F A1FE      LDD	R31,Y+38
    01E60 963A      ADIW	R30,0xA
    01E61 E080      LDI	R24,0
    01E62 8380      ST	Z,R24
    01E63 8381      STD	Z+1,R24
    01E64 8382      STD	Z+2,R24
    01E65 8383      STD	Z+3,R24
(2136) 
(2137) 	/* Get fsinfo if available */
(2138) 	if (fmt == FS_FAT32) {
    01E66 2D8C      MOV	R24,R12
    01E67 3083      CPI	R24,3
    01E68 F009      BEQ	0x1E6A
    01E69 C13C      RJMP	0x1FA6
(2139) 	 	fs->fsi_flag = 0;
    01E6A 2422      CLR	R2
    01E6B A1ED      LDD	R30,Y+37
    01E6C A1FE      LDD	R31,Y+38
    01E6D 8225      STD	Z+5,R2
(2140) 		fs->fsi_sector = bsect + LD_WORD(fs->win+BPB_FSInfo);
    01E6E 5AE2      SUBI	R30,0xA2
    01E6F 4FFF      SBCI	R31,0xFF
    01E70 8020      LD	R2,Z
    01E71 55EE      SUBI	R30,0x5E
    01E72 40F0      SBCI	R31,0
    01E73 2433      CLR	R3
    01E74 5AE1      SUBI	R30,0xA1
    01E75 4FFF      SBCI	R31,0xFF
    01E76 8040      LD	R4,Z
    01E77 2455      CLR	R5
    01E78 2C54      MOV	R5,R4
    01E79 2444      CLR	R4
    01E7A 2842      OR	R4,R2
    01E7B 2853      OR	R5,R3
    01E7C 0112      MOVW	R2,R4
    01E7D 2444      CLR	R4
    01E7E 2455      CLR	R5
    01E7F 8869      LDD	R6,Y+17
    01E80 887A      LDD	R7,Y+18
    01E81 888B      LDD	R8,Y+19
    01E82 889C      LDD	R9,Y+20
    01E83 0C62      ADD	R6,R2
    01E84 1C73      ADC	R7,R3
    01E85 1C84      ADC	R8,R4
    01E86 1C95      ADC	R9,R5
    01E87 A1ED      LDD	R30,Y+37
    01E88 A1FE      LDD	R31,Y+38
    01E89 8A62      STD	Z+18,R6
    01E8A 8A73      STD	Z+19,R7
    01E8B 8A84      STD	Z+20,R8
    01E8C 8A95      STD	Z+21,R9
(2141) 		if (disk_read(fs->drv, fs->win, fs->fsi_sector, 1) == RES_OK &&
    01E8D E081      LDI	R24,1
    01E8E 838C      STD	Y+4,R24
    01E8F 8822      LDD	R2,Z+18
    01E90 8833      LDD	R3,Z+19
    01E91 8844      LDD	R4,Z+20
    01E92 8855      LDD	R5,Z+21
    01E93 8228      ST	Y,R2
    01E94 8239      STD	Y+1,R3
    01E95 824A      STD	Y+2,R4
    01E96 825B      STD	Y+3,R5
    01E97 019F      MOVW	R18,R30
    01E98 5D22      SUBI	R18,0xD2
    01E99 4F3F      SBCI	R19,0xFF
    01E9A 8101      LDD	R16,Z+1
    01E9B 940E 0C12 CALL	_disk_read
    01E9D 2EE0      MOV	R14,R16
    01E9E 2300      TST	R16
    01E9F F009      BEQ	0x1EA1
    01EA0 C105      RJMP	0x1FA6
    01EA1 A1ED      LDD	R30,Y+37
    01EA2 A1FE      LDD	R31,Y+38
    01EA3 5DE4      SUBI	R30,0xD4
    01EA4 4FFD      SBCI	R31,0xFD
    01EA5 8020      LD	R2,Z
    01EA6 52EC      SUBI	R30,0x2C
    01EA7 40F2      SBCI	R31,2
    01EA8 2433      CLR	R3
    01EA9 5DE3      SUBI	R30,0xD3
    01EAA 4FFD      SBCI	R31,0xFD
    01EAB 8180      LD	R24,Z
    01EAC 52ED      SUBI	R30,0x2D
    01EAD 40F2      SBCI	R31,2
    01EAE 2799      CLR	R25
    01EAF 2F98      MOV	R25,R24
    01EB0 2788      CLR	R24
    01EB1 2982      OR	R24,R2
    01EB2 2993      OR	R25,R3
    01EB3 3585      CPI	R24,0x55
    01EB4 EAAA      LDI	R26,0xAA
    01EB5 079A      CPC	R25,R26
    01EB6 F009      BEQ	0x1EB8
    01EB7 C0EE      RJMP	0x1FA6
    01EB8 E188      LDI	R24,0x18
    01EB9 E090      LDI	R25,0
    01EBA A901      LDD	R16,Z+49
    01EBB 2711      CLR	R17
    01EBC 2722      CLR	R18
    01EBD 2733      CLR	R19
    01EBE 938A      ST	-Y,R24
    01EBF 940E 4C36 CALL	lsl32
    01EC1 0118      MOVW	R2,R16
    01EC2 0129      MOVW	R4,R18
    01EC3 A1ED      LDD	R30,Y+37
    01EC4 A1FE      LDD	R31,Y+38
    01EC5 A860      LDD	R6,Z+48
    01EC6 2477      CLR	R7
    01EC7 2488      CLR	R8
    01EC8 2499      CLR	R9
    01EC9 0143      MOVW	R8,R6
    01ECA 2466      CLR	R6
    01ECB 2477      CLR	R7
    01ECC 2826      OR	R2,R6
    01ECD 2837      OR	R3,R7
    01ECE 2848      OR	R4,R8
    01ECF 2859      OR	R5,R9
    01ED0 A467      LDD	R6,Z+47
    01ED1 2477      CLR	R7
    01ED2 2C76      MOV	R7,R6
    01ED3 2466      CLR	R6
    01ED4 2488      CLR	R8
    01ED5 2499      CLR	R9
    01ED6 2826      OR	R2,R6
    01ED7 2837      OR	R3,R7
    01ED8 2848      OR	R4,R8
    01ED9 2859      OR	R5,R9
    01EDA A466      LDD	R6,Z+46
    01EDB 2477      CLR	R7
    01EDC 2488      CLR	R8
    01EDD 2499      CLR	R9
    01EDE 2826      OR	R2,R6
    01EDF 2837      OR	R3,R7
    01EE0 2848      OR	R4,R8
    01EE1 2859      OR	R5,R9
    01EE2 E542      LDI	R20,0x52
    01EE3 E552      LDI	R21,0x52
    01EE4 E661      LDI	R22,0x61
    01EE5 E471      LDI	R23,0x41
    01EE6 1624      CP	R2,R20
    01EE7 0635      CPC	R3,R21
    01EE8 0646      CPC	R4,R22
    01EE9 0657      CPC	R5,R23
    01EEA F009      BEQ	0x1EEC
    01EEB C0BA      RJMP	0x1FA6
    01EEC E188      LDI	R24,0x18
    01EED E090      LDI	R25,0
    01EEE 5EEB      SUBI	R30,0xEB
    01EEF 4FFD      SBCI	R31,0xFD
    01EF0 8100      LD	R16,Z
    01EF1 2711      CLR	R17
    01EF2 2722      CLR	R18
    01EF3 2733      CLR	R19
    01EF4 938A      ST	-Y,R24
    01EF5 940E 4C36 CALL	lsl32
    01EF7 0118      MOVW	R2,R16
    01EF8 0129      MOVW	R4,R18
    01EF9 A1ED      LDD	R30,Y+37
    01EFA A1FE      LDD	R31,Y+38
    01EFB 5EEC      SUBI	R30,0xEC
    01EFC 4FFD      SBCI	R31,0xFD
    01EFD 8060      LD	R6,Z
    01EFE 51E4      SUBI	R30,0x14
    01EFF 40F2      SBCI	R31,2
    01F00 2477      CLR	R7
    01F01 2488      CLR	R8
    01F02 2499      CLR	R9
    01F03 0143      MOVW	R8,R6
    01F04 2466      CLR	R6
    01F05 2477      CLR	R7
    01F06 2826      OR	R2,R6
    01F07 2837      OR	R3,R7
    01F08 2848      OR	R4,R8
    01F09 2859      OR	R5,R9
    01F0A 5EED      SUBI	R30,0xED
    01F0B 4FFD      SBCI	R31,0xFD
    01F0C 8060      LD	R6,Z
    01F0D 51E3      SUBI	R30,0x13
    01F0E 40F2      SBCI	R31,2
    01F0F 2477      CLR	R7
    01F10 2C76      MOV	R7,R6
    01F11 2466      CLR	R6
    01F12 2488      CLR	R8
    01F13 2499      CLR	R9
    01F14 2826      OR	R2,R6
    01F15 2837      OR	R3,R7
    01F16 2848      OR	R4,R8
    01F17 2859      OR	R5,R9
    01F18 5EEE      SUBI	R30,0xEE
    01F19 4FFD      SBCI	R31,0xFD
    01F1A 8060      LD	R6,Z
    01F1B 51E2      SUBI	R30,0x12
    01F1C 40F2      SBCI	R31,2
    01F1D 2477      CLR	R7
    01F1E 2488      CLR	R8
    01F1F 2499      CLR	R9
    01F20 2826      OR	R2,R6
    01F21 2837      OR	R3,R7
    01F22 2848      OR	R4,R8
    01F23 2859      OR	R5,R9
    01F24 E742      LDI	R20,0x72
    01F25 E752      LDI	R21,0x72
    01F26 E461      LDI	R22,0x41
    01F27 E671      LDI	R23,0x61
    01F28 1624      CP	R2,R20
    01F29 0635      CPC	R3,R21
    01F2A 0646      CPC	R4,R22
    01F2B 0657      CPC	R5,R23
    01F2C F009      BEQ	0x1F2E
    01F2D C078      RJMP	0x1FA6
(2142) 			LD_WORD(fs->win+BS_55AA) == 0xAA55 &&
(2143) 			LD_DWORD(fs->win+FSI_LeadSig) == 0x41615252 &&
(2144) 			LD_DWORD(fs->win+FSI_StrucSig) == 0x61417272) {
(2145) 				fs->last_clust = LD_DWORD(fs->win+FSI_Nxt_Free);
    01F2E E188      LDI	R24,0x18
    01F2F E090      LDI	R25,0
    01F30 5EE3      SUBI	R30,0xE3
    01F31 4FFD      SBCI	R31,0xFD
    01F32 8100      LD	R16,Z
    01F33 2711      CLR	R17
    01F34 2722      CLR	R18
    01F35 2733      CLR	R19
    01F36 938A      ST	-Y,R24
    01F37 940E 4C36 CALL	lsl32
    01F39 0118      MOVW	R2,R16
    01F3A 0129      MOVW	R4,R18
    01F3B A1ED      LDD	R30,Y+37
    01F3C A1FE      LDD	R31,Y+38
    01F3D 5EE4      SUBI	R30,0xE4
    01F3E 4FFD      SBCI	R31,0xFD
    01F3F 8060      LD	R6,Z
    01F40 51EC      SUBI	R30,0x1C
    01F41 40F2      SBCI	R31,2
    01F42 2477      CLR	R7
    01F43 2488      CLR	R8
    01F44 2499      CLR	R9
    01F45 0143      MOVW	R8,R6
    01F46 2466      CLR	R6
    01F47 2477      CLR	R7
    01F48 2826      OR	R2,R6
    01F49 2837      OR	R3,R7
    01F4A 2848      OR	R4,R8
    01F4B 2859      OR	R5,R9
    01F4C 5EE5      SUBI	R30,0xE5
    01F4D 4FFD      SBCI	R31,0xFD
    01F4E 8060      LD	R6,Z
    01F4F 51EB      SUBI	R30,0x1B
    01F50 40F2      SBCI	R31,2
    01F51 2477      CLR	R7
    01F52 2C76      MOV	R7,R6
    01F53 2466      CLR	R6
    01F54 2488      CLR	R8
    01F55 2499      CLR	R9
    01F56 2826      OR	R2,R6
    01F57 2837      OR	R3,R7
    01F58 2848      OR	R4,R8
    01F59 2859      OR	R5,R9
    01F5A 5EE6      SUBI	R30,0xE6
    01F5B 4FFD      SBCI	R31,0xFD
    01F5C 8060      LD	R6,Z
    01F5D 51EA      SUBI	R30,0x1A
    01F5E 40F2      SBCI	R31,2
    01F5F 2477      CLR	R7
    01F60 2488      CLR	R8
    01F61 2499      CLR	R9
    01F62 2826      OR	R2,R6
    01F63 2837      OR	R3,R7
    01F64 2848      OR	R4,R8
    01F65 2859      OR	R5,R9
    01F66 8622      STD	Z+10,R2
    01F67 8633      STD	Z+11,R3
    01F68 8644      STD	Z+12,R4
    01F69 8655      STD	Z+13,R5
(2146) 				fs->free_clust = LD_DWORD(fs->win+FSI_Free_Count);
    01F6A E188      LDI	R24,0x18
    01F6B E090      LDI	R25,0
    01F6C 5EE7      SUBI	R30,0xE7
    01F6D 4FFD      SBCI	R31,0xFD
    01F6E 8100      LD	R16,Z
    01F6F 2711      CLR	R17
    01F70 2722      CLR	R18
    01F71 2733      CLR	R19
    01F72 938A      ST	-Y,R24
    01F73 940E 4C36 CALL	lsl32
    01F75 0118      MOVW	R2,R16
    01F76 0129      MOVW	R4,R18
    01F77 A1ED      LDD	R30,Y+37
    01F78 A1FE      LDD	R31,Y+38
    01F79 5EE8      SUBI	R30,0xE8
    01F7A 4FFD      SBCI	R31,0xFD
    01F7B 8060      LD	R6,Z
    01F7C 51E8      SUBI	R30,0x18
    01F7D 40F2      SBCI	R31,2
    01F7E 2477      CLR	R7
    01F7F 2488      CLR	R8
    01F80 2499      CLR	R9
    01F81 0143      MOVW	R8,R6
    01F82 2466      CLR	R6
    01F83 2477      CLR	R7
    01F84 2826      OR	R2,R6
    01F85 2837      OR	R3,R7
    01F86 2848      OR	R4,R8
    01F87 2859      OR	R5,R9
    01F88 5EE9      SUBI	R30,0xE9
    01F89 4FFD      SBCI	R31,0xFD
    01F8A 8060      LD	R6,Z
    01F8B 51E7      SUBI	R30,0x17
    01F8C 40F2      SBCI	R31,2
    01F8D 2477      CLR	R7
    01F8E 2C76      MOV	R7,R6
    01F8F 2466      CLR	R6
    01F90 2488      CLR	R8
    01F91 2499      CLR	R9
    01F92 2826      OR	R2,R6
    01F93 2837      OR	R3,R7
    01F94 2848      OR	R4,R8
    01F95 2859      OR	R5,R9
    01F96 5EEA      SUBI	R30,0xEA
    01F97 4FFD      SBCI	R31,0xFD
    01F98 8060      LD	R6,Z
    01F99 51E6      SUBI	R30,0x16
    01F9A 40F2      SBCI	R31,2
    01F9B 2477      CLR	R7
    01F9C 2488      CLR	R8
    01F9D 2499      CLR	R9
    01F9E 2826      OR	R2,R6
    01F9F 2837      OR	R3,R7
    01FA0 2848      OR	R4,R8
    01FA1 2859      OR	R5,R9
    01FA2 8626      STD	Z+14,R2
    01FA3 8637      STD	Z+15,R3
    01FA4 8A40      STD	Z+16,R4
    01FA5 8A51      STD	Z+17,R5
(2147) 		}
(2148) 	}
(2149) #endif
(2150) 	fs->fs_type = fmt;		/* FAT sub-type */
    01FA6 A1ED      LDD	R30,Y+37
    01FA7 A1FE      LDD	R31,Y+38
    01FA8 82C0      ST	Z,R12
(2151) 	fs->id = ++Fsid;		/* File system mount ID */
    01FA9 9180 08F3 LDS	R24,ff.c:Fsid
    01FAB 9190 08F4 LDS	R25,ff.c:Fsid+1
    01FAD 9601      ADIW	R24,1
    01FAE 016C      MOVW	R12,R24
    01FAF 92D0 08F4 STS	ff.c:Fsid+1,R13
    01FB1 92C0 08F3 STS	ff.c:Fsid,R12
    01FB3 82D7      STD	Z+7,R13
    01FB4 82C6      STD	Z+6,R12
(2152) 	fs->winsect = 0;		/* Invalidate sector cache */
    01FB5 96BA      ADIW	R30,0x2A
    01FB6 E080      LDI	R24,0
    01FB7 8380      ST	Z,R24
    01FB8 8381      STD	Z+1,R24
    01FB9 8382      STD	Z+2,R24
    01FBA 8383      STD	Z+3,R24
(2153) 	fs->wflag = 0;
    01FBB 2422      CLR	R2
    01FBC A1ED      LDD	R30,Y+37
    01FBD A1FE      LDD	R31,Y+38
    01FBE 8224      STD	Z+4,R2
(2154) #if _FS_RPATH
(2155) 	fs->cdir = 0;			/* Current directory (root dir) */
(2156) #endif
(2157) #if _FS_SHARE				/* Clear file lock semaphores */
(2158) 	clear_lock(fs);
(2159) #endif
(2160) 
(2161) 	return FR_OK;
    01FBF 2700      CLR	R16
    01FC0 96A7      ADIW	R28,0x27
    01FC1 940E 4BA0 CALL	pop_xgsetF0FC
    01FC3 9622      ADIW	R28,2
    01FC4 9508      RET
ff.c:validate:
  id                   --> R10
  fs                   --> R20
    01FC5 940E 4BB6 CALL	push_xgset300C
    01FC7 0159      MOVW	R10,R18
    01FC8 01A8      MOVW	R20,R16
(2162) }
(2163) 
(2164) 
(2165) 
(2166) 
(2167) /*-----------------------------------------------------------------------*/
(2168) /* Check if the file/dir object is valid or not                          */
(2169) /*-----------------------------------------------------------------------*/
(2170) 
(2171) static
(2172) FRESULT validate (	/* FR_OK(0): The object is valid, !=0: Invalid */
(2173) 	FATFS *fs,		/* Pointer to the file system object */
(2174) 	WORD id			/* Member id of the target object to be checked */
(2175) )
(2176) {
(2177) 	if (!fs || !fs->fs_type || fs->id != id)
    01FC9 3040      CPI	R20,0
    01FCA 0745      CPC	R20,R21
    01FCB F049      BEQ	0x1FD5
    01FCC 01FA      MOVW	R30,R20
    01FCD 8020      LD	R2,Z
    01FCE 2022      TST	R2
    01FCF F029      BEQ	0x1FD5
    01FD0 8026      LDD	R2,Z+6
    01FD1 8037      LDD	R3,Z+7
    01FD2 142A      CP	R2,R10
    01FD3 043B      CPC	R3,R11
    01FD4 F011      BEQ	0x1FD7
(2178) 		return FR_INVALID_OBJECT;
    01FD5 E009      LDI	R16,0x9
    01FD6 C009      RJMP	0x1FE0
(2179) 
(2180) 	ENTER_FF(fs);		/* Lock file system */
(2181) 
(2182) 	if (disk_status(fs->drv) & STA_NOINIT)
    01FD7 01FA      MOVW	R30,R20
    01FD8 8101      LDD	R16,Z+1
    01FD9 940E 0C0C CALL	_disk_status
    01FDB FF00      SBRS	R16,0
    01FDC C002      RJMP	0x1FDF
(2183) 		return FR_NOT_READY;
    01FDD E003      LDI	R16,3
    01FDE C001      RJMP	0x1FE0
(2184) 
(2185) 	return FR_OK;
    01FDF 2700      CLR	R16
    01FE0 940C 4BBB JMP	pop_xgset300C
_f_mount:
  rfs                  --> R10
  fs                   --> R18
  vol                  --> R16
    01FE2 92AA      ST	-Y,R10
    01FE3 92BA      ST	-Y,R11
(2186) }
(2187) 
(2188) 
(2189) 
(2190) 
(2191) /*--------------------------------------------------------------------------
(2192) 
(2193)    Public Functions
(2194) 
(2195) --------------------------------------------------------------------------*/
(2196) 
(2197) 
(2198) 
(2199) /*-----------------------------------------------------------------------*/
(2200) /* Mount/Unmount a Logical Drive                                         */
(2201) /*-----------------------------------------------------------------------*/
(2202) 
(2203) FRESULT f_mount (
(2204) 	BYTE vol,		/* Logical drive number to be mounted/unmounted */
(2205) 	FATFS *fs		/* Pointer to new file system object (NULL for unmount)*/
(2206) )
(2207) {
(2208) 	FATFS *rfs;
(2209) 
(2210) 
(2211) 	if (vol >= _VOLUMES)		/* Check if the drive number is valid */
    01FE4 3001      CPI	R16,1
    01FE5 F010      BCS	0x1FE8
(2212) 		return FR_INVALID_DRIVE;
    01FE6 E00B      LDI	R16,0xB
    01FE7 C022      RJMP	0x200A
(2213) 	rfs = FatFs[vol];			/* Get current fs object */
    01FE8 EF85      LDI	R24,0xF5
    01FE9 E098      LDI	R25,0x8
    01FEA 2FE0      MOV	R30,R16
    01FEB 27FF      CLR	R31
    01FEC 0FEE      LSL	R30
    01FED 1FFF      ROL	R31
    01FEE 0FE8      ADD	R30,R24
    01FEF 1FF9      ADC	R31,R25
    01FF0 80A0      LD	R10,Z
    01FF1 80B1      LDD	R11,Z+1
(2214) 
(2215) 	if (rfs) {
    01FF2 20AA      TST	R10
    01FF3 F411      BNE	0x1FF6
    01FF4 20BB      TST	R11
    01FF5 F019      BEQ	0x1FF9
(2216) #if _FS_SHARE
(2217) 		clear_lock(rfs);
(2218) #endif
(2219) #if _FS_REENTRANT				/* Discard sync object of the current volume */
(2220) 		if (!ff_del_syncobj(rfs->sobj)) return FR_INT_ERR;
(2221) #endif
(2222) 		rfs->fs_type = 0;		/* Clear old fs object */
    01FF6 2422      CLR	R2
    01FF7 01F5      MOVW	R30,R10
    01FF8 8220      ST	Z,R2
(2223) 	}
(2224) 
(2225) 	if (fs) {
    01FF9 3020      CPI	R18,0
    01FFA 0723      CPC	R18,R19
    01FFB F019      BEQ	0x1FFF
(2226) 		fs->fs_type = 0;		/* Clear new fs object */
    01FFC 2422      CLR	R2
    01FFD 01F9      MOVW	R30,R18
    01FFE 8220      ST	Z,R2
(2227) #if _FS_REENTRANT				/* Create sync object for the new volume */
(2228) 		if (!ff_cre_syncobj(vol, &fs->sobj)) return FR_INT_ERR;
(2229) #endif
(2230) 	}
(2231) 	FatFs[vol] = fs;			/* Register new fs object */
    01FFF EF85      LDI	R24,0xF5
    02000 E098      LDI	R25,0x8
    02001 2FE0      MOV	R30,R16
    02002 27FF      CLR	R31
    02003 0FEE      LSL	R30
    02004 1FFF      ROL	R31
    02005 0FE8      ADD	R30,R24
    02006 1FF9      ADC	R31,R25
    02007 8331      STD	Z+1,R19
    02008 8320      ST	Z,R18
(2232) 
(2233) 	return FR_OK;
    02009 2700      CLR	R16
    0200A 90B9      LD	R11,Y+
    0200B 90A9      LD	R10,Y+
    0200C 9508      RET
_f_open:
  cl                   --> Y,+40
  dw                   --> Y,+36
  sfn                  --> Y,+24
  dj                   --> Y,+2
  res                  --> R10
  dir                  --> R14
  mode                 --> Y,+58
  path                 --> Y,+56
  fp                   --> Y,+54
    0200D 940E 4A66 CALL	push_arg4
    0200F 940E 4BAB CALL	push_xgsetF0FC
    02011 97AC      SBIW	R28,0x2C
(2234) }
(2235) 
(2236) 
(2237) 
(2238) 
(2239) /*-----------------------------------------------------------------------*/
(2240) /* Open or Create a File                                                 */
(2241) /*-----------------------------------------------------------------------*/
(2242) 
(2243) FRESULT f_open (
(2244) 	FIL *fp,			/* Pointer to the blank file object */
(2245) 	const TCHAR *path,	/* Pointer to the file name */
(2246) 	BYTE mode			/* Access mode and file open mode flags */
(2247) )
(2248) {
(2249) 	FRESULT res;
(2250) 	DIR dj;
(2251) 	BYTE *dir;
(2252) 	DEF_NAMEBUF;
(2253) 
(2254) 
(2255) 	fp->fs = 0;			/* Clear file object */
    02012 2422      CLR	R2
    02013 2433      CLR	R3
    02014 A9EE      LDD	R30,Y+54
    02015 A9FF      LDD	R31,Y+55
    02016 8231      STD	Z+1,R3
    02017 8220      ST	Z,R2
(2256) 
(2257) #if !_FS_READONLY
(2258) 	mode &= FA_READ | FA_WRITE | FA_CREATE_ALWAYS | FA_OPEN_ALWAYS | FA_CREATE_NEW;
    02018 AD8A      LDD	R24,Y+58
    02019 718F      ANDI	R24,0x1F
    0201A AF8A      STD	Y+58,R24
(2259) 	res = chk_mounted(&path, &dj.fs, (BYTE)(mode & ~FA_READ));
    0201B 2799      CLR	R25
    0201C 7F8E      ANDI	R24,0xFE
    0201D 8388      ST	Y,R24
    0201E 019E      MOVW	R18,R28
    0201F 5F2E      SUBI	R18,0xFE
    02020 4F3F      SBCI	R19,0xFF
    02021 018E      MOVW	R16,R28
    02022 5C08      SUBI	R16,0xC8
    02023 4F1F      SBCI	R17,0xFF
    02024 DAA6      RCALL	ff.c:chk_mounted
    02025 2EA0      MOV	R10,R16
(2260) #else
(2261) 	mode &= FA_READ;
(2262) 	res = chk_mounted(&path, &dj.fs, 0);
(2263) #endif
(2264) 	INIT_BUF(dj);
    02026 01CE      MOVW	R24,R28
    02027 9648      ADIW	R24,0x18
    02028 8B9F      STD	Y+23,R25
    02029 8B8E      STD	Y+22,R24
(2265) 	if (res == FR_OK)
    0202A 2300      TST	R16
    0202B F439      BNE	0x2033
(2266) 		res = follow_path(&dj, path);	/* Follow the file path */
    0202C AD28      LDD	R18,Y+56
    0202D AD39      LDD	R19,Y+57
    0202E 018E      MOVW	R16,R28
    0202F 5F0E      SUBI	R16,0xFE
    02030 4F1F      SBCI	R17,0xFF
    02031 D94D      RCALL	ff.c:follow_path
    02032 2EA0      MOV	R10,R16
(2267) 	dir = dj.dir;
    02033 88EC      LDD	R14,Y+20
    02034 88FD      LDD	R15,Y+21
(2268) 
(2269) #if !_FS_READONLY	/* R/W configuration */
(2270) 	if (res == FR_OK) {
    02035 20AA      TST	R10
    02036 F431      BNE	0x203D
(2271) 		if (!dir)	/* Current dir itself */
    02037 20EE      TST	R14
    02038 F421      BNE	0x203D
    02039 20FF      TST	R15
    0203A F411      BNE	0x203D
(2272) 			res = FR_INVALID_NAME;
    0203B E086      LDI	R24,6
    0203C 2EA8      MOV	R10,R24
(2273) #if _FS_SHARE
(2274) 		else
(2275) 			res = chk_lock(&dj, (mode & ~FA_READ) ? 1 : 0);
(2276) #endif
(2277) 	}
(2278) 	/* Create or Open a file */
(2279) 	if (mode & (FA_CREATE_ALWAYS | FA_OPEN_ALWAYS | FA_CREATE_NEW)) {
    0203D AD8A      LDD	R24,Y+58
    0203E 718C      ANDI	R24,0x1C
    0203F F409      BNE	0x2041
    02040 C0C0      RJMP	0x2101
(2280) 		DWORD dw, cl;
(2281) 
(2282) 		if (res != FR_OK) {					/* No file, create new */
    02041 20AA      TST	R10
    02042 F081      BEQ	0x2053
(2283) 			if (res == FR_NO_FILE)			/* There is no file to open, create a new entry */
    02043 2D8A      MOV	R24,R10
    02044 3084      CPI	R24,4
    02045 F439      BNE	0x204D
(2284) #if _FS_SHARE
(2285) 				res = enq_lock() ? dir_register(&dj) : FR_TOO_MANY_OPEN_FILES;
(2286) #else
(2287) 				res = dir_register(&dj);
    02046 018E      MOVW	R16,R28
    02047 5F0E      SUBI	R16,0xFE
    02048 4F1F      SBCI	R17,0xFF
    02049 940E 1771 CALL	ff.c:dir_register
    0204B 2EC0      MOV	R12,R16
    0204C 2CAC      MOV	R10,R12
(2288) #endif
(2289) 			mode |= FA_CREATE_ALWAYS;		/* File is created */
    0204D AD8A      LDD	R24,Y+58
    0204E 6088      ORI	R24,0x8
    0204F AF8A      STD	Y+58,R24
(2290) 			dir = dj.dir;					/* New entry */
    02050 88EC      LDD	R14,Y+20
    02051 88FD      LDD	R15,Y+21
(2291) 		}
    02052 C00C      RJMP	0x205F
(2292) 		else {								/* Any object is already existing */
(2293) 			if (dir[DIR_Attr] & (AM_RDO | AM_DIR)) {	/* Cannot overwrite it (R/O or DIR) */
    02053 01F7      MOVW	R30,R14
    02054 8583      LDD	R24,Z+11
    02055 7181      ANDI	R24,0x11
    02056 F019      BEQ	0x205A
(2294) 				res = FR_DENIED;
    02057 E087      LDI	R24,7
    02058 2EA8      MOV	R10,R24
(2295) 			} else {
    02059 C005      RJMP	0x205F
(2296) 				if (mode & FA_CREATE_NEW)	/* Cannot create as new file */
    0205A AC0A      LDD	R0,Y+58
    0205B FE02      SBRS	R0,2
    0205C C002      RJMP	0x205F
(2297) 					res = FR_EXIST;
    0205D E088      LDI	R24,0x8
    0205E 2EA8      MOV	R10,R24
(2298) 			}
(2299) 		}
(2300) 		if (res == FR_OK && (mode & FA_CREATE_ALWAYS)) {	/* Truncate it if overwrite mode */
    0205F 20AA      TST	R10
    02060 F009      BEQ	0x2062
    02061 C0B1      RJMP	0x2113
    02062 AC0A      LDD	R0,Y+58
    02063 FE03      SBRS	R0,3
    02064 C0AE      RJMP	0x2113
(2301) 			dw = get_fattime();					/* Created time */
    02065 940E 0C4F CALL	_get_fattime
    02067 A30C      STD	Y+36,R16
    02068 A31D      STD	Y+37,R17
    02069 A32E      STD	Y+38,R18
    0206A A33F      STD	Y+39,R19
(2302) 			ST_DWORD(dir+DIR_CrtTime, dw);
    0206B A02C      LDD	R2,Y+36
    0206C A03D      LDD	R3,Y+37
    0206D A04E      LDD	R4,Y+38
    0206E A05F      LDD	R5,Y+39
    0206F 01F7      MOVW	R30,R14
    02070 8626      STD	Z+14,R2
    02071 2C23      MOV	R2,R3
    02072 2433      CLR	R3
    02073 963F      ADIW	R30,0xF
    02074 8220      ST	Z,R2
    02075 A02C      LDD	R2,Y+36
    02076 A03D      LDD	R3,Y+37
    02077 A04E      LDD	R4,Y+38
    02078 A05F      LDD	R5,Y+39
    02079 0112      MOVW	R2,R4
    0207A 2444      CLR	R4
    0207B 2455      CLR	R5
    0207C 01F7      MOVW	R30,R14
    0207D 9670      ADIW	R30,0x10
    0207E 8220      ST	Z,R2
    0207F E188      LDI	R24,0x18
    02080 E090      LDI	R25,0
    02081 A10C      LDD	R16,Y+36
    02082 A11D      LDD	R17,Y+37
    02083 A12E      LDD	R18,Y+38
    02084 A13F      LDD	R19,Y+39
    02085 938A      ST	-Y,R24
    02086 940E 4C4F CALL	lsr32
    02088 01F7      MOVW	R30,R14
    02089 8B01      STD	Z+17,R16
(2303) 			dir[DIR_Attr] = 0;					/* Reset attribute */
    0208A 2422      CLR	R2
    0208B 8623      STD	Z+11,R2
(2304) 			ST_DWORD(dir+DIR_FileSize, 0);		/* size = 0 */
    0208C 8E24      STD	Z+28,R2
    0208D 8E25      STD	Z+29,R2
    0208E 8E26      STD	Z+30,R2
    0208F 8E27      STD	Z+31,R2
(2305) 			cl = LD_CLUST(dir);					/* Get start cluster */
    02090 8C22      LDD	R2,Z+26
    02091 2433      CLR	R3
    02092 8C43      LDD	R4,Z+27
    02093 2455      CLR	R5
    02094 2C54      MOV	R5,R4
    02095 2444      CLR	R4
    02096 2842      OR	R4,R2
    02097 2853      OR	R5,R3
    02098 0112      MOVW	R2,R4
    02099 2444      CLR	R4
    0209A 2455      CLR	R5
    0209B 8864      LDD	R6,Z+20
    0209C 2477      CLR	R7
    0209D 9675      ADIW	R30,0x15
    0209E 8080      LD	R8,Z
    0209F 2499      CLR	R9
    020A0 2C98      MOV	R9,R8
    020A1 2488      CLR	R8
    020A2 2886      OR	R8,R6
    020A3 2897      OR	R9,R7
    020A4 0134      MOVW	R6,R8
    020A5 2488      CLR	R8
    020A6 2499      CLR	R9
    020A7 0143      MOVW	R8,R6
    020A8 2466      CLR	R6
    020A9 2477      CLR	R7
    020AA 2862      OR	R6,R2
    020AB 2873      OR	R7,R3
    020AC 2884      OR	R8,R4
    020AD 2895      OR	R9,R5
    020AE A668      STD	Y+40,R6
    020AF A679      STD	Y+41,R7
    020B0 A68A      STD	Y+42,R8
    020B1 A69B      STD	Y+43,R9
(2306) 			ST_CLUST(dir, 0);					/* cluster = 0 */
    020B2 2422      CLR	R2
    020B3 01F7      MOVW	R30,R14
    020B4 8E22      STD	Z+26,R2
    020B5 8E23      STD	Z+27,R2
    020B6 8A24      STD	Z+20,R2
    020B7 8A25      STD	Z+21,R2
(2307) 			dj.fs->wflag = 1;
    020B8 E081      LDI	R24,1
    020B9 81EA      LDD	R30,Y+2
    020BA 81FB      LDD	R31,Y+3
    020BB 9634      ADIW	R30,4
    020BC 8380      ST	Z,R24
(2308) 			if (cl) {							/* Remove the cluster chain if exist */
    020BD A428      LDD	R2,Y+40
    020BE A439      LDD	R3,Y+41
    020BF A44A      LDD	R4,Y+42
    020C0 A45B      LDD	R5,Y+43
    020C1 9488      BCLR	0
    020C2 2022      TST	R2
    020C3 0432      CPC	R3,R2
    020C4 0442      CPC	R4,R2
    020C5 0452      CPC	R5,R2
    020C6 F409      BNE	0x20C8
    020C7 C04B      RJMP	0x2113
(2309) 				dw = dj.fs->winsect;
    020C8 81EA      LDD	R30,Y+2
    020C9 81FB      LDD	R31,Y+3
    020CA A422      LDD	R2,Z+42
    020CB A433      LDD	R3,Z+43
    020CC A444      LDD	R4,Z+44
    020CD A455      LDD	R5,Z+45
    020CE A22C      STD	Y+36,R2
    020CF A23D      STD	Y+37,R3
    020D0 A24E      STD	Y+38,R4
    020D1 A25F      STD	Y+39,R5
(2310) 				res = remove_chain(dj.fs, cl);
    020D2 A428      LDD	R2,Y+40
    020D3 A439      LDD	R3,Y+41
    020D4 A44A      LDD	R4,Y+42
    020D5 A45B      LDD	R5,Y+43
    020D6 8248      ST	Y,R4
    020D7 8259      STD	Y+1,R5
    020D8 0191      MOVW	R18,R2
    020D9 810A      LDD	R16,Y+2
    020DA 811B      LDD	R17,Y+3
    020DB 940E 1185 CALL	ff.c:remove_chain
    020DD 2EC0      MOV	R12,R16
    020DE 2CAC      MOV	R10,R12
(2311) 				if (res == FR_OK) {
    020DF 2300      TST	R16
    020E0 F591      BNE	0x2113
(2312) 					dj.fs->last_clust = cl - 1;	/* Reuse the cluster hole */
    020E1 E041      LDI	R20,1
    020E2 E050      LDI	R21,0
    020E3 E060      LDI	R22,0
    020E4 E070      LDI	R23,0
    020E5 A428      LDD	R2,Y+40
    020E6 A439      LDD	R3,Y+41
    020E7 A44A      LDD	R4,Y+42
    020E8 A45B      LDD	R5,Y+43
    020E9 1A24      SUB	R2,R20
    020EA 0A35      SBC	R3,R21
    020EB 0A46      SBC	R4,R22
    020EC 0A57      SBC	R5,R23
    020ED 81EA      LDD	R30,Y+2
    020EE 81FB      LDD	R31,Y+3
    020EF 8622      STD	Z+10,R2
    020F0 8633      STD	Z+11,R3
    020F1 8644      STD	Z+12,R4
    020F2 8655      STD	Z+13,R5
(2313) 					res = move_window(dj.fs, dw);
    020F3 A02C      LDD	R2,Y+36
    020F4 A03D      LDD	R3,Y+37
    020F5 A04E      LDD	R4,Y+38
    020F6 A05F      LDD	R5,Y+39
    020F7 8248      ST	Y,R4
    020F8 8259      STD	Y+1,R5
    020F9 0191      MOVW	R18,R2
    020FA 810A      LDD	R16,Y+2
    020FB 811B      LDD	R17,Y+3
    020FC 940E 0CAD CALL	ff.c:move_window
    020FE 2EC0      MOV	R12,R16
    020FF 2CAC      MOV	R10,R12
(2314) 				}
(2315) 			}
(2316) 		}
(2317) 	}
    02100 C012      RJMP	0x2113
(2318) 	else {	/* Open an existing file */
(2319) 		if (res == FR_OK) {						/* Follow succeeded */
    02101 20AA      TST	R10
    02102 F481      BNE	0x2113
(2320) 			if (dir[DIR_Attr] & AM_DIR) {		/* It is a directory */
    02103 01F7      MOVW	R30,R14
    02104 8423      LDD	R2,Z+11
    02105 FE24      SBRS	R2,4
    02106 C003      RJMP	0x210A
(2321) 				res = FR_NO_FILE;
    02107 E084      LDI	R24,4
    02108 2EA8      MOV	R10,R24
(2322) 			} else {
    02109 C009      RJMP	0x2113
(2323) 				if ((mode & FA_WRITE) && (dir[DIR_Attr] & AM_RDO)) /* R/O violation */
    0210A AC0A      LDD	R0,Y+58
    0210B FE01      SBRS	R0,1
    0210C C006      RJMP	0x2113
    0210D 01F7      MOVW	R30,R14
    0210E 8423      LDD	R2,Z+11
    0210F FE20      SBRS	R2,0
    02110 C002      RJMP	0x2113
(2324) 					res = FR_DENIED;
    02111 E087      LDI	R24,7
    02112 2EA8      MOV	R10,R24
(2325) 			}
(2326) 		}
(2327) 	}
(2328) 	if (res == FR_OK) {
    02113 20AA      TST	R10
    02114 F4A1      BNE	0x2129
(2329) 		if (mode & FA_CREATE_ALWAYS)			/* Set file change flag if created or overwritten */
    02115 AC0A      LDD	R0,Y+58
    02116 FE03      SBRS	R0,3
    02117 C003      RJMP	0x211B
(2330) 			mode |= FA__WRITTEN;
    02118 2D80      MOV	R24,R0
    02119 6280      ORI	R24,0x20
    0211A AF8A      STD	Y+58,R24
(2331) 		fp->dir_sect = dj.fs->winsect;			/* Pointer to the directory entry */
    0211B 81EA      LDD	R30,Y+2
    0211C 81FB      LDD	R31,Y+3
    0211D A422      LDD	R2,Z+42
    0211E A433      LDD	R3,Z+43
    0211F A444      LDD	R4,Z+44
    02120 A455      LDD	R5,Z+45
    02121 A9EE      LDD	R30,Y+54
    02122 A9FF      LDD	R31,Y+55
    02123 8E22      STD	Z+26,R2
    02124 8E33      STD	Z+27,R3
    02125 8E44      STD	Z+28,R4
    02126 8E55      STD	Z+29,R5
(2332) 		fp->dir_ptr = dir;
    02127 8EF7      STD	Z+31,R15
    02128 8EE6      STD	Z+30,R14
(2333) #if _FS_SHARE
(2334) 		fp->lockid = inc_lock(&dj, (mode & ~FA_READ) ? 1 : 0);
(2335) 		if (!fp->lockid) res = FR_INT_ERR;
(2336) #endif
(2337) 	}
(2338) 
(2339) #else				/* R/O configuration */
(2340) 	if (res == FR_OK) {					/* Follow succeeded */
(2341) 		if (!dir) {						/* Current dir itself */
(2342) 			res = FR_INVALID_NAME;
(2343) 		} else {
(2344) 			if (dir[DIR_Attr] & AM_DIR)	/* It is a directory */
(2345) 				res = FR_NO_FILE;
(2346) 		}
(2347) 	}
(2348) #endif
(2349) 	FREE_BUF();
(2350) 
(2351) 	if (res == FR_OK) {
    02129 20AA      TST	R10
    0212A F009      BEQ	0x212C
    0212B C077      RJMP	0x21A3
(2352) 		fp->flag = mode;					/* File access mode */
    0212C A9EE      LDD	R30,Y+54
    0212D A9FF      LDD	R31,Y+55
    0212E AC0A      LDD	R0,Y+58
    0212F 8204      STD	Z+4,R0
(2353) 		fp->sclust = LD_CLUST(dir);			/* File start cluster */
    02130 01F7      MOVW	R30,R14
    02131 8C22      LDD	R2,Z+26
    02132 2433      CLR	R3
    02133 8C43      LDD	R4,Z+27
    02134 2455      CLR	R5
    02135 2C54      MOV	R5,R4
    02136 2444      CLR	R4
    02137 2842      OR	R4,R2
    02138 2853      OR	R5,R3
    02139 0112      MOVW	R2,R4
    0213A 2444      CLR	R4
    0213B 2455      CLR	R5
    0213C 8864      LDD	R6,Z+20
    0213D 2477      CLR	R7
    0213E 8885      LDD	R8,Z+21
    0213F 2499      CLR	R9
    02140 2C98      MOV	R9,R8
    02141 2488      CLR	R8
    02142 2886      OR	R8,R6
    02143 2897      OR	R9,R7
    02144 0134      MOVW	R6,R8
    02145 2488      CLR	R8
    02146 2499      CLR	R9
    02147 0143      MOVW	R8,R6
    02148 2466      CLR	R6
    02149 2477      CLR	R7
    0214A 2862      OR	R6,R2
    0214B 2873      OR	R7,R3
    0214C 2884      OR	R8,R4
    0214D 2895      OR	R9,R5
    0214E A9EE      LDD	R30,Y+54
    0214F A9FF      LDD	R31,Y+55
    02150 8666      STD	Z+14,R6
    02151 8677      STD	Z+15,R7
    02152 8A80      STD	Z+16,R8
    02153 8A91      STD	Z+17,R9
(2354) 		fp->fsize = LD_DWORD(dir+DIR_FileSize);	/* File size */
    02154 E188      LDI	R24,0x18
    02155 E090      LDI	R25,0
    02156 01F7      MOVW	R30,R14
    02157 8D07      LDD	R16,Z+31
    02158 2711      CLR	R17
    02159 2722      CLR	R18
    0215A 2733      CLR	R19
    0215B 938A      ST	-Y,R24
    0215C 940E 4C36 CALL	lsl32
    0215E 0118      MOVW	R2,R16
    0215F 0129      MOVW	R4,R18
    02160 01F7      MOVW	R30,R14
    02161 8C66      LDD	R6,Z+30
    02162 2477      CLR	R7
    02163 2488      CLR	R8
    02164 2499      CLR	R9
    02165 0143      MOVW	R8,R6
    02166 2466      CLR	R6
    02167 2477      CLR	R7
    02168 2826      OR	R2,R6
    02169 2837      OR	R3,R7
    0216A 2848      OR	R4,R8
    0216B 2859      OR	R5,R9
    0216C 8C65      LDD	R6,Z+29
    0216D 2477      CLR	R7
    0216E 2C76      MOV	R7,R6
    0216F 2466      CLR	R6
    02170 2488      CLR	R8
    02171 2499      CLR	R9
    02172 2826      OR	R2,R6
    02173 2837      OR	R3,R7
    02174 2848      OR	R4,R8
    02175 2859      OR	R5,R9
    02176 8C64      LDD	R6,Z+28
    02177 2477      CLR	R7
    02178 2488      CLR	R8
    02179 2499      CLR	R9
    0217A 2826      OR	R2,R6
    0217B 2837      OR	R3,R7
    0217C 2848      OR	R4,R8
    0217D 2859      OR	R5,R9
    0217E A9EE      LDD	R30,Y+54
    0217F A9FF      LDD	R31,Y+55
    02180 8622      STD	Z+10,R2
    02181 8633      STD	Z+11,R3
    02182 8644      STD	Z+12,R4
    02183 8655      STD	Z+13,R5
(2355) 		fp->fptr = 0;						/* File pointer */
    02184 9636      ADIW	R30,6
    02185 E080      LDI	R24,0
    02186 8380      ST	Z,R24
    02187 8381      STD	Z+1,R24
    02188 8382      STD	Z+2,R24
    02189 8383      STD	Z+3,R24
(2356) 		fp->dsect = 0;
    0218A A9EE      LDD	R30,Y+54
    0218B A9FF      LDD	R31,Y+55
    0218C 9676      ADIW	R30,0x16
    0218D E080      LDI	R24,0
    0218E 8380      ST	Z,R24
    0218F 8381      STD	Z+1,R24
    02190 8382      STD	Z+2,R24
    02191 8383      STD	Z+3,R24
(2357) #if _USE_FASTSEEK
(2358) 		fp->cltbl = 0;						/* Normal seek mode */
    02192 2422      CLR	R2
    02193 2433      CLR	R3
    02194 A9EE      LDD	R30,Y+54
    02195 A9FF      LDD	R31,Y+55
    02196 A231      STD	Z+33,R3
    02197 A220      STD	Z+32,R2
(2359) #endif
(2360) 		fp->fs = dj.fs; fp->id = dj.fs->id;	/* Validate file object */
    02198 802A      LDD	R2,Y+2
    02199 803B      LDD	R3,Y+3
    0219A 8231      STD	Z+1,R3
    0219B 8220      ST	Z,R2
    0219C 01F1      MOVW	R30,R2
    0219D 8026      LDD	R2,Z+6
    0219E 8037      LDD	R3,Z+7
    0219F A9EE      LDD	R30,Y+54
    021A0 A9FF      LDD	R31,Y+55
    021A1 8233      STD	Z+3,R3
    021A2 8222      STD	Z+2,R2
(2361) 	}
(2362) 
(2363) 	LEAVE_FF(dj.fs, res);
    021A3 2D0A      MOV	R16,R10
    021A4 96AC      ADIW	R28,0x2C
    021A5 940E 4BA0 CALL	pop_xgsetF0FC
    021A7 9624      ADIW	R28,4
    021A8 9508      RET
_f_read:
  remain               --> Y,+13
  res                  --> R10
  clst                 --> Y,+9
  csect                --> R12
  cc                   --> R10
  rbuff                --> R14
  sect                 --> Y,+5
  rcnt                 --> R12
  br                   --> Y,+33
  btr                  --> Y,+31
  buff                 --> R10
  fp                   --> Y,+27
    021A9 940E 4A66 CALL	push_arg4
    021AB 940E 4BAB CALL	push_xgsetF0FC
    021AD 0159      MOVW	R10,R18
    021AE 9761      SBIW	R28,0x11
(2364) }
(2365) 
(2366) 
(2367) 
(2368) 
(2369) /*-----------------------------------------------------------------------*/
(2370) /* Read File                                                             */
(2371) /*-----------------------------------------------------------------------*/
(2372) 
(2373) FRESULT f_read (
(2374) 	FIL *fp, 		/* Pointer to the file object */
(2375) 	void *buff,		/* Pointer to data buffer */
(2376) 	UINT btr,		/* Number of bytes to read */
(2377) 	UINT *br		/* Pointer to number of bytes read */
(2378) )
(2379) {
(2380) 	FRESULT res;
(2381) 	DWORD clst, sect, remain;
(2382) 	UINT rcnt, cc;
(2383) 	BYTE csect, *rbuff = buff;
    021AF 0175      MOVW	R14,R10
(2384) 
(2385) 	memset(buff,0,512);
    021B0 E080      LDI	R24,0
    021B1 E092      LDI	R25,2
    021B2 8399      STD	Y+1,R25
    021B3 8388      ST	Y,R24
    021B4 2722      CLR	R18
    021B5 2733      CLR	R19
    021B6 0185      MOVW	R16,R10
    021B7 940E 4A42 CALL	_memset
(2386) 
(2387) 	*br = 0;	/* Initialize byte counter */
    021B9 2422      CLR	R2
    021BA 2433      CLR	R3
    021BB A1E9      LDD	R30,Y+33
    021BC A1FA      LDD	R31,Y+34
    021BD 8231      STD	Z+1,R3
    021BE 8220      ST	Z,R2
(2388) 
(2389) 	res = validate(fp->fs, fp->id);				/* Check validity */
    021BF 8DEB      LDD	R30,Y+27
    021C0 8DFC      LDD	R31,Y+28
    021C1 8122      LDD	R18,Z+2
    021C2 8133      LDD	R19,Z+3
    021C3 8100      LD	R16,Z
    021C4 8111      LDD	R17,Z+1
    021C5 DDFF      RCALL	ff.c:validate
    021C6 2EA0      MOV	R10,R16
(2390) 	if (res != FR_OK) LEAVE_FF(fp->fs, res);
    021C7 2300      TST	R16
    021C8 F009      BEQ	0x21CA
    021C9 C245      RJMP	0x240F
(2391) 	if (fp->flag & FA__ERROR)					/* Aborted file? */
    021CA 8DEB      LDD	R30,Y+27
    021CB 8DFC      LDD	R31,Y+28
    021CC 8024      LDD	R2,Z+4
    021CD FE27      SBRS	R2,7
    021CE C002      RJMP	0x21D1
(2392) 		LEAVE_FF(fp->fs, FR_INT_ERR);
    021CF E002      LDI	R16,2
    021D0 C23E      RJMP	0x240F
(2393) 	if (!(fp->flag & FA_READ)) 					/* Check access mode */
    021D1 8DEB      LDD	R30,Y+27
    021D2 8DFC      LDD	R31,Y+28
    021D3 8024      LDD	R2,Z+4
    021D4 FC20      SBRC	R2,0
    021D5 C002      RJMP	0x21D8
(2394) 		LEAVE_FF(fp->fs, FR_DENIED);
    021D6 E007      LDI	R16,7
    021D7 C237      RJMP	0x240F
(2395) 	remain = fp->fsize - fp->fptr;
    021D8 8DEB      LDD	R30,Y+27
    021D9 8DFC      LDD	R31,Y+28
    021DA 8026      LDD	R2,Z+6
    021DB 8037      LDD	R3,Z+7
    021DC 8440      LDD	R4,Z+8
    021DD 8451      LDD	R5,Z+9
    021DE 963A      ADIW	R30,0xA
    021DF 8060      LD	R6,Z
    021E0 8071      LDD	R7,Z+1
    021E1 8082      LDD	R8,Z+2
    021E2 8093      LDD	R9,Z+3
    021E3 1862      SUB	R6,R2
    021E4 0873      SBC	R7,R3
    021E5 0884      SBC	R8,R4
    021E6 0895      SBC	R9,R5
    021E7 866D      STD	Y+13,R6
    021E8 867E      STD	Y+14,R7
    021E9 868F      STD	Y+15,R8
    021EA 8A98      STD	Y+16,R9
(2396) 	if (btr > remain) btr = (UINT)remain;		/* Truncate btr by remaining bytes */
    021EB 842D      LDD	R2,Y+13
    021EC 843E      LDD	R3,Y+14
    021ED 844F      LDD	R4,Y+15
    021EE 8858      LDD	R5,Y+16
    021EF 8C6F      LDD	R6,Y+31
    021F0 A078      LDD	R7,Y+32
    021F1 2488      CLR	R8
    021F2 2499      CLR	R9
    021F3 1426      CP	R2,R6
    021F4 0437      CPC	R3,R7
    021F5 0448      CPC	R4,R8
    021F6 0459      CPC	R5,R9
    021F7 F008      BCS	0x21F9
    021F8 C20D      RJMP	0x2406
    021F9 A238      STD	Y+32,R3
    021FA 8E2F      STD	Y+31,R2
(2397) 
(2398) 	for ( ;  btr;								/* Repeat until all data read */
    021FB C20A      RJMP	0x2406
(2399) 		rbuff += rcnt, fp->fptr += rcnt, *br += rcnt, btr -= rcnt) {
(2400) 		if ((fp->fptr % SS(fp->fs)) == 0) {		/* On the sector boundary? */
    021FC EF4F      LDI	R20,0xFF
    021FD E051      LDI	R21,1
    021FE E060      LDI	R22,0
    021FF E070      LDI	R23,0
    02200 8DEB      LDD	R30,Y+27
    02201 8DFC      LDD	R31,Y+28
    02202 9636      ADIW	R30,6
    02203 8020      LD	R2,Z
    02204 8031      LDD	R3,Z+1
    02205 8042      LDD	R4,Z+2
    02206 8053      LDD	R5,Z+3
    02207 2224      AND	R2,R20
    02208 2235      AND	R3,R21
    02209 2246      AND	R4,R22
    0220A 2257      AND	R5,R23
    0220B 9488      BCLR	0
    0220C 2022      TST	R2
    0220D 0432      CPC	R3,R2
    0220E 0442      CPC	R4,R2
    0220F 0452      CPC	R5,R2
    02210 F009      BEQ	0x2212
    02211 C180      RJMP	0x2392
(2401) 			csect = (BYTE)(fp->fptr / SS(fp->fs) & (fp->fs->csize - 1));	/* Sector offset in the cluster */
    02212 E089      LDI	R24,0x9
    02213 E090      LDI	R25,0
    02214 8DEB      LDD	R30,Y+27
    02215 8DFC      LDD	R31,Y+28
    02216 8106      LDD	R16,Z+6
    02217 8117      LDD	R17,Z+7
    02218 8520      LDD	R18,Z+8
    02219 8531      LDD	R19,Z+9
    0221A 938A      ST	-Y,R24
    0221B 940E 4C4F CALL	lsr32
    0221D 0118      MOVW	R2,R16
    0221E 0129      MOVW	R4,R18
    0221F 8DEB      LDD	R30,Y+27
    02220 8DFC      LDD	R31,Y+28
    02221 93AF      PUSH	R26
    02222 93BF      PUSH	R27
    02223 81A0      LD	R26,Z
    02224 81B1      LDD	R27,Z+1
    02225 01FD      MOVW	R30,R26
    02226 91BF      POP	R27
    02227 91AF      POP	R26
    02228 8182      LDD	R24,Z+2
    02229 2799      CLR	R25
    0222A 9701      SBIW	R24,1
    0222B 013C      MOVW	R6,R24
    0222C 2488      CLR	R8
    0222D FC77      SBRC	R7,7
    0222E 9480      COM	R8
    0222F 2499      CLR	R9
    02230 FC87      SBRC	R8,7
    02231 9490      COM	R9
    02232 2026      AND	R2,R6
    02233 2037      AND	R3,R7
    02234 2048      AND	R4,R8
    02235 2059      AND	R5,R9
    02236 2CC2      MOV	R12,R2
(2402) 			if (!csect) {						/* On the cluster boundary? */
    02237 2022      TST	R2
    02238 F009      BEQ	0x223A
    02239 C078      RJMP	0x22B2
(2403) 				if (fp->fptr == 0) {			/* On the top of the file? */
    0223A 8DEB      LDD	R30,Y+27
    0223B 8DFC      LDD	R31,Y+28
    0223C 9636      ADIW	R30,6
    0223D 8020      LD	R2,Z
    0223E 8031      LDD	R3,Z+1
    0223F 8042      LDD	R4,Z+2
    02240 8053      LDD	R5,Z+3
    02241 9488      BCLR	0
    02242 2022      TST	R2
    02243 0432      CPC	R3,R2
    02244 0442      CPC	R4,R2
    02245 0452      CPC	R5,R2
    02246 F461      BNE	0x2253
(2404) 					clst = fp->sclust;			/* Follow from the origin */
    02247 8DEB      LDD	R30,Y+27
    02248 8DFC      LDD	R31,Y+28
    02249 963E      ADIW	R30,0xE
    0224A 8020      LD	R2,Z
    0224B 8031      LDD	R3,Z+1
    0224C 8042      LDD	R4,Z+2
    0224D 8053      LDD	R5,Z+3
    0224E 8629      STD	Y+9,R2
    0224F 863A      STD	Y+10,R3
    02250 864B      STD	Y+11,R4
    02251 865C      STD	Y+12,R5
(2405) 				} else {						/* Middle or end of the file */
    02252 C028      RJMP	0x227B
(2406) #if _USE_FASTSEEK
(2407) 					if (fp->cltbl)
    02253 8DEB      LDD	R30,Y+27
    02254 8DFC      LDD	R31,Y+28
    02255 A020      LDD	R2,Z+32
    02256 A031      LDD	R3,Z+33
    02257 2022      TST	R2
    02258 F411      BNE	0x225B
    02259 2033      TST	R3
    0225A F079      BEQ	0x226A
(2408) 						clst = clmt_clust(fp, fp->fptr);	/* Get cluster# from the CLMT */
    0225B 8026      LDD	R2,Z+6
    0225C 8037      LDD	R3,Z+7
    0225D 8440      LDD	R4,Z+8
    0225E 8451      LDD	R5,Z+9
    0225F 8248      ST	Y,R4
    02260 8259      STD	Y+1,R5
    02261 0191      MOVW	R18,R2
    02262 018F      MOVW	R16,R30
    02263 940E 13B0 CALL	ff.c:clmt_clust
    02265 8709      STD	Y+9,R16
    02266 871A      STD	Y+10,R17
    02267 872B      STD	Y+11,R18
    02268 873C      STD	Y+12,R19
    02269 C011      RJMP	0x227B
(2409) 					else
(2410) #endif
(2411) 						clst = get_fat(fp->fs, fp->clust);	/* Follow cluster chain on the FAT */
    0226A 8DEB      LDD	R30,Y+27
    0226B 8DFC      LDD	R31,Y+28
    0226C 8822      LDD	R2,Z+18
    0226D 8833      LDD	R3,Z+19
    0226E 8844      LDD	R4,Z+20
    0226F 8855      LDD	R5,Z+21
    02270 8248      ST	Y,R4
    02271 8259      STD	Y+1,R5
    02272 0191      MOVW	R18,R2
    02273 8100      LD	R16,Z
    02274 8111      LDD	R17,Z+1
    02275 940E 0E76 CALL	_get_fat
    02277 8709      STD	Y+9,R16
    02278 871A      STD	Y+10,R17
    02279 872B      STD	Y+11,R18
    0227A 873C      STD	Y+12,R19
(2412) 				}
(2413) 				if (clst < 2) ABORT(fp->fs, FR_INT_ERR);
    0227B E042      LDI	R20,2
    0227C E050      LDI	R21,0
    0227D E060      LDI	R22,0
    0227E E070      LDI	R23,0
    0227F 8429      LDD	R2,Y+9
    02280 843A      LDD	R3,Y+10
    02281 844B      LDD	R4,Y+11
    02282 845C      LDD	R5,Y+12
    02283 1624      CP	R2,R20
    02284 0635      CPC	R3,R21
    02285 0646      CPC	R4,R22
    02286 0657      CPC	R5,R23
    02287 F448      BCC	0x2291
    02288 8D8B      LDD	R24,Y+27
    02289 8D9C      LDD	R25,Y+28
    0228A 9604      ADIW	R24,4
    0228B 01FC      MOVW	R30,R24
    0228C 8180      LD	R24,Z
    0228D 6880      ORI	R24,0x80
    0228E 8380      ST	Z,R24
    0228F E002      LDI	R16,2
    02290 C17E      RJMP	0x240F
(2414) 				if (clst == 0xFFFFFFFF) ABORT(fp->fs, FR_DISK_ERR);
    02291 EF4F      LDI	R20,0xFF
    02292 EF5F      LDI	R21,0xFF
    02293 EF6F      LDI	R22,0xFF
    02294 EF7F      LDI	R23,0xFF
    02295 8429      LDD	R2,Y+9
    02296 843A      LDD	R3,Y+10
    02297 844B      LDD	R4,Y+11
    02298 845C      LDD	R5,Y+12
    02299 1624      CP	R2,R20
    0229A 0635      CPC	R3,R21
    0229B 0646      CPC	R4,R22
    0229C 0657      CPC	R5,R23
    0229D F451      BNE	0x22A8
    0229E 8D8B      LDD	R24,Y+27
    0229F 8D9C      LDD	R25,Y+28
    022A0 9604      ADIW	R24,4
    022A1 015C      MOVW	R10,R24
    022A2 01FC      MOVW	R30,R24
    022A3 8180      LD	R24,Z
    022A4 6880      ORI	R24,0x80
    022A5 8380      ST	Z,R24
    022A6 E001      LDI	R16,1
    022A7 C167      RJMP	0x240F
(2415) 				fp->clust = clst;				/* Update current cluster */
    022A8 8429      LDD	R2,Y+9
    022A9 843A      LDD	R3,Y+10
    022AA 844B      LDD	R4,Y+11
    022AB 845C      LDD	R5,Y+12
    022AC 8DEB      LDD	R30,Y+27
    022AD 8DFC      LDD	R31,Y+28
    022AE 8A22      STD	Z+18,R2
    022AF 8A33      STD	Z+19,R3
    022B0 8A44      STD	Z+20,R4
    022B1 8A55      STD	Z+21,R5
(2416) 			}
(2417) 			sect = clust2sect(fp->fs, fp->clust);	/* Get current sector */
    022B2 8DEB      LDD	R30,Y+27
    022B3 8DFC      LDD	R31,Y+28
    022B4 8822      LDD	R2,Z+18
    022B5 8833      LDD	R3,Z+19
    022B6 8844      LDD	R4,Z+20
    022B7 8855      LDD	R5,Z+21
    022B8 8248      ST	Y,R4
    022B9 8259      STD	Y+1,R5
    022BA 0191      MOVW	R18,R2
    022BB 8100      LD	R16,Z
    022BC 8111      LDD	R17,Z+1
    022BD 940E 0E24 CALL	_clust2sect
    022BF 830D      STD	Y+5,R16
    022C0 831E      STD	Y+6,R17
    022C1 832F      STD	Y+7,R18
    022C2 8738      STD	Y+8,R19
(2418) 			if (!sect) ABORT(fp->fs, FR_INT_ERR);
    022C3 802D      LDD	R2,Y+5
    022C4 803E      LDD	R3,Y+6
    022C5 804F      LDD	R4,Y+7
    022C6 8458      LDD	R5,Y+8
    022C7 9488      BCLR	0
    022C8 2022      TST	R2
    022C9 0432      CPC	R3,R2
    022CA 0442      CPC	R4,R2
    022CB 0452      CPC	R5,R2
    022CC F451      BNE	0x22D7
    022CD 8D8B      LDD	R24,Y+27
    022CE 8D9C      LDD	R25,Y+28
    022CF 9604      ADIW	R24,4
    022D0 015C      MOVW	R10,R24
    022D1 01FC      MOVW	R30,R24
    022D2 8180      LD	R24,Z
    022D3 6880      ORI	R24,0x80
    022D4 8380      ST	Z,R24
    022D5 E002      LDI	R16,2
    022D6 C138      RJMP	0x240F
(2419) 			sect += csect;
    022D7 2C2C      MOV	R2,R12
    022D8 2433      CLR	R3
    022D9 2444      CLR	R4
    022DA 2455      CLR	R5
    022DB 806D      LDD	R6,Y+5
    022DC 807E      LDD	R7,Y+6
    022DD 808F      LDD	R8,Y+7
    022DE 8498      LDD	R9,Y+8
    022DF 0C62      ADD	R6,R2
    022E0 1C73      ADC	R7,R3
    022E1 1C84      ADC	R8,R4
    022E2 1C95      ADC	R9,R5
    022E3 826D      STD	Y+5,R6
    022E4 827E      STD	Y+6,R7
    022E5 828F      STD	Y+7,R8
    022E6 8698      STD	Y+8,R9
(2420) 			cc = btr / SS(fp->fs);				/* When remaining bytes >= sector size, */
    022E7 E029      LDI	R18,0x9
    022E8 E030      LDI	R19,0
    022E9 8D0F      LDD	R16,Y+31
    022EA A118      LDD	R17,Y+32
    022EB 940E 4C48 CALL	lsr16
    022ED 0158      MOVW	R10,R16
(2421) 			if (cc) {							/* Read maximum contiguous sectors directly */
    022EE 3000      CPI	R16,0
    022EF 0701      CPC	R16,R17
    022F0 F409      BNE	0x22F2
    022F1 C096      RJMP	0x2388
(2422) 				if (csect + cc > fp->fs->csize)	/* Clip at cluster boundary */
    022F2 2C2C      MOV	R2,R12
    022F3 2433      CLR	R3
    022F4 0E20      ADD	R2,R16
    022F5 1E31      ADC	R3,R17
    022F6 8DEB      LDD	R30,Y+27
    022F7 8DFC      LDD	R31,Y+28
    022F8 93AF      PUSH	R26
    022F9 93BF      PUSH	R27
    022FA 81A0      LD	R26,Z
    022FB 81B1      LDD	R27,Z+1
    022FC 01FD      MOVW	R30,R26
    022FD 91BF      POP	R27
    022FE 91AF      POP	R26
    022FF 8042      LDD	R4,Z+2
    02300 2455      CLR	R5
    02301 1442      CP	R4,R2
    02302 0453      CPC	R5,R3
    02303 F478      BCC	0x2313
(2423) 					cc = fp->fs->csize - csect;
    02304 2C2C      MOV	R2,R12
    02305 2433      CLR	R3
    02306 8DEB      LDD	R30,Y+27
    02307 8DFC      LDD	R31,Y+28
    02308 93AF      PUSH	R26
    02309 93BF      PUSH	R27
    0230A 81A0      LD	R26,Z
    0230B 81B1      LDD	R27,Z+1
    0230C 01FD      MOVW	R30,R26
    0230D 91BF      POP	R27
    0230E 91AF      POP	R26
    0230F 80A2      LDD	R10,Z+2
    02310 24BB      CLR	R11
    02311 18A2      SUB	R10,R2
    02312 08B3      SBC	R11,R3
(2424) 				if (disk_read(fp->fs->drv, rbuff, sect, (BYTE)cc) != RES_OK)
    02313 82AC      STD	Y+4,R10
    02314 802D      LDD	R2,Y+5
    02315 803E      LDD	R3,Y+6
    02316 804F      LDD	R4,Y+7
    02317 8458      LDD	R5,Y+8
    02318 8228      ST	Y,R2
    02319 8239      STD	Y+1,R3
    0231A 824A      STD	Y+2,R4
    0231B 825B      STD	Y+3,R5
    0231C 0197      MOVW	R18,R14
    0231D 8DEB      LDD	R30,Y+27
    0231E 8DFC      LDD	R31,Y+28
    0231F 93AF      PUSH	R26
    02320 93BF      PUSH	R27
    02321 81A0      LD	R26,Z
    02322 81B1      LDD	R27,Z+1
    02323 01FD      MOVW	R30,R26
    02324 91BF      POP	R27
    02325 91AF      POP	R26
    02326 8101      LDD	R16,Z+1
    02327 940E 0C12 CALL	_disk_read
    02329 2EC0      MOV	R12,R16
    0232A 2300      TST	R16
    0232B F051      BEQ	0x2336
(2425) 					ABORT(fp->fs, FR_DISK_ERR);
    0232C 8D8B      LDD	R24,Y+27
    0232D 8D9C      LDD	R25,Y+28
    0232E 9604      ADIW	R24,4
    0232F 016C      MOVW	R12,R24
    02330 01FC      MOVW	R30,R24
    02331 8180      LD	R24,Z
    02332 6880      ORI	R24,0x80
    02333 8380      ST	Z,R24
    02334 E001      LDI	R16,1
    02335 C0D9      RJMP	0x240F
(2426) #if !_FS_READONLY && _FS_MINIMIZE <= 2			/* Replace one of the read sectors with cached data if it contains a dirty sector */
(2427) #if _FS_TINY
(2428) 				if (fp->fs->wflag && fp->fs->winsect - sect < cc)
    02336 8DEB      LDD	R30,Y+27
    02337 8DFC      LDD	R31,Y+28
    02338 80C0      LD	R12,Z
    02339 80D1      LDD	R13,Z+1
    0233A 01F6      MOVW	R30,R12
    0233B 9634      ADIW	R30,4
    0233C 8020      LD	R2,Z
    0233D 2022      TST	R2
    0233E F409      BNE	0x2340
    0233F C041      RJMP	0x2381
    02340 802D      LDD	R2,Y+5
    02341 803E      LDD	R3,Y+6
    02342 804F      LDD	R4,Y+7
    02343 8458      LDD	R5,Y+8
    02344 01F6      MOVW	R30,R12
    02345 A462      LDD	R6,Z+42
    02346 A473      LDD	R7,Z+43
    02347 A484      LDD	R8,Z+44
    02348 A495      LDD	R9,Z+45
    02349 1862      SUB	R6,R2
    0234A 0873      SBC	R7,R3
    0234B 0884      SBC	R8,R4
    0234C 0895      SBC	R9,R5
    0234D 0115      MOVW	R2,R10
    0234E 2444      CLR	R4
    0234F 2455      CLR	R5
    02350 1462      CP	R6,R2
    02351 0473      CPC	R7,R3
    02352 0484      CPC	R8,R4
    02353 0495      CPC	R9,R5
    02354 F560      BCC	0x2381
(2429) 					mem_cpy(rbuff + ((fp->fs->winsect - sect) * SS(fp->fs)), fp->fs->win, SS(fp->fs));
    02355 E080      LDI	R24,0
    02356 E092      LDI	R25,2
    02357 8399      STD	Y+1,R25
    02358 8388      ST	Y,R24
    02359 8DEB      LDD	R30,Y+27
    0235A 8DFC      LDD	R31,Y+28
    0235B 80C0      LD	R12,Z
    0235C 80D1      LDD	R13,Z+1
    0235D 0196      MOVW	R18,R12
    0235E 5D22      SUBI	R18,0xD2
    0235F 4F3F      SBCI	R19,0xFF
    02360 802D      LDD	R2,Y+5
    02361 803E      LDD	R3,Y+6
    02362 804F      LDD	R4,Y+7
    02363 8458      LDD	R5,Y+8
    02364 01F6      MOVW	R30,R12
    02365 A462      LDD	R6,Z+42
    02366 A473      LDD	R7,Z+43
    02367 A484      LDD	R8,Z+44
    02368 A495      LDD	R9,Z+45
    02369 1862      SUB	R6,R2
    0236A 0873      SBC	R7,R3
    0236B 0884      SBC	R8,R4
    0236C 0895      SBC	R9,R5
    0236D E040      LDI	R20,0
    0236E E052      LDI	R21,2
    0236F E060      LDI	R22,0
    02370 E070      LDI	R23,0
    02371 932F      PUSH	R18
    02372 933F      PUSH	R19
    02373 929A      ST	-Y,R9
    02374 928A      ST	-Y,R8
    02375 927A      ST	-Y,R7
    02376 926A      ST	-Y,R6
    02377 018A      MOVW	R16,R20
    02378 019B      MOVW	R18,R22
    02379 940E 4B57 CALL	empy32s|empy32u
    0237B 913F      POP	R19
    0237C 912F      POP	R18
    0237D 0D0E      ADD	R16,R14
    0237E 1D1F      ADC	R17,R15
    0237F 940E 0C54 CALL	ff.c:mem_cpy
(2430) #else
(2431) 				if ((fp->flag & FA__DIRTY) && fp->dsect - sect < cc)
(2432) 					mem_cpy(rbuff + ((fp->dsect - sect) * SS(fp->fs)), fp->buf, SS(fp->fs));
(2433) #endif
(2434) #endif
(2435) 				rcnt = SS(fp->fs) * cc;			/* Number of bytes transferred */
    02381 E000      LDI	R16,0
    02382 E012      LDI	R17,2
    02383 0195      MOVW	R18,R10
    02384 940E 4B47 CALL	empy16s
    02386 0168      MOVW	R12,R16
(2436) 				continue;
    02387 C05A      RJMP	0x23E2
(2437) 			}
(2438) #if !_FS_TINY
(2439) 			if (fp->dsect != sect) {			/* Load data sector if not in cache */
(2440) #if !_FS_READONLY
(2441) 				if (fp->flag & FA__DIRTY) {		/* Write-back dirty sector cache */
(2442) 					if (disk_write(fp->fs->drv, fp->buf, fp->dsect, 1) != RES_OK)
(2443) 						ABORT(fp->fs, FR_DISK_ERR);
(2444) 					fp->flag &= ~FA__DIRTY;
(2445) 				}
(2446) #endif
(2447) 				if (disk_read(fp->fs->drv, fp->buf, sect, 1) != RES_OK)	/* Fill sector cache */
(2448) 					ABORT(fp->fs, FR_DISK_ERR);
(2449) 			}
(2450) #endif
(2451) 			fp->dsect = sect;
    02388 802D      LDD	R2,Y+5
    02389 803E      LDD	R3,Y+6
    0238A 804F      LDD	R4,Y+7
    0238B 8458      LDD	R5,Y+8
    0238C 8DEB      LDD	R30,Y+27
    0238D 8DFC      LDD	R31,Y+28
    0238E 8A26      STD	Z+22,R2
    0238F 8A37      STD	Z+23,R3
    02390 8E40      STD	Z+24,R4
    02391 8E51      STD	Z+25,R5
(2452) 		}
(2453) 		rcnt = SS(fp->fs) - (fp->fptr % SS(fp->fs));	/* Get partial sector data from sector buffer */
    02392 EF4F      LDI	R20,0xFF
    02393 E051      LDI	R21,1
    02394 E060      LDI	R22,0
    02395 E070      LDI	R23,0
    02396 8DEB      LDD	R30,Y+27
    02397 8DFC      LDD	R31,Y+28
    02398 8026      LDD	R2,Z+6
    02399 8037      LDD	R3,Z+7
    0239A 8440      LDD	R4,Z+8
    0239B 8451      LDD	R5,Z+9
    0239C 2224      AND	R2,R20
    0239D 2235      AND	R3,R21
    0239E 2246      AND	R4,R22
    0239F 2257      AND	R5,R23
    023A0 E040      LDI	R20,0
    023A1 E052      LDI	R21,2
    023A2 E060      LDI	R22,0
    023A3 E070      LDI	R23,0
    023A4 1942      SUB	R20,R2
    023A5 0953      SBC	R21,R3
    023A6 0964      SBC	R22,R4
    023A7 0975      SBC	R23,R5
    023A8 016A      MOVW	R12,R20
(2454) 		if (rcnt > btr) rcnt = btr;
    023A9 8C0F      LDD	R0,Y+31
    023AA A018      LDD	R1,Y+32
    023AB 1604      CP	R0,R20
    023AC 0615      CPC	R1,R21
    023AD F408      BCC	0x23AF
    023AE 0160      MOVW	R12,R0
(2455) #if _FS_TINY
(2456) 		if (move_window(fp->fs, fp->dsect))		/* Move sector window */
    023AF 8DEB      LDD	R30,Y+27
    023B0 8DFC      LDD	R31,Y+28
    023B1 8826      LDD	R2,Z+22
    023B2 8837      LDD	R3,Z+23
    023B3 8C40      LDD	R4,Z+24
    023B4 8C51      LDD	R5,Z+25
    023B5 8248      ST	Y,R4
    023B6 8259      STD	Y+1,R5
    023B7 0191      MOVW	R18,R2
    023B8 8100      LD	R16,Z
    023B9 8111      LDD	R17,Z+1
    023BA 940E 0CAD CALL	ff.c:move_window
    023BC 2EA0      MOV	R10,R16
    023BD 2300      TST	R16
    023BE F051      BEQ	0x23C9
(2457) 			ABORT(fp->fs, FR_DISK_ERR);
    023BF 8D8B      LDD	R24,Y+27
    023C0 8D9C      LDD	R25,Y+28
    023C1 9604      ADIW	R24,4
    023C2 015C      MOVW	R10,R24
    023C3 01FC      MOVW	R30,R24
    023C4 8180      LD	R24,Z
    023C5 6880      ORI	R24,0x80
    023C6 8380      ST	Z,R24
    023C7 E001      LDI	R16,1
    023C8 C046      RJMP	0x240F
(2458) 		mem_cpy(rbuff, &fp->fs->win[fp->fptr % SS(fp->fs)], rcnt);	/* Pick partial sector */
    023C9 82D9      STD	Y+1,R13
    023CA 82C8      ST	Y,R12
    023CB EF4F      LDI	R20,0xFF
    023CC E051      LDI	R21,1
    023CD E060      LDI	R22,0
    023CE E070      LDI	R23,0
    023CF 8DEB      LDD	R30,Y+27
    023D0 8DFC      LDD	R31,Y+28
    023D1 8026      LDD	R2,Z+6
    023D2 8037      LDD	R3,Z+7
    023D3 8440      LDD	R4,Z+8
    023D4 8451      LDD	R5,Z+9
    023D5 2224      AND	R2,R20
    023D6 2235      AND	R3,R21
    023D7 2246      AND	R4,R22
    023D8 2257      AND	R5,R23
    023D9 0191      MOVW	R18,R2
    023DA 8180      LD	R24,Z
    023DB 8191      LDD	R25,Z+1
    023DC 968E      ADIW	R24,0x2E
    023DD 0F28      ADD	R18,R24
    023DE 1F39      ADC	R19,R25
    023DF 0187      MOVW	R16,R14
    023E0 940E 0C54 CALL	ff.c:mem_cpy
    023E2 0CEC      ADD	R14,R12
    023E3 1CFD      ADC	R15,R13
    023E4 8D8B      LDD	R24,Y+27
    023E5 8D9C      LDD	R25,Y+28
    023E6 9606      ADIW	R24,6
    023E7 015C      MOVW	R10,R24
    023E8 0116      MOVW	R2,R12
    023E9 2444      CLR	R4
    023EA 2455      CLR	R5
    023EB 01FC      MOVW	R30,R24
    023EC 8060      LD	R6,Z
    023ED 8071      LDD	R7,Z+1
    023EE 8082      LDD	R8,Z+2
    023EF 8093      LDD	R9,Z+3
    023F0 0C62      ADD	R6,R2
    023F1 1C73      ADC	R7,R3
    023F2 1C84      ADC	R8,R4
    023F3 1C95      ADC	R9,R5
    023F4 8260      ST	Z,R6
    023F5 8271      STD	Z+1,R7
    023F6 8282      STD	Z+2,R8
    023F7 8293      STD	Z+3,R9
    023F8 A1E9      LDD	R30,Y+33
    023F9 A1FA      LDD	R31,Y+34
    023FA 8020      LD	R2,Z
    023FB 8031      LDD	R3,Z+1
    023FC 0C2C      ADD	R2,R12
    023FD 1C3D      ADC	R3,R13
    023FE 8231      STD	Z+1,R3
    023FF 8220      ST	Z,R2
    02400 8C0F      LDD	R0,Y+31
    02401 A018      LDD	R1,Y+32
    02402 180C      SUB	R0,R12
    02403 081D      SBC	R1,R13
    02404 A218      STD	Y+32,R1
    02405 8E0F      STD	Y+31,R0
    02406 8C0F      LDD	R0,Y+31
    02407 A018      LDD	R1,Y+32
    02408 2000      TST	R0
    02409 F009      BEQ	0x240B
    0240A CDF1      RJMP	0x21FC
    0240B 2011      TST	R1
    0240C F009      BEQ	0x240E
    0240D CDEE      RJMP	0x21FC
(2459) #else
(2460) 		mem_cpy(rbuff, &fp->buf[fp->fptr % SS(fp->fs)], rcnt);	/* Pick partial sector */
(2461) #endif
(2462) 	}
(2463) 
(2464) 	LEAVE_FF(fp->fs, FR_OK);
    0240E 2700      CLR	R16
    0240F 9661      ADIW	R28,0x11
    02410 940E 4BA0 CALL	pop_xgsetF0FC
    02412 9624      ADIW	R28,4
    02413 9508      RET
_f_write:
  res                  --> R10
  clst                 --> Y,+9
  csect                --> R12
  cc                   --> R10
  wbuff                --> R14
  sect                 --> Y,+5
  wcnt                 --> R12
  bw                   --> Y,+33
  btw                  --> Y,+31
  buff                 --> R10
  fp                   --> Y,+27
    02414 940E 4A66 CALL	push_arg4
    02416 940E 4BAB CALL	push_xgsetF0FC
    02418 0159      MOVW	R10,R18
    02419 9761      SBIW	R28,0x11
(2465) }
(2466) 
(2467) 
(2468) 
(2469) 
(2470) #if !_FS_READONLY
(2471) /*-----------------------------------------------------------------------*/
(2472) /* Write File                                                            */
(2473) /*-----------------------------------------------------------------------*/
(2474) 
(2475) FRESULT f_write (
(2476) 	FIL *fp,			/* Pointer to the file object */
(2477) 	const void *buff,	/* Pointer to the data to be written */
(2478) 	UINT btw,			/* Number of bytes to write */
(2479) 	UINT *bw			/* Pointer to number of bytes written */
(2480) )
(2481) {
(2482) 	FRESULT res;
(2483) 	DWORD clst, sect;
(2484) 	UINT wcnt, cc;
(2485) 	const BYTE *wbuff = buff;
    0241A 0175      MOVW	R14,R10
(2486) 	BYTE csect;
(2487) 
(2488) 
(2489) 	*bw = 0;	/* Initialize byte counter */
    0241B 2422      CLR	R2
    0241C 2433      CLR	R3
    0241D A1E9      LDD	R30,Y+33
    0241E A1FA      LDD	R31,Y+34
    0241F 8231      STD	Z+1,R3
    02420 8220      ST	Z,R2
(2490) 
(2491) 	res = validate(fp->fs, fp->id);			/* Check validity */
    02421 8DEB      LDD	R30,Y+27
    02422 8DFC      LDD	R31,Y+28
    02423 8122      LDD	R18,Z+2
    02424 8133      LDD	R19,Z+3
    02425 8100      LD	R16,Z
    02426 8111      LDD	R17,Z+1
    02427 DB9D      RCALL	ff.c:validate
    02428 2EA0      MOV	R10,R16
(2492) 	if (res != FR_OK) LEAVE_FF(fp->fs, res);
    02429 2300      TST	R16
    0242A F009      BEQ	0x242C
    0242B C2FC      RJMP	0x2728
(2493) 	if (fp->flag & FA__ERROR)				/* Aborted file? */
    0242C 8DEB      LDD	R30,Y+27
    0242D 8DFC      LDD	R31,Y+28
    0242E 8024      LDD	R2,Z+4
    0242F FE27      SBRS	R2,7
    02430 C002      RJMP	0x2433
(2494) 		LEAVE_FF(fp->fs, FR_INT_ERR);
    02431 E002      LDI	R16,2
    02432 C2F5      RJMP	0x2728
(2495) 	if (!(fp->flag & FA_WRITE))				/* Check access mode */
    02433 8DEB      LDD	R30,Y+27
    02434 8DFC      LDD	R31,Y+28
    02435 8024      LDD	R2,Z+4
    02436 FC21      SBRC	R2,1
    02437 C002      RJMP	0x243A
(2496) 		LEAVE_FF(fp->fs, FR_DENIED);
    02438 E007      LDI	R16,7
    02439 C2EE      RJMP	0x2728
(2497) 	if ((DWORD)(fp->fsize + btw) < fp->fsize) btw = 0;	/* File size cannot reach 4GB */
    0243A 8DEB      LDD	R30,Y+27
    0243B 8DFC      LDD	R31,Y+28
    0243C 963A      ADIW	R30,0xA
    0243D 8020      LD	R2,Z
    0243E 8031      LDD	R3,Z+1
    0243F 8042      LDD	R4,Z+2
    02440 8053      LDD	R5,Z+3
    02441 862D      STD	Y+13,R2
    02442 863E      STD	Y+14,R3
    02443 864F      STD	Y+15,R4
    02444 8A58      STD	Y+16,R5
    02445 8C2F      LDD	R2,Y+31
    02446 A038      LDD	R3,Y+32
    02447 2444      CLR	R4
    02448 2455      CLR	R5
    02449 846D      LDD	R6,Y+13
    0244A 847E      LDD	R7,Y+14
    0244B 848F      LDD	R8,Y+15
    0244C 8898      LDD	R9,Y+16
    0244D 0C62      ADD	R6,R2
    0244E 1C73      ADC	R7,R3
    0244F 1C84      ADC	R8,R4
    02450 1C95      ADC	R9,R5
    02451 842D      LDD	R2,Y+13
    02452 843E      LDD	R3,Y+14
    02453 844F      LDD	R4,Y+15
    02454 8858      LDD	R5,Y+16
    02455 1462      CP	R6,R2
    02456 0473      CPC	R7,R3
    02457 0484      CPC	R8,R4
    02458 0495      CPC	R9,R5
    02459 F008      BCS	0x245B
    0245A C2A5      RJMP	0x2700
    0245B 2400      CLR	R0
    0245C 2411      CLR	R1
    0245D A218      STD	Y+32,R1
    0245E 8E0F      STD	Y+31,R0
(2498) 
(2499) 	for ( ;  btw;							/* Repeat until all data written */
    0245F C2A0      RJMP	0x2700
(2500) 		wbuff += wcnt, fp->fptr += wcnt, *bw += wcnt, btw -= wcnt) {
(2501) 		if ((fp->fptr % SS(fp->fs)) == 0) {	/* On the sector boundary? */
    02460 EF4F      LDI	R20,0xFF
    02461 E051      LDI	R21,1
    02462 E060      LDI	R22,0
    02463 E070      LDI	R23,0
    02464 8DEB      LDD	R30,Y+27
    02465 8DFC      LDD	R31,Y+28
    02466 9636      ADIW	R30,6
    02467 8020      LD	R2,Z
    02468 8031      LDD	R3,Z+1
    02469 8042      LDD	R4,Z+2
    0246A 8053      LDD	R5,Z+3
    0246B 2224      AND	R2,R20
    0246C 2235      AND	R3,R21
    0246D 2246      AND	R4,R22
    0246E 2257      AND	R5,R23
    0246F 9488      BCLR	0
    02470 2022      TST	R2
    02471 0432      CPC	R3,R2
    02472 0442      CPC	R4,R2
    02473 0452      CPC	R5,R2
    02474 F009      BEQ	0x2476
    02475 C20B      RJMP	0x2681
(2502) 			csect = (BYTE)(fp->fptr / SS(fp->fs) & (fp->fs->csize - 1));	/* Sector offset in the cluster */
    02476 E089      LDI	R24,0x9
    02477 E090      LDI	R25,0
    02478 8DEB      LDD	R30,Y+27
    02479 8DFC      LDD	R31,Y+28
    0247A 8106      LDD	R16,Z+6
    0247B 8117      LDD	R17,Z+7
    0247C 8520      LDD	R18,Z+8
    0247D 8531      LDD	R19,Z+9
    0247E 938A      ST	-Y,R24
    0247F 940E 4C4F CALL	lsr32
    02481 0118      MOVW	R2,R16
    02482 0129      MOVW	R4,R18
    02483 8DEB      LDD	R30,Y+27
    02484 8DFC      LDD	R31,Y+28
    02485 93AF      PUSH	R26
    02486 93BF      PUSH	R27
    02487 81A0      LD	R26,Z
    02488 81B1      LDD	R27,Z+1
    02489 01FD      MOVW	R30,R26
    0248A 91BF      POP	R27
    0248B 91AF      POP	R26
    0248C 8182      LDD	R24,Z+2
    0248D 2799      CLR	R25
    0248E 9701      SBIW	R24,1
    0248F 013C      MOVW	R6,R24
    02490 2488      CLR	R8
    02491 FC77      SBRC	R7,7
    02492 9480      COM	R8
    02493 2499      CLR	R9
    02494 FC87      SBRC	R8,7
    02495 9490      COM	R9
    02496 2026      AND	R2,R6
    02497 2037      AND	R3,R7
    02498 2048      AND	R4,R8
    02499 2059      AND	R5,R9
    0249A 2CC2      MOV	R12,R2
(2503) 			if (!csect) {					/* On the cluster boundary? */
    0249B 2022      TST	R2
    0249C F009      BEQ	0x249E
    0249D C0A5      RJMP	0x2543
(2504) 				if (fp->fptr == 0) {		/* On the top of the file? */
    0249E 8DEB      LDD	R30,Y+27
    0249F 8DFC      LDD	R31,Y+28
    024A0 9636      ADIW	R30,6
    024A1 8020      LD	R2,Z
    024A2 8031      LDD	R3,Z+1
    024A3 8042      LDD	R4,Z+2
    024A4 8053      LDD	R5,Z+3
    024A5 9488      BCLR	0
    024A6 2022      TST	R2
    024A7 0432      CPC	R3,R2
    024A8 0442      CPC	R4,R2
    024A9 0452      CPC	R5,R2
    024AA F571      BNE	0x24D9
(2505) 					clst = fp->sclust;		/* Follow from the origin */
    024AB 8DEB      LDD	R30,Y+27
    024AC 8DFC      LDD	R31,Y+28
    024AD 963E      ADIW	R30,0xE
    024AE 8020      LD	R2,Z
    024AF 8031      LDD	R3,Z+1
    024B0 8042      LDD	R4,Z+2
    024B1 8053      LDD	R5,Z+3
    024B2 8629      STD	Y+9,R2
    024B3 863A      STD	Y+10,R3
    024B4 864B      STD	Y+11,R4
    024B5 865C      STD	Y+12,R5
(2506) 					if (clst == 0)			/* When no cluster is allocated, */
    024B6 8429      LDD	R2,Y+9
    024B7 843A      LDD	R3,Y+10
    024B8 844B      LDD	R4,Y+11
    024B9 845C      LDD	R5,Y+12
    024BA 9488      BCLR	0
    024BB 2022      TST	R2
    024BC 0432      CPC	R3,R2
    024BD 0442      CPC	R4,R2
    024BE 0452      CPC	R5,R2
    024BF F009      BEQ	0x24C1
    024C0 C040      RJMP	0x2501
(2507) 						fp->sclust = clst = create_chain(fp->fs, 0);	/* Create a new cluster chain */
    024C1 E040      LDI	R20,0
    024C2 E050      LDI	R21,0
    024C3 E060      LDI	R22,0
    024C4 E070      LDI	R23,0
    024C5 8368      ST	Y,R22
    024C6 8379      STD	Y+1,R23
    024C7 019A      MOVW	R18,R20
    024C8 8DEB      LDD	R30,Y+27
    024C9 8DFC      LDD	R31,Y+28
    024CA 8100      LD	R16,Z
    024CB 8111      LDD	R17,Z+1
    024CC 940E 1238 CALL	ff.c:create_chain
    024CE 8709      STD	Y+9,R16
    024CF 871A      STD	Y+10,R17
    024D0 872B      STD	Y+11,R18
    024D1 873C      STD	Y+12,R19
    024D2 8DEB      LDD	R30,Y+27
    024D3 8DFC      LDD	R31,Y+28
    024D4 8706      STD	Z+14,R16
    024D5 8717      STD	Z+15,R17
    024D6 8B20      STD	Z+16,R18
    024D7 8B31      STD	Z+17,R19
(2508) 				} else {					/* Middle or end of the file */
    024D8 C028      RJMP	0x2501
(2509) #if _USE_FASTSEEK
(2510) 					if (fp->cltbl)
    024D9 8DEB      LDD	R30,Y+27
    024DA 8DFC      LDD	R31,Y+28
    024DB A020      LDD	R2,Z+32
    024DC A031      LDD	R3,Z+33
    024DD 2022      TST	R2
    024DE F411      BNE	0x24E1
    024DF 2033      TST	R3
    024E0 F079      BEQ	0x24F0
(2511) 						clst = clmt_clust(fp, fp->fptr);	/* Get cluster# from the CLMT */
    024E1 8026      LDD	R2,Z+6
    024E2 8037      LDD	R3,Z+7
    024E3 8440      LDD	R4,Z+8
    024E4 8451      LDD	R5,Z+9
    024E5 8248      ST	Y,R4
    024E6 8259      STD	Y+1,R5
    024E7 0191      MOVW	R18,R2
    024E8 018F      MOVW	R16,R30
    024E9 940E 13B0 CALL	ff.c:clmt_clust
    024EB 8709      STD	Y+9,R16
    024EC 871A      STD	Y+10,R17
    024ED 872B      STD	Y+11,R18
    024EE 873C      STD	Y+12,R19
    024EF C011      RJMP	0x2501
(2512) 					else
(2513) #endif
(2514) 						clst = create_chain(fp->fs, fp->clust);	/* Follow or stretch cluster chain on the FAT */
    024F0 8DEB      LDD	R30,Y+27
    024F1 8DFC      LDD	R31,Y+28
    024F2 8822      LDD	R2,Z+18
    024F3 8833      LDD	R3,Z+19
    024F4 8844      LDD	R4,Z+20
    024F5 8855      LDD	R5,Z+21
    024F6 8248      ST	Y,R4
    024F7 8259      STD	Y+1,R5
    024F8 0191      MOVW	R18,R2
    024F9 8100      LD	R16,Z
    024FA 8111      LDD	R17,Z+1
    024FB 940E 1238 CALL	ff.c:create_chain
    024FD 8709      STD	Y+9,R16
    024FE 871A      STD	Y+10,R17
    024FF 872B      STD	Y+11,R18
    02500 873C      STD	Y+12,R19
(2515) 				}
(2516) 				if (clst == 0) break;		/* Could not allocate a new cluster (disk full) */
    02501 8429      LDD	R2,Y+9
    02502 843A      LDD	R3,Y+10
    02503 844B      LDD	R4,Y+11
    02504 845C      LDD	R5,Y+12
    02505 9488      BCLR	0
    02506 2022      TST	R2
    02507 0432      CPC	R3,R2
    02508 0442      CPC	R4,R2
    02509 0452      CPC	R5,R2
    0250A F409      BNE	0x250C
    0250B C1FC      RJMP	0x2708
(2517) 				if (clst == 1) ABORT(fp->fs, FR_INT_ERR);
    0250C E041      LDI	R20,1
    0250D E050      LDI	R21,0
    0250E E060      LDI	R22,0
    0250F E070      LDI	R23,0
    02510 8429      LDD	R2,Y+9
    02511 843A      LDD	R3,Y+10
    02512 844B      LDD	R4,Y+11
    02513 845C      LDD	R5,Y+12
    02514 1624      CP	R2,R20
    02515 0635      CPC	R3,R21
    02516 0646      CPC	R4,R22
    02517 0657      CPC	R5,R23
    02518 F449      BNE	0x2522
    02519 8D8B      LDD	R24,Y+27
    0251A 8D9C      LDD	R25,Y+28
    0251B 9604      ADIW	R24,4
    0251C 01FC      MOVW	R30,R24
    0251D 8180      LD	R24,Z
    0251E 6880      ORI	R24,0x80
    0251F 8380      ST	Z,R24
    02520 E002      LDI	R16,2
    02521 C206      RJMP	0x2728
(2518) 				if (clst == 0xFFFFFFFF) ABORT(fp->fs, FR_DISK_ERR);
    02522 EF4F      LDI	R20,0xFF
    02523 EF5F      LDI	R21,0xFF
    02524 EF6F      LDI	R22,0xFF
    02525 EF7F      LDI	R23,0xFF
    02526 8429      LDD	R2,Y+9
    02527 843A      LDD	R3,Y+10
    02528 844B      LDD	R4,Y+11
    02529 845C      LDD	R5,Y+12
    0252A 1624      CP	R2,R20
    0252B 0635      CPC	R3,R21
    0252C 0646      CPC	R4,R22
    0252D 0657      CPC	R5,R23
    0252E F451      BNE	0x2539
    0252F 8D8B      LDD	R24,Y+27
    02530 8D9C      LDD	R25,Y+28
    02531 9604      ADIW	R24,4
    02532 015C      MOVW	R10,R24
    02533 01FC      MOVW	R30,R24
    02534 8180      LD	R24,Z
    02535 6880      ORI	R24,0x80
    02536 8380      ST	Z,R24
    02537 E001      LDI	R16,1
    02538 C1EF      RJMP	0x2728
(2519) 				fp->clust = clst;			/* Update current cluster */
    02539 8429      LDD	R2,Y+9
    0253A 843A      LDD	R3,Y+10
    0253B 844B      LDD	R4,Y+11
    0253C 845C      LDD	R5,Y+12
    0253D 8DEB      LDD	R30,Y+27
    0253E 8DFC      LDD	R31,Y+28
    0253F 8A22      STD	Z+18,R2
    02540 8A33      STD	Z+19,R3
    02541 8A44      STD	Z+20,R4
    02542 8A55      STD	Z+21,R5
(2520) 			}
(2521) #if _FS_TINY
(2522) 			if (fp->fs->winsect == fp->dsect && move_window(fp->fs, 0))	/* Write-back sector cache */
    02543 8DEB      LDD	R30,Y+27
    02544 8DFC      LDD	R31,Y+28
    02545 80A0      LD	R10,Z
    02546 80B1      LDD	R11,Z+1
    02547 8826      LDD	R2,Z+22
    02548 8837      LDD	R3,Z+23
    02549 8C40      LDD	R4,Z+24
    0254A 8C51      LDD	R5,Z+25
    0254B 01F5      MOVW	R30,R10
    0254C A462      LDD	R6,Z+42
    0254D A473      LDD	R7,Z+43
    0254E A484      LDD	R8,Z+44
    0254F A495      LDD	R9,Z+45
    02550 1462      CP	R6,R2
    02551 0473      CPC	R7,R3
    02552 0484      CPC	R8,R4
    02553 0495      CPC	R9,R5
    02554 F4B9      BNE	0x256C
    02555 E040      LDI	R20,0
    02556 E050      LDI	R21,0
    02557 E060      LDI	R22,0
    02558 E070      LDI	R23,0
    02559 8368      ST	Y,R22
    0255A 8379      STD	Y+1,R23
    0255B 019A      MOVW	R18,R20
    0255C 018F      MOVW	R16,R30
    0255D 940E 0CAD CALL	ff.c:move_window
    0255F 2EA0      MOV	R10,R16
    02560 2300      TST	R16
    02561 F051      BEQ	0x256C
(2523) 				ABORT(fp->fs, FR_DISK_ERR);
    02562 8D8B      LDD	R24,Y+27
    02563 8D9C      LDD	R25,Y+28
    02564 9604      ADIW	R24,4
    02565 015C      MOVW	R10,R24
    02566 01FC      MOVW	R30,R24
    02567 8180      LD	R24,Z
    02568 6880      ORI	R24,0x80
    02569 8380      ST	Z,R24
    0256A E001      LDI	R16,1
    0256B C1BC      RJMP	0x2728
(2524) #else
(2525) 			if (fp->flag & FA__DIRTY) {		/* Write-back sector cache */
(2526) 				if (disk_write(fp->fs->drv, fp->buf, fp->dsect, 1) != RES_OK)
(2527) 					ABORT(fp->fs, FR_DISK_ERR);
(2528) 				fp->flag &= ~FA__DIRTY;
(2529) 			}
(2530) #endif
(2531) 			sect = clust2sect(fp->fs, fp->clust);	/* Get current sector */
    0256C 8DEB      LDD	R30,Y+27
    0256D 8DFC      LDD	R31,Y+28
    0256E 8822      LDD	R2,Z+18
    0256F 8833      LDD	R3,Z+19
    02570 8844      LDD	R4,Z+20
    02571 8855      LDD	R5,Z+21
    02572 8248      ST	Y,R4
    02573 8259      STD	Y+1,R5
    02574 0191      MOVW	R18,R2
    02575 8100      LD	R16,Z
    02576 8111      LDD	R17,Z+1
    02577 940E 0E24 CALL	_clust2sect
    02579 830D      STD	Y+5,R16
    0257A 831E      STD	Y+6,R17
    0257B 832F      STD	Y+7,R18
    0257C 8738      STD	Y+8,R19
(2532) 			if (!sect) ABORT(fp->fs, FR_INT_ERR);
    0257D 802D      LDD	R2,Y+5
    0257E 803E      LDD	R3,Y+6
    0257F 804F      LDD	R4,Y+7
    02580 8458      LDD	R5,Y+8
    02581 9488      BCLR	0
    02582 2022      TST	R2
    02583 0432      CPC	R3,R2
    02584 0442      CPC	R4,R2
    02585 0452      CPC	R5,R2
    02586 F451      BNE	0x2591
    02587 8D8B      LDD	R24,Y+27
    02588 8D9C      LDD	R25,Y+28
    02589 9604      ADIW	R24,4
    0258A 015C      MOVW	R10,R24
    0258B 01FC      MOVW	R30,R24
    0258C 8180      LD	R24,Z
    0258D 6880      ORI	R24,0x80
    0258E 8380      ST	Z,R24
    0258F E002      LDI	R16,2
    02590 C197      RJMP	0x2728
(2533) 			sect += csect;
    02591 2C2C      MOV	R2,R12
    02592 2433      CLR	R3
    02593 2444      CLR	R4
    02594 2455      CLR	R5
    02595 806D      LDD	R6,Y+5
    02596 807E      LDD	R7,Y+6
    02597 808F      LDD	R8,Y+7
    02598 8498      LDD	R9,Y+8
    02599 0C62      ADD	R6,R2
    0259A 1C73      ADC	R7,R3
    0259B 1C84      ADC	R8,R4
    0259C 1C95      ADC	R9,R5
    0259D 826D      STD	Y+5,R6
    0259E 827E      STD	Y+6,R7
    0259F 828F      STD	Y+7,R8
    025A0 8698      STD	Y+8,R9
(2534) 			cc = btw / SS(fp->fs);			/* When remaining bytes >= sector size, */
    025A1 E029      LDI	R18,0x9
    025A2 E030      LDI	R19,0
    025A3 8D0F      LDD	R16,Y+31
    025A4 A118      LDD	R17,Y+32
    025A5 940E 4C48 CALL	lsr16
    025A7 0158      MOVW	R10,R16
(2535) 			if (cc) {						/* Write maximum contiguous sectors directly */
    025A8 3000      CPI	R16,0
    025A9 0701      CPC	R16,R17
    025AA F409      BNE	0x25AC
    025AB C097      RJMP	0x2643
(2536) 				if (csect + cc > fp->fs->csize)	/* Clip at cluster boundary */
    025AC 2C2C      MOV	R2,R12
    025AD 2433      CLR	R3
    025AE 0E20      ADD	R2,R16
    025AF 1E31      ADC	R3,R17
    025B0 8DEB      LDD	R30,Y+27
    025B1 8DFC      LDD	R31,Y+28
    025B2 93AF      PUSH	R26
    025B3 93BF      PUSH	R27
    025B4 81A0      LD	R26,Z
    025B5 81B1      LDD	R27,Z+1
    025B6 01FD      MOVW	R30,R26
    025B7 91BF      POP	R27
    025B8 91AF      POP	R26
    025B9 8042      LDD	R4,Z+2
    025BA 2455      CLR	R5
    025BB 1442      CP	R4,R2
    025BC 0453      CPC	R5,R3
    025BD F478      BCC	0x25CD
(2537) 					cc = fp->fs->csize - csect;
    025BE 2C2C      MOV	R2,R12
    025BF 2433      CLR	R3
    025C0 8DEB      LDD	R30,Y+27
    025C1 8DFC      LDD	R31,Y+28
    025C2 93AF      PUSH	R26
    025C3 93BF      PUSH	R27
    025C4 81A0      LD	R26,Z
    025C5 81B1      LDD	R27,Z+1
    025C6 01FD      MOVW	R30,R26
    025C7 91BF      POP	R27
    025C8 91AF      POP	R26
    025C9 80A2      LDD	R10,Z+2
    025CA 24BB      CLR	R11
    025CB 18A2      SUB	R10,R2
    025CC 08B3      SBC	R11,R3
(2538) 				if (disk_write(fp->fs->drv,(char*)wbuff, sect, (BYTE)cc) != RES_OK)
    025CD 82AC      STD	Y+4,R10
    025CE 802D      LDD	R2,Y+5
    025CF 803E      LDD	R3,Y+6
    025D0 804F      LDD	R4,Y+7
    025D1 8458      LDD	R5,Y+8
    025D2 8228      ST	Y,R2
    025D3 8239      STD	Y+1,R3
    025D4 824A      STD	Y+2,R4
    025D5 825B      STD	Y+3,R5
    025D6 0197      MOVW	R18,R14
    025D7 8DEB      LDD	R30,Y+27
    025D8 8DFC      LDD	R31,Y+28
    025D9 93AF      PUSH	R26
    025DA 93BF      PUSH	R27
    025DB 81A0      LD	R26,Z
    025DC 81B1      LDD	R27,Z+1
    025DD 01FD      MOVW	R30,R26
    025DE 91BF      POP	R27
    025DF 91AF      POP	R26
    025E0 8101      LDD	R16,Z+1
    025E1 940E 0C32 CALL	_disk_write
    025E3 2EC0      MOV	R12,R16
    025E4 2300      TST	R16
    025E5 F051      BEQ	0x25F0
(2539) 					ABORT(fp->fs, FR_DISK_ERR);
    025E6 8D8B      LDD	R24,Y+27
    025E7 8D9C      LDD	R25,Y+28
    025E8 9604      ADIW	R24,4
    025E9 016C      MOVW	R12,R24
    025EA 01FC      MOVW	R30,R24
    025EB 8180      LD	R24,Z
    025EC 6880      ORI	R24,0x80
    025ED 8380      ST	Z,R24
    025EE E001      LDI	R16,1
    025EF C138      RJMP	0x2728
(2540) #if _FS_TINY
(2541) 				if (fp->fs->winsect - sect < cc) {	/* Refill sector cache if it gets invalidated by the direct write */
    025F0 802D      LDD	R2,Y+5
    025F1 803E      LDD	R3,Y+6
    025F2 804F      LDD	R4,Y+7
    025F3 8458      LDD	R5,Y+8
    025F4 8DEB      LDD	R30,Y+27
    025F5 8DFC      LDD	R31,Y+28
    025F6 81A0      LD	R26,Z
    025F7 81B1      LDD	R27,Z+1
    025F8 969A      ADIW	R26,0x2A
    025F9 906D      LD	R6,X+
    025FA 907D      LD	R7,X+
    025FB 908D      LD	R8,X+
    025FC 909C      LD	R9,X
    025FD 1862      SUB	R6,R2
    025FE 0873      SBC	R7,R3
    025FF 0884      SBC	R8,R4
    02600 0895      SBC	R9,R5
    02601 0115      MOVW	R2,R10
    02602 2444      CLR	R4
    02603 2455      CLR	R5
    02604 1462      CP	R6,R2
    02605 0473      CPC	R7,R3
    02606 0484      CPC	R8,R4
    02607 0495      CPC	R9,R5
    02608 F008      BCS	0x260A
    02609 C032      RJMP	0x263C
(2542) 					mem_cpy(fp->fs->win, wbuff + ((fp->fs->winsect - sect) * SS(fp->fs)), SS(fp->fs));
    0260A E080      LDI	R24,0
    0260B E092      LDI	R25,2
    0260C 8399      STD	Y+1,R25
    0260D 8388      ST	Y,R24
    0260E 80C0      LD	R12,Z
    0260F 80D1      LDD	R13,Z+1
    02610 802D      LDD	R2,Y+5
    02611 803E      LDD	R3,Y+6
    02612 804F      LDD	R4,Y+7
    02613 8458      LDD	R5,Y+8
    02614 01F6      MOVW	R30,R12
    02615 A462      LDD	R6,Z+42
    02616 A473      LDD	R7,Z+43
    02617 A484      LDD	R8,Z+44
    02618 A495      LDD	R9,Z+45
    02619 1862      SUB	R6,R2
    0261A 0873      SBC	R7,R3
    0261B 0884      SBC	R8,R4
    0261C 0895      SBC	R9,R5
    0261D E040      LDI	R20,0
    0261E E052      LDI	R21,2
    0261F E060      LDI	R22,0
    02620 E070      LDI	R23,0
    02621 929A      ST	-Y,R9
    02622 928A      ST	-Y,R8
    02623 927A      ST	-Y,R7
    02624 926A      ST	-Y,R6
    02625 018A      MOVW	R16,R20
    02626 019B      MOVW	R18,R22
    02627 940E 4B57 CALL	empy32s|empy32u
    02629 0198      MOVW	R18,R16
    0262A 0D2E      ADD	R18,R14
    0262B 1D3F      ADC	R19,R15
    0262C 0186      MOVW	R16,R12
    0262D 5D02      SUBI	R16,0xD2
    0262E 4F1F      SBCI	R17,0xFF
    0262F 940E 0C54 CALL	ff.c:mem_cpy
(2543) 					fp->fs->wflag = 0;
    02631 2422      CLR	R2
    02632 8DEB      LDD	R30,Y+27
    02633 8DFC      LDD	R31,Y+28
    02634 93AF      PUSH	R26
    02635 93BF      PUSH	R27
    02636 81A0      LD	R26,Z
    02637 81B1      LDD	R27,Z+1
    02638 01FD      MOVW	R30,R26
    02639 91BF      POP	R27
    0263A 91AF      POP	R26
    0263B 8224      STD	Z+4,R2
(2544) 				}
(2545) #else
(2546) 				if (fp->dsect - sect < cc) { /* Refill sector cache if it gets invalidated by the direct write */
(2547) 					mem_cpy(fp->buf, wbuff + ((fp->dsect - sect) * SS(fp->fs)), SS(fp->fs));
(2548) 					fp->flag &= ~FA__DIRTY;
(2549) 				}
(2550) #endif
(2551) 				wcnt = SS(fp->fs) * cc;		/* Number of bytes transferred */
    0263C E000      LDI	R16,0
    0263D E012      LDI	R17,2
    0263E 0195      MOVW	R18,R10
    0263F 940E 4B47 CALL	empy16s
    02641 0168      MOVW	R12,R16
(2552) 				continue;
    02642 C099      RJMP	0x26DC
(2553) 			}
(2554) #if _FS_TINY
(2555) 			if (fp->fptr >= fp->fsize) {	/* Avoid silly cache filling at growing edge */
    02643 8DEB      LDD	R30,Y+27
    02644 8DFC      LDD	R31,Y+28
    02645 8422      LDD	R2,Z+10
    02646 8433      LDD	R3,Z+11
    02647 8444      LDD	R4,Z+12
    02648 8455      LDD	R5,Z+13
    02649 8066      LDD	R6,Z+6
    0264A 8077      LDD	R7,Z+7
    0264B 8480      LDD	R8,Z+8
    0264C 8491      LDD	R9,Z+9
    0264D 1462      CP	R6,R2
    0264E 0473      CPC	R7,R3
    0264F 0484      CPC	R8,R4
    02650 0495      CPC	R9,R5
    02651 F128      BCS	0x2677
(2556) 				if (move_window(fp->fs, 0)) ABORT(fp->fs, FR_DISK_ERR);
    02652 E040      LDI	R20,0
    02653 E050      LDI	R21,0
    02654 E060      LDI	R22,0
    02655 E070      LDI	R23,0
    02656 8368      ST	Y,R22
    02657 8379      STD	Y+1,R23
    02658 019A      MOVW	R18,R20
    02659 8100      LD	R16,Z
    0265A 8111      LDD	R17,Z+1
    0265B 940E 0CAD CALL	ff.c:move_window
    0265D 2EA0      MOV	R10,R16
    0265E 2300      TST	R16
    0265F F051      BEQ	0x266A
    02660 8D8B      LDD	R24,Y+27
    02661 8D9C      LDD	R25,Y+28
    02662 9604      ADIW	R24,4
    02663 015C      MOVW	R10,R24
    02664 01FC      MOVW	R30,R24
    02665 8180      LD	R24,Z
    02666 6880      ORI	R24,0x80
    02667 8380      ST	Z,R24
    02668 E001      LDI	R16,1
    02669 C0BE      RJMP	0x2728
(2557) 				fp->fs->winsect = sect;
    0266A 802D      LDD	R2,Y+5
    0266B 803E      LDD	R3,Y+6
    0266C 804F      LDD	R4,Y+7
    0266D 8458      LDD	R5,Y+8
    0266E 8DEB      LDD	R30,Y+27
    0266F 8DFC      LDD	R31,Y+28
    02670 81A0      LD	R26,Z
    02671 81B1      LDD	R27,Z+1
    02672 969A      ADIW	R26,0x2A
    02673 922D      ST	X+,R2
    02674 923D      ST	X+,R3
    02675 924D      ST	X+,R4
    02676 925C      ST	X,R5
(2558) 			}
(2559) #else
(2560) 			if (fp->dsect != sect) {		/* Fill sector cache with file data */
(2561) 				if (fp->fptr < fp->fsize &&
(2562) 					disk_read(fp->fs->drv, fp->buf, sect, 1) != RES_OK)
(2563) 						ABORT(fp->fs, FR_DISK_ERR);
(2564) 			}
(2565) #endif
(2566) 			fp->dsect = sect;
    02677 802D      LDD	R2,Y+5
    02678 803E      LDD	R3,Y+6
    02679 804F      LDD	R4,Y+7
    0267A 8458      LDD	R5,Y+8
    0267B 8DEB      LDD	R30,Y+27
    0267C 8DFC      LDD	R31,Y+28
    0267D 8A26      STD	Z+22,R2
    0267E 8A37      STD	Z+23,R3
    0267F 8E40      STD	Z+24,R4
    02680 8E51      STD	Z+25,R5
(2567) 		}
(2568) 		wcnt = SS(fp->fs) - (fp->fptr % SS(fp->fs));/* Put partial sector into file I/O buffer */
    02681 EF4F      LDI	R20,0xFF
    02682 E051      LDI	R21,1
    02683 E060      LDI	R22,0
    02684 E070      LDI	R23,0
    02685 8DEB      LDD	R30,Y+27
    02686 8DFC      LDD	R31,Y+28
    02687 8026      LDD	R2,Z+6
    02688 8037      LDD	R3,Z+7
    02689 8440      LDD	R4,Z+8
    0268A 8451      LDD	R5,Z+9
    0268B 2224      AND	R2,R20
    0268C 2235      AND	R3,R21
    0268D 2246      AND	R4,R22
    0268E 2257      AND	R5,R23
    0268F E040      LDI	R20,0
    02690 E052      LDI	R21,2
    02691 E060      LDI	R22,0
    02692 E070      LDI	R23,0
    02693 1942      SUB	R20,R2
    02694 0953      SBC	R21,R3
    02695 0964      SBC	R22,R4
    02696 0975      SBC	R23,R5
    02697 016A      MOVW	R12,R20
(2569) 		if (wcnt > btw) wcnt = btw;
    02698 8C0F      LDD	R0,Y+31
    02699 A018      LDD	R1,Y+32
    0269A 1604      CP	R0,R20
    0269B 0615      CPC	R1,R21
    0269C F408      BCC	0x269E
    0269D 0160      MOVW	R12,R0
(2570) #if _FS_TINY
(2571) 		if (move_window(fp->fs, fp->dsect))	/* Move sector window */
    0269E 8DEB      LDD	R30,Y+27
    0269F 8DFC      LDD	R31,Y+28
    026A0 8826      LDD	R2,Z+22
    026A1 8837      LDD	R3,Z+23
    026A2 8C40      LDD	R4,Z+24
    026A3 8C51      LDD	R5,Z+25
    026A4 8248      ST	Y,R4
    026A5 8259      STD	Y+1,R5
    026A6 0191      MOVW	R18,R2
    026A7 8100      LD	R16,Z
    026A8 8111      LDD	R17,Z+1
    026A9 940E 0CAD CALL	ff.c:move_window
    026AB 2EA0      MOV	R10,R16
    026AC 2300      TST	R16
    026AD F051      BEQ	0x26B8
(2572) 			ABORT(fp->fs, FR_DISK_ERR);
    026AE 8D8B      LDD	R24,Y+27
    026AF 8D9C      LDD	R25,Y+28
    026B0 9604      ADIW	R24,4
    026B1 015C      MOVW	R10,R24
    026B2 01FC      MOVW	R30,R24
    026B3 8180      LD	R24,Z
    026B4 6880      ORI	R24,0x80
    026B5 8380      ST	Z,R24
    026B6 E001      LDI	R16,1
    026B7 C070      RJMP	0x2728
(2573) 		mem_cpy(&fp->fs->win[fp->fptr % SS(fp->fs)], wbuff, wcnt);	/* Fit partial sector */
    026B8 82D9      STD	Y+1,R13
    026B9 82C8      ST	Y,R12
    026BA 0197      MOVW	R18,R14
    026BB EF4F      LDI	R20,0xFF
    026BC E051      LDI	R21,1
    026BD E060      LDI	R22,0
    026BE E070      LDI	R23,0
    026BF 8DEB      LDD	R30,Y+27
    026C0 8DFC      LDD	R31,Y+28
    026C1 8026      LDD	R2,Z+6
    026C2 8037      LDD	R3,Z+7
    026C3 8440      LDD	R4,Z+8
    026C4 8451      LDD	R5,Z+9
    026C5 2224      AND	R2,R20
    026C6 2235      AND	R3,R21
    026C7 2246      AND	R4,R22
    026C8 2257      AND	R5,R23
    026C9 0181      MOVW	R16,R2
    026CA 8180      LD	R24,Z
    026CB 8191      LDD	R25,Z+1
    026CC 968E      ADIW	R24,0x2E
    026CD 0F08      ADD	R16,R24
    026CE 1F19      ADC	R17,R25
    026CF 940E 0C54 CALL	ff.c:mem_cpy
(2574) 		fp->fs->wflag = 1;
    026D1 E081      LDI	R24,1
    026D2 8DEB      LDD	R30,Y+27
    026D3 8DFC      LDD	R31,Y+28
    026D4 93AF      PUSH	R26
    026D5 93BF      PUSH	R27
    026D6 81A0      LD	R26,Z
    026D7 81B1      LDD	R27,Z+1
    026D8 01FD      MOVW	R30,R26
    026D9 91BF      POP	R27
    026DA 91AF      POP	R26
    026DB 8384      STD	Z+4,R24
    026DC 0CEC      ADD	R14,R12
    026DD 1CFD      ADC	R15,R13
    026DE 8D8B      LDD	R24,Y+27
    026DF 8D9C      LDD	R25,Y+28
    026E0 9606      ADIW	R24,6
    026E1 015C      MOVW	R10,R24
    026E2 0116      MOVW	R2,R12
    026E3 2444      CLR	R4
    026E4 2455      CLR	R5
    026E5 01FC      MOVW	R30,R24
    026E6 8060      LD	R6,Z
    026E7 8071      LDD	R7,Z+1
    026E8 8082      LDD	R8,Z+2
    026E9 8093      LDD	R9,Z+3
    026EA 0C62      ADD	R6,R2
    026EB 1C73      ADC	R7,R3
    026EC 1C84      ADC	R8,R4
    026ED 1C95      ADC	R9,R5
    026EE 8260      ST	Z,R6
    026EF 8271      STD	Z+1,R7
    026F0 8282      STD	Z+2,R8
    026F1 8293      STD	Z+3,R9
    026F2 A1E9      LDD	R30,Y+33
    026F3 A1FA      LDD	R31,Y+34
    026F4 8020      LD	R2,Z
    026F5 8031      LDD	R3,Z+1
    026F6 0C2C      ADD	R2,R12
    026F7 1C3D      ADC	R3,R13
    026F8 8231      STD	Z+1,R3
    026F9 8220      ST	Z,R2
    026FA 8C0F      LDD	R0,Y+31
    026FB A018      LDD	R1,Y+32
    026FC 180C      SUB	R0,R12
    026FD 081D      SBC	R1,R13
    026FE A218      STD	Y+32,R1
    026FF 8E0F      STD	Y+31,R0
    02700 8C0F      LDD	R0,Y+31
    02701 A018      LDD	R1,Y+32
    02702 2000      TST	R0
    02703 F009      BEQ	0x2705
    02704 CD5B      RJMP	0x2460
    02705 2011      TST	R1
    02706 F009      BEQ	0x2708
    02707 CD58      RJMP	0x2460
(2575) #else
(2576) 		mem_cpy(&fp->buf[fp->fptr % SS(fp->fs)], wbuff, wcnt);	/* Fit partial sector */
(2577) 		fp->flag |= FA__DIRTY;
(2578) #endif
(2579) 	}
(2580) 
(2581) 	if (fp->fptr > fp->fsize) fp->fsize = fp->fptr;	/* Update file size if needed */
    02708 8DEB      LDD	R30,Y+27
    02709 8DFC      LDD	R31,Y+28
    0270A 8422      LDD	R2,Z+10
    0270B 8433      LDD	R3,Z+11
    0270C 8444      LDD	R4,Z+12
    0270D 8455      LDD	R5,Z+13
    0270E 8066      LDD	R6,Z+6
    0270F 8077      LDD	R7,Z+7
    02710 8480      LDD	R8,Z+8
    02711 8491      LDD	R9,Z+9
    02712 1426      CP	R2,R6
    02713 0437      CPC	R3,R7
    02714 0448      CPC	R4,R8
    02715 0459      CPC	R5,R9
    02716 F440      BCC	0x271F
    02717 8026      LDD	R2,Z+6
    02718 8037      LDD	R3,Z+7
    02719 8440      LDD	R4,Z+8
    0271A 8451      LDD	R5,Z+9
    0271B 8622      STD	Z+10,R2
    0271C 8633      STD	Z+11,R3
    0271D 8644      STD	Z+12,R4
    0271E 8655      STD	Z+13,R5
(2582) 	fp->flag |= FA__WRITTEN;						/* Set file change flag */
    0271F 8D8B      LDD	R24,Y+27
    02720 8D9C      LDD	R25,Y+28
    02721 9604      ADIW	R24,4
    02722 015C      MOVW	R10,R24
    02723 01FC      MOVW	R30,R24
    02724 8180      LD	R24,Z
    02725 6280      ORI	R24,0x20
    02726 8380      ST	Z,R24
(2583) 
(2584) 	LEAVE_FF(fp->fs, FR_OK);
    02727 2700      CLR	R16
    02728 9661      ADIW	R28,0x11
    02729 940E 4BA0 CALL	pop_xgsetF0FC
    0272B 9624      ADIW	R28,4
    0272C 9508      RET
_f_sync:
  tim                  --> Y,+2
  dir                  --> R22
  res                  --> R10
  fp                   --> R20
    0272D 940E 4BE6 CALL	push_xgsetF03C
    0272F 01A8      MOVW	R20,R16
    02730 9726      SBIW	R28,6
(2585) }
(2586) 
(2587) 
(2588) 
(2589) 
(2590) /*-----------------------------------------------------------------------*/
(2591) /* Synchronize the File Object                                           */
(2592) /*-----------------------------------------------------------------------*/
(2593) 
(2594) FRESULT f_sync (
(2595) 	FIL *fp		/* Pointer to the file object */
(2596) )
(2597) {
(2598) 	FRESULT res;
(2599) 	DWORD tim;
(2600) 	BYTE *dir;
(2601) 
(2602) 
(2603) 	res = validate(fp->fs, fp->id);		/* Check validity of the object */
    02731 01FA      MOVW	R30,R20
    02732 8122      LDD	R18,Z+2
    02733 8133      LDD	R19,Z+3
    02734 8100      LD	R16,Z
    02735 8111      LDD	R17,Z+1
    02736 D88E      RCALL	ff.c:validate
    02737 2EA0      MOV	R10,R16
(2604) 	if (res == FR_OK) {
    02738 2300      TST	R16
    02739 F009      BEQ	0x273B
    0273A C09F      RJMP	0x27DA
(2605) 		if (fp->flag & FA__WRITTEN) {	/* Has the file been written? */
    0273B 01FA      MOVW	R30,R20
    0273C 8024      LDD	R2,Z+4
    0273D FE25      SBRS	R2,5
    0273E C09B      RJMP	0x27DA
(2606) #if !_FS_TINY	/* Write-back dirty buffer */
(2607) 			if (fp->flag & FA__DIRTY) {
(2608) 				if (disk_write(fp->fs->drv, fp->buf, fp->dsect, 1) != RES_OK)
(2609) 					LEAVE_FF(fp->fs, FR_DISK_ERR);
(2610) 				fp->flag &= ~FA__DIRTY;
(2611) 			}
(2612) #endif
(2613) 			/* Update the directory entry */
(2614) 			res = move_window(fp->fs, fp->dir_sect);
    0273F 8C22      LDD	R2,Z+26
    02740 8C33      LDD	R3,Z+27
    02741 8C44      LDD	R4,Z+28
    02742 8C55      LDD	R5,Z+29
    02743 8248      ST	Y,R4
    02744 8259      STD	Y+1,R5
    02745 0191      MOVW	R18,R2
    02746 8100      LD	R16,Z
    02747 8111      LDD	R17,Z+1
    02748 940E 0CAD CALL	ff.c:move_window
    0274A 2EA0      MOV	R10,R16
(2615) 			if (res == FR_OK) {
    0274B 2300      TST	R16
    0274C F009      BEQ	0x274E
    0274D C08C      RJMP	0x27DA
(2616) 				dir = fp->dir_ptr;
    0274E 01FA      MOVW	R30,R20
    0274F 8D66      LDD	R22,Z+30
    02750 8D77      LDD	R23,Z+31
(2617) 				dir[DIR_Attr] |= AM_ARC;					/* Set archive bit */
    02751 01CB      MOVW	R24,R22
    02752 960B      ADIW	R24,0xB
    02753 01FC      MOVW	R30,R24
    02754 8180      LD	R24,Z
    02755 6280      ORI	R24,0x20
    02756 8380      ST	Z,R24
(2618) 				ST_DWORD(dir+DIR_FileSize, fp->fsize);		/* Update file size */
    02757 01FA      MOVW	R30,R20
    02758 8422      LDD	R2,Z+10
    02759 8433      LDD	R3,Z+11
    0275A 8444      LDD	R4,Z+12
    0275B 8455      LDD	R5,Z+13
    0275C 01FB      MOVW	R30,R22
    0275D 8E24      STD	Z+28,R2
    0275E 01FA      MOVW	R30,R20
    0275F 8422      LDD	R2,Z+10
    02760 8433      LDD	R3,Z+11
    02761 2C23      MOV	R2,R3
    02762 2433      CLR	R3
    02763 01FB      MOVW	R30,R22
    02764 8E25      STD	Z+29,R2
    02765 01FA      MOVW	R30,R20
    02766 8422      LDD	R2,Z+10
    02767 8433      LDD	R3,Z+11
    02768 8444      LDD	R4,Z+12
    02769 8455      LDD	R5,Z+13
    0276A 0112      MOVW	R2,R4
    0276B 2444      CLR	R4
    0276C 2455      CLR	R5
    0276D 01FB      MOVW	R30,R22
    0276E 8E26      STD	Z+30,R2
    0276F E188      LDI	R24,0x18
    02770 E090      LDI	R25,0
    02771 01FA      MOVW	R30,R20
    02772 8502      LDD	R16,Z+10
    02773 8513      LDD	R17,Z+11
    02774 8524      LDD	R18,Z+12
    02775 8535      LDD	R19,Z+13
    02776 938A      ST	-Y,R24
    02777 940E 4C4F CALL	lsr32
    02779 01FB      MOVW	R30,R22
    0277A 8F07      STD	Z+31,R16
(2619) 				ST_CLUST(dir, fp->sclust);					/* Update start cluster */
    0277B 01FA      MOVW	R30,R20
    0277C 8426      LDD	R2,Z+14
    0277D 8437      LDD	R3,Z+15
    0277E 8840      LDD	R4,Z+16
    0277F 8851      LDD	R5,Z+17
    02780 01FB      MOVW	R30,R22
    02781 8E22      STD	Z+26,R2
    02782 01FA      MOVW	R30,R20
    02783 8426      LDD	R2,Z+14
    02784 8437      LDD	R3,Z+15
    02785 2C23      MOV	R2,R3
    02786 2433      CLR	R3
    02787 01FB      MOVW	R30,R22
    02788 8E23      STD	Z+27,R2
    02789 01FA      MOVW	R30,R20
    0278A 8426      LDD	R2,Z+14
    0278B 8437      LDD	R3,Z+15
    0278C 8840      LDD	R4,Z+16
    0278D 8851      LDD	R5,Z+17
    0278E 0112      MOVW	R2,R4
    0278F 2444      CLR	R4
    02790 2455      CLR	R5
    02791 01FB      MOVW	R30,R22
    02792 8A24      STD	Z+20,R2
    02793 01FA      MOVW	R30,R20
    02794 8426      LDD	R2,Z+14
    02795 8437      LDD	R3,Z+15
    02796 8840      LDD	R4,Z+16
    02797 8851      LDD	R5,Z+17
    02798 0112      MOVW	R2,R4
    02799 2C23      MOV	R2,R3
    0279A 2433      CLR	R3
    0279B 01FB      MOVW	R30,R22
    0279C 8A25      STD	Z+21,R2
(2620) 				tim = get_fattime();						/* Update updated time */
    0279D 940E 0C4F CALL	_get_fattime
    0279F 830A      STD	Y+2,R16
    027A0 831B      STD	Y+3,R17
    027A1 832C      STD	Y+4,R18
    027A2 833D      STD	Y+5,R19
(2621) 				ST_DWORD(dir+DIR_WrtTime, tim);
    027A3 802A      LDD	R2,Y+2
    027A4 803B      LDD	R3,Y+3
    027A5 804C      LDD	R4,Y+4
    027A6 805D      LDD	R5,Y+5
    027A7 01FB      MOVW	R30,R22
    027A8 8A26      STD	Z+22,R2
    027A9 2C23      MOV	R2,R3
    027AA 2433      CLR	R3
    027AB 9677      ADIW	R30,0x17
    027AC 8220      ST	Z,R2
    027AD 802A      LDD	R2,Y+2
    027AE 803B      LDD	R3,Y+3
    027AF 804C      LDD	R4,Y+4
    027B0 805D      LDD	R5,Y+5
    027B1 0112      MOVW	R2,R4
    027B2 2444      CLR	R4
    027B3 2455      CLR	R5
    027B4 01FB      MOVW	R30,R22
    027B5 9678      ADIW	R30,0x18
    027B6 8220      ST	Z,R2
    027B7 E188      LDI	R24,0x18
    027B8 E090      LDI	R25,0
    027B9 810A      LDD	R16,Y+2
    027BA 811B      LDD	R17,Y+3
    027BB 812C      LDD	R18,Y+4
    027BC 813D      LDD	R19,Y+5
    027BD 938A      ST	-Y,R24
    027BE 940E 4C4F CALL	lsr32
    027C0 01FB      MOVW	R30,R22
    027C1 8F01      STD	Z+25,R16
(2622) 				fp->flag &= ~FA__WRITTEN;
    027C2 01BA      MOVW	R22,R20
    027C3 5F6C      SUBI	R22,0xFC
    027C4 4F7F      SBCI	R23,0xFF
    027C5 01FB      MOVW	R30,R22
    027C6 8180      LD	R24,Z
    027C7 7D8F      ANDI	R24,0xDF
    027C8 8380      ST	Z,R24
(2623) 				fp->fs->wflag = 1;
    027C9 E081      LDI	R24,1
    027CA 01FA      MOVW	R30,R20
    027CB 93AF      PUSH	R26
    027CC 93BF      PUSH	R27
    027CD 81A0      LD	R26,Z
    027CE 81B1      LDD	R27,Z+1
    027CF 01FD      MOVW	R30,R26
    027D0 91BF      POP	R27
    027D1 91AF      POP	R26
    027D2 8384      STD	Z+4,R24
(2624) 				res = sync(fp->fs);
    027D3 01FA      MOVW	R30,R20
    027D4 8100      LD	R16,Z
    027D5 8111      LDD	R17,Z+1
    027D6 940E 0D4F CALL	ff.c:sync
    027D8 2EC0      MOV	R12,R16
    027D9 2CAC      MOV	R10,R12
(2625) 			}
(2626) 		}
(2627) 	}
(2628) 
(2629) 	LEAVE_FF(fp->fs, res);
    027DA 2D0A      MOV	R16,R10
    027DB 9626      ADIW	R28,6
    027DC 940C 4BEF JMP	pop_xgsetF03C
_f_close:
  res                  --> R10
  fp                   --> R12
    027DE 940E 4BB1 CALL	push_xgset003C
    027E0 0168      MOVW	R12,R16
(2630) }
(2631) 
(2632) #endif /* !_FS_READONLY */
(2633) 
(2634) 
(2635) 
(2636) 
(2637) /*-----------------------------------------------------------------------*/
(2638) /* Close File                                                            */
(2639) /*-----------------------------------------------------------------------*/
(2640) 
(2641) FRESULT f_close (
(2642) 	FIL *fp		/* Pointer to the file object to be closed */
(2643) )
(2644) {
(2645) 	FRESULT res;
(2646) 
(2647) #if _FS_READONLY
(2648) 	FATFS *fs = fp->fs;
(2649) 	res = validate(fs, fp->id);
(2650) 	if (res == FR_OK) fp->fs = 0;	/* Discard file object */
(2651) 	LEAVE_FF(fs, res);
(2652) 
(2653) #else
(2654) 	res = f_sync(fp);		/* Flush cached data */
    027E1 0186      MOVW	R16,R12
    027E2 DF4A      RCALL	_f_sync
    027E3 2EA0      MOV	R10,R16
(2655) #if _FS_SHARE
(2656) 	if (res == FR_OK) {		/* Decrement open counter */
(2657) #if _FS_REENTRANT
(2658) 		res = validate(fp->fs, fp->id);
(2659) 		if (res == FR_OK) {
(2660) 			res = dec_lock(fp->lockid);	
(2661) 			unlock_fs(fp->fs, FR_OK);
(2662) 		}
(2663) #else
(2664) 		res = dec_lock(fp->lockid);
(2665) #endif
(2666) 	}
(2667) #endif
(2668) 	if (res == FR_OK) fp->fs = 0;	/* Discard file object */
    027E4 2300      TST	R16
    027E5 F429      BNE	0x27EB
    027E6 2422      CLR	R2
    027E7 2433      CLR	R3
    027E8 01F6      MOVW	R30,R12
    027E9 8231      STD	Z+1,R3
    027EA 8220      ST	Z,R2
(2669) 	return res;
    027EB 2D0A      MOV	R16,R10
    027EC 940C 4B8B JMP	pop_xgset003C
_f_lseek:
  ifptr                --> Y,+14
  nsect                --> Y,+10
  bcs                  --> Y,+6
  clst                 --> Y,+2
  dsc                  --> Y,+26
  tlen                 --> Y,+22
  tbl                  --> R14
  tcl                  --> Y,+18
  ulen                 --> Y,+14
  ncl                  --> Y,+10
  pcl                  --> Y,+6
  cl                   --> Y,+2
  res                  --> R10
  ofs                  --> Y,+42
  fp                   --> Y,+40
    027EE 940E 4A66 CALL	push_arg4
    027F0 940E 4BAB CALL	push_xgsetF0FC
    027F2 976E      SBIW	R28,0x1E
(2670) #endif
(2671) }
(2672) 
(2673) 
(2674) 
(2675) 
(2676) /*-----------------------------------------------------------------------*/
(2677) /* Current Drive/Directory Handlings                                     */
(2678) /*-----------------------------------------------------------------------*/
(2679) 
(2680) #if _FS_RPATH >= 1
(2681) 
(2682) FRESULT f_chdrive (
(2683) 	BYTE drv		/* Drive number */
(2684) )
(2685) {
(2686) 	if (drv >= _VOLUMES) return FR_INVALID_DRIVE;
(2687) 
(2688) 	CurrVol = drv;
(2689) 
(2690) 	return FR_OK;
(2691) }
(2692) 
(2693) 
(2694) 
(2695) FRESULT f_chdir (
(2696) 	const TCHAR *path	/* Pointer to the directory path */
(2697) )
(2698) {
(2699) 	FRESULT res;
(2700) 	DIR dj;
(2701) 	DEF_NAMEBUF;
(2702) 
(2703) 
(2704) 	res = chk_mounted(&path, &dj.fs, 0);
(2705) 	if (res == FR_OK) {
(2706) 		INIT_BUF(dj);
(2707) 		res = follow_path(&dj, path);		/* Follow the path */
(2708) 		FREE_BUF();
(2709) 		if (res == FR_OK) {					/* Follow completed */
(2710) 			if (!dj.dir) {
(2711) 				dj.fs->cdir = dj.sclust;	/* Start directory itself */
(2712) 			} else {
(2713) 				if (dj.dir[DIR_Attr] & AM_DIR)	/* Reached to the directory */
(2714) 					dj.fs->cdir = LD_CLUST(dj.dir);
(2715) 				else
(2716) 					res = FR_NO_PATH;		/* Reached but a file */
(2717) 			}
(2718) 		}
(2719) 		if (res == FR_NO_FILE) res = FR_NO_PATH;
(2720) 	}
(2721) 
(2722) 	LEAVE_FF(dj.fs, res);
(2723) }
(2724) 
(2725) 
(2726) #if _FS_RPATH >= 2
(2727) FRESULT f_getcwd (
(2728) 	TCHAR *path,	/* Pointer to the directory path */
(2729) 	UINT sz_path	/* Size of path */
(2730) )
(2731) {
(2732) 	FRESULT res;
(2733) 	DIR dj;
(2734) 	UINT i, n;
(2735) 	DWORD ccl;
(2736) 	TCHAR *tp;
(2737) 	FILINFO fno;
(2738) 	DEF_NAMEBUF;
(2739) 
(2740) 
(2741) 	*path = 0;
(2742) 	res = chk_mounted((const TCHAR**)&path, &dj.fs, 0);	/* Get current volume */
(2743) 	if (res == FR_OK) {
(2744) 		INIT_BUF(dj);
(2745) 		i = sz_path;		/* Bottom of buffer (dir stack base) */
(2746) 		dj.sclust = dj.fs->cdir;			/* Start to follow upper dir from current dir */
(2747) 		while ((ccl = dj.sclust) != 0) {	/* Repeat while current dir is a sub-dir */
(2748) 			res = dir_sdi(&dj, 1);			/* Get parent dir */
(2749) 			if (res != FR_OK) break;
(2750) 			res = dir_read(&dj);
(2751) 			if (res != FR_OK) break;
(2752) 			dj.sclust = LD_CLUST(dj.dir);	/* Goto parent dir */
(2753) 			res = dir_sdi(&dj, 0);
(2754) 			if (res != FR_OK) break;
(2755) 			do {							/* Find the entry links to the child dir */
(2756) 				res = dir_read(&dj);
(2757) 				if (res != FR_OK) break;
(2758) 				if (ccl == LD_CLUST(dj.dir)) break;	/* Found the entry */
(2759) 				res = dir_next(&dj, 0);	
(2760) 			} while (res == FR_OK);
(2761) 			if (res == FR_NO_FILE) res = FR_INT_ERR;/* It cannot be 'not found'. */
(2762) 			if (res != FR_OK) break;
(2763) #if _USE_LFN
(2764) 			fno.lfname = path;
(2765) 			fno.lfsize = i;
(2766) #endif
(2767) 			get_fileinfo(&dj, &fno);		/* Get the dir name and push it to the buffer */
(2768) 			tp = fno.fname;
(2769) 			if (_USE_LFN && *path) tp = path;
(2770) 			for (n = 0; tp[n]; n++) ;
(2771) 			if (i < n + 3) {
(2772) 				res = FR_NOT_ENOUGH_CORE; break;
(2773) 			}
(2774) 			while (n) path[--i] = tp[--n];
(2775) 			path[--i] = '/';
(2776) 		}
(2777) 		tp = path;
(2778) 		if (res == FR_OK) {
(2779) 			*tp++ = '0' + CurrVol;			/* Put drive number */
(2780) 			*tp++ = ':';
(2781) 			if (i == sz_path) {				/* Root-dir */
(2782) 				*tp++ = '/';
(2783) 			} else {						/* Sub-dir */
(2784) 				do		/* Add stacked path str */
(2785) 					*tp++ = path[i++];
(2786) 				while (i < sz_path);
(2787) 			}
(2788) 		}
(2789) 		*tp = 0;
(2790) 		FREE_BUF();
(2791) 	}
(2792) 
(2793) 	LEAVE_FF(dj.fs, res);
(2794) }
(2795) #endif /* _FS_RPATH >= 2 */
(2796) #endif /* _FS_RPATH >= 1 */
(2797) 
(2798) 
(2799) 
(2800) #if _FS_MINIMIZE <= 2
(2801) /*-----------------------------------------------------------------------*/
(2802) /* Seek File R/W Pointer                                                 */
(2803) /*-----------------------------------------------------------------------*/
(2804) 
(2805) FRESULT f_lseek (
(2806) 	FIL *fp,		/* Pointer to the file object */
(2807) 	DWORD ofs		/* File pointer from top of file */
(2808) )
(2809) {
(2810) 	FRESULT res;
(2811) 
(2812) 
(2813) 	res = validate(fp->fs, fp->id);		/* Check validity of the object */
    027F3 A5E8      LDD	R30,Y+40
    027F4 A5F9      LDD	R31,Y+41
    027F5 8122      LDD	R18,Z+2
    027F6 8133      LDD	R19,Z+3
    027F7 8100      LD	R16,Z
    027F8 8111      LDD	R17,Z+1
    027F9 940E 1FC5 CALL	ff.c:validate
    027FB 2EA0      MOV	R10,R16
(2814) 	if (res != FR_OK) LEAVE_FF(fp->fs, res);
    027FC 2300      TST	R16
    027FD F009      BEQ	0x27FF
    027FE C4A7      RJMP	0x2CA6
(2815) 	if (fp->flag & FA__ERROR)			/* Check abort flag */
    027FF A5E8      LDD	R30,Y+40
    02800 A5F9      LDD	R31,Y+41
    02801 8024      LDD	R2,Z+4
    02802 FE27      SBRS	R2,7
    02803 C002      RJMP	0x2806
(2816) 		LEAVE_FF(fp->fs, FR_INT_ERR);
    02804 E002      LDI	R16,2
    02805 C4A0      RJMP	0x2CA6
(2817) 
(2818) #if _USE_FASTSEEK
(2819) 	if (fp->cltbl) {	/* Fast seek */
    02806 A5E8      LDD	R30,Y+40
    02807 A5F9      LDD	R31,Y+41
    02808 96B0      ADIW	R30,0x20
    02809 8020      LD	R2,Z
    0280A 8031      LDD	R3,Z+1
    0280B 2022      TST	R2
    0280C F419      BNE	0x2810
    0280D 2033      TST	R3
    0280E F409      BNE	0x2810
    0280F C1E3      RJMP	0x29F3
(2820) 		DWORD cl, pcl, ncl, tcl, dsc, tlen, ulen, *tbl;
(2821) 
(2822) 		if (ofs == CREATE_LINKMAP) {	/* Create CLMT */
    02810 EF4F      LDI	R20,0xFF
    02811 EF5F      LDI	R21,0xFF
    02812 EF6F      LDI	R22,0xFF
    02813 EF7F      LDI	R23,0xFF
    02814 A42A      LDD	R2,Y+42
    02815 A43B      LDD	R3,Y+43
    02816 A44C      LDD	R4,Y+44
    02817 A45D      LDD	R5,Y+45
    02818 1624      CP	R2,R20
    02819 0635      CPC	R3,R21
    0281A 0646      CPC	R4,R22
    0281B 0657      CPC	R5,R23
    0281C F009      BEQ	0x281E
    0281D C109      RJMP	0x2927
(2823) 			tbl = fp->cltbl;
    0281E A5E8      LDD	R30,Y+40
    0281F A5F9      LDD	R31,Y+41
    02820 A0E0      LDD	R14,Z+32
    02821 A0F1      LDD	R15,Z+33
(2824) 			tlen = *tbl++; ulen = 2;	/* Given table size and required table size */
    02822 01F7      MOVW	R30,R14
    02823 9021      LD	R2,Z+
    02824 9031      LD	R3,Z+
    02825 9041      LD	R4,Z+
    02826 9051      LD	R5,Z+
    02827 017F      MOVW	R14,R30
    02828 8A2E      STD	Y+22,R2
    02829 8A3F      STD	Y+23,R3
    0282A 8E48      STD	Y+24,R4
    0282B 8E59      STD	Y+25,R5
    0282C E082      LDI	R24,2
    0282D 878E      STD	Y+14,R24
    0282E E080      LDI	R24,0
    0282F 878F      STD	Y+15,R24
    02830 8B88      STD	Y+16,R24
    02831 8B89      STD	Y+17,R24
(2825) 			cl = fp->sclust;			/* Top of the chain */
    02832 A5E8      LDD	R30,Y+40
    02833 A5F9      LDD	R31,Y+41
    02834 963E      ADIW	R30,0xE
    02835 8020      LD	R2,Z
    02836 8031      LDD	R3,Z+1
    02837 8042      LDD	R4,Z+2
    02838 8053      LDD	R5,Z+3
    02839 822A      STD	Y+2,R2
    0283A 823B      STD	Y+3,R3
    0283B 824C      STD	Y+4,R4
    0283C 825D      STD	Y+5,R5
(2826) 			if (cl) {
    0283D 802A      LDD	R2,Y+2
    0283E 803B      LDD	R3,Y+3
    0283F 804C      LDD	R4,Y+4
    02840 805D      LDD	R5,Y+5
    02841 9488      BCLR	0
    02842 2022      TST	R2
    02843 0432      CPC	R3,R2
    02844 0442      CPC	R4,R2
    02845 0452      CPC	R5,R2
    02846 F409      BNE	0x2848
    02847 C0BB      RJMP	0x2903
(2827) 				do {
(2828) 					/* Get a fragment */
(2829) 					tcl = cl; ncl = 0; ulen += 2;	/* Top, length and used items */
    02848 802A      LDD	R2,Y+2
    02849 803B      LDD	R3,Y+3
    0284A 804C      LDD	R4,Y+4
    0284B 805D      LDD	R5,Y+5
    0284C 8A2A      STD	Y+18,R2
    0284D 8A3B      STD	Y+19,R3
    0284E 8A4C      STD	Y+20,R4
    0284F 8A5D      STD	Y+21,R5
    02850 E080      LDI	R24,0
    02851 878A      STD	Y+10,R24
    02852 878B      STD	Y+11,R24
    02853 878C      STD	Y+12,R24
    02854 878D      STD	Y+13,R24
    02855 E042      LDI	R20,2
    02856 E050      LDI	R21,0
    02857 E060      LDI	R22,0
    02858 E070      LDI	R23,0
    02859 842E      LDD	R2,Y+14
    0285A 843F      LDD	R3,Y+15
    0285B 8848      LDD	R4,Y+16
    0285C 8859      LDD	R5,Y+17
    0285D 0E24      ADD	R2,R20
    0285E 1E35      ADC	R3,R21
    0285F 1E46      ADC	R4,R22
    02860 1E57      ADC	R5,R23
    02861 862E      STD	Y+14,R2
    02862 863F      STD	Y+15,R3
    02863 8A48      STD	Y+16,R4
    02864 8A59      STD	Y+17,R5
(2830) 					do {
(2831) 						pcl = cl; ncl++;
    02865 802A      LDD	R2,Y+2
    02866 803B      LDD	R3,Y+3
    02867 804C      LDD	R4,Y+4
    02868 805D      LDD	R5,Y+5
    02869 822E      STD	Y+6,R2
    0286A 823F      STD	Y+7,R3
    0286B 8648      STD	Y+8,R4
    0286C 8659      STD	Y+9,R5
    0286D E041      LDI	R20,1
    0286E E050      LDI	R21,0
    0286F E060      LDI	R22,0
    02870 E070      LDI	R23,0
    02871 842A      LDD	R2,Y+10
    02872 843B      LDD	R3,Y+11
    02873 844C      LDD	R4,Y+12
    02874 845D      LDD	R5,Y+13
    02875 0E24      ADD	R2,R20
    02876 1E35      ADC	R3,R21
    02877 1E46      ADC	R4,R22
    02878 1E57      ADC	R5,R23
    02879 862A      STD	Y+10,R2
    0287A 863B      STD	Y+11,R3
    0287B 864C      STD	Y+12,R4
    0287C 865D      STD	Y+13,R5
(2832) 						cl = get_fat(fp->fs, cl);
    0287D 802A      LDD	R2,Y+2
    0287E 803B      LDD	R3,Y+3
    0287F 804C      LDD	R4,Y+4
    02880 805D      LDD	R5,Y+5
    02881 8248      ST	Y,R4
    02882 8259      STD	Y+1,R5
    02883 0191      MOVW	R18,R2
    02884 A5E8      LDD	R30,Y+40
    02885 A5F9      LDD	R31,Y+41
    02886 8100      LD	R16,Z
    02887 8111      LDD	R17,Z+1
    02888 940E 0E76 CALL	_get_fat
    0288A 830A      STD	Y+2,R16
    0288B 831B      STD	Y+3,R17
    0288C 832C      STD	Y+4,R18
    0288D 833D      STD	Y+5,R19
(2833) 						if (cl <= 1) ABORT(fp->fs, FR_INT_ERR);
    0288E E041      LDI	R20,1
    0288F E050      LDI	R21,0
    02890 E060      LDI	R22,0
    02891 E070      LDI	R23,0
    02892 802A      LDD	R2,Y+2
    02893 803B      LDD	R3,Y+3
    02894 804C      LDD	R4,Y+4
    02895 805D      LDD	R5,Y+5
    02896 1542      CP	R20,R2
    02897 0553      CPC	R21,R3
    02898 0564      CPC	R22,R4
    02899 0575      CPC	R23,R5
    0289A F048      BCS	0x28A4
    0289B A588      LDD	R24,Y+40
    0289C A599      LDD	R25,Y+41
    0289D 9604      ADIW	R24,4
    0289E 01FC      MOVW	R30,R24
    0289F 8180      LD	R24,Z
    028A0 6880      ORI	R24,0x80
    028A1 8380      ST	Z,R24
    028A2 E002      LDI	R16,2
    028A3 C402      RJMP	0x2CA6
(2834) 						if (cl == 0xFFFFFFFF) ABORT(fp->fs, FR_DISK_ERR);
    028A4 EF4F      LDI	R20,0xFF
    028A5 EF5F      LDI	R21,0xFF
    028A6 EF6F      LDI	R22,0xFF
    028A7 EF7F      LDI	R23,0xFF
    028A8 802A      LDD	R2,Y+2
    028A9 803B      LDD	R3,Y+3
    028AA 804C      LDD	R4,Y+4
    028AB 805D      LDD	R5,Y+5
    028AC 1624      CP	R2,R20
    028AD 0635      CPC	R3,R21
    028AE 0646      CPC	R4,R22
    028AF 0657      CPC	R5,R23
    028B0 F451      BNE	0x28BB
    028B1 A588      LDD	R24,Y+40
    028B2 A599      LDD	R25,Y+41
    028B3 9604      ADIW	R24,4
    028B4 016C      MOVW	R12,R24
    028B5 01FC      MOVW	R30,R24
    028B6 8180      LD	R24,Z
    028B7 6880      ORI	R24,0x80
    028B8 8380      ST	Z,R24
    028B9 E001      LDI	R16,1
    028BA C3EB      RJMP	0x2CA6
(2835) 					} while (cl == pcl + 1);
    028BB E041      LDI	R20,1
    028BC E050      LDI	R21,0
    028BD E060      LDI	R22,0
    028BE E070      LDI	R23,0
    028BF 802E      LDD	R2,Y+6
    028C0 803F      LDD	R3,Y+7
    028C1 8448      LDD	R4,Y+8
    028C2 8459      LDD	R5,Y+9
    028C3 0E24      ADD	R2,R20
    028C4 1E35      ADC	R3,R21
    028C5 1E46      ADC	R4,R22
    028C6 1E57      ADC	R5,R23
    028C7 806A      LDD	R6,Y+2
    028C8 807B      LDD	R7,Y+3
    028C9 808C      LDD	R8,Y+4
    028CA 809D      LDD	R9,Y+5
    028CB 1462      CP	R6,R2
    028CC 0473      CPC	R7,R3
    028CD 0484      CPC	R8,R4
    028CE 0495      CPC	R9,R5
    028CF F409      BNE	0x28D1
    028D0 CF94      RJMP	0x2865
(2836) 					if (ulen <= tlen) {		/* Store the length and top of the fragment */
    028D1 882E      LDD	R2,Y+22
    028D2 883F      LDD	R3,Y+23
    028D3 8C48      LDD	R4,Y+24
    028D4 8C59      LDD	R5,Y+25
    028D5 846E      LDD	R6,Y+14
    028D6 847F      LDD	R7,Y+15
    028D7 8888      LDD	R8,Y+16
    028D8 8899      LDD	R9,Y+17
    028D9 1426      CP	R2,R6
    028DA 0437      CPC	R3,R7
    028DB 0448      CPC	R4,R8
    028DC 0459      CPC	R5,R9
    028DD F090      BCS	0x28F0
(2837) 						*tbl++ = ncl; *tbl++ = tcl;
    028DE 842A      LDD	R2,Y+10
    028DF 843B      LDD	R3,Y+11
    028E0 844C      LDD	R4,Y+12
    028E1 845D      LDD	R5,Y+13
    028E2 01F7      MOVW	R30,R14
    028E3 9221      ST	Z+,R2
    028E4 9231      ST	Z+,R3
    028E5 9241      ST	Z+,R4
    028E6 9251      ST	Z+,R5
    028E7 882A      LDD	R2,Y+18
    028E8 883B      LDD	R3,Y+19
    028E9 884C      LDD	R4,Y+20
    028EA 885D      LDD	R5,Y+21
    028EB 9221      ST	Z+,R2
    028EC 9231      ST	Z+,R3
    028ED 9241      ST	Z+,R4
    028EE 9251      ST	Z+,R5
    028EF 017F      MOVW	R14,R30
(2838) 					}
(2839) 				} while (cl < fp->fs->n_fatent);	/* Repeat until end of chain */
    028F0 A5E8      LDD	R30,Y+40
    028F1 A5F9      LDD	R31,Y+41
    028F2 81A0      LD	R26,Z
    028F3 81B1      LDD	R27,Z+1
    028F4 9656      ADIW	R26,0x16
    028F5 902D      LD	R2,X+
    028F6 903D      LD	R3,X+
    028F7 904D      LD	R4,X+
    028F8 905C      LD	R5,X
    028F9 806A      LDD	R6,Y+2
    028FA 807B      LDD	R7,Y+3
    028FB 808C      LDD	R8,Y+4
    028FC 809D      LDD	R9,Y+5
    028FD 1462      CP	R6,R2
    028FE 0473      CPC	R7,R3
    028FF 0484      CPC	R8,R4
    02900 0495      CPC	R9,R5
    02901 F408      BCC	0x2903
    02902 CF45      RJMP	0x2848
(2840) 			}
(2841) 			*fp->cltbl = ulen;	/* Number of items used */
    02903 842E      LDD	R2,Y+14
    02904 843F      LDD	R3,Y+15
    02905 8848      LDD	R4,Y+16
    02906 8859      LDD	R5,Y+17
    02907 A5E8      LDD	R30,Y+40
    02908 A5F9      LDD	R31,Y+41
    02909 96B0      ADIW	R30,0x20
    0290A 81A0      LD	R26,Z
    0290B 81B1      LDD	R27,Z+1
    0290C 922D      ST	X+,R2
    0290D 923D      ST	X+,R3
    0290E 924D      ST	X+,R4
    0290F 925C      ST	X,R5
(2842) 			if (ulen <= tlen)
    02910 882E      LDD	R2,Y+22
    02911 883F      LDD	R3,Y+23
    02912 8C48      LDD	R4,Y+24
    02913 8C59      LDD	R5,Y+25
    02914 846E      LDD	R6,Y+14
    02915 847F      LDD	R7,Y+15
    02916 8888      LDD	R8,Y+16
    02917 8899      LDD	R9,Y+17
    02918 1426      CP	R2,R6
    02919 0437      CPC	R3,R7
    0291A 0448      CPC	R4,R8
    0291B 0459      CPC	R5,R9
    0291C F038      BCS	0x2924
(2843) 				*tbl = 0;		/* Terminate table */
    0291D 01F7      MOVW	R30,R14
    0291E E080      LDI	R24,0
    0291F 8380      ST	Z,R24
    02920 8381      STD	Z+1,R24
    02921 8382      STD	Z+2,R24
    02922 8383      STD	Z+3,R24
    02923 C381      RJMP	0x2CA5
(2844) 			else
(2845) 				res = FR_NOT_ENOUGH_CORE;	/* Given table size is smaller than required */
    02924 E181      LDI	R24,0x11
    02925 2EA8      MOV	R10,R24
(2846) 
(2847) 		} else {						/* Fast seek */
    02926 C37E      RJMP	0x2CA5
(2848) 			if (ofs > fp->fsize)		/* Clip offset at the file size */
    02927 A5E8      LDD	R30,Y+40
    02928 A5F9      LDD	R31,Y+41
    02929 963A      ADIW	R30,0xA
    0292A 8020      LD	R2,Z
    0292B 8031      LDD	R3,Z+1
    0292C 8042      LDD	R4,Z+2
    0292D 8053      LDD	R5,Z+3
    0292E A46A      LDD	R6,Y+42
    0292F A47B      LDD	R7,Y+43
    02930 A48C      LDD	R8,Y+44
    02931 A49D      LDD	R9,Y+45
    02932 1426      CP	R2,R6
    02933 0437      CPC	R3,R7
    02934 0448      CPC	R4,R8
    02935 0459      CPC	R5,R9
    02936 F458      BCC	0x2942
(2849) 				ofs = fp->fsize;
    02937 A5E8      LDD	R30,Y+40
    02938 A5F9      LDD	R31,Y+41
    02939 963A      ADIW	R30,0xA
    0293A 8020      LD	R2,Z
    0293B 8031      LDD	R3,Z+1
    0293C 8042      LDD	R4,Z+2
    0293D 8053      LDD	R5,Z+3
    0293E A62A      STD	Y+42,R2
    0293F A63B      STD	Y+43,R3
    02940 A64C      STD	Y+44,R4
    02941 A65D      STD	Y+45,R5
(2850) 			fp->fptr = ofs;				/* Set file pointer */
    02942 A42A      LDD	R2,Y+42
    02943 A43B      LDD	R3,Y+43
    02944 A44C      LDD	R4,Y+44
    02945 A45D      LDD	R5,Y+45
    02946 A5E8      LDD	R30,Y+40
    02947 A5F9      LDD	R31,Y+41
    02948 9636      ADIW	R30,6
    02949 8220      ST	Z,R2
    0294A 8231      STD	Z+1,R3
    0294B 8242      STD	Z+2,R4
    0294C 8253      STD	Z+3,R5
(2851) 			if (ofs) {
    0294D 9488      BCLR	0
    0294E 2022      TST	R2
    0294F 0432      CPC	R3,R2
    02950 0442      CPC	R4,R2
    02951 0452      CPC	R5,R2
    02952 F409      BNE	0x2954
    02953 C351      RJMP	0x2CA5
(2852) 				fp->clust = clmt_clust(fp, ofs - 1);
    02954 E041      LDI	R20,1
    02955 E050      LDI	R21,0
    02956 E060      LDI	R22,0
    02957 E070      LDI	R23,0
    02958 1A24      SUB	R2,R20
    02959 0A35      SBC	R3,R21
    0295A 0A46      SBC	R4,R22
    0295B 0A57      SBC	R5,R23
    0295C 8248      ST	Y,R4
    0295D 8259      STD	Y+1,R5
    0295E 0191      MOVW	R18,R2
    0295F A508      LDD	R16,Y+40
    02960 A519      LDD	R17,Y+41
    02961 940E 13B0 CALL	ff.c:clmt_clust
    02963 A5E8      LDD	R30,Y+40
    02964 A5F9      LDD	R31,Y+41
    02965 8B02      STD	Z+18,R16
    02966 8B13      STD	Z+19,R17
    02967 8B24      STD	Z+20,R18
    02968 8B35      STD	Z+21,R19
(2853) 				dsc = clust2sect(fp->fs, fp->clust);
    02969 8822      LDD	R2,Z+18
    0296A 8833      LDD	R3,Z+19
    0296B 8844      LDD	R4,Z+20
    0296C 8855      LDD	R5,Z+21
    0296D 8248      ST	Y,R4
    0296E 8259      STD	Y+1,R5
    0296F 0191      MOVW	R18,R2
    02970 8100      LD	R16,Z
    02971 8111      LDD	R17,Z+1
    02972 940E 0E24 CALL	_clust2sect
    02974 8F0A      STD	Y+26,R16
    02975 8F1B      STD	Y+27,R17
    02976 8F2C      STD	Y+28,R18
    02977 8F3D      STD	Y+29,R19
(2854) 				if (!dsc) ABORT(fp->fs, FR_INT_ERR);
    02978 8C2A      LDD	R2,Y+26
    02979 8C3B      LDD	R3,Y+27
    0297A 8C4C      LDD	R4,Y+28
    0297B 8C5D      LDD	R5,Y+29
    0297C 9488      BCLR	0
    0297D 2022      TST	R2
    0297E 0432      CPC	R3,R2
    0297F 0442      CPC	R4,R2
    02980 0452      CPC	R5,R2
    02981 F451      BNE	0x298C
    02982 A588      LDD	R24,Y+40
    02983 A599      LDD	R25,Y+41
    02984 9604      ADIW	R24,4
    02985 017C      MOVW	R14,R24
    02986 01FC      MOVW	R30,R24
    02987 8180      LD	R24,Z
    02988 6880      ORI	R24,0x80
    02989 8380      ST	Z,R24
    0298A E002      LDI	R16,2
    0298B C31A      RJMP	0x2CA6
(2855) 				dsc += (ofs - 1) / SS(fp->fs) & (fp->fs->csize - 1);
    0298C E041      LDI	R20,1
    0298D E050      LDI	R21,0
    0298E E060      LDI	R22,0
    0298F E070      LDI	R23,0
    02990 A50A      LDD	R16,Y+42
    02991 A51B      LDD	R17,Y+43
    02992 A52C      LDD	R18,Y+44
    02993 A53D      LDD	R19,Y+45
    02994 1B04      SUB	R16,R20
    02995 0B15      SBC	R17,R21
    02996 0B26      SBC	R18,R22
    02997 0B37      SBC	R19,R23
    02998 E089      LDI	R24,0x9
    02999 E090      LDI	R25,0
    0299A 938A      ST	-Y,R24
    0299B 940E 4C4F CALL	lsr32
    0299D 0118      MOVW	R2,R16
    0299E 0129      MOVW	R4,R18
    0299F A5E8      LDD	R30,Y+40
    029A0 A5F9      LDD	R31,Y+41
    029A1 93AF      PUSH	R26
    029A2 93BF      PUSH	R27
    029A3 81A0      LD	R26,Z
    029A4 81B1      LDD	R27,Z+1
    029A5 01FD      MOVW	R30,R26
    029A6 91BF      POP	R27
    029A7 91AF      POP	R26
    029A8 9632      ADIW	R30,2
    029A9 8180      LD	R24,Z
    029AA 2799      CLR	R25
    029AB 9701      SBIW	R24,1
    029AC 013C      MOVW	R6,R24
    029AD 2488      CLR	R8
    029AE FC77      SBRC	R7,7
    029AF 9480      COM	R8
    029B0 2499      CLR	R9
    029B1 FC87      SBRC	R8,7
    029B2 9490      COM	R9
    029B3 2026      AND	R2,R6
    029B4 2037      AND	R3,R7
    029B5 2048      AND	R4,R8
    029B6 2059      AND	R5,R9
    029B7 8C6A      LDD	R6,Y+26
    029B8 8C7B      LDD	R7,Y+27
    029B9 8C8C      LDD	R8,Y+28
    029BA 8C9D      LDD	R9,Y+29
    029BB 0C62      ADD	R6,R2
    029BC 1C73      ADC	R7,R3
    029BD 1C84      ADC	R8,R4
    029BE 1C95      ADC	R9,R5
    029BF 8E6A      STD	Y+26,R6
    029C0 8E7B      STD	Y+27,R7
    029C1 8E8C      STD	Y+28,R8
    029C2 8E9D      STD	Y+29,R9
(2856) 				if (fp->fptr % SS(fp->fs) && dsc != fp->dsect) {	/* Refill sector cache if needed */
    029C3 EF4F      LDI	R20,0xFF
    029C4 E051      LDI	R21,1
    029C5 E060      LDI	R22,0
    029C6 E070      LDI	R23,0
    029C7 A5E8      LDD	R30,Y+40
    029C8 A5F9      LDD	R31,Y+41
    029C9 9636      ADIW	R30,6
    029CA 8020      LD	R2,Z
    029CB 8031      LDD	R3,Z+1
    029CC 8042      LDD	R4,Z+2
    029CD 8053      LDD	R5,Z+3
    029CE 2224      AND	R2,R20
    029CF 2235      AND	R3,R21
    029D0 2246      AND	R4,R22
    029D1 2257      AND	R5,R23
    029D2 9488      BCLR	0
    029D3 2022      TST	R2
    029D4 0432      CPC	R3,R2
    029D5 0442      CPC	R4,R2
    029D6 0452      CPC	R5,R2
    029D7 F409      BNE	0x29D9
    029D8 C2CC      RJMP	0x2CA5
    029D9 A5E8      LDD	R30,Y+40
    029DA A5F9      LDD	R31,Y+41
    029DB 9676      ADIW	R30,0x16
    029DC 8020      LD	R2,Z
    029DD 8031      LDD	R3,Z+1
    029DE 8042      LDD	R4,Z+2
    029DF 8053      LDD	R5,Z+3
    029E0 8C6A      LDD	R6,Y+26
    029E1 8C7B      LDD	R7,Y+27
    029E2 8C8C      LDD	R8,Y+28
    029E3 8C9D      LDD	R9,Y+29
    029E4 1462      CP	R6,R2
    029E5 0473      CPC	R7,R3
    029E6 0484      CPC	R8,R4
    029E7 0495      CPC	R9,R5
    029E8 F409      BNE	0x29EA
    029E9 C2BB      RJMP	0x2CA5
(2857) #if !_FS_TINY
(2858) #if !_FS_READONLY
(2859) 					if (fp->flag & FA__DIRTY) {		/* Write-back dirty sector cache */
(2860) 						if (disk_write(fp->fs->drv, fp->buf, fp->dsect, 1) != RES_OK)
(2861) 							ABORT(fp->fs, FR_DISK_ERR);
(2862) 						fp->flag &= ~FA__DIRTY;
(2863) 					}
(2864) #endif
(2865) 					if (disk_read(fp->fs->drv, fp->buf, dsc, 1) != RES_OK)	/* Load current sector */
(2866) 						ABORT(fp->fs, FR_DISK_ERR);
(2867) #endif
(2868) 					fp->dsect = dsc;
    029EA 0113      MOVW	R2,R6
    029EB 0124      MOVW	R4,R8
    029EC A5E8      LDD	R30,Y+40
    029ED A5F9      LDD	R31,Y+41
    029EE 8A26      STD	Z+22,R2
    029EF 8A37      STD	Z+23,R3
    029F0 8E40      STD	Z+24,R4
    029F1 8E51      STD	Z+25,R5
(2869) 				}
(2870) 			}
(2871) 		}
(2872) 	} else
    029F2 C2B2      RJMP	0x2CA5
(2873) #endif
(2874) 
(2875) 	/* Normal Seek */
(2876) 	{
(2877) 		DWORD clst, bcs, nsect, ifptr;
(2878) 
(2879) 		if (ofs > fp->fsize					/* In read-only mode, clip offset with the file size */
    029F3 A5E8      LDD	R30,Y+40
    029F4 A5F9      LDD	R31,Y+41
    029F5 963A      ADIW	R30,0xA
    029F6 8020      LD	R2,Z
    029F7 8031      LDD	R3,Z+1
    029F8 8042      LDD	R4,Z+2
    029F9 8053      LDD	R5,Z+3
    029FA A46A      LDD	R6,Y+42
    029FB A47B      LDD	R7,Y+43
    029FC A48C      LDD	R8,Y+44
    029FD A49D      LDD	R9,Y+45
    029FE 1426      CP	R2,R6
    029FF 0437      CPC	R3,R7
    02A00 0448      CPC	R4,R8
    02A01 0459      CPC	R5,R9
    02A02 F470      BCC	0x2A11
    02A03 A5E8      LDD	R30,Y+40
    02A04 A5F9      LDD	R31,Y+41
    02A05 8024      LDD	R2,Z+4
    02A06 FC21      SBRC	R2,1
    02A07 C009      RJMP	0x2A11
(2880) #if !_FS_READONLY
(2881) 			 && !(fp->flag & FA_WRITE)
(2882) #endif
(2883) 			) ofs = fp->fsize;
    02A08 963A      ADIW	R30,0xA
    02A09 8020      LD	R2,Z
    02A0A 8031      LDD	R3,Z+1
    02A0B 8042      LDD	R4,Z+2
    02A0C 8053      LDD	R5,Z+3
    02A0D A62A      STD	Y+42,R2
    02A0E A63B      STD	Y+43,R3
    02A0F A64C      STD	Y+44,R4
    02A10 A65D      STD	Y+45,R5
(2884) 
(2885) 		ifptr = fp->fptr;
    02A11 A5E8      LDD	R30,Y+40
    02A12 A5F9      LDD	R31,Y+41
    02A13 9636      ADIW	R30,6
    02A14 8020      LD	R2,Z
    02A15 8031      LDD	R3,Z+1
    02A16 8042      LDD	R4,Z+2
    02A17 8053      LDD	R5,Z+3
    02A18 862E      STD	Y+14,R2
    02A19 863F      STD	Y+15,R3
    02A1A 8A48      STD	Y+16,R4
    02A1B 8A59      STD	Y+17,R5
(2886) 		fp->fptr = nsect = 0;
    02A1C E080      LDI	R24,0
    02A1D 878A      STD	Y+10,R24
    02A1E 878B      STD	Y+11,R24
    02A1F 878C      STD	Y+12,R24
    02A20 878D      STD	Y+13,R24
    02A21 A5E8      LDD	R30,Y+40
    02A22 A5F9      LDD	R31,Y+41
    02A23 9636      ADIW	R30,6
    02A24 E080      LDI	R24,0
    02A25 8380      ST	Z,R24
    02A26 8381      STD	Z+1,R24
    02A27 8382      STD	Z+2,R24
    02A28 8383      STD	Z+3,R24
(2887) 		if (ofs) {
    02A29 A42A      LDD	R2,Y+42
    02A2A A43B      LDD	R3,Y+43
    02A2B A44C      LDD	R4,Y+44
    02A2C A45D      LDD	R5,Y+45
    02A2D 9488      BCLR	0
    02A2E 2022      TST	R2
    02A2F 0432      CPC	R3,R2
    02A30 0442      CPC	R4,R2
    02A31 0452      CPC	R5,R2
    02A32 F409      BNE	0x2A34
    02A33 C226      RJMP	0x2C5A
(2888) 			bcs = (DWORD)fp->fs->csize * SS(fp->fs);	/* Cluster size (byte) */
    02A34 A5E8      LDD	R30,Y+40
    02A35 A5F9      LDD	R31,Y+41
    02A36 93AF      PUSH	R26
    02A37 93BF      PUSH	R27
    02A38 81A0      LD	R26,Z
    02A39 81B1      LDD	R27,Z+1
    02A3A 01FD      MOVW	R30,R26
    02A3B 91BF      POP	R27
    02A3C 91AF      POP	R26
    02A3D 9632      ADIW	R30,2
    02A3E 8020      LD	R2,Z
    02A3F 2433      CLR	R3
    02A40 2444      CLR	R4
    02A41 2455      CLR	R5
    02A42 E040      LDI	R20,0
    02A43 E052      LDI	R21,2
    02A44 E060      LDI	R22,0
    02A45 E070      LDI	R23,0
    02A46 925A      ST	-Y,R5
    02A47 924A      ST	-Y,R4
    02A48 923A      ST	-Y,R3
    02A49 922A      ST	-Y,R2
    02A4A 018A      MOVW	R16,R20
    02A4B 019B      MOVW	R18,R22
    02A4C 940E 4B57 CALL	empy32s|empy32u
    02A4E 830E      STD	Y+6,R16
    02A4F 831F      STD	Y+7,R17
    02A50 8728      STD	Y+8,R18
    02A51 8739      STD	Y+9,R19
(2889) 			if (ifptr > 0 &&
    02A52 842E      LDD	R2,Y+14
    02A53 843F      LDD	R3,Y+15
    02A54 8848      LDD	R4,Y+16
    02A55 8859      LDD	R5,Y+17
    02A56 9488      BCLR	0
    02A57 2022      TST	R2
    02A58 0432      CPC	R3,R2
    02A59 0442      CPC	R4,R2
    02A5A 0452      CPC	R5,R2
    02A5B F409      BNE	0x2A5D
    02A5C C075      RJMP	0x2AD2
    02A5D E041      LDI	R20,1
    02A5E E050      LDI	R21,0
    02A5F E060      LDI	R22,0
    02A60 E070      LDI	R23,0
    02A61 0181      MOVW	R16,R2
    02A62 0192      MOVW	R18,R4
    02A63 1B04      SUB	R16,R20
    02A64 0B15      SBC	R17,R21
    02A65 0B26      SBC	R18,R22
    02A66 0B37      SBC	R19,R23
    02A67 802E      LDD	R2,Y+6
    02A68 803F      LDD	R3,Y+7
    02A69 8448      LDD	R4,Y+8
    02A6A 8459      LDD	R5,Y+9
    02A6B 925A      ST	-Y,R5
    02A6C 924A      ST	-Y,R4
    02A6D 923A      ST	-Y,R3
    02A6E 922A      ST	-Y,R2
    02A6F 940E 4AB1 CALL	div32u
    02A71 0118      MOVW	R2,R16
    02A72 0129      MOVW	R4,R18
    02A73 E041      LDI	R20,1
    02A74 E050      LDI	R21,0
    02A75 E060      LDI	R22,0
    02A76 E070      LDI	R23,0
    02A77 A50A      LDD	R16,Y+42
    02A78 A51B      LDD	R17,Y+43
    02A79 A52C      LDD	R18,Y+44
    02A7A A53D      LDD	R19,Y+45
    02A7B 1B04      SUB	R16,R20
    02A7C 0B15      SBC	R17,R21
    02A7D 0B26      SBC	R18,R22
    02A7E 0B37      SBC	R19,R23
    02A7F 806E      LDD	R6,Y+6
    02A80 807F      LDD	R7,Y+7
    02A81 8488      LDD	R8,Y+8
    02A82 8499      LDD	R9,Y+9
    02A83 929A      ST	-Y,R9
    02A84 928A      ST	-Y,R8
    02A85 927A      ST	-Y,R7
    02A86 926A      ST	-Y,R6
    02A87 940E 4AB1 CALL	div32u
    02A89 1502      CP	R16,R2
    02A8A 0513      CPC	R17,R3
    02A8B 0524      CPC	R18,R4
    02A8C 0535      CPC	R19,R5
    02A8D F408      BCC	0x2A8F
    02A8E C043      RJMP	0x2AD2
(2890) 				(ofs - 1) / bcs >= (ifptr - 1) / bcs) {	/* When seek to same or following cluster, */
(2891) 				fp->fptr = (ifptr - 1) & ~(bcs - 1);	/* start from the current cluster */
    02A8F E041      LDI	R20,1
    02A90 E050      LDI	R21,0
    02A91 E060      LDI	R22,0
    02A92 E070      LDI	R23,0
    02A93 802E      LDD	R2,Y+6
    02A94 803F      LDD	R3,Y+7
    02A95 8448      LDD	R4,Y+8
    02A96 8459      LDD	R5,Y+9
    02A97 1A24      SUB	R2,R20
    02A98 0A35      SBC	R3,R21
    02A99 0A46      SBC	R4,R22
    02A9A 0A57      SBC	R5,R23
    02A9B 9420      COM	R2
    02A9C 9430      COM	R3
    02A9D 9440      COM	R4
    02A9E 9450      COM	R5
    02A9F E041      LDI	R20,1
    02AA0 E050      LDI	R21,0
    02AA1 E060      LDI	R22,0
    02AA2 E070      LDI	R23,0
    02AA3 846E      LDD	R6,Y+14
    02AA4 847F      LDD	R7,Y+15
    02AA5 8888      LDD	R8,Y+16
    02AA6 8899      LDD	R9,Y+17
    02AA7 1A64      SUB	R6,R20
    02AA8 0A75      SBC	R7,R21
    02AA9 0A86      SBC	R8,R22
    02AAA 0A97      SBC	R9,R23
    02AAB 2062      AND	R6,R2
    02AAC 2073      AND	R7,R3
    02AAD 2084      AND	R8,R4
    02AAE 2095      AND	R9,R5
    02AAF A5E8      LDD	R30,Y+40
    02AB0 A5F9      LDD	R31,Y+41
    02AB1 8266      STD	Z+6,R6
    02AB2 8277      STD	Z+7,R7
    02AB3 8680      STD	Z+8,R8
    02AB4 8691      STD	Z+9,R9
(2892) 				ofs -= fp->fptr;
    02AB5 9636      ADIW	R30,6
    02AB6 8020      LD	R2,Z
    02AB7 8031      LDD	R3,Z+1
    02AB8 8042      LDD	R4,Z+2
    02AB9 8053      LDD	R5,Z+3
    02ABA A46A      LDD	R6,Y+42
    02ABB A47B      LDD	R7,Y+43
    02ABC A48C      LDD	R8,Y+44
    02ABD A49D      LDD	R9,Y+45
    02ABE 1862      SUB	R6,R2
    02ABF 0873      SBC	R7,R3
    02AC0 0884      SBC	R8,R4
    02AC1 0895      SBC	R9,R5
    02AC2 A66A      STD	Y+42,R6
    02AC3 A67B      STD	Y+43,R7
    02AC4 A68C      STD	Y+44,R8
    02AC5 A69D      STD	Y+45,R9
(2893) 				clst = fp->clust;
    02AC6 A5E8      LDD	R30,Y+40
    02AC7 A5F9      LDD	R31,Y+41
    02AC8 9672      ADIW	R30,0x12
    02AC9 8020      LD	R2,Z
    02ACA 8031      LDD	R3,Z+1
    02ACB 8042      LDD	R4,Z+2
    02ACC 8053      LDD	R5,Z+3
    02ACD 822A      STD	Y+2,R2
    02ACE 823B      STD	Y+3,R3
    02ACF 824C      STD	Y+4,R4
    02AD0 825D      STD	Y+5,R5
(2894) 			} else {									/* When seek to back cluster, */
    02AD1 C069      RJMP	0x2B3B
(2895) 				clst = fp->sclust;						/* start from the first cluster */
    02AD2 A5E8      LDD	R30,Y+40
    02AD3 A5F9      LDD	R31,Y+41
    02AD4 963E      ADIW	R30,0xE
    02AD5 8020      LD	R2,Z
    02AD6 8031      LDD	R3,Z+1
    02AD7 8042      LDD	R4,Z+2
    02AD8 8053      LDD	R5,Z+3
    02AD9 822A      STD	Y+2,R2
    02ADA 823B      STD	Y+3,R3
    02ADB 824C      STD	Y+4,R4
    02ADC 825D      STD	Y+5,R5
(2896) #if !_FS_READONLY
(2897) 				if (clst == 0) {						/* If no cluster chain, create a new chain */
    02ADD 802A      LDD	R2,Y+2
    02ADE 803B      LDD	R3,Y+3
    02ADF 804C      LDD	R4,Y+4
    02AE0 805D      LDD	R5,Y+5
    02AE1 9488      BCLR	0
    02AE2 2022      TST	R2
    02AE3 0432      CPC	R3,R2
    02AE4 0442      CPC	R4,R2
    02AE5 0452      CPC	R5,R2
    02AE6 F009      BEQ	0x2AE8
    02AE7 C049      RJMP	0x2B31
(2898) 					clst = create_chain(fp->fs, 0);
    02AE8 E040      LDI	R20,0
    02AE9 E050      LDI	R21,0
    02AEA E060      LDI	R22,0
    02AEB E070      LDI	R23,0
    02AEC 8368      ST	Y,R22
    02AED 8379      STD	Y+1,R23
    02AEE 019A      MOVW	R18,R20
    02AEF A5E8      LDD	R30,Y+40
    02AF0 A5F9      LDD	R31,Y+41
    02AF1 8100      LD	R16,Z
    02AF2 8111      LDD	R17,Z+1
    02AF3 940E 1238 CALL	ff.c:create_chain
    02AF5 830A      STD	Y+2,R16
    02AF6 831B      STD	Y+3,R17
    02AF7 832C      STD	Y+4,R18
    02AF8 833D      STD	Y+5,R19
(2899) 					if (clst == 1) ABORT(fp->fs, FR_INT_ERR);
    02AF9 E041      LDI	R20,1
    02AFA E050      LDI	R21,0
    02AFB E060      LDI	R22,0
    02AFC E070      LDI	R23,0
    02AFD 802A      LDD	R2,Y+2
    02AFE 803B      LDD	R3,Y+3
    02AFF 804C      LDD	R4,Y+4
    02B00 805D      LDD	R5,Y+5
    02B01 1624      CP	R2,R20
    02B02 0635      CPC	R3,R21
    02B03 0646      CPC	R4,R22
    02B04 0657      CPC	R5,R23
    02B05 F451      BNE	0x2B10
    02B06 A588      LDD	R24,Y+40
    02B07 A599      LDD	R25,Y+41
    02B08 9604      ADIW	R24,4
    02B09 017C      MOVW	R14,R24
    02B0A 01FC      MOVW	R30,R24
    02B0B 8180      LD	R24,Z
    02B0C 6880      ORI	R24,0x80
    02B0D 8380      ST	Z,R24
    02B0E E002      LDI	R16,2
    02B0F C196      RJMP	0x2CA6
(2900) 					if (clst == 0xFFFFFFFF) ABORT(fp->fs, FR_DISK_ERR);
    02B10 EF4F      LDI	R20,0xFF
    02B11 EF5F      LDI	R21,0xFF
    02B12 EF6F      LDI	R22,0xFF
    02B13 EF7F      LDI	R23,0xFF
    02B14 802A      LDD	R2,Y+2
    02B15 803B      LDD	R3,Y+3
    02B16 804C      LDD	R4,Y+4
    02B17 805D      LDD	R5,Y+5
    02B18 1624      CP	R2,R20
    02B19 0635      CPC	R3,R21
    02B1A 0646      CPC	R4,R22
    02B1B 0657      CPC	R5,R23
    02B1C F451      BNE	0x2B27
    02B1D A588      LDD	R24,Y+40
    02B1E A599      LDD	R25,Y+41
    02B1F 9604      ADIW	R24,4
    02B20 017C      MOVW	R14,R24
    02B21 01FC      MOVW	R30,R24
    02B22 8180      LD	R24,Z
    02B23 6880      ORI	R24,0x80
    02B24 8380      ST	Z,R24
    02B25 E001      LDI	R16,1
    02B26 C17F      RJMP	0x2CA6
(2901) 					fp->sclust = clst;
    02B27 802A      LDD	R2,Y+2
    02B28 803B      LDD	R3,Y+3
    02B29 804C      LDD	R4,Y+4
    02B2A 805D      LDD	R5,Y+5
    02B2B A5E8      LDD	R30,Y+40
    02B2C A5F9      LDD	R31,Y+41
    02B2D 8626      STD	Z+14,R2
    02B2E 8637      STD	Z+15,R3
    02B2F 8A40      STD	Z+16,R4
    02B30 8A51      STD	Z+17,R5
(2902) 				}
(2903) #endif
(2904) 				fp->clust = clst;
    02B31 802A      LDD	R2,Y+2
    02B32 803B      LDD	R3,Y+3
    02B33 804C      LDD	R4,Y+4
    02B34 805D      LDD	R5,Y+5
    02B35 A5E8      LDD	R30,Y+40
    02B36 A5F9      LDD	R31,Y+41
    02B37 8A22      STD	Z+18,R2
    02B38 8A33      STD	Z+19,R3
    02B39 8A44      STD	Z+20,R4
    02B3A 8A55      STD	Z+21,R5
(2905) 			}
(2906) 			if (clst != 0) {
    02B3B 802A      LDD	R2,Y+2
    02B3C 803B      LDD	R3,Y+3
    02B3D 804C      LDD	R4,Y+4
    02B3E 805D      LDD	R5,Y+5
    02B3F 9488      BCLR	0
    02B40 2022      TST	R2
    02B41 0432      CPC	R3,R2
    02B42 0442      CPC	R4,R2
    02B43 0452      CPC	R5,R2
    02B44 F409      BNE	0x2B46
    02B45 C114      RJMP	0x2C5A
    02B46 C0A7      RJMP	0x2BEE
(2907) 				while (ofs > bcs) {						/* Cluster following loop */
(2908) #if !_FS_READONLY
(2909) 					if (fp->flag & FA_WRITE) {			/* Check if in write mode or not */
    02B47 A5E8      LDD	R30,Y+40
    02B48 A5F9      LDD	R31,Y+41
    02B49 9634      ADIW	R30,4
    02B4A 8020      LD	R2,Z
    02B4B FE21      SBRS	R2,1
    02B4C C024      RJMP	0x2B71
(2910) 						clst = create_chain(fp->fs, clst);	/* Force stretch if in write mode */
    02B4D 802A      LDD	R2,Y+2
    02B4E 803B      LDD	R3,Y+3
    02B4F 804C      LDD	R4,Y+4
    02B50 805D      LDD	R5,Y+5
    02B51 8248      ST	Y,R4
    02B52 8259      STD	Y+1,R5
    02B53 0191      MOVW	R18,R2
    02B54 A5E8      LDD	R30,Y+40
    02B55 A5F9      LDD	R31,Y+41
    02B56 8100      LD	R16,Z
    02B57 8111      LDD	R17,Z+1
    02B58 940E 1238 CALL	ff.c:create_chain
    02B5A 830A      STD	Y+2,R16
    02B5B 831B      STD	Y+3,R17
    02B5C 832C      STD	Y+4,R18
    02B5D 833D      STD	Y+5,R19
(2911) 						if (clst == 0) {				/* When disk gets full, clip file size */
    02B5E 802A      LDD	R2,Y+2
    02B5F 803B      LDD	R3,Y+3
    02B60 804C      LDD	R4,Y+4
    02B61 805D      LDD	R5,Y+5
    02B62 9488      BCLR	0
    02B63 2022      TST	R2
    02B64 0432      CPC	R3,R2
    02B65 0442      CPC	R4,R2
    02B66 0452      CPC	R5,R2
    02B67 F4D1      BNE	0x2B82
(2912) 							ofs = bcs; break;
    02B68 802E      LDD	R2,Y+6
    02B69 803F      LDD	R3,Y+7
    02B6A 8448      LDD	R4,Y+8
    02B6B 8459      LDD	R5,Y+9
    02B6C A62A      STD	Y+42,R2
    02B6D A63B      STD	Y+43,R3
    02B6E A64C      STD	Y+44,R4
    02B6F A65D      STD	Y+45,R5
    02B70 C08B      RJMP	0x2BFC
(2913) 						}
(2914) 					} else
(2915) #endif
(2916) 						clst = get_fat(fp->fs, clst);	/* Follow cluster chain if not in write mode */
    02B71 802A      LDD	R2,Y+2
    02B72 803B      LDD	R3,Y+3
    02B73 804C      LDD	R4,Y+4
    02B74 805D      LDD	R5,Y+5
    02B75 8248      ST	Y,R4
    02B76 8259      STD	Y+1,R5
    02B77 0191      MOVW	R18,R2
    02B78 A5E8      LDD	R30,Y+40
    02B79 A5F9      LDD	R31,Y+41
    02B7A 8100      LD	R16,Z
    02B7B 8111      LDD	R17,Z+1
    02B7C 940E 0E76 CALL	_get_fat
    02B7E 830A      STD	Y+2,R16
    02B7F 831B      STD	Y+3,R17
    02B80 832C      STD	Y+4,R18
    02B81 833D      STD	Y+5,R19
(2917) 					if (clst == 0xFFFFFFFF) ABORT(fp->fs, FR_DISK_ERR);
    02B82 EF4F      LDI	R20,0xFF
    02B83 EF5F      LDI	R21,0xFF
    02B84 EF6F      LDI	R22,0xFF
    02B85 EF7F      LDI	R23,0xFF
    02B86 802A      LDD	R2,Y+2
    02B87 803B      LDD	R3,Y+3
    02B88 804C      LDD	R4,Y+4
    02B89 805D      LDD	R5,Y+5
    02B8A 1624      CP	R2,R20
    02B8B 0635      CPC	R3,R21
    02B8C 0646      CPC	R4,R22
    02B8D 0657      CPC	R5,R23
    02B8E F451      BNE	0x2B99
    02B8F A588      LDD	R24,Y+40
    02B90 A599      LDD	R25,Y+41
    02B91 9604      ADIW	R24,4
    02B92 017C      MOVW	R14,R24
    02B93 01FC      MOVW	R30,R24
    02B94 8180      LD	R24,Z
    02B95 6880      ORI	R24,0x80
    02B96 8380      ST	Z,R24
    02B97 E001      LDI	R16,1
    02B98 C10D      RJMP	0x2CA6
(2918) 					if (clst <= 1 || clst >= fp->fs->n_fatent) ABORT(fp->fs, FR_INT_ERR);
    02B99 E041      LDI	R20,1
    02B9A E050      LDI	R21,0
    02B9B E060      LDI	R22,0
    02B9C E070      LDI	R23,0
    02B9D 802A      LDD	R2,Y+2
    02B9E 803B      LDD	R3,Y+3
    02B9F 804C      LDD	R4,Y+4
    02BA0 805D      LDD	R5,Y+5
    02BA1 1542      CP	R20,R2
    02BA2 0553      CPC	R21,R3
    02BA3 0564      CPC	R22,R4
    02BA4 0575      CPC	R23,R5
    02BA5 F490      BCC	0x2BB8
    02BA6 A5E8      LDD	R30,Y+40
    02BA7 A5F9      LDD	R31,Y+41
    02BA8 81A0      LD	R26,Z
    02BA9 81B1      LDD	R27,Z+1
    02BAA 9656      ADIW	R26,0x16
    02BAB 902D      LD	R2,X+
    02BAC 903D      LD	R3,X+
    02BAD 904D      LD	R4,X+
    02BAE 905C      LD	R5,X
    02BAF 806A      LDD	R6,Y+2
    02BB0 807B      LDD	R7,Y+3
    02BB1 808C      LDD	R8,Y+4
    02BB2 809D      LDD	R9,Y+5
    02BB3 1462      CP	R6,R2
    02BB4 0473      CPC	R7,R3
    02BB5 0484      CPC	R8,R4
    02BB6 0495      CPC	R9,R5
    02BB7 F050      BCS	0x2BC2
    02BB8 A588      LDD	R24,Y+40
    02BB9 A599      LDD	R25,Y+41
    02BBA 9604      ADIW	R24,4
    02BBB 017C      MOVW	R14,R24
    02BBC 01FC      MOVW	R30,R24
    02BBD 8180      LD	R24,Z
    02BBE 6880      ORI	R24,0x80
    02BBF 8380      ST	Z,R24
    02BC0 E002      LDI	R16,2
    02BC1 C0E4      RJMP	0x2CA6
(2919) 					fp->clust = clst;
    02BC2 802A      LDD	R2,Y+2
    02BC3 803B      LDD	R3,Y+3
    02BC4 804C      LDD	R4,Y+4
    02BC5 805D      LDD	R5,Y+5
    02BC6 A5E8      LDD	R30,Y+40
    02BC7 A5F9      LDD	R31,Y+41
    02BC8 9672      ADIW	R30,0x12
    02BC9 8220      ST	Z,R2
    02BCA 8231      STD	Z+1,R3
    02BCB 8242      STD	Z+2,R4
    02BCC 8253      STD	Z+3,R5
(2920) 					fp->fptr += bcs;
    02BCD A588      LDD	R24,Y+40
    02BCE A599      LDD	R25,Y+41
    02BCF 9606      ADIW	R24,6
    02BD0 017C      MOVW	R14,R24
    02BD1 802E      LDD	R2,Y+6
    02BD2 803F      LDD	R3,Y+7
    02BD3 8448      LDD	R4,Y+8
    02BD4 8459      LDD	R5,Y+9
    02BD5 01FC      MOVW	R30,R24
    02BD6 8060      LD	R6,Z
    02BD7 8071      LDD	R7,Z+1
    02BD8 8082      LDD	R8,Z+2
    02BD9 8093      LDD	R9,Z+3
    02BDA 0C62      ADD	R6,R2
    02BDB 1C73      ADC	R7,R3
    02BDC 1C84      ADC	R8,R4
    02BDD 1C95      ADC	R9,R5
    02BDE 8260      ST	Z,R6
    02BDF 8271      STD	Z+1,R7
    02BE0 8282      STD	Z+2,R8
    02BE1 8293      STD	Z+3,R9
(2921) 					ofs -= bcs;
    02BE2 A46A      LDD	R6,Y+42
    02BE3 A47B      LDD	R7,Y+43
    02BE4 A48C      LDD	R8,Y+44
    02BE5 A49D      LDD	R9,Y+45
    02BE6 1862      SUB	R6,R2
    02BE7 0873      SBC	R7,R3
    02BE8 0884      SBC	R8,R4
    02BE9 0895      SBC	R9,R5
    02BEA A66A      STD	Y+42,R6
    02BEB A67B      STD	Y+43,R7
    02BEC A68C      STD	Y+44,R8
    02BED A69D      STD	Y+45,R9
    02BEE 802E      LDD	R2,Y+6
    02BEF 803F      LDD	R3,Y+7
    02BF0 8448      LDD	R4,Y+8
    02BF1 8459      LDD	R5,Y+9
    02BF2 A46A      LDD	R6,Y+42
    02BF3 A47B      LDD	R7,Y+43
    02BF4 A48C      LDD	R8,Y+44
    02BF5 A49D      LDD	R9,Y+45
    02BF6 1426      CP	R2,R6
    02BF7 0437      CPC	R3,R7
    02BF8 0448      CPC	R4,R8
    02BF9 0459      CPC	R5,R9
    02BFA F408      BCC	0x2BFC
    02BFB CF4B      RJMP	0x2B47
(2922) 				}
(2923) 				fp->fptr += ofs;
    02BFC A588      LDD	R24,Y+40
    02BFD A599      LDD	R25,Y+41
    02BFE 9606      ADIW	R24,6
    02BFF 017C      MOVW	R14,R24
    02C00 A42A      LDD	R2,Y+42
    02C01 A43B      LDD	R3,Y+43
    02C02 A44C      LDD	R4,Y+44
    02C03 A45D      LDD	R5,Y+45
    02C04 01FC      MOVW	R30,R24
    02C05 8060      LD	R6,Z
    02C06 8071      LDD	R7,Z+1
    02C07 8082      LDD	R8,Z+2
    02C08 8093      LDD	R9,Z+3
    02C09 0C62      ADD	R6,R2
    02C0A 1C73      ADC	R7,R3
    02C0B 1C84      ADC	R8,R4
    02C0C 1C95      ADC	R9,R5
    02C0D 8260      ST	Z,R6
    02C0E 8271      STD	Z+1,R7
    02C0F 8282      STD	Z+2,R8
    02C10 8293      STD	Z+3,R9
(2924) 				if (ofs % SS(fp->fs)) {
    02C11 EF4F      LDI	R20,0xFF
    02C12 E051      LDI	R21,1
    02C13 E060      LDI	R22,0
    02C14 E070      LDI	R23,0
    02C15 2224      AND	R2,R20
    02C16 2235      AND	R3,R21
    02C17 2246      AND	R4,R22
    02C18 2257      AND	R5,R23
    02C19 9488      BCLR	0
    02C1A 2022      TST	R2
    02C1B 0432      CPC	R3,R2
    02C1C 0442      CPC	R4,R2
    02C1D 0452      CPC	R5,R2
    02C1E F409      BNE	0x2C20
    02C1F C03A      RJMP	0x2C5A
(2925) 					nsect = clust2sect(fp->fs, clst);	/* Current sector */
    02C20 802A      LDD	R2,Y+2
    02C21 803B      LDD	R3,Y+3
    02C22 804C      LDD	R4,Y+4
    02C23 805D      LDD	R5,Y+5
    02C24 8248      ST	Y,R4
    02C25 8259      STD	Y+1,R5
    02C26 0191      MOVW	R18,R2
    02C27 A5E8      LDD	R30,Y+40
    02C28 A5F9      LDD	R31,Y+41
    02C29 8100      LD	R16,Z
    02C2A 8111      LDD	R17,Z+1
    02C2B 940E 0E24 CALL	_clust2sect
    02C2D 870A      STD	Y+10,R16
    02C2E 871B      STD	Y+11,R17
    02C2F 872C      STD	Y+12,R18
    02C30 873D      STD	Y+13,R19
(2926) 					if (!nsect) ABORT(fp->fs, FR_INT_ERR);
    02C31 842A      LDD	R2,Y+10
    02C32 843B      LDD	R3,Y+11
    02C33 844C      LDD	R4,Y+12
    02C34 845D      LDD	R5,Y+13
    02C35 9488      BCLR	0
    02C36 2022      TST	R2
    02C37 0432      CPC	R3,R2
    02C38 0442      CPC	R4,R2
    02C39 0452      CPC	R5,R2
    02C3A F451      BNE	0x2C45
    02C3B A588      LDD	R24,Y+40
    02C3C A599      LDD	R25,Y+41
    02C3D 9604      ADIW	R24,4
    02C3E 017C      MOVW	R14,R24
    02C3F 01FC      MOVW	R30,R24
    02C40 8180      LD	R24,Z
    02C41 6880      ORI	R24,0x80
    02C42 8380      ST	Z,R24
    02C43 E002      LDI	R16,2
    02C44 C061      RJMP	0x2CA6
(2927) 					nsect += ofs / SS(fp->fs);
    02C45 E089      LDI	R24,0x9
    02C46 E090      LDI	R25,0
    02C47 A50A      LDD	R16,Y+42
    02C48 A51B      LDD	R17,Y+43
    02C49 A52C      LDD	R18,Y+44
    02C4A A53D      LDD	R19,Y+45
    02C4B 938A      ST	-Y,R24
    02C4C 940E 4C4F CALL	lsr32
    02C4E 842A      LDD	R2,Y+10
    02C4F 843B      LDD	R3,Y+11
    02C50 844C      LDD	R4,Y+12
    02C51 845D      LDD	R5,Y+13
    02C52 0E20      ADD	R2,R16
    02C53 1E31      ADC	R3,R17
    02C54 1E42      ADC	R4,R18
    02C55 1E53      ADC	R5,R19
    02C56 862A      STD	Y+10,R2
    02C57 863B      STD	Y+11,R3
    02C58 864C      STD	Y+12,R4
    02C59 865D      STD	Y+13,R5
(2928) 				}
(2929) 			}
(2930) 		}
(2931) 		if (fp->fptr % SS(fp->fs) && nsect != fp->dsect) {	/* Fill sector cache if needed */
    02C5A EF4F      LDI	R20,0xFF
    02C5B E051      LDI	R21,1
    02C5C E060      LDI	R22,0
    02C5D E070      LDI	R23,0
    02C5E A5E8      LDD	R30,Y+40
    02C5F A5F9      LDD	R31,Y+41
    02C60 9636      ADIW	R30,6
    02C61 8020      LD	R2,Z
    02C62 8031      LDD	R3,Z+1
    02C63 8042      LDD	R4,Z+2
    02C64 8053      LDD	R5,Z+3
    02C65 2224      AND	R2,R20
    02C66 2235      AND	R3,R21
    02C67 2246      AND	R4,R22
    02C68 2257      AND	R5,R23
    02C69 9488      BCLR	0
    02C6A 2022      TST	R2
    02C6B 0432      CPC	R3,R2
    02C6C 0442      CPC	R4,R2
    02C6D 0452      CPC	R5,R2
    02C6E F0C1      BEQ	0x2C87
    02C6F A5E8      LDD	R30,Y+40
    02C70 A5F9      LDD	R31,Y+41
    02C71 9676      ADIW	R30,0x16
    02C72 8020      LD	R2,Z
    02C73 8031      LDD	R3,Z+1
    02C74 8042      LDD	R4,Z+2
    02C75 8053      LDD	R5,Z+3
    02C76 846A      LDD	R6,Y+10
    02C77 847B      LDD	R7,Y+11
    02C78 848C      LDD	R8,Y+12
    02C79 849D      LDD	R9,Y+13
    02C7A 1462      CP	R6,R2
    02C7B 0473      CPC	R7,R3
    02C7C 0484      CPC	R8,R4
    02C7D 0495      CPC	R9,R5
    02C7E F041      BEQ	0x2C87
(2932) #if !_FS_TINY
(2933) #if !_FS_READONLY
(2934) 			if (fp->flag & FA__DIRTY) {			/* Write-back dirty sector cache */
(2935) 				if (disk_write(fp->fs->drv, fp->buf, fp->dsect, 1) != RES_OK)
(2936) 					ABORT(fp->fs, FR_DISK_ERR);
(2937) 				fp->flag &= ~FA__DIRTY;
(2938) 			}
(2939) #endif
(2940) 			if (disk_read(fp->fs->drv, fp->buf, nsect, 1) != RES_OK)	/* Fill sector cache */
(2941) 				ABORT(fp->fs, FR_DISK_ERR);
(2942) #endif
(2943) 			fp->dsect = nsect;
    02C7F 0113      MOVW	R2,R6
    02C80 0124      MOVW	R4,R8
    02C81 A5E8      LDD	R30,Y+40
    02C82 A5F9      LDD	R31,Y+41
    02C83 8A26      STD	Z+22,R2
    02C84 8A37      STD	Z+23,R3
    02C85 8E40      STD	Z+24,R4
    02C86 8E51      STD	Z+25,R5
(2944) 		}
(2945) #if !_FS_READONLY
(2946) 		if (fp->fptr > fp->fsize) {			/* Set file change flag if the file size is extended */
    02C87 A5E8      LDD	R30,Y+40
    02C88 A5F9      LDD	R31,Y+41
    02C89 8422      LDD	R2,Z+10
    02C8A 8433      LDD	R3,Z+11
    02C8B 8444      LDD	R4,Z+12
    02C8C 8455      LDD	R5,Z+13
    02C8D 8066      LDD	R6,Z+6
    02C8E 8077      LDD	R7,Z+7
    02C8F 8480      LDD	R8,Z+8
    02C90 8491      LDD	R9,Z+9
    02C91 1426      CP	R2,R6
    02C92 0437      CPC	R3,R7
    02C93 0448      CPC	R4,R8
    02C94 0459      CPC	R5,R9
    02C95 F478      BCC	0x2CA5
(2947) 			fp->fsize = fp->fptr;
    02C96 8026      LDD	R2,Z+6
    02C97 8037      LDD	R3,Z+7
    02C98 8440      LDD	R4,Z+8
    02C99 8451      LDD	R5,Z+9
    02C9A 8622      STD	Z+10,R2
    02C9B 8633      STD	Z+11,R3
    02C9C 8644      STD	Z+12,R4
    02C9D 8655      STD	Z+13,R5
(2948) 			fp->flag |= FA__WRITTEN;
    02C9E 01CF      MOVW	R24,R30
    02C9F 9604      ADIW	R24,4
    02CA0 016C      MOVW	R12,R24
    02CA1 01FC      MOVW	R30,R24
    02CA2 8180      LD	R24,Z
    02CA3 6280      ORI	R24,0x20
    02CA4 8380      ST	Z,R24
(2949) 		}
(2950) #endif
(2951) 	}
(2952) 
(2953) 	LEAVE_FF(fp->fs, res);
    02CA5 2D0A      MOV	R16,R10
    02CA6 966E      ADIW	R28,0x1E
    02CA7 940E 4BA0 CALL	pop_xgsetF0FC
    02CA9 9624      ADIW	R28,4
    02CAA 9508      RET
_f_opendir:
  sfn                  --> Y,+1
  res                  --> R20
  path                 --> Y,+19
  dj                   --> R22
    02CAB 933A      ST	-Y,R19
    02CAC 932A      ST	-Y,R18
    02CAD 940E 4BCA CALL	push_xgsetF00C
    02CAF 01B8      MOVW	R22,R16
    02CB0 972D      SBIW	R28,0xD
(2954) }
(2955) 
(2956) 
(2957) 
(2958) #if _FS_MINIMIZE <= 1
(2959) /*-----------------------------------------------------------------------*/
(2960) /* Create a Directroy Object                                             */
(2961) /*-----------------------------------------------------------------------*/
(2962) 
(2963) FRESULT f_opendir (
(2964) 	DIR *dj,			/* Pointer to directory object to create */
(2965) 	const TCHAR *path	/* Pointer to the directory path */
(2966) )
(2967) {
(2968) 	FRESULT res;
(2969) 	DEF_NAMEBUF;
(2970) 
(2971) 
(2972) 	res = chk_mounted(&path, &dj->fs, 0);
    02CB1 2422      CLR	R2
    02CB2 8228      ST	Y,R2
    02CB3 019B      MOVW	R18,R22
    02CB4 018E      MOVW	R16,R28
    02CB5 5E0D      SUBI	R16,0xED
    02CB6 4F1F      SBCI	R17,0xFF
    02CB7 940E 1ACB CALL	ff.c:chk_mounted
    02CB9 2F40      MOV	R20,R16
(2973) 	if (res == FR_OK) {
    02CBA 2300      TST	R16
    02CBB F009      BEQ	0x2CBD
    02CBC C05C      RJMP	0x2D19
(2974) 		INIT_BUF(*dj);
    02CBD 01CE      MOVW	R24,R28
    02CBE 9601      ADIW	R24,1
    02CBF 01FB      MOVW	R30,R22
    02CC0 8B95      STD	Z+21,R25
    02CC1 8B84      STD	Z+20,R24
(2975) 		res = follow_path(dj, path);			/* Follow the path to the directory */
    02CC2 892B      LDD	R18,Y+19
    02CC3 893C      LDD	R19,Y+20
    02CC4 018F      MOVW	R16,R30
    02CC5 940E 197F CALL	ff.c:follow_path
    02CC7 2F40      MOV	R20,R16
(2976) 		FREE_BUF();
(2977) 		if (res == FR_OK) {						/* Follow completed */
    02CC8 2300      TST	R16
    02CC9 F009      BEQ	0x2CCB
    02CCA C04B      RJMP	0x2D16
(2978) 			if (dj->dir) {						/* It is not the root dir */
    02CCB 01FB      MOVW	R30,R22
    02CCC 8822      LDD	R2,Z+18
    02CCD 8833      LDD	R3,Z+19
    02CCE 2022      TST	R2
    02CCF F419      BNE	0x2CD3
    02CD0 2033      TST	R3
    02CD1 F409      BNE	0x2CD3
    02CD2 C032      RJMP	0x2D05
(2979) 				if (dj->dir[DIR_Attr] & AM_DIR) {	/* The object is a directory */
    02CD3 93AF      PUSH	R26
    02CD4 93BF      PUSH	R27
    02CD5 89A2      LDD	R26,Z+18
    02CD6 89B3      LDD	R27,Z+19
    02CD7 01FD      MOVW	R30,R26
    02CD8 91BF      POP	R27
    02CD9 91AF      POP	R26
    02CDA 8423      LDD	R2,Z+11
    02CDB FE24      SBRS	R2,4
    02CDC C027      RJMP	0x2D04
(2980) 					dj->sclust = LD_CLUST(dj->dir);
    02CDD 01FB      MOVW	R30,R22
    02CDE 88A2      LDD	R10,Z+18
    02CDF 88B3      LDD	R11,Z+19
    02CE0 01F5      MOVW	R30,R10
    02CE1 8C22      LDD	R2,Z+26
    02CE2 2433      CLR	R3
    02CE3 8C43      LDD	R4,Z+27
    02CE4 2455      CLR	R5
    02CE5 2C54      MOV	R5,R4
    02CE6 2444      CLR	R4
    02CE7 2842      OR	R4,R2
    02CE8 2853      OR	R5,R3
    02CE9 0112      MOVW	R2,R4
    02CEA 2444      CLR	R4
    02CEB 2455      CLR	R5
    02CEC 8864      LDD	R6,Z+20
    02CED 2477      CLR	R7
    02CEE 8885      LDD	R8,Z+21
    02CEF 2499      CLR	R9
    02CF0 2C98      MOV	R9,R8
    02CF1 2488      CLR	R8
    02CF2 2886      OR	R8,R6
    02CF3 2897      OR	R9,R7
    02CF4 0134      MOVW	R6,R8
    02CF5 2488      CLR	R8
    02CF6 2499      CLR	R9
    02CF7 0143      MOVW	R8,R6
    02CF8 2466      CLR	R6
    02CF9 2477      CLR	R7
    02CFA 2862      OR	R6,R2
    02CFB 2873      OR	R7,R3
    02CFC 2884      OR	R8,R4
    02CFD 2895      OR	R9,R5
    02CFE 01FB      MOVW	R30,R22
    02CFF 8266      STD	Z+6,R6
    02D00 8277      STD	Z+7,R7
    02D01 8680      STD	Z+8,R8
    02D02 8691      STD	Z+9,R9
(2981) 				} else {						/* The object is not a directory */
    02D03 C001      RJMP	0x2D05
(2982) 					res = FR_NO_PATH;
    02D04 E045      LDI	R20,5
(2983) 				}
(2984) 			}
(2985) 			if (res == FR_OK) {
    02D05 2344      TST	R20
    02D06 F479      BNE	0x2D16
(2986) 				dj->id = dj->fs->id;
    02D07 01FB      MOVW	R30,R22
    02D08 81A0      LD	R26,Z
    02D09 81B1      LDD	R27,Z+1
    02D0A 9616      ADIW	R26,6
    02D0B 902D      LD	R2,X+
    02D0C 903C      LD	R3,X
    02D0D 8233      STD	Z+3,R3
    02D0E 8222      STD	Z+2,R2
(2987) 				res = dir_sdi(dj, 0);			/* Rewind dir */
    02D0F 2722      CLR	R18
    02D10 2733      CLR	R19
    02D11 018F      MOVW	R16,R30
    02D12 940E 1429 CALL	ff.c:dir_sdi
    02D14 2EA0      MOV	R10,R16
    02D15 2D4A      MOV	R20,R10
(2988) 			}
(2989) 		}
(2990) 		if (res == FR_NO_FILE) res = FR_NO_PATH;
    02D16 3044      CPI	R20,4
    02D17 F409      BNE	0x2D19
    02D18 E045      LDI	R20,5
(2991) 	}
(2992) 
(2993) 	LEAVE_FF(dj->fs, res);
    02D19 2F04      MOV	R16,R20
    02D1A 962D      ADIW	R28,0xD
    02D1B 940E 4BD1 CALL	pop_xgsetF00C
    02D1D 9622      ADIW	R28,2
    02D1E 9508      RET
_f_readdir:
  sfn                  --> Y,+0
  res                  --> R20
  fno                  --> R10
  dj                   --> R22
    02D1F 940E 4BE6 CALL	push_xgsetF03C
    02D21 0159      MOVW	R10,R18
    02D22 01B8      MOVW	R22,R16
    02D23 972C      SBIW	R28,0xC
(2994) }
(2995) 
(2996) 
(2997) 
(2998) 
(2999) /*-----------------------------------------------------------------------*/
(3000) /* Read Directory Entry in Sequense                                      */
(3001) /*-----------------------------------------------------------------------*/
(3002) 
(3003) FRESULT f_readdir (
(3004) 	DIR *dj,			/* Pointer to the open directory object */
(3005) 	FILINFO *fno		/* Pointer to file information to return */
(3006) )
(3007) {
(3008) 	FRESULT res;
(3009) 	DEF_NAMEBUF;
(3010) 
(3011) 
(3012) 	res = validate(dj->fs, dj->id);			/* Check validity of the object */
    02D24 01FB      MOVW	R30,R22
    02D25 8122      LDD	R18,Z+2
    02D26 8133      LDD	R19,Z+3
    02D27 8100      LD	R16,Z
    02D28 8111      LDD	R17,Z+1
    02D29 940E 1FC5 CALL	ff.c:validate
    02D2B 2F40      MOV	R20,R16
(3013) 	if (res == FR_OK) {
    02D2C 2300      TST	R16
    02D2D F009      BEQ	0x2D2F
    02D2E C035      RJMP	0x2D64
(3014) 		if (!fno) {
    02D2F 20AA      TST	R10
    02D30 F449      BNE	0x2D3A
    02D31 20BB      TST	R11
    02D32 F439      BNE	0x2D3A
(3015) 			res = dir_sdi(dj, 0);			/* Rewind the directory object */
    02D33 2722      CLR	R18
    02D34 2733      CLR	R19
    02D35 018B      MOVW	R16,R22
    02D36 940E 1429 CALL	ff.c:dir_sdi
    02D38 2F40      MOV	R20,R16
(3016) 		} else {
    02D39 C02A      RJMP	0x2D64
(3017) 			INIT_BUF(*dj);
    02D3A 01CE      MOVW	R24,R28
    02D3B 01FB      MOVW	R30,R22
    02D3C 8B95      STD	Z+21,R25
    02D3D 8B84      STD	Z+20,R24
(3018) 			res = dir_read(dj);				/* Read an directory item */
    02D3E 018F      MOVW	R16,R30
    02D3F 940E 1726 CALL	ff.c:dir_read
    02D41 2EC0      MOV	R12,R16
    02D42 2D4C      MOV	R20,R12
(3019) 			if (res == FR_NO_FILE) {		/* Reached end of dir */
    02D43 3004      CPI	R16,4
    02D44 F441      BNE	0x2D4D
(3020) 				dj->sect = 0;
    02D45 01FB      MOVW	R30,R22
    02D46 963E      ADIW	R30,0xE
    02D47 E080      LDI	R24,0
    02D48 8380      ST	Z,R24
    02D49 8381      STD	Z+1,R24
    02D4A 8382      STD	Z+2,R24
    02D4B 8383      STD	Z+3,R24
(3021) 				res = FR_OK;
    02D4C 2744      CLR	R20
(3022) 			}
(3023) 			if (res == FR_OK) {				/* A valid entry is found */
    02D4D 2344      TST	R20
    02D4E F4A9      BNE	0x2D64
(3024) 				get_fileinfo(dj, fno);		/* Get the object information */
    02D4F 0195      MOVW	R18,R10
    02D50 018B      MOVW	R16,R22
    02D51 940E 18DC CALL	ff.c:get_fileinfo
(3025) 				res = dir_next(dj, 0);		/* Increment index for next */
    02D53 2722      CLR	R18
    02D54 2733      CLR	R19
    02D55 018B      MOVW	R16,R22
    02D56 940E 1533 CALL	ff.c:dir_next
    02D58 2EA0      MOV	R10,R16
    02D59 2D4A      MOV	R20,R10
(3026) 				if (res == FR_NO_FILE) {
    02D5A 3004      CPI	R16,4
    02D5B F441      BNE	0x2D64
(3027) 					dj->sect = 0;
    02D5C 01FB      MOVW	R30,R22
    02D5D 963E      ADIW	R30,0xE
    02D5E E080      LDI	R24,0
    02D5F 8380      ST	Z,R24
    02D60 8381      STD	Z+1,R24
    02D61 8382      STD	Z+2,R24
    02D62 8383      STD	Z+3,R24
(3028) 					res = FR_OK;
    02D63 2744      CLR	R20
(3029) 				}
(3030) 			}
(3031) 			FREE_BUF();
(3032) 		}
(3033) 	}
(3034) 
(3035) 	LEAVE_FF(dj->fs, res);
    02D64 2F04      MOV	R16,R20
    02D65 962C      ADIW	R28,0xC
    02D66 940C 4BEF JMP	pop_xgsetF03C
FILE: D:\LQD\software\software_src\delay.c
(0001) /*******************************
(0002)  function ：延时函数
(0003) Clock F  :7.3728M 
(0004) Software : ICCAVR7.14C
(0005) ********************************/
(0006) /*---------------------------------------------------------------------------------
(0007)      延时程序计算方法
(0008)      计数个数j = 延时时间/6*晶振频率 - 1
(0009) ---------------------------------------------------------------------------------*/
(0010) void delayus(unsigned int tttt)   // 1.2us 延时子函数   
(0011) { 
(0012)    do
(0013)    {
(0014)        tttt--;
_delayus:
  tttt                 --> R16
    02D68 5001      SUBI	R16,1
    02D69 4010      SBCI	R17,0
(0015)    }
(0016)    while(tttt>1);
    02D6A E081      LDI	R24,1
    02D6B E090      LDI	R25,0
    02D6C 1780      CP	R24,R16
    02D6D 0791      CPC	R25,R17
    02D6E F3C8      BCS	0x2D68
    02D6F 9508      RET
_delayms:
  j                    --> R20
  i                    --> R16
    02D70 934A      ST	-Y,R20
    02D71 935A      ST	-Y,R21
(0017) }
(0018) void delayms(unsigned int i)                 //1ms延时
(0019)    {
    02D72 C00A      RJMP	0x2D7D
(0020)     while(i--)
(0021)     {                          
(0022) 	    unsigned int j;                
(0023)         for(j=1;j<=1227;j++)   
    02D73 E041      LDI	R20,1
    02D74 E050      LDI	R21,0
    02D75 C002      RJMP	0x2D78
    02D76 5F4F      SUBI	R20,0xFF
    02D77 4F5F      SBCI	R21,0xFF
    02D78 EC8B      LDI	R24,0xCB
    02D79 E094      LDI	R25,4
    02D7A 1784      CP	R24,R20
    02D7B 0795      CPC	R25,R21
    02D7C F7C8      BCC	0x2D76
    02D7D 0118      MOVW	R2,R16
    02D7E 5001      SUBI	R16,1
    02D7F 4010      SBCI	R17,0
    02D80 2022      TST	R2
    02D81 F789      BNE	0x2D73
    02D82 2033      TST	R3
    02D83 F779      BNE	0x2D73
    02D84 9159      LD	R21,Y+
    02D85 9149      LD	R20,Y+
    02D86 9508      RET
_SD_Write_cmd:
  k                    --> R22
  temp                 --> R20
  p                    --> R20
    02D87 940E 4BC0 CALL	push_xgsetF000
    02D89 01A8      MOVW	R20,R16
FILE: D:\LQD\software\software_src\sd.c
(0001) //*****************************************************************************//
(0002) //*								数码相框
(0003) //*控制芯片：ATmgea128
(0004) //*开发环境：AVR Studio+GCC
(0005) //*隶属模块：SD卡控制
(0006) //*修改者：  桃子
(0007) //*****************************************************************************//
(0008) #include "sd.h"
(0009) 
(0010) //****************************************************************
(0011) //*隶属模块：SD卡控制
(0012) //*函数功能：写6字节数据
(0013) //****************************************************************
(0014) UINT8 SD_Write_cmd(UINT8 *p)
(0015) {	
(0016) 	UINT16 temp,k=0;
    02D8A 2766      CLR	R22
    02D8B 2777      CLR	R23
(0017) 	SD_CS_DIS();//禁止SPI
    02D8C 9AC0      SBI	0x18,0
(0018) 	SPI_Read();//空读一字节
    02D8D 940E 3F4C CALL	_SPI_Read
(0019) 	SD_CS_EN();//使能SPI
    02D8F 98C0      CBI	0x18,0
(0020) 
(0021) 	SPI_Write(p[0]);
    02D90 01FA      MOVW	R30,R20
    02D91 8100      LD	R16,Z
    02D92 940E 3F48 CALL	_SPI_Write
(0022) 	SPI_Write(p[1]);
    02D94 01FA      MOVW	R30,R20
    02D95 8101      LDD	R16,Z+1
    02D96 940E 3F48 CALL	_SPI_Write
(0023) 	SPI_Write(p[2]);
    02D98 01FA      MOVW	R30,R20
    02D99 8102      LDD	R16,Z+2
    02D9A 940E 3F48 CALL	_SPI_Write
(0024) 	SPI_Write(p[3]);
    02D9C 01FA      MOVW	R30,R20
    02D9D 8103      LDD	R16,Z+3
    02D9E 940E 3F48 CALL	_SPI_Write
(0025) 	SPI_Write(p[4]);
    02DA0 01FA      MOVW	R30,R20
    02DA1 8104      LDD	R16,Z+4
    02DA2 940E 3F48 CALL	_SPI_Write
(0026) 	SPI_Write(p[5]);
    02DA4 01FA      MOVW	R30,R20
    02DA5 8105      LDD	R16,Z+5
    02DA6 940E 3F48 CALL	_SPI_Write
(0027) 
(0028) 	do 
(0029)  	{  
(0030)   		temp = SPI_Read();//一直读，直到读到的不是0xff或超时
    02DA8 940E 3F4C CALL	_SPI_Read
    02DAA 2F40      MOV	R20,R16
    02DAB 2755      CLR	R21
(0031)  		k++;
    02DAC 5F6F      SUBI	R22,0xFF
    02DAD 4F7F      SBCI	R23,0xFF
(0032)  	}while((temp==0xff)&&(k<TRY_TIME)); 
    02DAE 3F4F      CPI	R20,0xFF
    02DAF E0E0      LDI	R30,0
    02DB0 075E      CPC	R21,R30
    02DB1 F421      BNE	0x2DB6
    02DB2 3164      CPI	R22,0x14
    02DB3 E0E0      LDI	R30,0
    02DB4 077E      CPC	R23,R30
    02DB5 F390      BCS	0x2DA8
(0033) 
(0034) 	return temp;
    02DB6 2F04      MOV	R16,R20
    02DB7 940C 4BC5 JMP	pop_xgsetF000
_SD_Init:
  pcmd                 --> Y,+0
  temp                 --> R22
  time                 --> R20
    02DB9 940E 4BCA CALL	push_xgsetF00C
    02DBB 9726      SBIW	R28,6
(0035) }
(0036) //****************************************************************
(0037) //*隶属模块：SD卡控制
(0038) //*函数功能：初始化
(0039) //****************************************************************
(0040) UINT8 SD_Init(void)	
(0041) {  
(0042) 	UINT8 time=0,temp=0;
    02DBC 2744      CLR	R20
    02DBD 2766      CLR	R22
(0043) 	UINT8 pcmd[] = {0x40,0x00,0x00,0x00,0x00,0x95}; //命令0的字节序列
    02DBE E88A      LDI	R24,0x8A
    02DBF E092      LDI	R25,2
    02DC0 01FE      MOVW	R30,R28
    02DC1 E006      LDI	R16,6
    02DC2 E010      LDI	R17,0
    02DC3 93FA      ST	-Y,R31
    02DC4 93EA      ST	-Y,R30
    02DC5 939A      ST	-Y,R25
    02DC6 938A      ST	-Y,R24
    02DC7 940E 4C5B CALL	asgnblk
(0044) 	if(SD_DET()==0) return 0x02; //no disk
    02DC9 B181      IN	R24,0x01
    02DCA 9586      LSR	R24
    02DCB 9586      LSR	R24
    02DCC 9586      LSR	R24
    02DCD 9586      LSR	R24
    02DCE 9586      LSR	R24
    02DCF 7081      ANDI	R24,1
    02DD0 F421      BNE	0x2DD5
    02DD1 E081      LDI	R24,1
    02DD2 E090      LDI	R25,0
    02DD3 015C      MOVW	R10,R24
    02DD4 C002      RJMP	0x2DD7
    02DD5 24AA      CLR	R10
    02DD6 24BB      CLR	R11
    02DD7 20AA      TST	R10
    02DD8 F421      BNE	0x2DDD
    02DD9 20BB      TST	R11
    02DDA F411      BNE	0x2DDD
    02DDB E002      LDI	R16,2
    02DDC C039      RJMP	0x2E16
(0045) 	SD_PORT |= (1<<SD_CS);
    02DDD 9AC0      SBI	0x18,0
(0046) 	SD_DDR |= (1<<SD_CS);
    02DDE 9AB8      SBI	0x17,0
(0047) 
(0048) 	SPI_IO_Init();
    02DDF 940E 3F3E CALL	_SPI_IO_Init
(0049) 	SPI_Low();
    02DE1 E582      LDI	R24,0x52
    02DE2 B98D      OUT	0x0D,R24
    02DE3 B18E      IN	R24,0x0E
    02DE4 7F8F      ANDI	R24,0xFF
    02DE5 B98E      OUT	0x0E,R24
(0050) 
(0051) 	SD_CS_DIS();  //关闭片选 
    02DE6 9AC0      SBI	0x18,0
(0052) 	for(time=0;time<10;time++) //初始时，首先要发送最少74个时钟信号，这是必须的！！！
    02DE7 2744      CLR	R20
    02DE8 C003      RJMP	0x2DEC
(0053) 	{
(0054)   		SPI_Read(); 
    02DE9 940E 3F4C CALL	_SPI_Read
    02DEB 9543      INC	R20
    02DEC 304A      CPI	R20,0xA
    02DED F3D8      BCS	0x2DE9
(0055) 	}
(0056) 	SD_CS_EN(); //打开片选
    02DEE 98C0      CBI	0x18,0
(0057) 	time = 0;
    02DEF 2744      CLR	R20
(0058) 	do
(0059) 	{ 
(0060) 		temp=SD_Write_cmd(pcmd);//写入CMD0
    02DF0 018E      MOVW	R16,R28
    02DF1 DF95      RCALL	_SD_Write_cmd
    02DF2 2F60      MOV	R22,R16
(0061) 	 	time++;
    02DF3 9543      INC	R20
(0062) 	 	if(time==TRY_TIME) 
    02DF4 3144      CPI	R20,0x14
    02DF5 F419      BNE	0x2DF9
(0063) 	 	{ 
(0064) 	  		SD_CS_DIS(); //关闭片选
    02DF6 9AC0      SBI	0x18,0
(0065) 	  		return(INIT_CMD0_ERROR);//CMD0写入失败
    02DF7 E001      LDI	R16,1
    02DF8 C01D      RJMP	0x2E16
(0066) 	 	}
(0067) 	 }while(temp!=0x01);
    02DF9 3061      CPI	R22,1
    02DFA F7A9      BNE	0x2DF0
(0068) 
(0069) 	SD_CS_DIS(); //关闭片选
    02DFB 9AC0      SBI	0x18,0
(0070) 	SPI_Read(); //按照SD卡的操作时序在这里补8个时钟 
    02DFC 940E 3F4C CALL	_SPI_Read
(0071) 	SD_CS_EN(); //打开片选
    02DFE 98C0      CBI	0x18,0
(0072) 
(0073) 	pcmd[0]=0x41,pcmd[5]=0xff;
    02DFF E481      LDI	R24,0x41
    02E00 8388      ST	Y,R24
    02E01 EF8F      LDI	R24,0xFF
    02E02 838D      STD	Y+5,R24
(0074) 	time = 0;
    02E03 2744      CLR	R20
(0075) 	do
(0076) 	{ 
(0077) 		temp=SD_Write_cmd(pcmd);
    02E04 018E      MOVW	R16,R28
    02E05 DF81      RCALL	_SD_Write_cmd
    02E06 2F60      MOV	R22,R16
(0078) 		time++;
    02E07 9543      INC	R20
(0079) 		if(time==TRY_TIME) 
    02E08 3144      CPI	R20,0x14
    02E09 F419      BNE	0x2E0D
(0080) 		{ 
(0081) 		 	SD_CS_DIS(); //关闭片选
    02E0A 9AC0      SBI	0x18,0
(0082) 			 return(INIT_CMD1_ERROR);//CMD1写入失败
    02E0B E002      LDI	R16,2
    02E0C C009      RJMP	0x2E16
(0083) 		 }
(0084) 	 }while(temp!=0);
    02E0D 2366      TST	R22
    02E0E F7A9      BNE	0x2E04
(0085)   
(0086) 	 SPI_High();  
    02E0F E580      LDI	R24,0x50
    02E10 B98D      OUT	0x0D,R24
    02E11 9A70      SBI	0x0E,0
(0087) 	 SD_CS_DIS();  //关闭片选 
    02E12 9AC0      SBI	0x18,0
(0088) 	 SPI_Read(); //按照SD卡的操作时序在这里补8个时钟
    02E13 940E 3F4C CALL	_SPI_Read
(0089) 	 return SD_TURE; //返回0,说明初始化操作成功
    02E15 2700      CLR	R16
    02E16 9626      ADIW	R28,6
    02E17 940C 4BD1 JMP	pop_xgsetF00C
_SD_Write_Sector:
  pcmd                 --> Y,+0
  time                 --> R12
  temp                 --> R20
  i                    --> R22
  buffer               --> R10
  addr                 --> Y,+14
    02E19 940E 4A66 CALL	push_arg4
    02E1B 940E 4BE6 CALL	push_xgsetF03C
    02E1D 9726      SBIW	R28,6
    02E1E 88AA      LDD	R10,Y+18
    02E1F 88BB      LDD	R11,Y+19
(0090) } 
(0091) //****************************************************************
(0092) //*隶属模块：SD卡控制
(0093) //*函数功能：写512字节数据（一扇区字节）
(0094) //****************************************************************
(0095) UINT16 SD_Write_Sector(UINT32 addr,UINT8 *buffer)
(0096) {  
(0097) 	UINT8 temp=0,time=0;
    02E20 2744      CLR	R20
    02E21 24CC      CLR	R12
(0098) 	UINT16 i=0;
    02E22 2766      CLR	R22
    02E23 2777      CLR	R23
(0099) 	UINT8 pcmd[] = {0x58,0x00,0x00,0x00,0x00,0xff}; //向SD卡中单个块（512字节，一个扇区）写入数据，用CMD24
    02E24 E980      LDI	R24,0x90
    02E25 E092      LDI	R25,2
    02E26 01FE      MOVW	R30,R28
    02E27 E006      LDI	R16,6
    02E28 E010      LDI	R17,0
    02E29 93FA      ST	-Y,R31
    02E2A 93EA      ST	-Y,R30
    02E2B 939A      ST	-Y,R25
    02E2C 938A      ST	-Y,R24
    02E2D 940E 4C5B CALL	asgnblk
(0100) 
(0101) 	 addr<<=9; //将块地址（扇区地址）转为字节地址 ［这里就限制了SD卡的最大容量为4G］
    02E2F E089      LDI	R24,0x9
    02E30 E090      LDI	R25,0
    02E31 850E      LDD	R16,Y+14
    02E32 851F      LDD	R17,Y+15
    02E33 8928      LDD	R18,Y+16
    02E34 8939      LDD	R19,Y+17
    02E35 938A      ST	-Y,R24
    02E36 940E 4C36 CALL	lsl32
    02E38 870E      STD	Y+14,R16
    02E39 871F      STD	Y+15,R17
    02E3A 8B28      STD	Y+16,R18
    02E3B 8B39      STD	Y+17,R19
(0102) 
(0103) 	 pcmd[1]=(addr>>24); //将字节地址写入到CMD24字节序列中
    02E3C E188      LDI	R24,0x18
    02E3D E090      LDI	R25,0
    02E3E 850E      LDD	R16,Y+14
    02E3F 851F      LDD	R17,Y+15
    02E40 8928      LDD	R18,Y+16
    02E41 8939      LDD	R19,Y+17
    02E42 938A      ST	-Y,R24
    02E43 940E 4C4F CALL	lsr32
    02E45 8309      STD	Y+1,R16
(0104) 	 pcmd[2]=(addr>>16);
    02E46 842E      LDD	R2,Y+14
    02E47 843F      LDD	R3,Y+15
    02E48 8848      LDD	R4,Y+16
    02E49 8859      LDD	R5,Y+17
    02E4A 0112      MOVW	R2,R4
    02E4B 2444      CLR	R4
    02E4C 2455      CLR	R5
    02E4D 822A      STD	Y+2,R2
(0105) 	 pcmd[3]=(addr>>8);
    02E4E E088      LDI	R24,0x8
    02E4F E090      LDI	R25,0
    02E50 850E      LDD	R16,Y+14
    02E51 851F      LDD	R17,Y+15
    02E52 8928      LDD	R18,Y+16
    02E53 8939      LDD	R19,Y+17
    02E54 938A      ST	-Y,R24
    02E55 940E 4C4F CALL	lsr32
    02E57 830B      STD	Y+3,R16
(0106) 	// pcmd[4]=offset;	
(0107) 	 SD_CS_EN();//打开SD卡片选
    02E58 98C0      CBI	0x18,0
(0108) 
(0109) 	 do
(0110) 	 {  
(0111) 		temp=SD_Write_cmd(pcmd);
    02E59 018E      MOVW	R16,R28
    02E5A DF2C      RCALL	_SD_Write_cmd
    02E5B 2F40      MOV	R20,R16
(0112)   		time++;
    02E5C 94C3      INC	R12
(0113)   		if(time==TRY_TIME) 
    02E5D 2D8C      MOV	R24,R12
    02E5E 3184      CPI	R24,0x14
    02E5F F419      BNE	0x2E63
(0114)   		{ 
(0115)    			SD_CS_DIS(); //关闭片选
    02E60 9AC0      SBI	0x18,0
(0116)    			return(temp); //命令写入失败
    02E61 2711      CLR	R17
    02E62 C037      RJMP	0x2E9A
(0117)   		}
(0118) 	}while(temp!=0); 
    02E63 2344      TST	R20
    02E64 F7A1      BNE	0x2E59
(0119) 
(0120) 	for(i=0;i<100;i++) //这里要插入若干时钟信号
    02E65 2766      CLR	R22
    02E66 2777      CLR	R23
    02E67 C004      RJMP	0x2E6C
(0121)   		SPI_Read();
    02E68 940E 3F4C CALL	_SPI_Read
    02E6A 5F6F      SUBI	R22,0xFF
    02E6B 4F7F      SBCI	R23,0xFF
    02E6C 3664      CPI	R22,0x64
    02E6D E0E0      LDI	R30,0
    02E6E 077E      CPC	R23,R30
    02E6F F3C0      BCS	0x2E68
(0122) 	
(0123) 	SPI_Write(0xfe);//写入开始字节 0xfe，后面就是要写入的512个字节的数据	
    02E70 EF0E      LDI	R16,0xFE
    02E71 940E 3F48 CALL	_SPI_Write
(0124) 	
(0125) 	for(i=0;i<512;i++) //将缓冲区中要写入的512个字节写入SD卡
    02E73 2766      CLR	R22
    02E74 2777      CLR	R23
    02E75 C007      RJMP	0x2E7D
(0126) 		SPI_Write(*buffer++);
    02E76 01F5      MOVW	R30,R10
    02E77 9101      LD	R16,Z+
    02E78 015F      MOVW	R10,R30
    02E79 940E 3F48 CALL	_SPI_Write
    02E7B 5F6F      SUBI	R22,0xFF
    02E7C 4F7F      SBCI	R23,0xFF
    02E7D 3060      CPI	R22,0
    02E7E E0E2      LDI	R30,2
    02E7F 077E      CPC	R23,R30
    02E80 F3A8      BCS	0x2E76
(0127)   
(0128) 	SPI_Read(); 
    02E81 940E 3F4C CALL	_SPI_Read
(0129) 	SPI_Read(); //两个字节的CRC校验码，不用关心
    02E83 940E 3F4C CALL	_SPI_Read
(0130)    
(0131)     
(0132) 	temp=SPI_Read();   //读取返回值
    02E85 940E 3F4C CALL	_SPI_Read
    02E87 2F40      MOV	R20,R16
(0133) 	if((temp&0x1F)!=0x05) //如果返回值是 XXX00101说明数据已经被SD卡接受了
    02E88 2F84      MOV	R24,R20
    02E89 718F      ANDI	R24,0x1F
    02E8A 3085      CPI	R24,5
    02E8B F021      BEQ	0x2E90
(0134) 	{
(0135)  		SD_CS_DIS();
    02E8C 9AC0      SBI	0x18,0
(0136)  		return(WRITE_BLOCK_ERROR); //写块数据失败
    02E8D E003      LDI	R16,3
    02E8E E010      LDI	R17,0
    02E8F C00A      RJMP	0x2E9A
(0137) 	}
(0138)  
(0139) 	while(SPI_Read()!=0xff);//等到SD卡不忙（数据被接受以后，SD卡要将这些数据写入到自身的FLASH中，需要一个时间）
    02E90 940E 3F4C CALL	_SPI_Read
    02E92 2F40      MOV	R20,R16
    02E93 3F0F      CPI	R16,0xFF
    02E94 F7D9      BNE	0x2E90
(0140) 						    //忙时，读回来的值为0x00,不忙时，为0xff
(0141) 
(0142) 	SD_CS_DIS(); //关闭片选
    02E95 9AC0      SBI	0x18,0
(0143) 
(0144) 	SPI_Read();//按照SD卡的操作时序在这里补8个时钟
    02E96 940E 3F4C CALL	_SPI_Read
(0145) 	return SD_TURE;		 //返回0,说明写扇区操作成功
    02E98 2700      CLR	R16
    02E99 2711      CLR	R17
    02E9A 9626      ADIW	R28,6
    02E9B 940E 4BEF CALL	pop_xgsetF03C
    02E9D 9624      ADIW	R28,4
    02E9E 9508      RET
_SD_Read_Sector:
  pcmd                 --> Y,+0
  temp                 --> R12
  time                 --> R22
  j                    --> R20
  buffer               --> R10
  addr                 --> Y,+14
    02E9F 940E 4A66 CALL	push_arg4
    02EA1 940E 4BE6 CALL	push_xgsetF03C
    02EA3 9726      SBIW	R28,6
    02EA4 88AA      LDD	R10,Y+18
    02EA5 88BB      LDD	R11,Y+19
(0146) } 
(0147) //****************************************************************
(0148) //*隶属模块：SD卡控制
(0149) //*函数功能：读512字节数据（一扇区字节）
(0150) //****************************************************************
(0151) UINT16 SD_Read_Sector(UINT32 addr,UINT8 *buffer)//从SD卡的指定扇区中读出512个字节，使用CMD17（17号命令）
(0152) {
(0153) 
(0154) 	 UINT16 j=0;
    02EA6 2744      CLR	R20
    02EA7 2755      CLR	R21
(0155) 	 UINT8 time=0,temp=0;
    02EA8 2766      CLR	R22
    02EA9 24CC      CLR	R12
(0156) 	 UINT8 pcmd[]={0x51,0x00,0x00,0x00,0x00,0xff}; //CMD17的字节序列
    02EAA E986      LDI	R24,0x96
    02EAB E092      LDI	R25,2
    02EAC 01FE      MOVW	R30,R28
    02EAD E006      LDI	R16,6
    02EAE E010      LDI	R17,0
    02EAF 93FA      ST	-Y,R31
    02EB0 93EA      ST	-Y,R30
    02EB1 939A      ST	-Y,R25
    02EB2 938A      ST	-Y,R24
    02EB3 940E 4C5B CALL	asgnblk
(0157) 
(0158) 	 addr <<= 9; //将块地址（扇区地址）转为字节地址
    02EB5 E089      LDI	R24,0x9
    02EB6 E090      LDI	R25,0
    02EB7 850E      LDD	R16,Y+14
    02EB8 851F      LDD	R17,Y+15
    02EB9 8928      LDD	R18,Y+16
    02EBA 8939      LDD	R19,Y+17
    02EBB 938A      ST	-Y,R24
    02EBC 940E 4C36 CALL	lsl32
    02EBE 870E      STD	Y+14,R16
    02EBF 871F      STD	Y+15,R17
    02EC0 8B28      STD	Y+16,R18
    02EC1 8B39      STD	Y+17,R19
(0159) 
(0160) 	 pcmd[1] = (addr>>24);//将字节地址写入到CMD17字节序列中
    02EC2 E188      LDI	R24,0x18
    02EC3 E090      LDI	R25,0
    02EC4 850E      LDD	R16,Y+14
    02EC5 851F      LDD	R17,Y+15
    02EC6 8928      LDD	R18,Y+16
    02EC7 8939      LDD	R19,Y+17
    02EC8 938A      ST	-Y,R24
    02EC9 940E 4C4F CALL	lsr32
    02ECB 8309      STD	Y+1,R16
(0161) 	 pcmd[2] = (addr>>16);
    02ECC 842E      LDD	R2,Y+14
    02ECD 843F      LDD	R3,Y+15
    02ECE 8848      LDD	R4,Y+16
    02ECF 8859      LDD	R5,Y+17
    02ED0 0112      MOVW	R2,R4
    02ED1 2444      CLR	R4
    02ED2 2455      CLR	R5
    02ED3 822A      STD	Y+2,R2
(0162) 	 pcmd[3] =(addr>>8);
    02ED4 E088      LDI	R24,0x8
    02ED5 E090      LDI	R25,0
    02ED6 850E      LDD	R16,Y+14
    02ED7 851F      LDD	R17,Y+15
    02ED8 8928      LDD	R18,Y+16
    02ED9 8939      LDD	R19,Y+17
    02EDA 938A      ST	-Y,R24
    02EDB 940E 4C4F CALL	lsr32
    02EDD 830B      STD	Y+3,R16
(0163) 	// pcmd[4] = offset;
(0164) 
(0165) 	 SD_CS_EN();//打开片选 
    02EDE 98C0      CBI	0x18,0
(0166) 
(0167) 	 do
(0168) 	 {  
(0169) 		  temp=SD_Write_cmd(pcmd); //写入CMD17
    02EDF 018E      MOVW	R16,R28
    02EE0 DEA6      RCALL	_SD_Write_cmd
    02EE1 2EC0      MOV	R12,R16
(0170) 		  time++;
    02EE2 9563      INC	R22
(0171) 		  if(time==TRY_TIME) 
    02EE3 3164      CPI	R22,0x14
    02EE4 F421      BNE	0x2EE9
(0172) 		  {
(0173) 		   SD_CS_DIS();
    02EE5 9AC0      SBI	0x18,0
(0174) 		   return(READ_BLOCK_ERROR); //读块失败
    02EE6 E004      LDI	R16,4
    02EE7 E010      LDI	R17,0
    02EE8 C01F      RJMP	0x2F08
(0175) 		  }
(0176) 	 }while(temp!=0); 
    02EE9 20CC      TST	R12
    02EEA F7A1      BNE	0x2EDF
(0177)    			
(0178) 	 while(SPI_Read()!= 0xfe); //一直读，当读到0xfe时，说明后面的是512字节的数据了
    02EEB 940E 3F4C CALL	_SPI_Read
    02EED 3F0E      CPI	R16,0xFE
    02EEE F7E1      BNE	0x2EEB
(0179)  		   	   	
(0180) 	 for(j=0;j<512;j++)	 //将数据写入到数据缓冲区中
    02EEF 2744      CLR	R20
    02EF0 2755      CLR	R21
    02EF1 C009      RJMP	0x2EFB
(0181) 	 {	
(0182) 	    buffer[j]=SPI_Read();
    02EF2 940E 3F4C CALL	_SPI_Read
    02EF4 2EC0      MOV	R12,R16
    02EF5 01FA      MOVW	R30,R20
    02EF6 0DEA      ADD	R30,R10
    02EF7 1DFB      ADC	R31,R11
    02EF8 82C0      ST	Z,R12
    02EF9 5F4F      SUBI	R20,0xFF
    02EFA 4F5F      SBCI	R21,0xFF
    02EFB 3040      CPI	R20,0
    02EFC E0E2      LDI	R30,2
    02EFD 075E      CPC	R21,R30
    02EFE F398      BCS	0x2EF2
(0183) 	 }
(0184) 
(0185) 	 SPI_Read();//读取两个字节的CRC校验码，不用关心它们
    02EFF 940E 3F4C CALL	_SPI_Read
(0186) 	 SPI_Read();
    02F01 940E 3F4C CALL	_SPI_Read
(0187) 
(0188) 	 SD_CS_DIS();  //SD卡关闭片选 
    02F03 9AC0      SBI	0x18,0
(0189) 
(0190) 	 SPI_Read();//按照SD卡的操作时序在这里补8个时钟
    02F04 940E 3F4C CALL	_SPI_Read
(0191) 
(0192) 	 return SD_TURE;
    02F06 2700      CLR	R16
    02F07 2711      CLR	R17
    02F08 9626      ADIW	R28,6
    02F09 940E 4BEF CALL	pop_xgsetF03C
    02F0B 9624      ADIW	R28,4
    02F0C 9508      RET
_SD_Read_Sector_ndata:
  pcmd                 --> Y,+0
  temp                 --> R12
  time                 --> R22
  j                    --> R20
  len                  --> R14
  offset               --> R10
  buffer               --> Y,+20
  addr                 --> Y,+16
    02F0D 940E 4A66 CALL	push_arg4
    02F0F 940E 4BAB CALL	push_xgsetF0FC
    02F11 9726      SBIW	R28,6
    02F12 88AE      LDD	R10,Y+22
    02F13 88BF      LDD	R11,Y+23
    02F14 8CE8      LDD	R14,Y+24
    02F15 8CF9      LDD	R15,Y+25
(0193) }
(0194) //****************************************************************
(0195) //*隶属模块：SD卡控制
(0196) //*函数功能：写多扇区数据（多扇区字节）
(0197) //****************************************************************
(0198) UINT16 SD_Read_Sector_ndata(UINT32 addr,UINT8 *buffer,UINT16 offset,UINT16 len)//从SD卡的指定扇区中读出512个字节，使用CMD17（17号命令）
(0199) {
(0200) 
(0201) 	 UINT16 j=0;
    02F16 2744      CLR	R20
    02F17 2755      CLR	R21
(0202) 	 UINT8 time=0,temp=0;
    02F18 2766      CLR	R22
    02F19 24CC      CLR	R12
(0203) 	 UINT8 pcmd[]={0x51,0x00,0x00,0x00,0x00,0xff}; //CMD17的字节序列
    02F1A E98C      LDI	R24,0x9C
    02F1B E092      LDI	R25,2
    02F1C 01FE      MOVW	R30,R28
    02F1D E006      LDI	R16,6
    02F1E E010      LDI	R17,0
    02F1F 93FA      ST	-Y,R31
    02F20 93EA      ST	-Y,R30
    02F21 939A      ST	-Y,R25
    02F22 938A      ST	-Y,R24
    02F23 940E 4C5B CALL	asgnblk
(0204) 
(0205) 	 addr <<= 9; //将块地址（扇区地址）转为字节地址
    02F25 E089      LDI	R24,0x9
    02F26 E090      LDI	R25,0
    02F27 8908      LDD	R16,Y+16
    02F28 8919      LDD	R17,Y+17
    02F29 892A      LDD	R18,Y+18
    02F2A 893B      LDD	R19,Y+19
    02F2B 938A      ST	-Y,R24
    02F2C 940E 4C36 CALL	lsl32
    02F2E 8B08      STD	Y+16,R16
    02F2F 8B19      STD	Y+17,R17
    02F30 8B2A      STD	Y+18,R18
    02F31 8B3B      STD	Y+19,R19
(0206) 
(0207) 	 pcmd[1] = (addr>>24);//将字节地址写入到CMD17字节序列中
    02F32 E188      LDI	R24,0x18
    02F33 E090      LDI	R25,0
    02F34 8908      LDD	R16,Y+16
    02F35 8919      LDD	R17,Y+17
    02F36 892A      LDD	R18,Y+18
    02F37 893B      LDD	R19,Y+19
    02F38 938A      ST	-Y,R24
    02F39 940E 4C4F CALL	lsr32
    02F3B 8309      STD	Y+1,R16
(0208) 	 pcmd[2] = (addr>>16);
    02F3C 8828      LDD	R2,Y+16
    02F3D 8839      LDD	R3,Y+17
    02F3E 884A      LDD	R4,Y+18
    02F3F 885B      LDD	R5,Y+19
    02F40 0112      MOVW	R2,R4
    02F41 2444      CLR	R4
    02F42 2455      CLR	R5
    02F43 822A      STD	Y+2,R2
(0209) 	 pcmd[3] =(addr>>8);
    02F44 E088      LDI	R24,0x8
    02F45 E090      LDI	R25,0
    02F46 8908      LDD	R16,Y+16
    02F47 8919      LDD	R17,Y+17
    02F48 892A      LDD	R18,Y+18
    02F49 893B      LDD	R19,Y+19
    02F4A 938A      ST	-Y,R24
    02F4B 940E 4C4F CALL	lsr32
    02F4D 830B      STD	Y+3,R16
(0210) 	// pcmd[4] = offset;
(0211) 
(0212) 	 SD_CS_EN();//打开片选 
    02F4E 98C0      CBI	0x18,0
(0213) 
(0214) 	 do
(0215) 	 {  
(0216) 		  temp=SD_Write_cmd(pcmd); //写入CMD17
    02F4F 018E      MOVW	R16,R28
    02F50 DE36      RCALL	_SD_Write_cmd
    02F51 2EC0      MOV	R12,R16
(0217) 		  time++;
    02F52 9563      INC	R22
(0218) 		  if(time==TRY_TIME) 
    02F53 3164      CPI	R22,0x14
    02F54 F421      BNE	0x2F59
(0219) 		  {
(0220) 		   SD_CS_DIS();
    02F55 9AC0      SBI	0x18,0
(0221) 		   return(READ_BLOCK_ERROR); //读块失败
    02F56 E004      LDI	R16,4
    02F57 E010      LDI	R17,0
    02F58 C034      RJMP	0x2F8D
(0222) 		  }
(0223) 	 }while(temp!=0); 
    02F59 20CC      TST	R12
    02F5A F7A1      BNE	0x2F4F
(0224)    			
(0225) 	 while(SPI_Read()!= 0xfe); //一直读，当读到0xfe时，说明后面的是512字节的数据了
    02F5B 940E 3F4C CALL	_SPI_Read
    02F5D 3F0E      CPI	R16,0xFE
    02F5E F7E1      BNE	0x2F5B
(0226)  		   	   	
(0227) 	 for(j=0;j<offset;j++)	 //将数据写入到数据缓冲区中
    02F5F 2744      CLR	R20
    02F60 2755      CLR	R21
    02F61 C004      RJMP	0x2F66
(0228) 	    SPI_Read();
    02F62 940E 3F4C CALL	_SPI_Read
    02F64 5F4F      SUBI	R20,0xFF
    02F65 4F5F      SBCI	R21,0xFF
    02F66 154A      CP	R20,R10
    02F67 055B      CPC	R21,R11
    02F68 F3C8      BCS	0x2F62
(0229) 	 for(;j<offset+len;j++)	 
    02F69 C00B      RJMP	0x2F75
(0230) 		buffer[j]=SPI_Read();
    02F6A 940E 3F4C CALL	_SPI_Read
    02F6C 2F60      MOV	R22,R16
    02F6D 01FA      MOVW	R30,R20
    02F6E 880C      LDD	R0,Y+20
    02F6F 881D      LDD	R1,Y+21
    02F70 0DE0      ADD	R30,R0
    02F71 1DF1      ADC	R31,R1
    02F72 8360      ST	Z,R22
    02F73 5F4F      SUBI	R20,0xFF
    02F74 4F5F      SBCI	R21,0xFF
    02F75 0115      MOVW	R2,R10
    02F76 0C2E      ADD	R2,R14
    02F77 1C3F      ADC	R3,R15
    02F78 1542      CP	R20,R2
    02F79 0553      CPC	R21,R3
    02F7A F378      BCS	0x2F6A
(0231) 	 for(;j<512;j++)	 
    02F7B C004      RJMP	0x2F80
(0232) 		SPI_Read();
    02F7C 940E 3F4C CALL	_SPI_Read
    02F7E 5F4F      SUBI	R20,0xFF
    02F7F 4F5F      SBCI	R21,0xFF
    02F80 3040      CPI	R20,0
    02F81 E0E2      LDI	R30,2
    02F82 075E      CPC	R21,R30
    02F83 F3C0      BCS	0x2F7C
(0233) 
(0234) 	 SPI_Read();//读取两个字节的CRC校验码，不用关心它们
    02F84 940E 3F4C CALL	_SPI_Read
(0235) 	 SPI_Read();
    02F86 940E 3F4C CALL	_SPI_Read
(0236) 
(0237) 	 SD_CS_DIS();  //SD卡关闭片选 
    02F88 9AC0      SBI	0x18,0
(0238) 
(0239) 	 SPI_Read();//按照SD卡的操作时序在这里补8个时钟
    02F89 940E 3F4C CALL	_SPI_Read
(0240) 
(0241) 	 return SD_TURE;
    02F8B 2700      CLR	R16
    02F8C 2711      CLR	R17
    02F8D 9626      ADIW	R28,6
    02F8E 940E 4BA0 CALL	pop_xgsetF0FC
    02F90 9624      ADIW	R28,4
    02F91 9508      RET
_GUI_mainmeu:
  key                  --> R22
  select               --> R20
    02F92 940E 4BCA CALL	push_xgsetF00C
    02F94 9723      SBIW	R28,3
FILE: D:\LQD\software\software_src\gui.c
(0001) #include "config.h"
(0002) const char labelH[]="高强度作业：\0";
(0003) const char labelM[]="中等强度作业：\0";
(0004) const char labelL[]="低强度作业：\0";
(0005) const char H01[]="加强劳动监督；\0";
(0006) const char H02[]="增加饮水;\0" ;
(0007) const char H03[]="保持干燥禁裸露。\0";
(0008) #define M01 H01
(0009) #define M02 H03
(0010) const char M03[]="戴面罩。\0";
(0011) const char M04[]="禁油彩。\0";
(0012) #define L01 M03
(0013) #define L02 M04
(0014) const char L03[]="缩短作业时间。";
(0015) //-----//
(0016) #define H11 M04
(0017) #define H12 H03
(0018) const char H13[]="休息注意保暖。\0";
(0019) #define M11 H01
(0020) const char M12[]="减少非必须作业；\0";
(0021) const char M13[]="劳动时间<30min。\0";
(0022) const char L11[]="取消非必须的作业\0";
(0023) const char L12[]="劳动时间<15min；\0";
(0024) #define L13 H03
(0025) //-----//
(0026) #define H21 L11
(0027) #define H22 L12
(0028) #define H23 H03
(0029) const char M21[]="取消户外作业。"; 
(0030) #define L21 M21
(0031) const char str_blank[]="----------------"; 
(0032) //#define LEDON   PORTC&=~(1<<7)					   
(0033) //#define LEDOFF  PINC|=(1<<7)
(0034) char GUI_date[17]="09月19日18:00:00\0";
(0035) #define SW_ON 1
(0036) #define SW_OFF 0
(0037) // 主菜单
(0038) unsigned char GUI_mainmeu( void ){
(0039)  	unsigned char key=0; //init= nokey
    02F95 2766      CLR	R22
(0040) 	unsigned char select=3;
    02F96 E043      LDI	R20,3
(0041) 	LCD_CLR();
    02F97 940E 402C CALL	_LCD_CLR
(0042) 	
(0043)  	Set_White(1,1,8,1);
    02F99 E081      LDI	R24,1
    02F9A 838A      STD	Y+2,R24
    02F9B E088      LDI	R24,0x8
    02F9C 8388      ST	Y,R24
    02F9D E021      LDI	R18,1
    02F9E E001      LDI	R16,1
    02F9F 940E 40B6 CALL	_Set_White
(0044) 	Set_White(1,2,8,1);
    02FA1 E081      LDI	R24,1
    02FA2 838A      STD	Y+2,R24
    02FA3 E088      LDI	R24,0x8
    02FA4 8388      ST	Y,R24
    02FA5 E022      LDI	R18,2
    02FA6 E001      LDI	R16,1
    02FA7 940E 40B6 CALL	_Set_White
(0045) 	Set_White(1,3,8,1);
    02FA9 E081      LDI	R24,1
    02FAA 838A      STD	Y+2,R24
    02FAB E088      LDI	R24,0x8
    02FAC 8388      ST	Y,R24
    02FAD E023      LDI	R18,3
    02FAE E001      LDI	R16,1
    02FAF 940E 40B6 CALL	_Set_White
(0046) 	Set_White(1,4,8,1);
    02FB1 E081      LDI	R24,1
    02FB2 838A      STD	Y+2,R24
    02FB3 E088      LDI	R24,0x8
    02FB4 8388      ST	Y,R24
    02FB5 E024      LDI	R18,4
    02FB6 E001      LDI	R16,1
    02FB7 940E 40B6 CALL	_Set_White
(0047) 	dateRefresh(1); //更新系统时间
    02FB9 E001      LDI	R16,1
    02FBA 940E 39E7 CALL	_dateRefresh
(0048) 	LCD_const_disp(1,1,GUI_get_date()); //显示时间
    02FBC D5DF      RCALL	_GUI_get_date
    02FBD 8319      STD	Y+1,R17
    02FBE 8308      ST	Y,R16
    02FBF E021      LDI	R18,1
    02FC0 E001      LDI	R16,1
    02FC1 940E 3F86 CALL	_LCD_const_disp
(0049) 	LCD_const_disp(2,1,"  检测  时钟调整");
    02FC3 ED85      LDI	R24,0xD5
    02FC4 E095      LDI	R25,5
    02FC5 8399      STD	Y+1,R25
    02FC6 8388      ST	Y,R24
    02FC7 E021      LDI	R18,1
    02FC8 E002      LDI	R16,2
    02FC9 940E 3F86 CALL	_LCD_const_disp
(0050) 	LCD_const_disp(3,1,"  查询  数据传输");
    02FCB EC84      LDI	R24,0xC4
    02FCC E095      LDI	R25,5
    02FCD 8399      STD	Y+1,R25
    02FCE 8388      ST	Y,R24
    02FCF E021      LDI	R18,1
    02FD0 E003      LDI	R16,3
    02FD1 940E 3F86 CALL	_LCD_const_disp
(0051) 	LCD_const_disp(4,1,"  初始化");
    02FD3 EB8B      LDI	R24,0xBB
    02FD4 E095      LDI	R25,5
    02FD5 8399      STD	Y+1,R25
    02FD6 8388      ST	Y,R24
    02FD7 E021      LDI	R18,1
    02FD8 E004      LDI	R16,4
    02FD9 940E 3F86 CALL	_LCD_const_disp
(0052) 	Set_White(1,1,8,1);
    02FDB E081      LDI	R24,1
    02FDC 838A      STD	Y+2,R24
    02FDD E088      LDI	R24,0x8
    02FDE 8388      ST	Y,R24
    02FDF E021      LDI	R18,1
    02FE0 E001      LDI	R16,1
    02FE1 940E 40B6 CALL	_Set_White
(0053) 	Set_White(1,2,8,1);
    02FE3 E081      LDI	R24,1
    02FE4 838A      STD	Y+2,R24
    02FE5 E088      LDI	R24,0x8
    02FE6 8388      ST	Y,R24
    02FE7 E022      LDI	R18,2
    02FE8 E001      LDI	R16,1
    02FE9 940E 40B6 CALL	_Set_White
(0054) 	Set_White(1,3,8,1);
    02FEB E081      LDI	R24,1
    02FEC 838A      STD	Y+2,R24
    02FED E088      LDI	R24,0x8
    02FEE 8388      ST	Y,R24
    02FEF E023      LDI	R18,3
    02FF0 E001      LDI	R16,1
    02FF1 940E 40B6 CALL	_Set_White
(0055) 	Set_White(1,4,8,1);
    02FF3 E081      LDI	R24,1
    02FF4 838A      STD	Y+2,R24
    02FF5 E088      LDI	R24,0x8
    02FF6 8388      ST	Y,R24
    02FF7 E024      LDI	R18,4
    02FF8 E001      LDI	R16,1
    02FF9 940E 40B6 CALL	_Set_White
(0056) 	set_white_n(select,0);
    02FFB 2722      CLR	R18
    02FFC 2F04      MOV	R16,R20
    02FFD 940E 4148 CALL	_set_white_n
(0057) 	//处理上位机自动检测命令
(0058) 	if(config.comCmd == 0x01 || config.comCmd == 0x02) {
    02FFF 9180 08F2 LDS	R24,config+21
    03001 3081      CPI	R24,1
    03002 F019      BEQ	0x3006
    03003 3082      CPI	R24,2
    03004 F009      BEQ	0x3006
    03005 C07F      RJMP	0x3085
(0059) 	    return 3; //goto check();
    03006 E003      LDI	R16,3
    03007 C084      RJMP	0x308C
(0060) 	}
(0061) 		
(0062) 	while(alwaysCheck())
(0063) 	{
(0064) 	 	key=kbscan();
    03008 940E 458C CALL	_kbscan
    0300A 2F60      MOV	R22,R16
(0065) 		dateRefresh(1); //更新系统时间
    0300B E001      LDI	R16,1
    0300C 940E 39E7 CALL	_dateRefresh
(0066) 		LCD_const_disp(1,1,GUI_get_date()); //显示时间
    0300E D58D      RCALL	_GUI_get_date
    0300F 0158      MOVW	R10,R16
    03010 82B9      STD	Y+1,R11
    03011 82A8      ST	Y,R10
    03012 E021      LDI	R18,1
    03013 E001      LDI	R16,1
    03014 940E 3F86 CALL	_LCD_const_disp
(0067) 		if((select>3) && ( key==up ) ){
    03016 E083      LDI	R24,3
    03017 1784      CP	R24,R20
    03018 F4F8      BCC	0x3038
    03019 316E      CPI	R22,0x1E
    0301A F4E9      BNE	0x3038
(0068) 		 Set_White(1,2,8,1);
    0301B E081      LDI	R24,1
    0301C 838A      STD	Y+2,R24
    0301D E088      LDI	R24,0x8
    0301E 8388      ST	Y,R24
    0301F E022      LDI	R18,2
    03020 E001      LDI	R16,1
    03021 940E 40B6 CALL	_Set_White
(0069) 		 Set_White(1,3,8,1);
    03023 E081      LDI	R24,1
    03024 838A      STD	Y+2,R24
    03025 E088      LDI	R24,0x8
    03026 8388      ST	Y,R24
    03027 E023      LDI	R18,3
    03028 E001      LDI	R16,1
    03029 940E 40B6 CALL	_Set_White
(0070) 		 Set_White(1,4,8,1);
    0302B E081      LDI	R24,1
    0302C 838A      STD	Y+2,R24
    0302D E088      LDI	R24,0x8
    0302E 8388      ST	Y,R24
    0302F E024      LDI	R18,4
    03030 E001      LDI	R16,1
    03031 940E 40B6 CALL	_Set_White
(0071) 		 select--;
    03033 954A      DEC	R20
(0072) 		 set_white_n(select,0);
    03034 2722      CLR	R18
    03035 2F04      MOV	R16,R20
    03036 940E 4148 CALL	_set_white_n
(0073) 		}
(0074) 		if((select<7) && ( key==down ) ){
    03038 3047      CPI	R20,7
    03039 F538      BCC	0x3061
    0303A 316D      CPI	R22,0x1D
    0303B F529      BNE	0x3061
(0075) 		 Set_White(1,1,8,1);
    0303C E081      LDI	R24,1
    0303D 838A      STD	Y+2,R24
    0303E E088      LDI	R24,0x8
    0303F 8388      ST	Y,R24
    03040 E021      LDI	R18,1
    03041 E001      LDI	R16,1
    03042 940E 40B6 CALL	_Set_White
(0076) 		 Set_White(1,2,8,1);
    03044 E081      LDI	R24,1
    03045 838A      STD	Y+2,R24
    03046 E088      LDI	R24,0x8
    03047 8388      ST	Y,R24
    03048 E022      LDI	R18,2
    03049 E001      LDI	R16,1
    0304A 940E 40B6 CALL	_Set_White
(0077) 		 Set_White(1,3,8,1);
    0304C E081      LDI	R24,1
    0304D 838A      STD	Y+2,R24
    0304E E088      LDI	R24,0x8
    0304F 8388      ST	Y,R24
    03050 E023      LDI	R18,3
    03051 E001      LDI	R16,1
    03052 940E 40B6 CALL	_Set_White
(0078) 		 Set_White(1,4,8,1);
    03054 E081      LDI	R24,1
    03055 838A      STD	Y+2,R24
    03056 E088      LDI	R24,0x8
    03057 8388      ST	Y,R24
    03058 E024      LDI	R18,4
    03059 E001      LDI	R16,1
    0305A 940E 40B6 CALL	_Set_White
(0079) 		 select++;
    0305C 9543      INC	R20
(0080) 		 set_white_n(select,0);
    0305D 2722      CLR	R18
    0305E 2F04      MOV	R16,R20
    0305F 940E 4148 CALL	_set_white_n
(0081) 		}
(0082) 		if(key == left ){
    03061 316B      CPI	R22,0x1B
    03062 F511      BNE	0x3085
(0083) 		 Set_White(1,1,8,1);
    03063 E081      LDI	R24,1
    03064 838A      STD	Y+2,R24
    03065 E088      LDI	R24,0x8
    03066 8388      ST	Y,R24
    03067 E021      LDI	R18,1
    03068 E001      LDI	R16,1
    03069 940E 40B6 CALL	_Set_White
(0084) 		 Set_White(1,2,8,1);
    0306B E081      LDI	R24,1
    0306C 838A      STD	Y+2,R24
    0306D E088      LDI	R24,0x8
    0306E 8388      ST	Y,R24
    0306F E022      LDI	R18,2
    03070 E001      LDI	R16,1
    03071 940E 40B6 CALL	_Set_White
(0085) 		 Set_White(1,3,8,1);
    03073 E081      LDI	R24,1
    03074 838A      STD	Y+2,R24
    03075 E088      LDI	R24,0x8
    03076 8388      ST	Y,R24
    03077 E023      LDI	R18,3
    03078 E001      LDI	R16,1
    03079 940E 40B6 CALL	_Set_White
(0086) 		 Set_White(1,4,8,1);
    0307B E081      LDI	R24,1
    0307C 838A      STD	Y+2,R24
    0307D E088      LDI	R24,0x8
    0307E 8388      ST	Y,R24
    0307F E024      LDI	R18,4
    03080 E001      LDI	R16,1
    03081 940E 40B6 CALL	_Set_White
(0087) 		 //beep(3,select);
(0088) 		 return select;
    03083 2F04      MOV	R16,R20
    03084 C007      RJMP	0x308C
    03085 940E 0492 CALL	_alwaysCheck
    03087 2EA0      MOV	R10,R16
    03088 2300      TST	R16
    03089 F009      BEQ	0x308B
    0308A CF7D      RJMP	0x3008
(0089) 		}
(0090)     }
(0091) 	return 0xff; //error
    0308B EF0F      LDI	R16,0xFF
    0308C 9623      ADIW	R28,3
    0308D 940C 4BD1 JMP	pop_xgsetF00C
_GUI_check:
  selectCheckMode      --> R10
  windcounter          --> Y,+9
  next_step_time       --> Y,+3
  is_on                --> Y,+8
  page                 --> Y,+7
  key                  --> R12
    0308F 940E 4BAB CALL	push_xgsetF0FC
    03091 972A      SBIW	R28,0xA
(0092) 	
(0093) }
(0094) 
(0095) //”检测 “菜单
(0096) void GUI_check(void){
(0097)     char key;
(0098) 	char page=0,is_on=0;
    03092 2400      CLR	R0
    03093 820F      STD	Y+7,R0
    03094 8608      STD	Y+8,R0
(0099) 	char windcounter=0;
    03095 8609      STD	Y+9,R0
(0100) 	unsigned long next_step_time=0;
    03096 E080      LDI	R24,0
    03097 838B      STD	Y+3,R24
    03098 838C      STD	Y+4,R24
    03099 838D      STD	Y+5,R24
    0309A 838E      STD	Y+6,R24
(0101) 	char selectCheckMode=config.autocheck; //自动检测开关
    0309B 90A0 08EC LDS	R10,config+15
(0102) 	
(0103) RE_IN:
(0104) 	key=0;
    0309D 24CC      CLR	R12
(0105) 	page=0;
    0309E 2400      CLR	R0
    0309F 820F      STD	Y+7,R0
(0106) 	is_on=0;
    030A0 8608      STD	Y+8,R0
(0107) 	windcounter=0;
    030A1 8609      STD	Y+9,R0
(0108) 	next_step_time=0;
    030A2 E080      LDI	R24,0
    030A3 838B      STD	Y+3,R24
    030A4 838C      STD	Y+4,R24
    030A5 838D      STD	Y+5,R24
    030A6 838E      STD	Y+6,R24
(0109) 	dateRefresh(1);
    030A7 E001      LDI	R16,1
    030A8 940E 39E7 CALL	_dateRefresh
(0110) if(config.comCmd == 0x02 && config.checkDeltaTime > 5) {  //循环检测 且 间隔>5
    030AA 9180 08F2 LDS	R24,config+21
    030AC 3082      CPI	R24,2
    030AD F5A9      BNE	0x30E3
    030AE E085      LDI	R24,5
    030AF E090      LDI	R25,0
    030B0 9020 08ED LDS	R2,config+16
    030B2 9030 08EE LDS	R3,config+17
    030B4 1582      CP	R24,R2
    030B5 0593      CPC	R25,R3
    030B6 F564      BGE	0x30E3
(0111) 	 config.autocheck = SW_ON;
    030B7 E081      LDI	R24,1
    030B8 9380 08EC STS	config+15,R24
(0112) 	 LCD_CLR();
    030BA 940E 402C CALL	_LCD_CLR
(0113) 	 LCD_const_disp(1,1,"收到命令：");
    030BC EB80      LDI	R24,0xB0
    030BD E095      LDI	R25,5
    030BE 8399      STD	Y+1,R25
    030BF 8388      ST	Y,R24
    030C0 E021      LDI	R18,1
    030C1 E001      LDI	R16,1
    030C2 940E 3F86 CALL	_LCD_const_disp
(0114) 	 LCD_const_disp(2,1,"  循环检测");
    030C4 EA85      LDI	R24,0xA5
    030C5 E095      LDI	R25,5
    030C6 8399      STD	Y+1,R25
    030C7 8388      ST	Y,R24
    030C8 E021      LDI	R18,1
    030C9 E002      LDI	R16,2
    030CA 940E 3F86 CALL	_LCD_const_disp
(0115) 	 LCD_const_disp(3,1,"检测间隔(s):");
    030CC E988      LDI	R24,0x98
    030CD E095      LDI	R25,5
    030CE 8399      STD	Y+1,R25
    030CF 8388      ST	Y,R24
    030D0 E021      LDI	R18,1
    030D1 E003      LDI	R16,3
    030D2 940E 3F86 CALL	_LCD_const_disp
(0116) 	 LCD_print4num(4,7,config.checkDeltaTime);
    030D4 9020 08ED LDS	R2,config+16
    030D6 9030 08EE LDS	R3,config+17
    030D8 8239      STD	Y+1,R3
    030D9 8228      ST	Y,R2
    030DA E027      LDI	R18,7
    030DB E004      LDI	R16,4
    030DC 940E 4248 CALL	_LCD_print4num
(0117) 	 delayms(500);
    030DE EF04      LDI	R16,0xF4
    030DF E011      LDI	R17,1
    030E0 940E 2D70 CALL	_delayms
(0118) }
    030E2 C0B4      RJMP	0x3197
(0119) else if(config.comCmd == 0x01 || config.comCmd == 0x02){  //单次检测 或（循环检测但不满足检测间隔）
    030E3 9180 08F2 LDS	R24,config+21
    030E5 3081      CPI	R24,1
    030E6 F011      BEQ	0x30E9
    030E7 3082      CPI	R24,2
    030E8 F4E9      BNE	0x3106
(0120) 	config.autocheck = SW_OFF;
    030E9 2422      CLR	R2
    030EA 9220 08EC STS	config+15,R2
(0121) 	 LCD_CLR();
    030EC 940E 402C CALL	_LCD_CLR
(0122) 	 LCD_const_disp(1,1,"收到命令：");
    030EE EB80      LDI	R24,0xB0
    030EF E095      LDI	R25,5
    030F0 8399      STD	Y+1,R25
    030F1 8388      ST	Y,R24
    030F2 E021      LDI	R18,1
    030F3 E001      LDI	R16,1
    030F4 940E 3F86 CALL	_LCD_const_disp
(0123) 	 LCD_const_disp(2,1,"  单次检测");
    030F6 E88D      LDI	R24,0x8D
    030F7 E095      LDI	R25,5
    030F8 8399      STD	Y+1,R25
    030F9 8388      ST	Y,R24
    030FA E021      LDI	R18,1
    030FB E002      LDI	R16,2
    030FC 940E 3F86 CALL	_LCD_const_disp
(0124) 	 config.comCmd = 0x00; //单次检测情况下检测设置完成则清除检测标志
    030FE 2422      CLR	R2
    030FF 9220 08F2 STS	config+21,R2
(0125) 	 delayms(500); 
    03101 EF04      LDI	R16,0xF4
    03102 E011      LDI	R17,1
    03103 940E 2D70 CALL	_delayms
(0126) }
    03105 C091      RJMP	0x3197
(0127) else {
(0128) 	      LCD_CLR();
    03106 940E 402C CALL	_LCD_CLR
(0129) 		  LCD_const_disp(1,1,"菜单/ 检测");
    03108 E882      LDI	R24,0x82
    03109 E095      LDI	R25,5
    0310A 8399      STD	Y+1,R25
    0310B 8388      ST	Y,R24
    0310C E021      LDI	R18,1
    0310D E001      LDI	R16,1
    0310E 940E 3F86 CALL	_LCD_const_disp
(0130) 		  LCD_const_disp(2,3,"自动");		 
    03110 E78D      LDI	R24,0x7D
    03111 E095      LDI	R25,5
    03112 8399      STD	Y+1,R25
    03113 8388      ST	Y,R24
    03114 E023      LDI	R18,3
    03115 E002      LDI	R16,2
    03116 940E 3F86 CALL	_LCD_const_disp
(0131) 		  LCD_const_disp(3,3,"手动");
    03118 E788      LDI	R24,0x78
    03119 E095      LDI	R25,5
    0311A 8399      STD	Y+1,R25
    0311B 8388      ST	Y,R24
    0311C E023      LDI	R18,3
    0311D E003      LDI	R16,3
    0311E 940E 3F86 CALL	_LCD_const_disp
(0132) 		  if(selectCheckMode==SW_ON) {
    03120 2D8A      MOV	R24,R10
    03121 3081      CPI	R24,1
    03122 F489      BNE	0x3134
(0133) 	          Set_White(1,2,8,0);
    03123 2422      CLR	R2
    03124 822A      STD	Y+2,R2
    03125 E088      LDI	R24,0x8
    03126 8388      ST	Y,R24
    03127 E022      LDI	R18,2
    03128 E001      LDI	R16,1
    03129 940E 40B6 CALL	_Set_White
(0134) 			  Set_White(1,3,8,1);
    0312B E081      LDI	R24,1
    0312C 838A      STD	Y+2,R24
    0312D E088      LDI	R24,0x8
    0312E 8388      ST	Y,R24
    0312F E023      LDI	R18,3
    03130 E001      LDI	R16,1
    03131 940E 40B6 CALL	_Set_White
(0135) 		  }
    03133 C05E      RJMP	0x3192
(0136) 		  else {
(0137) 		      Set_White(1,2,8,1);
    03134 E081      LDI	R24,1
    03135 838A      STD	Y+2,R24
    03136 E088      LDI	R24,0x8
    03137 8388      ST	Y,R24
    03138 E022      LDI	R18,2
    03139 E001      LDI	R16,1
    0313A 940E 40B6 CALL	_Set_White
(0138) 		      Set_White(1,3,8,0);
    0313C 2422      CLR	R2
    0313D 822A      STD	Y+2,R2
    0313E E088      LDI	R24,0x8
    0313F 8388      ST	Y,R24
    03140 E023      LDI	R18,3
    03141 E001      LDI	R16,1
    03142 940E 40B6 CALL	_Set_White
(0139) 		  }
    03144 C04D      RJMP	0x3192
(0140) 	
(0141)     //<<菜单/检测/手（自）动>>
(0142) 	while(alwaysCheck()){
(0143) 	 	key=kbscan();
    03145 940E 458C CALL	_kbscan
    03147 2EC0      MOV	R12,R16
(0144) 		dateRefresh(0); //只刷新后台时间
    03148 2700      CLR	R16
    03149 940E 39E7 CALL	_dateRefresh
(0145) 		//上键短按 选择
(0146) 		if(key==up || key ==down){
    0314B 2D8C      MOV	R24,R12
    0314C 318E      CPI	R24,0x1E
    0314D F011      BEQ	0x3150
    0314E 318D      CPI	R24,0x1D
    0314F F539      BNE	0x3177
(0147) 		    if(selectCheckMode >0){
    03150 E080      LDI	R24,0
    03151 158A      CP	R24,R10
    03152 F490      BCC	0x3165
(0148) 			    selectCheckMode=0;
    03153 24AA      CLR	R10
(0149) 				Set_White(1,2,8,1);
    03154 E081      LDI	R24,1
    03155 838A      STD	Y+2,R24
    03156 E088      LDI	R24,0x8
    03157 8388      ST	Y,R24
    03158 E022      LDI	R18,2
    03159 E001      LDI	R16,1
    0315A 940E 40B6 CALL	_Set_White
(0150) 	 			Set_White(1,3,8,0);
    0315C 2422      CLR	R2
    0315D 822A      STD	Y+2,R2
    0315E E088      LDI	R24,0x8
    0315F 8388      ST	Y,R24
    03160 E023      LDI	R18,3
    03161 E001      LDI	R16,1
    03162 940E 40B6 CALL	_Set_White
(0151) 			}
    03164 C012      RJMP	0x3177
(0152) 			else {
(0153) 			    selectCheckMode=1;
    03165 24AA      CLR	R10
    03166 94A3      INC	R10
(0154) 				Set_White(1,2,8,0);
    03167 2422      CLR	R2
    03168 822A      STD	Y+2,R2
    03169 E088      LDI	R24,0x8
    0316A 8388      ST	Y,R24
    0316B E022      LDI	R18,2
    0316C E001      LDI	R16,1
    0316D 940E 40B6 CALL	_Set_White
(0155) 	 			Set_White(1,3,8,1);
    0316F E081      LDI	R24,1
    03170 838A      STD	Y+2,R24
    03171 E088      LDI	R24,0x8
    03172 8388      ST	Y,R24
    03173 E023      LDI	R18,3
    03174 E001      LDI	R16,1
    03175 940E 40B6 CALL	_Set_White
(0156) 			}
(0157) 			
(0158) 		}
(0159) 		//左键短按  进入
(0160) 		if(key == left) {
    03177 2D8C      MOV	R24,R12
    03178 318B      CPI	R24,0x1B
    03179 F499      BNE	0x318D
(0161) 			config.autocheck=selectCheckMode; 
    0317A 92A0 08EC STS	config+15,R10
(0162) 			Set_White(1,2,8,1);
    0317C E081      LDI	R24,1
    0317D 838A      STD	Y+2,R24
    0317E E088      LDI	R24,0x8
    0317F 8388      ST	Y,R24
    03180 E022      LDI	R18,2
    03181 E001      LDI	R16,1
    03182 940E 40B6 CALL	_Set_White
(0163) 	 		Set_White(1,3,8,1); 
    03184 E081      LDI	R24,1
    03185 838A      STD	Y+2,R24
    03186 E088      LDI	R24,0x8
    03187 8388      ST	Y,R24
    03188 E023      LDI	R18,3
    03189 E001      LDI	R16,1
    0318A 940E 40B6 CALL	_Set_White
(0164) 			break ;		
    0318C C00A      RJMP	0x3197
(0165) 		}
(0166) 		//右键短按  返回
(0167) 		if(key == right) {
    0318D 2D8C      MOV	R24,R12
    0318E 3187      CPI	R24,0x17
    0318F F409      BNE	0x3191
(0168) 			return ;		
    03190 C1FC      RJMP	0x338D
(0169) 		}
(0170) 		key=0;
    03191 24CC      CLR	R12
    03192 940E 0492 CALL	_alwaysCheck
    03194 2300      TST	R16
    03195 F009      BEQ	0x3197
    03196 CFAE      RJMP	0x3145
(0171) 	} //end of while
(0172) }//end if	
(0173) 
(0174)     //自动开启检测
(0175) 	dateRefresh(0);
    03197 2700      CLR	R16
    03198 940E 39E7 CALL	_dateRefresh
(0176) 	is_on =1 ;
    0319A 2400      CLR	R0
    0319B 9403      INC	R0
    0319C 8608      STD	Y+8,R0
(0177) 	config.time1=config.now+config.THRESHOLD_delta_sec;
    0319D 9040 08E2 LDS	R4,config+5
    0319F 9050 08E3 LDS	R5,config+6
    031A1 9020 08E0 LDS	R2,config+3
    031A3 9030 08E1 LDS	R3,config+4
    031A5 9080 08EA LDS	R8,config+13
    031A7 9090 08EB LDS	R9,config+14
    031A9 9060 08E8 LDS	R6,config+11
    031AB 9070 08E9 LDS	R7,config+12
    031AD 0C62      ADD	R6,R2
    031AE 1C73      ADC	R7,R3
    031AF 1C84      ADC	R8,R4
    031B0 1C95      ADC	R9,R5
    031B1 9270 08E5 STS	config+8,R7
    031B3 9260 08E4 STS	config+7,R6
    031B5 9290 08E7 STS	config+10,R9
    031B7 9280 08E6 STS	config+9,R8
(0178) 	Result.TempChar[0]=0; //清除上次结果
    031B9 2422      CLR	R2
    031BA 9220 0698 STS	Result+45,R2
(0179) 	Result.WSChar[0]=0;
    031BC 9220 06A2 STS	Result+55,R2
    031BE C1C8      RJMP	0x3387
(0180) 	while(alwaysCheck()){
(0181) 		dateRefresh(0); //只刷新后台时间
    031BF 2700      CLR	R16
    031C0 940E 39E7 CALL	_dateRefresh
(0182) 		if(key != 0) beep(0,1);
    031C2 20CC      TST	R12
    031C3 F021      BEQ	0x31C8
    031C4 E021      LDI	R18,1
    031C5 2700      CLR	R16
    031C6 940E 4303 CALL	_beep
(0183) 		if(key==right || config.comCmd == 0x03){	//右键 退出
    031C8 2D8C      MOV	R24,R12
    031C9 3187      CPI	R24,0x17
    031CA F021      BEQ	0x31CF
    031CB 9180 08F2 LDS	R24,config+21
    031CD 3083      CPI	R24,3
    031CE F581      BNE	0x31FF
(0184) 		    is_on=0;
    031CF 2400      CLR	R0
    031D0 8608      STD	Y+8,R0
(0185) 			LCD_CLR();
    031D1 940E 402C CALL	_LCD_CLR
(0186) 		 	LCD_Init();	  
    031D3 940E 3FFA CALL	_LCD_Init
(0187) 	 	 	LCD_const_disp(4,5,"退出    "); 
    031D5 E68F      LDI	R24,0x6F
    031D6 E095      LDI	R25,5
    031D7 8399      STD	Y+1,R25
    031D8 8388      ST	Y,R24
    031D9 E025      LDI	R18,5
    031DA E004      LDI	R16,4
    031DB 940E 3F86 CALL	_LCD_const_disp
(0188) 		 	delayms(200);
    031DD EC08      LDI	R16,0xC8
    031DE E010      LDI	R17,0
    031DF 940E 2D70 CALL	_delayms
(0189) 		 	LCD_const_disp(4,7,".."); 
    031E1 E68C      LDI	R24,0x6C
    031E2 E095      LDI	R25,5
    031E3 8399      STD	Y+1,R25
    031E4 8388      ST	Y,R24
    031E5 E027      LDI	R18,7
    031E6 E004      LDI	R16,4
    031E7 940E 3F86 CALL	_LCD_const_disp
(0190) 		 	delayms(200);
    031E9 EC08      LDI	R16,0xC8
    031EA E010      LDI	R17,0
    031EB 940E 2D70 CALL	_delayms
(0191) 		 	LCD_const_disp(4,8,".."); 	
    031ED E68C      LDI	R24,0x6C
    031EE E095      LDI	R25,5
    031EF 8399      STD	Y+1,R25
    031F0 8388      ST	Y,R24
    031F1 E028      LDI	R18,0x8
    031F2 E004      LDI	R16,4
    031F3 940E 3F86 CALL	_LCD_const_disp
(0192) 		 	delayms(500);
    031F5 EF04      LDI	R16,0xF4
    031F6 E011      LDI	R17,1
    031F7 940E 2D70 CALL	_delayms
(0193) 		 	LCD_CLR();
    031F9 940E 402C CALL	_LCD_CLR
(0194) 			config.comCmd = 0;//清除自动检测命令
    031FB 2422      CLR	R2
    031FC 9220 08F2 STS	config+21,R2
(0195) 		 	goto RE_IN;
    031FE CE9E      RJMP	0x309D
(0196) 		}
(0197) 		if(is_on==1){ 
    031FF 8588      LDD	R24,Y+8
    03200 3081      CPI	R24,1
    03201 F009      BEQ	0x3203
    03202 C0A0      RJMP	0x32A3
(0198) 			dateRefresh(1); //更新时间
    03203 E001      LDI	R16,1
    03204 D7E2      RCALL	_dateRefresh
(0199) 		    _GUI_datashow(page); 
    03205 810F      LDD	R16,Y+7
    03206 D189      RCALL	__GUI_datashow
(0200) 		    if(config.now < config.time1) {
    03207 9040 08E6 LDS	R4,config+9
    03209 9050 08E7 LDS	R5,config+10
    0320B 9020 08E4 LDS	R2,config+7
    0320D 9030 08E5 LDS	R3,config+8
    0320F 9080 08EA LDS	R8,config+13
    03211 9090 08EB LDS	R9,config+14
    03213 9060 08E8 LDS	R6,config+11
    03215 9070 08E9 LDS	R7,config+12
    03217 1462      CP	R6,R2
    03218 0473      CPC	R7,R3
    03219 0484      CPC	R8,R4
    0321A 0495      CPC	R9,R5
    0321B F5A8      BCC	0x3251
(0201) 				//时间更新 开启风速检测 等待检测 不支持翻页
(0202) 				if(windcounter==0){
    0321C 8409      LDD	R0,Y+9
    0321D 2000      TST	R0
    0321E F429      BNE	0x3224
(0203) 				    windcounter=1; //清零开启风速计数器
    0321F 2400      CLR	R0
    03220 9403      INC	R0
    03221 8609      STD	Y+9,R0
(0204) 					timer1_init(); //开启风速传感器技术
    03222 940E 0426 CALL	_timer1_init
(0205) 				}
(0206) 				if(page == 0 ){
    03224 800F      LDD	R0,Y+7
    03225 2000      TST	R0
    03226 F009      BEQ	0x3228
    03227 C15B      RJMP	0x3383
(0207) 				
(0208) 				    LCD_const_disp(4,1,"正在检测");
    03228 E683      LDI	R24,0x63
    03229 E095      LDI	R25,5
    0322A 8399      STD	Y+1,R25
    0322B 8388      ST	Y,R24
    0322C E021      LDI	R18,1
    0322D E004      LDI	R16,4
    0322E 940E 3F86 CALL	_LCD_const_disp
(0209) 					LCD_print4num(4,5,config.time1-config.now);
    03230 9020 08E8 LDS	R2,config+11
    03232 9030 08E9 LDS	R3,config+12
    03234 9040 08E4 LDS	R4,config+7
    03236 9050 08E5 LDS	R5,config+8
    03238 1842      SUB	R4,R2
    03239 0853      SBC	R5,R3
    0323A 8259      STD	Y+1,R5
    0323B 8248      ST	Y,R4
    0323C E025      LDI	R18,5
    0323D E004      LDI	R16,4
    0323E 940E 4248 CALL	_LCD_print4num
(0210) 					LCD_const_disp(2,6,"      ");
    03240 E58C      LDI	R24,0x5C
    03241 E095      LDI	R25,5
    03242 8399      STD	Y+1,R25
    03243 8388      ST	Y,R24
    03244 E026      LDI	R18,6
    03245 E002      LDI	R16,2
    03246 940E 3F86 CALL	_LCD_const_disp
(0211) 					LCD_const_disp(3,6,"      ");
    03248 E58C      LDI	R24,0x5C
    03249 E095      LDI	R25,5
    0324A 8399      STD	Y+1,R25
    0324B 8388      ST	Y,R24
    0324C E026      LDI	R18,6
    0324D E003      LDI	R16,3
    0324E 940E 3F86 CALL	_LCD_const_disp
(0212) 				}
(0213) 			} 
    03250 C132      RJMP	0x3383
(0214) 			else {
(0215) 			   //检测完成 获得数据 转换数据 存储数据 切换到非检测状态
(0216) 			    windcounter =0 ; //关闭风速传感器计数器
    03251 2400      CLR	R0
    03252 8609      STD	Y+9,R0
(0217) 				beep(1,1);
    03253 E021      LDI	R18,1
    03254 E001      LDI	R16,1
    03255 940E 4303 CALL	_beep
(0218) 				LCD_const_disp(4,1,"--计算并存储--       ");
    03257 E486      LDI	R24,0x46
    03258 E095      LDI	R25,5
    03259 8399      STD	Y+1,R25
    0325A 8388      ST	Y,R24
    0325B E021      LDI	R18,1
    0325C E004      LDI	R16,4
    0325D 940E 3F86 CALL	_LCD_const_disp
(0219) 				check();
    0325F 940E 08F3 CALL	_check
(0220) 				StructToChar(); //转成字符串
    03261 940E 0A5D CALL	_StructToChar
(0221) 				WriteFileHead();//重写文件头
    03263 940E 05B7 CALL	_WriteFileHead
(0222) 				WriteSDFile();  //写入sd卡
    03265 940E 061E CALL	_WriteSDFile
(0223) 				if(config.autoSend>=1) {
    03267 9180 08F1 LDS	R24,config+20
    03269 3081      CPI	R24,1
    0326A F010      BCS	0x326D
(0224) 					 zigbee_send_date(); //zigbee发送
    0326B 940E 3CEE CALL	_zigbee_send_date
(0225) 				}
(0226) 				Result.Index++; //索引自增一
    0326D E041      LDI	R20,1
    0326E E050      LDI	R21,0
    0326F E060      LDI	R22,0
    03270 E070      LDI	R23,0
    03271 9040 0677 LDS	R4,Result+12
    03273 9050 0678 LDS	R5,Result+13
    03275 9020 0675 LDS	R2,Result+10
    03277 9030 0676 LDS	R3,Result+11
    03279 0E24      ADD	R2,R20
    0327A 1E35      ADC	R3,R21
    0327B 1E46      ADC	R4,R22
    0327C 1E57      ADC	R5,R23
    0327D 9230 0676 STS	Result+11,R3
    0327F 9220 0675 STS	Result+10,R2
    03281 9250 0678 STS	Result+13,R5
    03283 9240 0677 STS	Result+12,R4
(0227) 				is_on=0; //切换到非检测状态
    03285 2400      CLR	R0
    03286 8608      STD	Y+8,R0
(0228) 				next_step_time=config.now+config.checkDeltaTime;//自动翻页时间更新
    03287 9020 08ED LDS	R2,config+16
    03289 9030 08EE LDS	R3,config+17
    0328B 2444      CLR	R4
    0328C FC37      SBRC	R3,7
    0328D 9440      COM	R4
    0328E 2455      CLR	R5
    0328F FC47      SBRC	R4,7
    03290 9450      COM	R5
    03291 9080 08EA LDS	R8,config+13
    03293 9090 08EB LDS	R9,config+14
    03295 9060 08E8 LDS	R6,config+11
    03297 9070 08E9 LDS	R7,config+12
    03299 0C62      ADD	R6,R2
    0329A 1C73      ADC	R7,R3
    0329B 1C84      ADC	R8,R4
    0329C 1C95      ADC	R9,R5
    0329D 826B      STD	Y+3,R6
    0329E 827C      STD	Y+4,R7
    0329F 828D      STD	Y+5,R8
    032A0 829E      STD	Y+6,R9
(0229) 				page=0;
    032A1 820F      STD	Y+7,R0
(0230) 		   }
(0231) 		}
    032A2 C0E0      RJMP	0x3383
(0232) 		else { //is_on == 0 非检测状态 手动翻页/自动翻页
(0233) 		    dateRefresh(0);//不更新时间
    032A3 2700      CLR	R16
    032A4 D742      RCALL	_dateRefresh
(0234) 			_GUI_datashow(page); 
    032A5 810F      LDD	R16,Y+7
    032A6 D0E9      RCALL	__GUI_datashow
(0235) 			if(page == 0 ){
    032A7 800F      LDD	R0,Y+7
    032A8 2000      TST	R0
    032A9 F4E9      BNE	0x32C7
(0236) 				
(0237) 				    LCD_const_disp(4,1,"完成检测        ");
    032AA E385      LDI	R24,0x35
    032AB E095      LDI	R25,5
    032AC 8399      STD	Y+1,R25
    032AD 8388      ST	Y,R24
    032AE E021      LDI	R18,1
    032AF E004      LDI	R16,4
    032B0 940E 3F86 CALL	_LCD_const_disp
(0238) 					if(config.autocheck == 1){
    032B2 9180 08EC LDS	R24,config+15
    032B4 3081      CPI	R24,1
    032B5 F449      BNE	0x32BF
(0239) 					    LCD_const_disp(4,7,"自动");
    032B6 E78D      LDI	R24,0x7D
    032B7 E095      LDI	R25,5
    032B8 8399      STD	Y+1,R25
    032B9 8388      ST	Y,R24
    032BA E027      LDI	R18,7
    032BB E004      LDI	R16,4
    032BC 940E 3F86 CALL	_LCD_const_disp
(0240) 					}
    032BE C008      RJMP	0x32C7
(0241) 					else {
(0242) 					    LCD_const_disp(4,7,"手动");
    032BF E788      LDI	R24,0x78
    032C0 E095      LDI	R25,5
    032C1 8399      STD	Y+1,R25
    032C2 8388      ST	Y,R24
    032C3 E027      LDI	R18,7
    032C4 E004      LDI	R16,4
    032C5 940E 3F86 CALL	_LCD_const_disp
(0243) 					}
(0244) 					
(0245) 				}
(0246) 						//手动翻页 
(0247) 			if(key==up){ //上键 : 页面减 
    032C7 2D8C      MOV	R24,R12
    032C8 318E      CPI	R24,0x1E
    032C9 F539      BNE	0x32F1
(0248) 		        if(page>0) page--;
    032CA E080      LDI	R24,0
    032CB 800F      LDD	R0,Y+7
    032CC 1580      CP	R24,R0
    032CD F418      BCC	0x32D1
    032CE 940A      DEC	R0
    032CF 820F      STD	Y+7,R0
    032D0 C01C      RJMP	0x32ED
(0249) 				else{
(0250) 				page =5;
    032D1 E085      LDI	R24,5
    032D2 838F      STD	Y+7,R24
(0251) 				next_step_time = config.now + config.checkDeltaTime;
    032D3 9020 08ED LDS	R2,config+16
    032D5 9030 08EE LDS	R3,config+17
    032D7 2444      CLR	R4
    032D8 FC37      SBRC	R3,7
    032D9 9440      COM	R4
    032DA 2455      CLR	R5
    032DB FC47      SBRC	R4,7
    032DC 9450      COM	R5
    032DD 9080 08EA LDS	R8,config+13
    032DF 9090 08EB LDS	R9,config+14
    032E1 9060 08E8 LDS	R6,config+11
    032E3 9070 08E9 LDS	R7,config+12
    032E5 0C62      ADD	R6,R2
    032E6 1C73      ADC	R7,R3
    032E7 1C84      ADC	R8,R4
    032E8 1C95      ADC	R9,R5
    032E9 826B      STD	Y+3,R6
    032EA 827C      STD	Y+4,R7
    032EB 828D      STD	Y+5,R8
    032EC 829E      STD	Y+6,R9
(0252) 				}
(0253) 		    	LCD_CLR();
    032ED 940E 402C CALL	_LCD_CLR
(0254) 		    	LCD_Init();
    032EF 940E 3FFA CALL	_LCD_Init
(0255) 			}
(0256) 			if(key==down){//下键 ： 页面加
    032F1 2D8C      MOV	R24,R12
    032F2 318D      CPI	R24,0x1D
    032F3 F539      BNE	0x331B
(0257) 		        page++;
    032F4 800F      LDD	R0,Y+7
    032F5 9403      INC	R0
    032F6 820F      STD	Y+7,R0
(0258) 				next_step_time = config.now + config.checkDeltaTime;
    032F7 9020 08ED LDS	R2,config+16
    032F9 9030 08EE LDS	R3,config+17
    032FB 2444      CLR	R4
    032FC FC37      SBRC	R3,7
    032FD 9440      COM	R4
    032FE 2455      CLR	R5
    032FF FC47      SBRC	R4,7
    03300 9450      COM	R5
    03301 9080 08EA LDS	R8,config+13
    03303 9090 08EB LDS	R9,config+14
    03305 9060 08E8 LDS	R6,config+11
    03307 9070 08E9 LDS	R7,config+12
    03309 0C62      ADD	R6,R2
    0330A 1C73      ADC	R7,R3
    0330B 1C84      ADC	R8,R4
    0330C 1C95      ADC	R9,R5
    0330D 826B      STD	Y+3,R6
    0330E 827C      STD	Y+4,R7
    0330F 828D      STD	Y+5,R8
    03310 829E      STD	Y+6,R9
(0259) 		  		LCD_CLR();
    03311 940E 402C CALL	_LCD_CLR
(0260) 		    	LCD_Init();
    03313 940E 3FFA CALL	_LCD_Init
(0261) 				if(page >= 6 ) {
    03315 818F      LDD	R24,Y+7
    03316 3086      CPI	R24,6
    03317 F018      BCS	0x331B
(0262) 					page=0;
    03318 2400      CLR	R0
    03319 820F      STD	Y+7,R0
(0263) 					continue ;
    0331A C06C      RJMP	0x3387
(0264) 				}
(0265) 			} 	
(0266) 			//LCD_print2num(4,1,page);
(0267) 			//LCD_print4num(4,3,config.now);
(0268) 			//LCD_print4num(4,6,next_step_time);
(0269) 			if( config.autocheck == 1 ){  //如果开启自动翻页
    0331B 9180 08EC LDS	R24,config+15
    0331D 3081      CPI	R24,1
    0331E F5A1      BNE	0x3353
(0270) 			      if(config.now >= next_step_time || page >=6 )	{
    0331F 802B      LDD	R2,Y+3
    03320 803C      LDD	R3,Y+4
    03321 804D      LDD	R4,Y+5
    03322 805E      LDD	R5,Y+6
    03323 9080 08EA LDS	R8,config+13
    03325 9090 08EB LDS	R9,config+14
    03327 9060 08E8 LDS	R6,config+11
    03329 9070 08E9 LDS	R7,config+12
    0332B 1462      CP	R6,R2
    0332C 0473      CPC	R7,R3
    0332D 0484      CPC	R8,R4
    0332E 0495      CPC	R9,R5
    0332F F418      BCC	0x3333
    03330 818F      LDD	R24,Y+7
    03331 3086      CPI	R24,6
    03332 F100      BCS	0x3353
(0271) 				      next_step_time = config.now + config.checkDeltaTime;
    03333 9020 08ED LDS	R2,config+16
    03335 9030 08EE LDS	R3,config+17
    03337 2444      CLR	R4
    03338 FC37      SBRC	R3,7
    03339 9440      COM	R4
    0333A 2455      CLR	R5
    0333B FC47      SBRC	R4,7
    0333C 9450      COM	R5
    0333D 9080 08EA LDS	R8,config+13
    0333F 9090 08EB LDS	R9,config+14
    03341 9060 08E8 LDS	R6,config+11
    03343 9070 08E9 LDS	R7,config+12
    03345 0C62      ADD	R6,R2
    03346 1C73      ADC	R7,R3
    03347 1C84      ADC	R8,R4
    03348 1C95      ADC	R9,R5
    03349 826B      STD	Y+3,R6
    0334A 827C      STD	Y+4,R7
    0334B 828D      STD	Y+5,R8
    0334C 829E      STD	Y+6,R9
(0272) 					  page++;
    0334D 800F      LDD	R0,Y+7
    0334E 9403      INC	R0
    0334F 820F      STD	Y+7,R0
(0273) 					  LCD_CLR(); 
    03350 940E 402C CALL	_LCD_CLR
(0274) 					  key=0;
    03352 24CC      CLR	R12
(0275) 				  }  
(0276) 			}
(0277) 			if( page>=6 || key == left){
    03353 818F      LDD	R24,Y+7
    03354 3086      CPI	R24,6
    03355 F418      BCC	0x3359
    03356 2D8C      MOV	R24,R12
    03357 318B      CPI	R24,0x1B
    03358 F551      BNE	0x3383
(0278) 					      //翻到最后页，页面清零开启下次检测
(0279) 					      page = 0;
    03359 2400      CLR	R0
    0335A 820F      STD	Y+7,R0
(0280) 						  dateRefresh(1); //刷新时间
    0335B E001      LDI	R16,1
    0335C D68A      RCALL	_dateRefresh
(0281) 						  is_on =1 ; //开启检测
    0335D 2400      CLR	R0
    0335E 9403      INC	R0
    0335F 8608      STD	Y+8,R0
(0282) 						  config.time1=config.now+config.THRESHOLD_delta_sec; //更新下次检测时间
    03360 9040 08E2 LDS	R4,config+5
    03362 9050 08E3 LDS	R5,config+6
    03364 9020 08E0 LDS	R2,config+3
    03366 9030 08E1 LDS	R3,config+4
    03368 9080 08EA LDS	R8,config+13
    0336A 9090 08EB LDS	R9,config+14
    0336C 9060 08E8 LDS	R6,config+11
    0336E 9070 08E9 LDS	R7,config+12
    03370 0C62      ADD	R6,R2
    03371 1C73      ADC	R7,R3
    03372 1C84      ADC	R8,R4
    03373 1C95      ADC	R9,R5
    03374 9270 08E5 STS	config+8,R7
    03376 9260 08E4 STS	config+7,R6
    03378 9290 08E7 STS	config+10,R9
    0337A 9280 08E6 STS	config+9,R8
(0283) 						  Result.TempChar[0]=0; //清除上次结果
    0337C 2422      CLR	R2
    0337D 9220 0698 STS	Result+45,R2
(0284) 						  Result.WSChar[0]=0;
    0337F 9220 06A2 STS	Result+55,R2
(0285) 					   	  LCD_CLR();  
    03381 940E 402C CALL	_LCD_CLR
(0286) 					  }
(0287) 				         
(0288) 				
(0289) 
(0290) 		} 
(0291) 		
(0292) 	    delayms(10); 
    03383 E00A      LDI	R16,0xA
    03384 E010      LDI	R17,0
    03385 940E 2D70 CALL	_delayms
    03387 940E 0492 CALL	_alwaysCheck
    03389 2EE0      MOV	R14,R16
    0338A 2300      TST	R16
    0338B F009      BEQ	0x338D
    0338C CE32      RJMP	0x31BF
    0338D 962A      ADIW	R28,0xA
    0338E 940C 4BA0 JMP	pop_xgsetF0FC
__GUI_datashow:
  page                 --> R20
    03390 940E 4BCA CALL	push_xgsetF00C
    03392 2F40      MOV	R20,R16
    03393 9722      SBIW	R28,2
(0293) 	}//end while
(0294) }//end function
(0295) void _GUI_datashow(char page){
(0296) 	if(page == 0){
    03394 2344      TST	R20
    03395 F539      BNE	0x33BD
(0297)  	//显示日期时间
(0298) 	    LCD_var_disp(1,1,GUI_get_date());
    03396 D205      RCALL	_GUI_get_date
    03397 8319      STD	Y+1,R17
    03398 8308      ST	Y,R16
    03399 E021      LDI	R18,1
    0339A E001      LDI	R16,1
    0339B 940E 3FB3 CALL	_LCD_var_disp
(0299) 	//显示温度
(0300) 	 	LCD_const_disp(2,1,"温度 (℃):      ");
    0339D E284      LDI	R24,0x24
    0339E E095      LDI	R25,5
    0339F 8399      STD	Y+1,R25
    033A0 8388      ST	Y,R24
    033A1 E021      LDI	R18,1
    033A2 E002      LDI	R16,2
    033A3 940E 3F86 CALL	_LCD_const_disp
(0301) 	 	LCD_var_disp(2,6,Result.TempChar);
    033A5 E988      LDI	R24,0x98
    033A6 E096      LDI	R25,6
    033A7 8399      STD	Y+1,R25
    033A8 8388      ST	Y,R24
    033A9 E026      LDI	R18,6
    033AA E002      LDI	R16,2
    033AB 940E 3FB3 CALL	_LCD_var_disp
(0302) 	//显示风速
(0303) 	    LCD_const_disp(3,1,"风速(m/s):      ");
    033AD E183      LDI	R24,0x13
    033AE E095      LDI	R25,5
    033AF 8399      STD	Y+1,R25
    033B0 8388      ST	Y,R24
    033B1 E021      LDI	R18,1
    033B2 E003      LDI	R16,3
    033B3 940E 3F86 CALL	_LCD_const_disp
(0304) 	 	LCD_const_disp(3,6,Result.WSChar);
    033B5 EA82      LDI	R24,0xA2
    033B6 E096      LDI	R25,6
    033B7 8399      STD	Y+1,R25
    033B8 8388      ST	Y,R24
    033B9 E026      LDI	R18,6
    033BA E003      LDI	R16,3
    033BB 940E 3F86 CALL	_LCD_const_disp
(0305) 
(0306) 	 } 
(0307) 	 if(page == 1){
    033BD 3041      CPI	R20,1
    033BE F5B9      BNE	0x33F6
(0308) 	     LCD_var_disp(1,1,GUI_get_date());
    033BF D1DC      RCALL	_GUI_get_date
    033C0 8319      STD	Y+1,R17
    033C1 8308      ST	Y,R16
    033C2 E021      LDI	R18,1
    033C3 E001      LDI	R16,1
    033C4 940E 3FB3 CALL	_LCD_var_disp
(0309) 		 LCD_const_disp(2,1,"风冷指数: ");
    033C6 E088      LDI	R24,0x8
    033C7 E095      LDI	R25,5
    033C8 8399      STD	Y+1,R25
    033C9 8388      ST	Y,R24
    033CA E021      LDI	R18,1
    033CB E002      LDI	R16,2
    033CC 940E 3F86 CALL	_LCD_const_disp
(0310) 		 LCD_var_disp(2,6,Result.WCIChar);						
    033CE EA8B      LDI	R24,0xAB
    033CF E096      LDI	R25,6
    033D0 8399      STD	Y+1,R25
    033D1 8388      ST	Y,R24
    033D2 E026      LDI	R18,6
    033D3 E002      LDI	R16,2
    033D4 940E 3FB3 CALL	_LCD_var_disp
(0311) 		 LCD_const_disp(3,1,"等价温度: ");
    033D6 EF8D      LDI	R24,0xFD
    033D7 E094      LDI	R25,4
    033D8 8399      STD	Y+1,R25
    033D9 8388      ST	Y,R24
    033DA E021      LDI	R18,1
    033DB E003      LDI	R16,3
    033DC 940E 3F86 CALL	_LCD_const_disp
(0312) 		 LCD_var_disp(3,6,Result.ECTChar);	 
    033DE EB87      LDI	R24,0xB7
    033DF E096      LDI	R25,6
    033E0 8399      STD	Y+1,R25
    033E1 8388      ST	Y,R24
    033E2 E026      LDI	R18,6
    033E3 E003      LDI	R16,3
    033E4 940E 3FB3 CALL	_LCD_var_disp
(0313) 		 LCD_const_disp(4,1,"相当温度: ");
    033E6 EF82      LDI	R24,0xF2
    033E7 E094      LDI	R25,4
    033E8 8399      STD	Y+1,R25
    033E9 8388      ST	Y,R24
    033EA E021      LDI	R18,1
    033EB E004      LDI	R16,4
    033EC 940E 3F86 CALL	_LCD_const_disp
(0314) 		 LCD_var_disp(4,6,Result.TeqChar);	
    033EE EC81      LDI	R24,0xC1
    033EF E096      LDI	R25,6
    033F0 8399      STD	Y+1,R25
    033F1 8388      ST	Y,R24
    033F2 E026      LDI	R18,6
    033F3 E004      LDI	R16,4
    033F4 940E 3FB3 CALL	_LCD_var_disp
(0315) 	 }
(0316) 	 if(page == 2){
    033F6 3042      CPI	R20,2
    033F7 F009      BEQ	0x33F9
    033F8 C03F      RJMP	0x3438
(0317) 	     LCD_var_disp(1,1,GUI_get_date());
    033F9 D1A2      RCALL	_GUI_get_date
    033FA 0158      MOVW	R10,R16
    033FB 82B9      STD	Y+1,R11
    033FC 82A8      ST	Y,R10
    033FD E021      LDI	R18,1
    033FE E001      LDI	R16,1
    033FF 940E 3FB3 CALL	_LCD_var_disp
(0318) 		 LCD_const_disp(2,1,"冻伤危害性:");
    03401 EE86      LDI	R24,0xE6
    03402 E094      LDI	R25,4
    03403 8399      STD	Y+1,R25
    03404 8388      ST	Y,R24
    03405 E021      LDI	R18,1
    03406 E002      LDI	R16,2
    03407 940E 3F86 CALL	_LCD_const_disp
(0319) 	 if(Result.WeiHai==0){LCD_const_disp(3,1,"  冻伤危害性小");			 }
    03409 9020 06C7 LDS	R2,Result+92
    0340B 2022      TST	R2
    0340C F449      BNE	0x3416
    0340D ED87      LDI	R24,0xD7
    0340E E094      LDI	R25,4
    0340F 8399      STD	Y+1,R25
    03410 8388      ST	Y,R24
    03411 E021      LDI	R18,1
    03412 E003      LDI	R16,3
    03413 940E 3F86 CALL	_LCD_const_disp
    03415 C022      RJMP	0x3438
(0320) 	 else if(Result.WeiHai==1){	LCD_const_disp(3,1,"  冻伤危害性较大");	 }
    03416 9180 06C7 LDS	R24,Result+92
    03418 3081      CPI	R24,1
    03419 F449      BNE	0x3423
    0341A EC86      LDI	R24,0xC6
    0341B E094      LDI	R25,4
    0341C 8399      STD	Y+1,R25
    0341D 8388      ST	Y,R24
    0341E E021      LDI	R18,1
    0341F E003      LDI	R16,3
    03420 940E 3F86 CALL	_LCD_const_disp
    03422 C015      RJMP	0x3438
(0321) 	 else if(Result.WeiHai==2){	LCD_const_disp(3,1,"  冻伤危害性很大");	 }
    03423 9180 06C7 LDS	R24,Result+92
    03425 3082      CPI	R24,2
    03426 F449      BNE	0x3430
    03427 EB85      LDI	R24,0xB5
    03428 E094      LDI	R25,4
    03429 8399      STD	Y+1,R25
    0342A 8388      ST	Y,R24
    0342B E021      LDI	R18,1
    0342C E003      LDI	R16,3
    0342D 940E 3F86 CALL	_LCD_const_disp
    0342F C008      RJMP	0x3438
(0322) 	 else LCD_const_disp(3,1,"冻伤危害性小。");
    03430 EA86      LDI	R24,0xA6
    03431 E094      LDI	R25,4
    03432 8399      STD	Y+1,R25
    03433 8388      ST	Y,R24
    03434 E021      LDI	R18,1
    03435 E003      LDI	R16,3
    03436 940E 3F86 CALL	_LCD_const_disp
(0323) 	 }	  
(0324) 	 if(page==3){
    03438 3043      CPI	R20,3
    03439 F009      BEQ	0x343B
    0343A C061      RJMP	0x349C
(0325) 	     LCD_const_disp(1,1,labelH);		
    0343B EA82      LDI	R24,0xA2
    0343C E092      LDI	R25,2
    0343D 8399      STD	Y+1,R25
    0343E 8388      ST	Y,R24
    0343F E021      LDI	R18,1
    03440 E001      LDI	R16,1
    03441 940E 3F86 CALL	_LCD_const_disp
(0326) 	 	 switch( Result.WeiHai ){
    03443 9160 06C7 LDS	R22,Result+92
    03445 2777      CLR	R23
    03446 3060      CPI	R22,0
    03447 0767      CPC	R22,R23
    03448 F049      BEQ	0x3452
    03449 3061      CPI	R22,1
    0344A E0E0      LDI	R30,0
    0344B 077E      CPC	R23,R30
    0344C F0F1      BEQ	0x346B
    0344D 3062      CPI	R22,2
    0344E E0E0      LDI	R30,0
    0344F 077E      CPC	R23,R30
    03450 F199      BEQ	0x3484
    03451 C04A      RJMP	0x349C
(0327) 			case 0 :
(0328) 			LCD_const_disp(2,1,H01);
    03452 EC8E      LDI	R24,0xCE
    03453 E092      LDI	R25,2
    03454 8399      STD	Y+1,R25
    03455 8388      ST	Y,R24
    03456 E021      LDI	R18,1
    03457 E002      LDI	R16,2
    03458 940E 3F86 CALL	_LCD_const_disp
(0329) 			LCD_const_disp(3,1,H02);
    0345A ED8E      LDI	R24,0xDE
    0345B E092      LDI	R25,2
    0345C 8399      STD	Y+1,R25
    0345D 8388      ST	Y,R24
    0345E E021      LDI	R18,1
    0345F E003      LDI	R16,3
    03460 940E 3F86 CALL	_LCD_const_disp
(0330) 			LCD_const_disp(4,1,H03);
    03462 EE89      LDI	R24,0xE9
    03463 E092      LDI	R25,2
    03464 8399      STD	Y+1,R25
    03465 8388      ST	Y,R24
    03466 E021      LDI	R18,1
    03467 E004      LDI	R16,4
    03468 940E 3F86 CALL	_LCD_const_disp
(0331) 			break;
    0346A C031      RJMP	0x349C
(0332) 			case 1 : 
(0333) 			LCD_const_disp(2,1,H11);
    0346B E085      LDI	R24,5
    0346C E093      LDI	R25,3
    0346D 8399      STD	Y+1,R25
    0346E 8388      ST	Y,R24
    0346F E021      LDI	R18,1
    03470 E002      LDI	R16,2
    03471 940E 3F86 CALL	_LCD_const_disp
(0334) 			LCD_const_disp(3,1,H12);
    03473 EE89      LDI	R24,0xE9
    03474 E092      LDI	R25,2
    03475 8399      STD	Y+1,R25
    03476 8388      ST	Y,R24
    03477 E021      LDI	R18,1
    03478 E003      LDI	R16,3
    03479 940E 3F86 CALL	_LCD_const_disp
(0335) 			LCD_const_disp(4,1,H13);
    0347B E18E      LDI	R24,0x1E
    0347C E093      LDI	R25,3
    0347D 8399      STD	Y+1,R25
    0347E 8388      ST	Y,R24
    0347F E021      LDI	R18,1
    03480 E004      LDI	R16,4
    03481 940E 3F86 CALL	_LCD_const_disp
(0336) 			break ;	
    03483 C018      RJMP	0x349C
(0337) 			case 2 :
(0338) 			LCD_const_disp(2,1,H21);
    03484 E582      LDI	R24,0x52
    03485 E093      LDI	R25,3
    03486 8399      STD	Y+1,R25
    03487 8388      ST	Y,R24
    03488 E021      LDI	R18,1
    03489 E002      LDI	R16,2
    0348A 940E 3F86 CALL	_LCD_const_disp
(0339) 			LCD_const_disp(3,1,H22);
    0348C E684      LDI	R24,0x64
    0348D E093      LDI	R25,3
    0348E 8399      STD	Y+1,R25
    0348F 8388      ST	Y,R24
    03490 E021      LDI	R18,1
    03491 E003      LDI	R16,3
    03492 940E 3F86 CALL	_LCD_const_disp
(0340) 			LCD_const_disp(4,1,H23);
    03494 EE89      LDI	R24,0xE9
    03495 E092      LDI	R25,2
    03496 8399      STD	Y+1,R25
    03497 8388      ST	Y,R24
    03498 E021      LDI	R18,1
    03499 E004      LDI	R16,4
    0349A 940E 3F86 CALL	_LCD_const_disp
(0341) 			break;
(0342) 			default : ;
(0343) 		}
(0344) 	 } 
(0345) 	 if(page==4){
    0349C 3044      CPI	R20,4
    0349D F009      BEQ	0x349F
    0349E C086      RJMP	0x3525
(0346) 	 		LCD_const_disp(1,1,labelM);		
    0349F EB80      LDI	R24,0xB0
    034A0 E092      LDI	R25,2
    034A1 8399      STD	Y+1,R25
    034A2 8388      ST	Y,R24
    034A3 E021      LDI	R18,1
    034A4 E001      LDI	R16,1
    034A5 940E 3F86 CALL	_LCD_const_disp
(0347) 	 		switch( Result.WeiHai ){
    034A7 9160 06C7 LDS	R22,Result+92
    034A9 2777      CLR	R23
    034AA 3060      CPI	R22,0
    034AB 0767      CPC	R22,R23
    034AC F059      BEQ	0x34B8
    034AD 3061      CPI	R22,1
    034AE E0E0      LDI	R30,0
    034AF 077E      CPC	R23,R30
    034B0 F409      BNE	0x34B2
    034B1 C052      RJMP	0x3504
    034B2 3062      CPI	R22,2
    034B3 E0E0      LDI	R30,0
    034B4 077E      CPC	R23,R30
    034B5 F409      BNE	0x34B7
    034B6 C066      RJMP	0x351D
    034B7 C06D      RJMP	0x3525
(0348) 	 			case 0 :
(0349) 				LCD_const_disp(2,1,M01);
    034B8 EC8E      LDI	R24,0xCE
    034B9 E092      LDI	R25,2
    034BA 8399      STD	Y+1,R25
    034BB 8388      ST	Y,R24
    034BC E021      LDI	R18,1
    034BD E002      LDI	R16,2
    034BE 940E 3F86 CALL	_LCD_const_disp
(0350) 				LCD_const_disp(3,1,M02);
    034C0 EE89      LDI	R24,0xE9
    034C1 E092      LDI	R25,2
    034C2 8399      STD	Y+1,R25
    034C3 8388      ST	Y,R24
    034C4 E021      LDI	R18,1
    034C5 E003      LDI	R16,3
    034C6 940E 3F86 CALL	_LCD_const_disp
(0351) 				if(Result.Temperature < -17.7){
    034C8 9040 0696 LDS	R4,Result+43
    034CA 9050 0697 LDS	R5,Result+44
    034CC 9020 0694 LDS	R2,Result+41
    034CE 9030 0695 LDS	R3,Result+42
    034D0 EE00      LDI	R16,0xE0
    034D1 E010      LDI	R17,0
    034D2 940E 4B33 CALL	elpm32
    034D4 933A      ST	-Y,R19
    034D5 932A      ST	-Y,R18
    034D6 931A      ST	-Y,R17
    034D7 930A      ST	-Y,R16
    034D8 0181      MOVW	R16,R2
    034D9 0192      MOVW	R18,R4
    034DA 940E 4F2B CALL	fpcmp2
    034DC F44C      BGE	0x34E6
(0352) 				    LCD_const_disp(4,1,"戴面罩；禁油彩。");
    034DD E985      LDI	R24,0x95
    034DE E094      LDI	R25,4
    034DF 8399      STD	Y+1,R25
    034E0 8388      ST	Y,R24
    034E1 E021      LDI	R18,1
    034E2 E004      LDI	R16,4
    034E3 940E 3F86 CALL	_LCD_const_disp
(0353) 				}
    034E5 C03F      RJMP	0x3525
(0354) 				else if(Result.Temperature < -12){
    034E6 9040 0696 LDS	R4,Result+43
    034E8 9050 0697 LDS	R5,Result+44
    034EA 9020 0694 LDS	R2,Result+41
    034EC 9030 0695 LDS	R3,Result+42
    034EE ED0C      LDI	R16,0xDC
    034EF E010      LDI	R17,0
    034F0 940E 4B33 CALL	elpm32
    034F2 933A      ST	-Y,R19
    034F3 932A      ST	-Y,R18
    034F4 931A      ST	-Y,R17
    034F5 930A      ST	-Y,R16
    034F6 0181      MOVW	R16,R2
    034F7 0192      MOVW	R18,R4
    034F8 940E 4F2B CALL	fpcmp2
    034FA F554      BGE	0x3525
(0355) 				    LCD_const_disp(4,1,"禁油彩。        \0");
    034FB E883      LDI	R24,0x83
    034FC E094      LDI	R25,4
    034FD 8399      STD	Y+1,R25
    034FE 8388      ST	Y,R24
    034FF E021      LDI	R18,1
    03500 E004      LDI	R16,4
    03501 940E 3F86 CALL	_LCD_const_disp
(0356) 				}
(0357) 				break;
    03503 C021      RJMP	0x3525
(0358) 				case 1 : 
(0359) 			    LCD_const_disp(2,1,M11);
    03504 EC8E      LDI	R24,0xCE
    03505 E092      LDI	R25,2
    03506 8399      STD	Y+1,R25
    03507 8388      ST	Y,R24
    03508 E021      LDI	R18,1
    03509 E002      LDI	R16,2
    0350A 940E 3F86 CALL	_LCD_const_disp
(0360) 				LCD_const_disp(3,1,M12);
    0350C E28E      LDI	R24,0x2E
    0350D E093      LDI	R25,3
    0350E 8399      STD	Y+1,R25
    0350F 8388      ST	Y,R24
    03510 E021      LDI	R18,1
    03511 E003      LDI	R16,3
    03512 940E 3F86 CALL	_LCD_const_disp
(0361) 				LCD_const_disp(4,1,M13);
    03514 E480      LDI	R24,0x40
    03515 E093      LDI	R25,3
    03516 8399      STD	Y+1,R25
    03517 8388      ST	Y,R24
    03518 E021      LDI	R18,1
    03519 E004      LDI	R16,4
    0351A 940E 3F86 CALL	_LCD_const_disp
(0362) 				break ;
    0351C C008      RJMP	0x3525
(0363) 				case 2 :
(0364) 				LCD_const_disp(2,1,M21);
    0351D E786      LDI	R24,0x76
    0351E E093      LDI	R25,3
    0351F 8399      STD	Y+1,R25
    03520 8388      ST	Y,R24
    03521 E021      LDI	R18,1
    03522 E002      LDI	R16,2
    03523 940E 3F86 CALL	_LCD_const_disp
(0365) 				break ;
(0366) 				default :;
(0367) 	 		}
(0368) 	 }
(0369) 	 if(page==5){
    03525 3045      CPI	R20,5
    03526 F009      BEQ	0x3528
    03527 C071      RJMP	0x3599
(0370) 	     LCD_const_disp(1,1,labelL);		
    03528 EC80      LDI	R24,0xC0
    03529 E092      LDI	R25,2
    0352A 8399      STD	Y+1,R25
    0352B 8388      ST	Y,R24
    0352C E021      LDI	R18,1
    0352D E001      LDI	R16,1
    0352E 940E 3F86 CALL	_LCD_const_disp
(0371) 	 	 switch( Result.WeiHai ){	
    03530 9140 06C7 LDS	R20,Result+92
    03532 2755      CLR	R21
    03533 3040      CPI	R20,0
    03534 0745      CPC	R20,R21
    03535 F059      BEQ	0x3541
    03536 3041      CPI	R20,1
    03537 E0E0      LDI	R30,0
    03538 075E      CPC	R21,R30
    03539 F409      BNE	0x353B
    0353A C03D      RJMP	0x3578
    0353B 3042      CPI	R20,2
    0353C E0E0      LDI	R30,0
    0353D 075E      CPC	R21,R30
    0353E F409      BNE	0x3540
    0353F C051      RJMP	0x3591
    03540 C058      RJMP	0x3599
(0372) 		     case 0 :
(0373) 			 LCD_const_disp(2,1,L01);
    03541 EF8B      LDI	R24,0xFB
    03542 E092      LDI	R25,2
    03543 8399      STD	Y+1,R25
    03544 8388      ST	Y,R24
    03545 E021      LDI	R18,1
    03546 E002      LDI	R16,2
    03547 940E 3F86 CALL	_LCD_const_disp
(0374) 			 if(Result.Temperature < -12) {
    03549 9040 0696 LDS	R4,Result+43
    0354B 9050 0697 LDS	R5,Result+44
    0354D 9020 0694 LDS	R2,Result+41
    0354F 9030 0695 LDS	R3,Result+42
    03551 ED0C      LDI	R16,0xDC
    03552 E010      LDI	R17,0
    03553 940E 4B33 CALL	elpm32
    03555 933A      ST	-Y,R19
    03556 932A      ST	-Y,R18
    03557 931A      ST	-Y,R17
    03558 930A      ST	-Y,R16
    03559 0181      MOVW	R16,R2
    0355A 0192      MOVW	R18,R4
    0355B 940E 4F2B CALL	fpcmp2
    0355D F48C      BGE	0x356F
(0375) 			 LCD_const_disp(3,1,L02);
    0355E E085      LDI	R24,5
    0355F E093      LDI	R25,3
    03560 8399      STD	Y+1,R25
    03561 8388      ST	Y,R24
    03562 E021      LDI	R18,1
    03563 E003      LDI	R16,3
    03564 940E 3F86 CALL	_LCD_const_disp
(0376) 			 LCD_const_disp(4,1,L03);
    03566 E08F      LDI	R24,0xF
    03567 E093      LDI	R25,3
    03568 8399      STD	Y+1,R25
    03569 8388      ST	Y,R24
    0356A E021      LDI	R18,1
    0356B E004      LDI	R16,4
    0356C 940E 3F86 CALL	_LCD_const_disp
(0377) 			 } 
    0356E C02A      RJMP	0x3599
(0378) 			 else {
(0379) 			 LCD_const_disp(3,1,L03);
    0356F E08F      LDI	R24,0xF
    03570 E093      LDI	R25,3
    03571 8399      STD	Y+1,R25
    03572 8388      ST	Y,R24
    03573 E021      LDI	R18,1
    03574 E003      LDI	R16,3
    03575 940E 3F86 CALL	_LCD_const_disp
(0380) 			 }
(0381) 			 break;
    03577 C021      RJMP	0x3599
(0382) 			 case 1: 
(0383) 			 LCD_const_disp(2,1,L11);
    03578 E582      LDI	R24,0x52
    03579 E093      LDI	R25,3
    0357A 8399      STD	Y+1,R25
    0357B 8388      ST	Y,R24
    0357C E021      LDI	R18,1
    0357D E002      LDI	R16,2
    0357E 940E 3F86 CALL	_LCD_const_disp
(0384) 			 LCD_const_disp(3,1,L12);
    03580 E684      LDI	R24,0x64
    03581 E093      LDI	R25,3
    03582 8399      STD	Y+1,R25
    03583 8388      ST	Y,R24
    03584 E021      LDI	R18,1
    03585 E003      LDI	R16,3
    03586 940E 3F86 CALL	_LCD_const_disp
(0385) 			 LCD_const_disp(3,1,L13);
    03588 EE89      LDI	R24,0xE9
    03589 E092      LDI	R25,2
    0358A 8399      STD	Y+1,R25
    0358B 8388      ST	Y,R24
    0358C E021      LDI	R18,1
    0358D E003      LDI	R16,3
    0358E 940E 3F86 CALL	_LCD_const_disp
(0386) 			 break ;
    03590 C008      RJMP	0x3599
(0387) 			 case 2 :
(0388) 			 LCD_const_disp(2,1,L21);
    03591 E786      LDI	R24,0x76
    03592 E093      LDI	R25,3
    03593 8399      STD	Y+1,R25
    03594 8388      ST	Y,R24
    03595 E021      LDI	R18,1
    03596 E002      LDI	R16,2
    03597 940E 3F86 CALL	_LCD_const_disp
(0389) 			 break;
(0390) 			 default : ;
(0391) 		} //end switch
(0392) 	}  //end if
    03599 9622      ADIW	R28,2
    0359A 940C 4BD1 JMP	pop_xgsetF00C
(0393) }
(0394) char * GUI_get_date(void) {  
(0395)   //格式:12月11日19:00:00
(0396)     GUI_date[0]=Result.Date[4]; 
_GUI_get_date:
    0359C 9020 0685 LDS	R2,Result+26
    0359E 9220 0396 STS	GUI_date,R2
(0397)     GUI_date[1]=Result.Date[5];
    035A0 9020 0686 LDS	R2,Result+27
    035A2 9220 0397 STS	GUI_date+1,R2
(0398)     GUI_date[4]=Result.Date[6];
    035A4 9020 0687 LDS	R2,Result+28
    035A6 9220 039A STS	GUI_date+4,R2
(0399)     GUI_date[5]=Result.Date[7];
    035A8 9020 0688 LDS	R2,Result+29
    035AA 9220 039B STS	GUI_date+5,R2
(0400)     GUI_date[8]=Result.Time[0];
    035AC 9020 068A LDS	R2,Result+31
    035AE 9220 039E STS	GUI_date+8,R2
(0401)     GUI_date[9]=Result.Time[1];
    035B0 9020 068B LDS	R2,Result+32
    035B2 9220 039F STS	GUI_date+9,R2
(0402)     GUI_date[11]=Result.Time[3];
    035B4 9020 068D LDS	R2,Result+34
    035B6 9220 03A1 STS	GUI_date+11,R2
(0403)     GUI_date[12]=Result.Time[4];
    035B8 9020 068E LDS	R2,Result+35
    035BA 9220 03A2 STS	GUI_date+12,R2
(0404)     GUI_date[14]=Result.Time[6];
    035BC 9020 0690 LDS	R2,Result+37
    035BE 9220 03A4 STS	GUI_date+14,R2
(0405)     GUI_date[15]=Result.Time[7];
    035C0 9020 0691 LDS	R2,Result+38
    035C2 9220 03A5 STS	GUI_date+15,R2
(0406)     GUI_date[16]='\0';
    035C4 2422      CLR	R2
    035C5 9220 03A6 STS	GUI_date+16,R2
(0407)     return GUI_date;
    035C7 E906      LDI	R16,0x96
    035C8 E013      LDI	R17,3
    035C9 9508      RET
_GUI_set_time:
  GUI_down             --> Y,+5
  GUI_up               --> Y,+2
  ary                  --> R12
  p                    --> Y,+10
  i                    --> R14
  keyc                 --> R20
  pT                   --> R10
  pD                   --> Y,+8
    035CA 940E 4BAB CALL	push_xgsetF0FC
    035CC 972B      SBIW	R28,0xB
(0408) }
(0409) //设置时间 菜单 
(0410) void GUI_set_time(void){
(0411)     unsigned char p=2;
    035CD E082      LDI	R24,2
    035CE 878A      STD	Y+10,R24
(0412) 	char GUI_up[]= "↑";
    035CF EA87      LDI	R24,0xA7
    035D0 E093      LDI	R25,3
    035D1 01FE      MOVW	R30,R28
    035D2 9632      ADIW	R30,2
    035D3 E003      LDI	R16,3
    035D4 E010      LDI	R17,0
    035D5 93FA      ST	-Y,R31
    035D6 93EA      ST	-Y,R30
    035D7 939A      ST	-Y,R25
    035D8 938A      ST	-Y,R24
    035D9 940E 4C5B CALL	asgnblk
(0413) 	char GUI_down[]= "↓";
    035DB EA8A      LDI	R24,0xAA
    035DC E093      LDI	R25,3
    035DD 01FE      MOVW	R30,R28
    035DE 9635      ADIW	R30,5
    035DF E003      LDI	R16,3
    035E0 E010      LDI	R17,0
    035E1 93FA      ST	-Y,R31
    035E2 93EA      ST	-Y,R30
    035E3 939A      ST	-Y,R25
    035E4 938A      ST	-Y,R24
    035E5 940E 4C5B CALL	asgnblk
(0414) 	char *pD=NULL,*pT=NULL;
    035E7 2400      CLR	R0
    035E8 2411      CLR	R1
    035E9 8619      STD	Y+9,R1
    035EA 8608      STD	Y+8,R0
(0415) 	char *ary=GUI_up;
    035EB 01CE      MOVW	R24,R28
    035EC 9602      ADIW	R24,2
    035ED 016C      MOVW	R12,R24
(0416) 	unsigned char i=0,keyc=NO_KEY;
    035EE 24EE      CLR	R14
    035EF 2744      CLR	R20
(0417) 	LCD_CLR(); //清屏
    035F0 940E 402C CALL	_LCD_CLR
(0418) 	pD="2012年12月31日\0";
    035F2 E783      LDI	R24,0x73
    035F3 E094      LDI	R25,4
    035F4 8799      STD	Y+9,R25
    035F5 8788      STD	Y+8,R24
(0419) 	pT="12: 30: 59\0";
    035F6 E687      LDI	R24,0x67
    035F7 E094      LDI	R25,4
    035F8 015C      MOVW	R10,R24
(0420) 	LCD_const_disp(1,1,"时间设置:       ");
    035F9 E586      LDI	R24,0x56
    035FA E094      LDI	R25,4
    035FB 8399      STD	Y+1,R25
    035FC 8388      ST	Y,R24
    035FD E021      LDI	R18,1
    035FE E001      LDI	R16,1
    035FF 940E 3F86 CALL	_LCD_const_disp
(0421) 	LCD_const_disp(4,7,"保存");
    03601 E581      LDI	R24,0x51
    03602 E094      LDI	R25,4
    03603 8399      STD	Y+1,R25
    03604 8388      ST	Y,R24
    03605 E027      LDI	R18,7
    03606 E004      LDI	R16,4
    03607 940E 3F86 CALL	_LCD_const_disp
(0422) 	LCD_var_disp(3,p,ary);
    03609 82D9      STD	Y+1,R13
    0360A 82C8      ST	Y,R12
    0360B 852A      LDD	R18,Y+10
    0360C E003      LDI	R16,3
    0360D 940E 3FB3 CALL	_LCD_var_disp
(0423) 	LCD_var_disp(2,1,pD);
    0360F 8408      LDD	R0,Y+8
    03610 8419      LDD	R1,Y+9
    03611 8219      STD	Y+1,R1
    03612 8208      ST	Y,R0
    03613 E021      LDI	R18,1
    03614 E002      LDI	R16,2
    03615 940E 3FB3 CALL	_LCD_var_disp
(0424) 	LCD_var_disp(4,1,pT);
    03617 82B9      STD	Y+1,R11
    03618 82A8      ST	Y,R10
    03619 E021      LDI	R18,1
    0361A E004      LDI	R16,4
    0361B 940E 3FB3 CALL	_LCD_var_disp
(0425) 	delayms(250);
    0361D EF0A      LDI	R16,0xFA
    0361E E010      LDI	R17,0
    0361F 940E 2D70 CALL	_delayms
    03621 C1F5      RJMP	0x3817
(0426) 	while(alwaysCheck()){
(0427) 	    keyc=kbscan();
    03622 940E 458C CALL	_kbscan
    03624 2F40      MOV	R20,R16
(0428) 		pD[2]=Result.Date[2];
    03625 9020 0683 LDS	R2,Result+24
    03627 85E8      LDD	R30,Y+8
    03628 85F9      LDD	R31,Y+9
    03629 8222      STD	Z+2,R2
(0429) 		pD[3]=Result.Date[3];
    0362A 9020 0684 LDS	R2,Result+25
    0362C 8223      STD	Z+3,R2
(0430) 		pD[6]=Result.Date[4];
    0362D 9020 0685 LDS	R2,Result+26
    0362F 8226      STD	Z+6,R2
(0431) 		pD[7]=Result.Date[5];
    03630 9020 0686 LDS	R2,Result+27
    03632 8227      STD	Z+7,R2
(0432) 		pD[10]=Result.Date[6];
    03633 9020 0687 LDS	R2,Result+28
    03635 8622      STD	Z+10,R2
(0433) 		pD[11]=Result.Date[7];  
    03636 9020 0688 LDS	R2,Result+29
    03638 8623      STD	Z+11,R2
(0434) 		pT[0] = Result.Time[0];
    03639 9020 068A LDS	R2,Result+31
    0363B 01F5      MOVW	R30,R10
    0363C 8220      ST	Z,R2
(0435) 		pT[1] = Result.Time[1];
    0363D 9020 068B LDS	R2,Result+32
    0363F 8221      STD	Z+1,R2
(0436) 		pT[4] = Result.Time[3];
    03640 9020 068D LDS	R2,Result+34
    03642 8224      STD	Z+4,R2
(0437) 		pT[5] = Result.Time[4];
    03643 9020 068E LDS	R2,Result+35
    03645 8225      STD	Z+5,R2
(0438) 		pT[8] = Result.Time[6];
    03646 9020 0690 LDS	R2,Result+37
    03648 8620      STD	Z+8,R2
(0439) 		pT[9] = Result.Time[7];
    03649 9020 0691 LDS	R2,Result+38
    0364B 8621      STD	Z+9,R2
(0440) 		
(0441) 		switch(i){
    0364C 2D6E      MOV	R22,R14
    0364D 2777      CLR	R23
    0364E 3060      CPI	R22,0
    0364F 0767      CPC	R22,R23
    03650 F0D1      BEQ	0x366B
    03651 3061      CPI	R22,1
    03652 E0E0      LDI	R30,0
    03653 077E      CPC	R23,R30
    03654 F409      BNE	0x3656
    03655 C04A      RJMP	0x36A0
    03656 3062      CPI	R22,2
    03657 E0E0      LDI	R30,0
    03658 077E      CPC	R23,R30
    03659 F409      BNE	0x365B
    0365A C07C      RJMP	0x36D7
    0365B 3063      CPI	R22,3
    0365C E0E0      LDI	R30,0
    0365D 077E      CPC	R23,R30
    0365E F409      BNE	0x3660
    0365F C0BE      RJMP	0x371E
    03660 3064      CPI	R22,4
    03661 E0E0      LDI	R30,0
    03662 077E      CPC	R23,R30
    03663 F409      BNE	0x3665
    03664 C0F1      RJMP	0x3756
    03665 3065      CPI	R22,5
    03666 E0E0      LDI	R30,0
    03667 077E      CPC	R23,R30
    03668 F409      BNE	0x366A
    03669 C123      RJMP	0x378D
    0366A C15C      RJMP	0x37C7
(0442)             case 0: p=2;ary=GUI_up;  //年
    0366B E082      LDI	R24,2
    0366C 878A      STD	Y+10,R24
    0366D 01CE      MOVW	R24,R28
    0366E 9602      ADIW	R24,2
    0366F 016C      MOVW	R12,R24
(0443) 		 	  	 if(keyc==up){
    03670 314E      CPI	R20,0x1E
    03671 F491      BNE	0x3684
(0444) 				     if(time_buf[1]<0x99){ 
    03672 9180 0612 LDS	R24,time_buf+1
    03674 3989      CPI	R24,0x99
    03675 F008      BCS	0x3677
    03676 C150      RJMP	0x37C7
(0445) 					     time_buf[1]++;
    03677 5F8F      SUBI	R24,0xFF
    03678 9380 0612 STS	time_buf+1,R24
(0446) 						 if((time_buf[1]&0x0f)==0x0a) 
    0367A 708F      ANDI	R24,0xF
    0367B 308A      CPI	R24,0xA
    0367C F009      BEQ	0x367E
    0367D C149      RJMP	0x37C7
(0447) 						     time_buf[1]=time_buf[1]+6;
    0367E 9180 0612 LDS	R24,time_buf+1
    03680 5F8A      SUBI	R24,0xFA
    03681 9380 0612 STS	time_buf+1,R24
(0448) 					 }
(0449) 												     
(0450) 				}				  
    03683 C143      RJMP	0x37C7
(0451)  					        
(0452) 			    else if(keyc==down){ 
    03684 314D      CPI	R20,0x1D
    03685 F4A1      BNE	0x369A
(0453) 				    if(time_buf[1]>0x00){
    03686 E080      LDI	R24,0
    03687 9020 0612 LDS	R2,time_buf+1
    03689 1582      CP	R24,R2
    0368A F008      BCS	0x368C
    0368B C13B      RJMP	0x37C7
(0454) 				        time_buf[1]--;
    0368C 2D82      MOV	R24,R2
    0368D 5081      SUBI	R24,1
    0368E 9380 0612 STS	time_buf+1,R24
(0455) 						if((time_buf[1]&0x0f)==0x0f) 
    03690 708F      ANDI	R24,0xF
    03691 308F      CPI	R24,0xF
    03692 F009      BEQ	0x3694
    03693 C133      RJMP	0x37C7
(0456) 						    time_buf[1]=time_buf[1]-6;
    03694 9180 0612 LDS	R24,time_buf+1
    03696 5086      SUBI	R24,6
    03697 9380 0612 STS	time_buf+1,R24
(0457) 		 	  	 		 }
(0458) 												   
(0459) 					}			   		
    03699 C12D      RJMP	0x37C7
(0460) 				else if(keyc==left) {i=1;}
    0369A 314B      CPI	R20,0x1B
    0369B F009      BEQ	0x369D
    0369C C12A      RJMP	0x37C7
    0369D 24EE      CLR	R14
    0369E 94E3      INC	R14
(0461) 				break;
    0369F C127      RJMP	0x37C7
(0462) 		 case 1:p=4;ary=GUI_up;  //月
    036A0 E084      LDI	R24,4
    036A1 878A      STD	Y+10,R24
    036A2 01CE      MOVW	R24,R28
    036A3 9602      ADIW	R24,2
    036A4 016C      MOVW	R12,R24
(0463) 		  	  	if(keyc==up){
    036A5 314E      CPI	R20,0x1E
    036A6 F499      BNE	0x36BA
(0464) 				    if(time_buf[2]<0x12){  
    036A7 9180 0613 LDS	R24,time_buf+2
    036A9 3182      CPI	R24,0x12
    036AA F460      BCC	0x36B7
(0465) 					    time_buf[2]++;	
    036AB 5F8F      SUBI	R24,0xFF
    036AC 9380 0613 STS	time_buf+2,R24
(0466) 						if((time_buf[2]&0x0f)==0x0a) time_buf[2]+=6;
    036AE 708F      ANDI	R24,0xF
    036AF 308A      CPI	R24,0xA
    036B0 F449      BNE	0x36BA
    036B1 9180 0613 LDS	R24,time_buf+2
    036B3 5F8A      SUBI	R24,0xFA
    036B4 9380 0613 STS	time_buf+2,R24
(0467) 					}
    036B6 C003      RJMP	0x36BA
(0468) 					else 
(0469) 					    time_buf[2]=0x01;
    036B7 E081      LDI	R24,1
    036B8 9380 0613 STS	time_buf+2,R24
(0470) 				}						 
(0471) 				if(keyc==down){ 
    036BA 314D      CPI	R20,0x1D
    036BB F4A9      BNE	0x36D1
(0472) 				    if(time_buf[2]>0x01){  
    036BC E081      LDI	R24,1
    036BD 9020 0613 LDS	R2,time_buf+2
    036BF 1582      CP	R24,R2
    036C0 F468      BCC	0x36CE
(0473) 					    time_buf[2]--;	
    036C1 2D82      MOV	R24,R2
    036C2 5081      SUBI	R24,1
    036C3 9380 0613 STS	time_buf+2,R24
(0474) 						if((time_buf[2]&0x0f)==0x0f) 
    036C5 708F      ANDI	R24,0xF
    036C6 308F      CPI	R24,0xF
    036C7 F449      BNE	0x36D1
(0475) 						    time_buf[2]-=6;
    036C8 9180 0613 LDS	R24,time_buf+2
    036CA 5086      SUBI	R24,6
    036CB 9380 0613 STS	time_buf+2,R24
(0476) 			  		}
    036CD C003      RJMP	0x36D1
(0477) 				    else 
(0478) 					    time_buf[2]=0x12;						
    036CE E182      LDI	R24,0x12
    036CF 9380 0613 STS	time_buf+2,R24
(0479) 				}						 							
(0480)  								
(0481) 				if(keyc==left){
    036D1 314B      CPI	R20,0x1B
    036D2 F009      BEQ	0x36D4
    036D3 C0F3      RJMP	0x37C7
(0482) 				    i=2;   
    036D4 E082      LDI	R24,2
    036D5 2EE8      MOV	R14,R24
(0483) 				}  
(0484) 				break;
    036D6 C0F0      RJMP	0x37C7
(0485) 	 	 case 2: p=6;ary=GUI_up;
    036D7 E086      LDI	R24,6
    036D8 878A      STD	Y+10,R24
    036D9 01CE      MOVW	R24,R28
    036DA 9602      ADIW	R24,2
    036DB 016C      MOVW	R12,R24
(0486) 		 	  	 if(keyc==up){ 
    036DC 314E      CPI	R20,0x1E
    036DD F519      BNE	0x3701
(0487) 				     if(time_buf[3]<0x31){ 
    036DE 9180 0614 LDS	R24,time_buf+3
    036E0 3381      CPI	R24,0x31
    036E1 F5B0      BCC	0x3718
(0488) 				         time_buf[3]++;
    036E2 5F8F      SUBI	R24,0xFF
    036E3 9380 0614 STS	time_buf+3,R24
(0489) 						 if ((time_buf[3]&0x0f)==0x0a) time_buf[3]=time_buf[3]+6;
    036E5 708F      ANDI	R24,0xF
    036E6 308A      CPI	R24,0xA
    036E7 F429      BNE	0x36ED
    036E8 9180 0614 LDS	R24,time_buf+3
    036EA 5F8A      SUBI	R24,0xFA
    036EB 9380 0614 STS	time_buf+3,R24
(0490) 						 if(  //2 4 6 9 11 月最大30天
(0491) 						  ( ((time_buf[2]==0x02) || (time_buf[2]==0x04)|| (time_buf[2]==0x06)||
    036ED 9180 0613 LDS	R24,time_buf+2
    036EF 3082      CPI	R24,2
    036F0 F041      BEQ	0x36F9
    036F1 3084      CPI	R24,4
    036F2 F031      BEQ	0x36F9
    036F3 3086      CPI	R24,6
    036F4 F021      BEQ	0x36F9
    036F5 3089      CPI	R24,0x9
    036F6 F011      BEQ	0x36F9
    036F7 3181      CPI	R24,0x11
    036F8 F4F9      BNE	0x3718
    036F9 9180 0614 LDS	R24,time_buf+3
    036FB 3381      CPI	R24,0x31
    036FC F4D9      BNE	0x3718
(0492) 						  (time_buf[2]==0x09)||(time_buf[2]==0x11))&&(time_buf[3]==0x31))){
(0493) 						      time_buf[3]=0x30;
    036FD E380      LDI	R24,0x30
    036FE 9380 0614 STS	time_buf+3,R24
(0494) 						}
(0495) 				     }
(0496)  									  
(0497)  				 }
    03700 C017      RJMP	0x3718
(0498) 			     else if(keyc==down){ 
    03701 314D      CPI	R20,0x1D
    03702 F4A9      BNE	0x3718
(0499) 				      if(time_buf[3]>0x01){  
    03703 E081      LDI	R24,1
    03704 9020 0614 LDS	R2,time_buf+3
    03706 1582      CP	R24,R2
    03707 F468      BCC	0x3715
(0500) 					     time_buf[3]--;
    03708 2D82      MOV	R24,R2
    03709 5081      SUBI	R24,1
    0370A 9380 0614 STS	time_buf+3,R24
(0501) 				 	  	 if((time_buf[3]&0x0f)==0x0f) time_buf[3]=time_buf[3]-6;
    0370C 708F      ANDI	R24,0xF
    0370D 308F      CPI	R24,0xF
    0370E F449      BNE	0x3718
    0370F 9180 0614 LDS	R24,time_buf+3
    03711 5086      SUBI	R24,6
    03712 9380 0614 STS	time_buf+3,R24
(0502) 		 	  	 	 }
    03714 C003      RJMP	0x3718
(0503) 					 else time_buf[3]=0x31;						
    03715 E381      LDI	R24,0x31
    03716 9380 0614 STS	time_buf+3,R24
(0504) 											   
(0505) 				}
(0506) 				if(keyc==left) {i=3;  }						 			   		
    03718 314B      CPI	R20,0x1B
    03719 F009      BEQ	0x371B
    0371A C0AC      RJMP	0x37C7
    0371B E083      LDI	R24,3
    0371C 2EE8      MOV	R14,R24
(0507) 				break;
    0371D C0A9      RJMP	0x37C7
(0508) 		case 3:p=1;ary=GUI_down;
    0371E 2400      CLR	R0
    0371F 9403      INC	R0
    03720 860A      STD	Y+10,R0
    03721 01CE      MOVW	R24,R28
    03722 9605      ADIW	R24,5
    03723 016C      MOVW	R12,R24
(0509)  	  	if(keyc==up){ if(time_buf[4]<0x23){  time_buf[4]++;	
    03724 314E      CPI	R20,0x1E
    03725 F499      BNE	0x3739
    03726 9180 0615 LDS	R24,time_buf+4
    03728 3283      CPI	R24,0x23
    03729 F460      BCC	0x3736
    0372A 5F8F      SUBI	R24,0xFF
    0372B 9380 0615 STS	time_buf+4,R24
(0510) 													if((time_buf[4]&0x0f)==0x0a) time_buf[4]+=6;
    0372D 708F      ANDI	R24,0xF
    0372E 308A      CPI	R24,0xA
    0372F F449      BNE	0x3739
    03730 9180 0615 LDS	R24,time_buf+4
    03732 5F8A      SUBI	R24,0xFA
    03733 9380 0615 STS	time_buf+4,R24
(0511) 													 
(0512) 													
(0513) 												 }
    03735 C003      RJMP	0x3739
(0514) 							else time_buf[4]=0x00;
    03736 2422      CLR	R2
    03737 9220 0615 STS	time_buf+4,R2
(0515) 						  }						 
(0516) 				if(keyc==down){ if(time_buf[4]>0x00){  time_buf[4]--;	
    03739 314D      CPI	R20,0x1D
    0373A F4A9      BNE	0x3750
    0373B E080      LDI	R24,0
    0373C 9020 0615 LDS	R2,time_buf+4
    0373E 1582      CP	R24,R2
    0373F F468      BCC	0x374D
    03740 2D82      MOV	R24,R2
    03741 5081      SUBI	R24,1
    03742 9380 0615 STS	time_buf+4,R24
(0517) 													if((time_buf[4]&0x0f)==0x0f) time_buf[4]-=6;
    03744 708F      ANDI	R24,0xF
    03745 308F      CPI	R24,0xF
    03746 F449      BNE	0x3750
    03747 9180 0615 LDS	R24,time_buf+4
    03749 5086      SUBI	R24,6
    0374A 9380 0615 STS	time_buf+4,R24
(0518) 													
(0519) 												 }
    0374C C003      RJMP	0x3750
(0520) 							 else time_buf[4]=0x23;						
    0374D E283      LDI	R24,0x23
    0374E 9380 0615 STS	time_buf+4,R24
(0521) 						  }	
(0522) 		if(keyc==left) {i=4;    } 
    03750 314B      CPI	R20,0x1B
    03751 F009      BEQ	0x3753
    03752 C074      RJMP	0x37C7
    03753 E084      LDI	R24,4
    03754 2EE8      MOV	R14,R24
(0523) 		break;						  					 			
    03755 C071      RJMP	0x37C7
(0524)  case 4:p=3;ary=GUI_down;
    03756 E083      LDI	R24,3
    03757 878A      STD	Y+10,R24
    03758 01CE      MOVW	R24,R28
    03759 9605      ADIW	R24,5
    0375A 016C      MOVW	R12,R24
(0525)  	  	if(keyc==up){ if(time_buf[5]<0x59){  time_buf[5]++;	
    0375B 314E      CPI	R20,0x1E
    0375C F499      BNE	0x3770
    0375D 9180 0616 LDS	R24,time_buf+5
    0375F 3589      CPI	R24,0x59
    03760 F460      BCC	0x376D
    03761 5F8F      SUBI	R24,0xFF
    03762 9380 0616 STS	time_buf+5,R24
(0526) 											 if((time_buf[5]&0x0f)==0x0a) time_buf[5]+=6;
    03764 708F      ANDI	R24,0xF
    03765 308A      CPI	R24,0xA
    03766 F449      BNE	0x3770
    03767 9180 0616 LDS	R24,time_buf+5
    03769 5F8A      SUBI	R24,0xFA
    0376A 9380 0616 STS	time_buf+5,R24
(0527) 										  }
    0376C C003      RJMP	0x3770
(0528) 					  else time_buf[5]=0x00;
    0376D 2422      CLR	R2
    0376E 9220 0616 STS	time_buf+5,R2
(0529) 					}						 
(0530) 		if(keyc==down){ if(time_buf[5]>0x00){  time_buf[5]--;	
    03770 314D      CPI	R20,0x1D
    03771 F4A9      BNE	0x3787
    03772 E080      LDI	R24,0
    03773 9020 0616 LDS	R2,time_buf+5
    03775 1582      CP	R24,R2
    03776 F468      BCC	0x3784
    03777 2D82      MOV	R24,R2
    03778 5081      SUBI	R24,1
    03779 9380 0616 STS	time_buf+5,R24
(0531) 												if((time_buf[5]&0x0f)==0x0f) time_buf[5]-=6;
    0377B 708F      ANDI	R24,0xF
    0377C 308F      CPI	R24,0xF
    0377D F449      BNE	0x3787
    0377E 9180 0616 LDS	R24,time_buf+5
    03780 5086      SUBI	R24,6
    03781 9380 0616 STS	time_buf+5,R24
(0532) 											}
    03783 C003      RJMP	0x3787
(0533) 						else time_buf[5]=0x59;						
    03784 E589      LDI	R24,0x59
    03785 9380 0616 STS	time_buf+5,R24
(0534) 					  }
(0535) 		if(keyc==left ) {i=5;    } 		  						 								  			
    03787 314B      CPI	R20,0x1B
    03788 F009      BEQ	0x378A
    03789 C03D      RJMP	0x37C7
    0378A E085      LDI	R24,5
    0378B 2EE8      MOV	R14,R24
(0536) 		break;			   
    0378C C03A      RJMP	0x37C7
(0537)  case 5:p=5;ary=GUI_down;
    0378D E085      LDI	R24,5
    0378E 878A      STD	Y+10,R24
    0378F 01CE      MOVW	R24,R28
    03790 9605      ADIW	R24,5
    03791 016C      MOVW	R12,R24
(0538)  	  	if(keyc==up){ if(time_buf[6]<0x59){  time_buf[6]++;	
    03792 314E      CPI	R20,0x1E
    03793 F499      BNE	0x37A7
    03794 9180 0617 LDS	R24,time_buf+6
    03796 3589      CPI	R24,0x59
    03797 F460      BCC	0x37A4
    03798 5F8F      SUBI	R24,0xFF
    03799 9380 0617 STS	time_buf+6,R24
(0539) 											 if((time_buf[6]&0x0f)==0x0a) time_buf[6]+=6;
    0379B 708F      ANDI	R24,0xF
    0379C 308A      CPI	R24,0xA
    0379D F449      BNE	0x37A7
    0379E 9180 0617 LDS	R24,time_buf+6
    037A0 5F8A      SUBI	R24,0xFA
    037A1 9380 0617 STS	time_buf+6,R24
(0540) 										 }
    037A3 C003      RJMP	0x37A7
(0541) 					  else time_buf[6]=0x00;
    037A4 2422      CLR	R2
    037A5 9220 0617 STS	time_buf+6,R2
(0542) 					}						 
(0543) 		if(keyc==down){ if(time_buf[6]>0x00){  time_buf[6]--;	
    037A7 314D      CPI	R20,0x1D
    037A8 F4A9      BNE	0x37BE
    037A9 E080      LDI	R24,0
    037AA 9020 0617 LDS	R2,time_buf+6
    037AC 1582      CP	R24,R2
    037AD F468      BCC	0x37BB
    037AE 2D82      MOV	R24,R2
    037AF 5081      SUBI	R24,1
    037B0 9380 0617 STS	time_buf+6,R24
(0544) 						if((time_buf[6]&0x0f)==0x0f) time_buf[6]-=6;
    037B2 708F      ANDI	R24,0xF
    037B3 308F      CPI	R24,0xF
    037B4 F449      BNE	0x37BE
    037B5 9180 0617 LDS	R24,time_buf+6
    037B7 5086      SUBI	R24,6
    037B8 9380 0617 STS	time_buf+6,R24
(0545) 					  }
    037BA C003      RJMP	0x37BE
(0546) 		else time_buf[6]=0x59;		}				
    037BB E589      LDI	R24,0x59
    037BC 9380 0617 STS	time_buf+6,R24
(0547) 		if(keyc==left) {i=6;p=1;ary=NULL;}  
    037BE 314B      CPI	R20,0x1B
    037BF F439      BNE	0x37C7
    037C0 E086      LDI	R24,6
    037C1 2EE8      MOV	R14,R24
    037C2 2400      CLR	R0
    037C3 9403      INC	R0
    037C4 860A      STD	Y+10,R0
    037C5 24CC      CLR	R12
    037C6 24DD      CLR	R13
(0548) 		break;           
(0549) 							 
(0550) 		 }//endcase
(0551)  		 dateRefresh(88); //set clock mode
    037C7 E508      LDI	R16,0x58
    037C8 D21E      RCALL	_dateRefresh
(0552) 		 
(0553) 		 LCD_const_disp(3,1,"                "); //清空箭头 
    037C9 E480      LDI	R24,0x40
    037CA E094      LDI	R25,4
    037CB 8399      STD	Y+1,R25
    037CC 8388      ST	Y,R24
    037CD E021      LDI	R18,1
    037CE E003      LDI	R16,3
    037CF 940E 3F86 CALL	_LCD_const_disp
(0554)  		 LCD_var_disp(3,p,ary); //显示箭头 
    037D1 82D9      STD	Y+1,R13
    037D2 82C8      ST	Y,R12
    037D3 852A      LDD	R18,Y+10
    037D4 E003      LDI	R16,3
    037D5 940E 3FB3 CALL	_LCD_var_disp
(0555)  		 LCD_var_disp(2,1,pD);  //显示日期
    037D7 8408      LDD	R0,Y+8
    037D8 8419      LDD	R1,Y+9
    037D9 8219      STD	Y+1,R1
    037DA 8208      ST	Y,R0
    037DB E021      LDI	R18,1
    037DC E002      LDI	R16,2
    037DD 940E 3FB3 CALL	_LCD_var_disp
(0556)  		 LCD_var_disp(4,1,pT);  //显示时间
    037DF 82B9      STD	Y+1,R11
    037E0 82A8      ST	Y,R10
    037E1 E021      LDI	R18,1
    037E2 E004      LDI	R16,4
    037E3 940E 3FB3 CALL	_LCD_var_disp
(0557)  if(keyc==right) {		  
    037E5 3147      CPI	R20,0x17
    037E6 F479      BNE	0x37F6
(0558)  		  LCD_const_disp(3,1,"        放弃修改"); 
    037E7 E28F      LDI	R24,0x2F
    037E8 E094      LDI	R25,4
    037E9 8399      STD	Y+1,R25
    037EA 8388      ST	Y,R24
    037EB E021      LDI	R18,1
    037EC E003      LDI	R16,3
    037ED 940E 3F86 CALL	_LCD_const_disp
(0559) 		  delayms(500);
    037EF EF04      LDI	R16,0xF4
    037F0 E011      LDI	R17,1
    037F1 940E 2D70 CALL	_delayms
(0560) 		  LCD_CLR(); //清屏
    037F3 940E 402C CALL	_LCD_CLR
(0561) 		  return ;} 
    037F5 C026      RJMP	0x381C
(0562)  keyc=NO_KEY;
    037F6 2744      CLR	R20
(0563)  if(i==6){    //各值改变完成后 显示已保存 清屏 返回
    037F7 2D8E      MOV	R24,R14
    037F8 3086      CPI	R24,6
    037F9 F4C9      BNE	0x3813
(0564) 		  ds1302_write_time(); 
    037FA 940E 453F CALL	_ds1302_write_time
(0565)           LCD_const_disp(4,7,"    ");		  
    037FC E28A      LDI	R24,0x2A
    037FD E094      LDI	R25,4
    037FE 8399      STD	Y+1,R25
    037FF 8388      ST	Y,R24
    03800 E027      LDI	R18,7
    03801 E004      LDI	R16,4
    03802 940E 3F86 CALL	_LCD_const_disp
(0566) 		  LCD_const_disp(3,1,"          已保存"); 
    03804 E189      LDI	R24,0x19
    03805 E094      LDI	R25,4
    03806 8399      STD	Y+1,R25
    03807 8388      ST	Y,R24
    03808 E021      LDI	R18,1
    03809 E003      LDI	R16,3
    0380A 940E 3F86 CALL	_LCD_const_disp
(0567) 		  delayms(300);
    0380C E20C      LDI	R16,0x2C
    0380D E011      LDI	R17,1
    0380E 940E 2D70 CALL	_delayms
(0568) 		  LCD_CLR(); //清屏
    03810 940E 402C CALL	_LCD_CLR
(0569) 		  return ;
    03812 C009      RJMP	0x381C
(0570) 		  }
(0571)  delayms(2);	  
    03813 E002      LDI	R16,2
    03814 E010      LDI	R17,0
    03815 940E 2D70 CALL	_delayms
    03817 940E 0492 CALL	_alwaysCheck
    03819 2300      TST	R16
    0381A F009      BEQ	0x381C
    0381B CE06      RJMP	0x3622
    0381C 962B      ADIW	R28,0xB
    0381D 940C 4BA0 JMP	pop_xgsetF0FC
_GUI_readback:
  res                  --> R12
  file_buf             --> Y,+3
  page                 --> R20
  key                  --> R22
  buf                  --> R10
    0381F 940E 4BAB CALL	push_xgsetF0FC
    03821 0158      MOVW	R10,R16
    03822 9760      SBIW	R28,0x10
(0572) }//endwhile(1)
(0573) }
(0574) void GUI_readback(char *buf){
(0575)     char key=0;
    03823 2766      CLR	R22
(0576) 	char page=0;
    03824 2744      CLR	R20
(0577) 	char res=0;
    03825 24CC      CLR	R12
(0578) 	char file_buf[]="201201.xls\0\0";
    03826 EA8D      LDI	R24,0xAD
    03827 E093      LDI	R25,3
    03828 01FE      MOVW	R30,R28
    03829 9633      ADIW	R30,3
    0382A E00D      LDI	R16,0xD
    0382B E010      LDI	R17,0
    0382C 93FA      ST	-Y,R31
    0382D 93EA      ST	-Y,R30
    0382E 939A      ST	-Y,R25
    0382F 938A      ST	-Y,R24
    03830 940E 4C5B CALL	asgnblk
(0579) 	LCD_CLR(); //清屏
    03832 940E 402C CALL	_LCD_CLR
(0580) 	//1 检测SD状态
(0581) 		//无SD卡 显示无卡 退出
(0582) 	if((SD_DET()==0)) {
    03834 B181      IN	R24,0x01
    03835 9586      LSR	R24
    03836 9586      LSR	R24
    03837 9586      LSR	R24
    03838 9586      LSR	R24
    03839 9586      LSR	R24
    0383A 7081      ANDI	R24,1
    0383B F421      BNE	0x3840
    0383C E081      LDI	R24,1
    0383D E090      LDI	R25,0
    0383E 017C      MOVW	R14,R24
    0383F C002      RJMP	0x3842
    03840 24EE      CLR	R14
    03841 24FF      CLR	R15
    03842 20EE      TST	R14
    03843 F479      BNE	0x3853
    03844 20FF      TST	R15
    03845 F469      BNE	0x3853
(0583) 		LCD_const_disp(2,1,"未检测到SD卡..");
    03846 E08A      LDI	R24,0xA
    03847 E094      LDI	R25,4
    03848 8399      STD	Y+1,R25
    03849 8388      ST	Y,R24
    0384A E021      LDI	R18,1
    0384B E002      LDI	R16,2
    0384C 940E 3F86 CALL	_LCD_const_disp
(0584) 			#ifdef _DBG_RD_
(0585) 		   PrintString_n("not find sd");
(0586) 		   #endif
(0587) 		delayms(500);
    0384E EF04      LDI	R16,0xF4
    0384F E011      LDI	R17,1
    03850 940E 2D70 CALL	_delayms
(0588) 		return ;
    03852 C174      RJMP	0x39C7
(0589) 	}
(0590) 	//2 显示当前月份
(0591) 	get_name(file_buf);
    03853 018E      MOVW	R16,R28
    03854 5F0D      SUBI	R16,0xFD
    03855 4F1F      SBCI	R17,0xFF
    03856 940E 0B0B CALL	_get_name
(0592) 	LCD_const_disp(1,1,"查找数据:");
    03858 E080      LDI	R24,0
    03859 E094      LDI	R25,4
    0385A 8399      STD	Y+1,R25
    0385B 8388      ST	Y,R24
    0385C E021      LDI	R18,1
    0385D E001      LDI	R16,1
    0385E 940E 3F86 CALL	_LCD_const_disp
(0593) 	LCD_const_disp(2,2,file_buf);
    03860 01CE      MOVW	R24,R28
    03861 9603      ADIW	R24,3
    03862 8399      STD	Y+1,R25
    03863 8388      ST	Y,R24
    03864 E022      LDI	R18,2
    03865 E002      LDI	R16,2
    03866 940E 3F86 CALL	_LCD_const_disp
(0594) 	#ifdef _DBG_RD_
(0595) 		   PrintString_n(file_buf);
(0596) 	#endif
(0597) 	//3 查找文件是否存在
(0598) 		//存在-> 进入读取顺序的选择
(0599) 		//不存在 -> 询问查找上月
(0600) 	//4 选择 查询顺序
(0601) 		//计算总条数
(0602) 		//顺序 增量为1， 查询第一条 
(0603) 		//逆序 增量为-1，查询最后一条
(0604) 	//5 读取	
(0605) 	//6 显示
(0606) 	//7 上一条 下一条  退出
(0607) 		//设置条数 判断边界 进入5
(0608) 		//退出 返回主程序	
(0609) 	//!!res=checkFile(file_buf);
(0610) label_recheck:	
(0611) 	LCD_Init(); //清屏
    03868 940E 3FFA CALL	_LCD_Init
(0612) 	LCD_CLR();  
    0386A 940E 402C CALL	_LCD_CLR
(0613) 	if(res == 0){ //找到并已经确认文件
    0386C 20CC      TST	R12
    0386D F009      BEQ	0x386F
    0386E C158      RJMP	0x39C7
(0614) 		   LCD_const_disp(1,1,"菜单/ 查询");
    0386F EF85      LDI	R24,0xF5
    03870 E093      LDI	R25,3
    03871 8399      STD	Y+1,R25
    03872 8388      ST	Y,R24
    03873 E021      LDI	R18,1
    03874 E001      LDI	R16,1
    03875 940E 3F86 CALL	_LCD_const_disp
(0615)    		   LCD_const_disp(2,3,"按顺序");
    03877 EE8E      LDI	R24,0xEE
    03878 E093      LDI	R25,3
    03879 8399      STD	Y+1,R25
    0387A 8388      ST	Y,R24
    0387B E023      LDI	R18,3
    0387C E002      LDI	R16,2
    0387D 940E 3F86 CALL	_LCD_const_disp
(0616) 		   LCD_const_disp(3,3,"最后一次");		 
    0387F EE85      LDI	R24,0xE5
    03880 E093      LDI	R25,3
    03881 8399      STD	Y+1,R25
    03882 8388      ST	Y,R24
    03883 E023      LDI	R18,3
    03884 E003      LDI	R16,3
    03885 940E 3F86 CALL	_LCD_const_disp
(0617) 	       if(config.readMode == READ_MODE_LAST){
    03887 9020 08EF LDS	R2,config+18
    03889 2022      TST	R2
    0388A F4A1      BNE	0x389F
(0618) 		       config.readMode=READ_MODE_FIRST;
    0388B E081      LDI	R24,1
    0388C 9380 08EF STS	config+18,R24
(0619) 			   Set_White(1,2,8,0);
    0388E 2422      CLR	R2
    0388F 822A      STD	Y+2,R2
    03890 E088      LDI	R24,0x8
    03891 8388      ST	Y,R24
    03892 E022      LDI	R18,2
    03893 E001      LDI	R16,1
    03894 940E 40B6 CALL	_Set_White
(0620)  			   Set_White(1,3,8,1);
    03896 E081      LDI	R24,1
    03897 838A      STD	Y+2,R24
    03898 E088      LDI	R24,0x8
    03899 8388      ST	Y,R24
    0389A E023      LDI	R18,3
    0389B E001      LDI	R16,1
    0389C 940E 40B6 CALL	_Set_White
(0621) 		  }
    0389E C067      RJMP	0x3906
(0622) 		  else {
(0623) 		       config.readMode=READ_MODE_LAST;
    0389F 2422      CLR	R2
    038A0 9220 08EF STS	config+18,R2
(0624) 			   Set_White(1,2,8,1);
    038A2 E081      LDI	R24,1
    038A3 838A      STD	Y+2,R24
    038A4 E088      LDI	R24,0x8
    038A5 8388      ST	Y,R24
    038A6 E022      LDI	R18,2
    038A7 E001      LDI	R16,1
    038A8 940E 40B6 CALL	_Set_White
(0625)  			   Set_White(1,3,8,0);
    038AA 2422      CLR	R2
    038AB 822A      STD	Y+2,R2
    038AC E088      LDI	R24,0x8
    038AD 8388      ST	Y,R24
    038AE E023      LDI	R18,3
    038AF E001      LDI	R16,1
    038B0 940E 40B6 CALL	_Set_White
(0626) 		 }
    038B2 C053      RJMP	0x3906
(0627) 		   // 菜单/查询   按顺序/最后一次
(0628) 		   while(alwaysCheck()){
(0629)  		       key=kbscan();
    038B3 940E 458C CALL	_kbscan
    038B5 2F60      MOV	R22,R16
(0630) 			   dateRefresh(0); //只刷新后台时间
    038B6 2700      CLR	R16
    038B7 D12F      RCALL	_dateRefresh
(0631) 			   //上键短按 选择
(0632) 			   if(key==up || key ==down){
    038B8 316E      CPI	R22,0x1E
    038B9 F011      BEQ	0x38BC
    038BA 316D      CPI	R22,0x1D
    038BB F559      BNE	0x38E7
(0633) 	    	       if(config.readMode == READ_MODE_LAST){
    038BC 9020 08EF LDS	R2,config+18
    038BE 2022      TST	R2
    038BF F4A1      BNE	0x38D4
(0634) 		    	       config.readMode=READ_MODE_FIRST;
    038C0 E081      LDI	R24,1
    038C1 9380 08EF STS	config+18,R24
(0635) 					   Set_White(1,2,8,0);
    038C3 2422      CLR	R2
    038C4 822A      STD	Y+2,R2
    038C5 E088      LDI	R24,0x8
    038C6 8388      ST	Y,R24
    038C7 E022      LDI	R18,2
    038C8 E001      LDI	R16,1
    038C9 940E 40B6 CALL	_Set_White
(0636)  					   Set_White(1,3,8,1);
    038CB E081      LDI	R24,1
    038CC 838A      STD	Y+2,R24
    038CD E088      LDI	R24,0x8
    038CE 8388      ST	Y,R24
    038CF E023      LDI	R18,3
    038D0 E001      LDI	R16,1
    038D1 940E 40B6 CALL	_Set_White
(0637) 				   }
    038D3 C013      RJMP	0x38E7
(0638) 				   else {
(0639) 		    	       config.readMode=READ_MODE_LAST;
    038D4 2422      CLR	R2
    038D5 9220 08EF STS	config+18,R2
(0640) 					   Set_White(1,2,8,1);
    038D7 E081      LDI	R24,1
    038D8 838A      STD	Y+2,R24
    038D9 E088      LDI	R24,0x8
    038DA 8388      ST	Y,R24
    038DB E022      LDI	R18,2
    038DC E001      LDI	R16,1
    038DD 940E 40B6 CALL	_Set_White
(0641)  					   Set_White(1,3,8,0);
    038DF 2422      CLR	R2
    038E0 822A      STD	Y+2,R2
    038E1 E088      LDI	R24,0x8
    038E2 8388      ST	Y,R24
    038E3 E023      LDI	R18,3
    038E4 E001      LDI	R16,1
    038E5 940E 40B6 CALL	_Set_White
(0642) 				   }
(0643) 				}      
(0644) 				//左键短按  进入
(0645) 				if(key == left) {
    038E7 316B      CPI	R22,0x1B
    038E8 F4A9      BNE	0x38FE
(0646) 				    Set_White(1,2,8,1);
    038E9 E081      LDI	R24,1
    038EA 838A      STD	Y+2,R24
    038EB E088      LDI	R24,0x8
    038EC 8388      ST	Y,R24
    038ED E022      LDI	R18,2
    038EE E001      LDI	R16,1
    038EF 940E 40B6 CALL	_Set_White
(0647)  				    Set_White(1,3,8,1);
    038F1 E081      LDI	R24,1
    038F2 838A      STD	Y+2,R24
    038F3 E088      LDI	R24,0x8
    038F4 8388      ST	Y,R24
    038F5 E023      LDI	R18,3
    038F6 E001      LDI	R16,1
    038F7 940E 40B6 CALL	_Set_White
(0648) 					delayms(100);
    038F9 E604      LDI	R16,0x64
    038FA E010      LDI	R17,0
    038FB 940E 2D70 CALL	_delayms
(0649) 				break ;		
    038FD C00D      RJMP	0x390B
(0650) 				}
(0651) 				//右键短按  返回
(0652) 				if(key == right) {
    038FE 3167      CPI	R22,0x17
    038FF F429      BNE	0x3905
(0653) 				    LCD_CLR();
    03900 940E 402C CALL	_LCD_CLR
(0654) 	    			LCD_Init(); //清屏
    03902 940E 3FFA CALL	_LCD_Init
(0655) 					return ;	//返回主界面	
    03904 C0C2      RJMP	0x39C7
(0656) 				}
(0657) 				key=0;
    03905 2766      CLR	R22
    03906 940E 0492 CALL	_alwaysCheck
    03908 2300      TST	R16
    03909 F009      BEQ	0x390B
    0390A CFA8      RJMP	0x38B3
(0658) 		    } //end of while
(0659) 			if(config.readMode==READ_MODE_LAST){
    0390B 9020 08EF LDS	R2,config+18
    0390D 2022      TST	R2
    0390E F461      BNE	0x391B
(0660) 			    ReadSDFile(file_buf,65535,buf,0); //最后一条
    0390F 2422      CLR	R2
    03910 822A      STD	Y+2,R2
    03911 82B9      STD	Y+1,R11
    03912 82A8      ST	Y,R10
    03913 EF2F      LDI	R18,0xFF
    03914 EF3F      LDI	R19,0xFF
    03915 018E      MOVW	R16,R28
    03916 5F0D      SUBI	R16,0xFD
    03917 4F1F      SBCI	R17,0xFF
    03918 940E 0680 CALL	_ReadSDFile
(0661) 			}
    0391A C00B      RJMP	0x3926
(0662) 			else {
(0663) 			    ReadSDFile(file_buf,1,buf,0); //读第一条
    0391B 2422      CLR	R2
    0391C 822A      STD	Y+2,R2
    0391D 82B9      STD	Y+1,R11
    0391E 82A8      ST	Y,R10
    0391F E021      LDI	R18,1
    03920 E030      LDI	R19,0
    03921 018E      MOVW	R16,R28
    03922 5F0D      SUBI	R16,0xFD
    03923 4F1F      SBCI	R17,0xFF
    03924 940E 0680 CALL	_ReadSDFile
(0664) 			}
(0665) 			CharToStruct(buf);      //转换
    03926 0185      MOVW	R16,R10
    03927 940E 0AC6 CALL	_CharToStruct
    03929 C097      RJMP	0x39C1
(0666) 			while(alwaysCheck()){
(0667) 			    key=kbscan();     //键盘扫描
    0392A 940E 458C CALL	_kbscan
    0392C 2EE0      MOV	R14,R16
    0392D 2D6E      MOV	R22,R14
(0668) 				dateRefresh(0); //只刷新后台时间
    0392E 2700      CLR	R16
    0392F D0B7      RCALL	_dateRefresh
(0669) 				if(key != 0){ 
    03930 20EE      TST	R14
    03931 F021      BEQ	0x3936
(0670) 					   beep(0,1);
    03932 E021      LDI	R18,1
    03933 2700      CLR	R16
    03934 940E 4303 CALL	_beep
(0671) 				}
(0672) 				//dateRefresh(0);  //刷新
(0673) 				_GUI_datashow(page); //显示
    03936 2F04      MOV	R16,R20
    03937 DA58      RCALL	__GUI_datashow
(0674) 				if( key==left ){ //按left键下一条
    03938 316B      CPI	R22,0x1B
    03939 F4A1      BNE	0x394E
(0675) 					next_item:  //下一条
(0676) 				    ReadSDFile(file_buf,1,buf,1); //偏移到下一条
    0393A E081      LDI	R24,1
    0393B 838A      STD	Y+2,R24
    0393C 82B9      STD	Y+1,R11
    0393D 82A8      ST	Y,R10
    0393E E021      LDI	R18,1
    0393F E030      LDI	R19,0
    03940 018E      MOVW	R16,R28
    03941 5F0D      SUBI	R16,0xFD
    03942 4F1F      SBCI	R17,0xFF
    03943 940E 0680 CALL	_ReadSDFile
(0677) 					CharToStruct(buf);
    03945 0185      MOVW	R16,R10
    03946 940E 0AC6 CALL	_CharToStruct
(0678) 					LCD_CLR();
    03948 940E 402C CALL	_LCD_CLR
(0679) 		    		LCD_Init();
    0394A 940E 3FFA CALL	_LCD_Init
(0680) 					page = 0;
    0394C 2744      CLR	R20
(0681) 					key=0;
    0394D 2766      CLR	R22
(0682) 				}
(0683) 				if( key==lleft ){ //长按left键上一条
    0394E 396B      CPI	R22,0x9B
    0394F F4A1      BNE	0x3964
(0684) 		    	    pre_item: //上一条
(0685) 					ReadSDFile(file_buf,-1,buf,1); //偏移到上一条
    03950 E081      LDI	R24,1
    03951 838A      STD	Y+2,R24
    03952 82B9      STD	Y+1,R11
    03953 82A8      ST	Y,R10
    03954 EF2F      LDI	R18,0xFF
    03955 EF3F      LDI	R19,0xFF
    03956 018E      MOVW	R16,R28
    03957 5F0D      SUBI	R16,0xFD
    03958 4F1F      SBCI	R17,0xFF
    03959 940E 0680 CALL	_ReadSDFile
(0686) 					CharToStruct(buf);
    0395B 0185      MOVW	R16,R10
    0395C 940E 0AC6 CALL	_CharToStruct
(0687) 					LCD_CLR();
    0395E 940E 402C CALL	_LCD_CLR
(0688) 		    		LCD_Init();
    03960 940E 3FFA CALL	_LCD_Init
(0689) 					page = 0;
    03962 2744      CLR	R20
(0690) 					key=0;
    03963 2766      CLR	R22
(0691) 				}
(0692) 				if(key==up){ //上键 : 页面减 
    03964 316E      CPI	R22,0x1E
    03965 F441      BNE	0x396E
(0693) 	    		     LCD_CLR();
    03966 940E 402C CALL	_LCD_CLR
(0694) 		    		 LCD_Init();
    03968 940E 3FFA CALL	_LCD_Init
(0695) 					 if(page>0) page--;
    0396A E080      LDI	R24,0
    0396B 1784      CP	R24,R20
    0396C F718      BCC	0x3950
    0396D 954A      DEC	R20
(0696) 	    			 else{ 
(0697) 					    goto pre_item;
(0698) 					 }
(0699) 				}
(0700) 				if(key==lup){ //长按上键 : -10 条 
    0396E 396E      CPI	R22,0x9E
    0396F F4A1      BNE	0x3984
(0701) 	    		     LCD_CLR();
    03970 940E 402C CALL	_LCD_CLR
(0702) 		    		 LCD_Init();
    03972 940E 3FFA CALL	_LCD_Init
(0703) 					 ReadSDFile(file_buf,-10,buf,1); //偏移到下10条
    03974 E081      LDI	R24,1
    03975 838A      STD	Y+2,R24
    03976 82B9      STD	Y+1,R11
    03977 82A8      ST	Y,R10
    03978 EF26      LDI	R18,0xF6
    03979 EF3F      LDI	R19,0xFF
    0397A 018E      MOVW	R16,R28
    0397B 5F0D      SUBI	R16,0xFD
    0397C 4F1F      SBCI	R17,0xFF
    0397D 940E 0680 CALL	_ReadSDFile
(0704) 					 CharToStruct(buf);
    0397F 0185      MOVW	R16,R10
    03980 940E 0AC6 CALL	_CharToStruct
(0705) 					 page = 0;
    03982 2744      CLR	R20
(0706) 					 key = 0;
    03983 2766      CLR	R22
(0707) 				}
(0708) 				if(key==down){ //下键 ： 页面加
    03984 316D      CPI	R22,0x1D
    03985 F441      BNE	0x398E
(0709) 					LCD_CLR();
    03986 940E 402C CALL	_LCD_CLR
(0710) 		    		LCD_Init();
    03988 940E 3FFA CALL	_LCD_Init
(0711) 					if(page<5) page++;
    0398A 3045      CPI	R20,5
    0398B F008      BCS	0x398D
    0398C CFAD      RJMP	0x393A
    0398D 9543      INC	R20
(0712) 	  				else{
(0713) 						goto next_item;
(0714) 					}
(0715) 				}
(0716) 				if(key==ldown){ //长按下键 ： 页面加10条・
    0398E 396D      CPI	R22,0x9D
    0398F F4A1      BNE	0x39A4
(0717) 					LCD_CLR();
    03990 940E 402C CALL	_LCD_CLR
(0718) 		    		LCD_Init();
    03992 940E 3FFA CALL	_LCD_Init
(0719) 					page = 0;
    03994 2744      CLR	R20
(0720) 					key = 0;
    03995 2766      CLR	R22
(0721) 	 				ReadSDFile(file_buf,10,buf,1); //偏移到下10条
    03996 E081      LDI	R24,1
    03997 838A      STD	Y+2,R24
    03998 82B9      STD	Y+1,R11
    03999 82A8      ST	Y,R10
    0399A E02A      LDI	R18,0xA
    0399B E030      LDI	R19,0
    0399C 018E      MOVW	R16,R28
    0399D 5F0D      SUBI	R16,0xFD
    0399E 4F1F      SBCI	R17,0xFF
    0399F 940E 0680 CALL	_ReadSDFile
(0722) 					CharToStruct(buf);
    039A1 0185      MOVW	R16,R10
    039A2 940E 0AC6 CALL	_CharToStruct
(0723) 				}
(0724) 				//右键短按  返回
(0725) 				if(key == right) {
    039A4 3167      CPI	R22,0x17
    039A5 F429      BNE	0x39AB
(0726) 				    LCD_CLR();
    039A6 940E 402C CALL	_LCD_CLR
(0727) 		    		LCD_Init();
    039A8 940E 3FFA CALL	_LCD_Init
(0728) 					goto label_recheck;	   
    039AA CEBD      RJMP	0x3868
(0729) 				}
(0730) 				if(page == 0 ){
    039AB 2344      TST	R20
    039AC F481      BNE	0x39BD
(0731) 					LCD_const_disp(4,1,"ID:             ");
    039AD ED84      LDI	R24,0xD4
    039AE E093      LDI	R25,3
    039AF 8399      STD	Y+1,R25
    039B0 8388      ST	Y,R24
    039B1 E021      LDI	R18,1
    039B2 E004      LDI	R16,4
    039B3 940E 3F86 CALL	_LCD_const_disp
(0732) 					LCD_const_disp(4,3,Result.IndexChar);
    039B5 E789      LDI	R24,0x79
    039B6 E096      LDI	R25,6
    039B7 8399      STD	Y+1,R25
    039B8 8388      ST	Y,R24
    039B9 E023      LDI	R18,3
    039BA E004      LDI	R16,4
    039BB 940E 3F86 CALL	_LCD_const_disp
(0733) 				}
(0734) 
(0735)     			delayms(30); 
    039BD E10E      LDI	R16,0x1E
    039BE E010      LDI	R17,0
    039BF 940E 2D70 CALL	_delayms
    039C1 940E 0492 CALL	_alwaysCheck
    039C3 2EE0      MOV	R14,R16
    039C4 2300      TST	R16
    039C5 F009      BEQ	0x39C7
    039C6 CF63      RJMP	0x392A
(0736) 		 }//end while
(0737) 		   
(0738) 	}
(0739) 	else { //未找到或未确认文件
(0740) 		 //逆序查找文件，直到月份小于 200001.xls
(0741) 		 //或是手工确认的方式
(0742) 	}
    039C7 9660      ADIW	R28,0x10
    039C8 940C 4BA0 JMP	pop_xgsetF0FC
_GUI_welcome:
    039CA 9722      SBIW	R28,2
(0743) 
(0744) }
(0745) void GUI_welcome(void){
(0746)     LCD_CLR(); //清屏
    039CB 940E 402C CALL	_LCD_CLR
(0747) 	LCD_const_disp(2,3,"欢迎使用");
    039CD EC8B      LDI	R24,0xCB
    039CE E093      LDI	R25,3
    039CF 8399      STD	Y+1,R25
    039D0 8388      ST	Y,R24
    039D1 E023      LDI	R18,3
    039D2 E002      LDI	R16,2
    039D3 940E 3F86 CALL	_LCD_const_disp
(0748) 	LCD_const_disp(3,1,"环境冷强度检测仪");
    039D5 EB8A      LDI	R24,0xBA
    039D6 E093      LDI	R25,3
    039D7 8399      STD	Y+1,R25
    039D8 8388      ST	Y,R24
    039D9 E021      LDI	R18,1
    039DA E003      LDI	R16,3
    039DB 940E 3F86 CALL	_LCD_const_disp
(0749) 	delayms(800);
    039DD E200      LDI	R16,0x20
    039DE E013      LDI	R17,3
    039DF 940E 2D70 CALL	_delayms
(0750) 	beep(0,1);
    039E1 E021      LDI	R18,1
    039E2 2700      CLR	R16
    039E3 940E 4303 CALL	_beep
    039E5 9622      ADIW	R28,2
    039E6 9508      RET
_dateRefresh:
  readhardware         --> R20
    039E7 934A      ST	-Y,R20
    039E8 2F40      MOV	R20,R16
(0751) 	
(0752) }
(0753) 
(0754) ////////////////////////////////////
(0755) //  函数作用
(0756) //   将ds1302中缓存的时钟数据转换进结构体中
(0757) ////////////////////////////////////
(0758) void dateRefresh(unsigned char readhardware)
(0759) {	//readhardware = 0 not refresh, =1 refresh
(0760) 
(0761)  if( readhardware!=88 )	ds1302_read_time();
    039E9 3548      CPI	R20,0x58
    039EA F011      BEQ	0x39ED
    039EB 940E 4564 CALL	_ds1302_read_time
(0762) 	t.tm_sec=(((time_buf[6]&0x70)>>4)*10)+(time_buf[6]&0x0f);
    039ED 9110 0617 LDS	R17,time_buf+6
    039EF 7710      ANDI	R17,0x70
    039F0 9512      SWAP	R17
    039F1 701F      ANDI	R17,0xF
    039F2 E00A      LDI	R16,0xA
    039F3 0301      MULSU	R16,R17
    039F4 0110      MOVW	R2,R0
    039F5 9180 0617 LDS	R24,time_buf+6
    039F7 2799      CLR	R25
    039F8 708F      ANDI	R24,0xF
    039F9 7090      ANDI	R25,0
    039FA 0E28      ADD	R2,R24
    039FB 1E39      ADC	R3,R25
    039FC 9230 08CC STS	t+1,R3
    039FE 9220 08CB STS	t,R2
(0763) 	t.tm_min=  (((time_buf[5]&0x70)>>4)*10)+(time_buf[5]&0x0f);
    03A00 9110 0616 LDS	R17,time_buf+5
    03A02 7710      ANDI	R17,0x70
    03A03 9512      SWAP	R17
    03A04 701F      ANDI	R17,0xF
    03A05 0301      MULSU	R16,R17
    03A06 0110      MOVW	R2,R0
    03A07 9180 0616 LDS	R24,time_buf+5
    03A09 2799      CLR	R25
    03A0A 708F      ANDI	R24,0xF
    03A0B 7090      ANDI	R25,0
    03A0C 0E28      ADD	R2,R24
    03A0D 1E39      ADC	R3,R25
    03A0E 9230 08CE STS	t+3,R3
    03A10 9220 08CD STS	t+2,R2
(0764) 	t.tm_hour=  (((time_buf[4]&0x70)>>4)*10)+(time_buf[4]&0x0f);
    03A12 9110 0615 LDS	R17,time_buf+4
    03A14 7710      ANDI	R17,0x70
    03A15 9512      SWAP	R17
    03A16 701F      ANDI	R17,0xF
    03A17 0301      MULSU	R16,R17
    03A18 0110      MOVW	R2,R0
    03A19 9180 0615 LDS	R24,time_buf+4
    03A1B 2799      CLR	R25
    03A1C 708F      ANDI	R24,0xF
    03A1D 7090      ANDI	R25,0
    03A1E 0E28      ADD	R2,R24
    03A1F 1E39      ADC	R3,R25
    03A20 9230 08D0 STS	t+5,R3
    03A22 9220 08CF STS	t+4,R2
(0765) 	t.tm_mday=	(((time_buf[3]&0x70)>>4)*10)+(time_buf[3]&0x0f);
    03A24 9110 0614 LDS	R17,time_buf+3
    03A26 7710      ANDI	R17,0x70
    03A27 9512      SWAP	R17
    03A28 701F      ANDI	R17,0xF
    03A29 0301      MULSU	R16,R17
    03A2A 0110      MOVW	R2,R0
    03A2B 9180 0614 LDS	R24,time_buf+3
    03A2D 2799      CLR	R25
    03A2E 708F      ANDI	R24,0xF
    03A2F 7090      ANDI	R25,0
    03A30 0E28      ADD	R2,R24
    03A31 1E39      ADC	R3,R25
    03A32 9230 08D2 STS	t+7,R3
    03A34 9220 08D1 STS	t+6,R2
(0766) 	t.tm_mon= (((time_buf[2]&0x70)>>4)*10)+(time_buf[2]&0x0f);
    03A36 9110 0613 LDS	R17,time_buf+2
    03A38 7710      ANDI	R17,0x70
    03A39 9512      SWAP	R17
    03A3A 701F      ANDI	R17,0xF
    03A3B 0301      MULSU	R16,R17
    03A3C 0110      MOVW	R2,R0
    03A3D 9180 0613 LDS	R24,time_buf+2
    03A3F 2799      CLR	R25
    03A40 708F      ANDI	R24,0xF
    03A41 7090      ANDI	R25,0
    03A42 0E28      ADD	R2,R24
    03A43 1E39      ADC	R3,R25
    03A44 9230 08D4 STS	t+9,R3
    03A46 9220 08D3 STS	t+8,R2
(0767) 	t.tm_wday=	(time_buf[7]&0x0f);
    03A48 9180 0618 LDS	R24,time_buf+7
    03A4A 2799      CLR	R25
    03A4B 708F      ANDI	R24,0xF
    03A4C 7090      ANDI	R25,0
    03A4D 9390 08D8 STS	t+13,R25
    03A4F 9380 08D7 STS	t+12,R24
(0768)     t.tm_year=	(((time_buf[1]&0x70)>>4)*10)+(time_buf[1]&0x0f);
    03A51 9110 0612 LDS	R17,time_buf+1
    03A53 7710      ANDI	R17,0x70
    03A54 9512      SWAP	R17
    03A55 701F      ANDI	R17,0xF
    03A56 0301      MULSU	R16,R17
    03A57 0110      MOVW	R2,R0
    03A58 9180 0612 LDS	R24,time_buf+1
    03A5A 2799      CLR	R25
    03A5B 708F      ANDI	R24,0xF
    03A5C 7090      ANDI	R25,0
    03A5D 0E28      ADD	R2,R24
    03A5E 1E39      ADC	R3,R25
    03A5F 9230 08D6 STS	t+11,R3
    03A61 9220 08D5 STS	t+10,R2
(0769) 	if(readhardware != 0){
    03A63 2344      TST	R20
    03A64 F409      BNE	0x3A66
    03A65 C09F      RJMP	0x3B05
(0770) 	Result.Date[0]='2';
    03A66 E382      LDI	R24,0x32
    03A67 9380 0681 STS	Result+22,R24
(0771) 	Result.Date[1]='0';
    03A69 E380      LDI	R24,0x30
    03A6A 9380 0682 STS	Result+23,R24
(0772) 	Result.Date[2]=t.tm_year/10+'0';
    03A6C E02A      LDI	R18,0xA
    03A6D E030      LDI	R19,0
    03A6E 0181      MOVW	R16,R2
    03A6F 940E 4A7B CALL	div16s
    03A71 01C8      MOVW	R24,R16
    03A72 96C0      ADIW	R24,0x30
    03A73 9380 0683 STS	Result+24,R24
(0773) 	Result.Date[3]=t.tm_year%10+'0';
    03A75 E02A      LDI	R18,0xA
    03A76 E030      LDI	R19,0
    03A77 9100 08D5 LDS	R16,t+10
    03A79 9110 08D6 LDS	R17,t+11
    03A7B 940E 4A77 CALL	mod16s
    03A7D 01C8      MOVW	R24,R16
    03A7E 96C0      ADIW	R24,0x30
    03A7F 9380 0684 STS	Result+25,R24
(0774) 	Result.Date[4]=t.tm_mon/10+'0';
    03A81 E02A      LDI	R18,0xA
    03A82 E030      LDI	R19,0
    03A83 9100 08D3 LDS	R16,t+8
    03A85 9110 08D4 LDS	R17,t+9
    03A87 940E 4A7B CALL	div16s
    03A89 01C8      MOVW	R24,R16
    03A8A 96C0      ADIW	R24,0x30
    03A8B 9380 0685 STS	Result+26,R24
(0775) 	Result.Date[5]=t.tm_mon%10+'0';
    03A8D E02A      LDI	R18,0xA
    03A8E E030      LDI	R19,0
    03A8F 9100 08D3 LDS	R16,t+8
    03A91 9110 08D4 LDS	R17,t+9
    03A93 940E 4A77 CALL	mod16s
    03A95 01C8      MOVW	R24,R16
    03A96 96C0      ADIW	R24,0x30
    03A97 9380 0686 STS	Result+27,R24
(0776) 	Result.Date[6]=t.tm_mday/10+'0';
    03A99 E02A      LDI	R18,0xA
    03A9A E030      LDI	R19,0
    03A9B 9100 08D1 LDS	R16,t+6
    03A9D 9110 08D2 LDS	R17,t+7
    03A9F 940E 4A7B CALL	div16s
    03AA1 01C8      MOVW	R24,R16
    03AA2 96C0      ADIW	R24,0x30
    03AA3 9380 0687 STS	Result+28,R24
(0777) 	Result.Date[7]=t.tm_mday%10+'0';
    03AA5 E02A      LDI	R18,0xA
    03AA6 E030      LDI	R19,0
    03AA7 9100 08D1 LDS	R16,t+6
    03AA9 9110 08D2 LDS	R17,t+7
    03AAB 940E 4A77 CALL	mod16s
    03AAD 01C8      MOVW	R24,R16
    03AAE 96C0      ADIW	R24,0x30
    03AAF 9380 0688 STS	Result+29,R24
(0778)     Result.Date[8]='\0';
    03AB1 2422      CLR	R2
    03AB2 9220 0689 STS	Result+30,R2
(0779) 
(0780) 	Result.Time[0]=t.tm_hour/10+'0';
    03AB4 E02A      LDI	R18,0xA
    03AB5 E030      LDI	R19,0
    03AB6 9100 08CF LDS	R16,t+4
    03AB8 9110 08D0 LDS	R17,t+5
    03ABA 940E 4A7B CALL	div16s
    03ABC 01C8      MOVW	R24,R16
    03ABD 96C0      ADIW	R24,0x30
    03ABE 9380 068A STS	Result+31,R24
(0781) 	Result.Time[1]=t.tm_hour%10+'0';
    03AC0 E02A      LDI	R18,0xA
    03AC1 E030      LDI	R19,0
    03AC2 9100 08CF LDS	R16,t+4
    03AC4 9110 08D0 LDS	R17,t+5
    03AC6 940E 4A77 CALL	mod16s
    03AC8 01C8      MOVW	R24,R16
    03AC9 96C0      ADIW	R24,0x30
    03ACA 9380 068B STS	Result+32,R24
(0782) 	Result.Time[2]=':';
    03ACC E38A      LDI	R24,0x3A
    03ACD 9380 068C STS	Result+33,R24
(0783) 	//Result.Time[3]=' ';
(0784) 	Result.Time[3]=t.tm_min/10+'0';
    03ACF E02A      LDI	R18,0xA
    03AD0 E030      LDI	R19,0
    03AD1 9100 08CD LDS	R16,t+2
    03AD3 9110 08CE LDS	R17,t+3
    03AD5 940E 4A7B CALL	div16s
    03AD7 01C8      MOVW	R24,R16
    03AD8 96C0      ADIW	R24,0x30
    03AD9 9380 068D STS	Result+34,R24
(0785) 	Result.Time[4]=t.tm_min%10+'0';
    03ADB E02A      LDI	R18,0xA
    03ADC E030      LDI	R19,0
    03ADD 9100 08CD LDS	R16,t+2
    03ADF 9110 08CE LDS	R17,t+3
    03AE1 940E 4A77 CALL	mod16s
    03AE3 01C8      MOVW	R24,R16
    03AE4 96C0      ADIW	R24,0x30
    03AE5 9380 068E STS	Result+35,R24
(0786) 	Result.Time[5]=':';
    03AE7 E38A      LDI	R24,0x3A
    03AE8 9380 068F STS	Result+36,R24
(0787) 	//Result.Time[7]=' ';
(0788) 	Result.Time[6]=t.tm_sec/10+'0';
    03AEA E02A      LDI	R18,0xA
    03AEB E030      LDI	R19,0
    03AEC 9100 08CB LDS	R16,t
    03AEE 9110 08CC LDS	R17,t+1
    03AF0 940E 4A7B CALL	div16s
    03AF2 01C8      MOVW	R24,R16
    03AF3 96C0      ADIW	R24,0x30
    03AF4 9380 0690 STS	Result+37,R24
(0789) 	Result.Time[7]=t.tm_sec%10+'0';
    03AF6 E02A      LDI	R18,0xA
    03AF7 E030      LDI	R19,0
    03AF8 9100 08CB LDS	R16,t
    03AFA 9110 08CC LDS	R17,t+1
    03AFC 940E 4A77 CALL	mod16s
    03AFE 01C8      MOVW	R24,R16
    03AFF 96C0      ADIW	R24,0x30
    03B00 9380 0691 STS	Result+38,R24
(0790) 	Result.Time[8]='\0'; 
    03B02 2422      CLR	R2
    03B03 9220 0692 STS	Result+39,R2
(0791) 	}
(0792)     config.now =t.tm_hour*3600 + t.tm_min*60 + t.tm_sec; //更新系统心跳
    03B05 9120 08CD LDS	R18,t+2
    03B07 9130 08CE LDS	R19,t+3
    03B09 E30C      LDI	R16,0x3C
    03B0A E010      LDI	R17,0
    03B0B 940E 4B47 CALL	empy16s
    03B0D 0118      MOVW	R2,R16
    03B0E 9120 08CF LDS	R18,t+4
    03B10 9130 08D0 LDS	R19,t+5
    03B12 E100      LDI	R16,0x10
    03B13 E01E      LDI	R17,0xE
    03B14 940E 4B47 CALL	empy16s
    03B16 0128      MOVW	R4,R16
    03B17 0C42      ADD	R4,R2
    03B18 1C53      ADC	R5,R3
    03B19 9020 08CB LDS	R2,t
    03B1B 9030 08CC LDS	R3,t+1
    03B1D 0C42      ADD	R4,R2
    03B1E 1C53      ADC	R5,R3
    03B1F 0112      MOVW	R2,R4
    03B20 2444      CLR	R4
    03B21 FC37      SBRC	R3,7
    03B22 9440      COM	R4
    03B23 2455      CLR	R5
    03B24 FC47      SBRC	R4,7
    03B25 9450      COM	R5
    03B26 9230 08E9 STS	config+12,R3
    03B28 9220 08E8 STS	config+11,R2
    03B2A 9250 08EB STS	config+14,R5
    03B2C 9240 08EA STS	config+13,R4
    03B2E 9149      LD	R20,Y+
    03B2F 9508      RET
FILE: D:\LQD\software\software_src\zigbee.c
(0001) /*  此文件定义了从机zigbee的模块自检 及 与上位机通信的相关函数
(0002) *   版本 V1.0
(0003) *   日期 2012 08 10
(0004) *   版本历史：
(0005) * 数据格式
(0006) * 帧头    长度    目的地址   命令  内容     校验    帧尾
(0007) * FA       AA      B1        D1    01 03    00 00    fb  
(0008) *
(0009) *
(0010) *
(0011) ************/
(0012) #include "config.h"
(0013) 
(0014) #ifndef _DEVICE_INFOMATION_
(0015) #define _DEVICE_INFOMATION_
(0016) //设备相关信息 可存进EEPROM 调试阶段暂时做成全局常量
(0017) 
(0018) const char CommonId = 0xFF; //从设备公共ID
(0019) /***************配置设备ID***************/
(0020) #define _DEVICE_ID 1
(0021) /**************************************/
(0022) #if   _DEVICE_ID == 1 
(0023) char devicename[8] = {"DEV00001"};//设备名称
(0024) const char deviceId = 0xB1;//设备ID		
(0025) #elif  _DEVICE_ID == 2 
(0026) char devicename[8] = {"DEV000002"};//设备名称
(0027) const char deviceId = 0xB2;//设备ID		
(0028) #elif  _DEVICE_ID == 3  
(0029) char devicename[8] = {"DEV000003"};//设备名称
(0030) const char deviceId = 0xB3;//设备ID		
(0031) #elif  _DEVICE_ID == 4  
(0032) char devicename[8] = {"DEV000004"};//设备名称
(0033) const char deviceId = 0xB4;//设备ID		
(0034) #elif  _DEVICE_ID == 5  
(0035) char devicename[8] = {"DEV000005"};//设备名称
(0036) const char deviceId = 0xB5;//设备ID		
(0037) #elif  _DEVICE_ID == 6  
(0038) char devicename[8] = {"DEV000006"};//设备名称
(0039) const char deviceId = 0xB6;//设备ID		
(0040) #endif
(0041) 
(0042) //char *reslut_a ="Dev000001,0001,20120920,12:00,-40.5,12.3,-55.5,-40.4,-40.3";
(0043) 
(0044) //char *p2 = "a123456789b12456789c123456789d123456789e123456789f12456789g123456789h12345789i12456789";
(0045) #endif
(0046)  
(0047) 
(0048) #define FRAME_LEN     13
(0049) #define STORAGE_DB_AND_SD  0
(0050) #define STORAGE_DB		   1
(0051) #define STORAGE_SD		   2
(0052) #define Z_CMD0 0xD0   
(0053) //命令0 响应查找从机命令
(0054) 
(0055) #define Z_CMD1_DATE 0xD1
(0056) //命令1 发送 采样日期  Result.Date
(0057) 
(0058) #define Z_CMD2_TIME 0xD2
(0059) //命令2 发送 采样时间  Result.Time
(0060) 
(0061) #define Z_CMD3_TEMPERATURE 0xD3
(0062) //命令3 发送 温度
(0063) 
(0064) #define Z_CMD4_WS 0xD4
(0065) //命令4 发送风速
(0066) 
(0067) #define Z_CMD5_WCI 0xD5
(0068) //命令5 发送WCI
(0069) 
(0070) #define Z_CMD6_ETC 0xD6
(0071) //命令6 发送ETC
(0072) 
(0073) #define Z_CMD7_TEQ 0xD7
(0074) //命令7 发送TEQ
(0075) 
(0076) #define Z_CMD8_OTHER 0xD8
(0077) //命令8 发送冻伤危害性和轻、重、中四个字节的数据
(0078) 
(0079) #define Z_CMD9_SINGLE 0xD9
(0080) //命令09 单次检测
(0081) 
(0082) #define Z_CMD10_CYCLE 0xDA
(0083) //命令10 循环检测
(0084) 
(0085) #define Z_CMD11_STOP 0xDB
(0086) //命令11 中止检测
(0087) 
(0088) #define Z_CMD12_SYNC 0xDC
(0089) //命令12 同步时钟
(0090) 
(0091) #define Z_CMD13_GET_DATA 0xDD
(0092) //命令13 请求数据
(0093) 
(0094) #define Z_CMD14_SET_STORAGE 0xDE
(0095) //命令9 设置存储位置
(0096) 
(0097) struct buffer_struct Rec;
(0098) //缓存池 Buf[100] ;
(0099) //读缓存指针BufReadP;
(0100) //写缓存指针BufWriteP;
(0101) //当前缓存个数 BufCount;
(0102) 
(0103) //struct SendStruct Send; 
(0104) 
(0105) void zigbee_init( void )
(0106) {
(0107)   Rec.BufReadP=0;
_zigbee_init:
    03B30 2422      CLR	R2
    03B31 9220 0951 STS	Rec+90,R2
(0108)   Rec.BufWriteP=0;
    03B33 9220 0952 STS	Rec+91,R2
(0109)   Rec.BufCount=0;
    03B35 9220 0953 STS	Rec+92,R2
    03B37 9508      RET
(0110) }
(0111) unsigned char RecAdd(unsigned char ByteRec)
(0112) {
(0113)   if (Rec.BufWriteP >= BufSize)  
_RecAdd:
  ByteRec              --> R16
    03B38 9180 0952 LDS	R24,Rec+91
    03B3A 358A      CPI	R24,0x5A
    03B3B F018      BCS	0x3B3F
(0114)   	 Rec.BufWriteP=0;
    03B3C 2422      CLR	R2
    03B3D 9220 0952 STS	Rec+91,R2
(0115)   Rec.Buf[Rec.BufWriteP++] = ByteRec ;
    03B3F 9020 0952 LDS	R2,Rec+91
    03B41 2D82      MOV	R24,R2
    03B42 5F8F      SUBI	R24,0xFF
    03B43 9380 0952 STS	Rec+91,R24
    03B45 EF87      LDI	R24,0xF7
    03B46 E098      LDI	R25,0x8
    03B47 2DE2      MOV	R30,R2
    03B48 27FF      CLR	R31
    03B49 0FE8      ADD	R30,R24
    03B4A 1FF9      ADC	R31,R25
    03B4B 8300      ST	Z,R16
(0116)   Rec.BufCount++;
    03B4C 9180 0953 LDS	R24,Rec+92
    03B4E 5F8F      SUBI	R24,0xFF
    03B4F 9380 0953 STS	Rec+92,R24
(0117)   return Rec.BufWriteP;
    03B51 9100 0952 LDS	R16,Rec+91
    03B53 9508      RET
_RecRemove:
  N                    --> R10
    03B54 92AA      ST	-Y,R10
    03B55 2EA0      MOV	R10,R16
(0118) } 
(0119) 
(0120) void RecRemove(char N)
(0121) { 
(0122)   if(Rec.BufCount >= N ) 
    03B56 9020 0953 LDS	R2,Rec+92
    03B58 142A      CP	R2,R10
    03B59 F168      BCS	0x3B87
(0123)   {  debug("DEL=",Rec.Buf[Rec.BufReadP]);
    03B5A EF87      LDI	R24,0xF7
    03B5B E098      LDI	R25,0x8
    03B5C 91E0 0951 LDS	R30,Rec+90
    03B5E 27FF      CLR	R31
    03B5F 0FE8      ADD	R30,R24
    03B60 1FF9      ADC	R31,R25
    03B61 8120      LD	R18,Z
    03B62 EF00      LDI	R16,0xF0
    03B63 E015      LDI	R17,5
    03B64 940E 0BE6 CALL	_debug
(0124)      Rec.Buf[Rec.BufReadP]=0x00; 
    03B66 EF87      LDI	R24,0xF7
    03B67 E098      LDI	R25,0x8
    03B68 91E0 0951 LDS	R30,Rec+90
    03B6A 27FF      CLR	R31
    03B6B 0FE8      ADD	R30,R24
    03B6C 1FF9      ADC	R31,R25
    03B6D 2422      CLR	R2
    03B6E 8220      ST	Z,R2
(0125)    	 Rec.BufReadP=Rec.BufReadP+N;
    03B6F 9020 0951 LDS	R2,Rec+90
    03B71 0C2A      ADD	R2,R10
    03B72 9220 0951 STS	Rec+90,R2
(0126) 	 if(Rec.BufReadP >= BufSize) {
    03B74 2D82      MOV	R24,R2
    03B75 358A      CPI	R24,0x5A
    03B76 F018      BCS	0x3B7A
(0127) 	 				 		 Rec.BufReadP =Rec.BufReadP-BufSize;
    03B77 558A      SUBI	R24,0x5A
    03B78 9380 0951 STS	Rec+90,R24
(0128) 							 }
(0129) 	 Rec.BufCount=Rec.BufCount-N;
    03B7A 9020 0953 LDS	R2,Rec+92
    03B7C 182A      SUB	R2,R10
    03B7D 9220 0953 STS	Rec+92,R2
(0130) 	 if(Rec.BufCount==0) {
    03B7F 2022      TST	R2
    03B80 F469      BNE	0x3B8E
(0131) 	 Rec.BufReadP=0;
    03B81 2422      CLR	R2
    03B82 9220 0951 STS	Rec+90,R2
(0132)      Rec.BufWriteP=0;
    03B84 9220 0952 STS	Rec+91,R2
(0133) 	 
(0134) 	 }
(0135) 	 
(0136)   }
    03B86 C007      RJMP	0x3B8E
(0137)   else 
(0138)   {  //移除量大于现有量 移除所有 计数清零
(0139)     Rec.BufReadP=0;
    03B87 2422      CLR	R2
    03B88 9220 0951 STS	Rec+90,R2
(0140)     Rec.BufWriteP=0;
    03B8A 9220 0952 STS	Rec+91,R2
(0141)     Rec.BufCount=0;
    03B8C 9220 0953 STS	Rec+92,R2
(0142)   
(0143)   }
    03B8E 90A9      LD	R10,Y+
    03B8F 9508      RET
_RecRead:
  tmp                  --> R20
  index                --> R16
    03B90 934A      ST	-Y,R20
    03B91 935A      ST	-Y,R21
(0144)  }
(0145) char  RecRead(unsigned char index)
(0146) { 
(0147)   int tmp;
(0148)   if(Rec.BufCount < index) 
    03B92 9020 0953 LDS	R2,Rec+92
    03B94 1620      CP	R2,R16
    03B95 F410      BCC	0x3B98
(0149)   	return 0;
    03B96 2700      CLR	R16
    03B97 C013      RJMP	0x3BAB
(0150) 	
(0151)   tmp=Rec.BufReadP+index;
    03B98 2E20      MOV	R2,R16
    03B99 2433      CLR	R3
    03B9A 9140 0951 LDS	R20,Rec+90
    03B9C 2755      CLR	R21
    03B9D 0D42      ADD	R20,R2
    03B9E 1D53      ADC	R21,R3
(0152)   if(tmp>=BufSize)  {tmp=tmp-BufSize;}
    03B9F 354A      CPI	R20,0x5A
    03BA0 E0E0      LDI	R30,0
    03BA1 075E      CPC	R21,R30
    03BA2 F014      BLT	0x3BA5
    03BA3 554A      SUBI	R20,0x5A
    03BA4 4050      SBCI	R21,0
(0153)   return Rec.Buf[tmp-1];
    03BA5 EF86      LDI	R24,0xF6
    03BA6 E098      LDI	R25,0x8
    03BA7 01FA      MOVW	R30,R20
    03BA8 0FE8      ADD	R30,R24
    03BA9 1FF9      ADC	R31,R25
    03BAA 8100      LD	R16,Z
    03BAB 9159      LD	R21,Y+
    03BAC 9149      LD	R20,Y+
    03BAD 9508      RET
_CheckCRC:
  i                    --> Y,+0
    03BAE 931A      ST	-Y,R17
    03BAF 930A      ST	-Y,R16
(0154) } 
(0155) 
(0156) 
(0157) char CheckCRC(unsigned char i)
(0158) {
(0159)  i=i;
(0160)  return 1;  //校验成功
    03BB0 E001      LDI	R16,1
    03BB1 9622      ADIW	R28,2
    03BB2 9508      RET
_RecDeal:
  buf                  --> Y,+1
  state                --> R20
  tmp                  --> R10
  i                    --> R22
    03BB3 940E 4BCA CALL	push_xgsetF00C
    03BB5 9726      SBIW	R28,6
(0161) 
(0162) }
(0163) #define res Result
(0164)  //1 找头 2找长度 3计算尾 4找尾 5核对校验码 6分析命令 7执行操作
(0165) unsigned char RecDeal( void )
(0166) { 
(0167)   int i=0 , tmp=0, state=0 ;
    03BB6 24AA      CLR	R10
    03BB7 24BB      CLR	R11
    03BB8 2744      CLR	R20
    03BB9 2755      CLR	R21
(0168)   char buf[5];
(0169)   //[TASK :找帧头]
(0170)   for(i=0;i <= Rec.BufCount ; i++ ){ 
    03BBA 2766      CLR	R22
    03BBB 2777      CLR	R23
    03BBC C013      RJMP	0x3BD0
(0171)       tmp = RecRead(1);    //读出当前值
    03BBD E001      LDI	R16,1
    03BBE DFD1      RCALL	_RecRead
    03BBF 2EA0      MOV	R10,R16
    03BC0 24BB      CLR	R11
(0172) 	  if(tmp != FRAME_HEAD ) {
    03BC1 01C5      MOVW	R24,R10
    03BC2 3F8A      CPI	R24,0xFA
    03BC3 E0E0      LDI	R30,0
    03BC4 079E      CPC	R25,R30
    03BC5 F029      BEQ	0x3BCB
(0173) 	      state = 1; //已查找无帧头
    03BC6 E041      LDI	R20,1
    03BC7 E050      LDI	R21,0
(0174) 		  RecRemove(1);
    03BC8 E001      LDI	R16,1
    03BC9 DF8A      RCALL	_RecRemove
(0175) 	  }		  
    03BCA C003      RJMP	0x3BCE
(0176) 	  else{	  //已找到帧头 跳出循环
(0177)       state = 2 ;  //已找到帧头 标志	 
    03BCB E042      LDI	R20,2
    03BCC E050      LDI	R21,0
(0178) 	  break ;
    03BCD C008      RJMP	0x3BD6
    03BCE 5F6F      SUBI	R22,0xFF
    03BCF 4F7F      SBCI	R23,0xFF
    03BD0 9020 0953 LDS	R2,Rec+92
    03BD2 2433      CLR	R3
    03BD3 1626      CP	R2,R22
    03BD4 0637      CPC	R3,R23
    03BD5 F73C      BGE	0x3BBD
(0179) 	  }
(0180)  }		
(0181)  
(0182)  if(Rec.BufCount < FRAME_LEN) return 0x01;  //缓冲区数据太少  直接返回
    03BD6 9180 0953 LDS	R24,Rec+92
    03BD8 308D      CPI	R24,0xD
    03BD9 F410      BCC	0x3BDC
    03BDA E001      LDI	R16,1
    03BDB C0B3      RJMP	0x3C8F
(0183)  
(0184)  if(state == 1 || Rec.BufCount< FRAME_LEN ) return 0x03; //退出函数  无帧头
    03BDC 3041      CPI	R20,1
    03BDD E0E0      LDI	R30,0
    03BDE 075E      CPC	R21,R30
    03BDF F021      BEQ	0x3BE4
    03BE0 9180 0953 LDS	R24,Rec+92
    03BE2 308D      CPI	R24,0xD
    03BE3 F410      BCC	0x3BE6
    03BE4 E003      LDI	R16,3
    03BE5 C0A9      RJMP	0x3C8F
(0185)  //debug("#FRAME END =",RecRead(FRAME_LEN));
(0186)  //debug("#RECREAD(3) =",RecRead(3));
(0187)  if(RecRead(FRAME_LEN) != FRAME_END || ((RecRead(3)!=deviceId)&& (RecRead(3)!=CommonId) )  )  //非成帧数据或ID不符
    03BE6 E00D      LDI	R16,0xD
    03BE7 DFA8      RCALL	_RecRead
    03BE8 3F0B      CPI	R16,0xFB
    03BE9 F471      BNE	0x3BF8
    03BEA E003      LDI	R16,3
    03BEB DFA4      RCALL	_RecRead
    03BEC 2EA0      MOV	R10,R16
    03BED 9020 05EF LDS	R2,deviceId
    03BEF 1502      CP	R16,R2
    03BF0 F059      BEQ	0x3BFC
    03BF1 E003      LDI	R16,3
    03BF2 DF9D      RCALL	_RecRead
    03BF3 2EA0      MOV	R10,R16
    03BF4 9020 05E6 LDS	R2,CommonId
    03BF6 1502      CP	R16,R2
    03BF7 F021      BEQ	0x3BFC
(0188)  {
(0189)     RecRemove(1);	//移除命令
    03BF8 E001      LDI	R16,1
    03BF9 DF5A      RCALL	_RecRemove
(0190)     return 0x05;    //非成帧数据 或ID不符
    03BFA E005      LDI	R16,5
    03BFB C093      RJMP	0x3C8F
(0191)  }
(0192)  else if((CheckCRC(FRAME_LEN)==1))   //校验通过
    03BFC E00D      LDI	R16,0xD
    03BFD DFB0      RCALL	_CheckCRC
    03BFE 2F40      MOV	R20,R16
    03BFF 3001      CPI	R16,1
    03C00 F009      BEQ	0x3C02
    03C01 C088      RJMP	0x3C8A
(0193)  {
(0194)      switch(RecRead(4)){
    03C02 E004      LDI	R16,4
    03C03 DF8C      RCALL	_RecRead
    03C04 2EA0      MOV	R10,R16
    03C05 2D4A      MOV	R20,R10
    03C06 2755      CLR	R21
    03C07 3D40      CPI	R20,0xD0
    03C08 E0E0      LDI	R30,0
    03C09 075E      CPC	R21,R30
    03C0A F40C      BGE	0x3C0C
    03C0B C07C      RJMP	0x3C88
    03C0C ED8E      LDI	R24,0xDE
    03C0D E090      LDI	R25,0
    03C0E 1784      CP	R24,R20
    03C0F 0795      CPC	R25,R21
    03C10 F40C      BGE	0x3C12
    03C11 C076      RJMP	0x3C88
    03C12 E88C      LDI	R24,0x8C
    03C13 E090      LDI	R25,0
    03C14 01FA      MOVW	R30,R20
    03C15 5DE0      SUBI	R30,0xD0
    03C16 40F0      SBCI	R31,0
    03C17 0FEE      LSL	R30
    03C18 1FFF      ROL	R31
    03C19 0FE8      ADD	R30,R24
    03C1A 1FF9      ADC	R31,R25
    03C1B 9027      ELPM	R2,Z+
    03C1C 9036      ELPM	R3,Z
    03C1D 01F1      MOVW	R30,R2
    03C1E 9409      IJMP
(0195)          case Z_CMD0 :  //发送设备信息
(0196) 		 Send_string((char *)devicename,Z_CMD0,sizeof(devicename));
    03C1F E088      LDI	R24,0x8
    03C20 8388      ST	Y,R24
    03C21 ED20      LDI	R18,0xD0
    03C22 EE07      LDI	R16,0xE7
    03C23 E015      LDI	R17,5
    03C24 D06D      RCALL	_Send_string
(0197) 		 RecRemove(12);
    03C25 E00C      LDI	R16,0xC
    03C26 DF2D      RCALL	_RecRemove
(0198) 	     return Z_CMD0;  //发送完成 返回成功
    03C27 ED00      LDI	R16,0xD0
    03C28 C066      RJMP	0x3C8F
(0199) 		 break ;
(0200)   		
(0201) 		 case Z_CMD1_DATE :  //发送日期
(0202) 		 Send_string(res.Date, Z_CMD1_DATE, 9);
    03C29 E089      LDI	R24,0x9
    03C2A 8388      ST	Y,R24
    03C2B ED21      LDI	R18,0xD1
    03C2C E801      LDI	R16,0x81
    03C2D E016      LDI	R17,6
    03C2E D063      RCALL	_Send_string
(0203) 		 return Z_CMD1_DATE;  //发送完成 返回成功
    03C2F ED01      LDI	R16,0xD1
    03C30 C05E      RJMP	0x3C8F
(0204) 		 break ;	
(0205) 		 
(0206) 		 case Z_CMD2_TIME :  //发送Time
(0207) 		 Send_string(res.Time, Z_CMD2_TIME, 10);
    03C31 E08A      LDI	R24,0xA
    03C32 8388      ST	Y,R24
    03C33 ED22      LDI	R18,0xD2
    03C34 E80A      LDI	R16,0x8A
    03C35 E016      LDI	R17,6
    03C36 D05B      RCALL	_Send_string
(0208) 		 return Z_CMD2_TIME;  //发送完成 返回成功
    03C37 ED02      LDI	R16,0xD2
    03C38 C056      RJMP	0x3C8F
(0209) 		 break ;	
(0210) 		 
(0211) 		 case Z_CMD3_TEMPERATURE :  //发送温度
(0212) 		 Send_string(res.TempChar, Z_CMD3_TEMPERATURE, 6);
    03C39 E086      LDI	R24,6
    03C3A 8388      ST	Y,R24
    03C3B ED23      LDI	R18,0xD3
    03C3C E908      LDI	R16,0x98
    03C3D E016      LDI	R17,6
    03C3E D053      RCALL	_Send_string
(0213) 		 return Z_CMD3_TEMPERATURE;  //发送完成 返回成功
    03C3F ED03      LDI	R16,0xD3
    03C40 C04E      RJMP	0x3C8F
(0214) 		 break ;	
(0215) 		 
(0216) 		 case Z_CMD4_WS :  //发送WSChar
(0217) 		 Send_string(res.WSChar, Z_CMD4_WS, 5);
    03C41 E085      LDI	R24,5
    03C42 8388      ST	Y,R24
    03C43 ED24      LDI	R18,0xD4
    03C44 EA02      LDI	R16,0xA2
    03C45 E016      LDI	R17,6
    03C46 D04B      RCALL	_Send_string
(0218) 		 return Z_CMD4_WS;  //发送完成 返回成功
    03C47 ED04      LDI	R16,0xD4
    03C48 C046      RJMP	0x3C8F
(0219) 		 break ;			 
(0220) 		 
(0221) 		 case Z_CMD5_WCI :  //发送WCIChar
(0222) 		 Send_string(res.WCIChar, Z_CMD5_WCI ,8);
    03C49 E088      LDI	R24,0x8
    03C4A 8388      ST	Y,R24
    03C4B ED25      LDI	R18,0xD5
    03C4C EA0B      LDI	R16,0xAB
    03C4D E016      LDI	R17,6
    03C4E D043      RCALL	_Send_string
(0223) 		 return Z_CMD5_WCI;  //发送完成 返回成功
    03C4F ED05      LDI	R16,0xD5
    03C50 C03E      RJMP	0x3C8F
(0224) 		 break ;	
(0225) 		 
(0226) 		 case Z_CMD6_ETC :  //ECTChar
(0227) 		 Send_string(res.ECTChar, Z_CMD6_ETC ,6);
    03C51 E086      LDI	R24,6
    03C52 8388      ST	Y,R24
    03C53 ED26      LDI	R18,0xD6
    03C54 EB07      LDI	R16,0xB7
    03C55 E016      LDI	R17,6
    03C56 D03B      RCALL	_Send_string
(0228) 		 return Z_CMD6_ETC;  //发送完成 返回成功
    03C57 ED06      LDI	R16,0xD6
    03C58 C036      RJMP	0x3C8F
(0229) 		 break ;		
(0230) 		 
(0231) 		 case Z_CMD7_TEQ :  //发送TeqCharres.TeqChar
(0232) 		 Send_string(res.TeqChar, Z_CMD7_TEQ ,6);
    03C59 E086      LDI	R24,6
    03C5A 8388      ST	Y,R24
    03C5B ED27      LDI	R18,0xD7
    03C5C EC01      LDI	R16,0xC1
    03C5D E016      LDI	R17,6
    03C5E D033      RCALL	_Send_string
(0233) 		 return Z_CMD7_TEQ;  //发送完成 返回成功
    03C5F ED07      LDI	R16,0xD7
    03C60 C02E      RJMP	0x3C8F
(0234) 		 break ;	 
(0235) 		 
(0236) 		 case Z_CMD8_OTHER :  //发送日期
(0237) 		 buf[0]= res.WeiHai + 0x30;
    03C61 9180 06C7 LDS	R24,Result+92
    03C63 5D80      SUBI	R24,0xD0
    03C64 8389      STD	Y+1,R24
(0238) 		 buf[1]= res.LowLabor + 0x30;
    03C65 9180 06C8 LDS	R24,Result+93
    03C67 5D80      SUBI	R24,0xD0
    03C68 838A      STD	Y+2,R24
(0239) 		 buf[2]= res.MidLabor + 0x30;
    03C69 9180 06C9 LDS	R24,Result+94
    03C6B 5D80      SUBI	R24,0xD0
    03C6C 838B      STD	Y+3,R24
(0240) 		 buf[3]= res.HighLabor + 0x30;
    03C6D 9180 06CA LDS	R24,Result+95
    03C6F 5D80      SUBI	R24,0xD0
    03C70 838C      STD	Y+4,R24
(0241) 		 buf[4]= 0;
    03C71 2422      CLR	R2
    03C72 822D      STD	Y+5,R2
(0242) 		 Send_string(buf, Z_CMD8_OTHER, 4);
    03C73 E084      LDI	R24,4
    03C74 8388      ST	Y,R24
    03C75 ED28      LDI	R18,0xD8
    03C76 018E      MOVW	R16,R28
    03C77 5F0F      SUBI	R16,0xFF
    03C78 4F1F      SBCI	R17,0xFF
    03C79 D018      RCALL	_Send_string
(0243) 		 return Z_CMD8_OTHER;  //发送完成 返回成功
    03C7A ED08      LDI	R16,0xD8
    03C7B C013      RJMP	0x3C8F
(0244) 		 break ;
(0245) 		 
(0246) 		 case Z_CMD9_SINGLE:
(0247) 		 	  config.comCmd = 0x01; //sigle――check
    03C7C E081      LDI	R24,1
    03C7D 9380 08F2 STS	config+21,R24
(0248) 		 break;
    03C7F C00E      RJMP	0x3C8E
(0249) 		 
(0250) 		 case Z_CMD10_CYCLE:
(0251) 		 	  config.comCmd = 0x02; //cycle check.
    03C80 E082      LDI	R24,2
    03C81 9380 08F2 STS	config+21,R24
(0252) //			  config.checkDeltaTime
(0253) 		 break;
    03C83 C00A      RJMP	0x3C8E
(0254) 		 
(0255) 		 case Z_CMD11_STOP:
(0256) 		      config.comCmd = 0x03; //stop check 
    03C84 E083      LDI	R24,3
    03C85 9380 08F2 STS	config+21,R24
(0257) 		 break;
    03C87 C006      RJMP	0x3C8E
(0258) 		 
(0259) 		 case Z_CMD12_SYNC:
(0260) 		 break;
(0261) 		 
(0262) 		 case Z_CMD13_GET_DATA:
(0263) 		 break;
(0264) 		 
(0265) 		 case Z_CMD14_SET_STORAGE:
(0266) 		 break;
(0267) 		 
(0268) 		 default:    
(0269) 	     return 0xff;			   
    03C88 EF0F      LDI	R16,0xFF
    03C89 C005      RJMP	0x3C8F
(0270)      }
(0271)  } 
(0272)  else { //校验不成功 丢弃帧头 寻找下一帧头
(0273)   RecRemove(1);  //丢弃帧头
    03C8A E001      LDI	R16,1
    03C8B DEC8      RCALL	_RecRemove
(0274)   return 0xff;
    03C8C EF0F      LDI	R16,0xFF
    03C8D C001      RJMP	0x3C8F
(0275)  }
(0276) return 0xff;
    03C8E EF0F      LDI	R16,0xFF
    03C8F 9626      ADIW	R28,6
    03C90 940C 4BD1 JMP	pop_xgsetF00C
_Send_string:
  sendBuf              --> Y,+0
  i                    --> R20
  MaxLen               --> R12
  cmd                  --> R14
  buf                  --> R10
    03C92 940E 4BAD CALL	push_xgset30FC
    03C94 2EE2      MOV	R14,R18
    03C95 0158      MOVW	R10,R16
    03C96 97EF      SBIW	R28,0x3F
    03C97 9721      SBIW	R28,1
    03C98 01FE      MOVW	R30,R28
    03C99 5BE8      SUBI	R30,0xB8
    03C9A 4FFF      SBCI	R31,0xFF
    03C9B 80C0      LD	R12,Z
(0277) }
(0278) void Send_string(char *buf, unsigned char cmd, unsigned char MaxLen){
(0279) 	 char i = 0;
(0280) 	 
(0281) 	 unsigned char sendBuf[64];
(0282) 	 sendBuf[0] = FRAME_HEAD;
    03C9C EF8A      LDI	R24,0xFA
    03C9D 8388      ST	Y,R24
(0283) 	 sendBuf[1] = 0;
    03C9E 2422      CLR	R2
    03C9F 8229      STD	Y+1,R2
(0284) 	 sendBuf[2] = 0x00; //主机地址
    03CA0 822A      STD	Y+2,R2
(0285) 	 sendBuf[3] = deviceId;//Send.src; //本机地址
    03CA1 9020 05EF LDS	R2,deviceId
    03CA3 822B      STD	Y+3,R2
(0286) 	 sendBuf[4] = cmd; //
    03CA4 82EC      STD	Y+4,R14
(0287) 	 for(i=0;i<MaxLen;i++){
    03CA5 2744      CLR	R20
    03CA6 C014      RJMP	0x3CBB
(0288) 	     if( *(buf+i) != 0 ){
    03CA7 2FE4      MOV	R30,R20
    03CA8 27FF      CLR	R31
    03CA9 0DEA      ADD	R30,R10
    03CAA 1DFB      ADC	R31,R11
    03CAB 8020      LD	R2,Z
    03CAC 2022      TST	R2
    03CAD F079      BEQ	0x3CBD
(0289) 		 	 sendBuf[i+5] = *(buf+i);
    03CAE 2FE4      MOV	R30,R20
    03CAF 27FF      CLR	R31
    03CB0 0DEA      ADD	R30,R10
    03CB1 1DFB      ADC	R31,R11
    03CB2 8020      LD	R2,Z
    03CB3 01CE      MOVW	R24,R28
    03CB4 9605      ADIW	R24,5
    03CB5 2FE4      MOV	R30,R20
    03CB6 27FF      CLR	R31
    03CB7 0FE8      ADD	R30,R24
    03CB8 1FF9      ADC	R31,R25
    03CB9 8220      ST	Z,R2
    03CBA 9543      INC	R20
    03CBB 154C      CP	R20,R12
    03CBC F350      BCS	0x3CA7
(0290) 		 }
(0291) 		 else { 
(0292) 		 break;
(0293) 		 }
(0294) 	 }
(0295) 	 i=i+5;
    03CBD 5F4B      SUBI	R20,0xFB
(0296) 	 sendBuf[i++] = 0xCC;
    03CBE 2E24      MOV	R2,R20
    03CBF 2433      CLR	R3
    03CC0 5F4F      SUBI	R20,0xFF
    03CC1 01CE      MOVW	R24,R28
    03CC2 2DE2      MOV	R30,R2
    03CC3 27FF      CLR	R31
    03CC4 0FE8      ADD	R30,R24
    03CC5 1FF9      ADC	R31,R25
    03CC6 EC8C      LDI	R24,0xCC
    03CC7 8380      ST	Z,R24
(0297) 	 sendBuf[i++] = 0xCC;
    03CC8 2E24      MOV	R2,R20
    03CC9 2433      CLR	R3
    03CCA 5F4F      SUBI	R20,0xFF
    03CCB 01CE      MOVW	R24,R28
    03CCC 2DE2      MOV	R30,R2
    03CCD 27FF      CLR	R31
    03CCE 0FE8      ADD	R30,R24
    03CCF 1FF9      ADC	R31,R25
    03CD0 EC8C      LDI	R24,0xCC
    03CD1 8380      ST	Z,R24
(0298) 	 sendBuf[i] = FRAME_END;
    03CD2 01CE      MOVW	R24,R28
    03CD3 2FE4      MOV	R30,R20
    03CD4 27FF      CLR	R31
    03CD5 0FE8      ADD	R30,R24
    03CD6 1FF9      ADC	R31,R25
    03CD7 EF8B      LDI	R24,0xFB
    03CD8 8380      ST	Z,R24
(0299) 	 sendBuf[1] = i+1;
    03CD9 2F84      MOV	R24,R20
    03CDA 5F8F      SUBI	R24,0xFF
    03CDB 8389      STD	Y+1,R24
(0300) 	 delayms((deviceId-0xB1)*1);  //不同设备延时不同时间发送数据，避免碰撞
    03CDC 9110 05EF LDS	R17,deviceId
    03CDE E001      LDI	R16,1
    03CDF 0301      MULSU	R16,R17
    03CE0 0180      MOVW	R16,R0
    03CE1 5B01      SUBI	R16,0xB1
    03CE2 4010      SBCI	R17,0
    03CE3 940E 2D70 CALL	_delayms
(0301) 	 Send_nByte(sendBuf, i+1); //uart send
    03CE5 2F24      MOV	R18,R20
    03CE6 5F2F      SUBI	R18,0xFF
    03CE7 018E      MOVW	R16,R28
    03CE8 940E 3D9F CALL	_Send_nByte
    03CEA 96EF      ADIW	R28,0x3F
    03CEB 9621      ADIW	R28,1
    03CEC 940C 4B97 JMP	pop_xgset30FC
_zigbee_send_date:
  buf                  --> Y,+1
    03CEE 9726      SBIW	R28,6
(0302) }
(0303) /* 发送hex 暂未用到
(0304) void Send_bin(char *buf, unsigned char cmd, unsigned char buf_len){
(0305) 	 char i = 0;
(0306) 	 
(0307) 	 unsigned char sendBuf[64];
(0308) 	 sendBuf[0] = FRAME_HEAD;
(0309) 	 sendBuf[1] = 0;
(0310) 	 sendBuf[2] = 0x00; //主机地址
(0311) 	 sendBuf[3] = deviceId; //本机地址
(0312) 	 sendBuf[4] = cmd; //
(0313) 	 for(i=0;i<buf_len;i++){
(0314) 			 	 sendBuf[i+5] = *(buf+i);
(0315) 	 }
(0316) 	 i=i+5;
(0317) 	 sendBuf[i++] = 0xCC;
(0318) 	 sendBuf[i++] = 0xCC;
(0319) 	 sendBuf[i] = FRAME_END;
(0320) 	 sendBuf[1] = i+1;
(0321) 	 delayms((deviceId-0xB1)*1);  //不同设备延时不同时间发送数据，避免碰撞
(0322) 	 Send_nByte(sendBuf, i+1); //uart send
(0323) }
(0324) */
(0325) void zigbee_send_date(void){
(0326) 	char buf[5];
(0327)     Send_string(res.Date, Z_CMD1_DATE, 9);
    03CEF E089      LDI	R24,0x9
    03CF0 8388      ST	Y,R24
    03CF1 ED21      LDI	R18,0xD1
    03CF2 E801      LDI	R16,0x81
    03CF3 E016      LDI	R17,6
    03CF4 DF9D      RCALL	_Send_string
(0328) 	Send_string(res.Time, Z_CMD2_TIME, 10);
    03CF5 E08A      LDI	R24,0xA
    03CF6 8388      ST	Y,R24
    03CF7 ED22      LDI	R18,0xD2
    03CF8 E80A      LDI	R16,0x8A
    03CF9 E016      LDI	R17,6
    03CFA DF97      RCALL	_Send_string
(0329) 	Send_string(res.TempChar, Z_CMD3_TEMPERATURE, 6);
    03CFB E086      LDI	R24,6
    03CFC 8388      ST	Y,R24
    03CFD ED23      LDI	R18,0xD3
    03CFE E908      LDI	R16,0x98
    03CFF E016      LDI	R17,6
    03D00 DF91      RCALL	_Send_string
(0330) 	Send_string(res.WSChar, Z_CMD4_WS, 5);
    03D01 E085      LDI	R24,5
    03D02 8388      ST	Y,R24
    03D03 ED24      LDI	R18,0xD4
    03D04 EA02      LDI	R16,0xA2
    03D05 E016      LDI	R17,6
    03D06 DF8B      RCALL	_Send_string
(0331) 	Send_string(res.WCIChar, Z_CMD5_WCI ,8);
    03D07 E088      LDI	R24,0x8
    03D08 8388      ST	Y,R24
    03D09 ED25      LDI	R18,0xD5
    03D0A EA0B      LDI	R16,0xAB
    03D0B E016      LDI	R17,6
    03D0C DF85      RCALL	_Send_string
(0332) 	Send_string(res.ECTChar, Z_CMD6_ETC ,6);
    03D0D E086      LDI	R24,6
    03D0E 8388      ST	Y,R24
    03D0F ED26      LDI	R18,0xD6
    03D10 EB07      LDI	R16,0xB7
    03D11 E016      LDI	R17,6
    03D12 DF7F      RCALL	_Send_string
(0333) 	Send_string(res.TeqChar, Z_CMD7_TEQ ,6);
    03D13 E086      LDI	R24,6
    03D14 8388      ST	Y,R24
    03D15 ED27      LDI	R18,0xD7
    03D16 EC01      LDI	R16,0xC1
    03D17 E016      LDI	R17,6
    03D18 DF79      RCALL	_Send_string
(0334) 	
(0335) 	buf[0]= Result.WeiHai + 0x30;
    03D19 9180 06C7 LDS	R24,Result+92
    03D1B 5D80      SUBI	R24,0xD0
    03D1C 8389      STD	Y+1,R24
(0336) 	buf[1]= Result.LowLabor + 0x30;
    03D1D 9180 06C8 LDS	R24,Result+93
    03D1F 5D80      SUBI	R24,0xD0
    03D20 838A      STD	Y+2,R24
(0337) 	buf[2]= Result.MidLabor + 0x30;
    03D21 9180 06C9 LDS	R24,Result+94
    03D23 5D80      SUBI	R24,0xD0
    03D24 838B      STD	Y+3,R24
(0338) 	buf[3]= Result.HighLabor + 0x30;
    03D25 9180 06CA LDS	R24,Result+95
    03D27 5D80      SUBI	R24,0xD0
    03D28 838C      STD	Y+4,R24
(0339) 	buf[4]= 0;
    03D29 2422      CLR	R2
    03D2A 822D      STD	Y+5,R2
(0340) 	Send_string(buf, Z_CMD8_OTHER, 5);
    03D2B E085      LDI	R24,5
    03D2C 8388      ST	Y,R24
    03D2D ED28      LDI	R18,0xD8
    03D2E 018E      MOVW	R16,R28
    03D2F 5F0F      SUBI	R16,0xFF
    03D30 4F1F      SBCI	R17,0xFF
    03D31 DF60      RCALL	_Send_string
(0341) 	return ;
    03D32 9626      ADIW	R28,6
    03D33 9508      RET
_zigbee_send_id:
    03D34 9721      SBIW	R28,1
(0342) }
(0343) 
(0344) void zigbee_send_id(void){
(0345) 	 Send_string((char *)devicename,Z_CMD0,sizeof(devicename));
    03D35 E088      LDI	R24,0x8
    03D36 8388      ST	Y,R24
    03D37 ED20      LDI	R18,0xD0
    03D38 EE07      LDI	R16,0xE7
    03D39 E015      LDI	R17,5
    03D3A DF57      RCALL	_Send_string
    03D3B 9621      ADIW	R28,1
    03D3C 9508      RET
FILE: D:\LQD\software\software_src\usart.c
(0001) #include "config.h"
(0002) 
(0003) 
(0004) #define fosc 7372800UL //晶振7.3728MHZ
(0005) #define baud 38400  //波特率
(0006) //串口通信初始化  MEGA128
(0007) //UART1 initialize
(0008) // desired baud rate:38400
(0009) // actual baud rate:38400 (0.0%)
(0010) // char size: 8 bit
(0011) // parity: Disabled
(0012) void uart1_init(void)
(0013) {
(0014)  UCSR1B = 0x00; //disable while setting baud rate
_uart1_init:
    03D3D 2422      CLR	R2
    03D3E 9220 009A STS	0x9A,R2
(0015)  UCSR1A = 0x00;
    03D40 9220 009B STS	0x9B,R2
(0016)  UCSR1C = 0x06;
    03D42 E086      LDI	R24,6
    03D43 9380 009D STS	0x9D,R24
(0017)  UBRR1L = 0x0B; //set baud rate lo
    03D45 E08B      LDI	R24,0xB
    03D46 9380 0099 STS	0x99,R24
(0018)  UBRR1H = 0x00; //set baud rate hi
    03D48 9220 0098 STS	0x98,R2
(0019)  UCSR1B = 0x98;
    03D4A E988      LDI	R24,0x98
    03D4B 9380 009A STS	0x9A,R24
    03D4D 9508      RET
_uart1_rx_isr:
  tmp                  --> R10
    03D4E 920A      ST	-Y,R0
    03D4F 921A      ST	-Y,R1
    03D50 922A      ST	-Y,R2
    03D51 923A      ST	-Y,R3
    03D52 924A      ST	-Y,R4
    03D53 925A      ST	-Y,R5
    03D54 926A      ST	-Y,R6
    03D55 927A      ST	-Y,R7
    03D56 928A      ST	-Y,R8
    03D57 929A      ST	-Y,R9
    03D58 930A      ST	-Y,R16
    03D59 931A      ST	-Y,R17
    03D5A 932A      ST	-Y,R18
    03D5B 933A      ST	-Y,R19
    03D5C 938A      ST	-Y,R24
    03D5D 939A      ST	-Y,R25
    03D5E 93AA      ST	-Y,R26
    03D5F 93BA      ST	-Y,R27
    03D60 93EA      ST	-Y,R30
    03D61 93FA      ST	-Y,R31
    03D62 B60F      IN	R0,0x3F
    03D63 920A      ST	-Y,R0
    03D64 92AA      ST	-Y,R10
(0020) }
(0021) 
(0022) #pragma interrupt_handler uart1_rx_isr:iv_USART1_RXC
(0023) void uart1_rx_isr(void){   
(0024) 	 char tmp;
(0025) 	 tmp=UDR1;
    03D65 90A0 009C LDS	R10,0x9C
(0026) 	 //Usart_Transmit(tmp);
(0027) 	 RecAdd(tmp); //this function is come from zigbee.c
    03D67 2D0A      MOV	R16,R10
    03D68 940E 3B38 CALL	_RecAdd
    03D6A 90A9      LD	R10,Y+
    03D6B 9009      LD	R0,Y+
    03D6C BE0F      OUT	0x3F,R0
    03D6D 91F9      LD	R31,Y+
    03D6E 91E9      LD	R30,Y+
    03D6F 91B9      LD	R27,Y+
    03D70 91A9      LD	R26,Y+
    03D71 9199      LD	R25,Y+
    03D72 9189      LD	R24,Y+
    03D73 9139      LD	R19,Y+
    03D74 9129      LD	R18,Y+
    03D75 9119      LD	R17,Y+
    03D76 9109      LD	R16,Y+
    03D77 9099      LD	R9,Y+
    03D78 9089      LD	R8,Y+
    03D79 9079      LD	R7,Y+
    03D7A 9069      LD	R6,Y+
    03D7B 9059      LD	R5,Y+
    03D7C 9049      LD	R4,Y+
    03D7D 9039      LD	R3,Y+
    03D7E 9029      LD	R2,Y+
    03D7F 9019      LD	R1,Y+
    03D80 9009      LD	R0,Y+
    03D81 9518      RETI
(0028) }
(0029) 
(0030) void Usart_Transmit(char c)
(0031) {
(0032)  	 while (!(UCSR1A&(1<<UDRE1)));//表明发送器一准备就绪
_Usart_Transmit:
  c                    --> R16
    03D82 9020 009B LDS	R2,0x9B
    03D84 FE25      SBRS	R2,5
    03D85 CFFC      RJMP	_Usart_Transmit
(0033) 	 UDR1=c;
    03D86 9300 009C STS	0x9C,R16
    03D88 9508      RET
_Puts:
  s                    --> R20
    03D89 934A      ST	-Y,R20
    03D8A 935A      ST	-Y,R21
    03D8B 01A8      MOVW	R20,R16
(0034) }
(0035) 
(0036) //串口输出字符串
(0037) void Puts( unsigned char *s)
(0038) { 
    03D8C C00B      RJMP	0x3D98
(0039) 	 while (*s) 
(0040)       { 
(0041) 	  //为数据间的隔断创造一个串口能显示的隔断字符 即'/t'  ->  ' '
(0042) 	  if(*s==0x09)  
    03D8D 01FA      MOVW	R30,R20
    03D8E 8180      LD	R24,Z
    03D8F 3089      CPI	R24,0x9
    03D90 F411      BNE	0x3D93
(0043) 	  {   Usart_Transmit(' ');    }
    03D91 E200      LDI	R16,0x20
    03D92 DFEF      RCALL	_Usart_Transmit
(0044) 	 Usart_Transmit(*s);
    03D93 01FA      MOVW	R30,R20
    03D94 8100      LD	R16,Z
    03D95 DFEC      RCALL	_Usart_Transmit
(0045) 	 s++;
    03D96 5F4F      SUBI	R20,0xFF
    03D97 4F5F      SBCI	R21,0xFF
    03D98 01FA      MOVW	R30,R20
    03D99 8020      LD	R2,Z
    03D9A 2022      TST	R2
    03D9B F789      BNE	0x3D8D
    03D9C 9159      LD	R21,Y+
    03D9D 9149      LD	R20,Y+
    03D9E 9508      RET
_Send_nByte:
  i                    --> R20
  len                  --> R10
  p                    --> R12
    03D9F 940E 4BD8 CALL	push_xgset303C
    03DA1 2EA2      MOV	R10,R18
    03DA2 0168      MOVW	R12,R16
(0046) 	
(0047) 	
(0048)       }
(0049) }
(0050) 
(0051) 
(0052) 
(0053) void Send_nByte(unsigned char *p, unsigned char len)
(0054) { 
(0055)   int i = 0;
(0056)   for(i=0;i<len;i++)
    03DA3 2744      CLR	R20
    03DA4 2755      CLR	R21
    03DA5 C007      RJMP	0x3DAD
(0057)   {
(0058)    	Usart_Transmit(*(p+i));
    03DA6 01FA      MOVW	R30,R20
    03DA7 0DEC      ADD	R30,R12
    03DA8 1DFD      ADC	R31,R13
    03DA9 8100      LD	R16,Z
    03DAA DFD7      RCALL	_Usart_Transmit
    03DAB 5F4F      SUBI	R20,0xFF
    03DAC 4F5F      SBCI	R21,0xFF
    03DAD 2C2A      MOV	R2,R10
    03DAE 2433      CLR	R3
    03DAF 1542      CP	R20,R2
    03DB0 0553      CPC	R21,R3
    03DB1 F3A4      BLT	0x3DA6
    03DB2 940C 4BDF JMP	pop_xgset303C
_PrintString:
  str                  --> R10
    03DB4 92AA      ST	-Y,R10
    03DB5 92BA      ST	-Y,R11
    03DB6 0158      MOVW	R10,R16
(0059)   }
(0060) }
(0061) 
(0062) void  PrintString(const unsigned char *str)
(0063) {    
    03DB7 C004      RJMP	0x3DBC
(0064) 	while(*str!=0)	Usart_Transmit(*str++);
    03DB8 01F5      MOVW	R30,R10
    03DB9 9101      LD	R16,Z+
    03DBA 015F      MOVW	R10,R30
    03DBB DFC6      RCALL	_Usart_Transmit
    03DBC 01F5      MOVW	R30,R10
    03DBD 8020      LD	R2,Z
    03DBE 2022      TST	R2
    03DBF F7C1      BNE	0x3DB8
    03DC0 90B9      LD	R11,Y+
    03DC1 90A9      LD	R10,Y+
    03DC2 9508      RET
_PrintString_n:
  str                  --> R10
    03DC3 92AA      ST	-Y,R10
    03DC4 92BA      ST	-Y,R11
    03DC5 0158      MOVW	R10,R16
(0065) }
(0066) void  PrintString_n(const unsigned char *str)
(0067) {   
(0068) 	Usart_Transmit('\r');
    03DC6 E00D      LDI	R16,0xD
    03DC7 DFBA      RCALL	_Usart_Transmit
(0069) 	Usart_Transmit('\n'); 
    03DC8 E00A      LDI	R16,0xA
    03DC9 DFB8      RCALL	_Usart_Transmit
    03DCA C004      RJMP	0x3DCF
(0070) 	while(*str!=0)	Usart_Transmit(*str++);
    03DCB 01F5      MOVW	R30,R10
    03DCC 9101      LD	R16,Z+
    03DCD 015F      MOVW	R10,R30
    03DCE DFB3      RCALL	_Usart_Transmit
    03DCF 01F5      MOVW	R30,R10
    03DD0 8020      LD	R2,Z
    03DD1 2022      TST	R2
    03DD2 F7C1      BNE	0x3DCB
    03DD3 90B9      LD	R11,Y+
    03DD4 90A9      LD	R10,Y+
    03DD5 9508      RET
_PrintLong:
  i                    --> R20
  da                   --> Y,+0
  data                 --> Y,+9
    03DD6 940E 4A66 CALL	push_arg4
    03DD8 934A      ST	-Y,R20
    03DD9 9728      SBIW	R28,0x8
(0071) 
(0072) } 
(0073)  
(0074) void PrintLong(unsigned long data)
(0075) {
(0076)  
(0077) 	unsigned char da[8];
(0078) 	unsigned char i;
(0079) 	for(i=0;i<8;i++)	da[i]=0;
    03DDA 2744      CLR	R20
    03DDB C008      RJMP	0x3DE4
    03DDC 01CE      MOVW	R24,R28
    03DDD 2FE4      MOV	R30,R20
    03DDE 27FF      CLR	R31
    03DDF 0FE8      ADD	R30,R24
    03DE0 1FF9      ADC	R31,R25
    03DE1 2422      CLR	R2
    03DE2 8220      ST	Z,R2
    03DE3 9543      INC	R20
    03DE4 3048      CPI	R20,0x8
    03DE5 F3B0      BCS	0x3DDC
    03DE6 C013      RJMP	0x3DFA
(0080) 	while(data>=10000000L){ ++da[7];data-=10000000L;}
    03DE7 818F      LDD	R24,Y+7
    03DE8 5F8F      SUBI	R24,0xFF
    03DE9 838F      STD	Y+7,R24
    03DEA E880      LDI	R24,0x80
    03DEB E996      LDI	R25,0x96
    03DEC E9A8      LDI	R26,0x98
    03DED E0B0      LDI	R27,0
    03DEE 8429      LDD	R2,Y+9
    03DEF 843A      LDD	R3,Y+10
    03DF0 844B      LDD	R4,Y+11
    03DF1 845C      LDD	R5,Y+12
    03DF2 1A28      SUB	R2,R24
    03DF3 0A39      SBC	R3,R25
    03DF4 0A4A      SBC	R4,R26
    03DF5 0A5B      SBC	R5,R27
    03DF6 8629      STD	Y+9,R2
    03DF7 863A      STD	Y+10,R3
    03DF8 864B      STD	Y+11,R4
    03DF9 865C      STD	Y+12,R5
    03DFA E880      LDI	R24,0x80
    03DFB E996      LDI	R25,0x96
    03DFC E9A8      LDI	R26,0x98
    03DFD E0B0      LDI	R27,0
    03DFE 8429      LDD	R2,Y+9
    03DFF 843A      LDD	R3,Y+10
    03E00 844B      LDD	R4,Y+11
    03E01 845C      LDD	R5,Y+12
    03E02 1628      CP	R2,R24
    03E03 0639      CPC	R3,R25
    03E04 064A      CPC	R4,R26
    03E05 065B      CPC	R5,R27
    03E06 F700      BCC	0x3DE7
(0081) 	if(da[7])	i=0;
    03E07 802F      LDD	R2,Y+7
    03E08 2022      TST	R2
    03E09 F009      BEQ	0x3E0B
    03E0A 2744      CLR	R20
(0082) 	if(i==0)	Usart_Transmit('0'+da[7]);
    03E0B 2344      TST	R20
    03E0C F4B9      BNE	0x3E24
    03E0D 810F      LDD	R16,Y+7
    03E0E 5D00      SUBI	R16,0xD0
    03E0F DF72      RCALL	_Usart_Transmit
    03E10 C013      RJMP	0x3E24
(0083) 	while(data>=1000000L) { ++da[6];data-=1000000L;}
    03E11 818E      LDD	R24,Y+6
    03E12 5F8F      SUBI	R24,0xFF
    03E13 838E      STD	Y+6,R24
    03E14 E480      LDI	R24,0x40
    03E15 E492      LDI	R25,0x42
    03E16 E0AF      LDI	R26,0xF
    03E17 E0B0      LDI	R27,0
    03E18 8429      LDD	R2,Y+9
    03E19 843A      LDD	R3,Y+10
    03E1A 844B      LDD	R4,Y+11
    03E1B 845C      LDD	R5,Y+12
    03E1C 1A28      SUB	R2,R24
    03E1D 0A39      SBC	R3,R25
    03E1E 0A4A      SBC	R4,R26
    03E1F 0A5B      SBC	R5,R27
    03E20 8629      STD	Y+9,R2
    03E21 863A      STD	Y+10,R3
    03E22 864B      STD	Y+11,R4
    03E23 865C      STD	Y+12,R5
    03E24 E480      LDI	R24,0x40
    03E25 E492      LDI	R25,0x42
    03E26 E0AF      LDI	R26,0xF
    03E27 E0B0      LDI	R27,0
    03E28 8429      LDD	R2,Y+9
    03E29 843A      LDD	R3,Y+10
    03E2A 844B      LDD	R4,Y+11
    03E2B 845C      LDD	R5,Y+12
    03E2C 1628      CP	R2,R24
    03E2D 0639      CPC	R3,R25
    03E2E 064A      CPC	R4,R26
    03E2F 065B      CPC	R5,R27
    03E30 F700      BCC	0x3E11
(0084) 	if(da[6])	i=0;
    03E31 802E      LDD	R2,Y+6
    03E32 2022      TST	R2
    03E33 F009      BEQ	0x3E35
    03E34 2744      CLR	R20
(0085) 	if(i==0)	Usart_Transmit('0'+da[6]);
    03E35 2344      TST	R20
    03E36 F4B9      BNE	0x3E4E
    03E37 810E      LDD	R16,Y+6
    03E38 5D00      SUBI	R16,0xD0
    03E39 DF48      RCALL	_Usart_Transmit
    03E3A C013      RJMP	0x3E4E
(0086) 	while(data>=100000L)  { ++da[5];data-=100000L;}
    03E3B 818D      LDD	R24,Y+5
    03E3C 5F8F      SUBI	R24,0xFF
    03E3D 838D      STD	Y+5,R24
    03E3E EA80      LDI	R24,0xA0
    03E3F E896      LDI	R25,0x86
    03E40 E0A1      LDI	R26,1
    03E41 E0B0      LDI	R27,0
    03E42 8429      LDD	R2,Y+9
    03E43 843A      LDD	R3,Y+10
    03E44 844B      LDD	R4,Y+11
    03E45 845C      LDD	R5,Y+12
    03E46 1A28      SUB	R2,R24
    03E47 0A39      SBC	R3,R25
    03E48 0A4A      SBC	R4,R26
    03E49 0A5B      SBC	R5,R27
    03E4A 8629      STD	Y+9,R2
    03E4B 863A      STD	Y+10,R3
    03E4C 864B      STD	Y+11,R4
    03E4D 865C      STD	Y+12,R5
    03E4E EA80      LDI	R24,0xA0
    03E4F E896      LDI	R25,0x86
    03E50 E0A1      LDI	R26,1
    03E51 E0B0      LDI	R27,0
    03E52 8429      LDD	R2,Y+9
    03E53 843A      LDD	R3,Y+10
    03E54 844B      LDD	R4,Y+11
    03E55 845C      LDD	R5,Y+12
    03E56 1628      CP	R2,R24
    03E57 0639      CPC	R3,R25
    03E58 064A      CPC	R4,R26
    03E59 065B      CPC	R5,R27
    03E5A F700      BCC	0x3E3B
(0087) 	if(da[5])	i=0;
    03E5B 802D      LDD	R2,Y+5
    03E5C 2022      TST	R2
    03E5D F009      BEQ	0x3E5F
    03E5E 2744      CLR	R20
(0088) 	if(i==0)	Usart_Transmit('0'+da[5]);
    03E5F 2344      TST	R20
    03E60 F4B9      BNE	0x3E78
    03E61 810D      LDD	R16,Y+5
    03E62 5D00      SUBI	R16,0xD0
    03E63 DF1E      RCALL	_Usart_Transmit
    03E64 C013      RJMP	0x3E78
(0089) 	while(data>=10000L)   { ++da[4];data-=10000L;}
    03E65 818C      LDD	R24,Y+4
    03E66 5F8F      SUBI	R24,0xFF
    03E67 838C      STD	Y+4,R24
    03E68 E180      LDI	R24,0x10
    03E69 E297      LDI	R25,0x27
    03E6A E0A0      LDI	R26,0
    03E6B E0B0      LDI	R27,0
    03E6C 8429      LDD	R2,Y+9
    03E6D 843A      LDD	R3,Y+10
    03E6E 844B      LDD	R4,Y+11
    03E6F 845C      LDD	R5,Y+12
    03E70 1A28      SUB	R2,R24
    03E71 0A39      SBC	R3,R25
    03E72 0A4A      SBC	R4,R26
    03E73 0A5B      SBC	R5,R27
    03E74 8629      STD	Y+9,R2
    03E75 863A      STD	Y+10,R3
    03E76 864B      STD	Y+11,R4
    03E77 865C      STD	Y+12,R5
    03E78 E180      LDI	R24,0x10
    03E79 E297      LDI	R25,0x27
    03E7A E0A0      LDI	R26,0
    03E7B E0B0      LDI	R27,0
    03E7C 8429      LDD	R2,Y+9
    03E7D 843A      LDD	R3,Y+10
    03E7E 844B      LDD	R4,Y+11
    03E7F 845C      LDD	R5,Y+12
    03E80 1628      CP	R2,R24
    03E81 0639      CPC	R3,R25
    03E82 064A      CPC	R4,R26
    03E83 065B      CPC	R5,R27
    03E84 F700      BCC	0x3E65
(0090) 	if(da[4])	i=0;
    03E85 802C      LDD	R2,Y+4
    03E86 2022      TST	R2
    03E87 F009      BEQ	0x3E89
    03E88 2744      CLR	R20
(0091) 	if(i==0)	Usart_Transmit('0'+da[4]);
    03E89 2344      TST	R20
    03E8A F4B9      BNE	0x3EA2
    03E8B 810C      LDD	R16,Y+4
    03E8C 5D00      SUBI	R16,0xD0
    03E8D DEF4      RCALL	_Usart_Transmit
    03E8E C013      RJMP	0x3EA2
(0092) 	while(data>=1000L)    { ++da[3];data-=1000L;}
    03E8F 818B      LDD	R24,Y+3
    03E90 5F8F      SUBI	R24,0xFF
    03E91 838B      STD	Y+3,R24
    03E92 EE88      LDI	R24,0xE8
    03E93 E093      LDI	R25,3
    03E94 E0A0      LDI	R26,0
    03E95 E0B0      LDI	R27,0
    03E96 8429      LDD	R2,Y+9
    03E97 843A      LDD	R3,Y+10
    03E98 844B      LDD	R4,Y+11
    03E99 845C      LDD	R5,Y+12
    03E9A 1A28      SUB	R2,R24
    03E9B 0A39      SBC	R3,R25
    03E9C 0A4A      SBC	R4,R26
    03E9D 0A5B      SBC	R5,R27
    03E9E 8629      STD	Y+9,R2
    03E9F 863A      STD	Y+10,R3
    03EA0 864B      STD	Y+11,R4
    03EA1 865C      STD	Y+12,R5
    03EA2 EE88      LDI	R24,0xE8
    03EA3 E093      LDI	R25,3
    03EA4 E0A0      LDI	R26,0
    03EA5 E0B0      LDI	R27,0
    03EA6 8429      LDD	R2,Y+9
    03EA7 843A      LDD	R3,Y+10
    03EA8 844B      LDD	R4,Y+11
    03EA9 845C      LDD	R5,Y+12
    03EAA 1628      CP	R2,R24
    03EAB 0639      CPC	R3,R25
    03EAC 064A      CPC	R4,R26
    03EAD 065B      CPC	R5,R27
    03EAE F700      BCC	0x3E8F
(0093) 	if(da[3])	i=0;
    03EAF 802B      LDD	R2,Y+3
    03EB0 2022      TST	R2
    03EB1 F009      BEQ	0x3EB3
    03EB2 2744      CLR	R20
(0094) 	if(i==0)	Usart_Transmit('0'+da[3]);
    03EB3 2344      TST	R20
    03EB4 F4B9      BNE	0x3ECC
    03EB5 810B      LDD	R16,Y+3
    03EB6 5D00      SUBI	R16,0xD0
    03EB7 DECA      RCALL	_Usart_Transmit
    03EB8 C013      RJMP	0x3ECC
(0095) 	while(data>=100L)     { ++da[2];data-=100L;}
    03EB9 818A      LDD	R24,Y+2
    03EBA 5F8F      SUBI	R24,0xFF
    03EBB 838A      STD	Y+2,R24
    03EBC E684      LDI	R24,0x64
    03EBD E090      LDI	R25,0
    03EBE E0A0      LDI	R26,0
    03EBF E0B0      LDI	R27,0
    03EC0 8429      LDD	R2,Y+9
    03EC1 843A      LDD	R3,Y+10
    03EC2 844B      LDD	R4,Y+11
    03EC3 845C      LDD	R5,Y+12
    03EC4 1A28      SUB	R2,R24
    03EC5 0A39      SBC	R3,R25
    03EC6 0A4A      SBC	R4,R26
    03EC7 0A5B      SBC	R5,R27
    03EC8 8629      STD	Y+9,R2
    03EC9 863A      STD	Y+10,R3
    03ECA 864B      STD	Y+11,R4
    03ECB 865C      STD	Y+12,R5
    03ECC E684      LDI	R24,0x64
    03ECD E090      LDI	R25,0
    03ECE E0A0      LDI	R26,0
    03ECF E0B0      LDI	R27,0
    03ED0 8429      LDD	R2,Y+9
    03ED1 843A      LDD	R3,Y+10
    03ED2 844B      LDD	R4,Y+11
    03ED3 845C      LDD	R5,Y+12
    03ED4 1628      CP	R2,R24
    03ED5 0639      CPC	R3,R25
    03ED6 064A      CPC	R4,R26
    03ED7 065B      CPC	R5,R27
    03ED8 F700      BCC	0x3EB9
(0096) 	if(da[2])	i=0;
    03ED9 802A      LDD	R2,Y+2
    03EDA 2022      TST	R2
    03EDB F009      BEQ	0x3EDD
    03EDC 2744      CLR	R20
(0097) 	if(i==0)	Usart_Transmit('0'+da[2]);
    03EDD 2344      TST	R20
    03EDE F4B9      BNE	0x3EF6
    03EDF 810A      LDD	R16,Y+2
    03EE0 5D00      SUBI	R16,0xD0
    03EE1 DEA0      RCALL	_Usart_Transmit
    03EE2 C013      RJMP	0x3EF6
(0098) 	while(data>=10L)      { ++da[1];data-=10L;}
    03EE3 8189      LDD	R24,Y+1
    03EE4 5F8F      SUBI	R24,0xFF
    03EE5 8389      STD	Y+1,R24
    03EE6 E08A      LDI	R24,0xA
    03EE7 E090      LDI	R25,0
    03EE8 E0A0      LDI	R26,0
    03EE9 E0B0      LDI	R27,0
    03EEA 8429      LDD	R2,Y+9
    03EEB 843A      LDD	R3,Y+10
    03EEC 844B      LDD	R4,Y+11
    03EED 845C      LDD	R5,Y+12
    03EEE 1A28      SUB	R2,R24
    03EEF 0A39      SBC	R3,R25
    03EF0 0A4A      SBC	R4,R26
    03EF1 0A5B      SBC	R5,R27
    03EF2 8629      STD	Y+9,R2
    03EF3 863A      STD	Y+10,R3
    03EF4 864B      STD	Y+11,R4
    03EF5 865C      STD	Y+12,R5
    03EF6 E08A      LDI	R24,0xA
    03EF7 E090      LDI	R25,0
    03EF8 E0A0      LDI	R26,0
    03EF9 E0B0      LDI	R27,0
    03EFA 8429      LDD	R2,Y+9
    03EFB 843A      LDD	R3,Y+10
    03EFC 844B      LDD	R4,Y+11
    03EFD 845C      LDD	R5,Y+12
    03EFE 1628      CP	R2,R24
    03EFF 0639      CPC	R3,R25
    03F00 064A      CPC	R4,R26
    03F01 065B      CPC	R5,R27
    03F02 F700      BCC	0x3EE3
(0099) 	if(da[1])	i=0;
    03F03 8029      LDD	R2,Y+1
    03F04 2022      TST	R2
    03F05 F009      BEQ	0x3F07
    03F06 2744      CLR	R20
(0100) 	if(i==0)	Usart_Transmit('0'+da[1]);
    03F07 2344      TST	R20
    03F08 F419      BNE	0x3F0C
    03F09 8109      LDD	R16,Y+1
    03F0A 5D00      SUBI	R16,0xD0
    03F0B DE76      RCALL	_Usart_Transmit
(0101) 	Usart_Transmit('0'+data);
    03F0C E380      LDI	R24,0x30
    03F0D E090      LDI	R25,0
    03F0E E0A0      LDI	R26,0
    03F0F E0B0      LDI	R27,0
    03F10 8429      LDD	R2,Y+9
    03F11 843A      LDD	R3,Y+10
    03F12 844B      LDD	R4,Y+11
    03F13 845C      LDD	R5,Y+12
    03F14 0E28      ADD	R2,R24
    03F15 1E39      ADC	R3,R25
    03F16 1E4A      ADC	R4,R26
    03F17 1E5B      ADC	R5,R27
    03F18 2D02      MOV	R16,R2
    03F19 DE68      RCALL	_Usart_Transmit
    03F1A 9628      ADIW	R28,0x8
    03F1B 9149      LD	R20,Y+
    03F1C 9624      ADIW	R28,4
    03F1D 9508      RET
_PrintChar:
  h                    --> R20
  d                    --> R22
    03F1E 934A      ST	-Y,R20
    03F1F 936A      ST	-Y,R22
    03F20 2F60      MOV	R22,R16
(0102)  
(0103) }
(0104)  
(0105) void PrintChar(unsigned char d)
(0106) {
(0107) 	unsigned char h=(d&0xF0)>>4;
    03F21 2F46      MOV	R20,R22
    03F22 7F40      ANDI	R20,0xF0
    03F23 9542      SWAP	R20
    03F24 704F      ANDI	R20,0xF
(0108) 	if(h<10)	Usart_Transmit('0'+h);
    03F25 304A      CPI	R20,0xA
    03F26 F420      BCC	0x3F2B
    03F27 2F04      MOV	R16,R20
    03F28 5D00      SUBI	R16,0xD0
    03F29 DE58      RCALL	_Usart_Transmit
    03F2A C003      RJMP	0x3F2E
(0109) 	else		Usart_Transmit('A'-10+h);
    03F2B 2F04      MOV	R16,R20
    03F2C 5C09      SUBI	R16,0xC9
    03F2D DE54      RCALL	_Usart_Transmit
(0110) 	h=d&0x0f;
    03F2E 2F46      MOV	R20,R22
    03F2F 704F      ANDI	R20,0xF
(0111) 	if(h<10)	Usart_Transmit('0'+h);
    03F30 304A      CPI	R20,0xA
    03F31 F420      BCC	0x3F36
    03F32 2F04      MOV	R16,R20
    03F33 5D00      SUBI	R16,0xD0
    03F34 DE4D      RCALL	_Usart_Transmit
    03F35 C003      RJMP	0x3F39
(0112) 	else		Usart_Transmit('A'-10+h);
    03F36 2F04      MOV	R16,R20
    03F37 5C09      SUBI	R16,0xC9
    03F38 DE49      RCALL	_Usart_Transmit
(0113) 	Usart_Transmit(' ');
    03F39 E200      LDI	R16,0x20
    03F3A DE47      RCALL	_Usart_Transmit
    03F3B 9169      LD	R22,Y+
    03F3C 9149      LD	R20,Y+
    03F3D 9508      RET
FILE: D:\LQD\software\software_src\SPI.c
(0001) //*****************************************************************************//
(0002) //*								 
(0003) //*控制芯片：ATmgea128
(0004) //*开发环境：AVR Studio+GCC
(0005) //*隶属模块：SPI接口控制
(0006) //*****************************************************************************//
(0007) #include "SPI.h"
(0008) 
(0009) /******************************************************************
(0010) SPI接口函数初始化
(0011) ******************************************************************/
(0012) void SPI_IO_Init(void)
(0013) {
(0014) 	SPI_PORT |= (1<<SS);////拉高CS
_SPI_IO_Init:
    03F3E 9AC0      SBI	0x18,0
(0015) 	SPI_DDR |= (1<<SCLK)|(1<<MOSI)|(1<<SS);////CS,CLK,MOSI设为输出
    03F3F B387      IN	R24,0x17
    03F40 6087      ORI	R24,7
    03F41 BB87      OUT	0x17,R24
(0016) 	SPI_DDR &=~(1<<MISO);//MISO设为输入
    03F42 98BB      CBI	0x17,3
(0017) 	SPI_PORT |= (1<<SCLK);//拉高CLK
    03F43 9AC1      SBI	0x18,1
(0018) 	SPI_High();//SPI高通
    03F44 E580      LDI	R24,0x50
    03F45 B98D      OUT	0x0D,R24
    03F46 9A70      SBI	0x0E,0
    03F47 9508      RET
(0019) }
(0020) /******************************************************************
(0021) SPI写一个字节
(0022) ******************************************************************/
(0023) void SPI_Write(UINT8 data)
(0024) {
(0025) 	SPDR = data;
_SPI_Write:
  data                 --> R16
    03F48 B90F      OUT	0x0F,R16
(0026) 	while ((SPSR&(1<<SPIF))==0);
    03F49 9B77      SBIS	0x0E,7
    03F4A CFFE      RJMP	0x3F49
    03F4B 9508      RET
(0027) 	//loop_until_bit_is_set(SPSR,SPIF);
(0028) }
(0029) /******************************************************************
(0030) SPI读一个字节
(0031) ******************************************************************/
(0032) unsigned char SPI_Read(void)
(0033) {
(0034) 	SPDR = 0xFF;//写0xFF启动SPI
_SPI_Read:
    03F4C EF8F      LDI	R24,0xFF
    03F4D B98F      OUT	0x0F,R24
(0035) 	while ((SPSR&(1<<SPIF))==0);
    03F4E 9B77      SBIS	0x0E,7
    03F4F CFFE      RJMP	0x3F4E
(0036) 	//loop_until_bit_is_set(SPSR,SPIF);//等待SPIF为高电平
(0037) 	return  SPDR;//返回读取值
    03F50 B10F      IN	R16,0x0F
    03F51 9508      RET
FILE: D:\LQD\software\software_src\lcd.c
(0001) #include "config.h"
(0002) 
(0003) //此硬件引脚适合冷强度检测仪第2版电路  mega128
(0004) #define LCD_PIN_CS   4
(0005) #define LCD_PIN_SID  3
(0006) #define LCD_PIN_SCLK 2
(0007) #define LCD_PIN_RST  1
(0008) #define LCD_BACKLIGHT_SW		0
(0009) #define LCD_PORT PORTC
(0010) #define LCD_PIN_DDR DDRC
(0011) #define Set_CS()     LCD_PIN_DDR |= (1<<LCD_PIN_CS)  ;LCD_PORT |= (1<<LCD_PIN_CS) 
(0012) #define Set_SID()    LCD_PIN_DDR |= (1<<LCD_PIN_SID) ;LCD_PORT |= (1<<LCD_PIN_SID) 
(0013) #define Set_SCLK()   LCD_PIN_DDR |= (1<<LCD_PIN_SCLK);LCD_PORT |= (1<<LCD_PIN_SCLK) 
(0014) #define LCD_LIGHT_ON()   LCD_PIN_DDR |= (1<<LCD_BACKLIGHT_SW);LCD_PORT |= (1<<LCD_BACKLIGHT_SW) 
(0015) #define Set_RST()   LCD_PIN_DDR |= (1<<LCD_PIN_RST);LCD_PORT |= (1<<LCD_PIN_RST) 
(0016) 
(0017) #define Clr_CS()     LCD_PIN_DDR |= (1<<LCD_PIN_CS)  ;LCD_PORT &=~(1<<LCD_PIN_CS) 
(0018) #define Clr_SID()    LCD_PIN_DDR |= (1<<LCD_PIN_SID) ;LCD_PORT &=~(1<<LCD_PIN_SID) 
(0019) #define Clr_SCLK()   LCD_PIN_DDR |= (1<<LCD_PIN_SCLK);LCD_PORT &=~(1<<LCD_PIN_SCLK) 
(0020) #define LCD_LIGHT_OFF()   LCD_PIN_DDR |= (1<<LCD_BACKLIGHT_SW);LCD_PORT &=~(1<<LCD_BACKLIGHT_SW) 
(0021) #define Clr_RST()   LCD_PIN_DDR |= (1<<LCD_PIN_RST);LCD_PORT &=~(1<<LCD_PIN_RST) 
(0022)  
(0023) void W_1byte(unsigned char RW, unsigned char RS, unsigned char W_data); 
(0024) void Write_8bits(unsigned int W_bits); 
(0025) void LCD_Init(void); 
(0026) unsigned char LCD_INT(void); 
(0027) 
(0028) unsigned char LCD_SW(unsigned char i)
(0029) {
(0030)  if(i==0){
_LCD_SW:
  i                    --> R16
    03F52 2300      TST	R16
    03F53 F421      BNE	0x3F58
(0031)  LCD_LIGHT_OFF();
    03F54 9AA0      SBI	0x14,0
    03F55 98A8      CBI	0x15,0
(0032)  return 0;
    03F56 2700      CLR	R16
    03F57 C003      RJMP	0x3F5B
(0033)  }
(0034)  else{
(0035)  LCD_LIGHT_ON();
    03F58 9AA0      SBI	0x14,0
    03F59 9AA8      SBI	0x15,0
(0036)  return 1;
    03F5A E001      LDI	R16,1
    03F5B 9508      RET
(0037)  }
(0038)  
(0039) }
(0040)  
(0041) unsigned char LCD_INT(void) 
(0042) { 
(0043)   Clr_CS(); 
_LCD_INT:
    03F5C 9AA4      SBI	0x14,4
    03F5D 98AC      CBI	0x15,4
(0044)   Clr_SID(); 
    03F5E 9AA3      SBI	0x14,3
    03F5F 98AB      CBI	0x15,3
(0045)   Clr_SCLK(); 
    03F60 9AA2      SBI	0x14,2
    03F61 98AA      CBI	0x15,2
(0046)   LCD_Init(); 
    03F62 D097      RCALL	_LCD_Init
(0047)   return (0);
    03F63 2700      CLR	R16
    03F64 9508      RET
_address:
  a                    --> R20
  y                    --> R18
  x                    --> R16
    03F65 940E 4BC0 CALL	push_xgsetF000
(0048) } 
(0049)   
(0050) /******************************************************************** 
(0051) 函数 名：address
(0052) 入口参数：地址转换
(0053) 出口参数：无 
(0054) 函数作用： 
(0055) 说        明： 
(0056) ********************************************************************/ 
(0057) unsigned char address(unsigned char x,unsigned char y)
(0058) {  
(0059)  unsigned char a;
(0060) 
(0061) switch(x) 
    03F67 2F60      MOV	R22,R16
    03F68 2777      CLR	R23
    03F69 3061      CPI	R22,1
    03F6A E0E0      LDI	R30,0
    03F6B 077E      CPC	R23,R30
    03F6C F069      BEQ	0x3F7A
    03F6D 3062      CPI	R22,2
    03F6E E0E0      LDI	R30,0
    03F6F 077E      CPC	R23,R30
    03F70 F059      BEQ	0x3F7C
    03F71 3063      CPI	R22,3
    03F72 E0E0      LDI	R30,0
    03F73 077E      CPC	R23,R30
    03F74 F049      BEQ	0x3F7E
    03F75 3064      CPI	R22,4
    03F76 E0E0      LDI	R30,0
    03F77 077E      CPC	R23,R30
    03F78 F039      BEQ	0x3F80
    03F79 C007      RJMP	0x3F81
(0062) { 
(0063) case 1: 
(0064) {a=0x80;break;} 
    03F7A E840      LDI	R20,0x80
    03F7B C005      RJMP	0x3F81
(0065) case 2: 
(0066) {a=0x90;break;} 
    03F7C E940      LDI	R20,0x90
    03F7D C003      RJMP	0x3F81
(0067)   case 3: 
(0068) {a=0x88;break;} 
    03F7E E848      LDI	R20,0x88
    03F7F C001      RJMP	0x3F81
(0069)   case 4: 
(0070) {a=0x98;break;} 
    03F80 E948      LDI	R20,0x98
(0071) } 
(0072) a=a+y-1;
    03F81 0F42      ADD	R20,R18
    03F82 5041      SUBI	R20,1
(0073) 
(0074) return a;
    03F83 2F04      MOV	R16,R20
    03F84 940C 4BC5 JMP	pop_xgsetF000
_LCD_const_disp:
  a                    --> R12
  i                    --> R20
  single_data          --> R10
  y                    --> R14
  x                    --> R12
    03F86 940E 4BAD CALL	push_xgset30FC
    03F88 2EE2      MOV	R14,R18
    03F89 2EC0      MOV	R12,R16
    03F8A 9721      SBIW	R28,1
    03F8B 84A9      LDD	R10,Y+9
    03F8C 84BA      LDD	R11,Y+10
(0075) }
(0076)  
(0077) //////////////////////////////////////////////////////////////
(0078) 
(0079) /******************************************************************** 
(0080) 函数 名：LCD_const_disp
(0081) 入口参数：x y  *single_data
(0082) 出口参数：无 
(0083) 函数作用：负责 显示一串常量
(0084) 说        明： 
(0085) ********************************************************************/ 
(0086) void LCD_const_disp(unsigned char x, unsigned char y, const unsigned char *single_data) 
(0087) { 
(0088) unsigned char  a,i; 
(0089) a=address(x,y);
    03F8D 2D2E      MOV	R18,R14
    03F8E 2D0C      MOV	R16,R12
    03F8F DFD5      RCALL	_address
    03F90 2EC0      MOV	R12,R16
(0090) W_1byte(0,0,a);     //显示的地址 
    03F91 82C8      ST	Y,R12
    03F92 2722      CLR	R18
    03F93 2700      CLR	R16
    03F94 D0B7      RCALL	_W_1byte
(0091)    for(i=0; single_data[i]!='\0';i++) 
    03F95 2744      CLR	R20
    03F96 C00D      RJMP	0x3FA4
(0092)    {
(0093)     if(i>=16) break; 
    03F97 3140      CPI	R20,0x10
    03F98 F008      BCS	0x3F9A
    03F99 C011      RJMP	0x3FAB
(0094)     W_1byte(0,1,single_data[i]); 
    03F9A 2FE4      MOV	R30,R20
    03F9B 27FF      CLR	R31
    03F9C 0DEA      ADD	R30,R10
    03F9D 1DFB      ADC	R31,R11
    03F9E 8020      LD	R2,Z
    03F9F 8228      ST	Y,R2
    03FA0 E021      LDI	R18,1
    03FA1 2700      CLR	R16
    03FA2 D0A9      RCALL	_W_1byte
    03FA3 9543      INC	R20
    03FA4 2FE4      MOV	R30,R20
    03FA5 27FF      CLR	R31
    03FA6 0DEA      ADD	R30,R10
    03FA7 1DFB      ADC	R31,R11
    03FA8 8020      LD	R2,Z
    03FA9 2022      TST	R2
    03FAA F761      BNE	0x3F97
(0095)     
(0096)    } 
(0097)    W_1byte(0,0,0XFF); // 移走地址指针 防止下一输入内容的干扰
    03FAB EF8F      LDI	R24,0xFF
    03FAC 8388      ST	Y,R24
    03FAD 2722      CLR	R18
    03FAE 2700      CLR	R16
    03FAF D09C      RCALL	_W_1byte
    03FB0 9621      ADIW	R28,1
    03FB1 940C 4B97 JMP	pop_xgset30FC
_LCD_var_disp:
  a                    --> R12
  i                    --> R20
  single_data          --> R10
  y                    --> R14
  x                    --> R12
    03FB3 940E 4BAD CALL	push_xgset30FC
    03FB5 2EE2      MOV	R14,R18
    03FB6 2EC0      MOV	R12,R16
    03FB7 9721      SBIW	R28,1
    03FB8 84A9      LDD	R10,Y+9
    03FB9 84BA      LDD	R11,Y+10
(0098)  
(0099) } 
(0100) 
(0101) /******************************************************************** 
(0102) 函数 名：LCD_var_disp
(0103) 入口参数：single_row single_line  *single_data
(0104) 出口参数：无 
(0105) 函数作用：负责 显示一串变量
(0106) 说        明： 
(0107) ********************************************************************/ 
(0108) 
(0109) void LCD_var_disp(unsigned char x, unsigned char y, unsigned char *single_data) 
(0110) { 
(0111) unsigned char  a,i; 
(0112) 
(0113) #if _debug == 1 
(0114) 	PrintString_n(single_data);
(0115) #endif 
(0116) 
(0117) a=address( x,y);
    03FBA 2D2E      MOV	R18,R14
    03FBB 2D0C      MOV	R16,R12
    03FBC DFA8      RCALL	_address
    03FBD 2EC0      MOV	R12,R16
(0118) W_1byte(0,0,a);     //显示的地址0x88 
    03FBE 82C8      ST	Y,R12
    03FBF 2722      CLR	R18
    03FC0 2700      CLR	R16
    03FC1 D08A      RCALL	_W_1byte
(0119) 
(0120) for(i=0; single_data[i]!='\0';i++) 
    03FC2 2744      CLR	R20
    03FC3 C00D      RJMP	0x3FD1
(0121)    { 
(0122)     if(i>=16) break;
    03FC4 3140      CPI	R20,0x10
    03FC5 F008      BCS	0x3FC7
    03FC6 C011      RJMP	0x3FD8
(0123)     W_1byte(0,1,single_data[i]); 
    03FC7 2FE4      MOV	R30,R20
    03FC8 27FF      CLR	R31
    03FC9 0DEA      ADD	R30,R10
    03FCA 1DFB      ADC	R31,R11
    03FCB 8020      LD	R2,Z
    03FCC 8228      ST	Y,R2
    03FCD E021      LDI	R18,1
    03FCE 2700      CLR	R16
    03FCF D07C      RCALL	_W_1byte
    03FD0 9543      INC	R20
    03FD1 2FE4      MOV	R30,R20
    03FD2 27FF      CLR	R31
    03FD3 0DEA      ADD	R30,R10
    03FD4 1DFB      ADC	R31,R11
    03FD5 8020      LD	R2,Z
    03FD6 2022      TST	R2
    03FD7 F761      BNE	0x3FC4
(0124) 	} 
(0125)   W_1byte(0,0,0XFF); // 移走地址指针 防止下一输入内容的干扰
    03FD8 EF8F      LDI	R24,0xFF
    03FD9 8388      ST	Y,R24
    03FDA 2722      CLR	R18
    03FDB 2700      CLR	R16
    03FDC D06F      RCALL	_W_1byte
    03FDD 9621      ADIW	R28,1
    03FDE 940C 4B97 JMP	pop_xgset30FC
_LCD_char_disp:
  a                    --> R12
  data                 --> R10
  y                    --> R14
  x                    --> R12
    03FE0 940E 4BAF CALL	push_xgset00FC
    03FE2 2EE2      MOV	R14,R18
    03FE3 2EC0      MOV	R12,R16
    03FE4 9721      SBIW	R28,1
    03FE5 80AF      LDD	R10,Y+7
(0126) } 
(0127) /******************************************************************** 
(0128) 函数 名：LCD_char_disp
(0129) 入口参数：single_row single_line  data
(0130) 出口参数：无 
(0131) 函数作用：负责 显示一个 变量
(0132) 说        明： 
(0133) ********************************************************************/ 
(0134) 
(0135) void LCD_char_disp(unsigned char x, unsigned char y, unsigned char data) 
(0136) { 
(0137) unsigned char a; 
(0138) a=address(x,y);
    03FE6 2D2E      MOV	R18,R14
    03FE7 2D0C      MOV	R16,R12
    03FE8 DF7C      RCALL	_address
    03FE9 2EC0      MOV	R12,R16
(0139) W_1byte(0,0,a);     //显示的地址 
    03FEA 82C8      ST	Y,R12
    03FEB 2722      CLR	R18
    03FEC 2700      CLR	R16
    03FED D05E      RCALL	_W_1byte
(0140) W_1byte(0,1,data);  //显示内容
    03FEE 82A8      ST	Y,R10
    03FEF E021      LDI	R18,1
    03FF0 2700      CLR	R16
    03FF1 D05A      RCALL	_W_1byte
(0141)  
(0142)   W_1byte(0,0,0XFF); // 移走地址指针 防止下一输入内容的干扰
    03FF2 EF8F      LDI	R24,0xFF
    03FF3 8388      ST	Y,R24
    03FF4 2722      CLR	R18
    03FF5 2700      CLR	R16
    03FF6 D055      RCALL	_W_1byte
    03FF7 9621      ADIW	R28,1
    03FF8 940C 4B90 JMP	pop_xgset00FC
_LCD_Init:
  cmd                  --> R20
    03FFA 934A      ST	-Y,R20
    03FFB 9721      SBIW	R28,1
(0143) } 
(0144) 
(0145) /******************************************************************** 
(0146) 函数 名：LCD_Init
(0147) 入口参数：无
(0148) 出口参数：unsigned char  0/1
(0149) 函数作用：负责 清空液晶显示
(0150) 说        明： 
(0151) ********************************************************************/ 
(0152) void LCD_Init(void) 
(0153) { 
(0154)    unsigned char cmd; 
(0155)    cmd=0x30;      //功能设置 8 位数据，基本指令 
    03FFC E340      LDI	R20,0x30
(0156)   W_1byte(0,0,cmd); 
    03FFD 8348      ST	Y,R20
    03FFE 2722      CLR	R18
    03FFF 2700      CLR	R16
    04000 D04B      RCALL	_W_1byte
(0157)   delayms(2); 
    04001 E002      LDI	R16,2
    04002 E010      LDI	R17,0
    04003 940E 2D70 CALL	_delayms
(0158)   cmd=0x0C;      //显示状态 ON，游标OFF，反白OFF 
    04005 E04C      LDI	R20,0xC
(0159)   W_1byte(0,0,cmd); //写指令 
    04006 8348      ST	Y,R20
    04007 2722      CLR	R18
    04008 2700      CLR	R16
    04009 D042      RCALL	_W_1byte
(0160)   delayms(2); 
    0400A E002      LDI	R16,2
    0400B E010      LDI	R17,0
    0400C 940E 2D70 CALL	_delayms
(0161)   cmd=0x01;      //清除显示 
    0400E E041      LDI	R20,1
(0162)   W_1byte(0,0,cmd); //写指令 
    0400F 8348      ST	Y,R20
    04010 2722      CLR	R18
    04011 2700      CLR	R16
    04012 D039      RCALL	_W_1byte
(0163)   delayms(2); 
    04013 E002      LDI	R16,2
    04014 E010      LDI	R17,0
    04015 940E 2D70 CALL	_delayms
(0164)   cmd=0x02;      //地址归位 
    04017 E042      LDI	R20,2
(0165)   W_1byte(0,0,cmd); //写指令 
    04018 8348      ST	Y,R20
    04019 2722      CLR	R18
    0401A 2700      CLR	R16
    0401B D030      RCALL	_W_1byte
(0166)   delayms(2); 
    0401C E002      LDI	R16,2
    0401D E010      LDI	R17,0
    0401E 940E 2D70 CALL	_delayms
(0167)   cmd=0x80;      //设置DDRAM 地址 
    04020 E840      LDI	R20,0x80
(0168)   W_1byte(0,0,cmd); //写指令 
    04021 8348      ST	Y,R20
    04022 2722      CLR	R18
    04023 2700      CLR	R16
    04024 D027      RCALL	_W_1byte
(0169)   delayms(2);     //延时 
    04025 E002      LDI	R16,2
    04026 E010      LDI	R17,0
    04027 940E 2D70 CALL	_delayms
    04029 9621      ADIW	R28,1
    0402A 9149      LD	R20,Y+
    0402B 9508      RET
_LCD_CLR:
  cmd                  --> R20
    0402C 934A      ST	-Y,R20
    0402D 9721      SBIW	R28,1
(0170) } 
(0171) 
(0172) void LCD_CLR(void)
(0173) {
(0174) unsigned char cmd;
(0175)   cmd=0x01;      //清除显示 
    0402E E041      LDI	R20,1
(0176)   W_1byte(0,0,cmd); //写指令 
    0402F 8348      ST	Y,R20
    04030 2722      CLR	R18
    04031 2700      CLR	R16
    04032 D019      RCALL	_W_1byte
(0177)   delayms(1); 
    04033 E001      LDI	R16,1
    04034 E010      LDI	R17,0
    04035 940E 2D70 CALL	_delayms
(0178)   cmd=0x02;      //地址归位 
    04037 E042      LDI	R20,2
(0179)   W_1byte(0,0,cmd); //写指令 
    04038 8348      ST	Y,R20
    04039 2722      CLR	R18
    0403A 2700      CLR	R16
    0403B D010      RCALL	_W_1byte
(0180)   delayms(1); 
    0403C E001      LDI	R16,1
    0403D E010      LDI	R17,0
    0403E 940E 2D70 CALL	_delayms
(0181)   cmd=0x80;      //设置DDRAM 地址 
    04040 E840      LDI	R20,0x80
(0182)   W_1byte(0,0,cmd); //写指令 
    04041 8348      ST	Y,R20
    04042 2722      CLR	R18
    04043 2700      CLR	R16
    04044 D007      RCALL	_W_1byte
(0183)   delayms(1);     //延时
    04045 E001      LDI	R16,1
    04046 E010      LDI	R17,0
    04047 940E 2D70 CALL	_delayms
    04049 9621      ADIW	R28,1
    0404A 9149      LD	R20,Y+
    0404B 9508      RET
_W_1byte:
  H_data               --> R22
  S_ID                 --> R10
  L_data               --> R20
  W_data               --> R12
  RS                   --> R14
  RW                   --> R20
    0404C 940E 4BAB CALL	push_xgsetF0FC
    0404E 2EE2      MOV	R14,R18
    0404F 2F40      MOV	R20,R16
    04050 84CA      LDD	R12,Y+10
(0184) 
(0185) }
(0186)  
(0187) /*******************************************************************
(0188) 函 数 名：W_1byte
(0189) 入口参数：RW、RS、W_data
(0190) 出口参数：无
(0191) 建立日期：2007年3月3日
(0192) 修改日期：
(0193) 函数作用：写一个字节的数据到12864液晶，包括指令和数据
(0194) 说    明：RW=1，从液晶读数据到MCU；RW=0，写一个数据到液晶；
(0195) 		 （一般RW都设为0，即只向液晶写数据，不读数据）
(0196)           RS=1，写入的是数据；RS=0，写入的是指令；
(0197) 		  一般模式：RW=0，RS=1;写数据
(0198) 		  			RW=0，RS=0;写指令
(0199) ********************************************************************/
(0200) void W_1byte(unsigned char RW, unsigned char RS, unsigned char W_data)
(0201) {
(0202) 	unsigned int H_data,L_data,S_ID = 0xf8;	 //11111RWRS0
    04051 EF88      LDI	R24,0xF8
    04052 E090      LDI	R25,0
    04053 015C      MOVW	R10,R24
(0203) 	if(RW == 0)
    04054 2344      TST	R20
    04055 F419      BNE	0x4059
(0204) 	{
(0205) 	 	S_ID &=~ 0x04;
    04056 7F8B      ANDI	R24,0xFB
    04057 015C      MOVW	R10,R24
(0206) 	}
    04058 C003      RJMP	0x405C
(0207) 	else					//if(RW==1)
(0208) 	{
(0209) 	 	S_ID |= 0X04;
    04059 01C5      MOVW	R24,R10
    0405A 6084      ORI	R24,4
    0405B 015C      MOVW	R10,R24
(0210) 	}
(0211) 	if(RS == 0)
    0405C 20EE      TST	R14
    0405D F421      BNE	0x4062
(0212) 	{
(0213) 	 	S_ID &=~ 0x02;
    0405E 01C5      MOVW	R24,R10
    0405F 7F8D      ANDI	R24,0xFD
    04060 015C      MOVW	R10,R24
(0214) 	}
    04061 C003      RJMP	0x4065
(0215) 	else					//if(RS==1)
(0216) 	{
(0217) 	 	S_ID |= 0X02;
    04062 01C5      MOVW	R24,R10
    04063 6082      ORI	R24,2
    04064 015C      MOVW	R10,R24
(0218) 	}
(0219) 	H_data = W_data;
    04065 2D6C      MOV	R22,R12
    04066 2777      CLR	R23
(0220) 	H_data &= 0xf0;			//屏蔽低4位的数据
    04067 7F60      ANDI	R22,0xF0
    04068 7070      ANDI	R23,0
(0221) 	L_data = W_data;	   	//xxxx0000格式
    04069 2D4C      MOV	R20,R12
    0406A 2755      CLR	R21
(0222) 	L_data &= 0x0f;			//屏蔽高4位的数据
    0406B 704F      ANDI	R20,0xF
    0406C 7050      ANDI	R21,0
(0223) 	L_data <<= 4;			//xxxx0000格式
    0406D 0F44      LSL	R20
    0406E 1F55      ROL	R21
    0406F 0F44      LSL	R20
    04070 1F55      ROL	R21
    04071 0F44      LSL	R20
    04072 1F55      ROL	R21
    04073 0F44      LSL	R20
    04074 1F55      ROL	R21
(0224) 	Set_CS();
    04075 9AA4      SBI	0x14,4
    04076 9AAC      SBI	0x15,4
(0225) 	Write_8bits(S_ID); 		//发送S_ID
    04077 0185      MOVW	R16,R10
    04078 D00C      RCALL	_Write_8bits
(0226) 	Write_8bits(H_data);	//发送H_data
    04079 018B      MOVW	R16,R22
    0407A D00A      RCALL	_Write_8bits
(0227) 	Write_8bits(L_data);	//发送L_data
    0407B 018A      MOVW	R16,R20
    0407C D008      RCALL	_Write_8bits
(0228) 	Clr_CS();	Clr_CS();	Clr_CS();	
    0407D 9AA4      SBI	0x14,4
    0407E 98AC      CBI	0x15,4
    0407F 9AA4      SBI	0x14,4
    04080 98AC      CBI	0x15,4
    04081 9AA4      SBI	0x14,4
    04082 98AC      CBI	0x15,4
    04083 940C 4BA0 JMP	pop_xgsetF0FC
_Write_8bits:
  Temp_data            --> R12
  i                    --> R20
  W_bits               --> R10
    04085 940E 4BD8 CALL	push_xgset303C
    04087 0158      MOVW	R10,R16
(0229) 	 
(0230) 
(0231) }
(0232) /********************************************************************
(0233) 函 数 名：Write_8bits
(0234) 入口参数：W_bits
(0235) 出口参数：无
(0236) 建立日期：2007年3月3日
(0237) 修改日期：
(0238) 函数作用：负责串行输出8个bit位
(0239) 说    明：
(0240) ********************************************************************/
(0241) void Write_8bits(unsigned int W_bits)
(0242) {
(0243) 	unsigned int i,Temp_data;
(0244) 	for(i=0; i<8; i++)
    04088 2744      CLR	R20
    04089 2755      CLR	R21
    0408A C019      RJMP	0x40A4
(0245) 	{
(0246) 		Temp_data = W_bits;
    0408B 0165      MOVW	R12,R10
(0247) 		Temp_data <<= i;
    0408C 019A      MOVW	R18,R20
    0408D 0186      MOVW	R16,R12
    0408E 940E 4C2F CALL	lsl16
    04090 0168      MOVW	R12,R16
(0248) 		if((Temp_data&0x80)==0) 
    04091 FD07      SBRC	R16,7
    04092 C003      RJMP	0x4096
(0249) 		{
(0250) 		 	Clr_SID();
    04093 9AA3      SBI	0x14,3
    04094 98AB      CBI	0x15,3
(0251) 		}
    04095 C002      RJMP	0x4098
(0252) 		else
(0253) 		{
(0254) 		 	Set_SID();
    04096 9AA3      SBI	0x14,3
    04097 9AAB      SBI	0x15,3
(0255) 		} 
(0256) 		NOP();
    04098 0000      NOP
(0257) 		Set_SCLK();
    04099 9AA2      SBI	0x14,2
    0409A 9AAA      SBI	0x15,2
(0258) 		NOP();
    0409B 0000      NOP
(0259) 		NOP();
    0409C 0000      NOP
(0260) 		Clr_SCLK();
    0409D 9AA2      SBI	0x14,2
    0409E 98AA      CBI	0x15,2
(0261) 		NOP();
    0409F 0000      NOP
(0262) 		Clr_SID();
    040A0 9AA3      SBI	0x14,3
    040A1 98AB      CBI	0x15,3
    040A2 5F4F      SUBI	R20,0xFF
    040A3 4F5F      SBCI	R21,0xFF
    040A4 3048      CPI	R20,0x8
    040A5 E0E0      LDI	R30,0
    040A6 075E      CPC	R21,R30
    040A7 F318      BCS	0x408B
    040A8 940C 4BDF JMP	pop_xgset303C
_Set_Draw:
    040AA 9721      SBIW	R28,1
(0263) 	}
(0264) }
(0265)  
(0266) /********************************************************************
(0267) 函 数 名：Set_Draw(
(0268) 入口参数：无
(0269) 出口参数：无
(0270) 函数作用：设置为绘图模式
(0271) 说    明：
(0272) ********************************************************************/
(0273) void Set_Draw(void)
(0274) {  	
(0275) 	//W_1byte(0,0,0x34);			//8BIT控制界面，扩充指令集,，绘图显示OFF
(0276) 	W_1byte(0,0,0x36);
    040AB E386      LDI	R24,0x36
    040AC 8388      ST	Y,R24
    040AD 2722      CLR	R18
    040AE 2700      CLR	R16
    040AF DF9C      RCALL	_W_1byte
(0277) 	delayms(1);					//延时
    040B0 E001      LDI	R16,1
    040B1 E010      LDI	R17,0
    040B2 940E 2D70 CALL	_delayms
    040B4 9621      ADIW	R28,1
    040B5 9508      RET
_Set_White:
  clr_y                --> R10
  clr_x                --> R20
  white_y              --> Y,+2
  white_x              --> Y,+1
  i                    --> R22
  white_end_x          --> R12
  j                    --> R14
  clear                --> Y,+15
  end_x                --> R12
  y                    --> R14
  x                    --> R22
    040B6 940E 4BAB CALL	push_xgsetF0FC
    040B8 2EE2      MOV	R14,R18
    040B9 2F60      MOV	R22,R16
    040BA 9723      SBIW	R28,3
    040BB 84CD      LDD	R12,Y+13
(0278) } 
(0279)  
(0280) 
(0281) /******************************************************************** 
(0282) 函数 名：Set_White 
(0283) 入口参数：  x,   y,  end_x,  clear
(0284) 出口参数：无 
(0285) 函数作用： 设置反显
(0286) 说        明： 
(0287) ********************************************************************/ 
(0288) void Set_White(unsigned char x,unsigned char y,unsigned char end_x,unsigned char clear)
(0289) {
(0290)  
(0291) 	unsigned char i, j, white_x, white_y,white_end_x,clr_x,clr_y ;		//
(0292)   
(0293) 	W_1byte(0,0,0x36);	  //8BIT控制界面，扩充指令集,，绘图显示ON
    040BC E386      LDI	R24,0x36
    040BD 8388      ST	Y,R24
    040BE 2722      CLR	R18
    040BF 2700      CLR	R16
    040C0 DF8B      RCALL	_W_1byte
(0294) 	delayus(20);					//延时
    040C1 E104      LDI	R16,0x14
    040C2 E010      LDI	R17,0
    040C3 940E 2D68 CALL	_delayus
(0295)  
(0296) 	white_end_x = (end_x-x+1);
    040C5 2D8C      MOV	R24,R12
    040C6 1B86      SUB	R24,R22
    040C7 5F8F      SUBI	R24,0xFF
    040C8 2EC8      MOV	R12,R24
(0297) 	white_end_x <<= 1;
    040C9 0CCC      LSL	R12
(0298) 	if(y==1)   //x,1  a=80+x-1                   
    040CA 2D8E      MOV	R24,R14
    040CB 3081      CPI	R24,1
    040CC F449      BNE	0x40D6
(0299) 	{
(0300) 	 	white_x = (0x80+x-1); 
    040CD 2F86      MOV	R24,R22
    040CE 5880      SUBI	R24,0x80
    040CF 5081      SUBI	R24,1
    040D0 8389      STD	Y+1,R24
(0301) 		white_y = 0x80;
    040D1 E880      LDI	R24,0x80
    040D2 838A      STD	Y+2,R24
(0302) 		clr_x = 0x80;
    040D3 E840      LDI	R20,0x80
(0303) 		clr_y = 0x80;
    040D4 2EA8      MOV	R10,R24
(0304) 	}
    040D5 C023      RJMP	0x40F9
(0305) 	else if(y==2)
    040D6 2D8E      MOV	R24,R14
    040D7 3082      CPI	R24,2
    040D8 F449      BNE	0x40E2
(0306) 	{
(0307) 	 	white_x = (0x80+x-1);
    040D9 2F86      MOV	R24,R22
    040DA 5880      SUBI	R24,0x80
    040DB 5081      SUBI	R24,1
    040DC 8389      STD	Y+1,R24
(0308) 		white_y = 0x90;
    040DD E980      LDI	R24,0x90
    040DE 838A      STD	Y+2,R24
(0309) 		clr_x = 0x80;
    040DF E840      LDI	R20,0x80
(0310) 		clr_y = 0x90;
    040E0 2EA8      MOV	R10,R24
(0311) 	}
    040E1 C017      RJMP	0x40F9
(0312) 	else if(y==3)
    040E2 2D8E      MOV	R24,R14
    040E3 3083      CPI	R24,3
    040E4 F449      BNE	0x40EE
(0313) 	{
(0314) 	 	white_x = (0x88+x-1);
    040E5 2F86      MOV	R24,R22
    040E6 5788      SUBI	R24,0x78
    040E7 5081      SUBI	R24,1
    040E8 8389      STD	Y+1,R24
(0315) 		white_y = 0x80;
    040E9 E880      LDI	R24,0x80
    040EA 838A      STD	Y+2,R24
(0316) 		clr_x = 0x88;
    040EB E848      LDI	R20,0x88
(0317) 		clr_y = 0x80;
    040EC 2EA8      MOV	R10,R24
(0318) 	}
    040ED C00B      RJMP	0x40F9
(0319) 	else if(y==4)
    040EE 2D8E      MOV	R24,R14
    040EF 3084      CPI	R24,4
    040F0 F441      BNE	0x40F9
(0320) 	{
(0321) 	 	white_x = (0x88+x-1);
    040F1 2F86      MOV	R24,R22
    040F2 5788      SUBI	R24,0x78
    040F3 5081      SUBI	R24,1
    040F4 8389      STD	Y+1,R24
(0322) 		white_y = 0x90;
    040F5 E980      LDI	R24,0x90
    040F6 838A      STD	Y+2,R24
(0323) 		clr_x = 0x88;
    040F7 E848      LDI	R20,0x88
(0324) 		clr_y = 0x90;
    040F8 2EA8      MOV	R10,R24
(0325) 	}
(0326)   if(clear==0)//要反白时，先将整行的液晶全部清成不反白（此处行指y）
    040F9 840F      LDD	R0,Y+15
    040FA 2000      TST	R0
    040FB F4E9      BNE	0x4119
(0327) 	{
(0328) 	 	for(i=0;i<16;i++ )			//16行
    040FC 2766      CLR	R22
    040FD C019      RJMP	0x4117
(0329) 		{
(0330) 		 	W_1byte(0,0,clr_y++);	//设置绘图区的Y地址坐标0
    040FE 2C2A      MOV	R2,R10
    040FF 2D82      MOV	R24,R2
    04100 5F8F      SUBI	R24,0xFF
    04101 2EA8      MOV	R10,R24
    04102 8228      ST	Y,R2
    04103 2722      CLR	R18
    04104 2700      CLR	R16
    04105 DF46      RCALL	_W_1byte
(0331) 			W_1byte(0,0,clr_x);		//设置绘图区的X地址坐标0
    04106 8348      ST	Y,R20
    04107 2722      CLR	R18
    04108 2700      CLR	R16
    04109 DF42      RCALL	_W_1byte
(0332) 			for(j=0;j<16;j++)		//
    0410A 24EE      CLR	R14
    0410B C007      RJMP	0x4113
(0333) 			{
(0334) 			 	W_1byte(0,1,0x00);	//清成不反白
    0410C 2422      CLR	R2
    0410D 8228      ST	Y,R2
    0410E E021      LDI	R18,1
    0410F 2700      CLR	R16
    04110 DF3B      RCALL	_W_1byte
(0335) 			 	nop();
    04111 0000      NOP
    04112 94E3      INC	R14
    04113 2D8E      MOV	R24,R14
    04114 3180      CPI	R24,0x10
    04115 F3B0      BCS	0x410C
    04116 9563      INC	R22
    04117 3160      CPI	R22,0x10
    04118 F328      BCS	0x40FE
(0336) 			}
(0337) 		}
(0338) 	}
(0339) 	nop();
    04119 0000      NOP
(0340) //	
(0341) 	for(i=0;i<16;i++ )				//16行，因为是16*16汉字
    0411A 2766      CLR	R22
    0411B C022      RJMP	0x413E
(0342) 	{
(0343) 		W_1byte(0,0,white_y++);		//设置绘图区的Y地址坐标0
    0411C 802A      LDD	R2,Y+2
    0411D 2D82      MOV	R24,R2
    0411E 5F8F      SUBI	R24,0xFF
    0411F 838A      STD	Y+2,R24
    04120 8228      ST	Y,R2
    04121 2722      CLR	R18
    04122 2700      CLR	R16
    04123 DF28      RCALL	_W_1byte
(0344) 		W_1byte(0,0,white_x);		//设置绘图区的X地址坐标0
    04124 8009      LDD	R0,Y+1
    04125 8208      ST	Y,R0
    04126 2722      CLR	R18
    04127 2700      CLR	R16
    04128 DF23      RCALL	_W_1byte
(0345) 		for(j=0;j<white_end_x;j++)	//
    04129 24EE      CLR	R14
    0412A C010      RJMP	0x413B
(0346) 		{
(0347) 			 if(clear==1)
    0412B 858F      LDD	R24,Y+15
    0412C 3081      CPI	R24,1
    0412D F431      BNE	0x4134
(0348) 			 {
(0349) 			  	W_1byte(0,1,0x00); //取消这一行的8个点的反白，液晶地址自动加1
    0412E 2422      CLR	R2
    0412F 8228      ST	Y,R2
    04130 E021      LDI	R18,1
    04131 2700      CLR	R16
    04132 DF19      RCALL	_W_1byte
(0350) 								   //（此处行指一个一个液晶点所组成的行）
(0351) 			 }
    04133 C005      RJMP	0x4139
(0352) 			 else
(0353) 			 {
(0354) 				W_1byte(0,1,0xff); //反白这一行的8个点，液晶地址自动加1
    04134 EF8F      LDI	R24,0xFF
    04135 8388      ST	Y,R24
    04136 E021      LDI	R18,1
    04137 2700      CLR	R16
    04138 DF13      RCALL	_W_1byte
(0355) 								   //（此处行指一个一个液晶点所组成的行）
(0356) 			 }
(0357) 			nop();
    04139 0000      NOP
    0413A 94E3      INC	R14
    0413B 14EC      CP	R14,R12
    0413C F370      BCS	0x412B
    0413D 9563      INC	R22
    0413E 3160      CPI	R22,0x10
    0413F F2E0      BCS	0x411C
(0358) 		}
(0359) 	}
(0360) 	W_1byte(0,0,0x30);		//基本指令集,，绘图显示OFF
    04140 E380      LDI	R24,0x30
    04141 8388      ST	Y,R24
    04142 2722      CLR	R18
    04143 2700      CLR	R16
    04144 DF07      RCALL	_W_1byte
    04145 9623      ADIW	R28,3
    04146 940C 4BA0 JMP	pop_xgsetF0FC
_set_white_n:
  tempendx             --> R10
  tempy                --> R22
  tempx                --> R20
  clear                --> R12
  n                    --> R14
    04148 940E 4BAB CALL	push_xgsetF0FC
    0414A 2EC2      MOV	R12,R18
    0414B 2EE0      MOV	R14,R16
    0414C 9723      SBIW	R28,3
(0361)  }
(0362) 
(0363) /******************************************************************** 
(0364) 函数 名：set_white_n
(0365) 入口参数： n ,  clear
(0366) 出口参数：无 
(0367) 函数作用：   将四行分成八个位置。n代表位置1-8。本函数用于反显或取消反显
(0368)           某一位置的文字。
(0369) 说        明： 例如 set_white_n(1,0); 表示反显第一行前四个字
(0370) ********************************************************************/ 
(0371) void set_white_n(unsigned char n,unsigned char clear)
(0372) {
(0373) unsigned char tempx,tempy,tempendx;
(0374) if(n==1) {tempx=1;tempy=1;tempendx=4;}
    0414D 2D8E      MOV	R24,R14
    0414E 3081      CPI	R24,1
    0414F F429      BNE	0x4155
    04150 E041      LDI	R20,1
    04151 E061      LDI	R22,1
    04152 E084      LDI	R24,4
    04153 2EA8      MOV	R10,R24
    04154 C037      RJMP	0x418C
(0375) else if(n==2) {tempx=5;tempy=1;tempendx=8;}
    04155 2D8E      MOV	R24,R14
    04156 3082      CPI	R24,2
    04157 F429      BNE	0x415D
    04158 E045      LDI	R20,5
    04159 E061      LDI	R22,1
    0415A E088      LDI	R24,0x8
    0415B 2EA8      MOV	R10,R24
    0415C C02F      RJMP	0x418C
(0376) else if(n==3) {tempx=1;tempy=2;tempendx=4;}
    0415D 2D8E      MOV	R24,R14
    0415E 3083      CPI	R24,3
    0415F F429      BNE	0x4165
    04160 E041      LDI	R20,1
    04161 E062      LDI	R22,2
    04162 E084      LDI	R24,4
    04163 2EA8      MOV	R10,R24
    04164 C027      RJMP	0x418C
(0377) else if(n==4) {tempx=5;tempy=2;tempendx=8;}
    04165 2D8E      MOV	R24,R14
    04166 3084      CPI	R24,4
    04167 F429      BNE	0x416D
    04168 E045      LDI	R20,5
    04169 E062      LDI	R22,2
    0416A E088      LDI	R24,0x8
    0416B 2EA8      MOV	R10,R24
    0416C C01F      RJMP	0x418C
(0378) else if(n==5) {tempx=1;tempy=3;tempendx=4;}
    0416D 2D8E      MOV	R24,R14
    0416E 3085      CPI	R24,5
    0416F F429      BNE	0x4175
    04170 E041      LDI	R20,1
    04171 E063      LDI	R22,3
    04172 E084      LDI	R24,4
    04173 2EA8      MOV	R10,R24
    04174 C017      RJMP	0x418C
(0379) else if(n==6) {tempx=5;tempy=3;tempendx=8;}
    04175 2D8E      MOV	R24,R14
    04176 3086      CPI	R24,6
    04177 F429      BNE	0x417D
    04178 E045      LDI	R20,5
    04179 E063      LDI	R22,3
    0417A E088      LDI	R24,0x8
    0417B 2EA8      MOV	R10,R24
    0417C C00F      RJMP	0x418C
(0380) else if(n==7) {tempx=1;tempy=4;tempendx=4;}
    0417D 2D8E      MOV	R24,R14
    0417E 3087      CPI	R24,7
    0417F F429      BNE	0x4185
    04180 E041      LDI	R20,1
    04181 E064      LDI	R22,4
    04182 E084      LDI	R24,4
    04183 2EA8      MOV	R10,R24
    04184 C007      RJMP	0x418C
(0381) else if(n==8) {tempx=5;tempy=4;tempendx=8;}
    04185 2D8E      MOV	R24,R14
    04186 3088      CPI	R24,0x8
    04187 F421      BNE	0x418C
    04188 E045      LDI	R20,5
    04189 E064      LDI	R22,4
    0418A E088      LDI	R24,0x8
    0418B 2EA8      MOV	R10,R24
(0382) Set_White(tempx,tempy,tempendx,clear);
    0418C 82CA      STD	Y+2,R12
    0418D 82A8      ST	Y,R10
    0418E 2F26      MOV	R18,R22
    0418F 2F04      MOV	R16,R20
    04190 DF25      RCALL	_Set_White
    04191 9623      ADIW	R28,3
    04192 940C 4BA0 JMP	pop_xgsetF0FC
_clr_white:
  clr_x                --> R10
  clr_y                --> R20
  i                    --> R22
  j                    --> R12
    04194 940E 4BAB CALL	push_xgsetF0FC
    04196 9721      SBIW	R28,1
(0383) 
(0384) }
(0385)  
(0386) /******************************************************************** 
(0387) 函数 名：clr_white
(0388) 入口参数： 清所有 反白
(0389) 出口参数：无 
(0390) 函数作用： 
(0391) 说        明： 
(0392) ********************************************************************/ 
(0393) void clr_white(void)
(0394) {      unsigned char i,j;
(0395) 
(0396)        unsigned char  clr_y=0x80;
    04197 E840      LDI	R20,0x80
(0397) 	   unsigned char  clr_x=0x80;
    04198 E880      LDI	R24,0x80
    04199 2EA8      MOV	R10,R24
(0398) 	   W_1byte(0,0,0x36);	  //8BIT控制界面，扩充指令集,，绘图显示ON
    0419A E386      LDI	R24,0x36
    0419B 8388      ST	Y,R24
    0419C 2722      CLR	R18
    0419D 2700      CLR	R16
    0419E DEAD      RCALL	_W_1byte
(0399) 	 	for(i=0;i<16;i++ )			//16行
    0419F 2766      CLR	R22
    041A0 C017      RJMP	0x41B8
(0400) 		{
(0401) 		 	W_1byte(0,0,clr_y++);	//设置绘图区的Y地址坐标0
    041A1 2E24      MOV	R2,R20
    041A2 5F4F      SUBI	R20,0xFF
    041A3 8228      ST	Y,R2
    041A4 2722      CLR	R18
    041A5 2700      CLR	R16
    041A6 DEA5      RCALL	_W_1byte
(0402) 			W_1byte(0,0,clr_x);		//设置绘图区的X地址坐标0
    041A7 82A8      ST	Y,R10
    041A8 2722      CLR	R18
    041A9 2700      CLR	R16
    041AA DEA1      RCALL	_W_1byte
(0403) 			for(j=0;j<16;j++)		//
    041AB 24CC      CLR	R12
    041AC C007      RJMP	0x41B4
(0404) 			{
(0405) 			 	W_1byte(0,1,0x00);	//清成不反白
    041AD 2422      CLR	R2
    041AE 8228      ST	Y,R2
    041AF E021      LDI	R18,1
    041B0 2700      CLR	R16
    041B1 DE9A      RCALL	_W_1byte
(0406) 			 	nop();
    041B2 0000      NOP
    041B3 94C3      INC	R12
    041B4 2D8C      MOV	R24,R12
    041B5 3180      CPI	R24,0x10
    041B6 F3B0      BCS	0x41AD
    041B7 9563      INC	R22
    041B8 3160      CPI	R22,0x10
    041B9 F338      BCS	0x41A1
(0407) 			}
(0408) 		}
(0409) 	
(0410) 	    clr_y=0x80;
    041BA E840      LDI	R20,0x80
(0411) 	    clr_x=0x90;
    041BB E980      LDI	R24,0x90
    041BC 2EA8      MOV	R10,R24
(0412) 		 	for(i=0;i<16;i++ )			//16行
    041BD 2766      CLR	R22
    041BE C017      RJMP	0x41D6
(0413) 		{
(0414) 		 	W_1byte(0,0,clr_y++);	//设置绘图区的Y地址坐标0
    041BF 2E24      MOV	R2,R20
    041C0 5F4F      SUBI	R20,0xFF
    041C1 8228      ST	Y,R2
    041C2 2722      CLR	R18
    041C3 2700      CLR	R16
    041C4 DE87      RCALL	_W_1byte
(0415) 			W_1byte(0,0,clr_x);		//设置绘图区的X地址坐标0
    041C5 82A8      ST	Y,R10
    041C6 2722      CLR	R18
    041C7 2700      CLR	R16
    041C8 DE83      RCALL	_W_1byte
(0416) 			for(j=0;j<16;j++)		//
    041C9 24CC      CLR	R12
    041CA C007      RJMP	0x41D2
(0417) 			{
(0418) 			 	W_1byte(0,1,0x00);	//清成不反白
    041CB 2422      CLR	R2
    041CC 8228      ST	Y,R2
    041CD E021      LDI	R18,1
    041CE 2700      CLR	R16
    041CF DE7C      RCALL	_W_1byte
(0419) 			 	nop();
    041D0 0000      NOP
    041D1 94C3      INC	R12
    041D2 2D8C      MOV	R24,R12
    041D3 3180      CPI	R24,0x10
    041D4 F3B0      BCS	0x41CB
    041D5 9563      INC	R22
    041D6 3160      CPI	R22,0x10
    041D7 F338      BCS	0x41BF
(0420) 			}
(0421) 		}   
(0422) 	   
(0423) 	     clr_y=0x88;
    041D8 E848      LDI	R20,0x88
(0424) 	     clr_x=0x80;
    041D9 E880      LDI	R24,0x80
    041DA 2EA8      MOV	R10,R24
(0425) 		 	for(i=0;i<16;i++ )			//16行
    041DB 2766      CLR	R22
    041DC C017      RJMP	0x41F4
(0426) 		{
(0427) 		 	W_1byte(0,0,clr_y++);	//设置绘图区的Y地址坐标0
    041DD 2EE4      MOV	R14,R20
    041DE 5F4F      SUBI	R20,0xFF
    041DF 82E8      ST	Y,R14
    041E0 2722      CLR	R18
    041E1 2700      CLR	R16
    041E2 DE69      RCALL	_W_1byte
(0428) 			W_1byte(0,0,clr_x);		//设置绘图区的X地址坐标0
    041E3 82A8      ST	Y,R10
    041E4 2722      CLR	R18
    041E5 2700      CLR	R16
    041E6 DE65      RCALL	_W_1byte
(0429) 			for(j=0;j<16;j++)		//
    041E7 24CC      CLR	R12
    041E8 C007      RJMP	0x41F0
(0430) 			{
(0431) 			 	W_1byte(0,1,0x00);	//清成不反白
    041E9 2422      CLR	R2
    041EA 8228      ST	Y,R2
    041EB E021      LDI	R18,1
    041EC 2700      CLR	R16
    041ED DE5E      RCALL	_W_1byte
(0432) 			 	nop();
    041EE 0000      NOP
    041EF 94C3      INC	R12
    041F0 2D8C      MOV	R24,R12
    041F1 3180      CPI	R24,0x10
    041F2 F3B0      BCS	0x41E9
    041F3 9563      INC	R22
    041F4 3160      CPI	R22,0x10
    041F5 F338      BCS	0x41DD
(0433) 			}
(0434) 		} 
(0435) 	     clr_y=0x88;
    041F6 E848      LDI	R20,0x88
(0436) 	     clr_x=0x90;
    041F7 E980      LDI	R24,0x90
    041F8 2EA8      MOV	R10,R24
(0437) 		 	for(i=0;i<16;i++ )			//16行
    041F9 2766      CLR	R22
    041FA C017      RJMP	0x4212
(0438) 		{
(0439) 		 	W_1byte(0,0,clr_y++);	//设置绘图区的Y地址坐标0
    041FB 2EE4      MOV	R14,R20
    041FC 5F4F      SUBI	R20,0xFF
    041FD 82E8      ST	Y,R14
    041FE 2722      CLR	R18
    041FF 2700      CLR	R16
    04200 DE4B      RCALL	_W_1byte
(0440) 			W_1byte(0,0,clr_x);		//设置绘图区的X地址坐标0
    04201 82A8      ST	Y,R10
    04202 2722      CLR	R18
    04203 2700      CLR	R16
    04204 DE47      RCALL	_W_1byte
(0441) 			for(j=0;j<16;j++)		//
    04205 24CC      CLR	R12
    04206 C007      RJMP	0x420E
(0442) 			{
(0443) 			 	W_1byte(0,1,0x00);	//清成不反白
    04207 2422      CLR	R2
    04208 8228      ST	Y,R2
    04209 E021      LDI	R18,1
    0420A 2700      CLR	R16
    0420B DE40      RCALL	_W_1byte
(0444) 			 	nop();
    0420C 0000      NOP
    0420D 94C3      INC	R12
    0420E 2D8C      MOV	R24,R12
    0420F 3180      CPI	R24,0x10
    04210 F3B0      BCS	0x4207
    04211 9563      INC	R22
    04212 3160      CPI	R22,0x10
    04213 F338      BCS	0x41FB
(0445) 			}
(0446) 		} 		
(0447)   W_1byte(0,0,0x30);	  //8BIT控制界面，扩充指令集,，绘图显示ON
    04214 E380      LDI	R24,0x30
    04215 8388      ST	Y,R24
    04216 2722      CLR	R18
    04217 2700      CLR	R16
    04218 DE33      RCALL	_W_1byte
    04219 9621      ADIW	R28,1
    0421A 940C 4BA0 JMP	pop_xgsetF0FC
_LCD_print2num:
  a                    --> R12
  tem                  --> R20
  num                  --> R10
  y                    --> R14
  x                    --> R12
    0421C 940E 4BAD CALL	push_xgset30FC
    0421E 2EE2      MOV	R14,R18
    0421F 2EC0      MOV	R12,R16
    04220 9721      SBIW	R28,1
    04221 84A9      LDD	R10,Y+9
(0448) 	}
(0449) /******************************************************************** 
(0450) 函数 名：LCD_print2num
(0451) 入口参数： 显示2数字
(0452) 出口参数：无 
(0453) 函数作用： 
(0454) 说        明： 
(0455) ********************************************************************/ 
(0456) void LCD_print2num(unsigned char x,unsigned char y,unsigned char num){
(0457) unsigned char tem;
(0458) unsigned char a; 
(0459) 
(0460) a=address(x,y);
    04222 2D2E      MOV	R18,R14
    04223 2D0C      MOV	R16,R12
    04224 DD40      RCALL	_address
    04225 2EC0      MOV	R12,R16
(0461) W_1byte(0,0,a);     //显示的地址 
    04226 82C8      ST	Y,R12
    04227 2722      CLR	R18
    04228 2700      CLR	R16
    04229 DE22      RCALL	_W_1byte
(0462) tem=num/10;
    0422A E01A      LDI	R17,0xA
    0422B 2D0A      MOV	R16,R10
    0422C 940E 4B1D CALL	div8u
    0422E 2F40      MOV	R20,R16
(0463) W_1byte(0,1,tem+0x30);
    0422F 2F84      MOV	R24,R20
    04230 5D80      SUBI	R24,0xD0
    04231 8388      ST	Y,R24
    04232 E021      LDI	R18,1
    04233 2700      CLR	R16
    04234 DE17      RCALL	_W_1byte
(0464) tem=num%10;
    04235 E01A      LDI	R17,0xA
    04236 2D0A      MOV	R16,R10
    04237 940E 4B1B CALL	mod8u
    04239 2F40      MOV	R20,R16
(0465) W_1byte(0,1,tem+0x30); 
    0423A 2F84      MOV	R24,R20
    0423B 5D80      SUBI	R24,0xD0
    0423C 8388      ST	Y,R24
    0423D E021      LDI	R18,1
    0423E 2700      CLR	R16
    0423F DE0C      RCALL	_W_1byte
(0466) W_1byte(0,0,0XFF); // 移走地址指针 防止下一输入内容的干扰
    04240 EF8F      LDI	R24,0xFF
    04241 8388      ST	Y,R24
    04242 2722      CLR	R18
    04243 2700      CLR	R16
    04244 DE07      RCALL	_W_1byte
    04245 9621      ADIW	R28,1
    04246 940C 4B97 JMP	pop_xgset30FC
_LCD_print4num:
  tem                  --> R12
  num                  --> R14
  y                    --> R20
  x                    --> R10
    04248 940E 4BAD CALL	push_xgset30FC
    0424A 2F42      MOV	R20,R18
    0424B 2EA0      MOV	R10,R16
    0424C 9721      SBIW	R28,1
    0424D 84E9      LDD	R14,Y+9
    0424E 84FA      LDD	R15,Y+10
(0467) }
(0468)  
(0469) /******************************************************************** 
(0470) 函数 名：LCD_print4num
(0471) 入口参数： 显示4数字
(0472) 出口参数：无 
(0473) 函数作用： 
(0474) 说        明： 
(0475) ********************************************************************/ 
(0476) void LCD_print4num(unsigned char x,unsigned char y,unsigned int num){
(0477) unsigned char tem;
(0478) tem=num/100;
    0424F E624      LDI	R18,0x64
    04250 E030      LDI	R19,0
    04251 0187      MOVW	R16,R14
    04252 940E 4A97 CALL	div16u
    04254 2EC0      MOV	R12,R16
(0479) LCD_print2num(x,y,tem);
    04255 82C8      ST	Y,R12
    04256 2F24      MOV	R18,R20
    04257 2D0A      MOV	R16,R10
    04258 DFC3      RCALL	_LCD_print2num
(0480) 
(0481) tem=num%100;   
    04259 E624      LDI	R18,0x64
    0425A E030      LDI	R19,0
    0425B 0187      MOVW	R16,R14
    0425C 940E 4A95 CALL	mod16u
    0425E 2EC0      MOV	R12,R16
(0482) LCD_print2num(x,y+1,tem);
    0425F 82C8      ST	Y,R12
    04260 2F24      MOV	R18,R20
    04261 5F2F      SUBI	R18,0xFF
    04262 2D0A      MOV	R16,R10
    04263 DFB8      RCALL	_LCD_print2num
(0483) 
(0484) 
(0485)   W_1byte(0,0,0XFF); // 移走地址指针 防止下一输入内容的干扰
    04264 EF8F      LDI	R24,0xFF
    04265 8388      ST	Y,R24
    04266 2722      CLR	R18
    04267 2700      CLR	R16
    04268 DDE3      RCALL	_W_1byte
    04269 9621      ADIW	R28,1
    0426A 940C 4B97 JMP	pop_xgset30FC
_LCD_print:
  a                    --> R12
  ch                   --> R10
  y                    --> R14
  x                    --> R12
    0426C 940E 4BAF CALL	push_xgset00FC
    0426E 2EE2      MOV	R14,R18
    0426F 2EC0      MOV	R12,R16
    04270 9721      SBIW	R28,1
    04271 80AF      LDD	R10,Y+7
(0486) }
(0487)  
(0488) //////////////////////////////////////////////////////////////
(0489) 
(0490) /******************************************************************** 
(0491) 函数 名：LCD_print 
(0492) 入口参数： 显示1 ascii
(0493) 出口参数：无 
(0494) 函数作用： 
(0495) 说        明： 
(0496) ********************************************************************/ 
(0497) void LCD_print(unsigned char x,unsigned char y,unsigned char ch)
(0498) {  
(0499) unsigned char a; 
(0500) a=address(x,y);
    04272 2D2E      MOV	R18,R14
    04273 2D0C      MOV	R16,R12
    04274 DCF0      RCALL	_address
    04275 2EC0      MOV	R12,R16
(0501) W_1byte(0,0,a);     //显示的地址 
    04276 82C8      ST	Y,R12
    04277 2722      CLR	R18
    04278 2700      CLR	R16
    04279 DDD2      RCALL	_W_1byte
(0502) W_1byte(0,1,ch); 
    0427A 82A8      ST	Y,R10
    0427B E021      LDI	R18,1
    0427C 2700      CLR	R16
    0427D DDCE      RCALL	_W_1byte
    0427E 9621      ADIW	R28,1
    0427F 940C 4B90 JMP	pop_xgset00FC
_LCD_print1:
  ch                   --> R10
    04281 92AA      ST	-Y,R10
    04282 2EA0      MOV	R10,R16
    04283 9721      SBIW	R28,1
(0503) 
(0504) 
(0505) 
(0506) }
(0507) /******************************************************************** 
(0508) 函数 名：LCD_print1 
(0509) 入口参数： 显示1 ascii
(0510) 出口参数：无 
(0511) 函数作用：接着上文地址显示，不重设地址 
(0512) 说        明： 
(0513) ********************************************************************/ 
(0514) void LCD_print1(char ch)
(0515) {  
(0516) W_1byte(0,1,ch); 
    04284 82A8      ST	Y,R10
    04285 E021      LDI	R18,1
    04286 2700      CLR	R16
    04287 DDC4      RCALL	_W_1byte
    04288 9621      ADIW	R28,1
    04289 90A9      LD	R10,Y+
    0428A 9508      RET
_lp:
  p                    --> R10
    0428B 92AA      ST	-Y,R10
    0428C 92BA      ST	-Y,R11
    0428D 0158      MOVW	R10,R16
    0428E 9722      SBIW	R28,2
(0517) }
(0518) //////////////////////////////////////////////////////////////
(0519) 
(0520) 
(0521) 
(0522)  void lp(unsigned char *p)
(0523)  {
(0524)  static unsigned char *p1=" ",*p2=" ",*p3=" ",*p4=" ";
(0525)  p4=p3;
    0428F 9020 05F9 LDS	R2,lcd.c:p3
    04291 9030 05FA LDS	R3,lcd.c:p3+1
    04293 9230 05FC STS	lcd.c:p4+1,R3
    04295 9220 05FB STS	lcd.c:p4,R2
(0526)  p3=p2;
    04297 9020 05F7 LDS	R2,lcd.c:p2
    04299 9030 05F8 LDS	R3,lcd.c:p2+1
    0429B 9230 05FA STS	lcd.c:p3+1,R3
    0429D 9220 05F9 STS	lcd.c:p3,R2
(0527)  p2=p1;
    0429F 9020 05F5 LDS	R2,lcd.c:p1
    042A1 9030 05F6 LDS	R3,lcd.c:p1+1
    042A3 9230 05F8 STS	lcd.c:p2+1,R3
    042A5 9220 05F7 STS	lcd.c:p2,R2
(0528)  p1=p;
    042A7 92B0 05F6 STS	lcd.c:p1+1,R11
    042A9 92A0 05F5 STS	lcd.c:p1,R10
(0529)   LCD_const_disp(1,1,"                ");
    042AB EF8D      LDI	R24,0xFD
    042AC E095      LDI	R25,5
    042AD 8399      STD	Y+1,R25
    042AE 8388      ST	Y,R24
    042AF E021      LDI	R18,1
    042B0 E001      LDI	R16,1
    042B1 DCD4      RCALL	_LCD_const_disp
(0530)   LCD_const_disp(2,1,"                ");
    042B2 EF8D      LDI	R24,0xFD
    042B3 E095      LDI	R25,5
    042B4 8399      STD	Y+1,R25
    042B5 8388      ST	Y,R24
    042B6 E021      LDI	R18,1
    042B7 E002      LDI	R16,2
    042B8 DCCD      RCALL	_LCD_const_disp
(0531)   LCD_const_disp(3,1,"                ");
    042B9 EF8D      LDI	R24,0xFD
    042BA E095      LDI	R25,5
    042BB 8399      STD	Y+1,R25
    042BC 8388      ST	Y,R24
    042BD E021      LDI	R18,1
    042BE E003      LDI	R16,3
    042BF DCC6      RCALL	_LCD_const_disp
(0532)   LCD_const_disp(4,1,"                ");
    042C0 EF8D      LDI	R24,0xFD
    042C1 E095      LDI	R25,5
    042C2 8399      STD	Y+1,R25
    042C3 8388      ST	Y,R24
    042C4 E021      LDI	R18,1
    042C5 E004      LDI	R16,4
    042C6 DCBF      RCALL	_LCD_const_disp
(0533)   LCD_var_disp(1,1,p4);
    042C7 9020 05FB LDS	R2,lcd.c:p4
    042C9 9030 05FC LDS	R3,lcd.c:p4+1
    042CB 8239      STD	Y+1,R3
    042CC 8228      ST	Y,R2
    042CD E021      LDI	R18,1
    042CE E001      LDI	R16,1
    042CF DCE3      RCALL	_LCD_var_disp
(0534)   LCD_var_disp(2,1,p3);
    042D0 9020 05F9 LDS	R2,lcd.c:p3
    042D2 9030 05FA LDS	R3,lcd.c:p3+1
    042D4 8239      STD	Y+1,R3
    042D5 8228      ST	Y,R2
    042D6 E021      LDI	R18,1
    042D7 E002      LDI	R16,2
    042D8 DCDA      RCALL	_LCD_var_disp
(0535)   LCD_var_disp(3,1,p2);
    042D9 9020 05F7 LDS	R2,lcd.c:p2
    042DB 9030 05F8 LDS	R3,lcd.c:p2+1
    042DD 8239      STD	Y+1,R3
    042DE 8228      ST	Y,R2
    042DF E021      LDI	R18,1
    042E0 E003      LDI	R16,3
    042E1 DCD1      RCALL	_LCD_var_disp
(0536)   LCD_var_disp(4,1,p1);
    042E2 9020 05F5 LDS	R2,lcd.c:p1
    042E4 9030 05F6 LDS	R3,lcd.c:p1+1
    042E6 8239      STD	Y+1,R3
    042E7 8228      ST	Y,R2
    042E8 E021      LDI	R18,1
    042E9 E004      LDI	R16,4
    042EA DCC8      RCALL	_LCD_var_disp
(0537)   delayms(300);
    042EB E20C      LDI	R16,0x2C
    042EC E011      LDI	R17,1
    042ED 940E 2D70 CALL	_delayms
    042EF 9622      ADIW	R28,2
    042F0 90B9      LD	R11,Y+
    042F1 90A9      LD	R10,Y+
    042F2 9508      RET
FILE: D:\LQD\software\software_src\relay.c
(0001) #include "config.h"
(0002) /*继电器初始化
(0003) *设置端口
(0004) *初始化关闭
(0005) */
(0006) void relay_init(void){
(0007) 	
(0008) 		RELAY_DDR_SET() ;
_relay_init:
    042F3 9AA5      SBI	0x14,5
(0009) 		RELAY_OFF();
    042F4 98AD      CBI	0x15,5
    042F5 9508      RET
(0010) 		//state.Relay = 0;
(0011) 	}	
(0012) 
(0013) /*继电器控制
(0014) *传入 ： 温度
(0015) *传出 ： 当前继电器状态
(0016) *
(0017) */
(0018) unsigned char  relay(int temp)
(0019) {
(0020) 	if(temp<config.heatThreshold)
_relay:
  temp                 --> R16
    042F6 9020 08F0 LDS	R2,config+19
    042F8 2433      CLR	R3
    042F9 1502      CP	R16,R2
    042FA 0513      CPC	R17,R3
    042FB F41C      BGE	0x42FF
(0021) 	{
(0022) 	 		RELAY_DDR_SET();
    042FC 9AA5      SBI	0x14,5
(0023) 			RELAY_ON();
    042FD 9AAD      SBI	0x15,5
(0024) 			//state.Relay = 1 ;
(0025) 	}
    042FE C002      RJMP	0x4301
(0026) 	else
(0027) 	{
(0028) 	 	RELAY_DDR_SET();
    042FF 9AA5      SBI	0x14,5
(0029) 		RELAY_OFF();
    04300 98AD      CBI	0x15,5
(0030) 		//state.Relay = 0 ;
(0031) 	}		
(0032) 	//return state.Relay;
(0033) 	return 0;
    04301 2700      CLR	R16
    04302 9508      RET
_beep:
  i                    --> R10
  short_beep           --> R12
  long_beep            --> R14
    04303 940E 4BAF CALL	push_xgset00FC
    04305 2EC2      MOV	R12,R18
    04306 2EE0      MOV	R14,R16
FILE: D:\LQD\software\software_src\beep.c
(0001) #include "config.h"
(0002) 
(0003) #define BEEP_PORT	PORTC
(0004) #define BEEP_PIN	6
(0005) #define BEEP_OFF() BEEP_PORT|=(1<<BEEP_PIN)
(0006) #define BEEP_ON()  BEEP_PORT&=~(1<<BEEP_PIN)
(0007) //楦ｅ
(0008) void beep(unsigned char long_beep,unsigned char short_beep)
(0009) { 
(0010) unsigned char i;
(0011) DDRB|=(1<<0);
    04307 9AB8      SBI	0x17,0
(0012) for(i=0;i<long_beep;i++)
    04308 24AA      CLR	R10
    04309 C00B      RJMP	0x4315
(0013) {
(0014) BEEP_ON();  delayms(200);
    0430A 98AE      CBI	0x15,6
    0430B EC08      LDI	R16,0xC8
    0430C E010      LDI	R17,0
    0430D 940E 2D70 CALL	_delayms
(0015) BEEP_OFF(); delayms(50);
    0430F 9AAE      SBI	0x15,6
    04310 E302      LDI	R16,0x32
    04311 E010      LDI	R17,0
    04312 940E 2D70 CALL	_delayms
    04314 94A3      INC	R10
    04315 14AE      CP	R10,R14
    04316 F398      BCS	0x430A
(0016) }
(0017) delayms(100);
    04317 E604      LDI	R16,0x64
    04318 E010      LDI	R17,0
    04319 940E 2D70 CALL	_delayms
(0018) for(i=0;i<short_beep;i++)
    0431B 24AA      CLR	R10
    0431C C00B      RJMP	0x4328
(0019) {
(0020) BEEP_ON();  delayms(80);
    0431D 98AE      CBI	0x15,6
    0431E E500      LDI	R16,0x50
    0431F E010      LDI	R17,0
    04320 940E 2D70 CALL	_delayms
(0021) BEEP_OFF(); delayms(50);
    04322 9AAE      SBI	0x15,6
    04323 E302      LDI	R16,0x32
    04324 E010      LDI	R17,0
    04325 940E 2D70 CALL	_delayms
    04327 94A3      INC	R10
    04328 14AC      CP	R10,R12
    04329 F398      BCS	0x431D
    0432A 940C 4B90 JMP	pop_xgset00FC
_Delay_nus:
  i                    --> R20
  n                    --> R16
    0432C 934A      ST	-Y,R20
    0432D 935A      ST	-Y,R21
FILE: D:\LQD\software\software_src\DS18B20_driver.c
(0001) //------------------------------------------------------------------------------
(0002) // 文件名：DS18B20_driver.c
(0003) // 说明：  DS18B20驱动头文件
(0004) // 功能：  实现1-wire器件的读写
(0005) // 使用方法：   void Delay_nus(unsigned int n);             //延时n微秒函数
(0006) //              unsigned char reset_18B20(void);            //18B20复位
(0007) //              void write_bit_18B20(char bitval);          //写一位到18B20
(0008) //              unsigned char read_bit_18B20(void);         //读一位从18B20
(0009) //              void write_byte_18B20(unsigned char data);  //写一字节到18B20
(0010) //              unsigned char read_18B20(void);             //读一字节到18B20
(0011) //
(0012) // 运行平台：   AVR 8bit (M16已验证)
(0013) // 依存关系：   DS18B20_driver.h    DS18B20基本驱动头文件（函数声明）
(0014) // 移植人：     
(0015) // 最后修改：   
(0016) //------------------------------------------------------------------------------
(0017) 
(0018) #include "config.h"
(0019) #define DS18B20_PORT PORTG
(0020) #define DS18B20_PIN  PING
(0021) #define DS18B20_DDR  DDRG
(0022) #define CL_DQ   DS18B20_PORT&=~(1<<T_NUM)					   
(0023) #define SET_DQ  DS18B20_PORT|=(1<<T_NUM)			   
(0024) #define SET_OUT DS18B20_DDR|=(1<<T_NUM)				   
(0025) #define SET_IN  DS18B20_DDR&=~(1<<T_NUM)			   
(0026) #define IN_DQ   DS18B20_PIN&(1<<T_NUM)				  
(0027) unsigned char T_NUM=0;
(0028) 
(0029) 
(0030) //------------------------------------------------------------------------------
(0031) // 延时N微秒程序 供控制读写DS18B20时序使用
(0032) //------------------------------------------------------------------------------
(0033) void Delay_nus(unsigned int n)   
(0034) {  unsigned int i;
(0035) 	  for (i=0;i<n;i++) 
    0432E 2744      CLR	R20
    0432F 2755      CLR	R21
    04330 C005      RJMP	0x4336
(0036) 	  		{NOP();
    04331 0000      NOP
(0037) 						NOP();
    04332 0000      NOP
(0038) 						NOP();				        //20--300//比较接近
    04333 0000      NOP
    04334 5F4F      SUBI	R20,0xFF
    04335 4F5F      SBCI	R21,0xFF
    04336 1740      CP	R20,R16
    04337 0751      CPC	R21,R17
    04338 F3C0      BCS	0x4331
    04339 9159      LD	R21,Y+
    0433A 9149      LD	R20,Y+
    0433B 9508      RET
_reset_18B20:
  bus_flag             --> R10
    0433C 92AA      ST	-Y,R10
(0039) 					}
(0040) }
(0041) 
(0042) 
(0043) //------------------------------------------------------------------------------
(0044) // 1-wire总线复位
(0045) //------------------------------------------------------------------------------
(0046) unsigned char reset_18B20(void)
(0047) {
(0048) 	char bus_flag;
(0049) 	CLI();
    0433D 94F8      BCLR	7
(0050) 	SET_DQ;
    0433E 9110 0610 LDS	R17,T_NUM
    04340 E001      LDI	R16,1
    04341 940E 4C42 CALL	lsl8
    04343 9020 0065 LDS	R2,0x65
    04345 2A20      OR	R2,R16
    04346 9220 0065 STS	0x65,R2
(0051) 	SET_OUT;
    04348 9110 0610 LDS	R17,T_NUM
    0434A E001      LDI	R16,1
    0434B 940E 4C42 CALL	lsl8
    0434D 9020 0064 LDS	R2,0x64
    0434F 2A20      OR	R2,R16
    04350 9220 0064 STS	0x64,R2
(0052)  	
(0053)   	Delay_nus(1);
    04352 E001      LDI	R16,1
    04353 E010      LDI	R17,0
    04354 DFD7      RCALL	_Delay_nus
(0054)   	CL_DQ;
    04355 9110 0610 LDS	R17,T_NUM
    04357 E001      LDI	R16,1
    04358 940E 4C42 CALL	lsl8
    0435A 2E20      MOV	R2,R16
    0435B 9420      COM	R2
    0435C 9030 0065 LDS	R3,0x65
    0435E 2032      AND	R3,R2
    0435F 9230 0065 STS	0x65,R3
(0055)   	Delay_nus(550);		//拉低至少480us时间
    04361 E206      LDI	R16,0x26
    04362 E012      LDI	R17,2
    04363 DFC8      RCALL	_Delay_nus
(0056)   	SET_DQ;				//释放
    04364 9110 0610 LDS	R17,T_NUM
    04366 E001      LDI	R16,1
    04367 940E 4C42 CALL	lsl8
    04369 9020 0065 LDS	R2,0x65
    0436B 2A20      OR	R2,R16
    0436C 9220 0065 STS	0x65,R2
(0057) 					NOP();
    0436E 0000      NOP
(0058) 					NOP();
    0436F 0000      NOP
(0059)   	SET_IN;				//输入
    04370 9110 0610 LDS	R17,T_NUM
    04372 E001      LDI	R16,1
    04373 940E 4C42 CALL	lsl8
    04375 2E20      MOV	R2,R16
    04376 9420      COM	R2
    04377 9030 0064 LDS	R3,0x64
    04379 2032      AND	R3,R2
    0437A 9230 0064 STS	0x64,R3
(0060)   	Delay_nus(60);
    0437C E30C      LDI	R16,0x3C
    0437D E010      LDI	R17,0
    0437E DFAD      RCALL	_Delay_nus
(0061)   	
(0062) 						//等待回复
(0063)   	bus_flag = IN_DQ;
    0437F 9110 0610 LDS	R17,T_NUM
    04381 E001      LDI	R16,1
    04382 940E 4C42 CALL	lsl8
    04384 90A0 0063 LDS	R10,0x63
    04386 22A0      AND	R10,R16
(0064)   	
(0065)   	Delay_nus(240);		//回复的低电平在60到240US
    04387 EF00      LDI	R16,0xF0
    04388 E010      LDI	R17,0
    04389 DFA2      RCALL	_Delay_nus
(0066)   	SET_OUT;
    0438A 9110 0610 LDS	R17,T_NUM
    0438C E001      LDI	R16,1
    0438D 940E 4C42 CALL	lsl8
    0438F 9020 0064 LDS	R2,0x64
    04391 2A20      OR	R2,R16
    04392 9220 0064 STS	0x64,R2
(0067) 					NOP();
    04394 0000      NOP
(0068) 					NOP();
    04395 0000      NOP
(0069)   	SET_DQ;				//回到初始DQ=1；
    04396 9110 0610 LDS	R17,T_NUM
    04398 E001      LDI	R16,1
    04399 940E 4C42 CALL	lsl8
    0439B 9020 0065 LDS	R2,0x65
    0439D 2A20      OR	R2,R16
    0439E 9220 0065 STS	0x65,R2
(0070) 
(0071)   	SEI();
    043A0 9478      BSET	7
(0072) 	if(bus_flag){
    043A1 20AA      TST	R10
    043A2 F011      BEQ	0x43A5
(0073) 		return FALSE;
    043A3 2700      CLR	R16
    043A4 C001      RJMP	0x43A6
(0074) 	}else{
(0075) 		return TRUE;
    043A5 E001      LDI	R16,1
    043A6 90A9      LD	R10,Y+
    043A7 9508      RET
_write_bit_18B20:
  bitval               --> R10
    043A8 92AA      ST	-Y,R10
    043A9 2EA0      MOV	R10,R16
(0076) 	}
(0077) 
(0078) }
(0079) 
(0080) //------------------------------------------------------------------------------
(0081) // 写一位到总线
(0082) //------------------------------------------------------------------------------
(0083) void write_bit_18B20(char bitval)
(0084) {
(0085)     SET_OUT;
    043AA 9110 0610 LDS	R17,T_NUM
    043AC E001      LDI	R16,1
    043AD 940E 4C42 CALL	lsl8
    043AF 9020 0064 LDS	R2,0x64
    043B1 2A20      OR	R2,R16
    043B2 9220 0064 STS	0x64,R2
(0086) 					NOP();
    043B4 0000      NOP
(0087) 					NOP();
    043B5 0000      NOP
(0088) 			 CL_DQ;
    043B6 9110 0610 LDS	R17,T_NUM
    043B8 E001      LDI	R16,1
    043B9 940E 4C42 CALL	lsl8
    043BB 2E20      MOV	R2,R16
    043BC 9420      COM	R2
    043BD 9030 0065 LDS	R3,0x65
    043BF 2032      AND	R3,R2
    043C0 9230 0065 STS	0x65,R3
(0089) 	   Delay_nus(1);
    043C2 E001      LDI	R16,1
    043C3 E010      LDI	R17,0
    043C4 DF67      RCALL	_Delay_nus
(0090) 	   if(bitval){    //写数据，从低位开始
    043C5 20AA      TST	R10
    043C6 F059      BEQ	0x43D2
(0091) 		     SET_DQ;
    043C7 9110 0610 LDS	R17,T_NUM
    043C9 E001      LDI	R16,1
    043CA 940E 4C42 CALL	lsl8
    043CC 9020 0065 LDS	R2,0x65
    043CE 2A20      OR	R2,R16
    043CF 9220 0065 STS	0x65,R2
(0092) 	  }else{
    043D1 C00C      RJMP	0x43DE
(0093) 		     CL_DQ;
    043D2 9110 0610 LDS	R17,T_NUM
    043D4 E001      LDI	R16,1
    043D5 940E 4C42 CALL	lsl8
    043D7 2E20      MOV	R2,R16
    043D8 9420      COM	R2
    043D9 9030 0065 LDS	R3,0x65
    043DB 2032      AND	R3,R2
    043DC 9230 0065 STS	0x65,R3
(0094) 	  }
(0095) 	Delay_nus(40);		//15~60us
    043DE E208      LDI	R16,0x28
    043DF E010      LDI	R17,0
    043E0 DF4B      RCALL	_Delay_nus
(0096) 	SET_DQ;
    043E1 9110 0610 LDS	R17,T_NUM
    043E3 E001      LDI	R16,1
    043E4 940E 4C42 CALL	lsl8
    043E6 9020 0065 LDS	R2,0x65
    043E8 2A20      OR	R2,R16
    043E9 9220 0065 STS	0x65,R2
(0097) 	Delay_nus(10);
    043EB E00A      LDI	R16,0xA
    043EC E010      LDI	R17,0
    043ED DF3E      RCALL	_Delay_nus
    043EE 90A9      LD	R10,Y+
    043EF 9508      RET
_read_bit_18B20:
  k                    --> R10
    043F0 92AA      ST	-Y,R10
(0098) }
(0099) 
(0100) //------------------------------------------------------------------------------
(0101) // 读一位从总线
(0102) //------------------------------------------------------------------------------
(0103) unsigned char read_bit_18B20(void)
(0104) {
(0105) 	unsigned char k;
(0106) 	SET_OUT;
    043F1 9110 0610 LDS	R17,T_NUM
    043F3 E001      LDI	R16,1
    043F4 940E 4C42 CALL	lsl8
    043F6 9020 0064 LDS	R2,0x64
    043F8 2A20      OR	R2,R16
    043F9 9220 0064 STS	0x64,R2
(0107) 	CL_DQ;			//读时间片开始，拉低总线至少1us
    043FB 9110 0610 LDS	R17,T_NUM
    043FD E001      LDI	R16,1
    043FE 940E 4C42 CALL	lsl8
    04400 2E20      MOV	R2,R16
    04401 9420      COM	R2
    04402 9030 0065 LDS	R3,0x65
    04404 2032      AND	R3,R2
    04405 9230 0065 STS	0x65,R3
(0108) 	Delay_nus(1);
    04407 E001      LDI	R16,1
    04408 E010      LDI	R17,0
    04409 DF22      RCALL	_Delay_nus
(0109) 	
(0110) 					//SET_DQ;	
(0111) 	SET_IN;
    0440A 9110 0610 LDS	R17,T_NUM
    0440C E001      LDI	R16,1
    0440D 940E 4C42 CALL	lsl8
    0440F 2E20      MOV	R2,R16
    04410 9420      COM	R2
    04411 9030 0064 LDS	R3,0x64
    04413 2032      AND	R3,R2
    04414 9230 0064 STS	0x64,R3
(0112) 	Delay_nus(4);
    04416 E004      LDI	R16,4
    04417 E010      LDI	R17,0
    04418 DF13      RCALL	_Delay_nus
(0113) 	k=IN_DQ;    	//读数据,从低位开始
    04419 9110 0610 LDS	R17,T_NUM
    0441B E001      LDI	R16,1
    0441C 940E 4C42 CALL	lsl8
    0441E 90A0 0063 LDS	R10,0x63
    04420 22A0      AND	R10,R16
(0114) 	Delay_nus(10);
    04421 E00A      LDI	R16,0xA
    04422 E010      LDI	R17,0
    04423 DF08      RCALL	_Delay_nus
(0115) 	SET_DQ;	
    04424 9110 0610 LDS	R17,T_NUM
    04426 E001      LDI	R16,1
    04427 940E 4C42 CALL	lsl8
    04429 9020 0065 LDS	R2,0x65
    0442B 2A20      OR	R2,R16
    0442C 9220 0065 STS	0x65,R2
(0116) 				NOP();
    0442E 0000      NOP
(0117) 				NOP();
    0442F 0000      NOP
(0118) 	SET_OUT;
    04430 9110 0610 LDS	R17,T_NUM
    04432 E001      LDI	R16,1
    04433 940E 4C42 CALL	lsl8
    04435 9020 0064 LDS	R2,0x64
    04437 2A20      OR	R2,R16
    04438 9220 0064 STS	0x64,R2
(0119) 	    NOP();
    0443A 0000      NOP
(0120) 					NOP();
    0443B 0000      NOP
(0121) 	if(k){
    0443C 20AA      TST	R10
    0443D F011      BEQ	0x4440
(0122) 	    return 1;
    0443E E001      LDI	R16,1
    0443F C001      RJMP	0x4441
(0123) 	}else{
(0124) 	    return 0;
    04440 2700      CLR	R16
    04441 90A9      LD	R10,Y+
    04442 9508      RET
_write_byte_18B20:
  i                    --> R20
  data                 --> R10
    04443 92AA      ST	-Y,R10
    04444 934A      ST	-Y,R20
    04445 2EA0      MOV	R10,R16
(0125) 	}
(0126) 	
(0127) }
(0128) 
(0129) //------------------------------------------------------------------------------
(0130) // 写一个字节到总线
(0131) //------------------------------------------------------------------------------
(0132) void write_byte_18B20(unsigned char data)
(0133) {
(0134) 	unsigned char i;
(0135)    CLI();
    04446 94F8      BCLR	7
(0136)     for(i=0;i<8;i++)
    04447 2744      CLR	R20
    04448 C009      RJMP	0x4452
(0137)     {
(0138)         write_bit_18B20(data&(1<<i));
    04449 E001      LDI	R16,1
    0444A 2F14      MOV	R17,R20
    0444B 940E 4C42 CALL	lsl8
    0444D 2E20      MOV	R2,R16
    0444E 2D0A      MOV	R16,R10
    0444F 2102      AND	R16,R2
    04450 DF57      RCALL	_write_bit_18B20
    04451 9543      INC	R20
    04452 3048      CPI	R20,0x8
    04453 F3A8      BCS	0x4449
(0139)         
(0140)     }
(0141)     SET_DQ;
    04454 9110 0610 LDS	R17,T_NUM
    04456 E001      LDI	R16,1
    04457 940E 4C42 CALL	lsl8
    04459 9020 0065 LDS	R2,0x65
    0445B 2A20      OR	R2,R16
    0445C 9220 0065 STS	0x65,R2
(0142) 				  NOP();
    0445E 0000      NOP
(0143) 					 NOP();
    0445F 0000      NOP
(0144)     SEI();
    04460 9478      BSET	7
    04461 9149      LD	R20,Y+
    04462 90A9      LD	R10,Y+
    04463 9508      RET
_read_byte_18B20:
  temp                 --> R10
  n                    --> R20
    04464 92AA      ST	-Y,R10
    04465 934A      ST	-Y,R20
(0145)     
(0146)     //return;
(0147) }
(0148) 
(0149) //------------------------------------------------------------------------------
(0150) // 读一个字节
(0151) //------------------------------------------------------------------------------
(0152) unsigned char read_byte_18B20(void)
(0153) {
(0154) 	unsigned char temp,n;
(0155)     CLI();
    04466 94F8      BCLR	7
(0156)   	temp=0;
    04467 24AA      CLR	R10
(0157)     for(n=0;n<8;n++)
    04468 2744      CLR	R20
    04469 C014      RJMP	0x447E
(0158)     {
(0159)       	if(read_bit_18B20()){
    0446A DF85      RCALL	_read_bit_18B20
    0446B 2300      TST	R16
    0446C F031      BEQ	0x4473
(0160)       		temp|=(1<<n);
    0446D E001      LDI	R16,1
    0446E 2F14      MOV	R17,R20
    0446F 940E 4C42 CALL	lsl8
    04471 2AA0      OR	R10,R16
(0161)       	}else{
    04472 C007      RJMP	0x447A
(0162)       		temp&=~(1<<n);
    04473 E001      LDI	R16,1
    04474 2F14      MOV	R17,R20
    04475 940E 4C42 CALL	lsl8
    04477 2E20      MOV	R2,R16
    04478 9420      COM	R2
    04479 20A2      AND	R10,R2
(0163)       	}
(0164)       	Delay_nus(70); //60~120us
    0447A E406      LDI	R16,0x46
    0447B E010      LDI	R17,0
    0447C DEAF      RCALL	_Delay_nus
    0447D 9543      INC	R20
    0447E 3048      CPI	R20,0x8
    0447F F350      BCS	0x446A
(0165)       	
(0166)    }
(0167)    SEI();
    04480 9478      BSET	7
(0168) 
(0169)    return temp;
    04481 2D0A      MOV	R16,R10
    04482 9149      LD	R20,Y+
    04483 90A9      LD	R10,Y+
    04484 9508      RET
(0170) }
(0171) 
(0172) 
(0173) 
(0174) //------------------------------------------------------------------------------
(0175) // 应用函数部分！ 供外部调用
(0176) //------------------------------------------------------------------------------
(0177) //------------------------------------------------------------------------------
(0178) // 单器件/多器件：开始转换
(0179) //------------------------------------------------------------------------------
(0180) void convert_T(void)
(0181) {
(0182) 					if(reset_18B20()){
_convert_T:
    04485 DEB6      RCALL	_reset_18B20
    04486 2300      TST	R16
    04487 F021      BEQ	0x448C
(0183) 					write_byte_18B20(0xcc);
    04488 EC0C      LDI	R16,0xCC
    04489 DFB9      RCALL	_write_byte_18B20
(0184) 					write_byte_18B20(0x44);
    0448A E404      LDI	R16,0x44
    0448B DFB7      RCALL	_write_byte_18B20
(0185) 					}
    0448C 9508      RET
_read_T:
  tmp                  --> Y,+0
  tl                   --> R12
  th                   --> R10
    0448D 940E 4BAF CALL	push_xgset00FC
    0448F 9724      SBIW	R28,4
(0186) }
(0187) 
(0188) //------------------------------------------------------------------------------
(0189) // 单器件：读温度，返回INIT8U型温度数据（原始数据）
(0190) //------------------------------------------------------------------------------
(0191) float read_T(void)
(0192) {
(0193)     unsigned char th=0,tl=0;
    04490 24AA      CLR	R10
    04491 24CC      CLR	R12
(0194) 	float tmp;
(0195)     if(reset_18B20()){
    04492 DEA9      RCALL	_reset_18B20
    04493 2300      TST	R16
    04494 F021      BEQ	0x4499
(0196)     	write_byte_18B20(0xcc);
    04495 EC0C      LDI	R16,0xCC
    04496 DFAC      RCALL	_write_byte_18B20
(0197)     	write_byte_18B20(0xbe);
    04497 EB0E      LDI	R16,0xBE
    04498 DFAA      RCALL	_write_byte_18B20
(0198)     }
(0199)     
(0200)     tl = read_byte_18B20();
    04499 DFCA      RCALL	_read_byte_18B20
    0449A 2EC0      MOV	R12,R16
(0201)     th = read_byte_18B20();
    0449B DFC8      RCALL	_read_byte_18B20
    0449C 2EE0      MOV	R14,R16
    0449D 2CAE      MOV	R10,R14
(0202)  	tmp= ((float)(th<<8|tl))*0.0625;
    0449E EE08      LDI	R16,0xE8
    0449F E010      LDI	R17,0
    044A0 940E 4B33 CALL	elpm32
    044A2 0118      MOVW	R2,R16
    044A3 0129      MOVW	R4,R18
    044A4 2D1A      MOV	R17,R10
    044A5 2D0C      MOV	R16,R12
    044A6 940E 4D56 CALL	int2fp
    044A8 933A      ST	-Y,R19
    044A9 932A      ST	-Y,R18
    044AA 931A      ST	-Y,R17
    044AB 930A      ST	-Y,R16
    044AC 0181      MOVW	R16,R2
    044AD 0192      MOVW	R18,R4
    044AE 940E 4EFB CALL	fpmule2
    044B0 8308      ST	Y,R16
    044B1 8319      STD	Y+1,R17
    044B2 832A      STD	Y+2,R18
    044B3 833B      STD	Y+3,R19
(0203)     return( tmp);
    044B4 8108      LD	R16,Y
    044B5 8119      LDD	R17,Y+1
    044B6 812A      LDD	R18,Y+2
    044B7 813B      LDD	R19,Y+3
    044B8 9624      ADIW	R28,4
    044B9 940C 4B90 JMP	pop_xgset00FC
_read_T_NUM:
  ttemp                --> Y,+0
  NUM                  --> R10
    044BB 92AA      ST	-Y,R10
    044BC 2EA0      MOV	R10,R16
    044BD 9724      SBIW	R28,4
(0204) }
(0205) 
(0206) float read_T_NUM(unsigned char NUM){
(0207) float ttemp;
(0208) if ( NUM >1) return 123.45;
    044BE E081      LDI	R24,1
    044BF 158A      CP	R24,R10
    044C0 F428      BCC	0x44C6
    044C1 EE04      LDI	R16,0xE4
    044C2 E010      LDI	R17,0
    044C3 940E 4B33 CALL	elpm32
    044C5 C010      RJMP	0x44D6
(0209) T_NUM=NUM;//设置访问器件
    044C6 92A0 0610 STS	T_NUM,R10
(0210) convert_T();//温度转换
    044C8 DFBC      RCALL	_convert_T
(0211) delayms(800);
    044C9 E200      LDI	R16,0x20
    044CA E013      LDI	R17,3
    044CB 940E 2D70 CALL	_delayms
(0212) ttemp=read_T();
    044CD DFBF      RCALL	_read_T
    044CE 8308      ST	Y,R16
    044CF 8319      STD	Y+1,R17
    044D0 832A      STD	Y+2,R18
    044D1 833B      STD	Y+3,R19
(0213) return ttemp;
    044D2 8108      LD	R16,Y
    044D3 8119      LDD	R17,Y+1
    044D4 812A      LDD	R18,Y+2
    044D5 813B      LDD	R19,Y+3
    044D6 9624      ADIW	R28,4
    044D7 90A9      LD	R10,Y+
    044D8 9508      RET
_readWithoutDelay:
  ttemp                --> Y,+0
  NUM                  --> R10
    044D9 92AA      ST	-Y,R10
    044DA 2EA0      MOV	R10,R16
    044DB 9724      SBIW	R28,4
(0214) }
(0215) float readWithoutDelay(unsigned char NUM)
(0216) {
(0217) float ttemp;
(0218) if ( NUM >1) return 123.45;
    044DC E081      LDI	R24,1
    044DD 158A      CP	R24,R10
    044DE F428      BCC	0x44E4
    044DF EE04      LDI	R16,0xE4
    044E0 E010      LDI	R17,0
    044E1 940E 4B33 CALL	elpm32
    044E3 C00C      RJMP	0x44F0
(0219) T_NUM=NUM;//设置访问器件
    044E4 92A0 0610 STS	T_NUM,R10
(0220) ttemp=read_T();
    044E6 DFA6      RCALL	_read_T
    044E7 8308      ST	Y,R16
    044E8 8319      STD	Y+1,R17
    044E9 832A      STD	Y+2,R18
    044EA 833B      STD	Y+3,R19
(0221) convert_T();//温度转换
    044EB DF99      RCALL	_convert_T
(0222) return ttemp;
    044EC 8108      LD	R16,Y
    044ED 8119      LDD	R17,Y+1
    044EE 812A      LDD	R18,Y+2
    044EF 813B      LDD	R19,Y+3
    044F0 9624      ADIW	R28,4
    044F1 90A9      LD	R10,Y+
    044F2 9508      RET
FILE: D:\LQD\software\software_src\ds1302.c
(0001) #include "config.h"
(0002) 
(0003) #define TPORT PORTB
(0004) #define TDDR DDRB
(0005) #define TPIN PINB
(0006) #define PIN_RST	 4
(0007) #define PIN_IO	 5
(0008) #define PIN_SCK	 6
(0009) /******************复位脚*********************/
(0010) #define RST_CLR	TPORT &= ~(1 << PIN_RST)   /*电平置低*/
(0011) #define RST_SET	TPORT |= (1 << PIN_RST)    /*电平置高*/
(0012) #define RST_IN	TDDR &= ~(1 << PIN_RST)    /*方向输入*/
(0013) #define RST_OUT	TDDR |= (1 << PIN_RST)     /*方向输出*/
(0014) 
(0015) /*****************双向数据********************/
(0016) #define IO_CLR	TPORT &= ~(1 << PIN_IO)  /*电平置低*/
(0017) #define IO_SET	TPORT |= (1 << PIN_IO)   /*电平置高*/
(0018) #define IO_R	TPIN & (1 << PIN_IO)     /*电平读取*/
(0019) #define IO_IN	TDDR &= ~(1 << PIN_IO)   /*方向输入*/
(0020) #define IO_OUT	TDDR |= (1 << PIN_IO)    /*方向输出*/
(0021) 
(0022) /*****************时钟信号*******************/
(0023) #define SCK_CLR	TPORT &= ~(1 << PIN_SCK)  /*时钟信号*/
(0024) #define SCK_SET	TPORT |= (1 << PIN_SCK)   /*电平置高*/
(0025) #define SCK_IN	TDDR &= ~(1 << PIN_SCK)   /*方向输入*/
(0026) #define SCK_OUT	TDDR |= (1 << PIN_SCK)    /*方向输出*/
(0027) 
(0028) #define ds1302_sec_add			0x80		//秒数据地址
(0029) #define ds1302_min_add			0x82		//分数据地址
(0030) #define ds1302_hr_add			0x84		//时数据地址
(0031) #define ds1302_date_add			0x86		//日数据地址
(0032) #define ds1302_month_add		0x88		//月数据地址
(0033) #define ds1302_day_add			0x8a		//星期数据地址
(0034) #define ds1302_year_add			0x8c		//年数据地址
(0035) #define ds1302_control_add		0x8e		//控制数据地址
(0036) #define ds1302_charger_add		0x90 					 
(0037) #define ds1302_clkburst_add		0xbe
(0038) 
(0039) unsigned char time_buf[8] = {0x20,0x0c,0x0A,0x1c,0x22,0x46,0x00,0x06};
(0040) /*
(0041)  struct tm {
(0042)    	int tm_sec;   // 秒 seconds after the minute, 0 to 60
(0043)    	int tm_min;   // 分 minutes after the hour, 0 to 59
(0044) 	int tm_hour;  // 时 hours since midnight, 0 to 23*
(0045) 	int tm_mday;  // 日 day of the month, 1 to 31
(0046) 	int tm_mon;   // 月 months since January, 0 to 11
(0047) 	int tm_year;  // 年 years since 1900
(0048) 	int tm_wday;  // 星期 days since Sunday, 0 to 6
(0049) 	int tm_yday;  // 从元旦起的天数 days since January 1, 0 to 365
(0050)  	int tm_isdst; // 夏令时？？Daylight Savings Time flag
(0051)  	};	
(0052) 	*/
(0053) 
(0054) //DS1302初始化函数
(0055) void ds1302_init(void) 
(0056) {
(0057) 	RST_CLR;			/*RST脚置低*/
_ds1302_init:
    044F3 98C4      CBI	0x18,4
(0058) 	SCK_CLR;			/*SCK脚置低*/
    044F4 98C6      CBI	0x18,6
(0059) 	RST_OUT;			/*RST脚设置为输出*/
    044F5 9ABC      SBI	0x17,4
(0060) 	SCK_OUT;			/*SCK脚设置为输出*/
    044F6 9ABE      SBI	0x17,6
    044F7 9508      RET
_ds1302_write_byte:
  i                    --> R20
  d                    --> R18
  addr                 --> R16
    044F8 934A      ST	-Y,R20
(0061) }
(0062) 
(0063) //向DS1302写入一字节数据
(0064) void ds1302_write_byte(unsigned char addr, unsigned char d) {
(0065) 
(0066) 	unsigned char i;
(0067) 	RST_SET;					/*启动DS1302总线*/
    044F9 9AC4      SBI	0x18,4
(0068) 	
(0069) 	/*写入目标地址：addr*/
(0070) 	IO_OUT;
    044FA 9ABD      SBI	0x17,5
(0071) 	addr = addr & 0xFE;   //最低位置零，寄存器0位为0时写，为1时读
    044FB 7F0E      ANDI	R16,0xFE
(0072) 	for (i = 0; i < 8; i ++) {
    044FC 2744      CLR	R20
    044FD C009      RJMP	0x4507
(0073) 		if (addr & 0x01) {
    044FE FF00      SBRS	R16,0
    044FF C002      RJMP	0x4502
(0074) 			IO_SET;
    04500 9AC5      SBI	0x18,5
(0075) 			}
    04501 C001      RJMP	0x4503
(0076) 		else {
(0077) 			IO_CLR;
    04502 98C5      CBI	0x18,5
(0078) 			}
(0079) 		SCK_SET;      //产生时钟
    04503 9AC6      SBI	0x18,6
(0080) 		SCK_CLR;
    04504 98C6      CBI	0x18,6
(0081) 		addr = addr >> 1;
    04505 9506      LSR	R16
    04506 9543      INC	R20
    04507 3048      CPI	R20,0x8
    04508 F3A8      BCS	0x44FE
(0082) 		}
(0083) 	
(0084) 	/*写入数据：d*/
(0085) 	IO_OUT;
    04509 9ABD      SBI	0x17,5
(0086) 	for (i = 0; i < 8; i ++) {
    0450A 2744      CLR	R20
    0450B C009      RJMP	0x4515
(0087) 		if (d & 0x01) {
    0450C FF20      SBRS	R18,0
    0450D C002      RJMP	0x4510
(0088) 			IO_SET;
    0450E 9AC5      SBI	0x18,5
(0089) 			}
    0450F C001      RJMP	0x4511
(0090) 		else {
(0091) 			IO_CLR;
    04510 98C5      CBI	0x18,5
(0092) 			}
(0093) 		SCK_SET;    //产生时钟
    04511 9AC6      SBI	0x18,6
(0094) 		SCK_CLR;
    04512 98C6      CBI	0x18,6
(0095) 		d = d >> 1;
    04513 9526      LSR	R18
    04514 9543      INC	R20
    04515 3048      CPI	R20,0x8
    04516 F3A8      BCS	0x450C
(0096) 		}
(0097) 	RST_CLR;		//停止DS1302总线
    04517 98C4      CBI	0x18,4
    04518 9149      LD	R20,Y+
    04519 9508      RET
_ds1302_read_byte:
  temp                 --> R20
  i                    --> R22
  addr                 --> R16
    0451A 934A      ST	-Y,R20
    0451B 936A      ST	-Y,R22
(0098) 	
(0099) }
(0100) 
(0101) //从DS1302读出一字节数据
(0102) unsigned char ds1302_read_byte(unsigned char addr) {
(0103) 
(0104) 	unsigned char i;
(0105) 	unsigned char temp;
(0106) 	RST_SET;					/*启动DS1302总线*/
    0451C 9AC4      SBI	0x18,4
(0107) 
(0108) 	/*写入目标地址：addr*/
(0109) 	IO_OUT;
    0451D 9ABD      SBI	0x17,5
(0110) 	addr = addr | 0x01;    //最低位置高，寄存器0位为0时写，为1时读
    0451E 6001      ORI	R16,1
(0111) 	for (i = 0; i < 8; i ++) {
    0451F 2766      CLR	R22
    04520 C009      RJMP	0x452A
(0112) 		if (addr & 0x01) {
    04521 FF00      SBRS	R16,0
    04522 C002      RJMP	0x4525
(0113) 			IO_SET;
    04523 9AC5      SBI	0x18,5
(0114) 			}
    04524 C001      RJMP	0x4526
(0115) 		else {
(0116) 			IO_CLR;
    04525 98C5      CBI	0x18,5
(0117) 			}
(0118) 		SCK_SET;
    04526 9AC6      SBI	0x18,6
(0119) 		SCK_CLR;
    04527 98C6      CBI	0x18,6
(0120) 		addr = addr >> 1;
    04528 9506      LSR	R16
    04529 9563      INC	R22
    0452A 3068      CPI	R22,0x8
    0452B F3A8      BCS	0x4521
(0121) 		}
(0122) 	
(0123) 	/*输出数据：temp*/
(0124) 	IO_IN;
    0452C 98BD      CBI	0x17,5
(0125) 	for (i = 0; i < 8; i ++) {
    0452D 2766      CLR	R22
    0452E C009      RJMP	0x4538
(0126) 		temp = temp >> 1;
    0452F 9546      LSR	R20
(0127) 		if (IO_R) {
    04530 9BB5      SBIS	0x16,5
    04531 C002      RJMP	0x4534
(0128) 			temp |= 0x80;
    04532 6840      ORI	R20,0x80
(0129) 			}
    04533 C001      RJMP	0x4535
(0130) 		else {
(0131) 			temp &= 0x7F;
    04534 774F      ANDI	R20,0x7F
(0132) 			}
(0133) 		SCK_SET;
    04535 9AC6      SBI	0x18,6
(0134) 		SCK_CLR;
    04536 98C6      CBI	0x18,6
    04537 9563      INC	R22
    04538 3068      CPI	R22,0x8
    04539 F3A8      BCS	0x452F
(0135) 		}
(0136) 	
(0137) 	RST_CLR;					/*停止DS1302总线*/
    0453A 98C4      CBI	0x18,4
(0138) 	return temp;
    0453B 2F04      MOV	R16,R20
    0453C 9169      LD	R22,Y+
    0453D 9149      LD	R20,Y+
    0453E 9508      RET
(0139) }
(0140) 
(0141) //向DS302写入时钟数据
(0142) void ds1302_write_time(void) {
(0143) 
(0144) 	ds1302_write_byte(ds1302_control_add,0x00);			//关闭写保护 
_ds1302_write_time:
    0453F 2722      CLR	R18
    04540 E80E      LDI	R16,0x8E
    04541 DFB6      RCALL	_ds1302_write_byte
(0145) 	ds1302_write_byte(ds1302_sec_add,0x80);				//暂停时钟 
    04542 E820      LDI	R18,0x80
    04543 E800      LDI	R16,0x80
    04544 DFB3      RCALL	_ds1302_write_byte
(0146) 	//ds1302_write_byte(ds1302_charger_add,0xa9);	    //涓流充电 
(0147) 	ds1302_write_byte(ds1302_year_add,time_buf[1]);		//年 
    04545 9120 0612 LDS	R18,time_buf+1
    04547 E80C      LDI	R16,0x8C
    04548 DFAF      RCALL	_ds1302_write_byte
(0148) 	ds1302_write_byte(ds1302_month_add,time_buf[2]);	//月 
    04549 9120 0613 LDS	R18,time_buf+2
    0454B E808      LDI	R16,0x88
    0454C DFAB      RCALL	_ds1302_write_byte
(0149) 	ds1302_write_byte(ds1302_date_add,time_buf[3]);		//日 
    0454D 9120 0614 LDS	R18,time_buf+3
    0454F E806      LDI	R16,0x86
    04550 DFA7      RCALL	_ds1302_write_byte
(0150) 	ds1302_write_byte(ds1302_hr_add,time_buf[4]);		//时 
    04551 9120 0615 LDS	R18,time_buf+4
    04553 E804      LDI	R16,0x84
    04554 DFA3      RCALL	_ds1302_write_byte
(0151) 	ds1302_write_byte(ds1302_min_add,time_buf[5]);		//分
    04555 9120 0616 LDS	R18,time_buf+5
    04557 E802      LDI	R16,0x82
    04558 DF9F      RCALL	_ds1302_write_byte
(0152) 	ds1302_write_byte(ds1302_sec_add,time_buf[6]);		//秒
    04559 9120 0617 LDS	R18,time_buf+6
    0455B E800      LDI	R16,0x80
    0455C DF9B      RCALL	_ds1302_write_byte
(0153) 	ds1302_write_byte(ds1302_day_add,time_buf[7]);		//周 
    0455D 9120 0618 LDS	R18,time_buf+7
    0455F E80A      LDI	R16,0x8A
    04560 DF97      RCALL	_ds1302_write_byte
(0154) 	ds1302_write_byte(ds1302_control_add,0x80);			//打开写保护 
    04561 E820      LDI	R18,0x80
    04562 E80E      LDI	R16,0x8E
    04563 CF94      RJMP	_ds1302_write_byte
_ds1302_read_time:
    04564 92AA      ST	-Y,R10
    04565 934A      ST	-Y,R20
(0155) }
(0156) 
(0157) //从DS302读出时钟数据
(0158) void ds1302_read_time(void)  { 
(0159) 	time_buf[1]=ds1302_read_byte(ds1302_year_add);		//年 
    04566 E80C      LDI	R16,0x8C
    04567 DFB2      RCALL	_ds1302_read_byte
    04568 9300 0612 STS	time_buf+1,R16
(0160) 	time_buf[2]=ds1302_read_byte(ds1302_month_add);		//月 
    0456A E808      LDI	R16,0x88
    0456B DFAE      RCALL	_ds1302_read_byte
    0456C 9300 0613 STS	time_buf+2,R16
(0161) 	time_buf[3]=ds1302_read_byte(ds1302_date_add);		//日 
    0456E E806      LDI	R16,0x86
    0456F DFAA      RCALL	_ds1302_read_byte
    04570 2EA0      MOV	R10,R16
    04571 92A0 0614 STS	time_buf+3,R10
(0162) 	time_buf[4]=ds1302_read_byte(ds1302_hr_add);		//时 
    04573 E804      LDI	R16,0x84
    04574 DFA5      RCALL	_ds1302_read_byte
    04575 2EA0      MOV	R10,R16
    04576 92A0 0615 STS	time_buf+4,R10
(0163) 	time_buf[5]=ds1302_read_byte(ds1302_min_add);		//分 
    04578 E802      LDI	R16,0x82
    04579 DFA0      RCALL	_ds1302_read_byte
    0457A 2EA0      MOV	R10,R16
    0457B 92A0 0616 STS	time_buf+5,R10
(0164) 	time_buf[6]=(ds1302_read_byte(ds1302_sec_add))&0x7F;//秒，屏蔽秒的第7位，避免超出59
    0457D E800      LDI	R16,0x80
    0457E DF9B      RCALL	_ds1302_read_byte
    0457F 2F40      MOV	R20,R16
    04580 2F84      MOV	R24,R20
    04581 778F      ANDI	R24,0x7F
    04582 9380 0617 STS	time_buf+6,R24
(0165) 	time_buf[7]=ds1302_read_byte(ds1302_day_add);		//周 
    04584 E80A      LDI	R16,0x8A
    04585 DF94      RCALL	_ds1302_read_byte
    04586 2EA0      MOV	R10,R16
    04587 92A0 0618 STS	time_buf+7,R10
    04589 9149      LD	R20,Y+
    0458A 90A9      LD	R10,Y+
    0458B 9508      RET
_kbscan:
  key                  --> R20
  temp                 --> Y,+0
    0458C 934A      ST	-Y,R20
    0458D 9724      SBIW	R28,4
FILE: D:\LQD\software\software_src\key.c
(0001) #include "config.h"
(0002) //键盘扫描函数
(0003) unsigned char kbscan(void)
(0004)   {
(0005)    unsigned char key;
(0006)    unsigned long temp=0;
    0458E E080      LDI	R24,0
    0458F 8388      ST	Y,R24
    04590 8389      STD	Y+1,R24
    04591 838A      STD	Y+2,R24
    04592 838B      STD	Y+3,R24
(0007)    DDR_SET;
    04593 B38A      IN	R24,0x1A
    04594 7087      ANDI	R24,7
    04595 BB8A      OUT	0x1A,R24
(0008)    
(0009)    if((KEY_PIN) != KEY_MASK)         //检测A口按键引脚电平，如果全是高电平则退出
    04596 B389      IN	R24,0x19
    04597 718F      ANDI	R24,0x1F
    04598 318F      CPI	R24,0x1F
    04599 F1A9      BEQ	0x45CF
(0010)     {
(0011)      delayms(20);           //防抖
    0459A E104      LDI	R16,0x14
    0459B E010      LDI	R17,0
    0459C 940E 2D70 CALL	_delayms
(0012)      if((KEY_PIN) != KEY_MASK )      //再次检测A口电平，如果不全是高电平则继续执行程序
    0459E B389      IN	R24,0x19
    0459F 718F      ANDI	R24,0x1F
    045A0 318F      CPI	R24,0x1F
    045A1 F179      BEQ	0x45D1
(0013)       {
(0014)        key = KEY_PIN ;          //读取PINA，将其存放在key中
    045A2 B349      IN	R20,0x19
    045A3 714F      ANDI	R20,0x1F
    045A4 C024      RJMP	0x45C9
(0015)         while((KEY_PIN) != KEY_MASK)
(0016) 		{
(0017) 		 temp++ ;
    045A5 E081      LDI	R24,1
    045A6 E090      LDI	R25,0
    045A7 E0A0      LDI	R26,0
    045A8 E0B0      LDI	R27,0
    045A9 8028      LD	R2,Y
    045AA 8039      LDD	R3,Y+1
    045AB 804A      LDD	R4,Y+2
    045AC 805B      LDD	R5,Y+3
    045AD 0E28      ADD	R2,R24
    045AE 1E39      ADC	R3,R25
    045AF 1E4A      ADC	R4,R26
    045B0 1E5B      ADC	R5,R27
    045B1 8228      ST	Y,R2
    045B2 8239      STD	Y+1,R3
    045B3 824A      STD	Y+2,R4
    045B4 825B      STD	Y+3,R5
(0018) 		 if(temp>LONGKEY) {  
    045B5 E880      LDI	R24,0x80
    045B6 E398      LDI	R25,0x38
    045B7 E0A1      LDI	R26,1
    045B8 E0B0      LDI	R27,0
    045B9 8028      LD	R2,Y
    045BA 8039      LDD	R3,Y+1
    045BB 804A      LDD	R4,Y+2
    045BC 805B      LDD	R5,Y+3
    045BD 1582      CP	R24,R2
    045BE 0593      CPC	R25,R3
    045BF 05A4      CPC	R26,R4
    045C0 05B5      CPC	R27,R5
    045C1 F438      BCC	0x45C9
(0019) 		     delayms(30);
    045C2 E10E      LDI	R16,0x1E
    045C3 E010      LDI	R17,0
    045C4 940E 2D70 CALL	_delayms
(0020) 			 return key+0x80;  
    045C6 2F04      MOV	R16,R20
    045C7 5800      SUBI	R16,0x80
    045C8 C009      RJMP	0x45D2
    045C9 B389      IN	R24,0x19
    045CA 718F      ANDI	R24,0x1F
    045CB 318F      CPI	R24,0x1F
    045CC F6C1      BNE	0x45A5
(0021) 		 };
(0022) 		}
(0023) 		; //当前有按键处于按下状态，再按其他按键时程序维持当前状态 
(0024)       	
(0025) 		return key;
    045CD 2F04      MOV	R16,R20
    045CE C003      RJMP	0x45D2
(0026) 	  
(0027) 	  }
(0028)     }
(0029) 	else return NO_KEY;
    045CF 2700      CLR	R16
    045D0 C001      RJMP	0x45D2
(0030) 	
(0031) 	return NO_KEY;
FILE: <library>
    045D1 2700      CLR	R16
    045D2 9624      ADIW	R28,4
    045D3 9149      LD	R20,Y+
    045D4 9508      RET
__print:
    045D5 940E 4A66 CALL	push_arg4
    045D7 940E 4BAB CALL	push_xgsetF0FC
    045D9 976C      SBIW	R28,0x1C
    045DA 2400      CLR	R0
    045DB 2411      CLR	R1
    045DC 8A1F      STD	Y+23,R1
    045DD 8A0E      STD	Y+22,R0
    045DE C456      RJMP	0x4A35
    045DF A5E8      LDD	R30,Y+40
    045E0 A5F9      LDD	R31,Y+41
    045E1 8180      LD	R24,Z
    045E2 3285      CPI	R24,0x25
    045E3 F059      BEQ	0x45EF
    045E4 8100      LD	R16,Z
    045E5 A1EE      LDD	R30,Y+38
    045E6 A1FF      LDD	R31,Y+39
    045E7 940E 4BF8 CALL	xicallx
    045E9 898E      LDD	R24,Y+22
    045EA 899F      LDD	R25,Y+23
    045EB 9601      ADIW	R24,1
    045EC 8B9F      STD	Y+23,R25
    045ED 8B8E      STD	Y+22,R24
    045EE C441      RJMP	0x4A30
    045EF 2400      CLR	R0
    045F0 2411      CLR	R1
    045F1 8A1D      STD	Y+21,R1
    045F2 8A0C      STD	Y+20,R0
    045F3 EF8F      LDI	R24,0xFF
    045F4 EF9F      LDI	R25,0xFF
    045F5 8F99      STD	Y+25,R25
    045F6 8F88      STD	Y+24,R24
    045F7 24AA      CLR	R10
    045F8 24BB      CLR	R11
    045F9 E544      LDI	R20,0x54
    045FA E059      LDI	R21,0x9
    045FB E260      LDI	R22,0x20
    045FC A588      LDD	R24,Y+40
    045FD A599      LDD	R25,Y+41
    045FE 9601      ADIW	R24,1
    045FF A799      STD	Y+41,R25
    04600 A788      STD	Y+40,R24
    04601 24CC      CLR	R12
    04602 24DD      CLR	R13
    04603 A5E8      LDD	R30,Y+40
    04604 A5F9      LDD	R31,Y+41
    04605 80E0      LD	R14,Z
    04606 24FF      CLR	R15
    04607 01C7      MOVW	R24,R14
    04608 3280      CPI	R24,0x20
    04609 E0E0      LDI	R30,0
    0460A 079E      CPC	R25,R30
    0460B F119      BEQ	0x462F
    0460C 3283      CPI	R24,0x23
    0460D E0E0      LDI	R30,0
    0460E 079E      CPC	R25,R30
    0460F F091      BEQ	0x4622
    04610 3280      CPI	R24,0x20
    04611 E0E0      LDI	R30,0
    04612 079E      CPC	R25,R30
    04613 F124      BLT	0x4638
    04614 01C7      MOVW	R24,R14
    04615 328B      CPI	R24,0x2B
    04616 E0E0      LDI	R30,0
    04617 079E      CPC	R25,R30
    04618 F089      BEQ	0x462A
    04619 328D      CPI	R24,0x2D
    0461A E0E0      LDI	R30,0
    0461B 079E      CPC	R25,R30
    0461C F049      BEQ	0x4626
    0461D 3380      CPI	R24,0x30
    0461E E0E0      LDI	R30,0
    0461F 079E      CPC	R25,R30
    04620 F099      BEQ	0x4634
    04621 C016      RJMP	0x4638
    04622 01C5      MOVW	R24,R10
    04623 6081      ORI	R24,1
    04624 015C      MOVW	R10,R24
    04625 C015      RJMP	0x463B
    04626 01C5      MOVW	R24,R10
    04627 6084      ORI	R24,4
    04628 015C      MOVW	R10,R24
    04629 C011      RJMP	0x463B
    0462A 01C5      MOVW	R24,R10
    0462B 6088      ORI	R24,0x8
    0462C 015C      MOVW	R10,R24
    0462D E26B      LDI	R22,0x2B
    0462E C00C      RJMP	0x463B
    0462F 01C5      MOVW	R24,R10
    04630 6088      ORI	R24,0x8
    04631 015C      MOVW	R10,R24
    04632 E260      LDI	R22,0x20
    04633 C007      RJMP	0x463B
    04634 01C5      MOVW	R24,R10
    04635 6180      ORI	R24,0x10
    04636 015C      MOVW	R10,R24
    04637 C003      RJMP	0x463B
    04638 E081      LDI	R24,1
    04639 E090      LDI	R25,0
    0463A 016C      MOVW	R12,R24
    0463B 20CC      TST	R12
    0463C F411      BNE	0x463F
    0463D 20DD      TST	R13
    0463E F009      BEQ	0x4640
    0463F C006      RJMP	0x4646
    04640 A588      LDD	R24,Y+40
    04641 A599      LDD	R25,Y+41
    04642 9601      ADIW	R24,1
    04643 A799      STD	Y+41,R25
    04644 A788      STD	Y+40,R24
    04645 CFBD      RJMP	0x4603
    04646 A5E8      LDD	R30,Y+40
    04647 A5F9      LDD	R31,Y+41
    04648 8100      LD	R16,Z
    04649 2711      CLR	R17
    0464A 940E 52ED CALL	_isdigit
    0464C 3000      CPI	R16,0
    0464D 0701      CPC	R16,R17
    0464E F0B9      BEQ	0x4666
    0464F A508      LDD	R16,Y+40
    04650 A519      LDD	R17,Y+41
    04651 940E 4F4E CALL	_atoi
    04653 8B1D      STD	Y+21,R17
    04654 8B0C      STD	Y+20,R16
    04655 C005      RJMP	0x465B
    04656 A588      LDD	R24,Y+40
    04657 A599      LDD	R25,Y+41
    04658 9601      ADIW	R24,1
    04659 A799      STD	Y+41,R25
    0465A A788      STD	Y+40,R24
    0465B A5E8      LDD	R30,Y+40
    0465C A5F9      LDD	R31,Y+41
    0465D 8100      LD	R16,Z
    0465E 2711      CLR	R17
    0465F 940E 52ED CALL	_isdigit
    04661 0168      MOVW	R12,R16
    04662 3000      CPI	R16,0
    04663 0701      CPC	R16,R17
    04664 F789      BNE	0x4656
    04665 C015      RJMP	0x467B
    04666 A5E8      LDD	R30,Y+40
    04667 A5F9      LDD	R31,Y+41
    04668 8180      LD	R24,Z
    04669 328A      CPI	R24,0x2A
    0466A F481      BNE	0x467B
    0466B A58A      LDD	R24,Y+42
    0466C A59B      LDD	R25,Y+43
    0466D 9602      ADIW	R24,2
    0466E A79B      STD	Y+43,R25
    0466F A78A      STD	Y+42,R24
    04670 01FC      MOVW	R30,R24
    04671 9732      SBIW	R30,2
    04672 8020      LD	R2,Z
    04673 8031      LDD	R3,Z+1
    04674 8A3D      STD	Y+21,R3
    04675 8A2C      STD	Y+20,R2
    04676 A588      LDD	R24,Y+40
    04677 A599      LDD	R25,Y+41
    04678 9601      ADIW	R24,1
    04679 A799      STD	Y+41,R25
    0467A A788      STD	Y+40,R24
    0467B A5E8      LDD	R30,Y+40
    0467C A5F9      LDD	R31,Y+41
    0467D 8180      LD	R24,Z
    0467E 328E      CPI	R24,0x2E
    0467F F009      BEQ	0x4681
    04680 C03A      RJMP	0x46BB
    04681 01CF      MOVW	R24,R30
    04682 9601      ADIW	R24,1
    04683 A799      STD	Y+41,R25
    04684 A788      STD	Y+40,R24
    04685 01FC      MOVW	R30,R24
    04686 8100      LD	R16,Z
    04687 2711      CLR	R17
    04688 940E 52ED CALL	_isdigit
    0468A 0168      MOVW	R12,R16
    0468B 3000      CPI	R16,0
    0468C 0701      CPC	R16,R17
    0468D F0C1      BEQ	0x46A6
    0468E A508      LDD	R16,Y+40
    0468F A519      LDD	R17,Y+41
    04690 940E 4F4E CALL	_atoi
    04692 0168      MOVW	R12,R16
    04693 8ED9      STD	Y+25,R13
    04694 8EC8      STD	Y+24,R12
    04695 C005      RJMP	0x469B
    04696 A588      LDD	R24,Y+40
    04697 A599      LDD	R25,Y+41
    04698 9601      ADIW	R24,1
    04699 A799      STD	Y+41,R25
    0469A A788      STD	Y+40,R24
    0469B A5E8      LDD	R30,Y+40
    0469C A5F9      LDD	R31,Y+41
    0469D 8100      LD	R16,Z
    0469E 2711      CLR	R17
    0469F 940E 52ED CALL	_isdigit
    046A1 0168      MOVW	R12,R16
    046A2 3000      CPI	R16,0
    046A3 0701      CPC	R16,R17
    046A4 F789      BNE	0x4696
    046A5 C015      RJMP	0x46BB
    046A6 A5E8      LDD	R30,Y+40
    046A7 A5F9      LDD	R31,Y+41
    046A8 8180      LD	R24,Z
    046A9 328A      CPI	R24,0x2A
    046AA F481      BNE	0x46BB
    046AB A58A      LDD	R24,Y+42
    046AC A59B      LDD	R25,Y+43
    046AD 9602      ADIW	R24,2
    046AE A79B      STD	Y+43,R25
    046AF A78A      STD	Y+42,R24
    046B0 01FC      MOVW	R30,R24
    046B1 9732      SBIW	R30,2
    046B2 8020      LD	R2,Z
    046B3 8031      LDD	R3,Z+1
    046B4 8E39      STD	Y+25,R3
    046B5 8E28      STD	Y+24,R2
    046B6 A588      LDD	R24,Y+40
    046B7 A599      LDD	R25,Y+41
    046B8 9601      ADIW	R24,1
    046B9 A799      STD	Y+41,R25
    046BA A788      STD	Y+40,R24
    046BB A5E8      LDD	R30,Y+40
    046BC A5F9      LDD	R31,Y+41
    046BD 8180      LD	R24,Z
    046BE 368C      CPI	R24,0x6C
    046BF F439      BNE	0x46C7
    046C0 01CF      MOVW	R24,R30
    046C1 9601      ADIW	R24,1
    046C2 A799      STD	Y+41,R25
    046C3 A788      STD	Y+40,R24
    046C4 01C5      MOVW	R24,R10
    046C5 6082      ORI	R24,2
    046C6 015C      MOVW	R10,R24
    046C7 A5E8      LDD	R30,Y+40
    046C8 A5F9      LDD	R31,Y+41
    046C9 80C0      LD	R12,Z
    046CA 24DD      CLR	R13
    046CB 01C6      MOVW	R24,R12
    046CC 3583      CPI	R24,0x53
    046CD E0E0      LDI	R30,0
    046CE 079E      CPC	R25,R30
    046CF F409      BNE	0x46D1
    046D0 C18A      RJMP	0x485B
    046D1 E583      LDI	R24,0x53
    046D2 158C      CP	R24,R12
    046D3 059D      CPC	R25,R13
    046D4 F064      BLT	0x46E1
    046D5 01C6      MOVW	R24,R12
    046D6 3485      CPI	R24,0x45
    046D7 E0E0      LDI	R30,0
    046D8 079E      CPC	R25,R30
    046D9 F409      BNE	0x46DB
    046DA C307      RJMP	0x49E2
    046DB 3487      CPI	R24,0x47
    046DC E0E0      LDI	R30,0
    046DD 079E      CPC	R25,R30
    046DE F409      BNE	0x46E0
    046DF C30B      RJMP	0x49EB
    046E0 C043      RJMP	0x4724
    046E1 01C6      MOVW	R24,R12
    046E2 3588      CPI	R24,0x58
    046E3 E0E0      LDI	R30,0
    046E4 079E      CPC	R25,R30
    046E5 F409      BNE	0x46E7
    046E6 C07E      RJMP	0x4765
    046E7 3588      CPI	R24,0x58
    046E8 E0E0      LDI	R30,0
    046E9 079E      CPC	R25,R30
    046EA F40C      BGE	0x46EC
    046EB C038      RJMP	0x4724
    046EC 01C6      MOVW	R24,R12
    046ED 3683      CPI	R24,0x63
    046EE E0E0      LDI	R30,0
    046EF 079E      CPC	R25,R30
    046F0 F409      BNE	0x46F2
    046F1 C145      RJMP	0x4837
    046F2 3684      CPI	R24,0x64
    046F3 E0E0      LDI	R30,0
    046F4 079E      CPC	R25,R30
    046F5 F409      BNE	0x46F7
    046F6 C03A      RJMP	0x4731
    046F7 3685      CPI	R24,0x65
    046F8 E0E0      LDI	R30,0
    046F9 079E      CPC	R25,R30
    046FA F409      BNE	0x46FC
    046FB C2E3      RJMP	0x49DF
    046FC 3686      CPI	R24,0x66
    046FD E0E0      LDI	R30,0
    046FE 079E      CPC	R25,R30
    046FF F409      BNE	0x4701
    04700 C2E4      RJMP	0x49E5
    04701 3687      CPI	R24,0x67
    04702 E0E0      LDI	R30,0
    04703 079E      CPC	R25,R30
    04704 F409      BNE	0x4706
    04705 C2E2      RJMP	0x49E8
    04706 3689      CPI	R24,0x69
    04707 E0E0      LDI	R30,0
    04708 079E      CPC	R25,R30
    04709 F139      BEQ	0x4731
    0470A 368F      CPI	R24,0x6F
    0470B E0E0      LDI	R30,0
    0470C 079E      CPC	R25,R30
    0470D F409      BNE	0x470F
    0470E C056      RJMP	0x4765
    0470F 3780      CPI	R24,0x70
    04710 E0E0      LDI	R30,0
    04711 079E      CPC	R25,R30
    04712 F409      BNE	0x4714
    04713 C051      RJMP	0x4765
    04714 3783      CPI	R24,0x73
    04715 E0E0      LDI	R30,0
    04716 079E      CPC	R25,R30
    04717 F409      BNE	0x4719
    04718 C200      RJMP	0x4919
    04719 3785      CPI	R24,0x75
    0471A E0E0      LDI	R30,0
    0471B 079E      CPC	R25,R30
    0471C F409      BNE	0x471E
    0471D C047      RJMP	0x4765
    0471E 3788      CPI	R24,0x78
    0471F E0E0      LDI	R30,0
    04720 079E      CPC	R25,R30
    04721 F409      BNE	0x4723
    04722 C042      RJMP	0x4765
    04723 C000      RJMP	0x4724
    04724 A5E8      LDD	R30,Y+40
    04725 A5F9      LDD	R31,Y+41
    04726 8100      LD	R16,Z
    04727 A1EE      LDD	R30,Y+38
    04728 A1FF      LDD	R31,Y+39
    04729 940E 4BF8 CALL	xicallx
    0472B 898E      LDD	R24,Y+22
    0472C 899F      LDD	R25,Y+23
    0472D 9601      ADIW	R24,1
    0472E 8B9F      STD	Y+23,R25
    0472F 8B8E      STD	Y+22,R24
    04730 C2FF      RJMP	0x4A30
    04731 FEA1      SBRS	R10,1
    04732 C01E      RJMP	0x4751
    04733 A58A      LDD	R24,Y+42
    04734 A59B      LDD	R25,Y+43
    04735 9604      ADIW	R24,4
    04736 A79B      STD	Y+43,R25
    04737 A78A      STD	Y+42,R24
    04738 01FC      MOVW	R30,R24
    04739 9734      SBIW	R30,4
    0473A 8020      LD	R2,Z
    0473B 8031      LDD	R3,Z+1
    0473C 8042      LDD	R4,Z+2
    0473D 8053      LDD	R5,Z+3
    0473E 862C      STD	Y+12,R2
    0473F 863D      STD	Y+13,R3
    04740 864E      STD	Y+14,R4
    04741 865F      STD	Y+15,R5
    04742 E08A      LDI	R24,0xA
    04743 E090      LDI	R25,0
    04744 839B      STD	Y+3,R25
    04745 838A      STD	Y+2,R24
    04746 842C      LDD	R2,Y+12
    04747 843D      LDD	R3,Y+13
    04748 844E      LDD	R4,Y+14
    04749 845F      LDD	R5,Y+15
    0474A 8248      ST	Y,R4
    0474B 8259      STD	Y+1,R5
    0474C 0191      MOVW	R18,R2
    0474D 018A      MOVW	R16,R20
    0474E 940E 4FFF CALL	_ltoa
    04750 C0C1      RJMP	0x4812
    04751 A58A      LDD	R24,Y+42
    04752 A59B      LDD	R25,Y+43
    04753 9602      ADIW	R24,2
    04754 A79B      STD	Y+43,R25
    04755 A78A      STD	Y+42,R24
    04756 01FC      MOVW	R30,R24
    04757 9732      SBIW	R30,2
    04758 8020      LD	R2,Z
    04759 8031      LDD	R3,Z+1
    0475A 8E3B      STD	Y+27,R3
    0475B 8E2A      STD	Y+26,R2
    0475C E08A      LDI	R24,0xA
    0475D E090      LDI	R25,0
    0475E 8399      STD	Y+1,R25
    0475F 8388      ST	Y,R24
    04760 0191      MOVW	R18,R2
    04761 018A      MOVW	R16,R20
    04762 940E 4F94 CALL	_itoa
    04764 C0AD      RJMP	0x4812
    04765 FEA1      SBRS	R10,1
    04766 C010      RJMP	0x4777
    04767 A58A      LDD	R24,Y+42
    04768 A59B      LDD	R25,Y+43
    04769 9604      ADIW	R24,4
    0476A A79B      STD	Y+43,R25
    0476B A78A      STD	Y+42,R24
    0476C 01FC      MOVW	R30,R24
    0476D 9734      SBIW	R30,4
    0476E 8020      LD	R2,Z
    0476F 8031      LDD	R3,Z+1
    04770 8042      LDD	R4,Z+2
    04771 8053      LDD	R5,Z+3
    04772 862C      STD	Y+12,R2
    04773 863D      STD	Y+13,R3
    04774 864E      STD	Y+14,R4
    04775 865F      STD	Y+15,R5
    04776 C00B      RJMP	0x4782
    04777 A58A      LDD	R24,Y+42
    04778 A59B      LDD	R25,Y+43
    04779 9602      ADIW	R24,2
    0477A A79B      STD	Y+43,R25
    0477B A78A      STD	Y+42,R24
    0477C 01FC      MOVW	R30,R24
    0477D 9732      SBIW	R30,2
    0477E 8020      LD	R2,Z
    0477F 8031      LDD	R3,Z+1
    04780 8E3B      STD	Y+27,R3
    04781 8E2A      STD	Y+26,R2
    04782 A5E8      LDD	R30,Y+40
    04783 A5F9      LDD	R31,Y+41
    04784 8180      LD	R24,Z
    04785 3785      CPI	R24,0x75
    04786 F4D9      BNE	0x47A2
    04787 FEA1      SBRS	R10,1
    04788 C00F      RJMP	0x4798
    04789 E08A      LDI	R24,0xA
    0478A E090      LDI	R25,0
    0478B 839B      STD	Y+3,R25
    0478C 838A      STD	Y+2,R24
    0478D 842C      LDD	R2,Y+12
    0478E 843D      LDD	R3,Y+13
    0478F 844E      LDD	R4,Y+14
    04790 845F      LDD	R5,Y+15
    04791 8248      ST	Y,R4
    04792 8259      STD	Y+1,R5
    04793 0191      MOVW	R18,R2
    04794 018A      MOVW	R16,R20
    04795 940E 50B7 CALL	_ultoa
    04797 C07A      RJMP	0x4812
    04798 E08A      LDI	R24,0xA
    04799 E090      LDI	R25,0
    0479A 8399      STD	Y+1,R25
    0479B 8388      ST	Y,R24
    0479C 8D2A      LDD	R18,Y+26
    0479D 8D3B      LDD	R19,Y+27
    0479E 018A      MOVW	R16,R20
    0479F 940E 511E CALL	_utoa
    047A1 C070      RJMP	0x4812
    047A2 A5E8      LDD	R30,Y+40
    047A3 A5F9      LDD	R31,Y+41
    047A4 8180      LD	R24,Z
    047A5 368F      CPI	R24,0x6F
    047A6 F509      BNE	0x47C8
    047A7 FEA0      SBRS	R10,0
    047A8 C004      RJMP	0x47AD
    047A9 E380      LDI	R24,0x30
    047AA 01FA      MOVW	R30,R20
    047AB 9381      ST	Z+,R24
    047AC 01AF      MOVW	R20,R30
    047AD FEA1      SBRS	R10,1
    047AE C00F      RJMP	0x47BE
    047AF E088      LDI	R24,0x8
    047B0 E090      LDI	R25,0
    047B1 839B      STD	Y+3,R25
    047B2 838A      STD	Y+2,R24
    047B3 842C      LDD	R2,Y+12
    047B4 843D      LDD	R3,Y+13
    047B5 844E      LDD	R4,Y+14
    047B6 845F      LDD	R5,Y+15
    047B7 8248      ST	Y,R4
    047B8 8259      STD	Y+1,R5
    047B9 0191      MOVW	R18,R2
    047BA 018A      MOVW	R16,R20
    047BB 940E 50B7 CALL	_ultoa
    047BD C054      RJMP	0x4812
    047BE E088      LDI	R24,0x8
    047BF E090      LDI	R25,0
    047C0 8399      STD	Y+1,R25
    047C1 8388      ST	Y,R24
    047C2 8D2A      LDD	R18,Y+26
    047C3 8D3B      LDD	R19,Y+27
    047C4 018A      MOVW	R16,R20
    047C5 940E 511E CALL	_utoa
    047C7 C04A      RJMP	0x4812
    047C8 A5E8      LDD	R30,Y+40
    047C9 A5F9      LDD	R31,Y+41
    047CA 8180      LD	R24,Z
    047CB 3780      CPI	R24,0x70
    047CC F439      BNE	0x47D4
    047CD E380      LDI	R24,0x30
    047CE 01FA      MOVW	R30,R20
    047CF 9381      ST	Z+,R24
    047D0 E788      LDI	R24,0x78
    047D1 9381      ST	Z+,R24
    047D2 01AF      MOVW	R20,R30
    047D3 C00C      RJMP	0x47E0
    047D4 FEA0      SBRS	R10,0
    047D5 C00A      RJMP	0x47E0
    047D6 E380      LDI	R24,0x30
    047D7 01FA      MOVW	R30,R20
    047D8 9381      ST	Z+,R24
    047D9 01AF      MOVW	R20,R30
    047DA A5E8      LDD	R30,Y+40
    047DB A5F9      LDD	R31,Y+41
    047DC 8020      LD	R2,Z
    047DD 01FA      MOVW	R30,R20
    047DE 9221      ST	Z+,R2
    047DF 01AF      MOVW	R20,R30
    047E0 FEA1      SBRS	R10,1
    047E1 C00F      RJMP	0x47F1
    047E2 E180      LDI	R24,0x10
    047E3 E090      LDI	R25,0
    047E4 839B      STD	Y+3,R25
    047E5 838A      STD	Y+2,R24
    047E6 842C      LDD	R2,Y+12
    047E7 843D      LDD	R3,Y+13
    047E8 844E      LDD	R4,Y+14
    047E9 845F      LDD	R5,Y+15
    047EA 8248      ST	Y,R4
    047EB 8259      STD	Y+1,R5
    047EC 0191      MOVW	R18,R2
    047ED 018A      MOVW	R16,R20
    047EE 940E 50B7 CALL	_ultoa
    047F0 C009      RJMP	0x47FA
    047F1 E180      LDI	R24,0x10
    047F2 E090      LDI	R25,0
    047F3 8399      STD	Y+1,R25
    047F4 8388      ST	Y,R24
    047F5 8D2A      LDD	R18,Y+26
    047F6 8D3B      LDD	R19,Y+27
    047F7 018A      MOVW	R16,R20
    047F8 940E 511E CALL	_utoa
    047FA A5E8      LDD	R30,Y+40
    047FB A5F9      LDD	R31,Y+41
    047FC 8180      LD	R24,Z
    047FD 3588      CPI	R24,0x58
    047FE F499      BNE	0x4812
    047FF E584      LDI	R24,0x54
    04800 E099      LDI	R25,0x9
    04801 017C      MOVW	R14,R24
    04802 C00B      RJMP	0x480E
    04803 01F7      MOVW	R30,R14
    04804 8100      LD	R16,Z
    04805 2711      CLR	R17
    04806 940E 530B CALL	_toupper
    04808 0168      MOVW	R12,R16
    04809 01F7      MOVW	R30,R14
    0480A 82C0      ST	Z,R12
    0480B 01C7      MOVW	R24,R14
    0480C 9601      ADIW	R24,1
    0480D 017C      MOVW	R14,R24
    0480E 01F7      MOVW	R30,R14
    0480F 8020      LD	R2,Z
    04810 2022      TST	R2
    04811 F789      BNE	0x4803
    04812 E584      LDI	R24,0x54
    04813 E099      LDI	R25,0x9
    04814 017C      MOVW	R14,R24
    04815 8D88      LDD	R24,Y+24
    04816 8D99      LDD	R25,Y+25
    04817 3F8F      CPI	R24,0xFF
    04818 EFEF      LDI	R30,0xFF
    04819 079E      CPC	R25,R30
    0481A F421      BNE	0x481F
    0481B 2400      CLR	R0
    0481C 2411      CLR	R1
    0481D 8E19      STD	Y+25,R1
    0481E 8E08      STD	Y+24,R0
    0481F 8C08      LDD	R0,Y+24
    04820 8C19      LDD	R1,Y+25
    04821 2000      TST	R0
    04822 F419      BNE	0x4826
    04823 2011      TST	R1
    04824 F409      BNE	0x4826
    04825 C104      RJMP	0x492A
    04826 E504      LDI	R16,0x54
    04827 E019      LDI	R17,0x9
    04828 940E 4A5A CALL	_strlen
    0482A 0168      MOVW	R12,R16
    0482B 8EDB      STD	Y+27,R13
    0482C 8ECA      STD	Y+26,R12
    0482D 8C08      LDD	R0,Y+24
    0482E 8C19      LDD	R1,Y+25
    0482F 140C      CP	R0,R12
    04830 041D      CPC	R1,R13
    04831 F00C      BLT	0x4833
    04832 C0F7      RJMP	0x492A
    04833 0106      MOVW	R0,R12
    04834 8E19      STD	Y+25,R1
    04835 8E08      STD	Y+24,R0
    04836 C0F3      RJMP	0x492A
    04837 A58A      LDD	R24,Y+42
    04838 A59B      LDD	R25,Y+43
    04839 9602      ADIW	R24,2
    0483A A79B      STD	Y+43,R25
    0483B A78A      STD	Y+42,R24
    0483C 01FC      MOVW	R30,R24
    0483D 9732      SBIW	R30,2
    0483E 8020      LD	R2,Z
    0483F 8031      LDD	R3,Z+1
    04840 862A      STD	Y+10,R2
    04841 E081      LDI	R24,1
    04842 E090      LDI	R25,0
    04843 880C      LDD	R0,Y+20
    04844 881D      LDD	R1,Y+21
    04845 1580      CP	R24,R0
    04846 0591      CPC	R25,R1
    04847 F444      BGE	0x4850
    04848 8E19      STD	Y+25,R1
    04849 8E08      STD	Y+24,R0
    0484A 2422      CLR	R2
    0484B 862B      STD	Y+11,R2
    0484C 01CE      MOVW	R24,R28
    0484D 960A      ADIW	R24,0xA
    0484E 017C      MOVW	R14,R24
    0484F C0DA      RJMP	0x492A
    04850 850A      LDD	R16,Y+10
    04851 A1EE      LDD	R30,Y+38
    04852 A1FF      LDD	R31,Y+39
    04853 940E 4BF8 CALL	xicallx
    04855 898E      LDD	R24,Y+22
    04856 899F      LDD	R25,Y+23
    04857 9601      ADIW	R24,1
    04858 8B9F      STD	Y+23,R25
    04859 8B8E      STD	Y+22,R24
    0485A C1D5      RJMP	0x4A30
    0485B A58A      LDD	R24,Y+42
    0485C A59B      LDD	R25,Y+43
    0485D 9602      ADIW	R24,2
    0485E A79B      STD	Y+43,R25
    0485F A78A      STD	Y+42,R24
    04860 01FC      MOVW	R30,R24
    04861 9732      SBIW	R30,2
    04862 80C0      LD	R12,Z
    04863 80D1      LDD	R13,Z+1
    04864 8D88      LDD	R24,Y+24
    04865 8D99      LDD	R25,Y+25
    04866 3F8F      CPI	R24,0xFF
    04867 EFEF      LDI	R30,0xFF
    04868 079E      CPC	R25,R30
    04869 F421      BNE	0x486E
    0486A 2400      CLR	R0
    0486B 2411      CLR	R1
    0486C 8E19      STD	Y+25,R1
    0486D 8E08      STD	Y+24,R0
    0486E 880C      LDD	R0,Y+20
    0486F 881D      LDD	R1,Y+21
    04870 2000      TST	R0
    04871 F411      BNE	0x4874
    04872 2011      TST	R1
    04873 F051      BEQ	0x487E
    04874 0186      MOVW	R16,R12
    04875 940E 4F41 CALL	_cstrlen
    04877 01A8      MOVW	R20,R16
    04878 882C      LDD	R2,Y+20
    04879 883D      LDD	R3,Y+21
    0487A 1A20      SUB	R2,R16
    0487B 0A31      SBC	R3,R17
    0487C 8A3D      STD	Y+21,R3
    0487D 8A2C      STD	Y+20,R2
    0487E 8C08      LDD	R0,Y+24
    0487F 8C19      LDD	R1,Y+25
    04880 2000      TST	R0
    04881 F441      BNE	0x488A
    04882 2011      TST	R1
    04883 F431      BNE	0x488A
    04884 0186      MOVW	R16,R12
    04885 940E 4F41 CALL	_cstrlen
    04887 01A8      MOVW	R20,R16
    04888 8F59      STD	Y+25,R21
    04889 8F48      STD	Y+24,R20
    0488A 880C      LDD	R0,Y+20
    0488B 881D      LDD	R1,Y+21
    0488C 2000      TST	R0
    0488D F411      BNE	0x4890
    0488E 2011      TST	R1
    0488F F031      BEQ	0x4896
    04890 FEA3      SBRS	R10,3
    04891 C004      RJMP	0x4896
    04892 01C0      MOVW	R24,R0
    04893 9701      SBIW	R24,1
    04894 8B9D      STD	Y+21,R25
    04895 8B8C      STD	Y+20,R24
    04896 FEA4      SBRS	R10,4
    04897 C026      RJMP	0x48BE
    04898 FEA3      SBRS	R10,3
    04899 C00A      RJMP	0x48A4
    0489A 2F06      MOV	R16,R22
    0489B A1EE      LDD	R30,Y+38
    0489C A1FF      LDD	R31,Y+39
    0489D 940E 4BF8 CALL	xicallx
    0489F 898E      LDD	R24,Y+22
    048A0 899F      LDD	R25,Y+23
    048A1 9601      ADIW	R24,1
    048A2 8B9F      STD	Y+23,R25
    048A3 8B8E      STD	Y+22,R24
    048A4 FCA2      SBRC	R10,2
    048A5 C04C      RJMP	0x48F2
    048A6 C00F      RJMP	0x48B6
    048A7 E300      LDI	R16,0x30
    048A8 A1EE      LDD	R30,Y+38
    048A9 A1FF      LDD	R31,Y+39
    048AA 940E 4BF8 CALL	xicallx
    048AC 898E      LDD	R24,Y+22
    048AD 899F      LDD	R25,Y+23
    048AE 9601      ADIW	R24,1
    048AF 8B9F      STD	Y+23,R25
    048B0 8B8E      STD	Y+22,R24
    048B1 898C      LDD	R24,Y+20
    048B2 899D      LDD	R25,Y+21
    048B3 9701      SBIW	R24,1
    048B4 8B9D      STD	Y+21,R25
    048B5 8B8C      STD	Y+20,R24
    048B6 2422      CLR	R2
    048B7 2433      CLR	R3
    048B8 880C      LDD	R0,Y+20
    048B9 881D      LDD	R1,Y+21
    048BA 1420      CP	R2,R0
    048BB 0431      CPC	R3,R1
    048BC F354      BLT	0x48A7
    048BD C034      RJMP	0x48F2
    048BE FCA2      SBRC	R10,2
    048BF C017      RJMP	0x48D7
    048C0 C00F      RJMP	0x48D0
    048C1 E200      LDI	R16,0x20
    048C2 A1EE      LDD	R30,Y+38
    048C3 A1FF      LDD	R31,Y+39
    048C4 940E 4BF8 CALL	xicallx
    048C6 898E      LDD	R24,Y+22
    048C7 899F      LDD	R25,Y+23
    048C8 9601      ADIW	R24,1
    048C9 8B9F      STD	Y+23,R25
    048CA 8B8E      STD	Y+22,R24
    048CB 898C      LDD	R24,Y+20
    048CC 899D      LDD	R25,Y+21
    048CD 9701      SBIW	R24,1
    048CE 8B9D      STD	Y+21,R25
    048CF 8B8C      STD	Y+20,R24
    048D0 2422      CLR	R2
    048D1 2433      CLR	R3
    048D2 880C      LDD	R0,Y+20
    048D3 881D      LDD	R1,Y+21
    048D4 1420      CP	R2,R0
    048D5 0431      CPC	R3,R1
    048D6 F354      BLT	0x48C1
    048D7 FEA3      SBRS	R10,3
    048D8 C019      RJMP	0x48F2
    048D9 2F06      MOV	R16,R22
    048DA A1EE      LDD	R30,Y+38
    048DB A1FF      LDD	R31,Y+39
    048DC 940E 4BF8 CALL	xicallx
    048DE 898E      LDD	R24,Y+22
    048DF 899F      LDD	R25,Y+23
    048E0 9601      ADIW	R24,1
    048E1 8B9F      STD	Y+23,R25
    048E2 8B8E      STD	Y+22,R24
    048E3 C00E      RJMP	0x48F2
    048E4 01F6      MOVW	R30,R12
    048E5 9106      ELPM	R16,Z
    048E6 A1EE      LDD	R30,Y+38
    048E7 A1FF      LDD	R31,Y+39
    048E8 940E 4BF8 CALL	xicallx
    048EA 898E      LDD	R24,Y+22
    048EB 899F      LDD	R25,Y+23
    048EC 9601      ADIW	R24,1
    048ED 8B9F      STD	Y+23,R25
    048EE 8B8E      STD	Y+22,R24
    048EF 01C6      MOVW	R24,R12
    048F0 9601      ADIW	R24,1
    048F1 016C      MOVW	R12,R24
    048F2 01F6      MOVW	R30,R12
    048F3 9026      ELPM	R2,Z
    048F4 2022      TST	R2
    048F5 F049      BEQ	0x48FF
    048F6 8D48      LDD	R20,Y+24
    048F7 8D59      LDD	R21,Y+25
    048F8 01CA      MOVW	R24,R20
    048F9 9701      SBIW	R24,1
    048FA 8F99      STD	Y+25,R25
    048FB 8F88      STD	Y+24,R24
    048FC 3040      CPI	R20,0
    048FD 0745      CPC	R20,R21
    048FE F729      BNE	0x48E4
    048FF FEA2      SBRS	R10,2
    04900 C12F      RJMP	0x4A30
    04901 C00F      RJMP	0x4911
    04902 E200      LDI	R16,0x20
    04903 A1EE      LDD	R30,Y+38
    04904 A1FF      LDD	R31,Y+39
    04905 940E 4BF8 CALL	xicallx
    04907 898E      LDD	R24,Y+22
    04908 899F      LDD	R25,Y+23
    04909 9601      ADIW	R24,1
    0490A 8B9F      STD	Y+23,R25
    0490B 8B8E      STD	Y+22,R24
    0490C 898C      LDD	R24,Y+20
    0490D 899D      LDD	R25,Y+21
    0490E 9701      SBIW	R24,1
    0490F 8B9D      STD	Y+21,R25
    04910 8B8C      STD	Y+20,R24
    04911 2422      CLR	R2
    04912 2433      CLR	R3
    04913 880C      LDD	R0,Y+20
    04914 881D      LDD	R1,Y+21
    04915 1420      CP	R2,R0
    04916 0431      CPC	R3,R1
    04917 F354      BLT	0x4902
    04918 C117      RJMP	0x4A30
    04919 A58A      LDD	R24,Y+42
    0491A A59B      LDD	R25,Y+43
    0491B 9602      ADIW	R24,2
    0491C A79B      STD	Y+43,R25
    0491D A78A      STD	Y+42,R24
    0491E 01FC      MOVW	R30,R24
    0491F 9732      SBIW	R30,2
    04920 80E0      LD	R14,Z
    04921 80F1      LDD	R15,Z+1
    04922 20EE      TST	R14
    04923 F431      BNE	0x492A
    04924 20FF      TST	R15
    04925 F421      BNE	0x492A
    04926 EE8C      LDI	R24,0xEC
    04927 E090      LDI	R25,0
    04928 016C      MOVW	R12,R24
    04929 CF3A      RJMP	0x4864
    0492A 8D88      LDD	R24,Y+24
    0492B 8D99      LDD	R25,Y+25
    0492C 3F8F      CPI	R24,0xFF
    0492D EFEF      LDI	R30,0xFF
    0492E 079E      CPC	R25,R30
    0492F F421      BNE	0x4934
    04930 2400      CLR	R0
    04931 2411      CLR	R1
    04932 8E19      STD	Y+25,R1
    04933 8E08      STD	Y+24,R0
    04934 880C      LDD	R0,Y+20
    04935 881D      LDD	R1,Y+21
    04936 2000      TST	R0
    04937 F411      BNE	0x493A
    04938 2011      TST	R1
    04939 F051      BEQ	0x4944
    0493A 0187      MOVW	R16,R14
    0493B 940E 4A5A CALL	_strlen
    0493D 0168      MOVW	R12,R16
    0493E 882C      LDD	R2,Y+20
    0493F 883D      LDD	R3,Y+21
    04940 1A20      SUB	R2,R16
    04941 0A31      SBC	R3,R17
    04942 8A3D      STD	Y+21,R3
    04943 8A2C      STD	Y+20,R2
    04944 8C08      LDD	R0,Y+24
    04945 8C19      LDD	R1,Y+25
    04946 2000      TST	R0
    04947 F441      BNE	0x4950
    04948 2011      TST	R1
    04949 F431      BNE	0x4950
    0494A 0187      MOVW	R16,R14
    0494B 940E 4A5A CALL	_strlen
    0494D 0168      MOVW	R12,R16
    0494E 8ED9      STD	Y+25,R13
    0494F 8EC8      STD	Y+24,R12
    04950 880C      LDD	R0,Y+20
    04951 881D      LDD	R1,Y+21
    04952 2000      TST	R0
    04953 F411      BNE	0x4956
    04954 2011      TST	R1
    04955 F031      BEQ	0x495C
    04956 FEA3      SBRS	R10,3
    04957 C004      RJMP	0x495C
    04958 01C0      MOVW	R24,R0
    04959 9701      SBIW	R24,1
    0495A 8B9D      STD	Y+21,R25
    0495B 8B8C      STD	Y+20,R24
    0495C FEA4      SBRS	R10,4
    0495D C026      RJMP	0x4984
    0495E FEA3      SBRS	R10,3
    0495F C00A      RJMP	0x496A
    04960 2F06      MOV	R16,R22
    04961 A1EE      LDD	R30,Y+38
    04962 A1FF      LDD	R31,Y+39
    04963 940E 4BF8 CALL	xicallx
    04965 898E      LDD	R24,Y+22
    04966 899F      LDD	R25,Y+23
    04967 9601      ADIW	R24,1
    04968 8B9F      STD	Y+23,R25
    04969 8B8E      STD	Y+22,R24
    0496A FCA2      SBRC	R10,2
    0496B C04C      RJMP	0x49B8
    0496C C00F      RJMP	0x497C
    0496D E300      LDI	R16,0x30
    0496E A1EE      LDD	R30,Y+38
    0496F A1FF      LDD	R31,Y+39
    04970 940E 4BF8 CALL	xicallx
    04972 898E      LDD	R24,Y+22
    04973 899F      LDD	R25,Y+23
    04974 9601      ADIW	R24,1
    04975 8B9F      STD	Y+23,R25
    04976 8B8E      STD	Y+22,R24
    04977 898C      LDD	R24,Y+20
    04978 899D      LDD	R25,Y+21
    04979 9701      SBIW	R24,1
    0497A 8B9D      STD	Y+21,R25
    0497B 8B8C      STD	Y+20,R24
    0497C 2422      CLR	R2
    0497D 2433      CLR	R3
    0497E 880C      LDD	R0,Y+20
    0497F 881D      LDD	R1,Y+21
    04980 1420      CP	R2,R0
    04981 0431      CPC	R3,R1
    04982 F354      BLT	0x496D
    04983 C034      RJMP	0x49B8
    04984 FCA2      SBRC	R10,2
    04985 C017      RJMP	0x499D
    04986 C00F      RJMP	0x4996
    04987 E200      LDI	R16,0x20
    04988 A1EE      LDD	R30,Y+38
    04989 A1FF      LDD	R31,Y+39
    0498A 940E 4BF8 CALL	xicallx
    0498C 898E      LDD	R24,Y+22
    0498D 899F      LDD	R25,Y+23
    0498E 9601      ADIW	R24,1
    0498F 8B9F      STD	Y+23,R25
    04990 8B8E      STD	Y+22,R24
    04991 898C      LDD	R24,Y+20
    04992 899D      LDD	R25,Y+21
    04993 9701      SBIW	R24,1
    04994 8B9D      STD	Y+21,R25
    04995 8B8C      STD	Y+20,R24
    04996 2422      CLR	R2
    04997 2433      CLR	R3
    04998 880C      LDD	R0,Y+20
    04999 881D      LDD	R1,Y+21
    0499A 1420      CP	R2,R0
    0499B 0431      CPC	R3,R1
    0499C F354      BLT	0x4987
    0499D FEA3      SBRS	R10,3
    0499E C019      RJMP	0x49B8
    0499F 2F06      MOV	R16,R22
    049A0 A1EE      LDD	R30,Y+38
    049A1 A1FF      LDD	R31,Y+39
    049A2 940E 4BF8 CALL	xicallx
    049A4 898E      LDD	R24,Y+22
    049A5 899F      LDD	R25,Y+23
    049A6 9601      ADIW	R24,1
    049A7 8B9F      STD	Y+23,R25
    049A8 8B8E      STD	Y+22,R24
    049A9 C00E      RJMP	0x49B8
    049AA 01F7      MOVW	R30,R14
    049AB 8100      LD	R16,Z
    049AC A1EE      LDD	R30,Y+38
    049AD A1FF      LDD	R31,Y+39
    049AE 940E 4BF8 CALL	xicallx
    049B0 898E      LDD	R24,Y+22
    049B1 899F      LDD	R25,Y+23
    049B2 9601      ADIW	R24,1
    049B3 8B9F      STD	Y+23,R25
    049B4 8B8E      STD	Y+22,R24
    049B5 01C7      MOVW	R24,R14
    049B6 9601      ADIW	R24,1
    049B7 017C      MOVW	R14,R24
    049B8 01F7      MOVW	R30,R14
    049B9 8020      LD	R2,Z
    049BA 2022      TST	R2
    049BB F049      BEQ	0x49C5
    049BC 8D68      LDD	R22,Y+24
    049BD 8D79      LDD	R23,Y+25
    049BE 01CB      MOVW	R24,R22
    049BF 9701      SBIW	R24,1
    049C0 8F99      STD	Y+25,R25
    049C1 8F88      STD	Y+24,R24
    049C2 3060      CPI	R22,0
    049C3 0767      CPC	R22,R23
    049C4 F729      BNE	0x49AA
    049C5 FEA2      SBRS	R10,2
    049C6 C069      RJMP	0x4A30
    049C7 C00F      RJMP	0x49D7
    049C8 E200      LDI	R16,0x20
    049C9 A1EE      LDD	R30,Y+38
    049CA A1FF      LDD	R31,Y+39
    049CB 940E 4BF8 CALL	xicallx
    049CD 898E      LDD	R24,Y+22
    049CE 899F      LDD	R25,Y+23
    049CF 9601      ADIW	R24,1
    049D0 8B9F      STD	Y+23,R25
    049D1 8B8E      STD	Y+22,R24
    049D2 898C      LDD	R24,Y+20
    049D3 899D      LDD	R25,Y+21
    049D4 9701      SBIW	R24,1
    049D5 8B9D      STD	Y+21,R25
    049D6 8B8C      STD	Y+20,R24
    049D7 2422      CLR	R2
    049D8 2433      CLR	R3
    049D9 880C      LDD	R0,Y+20
    049DA 881D      LDD	R1,Y+21
    049DB 1420      CP	R2,R0
    049DC 0431      CPC	R3,R1
    049DD F354      BLT	0x49C8
    049DE C051      RJMP	0x4A30
    049DF E061      LDI	R22,1
    049E0 E070      LDI	R23,0
    049E1 C00B      RJMP	0x49ED
    049E2 E062      LDI	R22,2
    049E3 E070      LDI	R23,0
    049E4 C008      RJMP	0x49ED
    049E5 2766      CLR	R22
    049E6 2777      CLR	R23
    049E7 C005      RJMP	0x49ED
    049E8 E063      LDI	R22,3
    049E9 E070      LDI	R23,0
    049EA C002      RJMP	0x49ED
    049EB E064      LDI	R22,4
    049EC E070      LDI	R23,0
    049ED A58A      LDD	R24,Y+42
    049EE A59B      LDD	R25,Y+43
    049EF 9604      ADIW	R24,4
    049F0 A79B      STD	Y+43,R25
    049F1 A78A      STD	Y+42,R24
    049F2 01FC      MOVW	R30,R24
    049F3 9734      SBIW	R30,4
    049F4 8020      LD	R2,Z
    049F5 8031      LDD	R3,Z+1
    049F6 8042      LDD	R4,Z+2
    049F7 8053      LDD	R5,Z+3
    049F8 8A28      STD	Y+16,R2
    049F9 8A39      STD	Y+17,R3
    049FA 8A4A      STD	Y+18,R4
    049FB 8A5B      STD	Y+19,R5
    049FC 8D88      LDD	R24,Y+24
    049FD 8D99      LDD	R25,Y+25
    049FE 3F8F      CPI	R24,0xFF
    049FF EFEF      LDI	R30,0xFF
    04A00 079E      CPC	R25,R30
    04A01 F421      BNE	0x4A06
    04A02 E086      LDI	R24,6
    04A03 E090      LDI	R25,0
    04A04 8F99      STD	Y+25,R25
    04A05 8F88      STD	Y+24,R24
    04A06 8C08      LDD	R0,Y+24
    04A07 8C19      LDD	R1,Y+25
    04A08 8619      STD	Y+9,R1
    04A09 8608      STD	Y+8,R0
    04A0A 880C      LDD	R0,Y+20
    04A0B 881D      LDD	R1,Y+21
    04A0C 821F      STD	Y+7,R1
    04A0D 820E      STD	Y+6,R0
    04A0E 82BD      STD	Y+5,R11
    04A0F 82AC      STD	Y+4,R10
    04A10 8828      LDD	R2,Y+16
    04A11 8839      LDD	R3,Y+17
    04A12 884A      LDD	R4,Y+18
    04A13 885B      LDD	R5,Y+19
    04A14 8228      ST	Y,R2
    04A15 8239      STD	Y+1,R3
    04A16 824A      STD	Y+2,R4
    04A17 825B      STD	Y+3,R5
    04A18 019B      MOVW	R18,R22
    04A19 E504      LDI	R16,0x54
    04A1A E019      LDI	R17,0x9
    04A1B 940E 536C CALL	__FormatFP_1
    04A1D 01B8      MOVW	R22,R16
    04A1E 017B      MOVW	R14,R22
    04A1F C00C      RJMP	0x4A2C
    04A20 01F7      MOVW	R30,R14
    04A21 9101      LD	R16,Z+
    04A22 017F      MOVW	R14,R30
    04A23 A1EE      LDD	R30,Y+38
    04A24 A1FF      LDD	R31,Y+39
    04A25 940E 4BF8 CALL	xicallx
    04A27 898E      LDD	R24,Y+22
    04A28 899F      LDD	R25,Y+23
    04A29 9601      ADIW	R24,1
    04A2A 8B9F      STD	Y+23,R25
    04A2B 8B8E      STD	Y+22,R24
    04A2C 01F7      MOVW	R30,R14
    04A2D 8020      LD	R2,Z
    04A2E 2022      TST	R2
    04A2F F781      BNE	0x4A20
    04A30 A588      LDD	R24,Y+40
    04A31 A599      LDD	R25,Y+41
    04A32 9601      ADIW	R24,1
    04A33 A799      STD	Y+41,R25
    04A34 A788      STD	Y+40,R24
    04A35 A5E8      LDD	R30,Y+40
    04A36 A5F9      LDD	R31,Y+41
    04A37 8020      LD	R2,Z
    04A38 2022      TST	R2
    04A39 F009      BEQ	0x4A3B
    04A3A CBA4      RJMP	0x45DF
    04A3B 890E      LDD	R16,Y+22
    04A3C 891F      LDD	R17,Y+23
    04A3D 966C      ADIW	R28,0x1C
    04A3E 940E 4BA0 CALL	pop_xgsetF0FC
    04A40 9624      ADIW	R28,4
    04A41 9508      RET
_memset:
    04A42 8188      LD	R24,Y
    04A43 8199      LDD	R25,Y+1
    04A44 3080      CPI	R24,0
    04A45 0789      CPC	R24,R25
    04A46 F029      BEQ	0x4A4C
    04A47 2FE0      MOV	R30,R16
    04A48 2FF1      MOV	R31,R17
    04A49 9321      ST	Z+,R18
    04A4A 9701      SBIW	R24,1
    04A4B F7E9      BNE	0x4A49
    04A4C 9508      RET
_strcat:
    04A4D 2FA0      MOV	R26,R16
    04A4E 2FB1      MOV	R27,R17
    04A4F 2FE2      MOV	R30,R18
    04A50 2FF3      MOV	R31,R19
    04A51 912D      LD	R18,X+
    04A52 2322      TST	R18
    04A53 F7E9      BNE	0x4A51
    04A54 9711      SBIW	R26,1
    04A55 9121      LD	R18,Z+
    04A56 932D      ST	X+,R18
    04A57 2322      TST	R18
    04A58 F7E1      BNE	0x4A55
    04A59 9508      RET
_strlen:
    04A5A 2FE0      MOV	R30,R16
    04A5B 2FF1      MOV	R31,R17
    04A5C 27AA      CLR	R26
    04A5D 27BB      CLR	R27
    04A5E 9001      LD	R0,Z+
    04A5F 2000      TST	R0
    04A60 F011      BEQ	0x4A63
    04A61 9611      ADIW	R26,1
    04A62 CFFB      RJMP	0x4A5E
    04A63 2F0A      MOV	R16,R26
    04A64 2F1B      MOV	R17,R27
    04A65 9508      RET
push_arg4:
    04A66 933A      ST	-Y,R19
    04A67 932A      ST	-Y,R18
push_arg2:
    04A68 931A      ST	-Y,R17
    04A69 930A      ST	-Y,R16
    04A6A 9508      RET
asr32:
    04A6B 920F      PUSH	R0
    04A6C 9009      LD	R0,Y+
    04A6D 2000      TST	R0
    04A6E F031      BEQ	0x4A75
    04A6F 9535      ASR	R19
    04A70 9527      ROR	R18
    04A71 9517      ROR	R17
    04A72 9507      ROR	R16
    04A73 940A      DEC	R0
    04A74 CFF8      RJMP	0x4A6D
    04A75 900F      POP	R0
    04A76 9508      RET
mod16s:
    04A77 9468      BSET	6
    04A78 92DA      ST	-Y,R13
    04A79 2ED1      MOV	R13,R17
    04A7A C004      RJMP	0x4A7F
div16s:
    04A7B 94E8      BCLR	6
    04A7C 92DA      ST	-Y,R13
    04A7D 2ED1      MOV	R13,R17
    04A7E 26D3      EOR	R13,R19
    04A7F FF17      SBRS	R17,7
    04A80 C004      RJMP	0x4A85
    04A81 9510      COM	R17
    04A82 9500      COM	R16
    04A83 5F0F      SUBI	R16,0xFF
    04A84 4F1F      SBCI	R17,0xFF
    04A85 FF37      SBRS	R19,7
    04A86 C004      RJMP	0x4A8B
    04A87 9530      COM	R19
    04A88 9520      COM	R18
    04A89 5F2F      SUBI	R18,0xFF
    04A8A 4F3F      SBCI	R19,0xFF
    04A8B 940E 4A98 CALL	xdiv16u
    04A8D FED7      SBRS	R13,7
    04A8E C004      RJMP	0x4A93
    04A8F 9510      COM	R17
    04A90 9500      COM	R16
    04A91 5F0F      SUBI	R16,0xFF
    04A92 4F1F      SBCI	R17,0xFF
    04A93 90D9      LD	R13,Y+
    04A94 9508      RET
mod16u:
    04A95 9468      BSET	6
    04A96 C001      RJMP	xdiv16u
div16u:
    04A97 94E8      BCLR	6
xdiv16u:
    04A98 92EA      ST	-Y,R14
    04A99 92FA      ST	-Y,R15
    04A9A 938A      ST	-Y,R24
    04A9B 24EE      CLR	R14
    04A9C 24FF      CLR	R15
    04A9D E180      LDI	R24,0x10
    04A9E 0F00      LSL	R16
    04A9F 1F11      ROL	R17
    04AA0 1CEE      ROL	R14
    04AA1 1CFF      ROL	R15
    04AA2 16E2      CP	R14,R18
    04AA3 06F3      CPC	R15,R19
    04AA4 F018      BCS	0x4AA8
    04AA5 1AE2      SUB	R14,R18
    04AA6 0AF3      SBC	R15,R19
    04AA7 9503      INC	R16
    04AA8 958A      DEC	R24
    04AA9 F7A1      BNE	0x4A9E
    04AAA F416      BRTC	0x4AAD
    04AAB 2D0E      MOV	R16,R14
    04AAC 2D1F      MOV	R17,R15
    04AAD 9189      LD	R24,Y+
    04AAE 90F9      LD	R15,Y+
    04AAF 90E9      LD	R14,Y+
    04AB0 9508      RET
div32u:
    04AB1 94E8      BCLR	6
    04AB2 C001      RJMP	0x4AB4
mod32u:
    04AB3 9468      BSET	6
    04AB4 D030      RCALL	long_div_prolog
    04AB5 24CC      CLR	R12
    04AB6 C009      RJMP	0x4AC0
div32s:
    04AB7 94E8      BCLR	6
    04AB8 C001      RJMP	0x4ABA
mod32s:
    04AB9 9468      BSET	6
    04ABA D02A      RCALL	long_div_prolog
    04ABB FD37      SBRC	R19,7
    04ABC 940E 4C01 CALL	neg32
    04ABE FDB7      SBRC	R27,7
    04ABF D052      RCALL	neg_R24_R27
    04AC0 2477      CLR	R7
    04AC1 2488      CLR	R8
    04AC2 2499      CLR	R9
    04AC3 24AA      CLR	R10
    04AC4 24BB      CLR	R11
    04AC5 D042      RCALL	tst_R16_R19
    04AC6 F0C1      BEQ	0x4ADF
    04AC7 D045      RCALL	tst_R24_R27
    04AC8 F0B1      BEQ	0x4ADF
    04AC9 E2E8      LDI	R30,0x28
    04ACA 0F00      LSL	R16
    04ACB 1F11      ROL	R17
    04ACC 1F22      ROL	R18
    04ACD 1F33      ROL	R19
    04ACE 1C77      ROL	R7
    04ACF 1C88      ROL	R8
    04AD0 1C99      ROL	R9
    04AD1 1CAA      ROL	R10
    04AD2 1CBB      ROL	R11
    04AD3 1688      CP	R8,R24
    04AD4 0699      CPC	R9,R25
    04AD5 06AA      CPC	R10,R26
    04AD6 06BB      CPC	R11,R27
    04AD7 F028      BCS	0x4ADD
    04AD8 1A88      SUB	R8,R24
    04AD9 0A99      SBC	R9,R25
    04ADA 0AAA      SBC	R10,R26
    04ADB 0ABB      SBC	R11,R27
    04ADC 9503      INC	R16
    04ADD 95EA      DEC	R30
    04ADE F759      BNE	0x4ACA
    04ADF F426      BRTC	0x4AE4
    04AE0 2D08      MOV	R16,R8
    04AE1 2D19      MOV	R17,R9
    04AE2 2D2A      MOV	R18,R10
    04AE3 2D3B      MOV	R19,R11
    04AE4 C013      RJMP	long_div_epilog
long_div_prolog:
    04AE5 927A      ST	-Y,R7
    04AE6 928A      ST	-Y,R8
    04AE7 929A      ST	-Y,R9
    04AE8 92AA      ST	-Y,R10
    04AE9 92BA      ST	-Y,R11
    04AEA 92CA      ST	-Y,R12
    04AEB 93EA      ST	-Y,R30
    04AEC 938A      ST	-Y,R24
    04AED 939A      ST	-Y,R25
    04AEE 93AA      ST	-Y,R26
    04AEF 93BA      ST	-Y,R27
    04AF0 858B      LDD	R24,Y+11
    04AF1 859C      LDD	R25,Y+12
    04AF2 85AD      LDD	R26,Y+13
    04AF3 85BE      LDD	R27,Y+14
    04AF4 2EC3      MOV	R12,R19
    04AF5 F00E      BRTS	0x4AF7
    04AF6 26CB      EOR	R12,R27
    04AF7 9508      RET
long_div_epilog:
    04AF8 FCC7      SBRC	R12,7
    04AF9 940E 4C01 CALL	neg32
    04AFB 91B9      LD	R27,Y+
    04AFC 91A9      LD	R26,Y+
    04AFD 9199      LD	R25,Y+
    04AFE 9189      LD	R24,Y+
    04AFF 91E9      LD	R30,Y+
    04B00 90C9      LD	R12,Y+
    04B01 90B9      LD	R11,Y+
    04B02 90A9      LD	R10,Y+
    04B03 9099      LD	R9,Y+
    04B04 9089      LD	R8,Y+
    04B05 9079      LD	R7,Y+
    04B06 9624      ADIW	R28,4
    04B07 9508      RET
tst_R16_R19:
    04B08 2FE0      MOV	R30,R16
    04B09 2BE1      OR	R30,R17
    04B0A 2BE2      OR	R30,R18
    04B0B 2BE3      OR	R30,R19
    04B0C 9508      RET
tst_R24_R27:
    04B0D 2FE8      MOV	R30,R24
    04B0E 2BE9      OR	R30,R25
    04B0F 2BEA      OR	R30,R26
    04B10 2BEB      OR	R30,R27
    04B11 9508      RET
neg_R24_R27:
    04B12 9580      COM	R24
    04B13 9590      COM	R25
    04B14 95A0      COM	R26
    04B15 95B0      COM	R27
    04B16 5F8F      SUBI	R24,0xFF
    04B17 4F9F      SBCI	R25,0xFF
    04B18 4FAF      SBCI	R26,0xFF
    04B19 4FBF      SBCI	R27,0xFF
    04B1A 9508      RET
mod8u:
    04B1B 9468      BSET	6
    04B1C C001      RJMP	xdiv8u
div8u:
    04B1D 94E8      BCLR	6
xdiv8u:
    04B1E 932A      ST	-Y,R18
    04B1F 92FA      ST	-Y,R15
    04B20 92EA      ST	-Y,R14
    04B21 24FF      CLR	R15
    04B22 24EE      CLR	R14
    04B23 E120      LDI	R18,0x10
    04B24 0F00      LSL	R16
    04B25 1CFF      ROL	R15
    04B26 1CEE      ROL	R14
    04B27 16E1      CP	R14,R17
    04B28 F010      BCS	0x4B2B
    04B29 1AE1      SUB	R14,R17
    04B2A 9503      INC	R16
    04B2B 952A      DEC	R18
    04B2C F7B9      BNE	0x4B24
    04B2D F40E      BRTC	0x4B2F
    04B2E 2D0E      MOV	R16,R14
    04B2F 90E9      LD	R14,Y+
    04B30 90F9      LD	R15,Y+
    04B31 9129      LD	R18,Y+
    04B32 9508      RET
elpm32:
    04B33 93EA      ST	-Y,R30
    04B34 93FA      ST	-Y,R31
    04B35 920A      ST	-Y,R0
    04B36 2FE0      MOV	R30,R16
    04B37 2FF1      MOV	R31,R17
    04B38 95D8      ELPM
    04B39 2D00      MOV	R16,R0
    04B3A 9631      ADIW	R30,1
    04B3B 95D8      ELPM
    04B3C 2D10      MOV	R17,R0
    04B3D 9631      ADIW	R30,1
    04B3E 95D8      ELPM
    04B3F 2D20      MOV	R18,R0
    04B40 9631      ADIW	R30,1
    04B41 95D8      ELPM
    04B42 2D30      MOV	R19,R0
    04B43 9009      LD	R0,Y+
    04B44 91F9      LD	R31,Y+
    04B45 91E9      LD	R30,Y+
    04B46 9508      RET
empy16s:
    04B47 920A      ST	-Y,R0
    04B48 921A      ST	-Y,R1
    04B49 938A      ST	-Y,R24
    04B4A 939A      ST	-Y,R25
    04B4B 9F02      MUL	R16,R18
    04B4C 01C0      MOVW	R24,R0
    04B4D 9F12      MUL	R17,R18
    04B4E 0D90      ADD	R25,R0
    04B4F 9F03      MUL	R16,R19
    04B50 0D90      ADD	R25,R0
    04B51 018C      MOVW	R16,R24
    04B52 9199      LD	R25,Y+
    04B53 9189      LD	R24,Y+
    04B54 9019      LD	R1,Y+
    04B55 9009      LD	R0,Y+
    04B56 9508      RET
empy32s|empy32u:
    04B57 940E 4C0A CALL	long_prolog
    04B59 927A      ST	-Y,R7
    04B5A 940E 4C23 CALL	tstzero1
    04B5C F159      BEQ	0x4B88
    04B5D 2477      CLR	R7
    04B5E 940E 4C29 CALL	tstzero2
    04B60 F419      BNE	0x4B64
    04B61 018C      MOVW	R16,R24
    04B62 019D      MOVW	R18,R26
    04B63 C024      RJMP	0x4B88
    04B64 920A      ST	-Y,R0
    04B65 921A      ST	-Y,R1
    04B66 9F08      MUL	R16,R24
    04B67 2CB0      MOV	R11,R0
    04B68 2CA1      MOV	R10,R1
    04B69 9F28      MUL	R18,R24
    04B6A 2C90      MOV	R9,R0
    04B6B 2C81      MOV	R8,R1
    04B6C 9F18      MUL	R17,R24
    04B6D 0CA0      ADD	R10,R0
    04B6E 1C91      ADC	R9,R1
    04B6F 1C87      ADC	R8,R7
    04B70 9F09      MUL	R16,R25
    04B71 0CA0      ADD	R10,R0
    04B72 1C91      ADC	R9,R1
    04B73 1C87      ADC	R8,R7
    04B74 9F19      MUL	R17,R25
    04B75 0C90      ADD	R9,R0
    04B76 1C81      ADC	R8,R1
    04B77 9F0A      MUL	R16,R26
    04B78 0C90      ADD	R9,R0
    04B79 1C81      ADC	R8,R1
    04B7A 9F38      MUL	R19,R24
    04B7B 0C80      ADD	R8,R0
    04B7C 9F29      MUL	R18,R25
    04B7D 0C80      ADD	R8,R0
    04B7E 9F1A      MUL	R17,R26
    04B7F 0C80      ADD	R8,R0
    04B80 9F0B      MUL	R16,R27
    04B81 0C80      ADD	R8,R0
    04B82 9019      LD	R1,Y+
    04B83 9009      LD	R0,Y+
    04B84 2D0B      MOV	R16,R11
    04B85 2D1A      MOV	R17,R10
    04B86 2D29      MOV	R18,R9
    04B87 2D38      MOV	R19,R8
    04B88 9079      LD	R7,Y+
    04B89 940C 4C18 JMP	long_epilog
pop_xgset003C:
    04B8B 90A9      LD	R10,Y+
    04B8C 90B9      LD	R11,Y+
    04B8D 90C9      LD	R12,Y+
    04B8E 90D9      LD	R13,Y+
    04B8F 9508      RET
pop_xgset00FC:
    04B90 90A9      LD	R10,Y+
    04B91 90B9      LD	R11,Y+
    04B92 90C9      LD	R12,Y+
    04B93 90D9      LD	R13,Y+
    04B94 90E9      LD	R14,Y+
    04B95 90F9      LD	R15,Y+
    04B96 9508      RET
pop_xgset30FC:
    04B97 90A9      LD	R10,Y+
    04B98 90B9      LD	R11,Y+
    04B99 90C9      LD	R12,Y+
    04B9A 90D9      LD	R13,Y+
    04B9B 90E9      LD	R14,Y+
    04B9C 90F9      LD	R15,Y+
    04B9D 9149      LD	R20,Y+
    04B9E 9159      LD	R21,Y+
    04B9F 9508      RET
pop_xgsetF0FC:
    04BA0 90A9      LD	R10,Y+
    04BA1 90B9      LD	R11,Y+
    04BA2 90C9      LD	R12,Y+
    04BA3 90D9      LD	R13,Y+
    04BA4 90E9      LD	R14,Y+
    04BA5 90F9      LD	R15,Y+
    04BA6 9149      LD	R20,Y+
    04BA7 9159      LD	R21,Y+
    04BA8 9169      LD	R22,Y+
    04BA9 9179      LD	R23,Y+
    04BAA 9508      RET
push_xgsetF0FC:
    04BAB 937A      ST	-Y,R23
    04BAC 936A      ST	-Y,R22
push_xgset30FC:
    04BAD 935A      ST	-Y,R21
    04BAE 934A      ST	-Y,R20
push_xgset00FC:
    04BAF 92FA      ST	-Y,R15
    04BB0 92EA      ST	-Y,R14
push_xgset003C:
    04BB1 92DA      ST	-Y,R13
    04BB2 92CA      ST	-Y,R12
    04BB3 92BA      ST	-Y,R11
    04BB4 92AA      ST	-Y,R10
    04BB5 9508      RET
push_xgset300C:
    04BB6 935A      ST	-Y,R21
    04BB7 934A      ST	-Y,R20
    04BB8 92BA      ST	-Y,R11
    04BB9 92AA      ST	-Y,R10
    04BBA 9508      RET
pop_xgset300C:
    04BBB 90A9      LD	R10,Y+
    04BBC 90B9      LD	R11,Y+
    04BBD 9149      LD	R20,Y+
    04BBE 9159      LD	R21,Y+
    04BBF 9508      RET
push_xgsetF000:
    04BC0 937A      ST	-Y,R23
    04BC1 936A      ST	-Y,R22
    04BC2 935A      ST	-Y,R21
    04BC3 934A      ST	-Y,R20
    04BC4 9508      RET
pop_xgsetF000:
    04BC5 9149      LD	R20,Y+
    04BC6 9159      LD	R21,Y+
    04BC7 9169      LD	R22,Y+
    04BC8 9179      LD	R23,Y+
    04BC9 9508      RET
push_xgsetF00C:
    04BCA 937A      ST	-Y,R23
    04BCB 936A      ST	-Y,R22
    04BCC 935A      ST	-Y,R21
    04BCD 934A      ST	-Y,R20
    04BCE 92BA      ST	-Y,R11
    04BCF 92AA      ST	-Y,R10
    04BD0 9508      RET
pop_xgsetF00C:
    04BD1 90A9      LD	R10,Y+
    04BD2 90B9      LD	R11,Y+
    04BD3 9149      LD	R20,Y+
    04BD4 9159      LD	R21,Y+
    04BD5 9169      LD	R22,Y+
    04BD6 9179      LD	R23,Y+
    04BD7 9508      RET
push_xgset303C:
    04BD8 935A      ST	-Y,R21
    04BD9 934A      ST	-Y,R20
    04BDA 92DA      ST	-Y,R13
    04BDB 92CA      ST	-Y,R12
    04BDC 92BA      ST	-Y,R11
    04BDD 92AA      ST	-Y,R10
    04BDE 9508      RET
pop_xgset303C:
    04BDF 90A9      LD	R10,Y+
    04BE0 90B9      LD	R11,Y+
    04BE1 90C9      LD	R12,Y+
    04BE2 90D9      LD	R13,Y+
    04BE3 9149      LD	R20,Y+
    04BE4 9159      LD	R21,Y+
    04BE5 9508      RET
push_xgsetF03C:
    04BE6 937A      ST	-Y,R23
    04BE7 936A      ST	-Y,R22
    04BE8 935A      ST	-Y,R21
    04BE9 934A      ST	-Y,R20
    04BEA 92DA      ST	-Y,R13
    04BEB 92CA      ST	-Y,R12
    04BEC 92BA      ST	-Y,R11
    04BED 92AA      ST	-Y,R10
    04BEE 9508      RET
pop_xgsetF03C:
    04BEF 90A9      LD	R10,Y+
    04BF0 90B9      LD	R11,Y+
    04BF1 90C9      LD	R12,Y+
    04BF2 90D9      LD	R13,Y+
    04BF3 9149      LD	R20,Y+
    04BF4 9159      LD	R21,Y+
    04BF5 9169      LD	R22,Y+
    04BF6 9179      LD	R23,Y+
    04BF7 9508      RET
xicallx:
    04BF8 920A      ST	-Y,R0
    04BF9 95D8      ELPM
    04BFA 920A      ST	-Y,R0
    04BFB 9631      ADIW	R30,1
    04BFC 95D8      ELPM
    04BFD 2DF0      MOV	R31,R0
    04BFE 91E9      LD	R30,Y+
    04BFF 9009      LD	R0,Y+
    04C00 9409      IJMP
neg32:
    04C01 9500      COM	R16
    04C02 9510      COM	R17
    04C03 9520      COM	R18
    04C04 9530      COM	R19
    04C05 5F0F      SUBI	R16,0xFF
    04C06 4F1F      SBCI	R17,0xFF
    04C07 4F2F      SBCI	R18,0xFF
    04C08 4F3F      SBCI	R19,0xFF
    04C09 9508      RET
long_prolog:
    04C0A 928A      ST	-Y,R8
    04C0B 929A      ST	-Y,R9
    04C0C 92AA      ST	-Y,R10
    04C0D 92BA      ST	-Y,R11
    04C0E 93EA      ST	-Y,R30
    04C0F 938A      ST	-Y,R24
    04C10 939A      ST	-Y,R25
    04C11 93AA      ST	-Y,R26
    04C12 93BA      ST	-Y,R27
    04C13 8589      LDD	R24,Y+9
    04C14 859A      LDD	R25,Y+10
    04C15 85AB      LDD	R26,Y+11
    04C16 85BC      LDD	R27,Y+12
    04C17 9508      RET
long_epilog:
    04C18 91B9      LD	R27,Y+
    04C19 91A9      LD	R26,Y+
    04C1A 9199      LD	R25,Y+
    04C1B 9189      LD	R24,Y+
    04C1C 91E9      LD	R30,Y+
    04C1D 90B9      LD	R11,Y+
    04C1E 90A9      LD	R10,Y+
    04C1F 9099      LD	R9,Y+
    04C20 9089      LD	R8,Y+
    04C21 9624      ADIW	R28,4
    04C22 9508      RET
tstzero1:
    04C23 27EE      CLR	R30
    04C24 2BE0      OR	R30,R16
    04C25 2BE1      OR	R30,R17
    04C26 2BE2      OR	R30,R18
    04C27 2BE3      OR	R30,R19
    04C28 9508      RET
tstzero2:
    04C29 27EE      CLR	R30
    04C2A 2BE8      OR	R30,R24
    04C2B 2BE9      OR	R30,R25
    04C2C 2BEA      OR	R30,R26
    04C2D 2BEB      OR	R30,R27
    04C2E 9508      RET
lsl16:
    04C2F 2322      TST	R18
    04C30 F021      BEQ	0x4C35
    04C31 0F00      LSL	R16
    04C32 1F11      ROL	R17
    04C33 952A      DEC	R18
    04C34 CFFA      RJMP	lsl16
    04C35 9508      RET
lsl32:
    04C36 920F      PUSH	R0
    04C37 9009      LD	R0,Y+
    04C38 2000      TST	R0
    04C39 F031      BEQ	0x4C40
    04C3A 0F00      LSL	R16
    04C3B 1F11      ROL	R17
    04C3C 1F22      ROL	R18
    04C3D 1F33      ROL	R19
    04C3E 940A      DEC	R0
    04C3F CFF8      RJMP	0x4C38
    04C40 900F      POP	R0
    04C41 9508      RET
lsl8:
    04C42 2311      TST	R17
    04C43 F019      BEQ	0x4C47
    04C44 0F00      LSL	R16
    04C45 951A      DEC	R17
    04C46 CFFB      RJMP	lsl8
    04C47 9508      RET
lsr16:
    04C48 2322      TST	R18
    04C49 F021      BEQ	0x4C4E
    04C4A 9516      LSR	R17
    04C4B 9507      ROR	R16
    04C4C 952A      DEC	R18
    04C4D CFFA      RJMP	lsr16
    04C4E 9508      RET
lsr32:
    04C4F 920F      PUSH	R0
    04C50 9009      LD	R0,Y+
    04C51 2000      TST	R0
    04C52 F031      BEQ	0x4C59
    04C53 9536      LSR	R19
    04C54 9527      ROR	R18
    04C55 9517      ROR	R17
    04C56 9507      ROR	R16
    04C57 940A      DEC	R0
    04C58 CFF8      RJMP	0x4C51
    04C59 900F      POP	R0
    04C5A 9508      RET
asgnblk:
    04C5B 93AA      ST	-Y,R26
    04C5C 93BA      ST	-Y,R27
    04C5D 93EA      ST	-Y,R30
    04C5E 93FA      ST	-Y,R31
    04C5F 920A      ST	-Y,R0
    04C60 81AF      LDD	R26,Y+7
    04C61 85B8      LDD	R27,Y+8
    04C62 81ED      LDD	R30,Y+5
    04C63 81FE      LDD	R31,Y+6
    04C64 3000      CPI	R16,0
    04C65 0701      CPC	R16,R17
    04C66 F029      BEQ	0x4C6C
    04C67 9001      LD	R0,Z+
    04C68 920D      ST	X+,R0
    04C69 5001      SUBI	R16,1
    04C6A 4010      SBCI	R17,0
    04C6B CFF8      RJMP	0x4C64
    04C6C 9009      LD	R0,Y+
    04C6D 91F9      LD	R31,Y+
    04C6E 91E9      LD	R30,Y+
    04C6F 91B9      LD	R27,Y+
    04C70 91A9      LD	R26,Y+
    04C71 9624      ADIW	R28,4
    04C72 9508      RET
fpsub:
    04C73 9468      BSET	6
    04C74 C001      RJMP	fpadd_alt
fpadd:
    04C75 94E8      BCLR	6
fpadd_alt:
    04C76 940E 4E80 CALL	saveFPRegs
    04C78 940E 4E12 CALL	unpacks
    04C7A F409      BNE	0x4C7C
    04C7B C048      RJMP	0x4CC4
    04C7C 2CE6      MOV	R14,R6
    04C7D 2CD5      MOV	R13,R5
    04C7E 2CC4      MOV	R12,R4
    04C7F 2EB3      MOV	R11,R19
    04C80 2EA2      MOV	R10,R18
    04C81 2E91      MOV	R9,R17
    04C82 2E80      MOV	R8,R16
    04C83 8100      LD	R16,Z
    04C84 8111      LDD	R17,Z+1
    04C85 8122      LDD	R18,Z+2
    04C86 8133      LDD	R19,Z+3
    04C87 940E 4E12 CALL	unpacks
    04C89 F409      BNE	0x4C8B
    04C8A C044      RJMP	0x4CCF
    04C8B 2D84      MOV	R24,R4
    04C8C 2D95      MOV	R25,R5
    04C8D 198C      SUB	R24,R12
    04C8E 099D      SBC	R25,R13
    04C8F F0B9      BEQ	0x4CA7
    04C90 F472      BPL	0x4C9F
    04C91 9590      COM	R25
    04C92 9580      COM	R24
    04C93 9601      ADIW	R24,1
    04C94 2C4C      MOV	R4,R12
    04C95 2C5D      MOV	R5,R13
    04C96 3188      CPI	R24,0x18
    04C97 F5B8      BCC	0x4CCF
    04C98 9535      ASR	R19
    04C99 9527      ROR	R18
    04C9A 9517      ROR	R17
    04C9B 9507      ROR	R16
    04C9C 9701      SBIW	R24,1
    04C9D F7D1      BNE	0x4C98
    04C9E C008      RJMP	0x4CA7
    04C9F 3188      CPI	R24,0x18
    04CA0 F518      BCC	0x4CC4
    04CA1 94B5      ASR	R11
    04CA2 94A7      ROR	R10
    04CA3 9497      ROR	R9
    04CA4 9487      ROR	R8
    04CA5 9701      SBIW	R24,1
    04CA6 F7D1      BNE	0x4CA1
    04CA7 2466      CLR	R6
    04CA8 F02E      BRTS	0x4CAE
    04CA9 0D08      ADD	R16,R8
    04CAA 1D19      ADC	R17,R9
    04CAB 1D2A      ADC	R18,R10
    04CAC 1D3B      ADC	R19,R11
    04CAD C009      RJMP	0x4CB7
    04CAE 1A80      SUB	R8,R16
    04CAF 0A91      SBC	R9,R17
    04CB0 0AA2      SBC	R10,R18
    04CB1 0AB3      SBC	R11,R19
    04CB2 2D08      MOV	R16,R8
    04CB3 2D19      MOV	R17,R9
    04CB4 2D2A      MOV	R18,R10
    04CB5 2D3B      MOV	R19,R11
    04CB6 2333      TST	R19
    04CB7 F422      BPL	0x4CBC
    04CB8 940E 4C01 CALL	neg32
    04CBA E880      LDI	R24,0x80
    04CBB 2E68      MOV	R6,R24
    04CBC 940E 4E3B CALL	normalize_and_pack
    04CBE C002      RJMP	0x4CC1
    04CBF 940E 4E70 CALL	pack
    04CC1 940E 4E8F CALL	restoreFPRegs
    04CC3 9508      RET
    04CC4 8100      LD	R16,Z
    04CC5 8111      LDD	R17,Z+1
    04CC6 8122      LDD	R18,Z+2
    04CC7 8133      LDD	R19,Z+3
    04CC8 F7C6      BRTC	0x4CC1
    04CC9 940E 4E1A CALL	tstR16_R19
    04CCB F3A9      BEQ	0x4CC1
    04CCC E880      LDI	R24,0x80
    04CCD 2738      EOR	R19,R24
    04CCE CFF2      RJMP	0x4CC1
    04CCF 2D08      MOV	R16,R8
    04CD0 2D19      MOV	R17,R9
    04CD1 2D2A      MOV	R18,R10
    04CD2 2D3B      MOV	R19,R11
    04CD3 2C4C      MOV	R4,R12
    04CD4 2C5D      MOV	R5,R13
    04CD5 2C6E      MOV	R6,R14
    04CD6 2333      TST	R19
    04CD7 F73A      BPL	0x4CBF
    04CD8 940E 4C01 CALL	neg32
    04CDA E880      LDI	R24,0x80
    04CDB 2E68      MOV	R6,R24
    04CDC CFE2      RJMP	0x4CBF
fpadd1:
    04CDD 93FA      ST	-Y,R31
    04CDE 93EA      ST	-Y,R30
    04CDF 81EA      LDD	R30,Y+2
    04CE0 81FB      LDD	R31,Y+3
    04CE1 940E 4C75 CALL	fpadd
    04CE3 91E9      LD	R30,Y+
    04CE4 91F9      LD	R31,Y+
    04CE5 9622      ADIW	R28,2
    04CE6 9508      RET
fpadd2:
    04CE7 93FA      ST	-Y,R31
    04CE8 93EA      ST	-Y,R30
    04CE9 2FEC      MOV	R30,R28
    04CEA 2FFD      MOV	R31,R29
    04CEB 9632      ADIW	R30,2
    04CEC 940E 4C75 CALL	fpadd
    04CEE 91E9      LD	R30,Y+
    04CEF 91F9      LD	R31,Y+
    04CF0 9624      ADIW	R28,4
    04CF1 9508      RET
fpsub1:
    04CF2 93FA      ST	-Y,R31
    04CF3 93EA      ST	-Y,R30
    04CF4 81EA      LDD	R30,Y+2
    04CF5 81FB      LDD	R31,Y+3
    04CF6 940E 4C73 CALL	fpsub
    04CF8 91E9      LD	R30,Y+
    04CF9 91F9      LD	R31,Y+
    04CFA 9622      ADIW	R28,2
    04CFB 9508      RET
fpsub2:
    04CFC 93FA      ST	-Y,R31
    04CFD 93EA      ST	-Y,R30
    04CFE 2FEC      MOV	R30,R28
    04CFF 2FFD      MOV	R31,R29
    04D00 9632      ADIW	R30,2
    04D01 940E 4C73 CALL	fpsub
    04D03 91E9      LD	R30,Y+
    04D04 91F9      LD	R31,Y+
    04D05 9624      ADIW	R28,4
    04D06 9508      RET
fpsub1x:
    04D07 93FA      ST	-Y,R31
    04D08 93EA      ST	-Y,R30
    04D09 81EA      LDD	R30,Y+2
    04D0A 81FB      LDD	R31,Y+3
    04D0B 940E 4C73 CALL	fpsub
    04D0D 91E9      LD	R30,Y+
    04D0E 91F9      LD	R31,Y+
    04D0F 8339      STD	Y+1,R19
    04D10 8328      ST	Y,R18
    04D11 931A      ST	-Y,R17
    04D12 930A      ST	-Y,R16
    04D13 9508      RET
fpsub2x:
    04D14 93FA      ST	-Y,R31
    04D15 93EA      ST	-Y,R30
    04D16 2FEC      MOV	R30,R28
    04D17 2FFD      MOV	R31,R29
    04D18 9632      ADIW	R30,2
    04D19 940E 4C73 CALL	fpsub
    04D1B 91E9      LD	R30,Y+
    04D1C 91F9      LD	R31,Y+
    04D1D 833B      STD	Y+3,R19
    04D1E 832A      STD	Y+2,R18
    04D1F 8319      STD	Y+1,R17
    04D20 8308      ST	Y,R16
    04D21 9508      RET
fpint:
    04D22 924A      ST	-Y,R4
    04D23 925A      ST	-Y,R5
    04D24 926A      ST	-Y,R6
    04D25 938A      ST	-Y,R24
    04D26 940E 4E22 CALL	unpacku
    04D28 F111      BEQ	0x4D4B
    04D29 2055      TST	R5
    04D2A F0E2      BMI	0x4D47
    04D2B E18F      LDI	R24,0x1F
    04D2C 1648      CP	R4,R24
    04D2D F4C0      BCC	0x4D46
    04D2E E187      LDI	R24,0x17
    04D2F 1648      CP	R4,R24
    04D30 F0D1      BEQ	0x4D4B
    04D31 F458      BCC	0x4D3D
    04D32 9441      NEG	R4
    04D33 EE89      LDI	R24,0xE9
    04D34 1A48      SUB	R4,R24
    04D35 C005      RJMP	0x4D3B
    04D36 9535      ASR	R19
    04D37 9527      ROR	R18
    04D38 9517      ROR	R17
    04D39 9507      ROR	R16
    04D3A 944A      DEC	R4
    04D3B F7D1      BNE	0x4D36
    04D3C C00E      RJMP	0x4D4B
    04D3D E187      LDI	R24,0x17
    04D3E 1A48      SUB	R4,R24
    04D3F 0F00      LSL	R16
    04D40 1F11      ROL	R17
    04D41 1F22      ROL	R18
    04D42 1F33      ROL	R19
    04D43 944A      DEC	R4
    04D44 F7D1      BNE	0x4D3F
    04D45 C005      RJMP	0x4D4B
    04D46 E73F      LDI	R19,0x7F
    04D47 2F23      MOV	R18,R19
    04D48 2F13      MOV	R17,R19
    04D49 2F03      MOV	R16,R19
    04D4A C004      RJMP	0x4D4F
    04D4B 2066      TST	R6
    04D4C F011      BEQ	0x4D4F
    04D4D 940E 4C01 CALL	neg32
    04D4F 9189      LD	R24,Y+
    04D50 9069      LD	R6,Y+
    04D51 9059      LD	R5,Y+
    04D52 9049      LD	R4,Y+
    04D53 9508      RET
uint2fp:
    04D54 9468      BSET	6
    04D55 C001      RJMP	0x4D57
int2fp:
    04D56 94E8      BCLR	6
    04D57 2722      CLR	R18
    04D58 2733      CLR	R19
    04D59 F046      BRTS	0x4D62
    04D5A FD17      SBRC	R17,7
    04D5B 9520      COM	R18
    04D5C FD17      SBRC	R17,7
    04D5D 9530      COM	R19
    04D5E C003      RJMP	0x4D62
ulong2fp:
    04D5F 9468      BSET	6
    04D60 C001      RJMP	0x4D62
long2fp:
    04D61 94E8      BCLR	6
    04D62 924A      ST	-Y,R4
    04D63 925A      ST	-Y,R5
    04D64 926A      ST	-Y,R6
    04D65 938A      ST	-Y,R24
    04D66 E187      LDI	R24,0x17
    04D67 2E48      MOV	R4,R24
    04D68 2455      CLR	R5
    04D69 2466      CLR	R6
    04D6A F036      BRTS	0x4D71
    04D6B 2333      TST	R19
    04D6C F422      BPL	0x4D71
    04D6D 940E 4C01 CALL	neg32
    04D6F E880      LDI	R24,0x80
    04D70 2E68      MOV	R6,R24
    04D71 940E 4E3B CALL	normalize_and_pack
    04D73 9189      LD	R24,Y+
    04D74 9069      LD	R6,Y+
    04D75 9059      LD	R5,Y+
    04D76 9049      LD	R4,Y+
    04D77 9508      RET
fpdiv1:
    04D78 93FA      ST	-Y,R31
    04D79 93EA      ST	-Y,R30
    04D7A 81EA      LDD	R30,Y+2
    04D7B 81FB      LDD	R31,Y+3
    04D7C D027      RCALL	0x4DA4
    04D7D 91E9      LD	R30,Y+
    04D7E 91F9      LD	R31,Y+
    04D7F 9622      ADIW	R28,2
    04D80 9508      RET
fpdiv2:
    04D81 93FA      ST	-Y,R31
    04D82 93EA      ST	-Y,R30
    04D83 2FEC      MOV	R30,R28
    04D84 2FFD      MOV	R31,R29
    04D85 9632      ADIW	R30,2
    04D86 D01D      RCALL	0x4DA4
    04D87 91E9      LD	R30,Y+
    04D88 91F9      LD	R31,Y+
    04D89 9624      ADIW	R28,4
    04D8A 9508      RET
fpdiv1x:
    04D8B 93FA      ST	-Y,R31
    04D8C 93EA      ST	-Y,R30
    04D8D 81EA      LDD	R30,Y+2
    04D8E 81FB      LDD	R31,Y+3
    04D8F D014      RCALL	0x4DA4
    04D90 91E9      LD	R30,Y+
    04D91 91F9      LD	R31,Y+
    04D92 8339      STD	Y+1,R19
    04D93 8328      ST	Y,R18
    04D94 931A      ST	-Y,R17
    04D95 930A      ST	-Y,R16
    04D96 9508      RET
fpdiv2x:
    04D97 93FA      ST	-Y,R31
    04D98 93EA      ST	-Y,R30
    04D99 2FEC      MOV	R30,R28
    04D9A 2FFD      MOV	R31,R29
    04D9B 9632      ADIW	R30,2
    04D9C D007      RCALL	0x4DA4
    04D9D 91E9      LD	R30,Y+
    04D9E 91F9      LD	R31,Y+
    04D9F 833B      STD	Y+3,R19
    04DA0 832A      STD	Y+2,R18
    04DA1 8319      STD	Y+1,R17
    04DA2 8308      ST	Y,R16
    04DA3 9508      RET
    04DA4 920A      ST	-Y,R0
    04DA5 921A      ST	-Y,R1
    04DA6 922A      ST	-Y,R2
    04DA7 923A      ST	-Y,R3
    04DA8 940E 4E80 CALL	saveFPRegs
    04DAA 933A      ST	-Y,R19
    04DAB 932A      ST	-Y,R18
    04DAC 931A      ST	-Y,R17
    04DAD 930A      ST	-Y,R16
    04DAE 8100      LD	R16,Z
    04DAF 8111      LDD	R17,Z+1
    04DB0 8122      LDD	R18,Z+2
    04DB1 8133      LDD	R19,Z+3
    04DB2 940E 4E22 CALL	unpacku
    04DB4 F409      BNE	0x4DB6
    04DB5 C057      RJMP	0x4E0D
    04DB6 2CE6      MOV	R14,R6
    04DB7 2CD5      MOV	R13,R5
    04DB8 2CC4      MOV	R12,R4
    04DB9 2EB3      MOV	R11,R19
    04DBA 2EA2      MOV	R10,R18
    04DBB 2E91      MOV	R9,R17
    04DBC 2E80      MOV	R8,R16
    04DBD 9109      LD	R16,Y+
    04DBE 9119      LD	R17,Y+
    04DBF 9129      LD	R18,Y+
    04DC0 9139      LD	R19,Y+
    04DC1 940E 4E22 CALL	unpacku
    04DC3 F1A1      BEQ	0x4DF8
    04DC4 246E      EOR	R6,R14
    04DC5 184C      SUB	R4,R12
    04DC6 085D      SBC	R5,R13
    04DC7 E880      LDI	R24,0x80
    04DC8 1648      CP	R4,R24
    04DC9 0653      CPC	R5,R19
    04DCA F00C      BLT	0x4DCC
    04DCB C033      RJMP	0x4DFF
    04DCC E881      LDI	R24,0x81
    04DCD 1648      CP	R4,R24
    04DCE EF8F      LDI	R24,0xFF
    04DCF 0658      CPC	R5,R24
    04DD0 F40C      BGE	0x4DD2
    04DD1 C036      RJMP	0x4E08
    04DD2 E280      LDI	R24,0x20
    04DD3 2433      CLR	R3
    04DD4 2E23      MOV	R2,R19
    04DD5 2E12      MOV	R1,R18
    04DD6 2E01      MOV	R0,R17
    04DD7 2F30      MOV	R19,R16
    04DD8 2722      CLR	R18
    04DD9 2711      CLR	R17
    04DDA 2700      CLR	R16
    04DDB 9426      LSR	R2
    04DDC 9417      ROR	R1
    04DDD 9407      ROR	R0
    04DDE 9537      ROR	R19
    04DDF 9527      ROR	R18
    04DE0 0F00      LSL	R16
    04DE1 1F11      ROL	R17
    04DE2 1F22      ROL	R18
    04DE3 1F33      ROL	R19
    04DE4 1C00      ROL	R0
    04DE5 1C11      ROL	R1
    04DE6 1C22      ROL	R2
    04DE7 1C33      ROL	R3
    04DE8 F028      BCS	0x4DEE
    04DE9 1808      SUB	R0,R8
    04DEA 0819      SBC	R1,R9
    04DEB 082A      SBC	R2,R10
    04DEC 083B      SBC	R3,R11
    04DED C004      RJMP	0x4DF2
    04DEE 0C08      ADD	R0,R8
    04DEF 1C19      ADC	R1,R9
    04DF0 1C2A      ADC	R2,R10
    04DF1 1C3B      ADC	R3,R11
    04DF2 F00A      BMI	0x4DF4
    04DF3 6001      ORI	R16,1
    04DF4 958A      DEC	R24
    04DF5 F751      BNE	0x4DE0
    04DF6 940E 4E3B CALL	normalize_and_pack
    04DF8 940E 4E8F CALL	restoreFPRegs
    04DFA 9039      LD	R3,Y+
    04DFB 9029      LD	R2,Y+
    04DFC 9019      LD	R1,Y+
    04DFD 9009      LD	R0,Y+
    04DFE 9508      RET
    04DFF EF0F      LDI	R16,0xFF
    04E00 2F10      MOV	R17,R16
    04E01 E72F      LDI	R18,0x7F
    04E02 E73F      LDI	R19,0x7F
    04E03 2066      TST	R6
    04E04 F399      BEQ	0x4DF8
    04E05 940E 4C01 CALL	neg32
    04E07 CFF0      RJMP	0x4DF8
    04E08 2700      CLR	R16
    04E09 2F10      MOV	R17,R16
    04E0A 2F20      MOV	R18,R16
    04E0B 2F30      MOV	R19,R16
    04E0C CFEB      RJMP	0x4DF8
    04E0D 9109      LD	R16,Y+
    04E0E 9119      LD	R17,Y+
    04E0F 9129      LD	R18,Y+
    04E10 9139      LD	R19,Y+
    04E11 CFED      RJMP	0x4DFF
unpacks:
    04E12 D00F      RCALL	unpacku
    04E13 F029      BEQ	0x4E19
    04E14 2066      TST	R6
    04E15 F011      BEQ	0x4E18
    04E16 940E 4C01 CALL	neg32
    04E18 9498      BCLR	1
    04E19 9508      RET
tstR16_R19:
    04E1A 2300      TST	R16
    04E1B F429      BNE	0x4E21
    04E1C 2311      TST	R17
    04E1D F419      BNE	0x4E21
    04E1E 2322      TST	R18
    04E1F F409      BNE	0x4E21
    04E20 2333      TST	R19
    04E21 9508      RET
unpacku:
    04E22 DFF7      RCALL	tstR16_R19
    04E23 F099      BEQ	0x4E37
    04E24 938A      ST	-Y,R24
    04E25 2E63      MOV	R6,R19
    04E26 E880      LDI	R24,0x80
    04E27 2268      AND	R6,R24
    04E28 0F22      LSL	R18
    04E29 1F33      ROL	R19
    04E2A 2E43      MOV	R4,R19
    04E2B E78F      LDI	R24,0x7F
    04E2C 1A48      SUB	R4,R24
    04E2D 2455      CLR	R5
    04E2E 2788      CLR	R24
    04E2F 0A58      SBC	R5,R24
    04E30 9526      LSR	R18
    04E31 E830      LDI	R19,0x80
    04E32 2B23      OR	R18,R19
    04E33 2733      CLR	R19
    04E34 9189      LD	R24,Y+
    04E35 9498      BCLR	1
    04E36 9508      RET
    04E37 2444      CLR	R4
    04E38 2455      CLR	R5
    04E39 2466      CLR	R6
    04E3A 9508      RET
normalize_and_pack:
    04E3B DFDE      RCALL	tstR16_R19
    04E3C F409      BNE	0x4E3E
    04E3D 9508      RET
    04E3E 93AA      ST	-Y,R26
    04E3F 93BA      ST	-Y,R27
    04E40 01D2      MOVW	R26,R4
    04E41 939A      ST	-Y,R25
    04E42 938A      ST	-Y,R24
    04E43 E78E      LDI	R24,0x7E
    04E44 E090      LDI	R25,0
    04E45 2333      TST	R19
    04E46 F049      BEQ	0x4E50
    04E47 9536      LSR	R19
    04E48 9527      ROR	R18
    04E49 9517      ROR	R17
    04E4A 9507      ROR	R16
    04E4B 17A8      CP	R26,R24
    04E4C 07B9      CPC	R27,R25
    04E4D F4CC      BGE	0x4E67
    04E4E 9611      ADIW	R26,1
    04E4F CFF5      RJMP	0x4E45
    04E50 9580      COM	R24
    04E51 9590      COM	R25
    04E52 9601      ADIW	R24,1
    04E53 2322      TST	R18
    04E54 F0BA      BMI	0x4E6C
    04E55 0F00      LSL	R16
    04E56 1F11      ROL	R17
    04E57 1F22      ROL	R18
    04E58 17A8      CP	R26,R24
    04E59 07B9      CPC	R27,R25
    04E5A F014      BLT	0x4E5D
    04E5B 9711      SBIW	R26,1
    04E5C CFF6      RJMP	0x4E53
    04E5D 2700      CLR	R16
    04E5E 2711      CLR	R17
    04E5F 2722      CLR	R18
    04E60 2733      CLR	R19
    04E61 9189      LD	R24,Y+
    04E62 9199      LD	R25,Y+
    04E63 012D      MOVW	R4,R26
    04E64 91B9      LD	R27,Y+
    04E65 91A9      LD	R26,Y+
    04E66 9508      RET
    04E67 2733      CLR	R19
    04E68 EF0F      LDI	R16,0xFF
    04E69 2F10      MOV	R17,R16
    04E6A E72F      LDI	R18,0x7F
    04E6B 2F32      MOV	R19,R18
    04E6C 9189      LD	R24,Y+
    04E6D 9199      LD	R25,Y+
    04E6E 012D      MOVW	R4,R26
    04E6F C002      RJMP	0x4E72
pack:
    04E70 93AA      ST	-Y,R26
    04E71 93BA      ST	-Y,R27
    04E72 DFA7      RCALL	tstR16_R19
    04E73 F049      BEQ	0x4E7D
    04E74 01D2      MOVW	R26,R4
    04E75 58A1      SUBI	R26,0x81
    04E76 4FBF      SBCI	R27,0xFF
    04E77 012D      MOVW	R4,R26
    04E78 2D34      MOV	R19,R4
    04E79 0F22      LSL	R18
    04E7A 9536      LSR	R19
    04E7B 9527      ROR	R18
    04E7C 2936      OR	R19,R6
    04E7D 91B9      LD	R27,Y+
    04E7E 91A9      LD	R26,Y+
    04E7F 9508      RET
saveFPRegs:
    04E80 924A      ST	-Y,R4
    04E81 925A      ST	-Y,R5
    04E82 926A      ST	-Y,R6
    04E83 927A      ST	-Y,R7
    04E84 928A      ST	-Y,R8
    04E85 929A      ST	-Y,R9
    04E86 92AA      ST	-Y,R10
    04E87 92BA      ST	-Y,R11
    04E88 92CA      ST	-Y,R12
    04E89 92DA      ST	-Y,R13
    04E8A 92EA      ST	-Y,R14
    04E8B 92FA      ST	-Y,R15
    04E8C 938A      ST	-Y,R24
    04E8D 939A      ST	-Y,R25
    04E8E 9508      RET
restoreFPRegs:
    04E8F 9199      LD	R25,Y+
    04E90 9189      LD	R24,Y+
    04E91 90F9      LD	R15,Y+
    04E92 90E9      LD	R14,Y+
    04E93 90D9      LD	R13,Y+
    04E94 90C9      LD	R12,Y+
    04E95 90B9      LD	R11,Y+
    04E96 90A9      LD	R10,Y+
    04E97 9099      LD	R9,Y+
    04E98 9089      LD	R8,Y+
    04E99 9079      LD	R7,Y+
    04E9A 9069      LD	R6,Y+
    04E9B 9059      LD	R5,Y+
    04E9C 9049      LD	R4,Y+
    04E9D 9508      RET
fpmule:
    04E9E 940E 4E80 CALL	saveFPRegs
    04EA0 93AA      ST	-Y,R26
    04EA1 93BA      ST	-Y,R27
    04EA2 940E 4E22 CALL	unpacku
    04EA4 F1E1      BEQ	0x4EE1
    04EA5 2CE6      MOV	R14,R6
    04EA6 2CD5      MOV	R13,R5
    04EA7 2CC4      MOV	R12,R4
    04EA8 2EB3      MOV	R11,R19
    04EA9 2EA2      MOV	R10,R18
    04EAA 2E91      MOV	R9,R17
    04EAB 2E80      MOV	R8,R16
    04EAC 8100      LD	R16,Z
    04EAD 8111      LDD	R17,Z+1
    04EAE 8122      LDD	R18,Z+2
    04EAF 8133      LDD	R19,Z+3
    04EB0 940E 4E22 CALL	unpacku
    04EB2 F171      BEQ	0x4EE1
    04EB3 246E      EOR	R6,R14
    04EB4 0C4C      ADD	R4,R12
    04EB5 1C5D      ADC	R5,R13
    04EB6 E880      LDI	R24,0x80
    04EB7 1648      CP	R4,R24
    04EB8 0653      CPC	R5,R19
    04EB9 F564      BGE	0x4EE6
    04EBA E881      LDI	R24,0x81
    04EBB 1648      CP	R4,R24
    04EBC EF8F      LDI	R24,0xFF
    04EBD 0658      CPC	R5,R24
    04EBE F16C      BLT	0x4EEC
    04EBF 9EA2      MUL	R10,R18
    04EC0 2DB1      MOV	R27,R1
    04EC1 2DA0      MOV	R26,R0
    04EC2 9E91      MUL	R9,R17
    04EC3 2D91      MOV	R25,R1
    04EC4 2D80      MOV	R24,R0
    04EC5 9EA0      MUL	R10,R16
    04EC6 0D80      ADD	R24,R0
    04EC7 1D91      ADC	R25,R1
    04EC8 1FA3      ADC	R26,R19
    04EC9 1FB3      ADC	R27,R19
    04ECA 9E82      MUL	R8,R18
    04ECB 0D80      ADD	R24,R0
    04ECC 1D91      ADC	R25,R1
    04ECD 1FA3      ADC	R26,R19
    04ECE 1FB3      ADC	R27,R19
    04ECF 9E92      MUL	R9,R18
    04ED0 0D90      ADD	R25,R0
    04ED1 1DA1      ADC	R26,R1
    04ED2 1FB3      ADC	R27,R19
    04ED3 9EA1      MUL	R10,R17
    04ED4 0D90      ADD	R25,R0
    04ED5 1DA1      ADC	R26,R1
    04ED6 1FB3      ADC	R27,R19
    04ED7 2F2B      MOV	R18,R27
    04ED8 2F1A      MOV	R17,R26
    04ED9 2F09      MOV	R16,R25
    04EDA 0F88      LSL	R24
    04EDB 1F00      ROL	R16
    04EDC 1F11      ROL	R17
    04EDD 1F22      ROL	R18
    04EDE 1F33      ROL	R19
    04EDF 940E 4E3B CALL	normalize_and_pack
    04EE1 91B9      LD	R27,Y+
    04EE2 91A9      LD	R26,Y+
    04EE3 940E 4E8F CALL	restoreFPRegs
    04EE5 9508      RET
    04EE6 EF0F      LDI	R16,0xFF
    04EE7 2F10      MOV	R17,R16
    04EE8 E72F      LDI	R18,0x7F
    04EE9 E78F      LDI	R24,0x7F
    04EEA 2E48      MOV	R4,R24
    04EEB CFF5      RJMP	0x4EE1
    04EEC 2700      CLR	R16
    04EED 2F10      MOV	R17,R16
    04EEE 2F20      MOV	R18,R16
    04EEF 2F30      MOV	R19,R16
    04EF0 CFF0      RJMP	0x4EE1
fpmule1:
    04EF1 93FA      ST	-Y,R31
    04EF2 93EA      ST	-Y,R30
    04EF3 81EA      LDD	R30,Y+2
    04EF4 81FB      LDD	R31,Y+3
    04EF5 940E 4E9E CALL	fpmule
    04EF7 91E9      LD	R30,Y+
    04EF8 91F9      LD	R31,Y+
    04EF9 9622      ADIW	R28,2
    04EFA 9508      RET
fpmule2:
    04EFB 93FA      ST	-Y,R31
    04EFC 93EA      ST	-Y,R30
    04EFD 2FEC      MOV	R30,R28
    04EFE 2FFD      MOV	R31,R29
    04EFF 9632      ADIW	R30,2
    04F00 940E 4E9E CALL	fpmule
    04F02 91E9      LD	R30,Y+
    04F03 91F9      LD	R31,Y+
    04F04 9624      ADIW	R28,4
    04F05 9508      RET
fpmule1x:
    04F06 93FA      ST	-Y,R31
    04F07 93EA      ST	-Y,R30
    04F08 81EA      LDD	R30,Y+2
    04F09 81FB      LDD	R31,Y+3
    04F0A 940E 4E9E CALL	fpmule
    04F0C 91E9      LD	R30,Y+
    04F0D 91F9      LD	R31,Y+
    04F0E 8339      STD	Y+1,R19
    04F0F 8328      ST	Y,R18
    04F10 931A      ST	-Y,R17
    04F11 930A      ST	-Y,R16
    04F12 9508      RET
fpcmp:
    04F13 940E 4C73 CALL	fpsub
    04F15 2333      TST	R19
    04F16 F03A      BMI	0x4F1E
    04F17 940E 4E1A CALL	tstR16_R19
    04F19 F011      BEQ	0x4F1C
    04F1A E001      LDI	R16,1
    04F1B 9508      RET
    04F1C 2700      CLR	R16
    04F1D 9508      RET
    04F1E EF0F      LDI	R16,0xFF
    04F1F 9508      RET
fpcmp1:
    04F20 93FA      ST	-Y,R31
    04F21 93EA      ST	-Y,R30
    04F22 81EA      LDD	R30,Y+2
    04F23 81FB      LDD	R31,Y+3
    04F24 940E 4F13 CALL	fpcmp
    04F26 91E9      LD	R30,Y+
    04F27 91F9      LD	R31,Y+
    04F28 9622      ADIW	R28,2
    04F29 2300      TST	R16
    04F2A 9508      RET
fpcmp2:
    04F2B 93FA      ST	-Y,R31
    04F2C 93EA      ST	-Y,R30
    04F2D 2FEC      MOV	R30,R28
    04F2E 2FFD      MOV	R31,R29
    04F2F 9632      ADIW	R30,2
    04F30 940E 4F13 CALL	fpcmp
    04F32 91E9      LD	R30,Y+
    04F33 91F9      LD	R31,Y+
    04F34 9624      ADIW	R28,4
    04F35 2300      TST	R16
    04F36 9508      RET
_cstrcpy:
    04F37 2FA0      MOV	R26,R16
    04F38 2FB1      MOV	R27,R17
    04F39 2FE2      MOV	R30,R18
    04F3A 2FF3      MOV	R31,R19
    04F3B 95C8      LPM
    04F3C 9631      ADIW	R30,1
    04F3D 920D      ST	X+,R0
    04F3E 2000      TST	R0
    04F3F F7D9      BNE	0x4F3B
    04F40 9508      RET
_cstrlen:
    04F41 2FE0      MOV	R30,R16
    04F42 2FF1      MOV	R31,R17
    04F43 27AA      CLR	R26
    04F44 27BB      CLR	R27
    04F45 95C8      LPM
    04F46 2000      TST	R0
    04F47 F019      BEQ	0x4F4B
    04F48 9631      ADIW	R30,1
    04F49 9611      ADIW	R26,1
    04F4A CFFA      RJMP	0x4F45
    04F4B 2F0A      MOV	R16,R26
    04F4C 2F1B      MOV	R17,R27
    04F4D 9508      RET
_atoi:
    04F4E 940E 4BCA CALL	push_xgsetF00C
    04F50 0158      MOVW	R10,R16
    04F51 C003      RJMP	0x4F55
    04F52 01C5      MOVW	R24,R10
    04F53 9601      ADIW	R24,1
    04F54 015C      MOVW	R10,R24
    04F55 01F5      MOVW	R30,R10
    04F56 8100      LD	R16,Z
    04F57 2711      CLR	R17
    04F58 940E 5301 CALL	_isspace
    04F5A 3000      CPI	R16,0
    04F5B 0701      CPC	R16,R17
    04F5C F7A9      BNE	0x4F52
    04F5D 2766      CLR	R22
    04F5E 2777      CLR	R23
    04F5F 01F5      MOVW	R30,R10
    04F60 8180      LD	R24,Z
    04F61 328D      CPI	R24,0x2D
    04F62 F429      BNE	0x4F68
    04F63 E061      LDI	R22,1
    04F64 01CF      MOVW	R24,R30
    04F65 9601      ADIW	R24,1
    04F66 015C      MOVW	R10,R24
    04F67 C007      RJMP	0x4F6F
    04F68 01F5      MOVW	R30,R10
    04F69 8180      LD	R24,Z
    04F6A 328B      CPI	R24,0x2B
    04F6B F419      BNE	0x4F6F
    04F6C 01CF      MOVW	R24,R30
    04F6D 9601      ADIW	R24,1
    04F6E 015C      MOVW	R10,R24
    04F6F 2744      CLR	R20
    04F70 2755      CLR	R21
    04F71 C00E      RJMP	0x4F80
    04F72 E00A      LDI	R16,0xA
    04F73 E010      LDI	R17,0
    04F74 019A      MOVW	R18,R20
    04F75 940E 4B47 CALL	empy16s
    04F77 01A8      MOVW	R20,R16
    04F78 01F5      MOVW	R30,R10
    04F79 9021      LD	R2,Z+
    04F7A 015F      MOVW	R10,R30
    04F7B 2433      CLR	R3
    04F7C 0D42      ADD	R20,R2
    04F7D 1D53      ADC	R21,R3
    04F7E 5340      SUBI	R20,0x30
    04F7F 4050      SBCI	R21,0
    04F80 01F5      MOVW	R30,R10
    04F81 8100      LD	R16,Z
    04F82 2711      CLR	R17
    04F83 940E 52ED CALL	_isdigit
    04F85 3000      CPI	R16,0
    04F86 0701      CPC	R16,R17
    04F87 F751      BNE	0x4F72
    04F88 3060      CPI	R22,0
    04F89 0767      CPC	R22,R23
    04F8A F031      BEQ	0x4F91
    04F8B 018A      MOVW	R16,R20
    04F8C 9500      COM	R16
    04F8D 9510      COM	R17
    04F8E 5F0F      SUBI	R16,0xFF
    04F8F 4F1F      SBCI	R17,0xFF
    04F90 C001      RJMP	0x4F92
    04F91 018A      MOVW	R16,R20
    04F92 940C 4BD1 JMP	pop_xgsetF00C
_itoa:
    04F94 940E 4A66 CALL	push_arg4
    04F96 940E 4BAB CALL	push_xgsetF0FC
    04F98 01A9      MOVW	R20,R18
    04F99 84EE      LDD	R14,Y+14
    04F9A 84FF      LDD	R15,Y+15
    04F9B 015A      MOVW	R10,R20
    04F9C 20AA      TST	R10
    04F9D F451      BNE	0x4FA8
    04F9E 20BB      TST	R11
    04F9F F441      BNE	0x4FA8
    04FA0 E380      LDI	R24,0x30
    04FA1 85EA      LDD	R30,Y+10
    04FA2 85FB      LDD	R31,Y+11
    04FA3 8380      ST	Z,R24
    04FA4 2422      CLR	R2
    04FA5 8221      STD	Z+1,R2
    04FA6 018F      MOVW	R16,R30
    04FA7 C053      RJMP	0x4FFB
    04FA8 3040      CPI	R20,0
    04FA9 E0E0      LDI	R30,0
    04FAA 075E      CPC	R21,R30
    04FAB F46C      BGE	0x4FB9
    04FAC 01C7      MOVW	R24,R14
    04FAD 308A      CPI	R24,0xA
    04FAE E0E0      LDI	R30,0
    04FAF 079E      CPC	R25,R30
    04FB0 F441      BNE	0x4FB9
    04FB1 24CC      CLR	R12
    04FB2 94C3      INC	R12
    04FB3 01C5      MOVW	R24,R10
    04FB4 9580      COM	R24
    04FB5 9590      COM	R25
    04FB6 9601      ADIW	R24,1
    04FB7 015C      MOVW	R10,R24
    04FB8 C001      RJMP	0x4FBA
    04FB9 24CC      CLR	R12
    04FBA 856A      LDD	R22,Y+10
    04FBB 857B      LDD	R23,Y+11
    04FBC 0197      MOVW	R18,R14
    04FBD 0185      MOVW	R16,R10
    04FBE 940E 4A95 CALL	mod16u
    04FC0 01A8      MOVW	R20,R16
    04FC1 E089      LDI	R24,0x9
    04FC2 E090      LDI	R25,0
    04FC3 1780      CP	R24,R16
    04FC4 0791      CPC	R25,R17
    04FC5 F034      BLT	0x4FCC
    04FC6 01CA      MOVW	R24,R20
    04FC7 96C0      ADIW	R24,0x30
    04FC8 01FB      MOVW	R30,R22
    04FC9 9381      ST	Z+,R24
    04FCA 01BF      MOVW	R22,R30
    04FCB C006      RJMP	0x4FD2
    04FCC 01CA      MOVW	R24,R20
    04FCD 5A89      SUBI	R24,0xA9
    04FCE 4F9F      SBCI	R25,0xFF
    04FCF 01FB      MOVW	R30,R22
    04FD0 9381      ST	Z+,R24
    04FD1 01BF      MOVW	R22,R30
    04FD2 0197      MOVW	R18,R14
    04FD3 0185      MOVW	R16,R10
    04FD4 940E 4A97 CALL	div16u
    04FD6 0158      MOVW	R10,R16
    04FD7 20AA      TST	R10
    04FD8 F719      BNE	0x4FBC
    04FD9 20BB      TST	R11
    04FDA F709      BNE	0x4FBC
    04FDB 20CC      TST	R12
    04FDC F021      BEQ	0x4FE1
    04FDD E28D      LDI	R24,0x2D
    04FDE 01FB      MOVW	R30,R22
    04FDF 9381      ST	Z+,R24
    04FE0 01BF      MOVW	R22,R30
    04FE1 012B      MOVW	R4,R22
    04FE2 5061      SUBI	R22,1
    04FE3 4070      SBCI	R23,0
    04FE4 2422      CLR	R2
    04FE5 01F2      MOVW	R30,R4
    04FE6 8220      ST	Z,R2
    04FE7 84AA      LDD	R10,Y+10
    04FE8 84BB      LDD	R11,Y+11
    04FE9 C00C      RJMP	0x4FF6
    04FEA 01F5      MOVW	R30,R10
    04FEB 80C0      LD	R12,Z
    04FEC 01FB      MOVW	R30,R22
    04FED 8020      LD	R2,Z
    04FEE 01F5      MOVW	R30,R10
    04FEF 9221      ST	Z+,R2
    04FF0 015F      MOVW	R10,R30
    04FF1 011B      MOVW	R2,R22
    04FF2 5061      SUBI	R22,1
    04FF3 4070      SBCI	R23,0
    04FF4 01F1      MOVW	R30,R2
    04FF5 82C0      ST	Z,R12
    04FF6 16A6      CP	R10,R22
    04FF7 06B7      CPC	R11,R23
    04FF8 F388      BCS	0x4FEA
    04FF9 850A      LDD	R16,Y+10
    04FFA 851B      LDD	R17,Y+11
    04FFB 940E 4BA0 CALL	pop_xgsetF0FC
    04FFD 9624      ADIW	R28,4
    04FFE 9508      RET
_ltoa:
    04FFF 940E 4A66 CALL	push_arg4
    05001 940E 4BAB CALL	push_xgsetF0FC
    05003 9724      SBIW	R28,4
    05004 8828      LDD	R2,Y+16
    05005 8839      LDD	R3,Y+17
    05006 884A      LDD	R4,Y+18
    05007 885B      LDD	R5,Y+19
    05008 8228      ST	Y,R2
    05009 8239      STD	Y+1,R3
    0500A 824A      STD	Y+2,R4
    0500B 825B      STD	Y+3,R5
    0500C 8828      LDD	R2,Y+16
    0500D 8839      LDD	R3,Y+17
    0500E 884A      LDD	R4,Y+18
    0500F 885B      LDD	R5,Y+19
    05010 9488      BCLR	0
    05011 2022      TST	R2
    05012 0432      CPC	R3,R2
    05013 0442      CPC	R4,R2
    05014 0452      CPC	R5,R2
    05015 F441      BNE	0x501E
    05016 E380      LDI	R24,0x30
    05017 85EE      LDD	R30,Y+14
    05018 85FF      LDD	R31,Y+15
    05019 8380      ST	Z,R24
    0501A 2422      CLR	R2
    0501B 8221      STD	Z+1,R2
    0501C 018F      MOVW	R16,R30
    0501D C094      RJMP	0x50B2
    0501E E040      LDI	R20,0
    0501F E050      LDI	R21,0
    05020 E060      LDI	R22,0
    05021 E070      LDI	R23,0
    05022 8828      LDD	R2,Y+16
    05023 8839      LDD	R3,Y+17
    05024 884A      LDD	R4,Y+18
    05025 885B      LDD	R5,Y+19
    05026 1624      CP	R2,R20
    05027 0635      CPC	R3,R21
    05028 0646      CPC	R4,R22
    05029 0657      CPC	R5,R23
    0502A F4EC      BGE	0x5048
    0502B 898C      LDD	R24,Y+20
    0502C 899D      LDD	R25,Y+21
    0502D 308A      CPI	R24,0xA
    0502E E0A0      LDI	R26,0
    0502F 079A      CPC	R25,R26
    05030 F4B9      BNE	0x5048
    05031 24AA      CLR	R10
    05032 94A3      INC	R10
    05033 E041      LDI	R20,1
    05034 E050      LDI	R21,0
    05035 E060      LDI	R22,0
    05036 E070      LDI	R23,0
    05037 8028      LD	R2,Y
    05038 8039      LDD	R3,Y+1
    05039 804A      LDD	R4,Y+2
    0503A 805B      LDD	R5,Y+3
    0503B 9420      COM	R2
    0503C 9430      COM	R3
    0503D 9440      COM	R4
    0503E 9450      COM	R5
    0503F 0E24      ADD	R2,R20
    05040 1E35      ADC	R3,R21
    05041 1E46      ADC	R4,R22
    05042 1E57      ADC	R5,R23
    05043 8228      ST	Y,R2
    05044 8239      STD	Y+1,R3
    05045 824A      STD	Y+2,R4
    05046 825B      STD	Y+3,R5
    05047 C001      RJMP	0x5049
    05048 24AA      CLR	R10
    05049 84CE      LDD	R12,Y+14
    0504A 84DF      LDD	R13,Y+15
    0504B 882C      LDD	R2,Y+20
    0504C 883D      LDD	R3,Y+21
    0504D 2444      CLR	R4
    0504E FC37      SBRC	R3,7
    0504F 9440      COM	R4
    05050 2455      CLR	R5
    05051 FC47      SBRC	R4,7
    05052 9450      COM	R5
    05053 8108      LD	R16,Y
    05054 8119      LDD	R17,Y+1
    05055 812A      LDD	R18,Y+2
    05056 813B      LDD	R19,Y+3
    05057 925A      ST	-Y,R5
    05058 924A      ST	-Y,R4
    05059 923A      ST	-Y,R3
    0505A 922A      ST	-Y,R2
    0505B 940E 4AB3 CALL	mod32u
    0505D 0178      MOVW	R14,R16
    0505E E089      LDI	R24,0x9
    0505F E090      LDI	R25,0
    05060 1780      CP	R24,R16
    05061 0791      CPC	R25,R17
    05062 F034      BLT	0x5069
    05063 01C7      MOVW	R24,R14
    05064 96C0      ADIW	R24,0x30
    05065 01F6      MOVW	R30,R12
    05066 9381      ST	Z+,R24
    05067 016F      MOVW	R12,R30
    05068 C006      RJMP	0x506F
    05069 01C7      MOVW	R24,R14
    0506A 5A89      SUBI	R24,0xA9
    0506B 4F9F      SBCI	R25,0xFF
    0506C 01F6      MOVW	R30,R12
    0506D 9381      ST	Z+,R24
    0506E 016F      MOVW	R12,R30
    0506F 882C      LDD	R2,Y+20
    05070 883D      LDD	R3,Y+21
    05071 2444      CLR	R4
    05072 FC37      SBRC	R3,7
    05073 9440      COM	R4
    05074 2455      CLR	R5
    05075 FC47      SBRC	R4,7
    05076 9450      COM	R5
    05077 8108      LD	R16,Y
    05078 8119      LDD	R17,Y+1
    05079 812A      LDD	R18,Y+2
    0507A 813B      LDD	R19,Y+3
    0507B 925A      ST	-Y,R5
    0507C 924A      ST	-Y,R4
    0507D 923A      ST	-Y,R3
    0507E 922A      ST	-Y,R2
    0507F 940E 4AB1 CALL	div32u
    05081 8308      ST	Y,R16
    05082 8319      STD	Y+1,R17
    05083 832A      STD	Y+2,R18
    05084 833B      STD	Y+3,R19
    05085 8028      LD	R2,Y
    05086 8039      LDD	R3,Y+1
    05087 804A      LDD	R4,Y+2
    05088 805B      LDD	R5,Y+3
    05089 9488      BCLR	0
    0508A 2022      TST	R2
    0508B 0432      CPC	R3,R2
    0508C 0442      CPC	R4,R2
    0508D 0452      CPC	R5,R2
    0508E F009      BEQ	0x5090
    0508F CFBB      RJMP	0x504B
    05090 20AA      TST	R10
    05091 F021      BEQ	0x5096
    05092 E28D      LDI	R24,0x2D
    05093 01F6      MOVW	R30,R12
    05094 9381      ST	Z+,R24
    05095 016F      MOVW	R12,R30
    05096 0126      MOVW	R4,R12
    05097 01C2      MOVW	R24,R4
    05098 9701      SBIW	R24,1
    05099 016C      MOVW	R12,R24
    0509A 2422      CLR	R2
    0509B 01F2      MOVW	R30,R4
    0509C 8220      ST	Z,R2
    0509D 84EE      LDD	R14,Y+14
    0509E 84FF      LDD	R15,Y+15
    0509F C00D      RJMP	0x50AD
    050A0 01F7      MOVW	R30,R14
    050A1 80A0      LD	R10,Z
    050A2 01F6      MOVW	R30,R12
    050A3 8020      LD	R2,Z
    050A4 01F7      MOVW	R30,R14
    050A5 9221      ST	Z+,R2
    050A6 017F      MOVW	R14,R30
    050A7 0116      MOVW	R2,R12
    050A8 01C1      MOVW	R24,R2
    050A9 9701      SBIW	R24,1
    050AA 016C      MOVW	R12,R24
    050AB 01F1      MOVW	R30,R2
    050AC 82A0      ST	Z,R10
    050AD 14EC      CP	R14,R12
    050AE 04FD      CPC	R15,R13
    050AF F380      BCS	0x50A0
    050B0 850E      LDD	R16,Y+14
    050B1 851F      LDD	R17,Y+15
    050B2 9624      ADIW	R28,4
    050B3 940E 4BA0 CALL	pop_xgsetF0FC
    050B5 9624      ADIW	R28,4
    050B6 9508      RET
_ultoa:
    050B7 933A      ST	-Y,R19
    050B8 932A      ST	-Y,R18
    050B9 940E 4BAB CALL	push_xgsetF0FC
    050BB 0158      MOVW	R10,R16
    050BC 84CE      LDD	R12,Y+14
    050BD 84DF      LDD	R13,Y+15
    050BE 01A5      MOVW	R20,R10
    050BF 0116      MOVW	R2,R12
    050C0 2444      CLR	R4
    050C1 FC37      SBRC	R3,7
    050C2 9440      COM	R4
    050C3 2455      CLR	R5
    050C4 FC47      SBRC	R4,7
    050C5 9450      COM	R5
    050C6 850A      LDD	R16,Y+10
    050C7 851B      LDD	R17,Y+11
    050C8 852C      LDD	R18,Y+12
    050C9 853D      LDD	R19,Y+13
    050CA 925A      ST	-Y,R5
    050CB 924A      ST	-Y,R4
    050CC 923A      ST	-Y,R3
    050CD 922A      ST	-Y,R2
    050CE 940E 4AB3 CALL	mod32u
    050D0 01B8      MOVW	R22,R16
    050D1 E089      LDI	R24,0x9
    050D2 E090      LDI	R25,0
    050D3 1780      CP	R24,R16
    050D4 0791      CPC	R25,R17
    050D5 F034      BLT	0x50DC
    050D6 01CB      MOVW	R24,R22
    050D7 96C0      ADIW	R24,0x30
    050D8 01FA      MOVW	R30,R20
    050D9 9381      ST	Z+,R24
    050DA 01AF      MOVW	R20,R30
    050DB C006      RJMP	0x50E2
    050DC 01CB      MOVW	R24,R22
    050DD 5A89      SUBI	R24,0xA9
    050DE 4F9F      SBCI	R25,0xFF
    050DF 01FA      MOVW	R30,R20
    050E0 9381      ST	Z+,R24
    050E1 01AF      MOVW	R20,R30
    050E2 0116      MOVW	R2,R12
    050E3 2444      CLR	R4
    050E4 FC37      SBRC	R3,7
    050E5 9440      COM	R4
    050E6 2455      CLR	R5
    050E7 FC47      SBRC	R4,7
    050E8 9450      COM	R5
    050E9 850A      LDD	R16,Y+10
    050EA 851B      LDD	R17,Y+11
    050EB 852C      LDD	R18,Y+12
    050EC 853D      LDD	R19,Y+13
    050ED 925A      ST	-Y,R5
    050EE 924A      ST	-Y,R4
    050EF 923A      ST	-Y,R3
    050F0 922A      ST	-Y,R2
    050F1 940E 4AB1 CALL	div32u
    050F3 870A      STD	Y+10,R16
    050F4 871B      STD	Y+11,R17
    050F5 872C      STD	Y+12,R18
    050F6 873D      STD	Y+13,R19
    050F7 842A      LDD	R2,Y+10
    050F8 843B      LDD	R3,Y+11
    050F9 844C      LDD	R4,Y+12
    050FA 845D      LDD	R5,Y+13
    050FB 9488      BCLR	0
    050FC 2022      TST	R2
    050FD 0432      CPC	R3,R2
    050FE 0442      CPC	R4,R2
    050FF 0452      CPC	R5,R2
    05100 F009      BEQ	0x5102
    05101 CFBD      RJMP	0x50BF
    05102 012A      MOVW	R4,R20
    05103 5041      SUBI	R20,1
    05104 4050      SBCI	R21,0
    05105 2422      CLR	R2
    05106 01F2      MOVW	R30,R4
    05107 8220      ST	Z,R2
    05108 0165      MOVW	R12,R10
    05109 C00C      RJMP	0x5116
    0510A 01F6      MOVW	R30,R12
    0510B 80E0      LD	R14,Z
    0510C 01FA      MOVW	R30,R20
    0510D 8020      LD	R2,Z
    0510E 01F6      MOVW	R30,R12
    0510F 9221      ST	Z+,R2
    05110 016F      MOVW	R12,R30
    05111 011A      MOVW	R2,R20
    05112 5041      SUBI	R20,1
    05113 4050      SBCI	R21,0
    05114 01F1      MOVW	R30,R2
    05115 82E0      ST	Z,R14
    05116 16C4      CP	R12,R20
    05117 06D5      CPC	R13,R21
    05118 F388      BCS	0x510A
    05119 0185      MOVW	R16,R10
    0511A 940E 4BA0 CALL	pop_xgsetF0FC
    0511C 9622      ADIW	R28,2
    0511D 9508      RET
_utoa:
    0511E 940E 4BAB CALL	push_xgsetF0FC
    05120 0169      MOVW	R12,R18
    05121 0158      MOVW	R10,R16
    05122 84EA      LDD	R14,Y+10
    05123 84FB      LDD	R15,Y+11
    05124 01A5      MOVW	R20,R10
    05125 0197      MOVW	R18,R14
    05126 0186      MOVW	R16,R12
    05127 940E 4A95 CALL	mod16u
    05129 01B8      MOVW	R22,R16
    0512A E089      LDI	R24,0x9
    0512B E090      LDI	R25,0
    0512C 1780      CP	R24,R16
    0512D 0791      CPC	R25,R17
    0512E F034      BLT	0x5135
    0512F 01CB      MOVW	R24,R22
    05130 96C0      ADIW	R24,0x30
    05131 01FA      MOVW	R30,R20
    05132 9381      ST	Z+,R24
    05133 01AF      MOVW	R20,R30
    05134 C006      RJMP	0x513B
    05135 01CB      MOVW	R24,R22
    05136 5A89      SUBI	R24,0xA9
    05137 4F9F      SBCI	R25,0xFF
    05138 01FA      MOVW	R30,R20
    05139 9381      ST	Z+,R24
    0513A 01AF      MOVW	R20,R30
    0513B 0197      MOVW	R18,R14
    0513C 0186      MOVW	R16,R12
    0513D 940E 4A97 CALL	div16u
    0513F 0168      MOVW	R12,R16
    05140 20CC      TST	R12
    05141 F719      BNE	0x5125
    05142 20DD      TST	R13
    05143 F709      BNE	0x5125
    05144 012A      MOVW	R4,R20
    05145 5041      SUBI	R20,1
    05146 4050      SBCI	R21,0
    05147 2422      CLR	R2
    05148 01F2      MOVW	R30,R4
    05149 8220      ST	Z,R2
    0514A 0165      MOVW	R12,R10
    0514B C00C      RJMP	0x5158
    0514C 01F6      MOVW	R30,R12
    0514D 80E0      LD	R14,Z
    0514E 01FA      MOVW	R30,R20
    0514F 8020      LD	R2,Z
    05150 01F6      MOVW	R30,R12
    05151 9221      ST	Z+,R2
    05152 016F      MOVW	R12,R30
    05153 011A      MOVW	R2,R20
    05154 5041      SUBI	R20,1
    05155 4050      SBCI	R21,0
    05156 01F1      MOVW	R30,R2
    05157 82E0      ST	Z,R14
    05158 16C4      CP	R12,R20
    05159 06D5      CPC	R13,R21
    0515A F388      BCS	0x514C
    0515B 0185      MOVW	R16,R10
    0515C 940C 4BA0 JMP	pop_xgsetF0FC
_ftoa:
    0515E 940E 4A66 CALL	push_arg4
    05160 940E 4BAB CALL	push_xgsetF0FC
    05162 9764      SBIW	R28,0x14
    05163 A0CA      LDD	R12,Y+34
    05164 A0DB      LDD	R13,Y+35
    05165 2422      CLR	R2
    05166 2433      CLR	R3
    05167 01F6      MOVW	R30,R12
    05168 8231      STD	Z+1,R3
    05169 8220      ST	Z,R2
    0516A 8C2E      LDD	R2,Y+30
    0516B 8C3F      LDD	R3,Y+31
    0516C A048      LDD	R4,Y+32
    0516D A059      LDD	R5,Y+33
    0516E EF0E      LDI	R16,0xFE
    0516F E010      LDI	R17,0
    05170 940E 4B33 CALL	elpm32
    05172 933A      ST	-Y,R19
    05173 932A      ST	-Y,R18
    05174 931A      ST	-Y,R17
    05175 930A      ST	-Y,R16
    05176 0181      MOVW	R16,R2
    05177 0192      MOVW	R18,R4
    05178 940E 4F2B CALL	fpcmp2
    0517A F479      BNE	0x518A
    0517B E380      LDI	R24,0x30
    0517C 9380 096D STS	Rec+118,R24
    0517E E28E      LDI	R24,0x2E
    0517F 9380 096E STS	Rec+119,R24
    05181 E380      LDI	R24,0x30
    05182 9380 096F STS	Rec+120,R24
    05184 2422      CLR	R2
    05185 9220 0970 STS	Rec+121,R2
    05187 E60D      LDI	R16,0x6D
    05188 E019      LDI	R17,0x9
    05189 C15E      RJMP	0x52E8
    0518A 8C2E      LDD	R2,Y+30
    0518B 8C3F      LDD	R3,Y+31
    0518C A048      LDD	R4,Y+32
    0518D A059      LDD	R5,Y+33
    0518E 8628      STD	Y+8,R2
    0518F 8639      STD	Y+9,R3
    05190 864A      STD	Y+10,R4
    05191 865B      STD	Y+11,R5
    05192 E187      LDI	R24,0x17
    05193 E090      LDI	R25,0
    05194 8508      LDD	R16,Y+8
    05195 8519      LDD	R17,Y+9
    05196 852A      LDD	R18,Y+10
    05197 853B      LDD	R19,Y+11
    05198 938A      ST	-Y,R24
    05199 940E 4A6B CALL	asr32
    0519B 2F80      MOV	R24,R16
    0519C 2799      CLR	R25
    0519D 578F      SUBI	R24,0x7F
    0519E 4090      SBCI	R25,0
    0519F 015C      MOVW	R10,R24
    051A0 EF4F      LDI	R20,0xFF
    051A1 EF5F      LDI	R21,0xFF
    051A2 EF6F      LDI	R22,0xFF
    051A3 E070      LDI	R23,0
    051A4 8428      LDD	R2,Y+8
    051A5 8439      LDD	R3,Y+9
    051A6 844A      LDD	R4,Y+10
    051A7 845B      LDD	R5,Y+11
    051A8 2224      AND	R2,R20
    051A9 2235      AND	R3,R21
    051AA 2246      AND	R4,R22
    051AB 2257      AND	R5,R23
    051AC 93EF      PUSH	R30
    051AD 2DE4      MOV	R30,R4
    051AE 68E0      ORI	R30,0x80
    051AF 2E4E      MOV	R4,R30
    051B0 91EF      POP	R30
    051B1 8A28      STD	Y+16,R2
    051B2 8A39      STD	Y+17,R3
    051B3 8A4A      STD	Y+18,R4
    051B4 8A5B      STD	Y+19,R5
    051B5 E080      LDI	R24,0
    051B6 838C      STD	Y+4,R24
    051B7 838D      STD	Y+5,R24
    051B8 838E      STD	Y+6,R24
    051B9 838F      STD	Y+7,R24
    051BA E080      LDI	R24,0
    051BB 878C      STD	Y+12,R24
    051BC 878D      STD	Y+13,R24
    051BD 878E      STD	Y+14,R24
    051BE 878F      STD	Y+15,R24
    051BF 01C5      MOVW	R24,R10
    051C0 318F      CPI	R24,0x1F
    051C1 E0E0      LDI	R30,0
    051C2 079E      CPC	R25,R30
    051C3 F044      BLT	0x51CC
    051C4 EF8E      LDI	R24,0xFE
    051C5 EF9F      LDI	R25,0xFF
    051C6 01F6      MOVW	R30,R12
    051C7 8391      STD	Z+1,R25
    051C8 8380      ST	Z,R24
    051C9 2700      CLR	R16
    051CA 2711      CLR	R17
    051CB C11C      RJMP	0x52E8
    051CC 01C5      MOVW	R24,R10
    051CD 3E89      CPI	R24,0xE9
    051CE EFEF      LDI	R30,0xFF
    051CF 079E      CPC	R25,R30
    051D0 F444      BGE	0x51D9
    051D1 EF8F      LDI	R24,0xFF
    051D2 EF9F      LDI	R25,0xFF
    051D3 01F6      MOVW	R30,R12
    051D4 8391      STD	Z+1,R25
    051D5 8380      ST	Z,R24
    051D6 2700      CLR	R16
    051D7 2711      CLR	R17
    051D8 C10F      RJMP	0x52E8
    051D9 01C5      MOVW	R24,R10
    051DA 3187      CPI	R24,0x17
    051DB E0A0      LDI	R26,0
    051DC 079A      CPC	R25,R26
    051DD F06C      BLT	0x51EB
    051DE 9747      SBIW	R24,0x17
    051DF 8908      LDD	R16,Y+16
    051E0 8919      LDD	R17,Y+17
    051E1 892A      LDD	R18,Y+18
    051E2 893B      LDD	R19,Y+19
    051E3 938A      ST	-Y,R24
    051E4 940E 4C36 CALL	lsl32
    051E6 870C      STD	Y+12,R16
    051E7 871D      STD	Y+13,R17
    051E8 872E      STD	Y+14,R18
    051E9 873F      STD	Y+15,R19
    051EA C045      RJMP	0x5230
    051EB 01C5      MOVW	R24,R10
    051EC 3080      CPI	R24,0
    051ED E0A0      LDI	R26,0
    051EE 079A      CPC	R25,R26
    051EF F13C      BLT	0x5217
    051F0 E187      LDI	R24,0x17
    051F1 E090      LDI	R25,0
    051F2 198A      SUB	R24,R10
    051F3 099B      SBC	R25,R11
    051F4 8908      LDD	R16,Y+16
    051F5 8919      LDD	R17,Y+17
    051F6 892A      LDD	R18,Y+18
    051F7 893B      LDD	R19,Y+19
    051F8 938A      ST	-Y,R24
    051F9 940E 4A6B CALL	asr32
    051FB 870C      STD	Y+12,R16
    051FC 871D      STD	Y+13,R17
    051FD 872E      STD	Y+14,R18
    051FE 873F      STD	Y+15,R19
    051FF 01C5      MOVW	R24,R10
    05200 9601      ADIW	R24,1
    05201 8908      LDD	R16,Y+16
    05202 8919      LDD	R17,Y+17
    05203 892A      LDD	R18,Y+18
    05204 893B      LDD	R19,Y+19
    05205 938A      ST	-Y,R24
    05206 940E 4C36 CALL	lsl32
    05208 0118      MOVW	R2,R16
    05209 0129      MOVW	R4,R18
    0520A EF4F      LDI	R20,0xFF
    0520B EF5F      LDI	R21,0xFF
    0520C EF6F      LDI	R22,0xFF
    0520D E070      LDI	R23,0
    0520E 2224      AND	R2,R20
    0520F 2235      AND	R3,R21
    05210 2246      AND	R4,R22
    05211 2257      AND	R5,R23
    05212 822C      STD	Y+4,R2
    05213 823D      STD	Y+5,R3
    05214 824E      STD	Y+6,R4
    05215 825F      STD	Y+7,R5
    05216 C019      RJMP	0x5230
    05217 EF4F      LDI	R20,0xFF
    05218 EF5F      LDI	R21,0xFF
    05219 EF6F      LDI	R22,0xFF
    0521A E070      LDI	R23,0
    0521B 8908      LDD	R16,Y+16
    0521C 8919      LDD	R17,Y+17
    0521D 892A      LDD	R18,Y+18
    0521E 893B      LDD	R19,Y+19
    0521F 2304      AND	R16,R20
    05220 2315      AND	R17,R21
    05221 2326      AND	R18,R22
    05222 2337      AND	R19,R23
    05223 01C5      MOVW	R24,R10
    05224 9601      ADIW	R24,1
    05225 9580      COM	R24
    05226 9590      COM	R25
    05227 5F8F      SUBI	R24,0xFF
    05228 4F9F      SBCI	R25,0xFF
    05229 938A      ST	-Y,R24
    0522A 940E 4A6B CALL	asr32
    0522C 830C      STD	Y+4,R16
    0522D 831D      STD	Y+5,R17
    0522E 832E      STD	Y+6,R18
    0522F 833F      STD	Y+7,R19
    05230 E68D      LDI	R24,0x6D
    05231 E099      LDI	R25,0x9
    05232 015C      MOVW	R10,R24
    05233 E040      LDI	R20,0
    05234 E050      LDI	R21,0
    05235 E060      LDI	R22,0
    05236 E070      LDI	R23,0
    05237 8428      LDD	R2,Y+8
    05238 8439      LDD	R3,Y+9
    05239 844A      LDD	R4,Y+10
    0523A 845B      LDD	R5,Y+11
    0523B 1624      CP	R2,R20
    0523C 0635      CPC	R3,R21
    0523D 0646      CPC	R4,R22
    0523E 0657      CPC	R5,R23
    0523F F424      BGE	0x5244
    05240 E28D      LDI	R24,0x2D
    05241 01F5      MOVW	R30,R10
    05242 9381      ST	Z+,R24
    05243 015F      MOVW	R10,R30
    05244 842C      LDD	R2,Y+12
    05245 843D      LDD	R3,Y+13
    05246 844E      LDD	R4,Y+14
    05247 845F      LDD	R5,Y+15
    05248 9488      BCLR	0
    05249 2022      TST	R2
    0524A 0432      CPC	R3,R2
    0524B 0442      CPC	R4,R2
    0524C 0452      CPC	R5,R2
    0524D F429      BNE	0x5253
    0524E E380      LDI	R24,0x30
    0524F 01F5      MOVW	R30,R10
    05250 9381      ST	Z+,R24
    05251 015F      MOVW	R10,R30
    05252 C016      RJMP	0x5269
    05253 E08A      LDI	R24,0xA
    05254 E090      LDI	R25,0
    05255 839B      STD	Y+3,R25
    05256 838A      STD	Y+2,R24
    05257 842C      LDD	R2,Y+12
    05258 843D      LDD	R3,Y+13
    05259 844E      LDD	R4,Y+14
    0525A 845F      LDD	R5,Y+15
    0525B 8248      ST	Y,R4
    0525C 8259      STD	Y+1,R5
    0525D 0191      MOVW	R18,R2
    0525E 0185      MOVW	R16,R10
    0525F 940E 4FFF CALL	_ltoa
    05261 C003      RJMP	0x5265
    05262 01C5      MOVW	R24,R10
    05263 9601      ADIW	R24,1
    05264 015C      MOVW	R10,R24
    05265 01F5      MOVW	R30,R10
    05266 8020      LD	R2,Z
    05267 2022      TST	R2
    05268 F7C9      BNE	0x5262
    05269 E28E      LDI	R24,0x2E
    0526A 01F5      MOVW	R30,R10
    0526B 9381      ST	Z+,R24
    0526C 015F      MOVW	R10,R30
    0526D 802C      LDD	R2,Y+4
    0526E 803D      LDD	R3,Y+5
    0526F 804E      LDD	R4,Y+6
    05270 805F      LDD	R5,Y+7
    05271 9488      BCLR	0
    05272 2022      TST	R2
    05273 0432      CPC	R3,R2
    05274 0442      CPC	R4,R2
    05275 0452      CPC	R5,R2
    05276 F421      BNE	0x527B
    05277 E380      LDI	R24,0x30
    05278 9381      ST	Z+,R24
    05279 015F      MOVW	R10,R30
    0527A C068      RJMP	0x52E3
    0527B E68D      LDI	R24,0x6D
    0527C E099      LDI	R25,0x9
    0527D 0115      MOVW	R2,R10
    0527E 1A28      SUB	R2,R24
    0527F 0A39      SBC	R3,R25
    05280 E08F      LDI	R24,0xF
    05281 E090      LDI	R25,0
    05282 1982      SUB	R24,R2
    05283 0993      SBC	R25,R3
    05284 9701      SBIW	R24,1
    05285 2EC8      MOV	R12,R24
    05286 E087      LDI	R24,7
    05287 158C      CP	R24,R12
    05288 F408      BCC	0x528A
    05289 2EC8      MOV	R12,R24
    0528A 24EE      CLR	R14
    0528B C042      RJMP	0x52CE
    0528C E083      LDI	R24,3
    0528D E090      LDI	R25,0
    0528E 810C      LDD	R16,Y+4
    0528F 811D      LDD	R17,Y+5
    05290 812E      LDD	R18,Y+6
    05291 813F      LDD	R19,Y+7
    05292 938A      ST	-Y,R24
    05293 940E 4C36 CALL	lsl32
    05295 0118      MOVW	R2,R16
    05296 0129      MOVW	R4,R18
    05297 806C      LDD	R6,Y+4
    05298 807D      LDD	R7,Y+5
    05299 808E      LDD	R8,Y+6
    0529A 809F      LDD	R9,Y+7
    0529B 0C66      LSL	R6
    0529C 1C77      ROL	R7
    0529D 1C88      ROL	R8
    0529E 1C99      ROL	R9
    0529F 0C26      ADD	R2,R6
    052A0 1C37      ADC	R3,R7
    052A1 1C48      ADC	R4,R8
    052A2 1C59      ADC	R5,R9
    052A3 822C      STD	Y+4,R2
    052A4 823D      STD	Y+5,R3
    052A5 824E      STD	Y+6,R4
    052A6 825F      STD	Y+7,R5
    052A7 E188      LDI	R24,0x18
    052A8 E090      LDI	R25,0
    052A9 810C      LDD	R16,Y+4
    052AA 811D      LDD	R17,Y+5
    052AB 812E      LDD	R18,Y+6
    052AC 813F      LDD	R19,Y+7
    052AD 938A      ST	-Y,R24
    052AE 940E 4A6B CALL	asr32
    052B0 0118      MOVW	R2,R16
    052B1 0129      MOVW	R4,R18
    052B2 E340      LDI	R20,0x30
    052B3 E050      LDI	R21,0
    052B4 E060      LDI	R22,0
    052B5 E070      LDI	R23,0
    052B6 0E24      ADD	R2,R20
    052B7 1E35      ADC	R3,R21
    052B8 1E46      ADC	R4,R22
    052B9 1E57      ADC	R5,R23
    052BA 01F5      MOVW	R30,R10
    052BB 9221      ST	Z+,R2
    052BC 015F      MOVW	R10,R30
    052BD EF4F      LDI	R20,0xFF
    052BE EF5F      LDI	R21,0xFF
    052BF EF6F      LDI	R22,0xFF
    052C0 E070      LDI	R23,0
    052C1 802C      LDD	R2,Y+4
    052C2 803D      LDD	R3,Y+5
    052C3 804E      LDD	R4,Y+6
    052C4 805F      LDD	R5,Y+7
    052C5 2224      AND	R2,R20
    052C6 2235      AND	R3,R21
    052C7 2246      AND	R4,R22
    052C8 2257      AND	R5,R23
    052C9 822C      STD	Y+4,R2
    052CA 823D      STD	Y+5,R3
    052CB 824E      STD	Y+6,R4
    052CC 825F      STD	Y+7,R5
    052CD 94E3      INC	R14
    052CE 14EC      CP	R14,R12
    052CF F408      BCC	0x52D1
    052D0 CFBB      RJMP	0x528C
    052D1 01C5      MOVW	R24,R10
    052D2 9701      SBIW	R24,1
    052D3 015C      MOVW	R10,R24
    052D4 C003      RJMP	0x52D8
    052D5 01C5      MOVW	R24,R10
    052D6 9701      SBIW	R24,1
    052D7 015C      MOVW	R10,R24
    052D8 01F5      MOVW	R30,R10
    052D9 8180      LD	R24,Z
    052DA 3380      CPI	R24,0x30
    052DB F421      BNE	0x52E0
    052DC 9731      SBIW	R30,1
    052DD 8180      LD	R24,Z
    052DE 328E      CPI	R24,0x2E
    052DF F7A9      BNE	0x52D5
    052E0 01C5      MOVW	R24,R10
    052E1 9601      ADIW	R24,1
    052E2 015C      MOVW	R10,R24
    052E3 2422      CLR	R2
    052E4 01F5      MOVW	R30,R10
    052E5 8220      ST	Z,R2
    052E6 E60D      LDI	R16,0x6D
    052E7 E019      LDI	R17,0x9
    052E8 9664      ADIW	R28,0x14
    052E9 940E 4BA0 CALL	pop_xgsetF0FC
    052EB 9624      ADIW	R28,4
    052EC 9508      RET
_isdigit:
    052ED E083      LDI	R24,3
    052EE E091      LDI	R25,1
    052EF 01F8      MOVW	R30,R16
    052F0 0FE8      ADD	R30,R24
    052F1 1FF9      ADC	R31,R25
    052F2 9106      ELPM	R16,Z
    052F3 2711      CLR	R17
    052F4 7004      ANDI	R16,4
    052F5 7010      ANDI	R17,0
    052F6 9508      RET
_islower:
    052F7 E083      LDI	R24,3
    052F8 E091      LDI	R25,1
    052F9 01F8      MOVW	R30,R16
    052FA 0FE8      ADD	R30,R24
    052FB 1FF9      ADC	R31,R25
    052FC 9106      ELPM	R16,Z
    052FD 2711      CLR	R17
    052FE 7002      ANDI	R16,2
    052FF 7010      ANDI	R17,0
    05300 9508      RET
_isspace:
    05301 E083      LDI	R24,3
    05302 E091      LDI	R25,1
    05303 01F8      MOVW	R30,R16
    05304 0FE8      ADD	R30,R24
    05305 1FF9      ADC	R31,R25
    05306 9106      ELPM	R16,Z
    05307 2711      CLR	R17
    05308 7100      ANDI	R16,0x10
    05309 7010      ANDI	R17,0
    0530A 9508      RET
_toupper:
    0530B 934A      ST	-Y,R20
    0530C 935A      ST	-Y,R21
    0530D 01A8      MOVW	R20,R16
    0530E 018A      MOVW	R16,R20
    0530F 940E 52F7 CALL	_islower
    05311 3000      CPI	R16,0
    05312 0701      CPC	R16,R17
    05313 F031      BEQ	0x531A
    05314 018A      MOVW	R16,R20
    05315 5601      SUBI	R16,0x61
    05316 4010      SBCI	R17,0
    05317 5B0F      SUBI	R16,0xBF
    05318 4F1F      SBCI	R17,0xFF
    05319 C001      RJMP	0x531B
    0531A 018A      MOVW	R16,R20
    0531B 9159      LD	R21,Y+
    0531C 9149      LD	R20,Y+
    0531D 9508      RET
__sdepi:
    0531E 91E0 097C LDS	R30,Rec+133
    05320 91F0 097D LDS	R31,Rec+134
    05322 9301      ST	Z+,R16
    05323 93F0 097D STS	Rec+134,R31
    05325 93E0 097C STS	Rec+133,R30
    05327 9508      RET
_sprintf:
    05328 940E 4A66 CALL	push_arg4
    0532A 92AA      ST	-Y,R10
    0532B 92BA      ST	-Y,R11
    0532C 9722      SBIW	R28,2
    0532D 802C      LDD	R2,Y+4
    0532E 803D      LDD	R3,Y+5
    0532F 9230 097D STS	Rec+134,R3
    05331 9220 097C STS	Rec+133,R2
    05333 01CE      MOVW	R24,R28
    05334 9608      ADIW	R24,0x8
    05335 015C      MOVW	R10,R24
    05336 82B9      STD	Y+1,R11
    05337 82A8      ST	Y,R10
    05338 812E      LDD	R18,Y+6
    05339 813F      LDD	R19,Y+7
    0533A EA0A      LDI	R16,0xAA
    0533B E010      LDI	R17,0
    0533C 940E 45D5 CALL	__print
    0533E 2422      CLR	R2
    0533F 91E0 097C LDS	R30,Rec+133
    05341 91F0 097D LDS	R31,Rec+134
    05343 8220      ST	Z,R2
    05344 802C      LDD	R2,Y+4
    05345 803D      LDD	R3,Y+5
    05346 9100 097C LDS	R16,Rec+133
    05348 9110 097D LDS	R17,Rec+134
    0534A 1902      SUB	R16,R2
    0534B 0913      SBC	R17,R3
    0534C 9622      ADIW	R28,2
    0534D 90B9      LD	R11,Y+
    0534E 90A9      LD	R10,Y+
    0534F 9624      ADIW	R28,4
    05350 9508      RET
    05351 940E 4BCA CALL	push_xgsetF00C
    05353 01B9      MOVW	R22,R18
    05354 0158      MOVW	R10,R16
    05355 3F6E      CPI	R22,0xFE
    05356 EFEF      LDI	R30,0xFF
    05357 077E      CPC	R23,R30
    05358 F419      BNE	0x535C
    05359 E043      LDI	R20,3
    0535A E052      LDI	R21,2
    0535B C009      RJMP	0x5365
    0535C 3F6F      CPI	R22,0xFF
    0535D EFEF      LDI	R30,0xFF
    0535E 077E      CPC	R23,R30
    0535F F419      BNE	0x5363
    05360 E14E      LDI	R20,0x1E
    05361 E052      LDI	R21,2
    05362 C002      RJMP	0x5365
    05363 E34B      LDI	R20,0x3B
    05364 E052      LDI	R21,2
    05365 019A      MOVW	R18,R20
    05366 0185      MOVW	R16,R10
    05367 940E 4F37 CALL	_cstrcpy
    05369 0185      MOVW	R16,R10
    0536A 940C 4BD1 JMP	pop_xgsetF00C
__FormatFP_1:
    0536C 940E 4A66 CALL	push_arg4
    0536E 940E 4BAB CALL	push_xgsetF0FC
    05370 01B9      MOVW	R22,R18
    05371 97A2      SBIW	R28,0x22
    05372 EF8F      LDI	R24,0xFF
    05373 EF9F      LDI	R25,0xFF
    05374 015C      MOVW	R10,R24
    05375 879F      STD	Y+15,R25
    05376 878E      STD	Y+14,R24
    05377 8B9B      STD	Y+19,R25
    05378 8B8A      STD	Y+18,R24
    05379 8B99      STD	Y+17,R25
    0537A 8B88      STD	Y+16,R24
    0537B 8F9E      STD	Y+30,R25
    0537C 8F8D      STD	Y+29,R24
    0537D 8B9E      STD	Y+22,R25
    0537E 8B8D      STD	Y+21,R24
    0537F 2400      CLR	R0
    05380 2411      CLR	R1
    05381 8E19      STD	Y+25,R1
    05382 8E08      STD	Y+24,R0
    05383 2799      CLR	R25
    05384 A398      STD	Y+32,R25
    05385 8F8F      STD	Y+31,R24
    05386 24EE      CLR	R14
    05387 24FF      CLR	R15
    05388 2744      CLR	R20
    05389 2755      CLR	R21
    0538A E280      LDI	R24,0x20
    0538B 8B8F      STD	Y+23,R24
    0538C 8F8C      STD	Y+28,R24
    0538D E685      LDI	R24,0x65
    0538E A389      STD	Y+33,R24
    0538F E184      LDI	R24,0x14
    05390 A80E      LDD	R0,Y+54
    05391 A81F      LDD	R1,Y+55
    05392 1580      CP	R24,R0
    05393 0591      CPC	R25,R1
    05394 F414      BGE	0x5397
    05395 AB9F      STD	Y+55,R25
    05396 AB8E      STD	Y+54,R24
    05397 E184      LDI	R24,0x14
    05398 E090      LDI	R25,0
    05399 AC08      LDD	R0,Y+56
    0539A AC19      LDD	R1,Y+57
    0539B 1580      CP	R24,R0
    0539C 0591      CPC	R25,R1
    0539D F414      BGE	0x53A0
    0539E AF99      STD	Y+57,R25
    0539F AF88      STD	Y+56,R24
    053A0 3060      CPI	R22,0
    053A1 0767      CPC	R22,R23
    053A2 F409      BNE	0x53A4
    053A3 C084      RJMP	0x5428
    053A4 3061      CPI	R22,1
    053A5 E0E0      LDI	R30,0
    053A6 077E      CPC	R23,R30
    053A7 F079      BEQ	0x53B7
    053A8 3062      CPI	R22,2
    053A9 E0E0      LDI	R30,0
    053AA 077E      CPC	R23,R30
    053AB F049      BEQ	0x53B5
    053AC 3063      CPI	R22,3
    053AD E0E0      LDI	R30,0
    053AE 077E      CPC	R23,R30
    053AF F061      BEQ	0x53BC
    053B0 3064      CPI	R22,4
    053B1 E0E0      LDI	R30,0
    053B2 077E      CPC	R23,R30
    053B3 F031      BEQ	0x53BA
    053B4 C073      RJMP	0x5428
    053B5 E485      LDI	R24,0x45
    053B6 A389      STD	Y+33,R24
    053B7 E041      LDI	R20,1
    053B8 E050      LDI	R21,0
    053B9 C06E      RJMP	0x5428
    053BA E485      LDI	R24,0x45
    053BB A389      STD	Y+33,R24
    053BC A828      LDD	R2,Y+48
    053BD A839      LDD	R3,Y+49
    053BE A84A      LDD	R4,Y+50
    053BF A85B      LDD	R5,Y+51
    053C0 8628      STD	Y+8,R2
    053C1 8639      STD	Y+9,R3
    053C2 864A      STD	Y+10,R4
    053C3 865B      STD	Y+11,R5
    053C4 A828      LDD	R2,Y+48
    053C5 A839      LDD	R3,Y+49
    053C6 A84A      LDD	R4,Y+50
    053C7 A85B      LDD	R5,Y+51
    053C8 E60C      LDI	R16,0x6C
    053C9 E012      LDI	R17,2
    053CA 940E 4B33 CALL	elpm32
    053CC 933A      ST	-Y,R19
    053CD 932A      ST	-Y,R18
    053CE 931A      ST	-Y,R17
    053CF 930A      ST	-Y,R16
    053D0 0181      MOVW	R16,R2
    053D1 0192      MOVW	R18,R4
    053D2 940E 4F2B CALL	fpcmp2
    053D4 F474      BGE	0x53E3
    053D5 E608      LDI	R16,0x68
    053D6 E012      LDI	R17,2
    053D7 940E 4B33 CALL	elpm32
    053D9 01CE      MOVW	R24,R28
    053DA 96C0      ADIW	R24,0x30
    053DB 939A      ST	-Y,R25
    053DC 938A      ST	-Y,R24
    053DD 940E 4EF1 CALL	fpmule1
    053DF 8708      STD	Y+8,R16
    053E0 8719      STD	Y+9,R17
    053E1 872A      STD	Y+10,R18
    053E2 873B      STD	Y+11,R19
    053E3 E604      LDI	R16,0x64
    053E4 E012      LDI	R17,2
    053E5 940E 4B33 CALL	elpm32
    053E7 830A      STD	Y+2,R16
    053E8 831B      STD	Y+3,R17
    053E9 832C      STD	Y+4,R18
    053EA 833D      STD	Y+5,R19
    053EB 2400      CLR	R0
    053EC 2411      CLR	R1
    053ED 861D      STD	Y+13,R1
    053EE 860C      STD	Y+12,R0
    053EF C013      RJMP	0x5403
    053F0 E600      LDI	R16,0x60
    053F1 E012      LDI	R17,2
    053F2 940E 4B33 CALL	elpm32
    053F4 01CE      MOVW	R24,R28
    053F5 9602      ADIW	R24,2
    053F6 939A      ST	-Y,R25
    053F7 938A      ST	-Y,R24
    053F8 940E 4EF1 CALL	fpmule1
    053FA 830A      STD	Y+2,R16
    053FB 831B      STD	Y+3,R17
    053FC 832C      STD	Y+4,R18
    053FD 833D      STD	Y+5,R19
    053FE 858C      LDD	R24,Y+12
    053FF 859D      LDD	R25,Y+13
    05400 9601      ADIW	R24,1
    05401 879D      STD	Y+13,R25
    05402 878C      STD	Y+12,R24
    05403 840C      LDD	R0,Y+12
    05404 841D      LDD	R1,Y+13
    05405 AD08      LDD	R16,Y+56
    05406 AD19      LDD	R17,Y+57
    05407 1600      CP	R0,R16
    05408 0611      CPC	R1,R17
    05409 F334      BLT	0x53F0
    0540A 8428      LDD	R2,Y+8
    0540B 8439      LDD	R3,Y+9
    0540C 844A      LDD	R4,Y+10
    0540D 845B      LDD	R5,Y+11
    0540E E50C      LDI	R16,0x5C
    0540F E012      LDI	R17,2
    05410 940E 4B33 CALL	elpm32
    05412 933A      ST	-Y,R19
    05413 932A      ST	-Y,R18
    05414 931A      ST	-Y,R17
    05415 930A      ST	-Y,R16
    05416 0181      MOVW	R16,R2
    05417 0192      MOVW	R18,R4
    05418 940E 4F2B CALL	fpcmp2
    0541A F05C      BLT	0x5426
    0541B 01CE      MOVW	R24,R28
    0541C 9608      ADIW	R24,0x8
    0541D 810A      LDD	R16,Y+2
    0541E 811B      LDD	R17,Y+3
    0541F 812C      LDD	R18,Y+4
    05420 813D      LDD	R19,Y+5
    05421 939A      ST	-Y,R25
    05422 938A      ST	-Y,R24
    05423 940E 4F20 CALL	fpcmp1
    05425 F414      BGE	0x5428
    05426 E041      LDI	R20,1
    05427 E050      LDI	R21,0
    05428 A80C      LDD	R0,Y+52
    05429 A81D      LDD	R1,Y+53
    0542A FE04      SBRS	R0,4
    0542B C002      RJMP	0x542E
    0542C E380      LDI	R24,0x30
    0542D 8B8F      STD	Y+23,R24
    0542E 880F      LDD	R0,Y+23
    0542F 8A0C      STD	Y+20,R0
    05430 A80C      LDD	R0,Y+52
    05431 A81D      LDD	R1,Y+53
    05432 FE03      SBRS	R0,3
    05433 C002      RJMP	0x5436
    05434 E28B      LDI	R24,0x2B
    05435 8B8C      STD	Y+20,R24
    05436 3040      CPI	R20,0
    05437 0745      CPC	R20,R21
    05438 F061      BEQ	0x5445
    05439 01CE      MOVW	R24,R28
    0543A 9606      ADIW	R24,6
    0543B 8399      STD	Y+1,R25
    0543C 8388      ST	Y,R24
    0543D A908      LDD	R16,Y+48
    0543E A919      LDD	R17,Y+49
    0543F A92A      LDD	R18,Y+50
    05440 A93B      LDD	R19,Y+51
    05441 940E 515E CALL	_ftoa
    05443 01B8      MOVW	R22,R16
    05444 C062      RJMP	0x54A7
    05445 E508      LDI	R16,0x58
    05446 E012      LDI	R17,2
    05447 940E 4B33 CALL	elpm32
    05449 830A      STD	Y+2,R16
    0544A 831B      STD	Y+3,R17
    0544B 832C      STD	Y+4,R18
    0544C 833D      STD	Y+5,R19
    0544D 2400      CLR	R0
    0544E 2411      CLR	R1
    0544F 861D      STD	Y+13,R1
    05450 860C      STD	Y+12,R0
    05451 C019      RJMP	0x546B
    05452 802A      LDD	R2,Y+2
    05453 803B      LDD	R3,Y+3
    05454 804C      LDD	R4,Y+4
    05455 805D      LDD	R5,Y+5
    05456 E600      LDI	R16,0x60
    05457 E012      LDI	R17,2
    05458 940E 4B33 CALL	elpm32
    0545A 933A      ST	-Y,R19
    0545B 932A      ST	-Y,R18
    0545C 931A      ST	-Y,R17
    0545D 930A      ST	-Y,R16
    0545E 0181      MOVW	R16,R2
    0545F 0192      MOVW	R18,R4
    05460 940E 4D81 CALL	fpdiv2
    05462 830A      STD	Y+2,R16
    05463 831B      STD	Y+3,R17
    05464 832C      STD	Y+4,R18
    05465 833D      STD	Y+5,R19
    05466 858C      LDD	R24,Y+12
    05467 859D      LDD	R25,Y+13
    05468 9601      ADIW	R24,1
    05469 879D      STD	Y+13,R25
    0546A 878C      STD	Y+12,R24
    0546B 840C      LDD	R0,Y+12
    0546C 841D      LDD	R1,Y+13
    0546D AD08      LDD	R16,Y+56
    0546E AD19      LDD	R17,Y+57
    0546F 1600      CP	R0,R16
    05470 0611      CPC	R1,R17
    05471 F304      BLT	0x5452
    05472 A828      LDD	R2,Y+48
    05473 A839      LDD	R3,Y+49
    05474 A84A      LDD	R4,Y+50
    05475 A85B      LDD	R5,Y+51
    05476 E60C      LDI	R16,0x6C
    05477 E012      LDI	R17,2
    05478 940E 4B33 CALL	elpm32
    0547A 933A      ST	-Y,R19
    0547B 932A      ST	-Y,R18
    0547C 931A      ST	-Y,R17
    0547D 930A      ST	-Y,R16
    0547E 0181      MOVW	R16,R2
    0547F 0192      MOVW	R18,R4
    05480 940E 4F2B CALL	fpcmp2
    05482 F494      BGE	0x5495
    05483 01CE      MOVW	R24,R28
    05484 9606      ADIW	R24,6
    05485 8399      STD	Y+1,R25
    05486 8388      ST	Y,R24
    05487 A908      LDD	R16,Y+48
    05488 A919      LDD	R17,Y+49
    05489 A92A      LDD	R18,Y+50
    0548A A93B      LDD	R19,Y+51
    0548B 01CE      MOVW	R24,R28
    0548C 9602      ADIW	R24,2
    0548D 939A      ST	-Y,R25
    0548E 938A      ST	-Y,R24
    0548F 940E 4CF2 CALL	fpsub1
    05491 940E 515E CALL	_ftoa
    05493 01B8      MOVW	R22,R16
    05494 C012      RJMP	0x54A7
    05495 01CE      MOVW	R24,R28
    05496 9606      ADIW	R24,6
    05497 8399      STD	Y+1,R25
    05498 8388      ST	Y,R24
    05499 A908      LDD	R16,Y+48
    0549A A919      LDD	R17,Y+49
    0549B A92A      LDD	R18,Y+50
    0549C A93B      LDD	R19,Y+51
    0549D 01CE      MOVW	R24,R28
    0549E 9602      ADIW	R24,2
    0549F 939A      ST	-Y,R25
    054A0 938A      ST	-Y,R24
    054A1 940E 4CDD CALL	fpadd1
    054A3 940E 515E CALL	_ftoa
    054A5 0168      MOVW	R12,R16
    054A6 01B6      MOVW	R22,R12
    054A7 802E      LDD	R2,Y+6
    054A8 803F      LDD	R3,Y+7
    054A9 2022      TST	R2
    054AA F411      BNE	0x54AD
    054AB 2033      TST	R3
    054AC F031      BEQ	0x54B3
    054AD 0191      MOVW	R18,R2
    054AE A50C      LDD	R16,Y+44
    054AF A51D      LDD	R17,Y+45
    054B0 DEA0      RCALL	0x5351
    054B1 0168      MOVW	R12,R16
    054B2 C39E      RJMP	0x5851
    054B3 2400      CLR	R0
    054B4 2411      CLR	R1
    054B5 861D      STD	Y+13,R1
    054B6 860C      STD	Y+12,R0
    054B7 3040      CPI	R20,0
    054B8 0745      CPC	R20,R21
    054B9 F481      BNE	0x54CA
    054BA 858E      LDD	R24,Y+14
    054BB 859F      LDD	R25,Y+15
    054BC 3080      CPI	R24,0
    054BD E0E0      LDI	R30,0
    054BE 079E      CPC	R25,R30
    054BF F054      BLT	0x54CA
    054C0 842C      LDD	R2,Y+12
    054C1 843D      LDD	R3,Y+13
    054C2 1A28      SUB	R2,R24
    054C3 0A39      SBC	R3,R25
    054C4 AC08      LDD	R0,Y+56
    054C5 AC19      LDD	R1,Y+57
    054C6 1402      CP	R0,R2
    054C7 0413      CPC	R1,R3
    054C8 F40C      BGE	0x54CA
    054C9 C060      RJMP	0x552A
    054CA 85EC      LDD	R30,Y+12
    054CB 85FD      LDD	R31,Y+13
    054CC 0FE6      ADD	R30,R22
    054CD 1FF7      ADC	R31,R23
    054CE 80C0      LD	R12,Z
    054CF 2D8C      MOV	R24,R12
    054D0 3380      CPI	R24,0x30
    054D1 F1E0      BCS	0x550E
    054D2 E389      LDI	R24,0x39
    054D3 158C      CP	R24,R12
    054D4 F1C8      BCS	0x550E
    054D5 84AC      LDD	R10,Y+12
    054D6 84BD      LDD	R11,Y+13
    054D7 E380      LDI	R24,0x30
    054D8 158C      CP	R24,R12
    054D9 F448      BCC	0x54E3
    054DA 8D8D      LDD	R24,Y+29
    054DB 8D9E      LDD	R25,Y+30
    054DC 3080      CPI	R24,0
    054DD E0E0      LDI	R30,0
    054DE 079E      CPC	R25,R30
    054DF F41C      BGE	0x54E3
    054E0 0105      MOVW	R0,R10
    054E1 8E1E      STD	Y+30,R1
    054E2 8E0D      STD	Y+29,R0
    054E3 858E      LDD	R24,Y+14
    054E4 859F      LDD	R25,Y+15
    054E5 3080      CPI	R24,0
    054E6 E0E0      LDI	R30,0
    054E7 079E      CPC	R25,R30
    054E8 F4C4      BGE	0x5501
    054E9 8988      LDD	R24,Y+16
    054EA 8999      LDD	R25,Y+17
    054EB 3080      CPI	R24,0
    054EC E0E0      LDI	R30,0
    054ED 079E      CPC	R25,R30
    054EE F43C      BGE	0x54F6
    054EF E380      LDI	R24,0x30
    054F0 158C      CP	R24,R12
    054F1 F420      BCC	0x54F6
    054F2 840C      LDD	R0,Y+12
    054F3 841D      LDD	R1,Y+13
    054F4 8A19      STD	Y+17,R1
    054F5 8A08      STD	Y+16,R0
    054F6 8988      LDD	R24,Y+16
    054F7 8999      LDD	R25,Y+17
    054F8 3080      CPI	R24,0
    054F9 E0E0      LDI	R30,0
    054FA 079E      CPC	R25,R30
    054FB F02C      BLT	0x5501
    054FC 8D88      LDD	R24,Y+24
    054FD 8D99      LDD	R25,Y+25
    054FE 9601      ADIW	R24,1
    054FF 8F99      STD	Y+25,R25
    05500 8F88      STD	Y+24,R24
    05501 858E      LDD	R24,Y+14
    05502 859F      LDD	R25,Y+15
    05503 3080      CPI	R24,0
    05504 E0E0      LDI	R30,0
    05505 079E      CPC	R25,R30
    05506 F03C      BLT	0x550E
    05507 E380      LDI	R24,0x30
    05508 158C      CP	R24,R12
    05509 F420      BCC	0x550E
    0550A 840C      LDD	R0,Y+12
    0550B 841D      LDD	R1,Y+13
    0550C 8A1E      STD	Y+22,R1
    0550D 8A0D      STD	Y+21,R0
    0550E 2D8C      MOV	R24,R12
    0550F 328E      CPI	R24,0x2E
    05510 F421      BNE	0x5515
    05511 840C      LDD	R0,Y+12
    05512 841D      LDD	R1,Y+13
    05513 861F      STD	Y+15,R1
    05514 860E      STD	Y+14,R0
    05515 2D8C      MOV	R24,R12
    05516 328D      CPI	R24,0x2D
    05517 F429      BNE	0x551D
    05518 E081      LDI	R24,1
    05519 E090      LDI	R25,0
    0551A 017C      MOVW	R14,R24
    0551B E28D      LDI	R24,0x2D
    0551C 8B8C      STD	Y+20,R24
    0551D 20CC      TST	R12
    0551E F409      BNE	0x5520
    0551F C00A      RJMP	0x552A
    05520 858C      LDD	R24,Y+12
    05521 859D      LDD	R25,Y+13
    05522 9601      ADIW	R24,1
    05523 879D      STD	Y+13,R25
    05524 878C      STD	Y+12,R24
    05525 3184      CPI	R24,0x14
    05526 E0E0      LDI	R30,0
    05527 079E      CPC	R25,R30
    05528 F40C      BGE	0x552A
    05529 CF8D      RJMP	0x54B7
    0552A 858E      LDD	R24,Y+14
    0552B 859F      LDD	R25,Y+15
    0552C 3080      CPI	R24,0
    0552D E0E0      LDI	R30,0
    0552E 079E      CPC	R25,R30
    0552F F43C      BGE	0x5537
    05530 01C5      MOVW	R24,R10
    05531 9601      ADIW	R24,1
    05532 8B9B      STD	Y+19,R25
    05533 8B8A      STD	Y+18,R24
    05534 9601      ADIW	R24,1
    05535 015C      MOVW	R10,R24
    05536 C012      RJMP	0x5549
    05537 840E      LDD	R0,Y+14
    05538 841F      LDD	R1,Y+15
    05539 8A1B      STD	Y+19,R1
    0553A 8A0A      STD	Y+18,R0
    0553B 898D      LDD	R24,Y+21
    0553C 899E      LDD	R25,Y+22
    0553D 3080      CPI	R24,0
    0553E E0E0      LDI	R30,0
    0553F 079E      CPC	R25,R30
    05540 F424      BGE	0x5545
    05541 01C0      MOVW	R24,R0
    05542 9601      ADIW	R24,1
    05543 015C      MOVW	R10,R24
    05544 C004      RJMP	0x5549
    05545 898D      LDD	R24,Y+21
    05546 899E      LDD	R25,Y+22
    05547 9601      ADIW	R24,1
    05548 015C      MOVW	R10,R24
    05549 8988      LDD	R24,Y+16
    0554A 8999      LDD	R25,Y+17
    0554B 3080      CPI	R24,0
    0554C E0E0      LDI	R30,0
    0554D 079E      CPC	R25,R30
    0554E F42C      BGE	0x5554
    0554F 898A      LDD	R24,Y+18
    05550 899B      LDD	R25,Y+19
    05551 9701      SBIW	R24,1
    05552 8B99      STD	Y+17,R25
    05553 8B88      STD	Y+16,R24
    05554 3040      CPI	R20,0
    05555 0745      CPC	R20,R21
    05556 F409      BNE	0x5558
    05557 C1D2      RJMP	0x572A
    05558 2400      CLR	R0
    05559 2411      CLR	R1
    0555A 861D      STD	Y+13,R1
    0555B 860C      STD	Y+12,R0
    0555C 880C      LDD	R0,Y+20
    0555D 890F      LDD	R16,Y+23
    0555E 1600      CP	R0,R16
    0555F F069      BEQ	0x556D
    05560 854C      LDD	R20,Y+12
    05561 855D      LDD	R21,Y+13
    05562 01CA      MOVW	R24,R20
    05563 9601      ADIW	R24,1
    05564 879D      STD	Y+13,R25
    05565 878C      STD	Y+12,R24
    05566 01FA      MOVW	R30,R20
    05567 A40C      LDD	R0,Y+44
    05568 A41D      LDD	R1,Y+45
    05569 0DE0      ADD	R30,R0
    0556A 1DF1      ADC	R31,R1
    0556B 880C      LDD	R0,Y+20
    0556C 8200      ST	Z,R0
    0556D 854C      LDD	R20,Y+12
    0556E 855D      LDD	R21,Y+13
    0556F 01CA      MOVW	R24,R20
    05570 9601      ADIW	R24,1
    05571 879D      STD	Y+13,R25
    05572 878C      STD	Y+12,R24
    05573 8DED      LDD	R30,Y+29
    05574 8DFE      LDD	R31,Y+30
    05575 0FE6      ADD	R30,R22
    05576 1FF7      ADC	R31,R23
    05577 8020      LD	R2,Z
    05578 01FA      MOVW	R30,R20
    05579 A40C      LDD	R0,Y+44
    0557A A41D      LDD	R1,Y+45
    0557B 0DE0      ADD	R30,R0
    0557C 1DF1      ADC	R31,R1
    0557D 8220      ST	Z,R2
    0557E 01FC      MOVW	R30,R24
    0557F 0DE0      ADD	R30,R0
    05580 1DF1      ADC	R31,R1
    05581 E28E      LDI	R24,0x2E
    05582 8380      ST	Z,R24
    05583 2422      CLR	R2
    05584 2433      CLR	R3
    05585 AC08      LDD	R0,Y+56
    05586 AC19      LDD	R1,Y+57
    05587 1420      CP	R2,R0
    05588 0431      CPC	R3,R1
    05589 F42C      BGE	0x558F
    0558A 858C      LDD	R24,Y+12
    0558B 859D      LDD	R25,Y+13
    0558C 9601      ADIW	R24,1
    0558D 879D      STD	Y+13,R25
    0558E 878C      STD	Y+12,R24
    0558F 8D4D      LDD	R20,Y+29
    05590 8D5E      LDD	R21,Y+30
    05591 5F4F      SUBI	R20,0xFF
    05592 4F5F      SBCI	R21,0xFF
    05593 24CC      CLR	R12
    05594 24DD      CLR	R13
    05595 C034      RJMP	0x55CA
    05596 880A      LDD	R0,Y+18
    05597 881B      LDD	R1,Y+19
    05598 1540      CP	R20,R0
    05599 0551      CPC	R21,R1
    0559A F409      BNE	0x559C
    0559B C02C      RJMP	0x55C8
    0559C 154A      CP	R20,R10
    0559D 055B      CPC	R21,R11
    0559E F48C      BGE	0x55B0
    0559F 84EC      LDD	R14,Y+12
    055A0 84FD      LDD	R15,Y+13
    055A1 01C7      MOVW	R24,R14
    055A2 9601      ADIW	R24,1
    055A3 879D      STD	Y+13,R25
    055A4 878C      STD	Y+12,R24
    055A5 01FA      MOVW	R30,R20
    055A6 0FE6      ADD	R30,R22
    055A7 1FF7      ADC	R31,R23
    055A8 8020      LD	R2,Z
    055A9 01F7      MOVW	R30,R14
    055AA A40C      LDD	R0,Y+44
    055AB A41D      LDD	R1,Y+45
    055AC 0DE0      ADD	R30,R0
    055AD 1DF1      ADC	R31,R1
    055AE 8220      ST	Z,R2
    055AF C015      RJMP	0x55C5
    055B0 A80C      LDD	R0,Y+52
    055B1 A81D      LDD	R1,Y+53
    055B2 FC00      SBRC	R0,0
    055B3 C004      RJMP	0x55B8
    055B4 20CC      TST	R12
    055B5 F501      BNE	0x55D6
    055B6 20DD      TST	R13
    055B7 F4F1      BNE	0x55D6
    055B8 84EC      LDD	R14,Y+12
    055B9 84FD      LDD	R15,Y+13
    055BA 01C7      MOVW	R24,R14
    055BB 9601      ADIW	R24,1
    055BC 879D      STD	Y+13,R25
    055BD 878C      STD	Y+12,R24
    055BE 01F7      MOVW	R30,R14
    055BF A40C      LDD	R0,Y+44
    055C0 A41D      LDD	R1,Y+45
    055C1 0DE0      ADD	R30,R0
    055C2 1DF1      ADC	R31,R1
    055C3 E380      LDI	R24,0x30
    055C4 8380      ST	Z,R24
    055C5 01C6      MOVW	R24,R12
    055C6 9601      ADIW	R24,1
    055C7 016C      MOVW	R12,R24
    055C8 5F4F      SUBI	R20,0xFF
    055C9 4F5F      SBCI	R21,0xFF
    055CA AC08      LDD	R0,Y+56
    055CB AC19      LDD	R1,Y+57
    055CC 14C0      CP	R12,R0
    055CD 04D1      CPC	R13,R1
    055CE F43C      BGE	0x55D6
    055CF 858C      LDD	R24,Y+12
    055D0 859D      LDD	R25,Y+13
    055D1 308E      CPI	R24,0xE
    055D2 E0E0      LDI	R30,0
    055D3 079E      CPC	R25,R30
    055D4 F40C      BGE	0x55D6
    055D5 CFC0      RJMP	0x5596
    055D6 858C      LDD	R24,Y+12
    055D7 859D      LDD	R25,Y+13
    055D8 9701      SBIW	R24,1
    055D9 016C      MOVW	R12,R24
    055DA AC08      LDD	R0,Y+56
    055DB AC19      LDD	R1,Y+57
    055DC 2000      TST	R0
    055DD F421      BNE	0x55E2
    055DE 2011      TST	R1
    055DF F411      BNE	0x55E2
    055E0 84CC      LDD	R12,Y+12
    055E1 84DD      LDD	R13,Y+13
    055E2 898A      LDD	R24,Y+18
    055E3 899B      LDD	R25,Y+19
    055E4 8C0D      LDD	R0,Y+29
    055E5 8C1E      LDD	R1,Y+30
    055E6 1980      SUB	R24,R0
    055E7 0991      SBC	R25,R1
    055E8 9701      SBIW	R24,1
    055E9 A398      STD	Y+32,R25
    055EA 8F8F      STD	Y+31,R24
    055EB 154A      CP	R20,R10
    055EC 055B      CPC	R21,R11
    055ED F444      BGE	0x55F6
    055EE 01FA      MOVW	R30,R20
    055EF 0FE6      ADD	R30,R22
    055F0 1FF7      ADC	R31,R23
    055F1 8180      LD	R24,Z
    055F2 328E      CPI	R24,0x2E
    055F3 F411      BNE	0x55F6
    055F4 5F4F      SUBI	R20,0xFF
    055F5 4F5F      SBCI	R21,0xFF
    055F6 154A      CP	R20,R10
    055F7 055B      CPC	R21,R11
    055F8 F00C      BLT	0x55FA
    055F9 C06B      RJMP	0x5665
    055FA 01FA      MOVW	R30,R20
    055FB 0FE6      ADD	R30,R22
    055FC 1FF7      ADC	R31,R23
    055FD 80E0      LD	R14,Z
    055FE 24FF      CLR	R15
    055FF 2D8E      MOV	R24,R14
    05600 3385      CPI	R24,0x35
    05601 F408      BCC	0x5603
    05602 C062      RJMP	0x5665
    05603 E389      LDI	R24,0x39
    05604 158E      CP	R24,R14
    05605 F408      BCC	0x5607
    05606 C05E      RJMP	0x5665
    05607 C057      RJMP	0x565F
    05608 01F6      MOVW	R30,R12
    05609 A40C      LDD	R0,Y+44
    0560A A41D      LDD	R1,Y+45
    0560B 0DE0      ADD	R30,R0
    0560C 1DF1      ADC	R31,R1
    0560D 80E0      LD	R14,Z
    0560E 24FF      CLR	R15
    0560F 2D8E      MOV	R24,R14
    05610 3380      CPI	R24,0x30
    05611 F058      BCS	0x561D
    05612 E388      LDI	R24,0x38
    05613 158E      CP	R24,R14
    05614 F040      BCS	0x561D
    05615 0176      MOVW	R14,R12
    05616 0CE0      ADD	R14,R0
    05617 1CF1      ADC	R15,R1
    05618 01F7      MOVW	R30,R14
    05619 8180      LD	R24,Z
    0561A 5F8F      SUBI	R24,0xFF
    0561B 8380      ST	Z,R24
    0561C C048      RJMP	0x5665
    0561D 01F6      MOVW	R30,R12
    0561E A40C      LDD	R0,Y+44
    0561F A41D      LDD	R1,Y+45
    05620 0DE0      ADD	R30,R0
    05621 1DF1      ADC	R31,R1
    05622 8180      LD	R24,Z
    05623 328E      CPI	R24,0x2E
    05624 F009      BEQ	0x5626
    05625 C029      RJMP	0x564F
    05626 01C6      MOVW	R24,R12
    05627 9701      SBIW	R24,1
    05628 016C      MOVW	R12,R24
    05629 01FC      MOVW	R30,R24
    0562A 0DE0      ADD	R30,R0
    0562B 1DF1      ADC	R31,R1
    0562C 80E0      LD	R14,Z
    0562D 24FF      CLR	R15
    0562E 2D8E      MOV	R24,R14
    0562F 3380      CPI	R24,0x30
    05630 F058      BCS	0x563C
    05631 E388      LDI	R24,0x38
    05632 158E      CP	R24,R14
    05633 F040      BCS	0x563C
    05634 0176      MOVW	R14,R12
    05635 0CE0      ADD	R14,R0
    05636 1CF1      ADC	R15,R1
    05637 01F7      MOVW	R30,R14
    05638 8180      LD	R24,Z
    05639 5F8F      SUBI	R24,0xFF
    0563A 8380      ST	Z,R24
    0563B C029      RJMP	0x5665
    0563C 01F6      MOVW	R30,R12
    0563D A40C      LDD	R0,Y+44
    0563E A41D      LDD	R1,Y+45
    0563F 0DE0      ADD	R30,R0
    05640 1DF1      ADC	R31,R1
    05641 8180      LD	R24,Z
    05642 3389      CPI	R24,0x39
    05643 F459      BNE	0x564F
    05644 01F6      MOVW	R30,R12
    05645 0DE0      ADD	R30,R0
    05646 1DF1      ADC	R31,R1
    05647 E381      LDI	R24,0x31
    05648 8380      ST	Z,R24
    05649 8D8F      LDD	R24,Y+31
    0564A A198      LDD	R25,Y+32
    0564B 9601      ADIW	R24,1
    0564C A398      STD	Y+32,R25
    0564D 8F8F      STD	Y+31,R24
    0564E C016      RJMP	0x5665
    0564F 01F6      MOVW	R30,R12
    05650 A40C      LDD	R0,Y+44
    05651 A41D      LDD	R1,Y+45
    05652 0DE0      ADD	R30,R0
    05653 1DF1      ADC	R31,R1
    05654 8180      LD	R24,Z
    05655 3389      CPI	R24,0x39
    05656 F429      BNE	0x565C
    05657 01F6      MOVW	R30,R12
    05658 0DE0      ADD	R30,R0
    05659 1DF1      ADC	R31,R1
    0565A E380      LDI	R24,0x30
    0565B 8380      ST	Z,R24
    0565C 01C6      MOVW	R24,R12
    0565D 9701      SBIW	R24,1
    0565E 016C      MOVW	R12,R24
    0565F 01C6      MOVW	R24,R12
    05660 3080      CPI	R24,0
    05661 E0E0      LDI	R30,0
    05662 079E      CPC	R25,R30
    05663 F00C      BLT	0x5665
    05664 CFA3      RJMP	0x5608
    05665 84CC      LDD	R12,Y+12
    05666 84DD      LDD	R13,Y+13
    05667 01C6      MOVW	R24,R12
    05668 9601      ADIW	R24,1
    05669 879D      STD	Y+13,R25
    0566A 878C      STD	Y+12,R24
    0566B 01F6      MOVW	R30,R12
    0566C A40C      LDD	R0,Y+44
    0566D A41D      LDD	R1,Y+45
    0566E 0DE0      ADD	R30,R0
    0566F 1DF1      ADC	R31,R1
    05670 A009      LDD	R0,Y+33
    05671 8200      ST	Z,R0
    05672 8D8F      LDD	R24,Y+31
    05673 A198      LDD	R25,Y+32
    05674 3080      CPI	R24,0
    05675 E0E0      LDI	R30,0
    05676 079E      CPC	R25,R30
    05677 F49C      BGE	0x568B
    05678 84CC      LDD	R12,Y+12
    05679 84DD      LDD	R13,Y+13
    0567A 01C6      MOVW	R24,R12
    0567B 9601      ADIW	R24,1
    0567C 879D      STD	Y+13,R25
    0567D 878C      STD	Y+12,R24
    0567E 01F6      MOVW	R30,R12
    0567F A40C      LDD	R0,Y+44
    05680 A41D      LDD	R1,Y+45
    05681 0DE0      ADD	R30,R0
    05682 1DF1      ADC	R31,R1
    05683 E28D      LDI	R24,0x2D
    05684 8380      ST	Z,R24
    05685 8C0F      LDD	R0,Y+31
    05686 A018      LDD	R1,Y+32
    05687 9400      COM	R0
    05688 9410      COM	R1
    05689 A218      STD	Y+32,R1
    0568A 8E0F      STD	Y+31,R0
    0568B E08A      LDI	R24,0xA
    0568C E090      LDI	R25,0
    0568D 8399      STD	Y+1,R25
    0568E 8388      ST	Y,R24
    0568F 8D2F      LDD	R18,Y+31
    05690 A138      LDD	R19,Y+32
    05691 850C      LDD	R16,Y+12
    05692 851D      LDD	R17,Y+13
    05693 A40C      LDD	R0,Y+44
    05694 A41D      LDD	R1,Y+45
    05695 0D00      ADD	R16,R0
    05696 1D11      ADC	R17,R1
    05697 940E 4F94 CALL	_itoa
    05699 2400      CLR	R0
    0569A 2411      CLR	R1
    0569B 861D      STD	Y+13,R1
    0569C 860C      STD	Y+12,R0
    0569D 85EC      LDD	R30,Y+12
    0569E 85FD      LDD	R31,Y+13
    0569F A40C      LDD	R0,Y+44
    056A0 A41D      LDD	R1,Y+45
    056A1 0DE0      ADD	R30,R0
    056A2 1DF1      ADC	R31,R1
    056A3 8020      LD	R2,Z
    056A4 2022      TST	R2
    056A5 F429      BNE	0x56AB
    056A6 840C      LDD	R0,Y+12
    056A7 841D      LDD	R1,Y+13
    056A8 8E1B      STD	Y+27,R1
    056A9 8E0A      STD	Y+26,R0
    056AA C009      RJMP	0x56B4
    056AB 858C      LDD	R24,Y+12
    056AC 859D      LDD	R25,Y+13
    056AD 9601      ADIW	R24,1
    056AE 879D      STD	Y+13,R25
    056AF 878C      STD	Y+12,R24
    056B0 3184      CPI	R24,0x14
    056B1 E0E0      LDI	R30,0
    056B2 079E      CPC	R25,R30
    056B3 F34C      BLT	0x569D
    056B4 A80C      LDD	R0,Y+52
    056B5 A81D      LDD	R1,Y+53
    056B6 FE02      SBRS	R0,2
    056B7 C021      RJMP	0x56D9
    056B8 8C0A      LDD	R0,Y+26
    056B9 8C1B      LDD	R1,Y+27
    056BA A90E      LDD	R16,Y+54
    056BB A91F      LDD	R17,Y+55
    056BC 1600      CP	R0,R16
    056BD 0611      CPC	R1,R17
    056BE F00C      BLT	0x56C0
    056BF C18F      RJMP	0x584F
    056C0 01A0      MOVW	R20,R0
    056C1 C009      RJMP	0x56CB
    056C2 01FA      MOVW	R30,R20
    056C3 A40C      LDD	R0,Y+44
    056C4 A41D      LDD	R1,Y+45
    056C5 0DE0      ADD	R30,R0
    056C6 1DF1      ADC	R31,R1
    056C7 8C0C      LDD	R0,Y+28
    056C8 8200      ST	Z,R0
    056C9 5F4F      SUBI	R20,0xFF
    056CA 4F5F      SBCI	R21,0xFF
    056CB A80E      LDD	R0,Y+54
    056CC A81F      LDD	R1,Y+55
    056CD 1540      CP	R20,R0
    056CE 0551      CPC	R21,R1
    056CF F394      BLT	0x56C2
    056D0 01F0      MOVW	R30,R0
    056D1 9731      SBIW	R30,1
    056D2 A40C      LDD	R0,Y+44
    056D3 A41D      LDD	R1,Y+45
    056D4 0DE0      ADD	R30,R0
    056D5 1DF1      ADC	R31,R1
    056D6 2422      CLR	R2
    056D7 8220      ST	Z,R2
    056D8 C176      RJMP	0x584F
    056D9 8C0A      LDD	R0,Y+26
    056DA 8C1B      LDD	R1,Y+27
    056DB A90E      LDD	R16,Y+54
    056DC A91F      LDD	R17,Y+55
    056DD 1600      CP	R0,R16
    056DE 0611      CPC	R1,R17
    056DF F00C      BLT	0x56E1
    056E0 C16E      RJMP	0x584F
    056E1 01A0      MOVW	R20,R0
    056E2 C014      RJMP	0x56F7
    056E3 01FA      MOVW	R30,R20
    056E4 A80E      LDD	R0,Y+54
    056E5 A81F      LDD	R1,Y+55
    056E6 0DE0      ADD	R30,R0
    056E7 1DF1      ADC	R31,R1
    056E8 8C0A      LDD	R0,Y+26
    056E9 8C1B      LDD	R1,Y+27
    056EA 19E0      SUB	R30,R0
    056EB 09F1      SBC	R31,R1
    056EC A40C      LDD	R0,Y+44
    056ED A41D      LDD	R1,Y+45
    056EE 0DE0      ADD	R30,R0
    056EF 1DF1      ADC	R31,R1
    056F0 01DA      MOVW	R26,R20
    056F1 0DA0      ADD	R26,R0
    056F2 1DB1      ADC	R27,R1
    056F3 902C      LD	R2,X
    056F4 8220      ST	Z,R2
    056F5 5041      SUBI	R20,1
    056F6 4050      SBCI	R21,0
    056F7 3040      CPI	R20,0
    056F8 E0E0      LDI	R30,0
    056F9 075E      CPC	R21,R30
    056FA F744      BGE	0x56E3
    056FB A94E      LDD	R20,Y+54
    056FC A95F      LDD	R21,Y+55
    056FD 8C0A      LDD	R0,Y+26
    056FE 8C1B      LDD	R1,Y+27
    056FF 1940      SUB	R20,R0
    05700 0951      SBC	R21,R1
    05701 5041      SUBI	R20,1
    05702 4050      SBCI	R21,0
    05703 C009      RJMP	0x570D
    05704 01FA      MOVW	R30,R20
    05705 A40C      LDD	R0,Y+44
    05706 A41D      LDD	R1,Y+45
    05707 0DE0      ADD	R30,R0
    05708 1DF1      ADC	R31,R1
    05709 880F      LDD	R0,Y+23
    0570A 8200      ST	Z,R0
    0570B 5041      SUBI	R20,1
    0570C 4050      SBCI	R21,0
    0570D 3040      CPI	R20,0
    0570E E0E0      LDI	R30,0
    0570F 075E      CPC	R21,R30
    05710 F79C      BGE	0x5704
    05711 A80C      LDD	R0,Y+52
    05712 A81D      LDD	R1,Y+53
    05713 FE04      SBRS	R0,4
    05714 C13A      RJMP	0x584F
    05715 880C      LDD	R0,Y+20
    05716 890F      LDD	R16,Y+23
    05717 1600      CP	R0,R16
    05718 F409      BNE	0x571A
    05719 C135      RJMP	0x584F
    0571A A5EC      LDD	R30,Y+44
    0571B A5FD      LDD	R31,Y+45
    0571C 8200      ST	Z,R0
    0571D A9EE      LDD	R30,Y+54
    0571E A9FF      LDD	R31,Y+55
    0571F 8C0A      LDD	R0,Y+26
    05720 8C1B      LDD	R1,Y+27
    05721 19E0      SUB	R30,R0
    05722 09F1      SBC	R31,R1
    05723 A40C      LDD	R0,Y+44
    05724 A41D      LDD	R1,Y+45
    05725 0DE0      ADD	R30,R0
    05726 1DF1      ADC	R31,R1
    05727 2E00      MOV	R0,R16
    05728 8200      ST	Z,R0
    05729 C125      RJMP	0x584F
    0572A A80C      LDD	R0,Y+52
    0572B A81D      LDD	R1,Y+53
    0572C FE00      SBRS	R0,0
    0572D C010      RJMP	0x573E
    0572E 882A      LDD	R2,Y+18
    0572F 883B      LDD	R3,Y+19
    05730 AC08      LDD	R0,Y+56
    05731 AC19      LDD	R1,Y+57
    05732 0C20      ADD	R2,R0
    05733 1C31      ADC	R3,R1
    05734 142A      CP	R2,R10
    05735 043B      CPC	R3,R11
    05736 F07C      BLT	0x5746
    05737 898A      LDD	R24,Y+18
    05738 899B      LDD	R25,Y+19
    05739 0D80      ADD	R24,R0
    0573A 1D91      ADC	R25,R1
    0573B 9601      ADIW	R24,1
    0573C 015C      MOVW	R10,R24
    0573D C008      RJMP	0x5746
    0573E 898A      LDD	R24,Y+18
    0573F 899B      LDD	R25,Y+19
    05740 9601      ADIW	R24,1
    05741 16A8      CP	R10,R24
    05742 06B9      CPC	R11,R25
    05743 F411      BNE	0x5746
    05744 88AA      LDD	R10,Y+18
    05745 88BB      LDD	R11,Y+19
    05746 E184      LDI	R24,0x14
    05747 E090      LDI	R25,0
    05748 158A      CP	R24,R10
    05749 059B      CPC	R25,R11
    0574A F40C      BGE	0x574C
    0574B 015C      MOVW	R10,R24
    0574C 0115      MOVW	R2,R10
    0574D 8808      LDD	R0,Y+16
    0574E 8819      LDD	R1,Y+17
    0574F 1820      SUB	R2,R0
    05750 0831      SBC	R3,R1
    05751 8E3B      STD	Y+27,R3
    05752 8E2A      STD	Y+26,R2
    05753 880C      LDD	R0,Y+20
    05754 890F      LDD	R16,Y+23
    05755 1600      CP	R0,R16
    05756 F021      BEQ	0x575B
    05757 01C1      MOVW	R24,R2
    05758 9601      ADIW	R24,1
    05759 8F9B      STD	Y+27,R25
    0575A 8F8A      STD	Y+26,R24
    0575B A80E      LDD	R0,Y+54
    0575C A81F      LDD	R1,Y+55
    0575D 8D0A      LDD	R16,Y+26
    0575E 8D1B      LDD	R17,Y+27
    0575F 1600      CP	R0,R16
    05760 0611      CPC	R1,R17
    05761 F41C      BGE	0x5765
    05762 0108      MOVW	R0,R16
    05763 AA1F      STD	Y+55,R1
    05764 AA0E      STD	Y+54,R0
    05765 E184      LDI	R24,0x14
    05766 E090      LDI	R25,0
    05767 A80E      LDD	R0,Y+54
    05768 A81F      LDD	R1,Y+55
    05769 1580      CP	R24,R0
    0576A 0591      CPC	R25,R1
    0576B F414      BGE	0x576E
    0576C AB9F      STD	Y+55,R25
    0576D AB8E      STD	Y+54,R24
    0576E E184      LDI	R24,0x14
    0576F E090      LDI	R25,0
    05770 8C0A      LDD	R0,Y+26
    05771 8C1B      LDD	R1,Y+27
    05772 1580      CP	R24,R0
    05773 0591      CPC	R25,R1
    05774 F414      BGE	0x5777
    05775 8F9B      STD	Y+27,R25
    05776 8F8A      STD	Y+26,R24
    05777 A80C      LDD	R0,Y+52
    05778 A81D      LDD	R1,Y+53
    05779 FC02      SBRC	R0,2
    0577A C007      RJMP	0x5782
    0577B A80E      LDD	R0,Y+54
    0577C A81F      LDD	R1,Y+55
    0577D 8D0A      LDD	R16,Y+26
    0577E 8D1B      LDD	R17,Y+27
    0577F 1600      CP	R0,R16
    05780 0611      CPC	R1,R17
    05781 F471      BNE	0x5790
    05782 24CC      CLR	R12
    05783 24DD      CLR	R13
    05784 880C      LDD	R0,Y+20
    05785 890F      LDD	R16,Y+23
    05786 1600      CP	R0,R16
    05787 F409      BNE	0x5789
    05788 C033      RJMP	0x57BC
    05789 A5EC      LDD	R30,Y+44
    0578A A5FD      LDD	R31,Y+45
    0578B 8200      ST	Z,R0
    0578C E081      LDI	R24,1
    0578D E090      LDI	R25,0
    0578E 016C      MOVW	R12,R24
    0578F C02C      RJMP	0x57BC
    05790 A8CE      LDD	R12,Y+54
    05791 A8DF      LDD	R13,Y+55
    05792 8C0A      LDD	R0,Y+26
    05793 8C1B      LDD	R1,Y+27
    05794 18C0      SUB	R12,R0
    05795 08D1      SBC	R13,R1
    05796 2744      CLR	R20
    05797 2755      CLR	R21
    05798 C009      RJMP	0x57A2
    05799 01FA      MOVW	R30,R20
    0579A A40C      LDD	R0,Y+44
    0579B A41D      LDD	R1,Y+45
    0579C 0DE0      ADD	R30,R0
    0579D 1DF1      ADC	R31,R1
    0579E 880F      LDD	R0,Y+23
    0579F 8200      ST	Z,R0
    057A0 5F4F      SUBI	R20,0xFF
    057A1 4F5F      SBCI	R21,0xFF
    057A2 16C4      CP	R12,R20
    057A3 06D5      CPC	R13,R21
    057A4 F7A4      BGE	0x5799
    057A5 880C      LDD	R0,Y+20
    057A6 890F      LDD	R16,Y+23
    057A7 1600      CP	R0,R16
    057A8 F099      BEQ	0x57BC
    057A9 A80C      LDD	R0,Y+52
    057AA A81D      LDD	R1,Y+53
    057AB FE04      SBRS	R0,4
    057AC C005      RJMP	0x57B2
    057AD A5EC      LDD	R30,Y+44
    057AE A5FD      LDD	R31,Y+45
    057AF 880C      LDD	R0,Y+20
    057B0 8200      ST	Z,R0
    057B1 C007      RJMP	0x57B9
    057B2 01F6      MOVW	R30,R12
    057B3 A40C      LDD	R0,Y+44
    057B4 A41D      LDD	R1,Y+45
    057B5 0DE0      ADD	R30,R0
    057B6 1DF1      ADC	R31,R1
    057B7 880C      LDD	R0,Y+20
    057B8 8200      ST	Z,R0
    057B9 01C6      MOVW	R24,R12
    057BA 9601      ADIW	R24,1
    057BB 016C      MOVW	R12,R24
    057BC 01A6      MOVW	R20,R12
    057BD 8C08      LDD	R0,Y+24
    057BE 8C19      LDD	R1,Y+25
    057BF 2000      TST	R0
    057C0 F459      BNE	0x57CC
    057C1 2011      TST	R1
    057C2 F449      BNE	0x57CC
    057C3 01FA      MOVW	R30,R20
    057C4 A40C      LDD	R0,Y+44
    057C5 A41D      LDD	R1,Y+45
    057C6 0DE0      ADD	R30,R0
    057C7 1DF1      ADC	R31,R1
    057C8 E380      LDI	R24,0x30
    057C9 8380      ST	Z,R24
    057CA 5F4F      SUBI	R20,0xFF
    057CB 4F5F      SBCI	R21,0xFF
    057CC 2400      CLR	R0
    057CD 2411      CLR	R1
    057CE 861D      STD	Y+13,R1
    057CF 860C      STD	Y+12,R0
    057D0 C016      RJMP	0x57E7
    057D1 842C      LDD	R2,Y+12
    057D2 843D      LDD	R3,Y+13
    057D3 0E26      ADD	R2,R22
    057D4 1E37      ADC	R3,R23
    057D5 89E8      LDD	R30,Y+16
    057D6 89F9      LDD	R31,Y+17
    057D7 0DE2      ADD	R30,R2
    057D8 1DF3      ADC	R31,R3
    057D9 8020      LD	R2,Z
    057DA 01FA      MOVW	R30,R20
    057DB A40C      LDD	R0,Y+44
    057DC A41D      LDD	R1,Y+45
    057DD 0DE0      ADD	R30,R0
    057DE 1DF1      ADC	R31,R1
    057DF 8220      ST	Z,R2
    057E0 5F4F      SUBI	R20,0xFF
    057E1 4F5F      SBCI	R21,0xFF
    057E2 858C      LDD	R24,Y+12
    057E3 859D      LDD	R25,Y+13
    057E4 9601      ADIW	R24,1
    057E5 879D      STD	Y+13,R25
    057E6 878C      STD	Y+12,R24
    057E7 840C      LDD	R0,Y+12
    057E8 841D      LDD	R1,Y+13
    057E9 8D08      LDD	R16,Y+24
    057EA 8D19      LDD	R17,Y+25
    057EB 1600      CP	R0,R16
    057EC 0611      CPC	R1,R17
    057ED F31C      BLT	0x57D1
    057EE 880A      LDD	R0,Y+18
    057EF 881B      LDD	R1,Y+19
    057F0 140A      CP	R0,R10
    057F1 041B      CPC	R1,R11
    057F2 F44C      BGE	0x57FC
    057F3 01FA      MOVW	R30,R20
    057F4 A40C      LDD	R0,Y+44
    057F5 A41D      LDD	R1,Y+45
    057F6 0DE0      ADD	R30,R0
    057F7 1DF1      ADC	R31,R1
    057F8 E28E      LDI	R24,0x2E
    057F9 8380      ST	Z,R24
    057FA 5F4F      SUBI	R20,0xFF
    057FB 4F5F      SBCI	R21,0xFF
    057FC 2400      CLR	R0
    057FD 2411      CLR	R1
    057FE 861D      STD	Y+13,R1
    057FF 860C      STD	Y+12,R0
    05800 C02C      RJMP	0x582D
    05801 882D      LDD	R2,Y+21
    05802 883E      LDD	R3,Y+22
    05803 840E      LDD	R0,Y+14
    05804 841F      LDD	R1,Y+15
    05805 1820      SUB	R2,R0
    05806 0831      SBC	R3,R1
    05807 840C      LDD	R0,Y+12
    05808 841D      LDD	R1,Y+13
    05809 1402      CP	R0,R2
    0580A 0413      CPC	R1,R3
    0580B F47C      BGE	0x581B
    0580C 0110      MOVW	R2,R0
    0580D 0E26      ADD	R2,R22
    0580E 1E37      ADC	R3,R23
    0580F 85EE      LDD	R30,Y+14
    05810 85FF      LDD	R31,Y+15
    05811 0DE2      ADD	R30,R2
    05812 1DF3      ADC	R31,R3
    05813 8021      LDD	R2,Z+1
    05814 01FA      MOVW	R30,R20
    05815 A40C      LDD	R0,Y+44
    05816 A41D      LDD	R1,Y+45
    05817 0DE0      ADD	R30,R0
    05818 1DF1      ADC	R31,R1
    05819 8220      ST	Z,R2
    0581A C00B      RJMP	0x5826
    0581B A80C      LDD	R0,Y+52
    0581C A81D      LDD	R1,Y+53
    0581D FE00      SBRS	R0,0
    0581E C024      RJMP	0x5843
    0581F 01FA      MOVW	R30,R20
    05820 A40C      LDD	R0,Y+44
    05821 A41D      LDD	R1,Y+45
    05822 0DE0      ADD	R30,R0
    05823 1DF1      ADC	R31,R1
    05824 E380      LDI	R24,0x30
    05825 8380      ST	Z,R24
    05826 5F4F      SUBI	R20,0xFF
    05827 4F5F      SBCI	R21,0xFF
    05828 858C      LDD	R24,Y+12
    05829 859D      LDD	R25,Y+13
    0582A 9601      ADIW	R24,1
    0582B 879D      STD	Y+13,R25
    0582C 878C      STD	Y+12,R24
    0582D 840C      LDD	R0,Y+12
    0582E 841D      LDD	R1,Y+13
    0582F AD08      LDD	R16,Y+56
    05830 AD19      LDD	R17,Y+57
    05831 1600      CP	R0,R16
    05832 0611      CPC	R1,R17
    05833 F42C      BGE	0x5839
    05834 3144      CPI	R20,0x14
    05835 E0E0      LDI	R30,0
    05836 075E      CPC	R21,R30
    05837 F40C      BGE	0x5839
    05838 CFC8      RJMP	0x5801
    05839 C009      RJMP	0x5843
    0583A 01FA      MOVW	R30,R20
    0583B A40C      LDD	R0,Y+44
    0583C A41D      LDD	R1,Y+45
    0583D 0DE0      ADD	R30,R0
    0583E 1DF1      ADC	R31,R1
    0583F 8C0C      LDD	R0,Y+28
    05840 8200      ST	Z,R0
    05841 5F4F      SUBI	R20,0xFF
    05842 4F5F      SBCI	R21,0xFF
    05843 A80E      LDD	R0,Y+54
    05844 A81F      LDD	R1,Y+55
    05845 1540      CP	R20,R0
    05846 0551      CPC	R21,R1
    05847 F394      BLT	0x583A
    05848 01FA      MOVW	R30,R20
    05849 A40C      LDD	R0,Y+44
    0584A A41D      LDD	R1,Y+45
    0584B 0DE0      ADD	R30,R0
    0584C 1DF1      ADC	R31,R1
    0584D 2422      CLR	R2
    0584E 8220      ST	Z,R2
    0584F A50C      LDD	R16,Y+44
    05850 A51D      LDD	R17,Y+45
    05851 96A2      ADIW	R28,0x22
    05852 940E 4BA0 CALL	pop_xgsetF0FC
    05854 9624      ADIW	R28,4
    05855 9508      RET
