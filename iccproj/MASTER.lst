Interrupt Vectors
    00000 940C 039A JMP	__start|__text_start
    0003C 940C 3A91 JMP	_uart1_rx_isr

Program Code (text area)
__start|__text_start:
    0039A EFCF      LDI	R28,0xFF
    0039B E1D0      LDI	R29,0x10
    0039C BFCD      OUT	0x3D,R28
    0039D BFDE      OUT	0x3E,R29
    0039E 50C0      SUBI	R28,0
    0039F 40D1      SBCI	R29,1
    003A0 EA0A      LDI	R16,0xAA
    003A1 8308      ST	Y,R16
    003A2 2400      CLR	R0
    003A3 EEE1      LDI	R30,0xE1
    003A4 E0F5      LDI	R31,5
    003A5 E018      LDI	R17,0x8
    003A6 3EE8      CPI	R30,0xE8
    003A7 07F1      CPC	R31,R17
    003A8 F011      BEQ	0x03AB
    003A9 9201      ST	Z+,R0
    003AA CFFB      RJMP	0x03A6
    003AB 8300      ST	Z,R16
    003AC E5E2      LDI	R30,0x52
    003AD E0F2      LDI	R31,2
    003AE E0A0      LDI	R26,0
    003AF E0B1      LDI	R27,1
    003B0 E017      LDI	R17,7
    003B1 E000      LDI	R16,0
    003B2 BF0B      OUT	0x3B,R16
    003B3 33E3      CPI	R30,0x33
    003B4 07F1      CPC	R31,R17
    003B5 F021      BEQ	0x03BA
    003B6 95C8      LPM
    003B7 9631      ADIW	R30,1
    003B8 920D      ST	X+,R0
    003B9 CFF9      RJMP	0x03B3
    003BA 940E 258E CALL	_main
_exit:
    003BC CFFF      RJMP	_exit
_disk_initialize:
  state                --> R20
  drv                  --> R10
    003BD 92AA      ST	-Y,R10
    003BE 934A      ST	-Y,R20
    003BF 2EA0      MOV	R10,R16
FILE: D:\LQD\software\software_src\diskio.c
(0001) 
(0002) 
(0003) /*-----------------------------------------------------------------------*/
(0004) /* Low level disk I/O module skeleton for FatFs     (C)ChaN, 2007        */
(0005) /*-----------------------------------------------------------------------*/
(0006) /* This is a stub disk I/O module that acts as front end of the existing */
(0007) /* disk I/O modules and attach it to FatFs module with common interface. */
(0008) /*-----------------------------------------------------------------------*/
(0009) 
(0010) #include "diskio.h"
(0011) #include "sd.h"
(0012) 
(0013) 
(0014) /*-----------------------------------------------------------------------*/
(0015) /* Correspondence between physical drive number and physical drive.      */
(0016) /* Note that Tiny-FatFs supports only single drive and always            */
(0017)                                       
(0018) 
(0019) ////////////////////////////
(0020) /*
(0021)    struct tm {
(0022)    	int tm_sec;   // 秒 seconds after the minute, 0 to 60
(0023)    	int tm_min;   // 分 minutes after the hour, 0 to 59
(0024) 	int tm_hour;  // 时 hours since midnight, 0 to 23*
(0025) 	int tm_mday;  // 日 day of the month, 1 to 31
(0026) 	int tm_mon;   // 月 months since January, 0 to 11
(0027) 	int tm_year;  // 年 years since 1900
(0028) 	int tm_wday;  // 星期 days since Sunday, 0 to 6
(0029) 	int tm_yday;  // 从元旦起的天数 days since January 1, 0 to 365
(0030)  	int tm_isdst; // 夏令时？？Daylight Savings Time flag
(0031)  	};
(0032) */
(0033) /*-----------------------------------------------------------------------*/
(0034) /* Inidialize a Drive                                                    */
(0035) 
(0036) DSTATUS disk_initialize ( 
(0037) BYTE drv				/* Physical drive nmuber (0..) */
(0038) )
(0039) {
(0040)     unsigned char state;
(0041) 
(0042)     if(drv)
    003C0 20AA      TST	R10
    003C1 F011      BEQ	0x03C4
(0043)     {
(0044)         return STA_NOINIT;  //仅支持磁盘0的操作
    003C2 E001      LDI	R16,1
    003C3 C00C      RJMP	0x03D0
(0045)     }
(0046) 
(0047)     state = SD_Init();
    003C4 940E 2D95 CALL	_SD_Init
    003C6 2F40      MOV	R20,R16
(0048)     if(state == STA_NODISK)
    003C7 3002      CPI	R16,2
    003C8 F411      BNE	0x03CB
(0049)     {
(0050)         return STA_NODISK;
    003C9 E002      LDI	R16,2
    003CA C005      RJMP	0x03D0
(0051)     }
(0052)     else if(state != 0)
    003CB 2344      TST	R20
    003CC F011      BEQ	0x03CF
(0053)     {
(0054)         return STA_NOINIT;  //其他错误：初始化失败
    003CD E001      LDI	R16,1
    003CE C001      RJMP	0x03D0
(0055)     }
(0056)     else
(0057)     {
(0058)         return 0;           //初始化成功
    003CF 2700      CLR	R16
    003D0 9149      LD	R20,Y+
    003D1 90A9      LD	R10,Y+
    003D2 9508      RET
(0059)     }
(0060) }
(0061) 
(0062) 
(0063) 
(0064) /*-----------------------------------------------------------------------*/
(0065) /* Return Disk Status                                                    */
(0066) 
(0067) DSTATUS disk_status (
(0068) 	BYTE drv		/* Physical drive nmuber (0..) */
(0069) )
(0070) {
(0071)     if(drv)
_disk_status:
  drv                  --> R16
    003D3 2300      TST	R16
    003D4 F011      BEQ	0x03D7
(0072)     {
(0073)         return STA_NOINIT;  //仅支持磁盘0操作
    003D5 E001      LDI	R16,1
    003D6 C001      RJMP	0x03D8
(0074)     }
(0075)     return 0;
    003D7 2700      CLR	R16
    003D8 9508      RET
_disk_read:
  res                  --> R10
  count                --> R20
  sector               --> Y,+10
  buff                 --> R12
  drv                  --> R14
    003D9 940E 48C5 CALL	push_xgset30FC
    003DB 0169      MOVW	R12,R18
    003DC 2EE0      MOV	R14,R16
    003DD 9722      SBIW	R28,2
    003DE 854E      LDD	R20,Y+14
(0076) }
(0077) 
(0078) 
(0079) 
(0080) /*-----------------------------------------------------------------------*/
(0081) /* Read Sector(s)                                                        */
(0082) 
(0083) DRESULT disk_read (
(0084) 	BYTE drv,		/* Physical drive nmuber (0..) */
(0085) 	BYTE *buff,		/* Data buffer to store read data */
(0086) 	DWORD sector,	/* Sector address (LBA) */
(0087) 	BYTE count		/* Number of sectors to read (1..255) */
(0088) )
(0089) {
(0090) 	unsigned char res=0;
    003DF 24AA      CLR	R10
(0091)     if (drv || !count)
    003E0 20EE      TST	R14
    003E1 F411      BNE	0x03E4
    003E2 2344      TST	R20
    003E3 F411      BNE	0x03E6
(0092)     {    
(0093)         return RES_PARERR;  //仅支持单磁盘操作，count不能等于0，否则返回参数错误
    003E4 E004      LDI	R16,4
    003E5 C010      RJMP	0x03F6
(0094)     }
(0095) 
(0096)     if(count==1)            //1个sector的读操作      
    003E6 3041      CPI	R20,1
    003E7 F449      BNE	0x03F1
(0097)     {                                                
(0098)         res = SD_Read_Sector(sector, buff);      
    003E8 82D9      STD	Y+1,R13
    003E9 82C8      ST	Y,R12
    003EA 850A      LDD	R16,Y+10
    003EB 851B      LDD	R17,Y+11
    003EC 852C      LDD	R18,Y+12
    003ED 853D      LDD	R19,Y+13
    003EE 940E 2E7B CALL	_SD_Read_Sector
    003F0 2EA0      MOV	R10,R16
(0099)     }                                                                                                 
(0100) 
(0101)     //处理返回值，将SD_driver.c的返回值转成ff.c的返回值
(0102)     if(res == 0x00)
    003F1 20AA      TST	R10
    003F2 F411      BNE	0x03F5
(0103)     {
(0104)         return RES_OK;
    003F3 2700      CLR	R16
    003F4 C001      RJMP	0x03F6
(0105)     }
(0106)     else
(0107)     {
(0108)         return RES_ERROR;
    003F5 E001      LDI	R16,1
    003F6 9622      ADIW	R28,2
    003F7 940C 48AF JMP	pop_xgset30FC
_disk_write:
  count                --> R12
  sector               --> Y,+8
  buff                 --> R10
  drv                  --> R14
    003F9 940E 48C7 CALL	push_xgset00FC
    003FB 0159      MOVW	R10,R18
    003FC 2EE0      MOV	R14,R16
    003FD 9722      SBIW	R28,2
    003FE 84CC      LDD	R12,Y+12
(0109)     }
(0110) }
(0111) 
(0112) 
(0113) 
(0114) /*-----------------------------------------------------------------------*/
(0115) /* Write Sector(s)                                                       */
(0116) 
(0117) #if _READONLY == 0
(0118) DRESULT disk_write (
(0119) 	BYTE drv,			/* Physical drive nmuber (0..) */
(0120) 	BYTE *buff,	        /* Data to be written */
(0121) 	DWORD sector,		/* Sector address (LBA) */
(0122) 	BYTE count			/* Number of sectors to write (1..255) */
(0123) )
(0124) {
(0125)     if (drv || !count)
    003FF 20EE      TST	R14
    00400 F411      BNE	0x0403
    00401 20CC      TST	R12
    00402 F411      BNE	0x0405
(0126)     {    
(0127)         return RES_PARERR;  //仅支持单磁盘操作，count不能等于0，否则返回参数错误
    00403 E004      LDI	R16,4
    00404 C009      RJMP	0x040E
(0128)     }   
(0129)    // 读写操作
(0130)     SD_Write_Sector(sector,buff);
    00405 82B9      STD	Y+1,R11
    00406 82A8      ST	Y,R10
    00407 8508      LDD	R16,Y+8
    00408 8519      LDD	R17,Y+9
    00409 852A      LDD	R18,Y+10
    0040A 853B      LDD	R19,Y+11
    0040B 940E 2DF5 CALL	_SD_Write_Sector
(0131) 	  
(0132)     return RES_OK;
    0040D 2700      CLR	R16
    0040E 9622      ADIW	R28,2
    0040F 940C 48A8 JMP	pop_xgset00FC
_disk_ioctl:
  buff                 --> Y,+4
  ctrl                 --> Y,+2
  drv                  --> Y,+0
    00411 940E 477E CALL	push_arg4
(0133) }
(0134) #endif /* _READONLY */
(0135) 
(0136) 
(0137) 
(0138) /*-----------------------------------------------------------------------*/
(0139) /* Miscellaneous Functions                                               */
(0140) DRESULT disk_ioctl (
(0141) 	BYTE drv,		/* Physical drive nmuber (0..) */
(0142) 	BYTE ctrl,		/* Control code */
(0143) 	void *buff		/* Buffer to send/receive control data */
(0144) )
(0145) {
(0146)  	drv=drv;
(0147) 	ctrl=ctrl;
(0148) 	buff=buff;
(0149) 	return 0;
    00413 2700      CLR	R16
    00414 9624      ADIW	R28,4
    00415 9508      RET
(0150) }
(0151) DWORD get_fattime (void)
(0152) {
(0153) 
(0154)   return 1950466005;
_get_fattime:
    00416 ED05      LDI	R16,0xD5
    00417 EB1F      LDI	R17,0xBF
    00418 E421      LDI	R18,0x41
    00419 E734      LDI	R19,0x74
    0041A 9508      RET
ff.c:mem_cpy:
  s                    --> R12
  d                    --> R10
  cnt                  --> R20
  src                  --> R18
  dst                  --> R16
    0041B 940E 48F0 CALL	push_xgset303C
    0041D 814E      LDD	R20,Y+6
    0041E 815F      LDD	R21,Y+7
FILE: D:\LQD\software\software_src\ff.c
(0001) /*----------------------------------------------------------------------------/
(0002) /  FatFs - FAT file system module  R0.09                  (C)ChaN, 2011
(0003) /-----------------------------------------------------------------------------/
(0004) / FatFs module is a generic FAT file system module for small embedded systems.
(0005) / This is a free software that opened for education, research and commercial
(0006) / developments under license policy of following terms.
(0007) /
(0008) /  Copyright (C) 2011, ChaN, all right reserved.
(0009) /
(0010) / * The FatFs module is a free software and there is NO WARRANTY.
(0011) / * No restriction on use. You can use, modify and redistribute it for
(0012) /   personal, non-profit or commercial products UNDER YOUR RESPONSIBILITY.
(0013) / * Redistributions of source code must retain the above copyright notice.
(0014) /
(0015) /-----------------------------------------------------------------------------/
(0016) / Feb 26,'06 R0.00  Prototype.
(0017) /
(0018) / Apr 29,'06 R0.01  First stable version.
(0019) /
(0020) / Jun 01,'06 R0.02  Added FAT12 support.
(0021) /                   Removed unbuffered mode.
(0022) /                   Fixed a problem on small (<32M) partition.
(0023) / Jun 10,'06 R0.02a Added a configuration option (_FS_MINIMUM).
(0024) /
(0025) / Sep 22,'06 R0.03  Added f_rename().
(0026) /                   Changed option _FS_MINIMUM to _FS_MINIMIZE.
(0027) / Dec 11,'06 R0.03a Improved cluster scan algorithm to write files fast.
(0028) /                   Fixed f_mkdir() creates incorrect directory on FAT32.
(0029) /
(0030) / Feb 04,'07 R0.04  Supported multiple drive system.
(0031) /                   Changed some interfaces for multiple drive system.
(0032) /                   Changed f_mountdrv() to f_mount().
(0033) /                   Added f_mkfs().
(0034) / Apr 01,'07 R0.04a Supported multiple partitions on a physical drive.
(0035) /                   Added a capability of extending file size to f_lseek().
(0036) /                   Added minimization level 3.
(0037) /                   Fixed an endian sensitive code in f_mkfs().
(0038) / May 05,'07 R0.04b Added a configuration option _USE_NTFLAG.
(0039) /                   Added FSInfo support.
(0040) /                   Fixed DBCS name can result FR_INVALID_NAME.
(0041) /                   Fixed short seek (<= csize) collapses the file object.
(0042) /
(0043) / Aug 25,'07 R0.05  Changed arguments of f_read(), f_write() and f_mkfs().
(0044) /                   Fixed f_mkfs() on FAT32 creates incorrect FSInfo.
(0045) /                   Fixed f_mkdir() on FAT32 creates incorrect directory.
(0046) / Feb 03,'08 R0.05a Added f_truncate() and f_utime().
(0047) /                   Fixed off by one error at FAT sub-type determination.
(0048) /                   Fixed btr in f_read() can be mistruncated.
(0049) /                   Fixed cached sector is not flushed when create and close without write.
(0050) /
(0051) / Apr 01,'08 R0.06  Added fputc(), fputs(), fprintf() and fgets().
(0052) /                   Improved performance of f_lseek() on moving to the same or following cluster.
(0053) /
(0054) / Apr 01,'09 R0.07  Merged Tiny-FatFs as a configuration option. (_FS_TINY)
(0055) /                   Added long file name feature.
(0056) /                   Added multiple code page feature.
(0057) /                   Added re-entrancy for multitask operation.
(0058) /                   Added auto cluster size selection to f_mkfs().
(0059) /                   Added rewind option to f_readdir().
(0060) /                   Changed result code of critical errors.
(0061) /                   Renamed string functions to avoid name collision.
(0062) / Apr 14,'09 R0.07a Separated out OS dependent code on reentrant cfg.
(0063) /                   Added multiple sector size feature.
(0064) / Jun 21,'09 R0.07c Fixed f_unlink() can return FR_OK on error.
(0065) /                   Fixed wrong cache control in f_lseek().
(0066) /                   Added relative path feature.
(0067) /                   Added f_chdir() and f_chdrive().
(0068) /                   Added proper case conversion to extended char.
(0069) / Nov 03,'09 R0.07e Separated out configuration options from ff.h to ffconf.h.
(0070) /                   Fixed f_unlink() fails to remove a sub-dir on _FS_RPATH.
(0071) /                   Fixed name matching error on the 13 char boundary.
(0072) /                   Added a configuration option, _LFN_UNICODE.
(0073) /                   Changed f_readdir() to return the SFN with always upper case on non-LFN cfg.
(0074) /
(0075) / May 15,'10 R0.08  Added a memory configuration option. (_USE_LFN = 3)
(0076) /                   Added file lock feature. (_FS_SHARE)
(0077) /                   Added fast seek feature. (_USE_FASTSEEK)
(0078) /                   Changed some types on the API, XCHAR->TCHAR.
(0079) /                   Changed fname member in the FILINFO structure on Unicode cfg.
(0080) /                   String functions support UTF-8 encoding files on Unicode cfg.
(0081) / Aug 16,'10 R0.08a Added f_getcwd(). (_FS_RPATH = 2)
(0082) /                   Added sector erase feature. (_USE_ERASE)
(0083) /                   Moved file lock semaphore table from fs object to the bss.
(0084) /                   Fixed a wrong directory entry is created on non-LFN cfg when the given name contains ';'.
(0085) /                   Fixed f_mkfs() creates wrong FAT32 volume.
(0086) / Jan 15,'11 R0.08b Fast seek feature is also applied to f_read() and f_write().
(0087) /                   f_lseek() reports required table size on creating CLMP.
(0088) /                   Extended format syntax of f_printf function.
(0089) /                   Ignores duplicated directory separators in given path names.
(0090) /
(0091) / Sep 06,'11 R0.09  f_mkfs() supports multiple partition to finish the multiple partition feature.
(0092) /                   Added f_fdisk(). (_MULTI_PARTITION = 2)
(0093) /---------------------------------------------------------------------------*/
(0094) 
(0095) #include "ff.h"			/* FatFs configurations and declarations */
(0096) #include "diskio.h"		/* Declarations of low level disk I/O functions */
(0097) #include <string.h>
(0098) 
(0099) /*--------------------------------------------------------------------------
(0100) 
(0101)    Module Private Definitions
(0102) 
(0103) ---------------------------------------------------------------------------*/
(0104) 
(0105) #if _FATFS != 6502	/* Revision ID */
(0106) #error Wrong include file (ff.h).
(0107) #endif
(0108) 
(0109) 
(0110) /* Definitions on sector size */
(0111) #if _MAX_SS != 512 && _MAX_SS != 1024 && _MAX_SS != 2048 && _MAX_SS != 4096
(0112) #error Wrong sector size.
(0113) #endif
(0114) #if _MAX_SS != 512
(0115) #define	SS(fs)	((fs)->ssize)	/* Variable sector size */
(0116) #else
(0117) #define	SS(fs)	512U			/* Fixed sector size */
(0118) #endif
(0119) 
(0120) 
(0121) /* Reentrancy related */
(0122) #if _FS_REENTRANT
(0123) #if _USE_LFN == 1
(0124) #error Static LFN work area must not be used in re-entrant configuration.
(0125) #endif
(0126) #define	ENTER_FF(fs)		{ if (!lock_fs(fs)) return FR_TIMEOUT; }
(0127) #define	LEAVE_FF(fs, res)	{ unlock_fs(fs, res); return res; }
(0128) #else
(0129) #define	ENTER_FF(fs)
(0130) #define LEAVE_FF(fs, res)	return res
(0131) #endif
(0132) 
(0133) #define	ABORT(fs, res)		{ fp->flag |= FA__ERROR; LEAVE_FF(fs, res); }
(0134) 
(0135) 
(0136) /* File shareing feature */
(0137) #if _FS_SHARE
(0138) #if _FS_READONLY
(0139) #error _FS_SHARE must be 0 on read-only cfg.
(0140) #endif
(0141) typedef struct {
(0142) 	FATFS *fs;				/* File ID 1, volume (NULL:blank entry) */
(0143) 	DWORD clu;				/* File ID 2, directory */
(0144) 	WORD idx;				/* File ID 3, directory index */
(0145) 	WORD ctr;				/* File open counter, 0:none, 0x01..0xFF:read open count, 0x100:write mode */
(0146) } FILESEM;
(0147) #endif
(0148) 
(0149) 
(0150) /* Misc definitions */
(0151) #define LD_CLUST(dir)	(((DWORD)LD_WORD(dir+DIR_FstClusHI)<<16) | LD_WORD(dir+DIR_FstClusLO))
(0152) #define ST_CLUST(dir,cl) {ST_WORD(dir+DIR_FstClusLO, cl); ST_WORD(dir+DIR_FstClusHI, (DWORD)cl>>16);}
(0153) 
(0154) 
(0155) /* DBCS code ranges and SBCS extend char conversion table */
(0156) 
(0157) #if _CODE_PAGE == 932	/* Japanese Shift-JIS */
(0158) #define _DF1S	0x81	/* DBC 1st byte range 1 start */
(0159) #define _DF1E	0x9F	/* DBC 1st byte range 1 end */
(0160) #define _DF2S	0xE0	/* DBC 1st byte range 2 start */
(0161) #define _DF2E	0xFC	/* DBC 1st byte range 2 end */
(0162) #define _DS1S	0x40	/* DBC 2nd byte range 1 start */
(0163) #define _DS1E	0x7E	/* DBC 2nd byte range 1 end */
(0164) #define _DS2S	0x80	/* DBC 2nd byte range 2 start */
(0165) #define _DS2E	0xFC	/* DBC 2nd byte range 2 end */
(0166) 
(0167) #elif _CODE_PAGE == 936	/* Simplified Chinese GBK */
(0168) #define _DF1S	0x81
(0169) #define _DF1E	0xFE
(0170) #define _DS1S	0x40
(0171) #define _DS1E	0x7E
(0172) #define _DS2S	0x80
(0173) #define _DS2E	0xFE
(0174) 
(0175) #elif _CODE_PAGE == 949	/* Korean */
(0176) #define _DF1S	0x81
(0177) #define _DF1E	0xFE
(0178) #define _DS1S	0x41
(0179) #define _DS1E	0x5A
(0180) #define _DS2S	0x61
(0181) #define _DS2E	0x7A
(0182) #define _DS3S	0x81
(0183) #define _DS3E	0xFE
(0184) 
(0185) #elif _CODE_PAGE == 950	/* Traditional Chinese Big5 */
(0186) #define _DF1S	0x81
(0187) #define _DF1E	0xFE
(0188) #define _DS1S	0x40
(0189) #define _DS1E	0x7E
(0190) #define _DS2S	0xA1
(0191) #define _DS2E	0xFE
(0192) 
(0193) #elif _CODE_PAGE == 437	/* U.S. (OEM) */
(0194) #define _DF1S	0
(0195) #define _EXCVT {0x80,0x9A,0x90,0x41,0x8E,0x41,0x8F,0x80,0x45,0x45,0x45,0x49,0x49,0x49,0x8E,0x8F,0x90,0x92,0x92,0x4F,0x99,0x4F,0x55,0x55,0x59,0x99,0x9A,0x9B,0x9C,0x9D,0x9E,0x9F, \
(0196) 				0x41,0x49,0x4F,0x55,0xA5,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0x21,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0197) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0198) 				0xE0,0xE1,0xE2,0xE3,0xE4,0xE5,0xE6,0xE7,0xE8,0xE9,0xEA,0xEB,0xEC,0xED,0xEE,0xEF,0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}
(0199) 
(0200) #elif _CODE_PAGE == 720	/* Arabic (OEM) */
(0201) #define _DF1S	0
(0202) #define _EXCVT {0x80,0x81,0x45,0x41,0x84,0x41,0x86,0x43,0x45,0x45,0x45,0x49,0x49,0x8D,0x8E,0x8F,0x90,0x92,0x92,0x93,0x94,0x95,0x49,0x49,0x98,0x99,0x9A,0x9B,0x9C,0x9D,0x9E,0x9F, \
(0203) 				0xA0,0xA1,0xA2,0xA3,0xA4,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0204) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0205) 				0xE0,0xE1,0xE2,0xE3,0xE4,0xE5,0xE6,0xE7,0xE8,0xE9,0xEA,0xEB,0xEC,0xED,0xEE,0xEF,0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}
(0206) 
(0207) #elif _CODE_PAGE == 737	/* Greek (OEM) */
(0208) #define _DF1S	0
(0209) #define _EXCVT {0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x92,0x92,0x93,0x94,0x95,0x96,0x97,0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87, \
(0210) 				0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x91,0xAA,0x92,0x93,0x94,0x95,0x96,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0211) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0212) 				0x97,0xEA,0xEB,0xEC,0xE4,0xED,0xEE,0xE7,0xE8,0xF1,0xEA,0xEB,0xEC,0xED,0xEE,0xEF,0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}
(0213) 
(0214) #elif _CODE_PAGE == 775	/* Baltic (OEM) */
(0215) #define _DF1S	0
(0216) #define _EXCVT {0x80,0x9A,0x91,0xA0,0x8E,0x95,0x8F,0x80,0xAD,0xED,0x8A,0x8A,0xA1,0x8D,0x8E,0x8F,0x90,0x92,0x92,0xE2,0x99,0x95,0x96,0x97,0x97,0x99,0x9A,0x9D,0x9C,0x9D,0x9E,0x9F, \
(0217) 				0xA0,0xA1,0xE0,0xA3,0xA3,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0218) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xB5,0xB6,0xB7,0xB8,0xBD,0xBE,0xC6,0xC7,0xA5,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0219) 				0xE0,0xE1,0xE2,0xE3,0xE5,0xE5,0xE6,0xE3,0xE8,0xE8,0xEA,0xEA,0xEE,0xED,0xEE,0xEF,0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}
(0220) 
(0221) #elif _CODE_PAGE == 850	/* Multilingual Latin 1 (OEM) */
(0222) #define _DF1S	0
(0223) #define _EXCVT {0x80,0x9A,0x90,0xB6,0x8E,0xB7,0x8F,0x80,0xD2,0xD3,0xD4,0xD8,0xD7,0xDE,0x8E,0x8F,0x90,0x92,0x92,0xE2,0x99,0xE3,0xEA,0xEB,0x59,0x99,0x9A,0x9D,0x9C,0x9D,0x9E,0x9F, \
(0224) 				0xB5,0xD6,0xE0,0xE9,0xA5,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0x21,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0225) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC7,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0226) 				0xE0,0xE1,0xE2,0xE3,0xE5,0xE5,0xE6,0xE7,0xE7,0xE9,0xEA,0xEB,0xED,0xED,0xEE,0xEF,0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}
(0227) 
(0228) #elif _CODE_PAGE == 852	/* Latin 2 (OEM) */
(0229) #define _DF1S	0
(0230) #define _EXCVT {0x80,0x9A,0x90,0xB6,0x8E,0xDE,0x8F,0x80,0x9D,0xD3,0x8A,0x8A,0xD7,0x8D,0x8E,0x8F,0x90,0x91,0x91,0xE2,0x99,0x95,0x95,0x97,0x97,0x99,0x9A,0x9B,0x9B,0x9D,0x9E,0x9F, \
(0231) 				0xB5,0xD6,0xE0,0xE9,0xA4,0xA4,0xA6,0xA6,0xA8,0xA8,0xAA,0x8D,0xAC,0xB8,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBD,0xBF, \
(0232) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC6,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD1,0xD1,0xD2,0xD3,0xD2,0xD5,0xD6,0xD7,0xB7,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0233) 				0xE0,0xE1,0xE2,0xE3,0xE3,0xD5,0xE6,0xE6,0xE8,0xE9,0xE8,0xEB,0xED,0xED,0xDD,0xEF,0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xEB,0xFC,0xFC,0xFE,0xFF}
(0234) 
(0235) #elif _CODE_PAGE == 855	/* Cyrillic (OEM) */
(0236) #define _DF1S	0
(0237) #define _EXCVT {0x81,0x81,0x83,0x83,0x85,0x85,0x87,0x87,0x89,0x89,0x8B,0x8B,0x8D,0x8D,0x8F,0x8F,0x91,0x91,0x93,0x93,0x95,0x95,0x97,0x97,0x99,0x99,0x9B,0x9B,0x9D,0x9D,0x9F,0x9F, \
(0238) 				0xA1,0xA1,0xA3,0xA3,0xA5,0xA5,0xA7,0xA7,0xA9,0xA9,0xAB,0xAB,0xAD,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB6,0xB6,0xB8,0xB8,0xB9,0xBA,0xBB,0xBC,0xBE,0xBE,0xBF, \
(0239) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC7,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD1,0xD1,0xD3,0xD3,0xD5,0xD5,0xD7,0xD7,0xDD,0xD9,0xDA,0xDB,0xDC,0xDD,0xE0,0xDF, \
(0240) 				0xE0,0xE2,0xE2,0xE4,0xE4,0xE6,0xE6,0xE8,0xE8,0xEA,0xEA,0xEC,0xEC,0xEE,0xEE,0xEF,0xF0,0xF2,0xF2,0xF4,0xF4,0xF6,0xF6,0xF8,0xF8,0xFA,0xFA,0xFC,0xFC,0xFD,0xFE,0xFF}
(0241) 
(0242) #elif _CODE_PAGE == 857	/* Turkish (OEM) */
(0243) #define _DF1S	0
(0244) #define _EXCVT {0x80,0x9A,0x90,0xB6,0x8E,0xB7,0x8F,0x80,0xD2,0xD3,0xD4,0xD8,0xD7,0x98,0x8E,0x8F,0x90,0x92,0x92,0xE2,0x99,0xE3,0xEA,0xEB,0x98,0x99,0x9A,0x9D,0x9C,0x9D,0x9E,0x9E, \
(0245) 				0xB5,0xD6,0xE0,0xE9,0xA5,0xA5,0xA6,0xA6,0xA8,0xA9,0xAA,0xAB,0xAC,0x21,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0246) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC7,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0247) 				0xE0,0xE1,0xE2,0xE3,0xE5,0xE5,0xE6,0xE7,0xE8,0xE9,0xEA,0xEB,0xDE,0x59,0xEE,0xEF,0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}
(0248) 
(0249) #elif _CODE_PAGE == 858	/* Multilingual Latin 1 + Euro (OEM) */
(0250) #define _DF1S	0
(0251) #define _EXCVT {0x80,0x9A,0x90,0xB6,0x8E,0xB7,0x8F,0x80,0xD2,0xD3,0xD4,0xD8,0xD7,0xDE,0x8E,0x8F,0x90,0x92,0x92,0xE2,0x99,0xE3,0xEA,0xEB,0x59,0x99,0x9A,0x9D,0x9C,0x9D,0x9E,0x9F, \
(0252) 				0xB5,0xD6,0xE0,0xE9,0xA5,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0x21,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0253) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC7,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD1,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0254) 				0xE0,0xE1,0xE2,0xE3,0xE5,0xE5,0xE6,0xE7,0xE7,0xE9,0xEA,0xEB,0xED,0xED,0xEE,0xEF,0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}
(0255) 
(0256) #elif _CODE_PAGE == 862	/* Hebrew (OEM) */
(0257) #define _DF1S	0
(0258) #define _EXCVT {0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x9A,0x9B,0x9C,0x9D,0x9E,0x9F, \
(0259) 				0x41,0x49,0x4F,0x55,0xA5,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0x21,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0260) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0261) 				0xE0,0xE1,0xE2,0xE3,0xE4,0xE5,0xE6,0xE7,0xE8,0xE9,0xEA,0xEB,0xEC,0xED,0xEE,0xEF,0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}
(0262) 
(0263) #elif _CODE_PAGE == 866	/* Russian (OEM) */
(0264) #define _DF1S	0
(0265) #define _EXCVT {0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x9A,0x9B,0x9C,0x9D,0x9E,0x9F, \
(0266) 				0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0267) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0268) 				0x90,0x91,0x92,0x93,0x9d,0x95,0x96,0x97,0x98,0x99,0x9A,0x9B,0x9C,0x9D,0x9E,0x9F,0xF0,0xF0,0xF2,0xF2,0xF4,0xF4,0xF6,0xF6,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}
(0269) 
(0270) #elif _CODE_PAGE == 874	/* Thai (OEM, Windows) */
(0271) #define _DF1S	0
(0272) #define _EXCVT {0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x9A,0x9B,0x9C,0x9D,0x9E,0x9F, \
(0273) 				0xA0,0xA1,0xA2,0xA3,0xA4,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0274) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0275) 				0xE0,0xE1,0xE2,0xE3,0xE4,0xE5,0xE6,0xE7,0xE8,0xE9,0xEA,0xEB,0xEC,0xED,0xEE,0xEF,0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}
(0276) 
(0277) #elif _CODE_PAGE == 1250 /* Central Europe (Windows) */
(0278) #define _DF1S	0
(0279) #define _EXCVT {0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x8A,0x9B,0x8C,0x8D,0x8E,0x8F, \
(0280) 				0xA0,0xA1,0xA2,0xA3,0xA4,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xA3,0xB4,0xB5,0xB6,0xB7,0xB8,0xA5,0xAA,0xBB,0xBC,0xBD,0xBC,0xAF, \
(0281) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0282) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xF7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xFF}
(0283) 
(0284) #elif _CODE_PAGE == 1251 /* Cyrillic (Windows) */
(0285) #define _DF1S	0
(0286) #define _EXCVT {0x80,0x81,0x82,0x82,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x80,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x8A,0x9B,0x8C,0x8D,0x8E,0x8F, \
(0287) 				0xA0,0xA2,0xA2,0xA3,0xA4,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xB2,0xA5,0xB5,0xB6,0xB7,0xA8,0xB9,0xAA,0xBB,0xA3,0xBD,0xBD,0xAF, \
(0288) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0289) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF}
(0290) 
(0291) #elif _CODE_PAGE == 1252 /* Latin 1 (Windows) */
(0292) #define _DF1S	0
(0293) #define _EXCVT {0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0xAd,0x9B,0x8C,0x9D,0xAE,0x9F, \
(0294) 				0xA0,0x21,0xA2,0xA3,0xA4,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0295) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0296) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xF7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0x9F}
(0297) 
(0298) #elif _CODE_PAGE == 1253 /* Greek (Windows) */
(0299) #define _DF1S	0
(0300) #define _EXCVT {0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x9A,0x9B,0x9C,0x9D,0x9E,0x9F, \
(0301) 				0xA0,0xA1,0xA2,0xA3,0xA4,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0302) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xA2,0xB8,0xB9,0xBA, \
(0303) 				0xE0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xF2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xFB,0xBC,0xFD,0xBF,0xFF}
(0304) 
(0305) #elif _CODE_PAGE == 1254 /* Turkish (Windows) */
(0306) #define _DF1S	0
(0307) #define _EXCVT {0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x8A,0x9B,0x8C,0x9D,0x9E,0x9F, \
(0308) 				0xA0,0x21,0xA2,0xA3,0xA4,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0309) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0310) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xF7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0x9F}
(0311) 
(0312) #elif _CODE_PAGE == 1255 /* Hebrew (Windows) */
(0313) #define _DF1S	0
(0314) #define _EXCVT {0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x9A,0x9B,0x9C,0x9D,0x9E,0x9F, \
(0315) 				0xA0,0x21,0xA2,0xA3,0xA4,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0316) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0317) 				0xE0,0xE1,0xE2,0xE3,0xE4,0xE5,0xE6,0xE7,0xE8,0xE9,0xEA,0xEB,0xEC,0xED,0xEE,0xEF,0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}
(0318) 
(0319) #elif _CODE_PAGE == 1256 /* Arabic (Windows) */
(0320) #define _DF1S	0
(0321) #define _EXCVT {0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x9A,0x9B,0x8C,0x9D,0x9E,0x9F, \
(0322) 				0xA0,0xA1,0xA2,0xA3,0xA4,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0323) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0324) 				0x41,0xE1,0x41,0xE3,0xE4,0xE5,0xE6,0x43,0x45,0x45,0x45,0x45,0xEC,0xED,0x49,0x49,0xF0,0xF1,0xF2,0xF3,0x4F,0xF5,0xF6,0xF7,0xF8,0x55,0xFA,0x55,0x55,0xFD,0xFE,0xFF}
(0325) 
(0326) #elif _CODE_PAGE == 1257 /* Baltic (Windows) */
(0327) #define _DF1S	0
(0328) #define _EXCVT {0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x9A,0x9B,0x9C,0x9D,0x9E,0x9F, \
(0329) 				0xA0,0xA1,0xA2,0xA3,0xA4,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xA8,0xB9,0xAA,0xBB,0xBC,0xBD,0xBE,0xAF, \
(0330) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0331) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xF7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xFF}
(0332) 
(0333) #elif _CODE_PAGE == 1258 /* Vietnam (OEM, Windows) */
(0334) #define _DF1S	0
(0335) #define _EXCVT {0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x9A,0x9B,0xAC,0x9D,0x9E,0x9F, \
(0336) 				0xA0,0x21,0xA2,0xA3,0xA4,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0337) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0338) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xEC,0xCD,0xCE,0xCF,0xD0,0xD1,0xF2,0xD3,0xD4,0xD5,0xD6,0xF7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xFE,0x9F}
(0339) 
(0340) #elif _CODE_PAGE == 1	/* ASCII (for only non-LFN cfg) */
(0341) #if _USE_LFN
(0342) #error Cannot use LFN feature without valid code page.
(0343) #endif
(0344) #define _DF1S	0
(0345) 
(0346) #else
(0347) #error Unknown code page
(0348) 
(0349) #endif
(0350) 
(0351) 
(0352) /* Character code support macros */
(0353) #define IsUpper(c)	(((c)>='A')&&((c)<='Z'))
(0354) #define IsLower(c)	(((c)>='a')&&((c)<='z'))
(0355) #define IsDigit(c)	(((c)>='0')&&((c)<='9'))
(0356) 
(0357) #if _DF1S		/* Code page is DBCS */
(0358) 
(0359) #ifdef _DF2S	/* Two 1st byte areas */
(0360) #define IsDBCS1(c)	(((BYTE)(c) >= _DF1S && (BYTE)(c) <= _DF1E) || ((BYTE)(c) >= _DF2S && (BYTE)(c) <= _DF2E))
(0361) #else			/* One 1st byte area */
(0362) #define IsDBCS1(c)	((BYTE)(c) >= _DF1S && (BYTE)(c) <= _DF1E)
(0363) #endif
(0364) 
(0365) #ifdef _DS3S	/* Three 2nd byte areas */
(0366) #define IsDBCS2(c)	(((BYTE)(c) >= _DS1S && (BYTE)(c) <= _DS1E) || ((BYTE)(c) >= _DS2S && (BYTE)(c) <= _DS2E) || ((BYTE)(c) >= _DS3S && (BYTE)(c) <= _DS3E))
(0367) #else			/* Two 2nd byte areas */
(0368) #define IsDBCS2(c)	(((BYTE)(c) >= _DS1S && (BYTE)(c) <= _DS1E) || ((BYTE)(c) >= _DS2S && (BYTE)(c) <= _DS2E))
(0369) #endif
(0370) 
(0371) #else			/* Code page is SBCS */
(0372) 
(0373) #define IsDBCS1(c)	0
(0374) #define IsDBCS2(c)	0
(0375) 
(0376) #endif /* _DF1S */
(0377) 
(0378) 
(0379) /* Name status flags */
(0380) #define NS			11		/* Index of name status byte in fn[] */
(0381) #define NS_LOSS		0x01	/* Out of 8.3 format */
(0382) #define NS_LFN		0x02	/* Force to create LFN entry */
(0383) #define NS_LAST		0x04	/* Last segment */
(0384) #define NS_BODY		0x08	/* Lower case flag (body) */
(0385) #define NS_EXT		0x10	/* Lower case flag (ext) */
(0386) #define NS_DOT		0x20	/* Dot entry */
(0387) 
(0388) 
(0389) /* FAT sub-type boundaries */
(0390) /* Note that the FAT spec by Microsoft says 4085 but Windows works with 4087! */
(0391) #define MIN_FAT16	4086	/* Minimum number of clusters for FAT16 */
(0392) #define	MIN_FAT32	65526	/* Minimum number of clusters for FAT32 */
(0393) 
(0394) 
(0395) /* FatFs refers the members in the FAT structures as byte array instead of
(0396) / structure member because the structure is not binary compatible between
(0397) / different platforms */
(0398) 
(0399) #define BS_jmpBoot			0	/* Jump instruction (3) */
(0400) #define BS_OEMName			3	/* OEM name (8) */
(0401) #define BPB_BytsPerSec		11	/* Sector size [byte] (2) */
(0402) #define BPB_SecPerClus		13	/* Cluster size [sector] (1) */
(0403) #define BPB_RsvdSecCnt		14	/* Size of reserved area [sector] (2) */
(0404) #define BPB_NumFATs			16	/* Number of FAT copies (1) */
(0405) #define BPB_RootEntCnt		17	/* Number of root dir entries for FAT12/16 (2) */
(0406) #define BPB_TotSec16		19	/* Volume size [sector] (2) */
(0407) #define BPB_Media			21	/* Media descriptor (1) */
(0408) #define BPB_FATSz16			22	/* FAT size [sector] (2) */
(0409) #define BPB_SecPerTrk		24	/* Track size [sector] (2) */
(0410) #define BPB_NumHeads		26	/* Number of heads (2) */
(0411) #define BPB_HiddSec			28	/* Number of special hidden sectors (4) */
(0412) #define BPB_TotSec32		32	/* Volume size [sector] (4) */
(0413) #define BS_DrvNum			36	/* Physical drive number (2) */
(0414) #define BS_BootSig			38	/* Extended boot signature (1) */
(0415) #define BS_VolID			39	/* Volume serial number (4) */
(0416) #define BS_VolLab			43	/* Volume label (8) */
(0417) #define BS_FilSysType		54	/* File system type (1) */
(0418) #define BPB_FATSz32			36	/* FAT size [sector] (4) */
(0419) #define BPB_ExtFlags		40	/* Extended flags (2) */
(0420) #define BPB_FSVer			42	/* File system version (2) */
(0421) #define BPB_RootClus		44	/* Root dir first cluster (4) */
(0422) #define BPB_FSInfo			48	/* Offset of FSInfo sector (2) */
(0423) #define BPB_BkBootSec		50	/* Offset of backup boot sectot (2) */
(0424) #define BS_DrvNum32			64	/* Physical drive number (2) */
(0425) #define BS_BootSig32		66	/* Extended boot signature (1) */
(0426) #define BS_VolID32			67	/* Volume serial number (4) */
(0427) #define BS_VolLab32			71	/* Volume label (8) */
(0428) #define BS_FilSysType32		82	/* File system type (1) */
(0429) #define	FSI_LeadSig			0	/* FSI: Leading signature (4) */
(0430) #define	FSI_StrucSig		484	/* FSI: Structure signature (4) */
(0431) #define	FSI_Free_Count		488	/* FSI: Number of free clusters (4) */
(0432) #define	FSI_Nxt_Free		492	/* FSI: Last allocated cluster (4) */
(0433) #define MBR_Table			446	/* MBR: Partition table offset (2) */
(0434) #define	SZ_PTE				16	/* MBR: Size of a partition table entry */
(0435) #define BS_55AA				510	/* Boot sector signature (2) */
(0436) 
(0437) #define	DIR_Name			0	/* Short file name (11) */
(0438) #define	DIR_Attr			11	/* Attribute (1) */
(0439) #define	DIR_NTres			12	/* NT flag (1) */
(0440) #define	DIR_CrtTime			14	/* Created time (2) */
(0441) #define	DIR_CrtDate			16	/* Created date (2) */
(0442) #define	DIR_FstClusHI		20	/* Higher 16-bit of first cluster (2) */
(0443) #define	DIR_WrtTime			22	/* Modified time (2) */
(0444) #define	DIR_WrtDate			24	/* Modified date (2) */
(0445) #define	DIR_FstClusLO		26	/* Lower 16-bit of first cluster (2) */
(0446) #define	DIR_FileSize		28	/* File size (4) */
(0447) #define	LDIR_Ord			0	/* LFN entry order and LLE flag (1) */
(0448) #define	LDIR_Attr			11	/* LFN attribute (1) */
(0449) #define	LDIR_Type			12	/* LFN type (1) */
(0450) #define	LDIR_Chksum			13	/* Sum of corresponding SFN entry */
(0451) #define	LDIR_FstClusLO		26	/* Filled by zero (0) */
(0452) #define	SZ_DIR				32		/* Size of a directory entry */
(0453) #define	LLE					0x40	/* Last long entry flag in LDIR_Ord */
(0454) #define	DDE					0xE5	/* Deleted directory enrty mark in DIR_Name[0] */
(0455) #define	NDDE				0x05	/* Replacement of a character collides with DDE */
(0456) 
(0457) 
(0458) /*------------------------------------------------------------*/
(0459) /* Module private work area                                   */
(0460) /*------------------------------------------------------------*/
(0461) /* Note that uninitialized variables with static duration are
(0462) /  zeroed/nulled at start-up. If not, the compiler or start-up
(0463) /  routine is out of ANSI-C standard.
(0464) */
(0465) 
(0466) #if _VOLUMES
(0467) static
(0468) FATFS *FatFs[_VOLUMES];	/* Pointer to the file system objects (logical drives) */
(0469) #else
(0470) #error Number of volumes must not be 0.
(0471) #endif
(0472) 
(0473) static
(0474) WORD Fsid;				/* File system mount ID */
(0475) 
(0476) #if _FS_RPATH
(0477) static
(0478) BYTE CurrVol;			/* Current drive */
(0479) #endif
(0480) 
(0481) #if _FS_SHARE
(0482) static
(0483) FILESEM	Files[_FS_SHARE];	/* File lock semaphores */
(0484) #endif
(0485) 
(0486) #if _USE_LFN == 0			/* No LFN feature */
(0487) #define	DEF_NAMEBUF			BYTE sfn[12]
(0488) #define INIT_BUF(dobj)		(dobj).fn = sfn
(0489) #define	FREE_BUF()
(0490) 
(0491) #elif _USE_LFN == 1			/* LFN feature with static working buffer */
(0492) static WCHAR LfnBuf[_MAX_LFN+1];
(0493) #define	DEF_NAMEBUF			BYTE sfn[12]
(0494) #define INIT_BUF(dobj)		{ (dobj).fn = sfn; (dobj).lfn = LfnBuf; }
(0495) #define	FREE_BUF()
(0496) 
(0497) #elif _USE_LFN == 2 		/* LFN feature with dynamic working buffer on the stack */
(0498) #define	DEF_NAMEBUF			BYTE sfn[12]; WCHAR lbuf[_MAX_LFN+1]
(0499) #define INIT_BUF(dobj)		{ (dobj).fn = sfn; (dobj).lfn = lbuf; }
(0500) #define	FREE_BUF()
(0501) 
(0502) #elif _USE_LFN == 3 		/* LFN feature with dynamic working buffer on the heap */
(0503) #define	DEF_NAMEBUF			BYTE sfn[12]; WCHAR *lfn
(0504) #define INIT_BUF(dobj)		{ lfn = ff_memalloc((_MAX_LFN + 1) * 2); \
(0505) 							  if (!lfn) LEAVE_FF((dobj).fs, FR_NOT_ENOUGH_CORE); \
(0506) 							  (dobj).lfn = lfn;	(dobj).fn = sfn; }
(0507) #define	FREE_BUF()			ff_memfree(lfn)
(0508) 
(0509) #else
(0510) #error Wrong LFN configuration.
(0511) #endif
(0512) 
(0513) 
(0514) 
(0515) 
(0516) /*--------------------------------------------------------------------------
(0517) 
(0518)    Module Private Functions
(0519) 
(0520) ---------------------------------------------------------------------------*/
(0521) 
(0522) 
(0523) /*-----------------------------------------------------------------------*/
(0524) /* String functions                                                      */
(0525) /*-----------------------------------------------------------------------*/
(0526) 
(0527) /* Copy memory to memory */
(0528) static
(0529) void mem_cpy (void* dst, const void* src, UINT cnt) {
(0530) 	BYTE *d = (BYTE*)dst;
    0041F 0158      MOVW	R10,R16
(0531) 	const BYTE *s = (const BYTE*)src;
    00420 0169      MOVW	R12,R18
    00421 C006      RJMP	0x0428
(0532) 
(0533) #if _WORD_ACCESS == 1
(0534) 	while (cnt >= sizeof(int)) {
(0535) 		*(int*)d = *(int*)s;
(0536) 		d += sizeof(int); s += sizeof(int);
(0537) 		cnt -= sizeof(int);
(0538) 	}
(0539) #endif
(0540) 	while (cnt--)
(0541) 		*d++ = *s++;
    00422 01F6      MOVW	R30,R12
    00423 01D5      MOVW	R26,R10
    00424 9001      LD	R0,Z+
    00425 016F      MOVW	R12,R30
    00426 920D      ST	X+,R0
    00427 015D      MOVW	R10,R26
    00428 011A      MOVW	R2,R20
    00429 5041      SUBI	R20,1
    0042A 4050      SBCI	R21,0
    0042B 2022      TST	R2
    0042C F7A9      BNE	0x0422
    0042D 2033      TST	R3
    0042E F799      BNE	0x0422
    0042F 940C 48F7 JMP	pop_xgset303C
ff.c:mem_set:
  d                    --> R10
  cnt                  --> R20
  val                  --> R18
  dst                  --> R16
    00431 940E 48CE CALL	push_xgset300C
    00433 814C      LDD	R20,Y+4
    00434 815D      LDD	R21,Y+5
(0542) }
(0543) 
(0544) /* Fill memory */
(0545) static
(0546) void mem_set (void* dst, int val, UINT cnt) {
(0547) 	BYTE *d = (BYTE*)dst;
    00435 0158      MOVW	R10,R16
    00436 C003      RJMP	0x043A
(0548) 
(0549) 	while (cnt--)
(0550) 		*d++ = (BYTE)val;
    00437 01F5      MOVW	R30,R10
    00438 9321      ST	Z+,R18
    00439 015F      MOVW	R10,R30
    0043A 011A      MOVW	R2,R20
    0043B 5041      SUBI	R20,1
    0043C 4050      SBCI	R21,0
    0043D 2022      TST	R2
    0043E F7C1      BNE	0x0437
    0043F 2033      TST	R3
    00440 F7B1      BNE	0x0437
    00441 940C 48D3 JMP	pop_xgset300C
ff.c:mem_cmp:
  s                    --> R14
  d                    --> R12
  r                    --> R10
  cnt                  --> R20
  src                  --> R18
  dst                  --> R16
    00443 940E 48C5 CALL	push_xgset30FC
    00445 8548      LDD	R20,Y+8
    00446 8559      LDD	R21,Y+9
(0551) }
(0552) 
(0553) /* Compare memory to memory */
(0554) static
(0555) int mem_cmp (const void* dst, const void* src, UINT cnt) {
(0556) 	const BYTE *d = (const BYTE *)dst, *s = (const BYTE *)src;
    00447 0168      MOVW	R12,R16
    00448 0179      MOVW	R14,R18
(0557) 	int r = 0;
    00449 24AA      CLR	R10
    0044A 24BB      CLR	R11
(0558) 
(0559) 	while (cnt-- && (r = *d++ - *s++) == 0) ;
    0044B 011A      MOVW	R2,R20
    0044C 5041      SUBI	R20,1
    0044D 4050      SBCI	R21,0
    0044E 2022      TST	R2
    0044F F411      BNE	0x0452
    00450 2033      TST	R3
    00451 F079      BEQ	0x0461
    00452 01F7      MOVW	R30,R14
    00453 9021      LD	R2,Z+
    00454 017F      MOVW	R14,R30
    00455 2433      CLR	R3
    00456 01F6      MOVW	R30,R12
    00457 9041      LD	R4,Z+
    00458 016F      MOVW	R12,R30
    00459 2455      CLR	R5
    0045A 1842      SUB	R4,R2
    0045B 0853      SBC	R5,R3
    0045C 0152      MOVW	R10,R4
    0045D 20AA      TST	R10
    0045E F411      BNE	0x0461
    0045F 20BB      TST	R11
    00460 F351      BEQ	0x044B
(0560) 	return r;
    00461 0185      MOVW	R16,R10
    00462 940C 48AF JMP	pop_xgset30FC
(0561) }
(0562) 
(0563) /* Check if chr is contained in the string */
(0564) static
(0565) int chk_chr (const char* str, int chr) {
ff.c:chk_chr:
  chr                  --> R18
  str                  --> R16
    00464 C002      RJMP	0x0467
(0566) 	while (*str && *str != chr) str++;
    00465 5F0F      SUBI	R16,0xFF
    00466 4F1F      SBCI	R17,0xFF
    00467 01F8      MOVW	R30,R16
    00468 8020      LD	R2,Z
    00469 2433      CLR	R3
    0046A 2022      TST	R2
    0046B F021      BEQ	0x0470
    0046C 2433      CLR	R3
    0046D 1622      CP	R2,R18
    0046E 0633      CPC	R3,R19
    0046F F7A9      BNE	0x0465
(0567) 	return *str;
    00470 01F8      MOVW	R30,R16
    00471 8100      LD	R16,Z
    00472 2711      CLR	R17
    00473 9508      RET
ff.c:move_window:
  nf                   --> R10
  wsect                --> Y,+5
  sector               --> Y,+13
  fs                   --> R20
    00474 933A      ST	-Y,R19
    00475 932A      ST	-Y,R18
    00476 940E 48CE CALL	push_xgset300C
    00478 01A8      MOVW	R20,R16
    00479 9729      SBIW	R28,0x9
(0568) }
(0569) 
(0570) 
(0571) 
(0572) /*-----------------------------------------------------------------------*/
(0573) /* Request/Release grant to access the volume                            */
(0574) /*-----------------------------------------------------------------------*/
(0575) #if _FS_REENTRANT
(0576) 
(0577) static
(0578) int lock_fs (
(0579) 	FATFS *fs		/* File system object */
(0580) )
(0581) {
(0582) 	return ff_req_grant(fs->sobj);
(0583) }
(0584) 
(0585) 
(0586) static
(0587) void unlock_fs (
(0588) 	FATFS *fs,		/* File system object */
(0589) 	FRESULT res		/* Result code to be returned */
(0590) )
(0591) {
(0592) 	if (res != FR_NOT_ENABLED &&
(0593) 		res != FR_INVALID_DRIVE &&
(0594) 		res != FR_INVALID_OBJECT &&
(0595) 		res != FR_TIMEOUT) {
(0596) 		ff_rel_grant(fs->sobj);
(0597) 	}
(0598) }
(0599) #endif
(0600) 
(0601) 
(0602) 
(0603) /*-----------------------------------------------------------------------*/
(0604) /* File shareing control functions                                       */
(0605) /*-----------------------------------------------------------------------*/
(0606) #if _FS_SHARE
(0607) 
(0608) static
(0609) FRESULT chk_lock (	/* Check if the file can be accessed */
(0610) 	DIR* dj,		/* Directory object pointing the file to be checked */
(0611) 	int acc			/* Desired access (0:Read, 1:Write, 2:Delete/Rename) */
(0612) )
(0613) {
(0614) 	UINT i, be;
(0615) 
(0616) 	/* Search file semaphore table */
(0617) 	for (i = be = 0; i < _FS_SHARE; i++) {
(0618) 		if (Files[i].fs) {	/* Existing entry */
(0619) 			if (Files[i].fs == dj->fs &&	 	/* Check if the file matched with an open file */
(0620) 				Files[i].clu == dj->sclust &&
(0621) 				Files[i].idx == dj->index) break;
(0622) 		} else {			/* Blank entry */
(0623) 			be++;
(0624) 		}
(0625) 	}
(0626) 	if (i == _FS_SHARE)	/* The file is not opened */
(0627) 		return (be || acc == 2) ? FR_OK : FR_TOO_MANY_OPEN_FILES;	/* Is there a blank entry for new file? */
(0628) 
(0629) 	/* The file has been opened. Reject any open against writing file and all write mode open */
(0630) 	return (acc || Files[i].ctr == 0x100) ? FR_LOCKED : FR_OK;
(0631) }
(0632) 
(0633) 
(0634) static
(0635) int enq_lock (void)	/* Check if an entry is available for a new file */
(0636) {
(0637) 	UINT i;
(0638) 
(0639) 	for (i = 0; i < _FS_SHARE && Files[i].fs; i++) ;
(0640) 	return (i == _FS_SHARE) ? 0 : 1;
(0641) }
(0642) 
(0643) 
(0644) static
(0645) UINT inc_lock (	/* Increment file open counter and returns its index (0:int error) */
(0646) 	DIR* dj,	/* Directory object pointing the file to register or increment */
(0647) 	int acc		/* Desired access mode (0:Read, !0:Write) */
(0648) )
(0649) {
(0650) 	UINT i;
(0651) 
(0652) 
(0653) 	for (i = 0; i < _FS_SHARE; i++) {	/* Find the file */
(0654) 		if (Files[i].fs == dj->fs &&
(0655) 			Files[i].clu == dj->sclust &&
(0656) 			Files[i].idx == dj->index) break;
(0657) 	}
(0658) 
(0659) 	if (i == _FS_SHARE) {				/* Not opened. Register it as new. */
(0660) 		for (i = 0; i < _FS_SHARE && Files[i].fs; i++) ;
(0661) 		if (i == _FS_SHARE) return 0;	/* No space to register (int err) */
(0662) 		Files[i].fs = dj->fs;
(0663) 		Files[i].clu = dj->sclust;
(0664) 		Files[i].idx = dj->index;
(0665) 		Files[i].ctr = 0;
(0666) 	}
(0667) 
(0668) 	if (acc && Files[i].ctr) return 0;	/* Access violation (int err) */
(0669) 
(0670) 	Files[i].ctr = acc ? 0x100 : Files[i].ctr + 1;	/* Set semaphore value */
(0671) 
(0672) 	return i + 1;
(0673) }
(0674) 
(0675) 
(0676) static
(0677) FRESULT dec_lock (	/* Decrement file open counter */
(0678) 	UINT i			/* Semaphore index */
(0679) )
(0680) {
(0681) 	WORD n;
(0682) 	FRESULT res;
(0683) 
(0684) 
(0685) 	if (--i < _FS_SHARE) {
(0686) 		n = Files[i].ctr;
(0687) 		if (n == 0x100) n = 0;
(0688) 		if (n) n--;
(0689) 		Files[i].ctr = n;
(0690) 		if (!n) Files[i].fs = 0;
(0691) 		res = FR_OK;
(0692) 	} else {
(0693) 		res = FR_INT_ERR;
(0694) 	}
(0695) 	return res;
(0696) }
(0697) 
(0698) 
(0699) static
(0700) void clear_lock (	/* Clear lock entries of the volume */
(0701) 	FATFS *fs
(0702) )
(0703) {
(0704) 	UINT i;
(0705) 
(0706) 	for (i = 0; i < _FS_SHARE; i++) {
(0707) 		if (Files[i].fs == fs) Files[i].fs = 0;
(0708) 	}
(0709) }
(0710) #endif
(0711) 
(0712) 
(0713) 
(0714) /*-----------------------------------------------------------------------*/
(0715) /* Change window offset                                                  */
(0716) /*-----------------------------------------------------------------------*/
(0717) 
(0718) static
(0719) FRESULT move_window (
(0720) 	FATFS *fs,		/* File system object */
(0721) 	DWORD sector	/* Sector number to make appearance in the fs->win[] */
(0722) )					/* Move to zero only writes back dirty window */
(0723) {
(0724) 	DWORD wsect;
(0725) 
(0726) 
(0727) 	wsect = fs->winsect;
    0047A 01FA      MOVW	R30,R20
    0047B 96BA      ADIW	R30,0x2A
    0047C 8020      LD	R2,Z
    0047D 8031      LDD	R3,Z+1
    0047E 8042      LDD	R4,Z+2
    0047F 8053      LDD	R5,Z+3
    00480 822D      STD	Y+5,R2
    00481 823E      STD	Y+6,R3
    00482 824F      STD	Y+7,R4
    00483 8658      STD	Y+8,R5
(0728) 	if (wsect != sector) {	/* Changed current window */
    00484 842D      LDD	R2,Y+13
    00485 843E      LDD	R3,Y+14
    00486 844F      LDD	R4,Y+15
    00487 8858      LDD	R5,Y+16
    00488 806D      LDD	R6,Y+5
    00489 807E      LDD	R7,Y+6
    0048A 808F      LDD	R8,Y+7
    0048B 8498      LDD	R9,Y+8
    0048C 1462      CP	R6,R2
    0048D 0473      CPC	R7,R3
    0048E 0484      CPC	R8,R4
    0048F 0495      CPC	R9,R5
    00490 F409      BNE	0x0492
    00491 C07E      RJMP	0x0510
(0729) #if !_FS_READONLY
(0730) 		if (fs->wflag) {	/* Write back dirty window if needed */
    00492 01FA      MOVW	R30,R20
    00493 8024      LDD	R2,Z+4
    00494 2022      TST	R2
    00495 F409      BNE	0x0497
    00496 C055      RJMP	0x04EC
(0731) 			if (disk_write(fs->drv, fs->win, wsect, 1) != RES_OK)
    00497 E081      LDI	R24,1
    00498 838C      STD	Y+4,R24
    00499 0113      MOVW	R2,R6
    0049A 0124      MOVW	R4,R8
    0049B 8228      ST	Y,R2
    0049C 8239      STD	Y+1,R3
    0049D 824A      STD	Y+2,R4
    0049E 825B      STD	Y+3,R5
    0049F 019A      MOVW	R18,R20
    004A0 5D22      SUBI	R18,0xD2
    004A1 4F3F      SBCI	R19,0xFF
    004A2 8101      LDD	R16,Z+1
    004A3 940E 03F9 CALL	_disk_write
    004A5 2300      TST	R16
    004A6 F011      BEQ	0x04A9
(0732) 				return FR_DISK_ERR;
    004A7 E001      LDI	R16,1
    004A8 C068      RJMP	0x0511
(0733) 			fs->wflag = 0;
    004A9 2422      CLR	R2
    004AA 01FA      MOVW	R30,R20
    004AB 8224      STD	Z+4,R2
(0734) 			if (wsect < (fs->fatbase + fs->fsize)) {	/* In FAT area */
    004AC 8C22      LDD	R2,Z+26
    004AD 8C33      LDD	R3,Z+27
    004AE 8C44      LDD	R4,Z+28
    004AF 8C55      LDD	R5,Z+29
    004B0 967E      ADIW	R30,0x1E
    004B1 8060      LD	R6,Z
    004B2 8071      LDD	R7,Z+1
    004B3 8082      LDD	R8,Z+2
    004B4 8093      LDD	R9,Z+3
    004B5 0C62      ADD	R6,R2
    004B6 1C73      ADC	R7,R3
    004B7 1C84      ADC	R8,R4
    004B8 1C95      ADC	R9,R5
    004B9 802D      LDD	R2,Y+5
    004BA 803E      LDD	R3,Y+6
    004BB 804F      LDD	R4,Y+7
    004BC 8458      LDD	R5,Y+8
    004BD 1426      CP	R2,R6
    004BE 0437      CPC	R3,R7
    004BF 0448      CPC	R4,R8
    004C0 0459      CPC	R5,R9
    004C1 F550      BCC	0x04EC
(0735) 				BYTE nf;
(0736) 				for (nf = fs->n_fats; nf > 1; nf--) {	/* Reflect the change to all FAT copies */
    004C2 01FA      MOVW	R30,R20
    004C3 80A3      LDD	R10,Z+3
    004C4 C024      RJMP	0x04E9
(0737) 					wsect += fs->fsize;
    004C5 01FA      MOVW	R30,R20
    004C6 967A      ADIW	R30,0x1A
    004C7 8020      LD	R2,Z
    004C8 8031      LDD	R3,Z+1
    004C9 8042      LDD	R4,Z+2
    004CA 8053      LDD	R5,Z+3
    004CB 806D      LDD	R6,Y+5
    004CC 807E      LDD	R7,Y+6
    004CD 808F      LDD	R8,Y+7
    004CE 8498      LDD	R9,Y+8
    004CF 0C62      ADD	R6,R2
    004D0 1C73      ADC	R7,R3
    004D1 1C84      ADC	R8,R4
    004D2 1C95      ADC	R9,R5
    004D3 826D      STD	Y+5,R6
    004D4 827E      STD	Y+6,R7
    004D5 828F      STD	Y+7,R8
    004D6 8698      STD	Y+8,R9
(0738) 					disk_write(fs->drv, fs->win, wsect, 1);
    004D7 E081      LDI	R24,1
    004D8 838C      STD	Y+4,R24
    004D9 802D      LDD	R2,Y+5
    004DA 803E      LDD	R3,Y+6
    004DB 804F      LDD	R4,Y+7
    004DC 8458      LDD	R5,Y+8
    004DD 8228      ST	Y,R2
    004DE 8239      STD	Y+1,R3
    004DF 824A      STD	Y+2,R4
    004E0 825B      STD	Y+3,R5
    004E1 019A      MOVW	R18,R20
    004E2 5D22      SUBI	R18,0xD2
    004E3 4F3F      SBCI	R19,0xFF
    004E4 01FA      MOVW	R30,R20
    004E5 8101      LDD	R16,Z+1
    004E6 940E 03F9 CALL	_disk_write
    004E8 94AA      DEC	R10
    004E9 E081      LDI	R24,1
    004EA 158A      CP	R24,R10
    004EB F2C8      BCS	0x04C5
(0739) 				}
(0740) 			}
(0741) 		}
(0742) #endif
(0743) 		if (sector) {
    004EC 842D      LDD	R2,Y+13
    004ED 843E      LDD	R3,Y+14
    004EE 844F      LDD	R4,Y+15
    004EF 8858      LDD	R5,Y+16
    004F0 9488      BCLR	0
    004F1 2022      TST	R2
    004F2 0432      CPC	R3,R2
    004F3 0442      CPC	R4,R2
    004F4 0452      CPC	R5,R2
    004F5 F0D1      BEQ	0x0510
(0744) 			if (disk_read(fs->drv, fs->win, sector, 1) != RES_OK)
    004F6 E081      LDI	R24,1
    004F7 838C      STD	Y+4,R24
    004F8 8228      ST	Y,R2
    004F9 8239      STD	Y+1,R3
    004FA 824A      STD	Y+2,R4
    004FB 825B      STD	Y+3,R5
    004FC 019A      MOVW	R18,R20
    004FD 5D22      SUBI	R18,0xD2
    004FE 4F3F      SBCI	R19,0xFF
    004FF 01FA      MOVW	R30,R20
    00500 8101      LDD	R16,Z+1
    00501 940E 03D9 CALL	_disk_read
    00503 2300      TST	R16
    00504 F011      BEQ	0x0507
(0745) 				return FR_DISK_ERR;
    00505 E001      LDI	R16,1
    00506 C00A      RJMP	0x0511
(0746) 			fs->winsect = sector;
    00507 842D      LDD	R2,Y+13
    00508 843E      LDD	R3,Y+14
    00509 844F      LDD	R4,Y+15
    0050A 8858      LDD	R5,Y+16
    0050B 01FA      MOVW	R30,R20
    0050C A622      STD	Z+42,R2
    0050D A633      STD	Z+43,R3
    0050E A644      STD	Z+44,R4
    0050F A655      STD	Z+45,R5
(0747) 		}
(0748) 	}
(0749) 
(0750) 	return FR_OK;
    00510 2700      CLR	R16
    00511 9629      ADIW	R28,0x9
    00512 940E 48D3 CALL	pop_xgset300C
    00514 9622      ADIW	R28,2
    00515 9508      RET
ff.c:sync:
  res                  --> R20
  fs                   --> R22
    00516 940E 48D8 CALL	push_xgsetF000
    00518 01B8      MOVW	R22,R16
    00519 9725      SBIW	R28,5
(0751) }
(0752) 
(0753) 
(0754) 
(0755) 
(0756) /*-----------------------------------------------------------------------*/
(0757) /* Clean-up cached data                                                  */
(0758) /*-----------------------------------------------------------------------*/
(0759) #if !_FS_READONLY
(0760) static
(0761) FRESULT sync (	/* FR_OK: successful, FR_DISK_ERR: failed */
(0762) 	FATFS *fs	/* File system object */
(0763) )
(0764) {
(0765) 	FRESULT res;
(0766) 
(0767) 
(0768) 	res = move_window(fs, 0);
    0051A E080      LDI	R24,0
    0051B E090      LDI	R25,0
    0051C E0A0      LDI	R26,0
    0051D E0B0      LDI	R27,0
    0051E 83A8      ST	Y,R26
    0051F 83B9      STD	Y+1,R27
    00520 019C      MOVW	R18,R24
    00521 018B      MOVW	R16,R22
    00522 DF51      RCALL	ff.c:move_window
    00523 2F40      MOV	R20,R16
(0769) 	if (res == FR_OK) {
    00524 2300      TST	R16
    00525 F009      BEQ	0x0527
    00526 C0C0      RJMP	0x05E7
(0770) 		/* Update FSInfo sector if needed */
(0771) 		if (fs->fs_type == FS_FAT32 && fs->fsi_flag) {
    00527 01FB      MOVW	R30,R22
    00528 8180      LD	R24,Z
    00529 3083      CPI	R24,3
    0052A F009      BEQ	0x052C
    0052B C0AC      RJMP	0x05D8
    0052C 8025      LDD	R2,Z+5
    0052D 2022      TST	R2
    0052E F409      BNE	0x0530
    0052F C0A8      RJMP	0x05D8
(0772) 			fs->winsect = 0;
    00530 96BA      ADIW	R30,0x2A
    00531 E080      LDI	R24,0
    00532 8380      ST	Z,R24
    00533 8381      STD	Z+1,R24
    00534 8382      STD	Z+2,R24
    00535 8383      STD	Z+3,R24
(0773) 			/* Create FSInfo structure */
(0774) 			mem_set(fs->win, 0, 512);
    00536 E080      LDI	R24,0
    00537 E092      LDI	R25,2
    00538 8399      STD	Y+1,R25
    00539 8388      ST	Y,R24
    0053A 2722      CLR	R18
    0053B 2733      CLR	R19
    0053C 018B      MOVW	R16,R22
    0053D 5D02      SUBI	R16,0xD2
    0053E 4F1F      SBCI	R17,0xFF
    0053F DEF1      RCALL	ff.c:mem_set
(0775) 			ST_WORD(fs->win+BS_55AA, 0xAA55);
    00540 E585      LDI	R24,0x55
    00541 01FB      MOVW	R30,R22
    00542 5DE4      SUBI	R30,0xD4
    00543 4FFD      SBCI	R31,0xFD
    00544 8380      ST	Z,R24
    00545 52EC      SUBI	R30,0x2C
    00546 40F2      SBCI	R31,2
    00547 EA8A      LDI	R24,0xAA
    00548 5DE3      SUBI	R30,0xD3
    00549 4FFD      SBCI	R31,0xFD
    0054A 8380      ST	Z,R24
    0054B 52ED      SUBI	R30,0x2D
    0054C 40F2      SBCI	R31,2
(0776) 			ST_DWORD(fs->win+FSI_LeadSig, 0x41615252);
    0054D E582      LDI	R24,0x52
    0054E A786      STD	Z+46,R24
    0054F A787      STD	Z+47,R24
    00550 E681      LDI	R24,0x61
    00551 AB80      STD	Z+48,R24
    00552 E481      LDI	R24,0x41
    00553 AB81      STD	Z+49,R24
(0777) 			ST_DWORD(fs->win+FSI_StrucSig, 0x61417272);
    00554 E782      LDI	R24,0x72
    00555 5EEE      SUBI	R30,0xEE
    00556 4FFD      SBCI	R31,0xFD
    00557 8380      ST	Z,R24
    00558 51E2      SUBI	R30,0x12
    00559 40F2      SBCI	R31,2
    0055A 5EED      SUBI	R30,0xED
    0055B 4FFD      SBCI	R31,0xFD
    0055C 8380      ST	Z,R24
    0055D 51E3      SUBI	R30,0x13
    0055E 40F2      SBCI	R31,2
    0055F E481      LDI	R24,0x41
    00560 5EEC      SUBI	R30,0xEC
    00561 4FFD      SBCI	R31,0xFD
    00562 8380      ST	Z,R24
    00563 51E4      SUBI	R30,0x14
    00564 40F2      SBCI	R31,2
    00565 E681      LDI	R24,0x61
    00566 5EEB      SUBI	R30,0xEB
    00567 4FFD      SBCI	R31,0xFD
    00568 8380      ST	Z,R24
    00569 51E5      SUBI	R30,0x15
    0056A 40F2      SBCI	R31,2
(0778) 			ST_DWORD(fs->win+FSI_Free_Count, fs->free_clust);
    0056B 8426      LDD	R2,Z+14
    0056C 8437      LDD	R3,Z+15
    0056D 8840      LDD	R4,Z+16
    0056E 8851      LDD	R5,Z+17
    0056F 5EEA      SUBI	R30,0xEA
    00570 4FFD      SBCI	R31,0xFD
    00571 8220      ST	Z,R2
    00572 51E6      SUBI	R30,0x16
    00573 40F2      SBCI	R31,2
    00574 8426      LDD	R2,Z+14
    00575 8437      LDD	R3,Z+15
    00576 2C23      MOV	R2,R3
    00577 2433      CLR	R3
    00578 5EE9      SUBI	R30,0xE9
    00579 4FFD      SBCI	R31,0xFD
    0057A 8220      ST	Z,R2
    0057B 51E7      SUBI	R30,0x17
    0057C 40F2      SBCI	R31,2
    0057D 8426      LDD	R2,Z+14
    0057E 8437      LDD	R3,Z+15
    0057F 8840      LDD	R4,Z+16
    00580 8851      LDD	R5,Z+17
    00581 0112      MOVW	R2,R4
    00582 2444      CLR	R4
    00583 2455      CLR	R5
    00584 5EE8      SUBI	R30,0xE8
    00585 4FFD      SBCI	R31,0xFD
    00586 8220      ST	Z,R2
    00587 51E8      SUBI	R30,0x18
    00588 40F2      SBCI	R31,2
    00589 E188      LDI	R24,0x18
    0058A E090      LDI	R25,0
    0058B 8506      LDD	R16,Z+14
    0058C 8517      LDD	R17,Z+15
    0058D 8920      LDD	R18,Z+16
    0058E 8931      LDD	R19,Z+17
    0058F 938A      ST	-Y,R24
    00590 940E 4967 CALL	lsr32
    00592 01FB      MOVW	R30,R22
    00593 5EE7      SUBI	R30,0xE7
    00594 4FFD      SBCI	R31,0xFD
    00595 8300      ST	Z,R16
    00596 51E9      SUBI	R30,0x19
    00597 40F2      SBCI	R31,2
(0779) 			ST_DWORD(fs->win+FSI_Nxt_Free, fs->last_clust);
    00598 8422      LDD	R2,Z+10
    00599 8433      LDD	R3,Z+11
    0059A 8444      LDD	R4,Z+12
    0059B 8455      LDD	R5,Z+13
    0059C 5EE6      SUBI	R30,0xE6
    0059D 4FFD      SBCI	R31,0xFD
    0059E 8220      ST	Z,R2
    0059F 51EA      SUBI	R30,0x1A
    005A0 40F2      SBCI	R31,2
    005A1 8422      LDD	R2,Z+10
    005A2 8433      LDD	R3,Z+11
    005A3 2C23      MOV	R2,R3
    005A4 2433      CLR	R3
    005A5 5EE5      SUBI	R30,0xE5
    005A6 4FFD      SBCI	R31,0xFD
    005A7 8220      ST	Z,R2
    005A8 51EB      SUBI	R30,0x1B
    005A9 40F2      SBCI	R31,2
    005AA 8422      LDD	R2,Z+10
    005AB 8433      LDD	R3,Z+11
    005AC 8444      LDD	R4,Z+12
    005AD 8455      LDD	R5,Z+13
    005AE 0112      MOVW	R2,R4
    005AF 2444      CLR	R4
    005B0 2455      CLR	R5
    005B1 5EE4      SUBI	R30,0xE4
    005B2 4FFD      SBCI	R31,0xFD
    005B3 8220      ST	Z,R2
    005B4 51EC      SUBI	R30,0x1C
    005B5 40F2      SBCI	R31,2
    005B6 E188      LDI	R24,0x18
    005B7 E090      LDI	R25,0
    005B8 8502      LDD	R16,Z+10
    005B9 8513      LDD	R17,Z+11
    005BA 8524      LDD	R18,Z+12
    005BB 8535      LDD	R19,Z+13
    005BC 938A      ST	-Y,R24
    005BD 940E 4967 CALL	lsr32
    005BF 01FB      MOVW	R30,R22
    005C0 5EE3      SUBI	R30,0xE3
    005C1 4FFD      SBCI	R31,0xFD
    005C2 8300      ST	Z,R16
    005C3 51ED      SUBI	R30,0x1D
    005C4 40F2      SBCI	R31,2
(0780) 			/* Write it into the FSInfo sector */
(0781) 			disk_write(fs->drv, fs->win, fs->fsi_sector, 1);
    005C5 E081      LDI	R24,1
    005C6 838C      STD	Y+4,R24
    005C7 8822      LDD	R2,Z+18
    005C8 8833      LDD	R3,Z+19
    005C9 8844      LDD	R4,Z+20
    005CA 8855      LDD	R5,Z+21
    005CB 8228      ST	Y,R2
    005CC 8239      STD	Y+1,R3
    005CD 824A      STD	Y+2,R4
    005CE 825B      STD	Y+3,R5
    005CF 019F      MOVW	R18,R30
    005D0 5D22      SUBI	R18,0xD2
    005D1 4F3F      SBCI	R19,0xFF
    005D2 8101      LDD	R16,Z+1
    005D3 940E 03F9 CALL	_disk_write
(0782) 			fs->fsi_flag = 0;
    005D5 2422      CLR	R2
    005D6 01FB      MOVW	R30,R22
    005D7 8225      STD	Z+5,R2
(0783) 		}
(0784) 		/* Make sure that no pending write process in the physical drive */
(0785) 		if (disk_ioctl(fs->drv, CTRL_SYNC, 0) != RES_OK)
    005D8 2422      CLR	R2
    005D9 2433      CLR	R3
    005DA 8239      STD	Y+1,R3
    005DB 8228      ST	Y,R2
    005DC 2722      CLR	R18
    005DD 2733      CLR	R19
    005DE 01FB      MOVW	R30,R22
    005DF 8101      LDD	R16,Z+1
    005E0 2711      CLR	R17
    005E1 940E 0411 CALL	_disk_ioctl
    005E3 3000      CPI	R16,0
    005E4 0701      CPC	R16,R17
    005E5 F009      BEQ	0x05E7
(0786) 			res = FR_DISK_ERR;
    005E6 E041      LDI	R20,1
(0787) 	}
(0788) 
(0789) 	return res;
    005E7 2F04      MOV	R16,R20
    005E8 9625      ADIW	R28,5
    005E9 940C 48DD JMP	pop_xgsetF000
_clust2sect:
  clst                 --> Y,+6
  fs                   --> R10
    005EB 933A      ST	-Y,R19
    005EC 932A      ST	-Y,R18
    005ED 940E 48E2 CALL	push_xgsetF00C
    005EF 0158      MOVW	R10,R16
(0790) }
(0791) #endif
(0792) 
(0793) 
(0794) 
(0795) 
(0796) /*-----------------------------------------------------------------------*/
(0797) /* Get sector# from cluster#                                             */
(0798) /*-----------------------------------------------------------------------*/
(0799) 
(0800) 
(0801) DWORD clust2sect (	/* !=0: Sector number, 0: Failed - invalid cluster# */
(0802) 	FATFS *fs,		/* File system object */
(0803) 	DWORD clst		/* Cluster# to be converted */
(0804) )
(0805) {
(0806) 	clst -= 2;
    005F0 E042      LDI	R20,2
    005F1 E050      LDI	R21,0
    005F2 E060      LDI	R22,0
    005F3 E070      LDI	R23,0
    005F4 802E      LDD	R2,Y+6
    005F5 803F      LDD	R3,Y+7
    005F6 8448      LDD	R4,Y+8
    005F7 8459      LDD	R5,Y+9
    005F8 1A24      SUB	R2,R20
    005F9 0A35      SBC	R3,R21
    005FA 0A46      SBC	R4,R22
    005FB 0A57      SBC	R5,R23
    005FC 822E      STD	Y+6,R2
    005FD 823F      STD	Y+7,R3
    005FE 8648      STD	Y+8,R4
    005FF 8659      STD	Y+9,R5
(0807) 	if (clst >= (fs->n_fatent - 2)) return 0;		/* Invalid cluster# */
    00600 E042      LDI	R20,2
    00601 E050      LDI	R21,0
    00602 E060      LDI	R22,0
    00603 E070      LDI	R23,0
    00604 01F5      MOVW	R30,R10
    00605 9676      ADIW	R30,0x16
    00606 8020      LD	R2,Z
    00607 8031      LDD	R3,Z+1
    00608 8042      LDD	R4,Z+2
    00609 8053      LDD	R5,Z+3
    0060A 1A24      SUB	R2,R20
    0060B 0A35      SBC	R3,R21
    0060C 0A46      SBC	R4,R22
    0060D 0A57      SBC	R5,R23
    0060E 806E      LDD	R6,Y+6
    0060F 807F      LDD	R7,Y+7
    00610 8488      LDD	R8,Y+8
    00611 8499      LDD	R9,Y+9
    00612 1462      CP	R6,R2
    00613 0473      CPC	R7,R3
    00614 0484      CPC	R8,R4
    00615 0495      CPC	R9,R5
    00616 F028      BCS	0x061C
    00617 E000      LDI	R16,0
    00618 E010      LDI	R17,0
    00619 E020      LDI	R18,0
    0061A E030      LDI	R19,0
    0061B C01D      RJMP	0x0639
(0808) 	return clst * fs->csize + fs->database;
    0061C 01F5      MOVW	R30,R10
    0061D 9632      ADIW	R30,2
    0061E 8020      LD	R2,Z
    0061F 2433      CLR	R3
    00620 2444      CLR	R4
    00621 2455      CLR	R5
    00622 810E      LDD	R16,Y+6
    00623 811F      LDD	R17,Y+7
    00624 8528      LDD	R18,Y+8
    00625 8539      LDD	R19,Y+9
    00626 925A      ST	-Y,R5
    00627 924A      ST	-Y,R4
    00628 923A      ST	-Y,R3
    00629 922A      ST	-Y,R2
    0062A 940E 486F CALL	empy32u|empy32s
    0062C 0118      MOVW	R2,R16
    0062D 0129      MOVW	R4,R18
    0062E 01F5      MOVW	R30,R10
    0062F A066      LDD	R6,Z+38
    00630 A077      LDD	R7,Z+39
    00631 A480      LDD	R8,Z+40
    00632 A491      LDD	R9,Z+41
    00633 0C26      ADD	R2,R6
    00634 1C37      ADC	R3,R7
    00635 1C48      ADC	R4,R8
    00636 1C59      ADC	R5,R9
    00637 0181      MOVW	R16,R2
    00638 0192      MOVW	R18,R4
    00639 940E 48E9 CALL	pop_xgsetF00C
    0063B 9622      ADIW	R28,2
    0063C 9508      RET
_get_fat:
  wc                   --> R14
  p                    --> R10
  bc                   --> R10
  clst                 --> Y,+12
  fs                   --> R12
    0063D 933A      ST	-Y,R19
    0063E 932A      ST	-Y,R18
    0063F 940E 48C3 CALL	push_xgsetF0FC
    00641 0168      MOVW	R12,R16
    00642 9722      SBIW	R28,2
(0809) }
(0810) 
(0811) 
(0812) 
(0813) 
(0814) /*-----------------------------------------------------------------------*/
(0815) /* FAT access - Read value of a FAT entry                                */
(0816) /*-----------------------------------------------------------------------*/
(0817) 
(0818) 
(0819) DWORD get_fat (	/* 0xFFFFFFFF:Disk error, 1:Internal error, Else:Cluster status */
(0820) 	FATFS *fs,	/* File system object */
(0821) 	DWORD clst	/* Cluster# to get the link information */
(0822) )
(0823) {
(0824) 	UINT wc, bc;
(0825) 	BYTE *p;
(0826) 
(0827) 
(0828) 	if (clst < 2 || clst >= fs->n_fatent)	/* Chack range */
    00643 E042      LDI	R20,2
    00644 E050      LDI	R21,0
    00645 E060      LDI	R22,0
    00646 E070      LDI	R23,0
    00647 842C      LDD	R2,Y+12
    00648 843D      LDD	R3,Y+13
    00649 844E      LDD	R4,Y+14
    0064A 845F      LDD	R5,Y+15
    0064B 1624      CP	R2,R20
    0064C 0635      CPC	R3,R21
    0064D 0646      CPC	R4,R22
    0064E 0657      CPC	R5,R23
    0064F F078      BCS	0x065F
    00650 01F6      MOVW	R30,R12
    00651 9676      ADIW	R30,0x16
    00652 8020      LD	R2,Z
    00653 8031      LDD	R3,Z+1
    00654 8042      LDD	R4,Z+2
    00655 8053      LDD	R5,Z+3
    00656 846C      LDD	R6,Y+12
    00657 847D      LDD	R7,Y+13
    00658 848E      LDD	R8,Y+14
    00659 849F      LDD	R9,Y+15
    0065A 1462      CP	R6,R2
    0065B 0473      CPC	R7,R3
    0065C 0484      CPC	R8,R4
    0065D 0495      CPC	R9,R5
    0065E F028      BCS	0x0664
(0829) 		return 1;
    0065F E001      LDI	R16,1
    00660 E010      LDI	R17,0
    00661 E020      LDI	R18,0
    00662 E030      LDI	R19,0
    00663 C124      RJMP	0x0788
(0830) 
(0831) 	switch (fs->fs_type) {
    00664 01F6      MOVW	R30,R12
    00665 80A0      LD	R10,Z
    00666 24BB      CLR	R11
    00667 01C5      MOVW	R24,R10
    00668 3081      CPI	R24,1
    00669 E0E0      LDI	R30,0
    0066A 079E      CPC	R25,R30
    0066B F059      BEQ	0x0677
    0066C 3082      CPI	R24,2
    0066D E0E0      LDI	R30,0
    0066E 079E      CPC	R25,R30
    0066F F409      BNE	0x0671
    00670 C06F      RJMP	0x06E0
    00671 3083      CPI	R24,3
    00672 E0E0      LDI	R30,0
    00673 079E      CPC	R25,R30
    00674 F409      BNE	0x0676
    00675 C0A6      RJMP	0x071C
    00676 C10D      RJMP	0x0784
(0832) 	case FS_FAT12 :
(0833) 		bc = (UINT)clst; bc += bc / 2;
    00677 84AC      LDD	R10,Y+12
    00678 84BD      LDD	R11,Y+13
    00679 0115      MOVW	R2,R10
    0067A 9436      LSR	R3
    0067B 9427      ROR	R2
    0067C 0CA2      ADD	R10,R2
    0067D 1CB3      ADC	R11,R3
(0834) 		if (move_window(fs, fs->fatbase + (bc / SS(fs)))) break;
    0067E E029      LDI	R18,0x9
    0067F E030      LDI	R19,0
    00680 0185      MOVW	R16,R10
    00681 940E 4960 CALL	lsr16
    00683 0118      MOVW	R2,R16
    00684 2444      CLR	R4
    00685 2455      CLR	R5
    00686 01F6      MOVW	R30,R12
    00687 8C66      LDD	R6,Z+30
    00688 8C77      LDD	R7,Z+31
    00689 A080      LDD	R8,Z+32
    0068A A091      LDD	R9,Z+33
    0068B 0C62      ADD	R6,R2
    0068C 1C73      ADC	R7,R3
    0068D 1C84      ADC	R8,R4
    0068E 1C95      ADC	R9,R5
    0068F 8288      ST	Y,R8
    00690 8299      STD	Y+1,R9
    00691 0193      MOVW	R18,R6
    00692 018F      MOVW	R16,R30
    00693 DDE0      RCALL	ff.c:move_window
    00694 2300      TST	R16
    00695 F009      BEQ	0x0697
    00696 C0ED      RJMP	0x0784
(0835) 		wc = fs->win[bc % SS(fs)]; bc++;
    00697 01C6      MOVW	R24,R12
    00698 968E      ADIW	R24,0x2E
    00699 01F5      MOVW	R30,R10
    0069A 70F1      ANDI	R31,1
    0069B 0FE8      ADD	R30,R24
    0069C 1FF9      ADC	R31,R25
    0069D 80E0      LD	R14,Z
    0069E 24FF      CLR	R15
    0069F 01C5      MOVW	R24,R10
    006A0 9601      ADIW	R24,1
    006A1 015C      MOVW	R10,R24
(0836) 		if (move_window(fs, fs->fatbase + (bc / SS(fs)))) break;
    006A2 E029      LDI	R18,0x9
    006A3 E030      LDI	R19,0
    006A4 018C      MOVW	R16,R24
    006A5 940E 4960 CALL	lsr16
    006A7 0118      MOVW	R2,R16
    006A8 2444      CLR	R4
    006A9 2455      CLR	R5
    006AA 01F6      MOVW	R30,R12
    006AB 8C66      LDD	R6,Z+30
    006AC 8C77      LDD	R7,Z+31
    006AD A080      LDD	R8,Z+32
    006AE A091      LDD	R9,Z+33
    006AF 0C62      ADD	R6,R2
    006B0 1C73      ADC	R7,R3
    006B1 1C84      ADC	R8,R4
    006B2 1C95      ADC	R9,R5
    006B3 8288      ST	Y,R8
    006B4 8299      STD	Y+1,R9
    006B5 0193      MOVW	R18,R6
    006B6 018F      MOVW	R16,R30
    006B7 DDBC      RCALL	ff.c:move_window
    006B8 2300      TST	R16
    006B9 F009      BEQ	0x06BB
    006BA C0C9      RJMP	0x0784
(0837) 		wc |= fs->win[bc % SS(fs)] << 8;
    006BB 01C6      MOVW	R24,R12
    006BC 968E      ADIW	R24,0x2E
    006BD 01F5      MOVW	R30,R10
    006BE 70F1      ANDI	R31,1
    006BF 0FE8      ADD	R30,R24
    006C0 1FF9      ADC	R31,R25
    006C1 8020      LD	R2,Z
    006C2 2433      CLR	R3
    006C3 2C32      MOV	R3,R2
    006C4 2422      CLR	R2
    006C5 28E2      OR	R14,R2
    006C6 28F3      OR	R15,R3
(0838) 		return (clst & 1) ? (wc >> 4) : (wc & 0xFFF);
    006C7 842C      LDD	R2,Y+12
    006C8 843D      LDD	R3,Y+13
    006C9 844E      LDD	R4,Y+14
    006CA 845F      LDD	R5,Y+15
    006CB 2DE2      MOV	R30,R2
    006CC 70E1      ANDI	R30,1
    006CD F051      BEQ	0x06D8
    006CE 0157      MOVW	R10,R14
    006CF 94B6      LSR	R11
    006D0 94A7      ROR	R10
    006D1 94B6      LSR	R11
    006D2 94A7      ROR	R10
    006D3 94B6      LSR	R11
    006D4 94A7      ROR	R10
    006D5 94B6      LSR	R11
    006D6 94A7      ROR	R10
    006D7 C003      RJMP	0x06DB
    006D8 01C7      MOVW	R24,R14
    006D9 709F      ANDI	R25,0xF
    006DA 015C      MOVW	R10,R24
    006DB 0185      MOVW	R16,R10
    006DC 0196      MOVW	R18,R12
    006DD 2722      CLR	R18
    006DE 2733      CLR	R19
    006DF C0A8      RJMP	0x0788
(0839) 
(0840) 	case FS_FAT16 :
(0841) 		if (move_window(fs, fs->fatbase + (clst / (SS(fs) / 2)))) break;
    006E0 E088      LDI	R24,0x8
    006E1 E090      LDI	R25,0
    006E2 850C      LDD	R16,Y+12
    006E3 851D      LDD	R17,Y+13
    006E4 852E      LDD	R18,Y+14
    006E5 853F      LDD	R19,Y+15
    006E6 938A      ST	-Y,R24
    006E7 940E 4967 CALL	lsr32
    006E9 01F6      MOVW	R30,R12
    006EA 8C26      LDD	R2,Z+30
    006EB 8C37      LDD	R3,Z+31
    006EC A040      LDD	R4,Z+32
    006ED A051      LDD	R5,Z+33
    006EE 0E20      ADD	R2,R16
    006EF 1E31      ADC	R3,R17
    006F0 1E42      ADC	R4,R18
    006F1 1E53      ADC	R5,R19
    006F2 8248      ST	Y,R4
    006F3 8259      STD	Y+1,R5
    006F4 0191      MOVW	R18,R2
    006F5 018F      MOVW	R16,R30
    006F6 DD7D      RCALL	ff.c:move_window
    006F7 2EA0      MOV	R10,R16
    006F8 2300      TST	R16
    006F9 F009      BEQ	0x06FB
    006FA C089      RJMP	0x0784
(0842) 		p = &fs->win[clst * 2 % SS(fs)];
    006FB EF4F      LDI	R20,0xFF
    006FC E051      LDI	R21,1
    006FD E060      LDI	R22,0
    006FE E070      LDI	R23,0
    006FF 842C      LDD	R2,Y+12
    00700 843D      LDD	R3,Y+13
    00701 844E      LDD	R4,Y+14
    00702 845F      LDD	R5,Y+15
    00703 0C22      LSL	R2
    00704 1C33      ROL	R3
    00705 1C44      ROL	R4
    00706 1C55      ROL	R5
    00707 2224      AND	R2,R20
    00708 2235      AND	R3,R21
    00709 2246      AND	R4,R22
    0070A 2257      AND	R5,R23
    0070B 0151      MOVW	R10,R2
    0070C 01C6      MOVW	R24,R12
    0070D 968E      ADIW	R24,0x2E
    0070E 0EA8      ADD	R10,R24
    0070F 1EB9      ADC	R11,R25
(0843) 		return LD_WORD(p);
    00710 01F5      MOVW	R30,R10
    00711 8020      LD	R2,Z
    00712 2433      CLR	R3
    00713 8101      LDD	R16,Z+1
    00714 2711      CLR	R17
    00715 2F10      MOV	R17,R16
    00716 2700      CLR	R16
    00717 2902      OR	R16,R2
    00718 2913      OR	R17,R3
    00719 2722      CLR	R18
    0071A 2733      CLR	R19
    0071B C06C      RJMP	0x0788
(0844) 
(0845) 	case FS_FAT32 :
(0846) 		if (move_window(fs, fs->fatbase + (clst / (SS(fs) / 4)))) break;
    0071C E087      LDI	R24,7
    0071D E090      LDI	R25,0
    0071E 850C      LDD	R16,Y+12
    0071F 851D      LDD	R17,Y+13
    00720 852E      LDD	R18,Y+14
    00721 853F      LDD	R19,Y+15
    00722 938A      ST	-Y,R24
    00723 940E 4967 CALL	lsr32
    00725 01F6      MOVW	R30,R12
    00726 8C26      LDD	R2,Z+30
    00727 8C37      LDD	R3,Z+31
    00728 A040      LDD	R4,Z+32
    00729 A051      LDD	R5,Z+33
    0072A 0E20      ADD	R2,R16
    0072B 1E31      ADC	R3,R17
    0072C 1E42      ADC	R4,R18
    0072D 1E53      ADC	R5,R19
    0072E 8248      ST	Y,R4
    0072F 8259      STD	Y+1,R5
    00730 0191      MOVW	R18,R2
    00731 018F      MOVW	R16,R30
    00732 DD41      RCALL	ff.c:move_window
    00733 2EE0      MOV	R14,R16
    00734 2300      TST	R16
    00735 F009      BEQ	0x0737
    00736 C04D      RJMP	0x0784
(0847) 		p = &fs->win[clst * 4 % SS(fs)];
    00737 E082      LDI	R24,2
    00738 E090      LDI	R25,0
    00739 850C      LDD	R16,Y+12
    0073A 851D      LDD	R17,Y+13
    0073B 852E      LDD	R18,Y+14
    0073C 853F      LDD	R19,Y+15
    0073D 938A      ST	-Y,R24
    0073E 940E 494E CALL	lsl32
    00740 0118      MOVW	R2,R16
    00741 0129      MOVW	R4,R18
    00742 EF4F      LDI	R20,0xFF
    00743 E051      LDI	R21,1
    00744 E060      LDI	R22,0
    00745 E070      LDI	R23,0
    00746 2224      AND	R2,R20
    00747 2235      AND	R3,R21
    00748 2246      AND	R4,R22
    00749 2257      AND	R5,R23
    0074A 0151      MOVW	R10,R2
    0074B 01C6      MOVW	R24,R12
    0074C 968E      ADIW	R24,0x2E
    0074D 0EA8      ADD	R10,R24
    0074E 1EB9      ADC	R11,R25
(0848) 		return LD_DWORD(p) & 0x0FFFFFFF;
    0074F E188      LDI	R24,0x18
    00750 E090      LDI	R25,0
    00751 01F5      MOVW	R30,R10
    00752 8103      LDD	R16,Z+3
    00753 2711      CLR	R17
    00754 2722      CLR	R18
    00755 2733      CLR	R19
    00756 938A      ST	-Y,R24
    00757 940E 494E CALL	lsl32
    00759 0118      MOVW	R2,R16
    0075A 0129      MOVW	R4,R18
    0075B 01F5      MOVW	R30,R10
    0075C 8062      LDD	R6,Z+2
    0075D 2477      CLR	R7
    0075E 2488      CLR	R8
    0075F 2499      CLR	R9
    00760 0143      MOVW	R8,R6
    00761 2466      CLR	R6
    00762 2477      CLR	R7
    00763 2826      OR	R2,R6
    00764 2837      OR	R3,R7
    00765 2848      OR	R4,R8
    00766 2859      OR	R5,R9
    00767 8061      LDD	R6,Z+1
    00768 2477      CLR	R7
    00769 2C76      MOV	R7,R6
    0076A 2466      CLR	R6
    0076B 2488      CLR	R8
    0076C 2499      CLR	R9
    0076D 2826      OR	R2,R6
    0076E 2837      OR	R3,R7
    0076F 2848      OR	R4,R8
    00770 2859      OR	R5,R9
    00771 8060      LD	R6,Z
    00772 2477      CLR	R7
    00773 2488      CLR	R8
    00774 2499      CLR	R9
    00775 2826      OR	R2,R6
    00776 2837      OR	R3,R7
    00777 2848      OR	R4,R8
    00778 2859      OR	R5,R9
    00779 EF4F      LDI	R20,0xFF
    0077A EF5F      LDI	R21,0xFF
    0077B EF6F      LDI	R22,0xFF
    0077C E07F      LDI	R23,0xF
    0077D 2224      AND	R2,R20
    0077E 2235      AND	R3,R21
    0077F 2246      AND	R4,R22
    00780 2257      AND	R5,R23
    00781 0181      MOVW	R16,R2
    00782 0192      MOVW	R18,R4
    00783 C004      RJMP	0x0788
(0849) 	}
(0850) 
(0851) 	return 0xFFFFFFFF;	/* An error occurred at the disk I/O layer */
    00784 EF0F      LDI	R16,0xFF
    00785 EF1F      LDI	R17,0xFF
    00786 EF2F      LDI	R18,0xFF
    00787 EF3F      LDI	R19,0xFF
    00788 9622      ADIW	R28,2
    00789 940E 48B8 CALL	pop_xgsetF0FC
    0078B 9622      ADIW	R28,2
    0078C 9508      RET
_put_fat:
  bc                   --> R12
  p                    --> R14
  res                  --> Y,+2
  val                  --> Y,+19
  clst                 --> Y,+15
  fs                   --> Y,+13
    0078D 940E 477E CALL	push_arg4
    0078F 940E 48C3 CALL	push_xgsetF0FC
    00791 9723      SBIW	R28,3
(0852) }
(0853) 
(0854) 
(0855) 
(0856) 
(0857) /*-----------------------------------------------------------------------*/
(0858) /* FAT access - Change value of a FAT entry                              */
(0859) /*-----------------------------------------------------------------------*/
(0860) #if !_FS_READONLY
(0861) 
(0862) FRESULT put_fat (
(0863) 	FATFS *fs,	/* File system object */
(0864) 	DWORD clst,	/* Cluster# to be changed in range of 2 to fs->n_fatent - 1 */
(0865) 	DWORD val	/* New value to mark the cluster */
(0866) )
(0867) {
(0868) 	UINT bc;
(0869) 	BYTE *p;
(0870) 	FRESULT res;
(0871) 
(0872) 
(0873) 	if (clst < 2 || clst >= fs->n_fatent) {	/* Check range */
    00792 E042      LDI	R20,2
    00793 E050      LDI	R21,0
    00794 E060      LDI	R22,0
    00795 E070      LDI	R23,0
    00796 842F      LDD	R2,Y+15
    00797 8838      LDD	R3,Y+16
    00798 8849      LDD	R4,Y+17
    00799 885A      LDD	R5,Y+18
    0079A 1624      CP	R2,R20
    0079B 0635      CPC	R3,R21
    0079C 0646      CPC	R4,R22
    0079D 0657      CPC	R5,R23
    0079E F080      BCS	0x07AF
    0079F 85ED      LDD	R30,Y+13
    007A0 85FE      LDD	R31,Y+14
    007A1 9676      ADIW	R30,0x16
    007A2 8020      LD	R2,Z
    007A3 8031      LDD	R3,Z+1
    007A4 8042      LDD	R4,Z+2
    007A5 8053      LDD	R5,Z+3
    007A6 846F      LDD	R6,Y+15
    007A7 8878      LDD	R7,Y+16
    007A8 8889      LDD	R8,Y+17
    007A9 889A      LDD	R9,Y+18
    007AA 1462      CP	R6,R2
    007AB 0473      CPC	R7,R3
    007AC 0484      CPC	R8,R4
    007AD 0495      CPC	R9,R5
    007AE F018      BCS	0x07B2
(0874) 		res = FR_INT_ERR;
    007AF E082      LDI	R24,2
    007B0 838A      STD	Y+2,R24
(0875) 
(0876) 	} else {
    007B1 C194      RJMP	0x0946
(0877) 		switch (fs->fs_type) {
    007B2 85ED      LDD	R30,Y+13
    007B3 85FE      LDD	R31,Y+14
    007B4 80A0      LD	R10,Z
    007B5 24BB      CLR	R11
    007B6 01C5      MOVW	R24,R10
    007B7 3081      CPI	R24,1
    007B8 E0E0      LDI	R30,0
    007B9 079E      CPC	R25,R30
    007BA F059      BEQ	0x07C6
    007BB 3082      CPI	R24,2
    007BC E0E0      LDI	R30,0
    007BD 079E      CPC	R25,R30
    007BE F409      BNE	0x07C0
    007BF C0B0      RJMP	0x0870
    007C0 3083      CPI	R24,3
    007C1 E0E0      LDI	R30,0
    007C2 079E      CPC	R25,R30
    007C3 F409      BNE	0x07C5
    007C4 C0E7      RJMP	0x08AC
    007C5 C17A      RJMP	0x0940
(0878) 		case FS_FAT12 :
(0879) 			bc = clst; bc += bc / 2;
    007C6 84CF      LDD	R12,Y+15
    007C7 88D8      LDD	R13,Y+16
    007C8 0116      MOVW	R2,R12
    007C9 9436      LSR	R3
    007CA 9427      ROR	R2
    007CB 0CC2      ADD	R12,R2
    007CC 1CD3      ADC	R13,R3
(0880) 			res = move_window(fs, fs->fatbase + (bc / SS(fs)));
    007CD E029      LDI	R18,0x9
    007CE E030      LDI	R19,0
    007CF 0186      MOVW	R16,R12
    007D0 940E 4960 CALL	lsr16
    007D2 0118      MOVW	R2,R16
    007D3 2444      CLR	R4
    007D4 2455      CLR	R5
    007D5 85ED      LDD	R30,Y+13
    007D6 85FE      LDD	R31,Y+14
    007D7 8C66      LDD	R6,Z+30
    007D8 8C77      LDD	R7,Z+31
    007D9 A080      LDD	R8,Z+32
    007DA A091      LDD	R9,Z+33
    007DB 0C62      ADD	R6,R2
    007DC 1C73      ADC	R7,R3
    007DD 1C84      ADC	R8,R4
    007DE 1C95      ADC	R9,R5
    007DF 8288      ST	Y,R8
    007E0 8299      STD	Y+1,R9
    007E1 0193      MOVW	R18,R6
    007E2 018F      MOVW	R16,R30
    007E3 DC90      RCALL	ff.c:move_window
    007E4 830A      STD	Y+2,R16
(0881) 			if (res != FR_OK) break;
    007E5 2E00      MOV	R0,R16
    007E6 2300      TST	R16
    007E7 F009      BEQ	0x07E9
    007E8 C159      RJMP	0x0942
(0882) 			p = &fs->win[bc % SS(fs)];
    007E9 858D      LDD	R24,Y+13
    007EA 859E      LDD	R25,Y+14
    007EB 968E      ADIW	R24,0x2E
    007EC 01F6      MOVW	R30,R12
    007ED 70F1      ANDI	R31,1
    007EE 017F      MOVW	R14,R30
    007EF 0EE8      ADD	R14,R24
    007F0 1EF9      ADC	R15,R25
(0883) 			*p = (clst & 1) ? ((*p & 0x0F) | ((BYTE)val << 4)) : (BYTE)val;
    007F1 842F      LDD	R2,Y+15
    007F2 8838      LDD	R3,Y+16
    007F3 8849      LDD	R4,Y+17
    007F4 885A      LDD	R5,Y+18
    007F5 93EF      PUSH	R30
    007F6 2DE2      MOV	R30,R2
    007F7 70E1      ANDI	R30,1
    007F8 91EF      POP	R30
    007F9 F0B1      BEQ	0x0810
    007FA 882B      LDD	R2,Y+19
    007FB 883C      LDD	R3,Y+20
    007FC 884D      LDD	R4,Y+21
    007FD 885E      LDD	R5,Y+22
    007FE 2433      CLR	R3
    007FF 0C22      LSL	R2
    00800 1C33      ROL	R3
    00801 0C22      LSL	R2
    00802 1C33      ROL	R3
    00803 0C22      LSL	R2
    00804 1C33      ROL	R3
    00805 0C22      LSL	R2
    00806 1C33      ROL	R3
    00807 01F7      MOVW	R30,R14
    00808 8180      LD	R24,Z
    00809 2799      CLR	R25
    0080A 708F      ANDI	R24,0xF
    0080B 7090      ANDI	R25,0
    0080C 015C      MOVW	R10,R24
    0080D 28A2      OR	R10,R2
    0080E 28B3      OR	R11,R3
    0080F C006      RJMP	0x0816
    00810 882B      LDD	R2,Y+19
    00811 883C      LDD	R3,Y+20
    00812 884D      LDD	R4,Y+21
    00813 885E      LDD	R5,Y+22
    00814 2CA2      MOV	R10,R2
    00815 24BB      CLR	R11
    00816 01F7      MOVW	R30,R14
    00817 82A0      ST	Z,R10
(0884) 			bc++;
    00818 01C6      MOVW	R24,R12
    00819 9601      ADIW	R24,1
    0081A 016C      MOVW	R12,R24
(0885) 			fs->wflag = 1;
    0081B E081      LDI	R24,1
    0081C 85ED      LDD	R30,Y+13
    0081D 85FE      LDD	R31,Y+14
    0081E 8384      STD	Z+4,R24
(0886) 			res = move_window(fs, fs->fatbase + (bc / SS(fs)));
    0081F E029      LDI	R18,0x9
    00820 E030      LDI	R19,0
    00821 0186      MOVW	R16,R12
    00822 940E 4960 CALL	lsr16
    00824 0118      MOVW	R2,R16
    00825 2444      CLR	R4
    00826 2455      CLR	R5
    00827 85ED      LDD	R30,Y+13
    00828 85FE      LDD	R31,Y+14
    00829 8C66      LDD	R6,Z+30
    0082A 8C77      LDD	R7,Z+31
    0082B A080      LDD	R8,Z+32
    0082C A091      LDD	R9,Z+33
    0082D 0C62      ADD	R6,R2
    0082E 1C73      ADC	R7,R3
    0082F 1C84      ADC	R8,R4
    00830 1C95      ADC	R9,R5
    00831 8288      ST	Y,R8
    00832 8299      STD	Y+1,R9
    00833 0193      MOVW	R18,R6
    00834 018F      MOVW	R16,R30
    00835 DC3E      RCALL	ff.c:move_window
    00836 830A      STD	Y+2,R16
(0887) 			if (res != FR_OK) break;
    00837 2E00      MOV	R0,R16
    00838 2300      TST	R16
    00839 F009      BEQ	0x083B
    0083A C107      RJMP	0x0942
(0888) 			p = &fs->win[bc % SS(fs)];
    0083B 858D      LDD	R24,Y+13
    0083C 859E      LDD	R25,Y+14
    0083D 968E      ADIW	R24,0x2E
    0083E 01F6      MOVW	R30,R12
    0083F 70F1      ANDI	R31,1
    00840 017F      MOVW	R14,R30
    00841 0EE8      ADD	R14,R24
    00842 1EF9      ADC	R15,R25
(0889) 			*p = (clst & 1) ? (BYTE)(val >> 4) : ((*p & 0xF0) | ((BYTE)(val >> 8) & 0x0F));
    00843 842F      LDD	R2,Y+15
    00844 8838      LDD	R3,Y+16
    00845 8849      LDD	R4,Y+17
    00846 885A      LDD	R5,Y+18
    00847 93EF      PUSH	R30
    00848 2DE2      MOV	R30,R2
    00849 70E1      ANDI	R30,1
    0084A 91EF      POP	R30
    0084B F061      BEQ	0x0858
    0084C E084      LDI	R24,4
    0084D E090      LDI	R25,0
    0084E 890B      LDD	R16,Y+19
    0084F 891C      LDD	R17,Y+20
    00850 892D      LDD	R18,Y+21
    00851 893E      LDD	R19,Y+22
    00852 938A      ST	-Y,R24
    00853 940E 4967 CALL	lsr32
    00855 2EC0      MOV	R12,R16
    00856 24DD      CLR	R13
    00857 C015      RJMP	0x086D
    00858 E088      LDI	R24,0x8
    00859 E090      LDI	R25,0
    0085A 890B      LDD	R16,Y+19
    0085B 891C      LDD	R17,Y+20
    0085C 892D      LDD	R18,Y+21
    0085D 893E      LDD	R19,Y+22
    0085E 938A      ST	-Y,R24
    0085F 940E 4967 CALL	lsr32
    00861 2F80      MOV	R24,R16
    00862 2799      CLR	R25
    00863 708F      ANDI	R24,0xF
    00864 7090      ANDI	R25,0
    00865 01F7      MOVW	R30,R14
    00866 81E0      LD	R30,Z
    00867 27FF      CLR	R31
    00868 7FE0      ANDI	R30,0xF0
    00869 70F0      ANDI	R31,0
    0086A 016F      MOVW	R12,R30
    0086B 2AC8      OR	R12,R24
    0086C 2AD9      OR	R13,R25
    0086D 01F7      MOVW	R30,R14
    0086E 82C0      ST	Z,R12
(0890) 			break;
    0086F C0D2      RJMP	0x0942
(0891) 
(0892) 		case FS_FAT16 :
(0893) 			res = move_window(fs, fs->fatbase + (clst / (SS(fs) / 2)));
    00870 E088      LDI	R24,0x8
    00871 E090      LDI	R25,0
    00872 850F      LDD	R16,Y+15
    00873 8918      LDD	R17,Y+16
    00874 8929      LDD	R18,Y+17
    00875 893A      LDD	R19,Y+18
    00876 938A      ST	-Y,R24
    00877 940E 4967 CALL	lsr32
    00879 85ED      LDD	R30,Y+13
    0087A 85FE      LDD	R31,Y+14
    0087B 8C26      LDD	R2,Z+30
    0087C 8C37      LDD	R3,Z+31
    0087D A040      LDD	R4,Z+32
    0087E A051      LDD	R5,Z+33
    0087F 0E20      ADD	R2,R16
    00880 1E31      ADC	R3,R17
    00881 1E42      ADC	R4,R18
    00882 1E53      ADC	R5,R19
    00883 8248      ST	Y,R4
    00884 8259      STD	Y+1,R5
    00885 0191      MOVW	R18,R2
    00886 018F      MOVW	R16,R30
    00887 DBEC      RCALL	ff.c:move_window
    00888 2EC0      MOV	R12,R16
    00889 82CA      STD	Y+2,R12
(0894) 			if (res != FR_OK) break;
    0088A 2C0C      MOV	R0,R12
    0088B 2300      TST	R16
    0088C F009      BEQ	0x088E
    0088D C0B4      RJMP	0x0942
(0895) 			p = &fs->win[clst * 2 % SS(fs)];
    0088E EF4F      LDI	R20,0xFF
    0088F E051      LDI	R21,1
    00890 E060      LDI	R22,0
    00891 E070      LDI	R23,0
    00892 842F      LDD	R2,Y+15
    00893 8838      LDD	R3,Y+16
    00894 8849      LDD	R4,Y+17
    00895 885A      LDD	R5,Y+18
    00896 0C22      LSL	R2
    00897 1C33      ROL	R3
    00898 1C44      ROL	R4
    00899 1C55      ROL	R5
    0089A 2224      AND	R2,R20
    0089B 2235      AND	R3,R21
    0089C 2246      AND	R4,R22
    0089D 2257      AND	R5,R23
    0089E 0171      MOVW	R14,R2
    0089F 858D      LDD	R24,Y+13
    008A0 859E      LDD	R25,Y+14
    008A1 968E      ADIW	R24,0x2E
    008A2 0EE8      ADD	R14,R24
    008A3 1EF9      ADC	R15,R25
(0896) 			ST_WORD(p, (WORD)val);
    008A4 882B      LDD	R2,Y+19
    008A5 883C      LDD	R3,Y+20
    008A6 01F7      MOVW	R30,R14
    008A7 8220      ST	Z,R2
    008A8 2C23      MOV	R2,R3
    008A9 2433      CLR	R3
    008AA 8221      STD	Z+1,R2
(0897) 			break;
    008AB C096      RJMP	0x0942
(0898) 
(0899) 		case FS_FAT32 :
(0900) 			res = move_window(fs, fs->fatbase + (clst / (SS(fs) / 4)));
    008AC E087      LDI	R24,7
    008AD E090      LDI	R25,0
    008AE 850F      LDD	R16,Y+15
    008AF 8918      LDD	R17,Y+16
    008B0 8929      LDD	R18,Y+17
    008B1 893A      LDD	R19,Y+18
    008B2 938A      ST	-Y,R24
    008B3 940E 4967 CALL	lsr32
    008B5 85ED      LDD	R30,Y+13
    008B6 85FE      LDD	R31,Y+14
    008B7 8C26      LDD	R2,Z+30
    008B8 8C37      LDD	R3,Z+31
    008B9 A040      LDD	R4,Z+32
    008BA A051      LDD	R5,Z+33
    008BB 0E20      ADD	R2,R16
    008BC 1E31      ADC	R3,R17
    008BD 1E42      ADC	R4,R18
    008BE 1E53      ADC	R5,R19
    008BF 8248      ST	Y,R4
    008C0 8259      STD	Y+1,R5
    008C1 0191      MOVW	R18,R2
    008C2 018F      MOVW	R16,R30
    008C3 DBB0      RCALL	ff.c:move_window
    008C4 2EC0      MOV	R12,R16
    008C5 82CA      STD	Y+2,R12
(0901) 			if (res != FR_OK) break;
    008C6 2C0C      MOV	R0,R12
    008C7 2300      TST	R16
    008C8 F009      BEQ	0x08CA
    008C9 C078      RJMP	0x0942
(0902) 			p = &fs->win[clst * 4 % SS(fs)];
    008CA E082      LDI	R24,2
    008CB E090      LDI	R25,0
    008CC 850F      LDD	R16,Y+15
    008CD 8918      LDD	R17,Y+16
    008CE 8929      LDD	R18,Y+17
    008CF 893A      LDD	R19,Y+18
    008D0 938A      ST	-Y,R24
    008D1 940E 494E CALL	lsl32
    008D3 0118      MOVW	R2,R16
    008D4 0129      MOVW	R4,R18
    008D5 EF4F      LDI	R20,0xFF
    008D6 E051      LDI	R21,1
    008D7 E060      LDI	R22,0
    008D8 E070      LDI	R23,0
    008D9 2224      AND	R2,R20
    008DA 2235      AND	R3,R21
    008DB 2246      AND	R4,R22
    008DC 2257      AND	R5,R23
    008DD 0171      MOVW	R14,R2
    008DE 858D      LDD	R24,Y+13
    008DF 859E      LDD	R25,Y+14
    008E0 968E      ADIW	R24,0x2E
    008E1 0EE8      ADD	R14,R24
    008E2 1EF9      ADC	R15,R25
(0903) 			val |= LD_DWORD(p) & 0xF0000000;
    008E3 E188      LDI	R24,0x18
    008E4 E090      LDI	R25,0
    008E5 01F7      MOVW	R30,R14
    008E6 8103      LDD	R16,Z+3
    008E7 2711      CLR	R17
    008E8 2722      CLR	R18
    008E9 2733      CLR	R19
    008EA 938A      ST	-Y,R24
    008EB 940E 494E CALL	lsl32
    008ED 0118      MOVW	R2,R16
    008EE 0129      MOVW	R4,R18
    008EF 01F7      MOVW	R30,R14
    008F0 8062      LDD	R6,Z+2
    008F1 2477      CLR	R7
    008F2 2488      CLR	R8
    008F3 2499      CLR	R9
    008F4 0143      MOVW	R8,R6
    008F5 2466      CLR	R6
    008F6 2477      CLR	R7
    008F7 2826      OR	R2,R6
    008F8 2837      OR	R3,R7
    008F9 2848      OR	R4,R8
    008FA 2859      OR	R5,R9
    008FB 8061      LDD	R6,Z+1
    008FC 2477      CLR	R7
    008FD 2C76      MOV	R7,R6
    008FE 2466      CLR	R6
    008FF 2488      CLR	R8
    00900 2499      CLR	R9
    00901 2826      OR	R2,R6
    00902 2837      OR	R3,R7
    00903 2848      OR	R4,R8
    00904 2859      OR	R5,R9
    00905 8060      LD	R6,Z
    00906 2477      CLR	R7
    00907 2488      CLR	R8
    00908 2499      CLR	R9
    00909 2826      OR	R2,R6
    0090A 2837      OR	R3,R7
    0090B 2848      OR	R4,R8
    0090C 2859      OR	R5,R9
    0090D E040      LDI	R20,0
    0090E E050      LDI	R21,0
    0090F E060      LDI	R22,0
    00910 EF70      LDI	R23,0xF0
    00911 2224      AND	R2,R20
    00912 2235      AND	R3,R21
    00913 2246      AND	R4,R22
    00914 2257      AND	R5,R23
    00915 886B      LDD	R6,Y+19
    00916 887C      LDD	R7,Y+20
    00917 888D      LDD	R8,Y+21
    00918 889E      LDD	R9,Y+22
    00919 2862      OR	R6,R2
    0091A 2873      OR	R7,R3
    0091B 2884      OR	R8,R4
    0091C 2895      OR	R9,R5
    0091D 8A6B      STD	Y+19,R6
    0091E 8A7C      STD	Y+20,R7
    0091F 8A8D      STD	Y+21,R8
    00920 8A9E      STD	Y+22,R9
(0904) 			ST_DWORD(p, val);
    00921 882B      LDD	R2,Y+19
    00922 883C      LDD	R3,Y+20
    00923 884D      LDD	R4,Y+21
    00924 885E      LDD	R5,Y+22
    00925 8220      ST	Z,R2
    00926 2C23      MOV	R2,R3
    00927 2433      CLR	R3
    00928 9631      ADIW	R30,1
    00929 8220      ST	Z,R2
    0092A 882B      LDD	R2,Y+19
    0092B 883C      LDD	R3,Y+20
    0092C 884D      LDD	R4,Y+21
    0092D 885E      LDD	R5,Y+22
    0092E 0112      MOVW	R2,R4
    0092F 2444      CLR	R4
    00930 2455      CLR	R5
    00931 01F7      MOVW	R30,R14
    00932 9632      ADIW	R30,2
    00933 8220      ST	Z,R2
    00934 E188      LDI	R24,0x18
    00935 E090      LDI	R25,0
    00936 890B      LDD	R16,Y+19
    00937 891C      LDD	R17,Y+20
    00938 892D      LDD	R18,Y+21
    00939 893E      LDD	R19,Y+22
    0093A 938A      ST	-Y,R24
    0093B 940E 4967 CALL	lsr32
    0093D 01F7      MOVW	R30,R14
    0093E 8303      STD	Z+3,R16
(0905) 			break;
    0093F C002      RJMP	0x0942
(0906) 
(0907) 		default :
(0908) 			res = FR_INT_ERR;
    00940 E082      LDI	R24,2
    00941 838A      STD	Y+2,R24
(0909) 		}
(0910) 		fs->wflag = 1;
    00942 E081      LDI	R24,1
    00943 85ED      LDD	R30,Y+13
    00944 85FE      LDD	R31,Y+14
    00945 8384      STD	Z+4,R24
(0911) 	}
(0912) 
(0913) 	return res;
    00946 810A      LDD	R16,Y+2
    00947 9623      ADIW	R28,3
    00948 940E 48B8 CALL	pop_xgsetF0FC
    0094A 9624      ADIW	R28,4
    0094B 9508      RET
ff.c:remove_chain:
  res                  --> R10
  nxt                  --> Y,+6
  clst                 --> Y,+18
  fs                   --> R12
    0094C 933A      ST	-Y,R19
    0094D 932A      ST	-Y,R18
    0094E 940E 48FE CALL	push_xgsetF03C
    00950 0168      MOVW	R12,R16
    00951 972A      SBIW	R28,0xA
(0914) }
(0915) #endif /* !_FS_READONLY */
(0916) 
(0917) 
(0918) 
(0919) 
(0920) /*-----------------------------------------------------------------------*/
(0921) /* FAT handling - Remove a cluster chain                                 */
(0922) /*-----------------------------------------------------------------------*/
(0923) #if !_FS_READONLY
(0924) static
(0925) FRESULT remove_chain (
(0926) 	FATFS *fs,			/* File system object */
(0927) 	DWORD clst			/* Cluster# to remove a chain from */
(0928) )
(0929) {
(0930) 	FRESULT res;
(0931) 	DWORD nxt;
(0932) #if _USE_ERASE
(0933) 	DWORD scl = clst, ecl = clst, resion[2];
(0934) #endif
(0935) 
(0936) 	if (clst < 2 || clst >= fs->n_fatent) {	/* Check range */
    00952 E042      LDI	R20,2
    00953 E050      LDI	R21,0
    00954 E060      LDI	R22,0
    00955 E070      LDI	R23,0
    00956 882A      LDD	R2,Y+18
    00957 883B      LDD	R3,Y+19
    00958 884C      LDD	R4,Y+20
    00959 885D      LDD	R5,Y+21
    0095A 1624      CP	R2,R20
    0095B 0635      CPC	R3,R21
    0095C 0646      CPC	R4,R22
    0095D 0657      CPC	R5,R23
    0095E F078      BCS	0x096E
    0095F 01F6      MOVW	R30,R12
    00960 9676      ADIW	R30,0x16
    00961 8020      LD	R2,Z
    00962 8031      LDD	R3,Z+1
    00963 8042      LDD	R4,Z+2
    00964 8053      LDD	R5,Z+3
    00965 886A      LDD	R6,Y+18
    00966 887B      LDD	R7,Y+19
    00967 888C      LDD	R8,Y+20
    00968 889D      LDD	R9,Y+21
    00969 1462      CP	R6,R2
    0096A 0473      CPC	R7,R3
    0096B 0484      CPC	R8,R4
    0096C 0495      CPC	R9,R5
    0096D F018      BCS	0x0971
(0937) 		res = FR_INT_ERR;
    0096E E082      LDI	R24,2
    0096F 2EA8      MOV	R10,R24
(0938) 
(0939) 	} else {
    00970 C088      RJMP	0x09F9
(0940) 		res = FR_OK;
    00971 24AA      CLR	R10
    00972 C076      RJMP	0x09E9
(0941) 		while (clst < fs->n_fatent) {			/* Not a last link? */
(0942) 			nxt = get_fat(fs, clst);			/* Get cluster status */
    00973 882A      LDD	R2,Y+18
    00974 883B      LDD	R3,Y+19
    00975 884C      LDD	R4,Y+20
    00976 885D      LDD	R5,Y+21
    00977 8248      ST	Y,R4
    00978 8259      STD	Y+1,R5
    00979 0191      MOVW	R18,R2
    0097A 0186      MOVW	R16,R12
    0097B DCC1      RCALL	_get_fat
    0097C 830E      STD	Y+6,R16
    0097D 831F      STD	Y+7,R17
    0097E 8728      STD	Y+8,R18
    0097F 8739      STD	Y+9,R19
(0943) 			if (nxt == 0) break;				/* Empty cluster? */
    00980 802E      LDD	R2,Y+6
    00981 803F      LDD	R3,Y+7
    00982 8448      LDD	R4,Y+8
    00983 8459      LDD	R5,Y+9
    00984 9488      BCLR	0
    00985 2022      TST	R2
    00986 0432      CPC	R3,R2
    00987 0442      CPC	R4,R2
    00988 0452      CPC	R5,R2
    00989 F409      BNE	0x098B
    0098A C06E      RJMP	0x09F9
(0944) 			if (nxt == 1) { res = FR_INT_ERR; break; }	/* Internal error? */
    0098B E041      LDI	R20,1
    0098C E050      LDI	R21,0
    0098D E060      LDI	R22,0
    0098E E070      LDI	R23,0
    0098F 802E      LDD	R2,Y+6
    00990 803F      LDD	R3,Y+7
    00991 8448      LDD	R4,Y+8
    00992 8459      LDD	R5,Y+9
    00993 1624      CP	R2,R20
    00994 0635      CPC	R3,R21
    00995 0646      CPC	R4,R22
    00996 0657      CPC	R5,R23
    00997 F419      BNE	0x099B
    00998 E082      LDI	R24,2
    00999 2EA8      MOV	R10,R24
    0099A C05E      RJMP	0x09F9
(0945) 			if (nxt == 0xFFFFFFFF) { res = FR_DISK_ERR; break; }	/* Disk error? */
    0099B EF4F      LDI	R20,0xFF
    0099C EF5F      LDI	R21,0xFF
    0099D EF6F      LDI	R22,0xFF
    0099E EF7F      LDI	R23,0xFF
    0099F 802E      LDD	R2,Y+6
    009A0 803F      LDD	R3,Y+7
    009A1 8448      LDD	R4,Y+8
    009A2 8459      LDD	R5,Y+9
    009A3 1624      CP	R2,R20
    009A4 0635      CPC	R3,R21
    009A5 0646      CPC	R4,R22
    009A6 0657      CPC	R5,R23
    009A7 F419      BNE	0x09AB
    009A8 24AA      CLR	R10
    009A9 94A3      INC	R10
    009AA C04E      RJMP	0x09F9
(0946) 			res = put_fat(fs, clst, 0);			/* Mark the cluster "empty" */
    009AB E080      LDI	R24,0
    009AC 838A      STD	Y+2,R24
    009AD 838B      STD	Y+3,R24
    009AE 838C      STD	Y+4,R24
    009AF 838D      STD	Y+5,R24
    009B0 882A      LDD	R2,Y+18
    009B1 883B      LDD	R3,Y+19
    009B2 884C      LDD	R4,Y+20
    009B3 885D      LDD	R5,Y+21
    009B4 8248      ST	Y,R4
    009B5 8259      STD	Y+1,R5
    009B6 0191      MOVW	R18,R2
    009B7 0186      MOVW	R16,R12
    009B8 DDD4      RCALL	_put_fat
    009B9 2EA0      MOV	R10,R16
(0947) 			if (res != FR_OK) break;
    009BA 2300      TST	R16
    009BB F009      BEQ	0x09BD
    009BC C03C      RJMP	0x09F9
(0948) 			if (fs->free_clust != 0xFFFFFFFF) {	/* Update FSInfo */
    009BD EF4F      LDI	R20,0xFF
    009BE EF5F      LDI	R21,0xFF
    009BF EF6F      LDI	R22,0xFF
    009C0 EF7F      LDI	R23,0xFF
    009C1 01F6      MOVW	R30,R12
    009C2 8426      LDD	R2,Z+14
    009C3 8437      LDD	R3,Z+15
    009C4 8840      LDD	R4,Z+16
    009C5 8851      LDD	R5,Z+17
    009C6 1624      CP	R2,R20
    009C7 0635      CPC	R3,R21
    009C8 0646      CPC	R4,R22
    009C9 0657      CPC	R5,R23
    009CA F0B1      BEQ	0x09E1
(0949) 				fs->free_clust++;
    009CB 01CF      MOVW	R24,R30
    009CC 960E      ADIW	R24,0xE
    009CD E041      LDI	R20,1
    009CE E050      LDI	R21,0
    009CF E060      LDI	R22,0
    009D0 E070      LDI	R23,0
    009D1 01FC      MOVW	R30,R24
    009D2 8020      LD	R2,Z
    009D3 8031      LDD	R3,Z+1
    009D4 8042      LDD	R4,Z+2
    009D5 8053      LDD	R5,Z+3
    009D6 0E24      ADD	R2,R20
    009D7 1E35      ADC	R3,R21
    009D8 1E46      ADC	R4,R22
    009D9 1E57      ADC	R5,R23
    009DA 8220      ST	Z,R2
    009DB 8231      STD	Z+1,R3
    009DC 8242      STD	Z+2,R4
    009DD 8253      STD	Z+3,R5
(0950) 				fs->fsi_flag = 1;
    009DE E081      LDI	R24,1
    009DF 01F6      MOVW	R30,R12
    009E0 8385      STD	Z+5,R24
(0951) 			}
(0952) #if _USE_ERASE
(0953) 			if (ecl + 1 == nxt) {	/* Next cluster is contiguous */
(0954) 				ecl = nxt;
(0955) 			} else {				/* End of contiguous clusters */ 
(0956) 				resion[0] = clust2sect(fs, scl);					/* Start sector */
(0957) 				resion[1] = clust2sect(fs, ecl) + fs->csize - 1;	/* End sector */
(0958) 				disk_ioctl(fs->drv, CTRL_ERASE_SECTOR, resion);		/* Erase the block */
(0959) 				scl = ecl = nxt;
(0960) 			}
(0961) #endif
(0962) 			clst = nxt;	/* Next cluster */
    009E1 802E      LDD	R2,Y+6
    009E2 803F      LDD	R3,Y+7
    009E3 8448      LDD	R4,Y+8
    009E4 8459      LDD	R5,Y+9
    009E5 8A2A      STD	Y+18,R2
    009E6 8A3B      STD	Y+19,R3
    009E7 8A4C      STD	Y+20,R4
    009E8 8A5D      STD	Y+21,R5
    009E9 01F6      MOVW	R30,R12
    009EA 9676      ADIW	R30,0x16
    009EB 8020      LD	R2,Z
    009EC 8031      LDD	R3,Z+1
    009ED 8042      LDD	R4,Z+2
    009EE 8053      LDD	R5,Z+3
    009EF 886A      LDD	R6,Y+18
    009F0 887B      LDD	R7,Y+19
    009F1 888C      LDD	R8,Y+20
    009F2 889D      LDD	R9,Y+21
    009F3 1462      CP	R6,R2
    009F4 0473      CPC	R7,R3
    009F5 0484      CPC	R8,R4
    009F6 0495      CPC	R9,R5
    009F7 F408      BCC	0x09F9
    009F8 CF7A      RJMP	0x0973
(0963) 		}
(0964) 	}
(0965) 
(0966) 	return res;
    009F9 2D0A      MOV	R16,R10
    009FA 962A      ADIW	R28,0xA
    009FB 940E 4907 CALL	pop_xgsetF03C
    009FD 9622      ADIW	R28,2
    009FE 9508      RET
ff.c:create_chain:
  res                  --> R10
  scl                  --> Y,+14
  cs                   --> Y,+10
  ncl                  --> Y,+6
  clst                 --> Y,+32
  fs                   --> R12
    009FF 933A      ST	-Y,R19
    00A00 932A      ST	-Y,R18
    00A01 940E 48C3 CALL	push_xgsetF0FC
    00A03 0168      MOVW	R12,R16
    00A04 9766      SBIW	R28,0x16
(0967) }
(0968) #endif
(0969) 
(0970) 
(0971) 
(0972) 
(0973) /*-----------------------------------------------------------------------*/
(0974) /* FAT handling - Stretch or Create a cluster chain                      */
(0975) /*-----------------------------------------------------------------------*/
(0976) #if !_FS_READONLY
(0977) static
(0978) DWORD create_chain (	/* 0:No free cluster, 1:Internal error, 0xFFFFFFFF:Disk error, >=2:New cluster# */
(0979) 	FATFS *fs,			/* File system object */
(0980) 	DWORD clst			/* Cluster# to stretch. 0 means create a new chain. */
(0981) )
(0982) {
(0983) 	DWORD cs, ncl, scl;
(0984) 	FRESULT res;
(0985) 
(0986) 
(0987) 	if (clst == 0) {		/* Create a new chain */
    00A05 A028      LDD	R2,Y+32
    00A06 A039      LDD	R3,Y+33
    00A07 A04A      LDD	R4,Y+34
    00A08 A05B      LDD	R5,Y+35
    00A09 9488      BCLR	0
    00A0A 2022      TST	R2
    00A0B 0432      CPC	R3,R2
    00A0C 0442      CPC	R4,R2
    00A0D 0452      CPC	R5,R2
    00A0E F559      BNE	0x0A3A
(0988) 		scl = fs->last_clust;			/* Get suggested start point */
    00A0F 01F6      MOVW	R30,R12
    00A10 963A      ADIW	R30,0xA
    00A11 8020      LD	R2,Z
    00A12 8031      LDD	R3,Z+1
    00A13 8042      LDD	R4,Z+2
    00A14 8053      LDD	R5,Z+3
    00A15 862E      STD	Y+14,R2
    00A16 863F      STD	Y+15,R3
    00A17 8A48      STD	Y+16,R4
    00A18 8A59      STD	Y+17,R5
(0989) 		if (!scl || scl >= fs->n_fatent) scl = 1;
    00A19 842E      LDD	R2,Y+14
    00A1A 843F      LDD	R3,Y+15
    00A1B 8848      LDD	R4,Y+16
    00A1C 8859      LDD	R5,Y+17
    00A1D 9488      BCLR	0
    00A1E 2022      TST	R2
    00A1F 0432      CPC	R3,R2
    00A20 0442      CPC	R4,R2
    00A21 0452      CPC	R5,R2
    00A22 F081      BEQ	0x0A33
    00A23 01F6      MOVW	R30,R12
    00A24 9676      ADIW	R30,0x16
    00A25 8020      LD	R2,Z
    00A26 8031      LDD	R3,Z+1
    00A27 8042      LDD	R4,Z+2
    00A28 8053      LDD	R5,Z+3
    00A29 846E      LDD	R6,Y+14
    00A2A 847F      LDD	R7,Y+15
    00A2B 8888      LDD	R8,Y+16
    00A2C 8899      LDD	R9,Y+17
    00A2D 1462      CP	R6,R2
    00A2E 0473      CPC	R7,R3
    00A2F 0484      CPC	R8,R4
    00A30 0495      CPC	R9,R5
    00A31 F408      BCC	0x0A33
    00A32 C040      RJMP	0x0A73
    00A33 E081      LDI	R24,1
    00A34 878E      STD	Y+14,R24
    00A35 E080      LDI	R24,0
    00A36 878F      STD	Y+15,R24
    00A37 8B88      STD	Y+16,R24
    00A38 8B89      STD	Y+17,R24
(0990) 	}
    00A39 C039      RJMP	0x0A73
(0991) 	else {					/* Stretch the current chain */
(0992) 		cs = get_fat(fs, clst);			/* Check the cluster status */
    00A3A A028      LDD	R2,Y+32
    00A3B A039      LDD	R3,Y+33
    00A3C A04A      LDD	R4,Y+34
    00A3D A05B      LDD	R5,Y+35
    00A3E 8248      ST	Y,R4
    00A3F 8259      STD	Y+1,R5
    00A40 0191      MOVW	R18,R2
    00A41 0186      MOVW	R16,R12
    00A42 DBFA      RCALL	_get_fat
    00A43 870A      STD	Y+10,R16
    00A44 871B      STD	Y+11,R17
    00A45 872C      STD	Y+12,R18
    00A46 873D      STD	Y+13,R19
(0993) 		if (cs < 2) return 1;			/* It is an invalid cluster */
    00A47 E042      LDI	R20,2
    00A48 E050      LDI	R21,0
    00A49 E060      LDI	R22,0
    00A4A E070      LDI	R23,0
    00A4B 842A      LDD	R2,Y+10
    00A4C 843B      LDD	R3,Y+11
    00A4D 844C      LDD	R4,Y+12
    00A4E 845D      LDD	R5,Y+13
    00A4F 1624      CP	R2,R20
    00A50 0635      CPC	R3,R21
    00A51 0646      CPC	R4,R22
    00A52 0657      CPC	R5,R23
    00A53 F428      BCC	0x0A59
    00A54 E001      LDI	R16,1
    00A55 E010      LDI	R17,0
    00A56 E020      LDI	R18,0
    00A57 E030      LDI	R19,0
    00A58 C119      RJMP	0x0B72
(0994) 		if (cs < fs->n_fatent) return cs;	/* It is already followed by next cluster */
    00A59 01F6      MOVW	R30,R12
    00A5A 9676      ADIW	R30,0x16
    00A5B 8020      LD	R2,Z
    00A5C 8031      LDD	R3,Z+1
    00A5D 8042      LDD	R4,Z+2
    00A5E 8053      LDD	R5,Z+3
    00A5F 846A      LDD	R6,Y+10
    00A60 847B      LDD	R7,Y+11
    00A61 848C      LDD	R8,Y+12
    00A62 849D      LDD	R9,Y+13
    00A63 1462      CP	R6,R2
    00A64 0473      CPC	R7,R3
    00A65 0484      CPC	R8,R4
    00A66 0495      CPC	R9,R5
    00A67 F418      BCC	0x0A6B
    00A68 0183      MOVW	R16,R6
    00A69 0194      MOVW	R18,R8
    00A6A C107      RJMP	0x0B72
(0995) 		scl = clst;
    00A6B A028      LDD	R2,Y+32
    00A6C A039      LDD	R3,Y+33
    00A6D A04A      LDD	R4,Y+34
    00A6E A05B      LDD	R5,Y+35
    00A6F 862E      STD	Y+14,R2
    00A70 863F      STD	Y+15,R3
    00A71 8A48      STD	Y+16,R4
    00A72 8A59      STD	Y+17,R5
(0996) 	}
(0997) 
(0998) 	ncl = scl;				/* Start cluster */
    00A73 842E      LDD	R2,Y+14
    00A74 843F      LDD	R3,Y+15
    00A75 8848      LDD	R4,Y+16
    00A76 8859      LDD	R5,Y+17
    00A77 822E      STD	Y+6,R2
    00A78 823F      STD	Y+7,R3
    00A79 8648      STD	Y+8,R4
    00A7A 8659      STD	Y+9,R5
(0999) 	for (;;) {
(1000) 		ncl++;							/* Next cluster */
    00A7B E041      LDI	R20,1
    00A7C E050      LDI	R21,0
    00A7D E060      LDI	R22,0
    00A7E E070      LDI	R23,0
    00A7F 802E      LDD	R2,Y+6
    00A80 803F      LDD	R3,Y+7
    00A81 8448      LDD	R4,Y+8
    00A82 8459      LDD	R5,Y+9
    00A83 0E24      ADD	R2,R20
    00A84 1E35      ADC	R3,R21
    00A85 1E46      ADC	R4,R22
    00A86 1E57      ADC	R5,R23
    00A87 822E      STD	Y+6,R2
    00A88 823F      STD	Y+7,R3
    00A89 8648      STD	Y+8,R4
    00A8A 8659      STD	Y+9,R5
(1001) 		if (ncl >= fs->n_fatent) {		/* Wrap around */
    00A8B 01F6      MOVW	R30,R12
    00A8C 9676      ADIW	R30,0x16
    00A8D 8020      LD	R2,Z
    00A8E 8031      LDD	R3,Z+1
    00A8F 8042      LDD	R4,Z+2
    00A90 8053      LDD	R5,Z+3
    00A91 806E      LDD	R6,Y+6
    00A92 807F      LDD	R7,Y+7
    00A93 8488      LDD	R8,Y+8
    00A94 8499      LDD	R9,Y+9
    00A95 1462      CP	R6,R2
    00A96 0473      CPC	R7,R3
    00A97 0484      CPC	R8,R4
    00A98 0495      CPC	R9,R5
    00A99 F0C0      BCS	0x0AB2
(1002) 			ncl = 2;
    00A9A E082      LDI	R24,2
    00A9B 838E      STD	Y+6,R24
    00A9C E080      LDI	R24,0
    00A9D 838F      STD	Y+7,R24
    00A9E 8788      STD	Y+8,R24
    00A9F 8789      STD	Y+9,R24
(1003) 			if (ncl > scl) return 0;	/* No free cluster */
    00AA0 842E      LDD	R2,Y+14
    00AA1 843F      LDD	R3,Y+15
    00AA2 8848      LDD	R4,Y+16
    00AA3 8859      LDD	R5,Y+17
    00AA4 806E      LDD	R6,Y+6
    00AA5 807F      LDD	R7,Y+7
    00AA6 8488      LDD	R8,Y+8
    00AA7 8499      LDD	R9,Y+9
    00AA8 1426      CP	R2,R6
    00AA9 0437      CPC	R3,R7
    00AAA 0448      CPC	R4,R8
    00AAB 0459      CPC	R5,R9
    00AAC F428      BCC	0x0AB2
    00AAD E000      LDI	R16,0
    00AAE E010      LDI	R17,0
    00AAF E020      LDI	R18,0
    00AB0 E030      LDI	R19,0
    00AB1 C0C0      RJMP	0x0B72
(1004) 		}
(1005) 		cs = get_fat(fs, ncl);			/* Get the cluster status */
    00AB2 802E      LDD	R2,Y+6
    00AB3 803F      LDD	R3,Y+7
    00AB4 8448      LDD	R4,Y+8
    00AB5 8459      LDD	R5,Y+9
    00AB6 8248      ST	Y,R4
    00AB7 8259      STD	Y+1,R5
    00AB8 0191      MOVW	R18,R2
    00AB9 0186      MOVW	R16,R12
    00ABA DB82      RCALL	_get_fat
    00ABB 870A      STD	Y+10,R16
    00ABC 871B      STD	Y+11,R17
    00ABD 872C      STD	Y+12,R18
    00ABE 873D      STD	Y+13,R19
(1006) 		if (cs == 0) break;				/* Found a free cluster */
    00ABF 842A      LDD	R2,Y+10
    00AC0 843B      LDD	R3,Y+11
    00AC1 844C      LDD	R4,Y+12
    00AC2 845D      LDD	R5,Y+13
    00AC3 9488      BCLR	0
    00AC4 2022      TST	R2
    00AC5 0432      CPC	R3,R2
    00AC6 0442      CPC	R4,R2
    00AC7 0452      CPC	R5,R2
    00AC8 F409      BNE	0x0ACA
    00AC9 C02E      RJMP	0x0AF8
(1007) 		if (cs == 0xFFFFFFFF || cs == 1)/* An error occurred */
    00ACA EF4F      LDI	R20,0xFF
    00ACB EF5F      LDI	R21,0xFF
    00ACC EF6F      LDI	R22,0xFF
    00ACD EF7F      LDI	R23,0xFF
    00ACE 842A      LDD	R2,Y+10
    00ACF 843B      LDD	R3,Y+11
    00AD0 844C      LDD	R4,Y+12
    00AD1 845D      LDD	R5,Y+13
    00AD2 1624      CP	R2,R20
    00AD3 0635      CPC	R3,R21
    00AD4 0646      CPC	R4,R22
    00AD5 0657      CPC	R5,R23
    00AD6 F049      BEQ	0x0AE0
    00AD7 E041      LDI	R20,1
    00AD8 E050      LDI	R21,0
    00AD9 E060      LDI	R22,0
    00ADA E070      LDI	R23,0
    00ADB 1624      CP	R2,R20
    00ADC 0635      CPC	R3,R21
    00ADD 0646      CPC	R4,R22
    00ADE 0657      CPC	R5,R23
    00ADF F429      BNE	0x0AE5
(1008) 			return cs;
    00AE0 850A      LDD	R16,Y+10
    00AE1 851B      LDD	R17,Y+11
    00AE2 852C      LDD	R18,Y+12
    00AE3 853D      LDD	R19,Y+13
    00AE4 C08D      RJMP	0x0B72
(1009) 		if (ncl == scl) return 0;		/* No free cluster */
    00AE5 842E      LDD	R2,Y+14
    00AE6 843F      LDD	R3,Y+15
    00AE7 8848      LDD	R4,Y+16
    00AE8 8859      LDD	R5,Y+17
    00AE9 806E      LDD	R6,Y+6
    00AEA 807F      LDD	R7,Y+7
    00AEB 8488      LDD	R8,Y+8
    00AEC 8499      LDD	R9,Y+9
    00AED 1462      CP	R6,R2
    00AEE 0473      CPC	R7,R3
    00AEF 0484      CPC	R8,R4
    00AF0 0495      CPC	R9,R5
    00AF1 F009      BEQ	0x0AF3
    00AF2 CF88      RJMP	0x0A7B
    00AF3 E000      LDI	R16,0
    00AF4 E010      LDI	R17,0
    00AF5 E020      LDI	R18,0
    00AF6 E030      LDI	R19,0
    00AF7 C07A      RJMP	0x0B72
(1010) 	}
(1011) 
(1012) 	res = put_fat(fs, ncl, 0x0FFFFFFF);	/* Mark the new cluster "last link" */
    00AF8 EF8F      LDI	R24,0xFF
    00AF9 838A      STD	Y+2,R24
    00AFA 838B      STD	Y+3,R24
    00AFB 838C      STD	Y+4,R24
    00AFC E08F      LDI	R24,0xF
    00AFD 838D      STD	Y+5,R24
    00AFE 802E      LDD	R2,Y+6
    00AFF 803F      LDD	R3,Y+7
    00B00 8448      LDD	R4,Y+8
    00B01 8459      LDD	R5,Y+9
    00B02 8248      ST	Y,R4
    00B03 8259      STD	Y+1,R5
    00B04 0191      MOVW	R18,R2
    00B05 0186      MOVW	R16,R12
    00B06 DC86      RCALL	_put_fat
    00B07 2EA0      MOV	R10,R16
(1013) 	if (res == FR_OK && clst != 0) {
    00B08 2300      TST	R16
    00B09 F4E1      BNE	0x0B26
    00B0A A028      LDD	R2,Y+32
    00B0B A039      LDD	R3,Y+33
    00B0C A04A      LDD	R4,Y+34
    00B0D A05B      LDD	R5,Y+35
    00B0E 9488      BCLR	0
    00B0F 2022      TST	R2
    00B10 0432      CPC	R3,R2
    00B11 0442      CPC	R4,R2
    00B12 0452      CPC	R5,R2
    00B13 F091      BEQ	0x0B26
(1014) 		res = put_fat(fs, clst, ncl);	/* Link it to the previous one if needed */
    00B14 802E      LDD	R2,Y+6
    00B15 803F      LDD	R3,Y+7
    00B16 8448      LDD	R4,Y+8
    00B17 8459      LDD	R5,Y+9
    00B18 822A      STD	Y+2,R2
    00B19 823B      STD	Y+3,R3
    00B1A 824C      STD	Y+4,R4
    00B1B 825D      STD	Y+5,R5
    00B1C A028      LDD	R2,Y+32
    00B1D A039      LDD	R3,Y+33
    00B1E A04A      LDD	R4,Y+34
    00B1F A05B      LDD	R5,Y+35
    00B20 8248      ST	Y,R4
    00B21 8259      STD	Y+1,R5
    00B22 0191      MOVW	R18,R2
    00B23 0186      MOVW	R16,R12
    00B24 DC68      RCALL	_put_fat
    00B25 2EA0      MOV	R10,R16
(1015) 	}
(1016) 	if (res == FR_OK) {
    00B26 20AA      TST	R10
    00B27 F009      BEQ	0x0B29
    00B28 C02E      RJMP	0x0B57
(1017) 		fs->last_clust = ncl;			/* Update FSINFO */
    00B29 802E      LDD	R2,Y+6
    00B2A 803F      LDD	R3,Y+7
    00B2B 8448      LDD	R4,Y+8
    00B2C 8459      LDD	R5,Y+9
    00B2D 01F6      MOVW	R30,R12
    00B2E 8622      STD	Z+10,R2
    00B2F 8633      STD	Z+11,R3
    00B30 8644      STD	Z+12,R4
    00B31 8655      STD	Z+13,R5
(1018) 		if (fs->free_clust != 0xFFFFFFFF) {
    00B32 EF4F      LDI	R20,0xFF
    00B33 EF5F      LDI	R21,0xFF
    00B34 EF6F      LDI	R22,0xFF
    00B35 EF7F      LDI	R23,0xFF
    00B36 8426      LDD	R2,Z+14
    00B37 8437      LDD	R3,Z+15
    00B38 8840      LDD	R4,Z+16
    00B39 8851      LDD	R5,Z+17
    00B3A 1624      CP	R2,R20
    00B3B 0635      CPC	R3,R21
    00B3C 0646      CPC	R4,R22
    00B3D 0657      CPC	R5,R23
    00B3E F179      BEQ	0x0B6E
(1019) 			fs->free_clust--;
    00B3F 01CF      MOVW	R24,R30
    00B40 960E      ADIW	R24,0xE
    00B41 017C      MOVW	R14,R24
    00B42 E041      LDI	R20,1
    00B43 E050      LDI	R21,0
    00B44 E060      LDI	R22,0
    00B45 E070      LDI	R23,0
    00B46 01FC      MOVW	R30,R24
    00B47 8020      LD	R2,Z
    00B48 8031      LDD	R3,Z+1
    00B49 8042      LDD	R4,Z+2
    00B4A 8053      LDD	R5,Z+3
    00B4B 1A24      SUB	R2,R20
    00B4C 0A35      SBC	R3,R21
    00B4D 0A46      SBC	R4,R22
    00B4E 0A57      SBC	R5,R23
    00B4F 8220      ST	Z,R2
    00B50 8231      STD	Z+1,R3
    00B51 8242      STD	Z+2,R4
    00B52 8253      STD	Z+3,R5
(1020) 			fs->fsi_flag = 1;
    00B53 E081      LDI	R24,1
    00B54 01F6      MOVW	R30,R12
    00B55 8385      STD	Z+5,R24
(1021) 		}
(1022) 	} else {
    00B56 C017      RJMP	0x0B6E
(1023) 		ncl = (res == FR_DISK_ERR) ? 0xFFFFFFFF : 1;
    00B57 2D8A      MOV	R24,R10
    00B58 3081      CPI	R24,1
    00B59 F431      BNE	0x0B60
    00B5A EF8F      LDI	R24,0xFF
    00B5B 8B8A      STD	Y+18,R24
    00B5C 8B8B      STD	Y+19,R24
    00B5D 8B8C      STD	Y+20,R24
    00B5E 8B8D      STD	Y+21,R24
    00B5F C006      RJMP	0x0B66
    00B60 E081      LDI	R24,1
    00B61 8B8A      STD	Y+18,R24
    00B62 E080      LDI	R24,0
    00B63 8B8B      STD	Y+19,R24
    00B64 8B8C      STD	Y+20,R24
    00B65 8B8D      STD	Y+21,R24
    00B66 882A      LDD	R2,Y+18
    00B67 883B      LDD	R3,Y+19
    00B68 884C      LDD	R4,Y+20
    00B69 885D      LDD	R5,Y+21
    00B6A 822E      STD	Y+6,R2
    00B6B 823F      STD	Y+7,R3
    00B6C 8648      STD	Y+8,R4
    00B6D 8659      STD	Y+9,R5
(1024) 	}
(1025) 
(1026) 	return ncl;		/* Return new cluster number or error code */
    00B6E 810E      LDD	R16,Y+6
    00B6F 811F      LDD	R17,Y+7
    00B70 8528      LDD	R18,Y+8
    00B71 8539      LDD	R19,Y+9
    00B72 9666      ADIW	R28,0x16
    00B73 940E 48B8 CALL	pop_xgsetF0FC
    00B75 9622      ADIW	R28,2
    00B76 9508      RET
ff.c:clmt_clust:
  tbl                  --> R10
  cl                   --> Y,+4
  ncl                  --> Y,+0
  ofs                  --> Y,+12
  fp                   --> R12
    00B77 933A      ST	-Y,R19
    00B78 932A      ST	-Y,R18
    00B79 940E 48C9 CALL	push_xgset003C
    00B7B 0168      MOVW	R12,R16
    00B7C 9728      SBIW	R28,0x8
(1027) }
(1028) #endif /* !_FS_READONLY */
(1029) 
(1030) 
(1031) 
(1032) /*-----------------------------------------------------------------------*/
(1033) /* FAT handling - Convert offset into cluster with link map table        */
(1034) /*-----------------------------------------------------------------------*/
(1035) 
(1036) #if _USE_FASTSEEK
(1037) static
(1038) DWORD clmt_clust (	/* <2:Error, >=2:Cluster number */
(1039) 	FIL* fp,		/* Pointer to the file object */
(1040) 	DWORD ofs		/* File offset to be converted to cluster# */
(1041) )
(1042) {
(1043) 	DWORD cl, ncl, *tbl;
(1044) 
(1045) 
(1046) 	tbl = fp->cltbl + 1;	/* Top of CLMT */
    00B7D 01F6      MOVW	R30,R12
    00B7E 96B0      ADIW	R30,0x20
    00B7F 8180      LD	R24,Z
    00B80 8191      LDD	R25,Z+1
    00B81 9604      ADIW	R24,4
    00B82 015C      MOVW	R10,R24
(1047) 	cl = ofs / SS(fp->fs) / fp->fs->csize;	/* Cluster order from top of the file */
    00B83 E089      LDI	R24,0x9
    00B84 E090      LDI	R25,0
    00B85 850C      LDD	R16,Y+12
    00B86 851D      LDD	R17,Y+13
    00B87 852E      LDD	R18,Y+14
    00B88 853F      LDD	R19,Y+15
    00B89 938A      ST	-Y,R24
    00B8A 940E 4967 CALL	lsr32
    00B8C 01F6      MOVW	R30,R12
    00B8D 93AF      PUSH	R26
    00B8E 93BF      PUSH	R27
    00B8F 81A0      LD	R26,Z
    00B90 81B1      LDD	R27,Z+1
    00B91 01FD      MOVW	R30,R26
    00B92 91BF      POP	R27
    00B93 91AF      POP	R26
    00B94 9632      ADIW	R30,2
    00B95 8020      LD	R2,Z
    00B96 2433      CLR	R3
    00B97 2444      CLR	R4
    00B98 2455      CLR	R5
    00B99 925A      ST	-Y,R5
    00B9A 924A      ST	-Y,R4
    00B9B 923A      ST	-Y,R3
    00B9C 922A      ST	-Y,R2
    00B9D 940E 47C9 CALL	div32u
    00B9F 830C      STD	Y+4,R16
    00BA0 831D      STD	Y+5,R17
    00BA1 832E      STD	Y+6,R18
    00BA2 833F      STD	Y+7,R19
(1048) 	for (;;) {
(1049) 		ncl = *tbl++;			/* Number of cluters in the fragment */
    00BA3 01F5      MOVW	R30,R10
    00BA4 9021      LD	R2,Z+
    00BA5 9031      LD	R3,Z+
    00BA6 9041      LD	R4,Z+
    00BA7 9051      LD	R5,Z+
    00BA8 015F      MOVW	R10,R30
    00BA9 8228      ST	Y,R2
    00BAA 8239      STD	Y+1,R3
    00BAB 824A      STD	Y+2,R4
    00BAC 825B      STD	Y+3,R5
(1050) 		if (!ncl) return 0;		/* End of table? (error) */
    00BAD 8028      LD	R2,Y
    00BAE 8039      LDD	R3,Y+1
    00BAF 804A      LDD	R4,Y+2
    00BB0 805B      LDD	R5,Y+3
    00BB1 9488      BCLR	0
    00BB2 2022      TST	R2
    00BB3 0432      CPC	R3,R2
    00BB4 0442      CPC	R4,R2
    00BB5 0452      CPC	R5,R2
    00BB6 F429      BNE	0x0BBC
    00BB7 E000      LDI	R16,0
    00BB8 E010      LDI	R17,0
    00BB9 E020      LDI	R18,0
    00BBA E030      LDI	R19,0
    00BBB C02F      RJMP	0x0BEB
(1051) 		if (cl < ncl) break;	/* In this fragment? */
    00BBC 8028      LD	R2,Y
    00BBD 8039      LDD	R3,Y+1
    00BBE 804A      LDD	R4,Y+2
    00BBF 805B      LDD	R5,Y+3
    00BC0 806C      LDD	R6,Y+4
    00BC1 807D      LDD	R7,Y+5
    00BC2 808E      LDD	R8,Y+6
    00BC3 809F      LDD	R9,Y+7
    00BC4 1462      CP	R6,R2
    00BC5 0473      CPC	R7,R3
    00BC6 0484      CPC	R8,R4
    00BC7 0495      CPC	R9,R5
    00BC8 F408      BCC	0x0BCA
    00BC9 C014      RJMP	0x0BDE
(1052) 		cl -= ncl; tbl++;		/* Next fragment */
    00BCA 8028      LD	R2,Y
    00BCB 8039      LDD	R3,Y+1
    00BCC 804A      LDD	R4,Y+2
    00BCD 805B      LDD	R5,Y+3
    00BCE 806C      LDD	R6,Y+4
    00BCF 807D      LDD	R7,Y+5
    00BD0 808E      LDD	R8,Y+6
    00BD1 809F      LDD	R9,Y+7
    00BD2 1862      SUB	R6,R2
    00BD3 0873      SBC	R7,R3
    00BD4 0884      SBC	R8,R4
    00BD5 0895      SBC	R9,R5
    00BD6 826C      STD	Y+4,R6
    00BD7 827D      STD	Y+5,R7
    00BD8 828E      STD	Y+6,R8
    00BD9 829F      STD	Y+7,R9
    00BDA 01C5      MOVW	R24,R10
    00BDB 9604      ADIW	R24,4
    00BDC 015C      MOVW	R10,R24
    00BDD CFC5      RJMP	0x0BA3
(1053) 	}
(1054) 	return cl + *tbl;	/* Return the cluster number */
    00BDE 01F5      MOVW	R30,R10
    00BDF 8020      LD	R2,Z
    00BE0 8031      LDD	R3,Z+1
    00BE1 8042      LDD	R4,Z+2
    00BE2 8053      LDD	R5,Z+3
    00BE3 810C      LDD	R16,Y+4
    00BE4 811D      LDD	R17,Y+5
    00BE5 812E      LDD	R18,Y+6
    00BE6 813F      LDD	R19,Y+7
    00BE7 0D02      ADD	R16,R2
    00BE8 1D13      ADC	R17,R3
    00BE9 1D24      ADC	R18,R4
    00BEA 1D35      ADC	R19,R5
    00BEB 9628      ADIW	R28,0x8
    00BEC 940E 48A3 CALL	pop_xgset003C
    00BEE 9622      ADIW	R28,2
    00BEF 9508      RET
ff.c:dir_sdi:
  ic                   --> R14
  clst                 --> Y,+2
  idx                  --> R12
  dj                   --> R10
    00BF0 940E 48C3 CALL	push_xgsetF0FC
    00BF2 0169      MOVW	R12,R18
    00BF3 0158      MOVW	R10,R16
    00BF4 9726      SBIW	R28,6
(1055) }
(1056) #endif	/* _USE_FASTSEEK */
(1057) 
(1058) 
(1059) 
(1060) /*-----------------------------------------------------------------------*/
(1061) /* Directory handling - Set directory index                              */
(1062) /*-----------------------------------------------------------------------*/
(1063) 
(1064) static
(1065) FRESULT dir_sdi (
(1066) 	DIR *dj,		/* Pointer to directory object */
(1067) 	WORD idx		/* Directory index number */
(1068) )
(1069) {
(1070) 	DWORD clst;
(1071) 	WORD ic;
(1072) 
(1073) 
(1074) 	dj->index = idx;
    00BF5 01F5      MOVW	R30,R10
    00BF6 82D5      STD	Z+5,R13
    00BF7 82C4      STD	Z+4,R12
(1075) 	clst = dj->sclust;
    00BF8 9636      ADIW	R30,6
    00BF9 8020      LD	R2,Z
    00BFA 8031      LDD	R3,Z+1
    00BFB 8042      LDD	R4,Z+2
    00BFC 8053      LDD	R5,Z+3
    00BFD 822A      STD	Y+2,R2
    00BFE 823B      STD	Y+3,R3
    00BFF 824C      STD	Y+4,R4
    00C00 825D      STD	Y+5,R5
(1076) 	if (clst == 1 || clst >= dj->fs->n_fatent)	/* Check start cluster range */
    00C01 E041      LDI	R20,1
    00C02 E050      LDI	R21,0
    00C03 E060      LDI	R22,0
    00C04 E070      LDI	R23,0
    00C05 802A      LDD	R2,Y+2
    00C06 803B      LDD	R3,Y+3
    00C07 804C      LDD	R4,Y+4
    00C08 805D      LDD	R5,Y+5
    00C09 1624      CP	R2,R20
    00C0A 0635      CPC	R3,R21
    00C0B 0646      CPC	R4,R22
    00C0C 0657      CPC	R5,R23
    00C0D F089      BEQ	0x0C1F
    00C0E 01F5      MOVW	R30,R10
    00C0F 81A0      LD	R26,Z
    00C10 81B1      LDD	R27,Z+1
    00C11 9656      ADIW	R26,0x16
    00C12 902D      LD	R2,X+
    00C13 903D      LD	R3,X+
    00C14 904D      LD	R4,X+
    00C15 905C      LD	R5,X
    00C16 806A      LDD	R6,Y+2
    00C17 807B      LDD	R7,Y+3
    00C18 808C      LDD	R8,Y+4
    00C19 809D      LDD	R9,Y+5
    00C1A 1462      CP	R6,R2
    00C1B 0473      CPC	R7,R3
    00C1C 0484      CPC	R8,R4
    00C1D 0495      CPC	R9,R5
    00C1E F010      BCS	0x0C21
(1077) 		return FR_INT_ERR;
    00C1F E002      LDI	R16,2
    00C20 C0D6      RJMP	0x0CF7
(1078) 	if (!clst && dj->fs->fs_type == FS_FAT32)	/* Replace cluster# 0 with root cluster# if in FAT32 */
    00C21 802A      LDD	R2,Y+2
    00C22 803B      LDD	R3,Y+3
    00C23 804C      LDD	R4,Y+4
    00C24 805D      LDD	R5,Y+5
    00C25 9488      BCLR	0
    00C26 2022      TST	R2
    00C27 0432      CPC	R3,R2
    00C28 0442      CPC	R4,R2
    00C29 0452      CPC	R5,R2
    00C2A F479      BNE	0x0C3A
    00C2B 01F5      MOVW	R30,R10
    00C2C 81A0      LD	R26,Z
    00C2D 81B1      LDD	R27,Z+1
    00C2E 918C      LD	R24,X
    00C2F 3083      CPI	R24,3
    00C30 F449      BNE	0x0C3A
(1079) 		clst = dj->fs->dirbase;
    00C31 9692      ADIW	R26,0x22
    00C32 902D      LD	R2,X+
    00C33 903D      LD	R3,X+
    00C34 904D      LD	R4,X+
    00C35 905C      LD	R5,X
    00C36 822A      STD	Y+2,R2
    00C37 823B      STD	Y+3,R3
    00C38 824C      STD	Y+4,R4
    00C39 825D      STD	Y+5,R5
(1080) 
(1081) 	if (clst == 0) {	/* Static table (root-dir in FAT12/16) */
    00C3A 802A      LDD	R2,Y+2
    00C3B 803B      LDD	R3,Y+3
    00C3C 804C      LDD	R4,Y+4
    00C3D 805D      LDD	R5,Y+5
    00C3E 9488      BCLR	0
    00C3F 2022      TST	R2
    00C40 0432      CPC	R3,R2
    00C41 0442      CPC	R4,R2
    00C42 0452      CPC	R5,R2
    00C43 F009      BEQ	0x0C45
    00C44 C02B      RJMP	0x0C70
(1082) 		dj->clust = clst;
    00C45 01F5      MOVW	R30,R10
    00C46 8622      STD	Z+10,R2
    00C47 8633      STD	Z+11,R3
    00C48 8644      STD	Z+12,R4
    00C49 8655      STD	Z+13,R5
(1083) 		if (idx >= dj->fs->n_rootdir)		/* Index is out of range */
    00C4A 81A0      LD	R26,Z
    00C4B 81B1      LDD	R27,Z+1
    00C4C 9618      ADIW	R26,0x8
    00C4D 902D      LD	R2,X+
    00C4E 903C      LD	R3,X
    00C4F 14C2      CP	R12,R2
    00C50 04D3      CPC	R13,R3
    00C51 F010      BCS	0x0C54
(1084) 			return FR_INT_ERR;
    00C52 E002      LDI	R16,2
    00C53 C0A3      RJMP	0x0CF7
(1085) 		dj->sect = dj->fs->dirbase + idx / (SS(dj->fs) / SZ_DIR);	/* Sector# */
    00C54 0116      MOVW	R2,R12
    00C55 9436      LSR	R3
    00C56 9427      ROR	R2
    00C57 9436      LSR	R3
    00C58 9427      ROR	R2
    00C59 9436      LSR	R3
    00C5A 9427      ROR	R2
    00C5B 9436      LSR	R3
    00C5C 9427      ROR	R2
    00C5D 2444      CLR	R4
    00C5E 2455      CLR	R5
    00C5F 01F5      MOVW	R30,R10
    00C60 81A0      LD	R26,Z
    00C61 81B1      LDD	R27,Z+1
    00C62 9692      ADIW	R26,0x22
    00C63 906D      LD	R6,X+
    00C64 907D      LD	R7,X+
    00C65 908D      LD	R8,X+
    00C66 909C      LD	R9,X
    00C67 0C62      ADD	R6,R2
    00C68 1C73      ADC	R7,R3
    00C69 1C84      ADC	R8,R4
    00C6A 1C95      ADC	R9,R5
    00C6B 8666      STD	Z+14,R6
    00C6C 8677      STD	Z+15,R7
    00C6D 8A80      STD	Z+16,R8
    00C6E 8A91      STD	Z+17,R9
(1086) 	}
    00C6F C076      RJMP	0x0CE6
(1087) 	else {				/* Dynamic table (sub-dirs or root-dir in FAT32) */
(1088) 		ic = SS(dj->fs) / SZ_DIR * dj->fs->csize;	/* Entries per cluster */
    00C70 01F5      MOVW	R30,R10
    00C71 93AF      PUSH	R26
    00C72 93BF      PUSH	R27
    00C73 81A0      LD	R26,Z
    00C74 81B1      LDD	R27,Z+1
    00C75 01FD      MOVW	R30,R26
    00C76 91BF      POP	R27
    00C77 91AF      POP	R26
    00C78 8022      LDD	R2,Z+2
    00C79 E180      LDI	R24,0x10
    00C7A 9D82      MUL	R24,R2
    00C7B 0170      MOVW	R14,R0
    00C7C C040      RJMP	0x0CBD
(1089) 		while (idx >= ic) {	/* Follow cluster chain */
(1090) 			clst = get_fat(dj->fs, clst);				/* Get next cluster */
    00C7D 802A      LDD	R2,Y+2
    00C7E 803B      LDD	R3,Y+3
    00C7F 804C      LDD	R4,Y+4
    00C80 805D      LDD	R5,Y+5
    00C81 8248      ST	Y,R4
    00C82 8259      STD	Y+1,R5
    00C83 0191      MOVW	R18,R2
    00C84 01F5      MOVW	R30,R10
    00C85 8100      LD	R16,Z
    00C86 8111      LDD	R17,Z+1
    00C87 D9B5      RCALL	_get_fat
    00C88 830A      STD	Y+2,R16
    00C89 831B      STD	Y+3,R17
    00C8A 832C      STD	Y+4,R18
    00C8B 833D      STD	Y+5,R19
(1091) 			if (clst == 0xFFFFFFFF) return FR_DISK_ERR;	/* Disk error */
    00C8C EF4F      LDI	R20,0xFF
    00C8D EF5F      LDI	R21,0xFF
    00C8E EF6F      LDI	R22,0xFF
    00C8F EF7F      LDI	R23,0xFF
    00C90 802A      LDD	R2,Y+2
    00C91 803B      LDD	R3,Y+3
    00C92 804C      LDD	R4,Y+4
    00C93 805D      LDD	R5,Y+5
    00C94 1624      CP	R2,R20
    00C95 0635      CPC	R3,R21
    00C96 0646      CPC	R4,R22
    00C97 0657      CPC	R5,R23
    00C98 F411      BNE	0x0C9B
    00C99 E001      LDI	R16,1
    00C9A C05C      RJMP	0x0CF7
(1092) 			if (clst < 2 || clst >= dj->fs->n_fatent)	/* Reached to end of table or int error */
    00C9B E042      LDI	R20,2
    00C9C E050      LDI	R21,0
    00C9D E060      LDI	R22,0
    00C9E E070      LDI	R23,0
    00C9F 802A      LDD	R2,Y+2
    00CA0 803B      LDD	R3,Y+3
    00CA1 804C      LDD	R4,Y+4
    00CA2 805D      LDD	R5,Y+5
    00CA3 1624      CP	R2,R20
    00CA4 0635      CPC	R3,R21
    00CA5 0646      CPC	R4,R22
    00CA6 0657      CPC	R5,R23
    00CA7 F088      BCS	0x0CB9
    00CA8 01F5      MOVW	R30,R10
    00CA9 81A0      LD	R26,Z
    00CAA 81B1      LDD	R27,Z+1
    00CAB 9656      ADIW	R26,0x16
    00CAC 902D      LD	R2,X+
    00CAD 903D      LD	R3,X+
    00CAE 904D      LD	R4,X+
    00CAF 905C      LD	R5,X
    00CB0 806A      LDD	R6,Y+2
    00CB1 807B      LDD	R7,Y+3
    00CB2 808C      LDD	R8,Y+4
    00CB3 809D      LDD	R9,Y+5
    00CB4 1462      CP	R6,R2
    00CB5 0473      CPC	R7,R3
    00CB6 0484      CPC	R8,R4
    00CB7 0495      CPC	R9,R5
    00CB8 F010      BCS	0x0CBB
(1093) 				return FR_INT_ERR;
    00CB9 E002      LDI	R16,2
    00CBA C03C      RJMP	0x0CF7
(1094) 			idx -= ic;
    00CBB 18CE      SUB	R12,R14
    00CBC 08DF      SBC	R13,R15
    00CBD 14CE      CP	R12,R14
    00CBE 04DF      CPC	R13,R15
    00CBF F008      BCS	0x0CC1
    00CC0 CFBC      RJMP	0x0C7D
(1095) 		}
(1096) 		dj->clust = clst;
    00CC1 802A      LDD	R2,Y+2
    00CC2 803B      LDD	R3,Y+3
    00CC3 804C      LDD	R4,Y+4
    00CC4 805D      LDD	R5,Y+5
    00CC5 01F5      MOVW	R30,R10
    00CC6 8622      STD	Z+10,R2
    00CC7 8633      STD	Z+11,R3
    00CC8 8644      STD	Z+12,R4
    00CC9 8655      STD	Z+13,R5
(1097) 		dj->sect = clust2sect(dj->fs, clst) + idx / (SS(dj->fs) / SZ_DIR);	/* Sector# */
    00CCA 8248      ST	Y,R4
    00CCB 8259      STD	Y+1,R5
    00CCC 0191      MOVW	R18,R2
    00CCD 8100      LD	R16,Z
    00CCE 8111      LDD	R17,Z+1
    00CCF D91B      RCALL	_clust2sect
    00CD0 0116      MOVW	R2,R12
    00CD1 9436      LSR	R3
    00CD2 9427      ROR	R2
    00CD3 9436      LSR	R3
    00CD4 9427      ROR	R2
    00CD5 9436      LSR	R3
    00CD6 9427      ROR	R2
    00CD7 9436      LSR	R3
    00CD8 9427      ROR	R2
    00CD9 2444      CLR	R4
    00CDA 2455      CLR	R5
    00CDB 0138      MOVW	R6,R16
    00CDC 0149      MOVW	R8,R18
    00CDD 0C62      ADD	R6,R2
    00CDE 1C73      ADC	R7,R3
    00CDF 1C84      ADC	R8,R4
    00CE0 1C95      ADC	R9,R5
    00CE1 01F5      MOVW	R30,R10
    00CE2 8666      STD	Z+14,R6
    00CE3 8677      STD	Z+15,R7
    00CE4 8A80      STD	Z+16,R8
    00CE5 8A91      STD	Z+17,R9
(1098) 	}
(1099) 
(1100) 	dj->dir = dj->fs->win + (idx % (SS(dj->fs) / SZ_DIR)) * SZ_DIR;	/* Ptr to the entry in the sector */
    00CE6 0196      MOVW	R18,R12
    00CE7 702F      ANDI	R18,0xF
    00CE8 7030      ANDI	R19,0
    00CE9 E200      LDI	R16,0x20
    00CEA E010      LDI	R17,0
    00CEB 940E 485F CALL	empy16s
    00CED 0118      MOVW	R2,R16
    00CEE 01F5      MOVW	R30,R10
    00CEF 8180      LD	R24,Z
    00CF0 8191      LDD	R25,Z+1
    00CF1 968E      ADIW	R24,0x2E
    00CF2 0E28      ADD	R2,R24
    00CF3 1E39      ADC	R3,R25
    00CF4 8A33      STD	Z+19,R3
    00CF5 8A22      STD	Z+18,R2
(1101) 
(1102) 	return FR_OK;	/* Seek succeeded */
    00CF6 2700      CLR	R16
    00CF7 9626      ADIW	R28,6
    00CF8 940C 48B8 JMP	pop_xgsetF0FC
ff.c:dir_next:
  c                    --> R10
  clst                 --> Y,+2
  i                    --> R12
  stretch              --> R10
  dj                   --> Y,+16
    00CFA 940E 477E CALL	push_arg4
    00CFC 940E 48C3 CALL	push_xgsetF0FC
    00CFE 0159      MOVW	R10,R18
    00CFF 9726      SBIW	R28,6
(1103) }
(1104) 
(1105) 
(1106) 
(1107) 
(1108) /*-----------------------------------------------------------------------*/
(1109) /* Directory handling - Move directory index next                        */
(1110) /*-----------------------------------------------------------------------*/
(1111) 
(1112) static
(1113) FRESULT dir_next (	/* FR_OK:Succeeded, FR_NO_FILE:End of table, FR_DENIED:EOT and could not stretch */
(1114) 	DIR *dj,		/* Pointer to directory object */
(1115) 	int stretch		/* 0: Do not stretch table, 1: Stretch table if needed */
(1116) )
(1117) {
(1118) 	DWORD clst;
(1119) 	WORD i;
(1120) 
(1121) 
(1122) 	stretch = stretch;		/* To suppress warning on read-only cfg. */
(1123) 	i = dj->index + 1;
    00D00 89E8      LDD	R30,Y+16
    00D01 89F9      LDD	R31,Y+17
    00D02 8184      LDD	R24,Z+4
    00D03 8195      LDD	R25,Z+5
    00D04 9601      ADIW	R24,1
    00D05 016C      MOVW	R12,R24
(1124) 	if (!i || !dj->sect)	/* Report EOT when index has reached 65535 */
    00D06 3080      CPI	R24,0
    00D07 0789      CPC	R24,R25
    00D08 F059      BEQ	0x0D14
    00D09 963E      ADIW	R30,0xE
    00D0A 8020      LD	R2,Z
    00D0B 8031      LDD	R3,Z+1
    00D0C 8042      LDD	R4,Z+2
    00D0D 8053      LDD	R5,Z+3
    00D0E 9488      BCLR	0
    00D0F 2022      TST	R2
    00D10 0432      CPC	R3,R2
    00D11 0442      CPC	R4,R2
    00D12 0452      CPC	R5,R2
    00D13 F411      BNE	0x0D16
(1125) 		return FR_NO_FILE;
    00D14 E004      LDI	R16,4
    00D15 C18D      RJMP	0x0EA3
(1126) 
(1127) 	if (!(i % (SS(dj->fs) / SZ_DIR))) {	/* Sector changed? */
    00D16 01C6      MOVW	R24,R12
    00D17 708F      ANDI	R24,0xF
    00D18 7090      ANDI	R25,0
    00D19 3080      CPI	R24,0
    00D1A 0789      CPC	R24,R25
    00D1B F009      BEQ	0x0D1D
    00D1C C170      RJMP	0x0E8D
(1128) 		dj->sect++;					/* Next sector */
    00D1D 8988      LDD	R24,Y+16
    00D1E 8999      LDD	R25,Y+17
    00D1F 960E      ADIW	R24,0xE
    00D20 E041      LDI	R20,1
    00D21 E050      LDI	R21,0
    00D22 E060      LDI	R22,0
    00D23 E070      LDI	R23,0
    00D24 01FC      MOVW	R30,R24
    00D25 8020      LD	R2,Z
    00D26 8031      LDD	R3,Z+1
    00D27 8042      LDD	R4,Z+2
    00D28 8053      LDD	R5,Z+3
    00D29 0E24      ADD	R2,R20
    00D2A 1E35      ADC	R3,R21
    00D2B 1E46      ADC	R4,R22
    00D2C 1E57      ADC	R5,R23
    00D2D 8220      ST	Z,R2
    00D2E 8231      STD	Z+1,R3
    00D2F 8242      STD	Z+2,R4
    00D30 8253      STD	Z+3,R5
(1129) 
(1130) 		if (dj->clust == 0) {	/* Static table */
    00D31 89E8      LDD	R30,Y+16
    00D32 89F9      LDD	R31,Y+17
    00D33 963A      ADIW	R30,0xA
    00D34 8020      LD	R2,Z
    00D35 8031      LDD	R3,Z+1
    00D36 8042      LDD	R4,Z+2
    00D37 8053      LDD	R5,Z+3
    00D38 9488      BCLR	0
    00D39 2022      TST	R2
    00D3A 0432      CPC	R3,R2
    00D3B 0442      CPC	R4,R2
    00D3C 0452      CPC	R5,R2
    00D3D F469      BNE	0x0D4B
(1131) 			if (i >= dj->fs->n_rootdir)	/* Report EOT when end of table */
    00D3E 89E8      LDD	R30,Y+16
    00D3F 89F9      LDD	R31,Y+17
    00D40 81A0      LD	R26,Z
    00D41 81B1      LDD	R27,Z+1
    00D42 9618      ADIW	R26,0x8
    00D43 902D      LD	R2,X+
    00D44 903C      LD	R3,X
    00D45 14C2      CP	R12,R2
    00D46 04D3      CPC	R13,R3
    00D47 F408      BCC	0x0D49
    00D48 C144      RJMP	0x0E8D
(1132) 				return FR_NO_FILE;
    00D49 E004      LDI	R16,4
    00D4A C158      RJMP	0x0EA3
(1133) 		}
(1134) 		else {					/* Dynamic table */
(1135) 			if (((i / (SS(dj->fs) / SZ_DIR)) & (dj->fs->csize - 1)) == 0) {	/* Cluster changed? */
    00D4B 89E8      LDD	R30,Y+16
    00D4C 89F9      LDD	R31,Y+17
    00D4D 93AF      PUSH	R26
    00D4E 93BF      PUSH	R27
    00D4F 81A0      LD	R26,Z
    00D50 81B1      LDD	R27,Z+1
    00D51 01FD      MOVW	R30,R26
    00D52 91BF      POP	R27
    00D53 91AF      POP	R26
    00D54 8182      LDD	R24,Z+2
    00D55 2799      CLR	R25
    00D56 9701      SBIW	R24,1
    00D57 0116      MOVW	R2,R12
    00D58 9436      LSR	R3
    00D59 9427      ROR	R2
    00D5A 9436      LSR	R3
    00D5B 9427      ROR	R2
    00D5C 9436      LSR	R3
    00D5D 9427      ROR	R2
    00D5E 9436      LSR	R3
    00D5F 9427      ROR	R2
    00D60 2228      AND	R2,R24
    00D61 2239      AND	R3,R25
    00D62 2022      TST	R2
    00D63 F009      BEQ	0x0D65
    00D64 C128      RJMP	0x0E8D
    00D65 2033      TST	R3
    00D66 F009      BEQ	0x0D68
    00D67 C125      RJMP	0x0E8D
(1136) 				clst = get_fat(dj->fs, dj->clust);				/* Get next cluster */
    00D68 89E8      LDD	R30,Y+16
    00D69 89F9      LDD	R31,Y+17
    00D6A 8422      LDD	R2,Z+10
    00D6B 8433      LDD	R3,Z+11
    00D6C 8444      LDD	R4,Z+12
    00D6D 8455      LDD	R5,Z+13
    00D6E 8248      ST	Y,R4
    00D6F 8259      STD	Y+1,R5
    00D70 0191      MOVW	R18,R2
    00D71 8100      LD	R16,Z
    00D72 8111      LDD	R17,Z+1
    00D73 D8C9      RCALL	_get_fat
    00D74 830A      STD	Y+2,R16
    00D75 831B      STD	Y+3,R17
    00D76 832C      STD	Y+4,R18
    00D77 833D      STD	Y+5,R19
(1137) 				if (clst <= 1) return FR_INT_ERR;
    00D78 E041      LDI	R20,1
    00D79 E050      LDI	R21,0
    00D7A E060      LDI	R22,0
    00D7B E070      LDI	R23,0
    00D7C 802A      LDD	R2,Y+2
    00D7D 803B      LDD	R3,Y+3
    00D7E 804C      LDD	R4,Y+4
    00D7F 805D      LDD	R5,Y+5
    00D80 1542      CP	R20,R2
    00D81 0553      CPC	R21,R3
    00D82 0564      CPC	R22,R4
    00D83 0575      CPC	R23,R5
    00D84 F010      BCS	0x0D87
    00D85 E002      LDI	R16,2
    00D86 C11C      RJMP	0x0EA3
(1138) 				if (clst == 0xFFFFFFFF) return FR_DISK_ERR;
    00D87 EF4F      LDI	R20,0xFF
    00D88 EF5F      LDI	R21,0xFF
    00D89 EF6F      LDI	R22,0xFF
    00D8A EF7F      LDI	R23,0xFF
    00D8B 802A      LDD	R2,Y+2
    00D8C 803B      LDD	R3,Y+3
    00D8D 804C      LDD	R4,Y+4
    00D8E 805D      LDD	R5,Y+5
    00D8F 1624      CP	R2,R20
    00D90 0635      CPC	R3,R21
    00D91 0646      CPC	R4,R22
    00D92 0657      CPC	R5,R23
    00D93 F411      BNE	0x0D96
    00D94 E001      LDI	R16,1
    00D95 C10D      RJMP	0x0EA3
(1139) 				if (clst >= dj->fs->n_fatent) {					/* When it reached end of dynamic table */
    00D96 89E8      LDD	R30,Y+16
    00D97 89F9      LDD	R31,Y+17
    00D98 81A0      LD	R26,Z
    00D99 81B1      LDD	R27,Z+1
    00D9A 9656      ADIW	R26,0x16
    00D9B 902D      LD	R2,X+
    00D9C 903D      LD	R3,X+
    00D9D 904D      LD	R4,X+
    00D9E 905C      LD	R5,X
    00D9F 806A      LDD	R6,Y+2
    00DA0 807B      LDD	R7,Y+3
    00DA1 808C      LDD	R8,Y+4
    00DA2 809D      LDD	R9,Y+5
    00DA3 1462      CP	R6,R2
    00DA4 0473      CPC	R7,R3
    00DA5 0484      CPC	R8,R4
    00DA6 0495      CPC	R9,R5
    00DA7 F408      BCC	0x0DA9
    00DA8 C0CD      RJMP	0x0E76
(1140) #if !_FS_READONLY
(1141) 					BYTE c;
(1142) 					if (!stretch) return FR_NO_FILE;			/* When do not stretch, report EOT */
    00DA9 20AA      TST	R10
    00DAA F421      BNE	0x0DAF
    00DAB 20BB      TST	R11
    00DAC F411      BNE	0x0DAF
    00DAD E004      LDI	R16,4
    00DAE C0F4      RJMP	0x0EA3
(1143) 					clst = create_chain(dj->fs, dj->clust);		/* Stretch cluster chain */
    00DAF 89E8      LDD	R30,Y+16
    00DB0 89F9      LDD	R31,Y+17
    00DB1 8422      LDD	R2,Z+10
    00DB2 8433      LDD	R3,Z+11
    00DB3 8444      LDD	R4,Z+12
    00DB4 8455      LDD	R5,Z+13
    00DB5 8248      ST	Y,R4
    00DB6 8259      STD	Y+1,R5
    00DB7 0191      MOVW	R18,R2
    00DB8 8100      LD	R16,Z
    00DB9 8111      LDD	R17,Z+1
    00DBA DC44      RCALL	ff.c:create_chain
    00DBB 830A      STD	Y+2,R16
    00DBC 831B      STD	Y+3,R17
    00DBD 832C      STD	Y+4,R18
    00DBE 833D      STD	Y+5,R19
(1144) 					if (clst == 0) return FR_DENIED;			/* No free cluster */
    00DBF 802A      LDD	R2,Y+2
    00DC0 803B      LDD	R3,Y+3
    00DC1 804C      LDD	R4,Y+4
    00DC2 805D      LDD	R5,Y+5
    00DC3 9488      BCLR	0
    00DC4 2022      TST	R2
    00DC5 0432      CPC	R3,R2
    00DC6 0442      CPC	R4,R2
    00DC7 0452      CPC	R5,R2
    00DC8 F411      BNE	0x0DCB
    00DC9 E007      LDI	R16,7
    00DCA C0D8      RJMP	0x0EA3
(1145) 					if (clst == 1) return FR_INT_ERR;
    00DCB E041      LDI	R20,1
    00DCC E050      LDI	R21,0
    00DCD E060      LDI	R22,0
    00DCE E070      LDI	R23,0
    00DCF 802A      LDD	R2,Y+2
    00DD0 803B      LDD	R3,Y+3
    00DD1 804C      LDD	R4,Y+4
    00DD2 805D      LDD	R5,Y+5
    00DD3 1624      CP	R2,R20
    00DD4 0635      CPC	R3,R21
    00DD5 0646      CPC	R4,R22
    00DD6 0657      CPC	R5,R23
    00DD7 F411      BNE	0x0DDA
    00DD8 E002      LDI	R16,2
    00DD9 C0C9      RJMP	0x0EA3
(1146) 					if (clst == 0xFFFFFFFF) return FR_DISK_ERR;
    00DDA EF4F      LDI	R20,0xFF
    00DDB EF5F      LDI	R21,0xFF
    00DDC EF6F      LDI	R22,0xFF
    00DDD EF7F      LDI	R23,0xFF
    00DDE 802A      LDD	R2,Y+2
    00DDF 803B      LDD	R3,Y+3
    00DE0 804C      LDD	R4,Y+4
    00DE1 805D      LDD	R5,Y+5
    00DE2 1624      CP	R2,R20
    00DE3 0635      CPC	R3,R21
    00DE4 0646      CPC	R4,R22
    00DE5 0657      CPC	R5,R23
    00DE6 F411      BNE	0x0DE9
    00DE7 E001      LDI	R16,1
    00DE8 C0BA      RJMP	0x0EA3
(1147) 					/* Clean-up stretched table */
(1148) 					if (move_window(dj->fs, 0)) return FR_DISK_ERR;	/* Flush active window */
    00DE9 E040      LDI	R20,0
    00DEA E050      LDI	R21,0
    00DEB E060      LDI	R22,0
    00DEC E070      LDI	R23,0
    00DED 8368      ST	Y,R22
    00DEE 8379      STD	Y+1,R23
    00DEF 019A      MOVW	R18,R20
    00DF0 89E8      LDD	R30,Y+16
    00DF1 89F9      LDD	R31,Y+17
    00DF2 8100      LD	R16,Z
    00DF3 8111      LDD	R17,Z+1
    00DF4 940E 0474 CALL	ff.c:move_window
    00DF6 2300      TST	R16
    00DF7 F011      BEQ	0x0DFA
    00DF8 E001      LDI	R16,1
    00DF9 C0A9      RJMP	0x0EA3
(1149) 					mem_set(dj->fs->win, 0, SS(dj->fs));			/* Clear window buffer */
    00DFA E080      LDI	R24,0
    00DFB E092      LDI	R25,2
    00DFC 8399      STD	Y+1,R25
    00DFD 8388      ST	Y,R24
    00DFE 2722      CLR	R18
    00DFF 2733      CLR	R19
    00E00 89E8      LDD	R30,Y+16
    00E01 89F9      LDD	R31,Y+17
    00E02 8100      LD	R16,Z
    00E03 8111      LDD	R17,Z+1
    00E04 5D02      SUBI	R16,0xD2
    00E05 4F1F      SBCI	R17,0xFF
    00E06 940E 0431 CALL	ff.c:mem_set
(1150) 					dj->fs->winsect = clust2sect(dj->fs, clst);	/* Cluster start sector */
    00E08 802A      LDD	R2,Y+2
    00E09 803B      LDD	R3,Y+3
    00E0A 804C      LDD	R4,Y+4
    00E0B 805D      LDD	R5,Y+5
    00E0C 8248      ST	Y,R4
    00E0D 8259      STD	Y+1,R5
    00E0E 0191      MOVW	R18,R2
    00E0F 89E8      LDD	R30,Y+16
    00E10 89F9      LDD	R31,Y+17
    00E11 80A0      LD	R10,Z
    00E12 80B1      LDD	R11,Z+1
    00E13 0185      MOVW	R16,R10
    00E14 940E 05EB CALL	_clust2sect
    00E16 01F5      MOVW	R30,R10
    00E17 A702      STD	Z+42,R16
    00E18 A713      STD	Z+43,R17
    00E19 A724      STD	Z+44,R18
    00E1A A735      STD	Z+45,R19
(1151) 					for (c = 0; c < dj->fs->csize; c++) {		/* Fill the new cluster with 0 */
    00E1B 24AA      CLR	R10
    00E1C C035      RJMP	0x0E52
(1152) 						dj->fs->wflag = 1;
    00E1D E081      LDI	R24,1
    00E1E 89E8      LDD	R30,Y+16
    00E1F 89F9      LDD	R31,Y+17
    00E20 93AF      PUSH	R26
    00E21 93BF      PUSH	R27
    00E22 81A0      LD	R26,Z
    00E23 81B1      LDD	R27,Z+1
    00E24 01FD      MOVW	R30,R26
    00E25 91BF      POP	R27
    00E26 91AF      POP	R26
    00E27 8384      STD	Z+4,R24
(1153) 						if (move_window(dj->fs, 0)) return FR_DISK_ERR;
    00E28 E040      LDI	R20,0
    00E29 E050      LDI	R21,0
    00E2A E060      LDI	R22,0
    00E2B E070      LDI	R23,0
    00E2C 8368      ST	Y,R22
    00E2D 8379      STD	Y+1,R23
    00E2E 019A      MOVW	R18,R20
    00E2F 89E8      LDD	R30,Y+16
    00E30 89F9      LDD	R31,Y+17
    00E31 8100      LD	R16,Z
    00E32 8111      LDD	R17,Z+1
    00E33 940E 0474 CALL	ff.c:move_window
    00E35 2EE0      MOV	R14,R16
    00E36 2300      TST	R16
    00E37 F011      BEQ	0x0E3A
    00E38 E001      LDI	R16,1
    00E39 C069      RJMP	0x0EA3
(1154) 						dj->fs->winsect++;
    00E3A 89E8      LDD	R30,Y+16
    00E3B 89F9      LDD	R31,Y+17
    00E3C 8180      LD	R24,Z
    00E3D 8191      LDD	R25,Z+1
    00E3E 968A      ADIW	R24,0x2A
    00E3F 017C      MOVW	R14,R24
    00E40 E041      LDI	R20,1
    00E41 E050      LDI	R21,0
    00E42 E060      LDI	R22,0
    00E43 E070      LDI	R23,0
    00E44 01FC      MOVW	R30,R24
    00E45 8020      LD	R2,Z
    00E46 8031      LDD	R3,Z+1
    00E47 8042      LDD	R4,Z+2
    00E48 8053      LDD	R5,Z+3
    00E49 0E24      ADD	R2,R20
    00E4A 1E35      ADC	R3,R21
    00E4B 1E46      ADC	R4,R22
    00E4C 1E57      ADC	R5,R23
    00E4D 8220      ST	Z,R2
    00E4E 8231      STD	Z+1,R3
    00E4F 8242      STD	Z+2,R4
    00E50 8253      STD	Z+3,R5
    00E51 94A3      INC	R10
    00E52 89E8      LDD	R30,Y+16
    00E53 89F9      LDD	R31,Y+17
    00E54 93AF      PUSH	R26
    00E55 93BF      PUSH	R27
    00E56 81A0      LD	R26,Z
    00E57 81B1      LDD	R27,Z+1
    00E58 01FD      MOVW	R30,R26
    00E59 91BF      POP	R27
    00E5A 91AF      POP	R26
    00E5B 8022      LDD	R2,Z+2
    00E5C 14A2      CP	R10,R2
    00E5D F408      BCC	0x0E5F
    00E5E CFBE      RJMP	0x0E1D
(1155) 					}
(1156) 					dj->fs->winsect -= c;						/* Rewind window address */
    00E5F 89E8      LDD	R30,Y+16
    00E60 89F9      LDD	R31,Y+17
    00E61 8180      LD	R24,Z
    00E62 8191      LDD	R25,Z+1
    00E63 968A      ADIW	R24,0x2A
    00E64 017C      MOVW	R14,R24
    00E65 2C2A      MOV	R2,R10
    00E66 2433      CLR	R3
    00E67 2444      CLR	R4
    00E68 2455      CLR	R5
    00E69 01FC      MOVW	R30,R24
    00E6A 8060      LD	R6,Z
    00E6B 8071      LDD	R7,Z+1
    00E6C 8082      LDD	R8,Z+2
    00E6D 8093      LDD	R9,Z+3
    00E6E 1862      SUB	R6,R2
    00E6F 0873      SBC	R7,R3
    00E70 0884      SBC	R8,R4
    00E71 0895      SBC	R9,R5
    00E72 8260      ST	Z,R6
    00E73 8271      STD	Z+1,R7
    00E74 8282      STD	Z+2,R8
    00E75 8293      STD	Z+3,R9
(1157) #else
(1158) 					return FR_NO_FILE;			/* Report EOT */
(1159) #endif
(1160) 				}
(1161) 				dj->clust = clst;				/* Initialize data for new cluster */
    00E76 802A      LDD	R2,Y+2
    00E77 803B      LDD	R3,Y+3
    00E78 804C      LDD	R4,Y+4
    00E79 805D      LDD	R5,Y+5
    00E7A 89E8      LDD	R30,Y+16
    00E7B 89F9      LDD	R31,Y+17
    00E7C 8622      STD	Z+10,R2
    00E7D 8633      STD	Z+11,R3
    00E7E 8644      STD	Z+12,R4
    00E7F 8655      STD	Z+13,R5
(1162) 				dj->sect = clust2sect(dj->fs, clst);
    00E80 8248      ST	Y,R4
    00E81 8259      STD	Y+1,R5
    00E82 0191      MOVW	R18,R2
    00E83 8100      LD	R16,Z
    00E84 8111      LDD	R17,Z+1
    00E85 940E 05EB CALL	_clust2sect
    00E87 89E8      LDD	R30,Y+16
    00E88 89F9      LDD	R31,Y+17
    00E89 8706      STD	Z+14,R16
    00E8A 8717      STD	Z+15,R17
    00E8B 8B20      STD	Z+16,R18
    00E8C 8B31      STD	Z+17,R19
(1163) 			}
(1164) 		}
(1165) 	}
(1166) 
(1167) 	dj->index = i;
    00E8D 89E8      LDD	R30,Y+16
    00E8E 89F9      LDD	R31,Y+17
    00E8F 82D5      STD	Z+5,R13
    00E90 82C4      STD	Z+4,R12
(1168) 	dj->dir = dj->fs->win + (i % (SS(dj->fs) / SZ_DIR)) * SZ_DIR;
    00E91 0196      MOVW	R18,R12
    00E92 702F      ANDI	R18,0xF
    00E93 7030      ANDI	R19,0
    00E94 E200      LDI	R16,0x20
    00E95 E010      LDI	R17,0
    00E96 940E 485F CALL	empy16s
    00E98 0118      MOVW	R2,R16
    00E99 89E8      LDD	R30,Y+16
    00E9A 89F9      LDD	R31,Y+17
    00E9B 8180      LD	R24,Z
    00E9C 8191      LDD	R25,Z+1
    00E9D 968E      ADIW	R24,0x2E
    00E9E 0E28      ADD	R2,R24
    00E9F 1E39      ADC	R3,R25
    00EA0 8A33      STD	Z+19,R3
    00EA1 8A22      STD	Z+18,R2
(1169) 
(1170) 	return FR_OK;
    00EA2 2700      CLR	R16
    00EA3 9626      ADIW	R28,6
    00EA4 940E 48B8 CALL	pop_xgsetF0FC
    00EA6 9624      ADIW	R28,4
    00EA7 9508      RET
ff.c:dir_find:
  c                    --> R12
  dir                  --> R10
  res                  --> R20
  dj                   --> R22
    00EA8 940E 48FE CALL	push_xgsetF03C
    00EAA 01B8      MOVW	R22,R16
    00EAB 9722      SBIW	R28,2
(1171) }
(1172) 
(1173) 
(1174) 
(1175) 
(1176) /*-----------------------------------------------------------------------*/
(1177) /* LFN handling - Test/Pick/Fit an LFN segment from/to directory entry   */
(1178) /*-----------------------------------------------------------------------*/
(1179) #if _USE_LFN
(1180) static
(1181) const BYTE LfnOfs[] = {1,3,5,7,9,14,16,18,20,22,24,28,30};	/* Offset of LFN chars in the directory entry */
(1182) 
(1183) 
(1184) static
(1185) int cmp_lfn (			/* 1:Matched, 0:Not matched */
(1186) 	WCHAR *lfnbuf,		/* Pointer to the LFN to be compared */
(1187) 	BYTE *dir			/* Pointer to the directory entry containing a part of LFN */
(1188) )
(1189) {
(1190) 	UINT i, s;
(1191) 	WCHAR wc, uc;
(1192) 
(1193) 
(1194) 	i = ((dir[LDIR_Ord] & ~LLE) - 1) * 13;	/* Get offset in the LFN buffer */
(1195) 	s = 0; wc = 1;
(1196) 	do {
(1197) 		uc = LD_WORD(dir+LfnOfs[s]);	/* Pick an LFN character from the entry */
(1198) 		if (wc) {	/* Last char has not been processed */
(1199) 			wc = ff_wtoupper(uc);		/* Convert it to upper case */
(1200) 			if (i >= _MAX_LFN || wc != ff_wtoupper(lfnbuf[i++]))	/* Compare it */
(1201) 				return 0;				/* Not matched */
(1202) 		} else {
(1203) 			if (uc != 0xFFFF) return 0;	/* Check filler */
(1204) 		}
(1205) 	} while (++s < 13);				/* Repeat until all chars in the entry are checked */
(1206) 
(1207) 	if ((dir[LDIR_Ord] & LLE) && wc && lfnbuf[i])	/* Last segment matched but different length */
(1208) 		return 0;
(1209) 
(1210) 	return 1;						/* The part of LFN matched */
(1211) }
(1212) 
(1213) 
(1214) 
(1215) static
(1216) int pick_lfn (			/* 1:Succeeded, 0:Buffer overflow */
(1217) 	WCHAR *lfnbuf,		/* Pointer to the Unicode-LFN buffer */
(1218) 	BYTE *dir			/* Pointer to the directory entry */
(1219) )
(1220) {
(1221) 	UINT i, s;
(1222) 	WCHAR wc, uc;
(1223) 
(1224) 
(1225) 	i = ((dir[LDIR_Ord] & 0x3F) - 1) * 13;	/* Offset in the LFN buffer */
(1226) 
(1227) 	s = 0; wc = 1;
(1228) 	do {
(1229) 		uc = LD_WORD(dir+LfnOfs[s]);		/* Pick an LFN character from the entry */
(1230) 		if (wc) {	/* Last char has not been processed */
(1231) 			if (i >= _MAX_LFN) return 0;	/* Buffer overflow? */
(1232) 			lfnbuf[i++] = wc = uc;			/* Store it */
(1233) 		} else {
(1234) 			if (uc != 0xFFFF) return 0;		/* Check filler */
(1235) 		}
(1236) 	} while (++s < 13);						/* Read all character in the entry */
(1237) 
(1238) 	if (dir[LDIR_Ord] & LLE) {				/* Put terminator if it is the last LFN part */
(1239) 		if (i >= _MAX_LFN) return 0;		/* Buffer overflow? */
(1240) 		lfnbuf[i] = 0;
(1241) 	}
(1242) 
(1243) 	return 1;
(1244) }
(1245) 
(1246) 
(1247) #if !_FS_READONLY
(1248) static
(1249) void fit_lfn (
(1250) 	const WCHAR *lfnbuf,	/* Pointer to the LFN buffer */
(1251) 	BYTE *dir,				/* Pointer to the directory entry */
(1252) 	BYTE ord,				/* LFN order (1-20) */
(1253) 	BYTE sum				/* SFN sum */
(1254) )
(1255) {
(1256) 	UINT i, s;
(1257) 	WCHAR wc;
(1258) 
(1259) 
(1260) 	dir[LDIR_Chksum] = sum;			/* Set check sum */
(1261) 	dir[LDIR_Attr] = AM_LFN;		/* Set attribute. LFN entry */
(1262) 	dir[LDIR_Type] = 0;
(1263) 	ST_WORD(dir+LDIR_FstClusLO, 0);
(1264) 
(1265) 	i = (ord - 1) * 13;				/* Get offset in the LFN buffer */
(1266) 	s = wc = 0;
(1267) 	do {
(1268) 		if (wc != 0xFFFF) wc = lfnbuf[i++];	/* Get an effective char */
(1269) 		ST_WORD(dir+LfnOfs[s], wc);	/* Put it */
(1270) 		if (!wc) wc = 0xFFFF;		/* Padding chars following last char */
(1271) 	} while (++s < 13);
(1272) 	if (wc == 0xFFFF || !lfnbuf[i]) ord |= LLE;	/* Bottom LFN part is the start of LFN sequence */
(1273) 	dir[LDIR_Ord] = ord;			/* Set the LFN order */
(1274) }
(1275) 
(1276) #endif
(1277) #endif
(1278) 
(1279) 
(1280) 
(1281) /*-----------------------------------------------------------------------*/
(1282) /* Create numbered name                                                  */
(1283) /*-----------------------------------------------------------------------*/
(1284) #if _USE_LFN
(1285) void gen_numname (
(1286) 	BYTE *dst,			/* Pointer to generated SFN */
(1287) 	const BYTE *src,	/* Pointer to source SFN to be modified */
(1288) 	const WCHAR *lfn,	/* Pointer to LFN */
(1289) 	WORD seq			/* Sequence number */
(1290) )
(1291) {
(1292) 	BYTE ns[8], c;
(1293) 	UINT i, j;
(1294) 
(1295) 
(1296) 	mem_cpy(dst, src, 11);
(1297) 
(1298) 	if (seq > 5) {	/* On many collisions, generate a hash number instead of sequential number */
(1299) 		do seq = (seq >> 1) + (seq << 15) + (WORD)*lfn++; while (*lfn);
(1300) 	}
(1301) 
(1302) 	/* itoa (hexdecimal) */
(1303) 	i = 7;
(1304) 	do {
(1305) 		c = (seq % 16) + '0';
(1306) 		if (c > '9') c += 7;
(1307) 		ns[i--] = c;
(1308) 		seq /= 16;
(1309) 	} while (seq);
(1310) 	ns[i] = '~';
(1311) 
(1312) 	/* Append the number */
(1313) 	for (j = 0; j < i && dst[j] != ' '; j++) {
(1314) 		if (IsDBCS1(dst[j])) {
(1315) 			if (j == i - 1) break;
(1316) 			j++;
(1317) 		}
(1318) 	}
(1319) 	do {
(1320) 		dst[j++] = (i < 8) ? ns[i++] : ' ';
(1321) 	} while (j < 8);
(1322) }
(1323) #endif
(1324) 
(1325) 
(1326) 
(1327) 
(1328) /*-----------------------------------------------------------------------*/
(1329) /* Calculate sum of an SFN                                               */
(1330) /*-----------------------------------------------------------------------*/
(1331) #if _USE_LFN
(1332) static
(1333) BYTE sum_sfn (
(1334) 	const BYTE *dir		/* Ptr to directory entry */
(1335) )
(1336) {
(1337) 	BYTE sum = 0;
(1338) 	UINT n = 11;
(1339) 
(1340) 	do sum = (sum >> 1) + (sum << 7) + *dir++; while (--n);
(1341) 	return sum;
(1342) }
(1343) #endif
(1344) 
(1345) 
(1346) 
(1347) 
(1348) /*-----------------------------------------------------------------------*/
(1349) /* Directory handling - Find an object in the directory                  */
(1350) /*-----------------------------------------------------------------------*/
(1351) 
(1352) static
(1353) FRESULT dir_find (
(1354) 	DIR *dj			/* Pointer to the directory object linked to the file name */
(1355) )
(1356) {
(1357) 	FRESULT res;
(1358) 	BYTE c, *dir;
(1359) #if _USE_LFN
(1360) 	BYTE a, ord, sum;
(1361) #endif
(1362) 
(1363) 	res = dir_sdi(dj, 0);			/* Rewind directory object */
    00EAC 2722      CLR	R18
    00EAD 2733      CLR	R19
    00EAE 018B      MOVW	R16,R22
    00EAF DD40      RCALL	ff.c:dir_sdi
    00EB0 2F40      MOV	R20,R16
(1364) 	if (res != FR_OK) return res;
    00EB1 2300      TST	R16
    00EB2 F009      BEQ	0x0EB4
    00EB3 C036      RJMP	0x0EEA
(1365) 
(1366) #if _USE_LFN
(1367) 	ord = sum = 0xFF;
(1368) #endif
(1369) 	do {
(1370) 		res = move_window(dj->fs, dj->sect);
    00EB4 01FB      MOVW	R30,R22
    00EB5 8426      LDD	R2,Z+14
    00EB6 8437      LDD	R3,Z+15
    00EB7 8840      LDD	R4,Z+16
    00EB8 8851      LDD	R5,Z+17
    00EB9 8248      ST	Y,R4
    00EBA 8259      STD	Y+1,R5
    00EBB 0191      MOVW	R18,R2
    00EBC 8100      LD	R16,Z
    00EBD 8111      LDD	R17,Z+1
    00EBE 940E 0474 CALL	ff.c:move_window
    00EC0 2F40      MOV	R20,R16
(1371) 		if (res != FR_OK) break;
    00EC1 2300      TST	R16
    00EC2 F009      BEQ	0x0EC4
    00EC3 C025      RJMP	0x0EE9
(1372) 		dir = dj->dir;					/* Ptr to the directory entry of current index */
    00EC4 01FB      MOVW	R30,R22
    00EC5 88A2      LDD	R10,Z+18
    00EC6 88B3      LDD	R11,Z+19
(1373) 		c = dir[DIR_Name];
    00EC7 01F5      MOVW	R30,R10
    00EC8 80C0      LD	R12,Z
(1374) 		if (c == 0) { res = FR_NO_FILE; break; }	/* Reached to end of table */
    00EC9 20CC      TST	R12
    00ECA F411      BNE	0x0ECD
    00ECB E044      LDI	R20,4
    00ECC C01C      RJMP	0x0EE9
(1375) #if _USE_LFN	/* LFN configuration */
(1376) 		a = dir[DIR_Attr] & AM_MASK;
(1377) 		if (c == DDE || ((a & AM_VOL) && a != AM_LFN)) {	/* An entry without valid data */
(1378) 			ord = 0xFF;
(1379) 		} else {
(1380) 			if (a == AM_LFN) {			/* An LFN entry is found */
(1381) 				if (dj->lfn) {
(1382) 					if (c & LLE) {		/* Is it start of LFN sequence? */
(1383) 						sum = dir[LDIR_Chksum];
(1384) 						c &= ~LLE; ord = c;	/* LFN start order */
(1385) 						dj->lfn_idx = dj->index;
(1386) 					}
(1387) 					/* Check validity of the LFN entry and compare it with given name */
(1388) 					ord = (c == ord && sum == dir[LDIR_Chksum] && cmp_lfn(dj->lfn, dir)) ? ord - 1 : 0xFF;
(1389) 				}
(1390) 			} else {					/* An SFN entry is found */
(1391) 				if (!ord && sum == sum_sfn(dir)) break;	/* LFN matched? */
(1392) 				ord = 0xFF; dj->lfn_idx = 0xFFFF;	/* Reset LFN sequence */
(1393) 				if (!(dj->fn[NS] & NS_LOSS) && !mem_cmp(dir, dj->fn, 11)) break;	/* SFN matched? */
(1394) 			}
(1395) 		}
(1396) #else		/* Non LFN configuration */
(1397) 		if (!(dir[DIR_Attr] & AM_VOL) && !mem_cmp(dir, dj->fn, 11)) /* Is it a valid entry? */
    00ECD 01F5      MOVW	R30,R10
    00ECE 8423      LDD	R2,Z+11
    00ECF FC23      SBRC	R2,3
    00ED0 C00F      RJMP	0x0EE0
    00ED1 E08B      LDI	R24,0xB
    00ED2 E090      LDI	R25,0
    00ED3 8399      STD	Y+1,R25
    00ED4 8388      ST	Y,R24
    00ED5 01FB      MOVW	R30,R22
    00ED6 8924      LDD	R18,Z+20
    00ED7 8935      LDD	R19,Z+21
    00ED8 0185      MOVW	R16,R10
    00ED9 940E 0443 CALL	ff.c:mem_cmp
    00EDB 0158      MOVW	R10,R16
    00EDC 3000      CPI	R16,0
    00EDD 0701      CPC	R16,R17
    00EDE F409      BNE	0x0EE0
(1398) 			break;
    00EDF C009      RJMP	0x0EE9
(1399) #endif
(1400) 		res = dir_next(dj, 0);		/* Next entry */
    00EE0 2722      CLR	R18
    00EE1 2733      CLR	R19
    00EE2 018B      MOVW	R16,R22
    00EE3 DE16      RCALL	ff.c:dir_next
    00EE4 2EA0      MOV	R10,R16
    00EE5 2D4A      MOV	R20,R10
(1401) 	} while (res == FR_OK);
    00EE6 2344      TST	R20
    00EE7 F409      BNE	0x0EE9
    00EE8 CFCB      RJMP	0x0EB4
(1402) 
(1403) 	return res;
    00EE9 2F04      MOV	R16,R20
    00EEA 9622      ADIW	R28,2
    00EEB 940C 4907 JMP	pop_xgsetF03C
ff.c:dir_read:
  dir                  --> R10
  c                    --> R12
  res                  --> R20
  dj                   --> R22
    00EED 940E 48FE CALL	push_xgsetF03C
    00EEF 01B8      MOVW	R22,R16
    00EF0 9722      SBIW	R28,2
(1404) }
(1405) 
(1406) 
(1407) 
(1408) 
(1409) /*-----------------------------------------------------------------------*/
(1410) /* Read an object from the directory                                     */
(1411) /*-----------------------------------------------------------------------*/
(1412) #if _FS_MINIMIZE <= 1
(1413) static
(1414) FRESULT dir_read (
(1415) 	DIR *dj			/* Pointer to the directory object that pointing the entry to be read */
(1416) )
(1417) {
(1418) 	FRESULT res;
(1419) 	BYTE c, *dir;
(1420) #if _USE_LFN
(1421) 	BYTE a, ord = 0xFF, sum = 0xFF;
(1422) #endif
(1423) 
(1424) 	res = FR_NO_FILE;
    00EF1 E044      LDI	R20,4
    00EF2 C02B      RJMP	0x0F1E
(1425) 	while (dj->sect) {
(1426) 		res = move_window(dj->fs, dj->sect);
    00EF3 01FB      MOVW	R30,R22
    00EF4 8426      LDD	R2,Z+14
    00EF5 8437      LDD	R3,Z+15
    00EF6 8840      LDD	R4,Z+16
    00EF7 8851      LDD	R5,Z+17
    00EF8 8248      ST	Y,R4
    00EF9 8259      STD	Y+1,R5
    00EFA 0191      MOVW	R18,R2
    00EFB 8100      LD	R16,Z
    00EFC 8111      LDD	R17,Z+1
    00EFD 940E 0474 CALL	ff.c:move_window
    00EFF 2F40      MOV	R20,R16
(1427) 		if (res != FR_OK) break;
    00F00 2300      TST	R16
    00F01 F009      BEQ	0x0F03
    00F02 C028      RJMP	0x0F2B
(1428) 		dir = dj->dir;					/* Ptr to the directory entry of current index */
    00F03 01FB      MOVW	R30,R22
    00F04 88A2      LDD	R10,Z+18
    00F05 88B3      LDD	R11,Z+19
(1429) 		c = dir[DIR_Name];
    00F06 01F5      MOVW	R30,R10
    00F07 80C0      LD	R12,Z
(1430) 		if (c == 0) { res = FR_NO_FILE; break; }	/* Reached to end of table */
    00F08 20CC      TST	R12
    00F09 F411      BNE	0x0F0C
    00F0A E044      LDI	R20,4
    00F0B C01F      RJMP	0x0F2B
(1431) #if _USE_LFN	/* LFN configuration */
(1432) 		a = dir[DIR_Attr] & AM_MASK;
(1433) 		if (c == DDE || (!_FS_RPATH && c == '.') || ((a & AM_VOL) && a != AM_LFN)) {	/* An entry without valid data */
(1434) 			ord = 0xFF;
(1435) 		} else {
(1436) 			if (a == AM_LFN) {			/* An LFN entry is found */
(1437) 				if (c & LLE) {			/* Is it start of LFN sequence? */
(1438) 					sum = dir[LDIR_Chksum];
(1439) 					c &= ~LLE; ord = c;
(1440) 					dj->lfn_idx = dj->index;
(1441) 				}
(1442) 				/* Check LFN validity and capture it */
(1443) 				ord = (c == ord && sum == dir[LDIR_Chksum] && pick_lfn(dj->lfn, dir)) ? ord - 1 : 0xFF;
(1444) 			} else {					/* An SFN entry is found */
(1445) 				if (ord || sum != sum_sfn(dir))	/* Is there a valid LFN? */
(1446) 					dj->lfn_idx = 0xFFFF;		/* It has no LFN. */
(1447) 				break;
(1448) 			}
(1449) 		}
(1450) #else		/* Non LFN configuration */
(1451) 		if (c != DDE && (_FS_RPATH || c != '.') && !(dir[DIR_Attr] & AM_VOL))	/* Is it a valid entry? */
    00F0C 2D8C      MOV	R24,R12
    00F0D 3E85      CPI	R24,0xE5
    00F0E F039      BEQ	0x0F16
    00F0F 328E      CPI	R24,0x2E
    00F10 F029      BEQ	0x0F16
    00F11 01F5      MOVW	R30,R10
    00F12 8423      LDD	R2,Z+11
    00F13 FC23      SBRC	R2,3
    00F14 C001      RJMP	0x0F16
(1452) 			break;
    00F15 C015      RJMP	0x0F2B
(1453) #endif
(1454) 		res = dir_next(dj, 0);				/* Next entry */
    00F16 2722      CLR	R18
    00F17 2733      CLR	R19
    00F18 018B      MOVW	R16,R22
    00F19 DDE0      RCALL	ff.c:dir_next
    00F1A 2F40      MOV	R20,R16
(1455) 		if (res != FR_OK) break;
    00F1B 2300      TST	R16
    00F1C F009      BEQ	0x0F1E
    00F1D C00D      RJMP	0x0F2B
    00F1E 01FB      MOVW	R30,R22
    00F1F 963E      ADIW	R30,0xE
    00F20 8020      LD	R2,Z
    00F21 8031      LDD	R3,Z+1
    00F22 8042      LDD	R4,Z+2
    00F23 8053      LDD	R5,Z+3
    00F24 9488      BCLR	0
    00F25 2022      TST	R2
    00F26 0432      CPC	R3,R2
    00F27 0442      CPC	R4,R2
    00F28 0452      CPC	R5,R2
    00F29 F009      BEQ	0x0F2B
    00F2A CFC8      RJMP	0x0EF3
(1456) 	}
(1457) 
(1458) 	if (res != FR_OK) dj->sect = 0;
    00F2B 2344      TST	R20
    00F2C F039      BEQ	0x0F34
    00F2D 01FB      MOVW	R30,R22
    00F2E 963E      ADIW	R30,0xE
    00F2F E080      LDI	R24,0
    00F30 8380      ST	Z,R24
    00F31 8381      STD	Z+1,R24
    00F32 8382      STD	Z+2,R24
    00F33 8383      STD	Z+3,R24
(1459) 
(1460) 	return res;
    00F34 2F04      MOV	R16,R20
    00F35 9622      ADIW	R28,2
    00F36 940C 4907 JMP	pop_xgsetF03C
ff.c:dir_register:
  dir                  --> R12
  c                    --> R22
  res                  --> R10
  dj                   --> R20
    00F38 940E 48FE CALL	push_xgsetF03C
    00F3A 01A8      MOVW	R20,R16
    00F3B 9722      SBIW	R28,2
(1461) }
(1462) #endif
(1463) 
(1464) 
(1465) 
(1466) /*-----------------------------------------------------------------------*/
(1467) /* Register an object to the directory                                   */
(1468) /*-----------------------------------------------------------------------*/
(1469) #if !_FS_READONLY
(1470) static
(1471) FRESULT dir_register (	/* FR_OK:Successful, FR_DENIED:No free entry or too many SFN collision, FR_DISK_ERR:Disk error */
(1472) 	DIR *dj				/* Target directory with object name to be created */
(1473) )
(1474) {
(1475) 	FRESULT res;
(1476) 	BYTE c, *dir;
(1477) #if _USE_LFN	/* LFN configuration */
(1478) 	WORD n, ne, is;
(1479) 	BYTE sn[12], *fn, sum;
(1480) 	WCHAR *lfn;
(1481) 
(1482) 
(1483) 	fn = dj->fn; lfn = dj->lfn;
(1484) 	mem_cpy(sn, fn, 12);
(1485) 
(1486) 	if (_FS_RPATH && (sn[NS] & NS_DOT))		/* Cannot create dot entry */
(1487) 		return FR_INVALID_NAME;
(1488) 
(1489) 	if (sn[NS] & NS_LOSS) {			/* When LFN is out of 8.3 format, generate a numbered name */
(1490) 		fn[NS] = 0; dj->lfn = 0;			/* Find only SFN */
(1491) 		for (n = 1; n < 100; n++) {
(1492) 			gen_numname(fn, sn, lfn, n);	/* Generate a numbered name */
(1493) 			res = dir_find(dj);				/* Check if the name collides with existing SFN */
(1494) 			if (res != FR_OK) break;
(1495) 		}
(1496) 		if (n == 100) return FR_DENIED;		/* Abort if too many collisions */
(1497) 		if (res != FR_NO_FILE) return res;	/* Abort if the result is other than 'not collided' */
(1498) 		fn[NS] = sn[NS]; dj->lfn = lfn;
(1499) 	}
(1500) 
(1501) 	if (sn[NS] & NS_LFN) {			/* When LFN is to be created, reserve an SFN + LFN entries. */
(1502) 		for (ne = 0; lfn[ne]; ne++) ;
(1503) 		ne = (ne + 25) / 13;
(1504) 	} else {						/* Otherwise reserve only an SFN entry. */
(1505) 		ne = 1;
(1506) 	}
(1507) 
(1508) 	/* Reserve contiguous entries */
(1509) 	res = dir_sdi(dj, 0);
(1510) 	if (res != FR_OK) return res;
(1511) 	n = is = 0;
(1512) 	do {
(1513) 		res = move_window(dj->fs, dj->sect);
(1514) 		if (res != FR_OK) break;
(1515) 		c = *dj->dir;				/* Check the entry status */
(1516) 		if (c == DDE || c == 0) {	/* Is it a blank entry? */
(1517) 			if (n == 0) is = dj->index;	/* First index of the contiguous entry */
(1518) 			if (++n == ne) break;	/* A contiguous entry that required count is found */
(1519) 		} else {
(1520) 			n = 0;					/* Not a blank entry. Restart to search */
(1521) 		}
(1522) 		res = dir_next(dj, 1);		/* Next entry with table stretch */
(1523) 	} while (res == FR_OK);
(1524) 
(1525) 	if (res == FR_OK && ne > 1) {	/* Initialize LFN entry if needed */
(1526) 		res = dir_sdi(dj, is);
(1527) 		if (res == FR_OK) {
(1528) 			sum = sum_sfn(dj->fn);	/* Sum of the SFN tied to the LFN */
(1529) 			ne--;
(1530) 			do {					/* Store LFN entries in bottom first */
(1531) 				res = move_window(dj->fs, dj->sect);
(1532) 				if (res != FR_OK) break;
(1533) 				fit_lfn(dj->lfn, dj->dir, (BYTE)ne, sum);
(1534) 				dj->fs->wflag = 1;
(1535) 				res = dir_next(dj, 0);	/* Next entry */
(1536) 			} while (res == FR_OK && --ne);
(1537) 		}
(1538) 	}
(1539) 
(1540) #else	/* Non LFN configuration */
(1541) 	res = dir_sdi(dj, 0);
    00F3C 2722      CLR	R18
    00F3D 2733      CLR	R19
    00F3E 018A      MOVW	R16,R20
    00F3F DCB0      RCALL	ff.c:dir_sdi
    00F40 2EA0      MOV	R10,R16
(1542) 	if (res == FR_OK) {
    00F41 2300      TST	R16
    00F42 F509      BNE	0x0F64
(1543) 		do {	/* Find a blank entry for the SFN */
(1544) 			res = move_window(dj->fs, dj->sect);
    00F43 01FA      MOVW	R30,R20
    00F44 8426      LDD	R2,Z+14
    00F45 8437      LDD	R3,Z+15
    00F46 8840      LDD	R4,Z+16
    00F47 8851      LDD	R5,Z+17
    00F48 8248      ST	Y,R4
    00F49 8259      STD	Y+1,R5
    00F4A 0191      MOVW	R18,R2
    00F4B 8100      LD	R16,Z
    00F4C 8111      LDD	R17,Z+1
    00F4D 940E 0474 CALL	ff.c:move_window
    00F4F 2EA0      MOV	R10,R16
(1545) 			if (res != FR_OK) break;
    00F50 2300      TST	R16
    00F51 F009      BEQ	0x0F53
    00F52 C011      RJMP	0x0F64
(1546) 			c = *dj->dir;
    00F53 01FA      MOVW	R30,R20
    00F54 89A2      LDD	R26,Z+18
    00F55 89B3      LDD	R27,Z+19
    00F56 916C      LD	R22,X
(1547) 			if (c == DDE || c == 0) break;	/* Is it a blank entry? */
    00F57 3E65      CPI	R22,0xE5
    00F58 F011      BEQ	0x0F5B
    00F59 2366      TST	R22
    00F5A F409      BNE	0x0F5C
    00F5B C008      RJMP	0x0F64
(1548) 			res = dir_next(dj, 1);			/* Next entry with table stretch */
    00F5C E021      LDI	R18,1
    00F5D E030      LDI	R19,0
    00F5E 018A      MOVW	R16,R20
    00F5F DD9A      RCALL	ff.c:dir_next
    00F60 2EC0      MOV	R12,R16
    00F61 2CAC      MOV	R10,R12
(1549) 		} while (res == FR_OK);
    00F62 20AA      TST	R10
    00F63 F2F9      BEQ	0x0F43
(1550) 	}
(1551) #endif
(1552) 
(1553) 	if (res == FR_OK) {		/* Initialize the SFN entry */
    00F64 20AA      TST	R10
    00F65 F009      BEQ	0x0F67
    00F66 C030      RJMP	0x0F97
(1554) 		res = move_window(dj->fs, dj->sect);
    00F67 01FA      MOVW	R30,R20
    00F68 8426      LDD	R2,Z+14
    00F69 8437      LDD	R3,Z+15
    00F6A 8840      LDD	R4,Z+16
    00F6B 8851      LDD	R5,Z+17
    00F6C 8248      ST	Y,R4
    00F6D 8259      STD	Y+1,R5
    00F6E 0191      MOVW	R18,R2
    00F6F 8100      LD	R16,Z
    00F70 8111      LDD	R17,Z+1
    00F71 940E 0474 CALL	ff.c:move_window
    00F73 2EC0      MOV	R12,R16
    00F74 2CAC      MOV	R10,R12
(1555) 		if (res == FR_OK) {
    00F75 2300      TST	R16
    00F76 F501      BNE	0x0F97
(1556) 			dir = dj->dir;
    00F77 01FA      MOVW	R30,R20
    00F78 88C2      LDD	R12,Z+18
    00F79 88D3      LDD	R13,Z+19
(1557) 			mem_set(dir, 0, SZ_DIR);	/* Clean the entry */
    00F7A E280      LDI	R24,0x20
    00F7B E090      LDI	R25,0
    00F7C 8399      STD	Y+1,R25
    00F7D 8388      ST	Y,R24
    00F7E 2722      CLR	R18
    00F7F 2733      CLR	R19
    00F80 0186      MOVW	R16,R12
    00F81 940E 0431 CALL	ff.c:mem_set
(1558) 			mem_cpy(dir, dj->fn, 11);	/* Put SFN */
    00F83 E08B      LDI	R24,0xB
    00F84 E090      LDI	R25,0
    00F85 8399      STD	Y+1,R25
    00F86 8388      ST	Y,R24
    00F87 01FA      MOVW	R30,R20
    00F88 8924      LDD	R18,Z+20
    00F89 8935      LDD	R19,Z+21
    00F8A 0186      MOVW	R16,R12
    00F8B 940E 041B CALL	ff.c:mem_cpy
(1559) #if _USE_LFN
(1560) 			dir[DIR_NTres] = *(dj->fn+NS) & (NS_BODY | NS_EXT);	/* Put NT flag */
(1561) #endif
(1562) 			dj->fs->wflag = 1;
    00F8D E081      LDI	R24,1
    00F8E 01FA      MOVW	R30,R20
    00F8F 93AF      PUSH	R26
    00F90 93BF      PUSH	R27
    00F91 81A0      LD	R26,Z
    00F92 81B1      LDD	R27,Z+1
    00F93 01FD      MOVW	R30,R26
    00F94 91BF      POP	R27
    00F95 91AF      POP	R26
    00F96 8384      STD	Z+4,R24
(1563) 		}
(1564) 	}
(1565) 
(1566) 	return res;
    00F97 2D0A      MOV	R16,R10
    00F98 9622      ADIW	R28,2
    00F99 940C 4907 JMP	pop_xgsetF03C
ff.c:create_name:
  si                   --> R22
  b                    --> Y,+8
  sfn                  --> Y,+6
  ni                   --> R12
  d                    --> R10
  i                    --> Y,+4
  p                    --> Y,+2
  c                    --> R20
  path                 --> Y,+19
  dj                   --> R20
    00F9B 933A      ST	-Y,R19
    00F9C 932A      ST	-Y,R18
    00F9D 940E 48C3 CALL	push_xgsetF0FC
    00F9F 01A8      MOVW	R20,R16
    00FA0 9729      SBIW	R28,0x9
(1567) }
(1568) #endif /* !_FS_READONLY */
(1569) 
(1570) 
(1571) 
(1572) 
(1573) /*-----------------------------------------------------------------------*/
(1574) /* Remove an object from the directory                                   */
(1575) /*-----------------------------------------------------------------------*/
(1576) #if !_FS_READONLY && !_FS_MINIMIZE
(1577) static
(1578) FRESULT dir_remove (	/* FR_OK: Successful, FR_DISK_ERR: A disk error */
(1579) 	DIR *dj				/* Directory object pointing the entry to be removed */
(1580) )
(1581) {
(1582) 	FRESULT res;
(1583) #if _USE_LFN	/* LFN configuration */
(1584) 	WORD i;
(1585) 
(1586) 	i = dj->index;	/* SFN index */
(1587) 	res = dir_sdi(dj, (WORD)((dj->lfn_idx == 0xFFFF) ? i : dj->lfn_idx));	/* Goto the SFN or top of the LFN entries */
(1588) 	if (res == FR_OK) {
(1589) 		do {
(1590) 			res = move_window(dj->fs, dj->sect);
(1591) 			if (res != FR_OK) break;
(1592) 			*dj->dir = DDE;			/* Mark the entry "deleted" */
(1593) 			dj->fs->wflag = 1;
(1594) 			if (dj->index >= i) break;	/* When reached SFN, all entries of the object has been deleted. */
(1595) 			res = dir_next(dj, 0);		/* Next entry */
(1596) 		} while (res == FR_OK);
(1597) 		if (res == FR_NO_FILE) res = FR_INT_ERR;
(1598) 	}
(1599) 
(1600) #else			/* Non LFN configuration */
(1601) 	res = dir_sdi(dj, dj->index);
(1602) 	if (res == FR_OK) {
(1603) 		res = move_window(dj->fs, dj->sect);
(1604) 		if (res == FR_OK) {
(1605) 			*dj->dir = DDE;			/* Mark the entry "deleted" */
(1606) 			dj->fs->wflag = 1;
(1607) 		}
(1608) 	}
(1609) #endif
(1610) 
(1611) 	return res;
(1612) }
(1613) #endif /* !_FS_READONLY */
(1614) 
(1615) 
(1616) 
(1617) 
(1618) /*-----------------------------------------------------------------------*/
(1619) /* Pick a segment and create the object name in directory form           */
(1620) /*-----------------------------------------------------------------------*/
(1621) 
(1622) static
(1623) FRESULT create_name (
(1624) 	DIR *dj,			/* Pointer to the directory object */
(1625) 	const TCHAR **path	/* Pointer to pointer to the segment in the path string */
(1626) )
(1627) {
(1628) #ifdef _EXCVT
(1629) 	static const BYTE excvt[] = _EXCVT;	/* Upper conversion table for extended chars */
(1630) #endif
(1631) 
(1632) #if _USE_LFN	/* LFN configuration */
(1633) 	BYTE b, cf;
(1634) 	WCHAR w, *lfn;
(1635) 	UINT i, ni, si, di;
(1636) 	const TCHAR *p;
(1637) 
(1638) 	/* Create LFN in Unicode */
(1639) 	for (p = *path; *p == '/' || *p == '\\'; p++) ;	/* Strip duplicated separator */
(1640) 	lfn = dj->lfn;
(1641) 	si = di = 0;
(1642) 	for (;;) {
(1643) 		w = p[si++];					/* Get a character */
(1644) 		if (w < ' ' || w == '/' || w == '\\') break;	/* Break on end of segment */
(1645) 		if (di >= _MAX_LFN)				/* Reject too long name */
(1646) 			return FR_INVALID_NAME;
(1647) #if !_LFN_UNICODE
(1648) 		w &= 0xFF;
(1649) 		if (IsDBCS1(w)) {				/* Check if it is a DBC 1st byte (always false on SBCS cfg) */
(1650) 			b = (BYTE)p[si++];			/* Get 2nd byte */
(1651) 			if (!IsDBCS2(b))
(1652) 				return FR_INVALID_NAME;	/* Reject invalid sequence */
(1653) 			w = (w << 8) + b;			/* Create a DBC */
(1654) 		}
(1655) 		w = ff_convert(w, 1);			/* Convert ANSI/OEM to Unicode */
(1656) 		if (!w) return FR_INVALID_NAME;	/* Reject invalid code */
(1657) #endif
(1658) 		if (w < 0x80 && chk_chr("\"*:<>\?|\x7F", w)) /* Reject illegal chars for LFN */
(1659) 			return FR_INVALID_NAME;
(1660) 		lfn[di++] = w;					/* Store the Unicode char */
(1661) 	}
(1662) 	*path = &p[si];						/* Return pointer to the next segment */
(1663) 	cf = (w < ' ') ? NS_LAST : 0;		/* Set last segment flag if end of path */
(1664) #if _FS_RPATH
(1665) 	if ((di == 1 && lfn[di-1] == '.') || /* Is this a dot entry? */
(1666) 		(di == 2 && lfn[di-1] == '.' && lfn[di-2] == '.')) {
(1667) 		lfn[di] = 0;
(1668) 		for (i = 0; i < 11; i++)
(1669) 			dj->fn[i] = (i < di) ? '.' : ' ';
(1670) 		dj->fn[i] = cf | NS_DOT;		/* This is a dot entry */
(1671) 		return FR_OK;
(1672) 	}
(1673) #endif
(1674) 	while (di) {						/* Strip trailing spaces and dots */
(1675) 		w = lfn[di-1];
(1676) 		if (w != ' ' && w != '.') break;
(1677) 		di--;
(1678) 	}
(1679) 	if (!di) return FR_INVALID_NAME;	/* Reject nul string */
(1680) 
(1681) 	lfn[di] = 0;						/* LFN is created */
(1682) 
(1683) 	/* Create SFN in directory form */
(1684) 	mem_set(dj->fn, ' ', 11);
(1685) 	for (si = 0; lfn[si] == ' ' || lfn[si] == '.'; si++) ;	/* Strip leading spaces and dots */
(1686) 	if (si) cf |= NS_LOSS | NS_LFN;
(1687) 	while (di && lfn[di - 1] != '.') di--;	/* Find extension (di<=si: no extension) */
(1688) 
(1689) 	b = i = 0; ni = 8;
(1690) 	for (;;) {
(1691) 		w = lfn[si++];					/* Get an LFN char */
(1692) 		if (!w) break;					/* Break on end of the LFN */
(1693) 		if (w == ' ' || (w == '.' && si != di)) {	/* Remove spaces and dots */
(1694) 			cf |= NS_LOSS | NS_LFN; continue;
(1695) 		}
(1696) 
(1697) 		if (i >= ni || si == di) {		/* Extension or end of SFN */
(1698) 			if (ni == 11) {				/* Long extension */
(1699) 				cf |= NS_LOSS | NS_LFN; break;
(1700) 			}
(1701) 			if (si != di) cf |= NS_LOSS | NS_LFN;	/* Out of 8.3 format */
(1702) 			if (si > di) break;			/* No extension */
(1703) 			si = di; i = 8; ni = 11;	/* Enter extension section */
(1704) 			b <<= 2; continue;
(1705) 		}
(1706) 
(1707) 		if (w >= 0x80) {				/* Non ASCII char */
(1708) #ifdef _EXCVT
(1709) 			w = ff_convert(w, 0);		/* Unicode -> OEM code */
(1710) 			if (w) w = excvt[w - 0x80];	/* Convert extended char to upper (SBCS) */
(1711) #else
(1712) 			w = ff_convert(ff_wtoupper(w), 0);	/* Upper converted Unicode -> OEM code */
(1713) #endif
(1714) 			cf |= NS_LFN;				/* Force create LFN entry */
(1715) 		}
(1716) 
(1717) 		if (_DF1S && w >= 0x100) {		/* Double byte char (always false on SBCS cfg) */
(1718) 			if (i >= ni - 1) {
(1719) 				cf |= NS_LOSS | NS_LFN; i = ni; continue;
(1720) 			}
(1721) 			dj->fn[i++] = (BYTE)(w >> 8);
(1722) 		} else {						/* Single byte char */
(1723) 			if (!w || chk_chr("+,;=[]", w)) {	/* Replace illegal chars for SFN */
(1724) 				w = '_'; cf |= NS_LOSS | NS_LFN;/* Lossy conversion */
(1725) 			} else {
(1726) 				if (IsUpper(w)) {		/* ASCII large capital */
(1727) 					b |= 2;
(1728) 				} else {
(1729) 					if (IsLower(w)) {	/* ASCII small capital */
(1730) 						b |= 1; w -= 0x20;
(1731) 					}
(1732) 				}
(1733) 			}
(1734) 		}
(1735) 		dj->fn[i++] = (BYTE)w;
(1736) 	}
(1737) 
(1738) 	if (dj->fn[0] == DDE) dj->fn[0] = NDDE;	/* If the first char collides with deleted mark, replace it with 0x05 */
(1739) 
(1740) 	if (ni == 8) b <<= 2;
(1741) 	if ((b & 0x0C) == 0x0C || (b & 0x03) == 0x03)	/* Create LFN entry when there are composite capitals */
(1742) 		cf |= NS_LFN;
(1743) 	if (!(cf & NS_LFN)) {						/* When LFN is in 8.3 format without extended char, NT flags are created */
(1744) 		if ((b & 0x03) == 0x01) cf |= NS_EXT;	/* NT flag (Extension has only small capital) */
(1745) 		if ((b & 0x0C) == 0x04) cf |= NS_BODY;	/* NT flag (Filename has only small capital) */
(1746) 	}
(1747) 
(1748) 	dj->fn[NS] = cf;	/* SFN is created */
(1749) 
(1750) 	return FR_OK;
(1751) 
(1752) 
(1753) #else	/* Non-LFN configuration */
(1754) 	BYTE b, c, d, *sfn;
(1755) 	UINT ni, si, i;
(1756) 	const char *p;
(1757) 
(1758) 	/* Create file name in directory form */
(1759) 	for (p = *path; *p == '/' || *p == '\\'; p++) ;	/* Strip duplicated separator */
    00FA1 89EB      LDD	R30,Y+19
    00FA2 89FC      LDD	R31,Y+20
    00FA3 8020      LD	R2,Z
    00FA4 8031      LDD	R3,Z+1
    00FA5 823B      STD	Y+3,R3
    00FA6 822A      STD	Y+2,R2
    00FA7 C005      RJMP	0x0FAD
    00FA8 818A      LDD	R24,Y+2
    00FA9 819B      LDD	R25,Y+3
    00FAA 9601      ADIW	R24,1
    00FAB 839B      STD	Y+3,R25
    00FAC 838A      STD	Y+2,R24
    00FAD 81EA      LDD	R30,Y+2
    00FAE 81FB      LDD	R31,Y+3
    00FAF 8020      LD	R2,Z
    00FB0 2433      CLR	R3
    00FB1 2D82      MOV	R24,R2
    00FB2 328F      CPI	R24,0x2F
    00FB3 F3A1      BEQ	0x0FA8
    00FB4 358C      CPI	R24,0x5C
    00FB5 F391      BEQ	0x0FA8
(1760) 	sfn = dj->fn;
    00FB6 01FA      MOVW	R30,R20
    00FB7 8824      LDD	R2,Z+20
    00FB8 8835      LDD	R3,Z+21
    00FB9 823F      STD	Y+7,R3
    00FBA 822E      STD	Y+6,R2
(1761) 	mem_set(sfn, ' ', 11);
    00FBB E08B      LDI	R24,0xB
    00FBC E090      LDI	R25,0
    00FBD 8399      STD	Y+1,R25
    00FBE 8388      ST	Y,R24
    00FBF E220      LDI	R18,0x20
    00FC0 E030      LDI	R19,0
    00FC1 0181      MOVW	R16,R2
    00FC2 940E 0431 CALL	ff.c:mem_set
(1762) 	si = i = b = 0; ni = 8;
    00FC4 2400      CLR	R0
    00FC5 8608      STD	Y+8,R0
    00FC6 2422      CLR	R2
    00FC7 2433      CLR	R3
    00FC8 823D      STD	Y+5,R3
    00FC9 822C      STD	Y+4,R2
    00FCA 01B1      MOVW	R22,R2
    00FCB E088      LDI	R24,0x8
    00FCC E090      LDI	R25,0
    00FCD 016C      MOVW	R12,R24
(1763) #if _FS_RPATH
(1764) 	if (p[si] == '.') { /* Is this a dot entry? */
(1765) 		for (;;) {
(1766) 			c = (BYTE)p[si++];
(1767) 			if (c != '.' || si >= 3) break;
(1768) 			sfn[i++] = c;
(1769) 		}
(1770) 		if (c != '/' && c != '\\' && c > ' ') return FR_INVALID_NAME;
(1771) 		*path = &p[si];									/* Return pointer to the next segment */
(1772) 		sfn[NS] = (c <= ' ') ? NS_LAST | NS_DOT : NS_DOT;	/* Set last segment flag if end of path */
(1773) 		return FR_OK;
(1774) 	}
(1775) #endif
(1776) 	for (;;) {
(1777) 		c = (BYTE)p[si++];
    00FCE 01AB      MOVW	R20,R22
    00FCF 5F6F      SUBI	R22,0xFF
    00FD0 4F7F      SBCI	R23,0xFF
    00FD1 01FA      MOVW	R30,R20
    00FD2 800A      LDD	R0,Y+2
    00FD3 801B      LDD	R1,Y+3
    00FD4 0DE0      ADD	R30,R0
    00FD5 1DF1      ADC	R31,R1
    00FD6 8140      LD	R20,Z
(1778) 		if (c <= ' ' || c == '/' || c == '\\') break;	/* Break on end of segment */
    00FD7 E280      LDI	R24,0x20
    00FD8 1784      CP	R24,R20
    00FD9 F420      BCC	0x0FDE
    00FDA 324F      CPI	R20,0x2F
    00FDB F011      BEQ	0x0FDE
    00FDC 354C      CPI	R20,0x5C
    00FDD F409      BNE	0x0FDF
    00FDE C087      RJMP	0x1066
(1779) 		if (c == '.' || i >= ni) {
    00FDF 324E      CPI	R20,0x2E
    00FE0 F029      BEQ	0x0FE6
    00FE1 800C      LDD	R0,Y+4
    00FE2 801D      LDD	R1,Y+5
    00FE3 140C      CP	R0,R12
    00FE4 041D      CPC	R1,R13
    00FE5 F0A0      BCS	0x0FFA
(1780) 			if (ni != 8 || c != '.') return FR_INVALID_NAME;
    00FE6 01C6      MOVW	R24,R12
    00FE7 3088      CPI	R24,0x8
    00FE8 E0E0      LDI	R30,0
    00FE9 079E      CPC	R25,R30
    00FEA F411      BNE	0x0FED
    00FEB 324E      CPI	R20,0x2E
    00FEC F011      BEQ	0x0FEF
    00FED E006      LDI	R16,6
    00FEE C0AF      RJMP	0x109E
(1781) 			i = 8; ni = 11;
    00FEF E088      LDI	R24,0x8
    00FF0 E090      LDI	R25,0
    00FF1 839D      STD	Y+5,R25
    00FF2 838C      STD	Y+4,R24
    00FF3 E08B      LDI	R24,0xB
    00FF4 016C      MOVW	R12,R24
(1782) 			b <<= 2; continue;
    00FF5 8408      LDD	R0,Y+8
    00FF6 0C00      LSL	R0
    00FF7 0C00      LSL	R0
    00FF8 8608      STD	Y+8,R0
    00FF9 CFD4      RJMP	0x0FCE
(1783) 		}
(1784) 		if (c >= 0x80) {				/* Extended char? */
    00FFA 3840      CPI	R20,0x80
    00FFB F018      BCS	0x0FFF
(1785) 			b |= 3;						/* Eliminate NT flag */
    00FFC 8588      LDD	R24,Y+8
    00FFD 6083      ORI	R24,3
    00FFE 8788      STD	Y+8,R24
(1786) #ifdef _EXCVT
(1787) 			c = excvt[c-0x80];			/* Upper conversion (SBCS) */
(1788) #else
(1789) #if !_DF1S	/* ASCII only cfg */
(1790) 			return FR_INVALID_NAME;
(1791) #endif
(1792) #endif
(1793) 		}
(1794) 		if (IsDBCS1(c)) {				/* Check if it is a DBC 1st byte (always false on SBCS cfg) */
    00FFF 3841      CPI	R20,0x81
    01000 F408      BCC	0x1002
    01001 C039      RJMP	0x103B
    01002 EF8E      LDI	R24,0xFE
    01003 1784      CP	R24,R20
    01004 F408      BCC	0x1006
    01005 C035      RJMP	0x103B
(1795) 			d = (BYTE)p[si++];			/* Get 2nd byte */
    01006 015B      MOVW	R10,R22
    01007 5F6F      SUBI	R22,0xFF
    01008 4F7F      SBCI	R23,0xFF
    01009 01F5      MOVW	R30,R10
    0100A 800A      LDD	R0,Y+2
    0100B 801B      LDD	R1,Y+3
    0100C 0DE0      ADD	R30,R0
    0100D 1DF1      ADC	R31,R1
    0100E 80A0      LD	R10,Z
(1796) 			if (!IsDBCS2(d) || i >= ni - 1)	/* Reject invalid DBC */
    0100F 2D8A      MOV	R24,R10
    01010 3480      CPI	R24,0x40
    01011 F018      BCS	0x1015
    01012 E78E      LDI	R24,0x7E
    01013 158A      CP	R24,R10
    01014 F430      BCC	0x101B
    01015 2D8A      MOV	R24,R10
    01016 3880      CPI	R24,0x80
    01017 F050      BCS	0x1022
    01018 EF8E      LDI	R24,0xFE
    01019 158A      CP	R24,R10
    0101A F038      BCS	0x1022
    0101B 01C6      MOVW	R24,R12
    0101C 9701      SBIW	R24,1
    0101D 800C      LDD	R0,Y+4
    0101E 801D      LDD	R1,Y+5
    0101F 1608      CP	R0,R24
    01020 0619      CPC	R1,R25
    01021 F010      BCS	0x1024
(1797) 				return FR_INVALID_NAME;
    01022 E006      LDI	R16,6
    01023 C07A      RJMP	0x109E
(1798) 			sfn[i++] = c;
    01024 80EC      LDD	R14,Y+4
    01025 80FD      LDD	R15,Y+5
    01026 01C7      MOVW	R24,R14
    01027 9601      ADIW	R24,1
    01028 839D      STD	Y+5,R25
    01029 838C      STD	Y+4,R24
    0102A 01F7      MOVW	R30,R14
    0102B 800E      LDD	R0,Y+6
    0102C 801F      LDD	R1,Y+7
    0102D 0DE0      ADD	R30,R0
    0102E 1DF1      ADC	R31,R1
    0102F 8340      ST	Z,R20
(1799) 			sfn[i++] = d;
    01030 017C      MOVW	R14,R24
    01031 9601      ADIW	R24,1
    01032 839D      STD	Y+5,R25
    01033 838C      STD	Y+4,R24
    01034 01F7      MOVW	R30,R14
    01035 800E      LDD	R0,Y+6
    01036 801F      LDD	R1,Y+7
    01037 0DE0      ADD	R30,R0
    01038 1DF1      ADC	R31,R1
    01039 82A0      ST	Z,R10
(1800) 		} else {						/* Single byte code */
    0103A CF93      RJMP	0x0FCE
(1801) 			if (chk_chr("\"*+,:;<=>\?[]|\x7F", c))	/* Reject illegal chrs for SFN */
    0103B 2F24      MOV	R18,R20
    0103C 2733      CLR	R19
    0103D E000      LDI	R16,0
    0103E E011      LDI	R17,1
    0103F 940E 0464 CALL	ff.c:chk_chr
    01041 0158      MOVW	R10,R16
    01042 3000      CPI	R16,0
    01043 0701      CPC	R16,R17
    01044 F011      BEQ	0x1047
(1802) 				return FR_INVALID_NAME;
    01045 E006      LDI	R16,6
    01046 C057      RJMP	0x109E
(1803) 			if (IsUpper(c)) {			/* ASCII large capital? */
    01047 3441      CPI	R20,0x41
    01048 F038      BCS	0x1050
    01049 E58A      LDI	R24,0x5A
    0104A 1784      CP	R24,R20
    0104B F020      BCS	0x1050
(1804) 				b |= 2;
    0104C 8588      LDD	R24,Y+8
    0104D 6082      ORI	R24,2
    0104E 8788      STD	Y+8,R24
(1805) 			} else {
    0104F C009      RJMP	0x1059
(1806) 				if (IsLower(c)) {		/* ASCII small capital? */
    01050 3641      CPI	R20,0x61
    01051 F038      BCS	0x1059
    01052 E78A      LDI	R24,0x7A
    01053 1784      CP	R24,R20
    01054 F020      BCS	0x1059
(1807) 					b |= 1; c -= 0x20;
    01055 8588      LDD	R24,Y+8
    01056 6081      ORI	R24,1
    01057 8788      STD	Y+8,R24
    01058 5240      SUBI	R20,0x20
(1808) 				}
(1809) 			}
(1810) 			sfn[i++] = c;
    01059 80AC      LDD	R10,Y+4
    0105A 80BD      LDD	R11,Y+5
    0105B 01C5      MOVW	R24,R10
    0105C 9601      ADIW	R24,1
    0105D 839D      STD	Y+5,R25
    0105E 838C      STD	Y+4,R24
    0105F 01F5      MOVW	R30,R10
    01060 800E      LDD	R0,Y+6
    01061 801F      LDD	R1,Y+7
    01062 0DE0      ADD	R30,R0
    01063 1DF1      ADC	R31,R1
    01064 8340      ST	Z,R20
    01065 CF68      RJMP	0x0FCE
(1811) 		}
(1812) 	}
(1813) 	*path = &p[si];						/* Return pointer to the next segment */
    01066 011B      MOVW	R2,R22
    01067 800A      LDD	R0,Y+2
    01068 801B      LDD	R1,Y+3
    01069 0C20      ADD	R2,R0
    0106A 1C31      ADC	R3,R1
    0106B 89EB      LDD	R30,Y+19
    0106C 89FC      LDD	R31,Y+20
    0106D 8231      STD	Z+1,R3
    0106E 8220      ST	Z,R2
(1814) 	c = (c <= ' ') ? NS_LAST : 0;		/* Set last segment flag if end of path */
    0106F E280      LDI	R24,0x20
    01070 1784      CP	R24,R20
    01071 F018      BCS	0x1075
    01072 E064      LDI	R22,4
    01073 E070      LDI	R23,0
    01074 C002      RJMP	0x1077
    01075 2766      CLR	R22
    01076 2777      CLR	R23
    01077 2F46      MOV	R20,R22
(1815) 
(1816) 	if (!i) return FR_INVALID_NAME;		/* Reject nul string */
    01078 800C      LDD	R0,Y+4
    01079 801D      LDD	R1,Y+5
    0107A 2000      TST	R0
    0107B F421      BNE	0x1080
    0107C 2011      TST	R1
    0107D F411      BNE	0x1080
    0107E E006      LDI	R16,6
    0107F C01E      RJMP	0x109E
(1817) 	if (sfn[0] == DDE) sfn[0] = NDDE;	/* When first char collides with DDE, replace it with 0x05 */
    01080 81EE      LDD	R30,Y+6
    01081 81FF      LDD	R31,Y+7
    01082 8180      LD	R24,Z
    01083 3E85      CPI	R24,0xE5
    01084 F411      BNE	0x1087
    01085 E085      LDI	R24,5
    01086 8380      ST	Z,R24
(1818) 
(1819) 	if (ni == 8) b <<= 2;
    01087 01C6      MOVW	R24,R12
    01088 3088      CPI	R24,0x8
    01089 E0E0      LDI	R30,0
    0108A 079E      CPC	R25,R30
    0108B F421      BNE	0x1090
    0108C 8408      LDD	R0,Y+8
    0108D 0C00      LSL	R0
    0108E 0C00      LSL	R0
    0108F 8608      STD	Y+8,R0
(1820) 	if ((b & 0x03) == 0x01) c |= NS_EXT;	/* NT flag (Name extension has only small capital) */
    01090 8588      LDD	R24,Y+8
    01091 7083      ANDI	R24,3
    01092 3081      CPI	R24,1
    01093 F409      BNE	0x1095
    01094 6140      ORI	R20,0x10
(1821) 	if ((b & 0x0C) == 0x04) c |= NS_BODY;	/* NT flag (Name body has only small capital) */
    01095 8588      LDD	R24,Y+8
    01096 708C      ANDI	R24,0xC
    01097 3084      CPI	R24,4
    01098 F409      BNE	0x109A
    01099 6048      ORI	R20,0x8
(1822) 
(1823) 	sfn[NS] = c;		/* Store NT flag, File name is created */
    0109A 81EE      LDD	R30,Y+6
    0109B 81FF      LDD	R31,Y+7
    0109C 8743      STD	Z+11,R20
(1824) 
(1825) 	return FR_OK;
    0109D 2700      CLR	R16
    0109E 9629      ADIW	R28,0x9
    0109F 940E 48B8 CALL	pop_xgsetF0FC
    010A1 9622      ADIW	R28,2
    010A2 9508      RET
ff.c:get_fileinfo:
  nt                   --> R12
  p                    --> R20
  dir                  --> R10
  i                    --> R12
  c                    --> R14
  fno                  --> R22
  dj                   --> R10
    010A3 940E 48C3 CALL	push_xgsetF0FC
    010A5 01B9      MOVW	R22,R18
    010A6 0158      MOVW	R10,R16
(1826) #endif
(1827) }
(1828) 
(1829) 
(1830) 
(1831) 
(1832) /*-----------------------------------------------------------------------*/
(1833) /* Get file information from directory entry                             */
(1834) /*-----------------------------------------------------------------------*/
(1835) #if _FS_MINIMIZE <= 1
(1836) static
(1837) void get_fileinfo (		/* No return code */
(1838) 	DIR *dj,			/* Pointer to the directory object */
(1839) 	FILINFO *fno	 	/* Pointer to the file information to be filled */
(1840) )
(1841) {
(1842) 	UINT i;
(1843) 	BYTE nt, *dir;
(1844) 	TCHAR *p, c;
(1845) 
(1846) 
(1847) 	p = fno->fname;
    010A7 01AB      MOVW	R20,R22
    010A8 5F47      SUBI	R20,0xF7
    010A9 4F5F      SBCI	R21,0xFF
(1848) 	if (dj->sect) {
    010AA 01F5      MOVW	R30,R10
    010AB 963E      ADIW	R30,0xE
    010AC 8020      LD	R2,Z
    010AD 8031      LDD	R3,Z+1
    010AE 8042      LDD	R4,Z+2
    010AF 8053      LDD	R5,Z+3
    010B0 9488      BCLR	0
    010B1 2022      TST	R2
    010B2 0432      CPC	R3,R2
    010B3 0442      CPC	R4,R2
    010B4 0452      CPC	R5,R2
    010B5 F409      BNE	0x10B7
    010B6 C08A      RJMP	0x1141
(1849) 		dir = dj->dir;
    010B7 01F5      MOVW	R30,R10
    010B8 88A2      LDD	R10,Z+18
    010B9 88B3      LDD	R11,Z+19
(1850) 		nt = dir[DIR_NTres];		/* NT flag */
(1851) 		for (i = 0; i < 8; i++) {	/* Copy name body */
    010BA 24CC      CLR	R12
    010BB 24DD      CLR	R13
    010BC C014      RJMP	0x10D1
(1852) 			c = dir[i];
    010BD 01F6      MOVW	R30,R12
    010BE 0DEA      ADD	R30,R10
    010BF 1DFB      ADC	R31,R11
    010C0 80E0      LD	R14,Z
(1853) 			if (c == ' ') break;
    010C1 2D8E      MOV	R24,R14
    010C2 3280      CPI	R24,0x20
    010C3 F409      BNE	0x10C5
    010C4 C011      RJMP	0x10D6
(1854) 			if (c == NDDE) c = (TCHAR)DDE;
    010C5 2D8E      MOV	R24,R14
    010C6 3085      CPI	R24,5
    010C7 F411      BNE	0x10CA
    010C8 EE85      LDI	R24,0xE5
    010C9 2EE8      MOV	R14,R24
(1855) 			if (_USE_LFN && (nt & NS_BODY) && IsUpper(c)) c += 0x20;
    010CA C000      RJMP	0x10CB
(1856) #if _LFN_UNICODE
(1857) 			if (IsDBCS1(c) && i < 7 && IsDBCS2(dir[i+1]))
(1858) 				c = (c << 8) | dir[++i];
(1859) 			c = ff_convert(c, 1);
(1860) 			if (!c) c = '?';
(1861) #endif
(1862) 			*p++ = c;
    010CB 01FA      MOVW	R30,R20
    010CC 92E1      ST	Z+,R14
    010CD 01AF      MOVW	R20,R30
    010CE 01C6      MOVW	R24,R12
    010CF 9601      ADIW	R24,1
    010D0 016C      MOVW	R12,R24
    010D1 01C6      MOVW	R24,R12
    010D2 3088      CPI	R24,0x8
    010D3 E0E0      LDI	R30,0
    010D4 079E      CPC	R25,R30
    010D5 F338      BCS	0x10BD
(1863) 		}
(1864) 		if (dir[8] != ' ') {		/* Copy name extension */
    010D6 01F5      MOVW	R30,R10
    010D7 8580      LDD	R24,Z+8
    010D8 3280      CPI	R24,0x20
    010D9 F0E1      BEQ	0x10F6
(1865) 			*p++ = '.';
    010DA E28E      LDI	R24,0x2E
    010DB 01FA      MOVW	R30,R20
    010DC 9381      ST	Z+,R24
    010DD 01AF      MOVW	R20,R30
(1866) 			for (i = 8; i < 11; i++) {
    010DE E088      LDI	R24,0x8
    010DF E090      LDI	R25,0
    010E0 016C      MOVW	R12,R24
    010E1 C00F      RJMP	0x10F1
(1867) 				c = dir[i];
    010E2 01F6      MOVW	R30,R12
    010E3 0DEA      ADD	R30,R10
    010E4 1DFB      ADC	R31,R11
    010E5 80E0      LD	R14,Z
(1868) 				if (c == ' ') break;
    010E6 2D8E      MOV	R24,R14
    010E7 3280      CPI	R24,0x20
    010E8 F409      BNE	0x10EA
    010E9 C00C      RJMP	0x10F6
(1869) 				if (_USE_LFN && (nt & NS_EXT) && IsUpper(c)) c += 0x20;
    010EA C000      RJMP	0x10EB
(1870) #if _LFN_UNICODE
(1871) 				if (IsDBCS1(c) && i < 10 && IsDBCS2(dir[i+1]))
(1872) 					c = (c << 8) | dir[++i];
(1873) 				c = ff_convert(c, 1);
(1874) 				if (!c) c = '?';
(1875) #endif
(1876) 				*p++ = c;
    010EB 01FA      MOVW	R30,R20
    010EC 92E1      ST	Z+,R14
    010ED 01AF      MOVW	R20,R30
    010EE 01C6      MOVW	R24,R12
    010EF 9601      ADIW	R24,1
    010F0 016C      MOVW	R12,R24
    010F1 01C6      MOVW	R24,R12
    010F2 308B      CPI	R24,0xB
    010F3 E0E0      LDI	R30,0
    010F4 079E      CPC	R25,R30
    010F5 F360      BCS	0x10E2
(1877) 			}
(1878) 		}
(1879) 		fno->fattrib = dir[DIR_Attr];				/* Attribute */
    010F6 01F5      MOVW	R30,R10
    010F7 8423      LDD	R2,Z+11
    010F8 01FB      MOVW	R30,R22
    010F9 8620      STD	Z+8,R2
(1880) 		fno->fsize = LD_DWORD(dir+DIR_FileSize);	/* Size */
    010FA E188      LDI	R24,0x18
    010FB E090      LDI	R25,0
    010FC 01F5      MOVW	R30,R10
    010FD 8D07      LDD	R16,Z+31
    010FE 2711      CLR	R17
    010FF 2722      CLR	R18
    01100 2733      CLR	R19
    01101 938A      ST	-Y,R24
    01102 940E 494E CALL	lsl32
    01104 0118      MOVW	R2,R16
    01105 0129      MOVW	R4,R18
    01106 01F5      MOVW	R30,R10
    01107 8C66      LDD	R6,Z+30
    01108 2477      CLR	R7
    01109 2488      CLR	R8
    0110A 2499      CLR	R9
    0110B 0143      MOVW	R8,R6
    0110C 2466      CLR	R6
    0110D 2477      CLR	R7
    0110E 2826      OR	R2,R6
    0110F 2837      OR	R3,R7
    01110 2848      OR	R4,R8
    01111 2859      OR	R5,R9
    01112 8C65      LDD	R6,Z+29
    01113 2477      CLR	R7
    01114 2C76      MOV	R7,R6
    01115 2466      CLR	R6
    01116 2488      CLR	R8
    01117 2499      CLR	R9
    01118 2826      OR	R2,R6
    01119 2837      OR	R3,R7
    0111A 2848      OR	R4,R8
    0111B 2859      OR	R5,R9
    0111C 8C64      LDD	R6,Z+28
    0111D 2477      CLR	R7
    0111E 2488      CLR	R8
    0111F 2499      CLR	R9
    01120 2826      OR	R2,R6
    01121 2837      OR	R3,R7
    01122 2848      OR	R4,R8
    01123 2859      OR	R5,R9
    01124 01FB      MOVW	R30,R22
    01125 8220      ST	Z,R2
    01126 8231      STD	Z+1,R3
    01127 8242      STD	Z+2,R4
    01128 8253      STD	Z+3,R5
(1881) 		fno->fdate = LD_WORD(dir+DIR_WrtDate);		/* Date */
    01129 01F5      MOVW	R30,R10
    0112A 8C20      LDD	R2,Z+24
    0112B 2433      CLR	R3
    0112C 8C41      LDD	R4,Z+25
    0112D 2455      CLR	R5
    0112E 2C54      MOV	R5,R4
    0112F 2444      CLR	R4
    01130 2842      OR	R4,R2
    01131 2853      OR	R5,R3
    01132 01FB      MOVW	R30,R22
    01133 8255      STD	Z+5,R5
    01134 8244      STD	Z+4,R4
(1882) 		fno->ftime = LD_WORD(dir+DIR_WrtTime);		/* Time */
    01135 01F5      MOVW	R30,R10
    01136 8826      LDD	R2,Z+22
    01137 2433      CLR	R3
    01138 8847      LDD	R4,Z+23
    01139 2455      CLR	R5
    0113A 2C54      MOV	R5,R4
    0113B 2444      CLR	R4
    0113C 2842      OR	R4,R2
    0113D 2853      OR	R5,R3
    0113E 01FB      MOVW	R30,R22
    0113F 8257      STD	Z+7,R5
    01140 8246      STD	Z+6,R4
(1883) 	}
(1884) 	*p = 0;		/* Terminate SFN str by a \0 */
    01141 2422      CLR	R2
    01142 01FA      MOVW	R30,R20
    01143 8220      ST	Z,R2
    01144 940C 48B8 JMP	pop_xgsetF0FC
ff.c:follow_path:
  ns                   --> R10
  res                  --> R20
  dir                  --> R10
  path                 --> Y,+6
  dj                   --> R22
    01146 933A      ST	-Y,R19
    01147 932A      ST	-Y,R18
    01148 940E 48E2 CALL	push_xgsetF00C
    0114A 01B8      MOVW	R22,R16
(1885) 
(1886) #if _USE_LFN
(1887) 	if (fno->lfname && fno->lfsize) {
(1888) 		TCHAR *tp = fno->lfname;
(1889) 		WCHAR w, *lfn;
(1890) 
(1891) 		i = 0;
(1892) 		if (dj->sect && dj->lfn_idx != 0xFFFF) {/* Get LFN if available */
(1893) 			lfn = dj->lfn;
(1894) 			while ((w = *lfn++) != 0) {			/* Get an LFN char */
(1895) #if !_LFN_UNICODE
(1896) 				w = ff_convert(w, 0);			/* Unicode -> OEM conversion */
(1897) 				if (!w) { i = 0; break; }		/* Could not convert, no LFN */
(1898) 				if (_DF1S && w >= 0x100)		/* Put 1st byte if it is a DBC (always false on SBCS cfg) */
(1899) 					tp[i++] = (TCHAR)(w >> 8);
(1900) #endif
(1901) 				if (i >= fno->lfsize - 1) { i = 0; break; }	/* Buffer overflow, no LFN */
(1902) 				tp[i++] = (TCHAR)w;
(1903) 			}
(1904) 		}
(1905) 		tp[i] = 0;	/* Terminate the LFN str by a \0 */
(1906) 	}
(1907) #endif
(1908) }
(1909) #endif /* _FS_MINIMIZE <= 1 */
(1910) 
(1911) 
(1912) 
(1913) 
(1914) /*-----------------------------------------------------------------------*/
(1915) /* Follow a file path                                                    */
(1916) /*-----------------------------------------------------------------------*/
(1917) 
(1918) static
(1919) FRESULT follow_path (	/* FR_OK(0): successful, !=0: error code */
(1920) 	DIR *dj,			/* Directory object to return last directory and found object */
(1921) 	const TCHAR *path	/* Full-path string to find a file or directory */
(1922) )
(1923) {
(1924) 	FRESULT res;
(1925) 	BYTE *dir, ns;
(1926) 
(1927) 
(1928) #if _FS_RPATH
(1929) 	if (*path == '/' || *path == '\\') { /* There is a heading separator */
(1930) 		path++;	dj->sclust = 0;		/* Strip it and start from the root dir */
(1931) 	} else {							/* No heading separator */
(1932) 		dj->sclust = dj->fs->cdir;	/* Start from the current dir */
(1933) 	}
(1934) #else
(1935) 	if (*path == '/' || *path == '\\')	/* Strip heading separator if exist */
    0114B 81EE      LDD	R30,Y+6
    0114C 81FF      LDD	R31,Y+7
    0114D 8020      LD	R2,Z
    0114E 2433      CLR	R3
    0114F 2D82      MOV	R24,R2
    01150 328F      CPI	R24,0x2F
    01151 F011      BEQ	0x1154
    01152 358C      CPI	R24,0x5C
    01153 F429      BNE	0x1159
(1936) 		path++;
    01154 818E      LDD	R24,Y+6
    01155 819F      LDD	R25,Y+7
    01156 9601      ADIW	R24,1
    01157 839F      STD	Y+7,R25
    01158 838E      STD	Y+6,R24
(1937) 	dj->sclust = 0;						/* Start from the root dir */
    01159 01FB      MOVW	R30,R22
    0115A 9636      ADIW	R30,6
    0115B E080      LDI	R24,0
    0115C 8380      ST	Z,R24
    0115D 8381      STD	Z+1,R24
    0115E 8382      STD	Z+2,R24
    0115F 8383      STD	Z+3,R24
(1938) #endif
(1939) 
(1940) 	if ((UINT)*path < ' ') {			/* Nul path means the start directory itself */
    01160 81EE      LDD	R30,Y+6
    01161 81FF      LDD	R31,Y+7
    01162 8180      LD	R24,Z
    01163 2799      CLR	R25
    01164 3280      CPI	R24,0x20
    01165 E0E0      LDI	R30,0
    01166 079E      CPC	R25,R30
    01167 F458      BCC	0x1173
(1941) 		res = dir_sdi(dj, 0);
    01168 2722      CLR	R18
    01169 2733      CLR	R19
    0116A 018B      MOVW	R16,R22
    0116B DA84      RCALL	ff.c:dir_sdi
    0116C 2F40      MOV	R20,R16
(1942) 		dj->dir = 0;
    0116D 2422      CLR	R2
    0116E 2433      CLR	R3
    0116F 01FB      MOVW	R30,R22
    01170 8A33      STD	Z+19,R3
    01171 8A22      STD	Z+18,R2
(1943) 
(1944) 	} else {							/* Follow path */
    01172 C052      RJMP	0x11C5
(1945) 		for (;;) {
(1946) 			res = create_name(dj, &path);	/* Get a segment */
    01173 019E      MOVW	R18,R28
    01174 5F2A      SUBI	R18,0xFA
    01175 4F3F      SBCI	R19,0xFF
    01176 018B      MOVW	R16,R22
    01177 DE23      RCALL	ff.c:create_name
    01178 2EA0      MOV	R10,R16
    01179 2D4A      MOV	R20,R10
(1947) 			if (res != FR_OK) break;
    0117A 2300      TST	R16
    0117B F009      BEQ	0x117D
    0117C C048      RJMP	0x11C5
(1948) 			res = dir_find(dj);				/* Find it */
    0117D 018B      MOVW	R16,R22
    0117E DD29      RCALL	ff.c:dir_find
    0117F 2EA0      MOV	R10,R16
    01180 2D4A      MOV	R20,R10
(1949) 			ns = *(dj->fn+NS);
    01181 01FB      MOVW	R30,R22
    01182 93AF      PUSH	R26
    01183 93BF      PUSH	R27
    01184 89A4      LDD	R26,Z+20
    01185 89B5      LDD	R27,Z+21
    01186 01FD      MOVW	R30,R26
    01187 91BF      POP	R27
    01188 91AF      POP	R26
    01189 84A3      LDD	R10,Z+11
(1950) 			if (res != FR_OK) {				/* Failed to find the object */
    0118A 2300      TST	R16
    0118B F049      BEQ	0x1195
(1951) 				if (res != FR_NO_FILE) break;	/* Abort if any hard error occured */
    0118C 3004      CPI	R16,4
    0118D F009      BEQ	0x118F
    0118E C036      RJMP	0x11C5
(1952) 				/* Object not found */
(1953) 				if (_FS_RPATH && (ns & NS_DOT)) {	/* If dot entry is not exit */
    0118F C001      RJMP	0x1191
(1954) 					dj->sclust = 0; dj->dir = 0;	/* It is the root dir */
(1955) 					res = FR_OK;
(1956) 					if (!(ns & NS_LAST)) continue;
    01190 CFE2      RJMP	0x1173
(1957) 				} else {							/* Could not find the object */
(1958) 					if (!(ns & NS_LAST)) res = FR_NO_PATH;
    01191 FCA2      SBRC	R10,2
    01192 C032      RJMP	0x11C5
    01193 E045      LDI	R20,5
(1959) 				}
(1960) 				break;
    01194 C030      RJMP	0x11C5
(1961) 			}
(1962) 			if (ns & NS_LAST) break;			/* Last segment match. Function completed. */
    01195 FEA2      SBRS	R10,2
    01196 C001      RJMP	0x1198
    01197 C02D      RJMP	0x11C5
(1963) 			dir = dj->dir;						/* There is next segment. Follow the sub directory */
    01198 01FB      MOVW	R30,R22
    01199 88A2      LDD	R10,Z+18
    0119A 88B3      LDD	R11,Z+19
(1964) 			if (!(dir[DIR_Attr] & AM_DIR)) {	/* Cannot follow because it is a file */
    0119B 01F5      MOVW	R30,R10
    0119C 8423      LDD	R2,Z+11
    0119D FC24      SBRC	R2,4
    0119E C002      RJMP	0x11A1
(1965) 				res = FR_NO_PATH; break;
    0119F E045      LDI	R20,5
    011A0 C024      RJMP	0x11C5
(1966) 			}
(1967) 			dj->sclust = LD_CLUST(dir);
    011A1 01F5      MOVW	R30,R10
    011A2 8C22      LDD	R2,Z+26
    011A3 2433      CLR	R3
    011A4 8C43      LDD	R4,Z+27
    011A5 2455      CLR	R5
    011A6 2C54      MOV	R5,R4
    011A7 2444      CLR	R4
    011A8 2842      OR	R4,R2
    011A9 2853      OR	R5,R3
    011AA 0112      MOVW	R2,R4
    011AB 2444      CLR	R4
    011AC 2455      CLR	R5
    011AD 8864      LDD	R6,Z+20
    011AE 2477      CLR	R7
    011AF 8885      LDD	R8,Z+21
    011B0 2499      CLR	R9
    011B1 2C98      MOV	R9,R8
    011B2 2488      CLR	R8
    011B3 2886      OR	R8,R6
    011B4 2897      OR	R9,R7
    011B5 0134      MOVW	R6,R8
    011B6 2488      CLR	R8
    011B7 2499      CLR	R9
    011B8 0143      MOVW	R8,R6
    011B9 2466      CLR	R6
    011BA 2477      CLR	R7
    011BB 2862      OR	R6,R2
    011BC 2873      OR	R7,R3
    011BD 2884      OR	R8,R4
    011BE 2895      OR	R9,R5
    011BF 01FB      MOVW	R30,R22
    011C0 8266      STD	Z+6,R6
    011C1 8277      STD	Z+7,R7
    011C2 8680      STD	Z+8,R8
    011C3 8691      STD	Z+9,R9
    011C4 CFAE      RJMP	0x1173
(1968) 		}
(1969) 	}
(1970) 
(1971) 	return res;
    011C5 2F04      MOV	R16,R20
    011C6 940E 48E9 CALL	pop_xgsetF00C
    011C8 9622      ADIW	R28,2
    011C9 9508      RET
ff.c:check_fs:
  sect                 --> Y,+11
  fs                   --> R10
    011CA 933A      ST	-Y,R19
    011CB 932A      ST	-Y,R18
    011CC 940E 48E2 CALL	push_xgsetF00C
    011CE 0158      MOVW	R10,R16
    011CF 9725      SBIW	R28,5
(1972) }
(1973) 
(1974) 
(1975) 
(1976) 
(1977) /*-----------------------------------------------------------------------*/
(1978) /* Load a sector and check if it is an FAT Volume Boot Record            */
(1979) /*-----------------------------------------------------------------------*/
(1980) 
(1981) static
(1982) BYTE check_fs (	/* 0:FAT-VBR, 1:Valid BR but not FAT, 2:Not a BR, 3:Disk error */
(1983) 	FATFS *fs,	/* File system object */
(1984) 	DWORD sect	/* Sector# (lba) to check if it is an FAT boot record or not */
(1985) )
(1986) {
(1987) 	if (disk_read(fs->drv, fs->win, sect, 1) != RES_OK)	/* Load boot record */
    011D0 E081      LDI	R24,1
    011D1 838C      STD	Y+4,R24
    011D2 842B      LDD	R2,Y+11
    011D3 843C      LDD	R3,Y+12
    011D4 844D      LDD	R4,Y+13
    011D5 845E      LDD	R5,Y+14
    011D6 8228      ST	Y,R2
    011D7 8239      STD	Y+1,R3
    011D8 824A      STD	Y+2,R4
    011D9 825B      STD	Y+3,R5
    011DA 0195      MOVW	R18,R10
    011DB 5D22      SUBI	R18,0xD2
    011DC 4F3F      SBCI	R19,0xFF
    011DD 01F5      MOVW	R30,R10
    011DE 8101      LDD	R16,Z+1
    011DF 940E 03D9 CALL	_disk_read
    011E1 2300      TST	R16
    011E2 F011      BEQ	0x11E5
(1988) 		return 3;
    011E3 E003      LDI	R16,3
    011E4 C0A8      RJMP	0x128D
(1989) 	if (LD_WORD(&fs->win[BS_55AA]) != 0xAA55)		/* Check record signature (always placed at offset 510 even if the sector size is >512) */
    011E5 01F5      MOVW	R30,R10
    011E6 5DE4      SUBI	R30,0xD4
    011E7 4FFD      SBCI	R31,0xFD
    011E8 8020      LD	R2,Z
    011E9 52EC      SUBI	R30,0x2C
    011EA 40F2      SBCI	R31,2
    011EB 2433      CLR	R3
    011EC 5DE3      SUBI	R30,0xD3
    011ED 4FFD      SBCI	R31,0xFD
    011EE 8180      LD	R24,Z
    011EF 2799      CLR	R25
    011F0 2F98      MOV	R25,R24
    011F1 2788      CLR	R24
    011F2 2982      OR	R24,R2
    011F3 2993      OR	R25,R3
    011F4 3585      CPI	R24,0x55
    011F5 EAEA      LDI	R30,0xAA
    011F6 079E      CPC	R25,R30
    011F7 F011      BEQ	0x11FA
(1990) 		return 2;
    011F8 E002      LDI	R16,2
    011F9 C093      RJMP	0x128D
(1991) 
(1992) 	if ((LD_DWORD(&fs->win[BS_FilSysType]) & 0xFFFFFF) == 0x544146)	/* Check "FAT" string */
    011FA E188      LDI	R24,0x18
    011FB E090      LDI	R25,0
    011FC 01F5      MOVW	R30,R10
    011FD 59E9      SUBI	R30,0x99
    011FE 4FFF      SBCI	R31,0xFF
    011FF 8100      LD	R16,Z
    01200 2711      CLR	R17
    01201 2722      CLR	R18
    01202 2733      CLR	R19
    01203 938A      ST	-Y,R24
    01204 940E 494E CALL	lsl32
    01206 0118      MOVW	R2,R16
    01207 0129      MOVW	R4,R18
    01208 01F5      MOVW	R30,R10
    01209 59EA      SUBI	R30,0x9A
    0120A 4FFF      SBCI	R31,0xFF
    0120B 8060      LD	R6,Z
    0120C 56E6      SUBI	R30,0x66
    0120D 40F0      SBCI	R31,0
    0120E 2477      CLR	R7
    0120F 2488      CLR	R8
    01210 2499      CLR	R9
    01211 0143      MOVW	R8,R6
    01212 2466      CLR	R6
    01213 2477      CLR	R7
    01214 2826      OR	R2,R6
    01215 2837      OR	R3,R7
    01216 2848      OR	R4,R8
    01217 2859      OR	R5,R9
    01218 59EB      SUBI	R30,0x9B
    01219 4FFF      SBCI	R31,0xFF
    0121A 8060      LD	R6,Z
    0121B 56E5      SUBI	R30,0x65
    0121C 40F0      SBCI	R31,0
    0121D 2477      CLR	R7
    0121E 2C76      MOV	R7,R6
    0121F 2466      CLR	R6
    01220 2488      CLR	R8
    01221 2499      CLR	R9
    01222 2826      OR	R2,R6
    01223 2837      OR	R3,R7
    01224 2848      OR	R4,R8
    01225 2859      OR	R5,R9
    01226 59EC      SUBI	R30,0x9C
    01227 4FFF      SBCI	R31,0xFF
    01228 8060      LD	R6,Z
    01229 2477      CLR	R7
    0122A 2488      CLR	R8
    0122B 2499      CLR	R9
    0122C 2826      OR	R2,R6
    0122D 2837      OR	R3,R7
    0122E 2848      OR	R4,R8
    0122F 2859      OR	R5,R9
    01230 EF4F      LDI	R20,0xFF
    01231 EF5F      LDI	R21,0xFF
    01232 EF6F      LDI	R22,0xFF
    01233 E070      LDI	R23,0
    01234 2224      AND	R2,R20
    01235 2235      AND	R3,R21
    01236 2246      AND	R4,R22
    01237 2257      AND	R5,R23
    01238 E446      LDI	R20,0x46
    01239 E451      LDI	R21,0x41
    0123A E564      LDI	R22,0x54
    0123B E070      LDI	R23,0
    0123C 1624      CP	R2,R20
    0123D 0635      CPC	R3,R21
    0123E 0646      CPC	R4,R22
    0123F 0657      CPC	R5,R23
    01240 F411      BNE	0x1243
(1993) 		return 0;
    01241 2700      CLR	R16
    01242 C04A      RJMP	0x128D
(1994) 	if ((LD_DWORD(&fs->win[BS_FilSysType32]) & 0xFFFFFF) == 0x544146)
    01243 E188      LDI	R24,0x18
    01244 E090      LDI	R25,0
    01245 01F5      MOVW	R30,R10
    01246 57ED      SUBI	R30,0x7D
    01247 4FFF      SBCI	R31,0xFF
    01248 8100      LD	R16,Z
    01249 2711      CLR	R17
    0124A 2722      CLR	R18
    0124B 2733      CLR	R19
    0124C 938A      ST	-Y,R24
    0124D 940E 494E CALL	lsl32
    0124F 0118      MOVW	R2,R16
    01250 0129      MOVW	R4,R18
    01251 01F5      MOVW	R30,R10
    01252 57EE      SUBI	R30,0x7E
    01253 4FFF      SBCI	R31,0xFF
    01254 8060      LD	R6,Z
    01255 58E2      SUBI	R30,0x82
    01256 40F0      SBCI	R31,0
    01257 2477      CLR	R7
    01258 2488      CLR	R8
    01259 2499      CLR	R9
    0125A 0143      MOVW	R8,R6
    0125B 2466      CLR	R6
    0125C 2477      CLR	R7
    0125D 2826      OR	R2,R6
    0125E 2837      OR	R3,R7
    0125F 2848      OR	R4,R8
    01260 2859      OR	R5,R9
    01261 57EF      SUBI	R30,0x7F
    01262 4FFF      SBCI	R31,0xFF
    01263 8060      LD	R6,Z
    01264 58E1      SUBI	R30,0x81
    01265 40F0      SBCI	R31,0
    01266 2477      CLR	R7
    01267 2C76      MOV	R7,R6
    01268 2466      CLR	R6
    01269 2488      CLR	R8
    0126A 2499      CLR	R9
    0126B 2826      OR	R2,R6
    0126C 2837      OR	R3,R7
    0126D 2848      OR	R4,R8
    0126E 2859      OR	R5,R9
    0126F 58E0      SUBI	R30,0x80
    01270 4FFF      SBCI	R31,0xFF
    01271 8060      LD	R6,Z
    01272 2477      CLR	R7
    01273 2488      CLR	R8
    01274 2499      CLR	R9
    01275 2826      OR	R2,R6
    01276 2837      OR	R3,R7
    01277 2848      OR	R4,R8
    01278 2859      OR	R5,R9
    01279 EF4F      LDI	R20,0xFF
    0127A EF5F      LDI	R21,0xFF
    0127B EF6F      LDI	R22,0xFF
    0127C E070      LDI	R23,0
    0127D 2224      AND	R2,R20
    0127E 2235      AND	R3,R21
    0127F 2246      AND	R4,R22
    01280 2257      AND	R5,R23
    01281 E446      LDI	R20,0x46
    01282 E451      LDI	R21,0x41
    01283 E564      LDI	R22,0x54
    01284 E070      LDI	R23,0
    01285 1624      CP	R2,R20
    01286 0635      CPC	R3,R21
    01287 0646      CPC	R4,R22
    01288 0657      CPC	R5,R23
    01289 F411      BNE	0x128C
(1995) 		return 0;
    0128A 2700      CLR	R16
    0128B C001      RJMP	0x128D
(1996) 
(1997) 	return 1;
    0128C E001      LDI	R16,1
    0128D 9625      ADIW	R28,5
    0128E 940E 48E9 CALL	pop_xgsetF00C
    01290 9622      ADIW	R28,2
    01291 9508      RET
ff.c:chk_mounted:
  pi                   --> R10
  szbfat               --> Y,+25
  tbl                  --> R10
  p                    --> R10
  nrsv                 --> R14
  sysect               --> Y,+21
  bsect                --> Y,+17
  stat                 --> R10
  tsect                --> Y,+13
  nclst                --> Y,+9
  vol                  --> R14
  fasize               --> Y,+5
  b                    --> R14
  fmt                  --> R12
  fs                   --> Y,+37
  chk_wp               --> Y,+51
  rfs                  --> Y,+49
  path                 --> R12
    01292 933A      ST	-Y,R19
    01293 932A      ST	-Y,R18
    01294 940E 48C3 CALL	push_xgsetF0FC
    01296 0168      MOVW	R12,R16
    01297 97A7      SBIW	R28,0x27
(1998) }
(1999) 
(2000) 
(2001) 
(2002) 
(2003) /*-----------------------------------------------------------------------*/
(2004) /* Check if the file system object is valid or not                       */
(2005) /*-----------------------------------------------------------------------*/
(2006) 
(2007) static
(2008) FRESULT chk_mounted (	/* FR_OK(0): successful, !=0: any error occurred */
(2009) 	const TCHAR **path,	/* Pointer to pointer to the path name (drive number) */
(2010) 	FATFS **rfs,		/* Pointer to pointer to the found file system object */
(2011) 	BYTE chk_wp			/* !=0: Check media write protection for write access */
(2012) )
(2013) {
(2014) 	BYTE fmt, b, pi, *tbl;
(2015) 	UINT vol;
(2016) 	DSTATUS stat;
(2017) 	DWORD bsect, fasize, tsect, sysect, nclst, szbfat;
(2018) 	WORD nrsv;
(2019) 	const TCHAR *p = *path;
    01298 01F6      MOVW	R30,R12
    01299 80A0      LD	R10,Z
    0129A 80B1      LDD	R11,Z+1
(2020) 	FATFS *fs;
(2021) 
(2022) 	/* Get logical drive number from the path name */
(2023) 	vol = p[0] - '0';					/* Is there a drive number? */
    0129B 01F5      MOVW	R30,R10
    0129C 8180      LD	R24,Z
    0129D 2799      CLR	R25
    0129E 97C0      SBIW	R24,0x30
    0129F 017C      MOVW	R14,R24
(2024) 	if (vol <= 9 && p[1] == ':') {		/* Found a drive number, get and strip it */
    012A0 E089      LDI	R24,0x9
    012A1 E090      LDI	R25,0
    012A2 158E      CP	R24,R14
    012A3 059F      CPC	R25,R15
    012A4 F050      BCS	0x12AF
    012A5 8181      LDD	R24,Z+1
    012A6 338A      CPI	R24,0x3A
    012A7 F439      BNE	0x12AF
(2025) 		p += 2; *path = p;				/* Return pointer to the path name */
    012A8 01CF      MOVW	R24,R30
    012A9 9602      ADIW	R24,2
    012AA 015C      MOVW	R10,R24
    012AB 01F6      MOVW	R30,R12
    012AC 82B1      STD	Z+1,R11
    012AD 82A0      ST	Z,R10
(2026) 	} else {							/* No drive number is given */
    012AE C002      RJMP	0x12B1
(2027) #if _FS_RPATH
(2028) 		vol = CurrVol;					/* Use current drive */
(2029) #else
(2030) 		vol = 0;						/* Use drive 0 */
    012AF 24EE      CLR	R14
    012B0 24FF      CLR	R15
(2031) #endif
(2032) 	}
(2033) 
(2034) 	/* Check if the file system object is valid or not */
(2035) 	if (vol >= _VOLUMES) 				/* Is the drive number valid? */
    012B1 01C7      MOVW	R24,R14
    012B2 3081      CPI	R24,1
    012B3 E0E0      LDI	R30,0
    012B4 079E      CPC	R25,R30
    012B5 F010      BCS	0x12B8
(2036) 		return FR_INVALID_DRIVE;
    012B6 E00B      LDI	R16,0xB
    012B7 C4CF      RJMP	0x1787
(2037) 	*rfs = fs = FatFs[vol];				/* Return pointer to the corresponding file system object */
    012B8 EE83      LDI	R24,0xE3
    012B9 E095      LDI	R25,5
    012BA 01F7      MOVW	R30,R14
    012BB 0FEE      LSL	R30
    012BC 1FFF      ROL	R31
    012BD 0FE8      ADD	R30,R24
    012BE 1FF9      ADC	R31,R25
    012BF 8020      LD	R2,Z
    012C0 8031      LDD	R3,Z+1
    012C1 A23E      STD	Y+38,R3
    012C2 A22D      STD	Y+37,R2
    012C3 A9E9      LDD	R30,Y+49
    012C4 A9FA      LDD	R31,Y+50
    012C5 8231      STD	Z+1,R3
    012C6 8220      ST	Z,R2
(2038) 	if (!fs) return FR_NOT_ENABLED;		/* Is the file system object available? */
    012C7 0101      MOVW	R0,R2
    012C8 2022      TST	R2
    012C9 F421      BNE	0x12CE
    012CA 2033      TST	R3
    012CB F411      BNE	0x12CE
    012CC E00C      LDI	R16,0xC
    012CD C4B9      RJMP	0x1787
(2039) 
(2040) 	ENTER_FF(fs);						/* Lock file system */
(2041) 
(2042) 	if (fs->fs_type) {					/* If the logical drive has been mounted */
    012CE A1ED      LDD	R30,Y+37
    012CF A1FE      LDD	R31,Y+38
    012D0 8020      LD	R2,Z
    012D1 2022      TST	R2
    012D2 F079      BEQ	0x12E2
(2043) 		stat = disk_status(fs->drv);
    012D3 8101      LDD	R16,Z+1
    012D4 940E 03D3 CALL	_disk_status
    012D6 2EA0      MOV	R10,R16
(2044) 		if (!(stat & STA_NOINIT)) {		/* and the physical drive is kept initialized (has not been changed), */
    012D7 FD00      SBRC	R16,0
    012D8 C009      RJMP	0x12E2
(2045) 			if (!_FS_READONLY && chk_wp && (stat & STA_PROTECT))	/* Check write protection if needed */
    012D9 A80B      LDD	R0,Y+51
    012DA 2000      TST	R0
    012DB F021      BEQ	0x12E0
    012DC FF02      SBRS	R16,2
    012DD C002      RJMP	0x12E0
(2046) 				return FR_WRITE_PROTECTED;
    012DE E00A      LDI	R16,0xA
    012DF C4A7      RJMP	0x1787
(2047) 			return FR_OK;				/* The file system object is valid */
    012E0 2700      CLR	R16
    012E1 C4A5      RJMP	0x1787
(2048) 		}
(2049) 	}
(2050) 
(2051) 	/* The file system object is not valid. */
(2052) 	/* Following code attempts to mount the volume. (analyze BPB and initialize the fs object) */
(2053) 
(2054) 	fs->fs_type = 0;					/* Clear the file system object */
    012E2 2422      CLR	R2
    012E3 A1ED      LDD	R30,Y+37
    012E4 A1FE      LDD	R31,Y+38
    012E5 8220      ST	Z,R2
(2055) 	fs->drv = LD2PD(vol);				/* Bind the logical drive and a physical drive */
    012E6 82E1      STD	Z+1,R14
(2056) 	stat = disk_initialize(fs->drv);	/* Initialize low level disk I/O layer */
    012E7 8101      LDD	R16,Z+1
    012E8 940E 03BD CALL	_disk_initialize
    012EA 2EE0      MOV	R14,R16
    012EB 2CAE      MOV	R10,R14
(2057) 	if (stat & STA_NOINIT)				/* Check if the initialization succeeded */
    012EC FF00      SBRS	R16,0
    012ED C002      RJMP	0x12F0
(2058) 		return FR_NOT_READY;			/* Failed to initialize due to no media or hard error */
    012EE E003      LDI	R16,3
    012EF C497      RJMP	0x1787
(2059) 	if (!_FS_READONLY && chk_wp && (stat & STA_PROTECT))	/* Check disk write protection if needed */
    012F0 A80B      LDD	R0,Y+51
    012F1 2000      TST	R0
    012F2 F021      BEQ	0x12F7
    012F3 FEA2      SBRS	R10,2
    012F4 C002      RJMP	0x12F7
(2060) 		return FR_WRITE_PROTECTED;
    012F5 E00A      LDI	R16,0xA
    012F6 C490      RJMP	0x1787
(2061) #if _MAX_SS != 512						/* Get disk sector size (variable sector size cfg only) */
(2062) 	if (disk_ioctl(fs->drv, GET_SECTOR_SIZE, &fs->ssize) != RES_OK)
(2063) 		return FR_DISK_ERR;
(2064) #endif
(2065) 	/* Search FAT partition on the drive. Supports only generic partitionings, FDISK and SFD. */
(2066) 	fmt = check_fs(fs, bsect = 0);		/* Load sector 0 and check if it is an FAT-VBR (in SFD) */
    012F7 E080      LDI	R24,0
    012F8 8B89      STD	Y+17,R24
    012F9 8B8A      STD	Y+18,R24
    012FA 8B8B      STD	Y+19,R24
    012FB 8B8C      STD	Y+20,R24
    012FC E040      LDI	R20,0
    012FD E050      LDI	R21,0
    012FE E060      LDI	R22,0
    012FF E070      LDI	R23,0
    01300 8368      ST	Y,R22
    01301 8379      STD	Y+1,R23
    01302 019A      MOVW	R18,R20
    01303 A10D      LDD	R16,Y+37
    01304 A11E      LDD	R17,Y+38
    01305 DEC4      RCALL	ff.c:check_fs
    01306 2EA0      MOV	R10,R16
    01307 2CCA      MOV	R12,R10
(2067) 	if (LD2PT(vol) && !fmt) fmt = 1;	/* Force non-SFD if the volume is forced partition */
    01308 C000      RJMP	0x1309
(2068) 	if (fmt == 1) {						/* Not an FAT-VBR, the physical drive can be partitioned */
    01309 2D8C      MOV	R24,R12
    0130A 3081      CPI	R24,1
    0130B F009      BEQ	0x130D
    0130C C04C      RJMP	0x1359
(2069) 		/* Check the partition listed in the partition table */
(2070) 		pi = LD2PT(vol);
    0130D 24AA      CLR	R10
(2071) 		if (pi) pi--;
    0130E F009      BEQ	0x1310
    0130F 94AA      DEC	R10
(2072) 		tbl = &fs->win[MBR_Table + pi * SZ_PTE];/* Partition table */
    01310 E100      LDI	R16,0x10
    01311 2D1A      MOV	R17,R10
    01312 0301      MULSU	R16,R17
    01313 0150      MOVW	R10,R0
    01314 A18D      LDD	R24,Y+37
    01315 A19E      LDD	R25,Y+38
    01316 5184      SUBI	R24,0x14
    01317 4F9E      SBCI	R25,0xFE
    01318 0EA8      ADD	R10,R24
    01319 1EB9      ADC	R11,R25
(2073) 		if (tbl[4]) {						/* Is the partition existing? */
    0131A 01F5      MOVW	R30,R10
    0131B 8024      LDD	R2,Z+4
    0131C 2022      TST	R2
    0131D F409      BNE	0x131F
    0131E C03A      RJMP	0x1359
(2074) 			bsect = LD_DWORD(&tbl[8]);		/* Partition offset in LBA */
    0131F E188      LDI	R24,0x18
    01320 E090      LDI	R25,0
    01321 8503      LDD	R16,Z+11
    01322 2711      CLR	R17
    01323 2722      CLR	R18
    01324 2733      CLR	R19
    01325 938A      ST	-Y,R24
    01326 940E 494E CALL	lsl32
    01328 0118      MOVW	R2,R16
    01329 0129      MOVW	R4,R18
    0132A 01F5      MOVW	R30,R10
    0132B 8462      LDD	R6,Z+10
    0132C 2477      CLR	R7
    0132D 2488      CLR	R8
    0132E 2499      CLR	R9
    0132F 0143      MOVW	R8,R6
    01330 2466      CLR	R6
    01331 2477      CLR	R7
    01332 2826      OR	R2,R6
    01333 2837      OR	R3,R7
    01334 2848      OR	R4,R8
    01335 2859      OR	R5,R9
    01336 8461      LDD	R6,Z+9
    01337 2477      CLR	R7
    01338 2C76      MOV	R7,R6
    01339 2466      CLR	R6
    0133A 2488      CLR	R8
    0133B 2499      CLR	R9
    0133C 2826      OR	R2,R6
    0133D 2837      OR	R3,R7
    0133E 2848      OR	R4,R8
    0133F 2859      OR	R5,R9
    01340 9638      ADIW	R30,0x8
    01341 8060      LD	R6,Z
    01342 2477      CLR	R7
    01343 2488      CLR	R8
    01344 2499      CLR	R9
    01345 2826      OR	R2,R6
    01346 2837      OR	R3,R7
    01347 2848      OR	R4,R8
    01348 2859      OR	R5,R9
    01349 8A29      STD	Y+17,R2
    0134A 8A3A      STD	Y+18,R3
    0134B 8A4B      STD	Y+19,R4
    0134C 8A5C      STD	Y+20,R5
(2075) 			fmt = check_fs(fs, bsect);		/* Check the partition */
    0134D 8829      LDD	R2,Y+17
    0134E 883A      LDD	R3,Y+18
    0134F 884B      LDD	R4,Y+19
    01350 885C      LDD	R5,Y+20
    01351 8248      ST	Y,R4
    01352 8259      STD	Y+1,R5
    01353 0191      MOVW	R18,R2
    01354 A10D      LDD	R16,Y+37
    01355 A11E      LDD	R17,Y+38
    01356 DE73      RCALL	ff.c:check_fs
    01357 2EA0      MOV	R10,R16
    01358 2CCA      MOV	R12,R10
(2076) 		}
(2077) 	}
(2078) 	if (fmt == 3) return FR_DISK_ERR;
    01359 2D8C      MOV	R24,R12
    0135A 3083      CPI	R24,3
    0135B F411      BNE	0x135E
    0135C E001      LDI	R16,1
    0135D C429      RJMP	0x1787
(2079) 	if (fmt) return FR_NO_FILESYSTEM;		/* No FAT volume is found */
    0135E 20CC      TST	R12
    0135F F011      BEQ	0x1362
    01360 E00D      LDI	R16,0xD
    01361 C425      RJMP	0x1787
(2080) 
(2081) 	/* An FAT volume is found. Following code initializes the file system object */
(2082) 
(2083) 	if (LD_WORD(fs->win+BPB_BytsPerSec) != SS(fs))		/* (BPB_BytsPerSec must be equal to the physical sector size) */
    01362 A1ED      LDD	R30,Y+37
    01363 A1FE      LDD	R31,Y+38
    01364 AC21      LDD	R2,Z+57
    01365 2433      CLR	R3
    01366 AD82      LDD	R24,Z+58
    01367 2799      CLR	R25
    01368 2F98      MOV	R25,R24
    01369 2788      CLR	R24
    0136A 2982      OR	R24,R2
    0136B 2993      OR	R25,R3
    0136C 3080      CPI	R24,0
    0136D E0E2      LDI	R30,2
    0136E 079E      CPC	R25,R30
    0136F F011      BEQ	0x1372
(2084) 		return FR_NO_FILESYSTEM;
    01370 E00D      LDI	R16,0xD
    01371 C415      RJMP	0x1787
(2085) 
(2086) 	fasize = LD_WORD(fs->win+BPB_FATSz16);				/* Number of sectors per FAT */
    01372 A1ED      LDD	R30,Y+37
    01373 A1FE      LDD	R31,Y+38
    01374 5BEC      SUBI	R30,0xBC
    01375 4FFF      SBCI	R31,0xFF
    01376 8020      LD	R2,Z
    01377 54E4      SUBI	R30,0x44
    01378 40F0      SBCI	R31,0
    01379 2433      CLR	R3
    0137A 5BEB      SUBI	R30,0xBB
    0137B 4FFF      SBCI	R31,0xFF
    0137C 8040      LD	R4,Z
    0137D 2455      CLR	R5
    0137E 2C54      MOV	R5,R4
    0137F 2444      CLR	R4
    01380 2842      OR	R4,R2
    01381 2853      OR	R5,R3
    01382 0112      MOVW	R2,R4
    01383 2444      CLR	R4
    01384 2455      CLR	R5
    01385 822D      STD	Y+5,R2
    01386 823E      STD	Y+6,R3
    01387 824F      STD	Y+7,R4
    01388 8658      STD	Y+8,R5
(2087) 	if (!fasize) fasize = LD_DWORD(fs->win+BPB_FATSz32);
    01389 802D      LDD	R2,Y+5
    0138A 803E      LDD	R3,Y+6
    0138B 804F      LDD	R4,Y+7
    0138C 8458      LDD	R5,Y+8
    0138D 9488      BCLR	0
    0138E 2022      TST	R2
    0138F 0432      CPC	R3,R2
    01390 0442      CPC	R4,R2
    01391 0452      CPC	R5,R2
    01392 F009      BEQ	0x1394
    01393 C03C      RJMP	0x13D0
    01394 E188      LDI	R24,0x18
    01395 E090      LDI	R25,0
    01396 A1ED      LDD	R30,Y+37
    01397 A1FE      LDD	R31,Y+38
    01398 5AEB      SUBI	R30,0xAB
    01399 4FFF      SBCI	R31,0xFF
    0139A 8100      LD	R16,Z
    0139B 2711      CLR	R17
    0139C 2722      CLR	R18
    0139D 2733      CLR	R19
    0139E 938A      ST	-Y,R24
    0139F 940E 494E CALL	lsl32
    013A1 0118      MOVW	R2,R16
    013A2 0129      MOVW	R4,R18
    013A3 A1ED      LDD	R30,Y+37
    013A4 A1FE      LDD	R31,Y+38
    013A5 5AEC      SUBI	R30,0xAC
    013A6 4FFF      SBCI	R31,0xFF
    013A7 8060      LD	R6,Z
    013A8 55E4      SUBI	R30,0x54
    013A9 40F0      SBCI	R31,0
    013AA 2477      CLR	R7
    013AB 2488      CLR	R8
    013AC 2499      CLR	R9
    013AD 0143      MOVW	R8,R6
    013AE 2466      CLR	R6
    013AF 2477      CLR	R7
    013B0 2826      OR	R2,R6
    013B1 2837      OR	R3,R7
    013B2 2848      OR	R4,R8
    013B3 2859      OR	R5,R9
    013B4 5AED      SUBI	R30,0xAD
    013B5 4FFF      SBCI	R31,0xFF
    013B6 8060      LD	R6,Z
    013B7 55E3      SUBI	R30,0x53
    013B8 40F0      SBCI	R31,0
    013B9 2477      CLR	R7
    013BA 2C76      MOV	R7,R6
    013BB 2466      CLR	R6
    013BC 2488      CLR	R8
    013BD 2499      CLR	R9
    013BE 2826      OR	R2,R6
    013BF 2837      OR	R3,R7
    013C0 2848      OR	R4,R8
    013C1 2859      OR	R5,R9
    013C2 5AEE      SUBI	R30,0xAE
    013C3 4FFF      SBCI	R31,0xFF
    013C4 8060      LD	R6,Z
    013C5 2477      CLR	R7
    013C6 2488      CLR	R8
    013C7 2499      CLR	R9
    013C8 2826      OR	R2,R6
    013C9 2837      OR	R3,R7
    013CA 2848      OR	R4,R8
    013CB 2859      OR	R5,R9
    013CC 822D      STD	Y+5,R2
    013CD 823E      STD	Y+6,R3
    013CE 824F      STD	Y+7,R4
    013CF 8658      STD	Y+8,R5
(2088) 	fs->fsize = fasize;
    013D0 802D      LDD	R2,Y+5
    013D1 803E      LDD	R3,Y+6
    013D2 804F      LDD	R4,Y+7
    013D3 8458      LDD	R5,Y+8
    013D4 A1ED      LDD	R30,Y+37
    013D5 A1FE      LDD	R31,Y+38
    013D6 8E22      STD	Z+26,R2
    013D7 8E33      STD	Z+27,R3
    013D8 8E44      STD	Z+28,R4
    013D9 8E55      STD	Z+29,R5
(2089) 
(2090) 	fs->n_fats = b = fs->win[BPB_NumFATs];				/* Number of FAT copies */
    013DA ACA6      LDD	R10,Z+62
    013DB 2CEA      MOV	R14,R10
    013DC 82A3      STD	Z+3,R10
(2091) 	if (b != 1 && b != 2) return FR_NO_FILESYSTEM;		/* (Must be 1 or 2) */
    013DD 2D8E      MOV	R24,R14
    013DE 3081      CPI	R24,1
    013DF F021      BEQ	0x13E4
    013E0 3082      CPI	R24,2
    013E1 F011      BEQ	0x13E4
    013E2 E00D      LDI	R16,0xD
    013E3 C3A3      RJMP	0x1787
(2092) 	fasize *= b;										/* Number of sectors for FAT area */
    013E4 2C2E      MOV	R2,R14
    013E5 2433      CLR	R3
    013E6 2444      CLR	R4
    013E7 2455      CLR	R5
    013E8 810D      LDD	R16,Y+5
    013E9 811E      LDD	R17,Y+6
    013EA 812F      LDD	R18,Y+7
    013EB 8538      LDD	R19,Y+8
    013EC 925A      ST	-Y,R5
    013ED 924A      ST	-Y,R4
    013EE 923A      ST	-Y,R3
    013EF 922A      ST	-Y,R2
    013F0 940E 486F CALL	empy32u|empy32s
    013F2 830D      STD	Y+5,R16
    013F3 831E      STD	Y+6,R17
    013F4 832F      STD	Y+7,R18
    013F5 8738      STD	Y+8,R19
(2093) 
(2094) 	fs->csize = b = fs->win[BPB_SecPerClus];			/* Number of sectors per cluster */
    013F6 A1ED      LDD	R30,Y+37
    013F7 A1FE      LDD	R31,Y+38
    013F8 ACA3      LDD	R10,Z+59
    013F9 2CEA      MOV	R14,R10
    013FA 82A2      STD	Z+2,R10
(2095) 	if (!b || (b & (b - 1))) return FR_NO_FILESYSTEM;	/* (Must be power of 2) */
    013FB 20AA      TST	R10
    013FC F029      BEQ	0x1402
    013FD 2D8E      MOV	R24,R14
    013FE 5081      SUBI	R24,1
    013FF 2C2E      MOV	R2,R14
    01400 2228      AND	R2,R24
    01401 F011      BEQ	0x1404
    01402 E00D      LDI	R16,0xD
    01403 C383      RJMP	0x1787
(2096) 
(2097) 	fs->n_rootdir = LD_WORD(fs->win+BPB_RootEntCnt);	/* Number of root directory entries */
    01404 A1ED      LDD	R30,Y+37
    01405 A1FE      LDD	R31,Y+38
    01406 AC27      LDD	R2,Z+63
    01407 2433      CLR	R3
    01408 5CE0      SUBI	R30,0xC0
    01409 4FFF      SBCI	R31,0xFF
    0140A 8040      LD	R4,Z
    0140B 54E0      SUBI	R30,0x40
    0140C 40F0      SBCI	R31,0
    0140D 2455      CLR	R5
    0140E 2C54      MOV	R5,R4
    0140F 2444      CLR	R4
    01410 2842      OR	R4,R2
    01411 2853      OR	R5,R3
    01412 8651      STD	Z+9,R5
    01413 8640      STD	Z+8,R4
(2098) 	if (fs->n_rootdir % (SS(fs) / SZ_DIR)) return FR_NO_FILESYSTEM;	/* (BPB_RootEntCnt must be sector aligned) */
    01414 8580      LDD	R24,Z+8
    01415 8591      LDD	R25,Z+9
    01416 708F      ANDI	R24,0xF
    01417 7090      ANDI	R25,0
    01418 3080      CPI	R24,0
    01419 0789      CPC	R24,R25
    0141A F011      BEQ	0x141D
    0141B E00D      LDI	R16,0xD
    0141C C36A      RJMP	0x1787
(2099) 
(2100) 	tsect = LD_WORD(fs->win+BPB_TotSec16);				/* Number of sectors on the volume */
    0141D A1ED      LDD	R30,Y+37
    0141E A1FE      LDD	R31,Y+38
    0141F 5BEF      SUBI	R30,0xBF
    01420 4FFF      SBCI	R31,0xFF
    01421 8020      LD	R2,Z
    01422 54E1      SUBI	R30,0x41
    01423 40F0      SBCI	R31,0
    01424 2433      CLR	R3
    01425 5BEE      SUBI	R30,0xBE
    01426 4FFF      SBCI	R31,0xFF
    01427 8040      LD	R4,Z
    01428 2455      CLR	R5
    01429 2C54      MOV	R5,R4
    0142A 2444      CLR	R4
    0142B 2842      OR	R4,R2
    0142C 2853      OR	R5,R3
    0142D 0112      MOVW	R2,R4
    0142E 2444      CLR	R4
    0142F 2455      CLR	R5
    01430 862D      STD	Y+13,R2
    01431 863E      STD	Y+14,R3
    01432 864F      STD	Y+15,R4
    01433 8A58      STD	Y+16,R5
(2101) 	if (!tsect) tsect = LD_DWORD(fs->win+BPB_TotSec32);
    01434 842D      LDD	R2,Y+13
    01435 843E      LDD	R3,Y+14
    01436 844F      LDD	R4,Y+15
    01437 8858      LDD	R5,Y+16
    01438 9488      BCLR	0
    01439 2022      TST	R2
    0143A 0432      CPC	R3,R2
    0143B 0442      CPC	R4,R2
    0143C 0452      CPC	R5,R2
    0143D F009      BEQ	0x143F
    0143E C03C      RJMP	0x147B
    0143F E188      LDI	R24,0x18
    01440 E090      LDI	R25,0
    01441 A1ED      LDD	R30,Y+37
    01442 A1FE      LDD	R31,Y+38
    01443 5AEF      SUBI	R30,0xAF
    01444 4FFF      SBCI	R31,0xFF
    01445 8100      LD	R16,Z
    01446 2711      CLR	R17
    01447 2722      CLR	R18
    01448 2733      CLR	R19
    01449 938A      ST	-Y,R24
    0144A 940E 494E CALL	lsl32
    0144C 0118      MOVW	R2,R16
    0144D 0129      MOVW	R4,R18
    0144E A1ED      LDD	R30,Y+37
    0144F A1FE      LDD	R31,Y+38
    01450 5BE0      SUBI	R30,0xB0
    01451 4FFF      SBCI	R31,0xFF
    01452 8060      LD	R6,Z
    01453 55E0      SUBI	R30,0x50
    01454 40F0      SBCI	R31,0
    01455 2477      CLR	R7
    01456 2488      CLR	R8
    01457 2499      CLR	R9
    01458 0143      MOVW	R8,R6
    01459 2466      CLR	R6
    0145A 2477      CLR	R7
    0145B 2826      OR	R2,R6
    0145C 2837      OR	R3,R7
    0145D 2848      OR	R4,R8
    0145E 2859      OR	R5,R9
    0145F 5BE1      SUBI	R30,0xB1
    01460 4FFF      SBCI	R31,0xFF
    01461 8060      LD	R6,Z
    01462 54EF      SUBI	R30,0x4F
    01463 40F0      SBCI	R31,0
    01464 2477      CLR	R7
    01465 2C76      MOV	R7,R6
    01466 2466      CLR	R6
    01467 2488      CLR	R8
    01468 2499      CLR	R9
    01469 2826      OR	R2,R6
    0146A 2837      OR	R3,R7
    0146B 2848      OR	R4,R8
    0146C 2859      OR	R5,R9
    0146D 5BE2      SUBI	R30,0xB2
    0146E 4FFF      SBCI	R31,0xFF
    0146F 8060      LD	R6,Z
    01470 2477      CLR	R7
    01471 2488      CLR	R8
    01472 2499      CLR	R9
    01473 2826      OR	R2,R6
    01474 2837      OR	R3,R7
    01475 2848      OR	R4,R8
    01476 2859      OR	R5,R9
    01477 862D      STD	Y+13,R2
    01478 863E      STD	Y+14,R3
    01479 864F      STD	Y+15,R4
    0147A 8A58      STD	Y+16,R5
(2102) 
(2103) 	nrsv = LD_WORD(fs->win+BPB_RsvdSecCnt);				/* Number of reserved sectors */
    0147B A1ED      LDD	R30,Y+37
    0147C A1FE      LDD	R31,Y+38
    0147D AC24      LDD	R2,Z+60
    0147E 2433      CLR	R3
    0147F ACE5      LDD	R14,Z+61
    01480 24FF      CLR	R15
    01481 2CFE      MOV	R15,R14
    01482 24EE      CLR	R14
    01483 28E2      OR	R14,R2
    01484 28F3      OR	R15,R3
(2104) 	if (!nrsv) return FR_NO_FILESYSTEM;					/* (BPB_RsvdSecCnt must not be 0) */
    01485 20EE      TST	R14
    01486 F421      BNE	0x148B
    01487 20FF      TST	R15
    01488 F411      BNE	0x148B
    01489 E00D      LDI	R16,0xD
    0148A C2FC      RJMP	0x1787
(2105) 
(2106) 	/* Determine the FAT sub type */
(2107) 	sysect = nrsv + fasize + fs->n_rootdir / (SS(fs) / SZ_DIR);	/* RSV+FAT+DIR */
    0148B 802D      LDD	R2,Y+5
    0148C 803E      LDD	R3,Y+6
    0148D 804F      LDD	R4,Y+7
    0148E 8458      LDD	R5,Y+8
    0148F 0137      MOVW	R6,R14
    01490 2488      CLR	R8
    01491 2499      CLR	R9
    01492 0C62      ADD	R6,R2
    01493 1C73      ADC	R7,R3
    01494 1C84      ADC	R8,R4
    01495 1C95      ADC	R9,R5
    01496 A1ED      LDD	R30,Y+37
    01497 A1FE      LDD	R31,Y+38
    01498 9638      ADIW	R30,0x8
    01499 8020      LD	R2,Z
    0149A 8031      LDD	R3,Z+1
    0149B 9436      LSR	R3
    0149C 9427      ROR	R2
    0149D 9436      LSR	R3
    0149E 9427      ROR	R2
    0149F 9436      LSR	R3
    014A0 9427      ROR	R2
    014A1 9436      LSR	R3
    014A2 9427      ROR	R2
    014A3 2444      CLR	R4
    014A4 2455      CLR	R5
    014A5 0C62      ADD	R6,R2
    014A6 1C73      ADC	R7,R3
    014A7 1C84      ADC	R8,R4
    014A8 1C95      ADC	R9,R5
    014A9 8A6D      STD	Y+21,R6
    014AA 8A7E      STD	Y+22,R7
    014AB 8A8F      STD	Y+23,R8
    014AC 8E98      STD	Y+24,R9
(2108) 	if (tsect < sysect) return FR_NO_FILESYSTEM;		/* (Invalid volume size) */
    014AD 882D      LDD	R2,Y+21
    014AE 883E      LDD	R3,Y+22
    014AF 884F      LDD	R4,Y+23
    014B0 8C58      LDD	R5,Y+24
    014B1 846D      LDD	R6,Y+13
    014B2 847E      LDD	R7,Y+14
    014B3 848F      LDD	R8,Y+15
    014B4 8898      LDD	R9,Y+16
    014B5 1462      CP	R6,R2
    014B6 0473      CPC	R7,R3
    014B7 0484      CPC	R8,R4
    014B8 0495      CPC	R9,R5
    014B9 F410      BCC	0x14BC
    014BA E00D      LDI	R16,0xD
    014BB C2CB      RJMP	0x1787
(2109) 	nclst = (tsect - sysect) / fs->csize;				/* Number of clusters */
    014BC 882D      LDD	R2,Y+21
    014BD 883E      LDD	R3,Y+22
    014BE 884F      LDD	R4,Y+23
    014BF 8C58      LDD	R5,Y+24
    014C0 850D      LDD	R16,Y+13
    014C1 851E      LDD	R17,Y+14
    014C2 852F      LDD	R18,Y+15
    014C3 8938      LDD	R19,Y+16
    014C4 1902      SUB	R16,R2
    014C5 0913      SBC	R17,R3
    014C6 0924      SBC	R18,R4
    014C7 0935      SBC	R19,R5
    014C8 A1ED      LDD	R30,Y+37
    014C9 A1FE      LDD	R31,Y+38
    014CA 9632      ADIW	R30,2
    014CB 8020      LD	R2,Z
    014CC 2433      CLR	R3
    014CD 2444      CLR	R4
    014CE 2455      CLR	R5
    014CF 925A      ST	-Y,R5
    014D0 924A      ST	-Y,R4
    014D1 923A      ST	-Y,R3
    014D2 922A      ST	-Y,R2
    014D3 940E 47C9 CALL	div32u
    014D5 8709      STD	Y+9,R16
    014D6 871A      STD	Y+10,R17
    014D7 872B      STD	Y+11,R18
    014D8 873C      STD	Y+12,R19
(2110) 	if (!nclst) return FR_NO_FILESYSTEM;				/* (Invalid volume size) */
    014D9 8429      LDD	R2,Y+9
    014DA 843A      LDD	R3,Y+10
    014DB 844B      LDD	R4,Y+11
    014DC 845C      LDD	R5,Y+12
    014DD 9488      BCLR	0
    014DE 2022      TST	R2
    014DF 0432      CPC	R3,R2
    014E0 0442      CPC	R4,R2
    014E1 0452      CPC	R5,R2
    014E2 F411      BNE	0x14E5
    014E3 E00D      LDI	R16,0xD
    014E4 C2A2      RJMP	0x1787
(2111) 	fmt = FS_FAT12;
    014E5 24CC      CLR	R12
    014E6 94C3      INC	R12
(2112) 	if (nclst >= MIN_FAT16) fmt = FS_FAT16;
    014E7 EF46      LDI	R20,0xF6
    014E8 E05F      LDI	R21,0xF
    014E9 E060      LDI	R22,0
    014EA E070      LDI	R23,0
    014EB 8429      LDD	R2,Y+9
    014EC 843A      LDD	R3,Y+10
    014ED 844B      LDD	R4,Y+11
    014EE 845C      LDD	R5,Y+12
    014EF 1624      CP	R2,R20
    014F0 0635      CPC	R3,R21
    014F1 0646      CPC	R4,R22
    014F2 0657      CPC	R5,R23
    014F3 F010      BCS	0x14F6
    014F4 E082      LDI	R24,2
    014F5 2EC8      MOV	R12,R24
(2113) 	if (nclst >= MIN_FAT32) fmt = FS_FAT32;
    014F6 EF46      LDI	R20,0xF6
    014F7 EF5F      LDI	R21,0xFF
    014F8 E060      LDI	R22,0
    014F9 E070      LDI	R23,0
    014FA 8429      LDD	R2,Y+9
    014FB 843A      LDD	R3,Y+10
    014FC 844B      LDD	R4,Y+11
    014FD 845C      LDD	R5,Y+12
    014FE 1624      CP	R2,R20
    014FF 0635      CPC	R3,R21
    01500 0646      CPC	R4,R22
    01501 0657      CPC	R5,R23
    01502 F010      BCS	0x1505
    01503 E083      LDI	R24,3
    01504 2EC8      MOV	R12,R24
(2114) 
(2115) 	/* Boundaries and Limits */
(2116) 	fs->n_fatent = nclst + 2;							/* Number of FAT entries */
    01505 E042      LDI	R20,2
    01506 E050      LDI	R21,0
    01507 E060      LDI	R22,0
    01508 E070      LDI	R23,0
    01509 8429      LDD	R2,Y+9
    0150A 843A      LDD	R3,Y+10
    0150B 844B      LDD	R4,Y+11
    0150C 845C      LDD	R5,Y+12
    0150D 0E24      ADD	R2,R20
    0150E 1E35      ADC	R3,R21
    0150F 1E46      ADC	R4,R22
    01510 1E57      ADC	R5,R23
    01511 A1ED      LDD	R30,Y+37
    01512 A1FE      LDD	R31,Y+38
    01513 9676      ADIW	R30,0x16
    01514 8220      ST	Z,R2
    01515 8231      STD	Z+1,R3
    01516 8242      STD	Z+2,R4
    01517 8253      STD	Z+3,R5
(2117) 	fs->database = bsect + sysect;						/* Data start sector */
    01518 882D      LDD	R2,Y+21
    01519 883E      LDD	R3,Y+22
    0151A 884F      LDD	R4,Y+23
    0151B 8C58      LDD	R5,Y+24
    0151C 8869      LDD	R6,Y+17
    0151D 887A      LDD	R7,Y+18
    0151E 888B      LDD	R8,Y+19
    0151F 889C      LDD	R9,Y+20
    01520 0C62      ADD	R6,R2
    01521 1C73      ADC	R7,R3
    01522 1C84      ADC	R8,R4
    01523 1C95      ADC	R9,R5
    01524 A1ED      LDD	R30,Y+37
    01525 A1FE      LDD	R31,Y+38
    01526 96B6      ADIW	R30,0x26
    01527 8260      ST	Z,R6
    01528 8271      STD	Z+1,R7
    01529 8282      STD	Z+2,R8
    0152A 8293      STD	Z+3,R9
(2118) 	fs->fatbase = bsect + nrsv; 						/* FAT start sector */
    0152B 0117      MOVW	R2,R14
    0152C 2444      CLR	R4
    0152D 2455      CLR	R5
    0152E 8869      LDD	R6,Y+17
    0152F 887A      LDD	R7,Y+18
    01530 888B      LDD	R8,Y+19
    01531 889C      LDD	R9,Y+20
    01532 0C62      ADD	R6,R2
    01533 1C73      ADC	R7,R3
    01534 1C84      ADC	R8,R4
    01535 1C95      ADC	R9,R5
    01536 A1ED      LDD	R30,Y+37
    01537 A1FE      LDD	R31,Y+38
    01538 8E66      STD	Z+30,R6
    01539 8E77      STD	Z+31,R7
    0153A A280      STD	Z+32,R8
    0153B A291      STD	Z+33,R9
(2119) 	if (fmt == FS_FAT32) {
    0153C 2D8C      MOV	R24,R12
    0153D 3083      CPI	R24,3
    0153E F009      BEQ	0x1540
    0153F C055      RJMP	0x1595
(2120) 		if (fs->n_rootdir) return FR_NO_FILESYSTEM;		/* (BPB_RootEntCnt must be 0) */
    01540 8420      LDD	R2,Z+8
    01541 8431      LDD	R3,Z+9
    01542 2022      TST	R2
    01543 F411      BNE	0x1546
    01544 2033      TST	R3
    01545 F011      BEQ	0x1548
    01546 E00D      LDI	R16,0xD
    01547 C23F      RJMP	0x1787
(2121) 		fs->dirbase = LD_DWORD(fs->win+BPB_RootClus);	/* Root directory start cluster */
    01548 E188      LDI	R24,0x18
    01549 E090      LDI	R25,0
    0154A A1ED      LDD	R30,Y+37
    0154B A1FE      LDD	R31,Y+38
    0154C 5AE3      SUBI	R30,0xA3
    0154D 4FFF      SBCI	R31,0xFF
    0154E 8100      LD	R16,Z
    0154F 2711      CLR	R17
    01550 2722      CLR	R18
    01551 2733      CLR	R19
    01552 938A      ST	-Y,R24
    01553 940E 494E CALL	lsl32
    01555 0118      MOVW	R2,R16
    01556 0129      MOVW	R4,R18
    01557 A1ED      LDD	R30,Y+37
    01558 A1FE      LDD	R31,Y+38
    01559 5AE4      SUBI	R30,0xA4
    0155A 4FFF      SBCI	R31,0xFF
    0155B 8060      LD	R6,Z
    0155C 55EC      SUBI	R30,0x5C
    0155D 40F0      SBCI	R31,0
    0155E 2477      CLR	R7
    0155F 2488      CLR	R8
    01560 2499      CLR	R9
    01561 0143      MOVW	R8,R6
    01562 2466      CLR	R6
    01563 2477      CLR	R7
    01564 2826      OR	R2,R6
    01565 2837      OR	R3,R7
    01566 2848      OR	R4,R8
    01567 2859      OR	R5,R9
    01568 5AE5      SUBI	R30,0xA5
    01569 4FFF      SBCI	R31,0xFF
    0156A 8060      LD	R6,Z
    0156B 55EB      SUBI	R30,0x5B
    0156C 40F0      SBCI	R31,0
    0156D 2477      CLR	R7
    0156E 2C76      MOV	R7,R6
    0156F 2466      CLR	R6
    01570 2488      CLR	R8
    01571 2499      CLR	R9
    01572 2826      OR	R2,R6
    01573 2837      OR	R3,R7
    01574 2848      OR	R4,R8
    01575 2859      OR	R5,R9
    01576 5AE6      SUBI	R30,0xA6
    01577 4FFF      SBCI	R31,0xFF
    01578 8060      LD	R6,Z
    01579 55EA      SUBI	R30,0x5A
    0157A 40F0      SBCI	R31,0
    0157B 2477      CLR	R7
    0157C 2488      CLR	R8
    0157D 2499      CLR	R9
    0157E 2826      OR	R2,R6
    0157F 2837      OR	R3,R7
    01580 2848      OR	R4,R8
    01581 2859      OR	R5,R9
    01582 A222      STD	Z+34,R2
    01583 A233      STD	Z+35,R3
    01584 A244      STD	Z+36,R4
    01585 A255      STD	Z+37,R5
(2122) 		szbfat = fs->n_fatent * 4;						/* (Required FAT size) */
    01586 E082      LDI	R24,2
    01587 E090      LDI	R25,0
    01588 9676      ADIW	R30,0x16
    01589 8100      LD	R16,Z
    0158A 8111      LDD	R17,Z+1
    0158B 8122      LDD	R18,Z+2
    0158C 8133      LDD	R19,Z+3
    0158D 938A      ST	-Y,R24
    0158E 940E 494E CALL	lsl32
    01590 8F09      STD	Y+25,R16
    01591 8F1A      STD	Y+26,R17
    01592 8F2B      STD	Y+27,R18
    01593 8F3C      STD	Y+28,R19
(2123) 	} else {
    01594 C06A      RJMP	0x15FF
(2124) 		if (!fs->n_rootdir)	return FR_NO_FILESYSTEM;	/* (BPB_RootEntCnt must not be 0) */
    01595 A1ED      LDD	R30,Y+37
    01596 A1FE      LDD	R31,Y+38
    01597 8420      LDD	R2,Z+8
    01598 8431      LDD	R3,Z+9
    01599 2022      TST	R2
    0159A F421      BNE	0x159F
    0159B 2033      TST	R3
    0159C F411      BNE	0x159F
    0159D E00D      LDI	R16,0xD
    0159E C1E8      RJMP	0x1787
(2125) 		fs->dirbase = fs->fatbase + fasize;				/* Root directory start sector */
    0159F 802D      LDD	R2,Y+5
    015A0 803E      LDD	R3,Y+6
    015A1 804F      LDD	R4,Y+7
    015A2 8458      LDD	R5,Y+8
    015A3 A1ED      LDD	R30,Y+37
    015A4 A1FE      LDD	R31,Y+38
    015A5 8C66      LDD	R6,Z+30
    015A6 8C77      LDD	R7,Z+31
    015A7 A080      LDD	R8,Z+32
    015A8 A091      LDD	R9,Z+33
    015A9 0C62      ADD	R6,R2
    015AA 1C73      ADC	R7,R3
    015AB 1C84      ADC	R8,R4
    015AC 1C95      ADC	R9,R5
    015AD A262      STD	Z+34,R6
    015AE A273      STD	Z+35,R7
    015AF A284      STD	Z+36,R8
    015B0 A295      STD	Z+37,R9
(2126) 		szbfat = (fmt == FS_FAT16) ?					/* (Required FAT size) */
    015B1 2D8C      MOV	R24,R12
    015B2 3082      CPI	R24,2
    015B3 F471      BNE	0x15C2
    015B4 9676      ADIW	R30,0x16
    015B5 8020      LD	R2,Z
    015B6 8031      LDD	R3,Z+1
    015B7 8042      LDD	R4,Z+2
    015B8 8053      LDD	R5,Z+3
    015B9 0C22      LSL	R2
    015BA 1C33      ROL	R3
    015BB 1C44      ROL	R4
    015BC 1C55      ROL	R5
    015BD 8E2D      STD	Y+29,R2
    015BE 8E3E      STD	Y+30,R3
    015BF 8E4F      STD	Y+31,R4
    015C0 A258      STD	Y+32,R5
    015C1 C035      RJMP	0x15F7
    015C2 A1ED      LDD	R30,Y+37
    015C3 A1FE      LDD	R31,Y+38
    015C4 9676      ADIW	R30,0x16
    015C5 8020      LD	R2,Z
    015C6 8031      LDD	R3,Z+1
    015C7 8042      LDD	R4,Z+2
    015C8 8053      LDD	R5,Z+3
    015C9 A229      STD	Y+33,R2
    015CA A23A      STD	Y+34,R3
    015CB A24B      STD	Y+35,R4
    015CC A25C      STD	Y+36,R5
    015CD E041      LDI	R20,1
    015CE E050      LDI	R21,0
    015CF E060      LDI	R22,0
    015D0 E070      LDI	R23,0
    015D1 A029      LDD	R2,Y+33
    015D2 A03A      LDD	R3,Y+34
    015D3 A04B      LDD	R4,Y+35
    015D4 A05C      LDD	R5,Y+36
    015D5 2224      AND	R2,R20
    015D6 2235      AND	R3,R21
    015D7 2246      AND	R4,R22
    015D8 2257      AND	R5,R23
    015D9 A069      LDD	R6,Y+33
    015DA A07A      LDD	R7,Y+34
    015DB A08B      LDD	R8,Y+35
    015DC A09C      LDD	R9,Y+36
    015DD E043      LDI	R20,3
    015DE E050      LDI	R21,0
    015DF E060      LDI	R22,0
    015E0 E070      LDI	R23,0
    015E1 929A      ST	-Y,R9
    015E2 928A      ST	-Y,R8
    015E3 927A      ST	-Y,R7
    015E4 926A      ST	-Y,R6
    015E5 018A      MOVW	R16,R20
    015E6 019B      MOVW	R18,R22
    015E7 940E 486F CALL	empy32u|empy32s
    015E9 0138      MOVW	R6,R16
    015EA 0149      MOVW	R8,R18
    015EB 9496      LSR	R9
    015EC 9487      ROR	R8
    015ED 9477      ROR	R7
    015EE 9467      ROR	R6
    015EF 0C62      ADD	R6,R2
    015F0 1C73      ADC	R7,R3
    015F1 1C84      ADC	R8,R4
    015F2 1C95      ADC	R9,R5
    015F3 8E6D      STD	Y+29,R6
    015F4 8E7E      STD	Y+30,R7
    015F5 8E8F      STD	Y+31,R8
    015F6 A298      STD	Y+32,R9
    015F7 8C2D      LDD	R2,Y+29
    015F8 8C3E      LDD	R3,Y+30
    015F9 8C4F      LDD	R4,Y+31
    015FA A058      LDD	R5,Y+32
    015FB 8E29      STD	Y+25,R2
    015FC 8E3A      STD	Y+26,R3
    015FD 8E4B      STD	Y+27,R4
    015FE 8E5C      STD	Y+28,R5
(2127) 			fs->n_fatent * 2 : fs->n_fatent * 3 / 2 + (fs->n_fatent & 1);
(2128) 	}
(2129) 	if (fs->fsize < (szbfat + (SS(fs) - 1)) / SS(fs))	/* (BPB_FATSz must not be less than required) */
    015FF EF4F      LDI	R20,0xFF
    01600 E051      LDI	R21,1
    01601 E060      LDI	R22,0
    01602 E070      LDI	R23,0
    01603 8D09      LDD	R16,Y+25
    01604 8D1A      LDD	R17,Y+26
    01605 8D2B      LDD	R18,Y+27
    01606 8D3C      LDD	R19,Y+28
    01607 0F04      ADD	R16,R20
    01608 1F15      ADC	R17,R21
    01609 1F26      ADC	R18,R22
    0160A 1F37      ADC	R19,R23
    0160B E089      LDI	R24,0x9
    0160C E090      LDI	R25,0
    0160D 938A      ST	-Y,R24
    0160E 940E 4967 CALL	lsr32
    01610 A1ED      LDD	R30,Y+37
    01611 A1FE      LDD	R31,Y+38
    01612 8C22      LDD	R2,Z+26
    01613 8C33      LDD	R3,Z+27
    01614 8C44      LDD	R4,Z+28
    01615 8C55      LDD	R5,Z+29
    01616 1620      CP	R2,R16
    01617 0631      CPC	R3,R17
    01618 0642      CPC	R4,R18
    01619 0653      CPC	R5,R19
    0161A F410      BCC	0x161D
(2130) 		return FR_NO_FILESYSTEM;
    0161B E00D      LDI	R16,0xD
    0161C C16A      RJMP	0x1787
(2131) 
(2132) #if !_FS_READONLY
(2133) 	/* Initialize cluster allocation information */
(2134) 	fs->free_clust = 0xFFFFFFFF;
    0161D A1ED      LDD	R30,Y+37
    0161E A1FE      LDD	R31,Y+38
    0161F 963E      ADIW	R30,0xE
    01620 EF8F      LDI	R24,0xFF
    01621 8380      ST	Z,R24
    01622 8381      STD	Z+1,R24
    01623 8382      STD	Z+2,R24
    01624 8383      STD	Z+3,R24
(2135) 	fs->last_clust = 0;
    01625 A1ED      LDD	R30,Y+37
    01626 A1FE      LDD	R31,Y+38
    01627 963A      ADIW	R30,0xA
    01628 E080      LDI	R24,0
    01629 8380      ST	Z,R24
    0162A 8381      STD	Z+1,R24
    0162B 8382      STD	Z+2,R24
    0162C 8383      STD	Z+3,R24
(2136) 
(2137) 	/* Get fsinfo if available */
(2138) 	if (fmt == FS_FAT32) {
    0162D 2D8C      MOV	R24,R12
    0162E 3083      CPI	R24,3
    0162F F009      BEQ	0x1631
    01630 C13C      RJMP	0x176D
(2139) 	 	fs->fsi_flag = 0;
    01631 2422      CLR	R2
    01632 A1ED      LDD	R30,Y+37
    01633 A1FE      LDD	R31,Y+38
    01634 8225      STD	Z+5,R2
(2140) 		fs->fsi_sector = bsect + LD_WORD(fs->win+BPB_FSInfo);
    01635 5AE2      SUBI	R30,0xA2
    01636 4FFF      SBCI	R31,0xFF
    01637 8020      LD	R2,Z
    01638 55EE      SUBI	R30,0x5E
    01639 40F0      SBCI	R31,0
    0163A 2433      CLR	R3
    0163B 5AE1      SUBI	R30,0xA1
    0163C 4FFF      SBCI	R31,0xFF
    0163D 8040      LD	R4,Z
    0163E 2455      CLR	R5
    0163F 2C54      MOV	R5,R4
    01640 2444      CLR	R4
    01641 2842      OR	R4,R2
    01642 2853      OR	R5,R3
    01643 0112      MOVW	R2,R4
    01644 2444      CLR	R4
    01645 2455      CLR	R5
    01646 8869      LDD	R6,Y+17
    01647 887A      LDD	R7,Y+18
    01648 888B      LDD	R8,Y+19
    01649 889C      LDD	R9,Y+20
    0164A 0C62      ADD	R6,R2
    0164B 1C73      ADC	R7,R3
    0164C 1C84      ADC	R8,R4
    0164D 1C95      ADC	R9,R5
    0164E A1ED      LDD	R30,Y+37
    0164F A1FE      LDD	R31,Y+38
    01650 8A62      STD	Z+18,R6
    01651 8A73      STD	Z+19,R7
    01652 8A84      STD	Z+20,R8
    01653 8A95      STD	Z+21,R9
(2141) 		if (disk_read(fs->drv, fs->win, fs->fsi_sector, 1) == RES_OK &&
    01654 E081      LDI	R24,1
    01655 838C      STD	Y+4,R24
    01656 8822      LDD	R2,Z+18
    01657 8833      LDD	R3,Z+19
    01658 8844      LDD	R4,Z+20
    01659 8855      LDD	R5,Z+21
    0165A 8228      ST	Y,R2
    0165B 8239      STD	Y+1,R3
    0165C 824A      STD	Y+2,R4
    0165D 825B      STD	Y+3,R5
    0165E 019F      MOVW	R18,R30
    0165F 5D22      SUBI	R18,0xD2
    01660 4F3F      SBCI	R19,0xFF
    01661 8101      LDD	R16,Z+1
    01662 940E 03D9 CALL	_disk_read
    01664 2EE0      MOV	R14,R16
    01665 2300      TST	R16
    01666 F009      BEQ	0x1668
    01667 C105      RJMP	0x176D
    01668 A1ED      LDD	R30,Y+37
    01669 A1FE      LDD	R31,Y+38
    0166A 5DE4      SUBI	R30,0xD4
    0166B 4FFD      SBCI	R31,0xFD
    0166C 8020      LD	R2,Z
    0166D 52EC      SUBI	R30,0x2C
    0166E 40F2      SBCI	R31,2
    0166F 2433      CLR	R3
    01670 5DE3      SUBI	R30,0xD3
    01671 4FFD      SBCI	R31,0xFD
    01672 8180      LD	R24,Z
    01673 52ED      SUBI	R30,0x2D
    01674 40F2      SBCI	R31,2
    01675 2799      CLR	R25
    01676 2F98      MOV	R25,R24
    01677 2788      CLR	R24
    01678 2982      OR	R24,R2
    01679 2993      OR	R25,R3
    0167A 3585      CPI	R24,0x55
    0167B EAAA      LDI	R26,0xAA
    0167C 079A      CPC	R25,R26
    0167D F009      BEQ	0x167F
    0167E C0EE      RJMP	0x176D
    0167F E188      LDI	R24,0x18
    01680 E090      LDI	R25,0
    01681 A901      LDD	R16,Z+49
    01682 2711      CLR	R17
    01683 2722      CLR	R18
    01684 2733      CLR	R19
    01685 938A      ST	-Y,R24
    01686 940E 494E CALL	lsl32
    01688 0118      MOVW	R2,R16
    01689 0129      MOVW	R4,R18
    0168A A1ED      LDD	R30,Y+37
    0168B A1FE      LDD	R31,Y+38
    0168C A860      LDD	R6,Z+48
    0168D 2477      CLR	R7
    0168E 2488      CLR	R8
    0168F 2499      CLR	R9
    01690 0143      MOVW	R8,R6
    01691 2466      CLR	R6
    01692 2477      CLR	R7
    01693 2826      OR	R2,R6
    01694 2837      OR	R3,R7
    01695 2848      OR	R4,R8
    01696 2859      OR	R5,R9
    01697 A467      LDD	R6,Z+47
    01698 2477      CLR	R7
    01699 2C76      MOV	R7,R6
    0169A 2466      CLR	R6
    0169B 2488      CLR	R8
    0169C 2499      CLR	R9
    0169D 2826      OR	R2,R6
    0169E 2837      OR	R3,R7
    0169F 2848      OR	R4,R8
    016A0 2859      OR	R5,R9
    016A1 A466      LDD	R6,Z+46
    016A2 2477      CLR	R7
    016A3 2488      CLR	R8
    016A4 2499      CLR	R9
    016A5 2826      OR	R2,R6
    016A6 2837      OR	R3,R7
    016A7 2848      OR	R4,R8
    016A8 2859      OR	R5,R9
    016A9 E542      LDI	R20,0x52
    016AA E552      LDI	R21,0x52
    016AB E661      LDI	R22,0x61
    016AC E471      LDI	R23,0x41
    016AD 1624      CP	R2,R20
    016AE 0635      CPC	R3,R21
    016AF 0646      CPC	R4,R22
    016B0 0657      CPC	R5,R23
    016B1 F009      BEQ	0x16B3
    016B2 C0BA      RJMP	0x176D
    016B3 E188      LDI	R24,0x18
    016B4 E090      LDI	R25,0
    016B5 5EEB      SUBI	R30,0xEB
    016B6 4FFD      SBCI	R31,0xFD
    016B7 8100      LD	R16,Z
    016B8 2711      CLR	R17
    016B9 2722      CLR	R18
    016BA 2733      CLR	R19
    016BB 938A      ST	-Y,R24
    016BC 940E 494E CALL	lsl32
    016BE 0118      MOVW	R2,R16
    016BF 0129      MOVW	R4,R18
    016C0 A1ED      LDD	R30,Y+37
    016C1 A1FE      LDD	R31,Y+38
    016C2 5EEC      SUBI	R30,0xEC
    016C3 4FFD      SBCI	R31,0xFD
    016C4 8060      LD	R6,Z
    016C5 51E4      SUBI	R30,0x14
    016C6 40F2      SBCI	R31,2
    016C7 2477      CLR	R7
    016C8 2488      CLR	R8
    016C9 2499      CLR	R9
    016CA 0143      MOVW	R8,R6
    016CB 2466      CLR	R6
    016CC 2477      CLR	R7
    016CD 2826      OR	R2,R6
    016CE 2837      OR	R3,R7
    016CF 2848      OR	R4,R8
    016D0 2859      OR	R5,R9
    016D1 5EED      SUBI	R30,0xED
    016D2 4FFD      SBCI	R31,0xFD
    016D3 8060      LD	R6,Z
    016D4 51E3      SUBI	R30,0x13
    016D5 40F2      SBCI	R31,2
    016D6 2477      CLR	R7
    016D7 2C76      MOV	R7,R6
    016D8 2466      CLR	R6
    016D9 2488      CLR	R8
    016DA 2499      CLR	R9
    016DB 2826      OR	R2,R6
    016DC 2837      OR	R3,R7
    016DD 2848      OR	R4,R8
    016DE 2859      OR	R5,R9
    016DF 5EEE      SUBI	R30,0xEE
    016E0 4FFD      SBCI	R31,0xFD
    016E1 8060      LD	R6,Z
    016E2 51E2      SUBI	R30,0x12
    016E3 40F2      SBCI	R31,2
    016E4 2477      CLR	R7
    016E5 2488      CLR	R8
    016E6 2499      CLR	R9
    016E7 2826      OR	R2,R6
    016E8 2837      OR	R3,R7
    016E9 2848      OR	R4,R8
    016EA 2859      OR	R5,R9
    016EB E742      LDI	R20,0x72
    016EC E752      LDI	R21,0x72
    016ED E461      LDI	R22,0x41
    016EE E671      LDI	R23,0x61
    016EF 1624      CP	R2,R20
    016F0 0635      CPC	R3,R21
    016F1 0646      CPC	R4,R22
    016F2 0657      CPC	R5,R23
    016F3 F009      BEQ	0x16F5
    016F4 C078      RJMP	0x176D
(2142) 			LD_WORD(fs->win+BS_55AA) == 0xAA55 &&
(2143) 			LD_DWORD(fs->win+FSI_LeadSig) == 0x41615252 &&
(2144) 			LD_DWORD(fs->win+FSI_StrucSig) == 0x61417272) {
(2145) 				fs->last_clust = LD_DWORD(fs->win+FSI_Nxt_Free);
    016F5 E188      LDI	R24,0x18
    016F6 E090      LDI	R25,0
    016F7 5EE3      SUBI	R30,0xE3
    016F8 4FFD      SBCI	R31,0xFD
    016F9 8100      LD	R16,Z
    016FA 2711      CLR	R17
    016FB 2722      CLR	R18
    016FC 2733      CLR	R19
    016FD 938A      ST	-Y,R24
    016FE 940E 494E CALL	lsl32
    01700 0118      MOVW	R2,R16
    01701 0129      MOVW	R4,R18
    01702 A1ED      LDD	R30,Y+37
    01703 A1FE      LDD	R31,Y+38
    01704 5EE4      SUBI	R30,0xE4
    01705 4FFD      SBCI	R31,0xFD
    01706 8060      LD	R6,Z
    01707 51EC      SUBI	R30,0x1C
    01708 40F2      SBCI	R31,2
    01709 2477      CLR	R7
    0170A 2488      CLR	R8
    0170B 2499      CLR	R9
    0170C 0143      MOVW	R8,R6
    0170D 2466      CLR	R6
    0170E 2477      CLR	R7
    0170F 2826      OR	R2,R6
    01710 2837      OR	R3,R7
    01711 2848      OR	R4,R8
    01712 2859      OR	R5,R9
    01713 5EE5      SUBI	R30,0xE5
    01714 4FFD      SBCI	R31,0xFD
    01715 8060      LD	R6,Z
    01716 51EB      SUBI	R30,0x1B
    01717 40F2      SBCI	R31,2
    01718 2477      CLR	R7
    01719 2C76      MOV	R7,R6
    0171A 2466      CLR	R6
    0171B 2488      CLR	R8
    0171C 2499      CLR	R9
    0171D 2826      OR	R2,R6
    0171E 2837      OR	R3,R7
    0171F 2848      OR	R4,R8
    01720 2859      OR	R5,R9
    01721 5EE6      SUBI	R30,0xE6
    01722 4FFD      SBCI	R31,0xFD
    01723 8060      LD	R6,Z
    01724 51EA      SUBI	R30,0x1A
    01725 40F2      SBCI	R31,2
    01726 2477      CLR	R7
    01727 2488      CLR	R8
    01728 2499      CLR	R9
    01729 2826      OR	R2,R6
    0172A 2837      OR	R3,R7
    0172B 2848      OR	R4,R8
    0172C 2859      OR	R5,R9
    0172D 8622      STD	Z+10,R2
    0172E 8633      STD	Z+11,R3
    0172F 8644      STD	Z+12,R4
    01730 8655      STD	Z+13,R5
(2146) 				fs->free_clust = LD_DWORD(fs->win+FSI_Free_Count);
    01731 E188      LDI	R24,0x18
    01732 E090      LDI	R25,0
    01733 5EE7      SUBI	R30,0xE7
    01734 4FFD      SBCI	R31,0xFD
    01735 8100      LD	R16,Z
    01736 2711      CLR	R17
    01737 2722      CLR	R18
    01738 2733      CLR	R19
    01739 938A      ST	-Y,R24
    0173A 940E 494E CALL	lsl32
    0173C 0118      MOVW	R2,R16
    0173D 0129      MOVW	R4,R18
    0173E A1ED      LDD	R30,Y+37
    0173F A1FE      LDD	R31,Y+38
    01740 5EE8      SUBI	R30,0xE8
    01741 4FFD      SBCI	R31,0xFD
    01742 8060      LD	R6,Z
    01743 51E8      SUBI	R30,0x18
    01744 40F2      SBCI	R31,2
    01745 2477      CLR	R7
    01746 2488      CLR	R8
    01747 2499      CLR	R9
    01748 0143      MOVW	R8,R6
    01749 2466      CLR	R6
    0174A 2477      CLR	R7
    0174B 2826      OR	R2,R6
    0174C 2837      OR	R3,R7
    0174D 2848      OR	R4,R8
    0174E 2859      OR	R5,R9
    0174F 5EE9      SUBI	R30,0xE9
    01750 4FFD      SBCI	R31,0xFD
    01751 8060      LD	R6,Z
    01752 51E7      SUBI	R30,0x17
    01753 40F2      SBCI	R31,2
    01754 2477      CLR	R7
    01755 2C76      MOV	R7,R6
    01756 2466      CLR	R6
    01757 2488      CLR	R8
    01758 2499      CLR	R9
    01759 2826      OR	R2,R6
    0175A 2837      OR	R3,R7
    0175B 2848      OR	R4,R8
    0175C 2859      OR	R5,R9
    0175D 5EEA      SUBI	R30,0xEA
    0175E 4FFD      SBCI	R31,0xFD
    0175F 8060      LD	R6,Z
    01760 51E6      SUBI	R30,0x16
    01761 40F2      SBCI	R31,2
    01762 2477      CLR	R7
    01763 2488      CLR	R8
    01764 2499      CLR	R9
    01765 2826      OR	R2,R6
    01766 2837      OR	R3,R7
    01767 2848      OR	R4,R8
    01768 2859      OR	R5,R9
    01769 8626      STD	Z+14,R2
    0176A 8637      STD	Z+15,R3
    0176B 8A40      STD	Z+16,R4
    0176C 8A51      STD	Z+17,R5
(2147) 		}
(2148) 	}
(2149) #endif
(2150) 	fs->fs_type = fmt;		/* FAT sub-type */
    0176D A1ED      LDD	R30,Y+37
    0176E A1FE      LDD	R31,Y+38
    0176F 82C0      ST	Z,R12
(2151) 	fs->id = ++Fsid;		/* File system mount ID */
    01770 9180 05E1 LDS	R24,ff.c:Fsid
    01772 9190 05E2 LDS	R25,ff.c:Fsid+1
    01774 9601      ADIW	R24,1
    01775 016C      MOVW	R12,R24
    01776 92D0 05E2 STS	ff.c:Fsid+1,R13
    01778 92C0 05E1 STS	ff.c:Fsid,R12
    0177A 82D7      STD	Z+7,R13
    0177B 82C6      STD	Z+6,R12
(2152) 	fs->winsect = 0;		/* Invalidate sector cache */
    0177C 96BA      ADIW	R30,0x2A
    0177D E080      LDI	R24,0
    0177E 8380      ST	Z,R24
    0177F 8381      STD	Z+1,R24
    01780 8382      STD	Z+2,R24
    01781 8383      STD	Z+3,R24
(2153) 	fs->wflag = 0;
    01782 2422      CLR	R2
    01783 A1ED      LDD	R30,Y+37
    01784 A1FE      LDD	R31,Y+38
    01785 8224      STD	Z+4,R2
(2154) #if _FS_RPATH
(2155) 	fs->cdir = 0;			/* Current directory (root dir) */
(2156) #endif
(2157) #if _FS_SHARE				/* Clear file lock semaphores */
(2158) 	clear_lock(fs);
(2159) #endif
(2160) 
(2161) 	return FR_OK;
    01786 2700      CLR	R16
    01787 96A7      ADIW	R28,0x27
    01788 940E 48B8 CALL	pop_xgsetF0FC
    0178A 9622      ADIW	R28,2
    0178B 9508      RET
ff.c:validate:
  id                   --> R10
  fs                   --> R20
    0178C 940E 48CE CALL	push_xgset300C
    0178E 0159      MOVW	R10,R18
    0178F 01A8      MOVW	R20,R16
(2162) }
(2163) 
(2164) 
(2165) 
(2166) 
(2167) /*-----------------------------------------------------------------------*/
(2168) /* Check if the file/dir object is valid or not                          */
(2169) /*-----------------------------------------------------------------------*/
(2170) 
(2171) static
(2172) FRESULT validate (	/* FR_OK(0): The object is valid, !=0: Invalid */
(2173) 	FATFS *fs,		/* Pointer to the file system object */
(2174) 	WORD id			/* Member id of the target object to be checked */
(2175) )
(2176) {
(2177) 	if (!fs || !fs->fs_type || fs->id != id)
    01790 3040      CPI	R20,0
    01791 0745      CPC	R20,R21
    01792 F049      BEQ	0x179C
    01793 01FA      MOVW	R30,R20
    01794 8020      LD	R2,Z
    01795 2022      TST	R2
    01796 F029      BEQ	0x179C
    01797 8026      LDD	R2,Z+6
    01798 8037      LDD	R3,Z+7
    01799 142A      CP	R2,R10
    0179A 043B      CPC	R3,R11
    0179B F011      BEQ	0x179E
(2178) 		return FR_INVALID_OBJECT;
    0179C E009      LDI	R16,0x9
    0179D C009      RJMP	0x17A7
(2179) 
(2180) 	ENTER_FF(fs);		/* Lock file system */
(2181) 
(2182) 	if (disk_status(fs->drv) & STA_NOINIT)
    0179E 01FA      MOVW	R30,R20
    0179F 8101      LDD	R16,Z+1
    017A0 940E 03D3 CALL	_disk_status
    017A2 FF00      SBRS	R16,0
    017A3 C002      RJMP	0x17A6
(2183) 		return FR_NOT_READY;
    017A4 E003      LDI	R16,3
    017A5 C001      RJMP	0x17A7
(2184) 
(2185) 	return FR_OK;
    017A6 2700      CLR	R16
    017A7 940C 48D3 JMP	pop_xgset300C
_f_mount:
  rfs                  --> R10
  fs                   --> R18
  vol                  --> R16
    017A9 92AA      ST	-Y,R10
    017AA 92BA      ST	-Y,R11
(2186) }
(2187) 
(2188) 
(2189) 
(2190) 
(2191) /*--------------------------------------------------------------------------
(2192) 
(2193)    Public Functions
(2194) 
(2195) --------------------------------------------------------------------------*/
(2196) 
(2197) 
(2198) 
(2199) /*-----------------------------------------------------------------------*/
(2200) /* Mount/Unmount a Logical Drive                                         */
(2201) /*-----------------------------------------------------------------------*/
(2202) 
(2203) FRESULT f_mount (
(2204) 	BYTE vol,		/* Logical drive number to be mounted/unmounted */
(2205) 	FATFS *fs		/* Pointer to new file system object (NULL for unmount)*/
(2206) )
(2207) {
(2208) 	FATFS *rfs;
(2209) 
(2210) 
(2211) 	if (vol >= _VOLUMES)		/* Check if the drive number is valid */
    017AB 3001      CPI	R16,1
    017AC F010      BCS	0x17AF
(2212) 		return FR_INVALID_DRIVE;
    017AD E00B      LDI	R16,0xB
    017AE C022      RJMP	0x17D1
(2213) 	rfs = FatFs[vol];			/* Get current fs object */
    017AF EE83      LDI	R24,0xE3
    017B0 E095      LDI	R25,5
    017B1 2FE0      MOV	R30,R16
    017B2 27FF      CLR	R31
    017B3 0FEE      LSL	R30
    017B4 1FFF      ROL	R31
    017B5 0FE8      ADD	R30,R24
    017B6 1FF9      ADC	R31,R25
    017B7 80A0      LD	R10,Z
    017B8 80B1      LDD	R11,Z+1
(2214) 
(2215) 	if (rfs) {
    017B9 20AA      TST	R10
    017BA F411      BNE	0x17BD
    017BB 20BB      TST	R11
    017BC F019      BEQ	0x17C0
(2216) #if _FS_SHARE
(2217) 		clear_lock(rfs);
(2218) #endif
(2219) #if _FS_REENTRANT				/* Discard sync object of the current volume */
(2220) 		if (!ff_del_syncobj(rfs->sobj)) return FR_INT_ERR;
(2221) #endif
(2222) 		rfs->fs_type = 0;		/* Clear old fs object */
    017BD 2422      CLR	R2
    017BE 01F5      MOVW	R30,R10
    017BF 8220      ST	Z,R2
(2223) 	}
(2224) 
(2225) 	if (fs) {
    017C0 3020      CPI	R18,0
    017C1 0723      CPC	R18,R19
    017C2 F019      BEQ	0x17C6
(2226) 		fs->fs_type = 0;		/* Clear new fs object */
    017C3 2422      CLR	R2
    017C4 01F9      MOVW	R30,R18
    017C5 8220      ST	Z,R2
(2227) #if _FS_REENTRANT				/* Create sync object for the new volume */
(2228) 		if (!ff_cre_syncobj(vol, &fs->sobj)) return FR_INT_ERR;
(2229) #endif
(2230) 	}
(2231) 	FatFs[vol] = fs;			/* Register new fs object */
    017C6 EE83      LDI	R24,0xE3
    017C7 E095      LDI	R25,5
    017C8 2FE0      MOV	R30,R16
    017C9 27FF      CLR	R31
    017CA 0FEE      LSL	R30
    017CB 1FFF      ROL	R31
    017CC 0FE8      ADD	R30,R24
    017CD 1FF9      ADC	R31,R25
    017CE 8331      STD	Z+1,R19
    017CF 8320      ST	Z,R18
(2232) 
(2233) 	return FR_OK;
    017D0 2700      CLR	R16
    017D1 90B9      LD	R11,Y+
    017D2 90A9      LD	R10,Y+
    017D3 9508      RET
_f_open:
  cl                   --> Y,+40
  dw                   --> Y,+36
  sfn                  --> Y,+24
  dj                   --> Y,+2
  res                  --> R10
  dir                  --> R14
  mode                 --> Y,+58
  path                 --> Y,+56
  fp                   --> Y,+54
    017D4 940E 477E CALL	push_arg4
    017D6 940E 48C3 CALL	push_xgsetF0FC
    017D8 97AC      SBIW	R28,0x2C
(2234) }
(2235) 
(2236) 
(2237) 
(2238) 
(2239) /*-----------------------------------------------------------------------*/
(2240) /* Open or Create a File                                                 */
(2241) /*-----------------------------------------------------------------------*/
(2242) 
(2243) FRESULT f_open (
(2244) 	FIL *fp,			/* Pointer to the blank file object */
(2245) 	const TCHAR *path,	/* Pointer to the file name */
(2246) 	BYTE mode			/* Access mode and file open mode flags */
(2247) )
(2248) {
(2249) 	FRESULT res;
(2250) 	DIR dj;
(2251) 	BYTE *dir;
(2252) 	DEF_NAMEBUF;
(2253) 
(2254) 
(2255) 	fp->fs = 0;			/* Clear file object */
    017D9 2422      CLR	R2
    017DA 2433      CLR	R3
    017DB A9EE      LDD	R30,Y+54
    017DC A9FF      LDD	R31,Y+55
    017DD 8231      STD	Z+1,R3
    017DE 8220      ST	Z,R2
(2256) 
(2257) #if !_FS_READONLY
(2258) 	mode &= FA_READ | FA_WRITE | FA_CREATE_ALWAYS | FA_OPEN_ALWAYS | FA_CREATE_NEW;
    017DF AD8A      LDD	R24,Y+58
    017E0 718F      ANDI	R24,0x1F
    017E1 AF8A      STD	Y+58,R24
(2259) 	res = chk_mounted(&path, &dj.fs, (BYTE)(mode & ~FA_READ));
    017E2 2799      CLR	R25
    017E3 7F8E      ANDI	R24,0xFE
    017E4 8388      ST	Y,R24
    017E5 019E      MOVW	R18,R28
    017E6 5F2E      SUBI	R18,0xFE
    017E7 4F3F      SBCI	R19,0xFF
    017E8 018E      MOVW	R16,R28
    017E9 5C08      SUBI	R16,0xC8
    017EA 4F1F      SBCI	R17,0xFF
    017EB DAA6      RCALL	ff.c:chk_mounted
    017EC 2EA0      MOV	R10,R16
(2260) #else
(2261) 	mode &= FA_READ;
(2262) 	res = chk_mounted(&path, &dj.fs, 0);
(2263) #endif
(2264) 	INIT_BUF(dj);
    017ED 01CE      MOVW	R24,R28
    017EE 9648      ADIW	R24,0x18
    017EF 8B9F      STD	Y+23,R25
    017F0 8B8E      STD	Y+22,R24
(2265) 	if (res == FR_OK)
    017F1 2300      TST	R16
    017F2 F439      BNE	0x17FA
(2266) 		res = follow_path(&dj, path);	/* Follow the file path */
    017F3 AD28      LDD	R18,Y+56
    017F4 AD39      LDD	R19,Y+57
    017F5 018E      MOVW	R16,R28
    017F6 5F0E      SUBI	R16,0xFE
    017F7 4F1F      SBCI	R17,0xFF
    017F8 D94D      RCALL	ff.c:follow_path
    017F9 2EA0      MOV	R10,R16
(2267) 	dir = dj.dir;
    017FA 88EC      LDD	R14,Y+20
    017FB 88FD      LDD	R15,Y+21
(2268) 
(2269) #if !_FS_READONLY	/* R/W configuration */
(2270) 	if (res == FR_OK) {
    017FC 20AA      TST	R10
    017FD F431      BNE	0x1804
(2271) 		if (!dir)	/* Current dir itself */
    017FE 20EE      TST	R14
    017FF F421      BNE	0x1804
    01800 20FF      TST	R15
    01801 F411      BNE	0x1804
(2272) 			res = FR_INVALID_NAME;
    01802 E086      LDI	R24,6
    01803 2EA8      MOV	R10,R24
(2273) #if _FS_SHARE
(2274) 		else
(2275) 			res = chk_lock(&dj, (mode & ~FA_READ) ? 1 : 0);
(2276) #endif
(2277) 	}
(2278) 	/* Create or Open a file */
(2279) 	if (mode & (FA_CREATE_ALWAYS | FA_OPEN_ALWAYS | FA_CREATE_NEW)) {
    01804 AD8A      LDD	R24,Y+58
    01805 718C      ANDI	R24,0x1C
    01806 F409      BNE	0x1808
    01807 C0C0      RJMP	0x18C8
(2280) 		DWORD dw, cl;
(2281) 
(2282) 		if (res != FR_OK) {					/* No file, create new */
    01808 20AA      TST	R10
    01809 F081      BEQ	0x181A
(2283) 			if (res == FR_NO_FILE)			/* There is no file to open, create a new entry */
    0180A 2D8A      MOV	R24,R10
    0180B 3084      CPI	R24,4
    0180C F439      BNE	0x1814
(2284) #if _FS_SHARE
(2285) 				res = enq_lock() ? dir_register(&dj) : FR_TOO_MANY_OPEN_FILES;
(2286) #else
(2287) 				res = dir_register(&dj);
    0180D 018E      MOVW	R16,R28
    0180E 5F0E      SUBI	R16,0xFE
    0180F 4F1F      SBCI	R17,0xFF
    01810 940E 0F38 CALL	ff.c:dir_register
    01812 2EC0      MOV	R12,R16
    01813 2CAC      MOV	R10,R12
(2288) #endif
(2289) 			mode |= FA_CREATE_ALWAYS;		/* File is created */
    01814 AD8A      LDD	R24,Y+58
    01815 6088      ORI	R24,0x8
    01816 AF8A      STD	Y+58,R24
(2290) 			dir = dj.dir;					/* New entry */
    01817 88EC      LDD	R14,Y+20
    01818 88FD      LDD	R15,Y+21
(2291) 		}
    01819 C00C      RJMP	0x1826
(2292) 		else {								/* Any object is already existing */
(2293) 			if (dir[DIR_Attr] & (AM_RDO | AM_DIR)) {	/* Cannot overwrite it (R/O or DIR) */
    0181A 01F7      MOVW	R30,R14
    0181B 8583      LDD	R24,Z+11
    0181C 7181      ANDI	R24,0x11
    0181D F019      BEQ	0x1821
(2294) 				res = FR_DENIED;
    0181E E087      LDI	R24,7
    0181F 2EA8      MOV	R10,R24
(2295) 			} else {
    01820 C005      RJMP	0x1826
(2296) 				if (mode & FA_CREATE_NEW)	/* Cannot create as new file */
    01821 AC0A      LDD	R0,Y+58
    01822 FE02      SBRS	R0,2
    01823 C002      RJMP	0x1826
(2297) 					res = FR_EXIST;
    01824 E088      LDI	R24,0x8
    01825 2EA8      MOV	R10,R24
(2298) 			}
(2299) 		}
(2300) 		if (res == FR_OK && (mode & FA_CREATE_ALWAYS)) {	/* Truncate it if overwrite mode */
    01826 20AA      TST	R10
    01827 F009      BEQ	0x1829
    01828 C0B1      RJMP	0x18DA
    01829 AC0A      LDD	R0,Y+58
    0182A FE03      SBRS	R0,3
    0182B C0AE      RJMP	0x18DA
(2301) 			dw = get_fattime();					/* Created time */
    0182C 940E 0416 CALL	_get_fattime
    0182E A30C      STD	Y+36,R16
    0182F A31D      STD	Y+37,R17
    01830 A32E      STD	Y+38,R18
    01831 A33F      STD	Y+39,R19
(2302) 			ST_DWORD(dir+DIR_CrtTime, dw);
    01832 A02C      LDD	R2,Y+36
    01833 A03D      LDD	R3,Y+37
    01834 A04E      LDD	R4,Y+38
    01835 A05F      LDD	R5,Y+39
    01836 01F7      MOVW	R30,R14
    01837 8626      STD	Z+14,R2
    01838 2C23      MOV	R2,R3
    01839 2433      CLR	R3
    0183A 963F      ADIW	R30,0xF
    0183B 8220      ST	Z,R2
    0183C A02C      LDD	R2,Y+36
    0183D A03D      LDD	R3,Y+37
    0183E A04E      LDD	R4,Y+38
    0183F A05F      LDD	R5,Y+39
    01840 0112      MOVW	R2,R4
    01841 2444      CLR	R4
    01842 2455      CLR	R5
    01843 01F7      MOVW	R30,R14
    01844 9670      ADIW	R30,0x10
    01845 8220      ST	Z,R2
    01846 E188      LDI	R24,0x18
    01847 E090      LDI	R25,0
    01848 A10C      LDD	R16,Y+36
    01849 A11D      LDD	R17,Y+37
    0184A A12E      LDD	R18,Y+38
    0184B A13F      LDD	R19,Y+39
    0184C 938A      ST	-Y,R24
    0184D 940E 4967 CALL	lsr32
    0184F 01F7      MOVW	R30,R14
    01850 8B01      STD	Z+17,R16
(2303) 			dir[DIR_Attr] = 0;					/* Reset attribute */
    01851 2422      CLR	R2
    01852 8623      STD	Z+11,R2
(2304) 			ST_DWORD(dir+DIR_FileSize, 0);		/* size = 0 */
    01853 8E24      STD	Z+28,R2
    01854 8E25      STD	Z+29,R2
    01855 8E26      STD	Z+30,R2
    01856 8E27      STD	Z+31,R2
(2305) 			cl = LD_CLUST(dir);					/* Get start cluster */
    01857 8C22      LDD	R2,Z+26
    01858 2433      CLR	R3
    01859 8C43      LDD	R4,Z+27
    0185A 2455      CLR	R5
    0185B 2C54      MOV	R5,R4
    0185C 2444      CLR	R4
    0185D 2842      OR	R4,R2
    0185E 2853      OR	R5,R3
    0185F 0112      MOVW	R2,R4
    01860 2444      CLR	R4
    01861 2455      CLR	R5
    01862 8864      LDD	R6,Z+20
    01863 2477      CLR	R7
    01864 9675      ADIW	R30,0x15
    01865 8080      LD	R8,Z
    01866 2499      CLR	R9
    01867 2C98      MOV	R9,R8
    01868 2488      CLR	R8
    01869 2886      OR	R8,R6
    0186A 2897      OR	R9,R7
    0186B 0134      MOVW	R6,R8
    0186C 2488      CLR	R8
    0186D 2499      CLR	R9
    0186E 0143      MOVW	R8,R6
    0186F 2466      CLR	R6
    01870 2477      CLR	R7
    01871 2862      OR	R6,R2
    01872 2873      OR	R7,R3
    01873 2884      OR	R8,R4
    01874 2895      OR	R9,R5
    01875 A668      STD	Y+40,R6
    01876 A679      STD	Y+41,R7
    01877 A68A      STD	Y+42,R8
    01878 A69B      STD	Y+43,R9
(2306) 			ST_CLUST(dir, 0);					/* cluster = 0 */
    01879 2422      CLR	R2
    0187A 01F7      MOVW	R30,R14
    0187B 8E22      STD	Z+26,R2
    0187C 8E23      STD	Z+27,R2
    0187D 8A24      STD	Z+20,R2
    0187E 8A25      STD	Z+21,R2
(2307) 			dj.fs->wflag = 1;
    0187F E081      LDI	R24,1
    01880 81EA      LDD	R30,Y+2
    01881 81FB      LDD	R31,Y+3
    01882 9634      ADIW	R30,4
    01883 8380      ST	Z,R24
(2308) 			if (cl) {							/* Remove the cluster chain if exist */
    01884 A428      LDD	R2,Y+40
    01885 A439      LDD	R3,Y+41
    01886 A44A      LDD	R4,Y+42
    01887 A45B      LDD	R5,Y+43
    01888 9488      BCLR	0
    01889 2022      TST	R2
    0188A 0432      CPC	R3,R2
    0188B 0442      CPC	R4,R2
    0188C 0452      CPC	R5,R2
    0188D F409      BNE	0x188F
    0188E C04B      RJMP	0x18DA
(2309) 				dw = dj.fs->winsect;
    0188F 81EA      LDD	R30,Y+2
    01890 81FB      LDD	R31,Y+3
    01891 A422      LDD	R2,Z+42
    01892 A433      LDD	R3,Z+43
    01893 A444      LDD	R4,Z+44
    01894 A455      LDD	R5,Z+45
    01895 A22C      STD	Y+36,R2
    01896 A23D      STD	Y+37,R3
    01897 A24E      STD	Y+38,R4
    01898 A25F      STD	Y+39,R5
(2310) 				res = remove_chain(dj.fs, cl);
    01899 A428      LDD	R2,Y+40
    0189A A439      LDD	R3,Y+41
    0189B A44A      LDD	R4,Y+42
    0189C A45B      LDD	R5,Y+43
    0189D 8248      ST	Y,R4
    0189E 8259      STD	Y+1,R5
    0189F 0191      MOVW	R18,R2
    018A0 810A      LDD	R16,Y+2
    018A1 811B      LDD	R17,Y+3
    018A2 940E 094C CALL	ff.c:remove_chain
    018A4 2EC0      MOV	R12,R16
    018A5 2CAC      MOV	R10,R12
(2311) 				if (res == FR_OK) {
    018A6 2300      TST	R16
    018A7 F591      BNE	0x18DA
(2312) 					dj.fs->last_clust = cl - 1;	/* Reuse the cluster hole */
    018A8 E041      LDI	R20,1
    018A9 E050      LDI	R21,0
    018AA E060      LDI	R22,0
    018AB E070      LDI	R23,0
    018AC A428      LDD	R2,Y+40
    018AD A439      LDD	R3,Y+41
    018AE A44A      LDD	R4,Y+42
    018AF A45B      LDD	R5,Y+43
    018B0 1A24      SUB	R2,R20
    018B1 0A35      SBC	R3,R21
    018B2 0A46      SBC	R4,R22
    018B3 0A57      SBC	R5,R23
    018B4 81EA      LDD	R30,Y+2
    018B5 81FB      LDD	R31,Y+3
    018B6 8622      STD	Z+10,R2
    018B7 8633      STD	Z+11,R3
    018B8 8644      STD	Z+12,R4
    018B9 8655      STD	Z+13,R5
(2313) 					res = move_window(dj.fs, dw);
    018BA A02C      LDD	R2,Y+36
    018BB A03D      LDD	R3,Y+37
    018BC A04E      LDD	R4,Y+38
    018BD A05F      LDD	R5,Y+39
    018BE 8248      ST	Y,R4
    018BF 8259      STD	Y+1,R5
    018C0 0191      MOVW	R18,R2
    018C1 810A      LDD	R16,Y+2
    018C2 811B      LDD	R17,Y+3
    018C3 940E 0474 CALL	ff.c:move_window
    018C5 2EC0      MOV	R12,R16
    018C6 2CAC      MOV	R10,R12
(2314) 				}
(2315) 			}
(2316) 		}
(2317) 	}
    018C7 C012      RJMP	0x18DA
(2318) 	else {	/* Open an existing file */
(2319) 		if (res == FR_OK) {						/* Follow succeeded */
    018C8 20AA      TST	R10
    018C9 F481      BNE	0x18DA
(2320) 			if (dir[DIR_Attr] & AM_DIR) {		/* It is a directory */
    018CA 01F7      MOVW	R30,R14
    018CB 8423      LDD	R2,Z+11
    018CC FE24      SBRS	R2,4
    018CD C003      RJMP	0x18D1
(2321) 				res = FR_NO_FILE;
    018CE E084      LDI	R24,4
    018CF 2EA8      MOV	R10,R24
(2322) 			} else {
    018D0 C009      RJMP	0x18DA
(2323) 				if ((mode & FA_WRITE) && (dir[DIR_Attr] & AM_RDO)) /* R/O violation */
    018D1 AC0A      LDD	R0,Y+58
    018D2 FE01      SBRS	R0,1
    018D3 C006      RJMP	0x18DA
    018D4 01F7      MOVW	R30,R14
    018D5 8423      LDD	R2,Z+11
    018D6 FE20      SBRS	R2,0
    018D7 C002      RJMP	0x18DA
(2324) 					res = FR_DENIED;
    018D8 E087      LDI	R24,7
    018D9 2EA8      MOV	R10,R24
(2325) 			}
(2326) 		}
(2327) 	}
(2328) 	if (res == FR_OK) {
    018DA 20AA      TST	R10
    018DB F4A1      BNE	0x18F0
(2329) 		if (mode & FA_CREATE_ALWAYS)			/* Set file change flag if created or overwritten */
    018DC AC0A      LDD	R0,Y+58
    018DD FE03      SBRS	R0,3
    018DE C003      RJMP	0x18E2
(2330) 			mode |= FA__WRITTEN;
    018DF 2D80      MOV	R24,R0
    018E0 6280      ORI	R24,0x20
    018E1 AF8A      STD	Y+58,R24
(2331) 		fp->dir_sect = dj.fs->winsect;			/* Pointer to the directory entry */
    018E2 81EA      LDD	R30,Y+2
    018E3 81FB      LDD	R31,Y+3
    018E4 A422      LDD	R2,Z+42
    018E5 A433      LDD	R3,Z+43
    018E6 A444      LDD	R4,Z+44
    018E7 A455      LDD	R5,Z+45
    018E8 A9EE      LDD	R30,Y+54
    018E9 A9FF      LDD	R31,Y+55
    018EA 8E22      STD	Z+26,R2
    018EB 8E33      STD	Z+27,R3
    018EC 8E44      STD	Z+28,R4
    018ED 8E55      STD	Z+29,R5
(2332) 		fp->dir_ptr = dir;
    018EE 8EF7      STD	Z+31,R15
    018EF 8EE6      STD	Z+30,R14
(2333) #if _FS_SHARE
(2334) 		fp->lockid = inc_lock(&dj, (mode & ~FA_READ) ? 1 : 0);
(2335) 		if (!fp->lockid) res = FR_INT_ERR;
(2336) #endif
(2337) 	}
(2338) 
(2339) #else				/* R/O configuration */
(2340) 	if (res == FR_OK) {					/* Follow succeeded */
(2341) 		if (!dir) {						/* Current dir itself */
(2342) 			res = FR_INVALID_NAME;
(2343) 		} else {
(2344) 			if (dir[DIR_Attr] & AM_DIR)	/* It is a directory */
(2345) 				res = FR_NO_FILE;
(2346) 		}
(2347) 	}
(2348) #endif
(2349) 	FREE_BUF();
(2350) 
(2351) 	if (res == FR_OK) {
    018F0 20AA      TST	R10
    018F1 F009      BEQ	0x18F3
    018F2 C077      RJMP	0x196A
(2352) 		fp->flag = mode;					/* File access mode */
    018F3 A9EE      LDD	R30,Y+54
    018F4 A9FF      LDD	R31,Y+55
    018F5 AC0A      LDD	R0,Y+58
    018F6 8204      STD	Z+4,R0
(2353) 		fp->sclust = LD_CLUST(dir);			/* File start cluster */
    018F7 01F7      MOVW	R30,R14
    018F8 8C22      LDD	R2,Z+26
    018F9 2433      CLR	R3
    018FA 8C43      LDD	R4,Z+27
    018FB 2455      CLR	R5
    018FC 2C54      MOV	R5,R4
    018FD 2444      CLR	R4
    018FE 2842      OR	R4,R2
    018FF 2853      OR	R5,R3
    01900 0112      MOVW	R2,R4
    01901 2444      CLR	R4
    01902 2455      CLR	R5
    01903 8864      LDD	R6,Z+20
    01904 2477      CLR	R7
    01905 8885      LDD	R8,Z+21
    01906 2499      CLR	R9
    01907 2C98      MOV	R9,R8
    01908 2488      CLR	R8
    01909 2886      OR	R8,R6
    0190A 2897      OR	R9,R7
    0190B 0134      MOVW	R6,R8
    0190C 2488      CLR	R8
    0190D 2499      CLR	R9
    0190E 0143      MOVW	R8,R6
    0190F 2466      CLR	R6
    01910 2477      CLR	R7
    01911 2862      OR	R6,R2
    01912 2873      OR	R7,R3
    01913 2884      OR	R8,R4
    01914 2895      OR	R9,R5
    01915 A9EE      LDD	R30,Y+54
    01916 A9FF      LDD	R31,Y+55
    01917 8666      STD	Z+14,R6
    01918 8677      STD	Z+15,R7
    01919 8A80      STD	Z+16,R8
    0191A 8A91      STD	Z+17,R9
(2354) 		fp->fsize = LD_DWORD(dir+DIR_FileSize);	/* File size */
    0191B E188      LDI	R24,0x18
    0191C E090      LDI	R25,0
    0191D 01F7      MOVW	R30,R14
    0191E 8D07      LDD	R16,Z+31
    0191F 2711      CLR	R17
    01920 2722      CLR	R18
    01921 2733      CLR	R19
    01922 938A      ST	-Y,R24
    01923 940E 494E CALL	lsl32
    01925 0118      MOVW	R2,R16
    01926 0129      MOVW	R4,R18
    01927 01F7      MOVW	R30,R14
    01928 8C66      LDD	R6,Z+30
    01929 2477      CLR	R7
    0192A 2488      CLR	R8
    0192B 2499      CLR	R9
    0192C 0143      MOVW	R8,R6
    0192D 2466      CLR	R6
    0192E 2477      CLR	R7
    0192F 2826      OR	R2,R6
    01930 2837      OR	R3,R7
    01931 2848      OR	R4,R8
    01932 2859      OR	R5,R9
    01933 8C65      LDD	R6,Z+29
    01934 2477      CLR	R7
    01935 2C76      MOV	R7,R6
    01936 2466      CLR	R6
    01937 2488      CLR	R8
    01938 2499      CLR	R9
    01939 2826      OR	R2,R6
    0193A 2837      OR	R3,R7
    0193B 2848      OR	R4,R8
    0193C 2859      OR	R5,R9
    0193D 8C64      LDD	R6,Z+28
    0193E 2477      CLR	R7
    0193F 2488      CLR	R8
    01940 2499      CLR	R9
    01941 2826      OR	R2,R6
    01942 2837      OR	R3,R7
    01943 2848      OR	R4,R8
    01944 2859      OR	R5,R9
    01945 A9EE      LDD	R30,Y+54
    01946 A9FF      LDD	R31,Y+55
    01947 8622      STD	Z+10,R2
    01948 8633      STD	Z+11,R3
    01949 8644      STD	Z+12,R4
    0194A 8655      STD	Z+13,R5
(2355) 		fp->fptr = 0;						/* File pointer */
    0194B 9636      ADIW	R30,6
    0194C E080      LDI	R24,0
    0194D 8380      ST	Z,R24
    0194E 8381      STD	Z+1,R24
    0194F 8382      STD	Z+2,R24
    01950 8383      STD	Z+3,R24
(2356) 		fp->dsect = 0;
    01951 A9EE      LDD	R30,Y+54
    01952 A9FF      LDD	R31,Y+55
    01953 9676      ADIW	R30,0x16
    01954 E080      LDI	R24,0
    01955 8380      ST	Z,R24
    01956 8381      STD	Z+1,R24
    01957 8382      STD	Z+2,R24
    01958 8383      STD	Z+3,R24
(2357) #if _USE_FASTSEEK
(2358) 		fp->cltbl = 0;						/* Normal seek mode */
    01959 2422      CLR	R2
    0195A 2433      CLR	R3
    0195B A9EE      LDD	R30,Y+54
    0195C A9FF      LDD	R31,Y+55
    0195D A231      STD	Z+33,R3
    0195E A220      STD	Z+32,R2
(2359) #endif
(2360) 		fp->fs = dj.fs; fp->id = dj.fs->id;	/* Validate file object */
    0195F 802A      LDD	R2,Y+2
    01960 803B      LDD	R3,Y+3
    01961 8231      STD	Z+1,R3
    01962 8220      ST	Z,R2
    01963 01F1      MOVW	R30,R2
    01964 8026      LDD	R2,Z+6
    01965 8037      LDD	R3,Z+7
    01966 A9EE      LDD	R30,Y+54
    01967 A9FF      LDD	R31,Y+55
    01968 8233      STD	Z+3,R3
    01969 8222      STD	Z+2,R2
(2361) 	}
(2362) 
(2363) 	LEAVE_FF(dj.fs, res);
    0196A 2D0A      MOV	R16,R10
    0196B 96AC      ADIW	R28,0x2C
    0196C 940E 48B8 CALL	pop_xgsetF0FC
    0196E 9624      ADIW	R28,4
    0196F 9508      RET
_f_read:
  remain               --> Y,+13
  res                  --> R10
  clst                 --> Y,+9
  csect                --> R12
  cc                   --> R10
  rbuff                --> R14
  sect                 --> Y,+5
  rcnt                 --> R12
  br                   --> Y,+33
  btr                  --> Y,+31
  buff                 --> R10
  fp                   --> Y,+27
    01970 940E 477E CALL	push_arg4
    01972 940E 48C3 CALL	push_xgsetF0FC
    01974 0159      MOVW	R10,R18
    01975 9761      SBIW	R28,0x11
(2364) }
(2365) 
(2366) 
(2367) 
(2368) 
(2369) /*-----------------------------------------------------------------------*/
(2370) /* Read File                                                             */
(2371) /*-----------------------------------------------------------------------*/
(2372) 
(2373) FRESULT f_read (
(2374) 	FIL *fp, 		/* Pointer to the file object */
(2375) 	void *buff,		/* Pointer to data buffer */
(2376) 	UINT btr,		/* Number of bytes to read */
(2377) 	UINT *br		/* Pointer to number of bytes read */
(2378) )
(2379) {
(2380) 	FRESULT res;
(2381) 	DWORD clst, sect, remain;
(2382) 	UINT rcnt, cc;
(2383) 	BYTE csect, *rbuff = buff;
    01976 0175      MOVW	R14,R10
(2384) 
(2385) 	memset(buff,0,512);
    01977 E080      LDI	R24,0
    01978 E092      LDI	R25,2
    01979 8399      STD	Y+1,R25
    0197A 8388      ST	Y,R24
    0197B 2722      CLR	R18
    0197C 2733      CLR	R19
    0197D 0185      MOVW	R16,R10
    0197E 940E 475A CALL	_memset
(2386) 
(2387) 	*br = 0;	/* Initialize byte counter */
    01980 2422      CLR	R2
    01981 2433      CLR	R3
    01982 A1E9      LDD	R30,Y+33
    01983 A1FA      LDD	R31,Y+34
    01984 8231      STD	Z+1,R3
    01985 8220      ST	Z,R2
(2388) 
(2389) 	res = validate(fp->fs, fp->id);				/* Check validity */
    01986 8DEB      LDD	R30,Y+27
    01987 8DFC      LDD	R31,Y+28
    01988 8122      LDD	R18,Z+2
    01989 8133      LDD	R19,Z+3
    0198A 8100      LD	R16,Z
    0198B 8111      LDD	R17,Z+1
    0198C DDFF      RCALL	ff.c:validate
    0198D 2EA0      MOV	R10,R16
(2390) 	if (res != FR_OK) LEAVE_FF(fp->fs, res);
    0198E 2300      TST	R16
    0198F F009      BEQ	0x1991
    01990 C245      RJMP	0x1BD6
(2391) 	if (fp->flag & FA__ERROR)					/* Aborted file? */
    01991 8DEB      LDD	R30,Y+27
    01992 8DFC      LDD	R31,Y+28
    01993 8024      LDD	R2,Z+4
    01994 FE27      SBRS	R2,7
    01995 C002      RJMP	0x1998
(2392) 		LEAVE_FF(fp->fs, FR_INT_ERR);
    01996 E002      LDI	R16,2
    01997 C23E      RJMP	0x1BD6
(2393) 	if (!(fp->flag & FA_READ)) 					/* Check access mode */
    01998 8DEB      LDD	R30,Y+27
    01999 8DFC      LDD	R31,Y+28
    0199A 8024      LDD	R2,Z+4
    0199B FC20      SBRC	R2,0
    0199C C002      RJMP	0x199F
(2394) 		LEAVE_FF(fp->fs, FR_DENIED);
    0199D E007      LDI	R16,7
    0199E C237      RJMP	0x1BD6
(2395) 	remain = fp->fsize - fp->fptr;
    0199F 8DEB      LDD	R30,Y+27
    019A0 8DFC      LDD	R31,Y+28
    019A1 8026      LDD	R2,Z+6
    019A2 8037      LDD	R3,Z+7
    019A3 8440      LDD	R4,Z+8
    019A4 8451      LDD	R5,Z+9
    019A5 963A      ADIW	R30,0xA
    019A6 8060      LD	R6,Z
    019A7 8071      LDD	R7,Z+1
    019A8 8082      LDD	R8,Z+2
    019A9 8093      LDD	R9,Z+3
    019AA 1862      SUB	R6,R2
    019AB 0873      SBC	R7,R3
    019AC 0884      SBC	R8,R4
    019AD 0895      SBC	R9,R5
    019AE 866D      STD	Y+13,R6
    019AF 867E      STD	Y+14,R7
    019B0 868F      STD	Y+15,R8
    019B1 8A98      STD	Y+16,R9
(2396) 	if (btr > remain) btr = (UINT)remain;		/* Truncate btr by remaining bytes */
    019B2 842D      LDD	R2,Y+13
    019B3 843E      LDD	R3,Y+14
    019B4 844F      LDD	R4,Y+15
    019B5 8858      LDD	R5,Y+16
    019B6 8C6F      LDD	R6,Y+31
    019B7 A078      LDD	R7,Y+32
    019B8 2488      CLR	R8
    019B9 2499      CLR	R9
    019BA 1426      CP	R2,R6
    019BB 0437      CPC	R3,R7
    019BC 0448      CPC	R4,R8
    019BD 0459      CPC	R5,R9
    019BE F008      BCS	0x19C0
    019BF C20D      RJMP	0x1BCD
    019C0 A238      STD	Y+32,R3
    019C1 8E2F      STD	Y+31,R2
(2397) 
(2398) 	for ( ;  btr;								/* Repeat until all data read */
    019C2 C20A      RJMP	0x1BCD
(2399) 		rbuff += rcnt, fp->fptr += rcnt, *br += rcnt, btr -= rcnt) {
(2400) 		if ((fp->fptr % SS(fp->fs)) == 0) {		/* On the sector boundary? */
    019C3 EF4F      LDI	R20,0xFF
    019C4 E051      LDI	R21,1
    019C5 E060      LDI	R22,0
    019C6 E070      LDI	R23,0
    019C7 8DEB      LDD	R30,Y+27
    019C8 8DFC      LDD	R31,Y+28
    019C9 9636      ADIW	R30,6
    019CA 8020      LD	R2,Z
    019CB 8031      LDD	R3,Z+1
    019CC 8042      LDD	R4,Z+2
    019CD 8053      LDD	R5,Z+3
    019CE 2224      AND	R2,R20
    019CF 2235      AND	R3,R21
    019D0 2246      AND	R4,R22
    019D1 2257      AND	R5,R23
    019D2 9488      BCLR	0
    019D3 2022      TST	R2
    019D4 0432      CPC	R3,R2
    019D5 0442      CPC	R4,R2
    019D6 0452      CPC	R5,R2
    019D7 F009      BEQ	0x19D9
    019D8 C180      RJMP	0x1B59
(2401) 			csect = (BYTE)(fp->fptr / SS(fp->fs) & (fp->fs->csize - 1));	/* Sector offset in the cluster */
    019D9 E089      LDI	R24,0x9
    019DA E090      LDI	R25,0
    019DB 8DEB      LDD	R30,Y+27
    019DC 8DFC      LDD	R31,Y+28
    019DD 8106      LDD	R16,Z+6
    019DE 8117      LDD	R17,Z+7
    019DF 8520      LDD	R18,Z+8
    019E0 8531      LDD	R19,Z+9
    019E1 938A      ST	-Y,R24
    019E2 940E 4967 CALL	lsr32
    019E4 0118      MOVW	R2,R16
    019E5 0129      MOVW	R4,R18
    019E6 8DEB      LDD	R30,Y+27
    019E7 8DFC      LDD	R31,Y+28
    019E8 93AF      PUSH	R26
    019E9 93BF      PUSH	R27
    019EA 81A0      LD	R26,Z
    019EB 81B1      LDD	R27,Z+1
    019EC 01FD      MOVW	R30,R26
    019ED 91BF      POP	R27
    019EE 91AF      POP	R26
    019EF 8182      LDD	R24,Z+2
    019F0 2799      CLR	R25
    019F1 9701      SBIW	R24,1
    019F2 013C      MOVW	R6,R24
    019F3 2488      CLR	R8
    019F4 FC77      SBRC	R7,7
    019F5 9480      COM	R8
    019F6 2499      CLR	R9
    019F7 FC87      SBRC	R8,7
    019F8 9490      COM	R9
    019F9 2026      AND	R2,R6
    019FA 2037      AND	R3,R7
    019FB 2048      AND	R4,R8
    019FC 2059      AND	R5,R9
    019FD 2CC2      MOV	R12,R2
(2402) 			if (!csect) {						/* On the cluster boundary? */
    019FE 2022      TST	R2
    019FF F009      BEQ	0x1A01
    01A00 C078      RJMP	0x1A79
(2403) 				if (fp->fptr == 0) {			/* On the top of the file? */
    01A01 8DEB      LDD	R30,Y+27
    01A02 8DFC      LDD	R31,Y+28
    01A03 9636      ADIW	R30,6
    01A04 8020      LD	R2,Z
    01A05 8031      LDD	R3,Z+1
    01A06 8042      LDD	R4,Z+2
    01A07 8053      LDD	R5,Z+3
    01A08 9488      BCLR	0
    01A09 2022      TST	R2
    01A0A 0432      CPC	R3,R2
    01A0B 0442      CPC	R4,R2
    01A0C 0452      CPC	R5,R2
    01A0D F461      BNE	0x1A1A
(2404) 					clst = fp->sclust;			/* Follow from the origin */
    01A0E 8DEB      LDD	R30,Y+27
    01A0F 8DFC      LDD	R31,Y+28
    01A10 963E      ADIW	R30,0xE
    01A11 8020      LD	R2,Z
    01A12 8031      LDD	R3,Z+1
    01A13 8042      LDD	R4,Z+2
    01A14 8053      LDD	R5,Z+3
    01A15 8629      STD	Y+9,R2
    01A16 863A      STD	Y+10,R3
    01A17 864B      STD	Y+11,R4
    01A18 865C      STD	Y+12,R5
(2405) 				} else {						/* Middle or end of the file */
    01A19 C028      RJMP	0x1A42
(2406) #if _USE_FASTSEEK
(2407) 					if (fp->cltbl)
    01A1A 8DEB      LDD	R30,Y+27
    01A1B 8DFC      LDD	R31,Y+28
    01A1C A020      LDD	R2,Z+32
    01A1D A031      LDD	R3,Z+33
    01A1E 2022      TST	R2
    01A1F F411      BNE	0x1A22
    01A20 2033      TST	R3
    01A21 F079      BEQ	0x1A31
(2408) 						clst = clmt_clust(fp, fp->fptr);	/* Get cluster# from the CLMT */
    01A22 8026      LDD	R2,Z+6
    01A23 8037      LDD	R3,Z+7
    01A24 8440      LDD	R4,Z+8
    01A25 8451      LDD	R5,Z+9
    01A26 8248      ST	Y,R4
    01A27 8259      STD	Y+1,R5
    01A28 0191      MOVW	R18,R2
    01A29 018F      MOVW	R16,R30
    01A2A 940E 0B77 CALL	ff.c:clmt_clust
    01A2C 8709      STD	Y+9,R16
    01A2D 871A      STD	Y+10,R17
    01A2E 872B      STD	Y+11,R18
    01A2F 873C      STD	Y+12,R19
    01A30 C011      RJMP	0x1A42
(2409) 					else
(2410) #endif
(2411) 						clst = get_fat(fp->fs, fp->clust);	/* Follow cluster chain on the FAT */
    01A31 8DEB      LDD	R30,Y+27
    01A32 8DFC      LDD	R31,Y+28
    01A33 8822      LDD	R2,Z+18
    01A34 8833      LDD	R3,Z+19
    01A35 8844      LDD	R4,Z+20
    01A36 8855      LDD	R5,Z+21
    01A37 8248      ST	Y,R4
    01A38 8259      STD	Y+1,R5
    01A39 0191      MOVW	R18,R2
    01A3A 8100      LD	R16,Z
    01A3B 8111      LDD	R17,Z+1
    01A3C 940E 063D CALL	_get_fat
    01A3E 8709      STD	Y+9,R16
    01A3F 871A      STD	Y+10,R17
    01A40 872B      STD	Y+11,R18
    01A41 873C      STD	Y+12,R19
(2412) 				}
(2413) 				if (clst < 2) ABORT(fp->fs, FR_INT_ERR);
    01A42 E042      LDI	R20,2
    01A43 E050      LDI	R21,0
    01A44 E060      LDI	R22,0
    01A45 E070      LDI	R23,0
    01A46 8429      LDD	R2,Y+9
    01A47 843A      LDD	R3,Y+10
    01A48 844B      LDD	R4,Y+11
    01A49 845C      LDD	R5,Y+12
    01A4A 1624      CP	R2,R20
    01A4B 0635      CPC	R3,R21
    01A4C 0646      CPC	R4,R22
    01A4D 0657      CPC	R5,R23
    01A4E F448      BCC	0x1A58
    01A4F 8D8B      LDD	R24,Y+27
    01A50 8D9C      LDD	R25,Y+28
    01A51 9604      ADIW	R24,4
    01A52 01FC      MOVW	R30,R24
    01A53 8180      LD	R24,Z
    01A54 6880      ORI	R24,0x80
    01A55 8380      ST	Z,R24
    01A56 E002      LDI	R16,2
    01A57 C17E      RJMP	0x1BD6
(2414) 				if (clst == 0xFFFFFFFF) ABORT(fp->fs, FR_DISK_ERR);
    01A58 EF4F      LDI	R20,0xFF
    01A59 EF5F      LDI	R21,0xFF
    01A5A EF6F      LDI	R22,0xFF
    01A5B EF7F      LDI	R23,0xFF
    01A5C 8429      LDD	R2,Y+9
    01A5D 843A      LDD	R3,Y+10
    01A5E 844B      LDD	R4,Y+11
    01A5F 845C      LDD	R5,Y+12
    01A60 1624      CP	R2,R20
    01A61 0635      CPC	R3,R21
    01A62 0646      CPC	R4,R22
    01A63 0657      CPC	R5,R23
    01A64 F451      BNE	0x1A6F
    01A65 8D8B      LDD	R24,Y+27
    01A66 8D9C      LDD	R25,Y+28
    01A67 9604      ADIW	R24,4
    01A68 015C      MOVW	R10,R24
    01A69 01FC      MOVW	R30,R24
    01A6A 8180      LD	R24,Z
    01A6B 6880      ORI	R24,0x80
    01A6C 8380      ST	Z,R24
    01A6D E001      LDI	R16,1
    01A6E C167      RJMP	0x1BD6
(2415) 				fp->clust = clst;				/* Update current cluster */
    01A6F 8429      LDD	R2,Y+9
    01A70 843A      LDD	R3,Y+10
    01A71 844B      LDD	R4,Y+11
    01A72 845C      LDD	R5,Y+12
    01A73 8DEB      LDD	R30,Y+27
    01A74 8DFC      LDD	R31,Y+28
    01A75 8A22      STD	Z+18,R2
    01A76 8A33      STD	Z+19,R3
    01A77 8A44      STD	Z+20,R4
    01A78 8A55      STD	Z+21,R5
(2416) 			}
(2417) 			sect = clust2sect(fp->fs, fp->clust);	/* Get current sector */
    01A79 8DEB      LDD	R30,Y+27
    01A7A 8DFC      LDD	R31,Y+28
    01A7B 8822      LDD	R2,Z+18
    01A7C 8833      LDD	R3,Z+19
    01A7D 8844      LDD	R4,Z+20
    01A7E 8855      LDD	R5,Z+21
    01A7F 8248      ST	Y,R4
    01A80 8259      STD	Y+1,R5
    01A81 0191      MOVW	R18,R2
    01A82 8100      LD	R16,Z
    01A83 8111      LDD	R17,Z+1
    01A84 940E 05EB CALL	_clust2sect
    01A86 830D      STD	Y+5,R16
    01A87 831E      STD	Y+6,R17
    01A88 832F      STD	Y+7,R18
    01A89 8738      STD	Y+8,R19
(2418) 			if (!sect) ABORT(fp->fs, FR_INT_ERR);
    01A8A 802D      LDD	R2,Y+5
    01A8B 803E      LDD	R3,Y+6
    01A8C 804F      LDD	R4,Y+7
    01A8D 8458      LDD	R5,Y+8
    01A8E 9488      BCLR	0
    01A8F 2022      TST	R2
    01A90 0432      CPC	R3,R2
    01A91 0442      CPC	R4,R2
    01A92 0452      CPC	R5,R2
    01A93 F451      BNE	0x1A9E
    01A94 8D8B      LDD	R24,Y+27
    01A95 8D9C      LDD	R25,Y+28
    01A96 9604      ADIW	R24,4
    01A97 015C      MOVW	R10,R24
    01A98 01FC      MOVW	R30,R24
    01A99 8180      LD	R24,Z
    01A9A 6880      ORI	R24,0x80
    01A9B 8380      ST	Z,R24
    01A9C E002      LDI	R16,2
    01A9D C138      RJMP	0x1BD6
(2419) 			sect += csect;
    01A9E 2C2C      MOV	R2,R12
    01A9F 2433      CLR	R3
    01AA0 2444      CLR	R4
    01AA1 2455      CLR	R5
    01AA2 806D      LDD	R6,Y+5
    01AA3 807E      LDD	R7,Y+6
    01AA4 808F      LDD	R8,Y+7
    01AA5 8498      LDD	R9,Y+8
    01AA6 0C62      ADD	R6,R2
    01AA7 1C73      ADC	R7,R3
    01AA8 1C84      ADC	R8,R4
    01AA9 1C95      ADC	R9,R5
    01AAA 826D      STD	Y+5,R6
    01AAB 827E      STD	Y+6,R7
    01AAC 828F      STD	Y+7,R8
    01AAD 8698      STD	Y+8,R9
(2420) 			cc = btr / SS(fp->fs);				/* When remaining bytes >= sector size, */
    01AAE E029      LDI	R18,0x9
    01AAF E030      LDI	R19,0
    01AB0 8D0F      LDD	R16,Y+31
    01AB1 A118      LDD	R17,Y+32
    01AB2 940E 4960 CALL	lsr16
    01AB4 0158      MOVW	R10,R16
(2421) 			if (cc) {							/* Read maximum contiguous sectors directly */
    01AB5 3000      CPI	R16,0
    01AB6 0701      CPC	R16,R17
    01AB7 F409      BNE	0x1AB9
    01AB8 C096      RJMP	0x1B4F
(2422) 				if (csect + cc > fp->fs->csize)	/* Clip at cluster boundary */
    01AB9 2C2C      MOV	R2,R12
    01ABA 2433      CLR	R3
    01ABB 0E20      ADD	R2,R16
    01ABC 1E31      ADC	R3,R17
    01ABD 8DEB      LDD	R30,Y+27
    01ABE 8DFC      LDD	R31,Y+28
    01ABF 93AF      PUSH	R26
    01AC0 93BF      PUSH	R27
    01AC1 81A0      LD	R26,Z
    01AC2 81B1      LDD	R27,Z+1
    01AC3 01FD      MOVW	R30,R26
    01AC4 91BF      POP	R27
    01AC5 91AF      POP	R26
    01AC6 8042      LDD	R4,Z+2
    01AC7 2455      CLR	R5
    01AC8 1442      CP	R4,R2
    01AC9 0453      CPC	R5,R3
    01ACA F478      BCC	0x1ADA
(2423) 					cc = fp->fs->csize - csect;
    01ACB 2C2C      MOV	R2,R12
    01ACC 2433      CLR	R3
    01ACD 8DEB      LDD	R30,Y+27
    01ACE 8DFC      LDD	R31,Y+28
    01ACF 93AF      PUSH	R26
    01AD0 93BF      PUSH	R27
    01AD1 81A0      LD	R26,Z
    01AD2 81B1      LDD	R27,Z+1
    01AD3 01FD      MOVW	R30,R26
    01AD4 91BF      POP	R27
    01AD5 91AF      POP	R26
    01AD6 80A2      LDD	R10,Z+2
    01AD7 24BB      CLR	R11
    01AD8 18A2      SUB	R10,R2
    01AD9 08B3      SBC	R11,R3
(2424) 				if (disk_read(fp->fs->drv, rbuff, sect, (BYTE)cc) != RES_OK)
    01ADA 82AC      STD	Y+4,R10
    01ADB 802D      LDD	R2,Y+5
    01ADC 803E      LDD	R3,Y+6
    01ADD 804F      LDD	R4,Y+7
    01ADE 8458      LDD	R5,Y+8
    01ADF 8228      ST	Y,R2
    01AE0 8239      STD	Y+1,R3
    01AE1 824A      STD	Y+2,R4
    01AE2 825B      STD	Y+3,R5
    01AE3 0197      MOVW	R18,R14
    01AE4 8DEB      LDD	R30,Y+27
    01AE5 8DFC      LDD	R31,Y+28
    01AE6 93AF      PUSH	R26
    01AE7 93BF      PUSH	R27
    01AE8 81A0      LD	R26,Z
    01AE9 81B1      LDD	R27,Z+1
    01AEA 01FD      MOVW	R30,R26
    01AEB 91BF      POP	R27
    01AEC 91AF      POP	R26
    01AED 8101      LDD	R16,Z+1
    01AEE 940E 03D9 CALL	_disk_read
    01AF0 2EC0      MOV	R12,R16
    01AF1 2300      TST	R16
    01AF2 F051      BEQ	0x1AFD
(2425) 					ABORT(fp->fs, FR_DISK_ERR);
    01AF3 8D8B      LDD	R24,Y+27
    01AF4 8D9C      LDD	R25,Y+28
    01AF5 9604      ADIW	R24,4
    01AF6 016C      MOVW	R12,R24
    01AF7 01FC      MOVW	R30,R24
    01AF8 8180      LD	R24,Z
    01AF9 6880      ORI	R24,0x80
    01AFA 8380      ST	Z,R24
    01AFB E001      LDI	R16,1
    01AFC C0D9      RJMP	0x1BD6
(2426) #if !_FS_READONLY && _FS_MINIMIZE <= 2			/* Replace one of the read sectors with cached data if it contains a dirty sector */
(2427) #if _FS_TINY
(2428) 				if (fp->fs->wflag && fp->fs->winsect - sect < cc)
    01AFD 8DEB      LDD	R30,Y+27
    01AFE 8DFC      LDD	R31,Y+28
    01AFF 80C0      LD	R12,Z
    01B00 80D1      LDD	R13,Z+1
    01B01 01F6      MOVW	R30,R12
    01B02 9634      ADIW	R30,4
    01B03 8020      LD	R2,Z
    01B04 2022      TST	R2
    01B05 F409      BNE	0x1B07
    01B06 C041      RJMP	0x1B48
    01B07 802D      LDD	R2,Y+5
    01B08 803E      LDD	R3,Y+6
    01B09 804F      LDD	R4,Y+7
    01B0A 8458      LDD	R5,Y+8
    01B0B 01F6      MOVW	R30,R12
    01B0C A462      LDD	R6,Z+42
    01B0D A473      LDD	R7,Z+43
    01B0E A484      LDD	R8,Z+44
    01B0F A495      LDD	R9,Z+45
    01B10 1862      SUB	R6,R2
    01B11 0873      SBC	R7,R3
    01B12 0884      SBC	R8,R4
    01B13 0895      SBC	R9,R5
    01B14 0115      MOVW	R2,R10
    01B15 2444      CLR	R4
    01B16 2455      CLR	R5
    01B17 1462      CP	R6,R2
    01B18 0473      CPC	R7,R3
    01B19 0484      CPC	R8,R4
    01B1A 0495      CPC	R9,R5
    01B1B F560      BCC	0x1B48
(2429) 					mem_cpy(rbuff + ((fp->fs->winsect - sect) * SS(fp->fs)), fp->fs->win, SS(fp->fs));
    01B1C E080      LDI	R24,0
    01B1D E092      LDI	R25,2
    01B1E 8399      STD	Y+1,R25
    01B1F 8388      ST	Y,R24
    01B20 8DEB      LDD	R30,Y+27
    01B21 8DFC      LDD	R31,Y+28
    01B22 80C0      LD	R12,Z
    01B23 80D1      LDD	R13,Z+1
    01B24 0196      MOVW	R18,R12
    01B25 5D22      SUBI	R18,0xD2
    01B26 4F3F      SBCI	R19,0xFF
    01B27 802D      LDD	R2,Y+5
    01B28 803E      LDD	R3,Y+6
    01B29 804F      LDD	R4,Y+7
    01B2A 8458      LDD	R5,Y+8
    01B2B 01F6      MOVW	R30,R12
    01B2C A462      LDD	R6,Z+42
    01B2D A473      LDD	R7,Z+43
    01B2E A484      LDD	R8,Z+44
    01B2F A495      LDD	R9,Z+45
    01B30 1862      SUB	R6,R2
    01B31 0873      SBC	R7,R3
    01B32 0884      SBC	R8,R4
    01B33 0895      SBC	R9,R5
    01B34 E040      LDI	R20,0
    01B35 E052      LDI	R21,2
    01B36 E060      LDI	R22,0
    01B37 E070      LDI	R23,0
    01B38 932F      PUSH	R18
    01B39 933F      PUSH	R19
    01B3A 929A      ST	-Y,R9
    01B3B 928A      ST	-Y,R8
    01B3C 927A      ST	-Y,R7
    01B3D 926A      ST	-Y,R6
    01B3E 018A      MOVW	R16,R20
    01B3F 019B      MOVW	R18,R22
    01B40 940E 486F CALL	empy32u|empy32s
    01B42 913F      POP	R19
    01B43 912F      POP	R18
    01B44 0D0E      ADD	R16,R14
    01B45 1D1F      ADC	R17,R15
    01B46 940E 041B CALL	ff.c:mem_cpy
(2430) #else
(2431) 				if ((fp->flag & FA__DIRTY) && fp->dsect - sect < cc)
(2432) 					mem_cpy(rbuff + ((fp->dsect - sect) * SS(fp->fs)), fp->buf, SS(fp->fs));
(2433) #endif
(2434) #endif
(2435) 				rcnt = SS(fp->fs) * cc;			/* Number of bytes transferred */
    01B48 E000      LDI	R16,0
    01B49 E012      LDI	R17,2
    01B4A 0195      MOVW	R18,R10
    01B4B 940E 485F CALL	empy16s
    01B4D 0168      MOVW	R12,R16
(2436) 				continue;
    01B4E C05A      RJMP	0x1BA9
(2437) 			}
(2438) #if !_FS_TINY
(2439) 			if (fp->dsect != sect) {			/* Load data sector if not in cache */
(2440) #if !_FS_READONLY
(2441) 				if (fp->flag & FA__DIRTY) {		/* Write-back dirty sector cache */
(2442) 					if (disk_write(fp->fs->drv, fp->buf, fp->dsect, 1) != RES_OK)
(2443) 						ABORT(fp->fs, FR_DISK_ERR);
(2444) 					fp->flag &= ~FA__DIRTY;
(2445) 				}
(2446) #endif
(2447) 				if (disk_read(fp->fs->drv, fp->buf, sect, 1) != RES_OK)	/* Fill sector cache */
(2448) 					ABORT(fp->fs, FR_DISK_ERR);
(2449) 			}
(2450) #endif
(2451) 			fp->dsect = sect;
    01B4F 802D      LDD	R2,Y+5
    01B50 803E      LDD	R3,Y+6
    01B51 804F      LDD	R4,Y+7
    01B52 8458      LDD	R5,Y+8
    01B53 8DEB      LDD	R30,Y+27
    01B54 8DFC      LDD	R31,Y+28
    01B55 8A26      STD	Z+22,R2
    01B56 8A37      STD	Z+23,R3
    01B57 8E40      STD	Z+24,R4
    01B58 8E51      STD	Z+25,R5
(2452) 		}
(2453) 		rcnt = SS(fp->fs) - (fp->fptr % SS(fp->fs));	/* Get partial sector data from sector buffer */
    01B59 EF4F      LDI	R20,0xFF
    01B5A E051      LDI	R21,1
    01B5B E060      LDI	R22,0
    01B5C E070      LDI	R23,0
    01B5D 8DEB      LDD	R30,Y+27
    01B5E 8DFC      LDD	R31,Y+28
    01B5F 8026      LDD	R2,Z+6
    01B60 8037      LDD	R3,Z+7
    01B61 8440      LDD	R4,Z+8
    01B62 8451      LDD	R5,Z+9
    01B63 2224      AND	R2,R20
    01B64 2235      AND	R3,R21
    01B65 2246      AND	R4,R22
    01B66 2257      AND	R5,R23
    01B67 E040      LDI	R20,0
    01B68 E052      LDI	R21,2
    01B69 E060      LDI	R22,0
    01B6A E070      LDI	R23,0
    01B6B 1942      SUB	R20,R2
    01B6C 0953      SBC	R21,R3
    01B6D 0964      SBC	R22,R4
    01B6E 0975      SBC	R23,R5
    01B6F 016A      MOVW	R12,R20
(2454) 		if (rcnt > btr) rcnt = btr;
    01B70 8C0F      LDD	R0,Y+31
    01B71 A018      LDD	R1,Y+32
    01B72 1604      CP	R0,R20
    01B73 0615      CPC	R1,R21
    01B74 F408      BCC	0x1B76
    01B75 0160      MOVW	R12,R0
(2455) #if _FS_TINY
(2456) 		if (move_window(fp->fs, fp->dsect))		/* Move sector window */
    01B76 8DEB      LDD	R30,Y+27
    01B77 8DFC      LDD	R31,Y+28
    01B78 8826      LDD	R2,Z+22
    01B79 8837      LDD	R3,Z+23
    01B7A 8C40      LDD	R4,Z+24
    01B7B 8C51      LDD	R5,Z+25
    01B7C 8248      ST	Y,R4
    01B7D 8259      STD	Y+1,R5
    01B7E 0191      MOVW	R18,R2
    01B7F 8100      LD	R16,Z
    01B80 8111      LDD	R17,Z+1
    01B81 940E 0474 CALL	ff.c:move_window
    01B83 2EA0      MOV	R10,R16
    01B84 2300      TST	R16
    01B85 F051      BEQ	0x1B90
(2457) 			ABORT(fp->fs, FR_DISK_ERR);
    01B86 8D8B      LDD	R24,Y+27
    01B87 8D9C      LDD	R25,Y+28
    01B88 9604      ADIW	R24,4
    01B89 015C      MOVW	R10,R24
    01B8A 01FC      MOVW	R30,R24
    01B8B 8180      LD	R24,Z
    01B8C 6880      ORI	R24,0x80
    01B8D 8380      ST	Z,R24
    01B8E E001      LDI	R16,1
    01B8F C046      RJMP	0x1BD6
(2458) 		mem_cpy(rbuff, &fp->fs->win[fp->fptr % SS(fp->fs)], rcnt);	/* Pick partial sector */
    01B90 82D9      STD	Y+1,R13
    01B91 82C8      ST	Y,R12
    01B92 EF4F      LDI	R20,0xFF
    01B93 E051      LDI	R21,1
    01B94 E060      LDI	R22,0
    01B95 E070      LDI	R23,0
    01B96 8DEB      LDD	R30,Y+27
    01B97 8DFC      LDD	R31,Y+28
    01B98 8026      LDD	R2,Z+6
    01B99 8037      LDD	R3,Z+7
    01B9A 8440      LDD	R4,Z+8
    01B9B 8451      LDD	R5,Z+9
    01B9C 2224      AND	R2,R20
    01B9D 2235      AND	R3,R21
    01B9E 2246      AND	R4,R22
    01B9F 2257      AND	R5,R23
    01BA0 0191      MOVW	R18,R2
    01BA1 8180      LD	R24,Z
    01BA2 8191      LDD	R25,Z+1
    01BA3 968E      ADIW	R24,0x2E
    01BA4 0F28      ADD	R18,R24
    01BA5 1F39      ADC	R19,R25
    01BA6 0187      MOVW	R16,R14
    01BA7 940E 041B CALL	ff.c:mem_cpy
    01BA9 0CEC      ADD	R14,R12
    01BAA 1CFD      ADC	R15,R13
    01BAB 8D8B      LDD	R24,Y+27
    01BAC 8D9C      LDD	R25,Y+28
    01BAD 9606      ADIW	R24,6
    01BAE 015C      MOVW	R10,R24
    01BAF 0116      MOVW	R2,R12
    01BB0 2444      CLR	R4
    01BB1 2455      CLR	R5
    01BB2 01FC      MOVW	R30,R24
    01BB3 8060      LD	R6,Z
    01BB4 8071      LDD	R7,Z+1
    01BB5 8082      LDD	R8,Z+2
    01BB6 8093      LDD	R9,Z+3
    01BB7 0C62      ADD	R6,R2
    01BB8 1C73      ADC	R7,R3
    01BB9 1C84      ADC	R8,R4
    01BBA 1C95      ADC	R9,R5
    01BBB 8260      ST	Z,R6
    01BBC 8271      STD	Z+1,R7
    01BBD 8282      STD	Z+2,R8
    01BBE 8293      STD	Z+3,R9
    01BBF A1E9      LDD	R30,Y+33
    01BC0 A1FA      LDD	R31,Y+34
    01BC1 8020      LD	R2,Z
    01BC2 8031      LDD	R3,Z+1
    01BC3 0C2C      ADD	R2,R12
    01BC4 1C3D      ADC	R3,R13
    01BC5 8231      STD	Z+1,R3
    01BC6 8220      ST	Z,R2
    01BC7 8C0F      LDD	R0,Y+31
    01BC8 A018      LDD	R1,Y+32
    01BC9 180C      SUB	R0,R12
    01BCA 081D      SBC	R1,R13
    01BCB A218      STD	Y+32,R1
    01BCC 8E0F      STD	Y+31,R0
    01BCD 8C0F      LDD	R0,Y+31
    01BCE A018      LDD	R1,Y+32
    01BCF 2000      TST	R0
    01BD0 F009      BEQ	0x1BD2
    01BD1 CDF1      RJMP	0x19C3
    01BD2 2011      TST	R1
    01BD3 F009      BEQ	0x1BD5
    01BD4 CDEE      RJMP	0x19C3
(2459) #else
(2460) 		mem_cpy(rbuff, &fp->buf[fp->fptr % SS(fp->fs)], rcnt);	/* Pick partial sector */
(2461) #endif
(2462) 	}
(2463) 
(2464) 	LEAVE_FF(fp->fs, FR_OK);
    01BD5 2700      CLR	R16
    01BD6 9661      ADIW	R28,0x11
    01BD7 940E 48B8 CALL	pop_xgsetF0FC
    01BD9 9624      ADIW	R28,4
    01BDA 9508      RET
_f_write:
  res                  --> R10
  clst                 --> Y,+9
  csect                --> R12
  cc                   --> R10
  wbuff                --> R14
  sect                 --> Y,+5
  wcnt                 --> R12
  bw                   --> Y,+33
  btw                  --> Y,+31
  buff                 --> R10
  fp                   --> Y,+27
    01BDB 940E 477E CALL	push_arg4
    01BDD 940E 48C3 CALL	push_xgsetF0FC
    01BDF 0159      MOVW	R10,R18
    01BE0 9761      SBIW	R28,0x11
(2465) }
(2466) 
(2467) 
(2468) 
(2469) 
(2470) #if !_FS_READONLY
(2471) /*-----------------------------------------------------------------------*/
(2472) /* Write File                                                            */
(2473) /*-----------------------------------------------------------------------*/
(2474) 
(2475) FRESULT f_write (
(2476) 	FIL *fp,			/* Pointer to the file object */
(2477) 	const void *buff,	/* Pointer to the data to be written */
(2478) 	UINT btw,			/* Number of bytes to write */
(2479) 	UINT *bw			/* Pointer to number of bytes written */
(2480) )
(2481) {
(2482) 	FRESULT res;
(2483) 	DWORD clst, sect;
(2484) 	UINT wcnt, cc;
(2485) 	const BYTE *wbuff = buff;
    01BE1 0175      MOVW	R14,R10
(2486) 	BYTE csect;
(2487) 
(2488) 
(2489) 	*bw = 0;	/* Initialize byte counter */
    01BE2 2422      CLR	R2
    01BE3 2433      CLR	R3
    01BE4 A1E9      LDD	R30,Y+33
    01BE5 A1FA      LDD	R31,Y+34
    01BE6 8231      STD	Z+1,R3
    01BE7 8220      ST	Z,R2
(2490) 
(2491) 	res = validate(fp->fs, fp->id);			/* Check validity */
    01BE8 8DEB      LDD	R30,Y+27
    01BE9 8DFC      LDD	R31,Y+28
    01BEA 8122      LDD	R18,Z+2
    01BEB 8133      LDD	R19,Z+3
    01BEC 8100      LD	R16,Z
    01BED 8111      LDD	R17,Z+1
    01BEE DB9D      RCALL	ff.c:validate
    01BEF 2EA0      MOV	R10,R16
(2492) 	if (res != FR_OK) LEAVE_FF(fp->fs, res);
    01BF0 2300      TST	R16
    01BF1 F009      BEQ	0x1BF3
    01BF2 C2FC      RJMP	0x1EEF
(2493) 	if (fp->flag & FA__ERROR)				/* Aborted file? */
    01BF3 8DEB      LDD	R30,Y+27
    01BF4 8DFC      LDD	R31,Y+28
    01BF5 8024      LDD	R2,Z+4
    01BF6 FE27      SBRS	R2,7
    01BF7 C002      RJMP	0x1BFA
(2494) 		LEAVE_FF(fp->fs, FR_INT_ERR);
    01BF8 E002      LDI	R16,2
    01BF9 C2F5      RJMP	0x1EEF
(2495) 	if (!(fp->flag & FA_WRITE))				/* Check access mode */
    01BFA 8DEB      LDD	R30,Y+27
    01BFB 8DFC      LDD	R31,Y+28
    01BFC 8024      LDD	R2,Z+4
    01BFD FC21      SBRC	R2,1
    01BFE C002      RJMP	0x1C01
(2496) 		LEAVE_FF(fp->fs, FR_DENIED);
    01BFF E007      LDI	R16,7
    01C00 C2EE      RJMP	0x1EEF
(2497) 	if ((DWORD)(fp->fsize + btw) < fp->fsize) btw = 0;	/* File size cannot reach 4GB */
    01C01 8DEB      LDD	R30,Y+27
    01C02 8DFC      LDD	R31,Y+28
    01C03 963A      ADIW	R30,0xA
    01C04 8020      LD	R2,Z
    01C05 8031      LDD	R3,Z+1
    01C06 8042      LDD	R4,Z+2
    01C07 8053      LDD	R5,Z+3
    01C08 862D      STD	Y+13,R2
    01C09 863E      STD	Y+14,R3
    01C0A 864F      STD	Y+15,R4
    01C0B 8A58      STD	Y+16,R5
    01C0C 8C2F      LDD	R2,Y+31
    01C0D A038      LDD	R3,Y+32
    01C0E 2444      CLR	R4
    01C0F 2455      CLR	R5
    01C10 846D      LDD	R6,Y+13
    01C11 847E      LDD	R7,Y+14
    01C12 848F      LDD	R8,Y+15
    01C13 8898      LDD	R9,Y+16
    01C14 0C62      ADD	R6,R2
    01C15 1C73      ADC	R7,R3
    01C16 1C84      ADC	R8,R4
    01C17 1C95      ADC	R9,R5
    01C18 842D      LDD	R2,Y+13
    01C19 843E      LDD	R3,Y+14
    01C1A 844F      LDD	R4,Y+15
    01C1B 8858      LDD	R5,Y+16
    01C1C 1462      CP	R6,R2
    01C1D 0473      CPC	R7,R3
    01C1E 0484      CPC	R8,R4
    01C1F 0495      CPC	R9,R5
    01C20 F008      BCS	0x1C22
    01C21 C2A5      RJMP	0x1EC7
    01C22 2400      CLR	R0
    01C23 2411      CLR	R1
    01C24 A218      STD	Y+32,R1
    01C25 8E0F      STD	Y+31,R0
(2498) 
(2499) 	for ( ;  btw;							/* Repeat until all data written */
    01C26 C2A0      RJMP	0x1EC7
(2500) 		wbuff += wcnt, fp->fptr += wcnt, *bw += wcnt, btw -= wcnt) {
(2501) 		if ((fp->fptr % SS(fp->fs)) == 0) {	/* On the sector boundary? */
    01C27 EF4F      LDI	R20,0xFF
    01C28 E051      LDI	R21,1
    01C29 E060      LDI	R22,0
    01C2A E070      LDI	R23,0
    01C2B 8DEB      LDD	R30,Y+27
    01C2C 8DFC      LDD	R31,Y+28
    01C2D 9636      ADIW	R30,6
    01C2E 8020      LD	R2,Z
    01C2F 8031      LDD	R3,Z+1
    01C30 8042      LDD	R4,Z+2
    01C31 8053      LDD	R5,Z+3
    01C32 2224      AND	R2,R20
    01C33 2235      AND	R3,R21
    01C34 2246      AND	R4,R22
    01C35 2257      AND	R5,R23
    01C36 9488      BCLR	0
    01C37 2022      TST	R2
    01C38 0432      CPC	R3,R2
    01C39 0442      CPC	R4,R2
    01C3A 0452      CPC	R5,R2
    01C3B F009      BEQ	0x1C3D
    01C3C C20B      RJMP	0x1E48
(2502) 			csect = (BYTE)(fp->fptr / SS(fp->fs) & (fp->fs->csize - 1));	/* Sector offset in the cluster */
    01C3D E089      LDI	R24,0x9
    01C3E E090      LDI	R25,0
    01C3F 8DEB      LDD	R30,Y+27
    01C40 8DFC      LDD	R31,Y+28
    01C41 8106      LDD	R16,Z+6
    01C42 8117      LDD	R17,Z+7
    01C43 8520      LDD	R18,Z+8
    01C44 8531      LDD	R19,Z+9
    01C45 938A      ST	-Y,R24
    01C46 940E 4967 CALL	lsr32
    01C48 0118      MOVW	R2,R16
    01C49 0129      MOVW	R4,R18
    01C4A 8DEB      LDD	R30,Y+27
    01C4B 8DFC      LDD	R31,Y+28
    01C4C 93AF      PUSH	R26
    01C4D 93BF      PUSH	R27
    01C4E 81A0      LD	R26,Z
    01C4F 81B1      LDD	R27,Z+1
    01C50 01FD      MOVW	R30,R26
    01C51 91BF      POP	R27
    01C52 91AF      POP	R26
    01C53 8182      LDD	R24,Z+2
    01C54 2799      CLR	R25
    01C55 9701      SBIW	R24,1
    01C56 013C      MOVW	R6,R24
    01C57 2488      CLR	R8
    01C58 FC77      SBRC	R7,7
    01C59 9480      COM	R8
    01C5A 2499      CLR	R9
    01C5B FC87      SBRC	R8,7
    01C5C 9490      COM	R9
    01C5D 2026      AND	R2,R6
    01C5E 2037      AND	R3,R7
    01C5F 2048      AND	R4,R8
    01C60 2059      AND	R5,R9
    01C61 2CC2      MOV	R12,R2
(2503) 			if (!csect) {					/* On the cluster boundary? */
    01C62 2022      TST	R2
    01C63 F009      BEQ	0x1C65
    01C64 C0A5      RJMP	0x1D0A
(2504) 				if (fp->fptr == 0) {		/* On the top of the file? */
    01C65 8DEB      LDD	R30,Y+27
    01C66 8DFC      LDD	R31,Y+28
    01C67 9636      ADIW	R30,6
    01C68 8020      LD	R2,Z
    01C69 8031      LDD	R3,Z+1
    01C6A 8042      LDD	R4,Z+2
    01C6B 8053      LDD	R5,Z+3
    01C6C 9488      BCLR	0
    01C6D 2022      TST	R2
    01C6E 0432      CPC	R3,R2
    01C6F 0442      CPC	R4,R2
    01C70 0452      CPC	R5,R2
    01C71 F571      BNE	0x1CA0
(2505) 					clst = fp->sclust;		/* Follow from the origin */
    01C72 8DEB      LDD	R30,Y+27
    01C73 8DFC      LDD	R31,Y+28
    01C74 963E      ADIW	R30,0xE
    01C75 8020      LD	R2,Z
    01C76 8031      LDD	R3,Z+1
    01C77 8042      LDD	R4,Z+2
    01C78 8053      LDD	R5,Z+3
    01C79 8629      STD	Y+9,R2
    01C7A 863A      STD	Y+10,R3
    01C7B 864B      STD	Y+11,R4
    01C7C 865C      STD	Y+12,R5
(2506) 					if (clst == 0)			/* When no cluster is allocated, */
    01C7D 8429      LDD	R2,Y+9
    01C7E 843A      LDD	R3,Y+10
    01C7F 844B      LDD	R4,Y+11
    01C80 845C      LDD	R5,Y+12
    01C81 9488      BCLR	0
    01C82 2022      TST	R2
    01C83 0432      CPC	R3,R2
    01C84 0442      CPC	R4,R2
    01C85 0452      CPC	R5,R2
    01C86 F009      BEQ	0x1C88
    01C87 C040      RJMP	0x1CC8
(2507) 						fp->sclust = clst = create_chain(fp->fs, 0);	/* Create a new cluster chain */
    01C88 E040      LDI	R20,0
    01C89 E050      LDI	R21,0
    01C8A E060      LDI	R22,0
    01C8B E070      LDI	R23,0
    01C8C 8368      ST	Y,R22
    01C8D 8379      STD	Y+1,R23
    01C8E 019A      MOVW	R18,R20
    01C8F 8DEB      LDD	R30,Y+27
    01C90 8DFC      LDD	R31,Y+28
    01C91 8100      LD	R16,Z
    01C92 8111      LDD	R17,Z+1
    01C93 940E 09FF CALL	ff.c:create_chain
    01C95 8709      STD	Y+9,R16
    01C96 871A      STD	Y+10,R17
    01C97 872B      STD	Y+11,R18
    01C98 873C      STD	Y+12,R19
    01C99 8DEB      LDD	R30,Y+27
    01C9A 8DFC      LDD	R31,Y+28
    01C9B 8706      STD	Z+14,R16
    01C9C 8717      STD	Z+15,R17
    01C9D 8B20      STD	Z+16,R18
    01C9E 8B31      STD	Z+17,R19
(2508) 				} else {					/* Middle or end of the file */
    01C9F C028      RJMP	0x1CC8
(2509) #if _USE_FASTSEEK
(2510) 					if (fp->cltbl)
    01CA0 8DEB      LDD	R30,Y+27
    01CA1 8DFC      LDD	R31,Y+28
    01CA2 A020      LDD	R2,Z+32
    01CA3 A031      LDD	R3,Z+33
    01CA4 2022      TST	R2
    01CA5 F411      BNE	0x1CA8
    01CA6 2033      TST	R3
    01CA7 F079      BEQ	0x1CB7
(2511) 						clst = clmt_clust(fp, fp->fptr);	/* Get cluster# from the CLMT */
    01CA8 8026      LDD	R2,Z+6
    01CA9 8037      LDD	R3,Z+7
    01CAA 8440      LDD	R4,Z+8
    01CAB 8451      LDD	R5,Z+9
    01CAC 8248      ST	Y,R4
    01CAD 8259      STD	Y+1,R5
    01CAE 0191      MOVW	R18,R2
    01CAF 018F      MOVW	R16,R30
    01CB0 940E 0B77 CALL	ff.c:clmt_clust
    01CB2 8709      STD	Y+9,R16
    01CB3 871A      STD	Y+10,R17
    01CB4 872B      STD	Y+11,R18
    01CB5 873C      STD	Y+12,R19
    01CB6 C011      RJMP	0x1CC8
(2512) 					else
(2513) #endif
(2514) 						clst = create_chain(fp->fs, fp->clust);	/* Follow or stretch cluster chain on the FAT */
    01CB7 8DEB      LDD	R30,Y+27
    01CB8 8DFC      LDD	R31,Y+28
    01CB9 8822      LDD	R2,Z+18
    01CBA 8833      LDD	R3,Z+19
    01CBB 8844      LDD	R4,Z+20
    01CBC 8855      LDD	R5,Z+21
    01CBD 8248      ST	Y,R4
    01CBE 8259      STD	Y+1,R5
    01CBF 0191      MOVW	R18,R2
    01CC0 8100      LD	R16,Z
    01CC1 8111      LDD	R17,Z+1
    01CC2 940E 09FF CALL	ff.c:create_chain
    01CC4 8709      STD	Y+9,R16
    01CC5 871A      STD	Y+10,R17
    01CC6 872B      STD	Y+11,R18
    01CC7 873C      STD	Y+12,R19
(2515) 				}
(2516) 				if (clst == 0) break;		/* Could not allocate a new cluster (disk full) */
    01CC8 8429      LDD	R2,Y+9
    01CC9 843A      LDD	R3,Y+10
    01CCA 844B      LDD	R4,Y+11
    01CCB 845C      LDD	R5,Y+12
    01CCC 9488      BCLR	0
    01CCD 2022      TST	R2
    01CCE 0432      CPC	R3,R2
    01CCF 0442      CPC	R4,R2
    01CD0 0452      CPC	R5,R2
    01CD1 F409      BNE	0x1CD3
    01CD2 C1FC      RJMP	0x1ECF
(2517) 				if (clst == 1) ABORT(fp->fs, FR_INT_ERR);
    01CD3 E041      LDI	R20,1
    01CD4 E050      LDI	R21,0
    01CD5 E060      LDI	R22,0
    01CD6 E070      LDI	R23,0
    01CD7 8429      LDD	R2,Y+9
    01CD8 843A      LDD	R3,Y+10
    01CD9 844B      LDD	R4,Y+11
    01CDA 845C      LDD	R5,Y+12
    01CDB 1624      CP	R2,R20
    01CDC 0635      CPC	R3,R21
    01CDD 0646      CPC	R4,R22
    01CDE 0657      CPC	R5,R23
    01CDF F449      BNE	0x1CE9
    01CE0 8D8B      LDD	R24,Y+27
    01CE1 8D9C      LDD	R25,Y+28
    01CE2 9604      ADIW	R24,4
    01CE3 01FC      MOVW	R30,R24
    01CE4 8180      LD	R24,Z
    01CE5 6880      ORI	R24,0x80
    01CE6 8380      ST	Z,R24
    01CE7 E002      LDI	R16,2
    01CE8 C206      RJMP	0x1EEF
(2518) 				if (clst == 0xFFFFFFFF) ABORT(fp->fs, FR_DISK_ERR);
    01CE9 EF4F      LDI	R20,0xFF
    01CEA EF5F      LDI	R21,0xFF
    01CEB EF6F      LDI	R22,0xFF
    01CEC EF7F      LDI	R23,0xFF
    01CED 8429      LDD	R2,Y+9
    01CEE 843A      LDD	R3,Y+10
    01CEF 844B      LDD	R4,Y+11
    01CF0 845C      LDD	R5,Y+12
    01CF1 1624      CP	R2,R20
    01CF2 0635      CPC	R3,R21
    01CF3 0646      CPC	R4,R22
    01CF4 0657      CPC	R5,R23
    01CF5 F451      BNE	0x1D00
    01CF6 8D8B      LDD	R24,Y+27
    01CF7 8D9C      LDD	R25,Y+28
    01CF8 9604      ADIW	R24,4
    01CF9 015C      MOVW	R10,R24
    01CFA 01FC      MOVW	R30,R24
    01CFB 8180      LD	R24,Z
    01CFC 6880      ORI	R24,0x80
    01CFD 8380      ST	Z,R24
    01CFE E001      LDI	R16,1
    01CFF C1EF      RJMP	0x1EEF
(2519) 				fp->clust = clst;			/* Update current cluster */
    01D00 8429      LDD	R2,Y+9
    01D01 843A      LDD	R3,Y+10
    01D02 844B      LDD	R4,Y+11
    01D03 845C      LDD	R5,Y+12
    01D04 8DEB      LDD	R30,Y+27
    01D05 8DFC      LDD	R31,Y+28
    01D06 8A22      STD	Z+18,R2
    01D07 8A33      STD	Z+19,R3
    01D08 8A44      STD	Z+20,R4
    01D09 8A55      STD	Z+21,R5
(2520) 			}
(2521) #if _FS_TINY
(2522) 			if (fp->fs->winsect == fp->dsect && move_window(fp->fs, 0))	/* Write-back sector cache */
    01D0A 8DEB      LDD	R30,Y+27
    01D0B 8DFC      LDD	R31,Y+28
    01D0C 80A0      LD	R10,Z
    01D0D 80B1      LDD	R11,Z+1
    01D0E 8826      LDD	R2,Z+22
    01D0F 8837      LDD	R3,Z+23
    01D10 8C40      LDD	R4,Z+24
    01D11 8C51      LDD	R5,Z+25
    01D12 01F5      MOVW	R30,R10
    01D13 A462      LDD	R6,Z+42
    01D14 A473      LDD	R7,Z+43
    01D15 A484      LDD	R8,Z+44
    01D16 A495      LDD	R9,Z+45
    01D17 1462      CP	R6,R2
    01D18 0473      CPC	R7,R3
    01D19 0484      CPC	R8,R4
    01D1A 0495      CPC	R9,R5
    01D1B F4B9      BNE	0x1D33
    01D1C E040      LDI	R20,0
    01D1D E050      LDI	R21,0
    01D1E E060      LDI	R22,0
    01D1F E070      LDI	R23,0
    01D20 8368      ST	Y,R22
    01D21 8379      STD	Y+1,R23
    01D22 019A      MOVW	R18,R20
    01D23 018F      MOVW	R16,R30
    01D24 940E 0474 CALL	ff.c:move_window
    01D26 2EA0      MOV	R10,R16
    01D27 2300      TST	R16
    01D28 F051      BEQ	0x1D33
(2523) 				ABORT(fp->fs, FR_DISK_ERR);
    01D29 8D8B      LDD	R24,Y+27
    01D2A 8D9C      LDD	R25,Y+28
    01D2B 9604      ADIW	R24,4
    01D2C 015C      MOVW	R10,R24
    01D2D 01FC      MOVW	R30,R24
    01D2E 8180      LD	R24,Z
    01D2F 6880      ORI	R24,0x80
    01D30 8380      ST	Z,R24
    01D31 E001      LDI	R16,1
    01D32 C1BC      RJMP	0x1EEF
(2524) #else
(2525) 			if (fp->flag & FA__DIRTY) {		/* Write-back sector cache */
(2526) 				if (disk_write(fp->fs->drv, fp->buf, fp->dsect, 1) != RES_OK)
(2527) 					ABORT(fp->fs, FR_DISK_ERR);
(2528) 				fp->flag &= ~FA__DIRTY;
(2529) 			}
(2530) #endif
(2531) 			sect = clust2sect(fp->fs, fp->clust);	/* Get current sector */
    01D33 8DEB      LDD	R30,Y+27
    01D34 8DFC      LDD	R31,Y+28
    01D35 8822      LDD	R2,Z+18
    01D36 8833      LDD	R3,Z+19
    01D37 8844      LDD	R4,Z+20
    01D38 8855      LDD	R5,Z+21
    01D39 8248      ST	Y,R4
    01D3A 8259      STD	Y+1,R5
    01D3B 0191      MOVW	R18,R2
    01D3C 8100      LD	R16,Z
    01D3D 8111      LDD	R17,Z+1
    01D3E 940E 05EB CALL	_clust2sect
    01D40 830D      STD	Y+5,R16
    01D41 831E      STD	Y+6,R17
    01D42 832F      STD	Y+7,R18
    01D43 8738      STD	Y+8,R19
(2532) 			if (!sect) ABORT(fp->fs, FR_INT_ERR);
    01D44 802D      LDD	R2,Y+5
    01D45 803E      LDD	R3,Y+6
    01D46 804F      LDD	R4,Y+7
    01D47 8458      LDD	R5,Y+8
    01D48 9488      BCLR	0
    01D49 2022      TST	R2
    01D4A 0432      CPC	R3,R2
    01D4B 0442      CPC	R4,R2
    01D4C 0452      CPC	R5,R2
    01D4D F451      BNE	0x1D58
    01D4E 8D8B      LDD	R24,Y+27
    01D4F 8D9C      LDD	R25,Y+28
    01D50 9604      ADIW	R24,4
    01D51 015C      MOVW	R10,R24
    01D52 01FC      MOVW	R30,R24
    01D53 8180      LD	R24,Z
    01D54 6880      ORI	R24,0x80
    01D55 8380      ST	Z,R24
    01D56 E002      LDI	R16,2
    01D57 C197      RJMP	0x1EEF
(2533) 			sect += csect;
    01D58 2C2C      MOV	R2,R12
    01D59 2433      CLR	R3
    01D5A 2444      CLR	R4
    01D5B 2455      CLR	R5
    01D5C 806D      LDD	R6,Y+5
    01D5D 807E      LDD	R7,Y+6
    01D5E 808F      LDD	R8,Y+7
    01D5F 8498      LDD	R9,Y+8
    01D60 0C62      ADD	R6,R2
    01D61 1C73      ADC	R7,R3
    01D62 1C84      ADC	R8,R4
    01D63 1C95      ADC	R9,R5
    01D64 826D      STD	Y+5,R6
    01D65 827E      STD	Y+6,R7
    01D66 828F      STD	Y+7,R8
    01D67 8698      STD	Y+8,R9
(2534) 			cc = btw / SS(fp->fs);			/* When remaining bytes >= sector size, */
    01D68 E029      LDI	R18,0x9
    01D69 E030      LDI	R19,0
    01D6A 8D0F      LDD	R16,Y+31
    01D6B A118      LDD	R17,Y+32
    01D6C 940E 4960 CALL	lsr16
    01D6E 0158      MOVW	R10,R16
(2535) 			if (cc) {						/* Write maximum contiguous sectors directly */
    01D6F 3000      CPI	R16,0
    01D70 0701      CPC	R16,R17
    01D71 F409      BNE	0x1D73
    01D72 C097      RJMP	0x1E0A
(2536) 				if (csect + cc > fp->fs->csize)	/* Clip at cluster boundary */
    01D73 2C2C      MOV	R2,R12
    01D74 2433      CLR	R3
    01D75 0E20      ADD	R2,R16
    01D76 1E31      ADC	R3,R17
    01D77 8DEB      LDD	R30,Y+27
    01D78 8DFC      LDD	R31,Y+28
    01D79 93AF      PUSH	R26
    01D7A 93BF      PUSH	R27
    01D7B 81A0      LD	R26,Z
    01D7C 81B1      LDD	R27,Z+1
    01D7D 01FD      MOVW	R30,R26
    01D7E 91BF      POP	R27
    01D7F 91AF      POP	R26
    01D80 8042      LDD	R4,Z+2
    01D81 2455      CLR	R5
    01D82 1442      CP	R4,R2
    01D83 0453      CPC	R5,R3
    01D84 F478      BCC	0x1D94
(2537) 					cc = fp->fs->csize - csect;
    01D85 2C2C      MOV	R2,R12
    01D86 2433      CLR	R3
    01D87 8DEB      LDD	R30,Y+27
    01D88 8DFC      LDD	R31,Y+28
    01D89 93AF      PUSH	R26
    01D8A 93BF      PUSH	R27
    01D8B 81A0      LD	R26,Z
    01D8C 81B1      LDD	R27,Z+1
    01D8D 01FD      MOVW	R30,R26
    01D8E 91BF      POP	R27
    01D8F 91AF      POP	R26
    01D90 80A2      LDD	R10,Z+2
    01D91 24BB      CLR	R11
    01D92 18A2      SUB	R10,R2
    01D93 08B3      SBC	R11,R3
(2538) 				if (disk_write(fp->fs->drv,(char*)wbuff, sect, (BYTE)cc) != RES_OK)
    01D94 82AC      STD	Y+4,R10
    01D95 802D      LDD	R2,Y+5
    01D96 803E      LDD	R3,Y+6
    01D97 804F      LDD	R4,Y+7
    01D98 8458      LDD	R5,Y+8
    01D99 8228      ST	Y,R2
    01D9A 8239      STD	Y+1,R3
    01D9B 824A      STD	Y+2,R4
    01D9C 825B      STD	Y+3,R5
    01D9D 0197      MOVW	R18,R14
    01D9E 8DEB      LDD	R30,Y+27
    01D9F 8DFC      LDD	R31,Y+28
    01DA0 93AF      PUSH	R26
    01DA1 93BF      PUSH	R27
    01DA2 81A0      LD	R26,Z
    01DA3 81B1      LDD	R27,Z+1
    01DA4 01FD      MOVW	R30,R26
    01DA5 91BF      POP	R27
    01DA6 91AF      POP	R26
    01DA7 8101      LDD	R16,Z+1
    01DA8 940E 03F9 CALL	_disk_write
    01DAA 2EC0      MOV	R12,R16
    01DAB 2300      TST	R16
    01DAC F051      BEQ	0x1DB7
(2539) 					ABORT(fp->fs, FR_DISK_ERR);
    01DAD 8D8B      LDD	R24,Y+27
    01DAE 8D9C      LDD	R25,Y+28
    01DAF 9604      ADIW	R24,4
    01DB0 016C      MOVW	R12,R24
    01DB1 01FC      MOVW	R30,R24
    01DB2 8180      LD	R24,Z
    01DB3 6880      ORI	R24,0x80
    01DB4 8380      ST	Z,R24
    01DB5 E001      LDI	R16,1
    01DB6 C138      RJMP	0x1EEF
(2540) #if _FS_TINY
(2541) 				if (fp->fs->winsect - sect < cc) {	/* Refill sector cache if it gets invalidated by the direct write */
    01DB7 802D      LDD	R2,Y+5
    01DB8 803E      LDD	R3,Y+6
    01DB9 804F      LDD	R4,Y+7
    01DBA 8458      LDD	R5,Y+8
    01DBB 8DEB      LDD	R30,Y+27
    01DBC 8DFC      LDD	R31,Y+28
    01DBD 81A0      LD	R26,Z
    01DBE 81B1      LDD	R27,Z+1
    01DBF 969A      ADIW	R26,0x2A
    01DC0 906D      LD	R6,X+
    01DC1 907D      LD	R7,X+
    01DC2 908D      LD	R8,X+
    01DC3 909C      LD	R9,X
    01DC4 1862      SUB	R6,R2
    01DC5 0873      SBC	R7,R3
    01DC6 0884      SBC	R8,R4
    01DC7 0895      SBC	R9,R5
    01DC8 0115      MOVW	R2,R10
    01DC9 2444      CLR	R4
    01DCA 2455      CLR	R5
    01DCB 1462      CP	R6,R2
    01DCC 0473      CPC	R7,R3
    01DCD 0484      CPC	R8,R4
    01DCE 0495      CPC	R9,R5
    01DCF F008      BCS	0x1DD1
    01DD0 C032      RJMP	0x1E03
(2542) 					mem_cpy(fp->fs->win, wbuff + ((fp->fs->winsect - sect) * SS(fp->fs)), SS(fp->fs));
    01DD1 E080      LDI	R24,0
    01DD2 E092      LDI	R25,2
    01DD3 8399      STD	Y+1,R25
    01DD4 8388      ST	Y,R24
    01DD5 80C0      LD	R12,Z
    01DD6 80D1      LDD	R13,Z+1
    01DD7 802D      LDD	R2,Y+5
    01DD8 803E      LDD	R3,Y+6
    01DD9 804F      LDD	R4,Y+7
    01DDA 8458      LDD	R5,Y+8
    01DDB 01F6      MOVW	R30,R12
    01DDC A462      LDD	R6,Z+42
    01DDD A473      LDD	R7,Z+43
    01DDE A484      LDD	R8,Z+44
    01DDF A495      LDD	R9,Z+45
    01DE0 1862      SUB	R6,R2
    01DE1 0873      SBC	R7,R3
    01DE2 0884      SBC	R8,R4
    01DE3 0895      SBC	R9,R5
    01DE4 E040      LDI	R20,0
    01DE5 E052      LDI	R21,2
    01DE6 E060      LDI	R22,0
    01DE7 E070      LDI	R23,0
    01DE8 929A      ST	-Y,R9
    01DE9 928A      ST	-Y,R8
    01DEA 927A      ST	-Y,R7
    01DEB 926A      ST	-Y,R6
    01DEC 018A      MOVW	R16,R20
    01DED 019B      MOVW	R18,R22
    01DEE 940E 486F CALL	empy32u|empy32s
    01DF0 0198      MOVW	R18,R16
    01DF1 0D2E      ADD	R18,R14
    01DF2 1D3F      ADC	R19,R15
    01DF3 0186      MOVW	R16,R12
    01DF4 5D02      SUBI	R16,0xD2
    01DF5 4F1F      SBCI	R17,0xFF
    01DF6 940E 041B CALL	ff.c:mem_cpy
(2543) 					fp->fs->wflag = 0;
    01DF8 2422      CLR	R2
    01DF9 8DEB      LDD	R30,Y+27
    01DFA 8DFC      LDD	R31,Y+28
    01DFB 93AF      PUSH	R26
    01DFC 93BF      PUSH	R27
    01DFD 81A0      LD	R26,Z
    01DFE 81B1      LDD	R27,Z+1
    01DFF 01FD      MOVW	R30,R26
    01E00 91BF      POP	R27
    01E01 91AF      POP	R26
    01E02 8224      STD	Z+4,R2
(2544) 				}
(2545) #else
(2546) 				if (fp->dsect - sect < cc) { /* Refill sector cache if it gets invalidated by the direct write */
(2547) 					mem_cpy(fp->buf, wbuff + ((fp->dsect - sect) * SS(fp->fs)), SS(fp->fs));
(2548) 					fp->flag &= ~FA__DIRTY;
(2549) 				}
(2550) #endif
(2551) 				wcnt = SS(fp->fs) * cc;		/* Number of bytes transferred */
    01E03 E000      LDI	R16,0
    01E04 E012      LDI	R17,2
    01E05 0195      MOVW	R18,R10
    01E06 940E 485F CALL	empy16s
    01E08 0168      MOVW	R12,R16
(2552) 				continue;
    01E09 C099      RJMP	0x1EA3
(2553) 			}
(2554) #if _FS_TINY
(2555) 			if (fp->fptr >= fp->fsize) {	/* Avoid silly cache filling at growing edge */
    01E0A 8DEB      LDD	R30,Y+27
    01E0B 8DFC      LDD	R31,Y+28
    01E0C 8422      LDD	R2,Z+10
    01E0D 8433      LDD	R3,Z+11
    01E0E 8444      LDD	R4,Z+12
    01E0F 8455      LDD	R5,Z+13
    01E10 8066      LDD	R6,Z+6
    01E11 8077      LDD	R7,Z+7
    01E12 8480      LDD	R8,Z+8
    01E13 8491      LDD	R9,Z+9
    01E14 1462      CP	R6,R2
    01E15 0473      CPC	R7,R3
    01E16 0484      CPC	R8,R4
    01E17 0495      CPC	R9,R5
    01E18 F128      BCS	0x1E3E
(2556) 				if (move_window(fp->fs, 0)) ABORT(fp->fs, FR_DISK_ERR);
    01E19 E040      LDI	R20,0
    01E1A E050      LDI	R21,0
    01E1B E060      LDI	R22,0
    01E1C E070      LDI	R23,0
    01E1D 8368      ST	Y,R22
    01E1E 8379      STD	Y+1,R23
    01E1F 019A      MOVW	R18,R20
    01E20 8100      LD	R16,Z
    01E21 8111      LDD	R17,Z+1
    01E22 940E 0474 CALL	ff.c:move_window
    01E24 2EA0      MOV	R10,R16
    01E25 2300      TST	R16
    01E26 F051      BEQ	0x1E31
    01E27 8D8B      LDD	R24,Y+27
    01E28 8D9C      LDD	R25,Y+28
    01E29 9604      ADIW	R24,4
    01E2A 015C      MOVW	R10,R24
    01E2B 01FC      MOVW	R30,R24
    01E2C 8180      LD	R24,Z
    01E2D 6880      ORI	R24,0x80
    01E2E 8380      ST	Z,R24
    01E2F E001      LDI	R16,1
    01E30 C0BE      RJMP	0x1EEF
(2557) 				fp->fs->winsect = sect;
    01E31 802D      LDD	R2,Y+5
    01E32 803E      LDD	R3,Y+6
    01E33 804F      LDD	R4,Y+7
    01E34 8458      LDD	R5,Y+8
    01E35 8DEB      LDD	R30,Y+27
    01E36 8DFC      LDD	R31,Y+28
    01E37 81A0      LD	R26,Z
    01E38 81B1      LDD	R27,Z+1
    01E39 969A      ADIW	R26,0x2A
    01E3A 922D      ST	X+,R2
    01E3B 923D      ST	X+,R3
    01E3C 924D      ST	X+,R4
    01E3D 925C      ST	X,R5
(2558) 			}
(2559) #else
(2560) 			if (fp->dsect != sect) {		/* Fill sector cache with file data */
(2561) 				if (fp->fptr < fp->fsize &&
(2562) 					disk_read(fp->fs->drv, fp->buf, sect, 1) != RES_OK)
(2563) 						ABORT(fp->fs, FR_DISK_ERR);
(2564) 			}
(2565) #endif
(2566) 			fp->dsect = sect;
    01E3E 802D      LDD	R2,Y+5
    01E3F 803E      LDD	R3,Y+6
    01E40 804F      LDD	R4,Y+7
    01E41 8458      LDD	R5,Y+8
    01E42 8DEB      LDD	R30,Y+27
    01E43 8DFC      LDD	R31,Y+28
    01E44 8A26      STD	Z+22,R2
    01E45 8A37      STD	Z+23,R3
    01E46 8E40      STD	Z+24,R4
    01E47 8E51      STD	Z+25,R5
(2567) 		}
(2568) 		wcnt = SS(fp->fs) - (fp->fptr % SS(fp->fs));/* Put partial sector into file I/O buffer */
    01E48 EF4F      LDI	R20,0xFF
    01E49 E051      LDI	R21,1
    01E4A E060      LDI	R22,0
    01E4B E070      LDI	R23,0
    01E4C 8DEB      LDD	R30,Y+27
    01E4D 8DFC      LDD	R31,Y+28
    01E4E 8026      LDD	R2,Z+6
    01E4F 8037      LDD	R3,Z+7
    01E50 8440      LDD	R4,Z+8
    01E51 8451      LDD	R5,Z+9
    01E52 2224      AND	R2,R20
    01E53 2235      AND	R3,R21
    01E54 2246      AND	R4,R22
    01E55 2257      AND	R5,R23
    01E56 E040      LDI	R20,0
    01E57 E052      LDI	R21,2
    01E58 E060      LDI	R22,0
    01E59 E070      LDI	R23,0
    01E5A 1942      SUB	R20,R2
    01E5B 0953      SBC	R21,R3
    01E5C 0964      SBC	R22,R4
    01E5D 0975      SBC	R23,R5
    01E5E 016A      MOVW	R12,R20
(2569) 		if (wcnt > btw) wcnt = btw;
    01E5F 8C0F      LDD	R0,Y+31
    01E60 A018      LDD	R1,Y+32
    01E61 1604      CP	R0,R20
    01E62 0615      CPC	R1,R21
    01E63 F408      BCC	0x1E65
    01E64 0160      MOVW	R12,R0
(2570) #if _FS_TINY
(2571) 		if (move_window(fp->fs, fp->dsect))	/* Move sector window */
    01E65 8DEB      LDD	R30,Y+27
    01E66 8DFC      LDD	R31,Y+28
    01E67 8826      LDD	R2,Z+22
    01E68 8837      LDD	R3,Z+23
    01E69 8C40      LDD	R4,Z+24
    01E6A 8C51      LDD	R5,Z+25
    01E6B 8248      ST	Y,R4
    01E6C 8259      STD	Y+1,R5
    01E6D 0191      MOVW	R18,R2
    01E6E 8100      LD	R16,Z
    01E6F 8111      LDD	R17,Z+1
    01E70 940E 0474 CALL	ff.c:move_window
    01E72 2EA0      MOV	R10,R16
    01E73 2300      TST	R16
    01E74 F051      BEQ	0x1E7F
(2572) 			ABORT(fp->fs, FR_DISK_ERR);
    01E75 8D8B      LDD	R24,Y+27
    01E76 8D9C      LDD	R25,Y+28
    01E77 9604      ADIW	R24,4
    01E78 015C      MOVW	R10,R24
    01E79 01FC      MOVW	R30,R24
    01E7A 8180      LD	R24,Z
    01E7B 6880      ORI	R24,0x80
    01E7C 8380      ST	Z,R24
    01E7D E001      LDI	R16,1
    01E7E C070      RJMP	0x1EEF
(2573) 		mem_cpy(&fp->fs->win[fp->fptr % SS(fp->fs)], wbuff, wcnt);	/* Fit partial sector */
    01E7F 82D9      STD	Y+1,R13
    01E80 82C8      ST	Y,R12
    01E81 0197      MOVW	R18,R14
    01E82 EF4F      LDI	R20,0xFF
    01E83 E051      LDI	R21,1
    01E84 E060      LDI	R22,0
    01E85 E070      LDI	R23,0
    01E86 8DEB      LDD	R30,Y+27
    01E87 8DFC      LDD	R31,Y+28
    01E88 8026      LDD	R2,Z+6
    01E89 8037      LDD	R3,Z+7
    01E8A 8440      LDD	R4,Z+8
    01E8B 8451      LDD	R5,Z+9
    01E8C 2224      AND	R2,R20
    01E8D 2235      AND	R3,R21
    01E8E 2246      AND	R4,R22
    01E8F 2257      AND	R5,R23
    01E90 0181      MOVW	R16,R2
    01E91 8180      LD	R24,Z
    01E92 8191      LDD	R25,Z+1
    01E93 968E      ADIW	R24,0x2E
    01E94 0F08      ADD	R16,R24
    01E95 1F19      ADC	R17,R25
    01E96 940E 041B CALL	ff.c:mem_cpy
(2574) 		fp->fs->wflag = 1;
    01E98 E081      LDI	R24,1
    01E99 8DEB      LDD	R30,Y+27
    01E9A 8DFC      LDD	R31,Y+28
    01E9B 93AF      PUSH	R26
    01E9C 93BF      PUSH	R27
    01E9D 81A0      LD	R26,Z
    01E9E 81B1      LDD	R27,Z+1
    01E9F 01FD      MOVW	R30,R26
    01EA0 91BF      POP	R27
    01EA1 91AF      POP	R26
    01EA2 8384      STD	Z+4,R24
    01EA3 0CEC      ADD	R14,R12
    01EA4 1CFD      ADC	R15,R13
    01EA5 8D8B      LDD	R24,Y+27
    01EA6 8D9C      LDD	R25,Y+28
    01EA7 9606      ADIW	R24,6
    01EA8 015C      MOVW	R10,R24
    01EA9 0116      MOVW	R2,R12
    01EAA 2444      CLR	R4
    01EAB 2455      CLR	R5
    01EAC 01FC      MOVW	R30,R24
    01EAD 8060      LD	R6,Z
    01EAE 8071      LDD	R7,Z+1
    01EAF 8082      LDD	R8,Z+2
    01EB0 8093      LDD	R9,Z+3
    01EB1 0C62      ADD	R6,R2
    01EB2 1C73      ADC	R7,R3
    01EB3 1C84      ADC	R8,R4
    01EB4 1C95      ADC	R9,R5
    01EB5 8260      ST	Z,R6
    01EB6 8271      STD	Z+1,R7
    01EB7 8282      STD	Z+2,R8
    01EB8 8293      STD	Z+3,R9
    01EB9 A1E9      LDD	R30,Y+33
    01EBA A1FA      LDD	R31,Y+34
    01EBB 8020      LD	R2,Z
    01EBC 8031      LDD	R3,Z+1
    01EBD 0C2C      ADD	R2,R12
    01EBE 1C3D      ADC	R3,R13
    01EBF 8231      STD	Z+1,R3
    01EC0 8220      ST	Z,R2
    01EC1 8C0F      LDD	R0,Y+31
    01EC2 A018      LDD	R1,Y+32
    01EC3 180C      SUB	R0,R12
    01EC4 081D      SBC	R1,R13
    01EC5 A218      STD	Y+32,R1
    01EC6 8E0F      STD	Y+31,R0
    01EC7 8C0F      LDD	R0,Y+31
    01EC8 A018      LDD	R1,Y+32
    01EC9 2000      TST	R0
    01ECA F009      BEQ	0x1ECC
    01ECB CD5B      RJMP	0x1C27
    01ECC 2011      TST	R1
    01ECD F009      BEQ	0x1ECF
    01ECE CD58      RJMP	0x1C27
(2575) #else
(2576) 		mem_cpy(&fp->buf[fp->fptr % SS(fp->fs)], wbuff, wcnt);	/* Fit partial sector */
(2577) 		fp->flag |= FA__DIRTY;
(2578) #endif
(2579) 	}
(2580) 
(2581) 	if (fp->fptr > fp->fsize) fp->fsize = fp->fptr;	/* Update file size if needed */
    01ECF 8DEB      LDD	R30,Y+27
    01ED0 8DFC      LDD	R31,Y+28
    01ED1 8422      LDD	R2,Z+10
    01ED2 8433      LDD	R3,Z+11
    01ED3 8444      LDD	R4,Z+12
    01ED4 8455      LDD	R5,Z+13
    01ED5 8066      LDD	R6,Z+6
    01ED6 8077      LDD	R7,Z+7
    01ED7 8480      LDD	R8,Z+8
    01ED8 8491      LDD	R9,Z+9
    01ED9 1426      CP	R2,R6
    01EDA 0437      CPC	R3,R7
    01EDB 0448      CPC	R4,R8
    01EDC 0459      CPC	R5,R9
    01EDD F440      BCC	0x1EE6
    01EDE 8026      LDD	R2,Z+6
    01EDF 8037      LDD	R3,Z+7
    01EE0 8440      LDD	R4,Z+8
    01EE1 8451      LDD	R5,Z+9
    01EE2 8622      STD	Z+10,R2
    01EE3 8633      STD	Z+11,R3
    01EE4 8644      STD	Z+12,R4
    01EE5 8655      STD	Z+13,R5
(2582) 	fp->flag |= FA__WRITTEN;						/* Set file change flag */
    01EE6 8D8B      LDD	R24,Y+27
    01EE7 8D9C      LDD	R25,Y+28
    01EE8 9604      ADIW	R24,4
    01EE9 015C      MOVW	R10,R24
    01EEA 01FC      MOVW	R30,R24
    01EEB 8180      LD	R24,Z
    01EEC 6280      ORI	R24,0x20
    01EED 8380      ST	Z,R24
(2583) 
(2584) 	LEAVE_FF(fp->fs, FR_OK);
    01EEE 2700      CLR	R16
    01EEF 9661      ADIW	R28,0x11
    01EF0 940E 48B8 CALL	pop_xgsetF0FC
    01EF2 9624      ADIW	R28,4
    01EF3 9508      RET
_f_sync:
  tim                  --> Y,+2
  dir                  --> R22
  res                  --> R10
  fp                   --> R20
    01EF4 940E 48FE CALL	push_xgsetF03C
    01EF6 01A8      MOVW	R20,R16
    01EF7 9726      SBIW	R28,6
(2585) }
(2586) 
(2587) 
(2588) 
(2589) 
(2590) /*-----------------------------------------------------------------------*/
(2591) /* Synchronize the File Object                                           */
(2592) /*-----------------------------------------------------------------------*/
(2593) 
(2594) FRESULT f_sync (
(2595) 	FIL *fp		/* Pointer to the file object */
(2596) )
(2597) {
(2598) 	FRESULT res;
(2599) 	DWORD tim;
(2600) 	BYTE *dir;
(2601) 
(2602) 
(2603) 	res = validate(fp->fs, fp->id);		/* Check validity of the object */
    01EF8 01FA      MOVW	R30,R20
    01EF9 8122      LDD	R18,Z+2
    01EFA 8133      LDD	R19,Z+3
    01EFB 8100      LD	R16,Z
    01EFC 8111      LDD	R17,Z+1
    01EFD D88E      RCALL	ff.c:validate
    01EFE 2EA0      MOV	R10,R16
(2604) 	if (res == FR_OK) {
    01EFF 2300      TST	R16
    01F00 F009      BEQ	0x1F02
    01F01 C09F      RJMP	0x1FA1
(2605) 		if (fp->flag & FA__WRITTEN) {	/* Has the file been written? */
    01F02 01FA      MOVW	R30,R20
    01F03 8024      LDD	R2,Z+4
    01F04 FE25      SBRS	R2,5
    01F05 C09B      RJMP	0x1FA1
(2606) #if !_FS_TINY	/* Write-back dirty buffer */
(2607) 			if (fp->flag & FA__DIRTY) {
(2608) 				if (disk_write(fp->fs->drv, fp->buf, fp->dsect, 1) != RES_OK)
(2609) 					LEAVE_FF(fp->fs, FR_DISK_ERR);
(2610) 				fp->flag &= ~FA__DIRTY;
(2611) 			}
(2612) #endif
(2613) 			/* Update the directory entry */
(2614) 			res = move_window(fp->fs, fp->dir_sect);
    01F06 8C22      LDD	R2,Z+26
    01F07 8C33      LDD	R3,Z+27
    01F08 8C44      LDD	R4,Z+28
    01F09 8C55      LDD	R5,Z+29
    01F0A 8248      ST	Y,R4
    01F0B 8259      STD	Y+1,R5
    01F0C 0191      MOVW	R18,R2
    01F0D 8100      LD	R16,Z
    01F0E 8111      LDD	R17,Z+1
    01F0F 940E 0474 CALL	ff.c:move_window
    01F11 2EA0      MOV	R10,R16
(2615) 			if (res == FR_OK) {
    01F12 2300      TST	R16
    01F13 F009      BEQ	0x1F15
    01F14 C08C      RJMP	0x1FA1
(2616) 				dir = fp->dir_ptr;
    01F15 01FA      MOVW	R30,R20
    01F16 8D66      LDD	R22,Z+30
    01F17 8D77      LDD	R23,Z+31
(2617) 				dir[DIR_Attr] |= AM_ARC;					/* Set archive bit */
    01F18 01CB      MOVW	R24,R22
    01F19 960B      ADIW	R24,0xB
    01F1A 01FC      MOVW	R30,R24
    01F1B 8180      LD	R24,Z
    01F1C 6280      ORI	R24,0x20
    01F1D 8380      ST	Z,R24
(2618) 				ST_DWORD(dir+DIR_FileSize, fp->fsize);		/* Update file size */
    01F1E 01FA      MOVW	R30,R20
    01F1F 8422      LDD	R2,Z+10
    01F20 8433      LDD	R3,Z+11
    01F21 8444      LDD	R4,Z+12
    01F22 8455      LDD	R5,Z+13
    01F23 01FB      MOVW	R30,R22
    01F24 8E24      STD	Z+28,R2
    01F25 01FA      MOVW	R30,R20
    01F26 8422      LDD	R2,Z+10
    01F27 8433      LDD	R3,Z+11
    01F28 2C23      MOV	R2,R3
    01F29 2433      CLR	R3
    01F2A 01FB      MOVW	R30,R22
    01F2B 8E25      STD	Z+29,R2
    01F2C 01FA      MOVW	R30,R20
    01F2D 8422      LDD	R2,Z+10
    01F2E 8433      LDD	R3,Z+11
    01F2F 8444      LDD	R4,Z+12
    01F30 8455      LDD	R5,Z+13
    01F31 0112      MOVW	R2,R4
    01F32 2444      CLR	R4
    01F33 2455      CLR	R5
    01F34 01FB      MOVW	R30,R22
    01F35 8E26      STD	Z+30,R2
    01F36 E188      LDI	R24,0x18
    01F37 E090      LDI	R25,0
    01F38 01FA      MOVW	R30,R20
    01F39 8502      LDD	R16,Z+10
    01F3A 8513      LDD	R17,Z+11
    01F3B 8524      LDD	R18,Z+12
    01F3C 8535      LDD	R19,Z+13
    01F3D 938A      ST	-Y,R24
    01F3E 940E 4967 CALL	lsr32
    01F40 01FB      MOVW	R30,R22
    01F41 8F07      STD	Z+31,R16
(2619) 				ST_CLUST(dir, fp->sclust);					/* Update start cluster */
    01F42 01FA      MOVW	R30,R20
    01F43 8426      LDD	R2,Z+14
    01F44 8437      LDD	R3,Z+15
    01F45 8840      LDD	R4,Z+16
    01F46 8851      LDD	R5,Z+17
    01F47 01FB      MOVW	R30,R22
    01F48 8E22      STD	Z+26,R2
    01F49 01FA      MOVW	R30,R20
    01F4A 8426      LDD	R2,Z+14
    01F4B 8437      LDD	R3,Z+15
    01F4C 2C23      MOV	R2,R3
    01F4D 2433      CLR	R3
    01F4E 01FB      MOVW	R30,R22
    01F4F 8E23      STD	Z+27,R2
    01F50 01FA      MOVW	R30,R20
    01F51 8426      LDD	R2,Z+14
    01F52 8437      LDD	R3,Z+15
    01F53 8840      LDD	R4,Z+16
    01F54 8851      LDD	R5,Z+17
    01F55 0112      MOVW	R2,R4
    01F56 2444      CLR	R4
    01F57 2455      CLR	R5
    01F58 01FB      MOVW	R30,R22
    01F59 8A24      STD	Z+20,R2
    01F5A 01FA      MOVW	R30,R20
    01F5B 8426      LDD	R2,Z+14
    01F5C 8437      LDD	R3,Z+15
    01F5D 8840      LDD	R4,Z+16
    01F5E 8851      LDD	R5,Z+17
    01F5F 0112      MOVW	R2,R4
    01F60 2C23      MOV	R2,R3
    01F61 2433      CLR	R3
    01F62 01FB      MOVW	R30,R22
    01F63 8A25      STD	Z+21,R2
(2620) 				tim = get_fattime();						/* Update updated time */
    01F64 940E 0416 CALL	_get_fattime
    01F66 830A      STD	Y+2,R16
    01F67 831B      STD	Y+3,R17
    01F68 832C      STD	Y+4,R18
    01F69 833D      STD	Y+5,R19
(2621) 				ST_DWORD(dir+DIR_WrtTime, tim);
    01F6A 802A      LDD	R2,Y+2
    01F6B 803B      LDD	R3,Y+3
    01F6C 804C      LDD	R4,Y+4
    01F6D 805D      LDD	R5,Y+5
    01F6E 01FB      MOVW	R30,R22
    01F6F 8A26      STD	Z+22,R2
    01F70 2C23      MOV	R2,R3
    01F71 2433      CLR	R3
    01F72 9677      ADIW	R30,0x17
    01F73 8220      ST	Z,R2
    01F74 802A      LDD	R2,Y+2
    01F75 803B      LDD	R3,Y+3
    01F76 804C      LDD	R4,Y+4
    01F77 805D      LDD	R5,Y+5
    01F78 0112      MOVW	R2,R4
    01F79 2444      CLR	R4
    01F7A 2455      CLR	R5
    01F7B 01FB      MOVW	R30,R22
    01F7C 9678      ADIW	R30,0x18
    01F7D 8220      ST	Z,R2
    01F7E E188      LDI	R24,0x18
    01F7F E090      LDI	R25,0
    01F80 810A      LDD	R16,Y+2
    01F81 811B      LDD	R17,Y+3
    01F82 812C      LDD	R18,Y+4
    01F83 813D      LDD	R19,Y+5
    01F84 938A      ST	-Y,R24
    01F85 940E 4967 CALL	lsr32
    01F87 01FB      MOVW	R30,R22
    01F88 8F01      STD	Z+25,R16
(2622) 				fp->flag &= ~FA__WRITTEN;
    01F89 01BA      MOVW	R22,R20
    01F8A 5F6C      SUBI	R22,0xFC
    01F8B 4F7F      SBCI	R23,0xFF
    01F8C 01FB      MOVW	R30,R22
    01F8D 8180      LD	R24,Z
    01F8E 7D8F      ANDI	R24,0xDF
    01F8F 8380      ST	Z,R24
(2623) 				fp->fs->wflag = 1;
    01F90 E081      LDI	R24,1
    01F91 01FA      MOVW	R30,R20
    01F92 93AF      PUSH	R26
    01F93 93BF      PUSH	R27
    01F94 81A0      LD	R26,Z
    01F95 81B1      LDD	R27,Z+1
    01F96 01FD      MOVW	R30,R26
    01F97 91BF      POP	R27
    01F98 91AF      POP	R26
    01F99 8384      STD	Z+4,R24
(2624) 				res = sync(fp->fs);
    01F9A 01FA      MOVW	R30,R20
    01F9B 8100      LD	R16,Z
    01F9C 8111      LDD	R17,Z+1
    01F9D 940E 0516 CALL	ff.c:sync
    01F9F 2EC0      MOV	R12,R16
    01FA0 2CAC      MOV	R10,R12
(2625) 			}
(2626) 		}
(2627) 	}
(2628) 
(2629) 	LEAVE_FF(fp->fs, res);
    01FA1 2D0A      MOV	R16,R10
    01FA2 9626      ADIW	R28,6
    01FA3 940C 4907 JMP	pop_xgsetF03C
_f_close:
  res                  --> R10
  fp                   --> R12
    01FA5 940E 48C9 CALL	push_xgset003C
    01FA7 0168      MOVW	R12,R16
(2630) }
(2631) 
(2632) #endif /* !_FS_READONLY */
(2633) 
(2634) 
(2635) 
(2636) 
(2637) /*-----------------------------------------------------------------------*/
(2638) /* Close File                                                            */
(2639) /*-----------------------------------------------------------------------*/
(2640) 
(2641) FRESULT f_close (
(2642) 	FIL *fp		/* Pointer to the file object to be closed */
(2643) )
(2644) {
(2645) 	FRESULT res;
(2646) 
(2647) #if _FS_READONLY
(2648) 	FATFS *fs = fp->fs;
(2649) 	res = validate(fs, fp->id);
(2650) 	if (res == FR_OK) fp->fs = 0;	/* Discard file object */
(2651) 	LEAVE_FF(fs, res);
(2652) 
(2653) #else
(2654) 	res = f_sync(fp);		/* Flush cached data */
    01FA8 0186      MOVW	R16,R12
    01FA9 DF4A      RCALL	_f_sync
    01FAA 2EA0      MOV	R10,R16
(2655) #if _FS_SHARE
(2656) 	if (res == FR_OK) {		/* Decrement open counter */
(2657) #if _FS_REENTRANT
(2658) 		res = validate(fp->fs, fp->id);
(2659) 		if (res == FR_OK) {
(2660) 			res = dec_lock(fp->lockid);	
(2661) 			unlock_fs(fp->fs, FR_OK);
(2662) 		}
(2663) #else
(2664) 		res = dec_lock(fp->lockid);
(2665) #endif
(2666) 	}
(2667) #endif
(2668) 	if (res == FR_OK) fp->fs = 0;	/* Discard file object */
    01FAB 2300      TST	R16
    01FAC F429      BNE	0x1FB2
    01FAD 2422      CLR	R2
    01FAE 2433      CLR	R3
    01FAF 01F6      MOVW	R30,R12
    01FB0 8231      STD	Z+1,R3
    01FB1 8220      ST	Z,R2
(2669) 	return res;
    01FB2 2D0A      MOV	R16,R10
    01FB3 940C 48A3 JMP	pop_xgset003C
_f_lseek:
  ifptr                --> Y,+14
  nsect                --> Y,+10
  bcs                  --> Y,+6
  clst                 --> Y,+2
  dsc                  --> Y,+26
  tlen                 --> Y,+22
  tbl                  --> R14
  tcl                  --> Y,+18
  ulen                 --> Y,+14
  ncl                  --> Y,+10
  pcl                  --> Y,+6
  cl                   --> Y,+2
  res                  --> R10
  ofs                  --> Y,+42
  fp                   --> Y,+40
    01FB5 940E 477E CALL	push_arg4
    01FB7 940E 48C3 CALL	push_xgsetF0FC
    01FB9 976E      SBIW	R28,0x1E
(2670) #endif
(2671) }
(2672) 
(2673) 
(2674) 
(2675) 
(2676) /*-----------------------------------------------------------------------*/
(2677) /* Current Drive/Directory Handlings                                     */
(2678) /*-----------------------------------------------------------------------*/
(2679) 
(2680) #if _FS_RPATH >= 1
(2681) 
(2682) FRESULT f_chdrive (
(2683) 	BYTE drv		/* Drive number */
(2684) )
(2685) {
(2686) 	if (drv >= _VOLUMES) return FR_INVALID_DRIVE;
(2687) 
(2688) 	CurrVol = drv;
(2689) 
(2690) 	return FR_OK;
(2691) }
(2692) 
(2693) 
(2694) 
(2695) FRESULT f_chdir (
(2696) 	const TCHAR *path	/* Pointer to the directory path */
(2697) )
(2698) {
(2699) 	FRESULT res;
(2700) 	DIR dj;
(2701) 	DEF_NAMEBUF;
(2702) 
(2703) 
(2704) 	res = chk_mounted(&path, &dj.fs, 0);
(2705) 	if (res == FR_OK) {
(2706) 		INIT_BUF(dj);
(2707) 		res = follow_path(&dj, path);		/* Follow the path */
(2708) 		FREE_BUF();
(2709) 		if (res == FR_OK) {					/* Follow completed */
(2710) 			if (!dj.dir) {
(2711) 				dj.fs->cdir = dj.sclust;	/* Start directory itself */
(2712) 			} else {
(2713) 				if (dj.dir[DIR_Attr] & AM_DIR)	/* Reached to the directory */
(2714) 					dj.fs->cdir = LD_CLUST(dj.dir);
(2715) 				else
(2716) 					res = FR_NO_PATH;		/* Reached but a file */
(2717) 			}
(2718) 		}
(2719) 		if (res == FR_NO_FILE) res = FR_NO_PATH;
(2720) 	}
(2721) 
(2722) 	LEAVE_FF(dj.fs, res);
(2723) }
(2724) 
(2725) 
(2726) #if _FS_RPATH >= 2
(2727) FRESULT f_getcwd (
(2728) 	TCHAR *path,	/* Pointer to the directory path */
(2729) 	UINT sz_path	/* Size of path */
(2730) )
(2731) {
(2732) 	FRESULT res;
(2733) 	DIR dj;
(2734) 	UINT i, n;
(2735) 	DWORD ccl;
(2736) 	TCHAR *tp;
(2737) 	FILINFO fno;
(2738) 	DEF_NAMEBUF;
(2739) 
(2740) 
(2741) 	*path = 0;
(2742) 	res = chk_mounted((const TCHAR**)&path, &dj.fs, 0);	/* Get current volume */
(2743) 	if (res == FR_OK) {
(2744) 		INIT_BUF(dj);
(2745) 		i = sz_path;		/* Bottom of buffer (dir stack base) */
(2746) 		dj.sclust = dj.fs->cdir;			/* Start to follow upper dir from current dir */
(2747) 		while ((ccl = dj.sclust) != 0) {	/* Repeat while current dir is a sub-dir */
(2748) 			res = dir_sdi(&dj, 1);			/* Get parent dir */
(2749) 			if (res != FR_OK) break;
(2750) 			res = dir_read(&dj);
(2751) 			if (res != FR_OK) break;
(2752) 			dj.sclust = LD_CLUST(dj.dir);	/* Goto parent dir */
(2753) 			res = dir_sdi(&dj, 0);
(2754) 			if (res != FR_OK) break;
(2755) 			do {							/* Find the entry links to the child dir */
(2756) 				res = dir_read(&dj);
(2757) 				if (res != FR_OK) break;
(2758) 				if (ccl == LD_CLUST(dj.dir)) break;	/* Found the entry */
(2759) 				res = dir_next(&dj, 0);	
(2760) 			} while (res == FR_OK);
(2761) 			if (res == FR_NO_FILE) res = FR_INT_ERR;/* It cannot be 'not found'. */
(2762) 			if (res != FR_OK) break;
(2763) #if _USE_LFN
(2764) 			fno.lfname = path;
(2765) 			fno.lfsize = i;
(2766) #endif
(2767) 			get_fileinfo(&dj, &fno);		/* Get the dir name and push it to the buffer */
(2768) 			tp = fno.fname;
(2769) 			if (_USE_LFN && *path) tp = path;
(2770) 			for (n = 0; tp[n]; n++) ;
(2771) 			if (i < n + 3) {
(2772) 				res = FR_NOT_ENOUGH_CORE; break;
(2773) 			}
(2774) 			while (n) path[--i] = tp[--n];
(2775) 			path[--i] = '/';
(2776) 		}
(2777) 		tp = path;
(2778) 		if (res == FR_OK) {
(2779) 			*tp++ = '0' + CurrVol;			/* Put drive number */
(2780) 			*tp++ = ':';
(2781) 			if (i == sz_path) {				/* Root-dir */
(2782) 				*tp++ = '/';
(2783) 			} else {						/* Sub-dir */
(2784) 				do		/* Add stacked path str */
(2785) 					*tp++ = path[i++];
(2786) 				while (i < sz_path);
(2787) 			}
(2788) 		}
(2789) 		*tp = 0;
(2790) 		FREE_BUF();
(2791) 	}
(2792) 
(2793) 	LEAVE_FF(dj.fs, res);
(2794) }
(2795) #endif /* _FS_RPATH >= 2 */
(2796) #endif /* _FS_RPATH >= 1 */
(2797) 
(2798) 
(2799) 
(2800) #if _FS_MINIMIZE <= 2
(2801) /*-----------------------------------------------------------------------*/
(2802) /* Seek File R/W Pointer                                                 */
(2803) /*-----------------------------------------------------------------------*/
(2804) 
(2805) FRESULT f_lseek (
(2806) 	FIL *fp,		/* Pointer to the file object */
(2807) 	DWORD ofs		/* File pointer from top of file */
(2808) )
(2809) {
(2810) 	FRESULT res;
(2811) 
(2812) 
(2813) 	res = validate(fp->fs, fp->id);		/* Check validity of the object */
    01FBA A5E8      LDD	R30,Y+40
    01FBB A5F9      LDD	R31,Y+41
    01FBC 8122      LDD	R18,Z+2
    01FBD 8133      LDD	R19,Z+3
    01FBE 8100      LD	R16,Z
    01FBF 8111      LDD	R17,Z+1
    01FC0 940E 178C CALL	ff.c:validate
    01FC2 2EA0      MOV	R10,R16
(2814) 	if (res != FR_OK) LEAVE_FF(fp->fs, res);
    01FC3 2300      TST	R16
    01FC4 F009      BEQ	0x1FC6
    01FC5 C4A7      RJMP	0x246D
(2815) 	if (fp->flag & FA__ERROR)			/* Check abort flag */
    01FC6 A5E8      LDD	R30,Y+40
    01FC7 A5F9      LDD	R31,Y+41
    01FC8 8024      LDD	R2,Z+4
    01FC9 FE27      SBRS	R2,7
    01FCA C002      RJMP	0x1FCD
(2816) 		LEAVE_FF(fp->fs, FR_INT_ERR);
    01FCB E002      LDI	R16,2
    01FCC C4A0      RJMP	0x246D
(2817) 
(2818) #if _USE_FASTSEEK
(2819) 	if (fp->cltbl) {	/* Fast seek */
    01FCD A5E8      LDD	R30,Y+40
    01FCE A5F9      LDD	R31,Y+41
    01FCF 96B0      ADIW	R30,0x20
    01FD0 8020      LD	R2,Z
    01FD1 8031      LDD	R3,Z+1
    01FD2 2022      TST	R2
    01FD3 F419      BNE	0x1FD7
    01FD4 2033      TST	R3
    01FD5 F409      BNE	0x1FD7
    01FD6 C1E3      RJMP	0x21BA
(2820) 		DWORD cl, pcl, ncl, tcl, dsc, tlen, ulen, *tbl;
(2821) 
(2822) 		if (ofs == CREATE_LINKMAP) {	/* Create CLMT */
    01FD7 EF4F      LDI	R20,0xFF
    01FD8 EF5F      LDI	R21,0xFF
    01FD9 EF6F      LDI	R22,0xFF
    01FDA EF7F      LDI	R23,0xFF
    01FDB A42A      LDD	R2,Y+42
    01FDC A43B      LDD	R3,Y+43
    01FDD A44C      LDD	R4,Y+44
    01FDE A45D      LDD	R5,Y+45
    01FDF 1624      CP	R2,R20
    01FE0 0635      CPC	R3,R21
    01FE1 0646      CPC	R4,R22
    01FE2 0657      CPC	R5,R23
    01FE3 F009      BEQ	0x1FE5
    01FE4 C109      RJMP	0x20EE
(2823) 			tbl = fp->cltbl;
    01FE5 A5E8      LDD	R30,Y+40
    01FE6 A5F9      LDD	R31,Y+41
    01FE7 A0E0      LDD	R14,Z+32
    01FE8 A0F1      LDD	R15,Z+33
(2824) 			tlen = *tbl++; ulen = 2;	/* Given table size and required table size */
    01FE9 01F7      MOVW	R30,R14
    01FEA 9021      LD	R2,Z+
    01FEB 9031      LD	R3,Z+
    01FEC 9041      LD	R4,Z+
    01FED 9051      LD	R5,Z+
    01FEE 017F      MOVW	R14,R30
    01FEF 8A2E      STD	Y+22,R2
    01FF0 8A3F      STD	Y+23,R3
    01FF1 8E48      STD	Y+24,R4
    01FF2 8E59      STD	Y+25,R5
    01FF3 E082      LDI	R24,2
    01FF4 878E      STD	Y+14,R24
    01FF5 E080      LDI	R24,0
    01FF6 878F      STD	Y+15,R24
    01FF7 8B88      STD	Y+16,R24
    01FF8 8B89      STD	Y+17,R24
(2825) 			cl = fp->sclust;			/* Top of the chain */
    01FF9 A5E8      LDD	R30,Y+40
    01FFA A5F9      LDD	R31,Y+41
    01FFB 963E      ADIW	R30,0xE
    01FFC 8020      LD	R2,Z
    01FFD 8031      LDD	R3,Z+1
    01FFE 8042      LDD	R4,Z+2
    01FFF 8053      LDD	R5,Z+3
    02000 822A      STD	Y+2,R2
    02001 823B      STD	Y+3,R3
    02002 824C      STD	Y+4,R4
    02003 825D      STD	Y+5,R5
(2826) 			if (cl) {
    02004 802A      LDD	R2,Y+2
    02005 803B      LDD	R3,Y+3
    02006 804C      LDD	R4,Y+4
    02007 805D      LDD	R5,Y+5
    02008 9488      BCLR	0
    02009 2022      TST	R2
    0200A 0432      CPC	R3,R2
    0200B 0442      CPC	R4,R2
    0200C 0452      CPC	R5,R2
    0200D F409      BNE	0x200F
    0200E C0BB      RJMP	0x20CA
(2827) 				do {
(2828) 					/* Get a fragment */
(2829) 					tcl = cl; ncl = 0; ulen += 2;	/* Top, length and used items */
    0200F 802A      LDD	R2,Y+2
    02010 803B      LDD	R3,Y+3
    02011 804C      LDD	R4,Y+4
    02012 805D      LDD	R5,Y+5
    02013 8A2A      STD	Y+18,R2
    02014 8A3B      STD	Y+19,R3
    02015 8A4C      STD	Y+20,R4
    02016 8A5D      STD	Y+21,R5
    02017 E080      LDI	R24,0
    02018 878A      STD	Y+10,R24
    02019 878B      STD	Y+11,R24
    0201A 878C      STD	Y+12,R24
    0201B 878D      STD	Y+13,R24
    0201C E042      LDI	R20,2
    0201D E050      LDI	R21,0
    0201E E060      LDI	R22,0
    0201F E070      LDI	R23,0
    02020 842E      LDD	R2,Y+14
    02021 843F      LDD	R3,Y+15
    02022 8848      LDD	R4,Y+16
    02023 8859      LDD	R5,Y+17
    02024 0E24      ADD	R2,R20
    02025 1E35      ADC	R3,R21
    02026 1E46      ADC	R4,R22
    02027 1E57      ADC	R5,R23
    02028 862E      STD	Y+14,R2
    02029 863F      STD	Y+15,R3
    0202A 8A48      STD	Y+16,R4
    0202B 8A59      STD	Y+17,R5
(2830) 					do {
(2831) 						pcl = cl; ncl++;
    0202C 802A      LDD	R2,Y+2
    0202D 803B      LDD	R3,Y+3
    0202E 804C      LDD	R4,Y+4
    0202F 805D      LDD	R5,Y+5
    02030 822E      STD	Y+6,R2
    02031 823F      STD	Y+7,R3
    02032 8648      STD	Y+8,R4
    02033 8659      STD	Y+9,R5
    02034 E041      LDI	R20,1
    02035 E050      LDI	R21,0
    02036 E060      LDI	R22,0
    02037 E070      LDI	R23,0
    02038 842A      LDD	R2,Y+10
    02039 843B      LDD	R3,Y+11
    0203A 844C      LDD	R4,Y+12
    0203B 845D      LDD	R5,Y+13
    0203C 0E24      ADD	R2,R20
    0203D 1E35      ADC	R3,R21
    0203E 1E46      ADC	R4,R22
    0203F 1E57      ADC	R5,R23
    02040 862A      STD	Y+10,R2
    02041 863B      STD	Y+11,R3
    02042 864C      STD	Y+12,R4
    02043 865D      STD	Y+13,R5
(2832) 						cl = get_fat(fp->fs, cl);
    02044 802A      LDD	R2,Y+2
    02045 803B      LDD	R3,Y+3
    02046 804C      LDD	R4,Y+4
    02047 805D      LDD	R5,Y+5
    02048 8248      ST	Y,R4
    02049 8259      STD	Y+1,R5
    0204A 0191      MOVW	R18,R2
    0204B A5E8      LDD	R30,Y+40
    0204C A5F9      LDD	R31,Y+41
    0204D 8100      LD	R16,Z
    0204E 8111      LDD	R17,Z+1
    0204F 940E 063D CALL	_get_fat
    02051 830A      STD	Y+2,R16
    02052 831B      STD	Y+3,R17
    02053 832C      STD	Y+4,R18
    02054 833D      STD	Y+5,R19
(2833) 						if (cl <= 1) ABORT(fp->fs, FR_INT_ERR);
    02055 E041      LDI	R20,1
    02056 E050      LDI	R21,0
    02057 E060      LDI	R22,0
    02058 E070      LDI	R23,0
    02059 802A      LDD	R2,Y+2
    0205A 803B      LDD	R3,Y+3
    0205B 804C      LDD	R4,Y+4
    0205C 805D      LDD	R5,Y+5
    0205D 1542      CP	R20,R2
    0205E 0553      CPC	R21,R3
    0205F 0564      CPC	R22,R4
    02060 0575      CPC	R23,R5
    02061 F048      BCS	0x206B
    02062 A588      LDD	R24,Y+40
    02063 A599      LDD	R25,Y+41
    02064 9604      ADIW	R24,4
    02065 01FC      MOVW	R30,R24
    02066 8180      LD	R24,Z
    02067 6880      ORI	R24,0x80
    02068 8380      ST	Z,R24
    02069 E002      LDI	R16,2
    0206A C402      RJMP	0x246D
(2834) 						if (cl == 0xFFFFFFFF) ABORT(fp->fs, FR_DISK_ERR);
    0206B EF4F      LDI	R20,0xFF
    0206C EF5F      LDI	R21,0xFF
    0206D EF6F      LDI	R22,0xFF
    0206E EF7F      LDI	R23,0xFF
    0206F 802A      LDD	R2,Y+2
    02070 803B      LDD	R3,Y+3
    02071 804C      LDD	R4,Y+4
    02072 805D      LDD	R5,Y+5
    02073 1624      CP	R2,R20
    02074 0635      CPC	R3,R21
    02075 0646      CPC	R4,R22
    02076 0657      CPC	R5,R23
    02077 F451      BNE	0x2082
    02078 A588      LDD	R24,Y+40
    02079 A599      LDD	R25,Y+41
    0207A 9604      ADIW	R24,4
    0207B 016C      MOVW	R12,R24
    0207C 01FC      MOVW	R30,R24
    0207D 8180      LD	R24,Z
    0207E 6880      ORI	R24,0x80
    0207F 8380      ST	Z,R24
    02080 E001      LDI	R16,1
    02081 C3EB      RJMP	0x246D
(2835) 					} while (cl == pcl + 1);
    02082 E041      LDI	R20,1
    02083 E050      LDI	R21,0
    02084 E060      LDI	R22,0
    02085 E070      LDI	R23,0
    02086 802E      LDD	R2,Y+6
    02087 803F      LDD	R3,Y+7
    02088 8448      LDD	R4,Y+8
    02089 8459      LDD	R5,Y+9
    0208A 0E24      ADD	R2,R20
    0208B 1E35      ADC	R3,R21
    0208C 1E46      ADC	R4,R22
    0208D 1E57      ADC	R5,R23
    0208E 806A      LDD	R6,Y+2
    0208F 807B      LDD	R7,Y+3
    02090 808C      LDD	R8,Y+4
    02091 809D      LDD	R9,Y+5
    02092 1462      CP	R6,R2
    02093 0473      CPC	R7,R3
    02094 0484      CPC	R8,R4
    02095 0495      CPC	R9,R5
    02096 F409      BNE	0x2098
    02097 CF94      RJMP	0x202C
(2836) 					if (ulen <= tlen) {		/* Store the length and top of the fragment */
    02098 882E      LDD	R2,Y+22
    02099 883F      LDD	R3,Y+23
    0209A 8C48      LDD	R4,Y+24
    0209B 8C59      LDD	R5,Y+25
    0209C 846E      LDD	R6,Y+14
    0209D 847F      LDD	R7,Y+15
    0209E 8888      LDD	R8,Y+16
    0209F 8899      LDD	R9,Y+17
    020A0 1426      CP	R2,R6
    020A1 0437      CPC	R3,R7
    020A2 0448      CPC	R4,R8
    020A3 0459      CPC	R5,R9
    020A4 F090      BCS	0x20B7
(2837) 						*tbl++ = ncl; *tbl++ = tcl;
    020A5 842A      LDD	R2,Y+10
    020A6 843B      LDD	R3,Y+11
    020A7 844C      LDD	R4,Y+12
    020A8 845D      LDD	R5,Y+13
    020A9 01F7      MOVW	R30,R14
    020AA 9221      ST	Z+,R2
    020AB 9231      ST	Z+,R3
    020AC 9241      ST	Z+,R4
    020AD 9251      ST	Z+,R5
    020AE 882A      LDD	R2,Y+18
    020AF 883B      LDD	R3,Y+19
    020B0 884C      LDD	R4,Y+20
    020B1 885D      LDD	R5,Y+21
    020B2 9221      ST	Z+,R2
    020B3 9231      ST	Z+,R3
    020B4 9241      ST	Z+,R4
    020B5 9251      ST	Z+,R5
    020B6 017F      MOVW	R14,R30
(2838) 					}
(2839) 				} while (cl < fp->fs->n_fatent);	/* Repeat until end of chain */
    020B7 A5E8      LDD	R30,Y+40
    020B8 A5F9      LDD	R31,Y+41
    020B9 81A0      LD	R26,Z
    020BA 81B1      LDD	R27,Z+1
    020BB 9656      ADIW	R26,0x16
    020BC 902D      LD	R2,X+
    020BD 903D      LD	R3,X+
    020BE 904D      LD	R4,X+
    020BF 905C      LD	R5,X
    020C0 806A      LDD	R6,Y+2
    020C1 807B      LDD	R7,Y+3
    020C2 808C      LDD	R8,Y+4
    020C3 809D      LDD	R9,Y+5
    020C4 1462      CP	R6,R2
    020C5 0473      CPC	R7,R3
    020C6 0484      CPC	R8,R4
    020C7 0495      CPC	R9,R5
    020C8 F408      BCC	0x20CA
    020C9 CF45      RJMP	0x200F
(2840) 			}
(2841) 			*fp->cltbl = ulen;	/* Number of items used */
    020CA 842E      LDD	R2,Y+14
    020CB 843F      LDD	R3,Y+15
    020CC 8848      LDD	R4,Y+16
    020CD 8859      LDD	R5,Y+17
    020CE A5E8      LDD	R30,Y+40
    020CF A5F9      LDD	R31,Y+41
    020D0 96B0      ADIW	R30,0x20
    020D1 81A0      LD	R26,Z
    020D2 81B1      LDD	R27,Z+1
    020D3 922D      ST	X+,R2
    020D4 923D      ST	X+,R3
    020D5 924D      ST	X+,R4
    020D6 925C      ST	X,R5
(2842) 			if (ulen <= tlen)
    020D7 882E      LDD	R2,Y+22
    020D8 883F      LDD	R3,Y+23
    020D9 8C48      LDD	R4,Y+24
    020DA 8C59      LDD	R5,Y+25
    020DB 846E      LDD	R6,Y+14
    020DC 847F      LDD	R7,Y+15
    020DD 8888      LDD	R8,Y+16
    020DE 8899      LDD	R9,Y+17
    020DF 1426      CP	R2,R6
    020E0 0437      CPC	R3,R7
    020E1 0448      CPC	R4,R8
    020E2 0459      CPC	R5,R9
    020E3 F038      BCS	0x20EB
(2843) 				*tbl = 0;		/* Terminate table */
    020E4 01F7      MOVW	R30,R14
    020E5 E080      LDI	R24,0
    020E6 8380      ST	Z,R24
    020E7 8381      STD	Z+1,R24
    020E8 8382      STD	Z+2,R24
    020E9 8383      STD	Z+3,R24
    020EA C381      RJMP	0x246C
(2844) 			else
(2845) 				res = FR_NOT_ENOUGH_CORE;	/* Given table size is smaller than required */
    020EB E181      LDI	R24,0x11
    020EC 2EA8      MOV	R10,R24
(2846) 
(2847) 		} else {						/* Fast seek */
    020ED C37E      RJMP	0x246C
(2848) 			if (ofs > fp->fsize)		/* Clip offset at the file size */
    020EE A5E8      LDD	R30,Y+40
    020EF A5F9      LDD	R31,Y+41
    020F0 963A      ADIW	R30,0xA
    020F1 8020      LD	R2,Z
    020F2 8031      LDD	R3,Z+1
    020F3 8042      LDD	R4,Z+2
    020F4 8053      LDD	R5,Z+3
    020F5 A46A      LDD	R6,Y+42
    020F6 A47B      LDD	R7,Y+43
    020F7 A48C      LDD	R8,Y+44
    020F8 A49D      LDD	R9,Y+45
    020F9 1426      CP	R2,R6
    020FA 0437      CPC	R3,R7
    020FB 0448      CPC	R4,R8
    020FC 0459      CPC	R5,R9
    020FD F458      BCC	0x2109
(2849) 				ofs = fp->fsize;
    020FE A5E8      LDD	R30,Y+40
    020FF A5F9      LDD	R31,Y+41
    02100 963A      ADIW	R30,0xA
    02101 8020      LD	R2,Z
    02102 8031      LDD	R3,Z+1
    02103 8042      LDD	R4,Z+2
    02104 8053      LDD	R5,Z+3
    02105 A62A      STD	Y+42,R2
    02106 A63B      STD	Y+43,R3
    02107 A64C      STD	Y+44,R4
    02108 A65D      STD	Y+45,R5
(2850) 			fp->fptr = ofs;				/* Set file pointer */
    02109 A42A      LDD	R2,Y+42
    0210A A43B      LDD	R3,Y+43
    0210B A44C      LDD	R4,Y+44
    0210C A45D      LDD	R5,Y+45
    0210D A5E8      LDD	R30,Y+40
    0210E A5F9      LDD	R31,Y+41
    0210F 9636      ADIW	R30,6
    02110 8220      ST	Z,R2
    02111 8231      STD	Z+1,R3
    02112 8242      STD	Z+2,R4
    02113 8253      STD	Z+3,R5
(2851) 			if (ofs) {
    02114 9488      BCLR	0
    02115 2022      TST	R2
    02116 0432      CPC	R3,R2
    02117 0442      CPC	R4,R2
    02118 0452      CPC	R5,R2
    02119 F409      BNE	0x211B
    0211A C351      RJMP	0x246C
(2852) 				fp->clust = clmt_clust(fp, ofs - 1);
    0211B E041      LDI	R20,1
    0211C E050      LDI	R21,0
    0211D E060      LDI	R22,0
    0211E E070      LDI	R23,0
    0211F 1A24      SUB	R2,R20
    02120 0A35      SBC	R3,R21
    02121 0A46      SBC	R4,R22
    02122 0A57      SBC	R5,R23
    02123 8248      ST	Y,R4
    02124 8259      STD	Y+1,R5
    02125 0191      MOVW	R18,R2
    02126 A508      LDD	R16,Y+40
    02127 A519      LDD	R17,Y+41
    02128 940E 0B77 CALL	ff.c:clmt_clust
    0212A A5E8      LDD	R30,Y+40
    0212B A5F9      LDD	R31,Y+41
    0212C 8B02      STD	Z+18,R16
    0212D 8B13      STD	Z+19,R17
    0212E 8B24      STD	Z+20,R18
    0212F 8B35      STD	Z+21,R19
(2853) 				dsc = clust2sect(fp->fs, fp->clust);
    02130 8822      LDD	R2,Z+18
    02131 8833      LDD	R3,Z+19
    02132 8844      LDD	R4,Z+20
    02133 8855      LDD	R5,Z+21
    02134 8248      ST	Y,R4
    02135 8259      STD	Y+1,R5
    02136 0191      MOVW	R18,R2
    02137 8100      LD	R16,Z
    02138 8111      LDD	R17,Z+1
    02139 940E 05EB CALL	_clust2sect
    0213B 8F0A      STD	Y+26,R16
    0213C 8F1B      STD	Y+27,R17
    0213D 8F2C      STD	Y+28,R18
    0213E 8F3D      STD	Y+29,R19
(2854) 				if (!dsc) ABORT(fp->fs, FR_INT_ERR);
    0213F 8C2A      LDD	R2,Y+26
    02140 8C3B      LDD	R3,Y+27
    02141 8C4C      LDD	R4,Y+28
    02142 8C5D      LDD	R5,Y+29
    02143 9488      BCLR	0
    02144 2022      TST	R2
    02145 0432      CPC	R3,R2
    02146 0442      CPC	R4,R2
    02147 0452      CPC	R5,R2
    02148 F451      BNE	0x2153
    02149 A588      LDD	R24,Y+40
    0214A A599      LDD	R25,Y+41
    0214B 9604      ADIW	R24,4
    0214C 017C      MOVW	R14,R24
    0214D 01FC      MOVW	R30,R24
    0214E 8180      LD	R24,Z
    0214F 6880      ORI	R24,0x80
    02150 8380      ST	Z,R24
    02151 E002      LDI	R16,2
    02152 C31A      RJMP	0x246D
(2855) 				dsc += (ofs - 1) / SS(fp->fs) & (fp->fs->csize - 1);
    02153 E041      LDI	R20,1
    02154 E050      LDI	R21,0
    02155 E060      LDI	R22,0
    02156 E070      LDI	R23,0
    02157 A50A      LDD	R16,Y+42
    02158 A51B      LDD	R17,Y+43
    02159 A52C      LDD	R18,Y+44
    0215A A53D      LDD	R19,Y+45
    0215B 1B04      SUB	R16,R20
    0215C 0B15      SBC	R17,R21
    0215D 0B26      SBC	R18,R22
    0215E 0B37      SBC	R19,R23
    0215F E089      LDI	R24,0x9
    02160 E090      LDI	R25,0
    02161 938A      ST	-Y,R24
    02162 940E 4967 CALL	lsr32
    02164 0118      MOVW	R2,R16
    02165 0129      MOVW	R4,R18
    02166 A5E8      LDD	R30,Y+40
    02167 A5F9      LDD	R31,Y+41
    02168 93AF      PUSH	R26
    02169 93BF      PUSH	R27
    0216A 81A0      LD	R26,Z
    0216B 81B1      LDD	R27,Z+1
    0216C 01FD      MOVW	R30,R26
    0216D 91BF      POP	R27
    0216E 91AF      POP	R26
    0216F 9632      ADIW	R30,2
    02170 8180      LD	R24,Z
    02171 2799      CLR	R25
    02172 9701      SBIW	R24,1
    02173 013C      MOVW	R6,R24
    02174 2488      CLR	R8
    02175 FC77      SBRC	R7,7
    02176 9480      COM	R8
    02177 2499      CLR	R9
    02178 FC87      SBRC	R8,7
    02179 9490      COM	R9
    0217A 2026      AND	R2,R6
    0217B 2037      AND	R3,R7
    0217C 2048      AND	R4,R8
    0217D 2059      AND	R5,R9
    0217E 8C6A      LDD	R6,Y+26
    0217F 8C7B      LDD	R7,Y+27
    02180 8C8C      LDD	R8,Y+28
    02181 8C9D      LDD	R9,Y+29
    02182 0C62      ADD	R6,R2
    02183 1C73      ADC	R7,R3
    02184 1C84      ADC	R8,R4
    02185 1C95      ADC	R9,R5
    02186 8E6A      STD	Y+26,R6
    02187 8E7B      STD	Y+27,R7
    02188 8E8C      STD	Y+28,R8
    02189 8E9D      STD	Y+29,R9
(2856) 				if (fp->fptr % SS(fp->fs) && dsc != fp->dsect) {	/* Refill sector cache if needed */
    0218A EF4F      LDI	R20,0xFF
    0218B E051      LDI	R21,1
    0218C E060      LDI	R22,0
    0218D E070      LDI	R23,0
    0218E A5E8      LDD	R30,Y+40
    0218F A5F9      LDD	R31,Y+41
    02190 9636      ADIW	R30,6
    02191 8020      LD	R2,Z
    02192 8031      LDD	R3,Z+1
    02193 8042      LDD	R4,Z+2
    02194 8053      LDD	R5,Z+3
    02195 2224      AND	R2,R20
    02196 2235      AND	R3,R21
    02197 2246      AND	R4,R22
    02198 2257      AND	R5,R23
    02199 9488      BCLR	0
    0219A 2022      TST	R2
    0219B 0432      CPC	R3,R2
    0219C 0442      CPC	R4,R2
    0219D 0452      CPC	R5,R2
    0219E F409      BNE	0x21A0
    0219F C2CC      RJMP	0x246C
    021A0 A5E8      LDD	R30,Y+40
    021A1 A5F9      LDD	R31,Y+41
    021A2 9676      ADIW	R30,0x16
    021A3 8020      LD	R2,Z
    021A4 8031      LDD	R3,Z+1
    021A5 8042      LDD	R4,Z+2
    021A6 8053      LDD	R5,Z+3
    021A7 8C6A      LDD	R6,Y+26
    021A8 8C7B      LDD	R7,Y+27
    021A9 8C8C      LDD	R8,Y+28
    021AA 8C9D      LDD	R9,Y+29
    021AB 1462      CP	R6,R2
    021AC 0473      CPC	R7,R3
    021AD 0484      CPC	R8,R4
    021AE 0495      CPC	R9,R5
    021AF F409      BNE	0x21B1
    021B0 C2BB      RJMP	0x246C
(2857) #if !_FS_TINY
(2858) #if !_FS_READONLY
(2859) 					if (fp->flag & FA__DIRTY) {		/* Write-back dirty sector cache */
(2860) 						if (disk_write(fp->fs->drv, fp->buf, fp->dsect, 1) != RES_OK)
(2861) 							ABORT(fp->fs, FR_DISK_ERR);
(2862) 						fp->flag &= ~FA__DIRTY;
(2863) 					}
(2864) #endif
(2865) 					if (disk_read(fp->fs->drv, fp->buf, dsc, 1) != RES_OK)	/* Load current sector */
(2866) 						ABORT(fp->fs, FR_DISK_ERR);
(2867) #endif
(2868) 					fp->dsect = dsc;
    021B1 0113      MOVW	R2,R6
    021B2 0124      MOVW	R4,R8
    021B3 A5E8      LDD	R30,Y+40
    021B4 A5F9      LDD	R31,Y+41
    021B5 8A26      STD	Z+22,R2
    021B6 8A37      STD	Z+23,R3
    021B7 8E40      STD	Z+24,R4
    021B8 8E51      STD	Z+25,R5
(2869) 				}
(2870) 			}
(2871) 		}
(2872) 	} else
    021B9 C2B2      RJMP	0x246C
(2873) #endif
(2874) 
(2875) 	/* Normal Seek */
(2876) 	{
(2877) 		DWORD clst, bcs, nsect, ifptr;
(2878) 
(2879) 		if (ofs > fp->fsize					/* In read-only mode, clip offset with the file size */
    021BA A5E8      LDD	R30,Y+40
    021BB A5F9      LDD	R31,Y+41
    021BC 963A      ADIW	R30,0xA
    021BD 8020      LD	R2,Z
    021BE 8031      LDD	R3,Z+1
    021BF 8042      LDD	R4,Z+2
    021C0 8053      LDD	R5,Z+3
    021C1 A46A      LDD	R6,Y+42
    021C2 A47B      LDD	R7,Y+43
    021C3 A48C      LDD	R8,Y+44
    021C4 A49D      LDD	R9,Y+45
    021C5 1426      CP	R2,R6
    021C6 0437      CPC	R3,R7
    021C7 0448      CPC	R4,R8
    021C8 0459      CPC	R5,R9
    021C9 F470      BCC	0x21D8
    021CA A5E8      LDD	R30,Y+40
    021CB A5F9      LDD	R31,Y+41
    021CC 8024      LDD	R2,Z+4
    021CD FC21      SBRC	R2,1
    021CE C009      RJMP	0x21D8
(2880) #if !_FS_READONLY
(2881) 			 && !(fp->flag & FA_WRITE)
(2882) #endif
(2883) 			) ofs = fp->fsize;
    021CF 963A      ADIW	R30,0xA
    021D0 8020      LD	R2,Z
    021D1 8031      LDD	R3,Z+1
    021D2 8042      LDD	R4,Z+2
    021D3 8053      LDD	R5,Z+3
    021D4 A62A      STD	Y+42,R2
    021D5 A63B      STD	Y+43,R3
    021D6 A64C      STD	Y+44,R4
    021D7 A65D      STD	Y+45,R5
(2884) 
(2885) 		ifptr = fp->fptr;
    021D8 A5E8      LDD	R30,Y+40
    021D9 A5F9      LDD	R31,Y+41
    021DA 9636      ADIW	R30,6
    021DB 8020      LD	R2,Z
    021DC 8031      LDD	R3,Z+1
    021DD 8042      LDD	R4,Z+2
    021DE 8053      LDD	R5,Z+3
    021DF 862E      STD	Y+14,R2
    021E0 863F      STD	Y+15,R3
    021E1 8A48      STD	Y+16,R4
    021E2 8A59      STD	Y+17,R5
(2886) 		fp->fptr = nsect = 0;
    021E3 E080      LDI	R24,0
    021E4 878A      STD	Y+10,R24
    021E5 878B      STD	Y+11,R24
    021E6 878C      STD	Y+12,R24
    021E7 878D      STD	Y+13,R24
    021E8 A5E8      LDD	R30,Y+40
    021E9 A5F9      LDD	R31,Y+41
    021EA 9636      ADIW	R30,6
    021EB E080      LDI	R24,0
    021EC 8380      ST	Z,R24
    021ED 8381      STD	Z+1,R24
    021EE 8382      STD	Z+2,R24
    021EF 8383      STD	Z+3,R24
(2887) 		if (ofs) {
    021F0 A42A      LDD	R2,Y+42
    021F1 A43B      LDD	R3,Y+43
    021F2 A44C      LDD	R4,Y+44
    021F3 A45D      LDD	R5,Y+45
    021F4 9488      BCLR	0
    021F5 2022      TST	R2
    021F6 0432      CPC	R3,R2
    021F7 0442      CPC	R4,R2
    021F8 0452      CPC	R5,R2
    021F9 F409      BNE	0x21FB
    021FA C226      RJMP	0x2421
(2888) 			bcs = (DWORD)fp->fs->csize * SS(fp->fs);	/* Cluster size (byte) */
    021FB A5E8      LDD	R30,Y+40
    021FC A5F9      LDD	R31,Y+41
    021FD 93AF      PUSH	R26
    021FE 93BF      PUSH	R27
    021FF 81A0      LD	R26,Z
    02200 81B1      LDD	R27,Z+1
    02201 01FD      MOVW	R30,R26
    02202 91BF      POP	R27
    02203 91AF      POP	R26
    02204 9632      ADIW	R30,2
    02205 8020      LD	R2,Z
    02206 2433      CLR	R3
    02207 2444      CLR	R4
    02208 2455      CLR	R5
    02209 E040      LDI	R20,0
    0220A E052      LDI	R21,2
    0220B E060      LDI	R22,0
    0220C E070      LDI	R23,0
    0220D 925A      ST	-Y,R5
    0220E 924A      ST	-Y,R4
    0220F 923A      ST	-Y,R3
    02210 922A      ST	-Y,R2
    02211 018A      MOVW	R16,R20
    02212 019B      MOVW	R18,R22
    02213 940E 486F CALL	empy32u|empy32s
    02215 830E      STD	Y+6,R16
    02216 831F      STD	Y+7,R17
    02217 8728      STD	Y+8,R18
    02218 8739      STD	Y+9,R19
(2889) 			if (ifptr > 0 &&
    02219 842E      LDD	R2,Y+14
    0221A 843F      LDD	R3,Y+15
    0221B 8848      LDD	R4,Y+16
    0221C 8859      LDD	R5,Y+17
    0221D 9488      BCLR	0
    0221E 2022      TST	R2
    0221F 0432      CPC	R3,R2
    02220 0442      CPC	R4,R2
    02221 0452      CPC	R5,R2
    02222 F409      BNE	0x2224
    02223 C075      RJMP	0x2299
    02224 E041      LDI	R20,1
    02225 E050      LDI	R21,0
    02226 E060      LDI	R22,0
    02227 E070      LDI	R23,0
    02228 0181      MOVW	R16,R2
    02229 0192      MOVW	R18,R4
    0222A 1B04      SUB	R16,R20
    0222B 0B15      SBC	R17,R21
    0222C 0B26      SBC	R18,R22
    0222D 0B37      SBC	R19,R23
    0222E 802E      LDD	R2,Y+6
    0222F 803F      LDD	R3,Y+7
    02230 8448      LDD	R4,Y+8
    02231 8459      LDD	R5,Y+9
    02232 925A      ST	-Y,R5
    02233 924A      ST	-Y,R4
    02234 923A      ST	-Y,R3
    02235 922A      ST	-Y,R2
    02236 940E 47C9 CALL	div32u
    02238 0118      MOVW	R2,R16
    02239 0129      MOVW	R4,R18
    0223A E041      LDI	R20,1
    0223B E050      LDI	R21,0
    0223C E060      LDI	R22,0
    0223D E070      LDI	R23,0
    0223E A50A      LDD	R16,Y+42
    0223F A51B      LDD	R17,Y+43
    02240 A52C      LDD	R18,Y+44
    02241 A53D      LDD	R19,Y+45
    02242 1B04      SUB	R16,R20
    02243 0B15      SBC	R17,R21
    02244 0B26      SBC	R18,R22
    02245 0B37      SBC	R19,R23
    02246 806E      LDD	R6,Y+6
    02247 807F      LDD	R7,Y+7
    02248 8488      LDD	R8,Y+8
    02249 8499      LDD	R9,Y+9
    0224A 929A      ST	-Y,R9
    0224B 928A      ST	-Y,R8
    0224C 927A      ST	-Y,R7
    0224D 926A      ST	-Y,R6
    0224E 940E 47C9 CALL	div32u
    02250 1502      CP	R16,R2
    02251 0513      CPC	R17,R3
    02252 0524      CPC	R18,R4
    02253 0535      CPC	R19,R5
    02254 F408      BCC	0x2256
    02255 C043      RJMP	0x2299
(2890) 				(ofs - 1) / bcs >= (ifptr - 1) / bcs) {	/* When seek to same or following cluster, */
(2891) 				fp->fptr = (ifptr - 1) & ~(bcs - 1);	/* start from the current cluster */
    02256 E041      LDI	R20,1
    02257 E050      LDI	R21,0
    02258 E060      LDI	R22,0
    02259 E070      LDI	R23,0
    0225A 802E      LDD	R2,Y+6
    0225B 803F      LDD	R3,Y+7
    0225C 8448      LDD	R4,Y+8
    0225D 8459      LDD	R5,Y+9
    0225E 1A24      SUB	R2,R20
    0225F 0A35      SBC	R3,R21
    02260 0A46      SBC	R4,R22
    02261 0A57      SBC	R5,R23
    02262 9420      COM	R2
    02263 9430      COM	R3
    02264 9440      COM	R4
    02265 9450      COM	R5
    02266 E041      LDI	R20,1
    02267 E050      LDI	R21,0
    02268 E060      LDI	R22,0
    02269 E070      LDI	R23,0
    0226A 846E      LDD	R6,Y+14
    0226B 847F      LDD	R7,Y+15
    0226C 8888      LDD	R8,Y+16
    0226D 8899      LDD	R9,Y+17
    0226E 1A64      SUB	R6,R20
    0226F 0A75      SBC	R7,R21
    02270 0A86      SBC	R8,R22
    02271 0A97      SBC	R9,R23
    02272 2062      AND	R6,R2
    02273 2073      AND	R7,R3
    02274 2084      AND	R8,R4
    02275 2095      AND	R9,R5
    02276 A5E8      LDD	R30,Y+40
    02277 A5F9      LDD	R31,Y+41
    02278 8266      STD	Z+6,R6
    02279 8277      STD	Z+7,R7
    0227A 8680      STD	Z+8,R8
    0227B 8691      STD	Z+9,R9
(2892) 				ofs -= fp->fptr;
    0227C 9636      ADIW	R30,6
    0227D 8020      LD	R2,Z
    0227E 8031      LDD	R3,Z+1
    0227F 8042      LDD	R4,Z+2
    02280 8053      LDD	R5,Z+3
    02281 A46A      LDD	R6,Y+42
    02282 A47B      LDD	R7,Y+43
    02283 A48C      LDD	R8,Y+44
    02284 A49D      LDD	R9,Y+45
    02285 1862      SUB	R6,R2
    02286 0873      SBC	R7,R3
    02287 0884      SBC	R8,R4
    02288 0895      SBC	R9,R5
    02289 A66A      STD	Y+42,R6
    0228A A67B      STD	Y+43,R7
    0228B A68C      STD	Y+44,R8
    0228C A69D      STD	Y+45,R9
(2893) 				clst = fp->clust;
    0228D A5E8      LDD	R30,Y+40
    0228E A5F9      LDD	R31,Y+41
    0228F 9672      ADIW	R30,0x12
    02290 8020      LD	R2,Z
    02291 8031      LDD	R3,Z+1
    02292 8042      LDD	R4,Z+2
    02293 8053      LDD	R5,Z+3
    02294 822A      STD	Y+2,R2
    02295 823B      STD	Y+3,R3
    02296 824C      STD	Y+4,R4
    02297 825D      STD	Y+5,R5
(2894) 			} else {									/* When seek to back cluster, */
    02298 C069      RJMP	0x2302
(2895) 				clst = fp->sclust;						/* start from the first cluster */
    02299 A5E8      LDD	R30,Y+40
    0229A A5F9      LDD	R31,Y+41
    0229B 963E      ADIW	R30,0xE
    0229C 8020      LD	R2,Z
    0229D 8031      LDD	R3,Z+1
    0229E 8042      LDD	R4,Z+2
    0229F 8053      LDD	R5,Z+3
    022A0 822A      STD	Y+2,R2
    022A1 823B      STD	Y+3,R3
    022A2 824C      STD	Y+4,R4
    022A3 825D      STD	Y+5,R5
(2896) #if !_FS_READONLY
(2897) 				if (clst == 0) {						/* If no cluster chain, create a new chain */
    022A4 802A      LDD	R2,Y+2
    022A5 803B      LDD	R3,Y+3
    022A6 804C      LDD	R4,Y+4
    022A7 805D      LDD	R5,Y+5
    022A8 9488      BCLR	0
    022A9 2022      TST	R2
    022AA 0432      CPC	R3,R2
    022AB 0442      CPC	R4,R2
    022AC 0452      CPC	R5,R2
    022AD F009      BEQ	0x22AF
    022AE C049      RJMP	0x22F8
(2898) 					clst = create_chain(fp->fs, 0);
    022AF E040      LDI	R20,0
    022B0 E050      LDI	R21,0
    022B1 E060      LDI	R22,0
    022B2 E070      LDI	R23,0
    022B3 8368      ST	Y,R22
    022B4 8379      STD	Y+1,R23
    022B5 019A      MOVW	R18,R20
    022B6 A5E8      LDD	R30,Y+40
    022B7 A5F9      LDD	R31,Y+41
    022B8 8100      LD	R16,Z
    022B9 8111      LDD	R17,Z+1
    022BA 940E 09FF CALL	ff.c:create_chain
    022BC 830A      STD	Y+2,R16
    022BD 831B      STD	Y+3,R17
    022BE 832C      STD	Y+4,R18
    022BF 833D      STD	Y+5,R19
(2899) 					if (clst == 1) ABORT(fp->fs, FR_INT_ERR);
    022C0 E041      LDI	R20,1
    022C1 E050      LDI	R21,0
    022C2 E060      LDI	R22,0
    022C3 E070      LDI	R23,0
    022C4 802A      LDD	R2,Y+2
    022C5 803B      LDD	R3,Y+3
    022C6 804C      LDD	R4,Y+4
    022C7 805D      LDD	R5,Y+5
    022C8 1624      CP	R2,R20
    022C9 0635      CPC	R3,R21
    022CA 0646      CPC	R4,R22
    022CB 0657      CPC	R5,R23
    022CC F451      BNE	0x22D7
    022CD A588      LDD	R24,Y+40
    022CE A599      LDD	R25,Y+41
    022CF 9604      ADIW	R24,4
    022D0 017C      MOVW	R14,R24
    022D1 01FC      MOVW	R30,R24
    022D2 8180      LD	R24,Z
    022D3 6880      ORI	R24,0x80
    022D4 8380      ST	Z,R24
    022D5 E002      LDI	R16,2
    022D6 C196      RJMP	0x246D
(2900) 					if (clst == 0xFFFFFFFF) ABORT(fp->fs, FR_DISK_ERR);
    022D7 EF4F      LDI	R20,0xFF
    022D8 EF5F      LDI	R21,0xFF
    022D9 EF6F      LDI	R22,0xFF
    022DA EF7F      LDI	R23,0xFF
    022DB 802A      LDD	R2,Y+2
    022DC 803B      LDD	R3,Y+3
    022DD 804C      LDD	R4,Y+4
    022DE 805D      LDD	R5,Y+5
    022DF 1624      CP	R2,R20
    022E0 0635      CPC	R3,R21
    022E1 0646      CPC	R4,R22
    022E2 0657      CPC	R5,R23
    022E3 F451      BNE	0x22EE
    022E4 A588      LDD	R24,Y+40
    022E5 A599      LDD	R25,Y+41
    022E6 9604      ADIW	R24,4
    022E7 017C      MOVW	R14,R24
    022E8 01FC      MOVW	R30,R24
    022E9 8180      LD	R24,Z
    022EA 6880      ORI	R24,0x80
    022EB 8380      ST	Z,R24
    022EC E001      LDI	R16,1
    022ED C17F      RJMP	0x246D
(2901) 					fp->sclust = clst;
    022EE 802A      LDD	R2,Y+2
    022EF 803B      LDD	R3,Y+3
    022F0 804C      LDD	R4,Y+4
    022F1 805D      LDD	R5,Y+5
    022F2 A5E8      LDD	R30,Y+40
    022F3 A5F9      LDD	R31,Y+41
    022F4 8626      STD	Z+14,R2
    022F5 8637      STD	Z+15,R3
    022F6 8A40      STD	Z+16,R4
    022F7 8A51      STD	Z+17,R5
(2902) 				}
(2903) #endif
(2904) 				fp->clust = clst;
    022F8 802A      LDD	R2,Y+2
    022F9 803B      LDD	R3,Y+3
    022FA 804C      LDD	R4,Y+4
    022FB 805D      LDD	R5,Y+5
    022FC A5E8      LDD	R30,Y+40
    022FD A5F9      LDD	R31,Y+41
    022FE 8A22      STD	Z+18,R2
    022FF 8A33      STD	Z+19,R3
    02300 8A44      STD	Z+20,R4
    02301 8A55      STD	Z+21,R5
(2905) 			}
(2906) 			if (clst != 0) {
    02302 802A      LDD	R2,Y+2
    02303 803B      LDD	R3,Y+3
    02304 804C      LDD	R4,Y+4
    02305 805D      LDD	R5,Y+5
    02306 9488      BCLR	0
    02307 2022      TST	R2
    02308 0432      CPC	R3,R2
    02309 0442      CPC	R4,R2
    0230A 0452      CPC	R5,R2
    0230B F409      BNE	0x230D
    0230C C114      RJMP	0x2421
    0230D C0A7      RJMP	0x23B5
(2907) 				while (ofs > bcs) {						/* Cluster following loop */
(2908) #if !_FS_READONLY
(2909) 					if (fp->flag & FA_WRITE) {			/* Check if in write mode or not */
    0230E A5E8      LDD	R30,Y+40
    0230F A5F9      LDD	R31,Y+41
    02310 9634      ADIW	R30,4
    02311 8020      LD	R2,Z
    02312 FE21      SBRS	R2,1
    02313 C024      RJMP	0x2338
(2910) 						clst = create_chain(fp->fs, clst);	/* Force stretch if in write mode */
    02314 802A      LDD	R2,Y+2
    02315 803B      LDD	R3,Y+3
    02316 804C      LDD	R4,Y+4
    02317 805D      LDD	R5,Y+5
    02318 8248      ST	Y,R4
    02319 8259      STD	Y+1,R5
    0231A 0191      MOVW	R18,R2
    0231B A5E8      LDD	R30,Y+40
    0231C A5F9      LDD	R31,Y+41
    0231D 8100      LD	R16,Z
    0231E 8111      LDD	R17,Z+1
    0231F 940E 09FF CALL	ff.c:create_chain
    02321 830A      STD	Y+2,R16
    02322 831B      STD	Y+3,R17
    02323 832C      STD	Y+4,R18
    02324 833D      STD	Y+5,R19
(2911) 						if (clst == 0) {				/* When disk gets full, clip file size */
    02325 802A      LDD	R2,Y+2
    02326 803B      LDD	R3,Y+3
    02327 804C      LDD	R4,Y+4
    02328 805D      LDD	R5,Y+5
    02329 9488      BCLR	0
    0232A 2022      TST	R2
    0232B 0432      CPC	R3,R2
    0232C 0442      CPC	R4,R2
    0232D 0452      CPC	R5,R2
    0232E F4D1      BNE	0x2349
(2912) 							ofs = bcs; break;
    0232F 802E      LDD	R2,Y+6
    02330 803F      LDD	R3,Y+7
    02331 8448      LDD	R4,Y+8
    02332 8459      LDD	R5,Y+9
    02333 A62A      STD	Y+42,R2
    02334 A63B      STD	Y+43,R3
    02335 A64C      STD	Y+44,R4
    02336 A65D      STD	Y+45,R5
    02337 C08B      RJMP	0x23C3
(2913) 						}
(2914) 					} else
(2915) #endif
(2916) 						clst = get_fat(fp->fs, clst);	/* Follow cluster chain if not in write mode */
    02338 802A      LDD	R2,Y+2
    02339 803B      LDD	R3,Y+3
    0233A 804C      LDD	R4,Y+4
    0233B 805D      LDD	R5,Y+5
    0233C 8248      ST	Y,R4
    0233D 8259      STD	Y+1,R5
    0233E 0191      MOVW	R18,R2
    0233F A5E8      LDD	R30,Y+40
    02340 A5F9      LDD	R31,Y+41
    02341 8100      LD	R16,Z
    02342 8111      LDD	R17,Z+1
    02343 940E 063D CALL	_get_fat
    02345 830A      STD	Y+2,R16
    02346 831B      STD	Y+3,R17
    02347 832C      STD	Y+4,R18
    02348 833D      STD	Y+5,R19
(2917) 					if (clst == 0xFFFFFFFF) ABORT(fp->fs, FR_DISK_ERR);
    02349 EF4F      LDI	R20,0xFF
    0234A EF5F      LDI	R21,0xFF
    0234B EF6F      LDI	R22,0xFF
    0234C EF7F      LDI	R23,0xFF
    0234D 802A      LDD	R2,Y+2
    0234E 803B      LDD	R3,Y+3
    0234F 804C      LDD	R4,Y+4
    02350 805D      LDD	R5,Y+5
    02351 1624      CP	R2,R20
    02352 0635      CPC	R3,R21
    02353 0646      CPC	R4,R22
    02354 0657      CPC	R5,R23
    02355 F451      BNE	0x2360
    02356 A588      LDD	R24,Y+40
    02357 A599      LDD	R25,Y+41
    02358 9604      ADIW	R24,4
    02359 017C      MOVW	R14,R24
    0235A 01FC      MOVW	R30,R24
    0235B 8180      LD	R24,Z
    0235C 6880      ORI	R24,0x80
    0235D 8380      ST	Z,R24
    0235E E001      LDI	R16,1
    0235F C10D      RJMP	0x246D
(2918) 					if (clst <= 1 || clst >= fp->fs->n_fatent) ABORT(fp->fs, FR_INT_ERR);
    02360 E041      LDI	R20,1
    02361 E050      LDI	R21,0
    02362 E060      LDI	R22,0
    02363 E070      LDI	R23,0
    02364 802A      LDD	R2,Y+2
    02365 803B      LDD	R3,Y+3
    02366 804C      LDD	R4,Y+4
    02367 805D      LDD	R5,Y+5
    02368 1542      CP	R20,R2
    02369 0553      CPC	R21,R3
    0236A 0564      CPC	R22,R4
    0236B 0575      CPC	R23,R5
    0236C F490      BCC	0x237F
    0236D A5E8      LDD	R30,Y+40
    0236E A5F9      LDD	R31,Y+41
    0236F 81A0      LD	R26,Z
    02370 81B1      LDD	R27,Z+1
    02371 9656      ADIW	R26,0x16
    02372 902D      LD	R2,X+
    02373 903D      LD	R3,X+
    02374 904D      LD	R4,X+
    02375 905C      LD	R5,X
    02376 806A      LDD	R6,Y+2
    02377 807B      LDD	R7,Y+3
    02378 808C      LDD	R8,Y+4
    02379 809D      LDD	R9,Y+5
    0237A 1462      CP	R6,R2
    0237B 0473      CPC	R7,R3
    0237C 0484      CPC	R8,R4
    0237D 0495      CPC	R9,R5
    0237E F050      BCS	0x2389
    0237F A588      LDD	R24,Y+40
    02380 A599      LDD	R25,Y+41
    02381 9604      ADIW	R24,4
    02382 017C      MOVW	R14,R24
    02383 01FC      MOVW	R30,R24
    02384 8180      LD	R24,Z
    02385 6880      ORI	R24,0x80
    02386 8380      ST	Z,R24
    02387 E002      LDI	R16,2
    02388 C0E4      RJMP	0x246D
(2919) 					fp->clust = clst;
    02389 802A      LDD	R2,Y+2
    0238A 803B      LDD	R3,Y+3
    0238B 804C      LDD	R4,Y+4
    0238C 805D      LDD	R5,Y+5
    0238D A5E8      LDD	R30,Y+40
    0238E A5F9      LDD	R31,Y+41
    0238F 9672      ADIW	R30,0x12
    02390 8220      ST	Z,R2
    02391 8231      STD	Z+1,R3
    02392 8242      STD	Z+2,R4
    02393 8253      STD	Z+3,R5
(2920) 					fp->fptr += bcs;
    02394 A588      LDD	R24,Y+40
    02395 A599      LDD	R25,Y+41
    02396 9606      ADIW	R24,6
    02397 017C      MOVW	R14,R24
    02398 802E      LDD	R2,Y+6
    02399 803F      LDD	R3,Y+7
    0239A 8448      LDD	R4,Y+8
    0239B 8459      LDD	R5,Y+9
    0239C 01FC      MOVW	R30,R24
    0239D 8060      LD	R6,Z
    0239E 8071      LDD	R7,Z+1
    0239F 8082      LDD	R8,Z+2
    023A0 8093      LDD	R9,Z+3
    023A1 0C62      ADD	R6,R2
    023A2 1C73      ADC	R7,R3
    023A3 1C84      ADC	R8,R4
    023A4 1C95      ADC	R9,R5
    023A5 8260      ST	Z,R6
    023A6 8271      STD	Z+1,R7
    023A7 8282      STD	Z+2,R8
    023A8 8293      STD	Z+3,R9
(2921) 					ofs -= bcs;
    023A9 A46A      LDD	R6,Y+42
    023AA A47B      LDD	R7,Y+43
    023AB A48C      LDD	R8,Y+44
    023AC A49D      LDD	R9,Y+45
    023AD 1862      SUB	R6,R2
    023AE 0873      SBC	R7,R3
    023AF 0884      SBC	R8,R4
    023B0 0895      SBC	R9,R5
    023B1 A66A      STD	Y+42,R6
    023B2 A67B      STD	Y+43,R7
    023B3 A68C      STD	Y+44,R8
    023B4 A69D      STD	Y+45,R9
    023B5 802E      LDD	R2,Y+6
    023B6 803F      LDD	R3,Y+7
    023B7 8448      LDD	R4,Y+8
    023B8 8459      LDD	R5,Y+9
    023B9 A46A      LDD	R6,Y+42
    023BA A47B      LDD	R7,Y+43
    023BB A48C      LDD	R8,Y+44
    023BC A49D      LDD	R9,Y+45
    023BD 1426      CP	R2,R6
    023BE 0437      CPC	R3,R7
    023BF 0448      CPC	R4,R8
    023C0 0459      CPC	R5,R9
    023C1 F408      BCC	0x23C3
    023C2 CF4B      RJMP	0x230E
(2922) 				}
(2923) 				fp->fptr += ofs;
    023C3 A588      LDD	R24,Y+40
    023C4 A599      LDD	R25,Y+41
    023C5 9606      ADIW	R24,6
    023C6 017C      MOVW	R14,R24
    023C7 A42A      LDD	R2,Y+42
    023C8 A43B      LDD	R3,Y+43
    023C9 A44C      LDD	R4,Y+44
    023CA A45D      LDD	R5,Y+45
    023CB 01FC      MOVW	R30,R24
    023CC 8060      LD	R6,Z
    023CD 8071      LDD	R7,Z+1
    023CE 8082      LDD	R8,Z+2
    023CF 8093      LDD	R9,Z+3
    023D0 0C62      ADD	R6,R2
    023D1 1C73      ADC	R7,R3
    023D2 1C84      ADC	R8,R4
    023D3 1C95      ADC	R9,R5
    023D4 8260      ST	Z,R6
    023D5 8271      STD	Z+1,R7
    023D6 8282      STD	Z+2,R8
    023D7 8293      STD	Z+3,R9
(2924) 				if (ofs % SS(fp->fs)) {
    023D8 EF4F      LDI	R20,0xFF
    023D9 E051      LDI	R21,1
    023DA E060      LDI	R22,0
    023DB E070      LDI	R23,0
    023DC 2224      AND	R2,R20
    023DD 2235      AND	R3,R21
    023DE 2246      AND	R4,R22
    023DF 2257      AND	R5,R23
    023E0 9488      BCLR	0
    023E1 2022      TST	R2
    023E2 0432      CPC	R3,R2
    023E3 0442      CPC	R4,R2
    023E4 0452      CPC	R5,R2
    023E5 F409      BNE	0x23E7
    023E6 C03A      RJMP	0x2421
(2925) 					nsect = clust2sect(fp->fs, clst);	/* Current sector */
    023E7 802A      LDD	R2,Y+2
    023E8 803B      LDD	R3,Y+3
    023E9 804C      LDD	R4,Y+4
    023EA 805D      LDD	R5,Y+5
    023EB 8248      ST	Y,R4
    023EC 8259      STD	Y+1,R5
    023ED 0191      MOVW	R18,R2
    023EE A5E8      LDD	R30,Y+40
    023EF A5F9      LDD	R31,Y+41
    023F0 8100      LD	R16,Z
    023F1 8111      LDD	R17,Z+1
    023F2 940E 05EB CALL	_clust2sect
    023F4 870A      STD	Y+10,R16
    023F5 871B      STD	Y+11,R17
    023F6 872C      STD	Y+12,R18
    023F7 873D      STD	Y+13,R19
(2926) 					if (!nsect) ABORT(fp->fs, FR_INT_ERR);
    023F8 842A      LDD	R2,Y+10
    023F9 843B      LDD	R3,Y+11
    023FA 844C      LDD	R4,Y+12
    023FB 845D      LDD	R5,Y+13
    023FC 9488      BCLR	0
    023FD 2022      TST	R2
    023FE 0432      CPC	R3,R2
    023FF 0442      CPC	R4,R2
    02400 0452      CPC	R5,R2
    02401 F451      BNE	0x240C
    02402 A588      LDD	R24,Y+40
    02403 A599      LDD	R25,Y+41
    02404 9604      ADIW	R24,4
    02405 017C      MOVW	R14,R24
    02406 01FC      MOVW	R30,R24
    02407 8180      LD	R24,Z
    02408 6880      ORI	R24,0x80
    02409 8380      ST	Z,R24
    0240A E002      LDI	R16,2
    0240B C061      RJMP	0x246D
(2927) 					nsect += ofs / SS(fp->fs);
    0240C E089      LDI	R24,0x9
    0240D E090      LDI	R25,0
    0240E A50A      LDD	R16,Y+42
    0240F A51B      LDD	R17,Y+43
    02410 A52C      LDD	R18,Y+44
    02411 A53D      LDD	R19,Y+45
    02412 938A      ST	-Y,R24
    02413 940E 4967 CALL	lsr32
    02415 842A      LDD	R2,Y+10
    02416 843B      LDD	R3,Y+11
    02417 844C      LDD	R4,Y+12
    02418 845D      LDD	R5,Y+13
    02419 0E20      ADD	R2,R16
    0241A 1E31      ADC	R3,R17
    0241B 1E42      ADC	R4,R18
    0241C 1E53      ADC	R5,R19
    0241D 862A      STD	Y+10,R2
    0241E 863B      STD	Y+11,R3
    0241F 864C      STD	Y+12,R4
    02420 865D      STD	Y+13,R5
(2928) 				}
(2929) 			}
(2930) 		}
(2931) 		if (fp->fptr % SS(fp->fs) && nsect != fp->dsect) {	/* Fill sector cache if needed */
    02421 EF4F      LDI	R20,0xFF
    02422 E051      LDI	R21,1
    02423 E060      LDI	R22,0
    02424 E070      LDI	R23,0
    02425 A5E8      LDD	R30,Y+40
    02426 A5F9      LDD	R31,Y+41
    02427 9636      ADIW	R30,6
    02428 8020      LD	R2,Z
    02429 8031      LDD	R3,Z+1
    0242A 8042      LDD	R4,Z+2
    0242B 8053      LDD	R5,Z+3
    0242C 2224      AND	R2,R20
    0242D 2235      AND	R3,R21
    0242E 2246      AND	R4,R22
    0242F 2257      AND	R5,R23
    02430 9488      BCLR	0
    02431 2022      TST	R2
    02432 0432      CPC	R3,R2
    02433 0442      CPC	R4,R2
    02434 0452      CPC	R5,R2
    02435 F0C1      BEQ	0x244E
    02436 A5E8      LDD	R30,Y+40
    02437 A5F9      LDD	R31,Y+41
    02438 9676      ADIW	R30,0x16
    02439 8020      LD	R2,Z
    0243A 8031      LDD	R3,Z+1
    0243B 8042      LDD	R4,Z+2
    0243C 8053      LDD	R5,Z+3
    0243D 846A      LDD	R6,Y+10
    0243E 847B      LDD	R7,Y+11
    0243F 848C      LDD	R8,Y+12
    02440 849D      LDD	R9,Y+13
    02441 1462      CP	R6,R2
    02442 0473      CPC	R7,R3
    02443 0484      CPC	R8,R4
    02444 0495      CPC	R9,R5
    02445 F041      BEQ	0x244E
(2932) #if !_FS_TINY
(2933) #if !_FS_READONLY
(2934) 			if (fp->flag & FA__DIRTY) {			/* Write-back dirty sector cache */
(2935) 				if (disk_write(fp->fs->drv, fp->buf, fp->dsect, 1) != RES_OK)
(2936) 					ABORT(fp->fs, FR_DISK_ERR);
(2937) 				fp->flag &= ~FA__DIRTY;
(2938) 			}
(2939) #endif
(2940) 			if (disk_read(fp->fs->drv, fp->buf, nsect, 1) != RES_OK)	/* Fill sector cache */
(2941) 				ABORT(fp->fs, FR_DISK_ERR);
(2942) #endif
(2943) 			fp->dsect = nsect;
    02446 0113      MOVW	R2,R6
    02447 0124      MOVW	R4,R8
    02448 A5E8      LDD	R30,Y+40
    02449 A5F9      LDD	R31,Y+41
    0244A 8A26      STD	Z+22,R2
    0244B 8A37      STD	Z+23,R3
    0244C 8E40      STD	Z+24,R4
    0244D 8E51      STD	Z+25,R5
(2944) 		}
(2945) #if !_FS_READONLY
(2946) 		if (fp->fptr > fp->fsize) {			/* Set file change flag if the file size is extended */
    0244E A5E8      LDD	R30,Y+40
    0244F A5F9      LDD	R31,Y+41
    02450 8422      LDD	R2,Z+10
    02451 8433      LDD	R3,Z+11
    02452 8444      LDD	R4,Z+12
    02453 8455      LDD	R5,Z+13
    02454 8066      LDD	R6,Z+6
    02455 8077      LDD	R7,Z+7
    02456 8480      LDD	R8,Z+8
    02457 8491      LDD	R9,Z+9
    02458 1426      CP	R2,R6
    02459 0437      CPC	R3,R7
    0245A 0448      CPC	R4,R8
    0245B 0459      CPC	R5,R9
    0245C F478      BCC	0x246C
(2947) 			fp->fsize = fp->fptr;
    0245D 8026      LDD	R2,Z+6
    0245E 8037      LDD	R3,Z+7
    0245F 8440      LDD	R4,Z+8
    02460 8451      LDD	R5,Z+9
    02461 8622      STD	Z+10,R2
    02462 8633      STD	Z+11,R3
    02463 8644      STD	Z+12,R4
    02464 8655      STD	Z+13,R5
(2948) 			fp->flag |= FA__WRITTEN;
    02465 01CF      MOVW	R24,R30
    02466 9604      ADIW	R24,4
    02467 016C      MOVW	R12,R24
    02468 01FC      MOVW	R30,R24
    02469 8180      LD	R24,Z
    0246A 6280      ORI	R24,0x20
    0246B 8380      ST	Z,R24
(2949) 		}
(2950) #endif
(2951) 	}
(2952) 
(2953) 	LEAVE_FF(fp->fs, res);
    0246C 2D0A      MOV	R16,R10
    0246D 966E      ADIW	R28,0x1E
    0246E 940E 48B8 CALL	pop_xgsetF0FC
    02470 9624      ADIW	R28,4
    02471 9508      RET
_f_opendir:
  sfn                  --> Y,+1
  res                  --> R20
  path                 --> Y,+19
  dj                   --> R22
    02472 933A      ST	-Y,R19
    02473 932A      ST	-Y,R18
    02474 940E 48E2 CALL	push_xgsetF00C
    02476 01B8      MOVW	R22,R16
    02477 972D      SBIW	R28,0xD
(2954) }
(2955) 
(2956) 
(2957) 
(2958) #if _FS_MINIMIZE <= 1
(2959) /*-----------------------------------------------------------------------*/
(2960) /* Create a Directroy Object                                             */
(2961) /*-----------------------------------------------------------------------*/
(2962) 
(2963) FRESULT f_opendir (
(2964) 	DIR *dj,			/* Pointer to directory object to create */
(2965) 	const TCHAR *path	/* Pointer to the directory path */
(2966) )
(2967) {
(2968) 	FRESULT res;
(2969) 	DEF_NAMEBUF;
(2970) 
(2971) 
(2972) 	res = chk_mounted(&path, &dj->fs, 0);
    02478 2422      CLR	R2
    02479 8228      ST	Y,R2
    0247A 019B      MOVW	R18,R22
    0247B 018E      MOVW	R16,R28
    0247C 5E0D      SUBI	R16,0xED
    0247D 4F1F      SBCI	R17,0xFF
    0247E 940E 1292 CALL	ff.c:chk_mounted
    02480 2F40      MOV	R20,R16
(2973) 	if (res == FR_OK) {
    02481 2300      TST	R16
    02482 F009      BEQ	0x2484
    02483 C05C      RJMP	0x24E0
(2974) 		INIT_BUF(*dj);
    02484 01CE      MOVW	R24,R28
    02485 9601      ADIW	R24,1
    02486 01FB      MOVW	R30,R22
    02487 8B95      STD	Z+21,R25
    02488 8B84      STD	Z+20,R24
(2975) 		res = follow_path(dj, path);			/* Follow the path to the directory */
    02489 892B      LDD	R18,Y+19
    0248A 893C      LDD	R19,Y+20
    0248B 018F      MOVW	R16,R30
    0248C 940E 1146 CALL	ff.c:follow_path
    0248E 2F40      MOV	R20,R16
(2976) 		FREE_BUF();
(2977) 		if (res == FR_OK) {						/* Follow completed */
    0248F 2300      TST	R16
    02490 F009      BEQ	0x2492
    02491 C04B      RJMP	0x24DD
(2978) 			if (dj->dir) {						/* It is not the root dir */
    02492 01FB      MOVW	R30,R22
    02493 8822      LDD	R2,Z+18
    02494 8833      LDD	R3,Z+19
    02495 2022      TST	R2
    02496 F419      BNE	0x249A
    02497 2033      TST	R3
    02498 F409      BNE	0x249A
    02499 C032      RJMP	0x24CC
(2979) 				if (dj->dir[DIR_Attr] & AM_DIR) {	/* The object is a directory */
    0249A 93AF      PUSH	R26
    0249B 93BF      PUSH	R27
    0249C 89A2      LDD	R26,Z+18
    0249D 89B3      LDD	R27,Z+19
    0249E 01FD      MOVW	R30,R26
    0249F 91BF      POP	R27
    024A0 91AF      POP	R26
    024A1 8423      LDD	R2,Z+11
    024A2 FE24      SBRS	R2,4
    024A3 C027      RJMP	0x24CB
(2980) 					dj->sclust = LD_CLUST(dj->dir);
    024A4 01FB      MOVW	R30,R22
    024A5 88A2      LDD	R10,Z+18
    024A6 88B3      LDD	R11,Z+19
    024A7 01F5      MOVW	R30,R10
    024A8 8C22      LDD	R2,Z+26
    024A9 2433      CLR	R3
    024AA 8C43      LDD	R4,Z+27
    024AB 2455      CLR	R5
    024AC 2C54      MOV	R5,R4
    024AD 2444      CLR	R4
    024AE 2842      OR	R4,R2
    024AF 2853      OR	R5,R3
    024B0 0112      MOVW	R2,R4
    024B1 2444      CLR	R4
    024B2 2455      CLR	R5
    024B3 8864      LDD	R6,Z+20
    024B4 2477      CLR	R7
    024B5 8885      LDD	R8,Z+21
    024B6 2499      CLR	R9
    024B7 2C98      MOV	R9,R8
    024B8 2488      CLR	R8
    024B9 2886      OR	R8,R6
    024BA 2897      OR	R9,R7
    024BB 0134      MOVW	R6,R8
    024BC 2488      CLR	R8
    024BD 2499      CLR	R9
    024BE 0143      MOVW	R8,R6
    024BF 2466      CLR	R6
    024C0 2477      CLR	R7
    024C1 2862      OR	R6,R2
    024C2 2873      OR	R7,R3
    024C3 2884      OR	R8,R4
    024C4 2895      OR	R9,R5
    024C5 01FB      MOVW	R30,R22
    024C6 8266      STD	Z+6,R6
    024C7 8277      STD	Z+7,R7
    024C8 8680      STD	Z+8,R8
    024C9 8691      STD	Z+9,R9
(2981) 				} else {						/* The object is not a directory */
    024CA C001      RJMP	0x24CC
(2982) 					res = FR_NO_PATH;
    024CB E045      LDI	R20,5
(2983) 				}
(2984) 			}
(2985) 			if (res == FR_OK) {
    024CC 2344      TST	R20
    024CD F479      BNE	0x24DD
(2986) 				dj->id = dj->fs->id;
    024CE 01FB      MOVW	R30,R22
    024CF 81A0      LD	R26,Z
    024D0 81B1      LDD	R27,Z+1
    024D1 9616      ADIW	R26,6
    024D2 902D      LD	R2,X+
    024D3 903C      LD	R3,X
    024D4 8233      STD	Z+3,R3
    024D5 8222      STD	Z+2,R2
(2987) 				res = dir_sdi(dj, 0);			/* Rewind dir */
    024D6 2722      CLR	R18
    024D7 2733      CLR	R19
    024D8 018F      MOVW	R16,R30
    024D9 940E 0BF0 CALL	ff.c:dir_sdi
    024DB 2EA0      MOV	R10,R16
    024DC 2D4A      MOV	R20,R10
(2988) 			}
(2989) 		}
(2990) 		if (res == FR_NO_FILE) res = FR_NO_PATH;
    024DD 3044      CPI	R20,4
    024DE F409      BNE	0x24E0
    024DF E045      LDI	R20,5
(2991) 	}
(2992) 
(2993) 	LEAVE_FF(dj->fs, res);
    024E0 2F04      MOV	R16,R20
    024E1 962D      ADIW	R28,0xD
    024E2 940E 48E9 CALL	pop_xgsetF00C
    024E4 9622      ADIW	R28,2
    024E5 9508      RET
_f_readdir:
  sfn                  --> Y,+0
  res                  --> R20
  fno                  --> R10
  dj                   --> R22
    024E6 940E 48FE CALL	push_xgsetF03C
    024E8 0159      MOVW	R10,R18
    024E9 01B8      MOVW	R22,R16
    024EA 972C      SBIW	R28,0xC
(2994) }
(2995) 
(2996) 
(2997) 
(2998) 
(2999) /*-----------------------------------------------------------------------*/
(3000) /* Read Directory Entry in Sequense                                      */
(3001) /*-----------------------------------------------------------------------*/
(3002) 
(3003) FRESULT f_readdir (
(3004) 	DIR *dj,			/* Pointer to the open directory object */
(3005) 	FILINFO *fno		/* Pointer to file information to return */
(3006) )
(3007) {
(3008) 	FRESULT res;
(3009) 	DEF_NAMEBUF;
(3010) 
(3011) 
(3012) 	res = validate(dj->fs, dj->id);			/* Check validity of the object */
    024EB 01FB      MOVW	R30,R22
    024EC 8122      LDD	R18,Z+2
    024ED 8133      LDD	R19,Z+3
    024EE 8100      LD	R16,Z
    024EF 8111      LDD	R17,Z+1
    024F0 940E 178C CALL	ff.c:validate
    024F2 2F40      MOV	R20,R16
(3013) 	if (res == FR_OK) {
    024F3 2300      TST	R16
    024F4 F009      BEQ	0x24F6
    024F5 C035      RJMP	0x252B
(3014) 		if (!fno) {
    024F6 20AA      TST	R10
    024F7 F449      BNE	0x2501
    024F8 20BB      TST	R11
    024F9 F439      BNE	0x2501
(3015) 			res = dir_sdi(dj, 0);			/* Rewind the directory object */
    024FA 2722      CLR	R18
    024FB 2733      CLR	R19
    024FC 018B      MOVW	R16,R22
    024FD 940E 0BF0 CALL	ff.c:dir_sdi
    024FF 2F40      MOV	R20,R16
(3016) 		} else {
    02500 C02A      RJMP	0x252B
(3017) 			INIT_BUF(*dj);
    02501 01CE      MOVW	R24,R28
    02502 01FB      MOVW	R30,R22
    02503 8B95      STD	Z+21,R25
    02504 8B84      STD	Z+20,R24
(3018) 			res = dir_read(dj);				/* Read an directory item */
    02505 018F      MOVW	R16,R30
    02506 940E 0EED CALL	ff.c:dir_read
    02508 2EC0      MOV	R12,R16
    02509 2D4C      MOV	R20,R12
(3019) 			if (res == FR_NO_FILE) {		/* Reached end of dir */
    0250A 3004      CPI	R16,4
    0250B F441      BNE	0x2514
(3020) 				dj->sect = 0;
    0250C 01FB      MOVW	R30,R22
    0250D 963E      ADIW	R30,0xE
    0250E E080      LDI	R24,0
    0250F 8380      ST	Z,R24
    02510 8381      STD	Z+1,R24
    02511 8382      STD	Z+2,R24
    02512 8383      STD	Z+3,R24
(3021) 				res = FR_OK;
    02513 2744      CLR	R20
(3022) 			}
(3023) 			if (res == FR_OK) {				/* A valid entry is found */
    02514 2344      TST	R20
    02515 F4A9      BNE	0x252B
(3024) 				get_fileinfo(dj, fno);		/* Get the object information */
    02516 0195      MOVW	R18,R10
    02517 018B      MOVW	R16,R22
    02518 940E 10A3 CALL	ff.c:get_fileinfo
(3025) 				res = dir_next(dj, 0);		/* Increment index for next */
    0251A 2722      CLR	R18
    0251B 2733      CLR	R19
    0251C 018B      MOVW	R16,R22
    0251D 940E 0CFA CALL	ff.c:dir_next
    0251F 2EA0      MOV	R10,R16
    02520 2D4A      MOV	R20,R10
(3026) 				if (res == FR_NO_FILE) {
    02521 3004      CPI	R16,4
    02522 F441      BNE	0x252B
(3027) 					dj->sect = 0;
    02523 01FB      MOVW	R30,R22
    02524 963E      ADIW	R30,0xE
    02525 E080      LDI	R24,0
    02526 8380      ST	Z,R24
    02527 8381      STD	Z+1,R24
    02528 8382      STD	Z+2,R24
    02529 8383      STD	Z+3,R24
(3028) 					res = FR_OK;
    0252A 2744      CLR	R20
(3029) 				}
(3030) 			}
(3031) 			FREE_BUF();
(3032) 		}
(3033) 	}
(3034) 
(3035) 	LEAVE_FF(dj->fs, res);
    0252B 2F04      MOV	R16,R20
    0252C 962C      ADIW	R28,0xC
    0252D 940C 4907 JMP	pop_xgsetF03C
FILE: D:\LQD\software\software_src\delay.c
(0001) /*******************************
(0002)  function ：延时函数
(0003) Clock F  :7.3728M 
(0004) Software : ICCAVR7.14C
(0005) ********************************/
(0006) /*---------------------------------------------------------------------------------
(0007)      延时程序计算方法
(0008)      计数个数j = 延时时间/6*晶振频率 - 1
(0009) ---------------------------------------------------------------------------------*/
(0010) void delayus(unsigned int tttt)   // 1.2us 延时子函数   
(0011) { 
(0012)    do
(0013)    {
(0014)        tttt--;
_delayus:
  tttt                 --> R16
    0252F 5001      SUBI	R16,1
    02530 4010      SBCI	R17,0
(0015)    }
(0016)    while(tttt>1);
    02531 E081      LDI	R24,1
    02532 E090      LDI	R25,0
    02533 1780      CP	R24,R16
    02534 0791      CPC	R25,R17
    02535 F3C8      BCS	0x252F
    02536 9508      RET
_delayms:
  j                    --> R20
  i                    --> R16
    02537 934A      ST	-Y,R20
    02538 935A      ST	-Y,R21
(0017) }
(0018) void delayms(unsigned int i)                 //1ms延时
(0019)    {
    02539 C00A      RJMP	0x2544
(0020)     while(i--)
(0021)     {                          
(0022) 	    unsigned int j;                
(0023)         for(j=1;j<=1227;j++)   
    0253A E041      LDI	R20,1
    0253B E050      LDI	R21,0
    0253C C002      RJMP	0x253F
    0253D 5F4F      SUBI	R20,0xFF
    0253E 4F5F      SBCI	R21,0xFF
    0253F EC8B      LDI	R24,0xCB
    02540 E094      LDI	R25,4
    02541 1784      CP	R24,R20
    02542 0795      CPC	R25,R21
    02543 F7C8      BCC	0x253D
    02544 0118      MOVW	R2,R16
    02545 5001      SUBI	R16,1
    02546 4010      SBCI	R17,0
    02547 2022      TST	R2
    02548 F789      BNE	0x253A
    02549 2033      TST	R3
    0254A F779      BNE	0x253A
    0254B 9159      LD	R21,Y+
    0254C 9149      LD	R20,Y+
    0254D 9508      RET
FILE: D:\LQD\software\software_src\main.c
(0001) #include "config.h"
(0002) #define  N_per_Second  (2.72*60)
(0003) const char tab[]="\t\0";
(0004) const char enter[]="\n\0";
(0005) char buffer[512];
(0006) char TempChar[80]; //存放临时字串
(0007) struct DATA Result;
(0008) struct tm t;
(0009) unsigned long now =0; 
(0010) void debug(UINT8 *str,UINT8 val);
(0011) void WriteSDFile(void);
(0012) struct CONFIG config;
(0013) void initDevices(void){
(0014)      CLI();
_initDevices:
    0254E 94F8      BCLR	7
(0015) 	 DDRA=0XFF;
    0254F EF8F      LDI	R24,0xFF
    02550 BB8A      OUT	0x1A,R24
(0016) 	 PORTA=0XFF;
    02551 BB8B      OUT	0x1B,R24
(0017) 	 DDRB=0XFF;
    02552 BB87      OUT	0x17,R24
(0018) 	 PORTB=0XFF; 	 
    02553 BB88      OUT	0x18,R24
(0019) 	 DDRC=0XFF;
    02554 BB84      OUT	0x14,R24
(0020) 	 PORTC=0XFF;
    02555 BB85      OUT	0x15,R24
(0021) 	 DDRG=0XFF;
    02556 9380 0064 STS	0x64,R24
(0022) 	 PORTG=0XFF;	 
    02558 9380 0065 STS	0x65,R24
(0023) 	 SPI_IO_Init(); 
    0255A 940E 3C56 CALL	_SPI_IO_Init
(0024) 	 SD_Init();
    0255C 940E 2D95 CALL	_SD_Init
(0025) 	 uart1_init();
    0255E 940E 3A80 CALL	_uart1_init
(0026) 	 LCD_INT();delayms(50);LCD_INT();
    02560 940E 3C74 CALL	_LCD_INT
    02562 E302      LDI	R16,0x32
    02563 E010      LDI	R17,0
    02564 940E 2537 CALL	_delayms
    02566 940E 3C74 CALL	_LCD_INT
(0027) 	 LCD_SW(1);
    02568 E001      LDI	R16,1
    02569 940E 3C6A CALL	_LCD_SW
(0028) 	 config.THRESHOLD_delta_sec=60; //一次检测用时
    0256B E38C      LDI	R24,0x3C
    0256C 9380 08AD STS	config+4,R24
    0256E E080      LDI	R24,0
    0256F 9380 08AE STS	config+5,R24
    02571 9380 08AF STS	config+6,R24
    02573 9380 08B0 STS	config+7,R24
(0029) 	 config.heatThreshold = 5; //继电器开启温度 
    02575 E085      LDI	R24,5
    02576 9380 08BD STS	config+20,R24
(0030) 	 config.checkDeltaTime=20;  //自动检测模式 时间间隔	 
    02578 E184      LDI	R24,0x14
    02579 E090      LDI	R25,0
    0257A 9390 08BB STS	config+18,R25
    0257C 9380 08BA STS	config+17,R24
(0031) 	 config.autocheck=1;        //自动检测开关
    0257E E081      LDI	R24,1
    0257F 9380 08B9 STS	config+16,R24
(0032) 	 config.readMode = 0;      //读数据模式
    02581 2422      CLR	R2
    02582 9220 08BC STS	config+19,R2
(0033) 	 SEI();
    02584 9478      BSET	7
    02585 9508      RET
(0034) }
(0035) void timer1_init(void)
(0036) {
(0037)  TCCR1B = 0x00; //stop
_timer1_init:
    02586 2422      CLR	R2
    02587 BC2E      OUT	0x2E,R2
(0038)  TCNT1H = 0x00 /*INVALID SETTING*/; //setup
    02588 BC2D      OUT	0x2D,R2
(0039)  TCNT1L = 0x00 /*INVALID SETTING*/;
    02589 BC2C      OUT	0x2C,R2
(0040)  TCCR1A = 0x00;
    0258A BC2F      OUT	0x2F,R2
(0041)  TCCR1B = 0x46; //start Timer
    0258B E486      LDI	R24,0x46
    0258C BD8E      OUT	0x2E,R24
    0258D 9508      RET
_main:
  keycode              --> Y,+1
  i                    --> R10
  filename             --> Y,+513
  buf512               --> Y,+0
  tmp                  --> R10
    0258E 97EF      SBIW	R28,0x3F
    0258F 97EF      SBIW	R28,0x3F
    02590 97EF      SBIW	R28,0x3F
    02591 97EF      SBIW	R28,0x3F
    02592 97EF      SBIW	R28,0x3F
    02593 97EF      SBIW	R28,0x3F
    02594 97EF      SBIW	R28,0x3F
    02595 97EF      SBIW	R28,0x3F
    02596 9767      SBIW	R28,0x17
(0042) }
(0043) ////////////////////////////////////////////////////////////////
(0044) void main(void){
(0045) 	 UINT8 tmp,keycode;
(0046) 	 UINT8 buf512[513];
(0047) 	 char filename[]="201301.xls\0\0\0";
    02597 E189      LDI	R24,0x19
    02598 E091      LDI	R25,1
    02599 01FE      MOVW	R30,R28
    0259A 5FEF      SUBI	R30,0xFF
    0259B 4FFD      SBCI	R31,0xFD
    0259C E00E      LDI	R16,0xE
    0259D E010      LDI	R17,0
    0259E 93FA      ST	-Y,R31
    0259F 93EA      ST	-Y,R30
    025A0 939A      ST	-Y,R25
    025A1 938A      ST	-Y,R24
    025A2 940E 4973 CALL	asgnblk
(0048) 	 int i=0;
    025A4 24AA      CLR	R10
    025A5 24BB      CLR	R11
(0049) 	 initDevices();
    025A6 DFA7      RCALL	_initDevices
(0050) 	 dateRefresh(1);
    025A7 E001      LDI	R16,1
    025A8 940E 3937 CALL	_dateRefresh
(0051) 	 WriteFileHead();
    025AA D179      RCALL	_WriteFileHead
(0052)      Result.Index=findIndex(get_name(filename),buf512);
    025AB 018E      MOVW	R16,R28
    025AC 5F0F      SUBI	R16,0xFF
    025AD 4F1D      SBCI	R17,0xFD
    025AE D6C9      RCALL	_get_name
    025AF 019E      MOVW	R18,R28
    025B0 D2EE      RCALL	_findIndex
    025B1 0118      MOVW	R2,R16
    025B2 2444      CLR	R4
    025B3 2455      CLR	R5
    025B4 9230 0642 STS	Result+11,R3
    025B6 9220 0641 STS	Result+10,R2
    025B8 9250 0644 STS	Result+13,R5
    025BA 9240 0643 STS	Result+12,R4
(0053) 	 #ifdef _DBG_RD_  
(0054) 	 	 while(1){
(0055) 		     GUI_readback(buf512);
(0056) 	     }
(0057) 	 #endif
(0058) 	 //selfTest();
(0059) 	 GUI_welcome();
    025BC 940E 391A CALL	_GUI_welcome
    025BE C026      RJMP	0x25E5
(0060) 	 while(1){
(0061) 	    tmp=GUI_mainmeu();
    025BF 940E 2F6E CALL	_GUI_mainmeu
    025C1 2EA0      MOV	R10,R16
(0062) 		switch(tmp){
    025C2 2D4A      MOV	R20,R10
    025C3 2755      CLR	R21
    025C4 3043      CPI	R20,3
    025C5 E0E0      LDI	R30,0
    025C6 075E      CPC	R21,R30
    025C7 F069      BEQ	0x25D5
    025C8 3044      CPI	R20,4
    025C9 E0E0      LDI	R30,0
    025CA 075E      CPC	R21,R30
    025CB F061      BEQ	0x25D8
    025CC 3045      CPI	R20,5
    025CD E0E0      LDI	R30,0
    025CE 075E      CPC	R21,R30
    025CF F059      BEQ	0x25DB
    025D0 3047      CPI	R20,7
    025D1 E0E0      LDI	R30,0
    025D2 075E      CPC	R21,R30
    025D3 F059      BEQ	0x25DF
    025D4 C00B      RJMP	0x25E0
(0063) 		    case 3 : GUI_check(); break; 
    025D5 940E 305F CALL	_GUI_check
    025D7 C008      RJMP	0x25E0
(0064) 			case 4 : GUI_set_time(); break ;
    025D8 940E 3522 CALL	_GUI_set_time
    025DA C005      RJMP	0x25E0
(0065) 			case 5 : GUI_readback(buf512); break;
    025DB 018E      MOVW	R16,R28
    025DC 940E 3775 CALL	_GUI_readback
    025DE C001      RJMP	0x25E0
(0066) 			//case 6 : GUI_send_date();
(0067) 			case 7 : selfTest(); break ;
    025DF D067      RCALL	_selfTest
(0068) 			default : break;
(0069) 	   }
(0070) 	   heaterSwitch();
    025E0 D00F      RCALL	_heaterSwitch
(0071) 	   delayms(100);
    025E1 E604      LDI	R16,0x64
    025E2 E010      LDI	R17,0
    025E3 940E 2537 CALL	_delayms
    025E5 CFD9      RJMP	0x25BF
    025E6 96EF      ADIW	R28,0x3F
    025E7 96EF      ADIW	R28,0x3F
    025E8 96EF      ADIW	R28,0x3F
    025E9 96EF      ADIW	R28,0x3F
    025EA 96EF      ADIW	R28,0x3F
    025EB 96EF      ADIW	R28,0x3F
    025EC 96EF      ADIW	R28,0x3F
    025ED 96EF      ADIW	R28,0x3F
    025EE 9667      ADIW	R28,0x17
    025EF 9508      RET
_heaterSwitch:
  temp                 --> Y,+0
    025F0 940E 48E2 CALL	push_xgsetF00C
    025F2 9724      SBIW	R28,4
(0072) 	 }
(0073) }
(0074) void heaterSwitch(void)
(0075) {
(0076)  static unsigned long last=0;
(0077)  float temp;
(0078)  if(config.now>last)
    025F3 9040 0129 LDS	R4,main.c:last+2
    025F5 9050 012A LDS	R5,main.c:last+3
    025F7 9020 0127 LDS	R2,main.c:last
    025F9 9030 0128 LDS	R3,main.c:last+1
    025FB 9080 08B7 LDS	R8,config+14
    025FD 9090 08B8 LDS	R9,config+15
    025FF 9060 08B5 LDS	R6,config+12
    02601 9070 08B6 LDS	R7,config+13
    02603 1426      CP	R2,R6
    02604 0437      CPC	R3,R7
    02605 0448      CPC	R4,R8
    02606 0459      CPC	R5,R9
    02607 F008      BCS	0x2609
    02608 C03B      RJMP	0x2644
(0079)  {   
(0080)  	 last=config.now+5;
    02609 E045      LDI	R20,5
    0260A E050      LDI	R21,0
    0260B E060      LDI	R22,0
    0260C E070      LDI	R23,0
    0260D 0113      MOVW	R2,R6
    0260E 0124      MOVW	R4,R8
    0260F 0E24      ADD	R2,R20
    02610 1E35      ADC	R3,R21
    02611 1E46      ADC	R4,R22
    02612 1E57      ADC	R5,R23
    02613 9230 0128 STS	main.c:last+1,R3
    02615 9220 0127 STS	main.c:last,R2
    02617 9250 012A STS	main.c:last+3,R5
    02619 9240 0129 STS	main.c:last+2,R4
(0081)      temp= readWithoutDelay(INSIDE_SENSOR);
    0261B 2700      CLR	R16
    0261C 940E 41F1 CALL	_readWithoutDelay
    0261E 8308      ST	Y,R16
    0261F 8319      STD	Y+1,R17
    02620 832A      STD	Y+2,R18
    02621 833B      STD	Y+3,R19
(0082)      if (temp>config.heatThreshold) {
    02622 01CE      MOVW	R24,R28
    02623 9100 08BD LDS	R16,config+20
    02625 2711      CLR	R17
    02626 940E 4A6E CALL	int2fp
    02628 939A      ST	-Y,R25
    02629 938A      ST	-Y,R24
    0262A 940E 4C38 CALL	fpcmp1
    0262C F464      BGE	0x2639
(0083)  	     RELAY_OFF(); debug("off=",(int)temp);
    0262D 98AD      CBI	0x15,5
    0262E 8108      LD	R16,Y
    0262F 8119      LDD	R17,Y+1
    02630 812A      LDD	R18,Y+2
    02631 813B      LDD	R19,Y+3
    02632 940E 4A3A CALL	fpint
    02634 0198      MOVW	R18,R16
    02635 E80A      LDI	R16,0x8A
    02636 E012      LDI	R17,2
    02637 D71B      RCALL	_debug
(0084) 		 return ;
    02638 C00B      RJMP	0x2644
(0085)  	  }
(0086)       else  {
(0087)    	     RELAY_ON();debug("on=",(int)temp);
    02639 9AAD      SBI	0x15,5
    0263A 8108      LD	R16,Y
    0263B 8119      LDD	R17,Y+1
    0263C 812A      LDD	R18,Y+2
    0263D 813B      LDD	R19,Y+3
    0263E 940E 4A3A CALL	fpint
    02640 0198      MOVW	R18,R16
    02641 E806      LDI	R16,0x86
    02642 E012      LDI	R17,2
    02643 D70F      RCALL	_debug
(0088)  	  } 
(0089) }
    02644 9624      ADIW	R28,4
    02645 940C 48E9 JMP	pop_xgsetF00C
_selfTest:
  str2                 --> Y,+14
  str1                 --> Y,+8
  tmp                  --> Y,+4
    02647 9764      SBIW	R28,0x14
(0090) }
(0091) void selfTest(void){
(0092) 	float tmp=0;                                                                
    02648 EB0A      LDI	R16,0xBA
    02649 E010      LDI	R17,0
    0264A 940E 484B CALL	elpm32
    0264C 830C      STD	Y+4,R16
    0264D 831D      STD	Y+5,R17
    0264E 832E      STD	Y+6,R18
    0264F 833F      STD	Y+7,R19
(0093) 	char str1[6],str2[6];
(0094) 	lp("┌──────┐");
    02650 E705      LDI	R16,0x75
    02651 E012      LDI	R17,2
    02652 940E 3FA3 CALL	_lp
(0095) 	lp("│  自检程序  │");
    02654 E604      LDI	R16,0x64
    02655 E012      LDI	R17,2
    02656 940E 3FA3 CALL	_lp
(0096) 	lp("│            │");
    02658 E503      LDI	R16,0x53
    02659 E012      LDI	R17,2
    0265A 940E 3FA3 CALL	_lp
(0097) 	lp("└──────┘");
    0265C E402      LDI	R16,0x42
    0265D E012      LDI	R17,2
    0265E 940E 3FA3 CALL	_lp
(0098) 	 //自检程序
(0099) 	delayms(500);
    02660 EF04      LDI	R16,0xF4
    02661 E011      LDI	R17,1
    02662 940E 2537 CALL	_delayms
(0100) 	lp("外部温度 ");
    02664 E308      LDI	R16,0x38
    02665 E012      LDI	R17,2
    02666 940E 3FA3 CALL	_lp
(0101) 	tmp=read_T_NUM(OUTSIDE_SENSOR);
    02668 E001      LDI	R16,1
    02669 940E 41D3 CALL	_read_T_NUM
    0266B 830C      STD	Y+4,R16
    0266C 831D      STD	Y+5,R17
    0266D 832E      STD	Y+6,R18
    0266E 833F      STD	Y+7,R19
(0102) 	sprintf(str1,"%#0.1f",tmp);
    0266F 802C      LDD	R2,Y+4
    02670 803D      LDD	R3,Y+5
    02671 804E      LDD	R4,Y+6
    02672 805F      LDD	R5,Y+7
    02673 8228      ST	Y,R2
    02674 8239      STD	Y+1,R3
    02675 824A      STD	Y+2,R4
    02676 825B      STD	Y+3,R5
    02677 E321      LDI	R18,0x31
    02678 E032      LDI	R19,2
    02679 018E      MOVW	R16,R28
    0267A 5F08      SUBI	R16,0xF8
    0267B 4F1F      SBCI	R17,0xFF
    0267C 940E 5040 CALL	_sprintf
(0103) 	str1[6]=0;
    0267E 2422      CLR	R2
    0267F 862E      STD	Y+14,R2
(0104) 	lp(str1);
    02680 018E      MOVW	R16,R28
    02681 5F08      SUBI	R16,0xF8
    02682 4F1F      SBCI	R17,0xFF
    02683 940E 3FA3 CALL	_lp
(0105) 	delayms(500);
    02685 EF04      LDI	R16,0xF4
    02686 E011      LDI	R17,1
    02687 940E 2537 CALL	_delayms
(0106) 	lp("内部温度");
    02689 E208      LDI	R16,0x28
    0268A E012      LDI	R17,2
    0268B 940E 3FA3 CALL	_lp
(0107) 	tmp=read_T_NUM(INSIDE_SENSOR);
    0268D 2700      CLR	R16
    0268E 940E 41D3 CALL	_read_T_NUM
    02690 830C      STD	Y+4,R16
    02691 831D      STD	Y+5,R17
    02692 832E      STD	Y+6,R18
    02693 833F      STD	Y+7,R19
(0108) 	sprintf(str2,"%#0.1f",tmp);
    02694 802C      LDD	R2,Y+4
    02695 803D      LDD	R3,Y+5
    02696 804E      LDD	R4,Y+6
    02697 805F      LDD	R5,Y+7
    02698 8228      ST	Y,R2
    02699 8239      STD	Y+1,R3
    0269A 824A      STD	Y+2,R4
    0269B 825B      STD	Y+3,R5
    0269C E321      LDI	R18,0x31
    0269D E032      LDI	R19,2
    0269E 018E      MOVW	R16,R28
    0269F 5F02      SUBI	R16,0xF2
    026A0 4F1F      SBCI	R17,0xFF
    026A1 940E 5040 CALL	_sprintf
(0109) 	str2[6]=0;
    026A3 2422      CLR	R2
    026A4 8A2C      STD	Y+20,R2
(0110) 	lp(str2);
    026A5 018E      MOVW	R16,R28
    026A6 5F02      SUBI	R16,0xF2
    026A7 4F1F      SBCI	R17,0xFF
    026A8 940E 3FA3 CALL	_lp
(0111) 	delayms(500);
    026AA EF04      LDI	R16,0xF4
    026AB E011      LDI	R17,1
    026AC 940E 2537 CALL	_delayms
(0112) 	lp("风速脉冲：");delayms(500);
    026AE E10D      LDI	R16,0x1D
    026AF E012      LDI	R17,2
    026B0 940E 3FA3 CALL	_lp
    026B2 EF04      LDI	R16,0xF4
    026B3 E011      LDI	R17,1
    026B4 940E 2537 CALL	_delayms
(0113) 	lp("蜂鸣器"); beep(2,2);delayms(500);
    026B6 E106      LDI	R16,0x16
    026B7 E012      LDI	R17,2
    026B8 940E 3FA3 CALL	_lp
    026BA E022      LDI	R18,2
    026BB E002      LDI	R16,2
    026BC 940E 401B CALL	_beep
    026BE EF04      LDI	R16,0xF4
    026BF E011      LDI	R17,1
    026C0 940E 2537 CALL	_delayms
(0114) 	lp("power 指示灯");
    026C2 E009      LDI	R16,0x9
    026C3 E012      LDI	R17,2
    026C4 940E 3FA3 CALL	_lp
(0115) 	LED_OFF();delayms(100);LED_ON();delayms(100);
    026C6 9AA7      SBI	0x14,7
    026C7 98AF      CBI	0x15,7
    026C8 E604      LDI	R16,0x64
    026C9 E010      LDI	R17,0
    026CA 940E 2537 CALL	_delayms
    026CC 9AA7      SBI	0x14,7
    026CD 9AAF      SBI	0x15,7
    026CE E604      LDI	R16,0x64
    026CF E010      LDI	R17,0
    026D0 940E 2537 CALL	_delayms
(0116) 	LED_OFF();delayms(100);LED_ON();delayms(100);
    026D2 9AA7      SBI	0x14,7
    026D3 98AF      CBI	0x15,7
    026D4 E604      LDI	R16,0x64
    026D5 E010      LDI	R17,0
    026D6 940E 2537 CALL	_delayms
    026D8 9AA7      SBI	0x14,7
    026D9 9AAF      SBI	0x15,7
    026DA E604      LDI	R16,0x64
    026DB E010      LDI	R17,0
    026DC 940E 2537 CALL	_delayms
(0117) 	LED_OFF();delayms(100);LED_ON();delayms(100);
    026DE 9AA7      SBI	0x14,7
    026DF 98AF      CBI	0x15,7
    026E0 E604      LDI	R16,0x64
    026E1 E010      LDI	R17,0
    026E2 940E 2537 CALL	_delayms
    026E4 9AA7      SBI	0x14,7
    026E5 9AAF      SBI	0x15,7
    026E6 E604      LDI	R16,0x64
    026E7 E010      LDI	R17,0
    026E8 940E 2537 CALL	_delayms
(0118) 	delayms(500);
    026EA EF04      LDI	R16,0xF4
    026EB E011      LDI	R17,1
    026EC 940E 2537 CALL	_delayms
(0119) 	lp("加热开关");
    026EE E000      LDI	R16,0
    026EF E012      LDI	R17,2
    026F0 940E 3FA3 CALL	_lp
(0120) 	RELAY_ON();delayms(100);  
    026F2 9AAD      SBI	0x15,5
    026F3 E604      LDI	R16,0x64
    026F4 E010      LDI	R17,0
    026F5 940E 2537 CALL	_delayms
(0121) 	RELAY_OFF();delayms(100);
    026F7 98AD      CBI	0x15,5
    026F8 E604      LDI	R16,0x64
    026F9 E010      LDI	R17,0
    026FA 940E 2537 CALL	_delayms
(0122) 	RELAY_ON();delayms(100);
    026FC 9AAD      SBI	0x15,5
    026FD E604      LDI	R16,0x64
    026FE E010      LDI	R17,0
    026FF 940E 2537 CALL	_delayms
(0123) 	RELAY_OFF();delayms(100);
    02701 98AD      CBI	0x15,5
    02702 E604      LDI	R16,0x64
    02703 E010      LDI	R17,0
    02704 940E 2537 CALL	_delayms
(0124) 	lp("  ");delayms(500);
    02706 EF0D      LDI	R16,0xFD
    02707 E011      LDI	R17,1
    02708 940E 3FA3 CALL	_lp
    0270A EF04      LDI	R16,0xF4
    0270B E011      LDI	R17,1
    0270C 940E 2537 CALL	_delayms
(0125) 	lp("                ");
    0270E EE0C      LDI	R16,0xEC
    0270F E011      LDI	R17,1
    02710 940E 3FA3 CALL	_lp
(0126) 	lp("                ");
    02712 EE0C      LDI	R16,0xEC
    02713 E011      LDI	R17,1
    02714 940E 3FA3 CALL	_lp
(0127) 	lp("                ");
    02716 EE0C      LDI	R16,0xEC
    02717 E011      LDI	R17,1
    02718 940E 3FA3 CALL	_lp
(0128) 	lp("                ");
    0271A EE0C      LDI	R16,0xEC
    0271B E011      LDI	R17,1
    0271C 940E 3FA3 CALL	_lp
(0129) 	delayms(100);
    0271E E604      LDI	R16,0x64
    0271F E010      LDI	R17,0
    02720 940E 2537 CALL	_delayms
    02722 9664      ADIW	R28,0x14
    02723 9508      RET
_WriteFileHead:
  fs                   --> Y,+177
  bw                   --> Y,+175
  itam                 --> Y,+52
  fnamep               --> Y,+38
  file                 --> Y,+4
  res                  --> R10
    02724 940E 48C9 CALL	push_xgset003C
    02726 97EF      SBIW	R28,0x3F
    02727 97EF      SBIW	R28,0x3F
    02728 97EF      SBIW	R28,0x3F
    02729 97EF      SBIW	R28,0x3F
    0272A 97EF      SBIW	R28,0x3F
    0272B 97EF      SBIW	R28,0x3F
    0272C 97EF      SBIW	R28,0x3F
    0272D 97EF      SBIW	R28,0x3F
    0272E 97EF      SBIW	R28,0x3F
    0272F 97EF      SBIW	R28,0x3F
    02730 97EF      SBIW	R28,0x3F
    02731 97AA      SBIW	R28,0x2A
(0130) 	  
(0131) }
(0132) 
(0133) void WriteFileHead(void)   
(0134) {
(0135)  	 unsigned int bw;
(0136) 	 FRESULT res;
(0137) 	 FATFS fs;
(0138) 	 FIL file;
(0139) 	 char fnamep[]="201201.xls\0\0\0"; 
    02732 E28B      LDI	R24,0x2B
    02733 E091      LDI	R25,1
    02734 01FE      MOVW	R30,R28
    02735 96B6      ADIW	R30,0x26
    02736 E00E      LDI	R16,0xE
    02737 E010      LDI	R17,0
    02738 93FA      ST	-Y,R31
    02739 93EA      ST	-Y,R30
    0273A 939A      ST	-Y,R25
    0273B 938A      ST	-Y,R24
    0273C 940E 4973 CALL	asgnblk
(0140) 	 UINT8 itam[]="DEV000001\t\t\t\t\t\t\t\t\t\t\r\n序号\t日期\t时分\t温度\t风速\t风冷指数\t等价制冷温度\t相当温度\t冻伤危害性\t安静作业\t中等强度作业\t高强度作业\n\0";
    0273E E389      LDI	R24,0x39
    0273F E091      LDI	R25,1
    02740 01FE      MOVW	R30,R28
    02741 96F4      ADIW	R30,0x34
    02742 E70B      LDI	R16,0x7B
    02743 E010      LDI	R17,0
    02744 93FA      ST	-Y,R31
    02745 93EA      ST	-Y,R30
    02746 939A      ST	-Y,R25
    02747 938A      ST	-Y,R24
    02748 940E 4973 CALL	asgnblk
(0141) 	 res=disk_initialize(0);
    0274A 2700      CLR	R16
    0274B 940E 03BD CALL	_disk_initialize
(0142) 	 #ifdef _DEBUG
(0143) 	 debug("dinit",res);
(0144) 	 #endif
(0145) 	 res = f_mount(0, &fs);
    0274D 019E      MOVW	R18,R28
    0274E 542F      SUBI	R18,0x4F
    0274F 4F3F      SBCI	R19,0xFF
    02750 2700      CLR	R16
    02751 940E 17A9 CALL	_f_mount
(0146) 	 #ifdef _DEBUG
(0147)  	 debug("dmnt",res);
(0148) 	 #endif
(0149) 	 //get_name(fnamep)
(0150) 	 res = f_open(&file, get_name(fnamep) , FA_OPEN_ALWAYS | FA_WRITE );  //创建一个新的文件
    02753 018E      MOVW	R16,R28
    02754 5D0A      SUBI	R16,0xDA
    02755 4F1F      SBCI	R17,0xFF
    02756 D521      RCALL	_get_name
    02757 0168      MOVW	R12,R16
    02758 E182      LDI	R24,0x12
    02759 8388      ST	Y,R24
    0275A 0196      MOVW	R18,R12
    0275B 018E      MOVW	R16,R28
    0275C 5F0C      SUBI	R16,0xFC
    0275D 4F1F      SBCI	R17,0xFF
    0275E 940E 17D4 CALL	_f_open
(0151) 	 #ifdef _DEBUG
(0152) 	 debug("fopen",res);
(0153) 	 #endif
(0154) 	 res = f_write(&file,itam,128,&bw);   //bw 已写入字节数
    02760 01CE      MOVW	R24,R28
    02761 5581      SUBI	R24,0x51
    02762 4F9F      SBCI	R25,0xFF
    02763 839B      STD	Y+3,R25
    02764 838A      STD	Y+2,R24
    02765 E880      LDI	R24,0x80
    02766 E090      LDI	R25,0
    02767 8399      STD	Y+1,R25
    02768 8388      ST	Y,R24
    02769 019E      MOVW	R18,R28
    0276A 5C2C      SUBI	R18,0xCC
    0276B 4F3F      SBCI	R19,0xFF
    0276C 018E      MOVW	R16,R28
    0276D 5F0C      SUBI	R16,0xFC
    0276E 4F1F      SBCI	R17,0xFF
    0276F 940E 1BDB CALL	_f_write
    02771 2EC0      MOV	R12,R16
    02772 2CAC      MOV	R10,R12
(0155) 	 #ifdef _DEBUG
(0156) 	 debug("fwrite",res);
(0157) 	 #endif
(0158) 	 f_close(&file);
    02773 018E      MOVW	R16,R28
    02774 5F0C      SUBI	R16,0xFC
    02775 4F1F      SBCI	R17,0xFF
    02776 940E 1FA5 CALL	_f_close
(0159) 	 f_mount(0, NULL);
    02778 2722      CLR	R18
    02779 2733      CLR	R19
    0277A 2700      CLR	R16
    0277B 940E 17A9 CALL	_f_mount
    0277D 96EF      ADIW	R28,0x3F
    0277E 96EF      ADIW	R28,0x3F
    0277F 96EF      ADIW	R28,0x3F
    02780 96EF      ADIW	R28,0x3F
    02781 96EF      ADIW	R28,0x3F
    02782 96EF      ADIW	R28,0x3F
    02783 96EF      ADIW	R28,0x3F
    02784 96EF      ADIW	R28,0x3F
    02785 96EF      ADIW	R28,0x3F
    02786 96EF      ADIW	R28,0x3F
    02787 96EF      ADIW	R28,0x3F
    02788 96AA      ADIW	R28,0x2A
    02789 940C 48A3 JMP	pop_xgset003C
_WriteSDFile:
  fnamep               --> Y,+602
  fs                   --> Y,+44
  bw                   --> Y,+42
  lenth                --> Y,+38
  res                  --> R10
  file                 --> Y,+4
    0278B 92AA      ST	-Y,R10
    0278C 92CA      ST	-Y,R12
    0278D 97EF      SBIW	R28,0x3F
    0278E 97EF      SBIW	R28,0x3F
    0278F 97EF      SBIW	R28,0x3F
    02790 97EF      SBIW	R28,0x3F
    02791 97EF      SBIW	R28,0x3F
    02792 97EF      SBIW	R28,0x3F
    02793 97EF      SBIW	R28,0x3F
    02794 97EF      SBIW	R28,0x3F
    02795 97EF      SBIW	R28,0x3F
    02796 97E0      SBIW	R28,0x30
(0160) } /////////////////////////////////////////////////
(0161) //       写入文件函数 
(0162) //(创建)打开文件 
(0163) // data 指向欲写入的的字符串 64byt 
(0164) //////////////////////////////////////////////// 
(0165) void WriteSDFile(void)   
(0166) {
(0167)     unsigned int bw;
(0168) 	FRESULT res;
(0169) 	FATFS fs;
(0170)     FIL file;
(0171) 	char fnamep[13];
(0172) 	long lenth=0;
    02797 E080      LDI	R24,0
    02798 A38E      STD	Y+38,R24
    02799 A38F      STD	Y+39,R24
    0279A A788      STD	Y+40,R24
    0279B A789      STD	Y+41,R24
(0173) 	disk_initialize(0);
    0279C 2700      CLR	R16
    0279D 940E 03BD CALL	_disk_initialize
(0174) 	res = f_mount(0, &fs);
    0279F 019E      MOVW	R18,R28
    027A0 5D24      SUBI	R18,0xD4
    027A1 4F3F      SBCI	R19,0xFF
    027A2 2700      CLR	R16
    027A3 940E 17A9 CALL	_f_mount
(0175) 	res = f_open(&file,get_name(fnamep), FA_OPEN_ALWAYS | FA_WRITE );  //创建一个新的文件
    027A5 018E      MOVW	R16,R28
    027A6 5A06      SUBI	R16,0xA6
    027A7 4F1D      SBCI	R17,0xFD
    027A8 D4CF      RCALL	_get_name
    027A9 E182      LDI	R24,0x12
    027AA 8388      ST	Y,R24
    027AB 0198      MOVW	R18,R16
    027AC 018E      MOVW	R16,R28
    027AD 5F0C      SUBI	R16,0xFC
    027AE 4F1F      SBCI	R17,0xFF
    027AF 940E 17D4 CALL	_f_open
(0176) 	lenth=file.fsize;   
    027B1 842E      LDD	R2,Y+14
    027B2 843F      LDD	R3,Y+15
    027B3 8848      LDD	R4,Y+16
    027B4 8859      LDD	R5,Y+17
    027B5 A22E      STD	Y+38,R2
    027B6 A23F      STD	Y+39,R3
    027B7 A648      STD	Y+40,R4
    027B8 A659      STD	Y+41,R5
(0177) 	res = f_lseek (&file,lenth);	 
    027B9 A02E      LDD	R2,Y+38
    027BA A03F      LDD	R3,Y+39
    027BB A448      LDD	R4,Y+40
    027BC A459      LDD	R5,Y+41
    027BD 8248      ST	Y,R4
    027BE 8259      STD	Y+1,R5
    027BF 0191      MOVW	R18,R2
    027C0 018E      MOVW	R16,R28
    027C1 5F0C      SUBI	R16,0xFC
    027C2 4F1F      SBCI	R17,0xFF
    027C3 940E 1FB5 CALL	_f_lseek
(0178) 	res = f_write(&file,TempChar,SINGLE_ITEM_SIZE,&bw);   //bw 已写入字节数
    027C5 01CE      MOVW	R24,R28
    027C6 968A      ADIW	R24,0x2A
    027C7 839B      STD	Y+3,R25
    027C8 838A      STD	Y+2,R24
    027C9 E480      LDI	R24,0x40
    027CA E090      LDI	R25,0
    027CB 8399      STD	Y+1,R25
    027CC 8388      ST	Y,R24
    027CD EE27      LDI	R18,0xE7
    027CE E035      LDI	R19,5
    027CF 018E      MOVW	R16,R28
    027D0 5F0C      SUBI	R16,0xFC
    027D1 4F1F      SBCI	R17,0xFF
    027D2 940E 1BDB CALL	_f_write
    027D4 2EC0      MOV	R12,R16
    027D5 2CAC      MOV	R10,R12
(0179) 	f_close(&file);
    027D6 018E      MOVW	R16,R28
    027D7 5F0C      SUBI	R16,0xFC
    027D8 4F1F      SBCI	R17,0xFF
    027D9 940E 1FA5 CALL	_f_close
(0180) 	f_mount(0, NULL);
    027DB 2722      CLR	R18
    027DC 2733      CLR	R19
    027DD 2700      CLR	R16
    027DE 940E 17A9 CALL	_f_mount
    027E0 96EF      ADIW	R28,0x3F
    027E1 96EF      ADIW	R28,0x3F
    027E2 96EF      ADIW	R28,0x3F
    027E3 96EF      ADIW	R28,0x3F
    027E4 96EF      ADIW	R28,0x3F
    027E5 96EF      ADIW	R28,0x3F
    027E6 96EF      ADIW	R28,0x3F
    027E7 96EF      ADIW	R28,0x3F
    027E8 96EF      ADIW	R28,0x3F
    027E9 96E0      ADIW	R28,0x30
    027EA 90C9      LD	R12,Y+
    027EB 90A9      LD	R10,Y+
    027EC 9508      RET
_ReadSDFile:
  fs                   --> Y,+40
  bw                   --> Y,+38
  max                  --> R12
  file                 --> Y,+4
  res                  --> R20
  mode                 --> R22
  data                 --> R10
  index                --> R14
  fnamep               --> R12
    027ED 940E 48C3 CALL	push_xgsetF0FC
    027EF 0179      MOVW	R14,R18
    027F0 0168      MOVW	R12,R16
    027F1 97EF      SBIW	R28,0x3F
    027F2 97EF      SBIW	R28,0x3F
    027F3 97EF      SBIW	R28,0x3F
    027F4 97EF      SBIW	R28,0x3F
    027F5 97EF      SBIW	R28,0x3F
    027F6 97EF      SBIW	R28,0x3F
    027F7 97EF      SBIW	R28,0x3F
    027F8 97EF      SBIW	R28,0x3F
    027F9 97EF      SBIW	R28,0x3F
    027FA 976F      SBIW	R28,0x1F
    027FB 01FE      MOVW	R30,R28
    027FC 5AE0      SUBI	R30,0xA0
    027FD 4FFD      SBCI	R31,0xFD
    027FE 80A0      LD	R10,Z
    027FF 80B1      LDD	R11,Z+1
    02800 01FE      MOVW	R30,R28
    02801 59EE      SUBI	R30,0x9E
    02802 4FFD      SBCI	R31,0xFD
    02803 8160      LD	R22,Z
(0181) }
(0182) /////////////////////////////////////////////////
(0183) //       读取文件函数
(0184) //以64byte为一块 读取
(0185) //index数据偏移量   data读出后存放地
(0186) //////////////////////////////////////////////// 
(0187) char ReadSDFile(char *fnamep,int index, char *data, char mode)
(0188) {
(0189)  	unsigned int bw;
(0190) 	char res;
(0191) 	FATFS fs;
(0192)     FIL file;
(0193) 	static int indexoffset;
(0194) 	unsigned int max;
(0195) 	disk_initialize(0);
    02804 2700      CLR	R16
    02805 940E 03BD CALL	_disk_initialize
(0196)     res = f_mount(0, &fs);
    02807 019E      MOVW	R18,R28
    02808 5D28      SUBI	R18,0xD8
    02809 4F3F      SBCI	R19,0xFF
    0280A 2700      CLR	R16
    0280B 940E 17A9 CALL	_f_mount
(0197)     res = f_open(&file,fnamep,FA_READ);  
    0280D E081      LDI	R24,1
    0280E 8388      ST	Y,R24
    0280F 0196      MOVW	R18,R12
    02810 018E      MOVW	R16,R28
    02811 5F0C      SUBI	R16,0xFC
    02812 4F1F      SBCI	R17,0xFF
    02813 940E 17D4 CALL	_f_open
    02815 2F40      MOV	R20,R16
(0198)     if(res==FR_NO_FILE) {
    02816 3004      CPI	R16,4
    02817 F419      BNE	0x281B
(0199) 	data=NULL;
    02818 24AA      CLR	R10
    02819 24BB      CLR	R11
(0200)     #if _debug >= 1 
(0201)     debug_out("now file",255);
(0202) 	debug_out(filename,res);
(0203) 	debug_out("file is no exist....",255);
(0204)     #endif 
(0205)     return res;
    0281A C078      RJMP	0x2893
(0206)     }   
(0207)     max = (file.fsize-128)/SINGLE_ITEM_SIZE;
    0281B E880      LDI	R24,0x80
    0281C E090      LDI	R25,0
    0281D E0A0      LDI	R26,0
    0281E E0B0      LDI	R27,0
    0281F 850E      LDD	R16,Y+14
    02820 851F      LDD	R17,Y+15
    02821 8928      LDD	R18,Y+16
    02822 8939      LDD	R19,Y+17
    02823 1B08      SUB	R16,R24
    02824 0B19      SBC	R17,R25
    02825 0B2A      SBC	R18,R26
    02826 0B3B      SBC	R19,R27
    02827 E086      LDI	R24,6
    02828 E090      LDI	R25,0
    02829 938A      ST	-Y,R24
    0282A 940E 4967 CALL	lsr32
    0282C 0168      MOVW	R12,R16
(0208) 	if(mode == 0){ //绝对位置模式
    0282D 2366      TST	R22
    0282E F429      BNE	0x2834
(0209) 		indexoffset = index;
    0282F 92F0 05E6 STS	main.c:indexoffset+1,R15
    02831 92E0 05E5 STS	main.c:indexoffset,R14
(0210) 	}
    02833 C00C      RJMP	0x2840
(0211) 	else if(mode == 1){ //位置偏移模式
    02834 3061      CPI	R22,1
    02835 F451      BNE	0x2840
(0212) 		indexoffset+=index;
    02836 9020 05E5 LDS	R2,main.c:indexoffset
    02838 9030 05E6 LDS	R3,main.c:indexoffset+1
    0283A 0C2E      ADD	R2,R14
    0283B 1C3F      ADC	R3,R15
    0283C 9230 05E6 STS	main.c:indexoffset+1,R3
    0283E 9220 05E5 STS	main.c:indexoffset,R2
(0213) 	}
(0214) 	if(indexoffset >max){
    02840 9020 05E5 LDS	R2,main.c:indexoffset
    02842 9030 05E6 LDS	R3,main.c:indexoffset+1
    02844 14C2      CP	R12,R2
    02845 04D3      CPC	R13,R3
    02846 F428      BCC	0x284C
(0215) 	    indexoffset = max;
    02847 92D0 05E6 STS	main.c:indexoffset+1,R13
    02849 92C0 05E5 STS	main.c:indexoffset,R12
(0216) 	}
    0284B C00F      RJMP	0x285B
(0217) 	else if(indexoffset <=0){
    0284C 2422      CLR	R2
    0284D 2433      CLR	R3
    0284E 9040 05E5 LDS	R4,main.c:indexoffset
    02850 9050 05E6 LDS	R5,main.c:indexoffset+1
    02852 1424      CP	R2,R4
    02853 0435      CPC	R3,R5
    02854 F034      BLT	0x285B
(0218) 		indexoffset = 1;
    02855 E081      LDI	R24,1
    02856 E090      LDI	R25,0
    02857 9390 05E6 STS	main.c:indexoffset+1,R25
    02859 9380 05E5 STS	main.c:indexoffset,R24
(0219) 	}
(0220) 	res = f_lseek (&file,(indexoffset-1)*SINGLE_ITEM_SIZE+128);	 //前两个字节数据为文件头空间 所以从第三块读/写起
    0285B 9120 05E5 LDS	R18,main.c:indexoffset
    0285D 9130 05E6 LDS	R19,main.c:indexoffset+1
    0285F E400      LDI	R16,0x40
    02860 E010      LDI	R17,0
    02861 940E 485F CALL	empy16s
    02863 01C8      MOVW	R24,R16
    02864 5480      SUBI	R24,0x40
    02865 4090      SBCI	R25,0
    02866 5880      SUBI	R24,0x80
    02867 4F9F      SBCI	R25,0xFF
    02868 011C      MOVW	R2,R24
    02869 2444      CLR	R4
    0286A FC37      SBRC	R3,7
    0286B 9440      COM	R4
    0286C 2455      CLR	R5
    0286D FC47      SBRC	R4,7
    0286E 9450      COM	R5
    0286F 8248      ST	Y,R4
    02870 8259      STD	Y+1,R5
    02871 0191      MOVW	R18,R2
    02872 018E      MOVW	R16,R28
    02873 5F0C      SUBI	R16,0xFC
    02874 4F1F      SBCI	R17,0xFF
    02875 940E 1FB5 CALL	_f_lseek
    02877 2EC0      MOV	R12,R16
(0221)     res = f_read(&file,data,SINGLE_ITEM_SIZE,&bw);
    02878 01CE      MOVW	R24,R28
    02879 9686      ADIW	R24,0x26
    0287A 839B      STD	Y+3,R25
    0287B 838A      STD	Y+2,R24
    0287C E480      LDI	R24,0x40
    0287D E090      LDI	R25,0
    0287E 8399      STD	Y+1,R25
    0287F 8388      ST	Y,R24
    02880 0195      MOVW	R18,R10
    02881 018E      MOVW	R16,R28
    02882 5F0C      SUBI	R16,0xFC
    02883 4F1F      SBCI	R17,0xFF
    02884 940E 1970 CALL	_f_read
    02886 2EA0      MOV	R10,R16
    02887 2D4A      MOV	R20,R10
(0222)     f_close(&file);
    02888 018E      MOVW	R16,R28
    02889 5F0C      SUBI	R16,0xFC
    0288A 4F1F      SBCI	R17,0xFF
    0288B 940E 1FA5 CALL	_f_close
(0223) 	f_mount(0, NULL);
    0288D 2722      CLR	R18
    0288E 2733      CLR	R19
    0288F 2700      CLR	R16
    02890 940E 17A9 CALL	_f_mount
(0224) 	return res;
    02892 2F04      MOV	R16,R20
    02893 96EF      ADIW	R28,0x3F
    02894 96EF      ADIW	R28,0x3F
    02895 96EF      ADIW	R28,0x3F
    02896 96EF      ADIW	R28,0x3F
    02897 96EF      ADIW	R28,0x3F
    02898 96EF      ADIW	R28,0x3F
    02899 96EF      ADIW	R28,0x3F
    0289A 96EF      ADIW	R28,0x3F
    0289B 96EF      ADIW	R28,0x3F
    0289C 966F      ADIW	R28,0x1F
    0289D 940C 48B8 JMP	pop_xgsetF0FC
_findIndex:
  fs                   --> Y,+48
  bw                   --> Y,+46
  fnamep               --> R14
  readsize             --> R10
  res                  --> R12
  file                 --> Y,+12
  lenth                --> Y,+8
  index                --> Y,+4
  is_first_end         --> Y,+606
  tmp                  --> R10
  buf                  --> Y,+617
  filename             --> R10
    0289F 933A      ST	-Y,R19
    028A0 932A      ST	-Y,R18
    028A1 940E 48C3 CALL	push_xgsetF0FC
    028A3 0158      MOVW	R10,R16
    028A4 97EF      SBIW	R28,0x3F
    028A5 97EF      SBIW	R28,0x3F
    028A6 97EF      SBIW	R28,0x3F
    028A7 97EF      SBIW	R28,0x3F
    028A8 97EF      SBIW	R28,0x3F
    028A9 97EF      SBIW	R28,0x3F
    028AA 97EF      SBIW	R28,0x3F
    028AB 97EF      SBIW	R28,0x3F
    028AC 97EF      SBIW	R28,0x3F
    028AD 97A8      SBIW	R28,0x28
(0225) } 
(0226) //////////////////////////////////
(0227) //   find index
(0228) // 检查当前文件尺寸，根据倒数第二个
(0229) //'\n'及其后面的index确定当前index值
(0230) //////////////////////////////////
(0231) unsigned int findIndex(char *filename,char *buf){
(0232)     unsigned int bw,tmp;
(0233) 	long index =0;
    028AE E080      LDI	R24,0
    028AF 838C      STD	Y+4,R24
    028B0 838D      STD	Y+5,R24
    028B1 838E      STD	Y+6,R24
    028B2 838F      STD	Y+7,R24
(0234) 	unsigned char is_first_end=0;
    028B3 2400      CLR	R0
    028B4 01DE      MOVW	R26,R28
    028B5 5AA2      SUBI	R26,0xA2
    028B6 4FBD      SBCI	R27,0xFD
    028B7 920C      ST	X,R0
(0235) 	char *fnamep=filename;
    028B8 0175      MOVW	R14,R10
(0236) 	FRESULT res;
(0237) 	FATFS fs;
(0238) 	FIL file;
(0239) 	long lenth=0;
    028B9 E080      LDI	R24,0
    028BA 8788      STD	Y+8,R24
    028BB 8789      STD	Y+9,R24
    028BC 878A      STD	Y+10,R24
    028BD 878B      STD	Y+11,R24
(0240) 	int readsize=0;
    028BE 24AA      CLR	R10
    028BF 24BB      CLR	R11
(0241) 	//PrintString_n(fnamep);
(0242) 	res = f_mount(0, &fs);
    028C0 019E      MOVW	R18,R28
    028C1 5D20      SUBI	R18,0xD0
    028C2 4F3F      SBCI	R19,0xFF
    028C3 2700      CLR	R16
    028C4 940E 17A9 CALL	_f_mount
(0243) 	res = f_open(&file,fnamep, FA_OPEN_ALWAYS | FA_READ );  //创建一个新的文件
    028C6 E181      LDI	R24,0x11
    028C7 8388      ST	Y,R24
    028C8 0197      MOVW	R18,R14
    028C9 018E      MOVW	R16,R28
    028CA 5F04      SUBI	R16,0xF4
    028CB 4F1F      SBCI	R17,0xFF
    028CC 940E 17D4 CALL	_f_open
    028CE 2EC0      MOV	R12,R16
(0244) 	if(res !=  FR_OK){ //openerror
    028CF 2300      TST	R16
    028D0 F011      BEQ	0x28D3
(0245) 	    return res;}
    028D1 2711      CLR	R17
    028D2 C110      RJMP	0x29E3
(0246) 	lenth=file.fsize;   //文件尾部为 file.size 
    028D3 882E      LDD	R2,Y+22
    028D4 883F      LDD	R3,Y+23
    028D5 8C48      LDD	R4,Y+24
    028D6 8C59      LDD	R5,Y+25
    028D7 8628      STD	Y+8,R2
    028D8 8639      STD	Y+9,R3
    028D9 864A      STD	Y+10,R4
    028DA 865B      STD	Y+11,R5
(0247) 	//debug("size=",0xff);
(0248) 	//PrintLong(lenth);
(0249) 	if(lenth > 512) {
    028DB E040      LDI	R20,0
    028DC E052      LDI	R21,2
    028DD E060      LDI	R22,0
    028DE E070      LDI	R23,0
    028DF 8428      LDD	R2,Y+8
    028E0 8439      LDD	R3,Y+9
    028E1 844A      LDD	R4,Y+10
    028E2 845B      LDD	R5,Y+11
    028E3 1542      CP	R20,R2
    028E4 0553      CPC	R21,R3
    028E5 0564      CPC	R22,R4
    028E6 0575      CPC	R23,R5
    028E7 F464      BGE	0x28F4
(0250) 	    readsize=512;
    028E8 E080      LDI	R24,0
    028E9 E092      LDI	R25,2
    028EA 015C      MOVW	R10,R24
(0251) 		lenth=file.fsize;
    028EB 882E      LDD	R2,Y+22
    028EC 883F      LDD	R3,Y+23
    028ED 8C48      LDD	R4,Y+24
    028EE 8C59      LDD	R5,Y+25
    028EF 8628      STD	Y+8,R2
    028F0 8639      STD	Y+9,R3
    028F1 864A      STD	Y+10,R4
    028F2 865B      STD	Y+11,R5
(0252) 	}
    028F3 C007      RJMP	0x28FB
(0253) 	else {
(0254) 	    readsize =file.fsize;
    028F4 88AE      LDD	R10,Y+22
    028F5 88BF      LDD	R11,Y+23
(0255) 		lenth=0;
    028F6 E080      LDI	R24,0
    028F7 8788      STD	Y+8,R24
    028F8 8789      STD	Y+9,R24
    028F9 878A      STD	Y+10,R24
    028FA 878B      STD	Y+11,R24
(0256) 	}
(0257) 	res = f_lseek (&file,file.fsize-readsize);
    028FB 0115      MOVW	R2,R10
    028FC 2444      CLR	R4
    028FD FC37      SBRC	R3,7
    028FE 9440      COM	R4
    028FF 2455      CLR	R5
    02900 FC47      SBRC	R4,7
    02901 9450      COM	R5
    02902 886E      LDD	R6,Y+22
    02903 887F      LDD	R7,Y+23
    02904 8C88      LDD	R8,Y+24
    02905 8C99      LDD	R9,Y+25
    02906 1862      SUB	R6,R2
    02907 0873      SBC	R7,R3
    02908 0884      SBC	R8,R4
    02909 0895      SBC	R9,R5
    0290A 8288      ST	Y,R8
    0290B 8299      STD	Y+1,R9
    0290C 0193      MOVW	R18,R6
    0290D 018E      MOVW	R16,R28
    0290E 5F04      SUBI	R16,0xF4
    0290F 4F1F      SBCI	R17,0xFF
    02910 940E 1FB5 CALL	_f_lseek
(0258) 	//debug("readSIZE=",0x00);
(0259) 	//PrintLong((file.fsize-readsize));
(0260) 	res = f_read(&file,buf,readsize,&bw);
    02912 01CE      MOVW	R24,R28
    02913 968E      ADIW	R24,0x2E
    02914 839B      STD	Y+3,R25
    02915 838A      STD	Y+2,R24
    02916 82B9      STD	Y+1,R11
    02917 82A8      ST	Y,R10
    02918 01FE      MOVW	R30,R28
    02919 59E7      SUBI	R30,0x97
    0291A 4FFD      SBCI	R31,0xFD
    0291B 8120      LD	R18,Z
    0291C 8131      LDD	R19,Z+1
    0291D 018E      MOVW	R16,R28
    0291E 5F04      SUBI	R16,0xF4
    0291F 4F1F      SBCI	R17,0xFF
    02920 940E 1970 CALL	_f_read
    02922 2EE0      MOV	R14,R16
    02923 2CCE      MOV	R12,R14
(0261) 	f_close(&file);
    02924 018E      MOVW	R16,R28
    02925 5F04      SUBI	R16,0xF4
    02926 4F1F      SBCI	R17,0xFF
    02927 940E 1FA5 CALL	_f_close
(0262) 	//debug("readRES=",res);
(0263) 	//debug("readbw=",0X00);
(0264) 	//PrintLong(bw);
(0265) 	//PrintString_n(buf);
(0266) 	for(tmp=readsize;tmp>0;tmp--){
    02929 C040      RJMP	0x296A
(0267) 		//debug("buf index",buf[tmp]);
(0268) 		//PrintLong(tmp);
(0269) 		//if(buf[tmp] == '\n') Usart_Transmit('@');						  
(0270) 		if(buf[tmp] == '\n' && is_first_end== 0){
    0292A 01F5      MOVW	R30,R10
    0292B 01DE      MOVW	R26,R28
    0292C 59A7      SUBI	R26,0x97
    0292D 4FBD      SBCI	R27,0xFD
    0292E 900D      LD	R0,X+
    0292F 901C      LD	R1,X
    02930 0DE0      ADD	R30,R0
    02931 1DF1      ADC	R31,R1
    02932 8180      LD	R24,Z
    02933 308A      CPI	R24,0xA
    02934 F469      BNE	0x2942
    02935 01FE      MOVW	R30,R28
    02936 5AE2      SUBI	R30,0xA2
    02937 4FFD      SBCI	R31,0xFD
    02938 8000      LD	R0,Z
    02939 2000      TST	R0
    0293A F439      BNE	0x2942
(0271) 		    is_first_end=1; 	
    0293B 2400      CLR	R0
    0293C 9403      INC	R0
    0293D 01FE      MOVW	R30,R28
    0293E 5AE2      SUBI	R30,0xA2
    0293F 4FFD      SBCI	R31,0xFD
    02940 8200      ST	Z,R0
(0272) 			//debug("first=",0xf0);					      
(0273) 		}
    02941 C025      RJMP	0x2967
(0274) 		else if(buf[tmp] == '\n' && is_first_end== 1){
    02942 01F5      MOVW	R30,R10
    02943 01DE      MOVW	R26,R28
    02944 59A7      SUBI	R26,0x97
    02945 4FBD      SBCI	R27,0xFD
    02946 900D      LD	R0,X+
    02947 901C      LD	R1,X
    02948 0DE0      ADD	R30,R0
    02949 1DF1      ADC	R31,R1
    0294A 8180      LD	R24,Z
    0294B 308A      CPI	R24,0xA
    0294C F4D1      BNE	0x2967
    0294D 01DE      MOVW	R26,R28
    0294E 5AA2      SUBI	R26,0xA2
    0294F 4FBD      SBCI	R27,0xFD
    02950 918C      LD	R24,X
    02951 3081      CPI	R24,1
    02952 F4A1      BNE	0x2967
(0275) 		    lenth -= (512-tmp);
    02953 E080      LDI	R24,0
    02954 E092      LDI	R25,2
    02955 011C      MOVW	R2,R24
    02956 182A      SUB	R2,R10
    02957 083B      SBC	R3,R11
    02958 2444      CLR	R4
    02959 2455      CLR	R5
    0295A 8468      LDD	R6,Y+8
    0295B 8479      LDD	R7,Y+9
    0295C 848A      LDD	R8,Y+10
    0295D 849B      LDD	R9,Y+11
    0295E 1862      SUB	R6,R2
    0295F 0873      SBC	R7,R3
    02960 0884      SBC	R8,R4
    02961 0895      SBC	R9,R5
    02962 8668      STD	Y+8,R6
    02963 8679      STD	Y+9,R7
    02964 868A      STD	Y+10,R8
    02965 869B      STD	Y+11,R9
(0276) 			break;
    02966 C009      RJMP	0x2970
    02967 01C5      MOVW	R24,R10
    02968 9701      SBIW	R24,1
    02969 015C      MOVW	R10,R24
    0296A 20AA      TST	R10
    0296B F009      BEQ	0x296D
    0296C CFBD      RJMP	0x292A
    0296D 20BB      TST	R11
    0296E F009      BEQ	0x2970
    0296F CFBA      RJMP	0x292A
(0277) 		} 						
(0278) 	}
(0279) 	//debug("start=",0X00); PrintLong(lenth);
(0280) 	if(lenth < 118 ){ 
    02970 E746      LDI	R20,0x76
    02971 E050      LDI	R21,0
    02972 E060      LDI	R22,0
    02973 E070      LDI	R23,0
    02974 8428      LDD	R2,Y+8
    02975 8439      LDD	R3,Y+9
    02976 844A      LDD	R4,Y+10
    02977 845B      LDD	R5,Y+11
    02978 1624      CP	R2,R20
    02979 0635      CPC	R3,R21
    0297A 0646      CPC	R4,R22
    0297B 0657      CPC	R5,R23
    0297C F434      BGE	0x2983
(0281)  		return 1;
    0297D E001      LDI	R16,1
    0297E E010      LDI	R17,0
    0297F C063      RJMP	0x29E3
(0282) 	}
(0283) 	else {
(0284) 		 //debug(">128 ",0X00);
(0285) 		 while(buf[tmp] <= '0' || buf[tmp] >= '9') tmp++;
    02980 01C5      MOVW	R24,R10
    02981 9601      ADIW	R24,1
    02982 015C      MOVW	R10,R24
    02983 01F5      MOVW	R30,R10
    02984 01DE      MOVW	R26,R28
    02985 59A7      SUBI	R26,0x97
    02986 4FBD      SBCI	R27,0xFD
    02987 900D      LD	R0,X+
    02988 901C      LD	R1,X
    02989 0DE0      ADD	R30,R0
    0298A 1DF1      ADC	R31,R1
    0298B 80E0      LD	R14,Z
    0298C 24FF      CLR	R15
    0298D E380      LDI	R24,0x30
    0298E 158E      CP	R24,R14
    0298F F780      BCC	0x2980
    02990 2D8E      MOV	R24,R14
    02991 3389      CPI	R24,0x39
    02992 F768      BCC	0x2980
    02993 C02F      RJMP	0x29C3
(0286) 		 //debug("nozero ",bw); PrintLong(tmp);
(0287) 		 while(buf[tmp] != 't' && buf[tmp] >= '0' && buf[tmp] <= '9'){
(0288) 		     index=index*10+(buf[tmp]-'0');
    02994 01F5      MOVW	R30,R10
    02995 01DE      MOVW	R26,R28
    02996 59A7      SUBI	R26,0x97
    02997 4FBD      SBCI	R27,0xFD
    02998 900D      LD	R0,X+
    02999 901C      LD	R1,X
    0299A 0DE0      ADD	R30,R0
    0299B 1DF1      ADC	R31,R1
    0299C 8180      LD	R24,Z
    0299D 2799      CLR	R25
    0299E 97C0      SBIW	R24,0x30
    0299F 011C      MOVW	R2,R24
    029A0 2444      CLR	R4
    029A1 FC37      SBRC	R3,7
    029A2 9440      COM	R4
    029A3 2455      CLR	R5
    029A4 FC47      SBRC	R4,7
    029A5 9450      COM	R5
    029A6 806C      LDD	R6,Y+4
    029A7 807D      LDD	R7,Y+5
    029A8 808E      LDD	R8,Y+6
    029A9 809F      LDD	R9,Y+7
    029AA E04A      LDI	R20,0xA
    029AB E050      LDI	R21,0
    029AC E060      LDI	R22,0
    029AD E070      LDI	R23,0
    029AE 929A      ST	-Y,R9
    029AF 928A      ST	-Y,R8
    029B0 927A      ST	-Y,R7
    029B1 926A      ST	-Y,R6
    029B2 018A      MOVW	R16,R20
    029B3 019B      MOVW	R18,R22
    029B4 940E 486F CALL	empy32u|empy32s
    029B6 0138      MOVW	R6,R16
    029B7 0149      MOVW	R8,R18
    029B8 0C62      ADD	R6,R2
    029B9 1C73      ADC	R7,R3
    029BA 1C84      ADC	R8,R4
    029BB 1C95      ADC	R9,R5
    029BC 826C      STD	Y+4,R6
    029BD 827D      STD	Y+5,R7
    029BE 828E      STD	Y+6,R8
    029BF 829F      STD	Y+7,R9
(0289) 		 	 //Usart_Transmit(buf[tmp]);	
(0290) 		 	 tmp++;
    029C0 01C5      MOVW	R24,R10
    029C1 9601      ADIW	R24,1
    029C2 015C      MOVW	R10,R24
    029C3 01F5      MOVW	R30,R10
    029C4 01DE      MOVW	R26,R28
    029C5 59A7      SUBI	R26,0x97
    029C6 4FBD      SBCI	R27,0xFD
    029C7 900D      LD	R0,X+
    029C8 901C      LD	R1,X
    029C9 0DE0      ADD	R30,R0
    029CA 1DF1      ADC	R31,R1
    029CB 80E0      LD	R14,Z
    029CC 24FF      CLR	R15
    029CD 2D8E      MOV	R24,R14
    029CE 3784      CPI	R24,0x74
    029CF F031      BEQ	0x29D6
    029D0 3380      CPI	R24,0x30
    029D1 F020      BCS	0x29D6
    029D2 E389      LDI	R24,0x39
    029D3 158E      CP	R24,R14
    029D4 F008      BCS	0x29D6
    029D5 CFBE      RJMP	0x2994
(0291) 		 }
(0292) 	}
(0293) 	//debug("index=",0X00);
(0294) 	//PrintLong(index+1);
(0295) 	return index+1;
    029D6 E041      LDI	R20,1
    029D7 E050      LDI	R21,0
    029D8 E060      LDI	R22,0
    029D9 E070      LDI	R23,0
    029DA 802C      LDD	R2,Y+4
    029DB 803D      LDD	R3,Y+5
    029DC 804E      LDD	R4,Y+6
    029DD 805F      LDD	R5,Y+7
    029DE 0E24      ADD	R2,R20
    029DF 1E35      ADC	R3,R21
    029E0 1E46      ADC	R4,R22
    029E1 1E57      ADC	R5,R23
    029E2 0181      MOVW	R16,R2
    029E3 96EF      ADIW	R28,0x3F
    029E4 96EF      ADIW	R28,0x3F
    029E5 96EF      ADIW	R28,0x3F
    029E6 96EF      ADIW	R28,0x3F
    029E7 96EF      ADIW	R28,0x3F
    029E8 96EF      ADIW	R28,0x3F
    029E9 96EF      ADIW	R28,0x3F
    029EA 96EF      ADIW	R28,0x3F
    029EB 96EF      ADIW	R28,0x3F
    029EC 96A8      ADIW	R28,0x28
    029ED 940E 48B8 CALL	pop_xgsetF0FC
    029EF 9622      ADIW	R28,2
    029F0 9508      RET
_Round:
  x                    --> Y,+0
    029F1 940E 477E CALL	push_arg4
(0296) }
(0297) float Round(float x){
(0298)     x=x*10;
    029F3 EB06      LDI	R16,0xB6
    029F4 E010      LDI	R17,0
    029F5 940E 484B CALL	elpm32
    029F7 01CE      MOVW	R24,R28
    029F8 939A      ST	-Y,R25
    029F9 938A      ST	-Y,R24
    029FA 940E 4C09 CALL	fpmule1
    029FC 8308      ST	Y,R16
    029FD 8319      STD	Y+1,R17
    029FE 832A      STD	Y+2,R18
    029FF 833B      STD	Y+3,R19
(0299) 	if(x >=0) x+=0.5;
    02A00 8028      LD	R2,Y
    02A01 8039      LDD	R3,Y+1
    02A02 804A      LDD	R4,Y+2
    02A03 805B      LDD	R5,Y+3
    02A04 EB0A      LDI	R16,0xBA
    02A05 E010      LDI	R17,0
    02A06 940E 484B CALL	elpm32
    02A08 933A      ST	-Y,R19
    02A09 932A      ST	-Y,R18
    02A0A 931A      ST	-Y,R17
    02A0B 930A      ST	-Y,R16
    02A0C 0181      MOVW	R16,R2
    02A0D 0192      MOVW	R18,R4
    02A0E 940E 4C43 CALL	fpcmp2
    02A10 F0AC      BLT	0x2A26
    02A11 8028      LD	R2,Y
    02A12 8039      LDD	R3,Y+1
    02A13 804A      LDD	R4,Y+2
    02A14 805B      LDD	R5,Y+3
    02A15 EB02      LDI	R16,0xB2
    02A16 E010      LDI	R17,0
    02A17 940E 484B CALL	elpm32
    02A19 933A      ST	-Y,R19
    02A1A 932A      ST	-Y,R18
    02A1B 931A      ST	-Y,R17
    02A1C 930A      ST	-Y,R16
    02A1D 0181      MOVW	R16,R2
    02A1E 0192      MOVW	R18,R4
    02A1F 940E 49FF CALL	fpadd2
    02A21 8308      ST	Y,R16
    02A22 8319      STD	Y+1,R17
    02A23 832A      STD	Y+2,R18
    02A24 833B      STD	Y+3,R19
    02A25 C014      RJMP	0x2A3A
(0300) 	else x-=0.5;
    02A26 8028      LD	R2,Y
    02A27 8039      LDD	R3,Y+1
    02A28 804A      LDD	R4,Y+2
    02A29 805B      LDD	R5,Y+3
    02A2A EB02      LDI	R16,0xB2
    02A2B E010      LDI	R17,0
    02A2C 940E 484B CALL	elpm32
    02A2E 933A      ST	-Y,R19
    02A2F 932A      ST	-Y,R18
    02A30 931A      ST	-Y,R17
    02A31 930A      ST	-Y,R16
    02A32 0181      MOVW	R16,R2
    02A33 0192      MOVW	R18,R4
    02A34 940E 4A14 CALL	fpsub2
    02A36 8308      ST	Y,R16
    02A37 8319      STD	Y+1,R17
    02A38 832A      STD	Y+2,R18
    02A39 833B      STD	Y+3,R19
(0301) 	x=(int)x;
    02A3A 8108      LD	R16,Y
    02A3B 8119      LDD	R17,Y+1
    02A3C 812A      LDD	R18,Y+2
    02A3D 813B      LDD	R19,Y+3
    02A3E 940E 4A3A CALL	fpint
    02A40 940E 4A6E CALL	int2fp
    02A42 8308      ST	Y,R16
    02A43 8319      STD	Y+1,R17
    02A44 832A      STD	Y+2,R18
    02A45 833B      STD	Y+3,R19
(0302) 	x=x/10.0;
    02A46 8028      LD	R2,Y
    02A47 8039      LDD	R3,Y+1
    02A48 804A      LDD	R4,Y+2
    02A49 805B      LDD	R5,Y+3
    02A4A EA0E      LDI	R16,0xAE
    02A4B E010      LDI	R17,0
    02A4C 940E 484B CALL	elpm32
    02A4E 933A      ST	-Y,R19
    02A4F 932A      ST	-Y,R18
    02A50 931A      ST	-Y,R17
    02A51 930A      ST	-Y,R16
    02A52 0181      MOVW	R16,R2
    02A53 0192      MOVW	R18,R4
    02A54 940E 4A99 CALL	fpdiv2
    02A56 8308      ST	Y,R16
    02A57 8319      STD	Y+1,R17
    02A58 832A      STD	Y+2,R18
    02A59 833B      STD	Y+3,R19
(0303) 	return x;
    02A5A 8108      LD	R16,Y
    02A5B 8119      LDD	R17,Y+1
    02A5C 812A      LDD	R18,Y+2
    02A5D 813B      LDD	R19,Y+3
    02A5E 9624      ADIW	R28,4
    02A5F 9508      RET
_check:
  WScounter            --> R10
  tmp                  --> R12
    02A60 940E 48C9 CALL	push_xgset003C
    02A62 9724      SBIW	R28,4
(0304) }
(0305) 
(0306) void check( void )
(0307) {
(0308)  unsigned char tmp;
(0309)  unsigned int WScounter;
(0310)  //检测风速
(0311)  //读计数器1 此步需严格按手册进行。
(0312)  tmp=SREG;
    02A63 B6CF      IN	R12,0x3F
(0313)  CLI();
    02A64 94F8      BCLR	7
(0314)  WScounter=TCNT1H*256+TCNT1L;
    02A65 B52D      IN	R18,0x2D
    02A66 2733      CLR	R19
    02A67 E000      LDI	R16,0
    02A68 E011      LDI	R17,1
    02A69 940E 485F CALL	empy16s
    02A6B 0158      MOVW	R10,R16
    02A6C B42C      IN	R2,0x2C
    02A6D 2433      CLR	R3
    02A6E 0CA2      ADD	R10,R2
    02A6F 1CB3      ADC	R11,R3
(0315)  SREG=tmp;
    02A70 BECF      OUT	0x3F,R12
(0316)  SEI();
    02A71 9478      BSET	7
(0317)  //计算风速
(0318)  Result.WindSpeed=WScounter/N_per_Second;
    02A72 0185      MOVW	R16,R10
    02A73 940E 4A6C CALL	uint2fp
    02A75 0118      MOVW	R2,R16
    02A76 0129      MOVW	R4,R18
    02A77 EA0A      LDI	R16,0xAA
    02A78 E010      LDI	R17,0
    02A79 940E 484B CALL	elpm32
    02A7B 933A      ST	-Y,R19
    02A7C 932A      ST	-Y,R18
    02A7D 931A      ST	-Y,R17
    02A7E 930A      ST	-Y,R16
    02A7F 0181      MOVW	R16,R2
    02A80 0192      MOVW	R18,R4
    02A81 940E 4A99 CALL	fpdiv2
    02A83 9310 066B STS	Result+52,R17
    02A85 9300 066A STS	Result+51,R16
    02A87 9330 066D STS	Result+54,R19
    02A89 9320 066C STS	Result+53,R18
(0319)  //四舍五入
(0320)  Result.WindSpeed=Round(Result.WindSpeed);
    02A8B DF65      RCALL	_Round
    02A8C 9310 066B STS	Result+52,R17
    02A8E 9300 066A STS	Result+51,R16
    02A90 9330 066D STS	Result+54,R19
    02A92 9320 066C STS	Result+53,R18
(0321)   //温度
(0322)  Result.Temperature=read_T_NUM(OUTSIDE_SENSOR); //读两次 避免出错
    02A94 E001      LDI	R16,1
    02A95 940E 41D3 CALL	_read_T_NUM
    02A97 9310 0661 STS	Result+42,R17
    02A99 9300 0660 STS	Result+41,R16
    02A9B 9330 0663 STS	Result+44,R19
    02A9D 9320 0662 STS	Result+43,R18
(0323)  Result.Temperature=read_T_NUM(OUTSIDE_SENSOR);
    02A9F E001      LDI	R16,1
    02AA0 940E 41D3 CALL	_read_T_NUM
    02AA2 9310 0661 STS	Result+42,R17
    02AA4 9300 0660 STS	Result+41,R16
    02AA6 9330 0663 STS	Result+44,R19
    02AA8 9320 0662 STS	Result+43,R18
(0324)  //四舍五入
(0325)  Result.Temperature=Round(Result.Temperature);
    02AAA DF46      RCALL	_Round
    02AAB 9310 0661 STS	Result+42,R17
    02AAD 9300 0660 STS	Result+41,R16
    02AAF 9330 0663 STS	Result+44,R19
    02AB1 9320 0662 STS	Result+43,R18
(0326)  //WCI风冷指数
(0327)   Result.WCI = 4.18 *(10*SquareRootFloat(Result.WindSpeed) + 10.45 -  Result.WindSpeed  ) *( 33 - Result.Temperature );
    02AB3 9120 066C LDS	R18,Result+53
    02AB5 9130 066D LDS	R19,Result+54
    02AB7 9100 066A LDS	R16,Result+51
    02AB9 9110 066B LDS	R17,Result+52
    02ABB D1FB      RCALL	_SquareRootFloat
    02ABC 0118      MOVW	R2,R16
    02ABD 0129      MOVW	R4,R18
    02ABE EA06      LDI	R16,0xA6
    02ABF E010      LDI	R17,0
    02AC0 940E 484B CALL	elpm32
    02AC2 0138      MOVW	R6,R16
    02AC3 0149      MOVW	R8,R18
    02AC4 EB06      LDI	R16,0xB6
    02AC5 E010      LDI	R17,0
    02AC6 940E 484B CALL	elpm32
    02AC8 925A      ST	-Y,R5
    02AC9 924A      ST	-Y,R4
    02ACA 923A      ST	-Y,R3
    02ACB 922A      ST	-Y,R2
    02ACC 940E 4C13 CALL	fpmule2
    02ACE 0118      MOVW	R2,R16
    02ACF 0129      MOVW	R4,R18
    02AD0 EA02      LDI	R16,0xA2
    02AD1 E010      LDI	R17,0
    02AD2 940E 484B CALL	elpm32
    02AD4 933A      ST	-Y,R19
    02AD5 932A      ST	-Y,R18
    02AD6 931A      ST	-Y,R17
    02AD7 930A      ST	-Y,R16
    02AD8 0181      MOVW	R16,R2
    02AD9 0192      MOVW	R18,R4
    02ADA 940E 49FF CALL	fpadd2
    02ADC E68A      LDI	R24,0x6A
    02ADD E096      LDI	R25,6
    02ADE 939A      ST	-Y,R25
    02ADF 938A      ST	-Y,R24
    02AE0 940E 4A1F CALL	fpsub1x
    02AE2 0183      MOVW	R16,R6
    02AE3 0194      MOVW	R18,R8
    02AE4 940E 4C13 CALL	fpmule2
    02AE6 0118      MOVW	R2,R16
    02AE7 0129      MOVW	R4,R18
    02AE8 E90E      LDI	R16,0x9E
    02AE9 E010      LDI	R17,0
    02AEA 940E 484B CALL	elpm32
    02AEC E680      LDI	R24,0x60
    02AED E096      LDI	R25,6
    02AEE 939A      ST	-Y,R25
    02AEF 938A      ST	-Y,R24
    02AF0 940E 4A1F CALL	fpsub1x
    02AF2 0181      MOVW	R16,R2
    02AF3 0192      MOVW	R18,R4
    02AF4 940E 4C13 CALL	fpmule2
    02AF6 9310 0674 STS	Result+61,R17
    02AF8 9300 0673 STS	Result+60,R16
    02AFA 9330 0676 STS	Result+63,R19
    02AFC 9320 0675 STS	Result+62,R18
(0328)  //ECT等价制冷温度
(0329)  Result.ECT=33.0f - 0.01085f*Result.WCI;
    02AFE E90E      LDI	R16,0x9E
    02AFF E010      LDI	R17,0
    02B00 940E 484B CALL	elpm32
    02B02 0118      MOVW	R2,R16
    02B03 0129      MOVW	R4,R18
    02B04 E90A      LDI	R16,0x9A
    02B05 E010      LDI	R17,0
    02B06 940E 484B CALL	elpm32
    02B08 E783      LDI	R24,0x73
    02B09 E096      LDI	R25,6
    02B0A 939A      ST	-Y,R25
    02B0B 938A      ST	-Y,R24
    02B0C 940E 4C1E CALL	fpmule1x
    02B0E 0181      MOVW	R16,R2
    02B0F 0192      MOVW	R18,R4
    02B10 940E 4A14 CALL	fpsub2
    02B12 9310 0680 STS	Result+73,R17
    02B14 9300 067F STS	Result+72,R16
    02B16 9330 0682 STS	Result+75,R19
    02B18 9320 0681 STS	Result+74,R18
(0330)  //TEQ 相当温度
(0331)  Result.Teq = Result.Temperature +( (Result.Temperature -36)/10 ) * Result.WindSpeed ;
    02B1A 9040 0662 LDS	R4,Result+43
    02B1C 9050 0663 LDS	R5,Result+44
    02B1E 9020 0660 LDS	R2,Result+41
    02B20 9030 0661 LDS	R3,Result+42
    02B22 0131      MOVW	R6,R2
    02B23 0142      MOVW	R8,R4
    02B24 E906      LDI	R16,0x96
    02B25 E010      LDI	R17,0
    02B26 940E 484B CALL	elpm32
    02B28 933A      ST	-Y,R19
    02B29 932A      ST	-Y,R18
    02B2A 931A      ST	-Y,R17
    02B2B 930A      ST	-Y,R16
    02B2C 0183      MOVW	R16,R6
    02B2D 0194      MOVW	R18,R8
    02B2E 940E 4A14 CALL	fpsub2
    02B30 0138      MOVW	R6,R16
    02B31 0149      MOVW	R8,R18
    02B32 EB06      LDI	R16,0xB6
    02B33 E010      LDI	R17,0
    02B34 940E 484B CALL	elpm32
    02B36 933A      ST	-Y,R19
    02B37 932A      ST	-Y,R18
    02B38 931A      ST	-Y,R17
    02B39 930A      ST	-Y,R16
    02B3A 0183      MOVW	R16,R6
    02B3B 0194      MOVW	R18,R8
    02B3C 940E 4A99 CALL	fpdiv2
    02B3E E68A      LDI	R24,0x6A
    02B3F E096      LDI	R25,6
    02B40 939A      ST	-Y,R25
    02B41 938A      ST	-Y,R24
    02B42 940E 4C1E CALL	fpmule1x
    02B44 0181      MOVW	R16,R2
    02B45 0192      MOVW	R18,R4
    02B46 940E 49FF CALL	fpadd2
    02B48 9310 068A STS	Result+83,R17
    02B4A 9300 0689 STS	Result+82,R16
    02B4C 9330 068C STS	Result+85,R19
    02B4E 9320 068B STS	Result+84,R18
(0332) //将数据转换成字符串
(0333) sprintf(Result.WSChar, "%#.1lf", (float)Result.WindSpeed);
    02B50 9040 066C LDS	R4,Result+53
    02B52 9050 066D LDS	R5,Result+54
    02B54 9020 066A LDS	R2,Result+51
    02B56 9030 066B LDS	R3,Result+52
    02B58 8228      ST	Y,R2
    02B59 8239      STD	Y+1,R3
    02B5A 824A      STD	Y+2,R4
    02B5B 825B      STD	Y+3,R5
    02B5C EE25      LDI	R18,0xE5
    02B5D E031      LDI	R19,1
    02B5E E60E      LDI	R16,0x6E
    02B5F E016      LDI	R17,6
    02B60 940E 5040 CALL	_sprintf
(0334) sprintf(Result.TempChar, "%#.1lf", (float)Result.Temperature); //PrintString_n(Result.TempChar);
    02B62 9040 0662 LDS	R4,Result+43
    02B64 9050 0663 LDS	R5,Result+44
    02B66 9020 0660 LDS	R2,Result+41
    02B68 9030 0661 LDS	R3,Result+42
    02B6A 8228      ST	Y,R2
    02B6B 8239      STD	Y+1,R3
    02B6C 824A      STD	Y+2,R4
    02B6D 825B      STD	Y+3,R5
    02B6E EE25      LDI	R18,0xE5
    02B6F E031      LDI	R19,1
    02B70 E604      LDI	R16,0x64
    02B71 E016      LDI	R17,6
    02B72 940E 5040 CALL	_sprintf
(0335) sprintf(Result.WCIChar, "%#.1lf",  (float)Result.WCI); //PrintString_n(Result.WCIChar);
    02B74 9040 0675 LDS	R4,Result+62
    02B76 9050 0676 LDS	R5,Result+63
    02B78 9020 0673 LDS	R2,Result+60
    02B7A 9030 0674 LDS	R3,Result+61
    02B7C 8228      ST	Y,R2
    02B7D 8239      STD	Y+1,R3
    02B7E 824A      STD	Y+2,R4
    02B7F 825B      STD	Y+3,R5
    02B80 EE25      LDI	R18,0xE5
    02B81 E031      LDI	R19,1
    02B82 E707      LDI	R16,0x77
    02B83 E016      LDI	R17,6
    02B84 940E 5040 CALL	_sprintf
(0336) sprintf(Result.ECTChar, "%#.1lf", (float)Result.ECT);  //PrintString_n(Result.ECTChar);
    02B86 9040 0681 LDS	R4,Result+74
    02B88 9050 0682 LDS	R5,Result+75
    02B8A 9020 067F LDS	R2,Result+72
    02B8C 9030 0680 LDS	R3,Result+73
    02B8E 8228      ST	Y,R2
    02B8F 8239      STD	Y+1,R3
    02B90 824A      STD	Y+2,R4
    02B91 825B      STD	Y+3,R5
    02B92 EE25      LDI	R18,0xE5
    02B93 E031      LDI	R19,1
    02B94 E803      LDI	R16,0x83
    02B95 E016      LDI	R17,6
    02B96 940E 5040 CALL	_sprintf
(0337) sprintf(Result.TeqChar, "%#.1lf", (float)Result.Teq);
    02B98 9040 068B LDS	R4,Result+84
    02B9A 9050 068C LDS	R5,Result+85
    02B9C 9020 0689 LDS	R2,Result+82
    02B9E 9030 068A LDS	R3,Result+83
    02BA0 8228      ST	Y,R2
    02BA1 8239      STD	Y+1,R3
    02BA2 824A      STD	Y+2,R4
    02BA3 825B      STD	Y+3,R5
    02BA4 EE25      LDI	R18,0xE5
    02BA5 E031      LDI	R19,1
    02BA6 E80D      LDI	R16,0x8D
    02BA7 E016      LDI	R17,6
    02BA8 940E 5040 CALL	_sprintf
(0338) sprintf(Result.IndexChar, "%d", Result.Index);
    02BAA 9040 0643 LDS	R4,Result+12
    02BAC 9050 0644 LDS	R5,Result+13
    02BAE 9020 0641 LDS	R2,Result+10
    02BB0 9030 0642 LDS	R3,Result+11
    02BB2 8228      ST	Y,R2
    02BB3 8239      STD	Y+1,R3
    02BB4 824A      STD	Y+2,R4
    02BB5 825B      STD	Y+3,R5
    02BB6 EE22      LDI	R18,0xE2
    02BB7 E031      LDI	R19,1
    02BB8 E405      LDI	R16,0x45
    02BB9 E016      LDI	R17,6
    02BBA 940E 5040 CALL	_sprintf
(0339) Result.TempChar[6]='\0';
    02BBC 2422      CLR	R2
    02BBD 9220 066A STS	Result+51,R2
(0340) Result.WSChar[5]='\0';
    02BBF 9220 0673 STS	Result+60,R2
(0341) Result.WCIChar[7]='\0';
    02BC1 9220 067E STS	Result+71,R2
(0342) Result.ECTChar[6]='\0';
    02BC3 9220 0689 STS	Result+82,R2
(0343) Result.TeqChar[6]='\0';
    02BC5 9220 0693 STS	Result+92,R2
(0344)  return ;
    02BC7 9624      ADIW	R28,4
    02BC8 940C 48A3 JMP	pop_xgset003C
_StructToChar:
  otherbyte            --> Y,+16
  ary                  --> Y,+0
  i                    --> R10
    02BCA 92AA      ST	-Y,R10
    02BCB 9768      SBIW	R28,0x18
(0345) }
(0346) /*
(0347) ////////////////////////////////////////////
(0348) //				字符串转换函数
(0349) //   浮点 到  字符串
(0350) ////////////////////////////////////////////
(0351) void ftochr(float a,char * dest){//float
(0352) char i=0,j=0,lenth;
(0353) int status;
(0354) char *res;
(0355)  res=ftoa(a,&status);  //float to ascii
(0356) lenth=strlen(res);
(0357) 
(0358) for(i=0;i <lenth;i++) 
(0359)        {
(0360) 	   	dest[i]=res[i];
(0361) 
(0362) 		if( res[i]=='.'  ) 
(0363) 			{
(0364) 				dest[i+1]=res[i+1];
(0365) 					dest[i+2]='\0';
(0366) 						return ;    
(0367) 		    }
(0368)  
(0369)  		}
(0370) }
(0371) //////////////////////////////////////////////////////
(0372) //              整型数据变字符串
(0373) //    a  到  dest
(0374) ///////////////////////////////////////////////////////
(0375) void itochr(int a,char * dest){ //int to ascii
(0376) 	 itoa(dest,a,10); 
(0377) }
(0378) */
(0379) //////////////////////////////////////////////////////
(0380) //                  结构体 变字符串
(0381) // 将目前存于结构体的数据转换到Temp_Char中。
(0382) ///////////////////////////////////////////////////////
(0383) void  StructToChar(void)
(0384) { 
(0385)   unsigned char i;
(0386)   char otherbyte[]="0\t0\t0\t0";
    02BCC EB84      LDI	R24,0xB4
    02BCD E091      LDI	R25,1
    02BCE 01FE      MOVW	R30,R28
    02BCF 9670      ADIW	R30,0x10
    02BD0 E008      LDI	R16,0x8
    02BD1 E010      LDI	R17,0
    02BD2 93FA      ST	-Y,R31
    02BD3 93EA      ST	-Y,R30
    02BD4 939A      ST	-Y,R25
    02BD5 938A      ST	-Y,R24
    02BD6 940E 4973 CALL	asgnblk
(0387)   char *(ary[])={Result.IndexChar,Result.Date,Result.Time,
    02BD8 EB8C      LDI	R24,0xBC
    02BD9 E091      LDI	R25,1
    02BDA 01FE      MOVW	R30,R28
    02BDB E100      LDI	R16,0x10
    02BDC E010      LDI	R17,0
    02BDD 93FA      ST	-Y,R31
    02BDE 93EA      ST	-Y,R30
    02BDF 939A      ST	-Y,R25
    02BE0 938A      ST	-Y,R24
    02BE1 940E 4973 CALL	asgnblk
(0388)  	  			Result.TempChar,Result.WSChar,Result.WCIChar,Result.ECTChar,
(0389) 				Result.TeqChar
(0390) 			   };  //指向数组首地址的指针
(0391)   //strcat(Temp_Char,Result.Name);
(0392)   for(i=0;i<=80;i++) TempChar[i]='\0';  //清空数组
    02BE3 24AA      CLR	R10
    02BE4 C009      RJMP	0x2BEE
    02BE5 EE87      LDI	R24,0xE7
    02BE6 E095      LDI	R25,5
    02BE7 2DEA      MOV	R30,R10
    02BE8 27FF      CLR	R31
    02BE9 0FE8      ADD	R30,R24
    02BEA 1FF9      ADC	R31,R25
    02BEB 2422      CLR	R2
    02BEC 8220      ST	Z,R2
    02BED 94A3      INC	R10
    02BEE E580      LDI	R24,0x50
    02BEF 158A      CP	R24,R10
    02BF0 F7A0      BCC	0x2BE5
(0393)     for(i=0;i<=7;i++){
    02BF1 24AA      CLR	R10
    02BF2 C014      RJMP	0x2C07
(0394) 		strcat(TempChar,ary[i]);  // 按顺序复制字符串
    02BF3 01CE      MOVW	R24,R28
    02BF4 2DEA      MOV	R30,R10
    02BF5 27FF      CLR	R31
    02BF6 0FEE      LSL	R30
    02BF7 1FFF      ROL	R31
    02BF8 0FE8      ADD	R30,R24
    02BF9 1FF9      ADC	R31,R25
    02BFA 8120      LD	R18,Z
    02BFB 8131      LDD	R19,Z+1
    02BFC EE07      LDI	R16,0xE7
    02BFD E015      LDI	R17,5
    02BFE 940E 4765 CALL	_strcat
(0395) 		strcat(TempChar,tab);     // 字串结尾加上制表符
    02C00 E02F      LDI	R18,0xF
    02C01 E031      LDI	R19,1
    02C02 EE07      LDI	R16,0xE7
    02C03 E015      LDI	R17,5
    02C04 940E 4765 CALL	_strcat
    02C06 94A3      INC	R10
    02C07 E087      LDI	R24,7
    02C08 158A      CP	R24,R10
    02C09 F748      BCC	0x2BF3
(0396)     }
(0397) 				 
(0398) 				 otherbyte[0]=otherbyte[0]+Result.WeiHai;
    02C0A 9020 0693 LDS	R2,Result+92
    02C0C 8838      LDD	R3,Y+16
    02C0D 0C32      ADD	R3,R2
    02C0E 8A38      STD	Y+16,R3
(0399) 				 otherbyte[2]=otherbyte[0]+Result.LowLabor;
    02C0F 9020 0694 LDS	R2,Result+93
    02C11 0C32      ADD	R3,R2
    02C12 8A3A      STD	Y+18,R3
(0400) 				 otherbyte[4]=otherbyte[0]+Result.MidLabor;
    02C13 9020 0695 LDS	R2,Result+94
    02C15 8838      LDD	R3,Y+16
    02C16 0C32      ADD	R3,R2
    02C17 8A3C      STD	Y+20,R3
(0401) 				 otherbyte[6]=otherbyte[0]+Result.HighLabor;
    02C18 9020 0696 LDS	R2,Result+95
    02C1A 8838      LDD	R3,Y+16
    02C1B 0C32      ADD	R3,R2
    02C1C 8A3E      STD	Y+22,R3
(0402)  
(0403)   strcat(TempChar,otherbyte);  
    02C1D 019E      MOVW	R18,R28
    02C1E 5F20      SUBI	R18,0xF0
    02C1F 4F3F      SBCI	R19,0xFF
    02C20 EE07      LDI	R16,0xE7
    02C21 E015      LDI	R17,5
    02C22 940E 4765 CALL	_strcat
(0404)   strcat(TempChar,enter);  
    02C24 E122      LDI	R18,0x12
    02C25 E031      LDI	R19,1
    02C26 EE07      LDI	R16,0xE7
    02C27 E015      LDI	R17,5
    02C28 940E 4765 CALL	_strcat
(0405)   strcat(TempChar,"\0");
    02C2A EE20      LDI	R18,0xE0
    02C2B E031      LDI	R19,1
    02C2C EE07      LDI	R16,0xE7
    02C2D E015      LDI	R17,5
    02C2E 940E 4765 CALL	_strcat
    02C30 9668      ADIW	R28,0x18
    02C31 90A9      LD	R10,Y+
    02C32 9508      RET
_CharToStruct:
  ary                  --> Y,+0
  j                    --> R12
  p                    --> R10
  q                    --> R20
  buf                  --> R14
    02C33 940E 48C5 CALL	push_xgset30FC
    02C35 0178      MOVW	R14,R16
    02C36 9760      SBIW	R28,0x10
(0406) }
(0407) 
(0408) //////////////////////////////////////////////////////
(0409) //               字符串  变  结构体
(0410) // 
(0411) ///////////////////////////////////////////////////////
(0412) void CharToStruct(char *buf)
(0413) {
(0414)   unsigned char j=0;
    02C37 24CC      CLR	R12
(0415)   unsigned char *p,*q;
(0416)   char *(ary[])={Result.IndexChar,Result.Date,Result.Time,
    02C38 EC8C      LDI	R24,0xCC
    02C39 E091      LDI	R25,1
    02C3A 01FE      MOVW	R30,R28
    02C3B E100      LDI	R16,0x10
    02C3C E010      LDI	R17,0
    02C3D 93FA      ST	-Y,R31
    02C3E 93EA      ST	-Y,R30
    02C3F 939A      ST	-Y,R25
    02C40 938A      ST	-Y,R24
    02C41 940E 4973 CALL	asgnblk
(0417)  	  			Result.TempChar,Result.WSChar,Result.WCIChar,Result.ECTChar,
(0418) 				Result.TeqChar
(0419) 			   };  //指向数组首地址的指针
(0420)     p=ary[j];
    02C43 01CE      MOVW	R24,R28
    02C44 2DEC      MOV	R30,R12
    02C45 27FF      CLR	R31
    02C46 0FEE      LSL	R30
    02C47 1FFF      ROL	R31
    02C48 0FE8      ADD	R30,R24
    02C49 1FF9      ADC	R31,R25
    02C4A 80A0      LD	R10,Z
    02C4B 80B1      LDD	R11,Z+1
(0421) 	q=buf;
    02C4C 01A7      MOVW	R20,R14
    02C4D C026      RJMP	0x2C74
(0422) 	
(0423) 	while(1){
(0424)     if(*q =='\n') {*p='\0'; return;} ;
    02C4E 01FA      MOVW	R30,R20
    02C4F 8180      LD	R24,Z
    02C50 308A      CPI	R24,0xA
    02C51 F421      BNE	0x2C56
    02C52 2422      CLR	R2
    02C53 01F5      MOVW	R30,R10
    02C54 8220      ST	Z,R2
    02C55 C01F      RJMP	0x2C75
(0425) 	if(*q =='\t') {
    02C56 01FA      MOVW	R30,R20
    02C57 8180      LD	R24,Z
    02C58 3089      CPI	R24,0x9
    02C59 F4A1      BNE	0x2C6E
(0426) 		*p='\0';
    02C5A 2422      CLR	R2
    02C5B 01F5      MOVW	R30,R10
    02C5C 8220      ST	Z,R2
(0427) 		q++;
    02C5D 5F4F      SUBI	R20,0xFF
    02C5E 4F5F      SBCI	R21,0xFF
(0428) 	    if(j>7) break ;
    02C5F E087      LDI	R24,7
    02C60 158C      CP	R24,R12
    02C61 F408      BCC	0x2C63
    02C62 C012      RJMP	0x2C75
(0429) 		j++;
    02C63 94C3      INC	R12
(0430) 		p=ary[j];
    02C64 01CE      MOVW	R24,R28
    02C65 2DEC      MOV	R30,R12
    02C66 27FF      CLR	R31
    02C67 0FEE      LSL	R30
    02C68 1FFF      ROL	R31
    02C69 0FE8      ADD	R30,R24
    02C6A 1FF9      ADC	R31,R25
    02C6B 80A0      LD	R10,Z
    02C6C 80B1      LDD	R11,Z+1
(0431) 		continue ;
    02C6D C006      RJMP	0x2C74
(0432) 	}
(0433)     *p++=*q++;
    02C6E 01FA      MOVW	R30,R20
    02C6F 01D5      MOVW	R26,R10
    02C70 9001      LD	R0,Z+
    02C71 01AF      MOVW	R20,R30
    02C72 920D      ST	X+,R0
    02C73 015D      MOVW	R10,R26
    02C74 CFD9      RJMP	0x2C4E
    02C75 9660      ADIW	R28,0x10
    02C76 940C 48AF JMP	pop_xgset30FC
_get_name:
  i                    --> R20
  filenamep            --> R16
    02C78 940E 48D8 CALL	push_xgsetF000
(0434) 	}
(0435) 	return ;
(0436) }
(0437)  
(0438)  ////////////////////////////////////////////
(0439) //				根据当前日期获取文件名
(0440) //   
(0441) ////////////////////////////////////////////
(0442) char *get_name( char filenamep[] ){     
(0443) 	  unsigned char i=0;
(0444)  	  for(i=0;i<6;i++) {
    02C7A 2744      CLR	R20
    02C7B C00D      RJMP	0x2C89
(0445) 	  				    *(filenamep+i)=Result.Date[i];
    02C7C E48D      LDI	R24,0x4D
    02C7D E096      LDI	R25,6
    02C7E 2FE4      MOV	R30,R20
    02C7F 27FF      CLR	R31
    02C80 0FE8      ADD	R30,R24
    02C81 1FF9      ADC	R31,R25
    02C82 8020      LD	R2,Z
    02C83 2FE4      MOV	R30,R20
    02C84 27FF      CLR	R31
    02C85 0FE0      ADD	R30,R16
    02C86 1FF1      ADC	R31,R17
    02C87 8220      ST	Z,R2
    02C88 9543      INC	R20
    02C89 3046      CPI	R20,6
    02C8A F388      BCS	0x2C7C
(0446) 	  				   } 
(0447) 	 	*(filenamep+(i++))='.';
    02C8B 2E24      MOV	R2,R20
    02C8C 2433      CLR	R3
    02C8D 5F4F      SUBI	R20,0xFF
    02C8E 2DE2      MOV	R30,R2
    02C8F 27FF      CLR	R31
    02C90 0FE0      ADD	R30,R16
    02C91 1FF1      ADC	R31,R17
    02C92 E28E      LDI	R24,0x2E
    02C93 8380      ST	Z,R24
(0448) 		*(filenamep+(i++))='x';
    02C94 2E24      MOV	R2,R20
    02C95 2433      CLR	R3
    02C96 5F4F      SUBI	R20,0xFF
    02C97 2DE2      MOV	R30,R2
    02C98 27FF      CLR	R31
    02C99 0FE0      ADD	R30,R16
    02C9A 1FF1      ADC	R31,R17
    02C9B E788      LDI	R24,0x78
    02C9C 8380      ST	Z,R24
(0449) 		*(filenamep+(i++))='l';
    02C9D 2F64      MOV	R22,R20
    02C9E 2777      CLR	R23
    02C9F 5F4F      SUBI	R20,0xFF
    02CA0 2FE6      MOV	R30,R22
    02CA1 27FF      CLR	R31
    02CA2 0FE0      ADD	R30,R16
    02CA3 1FF1      ADC	R31,R17
    02CA4 E68C      LDI	R24,0x6C
    02CA5 8380      ST	Z,R24
(0450) 		*(filenamep+(i++))='s';
    02CA6 2F64      MOV	R22,R20
    02CA7 2777      CLR	R23
    02CA8 5F4F      SUBI	R20,0xFF
    02CA9 2FE6      MOV	R30,R22
    02CAA 27FF      CLR	R31
    02CAB 0FE0      ADD	R30,R16
    02CAC 1FF1      ADC	R31,R17
    02CAD E783      LDI	R24,0x73
    02CAE 8380      ST	Z,R24
(0451) 		*(filenamep+(i))='\0';
    02CAF 2FE4      MOV	R30,R20
    02CB0 27FF      CLR	R31
    02CB1 0FE0      ADD	R30,R16
    02CB2 1FF1      ADC	R31,R17
    02CB3 2422      CLR	R2
    02CB4 8220      ST	Z,R2
(0452) 					   
(0453)       return filenamep;
    02CB5 940C 48DD JMP	pop_xgsetF000
_SquareRootFloat:
  f                    --> Y,+12
  x                    --> Y,+8
  i                    --> Y,+4
  y                    --> Y,+0
  number               --> Y,+20
    02CB7 940E 477E CALL	push_arg4
    02CB9 940E 48D8 CALL	push_xgsetF000
    02CBB 9760      SBIW	R28,0x10
(0454) } 
(0455) float SquareRootFloat(float number)
(0456) {
(0457)     long i;
(0458)     float x, y;
(0459)     const float f = 1.5F;
    02CBC E902      LDI	R16,0x92
    02CBD E010      LDI	R17,0
    02CBE 940E 484B CALL	elpm32
    02CC0 870C      STD	Y+12,R16
    02CC1 871D      STD	Y+13,R17
    02CC2 872E      STD	Y+14,R18
    02CC3 873F      STD	Y+15,R19
(0460)     x = number * 0.5F;
    02CC4 E80E      LDI	R16,0x8E
    02CC5 E010      LDI	R17,0
    02CC6 940E 484B CALL	elpm32
    02CC8 01CE      MOVW	R24,R28
    02CC9 9644      ADIW	R24,0x14
    02CCA 939A      ST	-Y,R25
    02CCB 938A      ST	-Y,R24
    02CCC 940E 4C09 CALL	fpmule1
    02CCE 8708      STD	Y+8,R16
    02CCF 8719      STD	Y+9,R17
    02CD0 872A      STD	Y+10,R18
    02CD1 873B      STD	Y+11,R19
(0461)     y  = number;
    02CD2 882C      LDD	R2,Y+20
    02CD3 883D      LDD	R3,Y+21
    02CD4 884E      LDD	R4,Y+22
    02CD5 885F      LDD	R5,Y+23
    02CD6 8228      ST	Y,R2
    02CD7 8239      STD	Y+1,R3
    02CD8 824A      STD	Y+2,R4
    02CD9 825B      STD	Y+3,R5
(0462)     i  = * ( long * ) &y;
    02CDA 01FE      MOVW	R30,R28
    02CDB 8020      LD	R2,Z
    02CDC 8031      LDD	R3,Z+1
    02CDD 8042      LDD	R4,Z+2
    02CDE 8053      LDD	R5,Z+3
    02CDF 822C      STD	Y+4,R2
    02CE0 823D      STD	Y+5,R3
    02CE1 824E      STD	Y+6,R4
    02CE2 825F      STD	Y+7,R5
(0463)     i  = 0x5f3759df - ( i >> 1 );  //卡马克
    02CE3 802C      LDD	R2,Y+4
    02CE4 803D      LDD	R3,Y+5
    02CE5 804E      LDD	R4,Y+6
    02CE6 805F      LDD	R5,Y+7
    02CE7 9455      ASR	R5
    02CE8 9447      ROR	R4
    02CE9 9437      ROR	R3
    02CEA 9427      ROR	R2
    02CEB ED4F      LDI	R20,0xDF
    02CEC E559      LDI	R21,0x59
    02CED E367      LDI	R22,0x37
    02CEE E57F      LDI	R23,0x5F
    02CEF 1942      SUB	R20,R2
    02CF0 0953      SBC	R21,R3
    02CF1 0964      SBC	R22,R4
    02CF2 0975      SBC	R23,R5
    02CF3 834C      STD	Y+4,R20
    02CF4 835D      STD	Y+5,R21
    02CF5 836E      STD	Y+6,R22
    02CF6 837F      STD	Y+7,R23
(0464)   //i  = 0x5f375a86 - ( i >> 1 );  //Lomont
(0465)     y  = * ( float * ) &i;
    02CF7 01FE      MOVW	R30,R28
    02CF8 9634      ADIW	R30,4
    02CF9 8020      LD	R2,Z
    02CFA 8031      LDD	R3,Z+1
    02CFB 8042      LDD	R4,Z+2
    02CFC 8053      LDD	R5,Z+3
    02CFD 8228      ST	Y,R2
    02CFE 8239      STD	Y+1,R3
    02CFF 824A      STD	Y+2,R4
    02D00 825B      STD	Y+3,R5
(0466)     y  = y * ( f - ( x * y * y ) );
    02D01 8028      LD	R2,Y
    02D02 8039      LDD	R3,Y+1
    02D03 804A      LDD	R4,Y+2
    02D04 805B      LDD	R5,Y+3
    02D05 846C      LDD	R6,Y+12
    02D06 847D      LDD	R7,Y+13
    02D07 848E      LDD	R8,Y+14
    02D08 849F      LDD	R9,Y+15
    02D09 8508      LDD	R16,Y+8
    02D0A 8519      LDD	R17,Y+9
    02D0B 852A      LDD	R18,Y+10
    02D0C 853B      LDD	R19,Y+11
    02D0D 01CE      MOVW	R24,R28
    02D0E 939A      ST	-Y,R25
    02D0F 938A      ST	-Y,R24
    02D10 940E 4C09 CALL	fpmule1
    02D12 01CE      MOVW	R24,R28
    02D13 939A      ST	-Y,R25
    02D14 938A      ST	-Y,R24
    02D15 940E 4C1E CALL	fpmule1x
    02D17 0183      MOVW	R16,R6
    02D18 0194      MOVW	R18,R8
    02D19 940E 4A2C CALL	fpsub2x
    02D1B 0181      MOVW	R16,R2
    02D1C 0192      MOVW	R18,R4
    02D1D 940E 4C13 CALL	fpmule2
    02D1F 8308      ST	Y,R16
    02D20 8319      STD	Y+1,R17
    02D21 832A      STD	Y+2,R18
    02D22 833B      STD	Y+3,R19
(0467)     y  = y * ( f - ( x * y * y ) );
    02D23 8028      LD	R2,Y
    02D24 8039      LDD	R3,Y+1
    02D25 804A      LDD	R4,Y+2
    02D26 805B      LDD	R5,Y+3
    02D27 846C      LDD	R6,Y+12
    02D28 847D      LDD	R7,Y+13
    02D29 848E      LDD	R8,Y+14
    02D2A 849F      LDD	R9,Y+15
    02D2B 8508      LDD	R16,Y+8
    02D2C 8519      LDD	R17,Y+9
    02D2D 852A      LDD	R18,Y+10
    02D2E 853B      LDD	R19,Y+11
    02D2F 01CE      MOVW	R24,R28
    02D30 939A      ST	-Y,R25
    02D31 938A      ST	-Y,R24
    02D32 940E 4C09 CALL	fpmule1
    02D34 01CE      MOVW	R24,R28
    02D35 939A      ST	-Y,R25
    02D36 938A      ST	-Y,R24
    02D37 940E 4C1E CALL	fpmule1x
    02D39 0183      MOVW	R16,R6
    02D3A 0194      MOVW	R18,R8
    02D3B 940E 4A2C CALL	fpsub2x
    02D3D 0181      MOVW	R16,R2
    02D3E 0192      MOVW	R18,R4
    02D3F 940E 4C13 CALL	fpmule2
    02D41 8308      ST	Y,R16
    02D42 8319      STD	Y+1,R17
    02D43 832A      STD	Y+2,R18
    02D44 833B      STD	Y+3,R19
(0468)     return number * y;
    02D45 890C      LDD	R16,Y+20
    02D46 891D      LDD	R17,Y+21
    02D47 892E      LDD	R18,Y+22
    02D48 893F      LDD	R19,Y+23
    02D49 01CE      MOVW	R24,R28
    02D4A 939A      ST	-Y,R25
    02D4B 938A      ST	-Y,R24
    02D4C 940E 4C09 CALL	fpmule1
    02D4E 9660      ADIW	R28,0x10
    02D4F 940E 48DD CALL	pop_xgsetF000
    02D51 9624      ADIW	R28,4
    02D52 9508      RET
_debug:
  str2                 --> Y,+0
  val                  --> Y,+6
  str                  --> Y,+4
    02D53 940E 477E CALL	push_arg4
    02D55 9724      SBIW	R28,4
(0469) } 
(0470) //
(0471) //###############################################################//
(0472) //debug
(0473) void debug(UINT8 *str,UINT8 val)
(0474) {
(0475)  UINT8 str2[4]={0,0,0,0};
    02D56 ED8C      LDI	R24,0xDC
    02D57 E091      LDI	R25,1
    02D58 01FE      MOVW	R30,R28
    02D59 E004      LDI	R16,4
    02D5A E010      LDI	R17,0
    02D5B 93FA      ST	-Y,R31
    02D5C 93EA      ST	-Y,R30
    02D5D 939A      ST	-Y,R25
    02D5E 938A      ST	-Y,R24
    02D5F 940E 4973 CALL	asgnblk
(0476)  str=str;
(0477)  val=val;
    02D61 9628      ADIW	R28,0x8
    02D62 9508      RET
_SD_Write_cmd:
  k                    --> R22
  temp                 --> R20
  p                    --> R20
    02D63 940E 48D8 CALL	push_xgsetF000
    02D65 01A8      MOVW	R20,R16
FILE: D:\LQD\software\software_src\sd.c
(0001) //*****************************************************************************//
(0002) //*								数码相框
(0003) //*控制芯片：ATmgea128
(0004) //*开发环境：AVR Studio+GCC
(0005) //*隶属模块：SD卡控制
(0006) //*修改者：  桃子
(0007) //*****************************************************************************//
(0008) #include "sd.h"
(0009) 
(0010) //****************************************************************
(0011) //*隶属模块：SD卡控制
(0012) //*函数功能：写6字节数据
(0013) //****************************************************************
(0014) UINT8 SD_Write_cmd(UINT8 *p)
(0015) {	
(0016) 	UINT16 temp,k=0;
    02D66 2766      CLR	R22
    02D67 2777      CLR	R23
(0017) 	SD_CS_DIS();//禁止SPI
    02D68 9AC0      SBI	0x18,0
(0018) 	SPI_Read();//空读一字节
    02D69 940E 3C64 CALL	_SPI_Read
(0019) 	SD_CS_EN();//使能SPI
    02D6B 98C0      CBI	0x18,0
(0020) 
(0021) 	SPI_Write(p[0]);
    02D6C 01FA      MOVW	R30,R20
    02D6D 8100      LD	R16,Z
    02D6E 940E 3C60 CALL	_SPI_Write
(0022) 	SPI_Write(p[1]);
    02D70 01FA      MOVW	R30,R20
    02D71 8101      LDD	R16,Z+1
    02D72 940E 3C60 CALL	_SPI_Write
(0023) 	SPI_Write(p[2]);
    02D74 01FA      MOVW	R30,R20
    02D75 8102      LDD	R16,Z+2
    02D76 940E 3C60 CALL	_SPI_Write
(0024) 	SPI_Write(p[3]);
    02D78 01FA      MOVW	R30,R20
    02D79 8103      LDD	R16,Z+3
    02D7A 940E 3C60 CALL	_SPI_Write
(0025) 	SPI_Write(p[4]);
    02D7C 01FA      MOVW	R30,R20
    02D7D 8104      LDD	R16,Z+4
    02D7E 940E 3C60 CALL	_SPI_Write
(0026) 	SPI_Write(p[5]);
    02D80 01FA      MOVW	R30,R20
    02D81 8105      LDD	R16,Z+5
    02D82 940E 3C60 CALL	_SPI_Write
(0027) 
(0028) 	do 
(0029)  	{  
(0030)   		temp = SPI_Read();//一直读，直到读到的不是0xff或超时
    02D84 940E 3C64 CALL	_SPI_Read
    02D86 2F40      MOV	R20,R16
    02D87 2755      CLR	R21
(0031)  		k++;
    02D88 5F6F      SUBI	R22,0xFF
    02D89 4F7F      SBCI	R23,0xFF
(0032)  	}while((temp==0xff)&&(k<TRY_TIME)); 
    02D8A 3F4F      CPI	R20,0xFF
    02D8B E0E0      LDI	R30,0
    02D8C 075E      CPC	R21,R30
    02D8D F421      BNE	0x2D92
    02D8E 3164      CPI	R22,0x14
    02D8F E0E0      LDI	R30,0
    02D90 077E      CPC	R23,R30
    02D91 F390      BCS	0x2D84
(0033) 
(0034) 	return temp;
    02D92 2F04      MOV	R16,R20
    02D93 940C 48DD JMP	pop_xgsetF000
_SD_Init:
  pcmd                 --> Y,+0
  temp                 --> R22
  time                 --> R20
    02D95 940E 48E2 CALL	push_xgsetF00C
    02D97 9726      SBIW	R28,6
(0035) }
(0036) //****************************************************************
(0037) //*隶属模块：SD卡控制
(0038) //*函数功能：初始化
(0039) //****************************************************************
(0040) UINT8 SD_Init(void)	
(0041) {  
(0042) 	UINT8 time=0,temp=0;
    02D98 2744      CLR	R20
    02D99 2766      CLR	R22
(0043) 	UINT8 pcmd[] = {0x40,0x00,0x00,0x00,0x00,0x95}; //命令0的字节序列
    02D9A E88F      LDI	R24,0x8F
    02D9B E092      LDI	R25,2
    02D9C 01FE      MOVW	R30,R28
    02D9D E006      LDI	R16,6
    02D9E E010      LDI	R17,0
    02D9F 93FA      ST	-Y,R31
    02DA0 93EA      ST	-Y,R30
    02DA1 939A      ST	-Y,R25
    02DA2 938A      ST	-Y,R24
    02DA3 940E 4973 CALL	asgnblk
(0044) 	if(SD_DET()==0) return 0x02; //no disk
    02DA5 B181      IN	R24,0x01
    02DA6 9586      LSR	R24
    02DA7 9586      LSR	R24
    02DA8 9586      LSR	R24
    02DA9 9586      LSR	R24
    02DAA 9586      LSR	R24
    02DAB 7081      ANDI	R24,1
    02DAC F421      BNE	0x2DB1
    02DAD E081      LDI	R24,1
    02DAE E090      LDI	R25,0
    02DAF 015C      MOVW	R10,R24
    02DB0 C002      RJMP	0x2DB3
    02DB1 24AA      CLR	R10
    02DB2 24BB      CLR	R11
    02DB3 20AA      TST	R10
    02DB4 F421      BNE	0x2DB9
    02DB5 20BB      TST	R11
    02DB6 F411      BNE	0x2DB9
    02DB7 E002      LDI	R16,2
    02DB8 C039      RJMP	0x2DF2
(0045) 	SD_PORT |= (1<<SD_CS);
    02DB9 9AC0      SBI	0x18,0
(0046) 	SD_DDR |= (1<<SD_CS);
    02DBA 9AB8      SBI	0x17,0
(0047) 
(0048) 	SPI_IO_Init();
    02DBB 940E 3C56 CALL	_SPI_IO_Init
(0049) 	SPI_Low();
    02DBD E582      LDI	R24,0x52
    02DBE B98D      OUT	0x0D,R24
    02DBF B18E      IN	R24,0x0E
    02DC0 7F8F      ANDI	R24,0xFF
    02DC1 B98E      OUT	0x0E,R24
(0050) 
(0051) 	SD_CS_DIS();  //关闭片选 
    02DC2 9AC0      SBI	0x18,0
(0052) 	for(time=0;time<10;time++) //初始时，首先要发送最少74个时钟信号，这是必须的！！！
    02DC3 2744      CLR	R20
    02DC4 C003      RJMP	0x2DC8
(0053) 	{
(0054)   		SPI_Read(); 
    02DC5 940E 3C64 CALL	_SPI_Read
    02DC7 9543      INC	R20
    02DC8 304A      CPI	R20,0xA
    02DC9 F3D8      BCS	0x2DC5
(0055) 	}
(0056) 	SD_CS_EN(); //打开片选
    02DCA 98C0      CBI	0x18,0
(0057) 	time = 0;
    02DCB 2744      CLR	R20
(0058) 	do
(0059) 	{ 
(0060) 		temp=SD_Write_cmd(pcmd);//写入CMD0
    02DCC 018E      MOVW	R16,R28
    02DCD DF95      RCALL	_SD_Write_cmd
    02DCE 2F60      MOV	R22,R16
(0061) 	 	time++;
    02DCF 9543      INC	R20
(0062) 	 	if(time==TRY_TIME) 
    02DD0 3144      CPI	R20,0x14
    02DD1 F419      BNE	0x2DD5
(0063) 	 	{ 
(0064) 	  		SD_CS_DIS(); //关闭片选
    02DD2 9AC0      SBI	0x18,0
(0065) 	  		return(INIT_CMD0_ERROR);//CMD0写入失败
    02DD3 E001      LDI	R16,1
    02DD4 C01D      RJMP	0x2DF2
(0066) 	 	}
(0067) 	 }while(temp!=0x01);
    02DD5 3061      CPI	R22,1
    02DD6 F7A9      BNE	0x2DCC
(0068) 
(0069) 	SD_CS_DIS(); //关闭片选
    02DD7 9AC0      SBI	0x18,0
(0070) 	SPI_Read(); //按照SD卡的操作时序在这里补8个时钟 
    02DD8 940E 3C64 CALL	_SPI_Read
(0071) 	SD_CS_EN(); //打开片选
    02DDA 98C0      CBI	0x18,0
(0072) 
(0073) 	pcmd[0]=0x41,pcmd[5]=0xff;
    02DDB E481      LDI	R24,0x41
    02DDC 8388      ST	Y,R24
    02DDD EF8F      LDI	R24,0xFF
    02DDE 838D      STD	Y+5,R24
(0074) 	time = 0;
    02DDF 2744      CLR	R20
(0075) 	do
(0076) 	{ 
(0077) 		temp=SD_Write_cmd(pcmd);
    02DE0 018E      MOVW	R16,R28
    02DE1 DF81      RCALL	_SD_Write_cmd
    02DE2 2F60      MOV	R22,R16
(0078) 		time++;
    02DE3 9543      INC	R20
(0079) 		if(time==TRY_TIME) 
    02DE4 3144      CPI	R20,0x14
    02DE5 F419      BNE	0x2DE9
(0080) 		{ 
(0081) 		 	SD_CS_DIS(); //关闭片选
    02DE6 9AC0      SBI	0x18,0
(0082) 			 return(INIT_CMD1_ERROR);//CMD1写入失败
    02DE7 E002      LDI	R16,2
    02DE8 C009      RJMP	0x2DF2
(0083) 		 }
(0084) 	 }while(temp!=0);
    02DE9 2366      TST	R22
    02DEA F7A9      BNE	0x2DE0
(0085)   
(0086) 	 SPI_High();  
    02DEB E580      LDI	R24,0x50
    02DEC B98D      OUT	0x0D,R24
    02DED 9A70      SBI	0x0E,0
(0087) 	 SD_CS_DIS();  //关闭片选 
    02DEE 9AC0      SBI	0x18,0
(0088) 	 SPI_Read(); //按照SD卡的操作时序在这里补8个时钟
    02DEF 940E 3C64 CALL	_SPI_Read
(0089) 	 return SD_TURE; //返回0,说明初始化操作成功
    02DF1 2700      CLR	R16
    02DF2 9626      ADIW	R28,6
    02DF3 940C 48E9 JMP	pop_xgsetF00C
_SD_Write_Sector:
  pcmd                 --> Y,+0
  time                 --> R12
  temp                 --> R20
  i                    --> R22
  buffer               --> R10
  addr                 --> Y,+14
    02DF5 940E 477E CALL	push_arg4
    02DF7 940E 48FE CALL	push_xgsetF03C
    02DF9 9726      SBIW	R28,6
    02DFA 88AA      LDD	R10,Y+18
    02DFB 88BB      LDD	R11,Y+19
(0090) } 
(0091) //****************************************************************
(0092) //*隶属模块：SD卡控制
(0093) //*函数功能：写512字节数据（一扇区字节）
(0094) //****************************************************************
(0095) UINT16 SD_Write_Sector(UINT32 addr,UINT8 *buffer)
(0096) {  
(0097) 	UINT8 temp=0,time=0;
    02DFC 2744      CLR	R20
    02DFD 24CC      CLR	R12
(0098) 	UINT16 i=0;
    02DFE 2766      CLR	R22
    02DFF 2777      CLR	R23
(0099) 	UINT8 pcmd[] = {0x58,0x00,0x00,0x00,0x00,0xff}; //向SD卡中单个块（512字节，一个扇区）写入数据，用CMD24
    02E00 E985      LDI	R24,0x95
    02E01 E092      LDI	R25,2
    02E02 01FE      MOVW	R30,R28
    02E03 E006      LDI	R16,6
    02E04 E010      LDI	R17,0
    02E05 93FA      ST	-Y,R31
    02E06 93EA      ST	-Y,R30
    02E07 939A      ST	-Y,R25
    02E08 938A      ST	-Y,R24
    02E09 940E 4973 CALL	asgnblk
(0100) 
(0101) 	 addr<<=9; //将块地址（扇区地址）转为字节地址 ［这里就限制了SD卡的最大容量为4G］
    02E0B E089      LDI	R24,0x9
    02E0C E090      LDI	R25,0
    02E0D 850E      LDD	R16,Y+14
    02E0E 851F      LDD	R17,Y+15
    02E0F 8928      LDD	R18,Y+16
    02E10 8939      LDD	R19,Y+17
    02E11 938A      ST	-Y,R24
    02E12 940E 494E CALL	lsl32
    02E14 870E      STD	Y+14,R16
    02E15 871F      STD	Y+15,R17
    02E16 8B28      STD	Y+16,R18
    02E17 8B39      STD	Y+17,R19
(0102) 
(0103) 	 pcmd[1]=(addr>>24); //将字节地址写入到CMD24字节序列中
    02E18 E188      LDI	R24,0x18
    02E19 E090      LDI	R25,0
    02E1A 850E      LDD	R16,Y+14
    02E1B 851F      LDD	R17,Y+15
    02E1C 8928      LDD	R18,Y+16
    02E1D 8939      LDD	R19,Y+17
    02E1E 938A      ST	-Y,R24
    02E1F 940E 4967 CALL	lsr32
    02E21 8309      STD	Y+1,R16
(0104) 	 pcmd[2]=(addr>>16);
    02E22 842E      LDD	R2,Y+14
    02E23 843F      LDD	R3,Y+15
    02E24 8848      LDD	R4,Y+16
    02E25 8859      LDD	R5,Y+17
    02E26 0112      MOVW	R2,R4
    02E27 2444      CLR	R4
    02E28 2455      CLR	R5
    02E29 822A      STD	Y+2,R2
(0105) 	 pcmd[3]=(addr>>8);
    02E2A E088      LDI	R24,0x8
    02E2B E090      LDI	R25,0
    02E2C 850E      LDD	R16,Y+14
    02E2D 851F      LDD	R17,Y+15
    02E2E 8928      LDD	R18,Y+16
    02E2F 8939      LDD	R19,Y+17
    02E30 938A      ST	-Y,R24
    02E31 940E 4967 CALL	lsr32
    02E33 830B      STD	Y+3,R16
(0106) 	// pcmd[4]=offset;	
(0107) 	 SD_CS_EN();//打开SD卡片选
    02E34 98C0      CBI	0x18,0
(0108) 
(0109) 	 do
(0110) 	 {  
(0111) 		temp=SD_Write_cmd(pcmd);
    02E35 018E      MOVW	R16,R28
    02E36 DF2C      RCALL	_SD_Write_cmd
    02E37 2F40      MOV	R20,R16
(0112)   		time++;
    02E38 94C3      INC	R12
(0113)   		if(time==TRY_TIME) 
    02E39 2D8C      MOV	R24,R12
    02E3A 3184      CPI	R24,0x14
    02E3B F419      BNE	0x2E3F
(0114)   		{ 
(0115)    			SD_CS_DIS(); //关闭片选
    02E3C 9AC0      SBI	0x18,0
(0116)    			return(temp); //命令写入失败
    02E3D 2711      CLR	R17
    02E3E C037      RJMP	0x2E76
(0117)   		}
(0118) 	}while(temp!=0); 
    02E3F 2344      TST	R20
    02E40 F7A1      BNE	0x2E35
(0119) 
(0120) 	for(i=0;i<100;i++) //这里要插入若干时钟信号
    02E41 2766      CLR	R22
    02E42 2777      CLR	R23
    02E43 C004      RJMP	0x2E48
(0121)   		SPI_Read();
    02E44 940E 3C64 CALL	_SPI_Read
    02E46 5F6F      SUBI	R22,0xFF
    02E47 4F7F      SBCI	R23,0xFF
    02E48 3664      CPI	R22,0x64
    02E49 E0E0      LDI	R30,0
    02E4A 077E      CPC	R23,R30
    02E4B F3C0      BCS	0x2E44
(0122) 	
(0123) 	SPI_Write(0xfe);//写入开始字节 0xfe，后面就是要写入的512个字节的数据	
    02E4C EF0E      LDI	R16,0xFE
    02E4D 940E 3C60 CALL	_SPI_Write
(0124) 	
(0125) 	for(i=0;i<512;i++) //将缓冲区中要写入的512个字节写入SD卡
    02E4F 2766      CLR	R22
    02E50 2777      CLR	R23
    02E51 C007      RJMP	0x2E59
(0126) 		SPI_Write(*buffer++);
    02E52 01F5      MOVW	R30,R10
    02E53 9101      LD	R16,Z+
    02E54 015F      MOVW	R10,R30
    02E55 940E 3C60 CALL	_SPI_Write
    02E57 5F6F      SUBI	R22,0xFF
    02E58 4F7F      SBCI	R23,0xFF
    02E59 3060      CPI	R22,0
    02E5A E0E2      LDI	R30,2
    02E5B 077E      CPC	R23,R30
    02E5C F3A8      BCS	0x2E52
(0127)   
(0128) 	SPI_Read(); 
    02E5D 940E 3C64 CALL	_SPI_Read
(0129) 	SPI_Read(); //两个字节的CRC校验码，不用关心
    02E5F 940E 3C64 CALL	_SPI_Read
(0130)    
(0131)     
(0132) 	temp=SPI_Read();   //读取返回值
    02E61 940E 3C64 CALL	_SPI_Read
    02E63 2F40      MOV	R20,R16
(0133) 	if((temp&0x1F)!=0x05) //如果返回值是 XXX00101说明数据已经被SD卡接受了
    02E64 2F84      MOV	R24,R20
    02E65 718F      ANDI	R24,0x1F
    02E66 3085      CPI	R24,5
    02E67 F021      BEQ	0x2E6C
(0134) 	{
(0135)  		SD_CS_DIS();
    02E68 9AC0      SBI	0x18,0
(0136)  		return(WRITE_BLOCK_ERROR); //写块数据失败
    02E69 E003      LDI	R16,3
    02E6A E010      LDI	R17,0
    02E6B C00A      RJMP	0x2E76
(0137) 	}
(0138)  
(0139) 	while(SPI_Read()!=0xff);//等到SD卡不忙（数据被接受以后，SD卡要将这些数据写入到自身的FLASH中，需要一个时间）
    02E6C 940E 3C64 CALL	_SPI_Read
    02E6E 2F40      MOV	R20,R16
    02E6F 3F0F      CPI	R16,0xFF
    02E70 F7D9      BNE	0x2E6C
(0140) 						    //忙时，读回来的值为0x00,不忙时，为0xff
(0141) 
(0142) 	SD_CS_DIS(); //关闭片选
    02E71 9AC0      SBI	0x18,0
(0143) 
(0144) 	SPI_Read();//按照SD卡的操作时序在这里补8个时钟
    02E72 940E 3C64 CALL	_SPI_Read
(0145) 	return SD_TURE;		 //返回0,说明写扇区操作成功
    02E74 2700      CLR	R16
    02E75 2711      CLR	R17
    02E76 9626      ADIW	R28,6
    02E77 940E 4907 CALL	pop_xgsetF03C
    02E79 9624      ADIW	R28,4
    02E7A 9508      RET
_SD_Read_Sector:
  pcmd                 --> Y,+0
  temp                 --> R12
  time                 --> R22
  j                    --> R20
  buffer               --> R10
  addr                 --> Y,+14
    02E7B 940E 477E CALL	push_arg4
    02E7D 940E 48FE CALL	push_xgsetF03C
    02E7F 9726      SBIW	R28,6
    02E80 88AA      LDD	R10,Y+18
    02E81 88BB      LDD	R11,Y+19
(0146) } 
(0147) //****************************************************************
(0148) //*隶属模块：SD卡控制
(0149) //*函数功能：读512字节数据（一扇区字节）
(0150) //****************************************************************
(0151) UINT16 SD_Read_Sector(UINT32 addr,UINT8 *buffer)//从SD卡的指定扇区中读出512个字节，使用CMD17（17号命令）
(0152) {
(0153) 
(0154) 	 UINT16 j=0;
    02E82 2744      CLR	R20
    02E83 2755      CLR	R21
(0155) 	 UINT8 time=0,temp=0;
    02E84 2766      CLR	R22
    02E85 24CC      CLR	R12
(0156) 	 UINT8 pcmd[]={0x51,0x00,0x00,0x00,0x00,0xff}; //CMD17的字节序列
    02E86 E98B      LDI	R24,0x9B
    02E87 E092      LDI	R25,2
    02E88 01FE      MOVW	R30,R28
    02E89 E006      LDI	R16,6
    02E8A E010      LDI	R17,0
    02E8B 93FA      ST	-Y,R31
    02E8C 93EA      ST	-Y,R30
    02E8D 939A      ST	-Y,R25
    02E8E 938A      ST	-Y,R24
    02E8F 940E 4973 CALL	asgnblk
(0157) 
(0158) 	 addr <<= 9; //将块地址（扇区地址）转为字节地址
    02E91 E089      LDI	R24,0x9
    02E92 E090      LDI	R25,0
    02E93 850E      LDD	R16,Y+14
    02E94 851F      LDD	R17,Y+15
    02E95 8928      LDD	R18,Y+16
    02E96 8939      LDD	R19,Y+17
    02E97 938A      ST	-Y,R24
    02E98 940E 494E CALL	lsl32
    02E9A 870E      STD	Y+14,R16
    02E9B 871F      STD	Y+15,R17
    02E9C 8B28      STD	Y+16,R18
    02E9D 8B39      STD	Y+17,R19
(0159) 
(0160) 	 pcmd[1] = (addr>>24);//将字节地址写入到CMD17字节序列中
    02E9E E188      LDI	R24,0x18
    02E9F E090      LDI	R25,0
    02EA0 850E      LDD	R16,Y+14
    02EA1 851F      LDD	R17,Y+15
    02EA2 8928      LDD	R18,Y+16
    02EA3 8939      LDD	R19,Y+17
    02EA4 938A      ST	-Y,R24
    02EA5 940E 4967 CALL	lsr32
    02EA7 8309      STD	Y+1,R16
(0161) 	 pcmd[2] = (addr>>16);
    02EA8 842E      LDD	R2,Y+14
    02EA9 843F      LDD	R3,Y+15
    02EAA 8848      LDD	R4,Y+16
    02EAB 8859      LDD	R5,Y+17
    02EAC 0112      MOVW	R2,R4
    02EAD 2444      CLR	R4
    02EAE 2455      CLR	R5
    02EAF 822A      STD	Y+2,R2
(0162) 	 pcmd[3] =(addr>>8);
    02EB0 E088      LDI	R24,0x8
    02EB1 E090      LDI	R25,0
    02EB2 850E      LDD	R16,Y+14
    02EB3 851F      LDD	R17,Y+15
    02EB4 8928      LDD	R18,Y+16
    02EB5 8939      LDD	R19,Y+17
    02EB6 938A      ST	-Y,R24
    02EB7 940E 4967 CALL	lsr32
    02EB9 830B      STD	Y+3,R16
(0163) 	// pcmd[4] = offset;
(0164) 
(0165) 	 SD_CS_EN();//打开片选 
    02EBA 98C0      CBI	0x18,0
(0166) 
(0167) 	 do
(0168) 	 {  
(0169) 		  temp=SD_Write_cmd(pcmd); //写入CMD17
    02EBB 018E      MOVW	R16,R28
    02EBC DEA6      RCALL	_SD_Write_cmd
    02EBD 2EC0      MOV	R12,R16
(0170) 		  time++;
    02EBE 9563      INC	R22
(0171) 		  if(time==TRY_TIME) 
    02EBF 3164      CPI	R22,0x14
    02EC0 F421      BNE	0x2EC5
(0172) 		  {
(0173) 		   SD_CS_DIS();
    02EC1 9AC0      SBI	0x18,0
(0174) 		   return(READ_BLOCK_ERROR); //读块失败
    02EC2 E004      LDI	R16,4
    02EC3 E010      LDI	R17,0
    02EC4 C01F      RJMP	0x2EE4
(0175) 		  }
(0176) 	 }while(temp!=0); 
    02EC5 20CC      TST	R12
    02EC6 F7A1      BNE	0x2EBB
(0177)    			
(0178) 	 while(SPI_Read()!= 0xfe); //一直读，当读到0xfe时，说明后面的是512字节的数据了
    02EC7 940E 3C64 CALL	_SPI_Read
    02EC9 3F0E      CPI	R16,0xFE
    02ECA F7E1      BNE	0x2EC7
(0179)  		   	   	
(0180) 	 for(j=0;j<512;j++)	 //将数据写入到数据缓冲区中
    02ECB 2744      CLR	R20
    02ECC 2755      CLR	R21
    02ECD C009      RJMP	0x2ED7
(0181) 	 {	
(0182) 	    buffer[j]=SPI_Read();
    02ECE 940E 3C64 CALL	_SPI_Read
    02ED0 2EC0      MOV	R12,R16
    02ED1 01FA      MOVW	R30,R20
    02ED2 0DEA      ADD	R30,R10
    02ED3 1DFB      ADC	R31,R11
    02ED4 82C0      ST	Z,R12
    02ED5 5F4F      SUBI	R20,0xFF
    02ED6 4F5F      SBCI	R21,0xFF
    02ED7 3040      CPI	R20,0
    02ED8 E0E2      LDI	R30,2
    02ED9 075E      CPC	R21,R30
    02EDA F398      BCS	0x2ECE
(0183) 	 }
(0184) 
(0185) 	 SPI_Read();//读取两个字节的CRC校验码，不用关心它们
    02EDB 940E 3C64 CALL	_SPI_Read
(0186) 	 SPI_Read();
    02EDD 940E 3C64 CALL	_SPI_Read
(0187) 
(0188) 	 SD_CS_DIS();  //SD卡关闭片选 
    02EDF 9AC0      SBI	0x18,0
(0189) 
(0190) 	 SPI_Read();//按照SD卡的操作时序在这里补8个时钟
    02EE0 940E 3C64 CALL	_SPI_Read
(0191) 
(0192) 	 return SD_TURE;
    02EE2 2700      CLR	R16
    02EE3 2711      CLR	R17
    02EE4 9626      ADIW	R28,6
    02EE5 940E 4907 CALL	pop_xgsetF03C
    02EE7 9624      ADIW	R28,4
    02EE8 9508      RET
_SD_Read_Sector_ndata:
  pcmd                 --> Y,+0
  temp                 --> R12
  time                 --> R22
  j                    --> R20
  len                  --> R14
  offset               --> R10
  buffer               --> Y,+20
  addr                 --> Y,+16
    02EE9 940E 477E CALL	push_arg4
    02EEB 940E 48C3 CALL	push_xgsetF0FC
    02EED 9726      SBIW	R28,6
    02EEE 88AE      LDD	R10,Y+22
    02EEF 88BF      LDD	R11,Y+23
    02EF0 8CE8      LDD	R14,Y+24
    02EF1 8CF9      LDD	R15,Y+25
(0193) }
(0194) //****************************************************************
(0195) //*隶属模块：SD卡控制
(0196) //*函数功能：写多扇区数据（多扇区字节）
(0197) //****************************************************************
(0198) UINT16 SD_Read_Sector_ndata(UINT32 addr,UINT8 *buffer,UINT16 offset,UINT16 len)//从SD卡的指定扇区中读出512个字节，使用CMD17（17号命令）
(0199) {
(0200) 
(0201) 	 UINT16 j=0;
    02EF2 2744      CLR	R20
    02EF3 2755      CLR	R21
(0202) 	 UINT8 time=0,temp=0;
    02EF4 2766      CLR	R22
    02EF5 24CC      CLR	R12
(0203) 	 UINT8 pcmd[]={0x51,0x00,0x00,0x00,0x00,0xff}; //CMD17的字节序列
    02EF6 EA81      LDI	R24,0xA1
    02EF7 E092      LDI	R25,2
    02EF8 01FE      MOVW	R30,R28
    02EF9 E006      LDI	R16,6
    02EFA E010      LDI	R17,0
    02EFB 93FA      ST	-Y,R31
    02EFC 93EA      ST	-Y,R30
    02EFD 939A      ST	-Y,R25
    02EFE 938A      ST	-Y,R24
    02EFF 940E 4973 CALL	asgnblk
(0204) 
(0205) 	 addr <<= 9; //将块地址（扇区地址）转为字节地址
    02F01 E089      LDI	R24,0x9
    02F02 E090      LDI	R25,0
    02F03 8908      LDD	R16,Y+16
    02F04 8919      LDD	R17,Y+17
    02F05 892A      LDD	R18,Y+18
    02F06 893B      LDD	R19,Y+19
    02F07 938A      ST	-Y,R24
    02F08 940E 494E CALL	lsl32
    02F0A 8B08      STD	Y+16,R16
    02F0B 8B19      STD	Y+17,R17
    02F0C 8B2A      STD	Y+18,R18
    02F0D 8B3B      STD	Y+19,R19
(0206) 
(0207) 	 pcmd[1] = (addr>>24);//将字节地址写入到CMD17字节序列中
    02F0E E188      LDI	R24,0x18
    02F0F E090      LDI	R25,0
    02F10 8908      LDD	R16,Y+16
    02F11 8919      LDD	R17,Y+17
    02F12 892A      LDD	R18,Y+18
    02F13 893B      LDD	R19,Y+19
    02F14 938A      ST	-Y,R24
    02F15 940E 4967 CALL	lsr32
    02F17 8309      STD	Y+1,R16
(0208) 	 pcmd[2] = (addr>>16);
    02F18 8828      LDD	R2,Y+16
    02F19 8839      LDD	R3,Y+17
    02F1A 884A      LDD	R4,Y+18
    02F1B 885B      LDD	R5,Y+19
    02F1C 0112      MOVW	R2,R4
    02F1D 2444      CLR	R4
    02F1E 2455      CLR	R5
    02F1F 822A      STD	Y+2,R2
(0209) 	 pcmd[3] =(addr>>8);
    02F20 E088      LDI	R24,0x8
    02F21 E090      LDI	R25,0
    02F22 8908      LDD	R16,Y+16
    02F23 8919      LDD	R17,Y+17
    02F24 892A      LDD	R18,Y+18
    02F25 893B      LDD	R19,Y+19
    02F26 938A      ST	-Y,R24
    02F27 940E 4967 CALL	lsr32
    02F29 830B      STD	Y+3,R16
(0210) 	// pcmd[4] = offset;
(0211) 
(0212) 	 SD_CS_EN();//打开片选 
    02F2A 98C0      CBI	0x18,0
(0213) 
(0214) 	 do
(0215) 	 {  
(0216) 		  temp=SD_Write_cmd(pcmd); //写入CMD17
    02F2B 018E      MOVW	R16,R28
    02F2C DE36      RCALL	_SD_Write_cmd
    02F2D 2EC0      MOV	R12,R16
(0217) 		  time++;
    02F2E 9563      INC	R22
(0218) 		  if(time==TRY_TIME) 
    02F2F 3164      CPI	R22,0x14
    02F30 F421      BNE	0x2F35
(0219) 		  {
(0220) 		   SD_CS_DIS();
    02F31 9AC0      SBI	0x18,0
(0221) 		   return(READ_BLOCK_ERROR); //读块失败
    02F32 E004      LDI	R16,4
    02F33 E010      LDI	R17,0
    02F34 C034      RJMP	0x2F69
(0222) 		  }
(0223) 	 }while(temp!=0); 
    02F35 20CC      TST	R12
    02F36 F7A1      BNE	0x2F2B
(0224)    			
(0225) 	 while(SPI_Read()!= 0xfe); //一直读，当读到0xfe时，说明后面的是512字节的数据了
    02F37 940E 3C64 CALL	_SPI_Read
    02F39 3F0E      CPI	R16,0xFE
    02F3A F7E1      BNE	0x2F37
(0226)  		   	   	
(0227) 	 for(j=0;j<offset;j++)	 //将数据写入到数据缓冲区中
    02F3B 2744      CLR	R20
    02F3C 2755      CLR	R21
    02F3D C004      RJMP	0x2F42
(0228) 	    SPI_Read();
    02F3E 940E 3C64 CALL	_SPI_Read
    02F40 5F4F      SUBI	R20,0xFF
    02F41 4F5F      SBCI	R21,0xFF
    02F42 154A      CP	R20,R10
    02F43 055B      CPC	R21,R11
    02F44 F3C8      BCS	0x2F3E
(0229) 	 for(;j<offset+len;j++)	 
    02F45 C00B      RJMP	0x2F51
(0230) 		buffer[j]=SPI_Read();
    02F46 940E 3C64 CALL	_SPI_Read
    02F48 2F60      MOV	R22,R16
    02F49 01FA      MOVW	R30,R20
    02F4A 880C      LDD	R0,Y+20
    02F4B 881D      LDD	R1,Y+21
    02F4C 0DE0      ADD	R30,R0
    02F4D 1DF1      ADC	R31,R1
    02F4E 8360      ST	Z,R22
    02F4F 5F4F      SUBI	R20,0xFF
    02F50 4F5F      SBCI	R21,0xFF
    02F51 0115      MOVW	R2,R10
    02F52 0C2E      ADD	R2,R14
    02F53 1C3F      ADC	R3,R15
    02F54 1542      CP	R20,R2
    02F55 0553      CPC	R21,R3
    02F56 F378      BCS	0x2F46
(0231) 	 for(;j<512;j++)	 
    02F57 C004      RJMP	0x2F5C
(0232) 		SPI_Read();
    02F58 940E 3C64 CALL	_SPI_Read
    02F5A 5F4F      SUBI	R20,0xFF
    02F5B 4F5F      SBCI	R21,0xFF
    02F5C 3040      CPI	R20,0
    02F5D E0E2      LDI	R30,2
    02F5E 075E      CPC	R21,R30
    02F5F F3C0      BCS	0x2F58
(0233) 
(0234) 	 SPI_Read();//读取两个字节的CRC校验码，不用关心它们
    02F60 940E 3C64 CALL	_SPI_Read
(0235) 	 SPI_Read();
    02F62 940E 3C64 CALL	_SPI_Read
(0236) 
(0237) 	 SD_CS_DIS();  //SD卡关闭片选 
    02F64 9AC0      SBI	0x18,0
(0238) 
(0239) 	 SPI_Read();//按照SD卡的操作时序在这里补8个时钟
    02F65 940E 3C64 CALL	_SPI_Read
(0240) 
(0241) 	 return SD_TURE;
    02F67 2700      CLR	R16
    02F68 2711      CLR	R17
    02F69 9626      ADIW	R28,6
    02F6A 940E 48B8 CALL	pop_xgsetF0FC
    02F6C 9624      ADIW	R28,4
    02F6D 9508      RET
_GUI_mainmeu:
  key                  --> R22
  select               --> R20
    02F6E 940E 48E2 CALL	push_xgsetF00C
    02F70 9723      SBIW	R28,3
FILE: D:\LQD\software\software_src\gui.c
(0001) #include "config.h"
(0002) const char labelH[]="高强度作业：\0";
(0003) const char labelM[]="中等强度作业：\0";
(0004) const char labelL[]="低强度作业：\0";
(0005) const char H01[]="加强劳动监督；\0";
(0006) const char H02[]="增加饮水;\0" ;
(0007) const char H03[]="保持干燥禁裸露。\0";
(0008) #define M01 H01
(0009) #define M02 H03
(0010) const char M03[]="戴面罩。\0";
(0011) const char M04[]="禁油彩。\0";
(0012) #define L01 M03
(0013) #define L02 M04
(0014) const char L03[]="缩短作业时间。";
(0015) //-----//
(0016) #define H11 M04
(0017) #define H12 H03
(0018) const char H13[]="休息注意保暖。\0";
(0019) #define M11 H01
(0020) const char M12[]="减少非必须作业；\0";
(0021) const char M13[]="劳动时间<30min。\0";
(0022) const char L11[]="取消非必须的作业\0";
(0023) const char L12[]="劳动时间<15min；\0";
(0024) #define L13 H03
(0025) //-----//
(0026) #define H21 L11
(0027) #define H22 L12
(0028) #define H23 H03
(0029) const char M21[]="取消户外作业。"; 
(0030) #define L21 M21
(0031) const char str_blank[]="----------------"; 
(0032) //#define LEDON   PORTC&=~(1<<7)					   
(0033) //#define LEDOFF  PINC|=(1<<7)
(0034) char GUI_date[17]="09月19日18:00:00\0";
(0035) 
(0036) // 主菜单
(0037) unsigned char GUI_mainmeu( void ){
(0038)  	unsigned char key=0; //init= nokey
    02F71 2766      CLR	R22
(0039) 	unsigned char select=3;
    02F72 E043      LDI	R20,3
(0040) 	LCD_CLR();
    02F73 940E 3D44 CALL	_LCD_CLR
(0041) 	
(0042)  	Set_White(1,1,8,1);
    02F75 E081      LDI	R24,1
    02F76 838A      STD	Y+2,R24
    02F77 E088      LDI	R24,0x8
    02F78 8388      ST	Y,R24
    02F79 E021      LDI	R18,1
    02F7A E001      LDI	R16,1
    02F7B 940E 3DCE CALL	_Set_White
(0043) 	Set_White(1,2,8,1);
    02F7D E081      LDI	R24,1
    02F7E 838A      STD	Y+2,R24
    02F7F E088      LDI	R24,0x8
    02F80 8388      ST	Y,R24
    02F81 E022      LDI	R18,2
    02F82 E001      LDI	R16,1
    02F83 940E 3DCE CALL	_Set_White
(0044) 	Set_White(1,3,8,1);
    02F85 E081      LDI	R24,1
    02F86 838A      STD	Y+2,R24
    02F87 E088      LDI	R24,0x8
    02F88 8388      ST	Y,R24
    02F89 E023      LDI	R18,3
    02F8A E001      LDI	R16,1
    02F8B 940E 3DCE CALL	_Set_White
(0045) 	Set_White(1,4,8,1);
    02F8D E081      LDI	R24,1
    02F8E 838A      STD	Y+2,R24
    02F8F E088      LDI	R24,0x8
    02F90 8388      ST	Y,R24
    02F91 E024      LDI	R18,4
    02F92 E001      LDI	R16,1
    02F93 940E 3DCE CALL	_Set_White
(0046) 	dateRefresh(1); //更新系统时间
    02F95 E001      LDI	R16,1
    02F96 940E 3937 CALL	_dateRefresh
(0047) 	LCD_const_disp(1,1,GUI_get_date()); //显示时间
    02F98 D55B      RCALL	_GUI_get_date
    02F99 8319      STD	Y+1,R17
    02F9A 8308      ST	Y,R16
    02F9B E021      LDI	R18,1
    02F9C E001      LDI	R16,1
    02F9D 940E 3C9E CALL	_LCD_const_disp
(0048) 	LCD_const_disp(2,1,"  检测  时钟调整");
    02F9F EA8C      LDI	R24,0xAC
    02FA0 E095      LDI	R25,5
    02FA1 8399      STD	Y+1,R25
    02FA2 8388      ST	Y,R24
    02FA3 E021      LDI	R18,1
    02FA4 E002      LDI	R16,2
    02FA5 940E 3C9E CALL	_LCD_const_disp
(0049) 	LCD_const_disp(3,1,"  查询  数据传输");
    02FA7 E98B      LDI	R24,0x9B
    02FA8 E095      LDI	R25,5
    02FA9 8399      STD	Y+1,R25
    02FAA 8388      ST	Y,R24
    02FAB E021      LDI	R18,1
    02FAC E003      LDI	R16,3
    02FAD 940E 3C9E CALL	_LCD_const_disp
(0050) 	LCD_const_disp(4,1,"  初始化");
    02FAF E982      LDI	R24,0x92
    02FB0 E095      LDI	R25,5
    02FB1 8399      STD	Y+1,R25
    02FB2 8388      ST	Y,R24
    02FB3 E021      LDI	R18,1
    02FB4 E004      LDI	R16,4
    02FB5 940E 3C9E CALL	_LCD_const_disp
(0051) 	Set_White(1,1,8,1);
    02FB7 E081      LDI	R24,1
    02FB8 838A      STD	Y+2,R24
    02FB9 E088      LDI	R24,0x8
    02FBA 8388      ST	Y,R24
    02FBB E021      LDI	R18,1
    02FBC E001      LDI	R16,1
    02FBD 940E 3DCE CALL	_Set_White
(0052) 	Set_White(1,2,8,1);
    02FBF E081      LDI	R24,1
    02FC0 838A      STD	Y+2,R24
    02FC1 E088      LDI	R24,0x8
    02FC2 8388      ST	Y,R24
    02FC3 E022      LDI	R18,2
    02FC4 E001      LDI	R16,1
    02FC5 940E 3DCE CALL	_Set_White
(0053) 	Set_White(1,3,8,1);
    02FC7 E081      LDI	R24,1
    02FC8 838A      STD	Y+2,R24
    02FC9 E088      LDI	R24,0x8
    02FCA 8388      ST	Y,R24
    02FCB E023      LDI	R18,3
    02FCC E001      LDI	R16,1
    02FCD 940E 3DCE CALL	_Set_White
(0054) 	Set_White(1,4,8,1);
    02FCF E081      LDI	R24,1
    02FD0 838A      STD	Y+2,R24
    02FD1 E088      LDI	R24,0x8
    02FD2 8388      ST	Y,R24
    02FD3 E024      LDI	R18,4
    02FD4 E001      LDI	R16,1
    02FD5 940E 3DCE CALL	_Set_White
(0055) 	set_white_n(select,0);
    02FD7 2722      CLR	R18
    02FD8 2F04      MOV	R16,R20
    02FD9 940E 3E60 CALL	_set_white_n
    02FDB C07F      RJMP	0x305B
(0056) 	while(1)
(0057) 	{
(0058) 	 	key=kbscan();
    02FDC 940E 42A4 CALL	_kbscan
    02FDE 2F60      MOV	R22,R16
(0059) 		dateRefresh(1); //更新系统时间
    02FDF E001      LDI	R16,1
    02FE0 940E 3937 CALL	_dateRefresh
(0060) 		heaterSwitch();
    02FE2 940E 25F0 CALL	_heaterSwitch
(0061) 		LCD_const_disp(1,1,GUI_get_date()); //显示时间
    02FE4 D50F      RCALL	_GUI_get_date
    02FE5 0158      MOVW	R10,R16
    02FE6 82B9      STD	Y+1,R11
    02FE7 82A8      ST	Y,R10
    02FE8 E021      LDI	R18,1
    02FE9 E001      LDI	R16,1
    02FEA 940E 3C9E CALL	_LCD_const_disp
(0062) 		if((select>3) && ( key==up ) ){
    02FEC E083      LDI	R24,3
    02FED 1784      CP	R24,R20
    02FEE F4F8      BCC	0x300E
    02FEF 316E      CPI	R22,0x1E
    02FF0 F4E9      BNE	0x300E
(0063) 		 Set_White(1,2,8,1);
    02FF1 E081      LDI	R24,1
    02FF2 838A      STD	Y+2,R24
    02FF3 E088      LDI	R24,0x8
    02FF4 8388      ST	Y,R24
    02FF5 E022      LDI	R18,2
    02FF6 E001      LDI	R16,1
    02FF7 940E 3DCE CALL	_Set_White
(0064) 		 Set_White(1,3,8,1);
    02FF9 E081      LDI	R24,1
    02FFA 838A      STD	Y+2,R24
    02FFB E088      LDI	R24,0x8
    02FFC 8388      ST	Y,R24
    02FFD E023      LDI	R18,3
    02FFE E001      LDI	R16,1
    02FFF 940E 3DCE CALL	_Set_White
(0065) 		 Set_White(1,4,8,1);
    03001 E081      LDI	R24,1
    03002 838A      STD	Y+2,R24
    03003 E088      LDI	R24,0x8
    03004 8388      ST	Y,R24
    03005 E024      LDI	R18,4
    03006 E001      LDI	R16,1
    03007 940E 3DCE CALL	_Set_White
(0066) 		 select--;
    03009 954A      DEC	R20
(0067) 		 set_white_n(select,0);
    0300A 2722      CLR	R18
    0300B 2F04      MOV	R16,R20
    0300C 940E 3E60 CALL	_set_white_n
(0068) 		}
(0069) 		if((select<7) && ( key==down ) ){
    0300E 3047      CPI	R20,7
    0300F F538      BCC	0x3037
    03010 316D      CPI	R22,0x1D
    03011 F529      BNE	0x3037
(0070) 		 Set_White(1,1,8,1);
    03012 E081      LDI	R24,1
    03013 838A      STD	Y+2,R24
    03014 E088      LDI	R24,0x8
    03015 8388      ST	Y,R24
    03016 E021      LDI	R18,1
    03017 E001      LDI	R16,1
    03018 940E 3DCE CALL	_Set_White
(0071) 		 Set_White(1,2,8,1);
    0301A E081      LDI	R24,1
    0301B 838A      STD	Y+2,R24
    0301C E088      LDI	R24,0x8
    0301D 8388      ST	Y,R24
    0301E E022      LDI	R18,2
    0301F E001      LDI	R16,1
    03020 940E 3DCE CALL	_Set_White
(0072) 		 Set_White(1,3,8,1);
    03022 E081      LDI	R24,1
    03023 838A      STD	Y+2,R24
    03024 E088      LDI	R24,0x8
    03025 8388      ST	Y,R24
    03026 E023      LDI	R18,3
    03027 E001      LDI	R16,1
    03028 940E 3DCE CALL	_Set_White
(0073) 		 Set_White(1,4,8,1);
    0302A E081      LDI	R24,1
    0302B 838A      STD	Y+2,R24
    0302C E088      LDI	R24,0x8
    0302D 8388      ST	Y,R24
    0302E E024      LDI	R18,4
    0302F E001      LDI	R16,1
    03030 940E 3DCE CALL	_Set_White
(0074) 		 select++;
    03032 9543      INC	R20
(0075) 		 set_white_n(select,0);
    03033 2722      CLR	R18
    03034 2F04      MOV	R16,R20
    03035 940E 3E60 CALL	_set_white_n
(0076) 		}
(0077) 		if(key == left ){
    03037 316B      CPI	R22,0x1B
    03038 F511      BNE	0x305B
(0078) 		 Set_White(1,1,8,1);
    03039 E081      LDI	R24,1
    0303A 838A      STD	Y+2,R24
    0303B E088      LDI	R24,0x8
    0303C 8388      ST	Y,R24
    0303D E021      LDI	R18,1
    0303E E001      LDI	R16,1
    0303F 940E 3DCE CALL	_Set_White
(0079) 		 Set_White(1,2,8,1);
    03041 E081      LDI	R24,1
    03042 838A      STD	Y+2,R24
    03043 E088      LDI	R24,0x8
    03044 8388      ST	Y,R24
    03045 E022      LDI	R18,2
    03046 E001      LDI	R16,1
    03047 940E 3DCE CALL	_Set_White
(0080) 		 Set_White(1,3,8,1);
    03049 E081      LDI	R24,1
    0304A 838A      STD	Y+2,R24
    0304B E088      LDI	R24,0x8
    0304C 8388      ST	Y,R24
    0304D E023      LDI	R18,3
    0304E E001      LDI	R16,1
    0304F 940E 3DCE CALL	_Set_White
(0081) 		 Set_White(1,4,8,1);
    03051 E081      LDI	R24,1
    03052 838A      STD	Y+2,R24
    03053 E088      LDI	R24,0x8
    03054 8388      ST	Y,R24
    03055 E024      LDI	R18,4
    03056 E001      LDI	R16,1
    03057 940E 3DCE CALL	_Set_White
(0082) 		 //beep(3,select);
(0083) 		 return select;
    03059 2F04      MOV	R16,R20
    0305A C001      RJMP	0x305C
    0305B CF80      RJMP	0x2FDC
    0305C 9623      ADIW	R28,3
    0305D 940C 48E9 JMP	pop_xgsetF00C
_GUI_check:
  windcounter          --> R10
  next_step_time       --> Y,+3
  selectCheckMode      --> R14
  is_on                --> Y,+8
  page                 --> Y,+7
  key                  --> R12
    0305F 940E 48C3 CALL	push_xgsetF0FC
    03061 9729      SBIW	R28,0x9
(0084) 		}
(0085)     }
(0086) 	return 0xff; //error
(0087) 	
(0088) }
(0089) 
(0090) //”检测 “菜单
(0091) void GUI_check(void){
(0092)     char key;
(0093) 	char page=0,is_on=0;
    03062 2400      CLR	R0
    03063 820F      STD	Y+7,R0
    03064 8608      STD	Y+8,R0
(0094) 	char windcounter=0;
    03065 24AA      CLR	R10
(0095) 	unsigned long next_step_time=0;
    03066 E080      LDI	R24,0
    03067 838B      STD	Y+3,R24
    03068 838C      STD	Y+4,R24
    03069 838D      STD	Y+5,R24
    0306A 838E      STD	Y+6,R24
(0096) 	char selectCheckMode=config.autocheck; //自动检测开关
    0306B 90E0 08B9 LDS	R14,config+16
(0097) RE_IN:
(0098) 	key=0;
    0306D 24CC      CLR	R12
(0099) 	page=0;
    0306E 2400      CLR	R0
    0306F 820F      STD	Y+7,R0
(0100) 	is_on=0;
    03070 8608      STD	Y+8,R0
(0101) 	windcounter=0;
    03071 24AA      CLR	R10
(0102) 	next_step_time=0;
    03072 E080      LDI	R24,0
    03073 838B      STD	Y+3,R24
    03074 838C      STD	Y+4,R24
    03075 838D      STD	Y+5,R24
    03076 838E      STD	Y+6,R24
(0103) 	
(0104) 	dateRefresh(1);
    03077 E001      LDI	R16,1
    03078 940E 3937 CALL	_dateRefresh
(0105) 	LCD_CLR();
    0307A 940E 3D44 CALL	_LCD_CLR
(0106) 	LCD_const_disp(1,1,"菜单/ 检测");
    0307C E887      LDI	R24,0x87
    0307D E095      LDI	R25,5
    0307E 8399      STD	Y+1,R25
    0307F 8388      ST	Y,R24
    03080 E021      LDI	R18,1
    03081 E001      LDI	R16,1
    03082 940E 3C9E CALL	_LCD_const_disp
(0107) 	LCD_const_disp(2,3,"自动");		 
    03084 E882      LDI	R24,0x82
    03085 E095      LDI	R25,5
    03086 8399      STD	Y+1,R25
    03087 8388      ST	Y,R24
    03088 E023      LDI	R18,3
    03089 E002      LDI	R16,2
    0308A 940E 3C9E CALL	_LCD_const_disp
(0108) 	LCD_const_disp(3,3,"手动");
    0308C E78D      LDI	R24,0x7D
    0308D E095      LDI	R25,5
    0308E 8399      STD	Y+1,R25
    0308F 8388      ST	Y,R24
    03090 E023      LDI	R18,3
    03091 E003      LDI	R16,3
    03092 940E 3C9E CALL	_LCD_const_disp
(0109) 	if(selectCheckMode==1) {
    03094 2D8E      MOV	R24,R14
    03095 3081      CPI	R24,1
    03096 F489      BNE	0x30A8
(0110) 	    Set_White(1,2,8,0);
    03097 2422      CLR	R2
    03098 822A      STD	Y+2,R2
    03099 E088      LDI	R24,0x8
    0309A 8388      ST	Y,R24
    0309B E022      LDI	R18,2
    0309C E001      LDI	R16,1
    0309D 940E 3DCE CALL	_Set_White
(0111) 		Set_White(1,3,8,1);
    0309F E081      LDI	R24,1
    030A0 838A      STD	Y+2,R24
    030A1 E088      LDI	R24,0x8
    030A2 8388      ST	Y,R24
    030A3 E023      LDI	R18,3
    030A4 E001      LDI	R16,1
    030A5 940E 3DCE CALL	_Set_White
(0112) 	}
    030A7 C060      RJMP	0x3108
(0113) 	else {
(0114) 		 Set_White(1,2,8,1);
    030A8 E081      LDI	R24,1
    030A9 838A      STD	Y+2,R24
    030AA E088      LDI	R24,0x8
    030AB 8388      ST	Y,R24
    030AC E022      LDI	R18,2
    030AD E001      LDI	R16,1
    030AE 940E 3DCE CALL	_Set_White
(0115) 		 Set_White(1,3,8,0);
    030B0 2422      CLR	R2
    030B1 822A      STD	Y+2,R2
    030B2 E088      LDI	R24,0x8
    030B3 8388      ST	Y,R24
    030B4 E023      LDI	R18,3
    030B5 E001      LDI	R16,1
    030B6 940E 3DCE CALL	_Set_White
(0116) 	}
    030B8 C04F      RJMP	0x3108
(0117) 	
(0118) //<<菜单/检测/手（自）动>>
(0119) 	while(1){
(0120) 	 	key=kbscan();
    030B9 940E 42A4 CALL	_kbscan
    030BB 2EC0      MOV	R12,R16
(0121) 		heaterSwitch();
    030BC 940E 25F0 CALL	_heaterSwitch
(0122) 		dateRefresh(0); //只刷新后台时间
    030BE 2700      CLR	R16
    030BF 940E 3937 CALL	_dateRefresh
(0123) 		//上键短按 选择
(0124) 		if(key==up || key ==down){
    030C1 2D8C      MOV	R24,R12
    030C2 318E      CPI	R24,0x1E
    030C3 F011      BEQ	0x30C6
    030C4 318D      CPI	R24,0x1D
    030C5 F539      BNE	0x30ED
(0125) 		    if(selectCheckMode >0){
    030C6 E080      LDI	R24,0
    030C7 158E      CP	R24,R14
    030C8 F490      BCC	0x30DB
(0126) 			    selectCheckMode=0;
    030C9 24EE      CLR	R14
(0127) 				Set_White(1,2,8,1);
    030CA E081      LDI	R24,1
    030CB 838A      STD	Y+2,R24
    030CC E088      LDI	R24,0x8
    030CD 8388      ST	Y,R24
    030CE E022      LDI	R18,2
    030CF E001      LDI	R16,1
    030D0 940E 3DCE CALL	_Set_White
(0128) 	 			Set_White(1,3,8,0);
    030D2 2422      CLR	R2
    030D3 822A      STD	Y+2,R2
    030D4 E088      LDI	R24,0x8
    030D5 8388      ST	Y,R24
    030D6 E023      LDI	R18,3
    030D7 E001      LDI	R16,1
    030D8 940E 3DCE CALL	_Set_White
(0129) 			}
    030DA C012      RJMP	0x30ED
(0130) 			else {
(0131) 			    selectCheckMode=1;
    030DB 24EE      CLR	R14
    030DC 94E3      INC	R14
(0132) 				Set_White(1,2,8,0);
    030DD 2422      CLR	R2
    030DE 822A      STD	Y+2,R2
    030DF E088      LDI	R24,0x8
    030E0 8388      ST	Y,R24
    030E1 E022      LDI	R18,2
    030E2 E001      LDI	R16,1
    030E3 940E 3DCE CALL	_Set_White
(0133) 	 			Set_White(1,3,8,1);
    030E5 E081      LDI	R24,1
    030E6 838A      STD	Y+2,R24
    030E7 E088      LDI	R24,0x8
    030E8 8388      ST	Y,R24
    030E9 E023      LDI	R18,3
    030EA E001      LDI	R16,1
    030EB 940E 3DCE CALL	_Set_White
(0134) 			}
(0135) 			
(0136) 		}
(0137) 		//左键短按  进入
(0138) 		if(key == left) {
    030ED 2D8C      MOV	R24,R12
    030EE 318B      CPI	R24,0x1B
    030EF F499      BNE	0x3103
(0139) 			config.autocheck=selectCheckMode; 
    030F0 92E0 08B9 STS	config+16,R14
(0140) 			Set_White(1,2,8,1);
    030F2 E081      LDI	R24,1
    030F3 838A      STD	Y+2,R24
    030F4 E088      LDI	R24,0x8
    030F5 8388      ST	Y,R24
    030F6 E022      LDI	R18,2
    030F7 E001      LDI	R16,1
    030F8 940E 3DCE CALL	_Set_White
(0141) 	 		Set_White(1,3,8,1); 
    030FA E081      LDI	R24,1
    030FB 838A      STD	Y+2,R24
    030FC E088      LDI	R24,0x8
    030FD 8388      ST	Y,R24
    030FE E023      LDI	R18,3
    030FF E001      LDI	R16,1
    03100 940E 3DCE CALL	_Set_White
(0142) 			break ;		
    03102 C006      RJMP	0x3109
(0143) 		}
(0144) 		//右键短按  返回
(0145) 		if(key == right) {
    03103 2D8C      MOV	R24,R12
    03104 3187      CPI	R24,0x17
    03105 F409      BNE	0x3107
(0146) 			return ;		
    03106 C1DE      RJMP	0x32E5
(0147) 		}
(0148) 		key=0;
    03107 24CC      CLR	R12
    03108 CFB0      RJMP	0x30B9
(0149) 	} //end of while
(0150)     //自动开启检测
(0151) 	dateRefresh(0);
    03109 2700      CLR	R16
    0310A 940E 3937 CALL	_dateRefresh
(0152) 	is_on =1 ;
    0310C 2400      CLR	R0
    0310D 9403      INC	R0
    0310E 8608      STD	Y+8,R0
(0153) 	config.time1=config.now+config.THRESHOLD_delta_sec;
    0310F 9040 08AF LDS	R4,config+6
    03111 9050 08B0 LDS	R5,config+7
    03113 9020 08AD LDS	R2,config+4
    03115 9030 08AE LDS	R3,config+5
    03117 9080 08B7 LDS	R8,config+14
    03119 9090 08B8 LDS	R9,config+15
    0311B 9060 08B5 LDS	R6,config+12
    0311D 9070 08B6 LDS	R7,config+13
    0311F 0C62      ADD	R6,R2
    03120 1C73      ADC	R7,R3
    03121 1C84      ADC	R8,R4
    03122 1C95      ADC	R9,R5
    03123 9270 08B2 STS	config+9,R7
    03125 9260 08B1 STS	config+8,R6
    03127 9290 08B4 STS	config+11,R9
    03129 9280 08B3 STS	config+10,R8
(0154) 	Result.TempChar[0]=0; //清除上次结果
    0312B 2422      CLR	R2
    0312C 9220 0664 STS	Result+45,R2
(0155) 	Result.WSChar[0]=0;
    0312E 9220 066E STS	Result+55,R2
    03130 C1B3      RJMP	0x32E4
(0156) 	while(1){
(0157) 		key=kbscan();
    03131 940E 42A4 CALL	_kbscan
    03133 2EC0      MOV	R12,R16
(0158) 		heaterSwitch();
    03134 940E 25F0 CALL	_heaterSwitch
(0159) 		dateRefresh(0); //只刷新后台时间
    03136 2700      CLR	R16
    03137 D7FF      RCALL	_dateRefresh
(0160) 		if(key != 0) beep(0,1);
    03138 20CC      TST	R12
    03139 F021      BEQ	0x313E
    0313A E021      LDI	R18,1
    0313B 2700      CLR	R16
    0313C 940E 401B CALL	_beep
(0161) 		if(key==right){	//右键 退出
    0313E 2D8C      MOV	R24,R12
    0313F 3187      CPI	R24,0x17
    03140 F569      BNE	0x316E
(0162) 		    is_on=0;
    03141 2400      CLR	R0
    03142 8608      STD	Y+8,R0
(0163) 			LCD_CLR();
    03143 940E 3D44 CALL	_LCD_CLR
(0164) 		 	LCD_Init();	  
    03145 940E 3D12 CALL	_LCD_Init
(0165) 	 	 	LCD_const_disp(4,5,"退出    "); 
    03147 E784      LDI	R24,0x74
    03148 E095      LDI	R25,5
    03149 8399      STD	Y+1,R25
    0314A 8388      ST	Y,R24
    0314B E025      LDI	R18,5
    0314C E004      LDI	R16,4
    0314D 940E 3C9E CALL	_LCD_const_disp
(0166) 		 	delayms(200);
    0314F EC08      LDI	R16,0xC8
    03150 E010      LDI	R17,0
    03151 940E 2537 CALL	_delayms
(0167) 		 	LCD_const_disp(4,7,".."); 
    03153 E781      LDI	R24,0x71
    03154 E095      LDI	R25,5
    03155 8399      STD	Y+1,R25
    03156 8388      ST	Y,R24
    03157 E027      LDI	R18,7
    03158 E004      LDI	R16,4
    03159 940E 3C9E CALL	_LCD_const_disp
(0168) 		 	delayms(200);
    0315B EC08      LDI	R16,0xC8
    0315C E010      LDI	R17,0
    0315D 940E 2537 CALL	_delayms
(0169) 		 	LCD_const_disp(4,8,".."); 	
    0315F E781      LDI	R24,0x71
    03160 E095      LDI	R25,5
    03161 8399      STD	Y+1,R25
    03162 8388      ST	Y,R24
    03163 E028      LDI	R18,0x8
    03164 E004      LDI	R16,4
    03165 940E 3C9E CALL	_LCD_const_disp
(0170) 		 	delayms(500);
    03167 EF04      LDI	R16,0xF4
    03168 E011      LDI	R17,1
    03169 940E 2537 CALL	_delayms
(0171) 		 	LCD_CLR();
    0316B 940E 3D44 CALL	_LCD_CLR
(0172) 		 	goto RE_IN;
    0316D CEFF      RJMP	0x306D
(0173) 		}
(0174) 		if(is_on==1){ 
    0316E 8588      LDD	R24,Y+8
    0316F 3081      CPI	R24,1
    03170 F009      BEQ	0x3172
    03171 C097      RJMP	0x3209
(0175) 			dateRefresh(1); //更新时间
    03172 E001      LDI	R16,1
    03173 D7C3      RCALL	_dateRefresh
(0176) 		    _GUI_datashow(page); 
    03174 810F      LDD	R16,Y+7
    03175 D172      RCALL	__GUI_datashow
(0177) 		    if(config.now < config.time1) {
    03176 9040 08B3 LDS	R4,config+10
    03178 9050 08B4 LDS	R5,config+11
    0317A 9020 08B1 LDS	R2,config+8
    0317C 9030 08B2 LDS	R3,config+9
    0317E 9080 08B7 LDS	R8,config+14
    03180 9090 08B8 LDS	R9,config+15
    03182 9060 08B5 LDS	R6,config+12
    03184 9070 08B6 LDS	R7,config+13
    03186 1462      CP	R6,R2
    03187 0473      CPC	R7,R3
    03188 0484      CPC	R8,R4
    03189 0495      CPC	R9,R5
    0318A F598      BCC	0x31BE
(0178) 				//时间更新 开启风速检测 等待检测 不支持翻页
(0179) 				if(windcounter==0){
    0318B 20AA      TST	R10
    0318C F421      BNE	0x3191
(0180) 				    windcounter=1; //清零开启风速计数器
    0318D 24AA      CLR	R10
    0318E 94A3      INC	R10
(0181) 					timer1_init(); //开启风速传感器技术
    0318F 940E 2586 CALL	_timer1_init
(0182) 				}
(0183) 				if(page == 0 ){
    03191 800F      LDD	R0,Y+7
    03192 2000      TST	R0
    03193 F009      BEQ	0x3195
    03194 C14B      RJMP	0x32E0
(0184) 				
(0185) 				    LCD_const_disp(4,1,"正在检测");
    03195 E688      LDI	R24,0x68
    03196 E095      LDI	R25,5
    03197 8399      STD	Y+1,R25
    03198 8388      ST	Y,R24
    03199 E021      LDI	R18,1
    0319A E004      LDI	R16,4
    0319B 940E 3C9E CALL	_LCD_const_disp
(0186) 					LCD_print4num(4,5,config.time1-config.now);
    0319D 9020 08B5 LDS	R2,config+12
    0319F 9030 08B6 LDS	R3,config+13
    031A1 9040 08B1 LDS	R4,config+8
    031A3 9050 08B2 LDS	R5,config+9
    031A5 1842      SUB	R4,R2
    031A6 0853      SBC	R5,R3
    031A7 8259      STD	Y+1,R5
    031A8 8248      ST	Y,R4
    031A9 E025      LDI	R18,5
    031AA E004      LDI	R16,4
    031AB 940E 3F60 CALL	_LCD_print4num
(0187) 					LCD_const_disp(2,6,"      ");
    031AD E681      LDI	R24,0x61
    031AE E095      LDI	R25,5
    031AF 8399      STD	Y+1,R25
    031B0 8388      ST	Y,R24
    031B1 E026      LDI	R18,6
    031B2 E002      LDI	R16,2
    031B3 940E 3C9E CALL	_LCD_const_disp
(0188) 					LCD_const_disp(3,6,"      ");
    031B5 E681      LDI	R24,0x61
    031B6 E095      LDI	R25,5
    031B7 8399      STD	Y+1,R25
    031B8 8388      ST	Y,R24
    031B9 E026      LDI	R18,6
    031BA E003      LDI	R16,3
    031BB 940E 3C9E CALL	_LCD_const_disp
(0189) 				}
(0190) 			} 
    031BD C122      RJMP	0x32E0
(0191) 			else {
(0192) 			   //检测完成 获得数据 转换数据 存储数据 切换到非检测状态
(0193) 			    windcounter =0 ; //关闭风速传感器计数器
    031BE 24AA      CLR	R10
(0194) 				beep(1,1);
    031BF E021      LDI	R18,1
    031C0 E001      LDI	R16,1
    031C1 940E 401B CALL	_beep
(0195) 				LCD_const_disp(4,1,"--计算并存储--       ");
    031C3 E48B      LDI	R24,0x4B
    031C4 E095      LDI	R25,5
    031C5 8399      STD	Y+1,R25
    031C6 8388      ST	Y,R24
    031C7 E021      LDI	R18,1
    031C8 E004      LDI	R16,4
    031C9 940E 3C9E CALL	_LCD_const_disp
(0196) 				check();
    031CB 940E 2A60 CALL	_check
(0197) 				StructToChar(); //转成字符串
    031CD 940E 2BCA CALL	_StructToChar
(0198) 				WriteFileHead();//重写文件头
    031CF 940E 2724 CALL	_WriteFileHead
(0199) 				WriteSDFile();  //写入sd卡
    031D1 940E 278B CALL	_WriteSDFile
(0200) 				//zigbee_send(); //发送
(0201) 				Result.Index++; //索引自增一
    031D3 E041      LDI	R20,1
    031D4 E050      LDI	R21,0
    031D5 E060      LDI	R22,0
    031D6 E070      LDI	R23,0
    031D7 9040 0643 LDS	R4,Result+12
    031D9 9050 0644 LDS	R5,Result+13
    031DB 9020 0641 LDS	R2,Result+10
    031DD 9030 0642 LDS	R3,Result+11
    031DF 0E24      ADD	R2,R20
    031E0 1E35      ADC	R3,R21
    031E1 1E46      ADC	R4,R22
    031E2 1E57      ADC	R5,R23
    031E3 9230 0642 STS	Result+11,R3
    031E5 9220 0641 STS	Result+10,R2
    031E7 9250 0644 STS	Result+13,R5
    031E9 9240 0643 STS	Result+12,R4
(0202) 				is_on=0; //切换到非检测状态
    031EB 2400      CLR	R0
    031EC 8608      STD	Y+8,R0
(0203) 				next_step_time=config.now+config.checkDeltaTime;//自动翻页时间更新
    031ED 9020 08BA LDS	R2,config+17
    031EF 9030 08BB LDS	R3,config+18
    031F1 2444      CLR	R4
    031F2 FC37      SBRC	R3,7
    031F3 9440      COM	R4
    031F4 2455      CLR	R5
    031F5 FC47      SBRC	R4,7
    031F6 9450      COM	R5
    031F7 9080 08B7 LDS	R8,config+14
    031F9 9090 08B8 LDS	R9,config+15
    031FB 9060 08B5 LDS	R6,config+12
    031FD 9070 08B6 LDS	R7,config+13
    031FF 0C62      ADD	R6,R2
    03200 1C73      ADC	R7,R3
    03201 1C84      ADC	R8,R4
    03202 1C95      ADC	R9,R5
    03203 826B      STD	Y+3,R6
    03204 827C      STD	Y+4,R7
    03205 828D      STD	Y+5,R8
    03206 829E      STD	Y+6,R9
(0204) 				page=0;
    03207 820F      STD	Y+7,R0
(0205) 		   }
(0206) 		}
    03208 C0D7      RJMP	0x32E0
(0207) 		else { //is_on == 0 非检测状态 手动翻页/自动翻页
(0208) 		    dateRefresh(0);//不更新时间
    03209 2700      CLR	R16
    0320A D72C      RCALL	_dateRefresh
(0209) 			_GUI_datashow(page); 
    0320B 810F      LDD	R16,Y+7
    0320C D0DB      RCALL	__GUI_datashow
(0210) 			if(page == 0 ){
    0320D 800F      LDD	R0,Y+7
    0320E 2000      TST	R0
    0320F F4E9      BNE	0x322D
(0211) 				
(0212) 				    LCD_const_disp(4,1,"完成检测        ");
    03210 E38A      LDI	R24,0x3A
    03211 E095      LDI	R25,5
    03212 8399      STD	Y+1,R25
    03213 8388      ST	Y,R24
    03214 E021      LDI	R18,1
    03215 E004      LDI	R16,4
    03216 940E 3C9E CALL	_LCD_const_disp
(0213) 					if(config.autocheck == 1){
    03218 9180 08B9 LDS	R24,config+16
    0321A 3081      CPI	R24,1
    0321B F449      BNE	0x3225
(0214) 					    LCD_const_disp(4,7,"自动");
    0321C E882      LDI	R24,0x82
    0321D E095      LDI	R25,5
    0321E 8399      STD	Y+1,R25
    0321F 8388      ST	Y,R24
    03220 E027      LDI	R18,7
    03221 E004      LDI	R16,4
    03222 940E 3C9E CALL	_LCD_const_disp
(0215) 					}
    03224 C008      RJMP	0x322D
(0216) 					else {
(0217) 					    LCD_const_disp(4,7,"手动");
    03225 E78D      LDI	R24,0x7D
    03226 E095      LDI	R25,5
    03227 8399      STD	Y+1,R25
    03228 8388      ST	Y,R24
    03229 E027      LDI	R18,7
    0322A E004      LDI	R16,4
    0322B 940E 3C9E CALL	_LCD_const_disp
(0218) 					}
(0219) 					
(0220) 				}
(0221) 						//手动翻页 
(0222) 			if(key==up){ //上键 : 页面减 
    0322D 2D8C      MOV	R24,R12
    0322E 318E      CPI	R24,0x1E
    0322F F539      BNE	0x3257
(0223) 		        if(page>0) page--;
    03230 E080      LDI	R24,0
    03231 800F      LDD	R0,Y+7
    03232 1580      CP	R24,R0
    03233 F418      BCC	0x3237
    03234 940A      DEC	R0
    03235 820F      STD	Y+7,R0
    03236 C01C      RJMP	0x3253
(0224) 				else{
(0225) 				page =5;
    03237 E085      LDI	R24,5
    03238 838F      STD	Y+7,R24
(0226) 				next_step_time = config.now + config.checkDeltaTime;
    03239 9020 08BA LDS	R2,config+17
    0323B 9030 08BB LDS	R3,config+18
    0323D 2444      CLR	R4
    0323E FC37      SBRC	R3,7
    0323F 9440      COM	R4
    03240 2455      CLR	R5
    03241 FC47      SBRC	R4,7
    03242 9450      COM	R5
    03243 9080 08B7 LDS	R8,config+14
    03245 9090 08B8 LDS	R9,config+15
    03247 9060 08B5 LDS	R6,config+12
    03249 9070 08B6 LDS	R7,config+13
    0324B 0C62      ADD	R6,R2
    0324C 1C73      ADC	R7,R3
    0324D 1C84      ADC	R8,R4
    0324E 1C95      ADC	R9,R5
    0324F 826B      STD	Y+3,R6
    03250 827C      STD	Y+4,R7
    03251 828D      STD	Y+5,R8
    03252 829E      STD	Y+6,R9
(0227) 				}
(0228) 		    	LCD_CLR();
    03253 940E 3D44 CALL	_LCD_CLR
(0229) 		    	LCD_Init();
    03255 940E 3D12 CALL	_LCD_Init
(0230) 			}
(0231) 			if(key==down){//下键 ： 页面加
    03257 2D8C      MOV	R24,R12
    03258 318D      CPI	R24,0x1D
    03259 F509      BNE	0x327B
(0232) 		        page++;
    0325A 800F      LDD	R0,Y+7
    0325B 9403      INC	R0
    0325C 820F      STD	Y+7,R0
(0233) 				next_step_time = config.now + config.checkDeltaTime;
    0325D 9020 08BA LDS	R2,config+17
    0325F 9030 08BB LDS	R3,config+18
    03261 2444      CLR	R4
    03262 FC37      SBRC	R3,7
    03263 9440      COM	R4
    03264 2455      CLR	R5
    03265 FC47      SBRC	R4,7
    03266 9450      COM	R5
    03267 9080 08B7 LDS	R8,config+14
    03269 9090 08B8 LDS	R9,config+15
    0326B 9060 08B5 LDS	R6,config+12
    0326D 9070 08B6 LDS	R7,config+13
    0326F 0C62      ADD	R6,R2
    03270 1C73      ADC	R7,R3
    03271 1C84      ADC	R8,R4
    03272 1C95      ADC	R9,R5
    03273 826B      STD	Y+3,R6
    03274 827C      STD	Y+4,R7
    03275 828D      STD	Y+5,R8
    03276 829E      STD	Y+6,R9
(0234) 		  		LCD_CLR();
    03277 940E 3D44 CALL	_LCD_CLR
(0235) 		    	LCD_Init();
    03279 940E 3D12 CALL	_LCD_Init
(0236) 			} 	
(0237) 			//LCD_print2num(4,1,page);
(0238) 			//LCD_print4num(4,3,config.now);
(0239) 			//LCD_print4num(4,6,next_step_time);
(0240) 			if( config.autocheck == 1 ){  //如果开启自动翻页
    0327B 9180 08B9 LDS	R24,config+16
    0327D 3081      CPI	R24,1
    0327E F5A1      BNE	0x32B3
(0241) 			      if(config.now >= next_step_time || page >=6 )	{
    0327F 802B      LDD	R2,Y+3
    03280 803C      LDD	R3,Y+4
    03281 804D      LDD	R4,Y+5
    03282 805E      LDD	R5,Y+6
    03283 9080 08B7 LDS	R8,config+14
    03285 9090 08B8 LDS	R9,config+15
    03287 9060 08B5 LDS	R6,config+12
    03289 9070 08B6 LDS	R7,config+13
    0328B 1462      CP	R6,R2
    0328C 0473      CPC	R7,R3
    0328D 0484      CPC	R8,R4
    0328E 0495      CPC	R9,R5
    0328F F418      BCC	0x3293
    03290 818F      LDD	R24,Y+7
    03291 3086      CPI	R24,6
    03292 F100      BCS	0x32B3
(0242) 				      next_step_time = config.now + config.checkDeltaTime;
    03293 9020 08BA LDS	R2,config+17
    03295 9030 08BB LDS	R3,config+18
    03297 2444      CLR	R4
    03298 FC37      SBRC	R3,7
    03299 9440      COM	R4
    0329A 2455      CLR	R5
    0329B FC47      SBRC	R4,7
    0329C 9450      COM	R5
    0329D 9080 08B7 LDS	R8,config+14
    0329F 9090 08B8 LDS	R9,config+15
    032A1 9060 08B5 LDS	R6,config+12
    032A3 9070 08B6 LDS	R7,config+13
    032A5 0C62      ADD	R6,R2
    032A6 1C73      ADC	R7,R3
    032A7 1C84      ADC	R8,R4
    032A8 1C95      ADC	R9,R5
    032A9 826B      STD	Y+3,R6
    032AA 827C      STD	Y+4,R7
    032AB 828D      STD	Y+5,R8
    032AC 829E      STD	Y+6,R9
(0243) 					  page++;
    032AD 800F      LDD	R0,Y+7
    032AE 9403      INC	R0
    032AF 820F      STD	Y+7,R0
(0244) 					  LCD_CLR(); 
    032B0 940E 3D44 CALL	_LCD_CLR
(0245) 					  key=0;
    032B2 24CC      CLR	R12
(0246) 				  }  
(0247) 			}
(0248) 			if( page>=6 ){
    032B3 818F      LDD	R24,Y+7
    032B4 3086      CPI	R24,6
    032B5 F150      BCS	0x32E0
(0249) 					      //翻到最后页，页面清零开启下次检测
(0250) 					      page = 0;
    032B6 2400      CLR	R0
    032B7 820F      STD	Y+7,R0
(0251) 						  dateRefresh(1); //刷新时间
    032B8 E001      LDI	R16,1
    032B9 D67D      RCALL	_dateRefresh
(0252) 						  is_on =1 ; //开启检测
    032BA 2400      CLR	R0
    032BB 9403      INC	R0
    032BC 8608      STD	Y+8,R0
(0253) 						  config.time1=config.now+config.THRESHOLD_delta_sec; //更新下次检测时间
    032BD 9040 08AF LDS	R4,config+6
    032BF 9050 08B0 LDS	R5,config+7
    032C1 9020 08AD LDS	R2,config+4
    032C3 9030 08AE LDS	R3,config+5
    032C5 9080 08B7 LDS	R8,config+14
    032C7 9090 08B8 LDS	R9,config+15
    032C9 9060 08B5 LDS	R6,config+12
    032CB 9070 08B6 LDS	R7,config+13
    032CD 0C62      ADD	R6,R2
    032CE 1C73      ADC	R7,R3
    032CF 1C84      ADC	R8,R4
    032D0 1C95      ADC	R9,R5
    032D1 9270 08B2 STS	config+9,R7
    032D3 9260 08B1 STS	config+8,R6
    032D5 9290 08B4 STS	config+11,R9
    032D7 9280 08B3 STS	config+10,R8
(0254) 						  Result.TempChar[0]=0; //清除上次结果
    032D9 2422      CLR	R2
    032DA 9220 0664 STS	Result+45,R2
(0255) 						  Result.WSChar[0]=0;
    032DC 9220 066E STS	Result+55,R2
(0256) 					   	  LCD_CLR();  
    032DE 940E 3D44 CALL	_LCD_CLR
(0257) 					  }
(0258) 				         
(0259) 				
(0260) 
(0261) 		} 
(0262) 	    delayms(10); 
    032E0 E00A      LDI	R16,0xA
    032E1 E010      LDI	R17,0
    032E2 940E 2537 CALL	_delayms
    032E4 CE4C      RJMP	0x3131
    032E5 9629      ADIW	R28,0x9
    032E6 940C 48B8 JMP	pop_xgsetF0FC
__GUI_datashow:
  page                 --> R20
    032E8 940E 48E2 CALL	push_xgsetF00C
    032EA 2F40      MOV	R20,R16
    032EB 9722      SBIW	R28,2
(0263) 	}//end while
(0264) }//end function
(0265) void _GUI_datashow(char page){
(0266) 	if(page == 0){
    032EC 2344      TST	R20
    032ED F539      BNE	0x3315
(0267)  	//显示日期时间
(0268) 	    LCD_var_disp(1,1,GUI_get_date());
    032EE D205      RCALL	_GUI_get_date
    032EF 8319      STD	Y+1,R17
    032F0 8308      ST	Y,R16
    032F1 E021      LDI	R18,1
    032F2 E001      LDI	R16,1
    032F3 940E 3CCB CALL	_LCD_var_disp
(0269) 	//显示温度
(0270) 	 	LCD_const_disp(2,1,"温度 (℃):      ");
    032F5 E289      LDI	R24,0x29
    032F6 E095      LDI	R25,5
    032F7 8399      STD	Y+1,R25
    032F8 8388      ST	Y,R24
    032F9 E021      LDI	R18,1
    032FA E002      LDI	R16,2
    032FB 940E 3C9E CALL	_LCD_const_disp
(0271) 	 	LCD_var_disp(2,6,Result.TempChar);
    032FD E684      LDI	R24,0x64
    032FE E096      LDI	R25,6
    032FF 8399      STD	Y+1,R25
    03300 8388      ST	Y,R24
    03301 E026      LDI	R18,6
    03302 E002      LDI	R16,2
    03303 940E 3CCB CALL	_LCD_var_disp
(0272) 	//显示风速
(0273) 	    LCD_const_disp(3,1,"风速(m/s):      ");
    03305 E188      LDI	R24,0x18
    03306 E095      LDI	R25,5
    03307 8399      STD	Y+1,R25
    03308 8388      ST	Y,R24
    03309 E021      LDI	R18,1
    0330A E003      LDI	R16,3
    0330B 940E 3C9E CALL	_LCD_const_disp
(0274) 	 	LCD_const_disp(3,6,Result.WSChar);
    0330D E68E      LDI	R24,0x6E
    0330E E096      LDI	R25,6
    0330F 8399      STD	Y+1,R25
    03310 8388      ST	Y,R24
    03311 E026      LDI	R18,6
    03312 E003      LDI	R16,3
    03313 940E 3C9E CALL	_LCD_const_disp
(0275) 
(0276) 	 } 
(0277) 	 if(page == 1){
    03315 3041      CPI	R20,1
    03316 F5B9      BNE	0x334E
(0278) 	     LCD_var_disp(1,1,GUI_get_date());
    03317 D1DC      RCALL	_GUI_get_date
    03318 8319      STD	Y+1,R17
    03319 8308      ST	Y,R16
    0331A E021      LDI	R18,1
    0331B E001      LDI	R16,1
    0331C 940E 3CCB CALL	_LCD_var_disp
(0279) 		 LCD_const_disp(2,1,"风冷指数: ");
    0331E E08D      LDI	R24,0xD
    0331F E095      LDI	R25,5
    03320 8399      STD	Y+1,R25
    03321 8388      ST	Y,R24
    03322 E021      LDI	R18,1
    03323 E002      LDI	R16,2
    03324 940E 3C9E CALL	_LCD_const_disp
(0280) 		 LCD_var_disp(2,6,Result.WCIChar);						
    03326 E787      LDI	R24,0x77
    03327 E096      LDI	R25,6
    03328 8399      STD	Y+1,R25
    03329 8388      ST	Y,R24
    0332A E026      LDI	R18,6
    0332B E002      LDI	R16,2
    0332C 940E 3CCB CALL	_LCD_var_disp
(0281) 		 LCD_const_disp(3,1,"等价温度: ");
    0332E E082      LDI	R24,2
    0332F E095      LDI	R25,5
    03330 8399      STD	Y+1,R25
    03331 8388      ST	Y,R24
    03332 E021      LDI	R18,1
    03333 E003      LDI	R16,3
    03334 940E 3C9E CALL	_LCD_const_disp
(0282) 		 LCD_var_disp(3,6,Result.ECTChar);	 
    03336 E883      LDI	R24,0x83
    03337 E096      LDI	R25,6
    03338 8399      STD	Y+1,R25
    03339 8388      ST	Y,R24
    0333A E026      LDI	R18,6
    0333B E003      LDI	R16,3
    0333C 940E 3CCB CALL	_LCD_var_disp
(0283) 		 LCD_const_disp(4,1,"相当温度: ");
    0333E EF87      LDI	R24,0xF7
    0333F E094      LDI	R25,4
    03340 8399      STD	Y+1,R25
    03341 8388      ST	Y,R24
    03342 E021      LDI	R18,1
    03343 E004      LDI	R16,4
    03344 940E 3C9E CALL	_LCD_const_disp
(0284) 		 LCD_var_disp(4,6,Result.TeqChar);	
    03346 E88D      LDI	R24,0x8D
    03347 E096      LDI	R25,6
    03348 8399      STD	Y+1,R25
    03349 8388      ST	Y,R24
    0334A E026      LDI	R18,6
    0334B E004      LDI	R16,4
    0334C 940E 3CCB CALL	_LCD_var_disp
(0285) 	 }
(0286) 	 if(page == 2){
    0334E 3042      CPI	R20,2
    0334F F009      BEQ	0x3351
    03350 C03F      RJMP	0x3390
(0287) 	     LCD_var_disp(1,1,GUI_get_date());
    03351 D1A2      RCALL	_GUI_get_date
    03352 0158      MOVW	R10,R16
    03353 82B9      STD	Y+1,R11
    03354 82A8      ST	Y,R10
    03355 E021      LDI	R18,1
    03356 E001      LDI	R16,1
    03357 940E 3CCB CALL	_LCD_var_disp
(0288) 		 LCD_const_disp(2,1,"冻伤危害性:");
    03359 EE8B      LDI	R24,0xEB
    0335A E094      LDI	R25,4
    0335B 8399      STD	Y+1,R25
    0335C 8388      ST	Y,R24
    0335D E021      LDI	R18,1
    0335E E002      LDI	R16,2
    0335F 940E 3C9E CALL	_LCD_const_disp
(0289) 	 if(Result.WeiHai==0){LCD_const_disp(3,1,"  冻伤危害性小");			 }
    03361 9020 0693 LDS	R2,Result+92
    03363 2022      TST	R2
    03364 F449      BNE	0x336E
    03365 ED8C      LDI	R24,0xDC
    03366 E094      LDI	R25,4
    03367 8399      STD	Y+1,R25
    03368 8388      ST	Y,R24
    03369 E021      LDI	R18,1
    0336A E003      LDI	R16,3
    0336B 940E 3C9E CALL	_LCD_const_disp
    0336D C022      RJMP	0x3390
(0290) 	 else if(Result.WeiHai==1){	LCD_const_disp(3,1,"  冻伤危害性较大");	 }
    0336E 9180 0693 LDS	R24,Result+92
    03370 3081      CPI	R24,1
    03371 F449      BNE	0x337B
    03372 EC8B      LDI	R24,0xCB
    03373 E094      LDI	R25,4
    03374 8399      STD	Y+1,R25
    03375 8388      ST	Y,R24
    03376 E021      LDI	R18,1
    03377 E003      LDI	R16,3
    03378 940E 3C9E CALL	_LCD_const_disp
    0337A C015      RJMP	0x3390
(0291) 	 else if(Result.WeiHai==2){	LCD_const_disp(3,1,"  冻伤危害性很大");	 }
    0337B 9180 0693 LDS	R24,Result+92
    0337D 3082      CPI	R24,2
    0337E F449      BNE	0x3388
    0337F EB8A      LDI	R24,0xBA
    03380 E094      LDI	R25,4
    03381 8399      STD	Y+1,R25
    03382 8388      ST	Y,R24
    03383 E021      LDI	R18,1
    03384 E003      LDI	R16,3
    03385 940E 3C9E CALL	_LCD_const_disp
    03387 C008      RJMP	0x3390
(0292) 	 else LCD_const_disp(3,1,"冻伤危害性小。");
    03388 EA8B      LDI	R24,0xAB
    03389 E094      LDI	R25,4
    0338A 8399      STD	Y+1,R25
    0338B 8388      ST	Y,R24
    0338C E021      LDI	R18,1
    0338D E003      LDI	R16,3
    0338E 940E 3C9E CALL	_LCD_const_disp
(0293) 	 }	  
(0294) 	 if(page==3){
    03390 3043      CPI	R20,3
    03391 F009      BEQ	0x3393
    03392 C061      RJMP	0x33F4
(0295) 	     LCD_const_disp(1,1,labelH);		
    03393 EA87      LDI	R24,0xA7
    03394 E092      LDI	R25,2
    03395 8399      STD	Y+1,R25
    03396 8388      ST	Y,R24
    03397 E021      LDI	R18,1
    03398 E001      LDI	R16,1
    03399 940E 3C9E CALL	_LCD_const_disp
(0296) 	 	 switch( Result.WeiHai ){
    0339B 9160 0693 LDS	R22,Result+92
    0339D 2777      CLR	R23
    0339E 3060      CPI	R22,0
    0339F 0767      CPC	R22,R23
    033A0 F049      BEQ	0x33AA
    033A1 3061      CPI	R22,1
    033A2 E0E0      LDI	R30,0
    033A3 077E      CPC	R23,R30
    033A4 F0F1      BEQ	0x33C3
    033A5 3062      CPI	R22,2
    033A6 E0E0      LDI	R30,0
    033A7 077E      CPC	R23,R30
    033A8 F199      BEQ	0x33DC
    033A9 C04A      RJMP	0x33F4
(0297) 			case 0 :
(0298) 			LCD_const_disp(2,1,H01);
    033AA ED83      LDI	R24,0xD3
    033AB E092      LDI	R25,2
    033AC 8399      STD	Y+1,R25
    033AD 8388      ST	Y,R24
    033AE E021      LDI	R18,1
    033AF E002      LDI	R16,2
    033B0 940E 3C9E CALL	_LCD_const_disp
(0299) 			LCD_const_disp(3,1,H02);
    033B2 EE83      LDI	R24,0xE3
    033B3 E092      LDI	R25,2
    033B4 8399      STD	Y+1,R25
    033B5 8388      ST	Y,R24
    033B6 E021      LDI	R18,1
    033B7 E003      LDI	R16,3
    033B8 940E 3C9E CALL	_LCD_const_disp
(0300) 			LCD_const_disp(4,1,H03);
    033BA EE8E      LDI	R24,0xEE
    033BB E092      LDI	R25,2
    033BC 8399      STD	Y+1,R25
    033BD 8388      ST	Y,R24
    033BE E021      LDI	R18,1
    033BF E004      LDI	R16,4
    033C0 940E 3C9E CALL	_LCD_const_disp
(0301) 			break;
    033C2 C031      RJMP	0x33F4
(0302) 			case 1 : 
(0303) 			LCD_const_disp(2,1,H11);
    033C3 E08A      LDI	R24,0xA
    033C4 E093      LDI	R25,3
    033C5 8399      STD	Y+1,R25
    033C6 8388      ST	Y,R24
    033C7 E021      LDI	R18,1
    033C8 E002      LDI	R16,2
    033C9 940E 3C9E CALL	_LCD_const_disp
(0304) 			LCD_const_disp(3,1,H12);
    033CB EE8E      LDI	R24,0xEE
    033CC E092      LDI	R25,2
    033CD 8399      STD	Y+1,R25
    033CE 8388      ST	Y,R24
    033CF E021      LDI	R18,1
    033D0 E003      LDI	R16,3
    033D1 940E 3C9E CALL	_LCD_const_disp
(0305) 			LCD_const_disp(4,1,H13);
    033D3 E283      LDI	R24,0x23
    033D4 E093      LDI	R25,3
    033D5 8399      STD	Y+1,R25
    033D6 8388      ST	Y,R24
    033D7 E021      LDI	R18,1
    033D8 E004      LDI	R16,4
    033D9 940E 3C9E CALL	_LCD_const_disp
(0306) 			break ;	
    033DB C018      RJMP	0x33F4
(0307) 			case 2 :
(0308) 			LCD_const_disp(2,1,H21);
    033DC E587      LDI	R24,0x57
    033DD E093      LDI	R25,3
    033DE 8399      STD	Y+1,R25
    033DF 8388      ST	Y,R24
    033E0 E021      LDI	R18,1
    033E1 E002      LDI	R16,2
    033E2 940E 3C9E CALL	_LCD_const_disp
(0309) 			LCD_const_disp(3,1,H22);
    033E4 E689      LDI	R24,0x69
    033E5 E093      LDI	R25,3
    033E6 8399      STD	Y+1,R25
    033E7 8388      ST	Y,R24
    033E8 E021      LDI	R18,1
    033E9 E003      LDI	R16,3
    033EA 940E 3C9E CALL	_LCD_const_disp
(0310) 			LCD_const_disp(4,1,H23);
    033EC EE8E      LDI	R24,0xEE
    033ED E092      LDI	R25,2
    033EE 8399      STD	Y+1,R25
    033EF 8388      ST	Y,R24
    033F0 E021      LDI	R18,1
    033F1 E004      LDI	R16,4
    033F2 940E 3C9E CALL	_LCD_const_disp
(0311) 			break;
(0312) 			default : ;
(0313) 		}
(0314) 	 } 
(0315) 	 if(page==4){
    033F4 3044      CPI	R20,4
    033F5 F009      BEQ	0x33F7
    033F6 C086      RJMP	0x347D
(0316) 	 		LCD_const_disp(1,1,labelM);		
    033F7 EB85      LDI	R24,0xB5
    033F8 E092      LDI	R25,2
    033F9 8399      STD	Y+1,R25
    033FA 8388      ST	Y,R24
    033FB E021      LDI	R18,1
    033FC E001      LDI	R16,1
    033FD 940E 3C9E CALL	_LCD_const_disp
(0317) 	 		switch( Result.WeiHai ){
    033FF 9160 0693 LDS	R22,Result+92
    03401 2777      CLR	R23
    03402 3060      CPI	R22,0
    03403 0767      CPC	R22,R23
    03404 F059      BEQ	0x3410
    03405 3061      CPI	R22,1
    03406 E0E0      LDI	R30,0
    03407 077E      CPC	R23,R30
    03408 F409      BNE	0x340A
    03409 C052      RJMP	0x345C
    0340A 3062      CPI	R22,2
    0340B E0E0      LDI	R30,0
    0340C 077E      CPC	R23,R30
    0340D F409      BNE	0x340F
    0340E C066      RJMP	0x3475
    0340F C06D      RJMP	0x347D
(0318) 	 			case 0 :
(0319) 				LCD_const_disp(2,1,M01);
    03410 ED83      LDI	R24,0xD3
    03411 E092      LDI	R25,2
    03412 8399      STD	Y+1,R25
    03413 8388      ST	Y,R24
    03414 E021      LDI	R18,1
    03415 E002      LDI	R16,2
    03416 940E 3C9E CALL	_LCD_const_disp
(0320) 				LCD_const_disp(3,1,M02);
    03418 EE8E      LDI	R24,0xEE
    03419 E092      LDI	R25,2
    0341A 8399      STD	Y+1,R25
    0341B 8388      ST	Y,R24
    0341C E021      LDI	R18,1
    0341D E003      LDI	R16,3
    0341E 940E 3C9E CALL	_LCD_const_disp
(0321) 				if(Result.Temperature < -17.7){
    03420 9040 0662 LDS	R4,Result+43
    03422 9050 0663 LDS	R5,Result+44
    03424 9020 0660 LDS	R2,Result+41
    03426 9030 0661 LDS	R3,Result+42
    03428 EC02      LDI	R16,0xC2
    03429 E010      LDI	R17,0
    0342A 940E 484B CALL	elpm32
    0342C 933A      ST	-Y,R19
    0342D 932A      ST	-Y,R18
    0342E 931A      ST	-Y,R17
    0342F 930A      ST	-Y,R16
    03430 0181      MOVW	R16,R2
    03431 0192      MOVW	R18,R4
    03432 940E 4C43 CALL	fpcmp2
    03434 F44C      BGE	0x343E
(0322) 				    LCD_const_disp(4,1,"戴面罩；禁油彩。");
    03435 E98A      LDI	R24,0x9A
    03436 E094      LDI	R25,4
    03437 8399      STD	Y+1,R25
    03438 8388      ST	Y,R24
    03439 E021      LDI	R18,1
    0343A E004      LDI	R16,4
    0343B 940E 3C9E CALL	_LCD_const_disp
(0323) 				}
    0343D C03F      RJMP	0x347D
(0324) 				else if(Result.Temperature < -12){
    0343E 9040 0662 LDS	R4,Result+43
    03440 9050 0663 LDS	R5,Result+44
    03442 9020 0660 LDS	R2,Result+41
    03444 9030 0661 LDS	R3,Result+42
    03446 EB0E      LDI	R16,0xBE
    03447 E010      LDI	R17,0
    03448 940E 484B CALL	elpm32
    0344A 933A      ST	-Y,R19
    0344B 932A      ST	-Y,R18
    0344C 931A      ST	-Y,R17
    0344D 930A      ST	-Y,R16
    0344E 0181      MOVW	R16,R2
    0344F 0192      MOVW	R18,R4
    03450 940E 4C43 CALL	fpcmp2
    03452 F554      BGE	0x347D
(0325) 				    LCD_const_disp(4,1,"禁油彩。        \0");
    03453 E888      LDI	R24,0x88
    03454 E094      LDI	R25,4
    03455 8399      STD	Y+1,R25
    03456 8388      ST	Y,R24
    03457 E021      LDI	R18,1
    03458 E004      LDI	R16,4
    03459 940E 3C9E CALL	_LCD_const_disp
(0326) 				}
(0327) 				break;
    0345B C021      RJMP	0x347D
(0328) 				case 1 : 
(0329) 			    LCD_const_disp(2,1,M11);
    0345C ED83      LDI	R24,0xD3
    0345D E092      LDI	R25,2
    0345E 8399      STD	Y+1,R25
    0345F 8388      ST	Y,R24
    03460 E021      LDI	R18,1
    03461 E002      LDI	R16,2
    03462 940E 3C9E CALL	_LCD_const_disp
(0330) 				LCD_const_disp(3,1,M12);
    03464 E383      LDI	R24,0x33
    03465 E093      LDI	R25,3
    03466 8399      STD	Y+1,R25
    03467 8388      ST	Y,R24
    03468 E021      LDI	R18,1
    03469 E003      LDI	R16,3
    0346A 940E 3C9E CALL	_LCD_const_disp
(0331) 				LCD_const_disp(4,1,M13);
    0346C E485      LDI	R24,0x45
    0346D E093      LDI	R25,3
    0346E 8399      STD	Y+1,R25
    0346F 8388      ST	Y,R24
    03470 E021      LDI	R18,1
    03471 E004      LDI	R16,4
    03472 940E 3C9E CALL	_LCD_const_disp
(0332) 				break ;
    03474 C008      RJMP	0x347D
(0333) 				case 2 :
(0334) 				LCD_const_disp(2,1,M21);
    03475 E78B      LDI	R24,0x7B
    03476 E093      LDI	R25,3
    03477 8399      STD	Y+1,R25
    03478 8388      ST	Y,R24
    03479 E021      LDI	R18,1
    0347A E002      LDI	R16,2
    0347B 940E 3C9E CALL	_LCD_const_disp
(0335) 				break ;
(0336) 				default :;
(0337) 	 		}
(0338) 	 }
(0339) 	 if(page==5){
    0347D 3045      CPI	R20,5
    0347E F009      BEQ	0x3480
    0347F C071      RJMP	0x34F1
(0340) 	     LCD_const_disp(1,1,labelL);		
    03480 EC85      LDI	R24,0xC5
    03481 E092      LDI	R25,2
    03482 8399      STD	Y+1,R25
    03483 8388      ST	Y,R24
    03484 E021      LDI	R18,1
    03485 E001      LDI	R16,1
    03486 940E 3C9E CALL	_LCD_const_disp
(0341) 	 	 switch( Result.WeiHai ){	
    03488 9140 0693 LDS	R20,Result+92
    0348A 2755      CLR	R21
    0348B 3040      CPI	R20,0
    0348C 0745      CPC	R20,R21
    0348D F059      BEQ	0x3499
    0348E 3041      CPI	R20,1
    0348F E0E0      LDI	R30,0
    03490 075E      CPC	R21,R30
    03491 F409      BNE	0x3493
    03492 C03D      RJMP	0x34D0
    03493 3042      CPI	R20,2
    03494 E0E0      LDI	R30,0
    03495 075E      CPC	R21,R30
    03496 F409      BNE	0x3498
    03497 C051      RJMP	0x34E9
    03498 C058      RJMP	0x34F1
(0342) 		     case 0 :
(0343) 			 LCD_const_disp(2,1,L01);
    03499 E080      LDI	R24,0
    0349A E093      LDI	R25,3
    0349B 8399      STD	Y+1,R25
    0349C 8388      ST	Y,R24
    0349D E021      LDI	R18,1
    0349E E002      LDI	R16,2
    0349F 940E 3C9E CALL	_LCD_const_disp
(0344) 			 if(Result.Temperature < -12) {
    034A1 9040 0662 LDS	R4,Result+43
    034A3 9050 0663 LDS	R5,Result+44
    034A5 9020 0660 LDS	R2,Result+41
    034A7 9030 0661 LDS	R3,Result+42
    034A9 EB0E      LDI	R16,0xBE
    034AA E010      LDI	R17,0
    034AB 940E 484B CALL	elpm32
    034AD 933A      ST	-Y,R19
    034AE 932A      ST	-Y,R18
    034AF 931A      ST	-Y,R17
    034B0 930A      ST	-Y,R16
    034B1 0181      MOVW	R16,R2
    034B2 0192      MOVW	R18,R4
    034B3 940E 4C43 CALL	fpcmp2
    034B5 F48C      BGE	0x34C7
(0345) 			 LCD_const_disp(3,1,L02);
    034B6 E08A      LDI	R24,0xA
    034B7 E093      LDI	R25,3
    034B8 8399      STD	Y+1,R25
    034B9 8388      ST	Y,R24
    034BA E021      LDI	R18,1
    034BB E003      LDI	R16,3
    034BC 940E 3C9E CALL	_LCD_const_disp
(0346) 			 LCD_const_disp(4,1,L03);
    034BE E184      LDI	R24,0x14
    034BF E093      LDI	R25,3
    034C0 8399      STD	Y+1,R25
    034C1 8388      ST	Y,R24
    034C2 E021      LDI	R18,1
    034C3 E004      LDI	R16,4
    034C4 940E 3C9E CALL	_LCD_const_disp
(0347) 			 } 
    034C6 C02A      RJMP	0x34F1
(0348) 			 else {
(0349) 			 LCD_const_disp(3,1,L03);
    034C7 E184      LDI	R24,0x14
    034C8 E093      LDI	R25,3
    034C9 8399      STD	Y+1,R25
    034CA 8388      ST	Y,R24
    034CB E021      LDI	R18,1
    034CC E003      LDI	R16,3
    034CD 940E 3C9E CALL	_LCD_const_disp
(0350) 			 }
(0351) 			 break;
    034CF C021      RJMP	0x34F1
(0352) 			 case 1: 
(0353) 			 LCD_const_disp(2,1,L11);
    034D0 E587      LDI	R24,0x57
    034D1 E093      LDI	R25,3
    034D2 8399      STD	Y+1,R25
    034D3 8388      ST	Y,R24
    034D4 E021      LDI	R18,1
    034D5 E002      LDI	R16,2
    034D6 940E 3C9E CALL	_LCD_const_disp
(0354) 			 LCD_const_disp(3,1,L12);
    034D8 E689      LDI	R24,0x69
    034D9 E093      LDI	R25,3
    034DA 8399      STD	Y+1,R25
    034DB 8388      ST	Y,R24
    034DC E021      LDI	R18,1
    034DD E003      LDI	R16,3
    034DE 940E 3C9E CALL	_LCD_const_disp
(0355) 			 LCD_const_disp(3,1,L13);
    034E0 EE8E      LDI	R24,0xEE
    034E1 E092      LDI	R25,2
    034E2 8399      STD	Y+1,R25
    034E3 8388      ST	Y,R24
    034E4 E021      LDI	R18,1
    034E5 E003      LDI	R16,3
    034E6 940E 3C9E CALL	_LCD_const_disp
(0356) 			 break ;
    034E8 C008      RJMP	0x34F1
(0357) 			 case 2 :
(0358) 			 LCD_const_disp(2,1,L21);
    034E9 E78B      LDI	R24,0x7B
    034EA E093      LDI	R25,3
    034EB 8399      STD	Y+1,R25
    034EC 8388      ST	Y,R24
    034ED E021      LDI	R18,1
    034EE E002      LDI	R16,2
    034EF 940E 3C9E CALL	_LCD_const_disp
(0359) 			 break;
(0360) 			 default : ;
(0361) 		} //end switch
(0362) 	}  //end if
    034F1 9622      ADIW	R28,2
    034F2 940C 48E9 JMP	pop_xgsetF00C
(0363) }
(0364) char * GUI_get_date(void) {  
(0365)   //格式:12月11日19:00:00
(0366)     GUI_date[0]=Result.Date[4]; 
_GUI_get_date:
    034F4 9020 0651 LDS	R2,Result+26
    034F6 9220 039B STS	GUI_date,R2
(0367)     GUI_date[1]=Result.Date[5];
    034F8 9020 0652 LDS	R2,Result+27
    034FA 9220 039C STS	GUI_date+1,R2
(0368)     GUI_date[4]=Result.Date[6];
    034FC 9020 0653 LDS	R2,Result+28
    034FE 9220 039F STS	GUI_date+4,R2
(0369)     GUI_date[5]=Result.Date[7];
    03500 9020 0654 LDS	R2,Result+29
    03502 9220 03A0 STS	GUI_date+5,R2
(0370)     GUI_date[8]=Result.Time[0];
    03504 9020 0656 LDS	R2,Result+31
    03506 9220 03A3 STS	GUI_date+8,R2
(0371)     GUI_date[9]=Result.Time[1];
    03508 9020 0657 LDS	R2,Result+32
    0350A 9220 03A4 STS	GUI_date+9,R2
(0372)     GUI_date[11]=Result.Time[3];
    0350C 9020 0659 LDS	R2,Result+34
    0350E 9220 03A6 STS	GUI_date+11,R2
(0373)     GUI_date[12]=Result.Time[4];
    03510 9020 065A LDS	R2,Result+35
    03512 9220 03A7 STS	GUI_date+12,R2
(0374)     GUI_date[14]=Result.Time[6];
    03514 9020 065C LDS	R2,Result+37
    03516 9220 03A9 STS	GUI_date+14,R2
(0375)     GUI_date[15]=Result.Time[7];
    03518 9020 065D LDS	R2,Result+38
    0351A 9220 03AA STS	GUI_date+15,R2
(0376)     GUI_date[16]='\0';
    0351C 2422      CLR	R2
    0351D 9220 03AB STS	GUI_date+16,R2
(0377)     return GUI_date;
    0351F E90B      LDI	R16,0x9B
    03520 E013      LDI	R17,3
    03521 9508      RET
_GUI_set_time:
  GUI_down             --> Y,+5
  GUI_up               --> Y,+2
  ary                  --> R12
  p                    --> Y,+10
  i                    --> R14
  keyc                 --> R20
  pT                   --> R10
  pD                   --> Y,+8
    03522 940E 48C3 CALL	push_xgsetF0FC
    03524 972B      SBIW	R28,0xB
(0378) }
(0379) //设置时间 菜单 
(0380) void GUI_set_time(void){
(0381)     unsigned char p=2;
    03525 E082      LDI	R24,2
    03526 878A      STD	Y+10,R24
(0382) 	char GUI_up[]= "↑";
    03527 EA8C      LDI	R24,0xAC
    03528 E093      LDI	R25,3
    03529 01FE      MOVW	R30,R28
    0352A 9632      ADIW	R30,2
    0352B E003      LDI	R16,3
    0352C E010      LDI	R17,0
    0352D 93FA      ST	-Y,R31
    0352E 93EA      ST	-Y,R30
    0352F 939A      ST	-Y,R25
    03530 938A      ST	-Y,R24
    03531 940E 4973 CALL	asgnblk
(0383) 	char GUI_down[]= "↓";
    03533 EA8F      LDI	R24,0xAF
    03534 E093      LDI	R25,3
    03535 01FE      MOVW	R30,R28
    03536 9635      ADIW	R30,5
    03537 E003      LDI	R16,3
    03538 E010      LDI	R17,0
    03539 93FA      ST	-Y,R31
    0353A 93EA      ST	-Y,R30
    0353B 939A      ST	-Y,R25
    0353C 938A      ST	-Y,R24
    0353D 940E 4973 CALL	asgnblk
(0384) 	char *pD=NULL,*pT=NULL;
    0353F 2400      CLR	R0
    03540 2411      CLR	R1
    03541 8619      STD	Y+9,R1
    03542 8608      STD	Y+8,R0
(0385) 	char *ary=GUI_up;
    03543 01CE      MOVW	R24,R28
    03544 9602      ADIW	R24,2
    03545 016C      MOVW	R12,R24
(0386) 	unsigned char i=0,keyc=NO_KEY;
    03546 24EE      CLR	R14
    03547 2744      CLR	R20
(0387) 	LCD_CLR(); //清屏
    03548 940E 3D44 CALL	_LCD_CLR
(0388) 	pD="2012年12月31日\0";
    0354A E788      LDI	R24,0x78
    0354B E094      LDI	R25,4
    0354C 8799      STD	Y+9,R25
    0354D 8788      STD	Y+8,R24
(0389) 	pT="12: 30: 59\0";
    0354E E68C      LDI	R24,0x6C
    0354F E094      LDI	R25,4
    03550 015C      MOVW	R10,R24
(0390) 	LCD_const_disp(1,1,"时间设置:       ");
    03551 E58B      LDI	R24,0x5B
    03552 E094      LDI	R25,4
    03553 8399      STD	Y+1,R25
    03554 8388      ST	Y,R24
    03555 E021      LDI	R18,1
    03556 E001      LDI	R16,1
    03557 940E 3C9E CALL	_LCD_const_disp
(0391) 	LCD_const_disp(4,7,"保存");
    03559 E586      LDI	R24,0x56
    0355A E094      LDI	R25,4
    0355B 8399      STD	Y+1,R25
    0355C 8388      ST	Y,R24
    0355D E027      LDI	R18,7
    0355E E004      LDI	R16,4
    0355F 940E 3C9E CALL	_LCD_const_disp
(0392) 	LCD_var_disp(3,p,ary);
    03561 82D9      STD	Y+1,R13
    03562 82C8      ST	Y,R12
    03563 852A      LDD	R18,Y+10
    03564 E003      LDI	R16,3
    03565 940E 3CCB CALL	_LCD_var_disp
(0393) 	LCD_var_disp(2,1,pD);
    03567 8408      LDD	R0,Y+8
    03568 8419      LDD	R1,Y+9
    03569 8219      STD	Y+1,R1
    0356A 8208      ST	Y,R0
    0356B E021      LDI	R18,1
    0356C E002      LDI	R16,2
    0356D 940E 3CCB CALL	_LCD_var_disp
(0394) 	LCD_var_disp(4,1,pT);
    0356F 82B9      STD	Y+1,R11
    03570 82A8      ST	Y,R10
    03571 E021      LDI	R18,1
    03572 E004      LDI	R16,4
    03573 940E 3CCB CALL	_LCD_var_disp
(0395) 	delayms(250);
    03575 EF0A      LDI	R16,0xFA
    03576 E010      LDI	R17,0
    03577 940E 2537 CALL	_delayms
    03579 C1F7      RJMP	0x3771
(0396) 	while(1){
(0397) 	    keyc=kbscan();
    0357A 940E 42A4 CALL	_kbscan
    0357C 2F40      MOV	R20,R16
(0398) 		heaterSwitch();
    0357D 940E 25F0 CALL	_heaterSwitch
(0399) 		pD[2]=Result.Date[2];
    0357F 9020 064F LDS	R2,Result+24
    03581 85E8      LDD	R30,Y+8
    03582 85F9      LDD	R31,Y+9
    03583 8222      STD	Z+2,R2
(0400) 		pD[3]=Result.Date[3];
    03584 9020 0650 LDS	R2,Result+25
    03586 8223      STD	Z+3,R2
(0401) 		pD[6]=Result.Date[4];
    03587 9020 0651 LDS	R2,Result+26
    03589 8226      STD	Z+6,R2
(0402) 		pD[7]=Result.Date[5];
    0358A 9020 0652 LDS	R2,Result+27
    0358C 8227      STD	Z+7,R2
(0403) 		pD[10]=Result.Date[6];
    0358D 9020 0653 LDS	R2,Result+28
    0358F 8622      STD	Z+10,R2
(0404) 		pD[11]=Result.Date[7];  
    03590 9020 0654 LDS	R2,Result+29
    03592 8623      STD	Z+11,R2
(0405) 		pT[0] = Result.Time[0];
    03593 9020 0656 LDS	R2,Result+31
    03595 01F5      MOVW	R30,R10
    03596 8220      ST	Z,R2
(0406) 		pT[1] = Result.Time[1];
    03597 9020 0657 LDS	R2,Result+32
    03599 8221      STD	Z+1,R2
(0407) 		pT[4] = Result.Time[3];
    0359A 9020 0659 LDS	R2,Result+34
    0359C 8224      STD	Z+4,R2
(0408) 		pT[5] = Result.Time[4];
    0359D 9020 065A LDS	R2,Result+35
    0359F 8225      STD	Z+5,R2
(0409) 		pT[8] = Result.Time[6];
    035A0 9020 065C LDS	R2,Result+37
    035A2 8620      STD	Z+8,R2
(0410) 		pT[9] = Result.Time[7];
    035A3 9020 065D LDS	R2,Result+38
    035A5 8621      STD	Z+9,R2
(0411) 		
(0412) 		switch(i){
    035A6 2D6E      MOV	R22,R14
    035A7 2777      CLR	R23
    035A8 3060      CPI	R22,0
    035A9 0767      CPC	R22,R23
    035AA F0D1      BEQ	0x35C5
    035AB 3061      CPI	R22,1
    035AC E0E0      LDI	R30,0
    035AD 077E      CPC	R23,R30
    035AE F409      BNE	0x35B0
    035AF C04A      RJMP	0x35FA
    035B0 3062      CPI	R22,2
    035B1 E0E0      LDI	R30,0
    035B2 077E      CPC	R23,R30
    035B3 F409      BNE	0x35B5
    035B4 C07C      RJMP	0x3631
    035B5 3063      CPI	R22,3
    035B6 E0E0      LDI	R30,0
    035B7 077E      CPC	R23,R30
    035B8 F409      BNE	0x35BA
    035B9 C0BE      RJMP	0x3678
    035BA 3064      CPI	R22,4
    035BB E0E0      LDI	R30,0
    035BC 077E      CPC	R23,R30
    035BD F409      BNE	0x35BF
    035BE C0F1      RJMP	0x36B0
    035BF 3065      CPI	R22,5
    035C0 E0E0      LDI	R30,0
    035C1 077E      CPC	R23,R30
    035C2 F409      BNE	0x35C4
    035C3 C123      RJMP	0x36E7
    035C4 C15C      RJMP	0x3721
(0413)             case 0: p=2;ary=GUI_up;  //年
    035C5 E082      LDI	R24,2
    035C6 878A      STD	Y+10,R24
    035C7 01CE      MOVW	R24,R28
    035C8 9602      ADIW	R24,2
    035C9 016C      MOVW	R12,R24
(0414) 		 	  	 if(keyc==up){
    035CA 314E      CPI	R20,0x1E
    035CB F491      BNE	0x35DE
(0415) 				     if(time_buf[1]<0x99){ 
    035CC 9180 05DA LDS	R24,time_buf+1
    035CE 3989      CPI	R24,0x99
    035CF F008      BCS	0x35D1
    035D0 C150      RJMP	0x3721
(0416) 					     time_buf[1]++;
    035D1 5F8F      SUBI	R24,0xFF
    035D2 9380 05DA STS	time_buf+1,R24
(0417) 						 if((time_buf[1]&0x0f)==0x0a) 
    035D4 708F      ANDI	R24,0xF
    035D5 308A      CPI	R24,0xA
    035D6 F009      BEQ	0x35D8
    035D7 C149      RJMP	0x3721
(0418) 						     time_buf[1]=time_buf[1]+6;
    035D8 9180 05DA LDS	R24,time_buf+1
    035DA 5F8A      SUBI	R24,0xFA
    035DB 9380 05DA STS	time_buf+1,R24
(0419) 					 }
(0420) 												     
(0421) 				}				  
    035DD C143      RJMP	0x3721
(0422)  					        
(0423) 			    else if(keyc==down){ 
    035DE 314D      CPI	R20,0x1D
    035DF F4A1      BNE	0x35F4
(0424) 				    if(time_buf[1]>0x00){
    035E0 E080      LDI	R24,0
    035E1 9020 05DA LDS	R2,time_buf+1
    035E3 1582      CP	R24,R2
    035E4 F008      BCS	0x35E6
    035E5 C13B      RJMP	0x3721
(0425) 				        time_buf[1]--;
    035E6 2D82      MOV	R24,R2
    035E7 5081      SUBI	R24,1
    035E8 9380 05DA STS	time_buf+1,R24
(0426) 						if((time_buf[1]&0x0f)==0x0f) 
    035EA 708F      ANDI	R24,0xF
    035EB 308F      CPI	R24,0xF
    035EC F009      BEQ	0x35EE
    035ED C133      RJMP	0x3721
(0427) 						    time_buf[1]=time_buf[1]-6;
    035EE 9180 05DA LDS	R24,time_buf+1
    035F0 5086      SUBI	R24,6
    035F1 9380 05DA STS	time_buf+1,R24
(0428) 		 	  	 		 }
(0429) 												   
(0430) 					}			   		
    035F3 C12D      RJMP	0x3721
(0431) 				else if(keyc==left) {i=1;}
    035F4 314B      CPI	R20,0x1B
    035F5 F009      BEQ	0x35F7
    035F6 C12A      RJMP	0x3721
    035F7 24EE      CLR	R14
    035F8 94E3      INC	R14
(0432) 				break;
    035F9 C127      RJMP	0x3721
(0433) 		 case 1:p=4;ary=GUI_up;  //月
    035FA E084      LDI	R24,4
    035FB 878A      STD	Y+10,R24
    035FC 01CE      MOVW	R24,R28
    035FD 9602      ADIW	R24,2
    035FE 016C      MOVW	R12,R24
(0434) 		  	  	if(keyc==up){
    035FF 314E      CPI	R20,0x1E
    03600 F499      BNE	0x3614
(0435) 				    if(time_buf[2]<0x12){  
    03601 9180 05DB LDS	R24,time_buf+2
    03603 3182      CPI	R24,0x12
    03604 F460      BCC	0x3611
(0436) 					    time_buf[2]++;	
    03605 5F8F      SUBI	R24,0xFF
    03606 9380 05DB STS	time_buf+2,R24
(0437) 						if((time_buf[2]&0x0f)==0x0a) time_buf[2]+=6;
    03608 708F      ANDI	R24,0xF
    03609 308A      CPI	R24,0xA
    0360A F449      BNE	0x3614
    0360B 9180 05DB LDS	R24,time_buf+2
    0360D 5F8A      SUBI	R24,0xFA
    0360E 9380 05DB STS	time_buf+2,R24
(0438) 					}
    03610 C003      RJMP	0x3614
(0439) 					else 
(0440) 					    time_buf[2]=0x01;
    03611 E081      LDI	R24,1
    03612 9380 05DB STS	time_buf+2,R24
(0441) 				}						 
(0442) 				if(keyc==down){ 
    03614 314D      CPI	R20,0x1D
    03615 F4A9      BNE	0x362B
(0443) 				    if(time_buf[2]>0x01){  
    03616 E081      LDI	R24,1
    03617 9020 05DB LDS	R2,time_buf+2
    03619 1582      CP	R24,R2
    0361A F468      BCC	0x3628
(0444) 					    time_buf[2]--;	
    0361B 2D82      MOV	R24,R2
    0361C 5081      SUBI	R24,1
    0361D 9380 05DB STS	time_buf+2,R24
(0445) 						if((time_buf[2]&0x0f)==0x0f) 
    0361F 708F      ANDI	R24,0xF
    03620 308F      CPI	R24,0xF
    03621 F449      BNE	0x362B
(0446) 						    time_buf[2]-=6;
    03622 9180 05DB LDS	R24,time_buf+2
    03624 5086      SUBI	R24,6
    03625 9380 05DB STS	time_buf+2,R24
(0447) 			  		}
    03627 C003      RJMP	0x362B
(0448) 				    else 
(0449) 					    time_buf[2]=0x12;						
    03628 E182      LDI	R24,0x12
    03629 9380 05DB STS	time_buf+2,R24
(0450) 				}						 							
(0451)  								
(0452) 				if(keyc==left){
    0362B 314B      CPI	R20,0x1B
    0362C F009      BEQ	0x362E
    0362D C0F3      RJMP	0x3721
(0453) 				    i=2;   
    0362E E082      LDI	R24,2
    0362F 2EE8      MOV	R14,R24
(0454) 				}  
(0455) 				break;
    03630 C0F0      RJMP	0x3721
(0456) 	 	 case 2: p=6;ary=GUI_up;
    03631 E086      LDI	R24,6
    03632 878A      STD	Y+10,R24
    03633 01CE      MOVW	R24,R28
    03634 9602      ADIW	R24,2
    03635 016C      MOVW	R12,R24
(0457) 		 	  	 if(keyc==up){ 
    03636 314E      CPI	R20,0x1E
    03637 F519      BNE	0x365B
(0458) 				     if(time_buf[3]<0x31){ 
    03638 9180 05DC LDS	R24,time_buf+3
    0363A 3381      CPI	R24,0x31
    0363B F5B0      BCC	0x3672
(0459) 				         time_buf[3]++;
    0363C 5F8F      SUBI	R24,0xFF
    0363D 9380 05DC STS	time_buf+3,R24
(0460) 						 if ((time_buf[3]&0x0f)==0x0a) time_buf[3]=time_buf[3]+6;
    0363F 708F      ANDI	R24,0xF
    03640 308A      CPI	R24,0xA
    03641 F429      BNE	0x3647
    03642 9180 05DC LDS	R24,time_buf+3
    03644 5F8A      SUBI	R24,0xFA
    03645 9380 05DC STS	time_buf+3,R24
(0461) 						 if(  //2 4 6 9 11 月最大30天
(0462) 						  ( ((time_buf[2]==0x02) || (time_buf[2]==0x04)|| (time_buf[2]==0x06)||
    03647 9180 05DB LDS	R24,time_buf+2
    03649 3082      CPI	R24,2
    0364A F041      BEQ	0x3653
    0364B 3084      CPI	R24,4
    0364C F031      BEQ	0x3653
    0364D 3086      CPI	R24,6
    0364E F021      BEQ	0x3653
    0364F 3089      CPI	R24,0x9
    03650 F011      BEQ	0x3653
    03651 3181      CPI	R24,0x11
    03652 F4F9      BNE	0x3672
    03653 9180 05DC LDS	R24,time_buf+3
    03655 3381      CPI	R24,0x31
    03656 F4D9      BNE	0x3672
(0463) 						  (time_buf[2]==0x09)||(time_buf[2]==0x11))&&(time_buf[3]==0x31))){
(0464) 						      time_buf[3]=0x30;
    03657 E380      LDI	R24,0x30
    03658 9380 05DC STS	time_buf+3,R24
(0465) 						}
(0466) 				     }
(0467)  									  
(0468)  				 }
    0365A C017      RJMP	0x3672
(0469) 			     else if(keyc==down){ 
    0365B 314D      CPI	R20,0x1D
    0365C F4A9      BNE	0x3672
(0470) 				      if(time_buf[3]>0x01){  
    0365D E081      LDI	R24,1
    0365E 9020 05DC LDS	R2,time_buf+3
    03660 1582      CP	R24,R2
    03661 F468      BCC	0x366F
(0471) 					     time_buf[3]--;
    03662 2D82      MOV	R24,R2
    03663 5081      SUBI	R24,1
    03664 9380 05DC STS	time_buf+3,R24
(0472) 				 	  	 if((time_buf[3]&0x0f)==0x0f) time_buf[3]=time_buf[3]-6;
    03666 708F      ANDI	R24,0xF
    03667 308F      CPI	R24,0xF
    03668 F449      BNE	0x3672
    03669 9180 05DC LDS	R24,time_buf+3
    0366B 5086      SUBI	R24,6
    0366C 9380 05DC STS	time_buf+3,R24
(0473) 		 	  	 	 }
    0366E C003      RJMP	0x3672
(0474) 					 else time_buf[3]=0x31;						
    0366F E381      LDI	R24,0x31
    03670 9380 05DC STS	time_buf+3,R24
(0475) 											   
(0476) 				}
(0477) 				if(keyc==left) {i=3;  }						 			   		
    03672 314B      CPI	R20,0x1B
    03673 F009      BEQ	0x3675
    03674 C0AC      RJMP	0x3721
    03675 E083      LDI	R24,3
    03676 2EE8      MOV	R14,R24
(0478) 				break;
    03677 C0A9      RJMP	0x3721
(0479) 		case 3:p=1;ary=GUI_down;
    03678 2400      CLR	R0
    03679 9403      INC	R0
    0367A 860A      STD	Y+10,R0
    0367B 01CE      MOVW	R24,R28
    0367C 9605      ADIW	R24,5
    0367D 016C      MOVW	R12,R24
(0480)  	  	if(keyc==up){ if(time_buf[4]<0x23){  time_buf[4]++;	
    0367E 314E      CPI	R20,0x1E
    0367F F499      BNE	0x3693
    03680 9180 05DD LDS	R24,time_buf+4
    03682 3283      CPI	R24,0x23
    03683 F460      BCC	0x3690
    03684 5F8F      SUBI	R24,0xFF
    03685 9380 05DD STS	time_buf+4,R24
(0481) 													if((time_buf[4]&0x0f)==0x0a) time_buf[4]+=6;
    03687 708F      ANDI	R24,0xF
    03688 308A      CPI	R24,0xA
    03689 F449      BNE	0x3693
    0368A 9180 05DD LDS	R24,time_buf+4
    0368C 5F8A      SUBI	R24,0xFA
    0368D 9380 05DD STS	time_buf+4,R24
(0482) 													 
(0483) 													
(0484) 												 }
    0368F C003      RJMP	0x3693
(0485) 							else time_buf[4]=0x00;
    03690 2422      CLR	R2
    03691 9220 05DD STS	time_buf+4,R2
(0486) 						  }						 
(0487) 				if(keyc==down){ if(time_buf[4]>0x00){  time_buf[4]--;	
    03693 314D      CPI	R20,0x1D
    03694 F4A9      BNE	0x36AA
    03695 E080      LDI	R24,0
    03696 9020 05DD LDS	R2,time_buf+4
    03698 1582      CP	R24,R2
    03699 F468      BCC	0x36A7
    0369A 2D82      MOV	R24,R2
    0369B 5081      SUBI	R24,1
    0369C 9380 05DD STS	time_buf+4,R24
(0488) 													if((time_buf[4]&0x0f)==0x0f) time_buf[4]-=6;
    0369E 708F      ANDI	R24,0xF
    0369F 308F      CPI	R24,0xF
    036A0 F449      BNE	0x36AA
    036A1 9180 05DD LDS	R24,time_buf+4
    036A3 5086      SUBI	R24,6
    036A4 9380 05DD STS	time_buf+4,R24
(0489) 													
(0490) 												 }
    036A6 C003      RJMP	0x36AA
(0491) 							 else time_buf[4]=0x23;						
    036A7 E283      LDI	R24,0x23
    036A8 9380 05DD STS	time_buf+4,R24
(0492) 						  }	
(0493) 		if(keyc==left) {i=4;    } 
    036AA 314B      CPI	R20,0x1B
    036AB F009      BEQ	0x36AD
    036AC C074      RJMP	0x3721
    036AD E084      LDI	R24,4
    036AE 2EE8      MOV	R14,R24
(0494) 		break;						  					 			
    036AF C071      RJMP	0x3721
(0495)  case 4:p=3;ary=GUI_down;
    036B0 E083      LDI	R24,3
    036B1 878A      STD	Y+10,R24
    036B2 01CE      MOVW	R24,R28
    036B3 9605      ADIW	R24,5
    036B4 016C      MOVW	R12,R24
(0496)  	  	if(keyc==up){ if(time_buf[5]<0x59){  time_buf[5]++;	
    036B5 314E      CPI	R20,0x1E
    036B6 F499      BNE	0x36CA
    036B7 9180 05DE LDS	R24,time_buf+5
    036B9 3589      CPI	R24,0x59
    036BA F460      BCC	0x36C7
    036BB 5F8F      SUBI	R24,0xFF
    036BC 9380 05DE STS	time_buf+5,R24
(0497) 											 if((time_buf[5]&0x0f)==0x0a) time_buf[5]+=6;
    036BE 708F      ANDI	R24,0xF
    036BF 308A      CPI	R24,0xA
    036C0 F449      BNE	0x36CA
    036C1 9180 05DE LDS	R24,time_buf+5
    036C3 5F8A      SUBI	R24,0xFA
    036C4 9380 05DE STS	time_buf+5,R24
(0498) 										  }
    036C6 C003      RJMP	0x36CA
(0499) 					  else time_buf[5]=0x00;
    036C7 2422      CLR	R2
    036C8 9220 05DE STS	time_buf+5,R2
(0500) 					}						 
(0501) 		if(keyc==down){ if(time_buf[5]>0x00){  time_buf[5]--;	
    036CA 314D      CPI	R20,0x1D
    036CB F4A9      BNE	0x36E1
    036CC E080      LDI	R24,0
    036CD 9020 05DE LDS	R2,time_buf+5
    036CF 1582      CP	R24,R2
    036D0 F468      BCC	0x36DE
    036D1 2D82      MOV	R24,R2
    036D2 5081      SUBI	R24,1
    036D3 9380 05DE STS	time_buf+5,R24
(0502) 												if((time_buf[5]&0x0f)==0x0f) time_buf[5]-=6;
    036D5 708F      ANDI	R24,0xF
    036D6 308F      CPI	R24,0xF
    036D7 F449      BNE	0x36E1
    036D8 9180 05DE LDS	R24,time_buf+5
    036DA 5086      SUBI	R24,6
    036DB 9380 05DE STS	time_buf+5,R24
(0503) 											}
    036DD C003      RJMP	0x36E1
(0504) 						else time_buf[5]=0x59;						
    036DE E589      LDI	R24,0x59
    036DF 9380 05DE STS	time_buf+5,R24
(0505) 					  }
(0506) 		if(keyc==left ) {i=5;    } 		  						 								  			
    036E1 314B      CPI	R20,0x1B
    036E2 F009      BEQ	0x36E4
    036E3 C03D      RJMP	0x3721
    036E4 E085      LDI	R24,5
    036E5 2EE8      MOV	R14,R24
(0507) 		break;			   
    036E6 C03A      RJMP	0x3721
(0508)  case 5:p=5;ary=GUI_down;
    036E7 E085      LDI	R24,5
    036E8 878A      STD	Y+10,R24
    036E9 01CE      MOVW	R24,R28
    036EA 9605      ADIW	R24,5
    036EB 016C      MOVW	R12,R24
(0509)  	  	if(keyc==up){ if(time_buf[6]<0x59){  time_buf[6]++;	
    036EC 314E      CPI	R20,0x1E
    036ED F499      BNE	0x3701
    036EE 9180 05DF LDS	R24,time_buf+6
    036F0 3589      CPI	R24,0x59
    036F1 F460      BCC	0x36FE
    036F2 5F8F      SUBI	R24,0xFF
    036F3 9380 05DF STS	time_buf+6,R24
(0510) 											 if((time_buf[6]&0x0f)==0x0a) time_buf[6]+=6;
    036F5 708F      ANDI	R24,0xF
    036F6 308A      CPI	R24,0xA
    036F7 F449      BNE	0x3701
    036F8 9180 05DF LDS	R24,time_buf+6
    036FA 5F8A      SUBI	R24,0xFA
    036FB 9380 05DF STS	time_buf+6,R24
(0511) 										 }
    036FD C003      RJMP	0x3701
(0512) 					  else time_buf[6]=0x00;
    036FE 2422      CLR	R2
    036FF 9220 05DF STS	time_buf+6,R2
(0513) 					}						 
(0514) 		if(keyc==down){ if(time_buf[6]>0x00){  time_buf[6]--;	
    03701 314D      CPI	R20,0x1D
    03702 F4A9      BNE	0x3718
    03703 E080      LDI	R24,0
    03704 9020 05DF LDS	R2,time_buf+6
    03706 1582      CP	R24,R2
    03707 F468      BCC	0x3715
    03708 2D82      MOV	R24,R2
    03709 5081      SUBI	R24,1
    0370A 9380 05DF STS	time_buf+6,R24
(0515) 						if((time_buf[6]&0x0f)==0x0f) time_buf[6]-=6;
    0370C 708F      ANDI	R24,0xF
    0370D 308F      CPI	R24,0xF
    0370E F449      BNE	0x3718
    0370F 9180 05DF LDS	R24,time_buf+6
    03711 5086      SUBI	R24,6
    03712 9380 05DF STS	time_buf+6,R24
(0516) 					  }
    03714 C003      RJMP	0x3718
(0517) 		else time_buf[6]=0x59;		}				
    03715 E589      LDI	R24,0x59
    03716 9380 05DF STS	time_buf+6,R24
(0518) 		if(keyc==left) {i=6;p=1;ary=NULL;}  
    03718 314B      CPI	R20,0x1B
    03719 F439      BNE	0x3721
    0371A E086      LDI	R24,6
    0371B 2EE8      MOV	R14,R24
    0371C 2400      CLR	R0
    0371D 9403      INC	R0
    0371E 860A      STD	Y+10,R0
    0371F 24CC      CLR	R12
    03720 24DD      CLR	R13
(0519) 		break;           
(0520) 							 
(0521) 		 }//endcase
(0522)  		 dateRefresh(88); //set clock mode
    03721 E508      LDI	R16,0x58
    03722 D214      RCALL	_dateRefresh
(0523) 		 
(0524) 		 LCD_const_disp(3,1,"                "); //清空箭头 
    03723 E485      LDI	R24,0x45
    03724 E094      LDI	R25,4
    03725 8399      STD	Y+1,R25
    03726 8388      ST	Y,R24
    03727 E021      LDI	R18,1
    03728 E003      LDI	R16,3
    03729 940E 3C9E CALL	_LCD_const_disp
(0525)  		 LCD_var_disp(3,p,ary); //显示箭头 
    0372B 82D9      STD	Y+1,R13
    0372C 82C8      ST	Y,R12
    0372D 852A      LDD	R18,Y+10
    0372E E003      LDI	R16,3
    0372F 940E 3CCB CALL	_LCD_var_disp
(0526)  		 LCD_var_disp(2,1,pD);  //显示日期
    03731 8408      LDD	R0,Y+8
    03732 8419      LDD	R1,Y+9
    03733 8219      STD	Y+1,R1
    03734 8208      ST	Y,R0
    03735 E021      LDI	R18,1
    03736 E002      LDI	R16,2
    03737 940E 3CCB CALL	_LCD_var_disp
(0527)  		 LCD_var_disp(4,1,pT);  //显示时间
    03739 82B9      STD	Y+1,R11
    0373A 82A8      ST	Y,R10
    0373B E021      LDI	R18,1
    0373C E004      LDI	R16,4
    0373D 940E 3CCB CALL	_LCD_var_disp
(0528)  if(keyc==right) {		  
    0373F 3147      CPI	R20,0x17
    03740 F479      BNE	0x3750
(0529)  		  LCD_const_disp(3,1,"        放弃修改"); 
    03741 E384      LDI	R24,0x34
    03742 E094      LDI	R25,4
    03743 8399      STD	Y+1,R25
    03744 8388      ST	Y,R24
    03745 E021      LDI	R18,1
    03746 E003      LDI	R16,3
    03747 940E 3C9E CALL	_LCD_const_disp
(0530) 		  delayms(500);
    03749 EF04      LDI	R16,0xF4
    0374A E011      LDI	R17,1
    0374B 940E 2537 CALL	_delayms
(0531) 		  LCD_CLR(); //清屏
    0374D 940E 3D44 CALL	_LCD_CLR
(0532) 		  return ;} 
    0374F C022      RJMP	0x3772
(0533)  keyc=NO_KEY;
    03750 2744      CLR	R20
(0534)  if(i==6){    //各值改变完成后 显示已保存 清屏 返回
    03751 2D8E      MOV	R24,R14
    03752 3086      CPI	R24,6
    03753 F4C9      BNE	0x376D
(0535) 		  ds1302_write_time(); 
    03754 940E 4257 CALL	_ds1302_write_time
(0536)           LCD_const_disp(4,7,"    ");		  
    03756 E28F      LDI	R24,0x2F
    03757 E094      LDI	R25,4
    03758 8399      STD	Y+1,R25
    03759 8388      ST	Y,R24
    0375A E027      LDI	R18,7
    0375B E004      LDI	R16,4
    0375C 940E 3C9E CALL	_LCD_const_disp
(0537) 		  LCD_const_disp(3,1,"          已保存"); 
    0375E E18E      LDI	R24,0x1E
    0375F E094      LDI	R25,4
    03760 8399      STD	Y+1,R25
    03761 8388      ST	Y,R24
    03762 E021      LDI	R18,1
    03763 E003      LDI	R16,3
    03764 940E 3C9E CALL	_LCD_const_disp
(0538) 		  delayms(300);
    03766 E20C      LDI	R16,0x2C
    03767 E011      LDI	R17,1
    03768 940E 2537 CALL	_delayms
(0539) 		  LCD_CLR(); //清屏
    0376A 940E 3D44 CALL	_LCD_CLR
(0540) 		  return ;
    0376C C005      RJMP	0x3772
(0541) 		  }
(0542)  delayms(2);	  
    0376D E002      LDI	R16,2
    0376E E010      LDI	R17,0
    0376F 940E 2537 CALL	_delayms
    03771 CE08      RJMP	0x357A
    03772 962B      ADIW	R28,0xB
    03773 940C 48B8 JMP	pop_xgsetF0FC
_GUI_readback:
  res                  --> R12
  file_buf             --> Y,+3
  page                 --> R20
  key                  --> R22
  buf                  --> R10
    03775 940E 48C3 CALL	push_xgsetF0FC
    03777 0158      MOVW	R10,R16
    03778 9760      SBIW	R28,0x10
(0543) }//endwhile(1)
(0544) }
(0545) void GUI_readback(char *buf){
(0546)     char key=0;
    03779 2766      CLR	R22
(0547) 	char page=0;
    0377A 2744      CLR	R20
(0548) 	char res=0;
    0377B 24CC      CLR	R12
(0549) 	char file_buf[]="201201.xls\0\0";
    0377C EB82      LDI	R24,0xB2
    0377D E093      LDI	R25,3
    0377E 01FE      MOVW	R30,R28
    0377F 9633      ADIW	R30,3
    03780 E00D      LDI	R16,0xD
    03781 E010      LDI	R17,0
    03782 93FA      ST	-Y,R31
    03783 93EA      ST	-Y,R30
    03784 939A      ST	-Y,R25
    03785 938A      ST	-Y,R24
    03786 940E 4973 CALL	asgnblk
(0550) 	LCD_CLR(); //清屏
    03788 940E 3D44 CALL	_LCD_CLR
(0551) 	//1 检测SD状态
(0552) 		//无SD卡 显示无卡 退出
(0553) 	if((SD_DET()==0)) {
    0378A B181      IN	R24,0x01
    0378B 9586      LSR	R24
    0378C 9586      LSR	R24
    0378D 9586      LSR	R24
    0378E 9586      LSR	R24
    0378F 9586      LSR	R24
    03790 7081      ANDI	R24,1
    03791 F421      BNE	0x3796
    03792 E081      LDI	R24,1
    03793 E090      LDI	R25,0
    03794 017C      MOVW	R14,R24
    03795 C002      RJMP	0x3798
    03796 24EE      CLR	R14
    03797 24FF      CLR	R15
    03798 20EE      TST	R14
    03799 F479      BNE	0x37A9
    0379A 20FF      TST	R15
    0379B F469      BNE	0x37A9
(0554) 		LCD_const_disp(2,1,"未检测到SD卡..");
    0379C E08F      LDI	R24,0xF
    0379D E094      LDI	R25,4
    0379E 8399      STD	Y+1,R25
    0379F 8388      ST	Y,R24
    037A0 E021      LDI	R18,1
    037A1 E002      LDI	R16,2
    037A2 940E 3C9E CALL	_LCD_const_disp
(0555) 			#ifdef _DBG_RD_
(0556) 		   PrintString_n("not find sd");
(0557) 		   #endif
(0558) 		delayms(500);
    037A4 EF04      LDI	R16,0xF4
    037A5 E011      LDI	R17,1
    037A6 940E 2537 CALL	_delayms
(0559) 		return ;
    037A8 C16E      RJMP	0x3917
(0560) 	}
(0561) 	//2 显示当前月份
(0562) 	get_name(file_buf);
    037A9 018E      MOVW	R16,R28
    037AA 5F0D      SUBI	R16,0xFD
    037AB 4F1F      SBCI	R17,0xFF
    037AC 940E 2C78 CALL	_get_name
(0563) 	LCD_const_disp(1,1,"查找数据:");
    037AE E085      LDI	R24,5
    037AF E094      LDI	R25,4
    037B0 8399      STD	Y+1,R25
    037B1 8388      ST	Y,R24
    037B2 E021      LDI	R18,1
    037B3 E001      LDI	R16,1
    037B4 940E 3C9E CALL	_LCD_const_disp
(0564) 	LCD_const_disp(2,2,file_buf);
    037B6 01CE      MOVW	R24,R28
    037B7 9603      ADIW	R24,3
    037B8 8399      STD	Y+1,R25
    037B9 8388      ST	Y,R24
    037BA E022      LDI	R18,2
    037BB E002      LDI	R16,2
    037BC 940E 3C9E CALL	_LCD_const_disp
(0565) 	#ifdef _DBG_RD_
(0566) 		   PrintString_n(file_buf);
(0567) 	#endif
(0568) 	//3 查找文件是否存在
(0569) 		//存在-> 进入读取顺序的选择
(0570) 		//不存在 -> 询问查找上月
(0571) 	//4 选择 查询顺序
(0572) 		//计算总条数
(0573) 		//顺序 增量为1， 查询第一条 
(0574) 		//逆序 增量为-1，查询最后一条
(0575) 	//5 读取	
(0576) 	//6 显示
(0577) 	//7 上一条 下一条  退出
(0578) 		//设置条数 判断边界 进入5
(0579) 		//退出 返回主程序	
(0580) 	//!!res=checkFile(file_buf);
(0581) label_recheck:	
(0582) 	LCD_Init(); //清屏
    037BE 940E 3D12 CALL	_LCD_Init
(0583) 	LCD_CLR();  
    037C0 940E 3D44 CALL	_LCD_CLR
(0584) 	if(res == 0){ //找到并已经确认文件
    037C2 20CC      TST	R12
    037C3 F009      BEQ	0x37C5
    037C4 C152      RJMP	0x3917
(0585) 		   LCD_const_disp(1,1,"菜单/ 查询");
    037C5 EF8A      LDI	R24,0xFA
    037C6 E093      LDI	R25,3
    037C7 8399      STD	Y+1,R25
    037C8 8388      ST	Y,R24
    037C9 E021      LDI	R18,1
    037CA E001      LDI	R16,1
    037CB 940E 3C9E CALL	_LCD_const_disp
(0586)    		   LCD_const_disp(2,3,"按顺序");
    037CD EF83      LDI	R24,0xF3
    037CE E093      LDI	R25,3
    037CF 8399      STD	Y+1,R25
    037D0 8388      ST	Y,R24
    037D1 E023      LDI	R18,3
    037D2 E002      LDI	R16,2
    037D3 940E 3C9E CALL	_LCD_const_disp
(0587) 		   LCD_const_disp(3,3,"最后一次");		 
    037D5 EE8A      LDI	R24,0xEA
    037D6 E093      LDI	R25,3
    037D7 8399      STD	Y+1,R25
    037D8 8388      ST	Y,R24
    037D9 E023      LDI	R18,3
    037DA E003      LDI	R16,3
    037DB 940E 3C9E CALL	_LCD_const_disp
(0588) 	       if(config.readMode == READ_MODE_LAST){
    037DD 9020 08BC LDS	R2,config+19
    037DF 2022      TST	R2
    037E0 F4A1      BNE	0x37F5
(0589) 		       config.readMode=READ_MODE_FIRST;
    037E1 E081      LDI	R24,1
    037E2 9380 08BC STS	config+19,R24
(0590) 			   Set_White(1,2,8,0);
    037E4 2422      CLR	R2
    037E5 822A      STD	Y+2,R2
    037E6 E088      LDI	R24,0x8
    037E7 8388      ST	Y,R24
    037E8 E022      LDI	R18,2
    037E9 E001      LDI	R16,1
    037EA 940E 3DCE CALL	_Set_White
(0591)  			   Set_White(1,3,8,1);
    037EC E081      LDI	R24,1
    037ED 838A      STD	Y+2,R24
    037EE E088      LDI	R24,0x8
    037EF 8388      ST	Y,R24
    037F0 E023      LDI	R18,3
    037F1 E001      LDI	R16,1
    037F2 940E 3DCE CALL	_Set_White
(0592) 		  }
    037F4 C069      RJMP	0x385E
(0593) 		  else {
(0594) 		       config.readMode=READ_MODE_LAST;
    037F5 2422      CLR	R2
    037F6 9220 08BC STS	config+19,R2
(0595) 			   Set_White(1,2,8,1);
    037F8 E081      LDI	R24,1
    037F9 838A      STD	Y+2,R24
    037FA E088      LDI	R24,0x8
    037FB 8388      ST	Y,R24
    037FC E022      LDI	R18,2
    037FD E001      LDI	R16,1
    037FE 940E 3DCE CALL	_Set_White
(0596)  			   Set_White(1,3,8,0);
    03800 2422      CLR	R2
    03801 822A      STD	Y+2,R2
    03802 E088      LDI	R24,0x8
    03803 8388      ST	Y,R24
    03804 E023      LDI	R18,3
    03805 E001      LDI	R16,1
    03806 940E 3DCE CALL	_Set_White
(0597) 		 }
    03808 C055      RJMP	0x385E
(0598) 		   // 菜单/查询   按顺序/最后一次
(0599) 		   while(1){
(0600)  		       key=kbscan();
    03809 940E 42A4 CALL	_kbscan
    0380B 2F60      MOV	R22,R16
(0601) 			   heaterSwitch();
    0380C 940E 25F0 CALL	_heaterSwitch
(0602) 			   dateRefresh(0); //只刷新后台时间
    0380E 2700      CLR	R16
    0380F D127      RCALL	_dateRefresh
(0603) 			   //上键短按 选择
(0604) 			   if(key==up || key ==down){
    03810 316E      CPI	R22,0x1E
    03811 F011      BEQ	0x3814
    03812 316D      CPI	R22,0x1D
    03813 F559      BNE	0x383F
(0605) 	    	       if(config.readMode == READ_MODE_LAST){
    03814 9020 08BC LDS	R2,config+19
    03816 2022      TST	R2
    03817 F4A1      BNE	0x382C
(0606) 		    	       config.readMode=READ_MODE_FIRST;
    03818 E081      LDI	R24,1
    03819 9380 08BC STS	config+19,R24
(0607) 					   Set_White(1,2,8,0);
    0381B 2422      CLR	R2
    0381C 822A      STD	Y+2,R2
    0381D E088      LDI	R24,0x8
    0381E 8388      ST	Y,R24
    0381F E022      LDI	R18,2
    03820 E001      LDI	R16,1
    03821 940E 3DCE CALL	_Set_White
(0608)  					   Set_White(1,3,8,1);
    03823 E081      LDI	R24,1
    03824 838A      STD	Y+2,R24
    03825 E088      LDI	R24,0x8
    03826 8388      ST	Y,R24
    03827 E023      LDI	R18,3
    03828 E001      LDI	R16,1
    03829 940E 3DCE CALL	_Set_White
(0609) 				   }
    0382B C013      RJMP	0x383F
(0610) 				   else {
(0611) 		    	       config.readMode=READ_MODE_LAST;
    0382C 2422      CLR	R2
    0382D 9220 08BC STS	config+19,R2
(0612) 					   Set_White(1,2,8,1);
    0382F E081      LDI	R24,1
    03830 838A      STD	Y+2,R24
    03831 E088      LDI	R24,0x8
    03832 8388      ST	Y,R24
    03833 E022      LDI	R18,2
    03834 E001      LDI	R16,1
    03835 940E 3DCE CALL	_Set_White
(0613)  					   Set_White(1,3,8,0);
    03837 2422      CLR	R2
    03838 822A      STD	Y+2,R2
    03839 E088      LDI	R24,0x8
    0383A 8388      ST	Y,R24
    0383B E023      LDI	R18,3
    0383C E001      LDI	R16,1
    0383D 940E 3DCE CALL	_Set_White
(0614) 				   }
(0615) 				}      
(0616) 				//左键短按  进入
(0617) 				if(key == left) {
    0383F 316B      CPI	R22,0x1B
    03840 F4A9      BNE	0x3856
(0618) 				    Set_White(1,2,8,1);
    03841 E081      LDI	R24,1
    03842 838A      STD	Y+2,R24
    03843 E088      LDI	R24,0x8
    03844 8388      ST	Y,R24
    03845 E022      LDI	R18,2
    03846 E001      LDI	R16,1
    03847 940E 3DCE CALL	_Set_White
(0619)  				    Set_White(1,3,8,1);
    03849 E081      LDI	R24,1
    0384A 838A      STD	Y+2,R24
    0384B E088      LDI	R24,0x8
    0384C 8388      ST	Y,R24
    0384D E023      LDI	R18,3
    0384E E001      LDI	R16,1
    0384F 940E 3DCE CALL	_Set_White
(0620) 					delayms(100);
    03851 E604      LDI	R16,0x64
    03852 E010      LDI	R17,0
    03853 940E 2537 CALL	_delayms
(0621) 				break ;		
    03855 C009      RJMP	0x385F
(0622) 				}
(0623) 				//右键短按  返回
(0624) 				if(key == right) {
    03856 3167      CPI	R22,0x17
    03857 F429      BNE	0x385D
(0625) 				    LCD_CLR();
    03858 940E 3D44 CALL	_LCD_CLR
(0626) 	    			LCD_Init(); //清屏
    0385A 940E 3D12 CALL	_LCD_Init
(0627) 					return ;	//返回主界面	
    0385C C0BA      RJMP	0x3917
(0628) 				}
(0629) 				key=0;
    0385D 2766      CLR	R22
    0385E CFAA      RJMP	0x3809
(0630) 		    } //end of while
(0631) 			if(config.readMode==READ_MODE_LAST){
    0385F 9020 08BC LDS	R2,config+19
    03861 2022      TST	R2
    03862 F461      BNE	0x386F
(0632) 			    ReadSDFile(file_buf,65535,buf,0); //最后一条
    03863 2422      CLR	R2
    03864 822A      STD	Y+2,R2
    03865 82B9      STD	Y+1,R11
    03866 82A8      ST	Y,R10
    03867 EF2F      LDI	R18,0xFF
    03868 EF3F      LDI	R19,0xFF
    03869 018E      MOVW	R16,R28
    0386A 5F0D      SUBI	R16,0xFD
    0386B 4F1F      SBCI	R17,0xFF
    0386C 940E 27ED CALL	_ReadSDFile
(0633) 			}
    0386E C00B      RJMP	0x387A
(0634) 			else {
(0635) 			    ReadSDFile(file_buf,1,buf,0); //读第一条
    0386F 2422      CLR	R2
    03870 822A      STD	Y+2,R2
    03871 82B9      STD	Y+1,R11
    03872 82A8      ST	Y,R10
    03873 E021      LDI	R18,1
    03874 E030      LDI	R19,0
    03875 018E      MOVW	R16,R28
    03876 5F0D      SUBI	R16,0xFD
    03877 4F1F      SBCI	R17,0xFF
    03878 940E 27ED CALL	_ReadSDFile
(0636) 			}
(0637) 			CharToStruct(buf);      //转换
    0387A 0185      MOVW	R16,R10
    0387B 940E 2C33 CALL	_CharToStruct
    0387D C098      RJMP	0x3916
(0638) 			while(1){
(0639) 			    key=kbscan();     //键盘扫描
    0387E 940E 42A4 CALL	_kbscan
    03880 2F60      MOV	R22,R16
(0640) 				heaterSwitch();
    03881 940E 25F0 CALL	_heaterSwitch
(0641) 				dateRefresh(0); //只刷新后台时间
    03883 2700      CLR	R16
    03884 D0B2      RCALL	_dateRefresh
(0642) 				if(key != 0){ 
    03885 2366      TST	R22
    03886 F021      BEQ	0x388B
(0643) 					   beep(0,1);
    03887 E021      LDI	R18,1
    03888 2700      CLR	R16
    03889 940E 401B CALL	_beep
(0644) 				}
(0645) 				//dateRefresh(0);  //刷新
(0646) 				_GUI_datashow(page); //显示
    0388B 2F04      MOV	R16,R20
    0388C DA5B      RCALL	__GUI_datashow
(0647) 				if( key==left ){ //按left键下一条
    0388D 316B      CPI	R22,0x1B
    0388E F4A1      BNE	0x38A3
(0648) 					next_item:  //下一条
(0649) 				    ReadSDFile(file_buf,1,buf,1); //偏移到下一条
    0388F E081      LDI	R24,1
    03890 838A      STD	Y+2,R24
    03891 82B9      STD	Y+1,R11
    03892 82A8      ST	Y,R10
    03893 E021      LDI	R18,1
    03894 E030      LDI	R19,0
    03895 018E      MOVW	R16,R28
    03896 5F0D      SUBI	R16,0xFD
    03897 4F1F      SBCI	R17,0xFF
    03898 940E 27ED CALL	_ReadSDFile
(0650) 					CharToStruct(buf);
    0389A 0185      MOVW	R16,R10
    0389B 940E 2C33 CALL	_CharToStruct
(0651) 					LCD_CLR();
    0389D 940E 3D44 CALL	_LCD_CLR
(0652) 		    		LCD_Init();
    0389F 940E 3D12 CALL	_LCD_Init
(0653) 					page = 0;
    038A1 2744      CLR	R20
(0654) 					key=0;
    038A2 2766      CLR	R22
(0655) 				}
(0656) 				if( key==lleft ){ //长按left键上一条
    038A3 396B      CPI	R22,0x9B
    038A4 F4A1      BNE	0x38B9
(0657) 		    	    pre_item: //上一条
(0658) 					ReadSDFile(file_buf,-1,buf,1); //偏移到上一条
    038A5 E081      LDI	R24,1
    038A6 838A      STD	Y+2,R24
    038A7 82B9      STD	Y+1,R11
    038A8 82A8      ST	Y,R10
    038A9 EF2F      LDI	R18,0xFF
    038AA EF3F      LDI	R19,0xFF
    038AB 018E      MOVW	R16,R28
    038AC 5F0D      SUBI	R16,0xFD
    038AD 4F1F      SBCI	R17,0xFF
    038AE 940E 27ED CALL	_ReadSDFile
(0659) 					CharToStruct(buf);
    038B0 0185      MOVW	R16,R10
    038B1 940E 2C33 CALL	_CharToStruct
(0660) 					LCD_CLR();
    038B3 940E 3D44 CALL	_LCD_CLR
(0661) 		    		LCD_Init();
    038B5 940E 3D12 CALL	_LCD_Init
(0662) 					page = 0;
    038B7 2744      CLR	R20
(0663) 					key=0;
    038B8 2766      CLR	R22
(0664) 				}
(0665) 				if(key==up){ //上键 : 页面减 
    038B9 316E      CPI	R22,0x1E
    038BA F441      BNE	0x38C3
(0666) 	    		     LCD_CLR();
    038BB 940E 3D44 CALL	_LCD_CLR
(0667) 		    		 LCD_Init();
    038BD 940E 3D12 CALL	_LCD_Init
(0668) 					 if(page>0) page--;
    038BF E080      LDI	R24,0
    038C0 1784      CP	R24,R20
    038C1 F718      BCC	0x38A5
    038C2 954A      DEC	R20
(0669) 	    			 else{ 
(0670) 					    goto pre_item;
(0671) 					 }
(0672) 				}
(0673) 				if(key==lup){ //长按上键 : -10 条 
    038C3 396E      CPI	R22,0x9E
    038C4 F4A1      BNE	0x38D9
(0674) 	    		     LCD_CLR();
    038C5 940E 3D44 CALL	_LCD_CLR
(0675) 		    		 LCD_Init();
    038C7 940E 3D12 CALL	_LCD_Init
(0676) 					 ReadSDFile(file_buf,-10,buf,1); //偏移到下10条
    038C9 E081      LDI	R24,1
    038CA 838A      STD	Y+2,R24
    038CB 82B9      STD	Y+1,R11
    038CC 82A8      ST	Y,R10
    038CD EF26      LDI	R18,0xF6
    038CE EF3F      LDI	R19,0xFF
    038CF 018E      MOVW	R16,R28
    038D0 5F0D      SUBI	R16,0xFD
    038D1 4F1F      SBCI	R17,0xFF
    038D2 940E 27ED CALL	_ReadSDFile
(0677) 					 CharToStruct(buf);
    038D4 0185      MOVW	R16,R10
    038D5 940E 2C33 CALL	_CharToStruct
(0678) 					 page = 0;
    038D7 2744      CLR	R20
(0679) 					 key = 0;
    038D8 2766      CLR	R22
(0680) 				}
(0681) 				if(key==down){ //下键 ： 页面加
    038D9 316D      CPI	R22,0x1D
    038DA F441      BNE	0x38E3
(0682) 					LCD_CLR();
    038DB 940E 3D44 CALL	_LCD_CLR
(0683) 		    		LCD_Init();
    038DD 940E 3D12 CALL	_LCD_Init
(0684) 					if(page<5) page++;
    038DF 3045      CPI	R20,5
    038E0 F008      BCS	0x38E2
    038E1 CFAD      RJMP	0x388F
    038E2 9543      INC	R20
(0685) 	  				else{
(0686) 						goto next_item;
(0687) 					}
(0688) 				}
(0689) 				if(key==ldown){ //长按下键 ： 页面加10条・
    038E3 396D      CPI	R22,0x9D
    038E4 F4A1      BNE	0x38F9
(0690) 					LCD_CLR();
    038E5 940E 3D44 CALL	_LCD_CLR
(0691) 		    		LCD_Init();
    038E7 940E 3D12 CALL	_LCD_Init
(0692) 					page = 0;
    038E9 2744      CLR	R20
(0693) 					key = 0;
    038EA 2766      CLR	R22
(0694) 	 				ReadSDFile(file_buf,10,buf,1); //偏移到下10条
    038EB E081      LDI	R24,1
    038EC 838A      STD	Y+2,R24
    038ED 82B9      STD	Y+1,R11
    038EE 82A8      ST	Y,R10
    038EF E02A      LDI	R18,0xA
    038F0 E030      LDI	R19,0
    038F1 018E      MOVW	R16,R28
    038F2 5F0D      SUBI	R16,0xFD
    038F3 4F1F      SBCI	R17,0xFF
    038F4 940E 27ED CALL	_ReadSDFile
(0695) 					CharToStruct(buf);
    038F6 0185      MOVW	R16,R10
    038F7 940E 2C33 CALL	_CharToStruct
(0696) 				}
(0697) 				//右键短按  返回
(0698) 				if(key == right) {
    038F9 3167      CPI	R22,0x17
    038FA F429      BNE	0x3900
(0699) 				    LCD_CLR();
    038FB 940E 3D44 CALL	_LCD_CLR
(0700) 		    		LCD_Init();
    038FD 940E 3D12 CALL	_LCD_Init
(0701) 					goto label_recheck;	   
    038FF CEBE      RJMP	0x37BE
(0702) 				}
(0703) 				if(page == 0 ){
    03900 2344      TST	R20
    03901 F481      BNE	0x3912
(0704) 					LCD_const_disp(4,1,"ID:             ");
    03902 ED89      LDI	R24,0xD9
    03903 E093      LDI	R25,3
    03904 8399      STD	Y+1,R25
    03905 8388      ST	Y,R24
    03906 E021      LDI	R18,1
    03907 E004      LDI	R16,4
    03908 940E 3C9E CALL	_LCD_const_disp
(0705) 					LCD_const_disp(4,3,Result.IndexChar);
    0390A E485      LDI	R24,0x45
    0390B E096      LDI	R25,6
    0390C 8399      STD	Y+1,R25
    0390D 8388      ST	Y,R24
    0390E E023      LDI	R18,3
    0390F E004      LDI	R16,4
    03910 940E 3C9E CALL	_LCD_const_disp
(0706) 				}
(0707) 
(0708)     			delayms(30); 
    03912 E10E      LDI	R16,0x1E
    03913 E010      LDI	R17,0
    03914 940E 2537 CALL	_delayms
    03916 CF67      RJMP	0x387E
(0709) 		 }//end while
(0710) 		   
(0711) 	}
(0712) 	else { //未找到或未确认文件
(0713) 		 //逆序查找文件，直到月份小于 200001.xls
(0714) 		 //或是手工确认的方式
(0715) 	}
    03917 9660      ADIW	R28,0x10
    03918 940C 48B8 JMP	pop_xgsetF0FC
_GUI_welcome:
    0391A 9722      SBIW	R28,2
(0716) 
(0717) }
(0718) void GUI_welcome(void){
(0719)     LCD_CLR(); //清屏
    0391B 940E 3D44 CALL	_LCD_CLR
(0720) 	LCD_const_disp(2,3,"欢迎使用");
    0391D ED80      LDI	R24,0xD0
    0391E E093      LDI	R25,3
    0391F 8399      STD	Y+1,R25
    03920 8388      ST	Y,R24
    03921 E023      LDI	R18,3
    03922 E002      LDI	R16,2
    03923 940E 3C9E CALL	_LCD_const_disp
(0721) 	LCD_const_disp(3,1,"环境冷强度检测仪");
    03925 EB8F      LDI	R24,0xBF
    03926 E093      LDI	R25,3
    03927 8399      STD	Y+1,R25
    03928 8388      ST	Y,R24
    03929 E021      LDI	R18,1
    0392A E003      LDI	R16,3
    0392B 940E 3C9E CALL	_LCD_const_disp
(0722) 	delayms(800);
    0392D E200      LDI	R16,0x20
    0392E E013      LDI	R17,3
    0392F 940E 2537 CALL	_delayms
(0723) 	beep(0,1);
    03931 E021      LDI	R18,1
    03932 2700      CLR	R16
    03933 940E 401B CALL	_beep
    03935 9622      ADIW	R28,2
    03936 9508      RET
_dateRefresh:
  readhardware         --> R20
    03937 934A      ST	-Y,R20
    03938 2F40      MOV	R20,R16
(0724) 	
(0725) }
(0726) 
(0727) ////////////////////////////////////
(0728) //  函数作用
(0729) //   将ds1302中缓存的时钟数据转换进结构体中
(0730) ////////////////////////////////////
(0731) void dateRefresh(unsigned char readhardware)
(0732) {	//readhardware = 0 not refresh, =1 refresh
(0733) 
(0734)  if( readhardware!=88 )	ds1302_read_time();
    03939 3548      CPI	R20,0x58
    0393A F011      BEQ	0x393D
    0393B 940E 427C CALL	_ds1302_read_time
(0735) 	t.tm_sec=(((time_buf[6]&0x70)>>4)*10)+(time_buf[6]&0x0f);
    0393D 9110 05DF LDS	R17,time_buf+6
    0393F 7710      ANDI	R17,0x70
    03940 9512      SWAP	R17
    03941 701F      ANDI	R17,0xF
    03942 E00A      LDI	R16,0xA
    03943 0301      MULSU	R16,R17
    03944 0110      MOVW	R2,R0
    03945 9180 05DF LDS	R24,time_buf+6
    03947 2799      CLR	R25
    03948 708F      ANDI	R24,0xF
    03949 7090      ANDI	R25,0
    0394A 0E28      ADD	R2,R24
    0394B 1E39      ADC	R3,R25
    0394C 9230 0898 STS	t+1,R3
    0394E 9220 0897 STS	t,R2
(0736) 	t.tm_min=  (((time_buf[5]&0x70)>>4)*10)+(time_buf[5]&0x0f);
    03950 9110 05DE LDS	R17,time_buf+5
    03952 7710      ANDI	R17,0x70
    03953 9512      SWAP	R17
    03954 701F      ANDI	R17,0xF
    03955 0301      MULSU	R16,R17
    03956 0110      MOVW	R2,R0
    03957 9180 05DE LDS	R24,time_buf+5
    03959 2799      CLR	R25
    0395A 708F      ANDI	R24,0xF
    0395B 7090      ANDI	R25,0
    0395C 0E28      ADD	R2,R24
    0395D 1E39      ADC	R3,R25
    0395E 9230 089A STS	t+3,R3
    03960 9220 0899 STS	t+2,R2
(0737) 	t.tm_hour=  (((time_buf[4]&0x70)>>4)*10)+(time_buf[4]&0x0f);
    03962 9110 05DD LDS	R17,time_buf+4
    03964 7710      ANDI	R17,0x70
    03965 9512      SWAP	R17
    03966 701F      ANDI	R17,0xF
    03967 0301      MULSU	R16,R17
    03968 0110      MOVW	R2,R0
    03969 9180 05DD LDS	R24,time_buf+4
    0396B 2799      CLR	R25
    0396C 708F      ANDI	R24,0xF
    0396D 7090      ANDI	R25,0
    0396E 0E28      ADD	R2,R24
    0396F 1E39      ADC	R3,R25
    03970 9230 089C STS	t+5,R3
    03972 9220 089B STS	t+4,R2
(0738) 	t.tm_mday=	(((time_buf[3]&0x70)>>4)*10)+(time_buf[3]&0x0f);
    03974 9110 05DC LDS	R17,time_buf+3
    03976 7710      ANDI	R17,0x70
    03977 9512      SWAP	R17
    03978 701F      ANDI	R17,0xF
    03979 0301      MULSU	R16,R17
    0397A 0110      MOVW	R2,R0
    0397B 9180 05DC LDS	R24,time_buf+3
    0397D 2799      CLR	R25
    0397E 708F      ANDI	R24,0xF
    0397F 7090      ANDI	R25,0
    03980 0E28      ADD	R2,R24
    03981 1E39      ADC	R3,R25
    03982 9230 089E STS	t+7,R3
    03984 9220 089D STS	t+6,R2
(0739) 	t.tm_mon= (((time_buf[2]&0x70)>>4)*10)+(time_buf[2]&0x0f);
    03986 9110 05DB LDS	R17,time_buf+2
    03988 7710      ANDI	R17,0x70
    03989 9512      SWAP	R17
    0398A 701F      ANDI	R17,0xF
    0398B 0301      MULSU	R16,R17
    0398C 0110      MOVW	R2,R0
    0398D 9180 05DB LDS	R24,time_buf+2
    0398F 2799      CLR	R25
    03990 708F      ANDI	R24,0xF
    03991 7090      ANDI	R25,0
    03992 0E28      ADD	R2,R24
    03993 1E39      ADC	R3,R25
    03994 9230 08A0 STS	t+9,R3
    03996 9220 089F STS	t+8,R2
(0740) 	t.tm_wday=	(time_buf[7]&0x0f);
    03998 9180 05E0 LDS	R24,time_buf+7
    0399A 2799      CLR	R25
    0399B 708F      ANDI	R24,0xF
    0399C 7090      ANDI	R25,0
    0399D 9390 08A4 STS	t+13,R25
    0399F 9380 08A3 STS	t+12,R24
(0741)     t.tm_year=	(((time_buf[1]&0x70)>>4)*10)+(time_buf[1]&0x0f);
    039A1 9110 05DA LDS	R17,time_buf+1
    039A3 7710      ANDI	R17,0x70
    039A4 9512      SWAP	R17
    039A5 701F      ANDI	R17,0xF
    039A6 0301      MULSU	R16,R17
    039A7 0110      MOVW	R2,R0
    039A8 9180 05DA LDS	R24,time_buf+1
    039AA 2799      CLR	R25
    039AB 708F      ANDI	R24,0xF
    039AC 7090      ANDI	R25,0
    039AD 0E28      ADD	R2,R24
    039AE 1E39      ADC	R3,R25
    039AF 9230 08A2 STS	t+11,R3
    039B1 9220 08A1 STS	t+10,R2
(0742) 	if(readhardware != 0){
    039B3 2344      TST	R20
    039B4 F409      BNE	0x39B6
    039B5 C09F      RJMP	0x3A55
(0743) 	Result.Date[0]='2';
    039B6 E382      LDI	R24,0x32
    039B7 9380 064D STS	Result+22,R24
(0744) 	Result.Date[1]='0';
    039B9 E380      LDI	R24,0x30
    039BA 9380 064E STS	Result+23,R24
(0745) 	Result.Date[2]=t.tm_year/10+'0';
    039BC E02A      LDI	R18,0xA
    039BD E030      LDI	R19,0
    039BE 0181      MOVW	R16,R2
    039BF 940E 4793 CALL	div16s
    039C1 01C8      MOVW	R24,R16
    039C2 96C0      ADIW	R24,0x30
    039C3 9380 064F STS	Result+24,R24
(0746) 	Result.Date[3]=t.tm_year%10+'0';
    039C5 E02A      LDI	R18,0xA
    039C6 E030      LDI	R19,0
    039C7 9100 08A1 LDS	R16,t+10
    039C9 9110 08A2 LDS	R17,t+11
    039CB 940E 478F CALL	mod16s
    039CD 01C8      MOVW	R24,R16
    039CE 96C0      ADIW	R24,0x30
    039CF 9380 0650 STS	Result+25,R24
(0747) 	Result.Date[4]=t.tm_mon/10+'0';
    039D1 E02A      LDI	R18,0xA
    039D2 E030      LDI	R19,0
    039D3 9100 089F LDS	R16,t+8
    039D5 9110 08A0 LDS	R17,t+9
    039D7 940E 4793 CALL	div16s
    039D9 01C8      MOVW	R24,R16
    039DA 96C0      ADIW	R24,0x30
    039DB 9380 0651 STS	Result+26,R24
(0748) 	Result.Date[5]=t.tm_mon%10+'0';
    039DD E02A      LDI	R18,0xA
    039DE E030      LDI	R19,0
    039DF 9100 089F LDS	R16,t+8
    039E1 9110 08A0 LDS	R17,t+9
    039E3 940E 478F CALL	mod16s
    039E5 01C8      MOVW	R24,R16
    039E6 96C0      ADIW	R24,0x30
    039E7 9380 0652 STS	Result+27,R24
(0749) 	Result.Date[6]=t.tm_mday/10+'0';
    039E9 E02A      LDI	R18,0xA
    039EA E030      LDI	R19,0
    039EB 9100 089D LDS	R16,t+6
    039ED 9110 089E LDS	R17,t+7
    039EF 940E 4793 CALL	div16s
    039F1 01C8      MOVW	R24,R16
    039F2 96C0      ADIW	R24,0x30
    039F3 9380 0653 STS	Result+28,R24
(0750) 	Result.Date[7]=t.tm_mday%10+'0';
    039F5 E02A      LDI	R18,0xA
    039F6 E030      LDI	R19,0
    039F7 9100 089D LDS	R16,t+6
    039F9 9110 089E LDS	R17,t+7
    039FB 940E 478F CALL	mod16s
    039FD 01C8      MOVW	R24,R16
    039FE 96C0      ADIW	R24,0x30
    039FF 9380 0654 STS	Result+29,R24
(0751)     Result.Date[8]='\0';
    03A01 2422      CLR	R2
    03A02 9220 0655 STS	Result+30,R2
(0752) 
(0753) 	Result.Time[0]=t.tm_hour/10+'0';
    03A04 E02A      LDI	R18,0xA
    03A05 E030      LDI	R19,0
    03A06 9100 089B LDS	R16,t+4
    03A08 9110 089C LDS	R17,t+5
    03A0A 940E 4793 CALL	div16s
    03A0C 01C8      MOVW	R24,R16
    03A0D 96C0      ADIW	R24,0x30
    03A0E 9380 0656 STS	Result+31,R24
(0754) 	Result.Time[1]=t.tm_hour%10+'0';
    03A10 E02A      LDI	R18,0xA
    03A11 E030      LDI	R19,0
    03A12 9100 089B LDS	R16,t+4
    03A14 9110 089C LDS	R17,t+5
    03A16 940E 478F CALL	mod16s
    03A18 01C8      MOVW	R24,R16
    03A19 96C0      ADIW	R24,0x30
    03A1A 9380 0657 STS	Result+32,R24
(0755) 	Result.Time[2]=':';
    03A1C E38A      LDI	R24,0x3A
    03A1D 9380 0658 STS	Result+33,R24
(0756) 	//Result.Time[3]=' ';
(0757) 	Result.Time[3]=t.tm_min/10+'0';
    03A1F E02A      LDI	R18,0xA
    03A20 E030      LDI	R19,0
    03A21 9100 0899 LDS	R16,t+2
    03A23 9110 089A LDS	R17,t+3
    03A25 940E 4793 CALL	div16s
    03A27 01C8      MOVW	R24,R16
    03A28 96C0      ADIW	R24,0x30
    03A29 9380 0659 STS	Result+34,R24
(0758) 	Result.Time[4]=t.tm_min%10+'0';
    03A2B E02A      LDI	R18,0xA
    03A2C E030      LDI	R19,0
    03A2D 9100 0899 LDS	R16,t+2
    03A2F 9110 089A LDS	R17,t+3
    03A31 940E 478F CALL	mod16s
    03A33 01C8      MOVW	R24,R16
    03A34 96C0      ADIW	R24,0x30
    03A35 9380 065A STS	Result+35,R24
(0759) 	Result.Time[5]=':';
    03A37 E38A      LDI	R24,0x3A
    03A38 9380 065B STS	Result+36,R24
(0760) 	//Result.Time[7]=' ';
(0761) 	Result.Time[6]=t.tm_sec/10+'0';
    03A3A E02A      LDI	R18,0xA
    03A3B E030      LDI	R19,0
    03A3C 9100 0897 LDS	R16,t
    03A3E 9110 0898 LDS	R17,t+1
    03A40 940E 4793 CALL	div16s
    03A42 01C8      MOVW	R24,R16
    03A43 96C0      ADIW	R24,0x30
    03A44 9380 065C STS	Result+37,R24
(0762) 	Result.Time[7]=t.tm_sec%10+'0';
    03A46 E02A      LDI	R18,0xA
    03A47 E030      LDI	R19,0
    03A48 9100 0897 LDS	R16,t
    03A4A 9110 0898 LDS	R17,t+1
    03A4C 940E 478F CALL	mod16s
    03A4E 01C8      MOVW	R24,R16
    03A4F 96C0      ADIW	R24,0x30
    03A50 9380 065D STS	Result+38,R24
(0763) 	Result.Time[8]='\0'; 
    03A52 2422      CLR	R2
    03A53 9220 065E STS	Result+39,R2
(0764) 	}
(0765)     config.now =t.tm_hour*3600 + t.tm_min*60 + t.tm_sec; //更新系统心跳
    03A55 9120 0899 LDS	R18,t+2
    03A57 9130 089A LDS	R19,t+3
    03A59 E30C      LDI	R16,0x3C
    03A5A E010      LDI	R17,0
    03A5B 940E 485F CALL	empy16s
    03A5D 0118      MOVW	R2,R16
    03A5E 9120 089B LDS	R18,t+4
    03A60 9130 089C LDS	R19,t+5
    03A62 E100      LDI	R16,0x10
    03A63 E01E      LDI	R17,0xE
    03A64 940E 485F CALL	empy16s
    03A66 0128      MOVW	R4,R16
    03A67 0C42      ADD	R4,R2
    03A68 1C53      ADC	R5,R3
    03A69 9020 0897 LDS	R2,t
    03A6B 9030 0898 LDS	R3,t+1
    03A6D 0C42      ADD	R4,R2
    03A6E 1C53      ADC	R5,R3
    03A6F 0112      MOVW	R2,R4
    03A70 2444      CLR	R4
    03A71 FC37      SBRC	R3,7
    03A72 9440      COM	R4
    03A73 2455      CLR	R5
    03A74 FC47      SBRC	R4,7
    03A75 9450      COM	R5
    03A76 9230 08B6 STS	config+13,R3
    03A78 9220 08B5 STS	config+12,R2
    03A7A 9250 08B8 STS	config+15,R5
    03A7C 9240 08B7 STS	config+14,R4
    03A7E 9149      LD	R20,Y+
    03A7F 9508      RET
FILE: D:\LQD\software\software_src\usart.c
(0001) #include "config.h"
(0002) 
(0003) 
(0004) #define fosc 7372800UL //晶振7.3728MHZ
(0005) #define baud 38400  //波特率
(0006) //串口通信初始化  MEGA128
(0007) //UART1 initialize
(0008) // desired baud rate:38400
(0009) // actual baud rate:38400 (0.0%)
(0010) // char size: 8 bit
(0011) // parity: Disabled
(0012) void uart1_init(void)
(0013) {
(0014)  	 UCSR1B = 0x00; //disable while setting baud rate
_uart1_init:
    03A80 2422      CLR	R2
    03A81 9220 009A STS	0x9A,R2
(0015)      UCSR1A = 0x00;
    03A83 9220 009B STS	0x9B,R2
(0016)      UCSR1C = (1<<UCSZ11)|(1<<UCSZ10);//8bit+1bit stop
    03A85 E086      LDI	R24,6
    03A86 9380 009D STS	0x9D,R24
(0017)      UBRR1L=(fosc/16/(baud+1))%256;
    03A88 E08B      LDI	R24,0xB
    03A89 9380 0099 STS	0x99,R24
(0018)      UBRR1H=(fosc/16/(baud+1))/256;
    03A8B 9220 0098 STS	0x98,R2
(0019)      UCSR1B =(1<<RXEN1)|(1<<TXEN1);//RXCEN TXCEN
    03A8D E188      LDI	R24,0x18
    03A8E 9380 009A STS	0x9A,R24
    03A90 9508      RET
_uart1_rx_isr:
  tmp                  --> R16
    03A91 930A      ST	-Y,R16
    03A92 B70F      IN	R16,0x3F
    03A93 930A      ST	-Y,R16
(0020) }
(0021) 
(0022) #pragma interrupt_handler uart1_rx_isr:iv_USART1_RXC
(0023) void uart1_rx_isr(void){   
(0024) 	 char tmp;
(0025) 	 tmp=UDR1;
    03A94 9100 009C LDS	R16,0x9C
    03A96 9109      LD	R16,Y+
    03A97 BF0F      OUT	0x3F,R16
    03A98 9109      LD	R16,Y+
    03A99 9518      RETI
(0026) }
(0027) 
(0028) void Usart_Transmit(char c)
(0029) {
(0030)  	 while (!(UCSR1A&(1<<UDRE1)));//表明发送器一准备就绪
_Usart_Transmit:
  c                    --> R16
    03A9A 9020 009B LDS	R2,0x9B
    03A9C FE25      SBRS	R2,5
    03A9D CFFC      RJMP	_Usart_Transmit
(0031) 	 UDR1=c;
    03A9E 9300 009C STS	0x9C,R16
    03AA0 9508      RET
_Puts:
  s                    --> R20
    03AA1 934A      ST	-Y,R20
    03AA2 935A      ST	-Y,R21
    03AA3 01A8      MOVW	R20,R16
(0032) }
(0033) 
(0034) //串口输出字符串
(0035) void Puts( unsigned char *s)
(0036) { 
    03AA4 C00B      RJMP	0x3AB0
(0037) 	 while (*s) 
(0038)       { 
(0039) 	  //为数据间的隔断创造一个串口能显示的隔断字符 即'/t'  ->  ' '
(0040) 	  if(*s==0x09)  
    03AA5 01FA      MOVW	R30,R20
    03AA6 8180      LD	R24,Z
    03AA7 3089      CPI	R24,0x9
    03AA8 F411      BNE	0x3AAB
(0041) 	  {   Usart_Transmit(' ');    }
    03AA9 E200      LDI	R16,0x20
    03AAA DFEF      RCALL	_Usart_Transmit
(0042) 	 Usart_Transmit(*s);
    03AAB 01FA      MOVW	R30,R20
    03AAC 8100      LD	R16,Z
    03AAD DFEC      RCALL	_Usart_Transmit
(0043) 	 s++;
    03AAE 5F4F      SUBI	R20,0xFF
    03AAF 4F5F      SBCI	R21,0xFF
    03AB0 01FA      MOVW	R30,R20
    03AB1 8020      LD	R2,Z
    03AB2 2022      TST	R2
    03AB3 F789      BNE	0x3AA5
    03AB4 9159      LD	R21,Y+
    03AB5 9149      LD	R20,Y+
    03AB6 9508      RET
_Send_nByte:
  i                    --> R20
  len                  --> R10
  p                    --> R12
    03AB7 940E 48F0 CALL	push_xgset303C
    03AB9 2EA2      MOV	R10,R18
    03ABA 0168      MOVW	R12,R16
(0044) 	
(0045) 	
(0046)       }
(0047) }
(0048) 
(0049) 
(0050) 
(0051) void Send_nByte(unsigned char *p, unsigned char len)
(0052) { 
(0053)   int i = 0;
(0054)   for(i=0;i<len;i++)
    03ABB 2744      CLR	R20
    03ABC 2755      CLR	R21
    03ABD C007      RJMP	0x3AC5
(0055)   {
(0056)    	Usart_Transmit(*(p+i));
    03ABE 01FA      MOVW	R30,R20
    03ABF 0DEC      ADD	R30,R12
    03AC0 1DFD      ADC	R31,R13
    03AC1 8100      LD	R16,Z
    03AC2 DFD7      RCALL	_Usart_Transmit
    03AC3 5F4F      SUBI	R20,0xFF
    03AC4 4F5F      SBCI	R21,0xFF
    03AC5 2C2A      MOV	R2,R10
    03AC6 2433      CLR	R3
    03AC7 1542      CP	R20,R2
    03AC8 0553      CPC	R21,R3
    03AC9 F3A4      BLT	0x3ABE
    03ACA 940C 48F7 JMP	pop_xgset303C
_PrintString:
  str                  --> R10
    03ACC 92AA      ST	-Y,R10
    03ACD 92BA      ST	-Y,R11
    03ACE 0158      MOVW	R10,R16
(0057)   }
(0058) }
(0059) 
(0060) void  PrintString(const unsigned char *str)
(0061) {    
    03ACF C004      RJMP	0x3AD4
(0062) 	while(*str!=0)	Usart_Transmit(*str++);
    03AD0 01F5      MOVW	R30,R10
    03AD1 9101      LD	R16,Z+
    03AD2 015F      MOVW	R10,R30
    03AD3 DFC6      RCALL	_Usart_Transmit
    03AD4 01F5      MOVW	R30,R10
    03AD5 8020      LD	R2,Z
    03AD6 2022      TST	R2
    03AD7 F7C1      BNE	0x3AD0
    03AD8 90B9      LD	R11,Y+
    03AD9 90A9      LD	R10,Y+
    03ADA 9508      RET
_PrintString_n:
  str                  --> R10
    03ADB 92AA      ST	-Y,R10
    03ADC 92BA      ST	-Y,R11
    03ADD 0158      MOVW	R10,R16
(0063) }
(0064) void  PrintString_n(const unsigned char *str)
(0065) {   
(0066) 	Usart_Transmit('\r');
    03ADE E00D      LDI	R16,0xD
    03ADF DFBA      RCALL	_Usart_Transmit
(0067) 	Usart_Transmit('\n'); 
    03AE0 E00A      LDI	R16,0xA
    03AE1 DFB8      RCALL	_Usart_Transmit
    03AE2 C004      RJMP	0x3AE7
(0068) 	while(*str!=0)	Usart_Transmit(*str++);
    03AE3 01F5      MOVW	R30,R10
    03AE4 9101      LD	R16,Z+
    03AE5 015F      MOVW	R10,R30
    03AE6 DFB3      RCALL	_Usart_Transmit
    03AE7 01F5      MOVW	R30,R10
    03AE8 8020      LD	R2,Z
    03AE9 2022      TST	R2
    03AEA F7C1      BNE	0x3AE3
    03AEB 90B9      LD	R11,Y+
    03AEC 90A9      LD	R10,Y+
    03AED 9508      RET
_PrintLong:
  i                    --> R20
  da                   --> Y,+0
  data                 --> Y,+9
    03AEE 940E 477E CALL	push_arg4
    03AF0 934A      ST	-Y,R20
    03AF1 9728      SBIW	R28,0x8
(0069) 
(0070) } 
(0071)  
(0072) void PrintLong(unsigned long data)
(0073) {
(0074)  
(0075) 	unsigned char da[8];
(0076) 	unsigned char i;
(0077) 	for(i=0;i<8;i++)	da[i]=0;
    03AF2 2744      CLR	R20
    03AF3 C008      RJMP	0x3AFC
    03AF4 01CE      MOVW	R24,R28
    03AF5 2FE4      MOV	R30,R20
    03AF6 27FF      CLR	R31
    03AF7 0FE8      ADD	R30,R24
    03AF8 1FF9      ADC	R31,R25
    03AF9 2422      CLR	R2
    03AFA 8220      ST	Z,R2
    03AFB 9543      INC	R20
    03AFC 3048      CPI	R20,0x8
    03AFD F3B0      BCS	0x3AF4
    03AFE C013      RJMP	0x3B12
(0078) 	while(data>=10000000L){ ++da[7];data-=10000000L;}
    03AFF 818F      LDD	R24,Y+7
    03B00 5F8F      SUBI	R24,0xFF
    03B01 838F      STD	Y+7,R24
    03B02 E880      LDI	R24,0x80
    03B03 E996      LDI	R25,0x96
    03B04 E9A8      LDI	R26,0x98
    03B05 E0B0      LDI	R27,0
    03B06 8429      LDD	R2,Y+9
    03B07 843A      LDD	R3,Y+10
    03B08 844B      LDD	R4,Y+11
    03B09 845C      LDD	R5,Y+12
    03B0A 1A28      SUB	R2,R24
    03B0B 0A39      SBC	R3,R25
    03B0C 0A4A      SBC	R4,R26
    03B0D 0A5B      SBC	R5,R27
    03B0E 8629      STD	Y+9,R2
    03B0F 863A      STD	Y+10,R3
    03B10 864B      STD	Y+11,R4
    03B11 865C      STD	Y+12,R5
    03B12 E880      LDI	R24,0x80
    03B13 E996      LDI	R25,0x96
    03B14 E9A8      LDI	R26,0x98
    03B15 E0B0      LDI	R27,0
    03B16 8429      LDD	R2,Y+9
    03B17 843A      LDD	R3,Y+10
    03B18 844B      LDD	R4,Y+11
    03B19 845C      LDD	R5,Y+12
    03B1A 1628      CP	R2,R24
    03B1B 0639      CPC	R3,R25
    03B1C 064A      CPC	R4,R26
    03B1D 065B      CPC	R5,R27
    03B1E F700      BCC	0x3AFF
(0079) 	if(da[7])	i=0;
    03B1F 802F      LDD	R2,Y+7
    03B20 2022      TST	R2
    03B21 F009      BEQ	0x3B23
    03B22 2744      CLR	R20
(0080) 	if(i==0)	Usart_Transmit('0'+da[7]);
    03B23 2344      TST	R20
    03B24 F4B9      BNE	0x3B3C
    03B25 810F      LDD	R16,Y+7
    03B26 5D00      SUBI	R16,0xD0
    03B27 DF72      RCALL	_Usart_Transmit
    03B28 C013      RJMP	0x3B3C
(0081) 	while(data>=1000000L) { ++da[6];data-=1000000L;}
    03B29 818E      LDD	R24,Y+6
    03B2A 5F8F      SUBI	R24,0xFF
    03B2B 838E      STD	Y+6,R24
    03B2C E480      LDI	R24,0x40
    03B2D E492      LDI	R25,0x42
    03B2E E0AF      LDI	R26,0xF
    03B2F E0B0      LDI	R27,0
    03B30 8429      LDD	R2,Y+9
    03B31 843A      LDD	R3,Y+10
    03B32 844B      LDD	R4,Y+11
    03B33 845C      LDD	R5,Y+12
    03B34 1A28      SUB	R2,R24
    03B35 0A39      SBC	R3,R25
    03B36 0A4A      SBC	R4,R26
    03B37 0A5B      SBC	R5,R27
    03B38 8629      STD	Y+9,R2
    03B39 863A      STD	Y+10,R3
    03B3A 864B      STD	Y+11,R4
    03B3B 865C      STD	Y+12,R5
    03B3C E480      LDI	R24,0x40
    03B3D E492      LDI	R25,0x42
    03B3E E0AF      LDI	R26,0xF
    03B3F E0B0      LDI	R27,0
    03B40 8429      LDD	R2,Y+9
    03B41 843A      LDD	R3,Y+10
    03B42 844B      LDD	R4,Y+11
    03B43 845C      LDD	R5,Y+12
    03B44 1628      CP	R2,R24
    03B45 0639      CPC	R3,R25
    03B46 064A      CPC	R4,R26
    03B47 065B      CPC	R5,R27
    03B48 F700      BCC	0x3B29
(0082) 	if(da[6])	i=0;
    03B49 802E      LDD	R2,Y+6
    03B4A 2022      TST	R2
    03B4B F009      BEQ	0x3B4D
    03B4C 2744      CLR	R20
(0083) 	if(i==0)	Usart_Transmit('0'+da[6]);
    03B4D 2344      TST	R20
    03B4E F4B9      BNE	0x3B66
    03B4F 810E      LDD	R16,Y+6
    03B50 5D00      SUBI	R16,0xD0
    03B51 DF48      RCALL	_Usart_Transmit
    03B52 C013      RJMP	0x3B66
(0084) 	while(data>=100000L)  { ++da[5];data-=100000L;}
    03B53 818D      LDD	R24,Y+5
    03B54 5F8F      SUBI	R24,0xFF
    03B55 838D      STD	Y+5,R24
    03B56 EA80      LDI	R24,0xA0
    03B57 E896      LDI	R25,0x86
    03B58 E0A1      LDI	R26,1
    03B59 E0B0      LDI	R27,0
    03B5A 8429      LDD	R2,Y+9
    03B5B 843A      LDD	R3,Y+10
    03B5C 844B      LDD	R4,Y+11
    03B5D 845C      LDD	R5,Y+12
    03B5E 1A28      SUB	R2,R24
    03B5F 0A39      SBC	R3,R25
    03B60 0A4A      SBC	R4,R26
    03B61 0A5B      SBC	R5,R27
    03B62 8629      STD	Y+9,R2
    03B63 863A      STD	Y+10,R3
    03B64 864B      STD	Y+11,R4
    03B65 865C      STD	Y+12,R5
    03B66 EA80      LDI	R24,0xA0
    03B67 E896      LDI	R25,0x86
    03B68 E0A1      LDI	R26,1
    03B69 E0B0      LDI	R27,0
    03B6A 8429      LDD	R2,Y+9
    03B6B 843A      LDD	R3,Y+10
    03B6C 844B      LDD	R4,Y+11
    03B6D 845C      LDD	R5,Y+12
    03B6E 1628      CP	R2,R24
    03B6F 0639      CPC	R3,R25
    03B70 064A      CPC	R4,R26
    03B71 065B      CPC	R5,R27
    03B72 F700      BCC	0x3B53
(0085) 	if(da[5])	i=0;
    03B73 802D      LDD	R2,Y+5
    03B74 2022      TST	R2
    03B75 F009      BEQ	0x3B77
    03B76 2744      CLR	R20
(0086) 	if(i==0)	Usart_Transmit('0'+da[5]);
    03B77 2344      TST	R20
    03B78 F4B9      BNE	0x3B90
    03B79 810D      LDD	R16,Y+5
    03B7A 5D00      SUBI	R16,0xD0
    03B7B DF1E      RCALL	_Usart_Transmit
    03B7C C013      RJMP	0x3B90
(0087) 	while(data>=10000L)   { ++da[4];data-=10000L;}
    03B7D 818C      LDD	R24,Y+4
    03B7E 5F8F      SUBI	R24,0xFF
    03B7F 838C      STD	Y+4,R24
    03B80 E180      LDI	R24,0x10
    03B81 E297      LDI	R25,0x27
    03B82 E0A0      LDI	R26,0
    03B83 E0B0      LDI	R27,0
    03B84 8429      LDD	R2,Y+9
    03B85 843A      LDD	R3,Y+10
    03B86 844B      LDD	R4,Y+11
    03B87 845C      LDD	R5,Y+12
    03B88 1A28      SUB	R2,R24
    03B89 0A39      SBC	R3,R25
    03B8A 0A4A      SBC	R4,R26
    03B8B 0A5B      SBC	R5,R27
    03B8C 8629      STD	Y+9,R2
    03B8D 863A      STD	Y+10,R3
    03B8E 864B      STD	Y+11,R4
    03B8F 865C      STD	Y+12,R5
    03B90 E180      LDI	R24,0x10
    03B91 E297      LDI	R25,0x27
    03B92 E0A0      LDI	R26,0
    03B93 E0B0      LDI	R27,0
    03B94 8429      LDD	R2,Y+9
    03B95 843A      LDD	R3,Y+10
    03B96 844B      LDD	R4,Y+11
    03B97 845C      LDD	R5,Y+12
    03B98 1628      CP	R2,R24
    03B99 0639      CPC	R3,R25
    03B9A 064A      CPC	R4,R26
    03B9B 065B      CPC	R5,R27
    03B9C F700      BCC	0x3B7D
(0088) 	if(da[4])	i=0;
    03B9D 802C      LDD	R2,Y+4
    03B9E 2022      TST	R2
    03B9F F009      BEQ	0x3BA1
    03BA0 2744      CLR	R20
(0089) 	if(i==0)	Usart_Transmit('0'+da[4]);
    03BA1 2344      TST	R20
    03BA2 F4B9      BNE	0x3BBA
    03BA3 810C      LDD	R16,Y+4
    03BA4 5D00      SUBI	R16,0xD0
    03BA5 DEF4      RCALL	_Usart_Transmit
    03BA6 C013      RJMP	0x3BBA
(0090) 	while(data>=1000L)    { ++da[3];data-=1000L;}
    03BA7 818B      LDD	R24,Y+3
    03BA8 5F8F      SUBI	R24,0xFF
    03BA9 838B      STD	Y+3,R24
    03BAA EE88      LDI	R24,0xE8
    03BAB E093      LDI	R25,3
    03BAC E0A0      LDI	R26,0
    03BAD E0B0      LDI	R27,0
    03BAE 8429      LDD	R2,Y+9
    03BAF 843A      LDD	R3,Y+10
    03BB0 844B      LDD	R4,Y+11
    03BB1 845C      LDD	R5,Y+12
    03BB2 1A28      SUB	R2,R24
    03BB3 0A39      SBC	R3,R25
    03BB4 0A4A      SBC	R4,R26
    03BB5 0A5B      SBC	R5,R27
    03BB6 8629      STD	Y+9,R2
    03BB7 863A      STD	Y+10,R3
    03BB8 864B      STD	Y+11,R4
    03BB9 865C      STD	Y+12,R5
    03BBA EE88      LDI	R24,0xE8
    03BBB E093      LDI	R25,3
    03BBC E0A0      LDI	R26,0
    03BBD E0B0      LDI	R27,0
    03BBE 8429      LDD	R2,Y+9
    03BBF 843A      LDD	R3,Y+10
    03BC0 844B      LDD	R4,Y+11
    03BC1 845C      LDD	R5,Y+12
    03BC2 1628      CP	R2,R24
    03BC3 0639      CPC	R3,R25
    03BC4 064A      CPC	R4,R26
    03BC5 065B      CPC	R5,R27
    03BC6 F700      BCC	0x3BA7
(0091) 	if(da[3])	i=0;
    03BC7 802B      LDD	R2,Y+3
    03BC8 2022      TST	R2
    03BC9 F009      BEQ	0x3BCB
    03BCA 2744      CLR	R20
(0092) 	if(i==0)	Usart_Transmit('0'+da[3]);
    03BCB 2344      TST	R20
    03BCC F4B9      BNE	0x3BE4
    03BCD 810B      LDD	R16,Y+3
    03BCE 5D00      SUBI	R16,0xD0
    03BCF DECA      RCALL	_Usart_Transmit
    03BD0 C013      RJMP	0x3BE4
(0093) 	while(data>=100L)     { ++da[2];data-=100L;}
    03BD1 818A      LDD	R24,Y+2
    03BD2 5F8F      SUBI	R24,0xFF
    03BD3 838A      STD	Y+2,R24
    03BD4 E684      LDI	R24,0x64
    03BD5 E090      LDI	R25,0
    03BD6 E0A0      LDI	R26,0
    03BD7 E0B0      LDI	R27,0
    03BD8 8429      LDD	R2,Y+9
    03BD9 843A      LDD	R3,Y+10
    03BDA 844B      LDD	R4,Y+11
    03BDB 845C      LDD	R5,Y+12
    03BDC 1A28      SUB	R2,R24
    03BDD 0A39      SBC	R3,R25
    03BDE 0A4A      SBC	R4,R26
    03BDF 0A5B      SBC	R5,R27
    03BE0 8629      STD	Y+9,R2
    03BE1 863A      STD	Y+10,R3
    03BE2 864B      STD	Y+11,R4
    03BE3 865C      STD	Y+12,R5
    03BE4 E684      LDI	R24,0x64
    03BE5 E090      LDI	R25,0
    03BE6 E0A0      LDI	R26,0
    03BE7 E0B0      LDI	R27,0
    03BE8 8429      LDD	R2,Y+9
    03BE9 843A      LDD	R3,Y+10
    03BEA 844B      LDD	R4,Y+11
    03BEB 845C      LDD	R5,Y+12
    03BEC 1628      CP	R2,R24
    03BED 0639      CPC	R3,R25
    03BEE 064A      CPC	R4,R26
    03BEF 065B      CPC	R5,R27
    03BF0 F700      BCC	0x3BD1
(0094) 	if(da[2])	i=0;
    03BF1 802A      LDD	R2,Y+2
    03BF2 2022      TST	R2
    03BF3 F009      BEQ	0x3BF5
    03BF4 2744      CLR	R20
(0095) 	if(i==0)	Usart_Transmit('0'+da[2]);
    03BF5 2344      TST	R20
    03BF6 F4B9      BNE	0x3C0E
    03BF7 810A      LDD	R16,Y+2
    03BF8 5D00      SUBI	R16,0xD0
    03BF9 DEA0      RCALL	_Usart_Transmit
    03BFA C013      RJMP	0x3C0E
(0096) 	while(data>=10L)      { ++da[1];data-=10L;}
    03BFB 8189      LDD	R24,Y+1
    03BFC 5F8F      SUBI	R24,0xFF
    03BFD 8389      STD	Y+1,R24
    03BFE E08A      LDI	R24,0xA
    03BFF E090      LDI	R25,0
    03C00 E0A0      LDI	R26,0
    03C01 E0B0      LDI	R27,0
    03C02 8429      LDD	R2,Y+9
    03C03 843A      LDD	R3,Y+10
    03C04 844B      LDD	R4,Y+11
    03C05 845C      LDD	R5,Y+12
    03C06 1A28      SUB	R2,R24
    03C07 0A39      SBC	R3,R25
    03C08 0A4A      SBC	R4,R26
    03C09 0A5B      SBC	R5,R27
    03C0A 8629      STD	Y+9,R2
    03C0B 863A      STD	Y+10,R3
    03C0C 864B      STD	Y+11,R4
    03C0D 865C      STD	Y+12,R5
    03C0E E08A      LDI	R24,0xA
    03C0F E090      LDI	R25,0
    03C10 E0A0      LDI	R26,0
    03C11 E0B0      LDI	R27,0
    03C12 8429      LDD	R2,Y+9
    03C13 843A      LDD	R3,Y+10
    03C14 844B      LDD	R4,Y+11
    03C15 845C      LDD	R5,Y+12
    03C16 1628      CP	R2,R24
    03C17 0639      CPC	R3,R25
    03C18 064A      CPC	R4,R26
    03C19 065B      CPC	R5,R27
    03C1A F700      BCC	0x3BFB
(0097) 	if(da[1])	i=0;
    03C1B 8029      LDD	R2,Y+1
    03C1C 2022      TST	R2
    03C1D F009      BEQ	0x3C1F
    03C1E 2744      CLR	R20
(0098) 	if(i==0)	Usart_Transmit('0'+da[1]);
    03C1F 2344      TST	R20
    03C20 F419      BNE	0x3C24
    03C21 8109      LDD	R16,Y+1
    03C22 5D00      SUBI	R16,0xD0
    03C23 DE76      RCALL	_Usart_Transmit
(0099) 	Usart_Transmit('0'+data);
    03C24 E380      LDI	R24,0x30
    03C25 E090      LDI	R25,0
    03C26 E0A0      LDI	R26,0
    03C27 E0B0      LDI	R27,0
    03C28 8429      LDD	R2,Y+9
    03C29 843A      LDD	R3,Y+10
    03C2A 844B      LDD	R4,Y+11
    03C2B 845C      LDD	R5,Y+12
    03C2C 0E28      ADD	R2,R24
    03C2D 1E39      ADC	R3,R25
    03C2E 1E4A      ADC	R4,R26
    03C2F 1E5B      ADC	R5,R27
    03C30 2D02      MOV	R16,R2
    03C31 DE68      RCALL	_Usart_Transmit
    03C32 9628      ADIW	R28,0x8
    03C33 9149      LD	R20,Y+
    03C34 9624      ADIW	R28,4
    03C35 9508      RET
_PrintChar:
  h                    --> R20
  d                    --> R22
    03C36 934A      ST	-Y,R20
    03C37 936A      ST	-Y,R22
    03C38 2F60      MOV	R22,R16
(0100)  
(0101) }
(0102)  
(0103) void PrintChar(unsigned char d)
(0104) {
(0105) 	unsigned char h=(d&0xF0)>>4;
    03C39 2F46      MOV	R20,R22
    03C3A 7F40      ANDI	R20,0xF0
    03C3B 9542      SWAP	R20
    03C3C 704F      ANDI	R20,0xF
(0106) 	if(h<10)	Usart_Transmit('0'+h);
    03C3D 304A      CPI	R20,0xA
    03C3E F420      BCC	0x3C43
    03C3F 2F04      MOV	R16,R20
    03C40 5D00      SUBI	R16,0xD0
    03C41 DE58      RCALL	_Usart_Transmit
    03C42 C003      RJMP	0x3C46
(0107) 	else		Usart_Transmit('A'-10+h);
    03C43 2F04      MOV	R16,R20
    03C44 5C09      SUBI	R16,0xC9
    03C45 DE54      RCALL	_Usart_Transmit
(0108) 	h=d&0x0f;
    03C46 2F46      MOV	R20,R22
    03C47 704F      ANDI	R20,0xF
(0109) 	if(h<10)	Usart_Transmit('0'+h);
    03C48 304A      CPI	R20,0xA
    03C49 F420      BCC	0x3C4E
    03C4A 2F04      MOV	R16,R20
    03C4B 5D00      SUBI	R16,0xD0
    03C4C DE4D      RCALL	_Usart_Transmit
    03C4D C003      RJMP	0x3C51
(0110) 	else		Usart_Transmit('A'-10+h);
    03C4E 2F04      MOV	R16,R20
    03C4F 5C09      SUBI	R16,0xC9
    03C50 DE49      RCALL	_Usart_Transmit
(0111) 	Usart_Transmit(' ');
    03C51 E200      LDI	R16,0x20
    03C52 DE47      RCALL	_Usart_Transmit
    03C53 9169      LD	R22,Y+
    03C54 9149      LD	R20,Y+
    03C55 9508      RET
FILE: D:\LQD\software\software_src\SPI.c
(0001) //*****************************************************************************//
(0002) //*								 
(0003) //*控制芯片：ATmgea128
(0004) //*开发环境：AVR Studio+GCC
(0005) //*隶属模块：SPI接口控制
(0006) //*****************************************************************************//
(0007) #include "SPI.h"
(0008) 
(0009) /******************************************************************
(0010) SPI接口函数初始化
(0011) ******************************************************************/
(0012) void SPI_IO_Init(void)
(0013) {
(0014) 	SPI_PORT |= (1<<SS);////拉高CS
_SPI_IO_Init:
    03C56 9AC0      SBI	0x18,0
(0015) 	SPI_DDR |= (1<<SCLK)|(1<<MOSI)|(1<<SS);////CS,CLK,MOSI设为输出
    03C57 B387      IN	R24,0x17
    03C58 6087      ORI	R24,7
    03C59 BB87      OUT	0x17,R24
(0016) 	SPI_DDR &=~(1<<MISO);//MISO设为输入
    03C5A 98BB      CBI	0x17,3
(0017) 	SPI_PORT |= (1<<SCLK);//拉高CLK
    03C5B 9AC1      SBI	0x18,1
(0018) 	SPI_High();//SPI高通
    03C5C E580      LDI	R24,0x50
    03C5D B98D      OUT	0x0D,R24
    03C5E 9A70      SBI	0x0E,0
    03C5F 9508      RET
(0019) }
(0020) /******************************************************************
(0021) SPI写一个字节
(0022) ******************************************************************/
(0023) void SPI_Write(UINT8 data)
(0024) {
(0025) 	SPDR = data;
_SPI_Write:
  data                 --> R16
    03C60 B90F      OUT	0x0F,R16
(0026) 	while ((SPSR&(1<<SPIF))==0);
    03C61 9B77      SBIS	0x0E,7
    03C62 CFFE      RJMP	0x3C61
    03C63 9508      RET
(0027) 	//loop_until_bit_is_set(SPSR,SPIF);
(0028) }
(0029) /******************************************************************
(0030) SPI读一个字节
(0031) ******************************************************************/
(0032) unsigned char SPI_Read(void)
(0033) {
(0034) 	SPDR = 0xFF;//写0xFF启动SPI
_SPI_Read:
    03C64 EF8F      LDI	R24,0xFF
    03C65 B98F      OUT	0x0F,R24
(0035) 	while ((SPSR&(1<<SPIF))==0);
    03C66 9B77      SBIS	0x0E,7
    03C67 CFFE      RJMP	0x3C66
(0036) 	//loop_until_bit_is_set(SPSR,SPIF);//等待SPIF为高电平
(0037) 	return  SPDR;//返回读取值
    03C68 B10F      IN	R16,0x0F
    03C69 9508      RET
FILE: D:\LQD\software\software_src\lcd.c
(0001) #include "config.h"
(0002) 
(0003) //此硬件引脚适合冷强度检测仪第2版电路  mega128
(0004) #define LCD_PIN_CS   4
(0005) #define LCD_PIN_SID  3
(0006) #define LCD_PIN_SCLK 2
(0007) #define LCD_PIN_RST  1
(0008) #define LCD_BACKLIGHT_SW		0
(0009) #define LCD_PORT PORTC
(0010) #define LCD_PIN_DDR DDRC
(0011) #define Set_CS()     LCD_PIN_DDR |= (1<<LCD_PIN_CS)  ;LCD_PORT |= (1<<LCD_PIN_CS) 
(0012) #define Set_SID()    LCD_PIN_DDR |= (1<<LCD_PIN_SID) ;LCD_PORT |= (1<<LCD_PIN_SID) 
(0013) #define Set_SCLK()   LCD_PIN_DDR |= (1<<LCD_PIN_SCLK);LCD_PORT |= (1<<LCD_PIN_SCLK) 
(0014) #define LCD_LIGHT_ON()   LCD_PIN_DDR |= (1<<LCD_BACKLIGHT_SW);LCD_PORT |= (1<<LCD_BACKLIGHT_SW) 
(0015) #define Set_RST()   LCD_PIN_DDR |= (1<<LCD_PIN_RST);LCD_PORT |= (1<<LCD_PIN_RST) 
(0016) 
(0017) #define Clr_CS()     LCD_PIN_DDR |= (1<<LCD_PIN_CS)  ;LCD_PORT &=~(1<<LCD_PIN_CS) 
(0018) #define Clr_SID()    LCD_PIN_DDR |= (1<<LCD_PIN_SID) ;LCD_PORT &=~(1<<LCD_PIN_SID) 
(0019) #define Clr_SCLK()   LCD_PIN_DDR |= (1<<LCD_PIN_SCLK);LCD_PORT &=~(1<<LCD_PIN_SCLK) 
(0020) #define LCD_LIGHT_OFF()   LCD_PIN_DDR |= (1<<LCD_BACKLIGHT_SW);LCD_PORT &=~(1<<LCD_BACKLIGHT_SW) 
(0021) #define Clr_RST()   LCD_PIN_DDR |= (1<<LCD_PIN_RST);LCD_PORT &=~(1<<LCD_PIN_RST) 
(0022)  
(0023) void W_1byte(unsigned char RW, unsigned char RS, unsigned char W_data); 
(0024) void Write_8bits(unsigned int W_bits); 
(0025) void LCD_Init(void); 
(0026) unsigned char LCD_INT(void); 
(0027) 
(0028) unsigned char LCD_SW(unsigned char i)
(0029) {
(0030)  if(i==0){
_LCD_SW:
  i                    --> R16
    03C6A 2300      TST	R16
    03C6B F421      BNE	0x3C70
(0031)  LCD_LIGHT_OFF();
    03C6C 9AA0      SBI	0x14,0
    03C6D 98A8      CBI	0x15,0
(0032)  return 0;
    03C6E 2700      CLR	R16
    03C6F C003      RJMP	0x3C73
(0033)  }
(0034)  else{
(0035)  LCD_LIGHT_ON();
    03C70 9AA0      SBI	0x14,0
    03C71 9AA8      SBI	0x15,0
(0036)  return 1;
    03C72 E001      LDI	R16,1
    03C73 9508      RET
(0037)  }
(0038)  
(0039) }
(0040)  
(0041) unsigned char LCD_INT(void) 
(0042) { 
(0043)   Clr_CS(); 
_LCD_INT:
    03C74 9AA4      SBI	0x14,4
    03C75 98AC      CBI	0x15,4
(0044)   Clr_SID(); 
    03C76 9AA3      SBI	0x14,3
    03C77 98AB      CBI	0x15,3
(0045)   Clr_SCLK(); 
    03C78 9AA2      SBI	0x14,2
    03C79 98AA      CBI	0x15,2
(0046)   LCD_Init(); 
    03C7A D097      RCALL	_LCD_Init
(0047)   return (0);
    03C7B 2700      CLR	R16
    03C7C 9508      RET
_address:
  a                    --> R20
  y                    --> R18
  x                    --> R16
    03C7D 940E 48D8 CALL	push_xgsetF000
(0048) } 
(0049)   
(0050) /******************************************************************** 
(0051) 函数 名：address
(0052) 入口参数：地址转换
(0053) 出口参数：无 
(0054) 函数作用： 
(0055) 说        明： 
(0056) ********************************************************************/ 
(0057) unsigned char address(unsigned char x,unsigned char y)
(0058) {  
(0059)  unsigned char a;
(0060) 
(0061) switch(x) 
    03C7F 2F60      MOV	R22,R16
    03C80 2777      CLR	R23
    03C81 3061      CPI	R22,1
    03C82 E0E0      LDI	R30,0
    03C83 077E      CPC	R23,R30
    03C84 F069      BEQ	0x3C92
    03C85 3062      CPI	R22,2
    03C86 E0E0      LDI	R30,0
    03C87 077E      CPC	R23,R30
    03C88 F059      BEQ	0x3C94
    03C89 3063      CPI	R22,3
    03C8A E0E0      LDI	R30,0
    03C8B 077E      CPC	R23,R30
    03C8C F049      BEQ	0x3C96
    03C8D 3064      CPI	R22,4
    03C8E E0E0      LDI	R30,0
    03C8F 077E      CPC	R23,R30
    03C90 F039      BEQ	0x3C98
    03C91 C007      RJMP	0x3C99
(0062) { 
(0063) case 1: 
(0064) {a=0x80;break;} 
    03C92 E840      LDI	R20,0x80
    03C93 C005      RJMP	0x3C99
(0065) case 2: 
(0066) {a=0x90;break;} 
    03C94 E940      LDI	R20,0x90
    03C95 C003      RJMP	0x3C99
(0067)   case 3: 
(0068) {a=0x88;break;} 
    03C96 E848      LDI	R20,0x88
    03C97 C001      RJMP	0x3C99
(0069)   case 4: 
(0070) {a=0x98;break;} 
    03C98 E948      LDI	R20,0x98
(0071) } 
(0072) a=a+y-1;
    03C99 0F42      ADD	R20,R18
    03C9A 5041      SUBI	R20,1
(0073) 
(0074) return a;
    03C9B 2F04      MOV	R16,R20
    03C9C 940C 48DD JMP	pop_xgsetF000
_LCD_const_disp:
  a                    --> R12
  i                    --> R20
  single_data          --> R10
  y                    --> R14
  x                    --> R12
    03C9E 940E 48C5 CALL	push_xgset30FC
    03CA0 2EE2      MOV	R14,R18
    03CA1 2EC0      MOV	R12,R16
    03CA2 9721      SBIW	R28,1
    03CA3 84A9      LDD	R10,Y+9
    03CA4 84BA      LDD	R11,Y+10
(0075) }
(0076)  
(0077) //////////////////////////////////////////////////////////////
(0078) 
(0079) /******************************************************************** 
(0080) 函数 名：LCD_const_disp
(0081) 入口参数：x y  *single_data
(0082) 出口参数：无 
(0083) 函数作用：负责 显示一串常量
(0084) 说        明： 
(0085) ********************************************************************/ 
(0086) void LCD_const_disp(unsigned char x, unsigned char y, const unsigned char *single_data) 
(0087) { 
(0088) unsigned char  a,i; 
(0089) a=address(x,y);
    03CA5 2D2E      MOV	R18,R14
    03CA6 2D0C      MOV	R16,R12
    03CA7 DFD5      RCALL	_address
    03CA8 2EC0      MOV	R12,R16
(0090) W_1byte(0,0,a);     //显示的地址 
    03CA9 82C8      ST	Y,R12
    03CAA 2722      CLR	R18
    03CAB 2700      CLR	R16
    03CAC D0B7      RCALL	_W_1byte
(0091)    for(i=0; single_data[i]!='\0';i++) 
    03CAD 2744      CLR	R20
    03CAE C00D      RJMP	0x3CBC
(0092)    {
(0093)     if(i>=16) break; 
    03CAF 3140      CPI	R20,0x10
    03CB0 F008      BCS	0x3CB2
    03CB1 C011      RJMP	0x3CC3
(0094)     W_1byte(0,1,single_data[i]); 
    03CB2 2FE4      MOV	R30,R20
    03CB3 27FF      CLR	R31
    03CB4 0DEA      ADD	R30,R10
    03CB5 1DFB      ADC	R31,R11
    03CB6 8020      LD	R2,Z
    03CB7 8228      ST	Y,R2
    03CB8 E021      LDI	R18,1
    03CB9 2700      CLR	R16
    03CBA D0A9      RCALL	_W_1byte
    03CBB 9543      INC	R20
    03CBC 2FE4      MOV	R30,R20
    03CBD 27FF      CLR	R31
    03CBE 0DEA      ADD	R30,R10
    03CBF 1DFB      ADC	R31,R11
    03CC0 8020      LD	R2,Z
    03CC1 2022      TST	R2
    03CC2 F761      BNE	0x3CAF
(0095)     
(0096)    } 
(0097)    W_1byte(0,0,0XFF); // 移走地址指针 防止下一输入内容的干扰
    03CC3 EF8F      LDI	R24,0xFF
    03CC4 8388      ST	Y,R24
    03CC5 2722      CLR	R18
    03CC6 2700      CLR	R16
    03CC7 D09C      RCALL	_W_1byte
    03CC8 9621      ADIW	R28,1
    03CC9 940C 48AF JMP	pop_xgset30FC
_LCD_var_disp:
  a                    --> R12
  i                    --> R20
  single_data          --> R10
  y                    --> R14
  x                    --> R12
    03CCB 940E 48C5 CALL	push_xgset30FC
    03CCD 2EE2      MOV	R14,R18
    03CCE 2EC0      MOV	R12,R16
    03CCF 9721      SBIW	R28,1
    03CD0 84A9      LDD	R10,Y+9
    03CD1 84BA      LDD	R11,Y+10
(0098)  
(0099) } 
(0100) 
(0101) /******************************************************************** 
(0102) 函数 名：LCD_var_disp
(0103) 入口参数：single_row single_line  *single_data
(0104) 出口参数：无 
(0105) 函数作用：负责 显示一串变量
(0106) 说        明： 
(0107) ********************************************************************/ 
(0108) 
(0109) void LCD_var_disp(unsigned char x, unsigned char y, unsigned char *single_data) 
(0110) { 
(0111) unsigned char  a,i; 
(0112) 
(0113) #if _debug == 1 
(0114) 	PrintString_n(single_data);
(0115) #endif 
(0116) 
(0117) a=address( x,y);
    03CD2 2D2E      MOV	R18,R14
    03CD3 2D0C      MOV	R16,R12
    03CD4 DFA8      RCALL	_address
    03CD5 2EC0      MOV	R12,R16
(0118) W_1byte(0,0,a);     //显示的地址0x88 
    03CD6 82C8      ST	Y,R12
    03CD7 2722      CLR	R18
    03CD8 2700      CLR	R16
    03CD9 D08A      RCALL	_W_1byte
(0119) 
(0120) for(i=0; single_data[i]!='\0';i++) 
    03CDA 2744      CLR	R20
    03CDB C00D      RJMP	0x3CE9
(0121)    { 
(0122)     if(i>=16) break;
    03CDC 3140      CPI	R20,0x10
    03CDD F008      BCS	0x3CDF
    03CDE C011      RJMP	0x3CF0
(0123)     W_1byte(0,1,single_data[i]); 
    03CDF 2FE4      MOV	R30,R20
    03CE0 27FF      CLR	R31
    03CE1 0DEA      ADD	R30,R10
    03CE2 1DFB      ADC	R31,R11
    03CE3 8020      LD	R2,Z
    03CE4 8228      ST	Y,R2
    03CE5 E021      LDI	R18,1
    03CE6 2700      CLR	R16
    03CE7 D07C      RCALL	_W_1byte
    03CE8 9543      INC	R20
    03CE9 2FE4      MOV	R30,R20
    03CEA 27FF      CLR	R31
    03CEB 0DEA      ADD	R30,R10
    03CEC 1DFB      ADC	R31,R11
    03CED 8020      LD	R2,Z
    03CEE 2022      TST	R2
    03CEF F761      BNE	0x3CDC
(0124) 	} 
(0125)   W_1byte(0,0,0XFF); // 移走地址指针 防止下一输入内容的干扰
    03CF0 EF8F      LDI	R24,0xFF
    03CF1 8388      ST	Y,R24
    03CF2 2722      CLR	R18
    03CF3 2700      CLR	R16
    03CF4 D06F      RCALL	_W_1byte
    03CF5 9621      ADIW	R28,1
    03CF6 940C 48AF JMP	pop_xgset30FC
_LCD_char_disp:
  a                    --> R12
  data                 --> R10
  y                    --> R14
  x                    --> R12
    03CF8 940E 48C7 CALL	push_xgset00FC
    03CFA 2EE2      MOV	R14,R18
    03CFB 2EC0      MOV	R12,R16
    03CFC 9721      SBIW	R28,1
    03CFD 80AF      LDD	R10,Y+7
(0126) } 
(0127) /******************************************************************** 
(0128) 函数 名：LCD_char_disp
(0129) 入口参数：single_row single_line  data
(0130) 出口参数：无 
(0131) 函数作用：负责 显示一个 变量
(0132) 说        明： 
(0133) ********************************************************************/ 
(0134) 
(0135) void LCD_char_disp(unsigned char x, unsigned char y, unsigned char data) 
(0136) { 
(0137) unsigned char a; 
(0138) a=address(x,y);
    03CFE 2D2E      MOV	R18,R14
    03CFF 2D0C      MOV	R16,R12
    03D00 DF7C      RCALL	_address
    03D01 2EC0      MOV	R12,R16
(0139) W_1byte(0,0,a);     //显示的地址 
    03D02 82C8      ST	Y,R12
    03D03 2722      CLR	R18
    03D04 2700      CLR	R16
    03D05 D05E      RCALL	_W_1byte
(0140) W_1byte(0,1,data);  //显示内容
    03D06 82A8      ST	Y,R10
    03D07 E021      LDI	R18,1
    03D08 2700      CLR	R16
    03D09 D05A      RCALL	_W_1byte
(0141)  
(0142)   W_1byte(0,0,0XFF); // 移走地址指针 防止下一输入内容的干扰
    03D0A EF8F      LDI	R24,0xFF
    03D0B 8388      ST	Y,R24
    03D0C 2722      CLR	R18
    03D0D 2700      CLR	R16
    03D0E D055      RCALL	_W_1byte
    03D0F 9621      ADIW	R28,1
    03D10 940C 48A8 JMP	pop_xgset00FC
_LCD_Init:
  cmd                  --> R20
    03D12 934A      ST	-Y,R20
    03D13 9721      SBIW	R28,1
(0143) } 
(0144) 
(0145) /******************************************************************** 
(0146) 函数 名：LCD_Init
(0147) 入口参数：无
(0148) 出口参数：unsigned char  0/1
(0149) 函数作用：负责 清空液晶显示
(0150) 说        明： 
(0151) ********************************************************************/ 
(0152) void LCD_Init(void) 
(0153) { 
(0154)    unsigned char cmd; 
(0155)    cmd=0x30;      //功能设置 8 位数据，基本指令 
    03D14 E340      LDI	R20,0x30
(0156)   W_1byte(0,0,cmd); 
    03D15 8348      ST	Y,R20
    03D16 2722      CLR	R18
    03D17 2700      CLR	R16
    03D18 D04B      RCALL	_W_1byte
(0157)   delayms(2); 
    03D19 E002      LDI	R16,2
    03D1A E010      LDI	R17,0
    03D1B 940E 2537 CALL	_delayms
(0158)   cmd=0x0C;      //显示状态 ON，游标OFF，反白OFF 
    03D1D E04C      LDI	R20,0xC
(0159)   W_1byte(0,0,cmd); //写指令 
    03D1E 8348      ST	Y,R20
    03D1F 2722      CLR	R18
    03D20 2700      CLR	R16
    03D21 D042      RCALL	_W_1byte
(0160)   delayms(2); 
    03D22 E002      LDI	R16,2
    03D23 E010      LDI	R17,0
    03D24 940E 2537 CALL	_delayms
(0161)   cmd=0x01;      //清除显示 
    03D26 E041      LDI	R20,1
(0162)   W_1byte(0,0,cmd); //写指令 
    03D27 8348      ST	Y,R20
    03D28 2722      CLR	R18
    03D29 2700      CLR	R16
    03D2A D039      RCALL	_W_1byte
(0163)   delayms(2); 
    03D2B E002      LDI	R16,2
    03D2C E010      LDI	R17,0
    03D2D 940E 2537 CALL	_delayms
(0164)   cmd=0x02;      //地址归位 
    03D2F E042      LDI	R20,2
(0165)   W_1byte(0,0,cmd); //写指令 
    03D30 8348      ST	Y,R20
    03D31 2722      CLR	R18
    03D32 2700      CLR	R16
    03D33 D030      RCALL	_W_1byte
(0166)   delayms(2); 
    03D34 E002      LDI	R16,2
    03D35 E010      LDI	R17,0
    03D36 940E 2537 CALL	_delayms
(0167)   cmd=0x80;      //设置DDRAM 地址 
    03D38 E840      LDI	R20,0x80
(0168)   W_1byte(0,0,cmd); //写指令 
    03D39 8348      ST	Y,R20
    03D3A 2722      CLR	R18
    03D3B 2700      CLR	R16
    03D3C D027      RCALL	_W_1byte
(0169)   delayms(2);     //延时 
    03D3D E002      LDI	R16,2
    03D3E E010      LDI	R17,0
    03D3F 940E 2537 CALL	_delayms
    03D41 9621      ADIW	R28,1
    03D42 9149      LD	R20,Y+
    03D43 9508      RET
_LCD_CLR:
  cmd                  --> R20
    03D44 934A      ST	-Y,R20
    03D45 9721      SBIW	R28,1
(0170) } 
(0171) 
(0172) void LCD_CLR(void)
(0173) {
(0174) unsigned char cmd;
(0175)   cmd=0x01;      //清除显示 
    03D46 E041      LDI	R20,1
(0176)   W_1byte(0,0,cmd); //写指令 
    03D47 8348      ST	Y,R20
    03D48 2722      CLR	R18
    03D49 2700      CLR	R16
    03D4A D019      RCALL	_W_1byte
(0177)   delayms(1); 
    03D4B E001      LDI	R16,1
    03D4C E010      LDI	R17,0
    03D4D 940E 2537 CALL	_delayms
(0178)   cmd=0x02;      //地址归位 
    03D4F E042      LDI	R20,2
(0179)   W_1byte(0,0,cmd); //写指令 
    03D50 8348      ST	Y,R20
    03D51 2722      CLR	R18
    03D52 2700      CLR	R16
    03D53 D010      RCALL	_W_1byte
(0180)   delayms(1); 
    03D54 E001      LDI	R16,1
    03D55 E010      LDI	R17,0
    03D56 940E 2537 CALL	_delayms
(0181)   cmd=0x80;      //设置DDRAM 地址 
    03D58 E840      LDI	R20,0x80
(0182)   W_1byte(0,0,cmd); //写指令 
    03D59 8348      ST	Y,R20
    03D5A 2722      CLR	R18
    03D5B 2700      CLR	R16
    03D5C D007      RCALL	_W_1byte
(0183)   delayms(1);     //延时
    03D5D E001      LDI	R16,1
    03D5E E010      LDI	R17,0
    03D5F 940E 2537 CALL	_delayms
    03D61 9621      ADIW	R28,1
    03D62 9149      LD	R20,Y+
    03D63 9508      RET
_W_1byte:
  H_data               --> R22
  S_ID                 --> R10
  L_data               --> R20
  W_data               --> R12
  RS                   --> R14
  RW                   --> R20
    03D64 940E 48C3 CALL	push_xgsetF0FC
    03D66 2EE2      MOV	R14,R18
    03D67 2F40      MOV	R20,R16
    03D68 84CA      LDD	R12,Y+10
(0184) 
(0185) }
(0186)  
(0187) /*******************************************************************
(0188) 函 数 名：W_1byte
(0189) 入口参数：RW、RS、W_data
(0190) 出口参数：无
(0191) 建立日期：2007年3月3日
(0192) 修改日期：
(0193) 函数作用：写一个字节的数据到12864液晶，包括指令和数据
(0194) 说    明：RW=1，从液晶读数据到MCU；RW=0，写一个数据到液晶；
(0195) 		 （一般RW都设为0，即只向液晶写数据，不读数据）
(0196)           RS=1，写入的是数据；RS=0，写入的是指令；
(0197) 		  一般模式：RW=0，RS=1;写数据
(0198) 		  			RW=0，RS=0;写指令
(0199) ********************************************************************/
(0200) void W_1byte(unsigned char RW, unsigned char RS, unsigned char W_data)
(0201) {
(0202) 	unsigned int H_data,L_data,S_ID = 0xf8;	 //11111RWRS0
    03D69 EF88      LDI	R24,0xF8
    03D6A E090      LDI	R25,0
    03D6B 015C      MOVW	R10,R24
(0203) 	if(RW == 0)
    03D6C 2344      TST	R20
    03D6D F419      BNE	0x3D71
(0204) 	{
(0205) 	 	S_ID &=~ 0x04;
    03D6E 7F8B      ANDI	R24,0xFB
    03D6F 015C      MOVW	R10,R24
(0206) 	}
    03D70 C003      RJMP	0x3D74
(0207) 	else					//if(RW==1)
(0208) 	{
(0209) 	 	S_ID |= 0X04;
    03D71 01C5      MOVW	R24,R10
    03D72 6084      ORI	R24,4
    03D73 015C      MOVW	R10,R24
(0210) 	}
(0211) 	if(RS == 0)
    03D74 20EE      TST	R14
    03D75 F421      BNE	0x3D7A
(0212) 	{
(0213) 	 	S_ID &=~ 0x02;
    03D76 01C5      MOVW	R24,R10
    03D77 7F8D      ANDI	R24,0xFD
    03D78 015C      MOVW	R10,R24
(0214) 	}
    03D79 C003      RJMP	0x3D7D
(0215) 	else					//if(RS==1)
(0216) 	{
(0217) 	 	S_ID |= 0X02;
    03D7A 01C5      MOVW	R24,R10
    03D7B 6082      ORI	R24,2
    03D7C 015C      MOVW	R10,R24
(0218) 	}
(0219) 	H_data = W_data;
    03D7D 2D6C      MOV	R22,R12
    03D7E 2777      CLR	R23
(0220) 	H_data &= 0xf0;			//屏蔽低4位的数据
    03D7F 7F60      ANDI	R22,0xF0
    03D80 7070      ANDI	R23,0
(0221) 	L_data = W_data;	   	//xxxx0000格式
    03D81 2D4C      MOV	R20,R12
    03D82 2755      CLR	R21
(0222) 	L_data &= 0x0f;			//屏蔽高4位的数据
    03D83 704F      ANDI	R20,0xF
    03D84 7050      ANDI	R21,0
(0223) 	L_data <<= 4;			//xxxx0000格式
    03D85 0F44      LSL	R20
    03D86 1F55      ROL	R21
    03D87 0F44      LSL	R20
    03D88 1F55      ROL	R21
    03D89 0F44      LSL	R20
    03D8A 1F55      ROL	R21
    03D8B 0F44      LSL	R20
    03D8C 1F55      ROL	R21
(0224) 	Set_CS();
    03D8D 9AA4      SBI	0x14,4
    03D8E 9AAC      SBI	0x15,4
(0225) 	Write_8bits(S_ID); 		//发送S_ID
    03D8F 0185      MOVW	R16,R10
    03D90 D00C      RCALL	_Write_8bits
(0226) 	Write_8bits(H_data);	//发送H_data
    03D91 018B      MOVW	R16,R22
    03D92 D00A      RCALL	_Write_8bits
(0227) 	Write_8bits(L_data);	//发送L_data
    03D93 018A      MOVW	R16,R20
    03D94 D008      RCALL	_Write_8bits
(0228) 	Clr_CS();	Clr_CS();	Clr_CS();	
    03D95 9AA4      SBI	0x14,4
    03D96 98AC      CBI	0x15,4
    03D97 9AA4      SBI	0x14,4
    03D98 98AC      CBI	0x15,4
    03D99 9AA4      SBI	0x14,4
    03D9A 98AC      CBI	0x15,4
    03D9B 940C 48B8 JMP	pop_xgsetF0FC
_Write_8bits:
  Temp_data            --> R12
  i                    --> R20
  W_bits               --> R10
    03D9D 940E 48F0 CALL	push_xgset303C
    03D9F 0158      MOVW	R10,R16
(0229) 	 
(0230) 
(0231) }
(0232) /********************************************************************
(0233) 函 数 名：Write_8bits
(0234) 入口参数：W_bits
(0235) 出口参数：无
(0236) 建立日期：2007年3月3日
(0237) 修改日期：
(0238) 函数作用：负责串行输出8个bit位
(0239) 说    明：
(0240) ********************************************************************/
(0241) void Write_8bits(unsigned int W_bits)
(0242) {
(0243) 	unsigned int i,Temp_data;
(0244) 	for(i=0; i<8; i++)
    03DA0 2744      CLR	R20
    03DA1 2755      CLR	R21
    03DA2 C019      RJMP	0x3DBC
(0245) 	{
(0246) 		Temp_data = W_bits;
    03DA3 0165      MOVW	R12,R10
(0247) 		Temp_data <<= i;
    03DA4 019A      MOVW	R18,R20
    03DA5 0186      MOVW	R16,R12
    03DA6 940E 4947 CALL	lsl16
    03DA8 0168      MOVW	R12,R16
(0248) 		if((Temp_data&0x80)==0) 
    03DA9 FD07      SBRC	R16,7
    03DAA C003      RJMP	0x3DAE
(0249) 		{
(0250) 		 	Clr_SID();
    03DAB 9AA3      SBI	0x14,3
    03DAC 98AB      CBI	0x15,3
(0251) 		}
    03DAD C002      RJMP	0x3DB0
(0252) 		else
(0253) 		{
(0254) 		 	Set_SID();
    03DAE 9AA3      SBI	0x14,3
    03DAF 9AAB      SBI	0x15,3
(0255) 		} 
(0256) 		NOP();
    03DB0 0000      NOP
(0257) 		Set_SCLK();
    03DB1 9AA2      SBI	0x14,2
    03DB2 9AAA      SBI	0x15,2
(0258) 		NOP();
    03DB3 0000      NOP
(0259) 		NOP();
    03DB4 0000      NOP
(0260) 		Clr_SCLK();
    03DB5 9AA2      SBI	0x14,2
    03DB6 98AA      CBI	0x15,2
(0261) 		NOP();
    03DB7 0000      NOP
(0262) 		Clr_SID();
    03DB8 9AA3      SBI	0x14,3
    03DB9 98AB      CBI	0x15,3
    03DBA 5F4F      SUBI	R20,0xFF
    03DBB 4F5F      SBCI	R21,0xFF
    03DBC 3048      CPI	R20,0x8
    03DBD E0E0      LDI	R30,0
    03DBE 075E      CPC	R21,R30
    03DBF F318      BCS	0x3DA3
    03DC0 940C 48F7 JMP	pop_xgset303C
_Set_Draw:
    03DC2 9721      SBIW	R28,1
(0263) 	}
(0264) }
(0265)  
(0266) /********************************************************************
(0267) 函 数 名：Set_Draw(
(0268) 入口参数：无
(0269) 出口参数：无
(0270) 函数作用：设置为绘图模式
(0271) 说    明：
(0272) ********************************************************************/
(0273) void Set_Draw(void)
(0274) {  	
(0275) 	//W_1byte(0,0,0x34);			//8BIT控制界面，扩充指令集,，绘图显示OFF
(0276) 	W_1byte(0,0,0x36);
    03DC3 E386      LDI	R24,0x36
    03DC4 8388      ST	Y,R24
    03DC5 2722      CLR	R18
    03DC6 2700      CLR	R16
    03DC7 DF9C      RCALL	_W_1byte
(0277) 	delayms(1);					//延时
    03DC8 E001      LDI	R16,1
    03DC9 E010      LDI	R17,0
    03DCA 940E 2537 CALL	_delayms
    03DCC 9621      ADIW	R28,1
    03DCD 9508      RET
_Set_White:
  clr_y                --> R10
  clr_x                --> R20
  white_y              --> Y,+2
  white_x              --> Y,+1
  i                    --> R22
  white_end_x          --> R12
  j                    --> R14
  clear                --> Y,+15
  end_x                --> R12
  y                    --> R14
  x                    --> R22
    03DCE 940E 48C3 CALL	push_xgsetF0FC
    03DD0 2EE2      MOV	R14,R18
    03DD1 2F60      MOV	R22,R16
    03DD2 9723      SBIW	R28,3
    03DD3 84CD      LDD	R12,Y+13
(0278) } 
(0279)  
(0280) 
(0281) /******************************************************************** 
(0282) 函数 名：Set_White 
(0283) 入口参数：  x,   y,  end_x,  clear
(0284) 出口参数：无 
(0285) 函数作用： 设置反显
(0286) 说        明： 
(0287) ********************************************************************/ 
(0288) void Set_White(unsigned char x,unsigned char y,unsigned char end_x,unsigned char clear)
(0289) {
(0290)  
(0291) 	unsigned char i, j, white_x, white_y,white_end_x,clr_x,clr_y ;		//
(0292)   
(0293) 	W_1byte(0,0,0x36);	  //8BIT控制界面，扩充指令集,，绘图显示ON
    03DD4 E386      LDI	R24,0x36
    03DD5 8388      ST	Y,R24
    03DD6 2722      CLR	R18
    03DD7 2700      CLR	R16
    03DD8 DF8B      RCALL	_W_1byte
(0294) 	delayus(20);					//延时
    03DD9 E104      LDI	R16,0x14
    03DDA E010      LDI	R17,0
    03DDB 940E 252F CALL	_delayus
(0295)  
(0296) 	white_end_x = (end_x-x+1);
    03DDD 2D8C      MOV	R24,R12
    03DDE 1B86      SUB	R24,R22
    03DDF 5F8F      SUBI	R24,0xFF
    03DE0 2EC8      MOV	R12,R24
(0297) 	white_end_x <<= 1;
    03DE1 0CCC      LSL	R12
(0298) 	if(y==1)   //x,1  a=80+x-1                   
    03DE2 2D8E      MOV	R24,R14
    03DE3 3081      CPI	R24,1
    03DE4 F449      BNE	0x3DEE
(0299) 	{
(0300) 	 	white_x = (0x80+x-1); 
    03DE5 2F86      MOV	R24,R22
    03DE6 5880      SUBI	R24,0x80
    03DE7 5081      SUBI	R24,1
    03DE8 8389      STD	Y+1,R24
(0301) 		white_y = 0x80;
    03DE9 E880      LDI	R24,0x80
    03DEA 838A      STD	Y+2,R24
(0302) 		clr_x = 0x80;
    03DEB E840      LDI	R20,0x80
(0303) 		clr_y = 0x80;
    03DEC 2EA8      MOV	R10,R24
(0304) 	}
    03DED C023      RJMP	0x3E11
(0305) 	else if(y==2)
    03DEE 2D8E      MOV	R24,R14
    03DEF 3082      CPI	R24,2
    03DF0 F449      BNE	0x3DFA
(0306) 	{
(0307) 	 	white_x = (0x80+x-1);
    03DF1 2F86      MOV	R24,R22
    03DF2 5880      SUBI	R24,0x80
    03DF3 5081      SUBI	R24,1
    03DF4 8389      STD	Y+1,R24
(0308) 		white_y = 0x90;
    03DF5 E980      LDI	R24,0x90
    03DF6 838A      STD	Y+2,R24
(0309) 		clr_x = 0x80;
    03DF7 E840      LDI	R20,0x80
(0310) 		clr_y = 0x90;
    03DF8 2EA8      MOV	R10,R24
(0311) 	}
    03DF9 C017      RJMP	0x3E11
(0312) 	else if(y==3)
    03DFA 2D8E      MOV	R24,R14
    03DFB 3083      CPI	R24,3
    03DFC F449      BNE	0x3E06
(0313) 	{
(0314) 	 	white_x = (0x88+x-1);
    03DFD 2F86      MOV	R24,R22
    03DFE 5788      SUBI	R24,0x78
    03DFF 5081      SUBI	R24,1
    03E00 8389      STD	Y+1,R24
(0315) 		white_y = 0x80;
    03E01 E880      LDI	R24,0x80
    03E02 838A      STD	Y+2,R24
(0316) 		clr_x = 0x88;
    03E03 E848      LDI	R20,0x88
(0317) 		clr_y = 0x80;
    03E04 2EA8      MOV	R10,R24
(0318) 	}
    03E05 C00B      RJMP	0x3E11
(0319) 	else if(y==4)
    03E06 2D8E      MOV	R24,R14
    03E07 3084      CPI	R24,4
    03E08 F441      BNE	0x3E11
(0320) 	{
(0321) 	 	white_x = (0x88+x-1);
    03E09 2F86      MOV	R24,R22
    03E0A 5788      SUBI	R24,0x78
    03E0B 5081      SUBI	R24,1
    03E0C 8389      STD	Y+1,R24
(0322) 		white_y = 0x90;
    03E0D E980      LDI	R24,0x90
    03E0E 838A      STD	Y+2,R24
(0323) 		clr_x = 0x88;
    03E0F E848      LDI	R20,0x88
(0324) 		clr_y = 0x90;
    03E10 2EA8      MOV	R10,R24
(0325) 	}
(0326)   if(clear==0)//要反白时，先将整行的液晶全部清成不反白（此处行指y）
    03E11 840F      LDD	R0,Y+15
    03E12 2000      TST	R0
    03E13 F4E9      BNE	0x3E31
(0327) 	{
(0328) 	 	for(i=0;i<16;i++ )			//16行
    03E14 2766      CLR	R22
    03E15 C019      RJMP	0x3E2F
(0329) 		{
(0330) 		 	W_1byte(0,0,clr_y++);	//设置绘图区的Y地址坐标0
    03E16 2C2A      MOV	R2,R10
    03E17 2D82      MOV	R24,R2
    03E18 5F8F      SUBI	R24,0xFF
    03E19 2EA8      MOV	R10,R24
    03E1A 8228      ST	Y,R2
    03E1B 2722      CLR	R18
    03E1C 2700      CLR	R16
    03E1D DF46      RCALL	_W_1byte
(0331) 			W_1byte(0,0,clr_x);		//设置绘图区的X地址坐标0
    03E1E 8348      ST	Y,R20
    03E1F 2722      CLR	R18
    03E20 2700      CLR	R16
    03E21 DF42      RCALL	_W_1byte
(0332) 			for(j=0;j<16;j++)		//
    03E22 24EE      CLR	R14
    03E23 C007      RJMP	0x3E2B
(0333) 			{
(0334) 			 	W_1byte(0,1,0x00);	//清成不反白
    03E24 2422      CLR	R2
    03E25 8228      ST	Y,R2
    03E26 E021      LDI	R18,1
    03E27 2700      CLR	R16
    03E28 DF3B      RCALL	_W_1byte
(0335) 			 	nop();
    03E29 0000      NOP
    03E2A 94E3      INC	R14
    03E2B 2D8E      MOV	R24,R14
    03E2C 3180      CPI	R24,0x10
    03E2D F3B0      BCS	0x3E24
    03E2E 9563      INC	R22
    03E2F 3160      CPI	R22,0x10
    03E30 F328      BCS	0x3E16
(0336) 			}
(0337) 		}
(0338) 	}
(0339) 	nop();
    03E31 0000      NOP
(0340) //	
(0341) 	for(i=0;i<16;i++ )				//16行，因为是16*16汉字
    03E32 2766      CLR	R22
    03E33 C022      RJMP	0x3E56
(0342) 	{
(0343) 		W_1byte(0,0,white_y++);		//设置绘图区的Y地址坐标0
    03E34 802A      LDD	R2,Y+2
    03E35 2D82      MOV	R24,R2
    03E36 5F8F      SUBI	R24,0xFF
    03E37 838A      STD	Y+2,R24
    03E38 8228      ST	Y,R2
    03E39 2722      CLR	R18
    03E3A 2700      CLR	R16
    03E3B DF28      RCALL	_W_1byte
(0344) 		W_1byte(0,0,white_x);		//设置绘图区的X地址坐标0
    03E3C 8009      LDD	R0,Y+1
    03E3D 8208      ST	Y,R0
    03E3E 2722      CLR	R18
    03E3F 2700      CLR	R16
    03E40 DF23      RCALL	_W_1byte
(0345) 		for(j=0;j<white_end_x;j++)	//
    03E41 24EE      CLR	R14
    03E42 C010      RJMP	0x3E53
(0346) 		{
(0347) 			 if(clear==1)
    03E43 858F      LDD	R24,Y+15
    03E44 3081      CPI	R24,1
    03E45 F431      BNE	0x3E4C
(0348) 			 {
(0349) 			  	W_1byte(0,1,0x00); //取消这一行的8个点的反白，液晶地址自动加1
    03E46 2422      CLR	R2
    03E47 8228      ST	Y,R2
    03E48 E021      LDI	R18,1
    03E49 2700      CLR	R16
    03E4A DF19      RCALL	_W_1byte
(0350) 								   //（此处行指一个一个液晶点所组成的行）
(0351) 			 }
    03E4B C005      RJMP	0x3E51
(0352) 			 else
(0353) 			 {
(0354) 				W_1byte(0,1,0xff); //反白这一行的8个点，液晶地址自动加1
    03E4C EF8F      LDI	R24,0xFF
    03E4D 8388      ST	Y,R24
    03E4E E021      LDI	R18,1
    03E4F 2700      CLR	R16
    03E50 DF13      RCALL	_W_1byte
(0355) 								   //（此处行指一个一个液晶点所组成的行）
(0356) 			 }
(0357) 			nop();
    03E51 0000      NOP
    03E52 94E3      INC	R14
    03E53 14EC      CP	R14,R12
    03E54 F370      BCS	0x3E43
    03E55 9563      INC	R22
    03E56 3160      CPI	R22,0x10
    03E57 F2E0      BCS	0x3E34
(0358) 		}
(0359) 	}
(0360) 	W_1byte(0,0,0x30);		//基本指令集,，绘图显示OFF
    03E58 E380      LDI	R24,0x30
    03E59 8388      ST	Y,R24
    03E5A 2722      CLR	R18
    03E5B 2700      CLR	R16
    03E5C DF07      RCALL	_W_1byte
    03E5D 9623      ADIW	R28,3
    03E5E 940C 48B8 JMP	pop_xgsetF0FC
_set_white_n:
  tempendx             --> R10
  tempy                --> R22
  tempx                --> R20
  clear                --> R12
  n                    --> R14
    03E60 940E 48C3 CALL	push_xgsetF0FC
    03E62 2EC2      MOV	R12,R18
    03E63 2EE0      MOV	R14,R16
    03E64 9723      SBIW	R28,3
(0361)  }
(0362) 
(0363) /******************************************************************** 
(0364) 函数 名：set_white_n
(0365) 入口参数： n ,  clear
(0366) 出口参数：无 
(0367) 函数作用：   将四行分成八个位置。n代表位置1-8。本函数用于反显或取消反显
(0368)           某一位置的文字。
(0369) 说        明： 例如 set_white_n(1,0); 表示反显第一行前四个字
(0370) ********************************************************************/ 
(0371) void set_white_n(unsigned char n,unsigned char clear)
(0372) {
(0373) unsigned char tempx,tempy,tempendx;
(0374) if(n==1) {tempx=1;tempy=1;tempendx=4;}
    03E65 2D8E      MOV	R24,R14
    03E66 3081      CPI	R24,1
    03E67 F429      BNE	0x3E6D
    03E68 E041      LDI	R20,1
    03E69 E061      LDI	R22,1
    03E6A E084      LDI	R24,4
    03E6B 2EA8      MOV	R10,R24
    03E6C C037      RJMP	0x3EA4
(0375) else if(n==2) {tempx=5;tempy=1;tempendx=8;}
    03E6D 2D8E      MOV	R24,R14
    03E6E 3082      CPI	R24,2
    03E6F F429      BNE	0x3E75
    03E70 E045      LDI	R20,5
    03E71 E061      LDI	R22,1
    03E72 E088      LDI	R24,0x8
    03E73 2EA8      MOV	R10,R24
    03E74 C02F      RJMP	0x3EA4
(0376) else if(n==3) {tempx=1;tempy=2;tempendx=4;}
    03E75 2D8E      MOV	R24,R14
    03E76 3083      CPI	R24,3
    03E77 F429      BNE	0x3E7D
    03E78 E041      LDI	R20,1
    03E79 E062      LDI	R22,2
    03E7A E084      LDI	R24,4
    03E7B 2EA8      MOV	R10,R24
    03E7C C027      RJMP	0x3EA4
(0377) else if(n==4) {tempx=5;tempy=2;tempendx=8;}
    03E7D 2D8E      MOV	R24,R14
    03E7E 3084      CPI	R24,4
    03E7F F429      BNE	0x3E85
    03E80 E045      LDI	R20,5
    03E81 E062      LDI	R22,2
    03E82 E088      LDI	R24,0x8
    03E83 2EA8      MOV	R10,R24
    03E84 C01F      RJMP	0x3EA4
(0378) else if(n==5) {tempx=1;tempy=3;tempendx=4;}
    03E85 2D8E      MOV	R24,R14
    03E86 3085      CPI	R24,5
    03E87 F429      BNE	0x3E8D
    03E88 E041      LDI	R20,1
    03E89 E063      LDI	R22,3
    03E8A E084      LDI	R24,4
    03E8B 2EA8      MOV	R10,R24
    03E8C C017      RJMP	0x3EA4
(0379) else if(n==6) {tempx=5;tempy=3;tempendx=8;}
    03E8D 2D8E      MOV	R24,R14
    03E8E 3086      CPI	R24,6
    03E8F F429      BNE	0x3E95
    03E90 E045      LDI	R20,5
    03E91 E063      LDI	R22,3
    03E92 E088      LDI	R24,0x8
    03E93 2EA8      MOV	R10,R24
    03E94 C00F      RJMP	0x3EA4
(0380) else if(n==7) {tempx=1;tempy=4;tempendx=4;}
    03E95 2D8E      MOV	R24,R14
    03E96 3087      CPI	R24,7
    03E97 F429      BNE	0x3E9D
    03E98 E041      LDI	R20,1
    03E99 E064      LDI	R22,4
    03E9A E084      LDI	R24,4
    03E9B 2EA8      MOV	R10,R24
    03E9C C007      RJMP	0x3EA4
(0381) else if(n==8) {tempx=5;tempy=4;tempendx=8;}
    03E9D 2D8E      MOV	R24,R14
    03E9E 3088      CPI	R24,0x8
    03E9F F421      BNE	0x3EA4
    03EA0 E045      LDI	R20,5
    03EA1 E064      LDI	R22,4
    03EA2 E088      LDI	R24,0x8
    03EA3 2EA8      MOV	R10,R24
(0382) Set_White(tempx,tempy,tempendx,clear);
    03EA4 82CA      STD	Y+2,R12
    03EA5 82A8      ST	Y,R10
    03EA6 2F26      MOV	R18,R22
    03EA7 2F04      MOV	R16,R20
    03EA8 DF25      RCALL	_Set_White
    03EA9 9623      ADIW	R28,3
    03EAA 940C 48B8 JMP	pop_xgsetF0FC
_clr_white:
  clr_x                --> R10
  clr_y                --> R20
  i                    --> R22
  j                    --> R12
    03EAC 940E 48C3 CALL	push_xgsetF0FC
    03EAE 9721      SBIW	R28,1
(0383) 
(0384) }
(0385)  
(0386) /******************************************************************** 
(0387) 函数 名：clr_white
(0388) 入口参数： 清所有 反白
(0389) 出口参数：无 
(0390) 函数作用： 
(0391) 说        明： 
(0392) ********************************************************************/ 
(0393) void clr_white(void)
(0394) {      unsigned char i,j;
(0395) 
(0396)        unsigned char  clr_y=0x80;
    03EAF E840      LDI	R20,0x80
(0397) 	   unsigned char  clr_x=0x80;
    03EB0 E880      LDI	R24,0x80
    03EB1 2EA8      MOV	R10,R24
(0398) 	   W_1byte(0,0,0x36);	  //8BIT控制界面，扩充指令集,，绘图显示ON
    03EB2 E386      LDI	R24,0x36
    03EB3 8388      ST	Y,R24
    03EB4 2722      CLR	R18
    03EB5 2700      CLR	R16
    03EB6 DEAD      RCALL	_W_1byte
(0399) 	 	for(i=0;i<16;i++ )			//16行
    03EB7 2766      CLR	R22
    03EB8 C017      RJMP	0x3ED0
(0400) 		{
(0401) 		 	W_1byte(0,0,clr_y++);	//设置绘图区的Y地址坐标0
    03EB9 2E24      MOV	R2,R20
    03EBA 5F4F      SUBI	R20,0xFF
    03EBB 8228      ST	Y,R2
    03EBC 2722      CLR	R18
    03EBD 2700      CLR	R16
    03EBE DEA5      RCALL	_W_1byte
(0402) 			W_1byte(0,0,clr_x);		//设置绘图区的X地址坐标0
    03EBF 82A8      ST	Y,R10
    03EC0 2722      CLR	R18
    03EC1 2700      CLR	R16
    03EC2 DEA1      RCALL	_W_1byte
(0403) 			for(j=0;j<16;j++)		//
    03EC3 24CC      CLR	R12
    03EC4 C007      RJMP	0x3ECC
(0404) 			{
(0405) 			 	W_1byte(0,1,0x00);	//清成不反白
    03EC5 2422      CLR	R2
    03EC6 8228      ST	Y,R2
    03EC7 E021      LDI	R18,1
    03EC8 2700      CLR	R16
    03EC9 DE9A      RCALL	_W_1byte
(0406) 			 	nop();
    03ECA 0000      NOP
    03ECB 94C3      INC	R12
    03ECC 2D8C      MOV	R24,R12
    03ECD 3180      CPI	R24,0x10
    03ECE F3B0      BCS	0x3EC5
    03ECF 9563      INC	R22
    03ED0 3160      CPI	R22,0x10
    03ED1 F338      BCS	0x3EB9
(0407) 			}
(0408) 		}
(0409) 	
(0410) 	    clr_y=0x80;
    03ED2 E840      LDI	R20,0x80
(0411) 	    clr_x=0x90;
    03ED3 E980      LDI	R24,0x90
    03ED4 2EA8      MOV	R10,R24
(0412) 		 	for(i=0;i<16;i++ )			//16行
    03ED5 2766      CLR	R22
    03ED6 C017      RJMP	0x3EEE
(0413) 		{
(0414) 		 	W_1byte(0,0,clr_y++);	//设置绘图区的Y地址坐标0
    03ED7 2E24      MOV	R2,R20
    03ED8 5F4F      SUBI	R20,0xFF
    03ED9 8228      ST	Y,R2
    03EDA 2722      CLR	R18
    03EDB 2700      CLR	R16
    03EDC DE87      RCALL	_W_1byte
(0415) 			W_1byte(0,0,clr_x);		//设置绘图区的X地址坐标0
    03EDD 82A8      ST	Y,R10
    03EDE 2722      CLR	R18
    03EDF 2700      CLR	R16
    03EE0 DE83      RCALL	_W_1byte
(0416) 			for(j=0;j<16;j++)		//
    03EE1 24CC      CLR	R12
    03EE2 C007      RJMP	0x3EEA
(0417) 			{
(0418) 			 	W_1byte(0,1,0x00);	//清成不反白
    03EE3 2422      CLR	R2
    03EE4 8228      ST	Y,R2
    03EE5 E021      LDI	R18,1
    03EE6 2700      CLR	R16
    03EE7 DE7C      RCALL	_W_1byte
(0419) 			 	nop();
    03EE8 0000      NOP
    03EE9 94C3      INC	R12
    03EEA 2D8C      MOV	R24,R12
    03EEB 3180      CPI	R24,0x10
    03EEC F3B0      BCS	0x3EE3
    03EED 9563      INC	R22
    03EEE 3160      CPI	R22,0x10
    03EEF F338      BCS	0x3ED7
(0420) 			}
(0421) 		}   
(0422) 	   
(0423) 	     clr_y=0x88;
    03EF0 E848      LDI	R20,0x88
(0424) 	     clr_x=0x80;
    03EF1 E880      LDI	R24,0x80
    03EF2 2EA8      MOV	R10,R24
(0425) 		 	for(i=0;i<16;i++ )			//16行
    03EF3 2766      CLR	R22
    03EF4 C017      RJMP	0x3F0C
(0426) 		{
(0427) 		 	W_1byte(0,0,clr_y++);	//设置绘图区的Y地址坐标0
    03EF5 2EE4      MOV	R14,R20
    03EF6 5F4F      SUBI	R20,0xFF
    03EF7 82E8      ST	Y,R14
    03EF8 2722      CLR	R18
    03EF9 2700      CLR	R16
    03EFA DE69      RCALL	_W_1byte
(0428) 			W_1byte(0,0,clr_x);		//设置绘图区的X地址坐标0
    03EFB 82A8      ST	Y,R10
    03EFC 2722      CLR	R18
    03EFD 2700      CLR	R16
    03EFE DE65      RCALL	_W_1byte
(0429) 			for(j=0;j<16;j++)		//
    03EFF 24CC      CLR	R12
    03F00 C007      RJMP	0x3F08
(0430) 			{
(0431) 			 	W_1byte(0,1,0x00);	//清成不反白
    03F01 2422      CLR	R2
    03F02 8228      ST	Y,R2
    03F03 E021      LDI	R18,1
    03F04 2700      CLR	R16
    03F05 DE5E      RCALL	_W_1byte
(0432) 			 	nop();
    03F06 0000      NOP
    03F07 94C3      INC	R12
    03F08 2D8C      MOV	R24,R12
    03F09 3180      CPI	R24,0x10
    03F0A F3B0      BCS	0x3F01
    03F0B 9563      INC	R22
    03F0C 3160      CPI	R22,0x10
    03F0D F338      BCS	0x3EF5
(0433) 			}
(0434) 		} 
(0435) 	     clr_y=0x88;
    03F0E E848      LDI	R20,0x88
(0436) 	     clr_x=0x90;
    03F0F E980      LDI	R24,0x90
    03F10 2EA8      MOV	R10,R24
(0437) 		 	for(i=0;i<16;i++ )			//16行
    03F11 2766      CLR	R22
    03F12 C017      RJMP	0x3F2A
(0438) 		{
(0439) 		 	W_1byte(0,0,clr_y++);	//设置绘图区的Y地址坐标0
    03F13 2EE4      MOV	R14,R20
    03F14 5F4F      SUBI	R20,0xFF
    03F15 82E8      ST	Y,R14
    03F16 2722      CLR	R18
    03F17 2700      CLR	R16
    03F18 DE4B      RCALL	_W_1byte
(0440) 			W_1byte(0,0,clr_x);		//设置绘图区的X地址坐标0
    03F19 82A8      ST	Y,R10
    03F1A 2722      CLR	R18
    03F1B 2700      CLR	R16
    03F1C DE47      RCALL	_W_1byte
(0441) 			for(j=0;j<16;j++)		//
    03F1D 24CC      CLR	R12
    03F1E C007      RJMP	0x3F26
(0442) 			{
(0443) 			 	W_1byte(0,1,0x00);	//清成不反白
    03F1F 2422      CLR	R2
    03F20 8228      ST	Y,R2
    03F21 E021      LDI	R18,1
    03F22 2700      CLR	R16
    03F23 DE40      RCALL	_W_1byte
(0444) 			 	nop();
    03F24 0000      NOP
    03F25 94C3      INC	R12
    03F26 2D8C      MOV	R24,R12
    03F27 3180      CPI	R24,0x10
    03F28 F3B0      BCS	0x3F1F
    03F29 9563      INC	R22
    03F2A 3160      CPI	R22,0x10
    03F2B F338      BCS	0x3F13
(0445) 			}
(0446) 		} 		
(0447)   W_1byte(0,0,0x30);	  //8BIT控制界面，扩充指令集,，绘图显示ON
    03F2C E380      LDI	R24,0x30
    03F2D 8388      ST	Y,R24
    03F2E 2722      CLR	R18
    03F2F 2700      CLR	R16
    03F30 DE33      RCALL	_W_1byte
    03F31 9621      ADIW	R28,1
    03F32 940C 48B8 JMP	pop_xgsetF0FC
_LCD_print2num:
  a                    --> R12
  tem                  --> R20
  num                  --> R10
  y                    --> R14
  x                    --> R12
    03F34 940E 48C5 CALL	push_xgset30FC
    03F36 2EE2      MOV	R14,R18
    03F37 2EC0      MOV	R12,R16
    03F38 9721      SBIW	R28,1
    03F39 84A9      LDD	R10,Y+9
(0448) 	}
(0449) /******************************************************************** 
(0450) 函数 名：LCD_print2num
(0451) 入口参数： 显示2数字
(0452) 出口参数：无 
(0453) 函数作用： 
(0454) 说        明： 
(0455) ********************************************************************/ 
(0456) void LCD_print2num(unsigned char x,unsigned char y,unsigned char num){
(0457) unsigned char tem;
(0458) unsigned char a; 
(0459) 
(0460) a=address(x,y);
    03F3A 2D2E      MOV	R18,R14
    03F3B 2D0C      MOV	R16,R12
    03F3C DD40      RCALL	_address
    03F3D 2EC0      MOV	R12,R16
(0461) W_1byte(0,0,a);     //显示的地址 
    03F3E 82C8      ST	Y,R12
    03F3F 2722      CLR	R18
    03F40 2700      CLR	R16
    03F41 DE22      RCALL	_W_1byte
(0462) tem=num/10;
    03F42 E01A      LDI	R17,0xA
    03F43 2D0A      MOV	R16,R10
    03F44 940E 4835 CALL	div8u
    03F46 2F40      MOV	R20,R16
(0463) W_1byte(0,1,tem+0x30);
    03F47 2F84      MOV	R24,R20
    03F48 5D80      SUBI	R24,0xD0
    03F49 8388      ST	Y,R24
    03F4A E021      LDI	R18,1
    03F4B 2700      CLR	R16
    03F4C DE17      RCALL	_W_1byte
(0464) tem=num%10;
    03F4D E01A      LDI	R17,0xA
    03F4E 2D0A      MOV	R16,R10
    03F4F 940E 4833 CALL	mod8u
    03F51 2F40      MOV	R20,R16
(0465) W_1byte(0,1,tem+0x30); 
    03F52 2F84      MOV	R24,R20
    03F53 5D80      SUBI	R24,0xD0
    03F54 8388      ST	Y,R24
    03F55 E021      LDI	R18,1
    03F56 2700      CLR	R16
    03F57 DE0C      RCALL	_W_1byte
(0466) W_1byte(0,0,0XFF); // 移走地址指针 防止下一输入内容的干扰
    03F58 EF8F      LDI	R24,0xFF
    03F59 8388      ST	Y,R24
    03F5A 2722      CLR	R18
    03F5B 2700      CLR	R16
    03F5C DE07      RCALL	_W_1byte
    03F5D 9621      ADIW	R28,1
    03F5E 940C 48AF JMP	pop_xgset30FC
_LCD_print4num:
  tem                  --> R12
  num                  --> R14
  y                    --> R20
  x                    --> R10
    03F60 940E 48C5 CALL	push_xgset30FC
    03F62 2F42      MOV	R20,R18
    03F63 2EA0      MOV	R10,R16
    03F64 9721      SBIW	R28,1
    03F65 84E9      LDD	R14,Y+9
    03F66 84FA      LDD	R15,Y+10
(0467) }
(0468)  
(0469) /******************************************************************** 
(0470) 函数 名：LCD_print4num
(0471) 入口参数： 显示4数字
(0472) 出口参数：无 
(0473) 函数作用： 
(0474) 说        明： 
(0475) ********************************************************************/ 
(0476) void LCD_print4num(unsigned char x,unsigned char y,unsigned int num){
(0477) unsigned char tem;
(0478) tem=num/100;
    03F67 E624      LDI	R18,0x64
    03F68 E030      LDI	R19,0
    03F69 0187      MOVW	R16,R14
    03F6A 940E 47AF CALL	div16u
    03F6C 2EC0      MOV	R12,R16
(0479) LCD_print2num(x,y,tem);
    03F6D 82C8      ST	Y,R12
    03F6E 2F24      MOV	R18,R20
    03F6F 2D0A      MOV	R16,R10
    03F70 DFC3      RCALL	_LCD_print2num
(0480) 
(0481) tem=num%100;   
    03F71 E624      LDI	R18,0x64
    03F72 E030      LDI	R19,0
    03F73 0187      MOVW	R16,R14
    03F74 940E 47AD CALL	mod16u
    03F76 2EC0      MOV	R12,R16
(0482) LCD_print2num(x,y+1,tem);
    03F77 82C8      ST	Y,R12
    03F78 2F24      MOV	R18,R20
    03F79 5F2F      SUBI	R18,0xFF
    03F7A 2D0A      MOV	R16,R10
    03F7B DFB8      RCALL	_LCD_print2num
(0483) 
(0484) 
(0485)   W_1byte(0,0,0XFF); // 移走地址指针 防止下一输入内容的干扰
    03F7C EF8F      LDI	R24,0xFF
    03F7D 8388      ST	Y,R24
    03F7E 2722      CLR	R18
    03F7F 2700      CLR	R16
    03F80 DDE3      RCALL	_W_1byte
    03F81 9621      ADIW	R28,1
    03F82 940C 48AF JMP	pop_xgset30FC
_LCD_print:
  a                    --> R12
  ch                   --> R10
  y                    --> R14
  x                    --> R12
    03F84 940E 48C7 CALL	push_xgset00FC
    03F86 2EE2      MOV	R14,R18
    03F87 2EC0      MOV	R12,R16
    03F88 9721      SBIW	R28,1
    03F89 80AF      LDD	R10,Y+7
(0486) }
(0487)  
(0488) //////////////////////////////////////////////////////////////
(0489) 
(0490) /******************************************************************** 
(0491) 函数 名：LCD_print 
(0492) 入口参数： 显示1 ascii
(0493) 出口参数：无 
(0494) 函数作用： 
(0495) 说        明： 
(0496) ********************************************************************/ 
(0497) void LCD_print(unsigned char x,unsigned char y,unsigned char ch)
(0498) {  
(0499) unsigned char a; 
(0500) a=address(x,y);
    03F8A 2D2E      MOV	R18,R14
    03F8B 2D0C      MOV	R16,R12
    03F8C DCF0      RCALL	_address
    03F8D 2EC0      MOV	R12,R16
(0501) W_1byte(0,0,a);     //显示的地址 
    03F8E 82C8      ST	Y,R12
    03F8F 2722      CLR	R18
    03F90 2700      CLR	R16
    03F91 DDD2      RCALL	_W_1byte
(0502) W_1byte(0,1,ch); 
    03F92 82A8      ST	Y,R10
    03F93 E021      LDI	R18,1
    03F94 2700      CLR	R16
    03F95 DDCE      RCALL	_W_1byte
    03F96 9621      ADIW	R28,1
    03F97 940C 48A8 JMP	pop_xgset00FC
_LCD_print1:
  ch                   --> R10
    03F99 92AA      ST	-Y,R10
    03F9A 2EA0      MOV	R10,R16
    03F9B 9721      SBIW	R28,1
(0503) 
(0504) 
(0505) 
(0506) }
(0507) /******************************************************************** 
(0508) 函数 名：LCD_print1 
(0509) 入口参数： 显示1 ascii
(0510) 出口参数：无 
(0511) 函数作用：接着上文地址显示，不重设地址 
(0512) 说        明： 
(0513) ********************************************************************/ 
(0514) void LCD_print1(char ch)
(0515) {  
(0516) W_1byte(0,1,ch); 
    03F9C 82A8      ST	Y,R10
    03F9D E021      LDI	R18,1
    03F9E 2700      CLR	R16
    03F9F DDC4      RCALL	_W_1byte
    03FA0 9621      ADIW	R28,1
    03FA1 90A9      LD	R10,Y+
    03FA2 9508      RET
_lp:
  p                    --> R10
    03FA3 92AA      ST	-Y,R10
    03FA4 92BA      ST	-Y,R11
    03FA5 0158      MOVW	R10,R16
    03FA6 9722      SBIW	R28,2
(0517) }
(0518) //////////////////////////////////////////////////////////////
(0519) 
(0520) 
(0521) 
(0522)  void lp(unsigned char *p)
(0523)  {
(0524)  static unsigned char *p1=" ",*p2=" ",*p3=" ",*p4=" ";
(0525)  p4=p3;
    03FA7 9020 05C1 LDS	R2,lcd.c:p3
    03FA9 9030 05C2 LDS	R3,lcd.c:p3+1
    03FAB 9230 05C4 STS	lcd.c:p4+1,R3
    03FAD 9220 05C3 STS	lcd.c:p4,R2
(0526)  p3=p2;
    03FAF 9020 05BF LDS	R2,lcd.c:p2
    03FB1 9030 05C0 LDS	R3,lcd.c:p2+1
    03FB3 9230 05C2 STS	lcd.c:p3+1,R3
    03FB5 9220 05C1 STS	lcd.c:p3,R2
(0527)  p2=p1;
    03FB7 9020 05BD LDS	R2,lcd.c:p1
    03FB9 9030 05BE LDS	R3,lcd.c:p1+1
    03FBB 9230 05C0 STS	lcd.c:p2+1,R3
    03FBD 9220 05BF STS	lcd.c:p2,R2
(0528)  p1=p;
    03FBF 92B0 05BE STS	lcd.c:p1+1,R11
    03FC1 92A0 05BD STS	lcd.c:p1,R10
(0529)   LCD_const_disp(1,1,"                ");
    03FC3 EC85      LDI	R24,0xC5
    03FC4 E095      LDI	R25,5
    03FC5 8399      STD	Y+1,R25
    03FC6 8388      ST	Y,R24
    03FC7 E021      LDI	R18,1
    03FC8 E001      LDI	R16,1
    03FC9 DCD4      RCALL	_LCD_const_disp
(0530)   LCD_const_disp(2,1,"                ");
    03FCA EC85      LDI	R24,0xC5
    03FCB E095      LDI	R25,5
    03FCC 8399      STD	Y+1,R25
    03FCD 8388      ST	Y,R24
    03FCE E021      LDI	R18,1
    03FCF E002      LDI	R16,2
    03FD0 DCCD      RCALL	_LCD_const_disp
(0531)   LCD_const_disp(3,1,"                ");
    03FD1 EC85      LDI	R24,0xC5
    03FD2 E095      LDI	R25,5
    03FD3 8399      STD	Y+1,R25
    03FD4 8388      ST	Y,R24
    03FD5 E021      LDI	R18,1
    03FD6 E003      LDI	R16,3
    03FD7 DCC6      RCALL	_LCD_const_disp
(0532)   LCD_const_disp(4,1,"                ");
    03FD8 EC85      LDI	R24,0xC5
    03FD9 E095      LDI	R25,5
    03FDA 8399      STD	Y+1,R25
    03FDB 8388      ST	Y,R24
    03FDC E021      LDI	R18,1
    03FDD E004      LDI	R16,4
    03FDE DCBF      RCALL	_LCD_const_disp
(0533)   LCD_var_disp(1,1,p4);
    03FDF 9020 05C3 LDS	R2,lcd.c:p4
    03FE1 9030 05C4 LDS	R3,lcd.c:p4+1
    03FE3 8239      STD	Y+1,R3
    03FE4 8228      ST	Y,R2
    03FE5 E021      LDI	R18,1
    03FE6 E001      LDI	R16,1
    03FE7 DCE3      RCALL	_LCD_var_disp
(0534)   LCD_var_disp(2,1,p3);
    03FE8 9020 05C1 LDS	R2,lcd.c:p3
    03FEA 9030 05C2 LDS	R3,lcd.c:p3+1
    03FEC 8239      STD	Y+1,R3
    03FED 8228      ST	Y,R2
    03FEE E021      LDI	R18,1
    03FEF E002      LDI	R16,2
    03FF0 DCDA      RCALL	_LCD_var_disp
(0535)   LCD_var_disp(3,1,p2);
    03FF1 9020 05BF LDS	R2,lcd.c:p2
    03FF3 9030 05C0 LDS	R3,lcd.c:p2+1
    03FF5 8239      STD	Y+1,R3
    03FF6 8228      ST	Y,R2
    03FF7 E021      LDI	R18,1
    03FF8 E003      LDI	R16,3
    03FF9 DCD1      RCALL	_LCD_var_disp
(0536)   LCD_var_disp(4,1,p1);
    03FFA 9020 05BD LDS	R2,lcd.c:p1
    03FFC 9030 05BE LDS	R3,lcd.c:p1+1
    03FFE 8239      STD	Y+1,R3
    03FFF 8228      ST	Y,R2
    04000 E021      LDI	R18,1
    04001 E004      LDI	R16,4
    04002 DCC8      RCALL	_LCD_var_disp
(0537)   delayms(300);
    04003 E20C      LDI	R16,0x2C
    04004 E011      LDI	R17,1
    04005 940E 2537 CALL	_delayms
    04007 9622      ADIW	R28,2
    04008 90B9      LD	R11,Y+
    04009 90A9      LD	R10,Y+
    0400A 9508      RET
FILE: D:\LQD\software\software_src\relay.c
(0001) #include "config.h"
(0002) /*继电器初始化
(0003) *设置端口
(0004) *初始化关闭
(0005) */
(0006) void relay_init(void){
(0007) 	
(0008) 		RELAY_DDR_SET() ;
_relay_init:
    0400B 9AA5      SBI	0x14,5
(0009) 		RELAY_OFF();
    0400C 98AD      CBI	0x15,5
    0400D 9508      RET
(0010) 		//state.Relay = 0;
(0011) 	}	
(0012) 
(0013) /*继电器控制
(0014) *传入 ： 温度
(0015) *传出 ： 当前继电器状态
(0016) *
(0017) */
(0018) unsigned char  relay(int temp)
(0019) {
(0020) 	if(temp<config.heatThreshold)
_relay:
  temp                 --> R16
    0400E 9020 08BD LDS	R2,config+20
    04010 2433      CLR	R3
    04011 1502      CP	R16,R2
    04012 0513      CPC	R17,R3
    04013 F41C      BGE	0x4017
(0021) 	{
(0022) 	 		RELAY_DDR_SET();
    04014 9AA5      SBI	0x14,5
(0023) 			RELAY_ON();
    04015 9AAD      SBI	0x15,5
(0024) 			//state.Relay = 1 ;
(0025) 	}
    04016 C002      RJMP	0x4019
(0026) 	else
(0027) 	{
(0028) 	 	RELAY_DDR_SET();
    04017 9AA5      SBI	0x14,5
(0029) 		RELAY_OFF();
    04018 98AD      CBI	0x15,5
(0030) 		//state.Relay = 0 ;
(0031) 	}		
(0032) 	//return state.Relay;
(0033) 	return 0;
    04019 2700      CLR	R16
    0401A 9508      RET
_beep:
  i                    --> R10
  short_beep           --> R12
  long_beep            --> R14
    0401B 940E 48C7 CALL	push_xgset00FC
    0401D 2EC2      MOV	R12,R18
    0401E 2EE0      MOV	R14,R16
FILE: D:\LQD\software\software_src\beep.c
(0001) #include "config.h"
(0002) 
(0003) #define BEEP_PORT	PORTC
(0004) #define BEEP_PIN	6
(0005) #define BEEP_OFF() BEEP_PORT|=(1<<BEEP_PIN)
(0006) #define BEEP_ON()  BEEP_PORT&=~(1<<BEEP_PIN)
(0007) //楦ｅ
(0008) void beep(unsigned char long_beep,unsigned char short_beep)
(0009) { 
(0010) unsigned char i;
(0011) DDRB|=(1<<0);
    0401F 9AB8      SBI	0x17,0
(0012) for(i=0;i<long_beep;i++)
    04020 24AA      CLR	R10
    04021 C00B      RJMP	0x402D
(0013) {
(0014) BEEP_ON();  delayms(200);
    04022 98AE      CBI	0x15,6
    04023 EC08      LDI	R16,0xC8
    04024 E010      LDI	R17,0
    04025 940E 2537 CALL	_delayms
(0015) BEEP_OFF(); delayms(50);
    04027 9AAE      SBI	0x15,6
    04028 E302      LDI	R16,0x32
    04029 E010      LDI	R17,0
    0402A 940E 2537 CALL	_delayms
    0402C 94A3      INC	R10
    0402D 14AE      CP	R10,R14
    0402E F398      BCS	0x4022
(0016) }
(0017) delayms(100);
    0402F E604      LDI	R16,0x64
    04030 E010      LDI	R17,0
    04031 940E 2537 CALL	_delayms
(0018) for(i=0;i<short_beep;i++)
    04033 24AA      CLR	R10
    04034 C00B      RJMP	0x4040
(0019) {
(0020) BEEP_ON();  delayms(80);
    04035 98AE      CBI	0x15,6
    04036 E500      LDI	R16,0x50
    04037 E010      LDI	R17,0
    04038 940E 2537 CALL	_delayms
(0021) BEEP_OFF(); delayms(50);
    0403A 9AAE      SBI	0x15,6
    0403B E302      LDI	R16,0x32
    0403C E010      LDI	R17,0
    0403D 940E 2537 CALL	_delayms
    0403F 94A3      INC	R10
    04040 14AC      CP	R10,R12
    04041 F398      BCS	0x4035
    04042 940C 48A8 JMP	pop_xgset00FC
_Delay_nus:
  i                    --> R20
  n                    --> R16
    04044 934A      ST	-Y,R20
    04045 935A      ST	-Y,R21
FILE: D:\LQD\software\software_src\DS18B20_driver.c
(0001) //------------------------------------------------------------------------------
(0002) // 文件名：DS18B20_driver.c
(0003) // 说明：  DS18B20驱动头文件
(0004) // 功能：  实现1-wire器件的读写
(0005) // 使用方法：   void Delay_nus(unsigned int n);             //延时n微秒函数
(0006) //              unsigned char reset_18B20(void);            //18B20复位
(0007) //              void write_bit_18B20(char bitval);          //写一位到18B20
(0008) //              unsigned char read_bit_18B20(void);         //读一位从18B20
(0009) //              void write_byte_18B20(unsigned char data);  //写一字节到18B20
(0010) //              unsigned char read_18B20(void);             //读一字节到18B20
(0011) //
(0012) // 运行平台：   AVR 8bit (M16已验证)
(0013) // 依存关系：   DS18B20_driver.h    DS18B20基本驱动头文件（函数声明）
(0014) // 移植人：     
(0015) // 最后修改：   
(0016) //------------------------------------------------------------------------------
(0017) 
(0018) #include "config.h"
(0019) #define DS18B20_PORT PORTG
(0020) #define DS18B20_PIN  PING
(0021) #define DS18B20_DDR  DDRG
(0022) #define CL_DQ   DS18B20_PORT&=~(1<<T_NUM)					   
(0023) #define SET_DQ  DS18B20_PORT|=(1<<T_NUM)			   
(0024) #define SET_OUT DS18B20_DDR|=(1<<T_NUM)				   
(0025) #define SET_IN  DS18B20_DDR&=~(1<<T_NUM)			   
(0026) #define IN_DQ   DS18B20_PIN&(1<<T_NUM)				  
(0027) unsigned char T_NUM=0;
(0028) 
(0029) 
(0030) //------------------------------------------------------------------------------
(0031) // 延时N微秒程序 供控制读写DS18B20时序使用
(0032) //------------------------------------------------------------------------------
(0033) void Delay_nus(unsigned int n)   
(0034) {  unsigned int i;
(0035) 	  for (i=0;i<n;i++) 
    04046 2744      CLR	R20
    04047 2755      CLR	R21
    04048 C005      RJMP	0x404E
(0036) 	  		{NOP();
    04049 0000      NOP
(0037) 						NOP();
    0404A 0000      NOP
(0038) 						NOP();				        //20--300//比较接近
    0404B 0000      NOP
    0404C 5F4F      SUBI	R20,0xFF
    0404D 4F5F      SBCI	R21,0xFF
    0404E 1740      CP	R20,R16
    0404F 0751      CPC	R21,R17
    04050 F3C0      BCS	0x4049
    04051 9159      LD	R21,Y+
    04052 9149      LD	R20,Y+
    04053 9508      RET
_reset_18B20:
  bus_flag             --> R10
    04054 92AA      ST	-Y,R10
(0039) 					}
(0040) }
(0041) 
(0042) 
(0043) //------------------------------------------------------------------------------
(0044) // 1-wire总线复位
(0045) //------------------------------------------------------------------------------
(0046) unsigned char reset_18B20(void)
(0047) {
(0048) 	char bus_flag;
(0049) 	CLI();
    04055 94F8      BCLR	7
(0050) 	SET_DQ;
    04056 9110 05D8 LDS	R17,T_NUM
    04058 E001      LDI	R16,1
    04059 940E 495A CALL	lsl8
    0405B 9020 0065 LDS	R2,0x65
    0405D 2A20      OR	R2,R16
    0405E 9220 0065 STS	0x65,R2
(0051) 	SET_OUT;
    04060 9110 05D8 LDS	R17,T_NUM
    04062 E001      LDI	R16,1
    04063 940E 495A CALL	lsl8
    04065 9020 0064 LDS	R2,0x64
    04067 2A20      OR	R2,R16
    04068 9220 0064 STS	0x64,R2
(0052)  	
(0053)   	Delay_nus(1);
    0406A E001      LDI	R16,1
    0406B E010      LDI	R17,0
    0406C DFD7      RCALL	_Delay_nus
(0054)   	CL_DQ;
    0406D 9110 05D8 LDS	R17,T_NUM
    0406F E001      LDI	R16,1
    04070 940E 495A CALL	lsl8
    04072 2E20      MOV	R2,R16
    04073 9420      COM	R2
    04074 9030 0065 LDS	R3,0x65
    04076 2032      AND	R3,R2
    04077 9230 0065 STS	0x65,R3
(0055)   	Delay_nus(550);		//拉低至少480us时间
    04079 E206      LDI	R16,0x26
    0407A E012      LDI	R17,2
    0407B DFC8      RCALL	_Delay_nus
(0056)   	SET_DQ;				//释放
    0407C 9110 05D8 LDS	R17,T_NUM
    0407E E001      LDI	R16,1
    0407F 940E 495A CALL	lsl8
    04081 9020 0065 LDS	R2,0x65
    04083 2A20      OR	R2,R16
    04084 9220 0065 STS	0x65,R2
(0057) 					NOP();
    04086 0000      NOP
(0058) 					NOP();
    04087 0000      NOP
(0059)   	SET_IN;				//输入
    04088 9110 05D8 LDS	R17,T_NUM
    0408A E001      LDI	R16,1
    0408B 940E 495A CALL	lsl8
    0408D 2E20      MOV	R2,R16
    0408E 9420      COM	R2
    0408F 9030 0064 LDS	R3,0x64
    04091 2032      AND	R3,R2
    04092 9230 0064 STS	0x64,R3
(0060)   	Delay_nus(60);
    04094 E30C      LDI	R16,0x3C
    04095 E010      LDI	R17,0
    04096 DFAD      RCALL	_Delay_nus
(0061)   	
(0062) 						//等待回复
(0063)   	bus_flag = IN_DQ;
    04097 9110 05D8 LDS	R17,T_NUM
    04099 E001      LDI	R16,1
    0409A 940E 495A CALL	lsl8
    0409C 90A0 0063 LDS	R10,0x63
    0409E 22A0      AND	R10,R16
(0064)   	
(0065)   	Delay_nus(240);		//回复的低电平在60到240US
    0409F EF00      LDI	R16,0xF0
    040A0 E010      LDI	R17,0
    040A1 DFA2      RCALL	_Delay_nus
(0066)   	SET_OUT;
    040A2 9110 05D8 LDS	R17,T_NUM
    040A4 E001      LDI	R16,1
    040A5 940E 495A CALL	lsl8
    040A7 9020 0064 LDS	R2,0x64
    040A9 2A20      OR	R2,R16
    040AA 9220 0064 STS	0x64,R2
(0067) 					NOP();
    040AC 0000      NOP
(0068) 					NOP();
    040AD 0000      NOP
(0069)   	SET_DQ;				//回到初始DQ=1；
    040AE 9110 05D8 LDS	R17,T_NUM
    040B0 E001      LDI	R16,1
    040B1 940E 495A CALL	lsl8
    040B3 9020 0065 LDS	R2,0x65
    040B5 2A20      OR	R2,R16
    040B6 9220 0065 STS	0x65,R2
(0070) 
(0071)   	SEI();
    040B8 9478      BSET	7
(0072) 	if(bus_flag){
    040B9 20AA      TST	R10
    040BA F011      BEQ	0x40BD
(0073) 		return FALSE;
    040BB 2700      CLR	R16
    040BC C001      RJMP	0x40BE
(0074) 	}else{
(0075) 		return TRUE;
    040BD E001      LDI	R16,1
    040BE 90A9      LD	R10,Y+
    040BF 9508      RET
_write_bit_18B20:
  bitval               --> R10
    040C0 92AA      ST	-Y,R10
    040C1 2EA0      MOV	R10,R16
(0076) 	}
(0077) 
(0078) }
(0079) 
(0080) //------------------------------------------------------------------------------
(0081) // 写一位到总线
(0082) //------------------------------------------------------------------------------
(0083) void write_bit_18B20(char bitval)
(0084) {
(0085)     SET_OUT;
    040C2 9110 05D8 LDS	R17,T_NUM
    040C4 E001      LDI	R16,1
    040C5 940E 495A CALL	lsl8
    040C7 9020 0064 LDS	R2,0x64
    040C9 2A20      OR	R2,R16
    040CA 9220 0064 STS	0x64,R2
(0086) 					NOP();
    040CC 0000      NOP
(0087) 					NOP();
    040CD 0000      NOP
(0088) 			 CL_DQ;
    040CE 9110 05D8 LDS	R17,T_NUM
    040D0 E001      LDI	R16,1
    040D1 940E 495A CALL	lsl8
    040D3 2E20      MOV	R2,R16
    040D4 9420      COM	R2
    040D5 9030 0065 LDS	R3,0x65
    040D7 2032      AND	R3,R2
    040D8 9230 0065 STS	0x65,R3
(0089) 	   Delay_nus(1);
    040DA E001      LDI	R16,1
    040DB E010      LDI	R17,0
    040DC DF67      RCALL	_Delay_nus
(0090) 	   if(bitval){    //写数据，从低位开始
    040DD 20AA      TST	R10
    040DE F059      BEQ	0x40EA
(0091) 		     SET_DQ;
    040DF 9110 05D8 LDS	R17,T_NUM
    040E1 E001      LDI	R16,1
    040E2 940E 495A CALL	lsl8
    040E4 9020 0065 LDS	R2,0x65
    040E6 2A20      OR	R2,R16
    040E7 9220 0065 STS	0x65,R2
(0092) 	  }else{
    040E9 C00C      RJMP	0x40F6
(0093) 		     CL_DQ;
    040EA 9110 05D8 LDS	R17,T_NUM
    040EC E001      LDI	R16,1
    040ED 940E 495A CALL	lsl8
    040EF 2E20      MOV	R2,R16
    040F0 9420      COM	R2
    040F1 9030 0065 LDS	R3,0x65
    040F3 2032      AND	R3,R2
    040F4 9230 0065 STS	0x65,R3
(0094) 	  }
(0095) 	Delay_nus(40);		//15~60us
    040F6 E208      LDI	R16,0x28
    040F7 E010      LDI	R17,0
    040F8 DF4B      RCALL	_Delay_nus
(0096) 	SET_DQ;
    040F9 9110 05D8 LDS	R17,T_NUM
    040FB E001      LDI	R16,1
    040FC 940E 495A CALL	lsl8
    040FE 9020 0065 LDS	R2,0x65
    04100 2A20      OR	R2,R16
    04101 9220 0065 STS	0x65,R2
(0097) 	Delay_nus(10);
    04103 E00A      LDI	R16,0xA
    04104 E010      LDI	R17,0
    04105 DF3E      RCALL	_Delay_nus
    04106 90A9      LD	R10,Y+
    04107 9508      RET
_read_bit_18B20:
  k                    --> R10
    04108 92AA      ST	-Y,R10
(0098) }
(0099) 
(0100) //------------------------------------------------------------------------------
(0101) // 读一位从总线
(0102) //------------------------------------------------------------------------------
(0103) unsigned char read_bit_18B20(void)
(0104) {
(0105) 	unsigned char k;
(0106) 	SET_OUT;
    04109 9110 05D8 LDS	R17,T_NUM
    0410B E001      LDI	R16,1
    0410C 940E 495A CALL	lsl8
    0410E 9020 0064 LDS	R2,0x64
    04110 2A20      OR	R2,R16
    04111 9220 0064 STS	0x64,R2
(0107) 	CL_DQ;			//读时间片开始，拉低总线至少1us
    04113 9110 05D8 LDS	R17,T_NUM
    04115 E001      LDI	R16,1
    04116 940E 495A CALL	lsl8
    04118 2E20      MOV	R2,R16
    04119 9420      COM	R2
    0411A 9030 0065 LDS	R3,0x65
    0411C 2032      AND	R3,R2
    0411D 9230 0065 STS	0x65,R3
(0108) 	Delay_nus(1);
    0411F E001      LDI	R16,1
    04120 E010      LDI	R17,0
    04121 DF22      RCALL	_Delay_nus
(0109) 	
(0110) 					//SET_DQ;	
(0111) 	SET_IN;
    04122 9110 05D8 LDS	R17,T_NUM
    04124 E001      LDI	R16,1
    04125 940E 495A CALL	lsl8
    04127 2E20      MOV	R2,R16
    04128 9420      COM	R2
    04129 9030 0064 LDS	R3,0x64
    0412B 2032      AND	R3,R2
    0412C 9230 0064 STS	0x64,R3
(0112) 	Delay_nus(4);
    0412E E004      LDI	R16,4
    0412F E010      LDI	R17,0
    04130 DF13      RCALL	_Delay_nus
(0113) 	k=IN_DQ;    	//读数据,从低位开始
    04131 9110 05D8 LDS	R17,T_NUM
    04133 E001      LDI	R16,1
    04134 940E 495A CALL	lsl8
    04136 90A0 0063 LDS	R10,0x63
    04138 22A0      AND	R10,R16
(0114) 	Delay_nus(10);
    04139 E00A      LDI	R16,0xA
    0413A E010      LDI	R17,0
    0413B DF08      RCALL	_Delay_nus
(0115) 	SET_DQ;	
    0413C 9110 05D8 LDS	R17,T_NUM
    0413E E001      LDI	R16,1
    0413F 940E 495A CALL	lsl8
    04141 9020 0065 LDS	R2,0x65
    04143 2A20      OR	R2,R16
    04144 9220 0065 STS	0x65,R2
(0116) 				NOP();
    04146 0000      NOP
(0117) 				NOP();
    04147 0000      NOP
(0118) 	SET_OUT;
    04148 9110 05D8 LDS	R17,T_NUM
    0414A E001      LDI	R16,1
    0414B 940E 495A CALL	lsl8
    0414D 9020 0064 LDS	R2,0x64
    0414F 2A20      OR	R2,R16
    04150 9220 0064 STS	0x64,R2
(0119) 	    NOP();
    04152 0000      NOP
(0120) 					NOP();
    04153 0000      NOP
(0121) 	if(k){
    04154 20AA      TST	R10
    04155 F011      BEQ	0x4158
(0122) 	    return 1;
    04156 E001      LDI	R16,1
    04157 C001      RJMP	0x4159
(0123) 	}else{
(0124) 	    return 0;
    04158 2700      CLR	R16
    04159 90A9      LD	R10,Y+
    0415A 9508      RET
_write_byte_18B20:
  i                    --> R20
  data                 --> R10
    0415B 92AA      ST	-Y,R10
    0415C 934A      ST	-Y,R20
    0415D 2EA0      MOV	R10,R16
(0125) 	}
(0126) 	
(0127) }
(0128) 
(0129) //------------------------------------------------------------------------------
(0130) // 写一个字节到总线
(0131) //------------------------------------------------------------------------------
(0132) void write_byte_18B20(unsigned char data)
(0133) {
(0134) 	unsigned char i;
(0135)    CLI();
    0415E 94F8      BCLR	7
(0136)     for(i=0;i<8;i++)
    0415F 2744      CLR	R20
    04160 C009      RJMP	0x416A
(0137)     {
(0138)         write_bit_18B20(data&(1<<i));
    04161 E001      LDI	R16,1
    04162 2F14      MOV	R17,R20
    04163 940E 495A CALL	lsl8
    04165 2E20      MOV	R2,R16
    04166 2D0A      MOV	R16,R10
    04167 2102      AND	R16,R2
    04168 DF57      RCALL	_write_bit_18B20
    04169 9543      INC	R20
    0416A 3048      CPI	R20,0x8
    0416B F3A8      BCS	0x4161
(0139)         
(0140)     }
(0141)     SET_DQ;
    0416C 9110 05D8 LDS	R17,T_NUM
    0416E E001      LDI	R16,1
    0416F 940E 495A CALL	lsl8
    04171 9020 0065 LDS	R2,0x65
    04173 2A20      OR	R2,R16
    04174 9220 0065 STS	0x65,R2
(0142) 				  NOP();
    04176 0000      NOP
(0143) 					 NOP();
    04177 0000      NOP
(0144)     SEI();
    04178 9478      BSET	7
    04179 9149      LD	R20,Y+
    0417A 90A9      LD	R10,Y+
    0417B 9508      RET
_read_byte_18B20:
  temp                 --> R10
  n                    --> R20
    0417C 92AA      ST	-Y,R10
    0417D 934A      ST	-Y,R20
(0145)     
(0146)     //return;
(0147) }
(0148) 
(0149) //------------------------------------------------------------------------------
(0150) // 读一个字节
(0151) //------------------------------------------------------------------------------
(0152) unsigned char read_byte_18B20(void)
(0153) {
(0154) 	unsigned char temp,n;
(0155)     CLI();
    0417E 94F8      BCLR	7
(0156)   	temp=0;
    0417F 24AA      CLR	R10
(0157)     for(n=0;n<8;n++)
    04180 2744      CLR	R20
    04181 C014      RJMP	0x4196
(0158)     {
(0159)       	if(read_bit_18B20()){
    04182 DF85      RCALL	_read_bit_18B20
    04183 2300      TST	R16
    04184 F031      BEQ	0x418B
(0160)       		temp|=(1<<n);
    04185 E001      LDI	R16,1
    04186 2F14      MOV	R17,R20
    04187 940E 495A CALL	lsl8
    04189 2AA0      OR	R10,R16
(0161)       	}else{
    0418A C007      RJMP	0x4192
(0162)       		temp&=~(1<<n);
    0418B E001      LDI	R16,1
    0418C 2F14      MOV	R17,R20
    0418D 940E 495A CALL	lsl8
    0418F 2E20      MOV	R2,R16
    04190 9420      COM	R2
    04191 20A2      AND	R10,R2
(0163)       	}
(0164)       	Delay_nus(70); //60~120us
    04192 E406      LDI	R16,0x46
    04193 E010      LDI	R17,0
    04194 DEAF      RCALL	_Delay_nus
    04195 9543      INC	R20
    04196 3048      CPI	R20,0x8
    04197 F350      BCS	0x4182
(0165)       	
(0166)    }
(0167)    SEI();
    04198 9478      BSET	7
(0168) 
(0169)    return temp;
    04199 2D0A      MOV	R16,R10
    0419A 9149      LD	R20,Y+
    0419B 90A9      LD	R10,Y+
    0419C 9508      RET
(0170) }
(0171) 
(0172) 
(0173) 
(0174) //------------------------------------------------------------------------------
(0175) // 应用函数部分！ 供外部调用
(0176) //------------------------------------------------------------------------------
(0177) //------------------------------------------------------------------------------
(0178) // 单器件/多器件：开始转换
(0179) //------------------------------------------------------------------------------
(0180) void convert_T(void)
(0181) {
(0182) 					if(reset_18B20()){
_convert_T:
    0419D DEB6      RCALL	_reset_18B20
    0419E 2300      TST	R16
    0419F F021      BEQ	0x41A4
(0183) 					write_byte_18B20(0xcc);
    041A0 EC0C      LDI	R16,0xCC
    041A1 DFB9      RCALL	_write_byte_18B20
(0184) 					write_byte_18B20(0x44);
    041A2 E404      LDI	R16,0x44
    041A3 DFB7      RCALL	_write_byte_18B20
(0185) 					}
    041A4 9508      RET
_read_T:
  tmp                  --> Y,+0
  tl                   --> R12
  th                   --> R10
    041A5 940E 48C7 CALL	push_xgset00FC
    041A7 9724      SBIW	R28,4
(0186) }
(0187) 
(0188) //------------------------------------------------------------------------------
(0189) // 单器件：读温度，返回INIT8U型温度数据（原始数据）
(0190) //------------------------------------------------------------------------------
(0191) float read_T(void)
(0192) {
(0193)     unsigned char th=0,tl=0;
    041A8 24AA      CLR	R10
    041A9 24CC      CLR	R12
(0194) 	float tmp;
(0195)     if(reset_18B20()){
    041AA DEA9      RCALL	_reset_18B20
    041AB 2300      TST	R16
    041AC F021      BEQ	0x41B1
(0196)     	write_byte_18B20(0xcc);
    041AD EC0C      LDI	R16,0xCC
    041AE DFAC      RCALL	_write_byte_18B20
(0197)     	write_byte_18B20(0xbe);
    041AF EB0E      LDI	R16,0xBE
    041B0 DFAA      RCALL	_write_byte_18B20
(0198)     }
(0199)     
(0200)     tl = read_byte_18B20();
    041B1 DFCA      RCALL	_read_byte_18B20
    041B2 2EC0      MOV	R12,R16
(0201)     th = read_byte_18B20();
    041B3 DFC8      RCALL	_read_byte_18B20
    041B4 2EE0      MOV	R14,R16
    041B5 2CAE      MOV	R10,R14
(0202)  	tmp= ((float)(th<<8|tl))*0.0625;
    041B6 EC0A      LDI	R16,0xCA
    041B7 E010      LDI	R17,0
    041B8 940E 484B CALL	elpm32
    041BA 0118      MOVW	R2,R16
    041BB 0129      MOVW	R4,R18
    041BC 2D1A      MOV	R17,R10
    041BD 2D0C      MOV	R16,R12
    041BE 940E 4A6E CALL	int2fp
    041C0 933A      ST	-Y,R19
    041C1 932A      ST	-Y,R18
    041C2 931A      ST	-Y,R17
    041C3 930A      ST	-Y,R16
    041C4 0181      MOVW	R16,R2
    041C5 0192      MOVW	R18,R4
    041C6 940E 4C13 CALL	fpmule2
    041C8 8308      ST	Y,R16
    041C9 8319      STD	Y+1,R17
    041CA 832A      STD	Y+2,R18
    041CB 833B      STD	Y+3,R19
(0203)     return( tmp);
    041CC 8108      LD	R16,Y
    041CD 8119      LDD	R17,Y+1
    041CE 812A      LDD	R18,Y+2
    041CF 813B      LDD	R19,Y+3
    041D0 9624      ADIW	R28,4
    041D1 940C 48A8 JMP	pop_xgset00FC
_read_T_NUM:
  ttemp                --> Y,+0
  NUM                  --> R10
    041D3 92AA      ST	-Y,R10
    041D4 2EA0      MOV	R10,R16
    041D5 9724      SBIW	R28,4
(0204) }
(0205) 
(0206) float read_T_NUM(unsigned char NUM){
(0207) float ttemp;
(0208) if ( NUM >1) return 123.45;
    041D6 E081      LDI	R24,1
    041D7 158A      CP	R24,R10
    041D8 F428      BCC	0x41DE
    041D9 EC06      LDI	R16,0xC6
    041DA E010      LDI	R17,0
    041DB 940E 484B CALL	elpm32
    041DD C010      RJMP	0x41EE
(0209) T_NUM=NUM;//设置访问器件
    041DE 92A0 05D8 STS	T_NUM,R10
(0210) convert_T();//温度转换
    041E0 DFBC      RCALL	_convert_T
(0211) delayms(800);
    041E1 E200      LDI	R16,0x20
    041E2 E013      LDI	R17,3
    041E3 940E 2537 CALL	_delayms
(0212) ttemp=read_T();
    041E5 DFBF      RCALL	_read_T
    041E6 8308      ST	Y,R16
    041E7 8319      STD	Y+1,R17
    041E8 832A      STD	Y+2,R18
    041E9 833B      STD	Y+3,R19
(0213) return ttemp;
    041EA 8108      LD	R16,Y
    041EB 8119      LDD	R17,Y+1
    041EC 812A      LDD	R18,Y+2
    041ED 813B      LDD	R19,Y+3
    041EE 9624      ADIW	R28,4
    041EF 90A9      LD	R10,Y+
    041F0 9508      RET
_readWithoutDelay:
  ttemp                --> Y,+0
  NUM                  --> R10
    041F1 92AA      ST	-Y,R10
    041F2 2EA0      MOV	R10,R16
    041F3 9724      SBIW	R28,4
(0214) }
(0215) float readWithoutDelay(unsigned char NUM)
(0216) {
(0217) float ttemp;
(0218) if ( NUM >1) return 123.45;
    041F4 E081      LDI	R24,1
    041F5 158A      CP	R24,R10
    041F6 F428      BCC	0x41FC
    041F7 EC06      LDI	R16,0xC6
    041F8 E010      LDI	R17,0
    041F9 940E 484B CALL	elpm32
    041FB C00C      RJMP	0x4208
(0219) T_NUM=NUM;//设置访问器件
    041FC 92A0 05D8 STS	T_NUM,R10
(0220) ttemp=read_T();
    041FE DFA6      RCALL	_read_T
    041FF 8308      ST	Y,R16
    04200 8319      STD	Y+1,R17
    04201 832A      STD	Y+2,R18
    04202 833B      STD	Y+3,R19
(0221) convert_T();//温度转换
    04203 DF99      RCALL	_convert_T
(0222) return ttemp;
    04204 8108      LD	R16,Y
    04205 8119      LDD	R17,Y+1
    04206 812A      LDD	R18,Y+2
    04207 813B      LDD	R19,Y+3
    04208 9624      ADIW	R28,4
    04209 90A9      LD	R10,Y+
    0420A 9508      RET
FILE: D:\LQD\software\software_src\ds1302.c
(0001) #include "config.h"
(0002) 
(0003) #define TPORT PORTB
(0004) #define TDDR DDRB
(0005) #define TPIN PINB
(0006) #define PIN_RST	 4
(0007) #define PIN_IO	 5
(0008) #define PIN_SCK	 6
(0009) /******************复位脚*********************/
(0010) #define RST_CLR	TPORT &= ~(1 << PIN_RST)   /*电平置低*/
(0011) #define RST_SET	TPORT |= (1 << PIN_RST)    /*电平置高*/
(0012) #define RST_IN	TDDR &= ~(1 << PIN_RST)    /*方向输入*/
(0013) #define RST_OUT	TDDR |= (1 << PIN_RST)     /*方向输出*/
(0014) 
(0015) /*****************双向数据********************/
(0016) #define IO_CLR	TPORT &= ~(1 << PIN_IO)  /*电平置低*/
(0017) #define IO_SET	TPORT |= (1 << PIN_IO)   /*电平置高*/
(0018) #define IO_R	TPIN & (1 << PIN_IO)     /*电平读取*/
(0019) #define IO_IN	TDDR &= ~(1 << PIN_IO)   /*方向输入*/
(0020) #define IO_OUT	TDDR |= (1 << PIN_IO)    /*方向输出*/
(0021) 
(0022) /*****************时钟信号*******************/
(0023) #define SCK_CLR	TPORT &= ~(1 << PIN_SCK)  /*时钟信号*/
(0024) #define SCK_SET	TPORT |= (1 << PIN_SCK)   /*电平置高*/
(0025) #define SCK_IN	TDDR &= ~(1 << PIN_SCK)   /*方向输入*/
(0026) #define SCK_OUT	TDDR |= (1 << PIN_SCK)    /*方向输出*/
(0027) 
(0028) #define ds1302_sec_add			0x80		//秒数据地址
(0029) #define ds1302_min_add			0x82		//分数据地址
(0030) #define ds1302_hr_add			0x84		//时数据地址
(0031) #define ds1302_date_add			0x86		//日数据地址
(0032) #define ds1302_month_add		0x88		//月数据地址
(0033) #define ds1302_day_add			0x8a		//星期数据地址
(0034) #define ds1302_year_add			0x8c		//年数据地址
(0035) #define ds1302_control_add		0x8e		//控制数据地址
(0036) #define ds1302_charger_add		0x90 					 
(0037) #define ds1302_clkburst_add		0xbe
(0038) 
(0039) unsigned char time_buf[8] = {0x20,0x0c,0x0A,0x1c,0x22,0x46,0x00,0x06};
(0040) /*
(0041)  struct tm {
(0042)    	int tm_sec;   // 秒 seconds after the minute, 0 to 60
(0043)    	int tm_min;   // 分 minutes after the hour, 0 to 59
(0044) 	int tm_hour;  // 时 hours since midnight, 0 to 23*
(0045) 	int tm_mday;  // 日 day of the month, 1 to 31
(0046) 	int tm_mon;   // 月 months since January, 0 to 11
(0047) 	int tm_year;  // 年 years since 1900
(0048) 	int tm_wday;  // 星期 days since Sunday, 0 to 6
(0049) 	int tm_yday;  // 从元旦起的天数 days since January 1, 0 to 365
(0050)  	int tm_isdst; // 夏令时？？Daylight Savings Time flag
(0051)  	};	
(0052) 	*/
(0053) 
(0054) //DS1302初始化函数
(0055) void ds1302_init(void) 
(0056) {
(0057) 	RST_CLR;			/*RST脚置低*/
_ds1302_init:
    0420B 98C4      CBI	0x18,4
(0058) 	SCK_CLR;			/*SCK脚置低*/
    0420C 98C6      CBI	0x18,6
(0059) 	RST_OUT;			/*RST脚设置为输出*/
    0420D 9ABC      SBI	0x17,4
(0060) 	SCK_OUT;			/*SCK脚设置为输出*/
    0420E 9ABE      SBI	0x17,6
    0420F 9508      RET
_ds1302_write_byte:
  i                    --> R20
  d                    --> R18
  addr                 --> R16
    04210 934A      ST	-Y,R20
(0061) }
(0062) 
(0063) //向DS1302写入一字节数据
(0064) void ds1302_write_byte(unsigned char addr, unsigned char d) {
(0065) 
(0066) 	unsigned char i;
(0067) 	RST_SET;					/*启动DS1302总线*/
    04211 9AC4      SBI	0x18,4
(0068) 	
(0069) 	/*写入目标地址：addr*/
(0070) 	IO_OUT;
    04212 9ABD      SBI	0x17,5
(0071) 	addr = addr & 0xFE;   //最低位置零，寄存器0位为0时写，为1时读
    04213 7F0E      ANDI	R16,0xFE
(0072) 	for (i = 0; i < 8; i ++) {
    04214 2744      CLR	R20
    04215 C009      RJMP	0x421F
(0073) 		if (addr & 0x01) {
    04216 FF00      SBRS	R16,0
    04217 C002      RJMP	0x421A
(0074) 			IO_SET;
    04218 9AC5      SBI	0x18,5
(0075) 			}
    04219 C001      RJMP	0x421B
(0076) 		else {
(0077) 			IO_CLR;
    0421A 98C5      CBI	0x18,5
(0078) 			}
(0079) 		SCK_SET;      //产生时钟
    0421B 9AC6      SBI	0x18,6
(0080) 		SCK_CLR;
    0421C 98C6      CBI	0x18,6
(0081) 		addr = addr >> 1;
    0421D 9506      LSR	R16
    0421E 9543      INC	R20
    0421F 3048      CPI	R20,0x8
    04220 F3A8      BCS	0x4216
(0082) 		}
(0083) 	
(0084) 	/*写入数据：d*/
(0085) 	IO_OUT;
    04221 9ABD      SBI	0x17,5
(0086) 	for (i = 0; i < 8; i ++) {
    04222 2744      CLR	R20
    04223 C009      RJMP	0x422D
(0087) 		if (d & 0x01) {
    04224 FF20      SBRS	R18,0
    04225 C002      RJMP	0x4228
(0088) 			IO_SET;
    04226 9AC5      SBI	0x18,5
(0089) 			}
    04227 C001      RJMP	0x4229
(0090) 		else {
(0091) 			IO_CLR;
    04228 98C5      CBI	0x18,5
(0092) 			}
(0093) 		SCK_SET;    //产生时钟
    04229 9AC6      SBI	0x18,6
(0094) 		SCK_CLR;
    0422A 98C6      CBI	0x18,6
(0095) 		d = d >> 1;
    0422B 9526      LSR	R18
    0422C 9543      INC	R20
    0422D 3048      CPI	R20,0x8
    0422E F3A8      BCS	0x4224
(0096) 		}
(0097) 	RST_CLR;		//停止DS1302总线
    0422F 98C4      CBI	0x18,4
    04230 9149      LD	R20,Y+
    04231 9508      RET
_ds1302_read_byte:
  temp                 --> R20
  i                    --> R22
  addr                 --> R16
    04232 934A      ST	-Y,R20
    04233 936A      ST	-Y,R22
(0098) 	
(0099) }
(0100) 
(0101) //从DS1302读出一字节数据
(0102) unsigned char ds1302_read_byte(unsigned char addr) {
(0103) 
(0104) 	unsigned char i;
(0105) 	unsigned char temp;
(0106) 	RST_SET;					/*启动DS1302总线*/
    04234 9AC4      SBI	0x18,4
(0107) 
(0108) 	/*写入目标地址：addr*/
(0109) 	IO_OUT;
    04235 9ABD      SBI	0x17,5
(0110) 	addr = addr | 0x01;    //最低位置高，寄存器0位为0时写，为1时读
    04236 6001      ORI	R16,1
(0111) 	for (i = 0; i < 8; i ++) {
    04237 2766      CLR	R22
    04238 C009      RJMP	0x4242
(0112) 		if (addr & 0x01) {
    04239 FF00      SBRS	R16,0
    0423A C002      RJMP	0x423D
(0113) 			IO_SET;
    0423B 9AC5      SBI	0x18,5
(0114) 			}
    0423C C001      RJMP	0x423E
(0115) 		else {
(0116) 			IO_CLR;
    0423D 98C5      CBI	0x18,5
(0117) 			}
(0118) 		SCK_SET;
    0423E 9AC6      SBI	0x18,6
(0119) 		SCK_CLR;
    0423F 98C6      CBI	0x18,6
(0120) 		addr = addr >> 1;
    04240 9506      LSR	R16
    04241 9563      INC	R22
    04242 3068      CPI	R22,0x8
    04243 F3A8      BCS	0x4239
(0121) 		}
(0122) 	
(0123) 	/*输出数据：temp*/
(0124) 	IO_IN;
    04244 98BD      CBI	0x17,5
(0125) 	for (i = 0; i < 8; i ++) {
    04245 2766      CLR	R22
    04246 C009      RJMP	0x4250
(0126) 		temp = temp >> 1;
    04247 9546      LSR	R20
(0127) 		if (IO_R) {
    04248 9BB5      SBIS	0x16,5
    04249 C002      RJMP	0x424C
(0128) 			temp |= 0x80;
    0424A 6840      ORI	R20,0x80
(0129) 			}
    0424B C001      RJMP	0x424D
(0130) 		else {
(0131) 			temp &= 0x7F;
    0424C 774F      ANDI	R20,0x7F
(0132) 			}
(0133) 		SCK_SET;
    0424D 9AC6      SBI	0x18,6
(0134) 		SCK_CLR;
    0424E 98C6      CBI	0x18,6
    0424F 9563      INC	R22
    04250 3068      CPI	R22,0x8
    04251 F3A8      BCS	0x4247
(0135) 		}
(0136) 	
(0137) 	RST_CLR;					/*停止DS1302总线*/
    04252 98C4      CBI	0x18,4
(0138) 	return temp;
    04253 2F04      MOV	R16,R20
    04254 9169      LD	R22,Y+
    04255 9149      LD	R20,Y+
    04256 9508      RET
(0139) }
(0140) 
(0141) //向DS302写入时钟数据
(0142) void ds1302_write_time(void) {
(0143) 
(0144) 	ds1302_write_byte(ds1302_control_add,0x00);			//关闭写保护 
_ds1302_write_time:
    04257 2722      CLR	R18
    04258 E80E      LDI	R16,0x8E
    04259 DFB6      RCALL	_ds1302_write_byte
(0145) 	ds1302_write_byte(ds1302_sec_add,0x80);				//暂停时钟 
    0425A E820      LDI	R18,0x80
    0425B E800      LDI	R16,0x80
    0425C DFB3      RCALL	_ds1302_write_byte
(0146) 	//ds1302_write_byte(ds1302_charger_add,0xa9);	    //涓流充电 
(0147) 	ds1302_write_byte(ds1302_year_add,time_buf[1]);		//年 
    0425D 9120 05DA LDS	R18,time_buf+1
    0425F E80C      LDI	R16,0x8C
    04260 DFAF      RCALL	_ds1302_write_byte
(0148) 	ds1302_write_byte(ds1302_month_add,time_buf[2]);	//月 
    04261 9120 05DB LDS	R18,time_buf+2
    04263 E808      LDI	R16,0x88
    04264 DFAB      RCALL	_ds1302_write_byte
(0149) 	ds1302_write_byte(ds1302_date_add,time_buf[3]);		//日 
    04265 9120 05DC LDS	R18,time_buf+3
    04267 E806      LDI	R16,0x86
    04268 DFA7      RCALL	_ds1302_write_byte
(0150) 	ds1302_write_byte(ds1302_hr_add,time_buf[4]);		//时 
    04269 9120 05DD LDS	R18,time_buf+4
    0426B E804      LDI	R16,0x84
    0426C DFA3      RCALL	_ds1302_write_byte
(0151) 	ds1302_write_byte(ds1302_min_add,time_buf[5]);		//分
    0426D 9120 05DE LDS	R18,time_buf+5
    0426F E802      LDI	R16,0x82
    04270 DF9F      RCALL	_ds1302_write_byte
(0152) 	ds1302_write_byte(ds1302_sec_add,time_buf[6]);		//秒
    04271 9120 05DF LDS	R18,time_buf+6
    04273 E800      LDI	R16,0x80
    04274 DF9B      RCALL	_ds1302_write_byte
(0153) 	ds1302_write_byte(ds1302_day_add,time_buf[7]);		//周 
    04275 9120 05E0 LDS	R18,time_buf+7
    04277 E80A      LDI	R16,0x8A
    04278 DF97      RCALL	_ds1302_write_byte
(0154) 	ds1302_write_byte(ds1302_control_add,0x80);			//打开写保护 
    04279 E820      LDI	R18,0x80
    0427A E80E      LDI	R16,0x8E
    0427B CF94      RJMP	_ds1302_write_byte
_ds1302_read_time:
    0427C 92AA      ST	-Y,R10
    0427D 934A      ST	-Y,R20
(0155) }
(0156) 
(0157) //从DS302读出时钟数据
(0158) void ds1302_read_time(void)  { 
(0159) 	time_buf[1]=ds1302_read_byte(ds1302_year_add);		//年 
    0427E E80C      LDI	R16,0x8C
    0427F DFB2      RCALL	_ds1302_read_byte
    04280 9300 05DA STS	time_buf+1,R16
(0160) 	time_buf[2]=ds1302_read_byte(ds1302_month_add);		//月 
    04282 E808      LDI	R16,0x88
    04283 DFAE      RCALL	_ds1302_read_byte
    04284 9300 05DB STS	time_buf+2,R16
(0161) 	time_buf[3]=ds1302_read_byte(ds1302_date_add);		//日 
    04286 E806      LDI	R16,0x86
    04287 DFAA      RCALL	_ds1302_read_byte
    04288 2EA0      MOV	R10,R16
    04289 92A0 05DC STS	time_buf+3,R10
(0162) 	time_buf[4]=ds1302_read_byte(ds1302_hr_add);		//时 
    0428B E804      LDI	R16,0x84
    0428C DFA5      RCALL	_ds1302_read_byte
    0428D 2EA0      MOV	R10,R16
    0428E 92A0 05DD STS	time_buf+4,R10
(0163) 	time_buf[5]=ds1302_read_byte(ds1302_min_add);		//分 
    04290 E802      LDI	R16,0x82
    04291 DFA0      RCALL	_ds1302_read_byte
    04292 2EA0      MOV	R10,R16
    04293 92A0 05DE STS	time_buf+5,R10
(0164) 	time_buf[6]=(ds1302_read_byte(ds1302_sec_add))&0x7F;//秒，屏蔽秒的第7位，避免超出59
    04295 E800      LDI	R16,0x80
    04296 DF9B      RCALL	_ds1302_read_byte
    04297 2F40      MOV	R20,R16
    04298 2F84      MOV	R24,R20
    04299 778F      ANDI	R24,0x7F
    0429A 9380 05DF STS	time_buf+6,R24
(0165) 	time_buf[7]=ds1302_read_byte(ds1302_day_add);		//周 
    0429C E80A      LDI	R16,0x8A
    0429D DF94      RCALL	_ds1302_read_byte
    0429E 2EA0      MOV	R10,R16
    0429F 92A0 05E0 STS	time_buf+7,R10
    042A1 9149      LD	R20,Y+
    042A2 90A9      LD	R10,Y+
    042A3 9508      RET
_kbscan:
  key                  --> R20
  temp                 --> Y,+0
    042A4 934A      ST	-Y,R20
    042A5 9724      SBIW	R28,4
FILE: D:\LQD\software\software_src\key.c
(0001) #include "config.h"
(0002) //键盘扫描函数
(0003) unsigned char kbscan(void)
(0004)   {
(0005)    unsigned char key;
(0006)    unsigned long temp=0;
    042A6 E080      LDI	R24,0
    042A7 8388      ST	Y,R24
    042A8 8389      STD	Y+1,R24
    042A9 838A      STD	Y+2,R24
    042AA 838B      STD	Y+3,R24
(0007)    DDR_SET;
    042AB B38A      IN	R24,0x1A
    042AC 7087      ANDI	R24,7
    042AD BB8A      OUT	0x1A,R24
(0008)    
(0009)    if((KEY_PIN) != KEY_MASK)         //检测A口按键引脚电平，如果全是高电平则退出
    042AE B389      IN	R24,0x19
    042AF 718F      ANDI	R24,0x1F
    042B0 318F      CPI	R24,0x1F
    042B1 F1A9      BEQ	0x42E7
(0010)     {
(0011)      delayms(20);           //防抖
    042B2 E104      LDI	R16,0x14
    042B3 E010      LDI	R17,0
    042B4 940E 2537 CALL	_delayms
(0012)      if((KEY_PIN) != KEY_MASK )      //再次检测A口电平，如果不全是高电平则继续执行程序
    042B6 B389      IN	R24,0x19
    042B7 718F      ANDI	R24,0x1F
    042B8 318F      CPI	R24,0x1F
    042B9 F179      BEQ	0x42E9
(0013)       {
(0014)        key = KEY_PIN ;          //读取PINA，将其存放在key中
    042BA B349      IN	R20,0x19
    042BB 714F      ANDI	R20,0x1F
    042BC C024      RJMP	0x42E1
(0015)         while((KEY_PIN) != KEY_MASK)
(0016) 		{
(0017) 		 temp++ ;
    042BD E081      LDI	R24,1
    042BE E090      LDI	R25,0
    042BF E0A0      LDI	R26,0
    042C0 E0B0      LDI	R27,0
    042C1 8028      LD	R2,Y
    042C2 8039      LDD	R3,Y+1
    042C3 804A      LDD	R4,Y+2
    042C4 805B      LDD	R5,Y+3
    042C5 0E28      ADD	R2,R24
    042C6 1E39      ADC	R3,R25
    042C7 1E4A      ADC	R4,R26
    042C8 1E5B      ADC	R5,R27
    042C9 8228      ST	Y,R2
    042CA 8239      STD	Y+1,R3
    042CB 824A      STD	Y+2,R4
    042CC 825B      STD	Y+3,R5
(0018) 		 if(temp>LONGKEY) {  
    042CD E880      LDI	R24,0x80
    042CE E398      LDI	R25,0x38
    042CF E0A1      LDI	R26,1
    042D0 E0B0      LDI	R27,0
    042D1 8028      LD	R2,Y
    042D2 8039      LDD	R3,Y+1
    042D3 804A      LDD	R4,Y+2
    042D4 805B      LDD	R5,Y+3
    042D5 1582      CP	R24,R2
    042D6 0593      CPC	R25,R3
    042D7 05A4      CPC	R26,R4
    042D8 05B5      CPC	R27,R5
    042D9 F438      BCC	0x42E1
(0019) 		     delayms(30);
    042DA E10E      LDI	R16,0x1E
    042DB E010      LDI	R17,0
    042DC 940E 2537 CALL	_delayms
(0020) 			 return key+0x80;  
    042DE 2F04      MOV	R16,R20
    042DF 5800      SUBI	R16,0x80
    042E0 C009      RJMP	0x42EA
    042E1 B389      IN	R24,0x19
    042E2 718F      ANDI	R24,0x1F
    042E3 318F      CPI	R24,0x1F
    042E4 F6C1      BNE	0x42BD
(0021) 		 };
(0022) 		}
(0023) 		; //当前有按键处于按下状态，再按其他按键时程序维持当前状态 
(0024)       	
(0025) 		return key;
    042E5 2F04      MOV	R16,R20
    042E6 C003      RJMP	0x42EA
(0026) 	  
(0027) 	  }
(0028)     }
(0029) 	else return NO_KEY;
    042E7 2700      CLR	R16
    042E8 C001      RJMP	0x42EA
(0030) 	
(0031) 	return NO_KEY;
FILE: <library>
    042E9 2700      CLR	R16
    042EA 9624      ADIW	R28,4
    042EB 9149      LD	R20,Y+
    042EC 9508      RET
__print:
    042ED 940E 477E CALL	push_arg4
    042EF 940E 48C3 CALL	push_xgsetF0FC
    042F1 976C      SBIW	R28,0x1C
    042F2 2400      CLR	R0
    042F3 2411      CLR	R1
    042F4 8A1F      STD	Y+23,R1
    042F5 8A0E      STD	Y+22,R0
    042F6 C456      RJMP	0x474D
    042F7 A5E8      LDD	R30,Y+40
    042F8 A5F9      LDD	R31,Y+41
    042F9 8180      LD	R24,Z
    042FA 3285      CPI	R24,0x25
    042FB F059      BEQ	0x4307
    042FC 8100      LD	R16,Z
    042FD A1EE      LDD	R30,Y+38
    042FE A1FF      LDD	R31,Y+39
    042FF 940E 4910 CALL	xicallx
    04301 898E      LDD	R24,Y+22
    04302 899F      LDD	R25,Y+23
    04303 9601      ADIW	R24,1
    04304 8B9F      STD	Y+23,R25
    04305 8B8E      STD	Y+22,R24
    04306 C441      RJMP	0x4748
    04307 2400      CLR	R0
    04308 2411      CLR	R1
    04309 8A1D      STD	Y+21,R1
    0430A 8A0C      STD	Y+20,R0
    0430B EF8F      LDI	R24,0xFF
    0430C EF9F      LDI	R25,0xFF
    0430D 8F99      STD	Y+25,R25
    0430E 8F88      STD	Y+24,R24
    0430F 24AA      CLR	R10
    04310 24BB      CLR	R11
    04311 EB4E      LDI	R20,0xBE
    04312 E058      LDI	R21,0x8
    04313 E260      LDI	R22,0x20
    04314 A588      LDD	R24,Y+40
    04315 A599      LDD	R25,Y+41
    04316 9601      ADIW	R24,1
    04317 A799      STD	Y+41,R25
    04318 A788      STD	Y+40,R24
    04319 24CC      CLR	R12
    0431A 24DD      CLR	R13
    0431B A5E8      LDD	R30,Y+40
    0431C A5F9      LDD	R31,Y+41
    0431D 80E0      LD	R14,Z
    0431E 24FF      CLR	R15
    0431F 01C7      MOVW	R24,R14
    04320 3280      CPI	R24,0x20
    04321 E0E0      LDI	R30,0
    04322 079E      CPC	R25,R30
    04323 F119      BEQ	0x4347
    04324 3283      CPI	R24,0x23
    04325 E0E0      LDI	R30,0
    04326 079E      CPC	R25,R30
    04327 F091      BEQ	0x433A
    04328 3280      CPI	R24,0x20
    04329 E0E0      LDI	R30,0
    0432A 079E      CPC	R25,R30
    0432B F124      BLT	0x4350
    0432C 01C7      MOVW	R24,R14
    0432D 328B      CPI	R24,0x2B
    0432E E0E0      LDI	R30,0
    0432F 079E      CPC	R25,R30
    04330 F089      BEQ	0x4342
    04331 328D      CPI	R24,0x2D
    04332 E0E0      LDI	R30,0
    04333 079E      CPC	R25,R30
    04334 F049      BEQ	0x433E
    04335 3380      CPI	R24,0x30
    04336 E0E0      LDI	R30,0
    04337 079E      CPC	R25,R30
    04338 F099      BEQ	0x434C
    04339 C016      RJMP	0x4350
    0433A 01C5      MOVW	R24,R10
    0433B 6081      ORI	R24,1
    0433C 015C      MOVW	R10,R24
    0433D C015      RJMP	0x4353
    0433E 01C5      MOVW	R24,R10
    0433F 6084      ORI	R24,4
    04340 015C      MOVW	R10,R24
    04341 C011      RJMP	0x4353
    04342 01C5      MOVW	R24,R10
    04343 6088      ORI	R24,0x8
    04344 015C      MOVW	R10,R24
    04345 E26B      LDI	R22,0x2B
    04346 C00C      RJMP	0x4353
    04347 01C5      MOVW	R24,R10
    04348 6088      ORI	R24,0x8
    04349 015C      MOVW	R10,R24
    0434A E260      LDI	R22,0x20
    0434B C007      RJMP	0x4353
    0434C 01C5      MOVW	R24,R10
    0434D 6180      ORI	R24,0x10
    0434E 015C      MOVW	R10,R24
    0434F C003      RJMP	0x4353
    04350 E081      LDI	R24,1
    04351 E090      LDI	R25,0
    04352 016C      MOVW	R12,R24
    04353 20CC      TST	R12
    04354 F411      BNE	0x4357
    04355 20DD      TST	R13
    04356 F009      BEQ	0x4358
    04357 C006      RJMP	0x435E
    04358 A588      LDD	R24,Y+40
    04359 A599      LDD	R25,Y+41
    0435A 9601      ADIW	R24,1
    0435B A799      STD	Y+41,R25
    0435C A788      STD	Y+40,R24
    0435D CFBD      RJMP	0x431B
    0435E A5E8      LDD	R30,Y+40
    0435F A5F9      LDD	R31,Y+41
    04360 8100      LD	R16,Z
    04361 2711      CLR	R17
    04362 940E 5005 CALL	_isdigit
    04364 3000      CPI	R16,0
    04365 0701      CPC	R16,R17
    04366 F0B9      BEQ	0x437E
    04367 A508      LDD	R16,Y+40
    04368 A519      LDD	R17,Y+41
    04369 940E 4C66 CALL	_atoi
    0436B 8B1D      STD	Y+21,R17
    0436C 8B0C      STD	Y+20,R16
    0436D C005      RJMP	0x4373
    0436E A588      LDD	R24,Y+40
    0436F A599      LDD	R25,Y+41
    04370 9601      ADIW	R24,1
    04371 A799      STD	Y+41,R25
    04372 A788      STD	Y+40,R24
    04373 A5E8      LDD	R30,Y+40
    04374 A5F9      LDD	R31,Y+41
    04375 8100      LD	R16,Z
    04376 2711      CLR	R17
    04377 940E 5005 CALL	_isdigit
    04379 0168      MOVW	R12,R16
    0437A 3000      CPI	R16,0
    0437B 0701      CPC	R16,R17
    0437C F789      BNE	0x436E
    0437D C015      RJMP	0x4393
    0437E A5E8      LDD	R30,Y+40
    0437F A5F9      LDD	R31,Y+41
    04380 8180      LD	R24,Z
    04381 328A      CPI	R24,0x2A
    04382 F481      BNE	0x4393
    04383 A58A      LDD	R24,Y+42
    04384 A59B      LDD	R25,Y+43
    04385 9602      ADIW	R24,2
    04386 A79B      STD	Y+43,R25
    04387 A78A      STD	Y+42,R24
    04388 01FC      MOVW	R30,R24
    04389 9732      SBIW	R30,2
    0438A 8020      LD	R2,Z
    0438B 8031      LDD	R3,Z+1
    0438C 8A3D      STD	Y+21,R3
    0438D 8A2C      STD	Y+20,R2
    0438E A588      LDD	R24,Y+40
    0438F A599      LDD	R25,Y+41
    04390 9601      ADIW	R24,1
    04391 A799      STD	Y+41,R25
    04392 A788      STD	Y+40,R24
    04393 A5E8      LDD	R30,Y+40
    04394 A5F9      LDD	R31,Y+41
    04395 8180      LD	R24,Z
    04396 328E      CPI	R24,0x2E
    04397 F009      BEQ	0x4399
    04398 C03A      RJMP	0x43D3
    04399 01CF      MOVW	R24,R30
    0439A 9601      ADIW	R24,1
    0439B A799      STD	Y+41,R25
    0439C A788      STD	Y+40,R24
    0439D 01FC      MOVW	R30,R24
    0439E 8100      LD	R16,Z
    0439F 2711      CLR	R17
    043A0 940E 5005 CALL	_isdigit
    043A2 0168      MOVW	R12,R16
    043A3 3000      CPI	R16,0
    043A4 0701      CPC	R16,R17
    043A5 F0C1      BEQ	0x43BE
    043A6 A508      LDD	R16,Y+40
    043A7 A519      LDD	R17,Y+41
    043A8 940E 4C66 CALL	_atoi
    043AA 0168      MOVW	R12,R16
    043AB 8ED9      STD	Y+25,R13
    043AC 8EC8      STD	Y+24,R12
    043AD C005      RJMP	0x43B3
    043AE A588      LDD	R24,Y+40
    043AF A599      LDD	R25,Y+41
    043B0 9601      ADIW	R24,1
    043B1 A799      STD	Y+41,R25
    043B2 A788      STD	Y+40,R24
    043B3 A5E8      LDD	R30,Y+40
    043B4 A5F9      LDD	R31,Y+41
    043B5 8100      LD	R16,Z
    043B6 2711      CLR	R17
    043B7 940E 5005 CALL	_isdigit
    043B9 0168      MOVW	R12,R16
    043BA 3000      CPI	R16,0
    043BB 0701      CPC	R16,R17
    043BC F789      BNE	0x43AE
    043BD C015      RJMP	0x43D3
    043BE A5E8      LDD	R30,Y+40
    043BF A5F9      LDD	R31,Y+41
    043C0 8180      LD	R24,Z
    043C1 328A      CPI	R24,0x2A
    043C2 F481      BNE	0x43D3
    043C3 A58A      LDD	R24,Y+42
    043C4 A59B      LDD	R25,Y+43
    043C5 9602      ADIW	R24,2
    043C6 A79B      STD	Y+43,R25
    043C7 A78A      STD	Y+42,R24
    043C8 01FC      MOVW	R30,R24
    043C9 9732      SBIW	R30,2
    043CA 8020      LD	R2,Z
    043CB 8031      LDD	R3,Z+1
    043CC 8E39      STD	Y+25,R3
    043CD 8E28      STD	Y+24,R2
    043CE A588      LDD	R24,Y+40
    043CF A599      LDD	R25,Y+41
    043D0 9601      ADIW	R24,1
    043D1 A799      STD	Y+41,R25
    043D2 A788      STD	Y+40,R24
    043D3 A5E8      LDD	R30,Y+40
    043D4 A5F9      LDD	R31,Y+41
    043D5 8180      LD	R24,Z
    043D6 368C      CPI	R24,0x6C
    043D7 F439      BNE	0x43DF
    043D8 01CF      MOVW	R24,R30
    043D9 9601      ADIW	R24,1
    043DA A799      STD	Y+41,R25
    043DB A788      STD	Y+40,R24
    043DC 01C5      MOVW	R24,R10
    043DD 6082      ORI	R24,2
    043DE 015C      MOVW	R10,R24
    043DF A5E8      LDD	R30,Y+40
    043E0 A5F9      LDD	R31,Y+41
    043E1 80C0      LD	R12,Z
    043E2 24DD      CLR	R13
    043E3 01C6      MOVW	R24,R12
    043E4 3583      CPI	R24,0x53
    043E5 E0E0      LDI	R30,0
    043E6 079E      CPC	R25,R30
    043E7 F409      BNE	0x43E9
    043E8 C18A      RJMP	0x4573
    043E9 E583      LDI	R24,0x53
    043EA 158C      CP	R24,R12
    043EB 059D      CPC	R25,R13
    043EC F064      BLT	0x43F9
    043ED 01C6      MOVW	R24,R12
    043EE 3485      CPI	R24,0x45
    043EF E0E0      LDI	R30,0
    043F0 079E      CPC	R25,R30
    043F1 F409      BNE	0x43F3
    043F2 C307      RJMP	0x46FA
    043F3 3487      CPI	R24,0x47
    043F4 E0E0      LDI	R30,0
    043F5 079E      CPC	R25,R30
    043F6 F409      BNE	0x43F8
    043F7 C30B      RJMP	0x4703
    043F8 C043      RJMP	0x443C
    043F9 01C6      MOVW	R24,R12
    043FA 3588      CPI	R24,0x58
    043FB E0E0      LDI	R30,0
    043FC 079E      CPC	R25,R30
    043FD F409      BNE	0x43FF
    043FE C07E      RJMP	0x447D
    043FF 3588      CPI	R24,0x58
    04400 E0E0      LDI	R30,0
    04401 079E      CPC	R25,R30
    04402 F40C      BGE	0x4404
    04403 C038      RJMP	0x443C
    04404 01C6      MOVW	R24,R12
    04405 3683      CPI	R24,0x63
    04406 E0E0      LDI	R30,0
    04407 079E      CPC	R25,R30
    04408 F409      BNE	0x440A
    04409 C145      RJMP	0x454F
    0440A 3684      CPI	R24,0x64
    0440B E0E0      LDI	R30,0
    0440C 079E      CPC	R25,R30
    0440D F409      BNE	0x440F
    0440E C03A      RJMP	0x4449
    0440F 3685      CPI	R24,0x65
    04410 E0E0      LDI	R30,0
    04411 079E      CPC	R25,R30
    04412 F409      BNE	0x4414
    04413 C2E3      RJMP	0x46F7
    04414 3686      CPI	R24,0x66
    04415 E0E0      LDI	R30,0
    04416 079E      CPC	R25,R30
    04417 F409      BNE	0x4419
    04418 C2E4      RJMP	0x46FD
    04419 3687      CPI	R24,0x67
    0441A E0E0      LDI	R30,0
    0441B 079E      CPC	R25,R30
    0441C F409      BNE	0x441E
    0441D C2E2      RJMP	0x4700
    0441E 3689      CPI	R24,0x69
    0441F E0E0      LDI	R30,0
    04420 079E      CPC	R25,R30
    04421 F139      BEQ	0x4449
    04422 368F      CPI	R24,0x6F
    04423 E0E0      LDI	R30,0
    04424 079E      CPC	R25,R30
    04425 F409      BNE	0x4427
    04426 C056      RJMP	0x447D
    04427 3780      CPI	R24,0x70
    04428 E0E0      LDI	R30,0
    04429 079E      CPC	R25,R30
    0442A F409      BNE	0x442C
    0442B C051      RJMP	0x447D
    0442C 3783      CPI	R24,0x73
    0442D E0E0      LDI	R30,0
    0442E 079E      CPC	R25,R30
    0442F F409      BNE	0x4431
    04430 C200      RJMP	0x4631
    04431 3785      CPI	R24,0x75
    04432 E0E0      LDI	R30,0
    04433 079E      CPC	R25,R30
    04434 F409      BNE	0x4436
    04435 C047      RJMP	0x447D
    04436 3788      CPI	R24,0x78
    04437 E0E0      LDI	R30,0
    04438 079E      CPC	R25,R30
    04439 F409      BNE	0x443B
    0443A C042      RJMP	0x447D
    0443B C000      RJMP	0x443C
    0443C A5E8      LDD	R30,Y+40
    0443D A5F9      LDD	R31,Y+41
    0443E 8100      LD	R16,Z
    0443F A1EE      LDD	R30,Y+38
    04440 A1FF      LDD	R31,Y+39
    04441 940E 4910 CALL	xicallx
    04443 898E      LDD	R24,Y+22
    04444 899F      LDD	R25,Y+23
    04445 9601      ADIW	R24,1
    04446 8B9F      STD	Y+23,R25
    04447 8B8E      STD	Y+22,R24
    04448 C2FF      RJMP	0x4748
    04449 FEA1      SBRS	R10,1
    0444A C01E      RJMP	0x4469
    0444B A58A      LDD	R24,Y+42
    0444C A59B      LDD	R25,Y+43
    0444D 9604      ADIW	R24,4
    0444E A79B      STD	Y+43,R25
    0444F A78A      STD	Y+42,R24
    04450 01FC      MOVW	R30,R24
    04451 9734      SBIW	R30,4
    04452 8020      LD	R2,Z
    04453 8031      LDD	R3,Z+1
    04454 8042      LDD	R4,Z+2
    04455 8053      LDD	R5,Z+3
    04456 862C      STD	Y+12,R2
    04457 863D      STD	Y+13,R3
    04458 864E      STD	Y+14,R4
    04459 865F      STD	Y+15,R5
    0445A E08A      LDI	R24,0xA
    0445B E090      LDI	R25,0
    0445C 839B      STD	Y+3,R25
    0445D 838A      STD	Y+2,R24
    0445E 842C      LDD	R2,Y+12
    0445F 843D      LDD	R3,Y+13
    04460 844E      LDD	R4,Y+14
    04461 845F      LDD	R5,Y+15
    04462 8248      ST	Y,R4
    04463 8259      STD	Y+1,R5
    04464 0191      MOVW	R18,R2
    04465 018A      MOVW	R16,R20
    04466 940E 4D17 CALL	_ltoa
    04468 C0C1      RJMP	0x452A
    04469 A58A      LDD	R24,Y+42
    0446A A59B      LDD	R25,Y+43
    0446B 9602      ADIW	R24,2
    0446C A79B      STD	Y+43,R25
    0446D A78A      STD	Y+42,R24
    0446E 01FC      MOVW	R30,R24
    0446F 9732      SBIW	R30,2
    04470 8020      LD	R2,Z
    04471 8031      LDD	R3,Z+1
    04472 8E3B      STD	Y+27,R3
    04473 8E2A      STD	Y+26,R2
    04474 E08A      LDI	R24,0xA
    04475 E090      LDI	R25,0
    04476 8399      STD	Y+1,R25
    04477 8388      ST	Y,R24
    04478 0191      MOVW	R18,R2
    04479 018A      MOVW	R16,R20
    0447A 940E 4CAC CALL	_itoa
    0447C C0AD      RJMP	0x452A
    0447D FEA1      SBRS	R10,1
    0447E C010      RJMP	0x448F
    0447F A58A      LDD	R24,Y+42
    04480 A59B      LDD	R25,Y+43
    04481 9604      ADIW	R24,4
    04482 A79B      STD	Y+43,R25
    04483 A78A      STD	Y+42,R24
    04484 01FC      MOVW	R30,R24
    04485 9734      SBIW	R30,4
    04486 8020      LD	R2,Z
    04487 8031      LDD	R3,Z+1
    04488 8042      LDD	R4,Z+2
    04489 8053      LDD	R5,Z+3
    0448A 862C      STD	Y+12,R2
    0448B 863D      STD	Y+13,R3
    0448C 864E      STD	Y+14,R4
    0448D 865F      STD	Y+15,R5
    0448E C00B      RJMP	0x449A
    0448F A58A      LDD	R24,Y+42
    04490 A59B      LDD	R25,Y+43
    04491 9602      ADIW	R24,2
    04492 A79B      STD	Y+43,R25
    04493 A78A      STD	Y+42,R24
    04494 01FC      MOVW	R30,R24
    04495 9732      SBIW	R30,2
    04496 8020      LD	R2,Z
    04497 8031      LDD	R3,Z+1
    04498 8E3B      STD	Y+27,R3
    04499 8E2A      STD	Y+26,R2
    0449A A5E8      LDD	R30,Y+40
    0449B A5F9      LDD	R31,Y+41
    0449C 8180      LD	R24,Z
    0449D 3785      CPI	R24,0x75
    0449E F4D9      BNE	0x44BA
    0449F FEA1      SBRS	R10,1
    044A0 C00F      RJMP	0x44B0
    044A1 E08A      LDI	R24,0xA
    044A2 E090      LDI	R25,0
    044A3 839B      STD	Y+3,R25
    044A4 838A      STD	Y+2,R24
    044A5 842C      LDD	R2,Y+12
    044A6 843D      LDD	R3,Y+13
    044A7 844E      LDD	R4,Y+14
    044A8 845F      LDD	R5,Y+15
    044A9 8248      ST	Y,R4
    044AA 8259      STD	Y+1,R5
    044AB 0191      MOVW	R18,R2
    044AC 018A      MOVW	R16,R20
    044AD 940E 4DCF CALL	_ultoa
    044AF C07A      RJMP	0x452A
    044B0 E08A      LDI	R24,0xA
    044B1 E090      LDI	R25,0
    044B2 8399      STD	Y+1,R25
    044B3 8388      ST	Y,R24
    044B4 8D2A      LDD	R18,Y+26
    044B5 8D3B      LDD	R19,Y+27
    044B6 018A      MOVW	R16,R20
    044B7 940E 4E36 CALL	_utoa
    044B9 C070      RJMP	0x452A
    044BA A5E8      LDD	R30,Y+40
    044BB A5F9      LDD	R31,Y+41
    044BC 8180      LD	R24,Z
    044BD 368F      CPI	R24,0x6F
    044BE F509      BNE	0x44E0
    044BF FEA0      SBRS	R10,0
    044C0 C004      RJMP	0x44C5
    044C1 E380      LDI	R24,0x30
    044C2 01FA      MOVW	R30,R20
    044C3 9381      ST	Z+,R24
    044C4 01AF      MOVW	R20,R30
    044C5 FEA1      SBRS	R10,1
    044C6 C00F      RJMP	0x44D6
    044C7 E088      LDI	R24,0x8
    044C8 E090      LDI	R25,0
    044C9 839B      STD	Y+3,R25
    044CA 838A      STD	Y+2,R24
    044CB 842C      LDD	R2,Y+12
    044CC 843D      LDD	R3,Y+13
    044CD 844E      LDD	R4,Y+14
    044CE 845F      LDD	R5,Y+15
    044CF 8248      ST	Y,R4
    044D0 8259      STD	Y+1,R5
    044D1 0191      MOVW	R18,R2
    044D2 018A      MOVW	R16,R20
    044D3 940E 4DCF CALL	_ultoa
    044D5 C054      RJMP	0x452A
    044D6 E088      LDI	R24,0x8
    044D7 E090      LDI	R25,0
    044D8 8399      STD	Y+1,R25
    044D9 8388      ST	Y,R24
    044DA 8D2A      LDD	R18,Y+26
    044DB 8D3B      LDD	R19,Y+27
    044DC 018A      MOVW	R16,R20
    044DD 940E 4E36 CALL	_utoa
    044DF C04A      RJMP	0x452A
    044E0 A5E8      LDD	R30,Y+40
    044E1 A5F9      LDD	R31,Y+41
    044E2 8180      LD	R24,Z
    044E3 3780      CPI	R24,0x70
    044E4 F439      BNE	0x44EC
    044E5 E380      LDI	R24,0x30
    044E6 01FA      MOVW	R30,R20
    044E7 9381      ST	Z+,R24
    044E8 E788      LDI	R24,0x78
    044E9 9381      ST	Z+,R24
    044EA 01AF      MOVW	R20,R30
    044EB C00C      RJMP	0x44F8
    044EC FEA0      SBRS	R10,0
    044ED C00A      RJMP	0x44F8
    044EE E380      LDI	R24,0x30
    044EF 01FA      MOVW	R30,R20
    044F0 9381      ST	Z+,R24
    044F1 01AF      MOVW	R20,R30
    044F2 A5E8      LDD	R30,Y+40
    044F3 A5F9      LDD	R31,Y+41
    044F4 8020      LD	R2,Z
    044F5 01FA      MOVW	R30,R20
    044F6 9221      ST	Z+,R2
    044F7 01AF      MOVW	R20,R30
    044F8 FEA1      SBRS	R10,1
    044F9 C00F      RJMP	0x4509
    044FA E180      LDI	R24,0x10
    044FB E090      LDI	R25,0
    044FC 839B      STD	Y+3,R25
    044FD 838A      STD	Y+2,R24
    044FE 842C      LDD	R2,Y+12
    044FF 843D      LDD	R3,Y+13
    04500 844E      LDD	R4,Y+14
    04501 845F      LDD	R5,Y+15
    04502 8248      ST	Y,R4
    04503 8259      STD	Y+1,R5
    04504 0191      MOVW	R18,R2
    04505 018A      MOVW	R16,R20
    04506 940E 4DCF CALL	_ultoa
    04508 C009      RJMP	0x4512
    04509 E180      LDI	R24,0x10
    0450A E090      LDI	R25,0
    0450B 8399      STD	Y+1,R25
    0450C 8388      ST	Y,R24
    0450D 8D2A      LDD	R18,Y+26
    0450E 8D3B      LDD	R19,Y+27
    0450F 018A      MOVW	R16,R20
    04510 940E 4E36 CALL	_utoa
    04512 A5E8      LDD	R30,Y+40
    04513 A5F9      LDD	R31,Y+41
    04514 8180      LD	R24,Z
    04515 3588      CPI	R24,0x58
    04516 F499      BNE	0x452A
    04517 EB8E      LDI	R24,0xBE
    04518 E098      LDI	R25,0x8
    04519 017C      MOVW	R14,R24
    0451A C00B      RJMP	0x4526
    0451B 01F7      MOVW	R30,R14
    0451C 8100      LD	R16,Z
    0451D 2711      CLR	R17
    0451E 940E 5023 CALL	_toupper
    04520 0168      MOVW	R12,R16
    04521 01F7      MOVW	R30,R14
    04522 82C0      ST	Z,R12
    04523 01C7      MOVW	R24,R14
    04524 9601      ADIW	R24,1
    04525 017C      MOVW	R14,R24
    04526 01F7      MOVW	R30,R14
    04527 8020      LD	R2,Z
    04528 2022      TST	R2
    04529 F789      BNE	0x451B
    0452A EB8E      LDI	R24,0xBE
    0452B E098      LDI	R25,0x8
    0452C 017C      MOVW	R14,R24
    0452D 8D88      LDD	R24,Y+24
    0452E 8D99      LDD	R25,Y+25
    0452F 3F8F      CPI	R24,0xFF
    04530 EFEF      LDI	R30,0xFF
    04531 079E      CPC	R25,R30
    04532 F421      BNE	0x4537
    04533 2400      CLR	R0
    04534 2411      CLR	R1
    04535 8E19      STD	Y+25,R1
    04536 8E08      STD	Y+24,R0
    04537 8C08      LDD	R0,Y+24
    04538 8C19      LDD	R1,Y+25
    04539 2000      TST	R0
    0453A F419      BNE	0x453E
    0453B 2011      TST	R1
    0453C F409      BNE	0x453E
    0453D C104      RJMP	0x4642
    0453E EB0E      LDI	R16,0xBE
    0453F E018      LDI	R17,0x8
    04540 940E 4772 CALL	_strlen
    04542 0168      MOVW	R12,R16
    04543 8EDB      STD	Y+27,R13
    04544 8ECA      STD	Y+26,R12
    04545 8C08      LDD	R0,Y+24
    04546 8C19      LDD	R1,Y+25
    04547 140C      CP	R0,R12
    04548 041D      CPC	R1,R13
    04549 F00C      BLT	0x454B
    0454A C0F7      RJMP	0x4642
    0454B 0106      MOVW	R0,R12
    0454C 8E19      STD	Y+25,R1
    0454D 8E08      STD	Y+24,R0
    0454E C0F3      RJMP	0x4642
    0454F A58A      LDD	R24,Y+42
    04550 A59B      LDD	R25,Y+43
    04551 9602      ADIW	R24,2
    04552 A79B      STD	Y+43,R25
    04553 A78A      STD	Y+42,R24
    04554 01FC      MOVW	R30,R24
    04555 9732      SBIW	R30,2
    04556 8020      LD	R2,Z
    04557 8031      LDD	R3,Z+1
    04558 862A      STD	Y+10,R2
    04559 E081      LDI	R24,1
    0455A E090      LDI	R25,0
    0455B 880C      LDD	R0,Y+20
    0455C 881D      LDD	R1,Y+21
    0455D 1580      CP	R24,R0
    0455E 0591      CPC	R25,R1
    0455F F444      BGE	0x4568
    04560 8E19      STD	Y+25,R1
    04561 8E08      STD	Y+24,R0
    04562 2422      CLR	R2
    04563 862B      STD	Y+11,R2
    04564 01CE      MOVW	R24,R28
    04565 960A      ADIW	R24,0xA
    04566 017C      MOVW	R14,R24
    04567 C0DA      RJMP	0x4642
    04568 850A      LDD	R16,Y+10
    04569 A1EE      LDD	R30,Y+38
    0456A A1FF      LDD	R31,Y+39
    0456B 940E 4910 CALL	xicallx
    0456D 898E      LDD	R24,Y+22
    0456E 899F      LDD	R25,Y+23
    0456F 9601      ADIW	R24,1
    04570 8B9F      STD	Y+23,R25
    04571 8B8E      STD	Y+22,R24
    04572 C1D5      RJMP	0x4748
    04573 A58A      LDD	R24,Y+42
    04574 A59B      LDD	R25,Y+43
    04575 9602      ADIW	R24,2
    04576 A79B      STD	Y+43,R25
    04577 A78A      STD	Y+42,R24
    04578 01FC      MOVW	R30,R24
    04579 9732      SBIW	R30,2
    0457A 80C0      LD	R12,Z
    0457B 80D1      LDD	R13,Z+1
    0457C 8D88      LDD	R24,Y+24
    0457D 8D99      LDD	R25,Y+25
    0457E 3F8F      CPI	R24,0xFF
    0457F EFEF      LDI	R30,0xFF
    04580 079E      CPC	R25,R30
    04581 F421      BNE	0x4586
    04582 2400      CLR	R0
    04583 2411      CLR	R1
    04584 8E19      STD	Y+25,R1
    04585 8E08      STD	Y+24,R0
    04586 880C      LDD	R0,Y+20
    04587 881D      LDD	R1,Y+21
    04588 2000      TST	R0
    04589 F411      BNE	0x458C
    0458A 2011      TST	R1
    0458B F051      BEQ	0x4596
    0458C 0186      MOVW	R16,R12
    0458D 940E 4C59 CALL	_cstrlen
    0458F 01A8      MOVW	R20,R16
    04590 882C      LDD	R2,Y+20
    04591 883D      LDD	R3,Y+21
    04592 1A20      SUB	R2,R16
    04593 0A31      SBC	R3,R17
    04594 8A3D      STD	Y+21,R3
    04595 8A2C      STD	Y+20,R2
    04596 8C08      LDD	R0,Y+24
    04597 8C19      LDD	R1,Y+25
    04598 2000      TST	R0
    04599 F441      BNE	0x45A2
    0459A 2011      TST	R1
    0459B F431      BNE	0x45A2
    0459C 0186      MOVW	R16,R12
    0459D 940E 4C59 CALL	_cstrlen
    0459F 01A8      MOVW	R20,R16
    045A0 8F59      STD	Y+25,R21
    045A1 8F48      STD	Y+24,R20
    045A2 880C      LDD	R0,Y+20
    045A3 881D      LDD	R1,Y+21
    045A4 2000      TST	R0
    045A5 F411      BNE	0x45A8
    045A6 2011      TST	R1
    045A7 F031      BEQ	0x45AE
    045A8 FEA3      SBRS	R10,3
    045A9 C004      RJMP	0x45AE
    045AA 01C0      MOVW	R24,R0
    045AB 9701      SBIW	R24,1
    045AC 8B9D      STD	Y+21,R25
    045AD 8B8C      STD	Y+20,R24
    045AE FEA4      SBRS	R10,4
    045AF C026      RJMP	0x45D6
    045B0 FEA3      SBRS	R10,3
    045B1 C00A      RJMP	0x45BC
    045B2 2F06      MOV	R16,R22
    045B3 A1EE      LDD	R30,Y+38
    045B4 A1FF      LDD	R31,Y+39
    045B5 940E 4910 CALL	xicallx
    045B7 898E      LDD	R24,Y+22
    045B8 899F      LDD	R25,Y+23
    045B9 9601      ADIW	R24,1
    045BA 8B9F      STD	Y+23,R25
    045BB 8B8E      STD	Y+22,R24
    045BC FCA2      SBRC	R10,2
    045BD C04C      RJMP	0x460A
    045BE C00F      RJMP	0x45CE
    045BF E300      LDI	R16,0x30
    045C0 A1EE      LDD	R30,Y+38
    045C1 A1FF      LDD	R31,Y+39
    045C2 940E 4910 CALL	xicallx
    045C4 898E      LDD	R24,Y+22
    045C5 899F      LDD	R25,Y+23
    045C6 9601      ADIW	R24,1
    045C7 8B9F      STD	Y+23,R25
    045C8 8B8E      STD	Y+22,R24
    045C9 898C      LDD	R24,Y+20
    045CA 899D      LDD	R25,Y+21
    045CB 9701      SBIW	R24,1
    045CC 8B9D      STD	Y+21,R25
    045CD 8B8C      STD	Y+20,R24
    045CE 2422      CLR	R2
    045CF 2433      CLR	R3
    045D0 880C      LDD	R0,Y+20
    045D1 881D      LDD	R1,Y+21
    045D2 1420      CP	R2,R0
    045D3 0431      CPC	R3,R1
    045D4 F354      BLT	0x45BF
    045D5 C034      RJMP	0x460A
    045D6 FCA2      SBRC	R10,2
    045D7 C017      RJMP	0x45EF
    045D8 C00F      RJMP	0x45E8
    045D9 E200      LDI	R16,0x20
    045DA A1EE      LDD	R30,Y+38
    045DB A1FF      LDD	R31,Y+39
    045DC 940E 4910 CALL	xicallx
    045DE 898E      LDD	R24,Y+22
    045DF 899F      LDD	R25,Y+23
    045E0 9601      ADIW	R24,1
    045E1 8B9F      STD	Y+23,R25
    045E2 8B8E      STD	Y+22,R24
    045E3 898C      LDD	R24,Y+20
    045E4 899D      LDD	R25,Y+21
    045E5 9701      SBIW	R24,1
    045E6 8B9D      STD	Y+21,R25
    045E7 8B8C      STD	Y+20,R24
    045E8 2422      CLR	R2
    045E9 2433      CLR	R3
    045EA 880C      LDD	R0,Y+20
    045EB 881D      LDD	R1,Y+21
    045EC 1420      CP	R2,R0
    045ED 0431      CPC	R3,R1
    045EE F354      BLT	0x45D9
    045EF FEA3      SBRS	R10,3
    045F0 C019      RJMP	0x460A
    045F1 2F06      MOV	R16,R22
    045F2 A1EE      LDD	R30,Y+38
    045F3 A1FF      LDD	R31,Y+39
    045F4 940E 4910 CALL	xicallx
    045F6 898E      LDD	R24,Y+22
    045F7 899F      LDD	R25,Y+23
    045F8 9601      ADIW	R24,1
    045F9 8B9F      STD	Y+23,R25
    045FA 8B8E      STD	Y+22,R24
    045FB C00E      RJMP	0x460A
    045FC 01F6      MOVW	R30,R12
    045FD 9106      ELPM	R16,Z
    045FE A1EE      LDD	R30,Y+38
    045FF A1FF      LDD	R31,Y+39
    04600 940E 4910 CALL	xicallx
    04602 898E      LDD	R24,Y+22
    04603 899F      LDD	R25,Y+23
    04604 9601      ADIW	R24,1
    04605 8B9F      STD	Y+23,R25
    04606 8B8E      STD	Y+22,R24
    04607 01C6      MOVW	R24,R12
    04608 9601      ADIW	R24,1
    04609 016C      MOVW	R12,R24
    0460A 01F6      MOVW	R30,R12
    0460B 9026      ELPM	R2,Z
    0460C 2022      TST	R2
    0460D F049      BEQ	0x4617
    0460E 8D48      LDD	R20,Y+24
    0460F 8D59      LDD	R21,Y+25
    04610 01CA      MOVW	R24,R20
    04611 9701      SBIW	R24,1
    04612 8F99      STD	Y+25,R25
    04613 8F88      STD	Y+24,R24
    04614 3040      CPI	R20,0
    04615 0745      CPC	R20,R21
    04616 F729      BNE	0x45FC
    04617 FEA2      SBRS	R10,2
    04618 C12F      RJMP	0x4748
    04619 C00F      RJMP	0x4629
    0461A E200      LDI	R16,0x20
    0461B A1EE      LDD	R30,Y+38
    0461C A1FF      LDD	R31,Y+39
    0461D 940E 4910 CALL	xicallx
    0461F 898E      LDD	R24,Y+22
    04620 899F      LDD	R25,Y+23
    04621 9601      ADIW	R24,1
    04622 8B9F      STD	Y+23,R25
    04623 8B8E      STD	Y+22,R24
    04624 898C      LDD	R24,Y+20
    04625 899D      LDD	R25,Y+21
    04626 9701      SBIW	R24,1
    04627 8B9D      STD	Y+21,R25
    04628 8B8C      STD	Y+20,R24
    04629 2422      CLR	R2
    0462A 2433      CLR	R3
    0462B 880C      LDD	R0,Y+20
    0462C 881D      LDD	R1,Y+21
    0462D 1420      CP	R2,R0
    0462E 0431      CPC	R3,R1
    0462F F354      BLT	0x461A
    04630 C117      RJMP	0x4748
    04631 A58A      LDD	R24,Y+42
    04632 A59B      LDD	R25,Y+43
    04633 9602      ADIW	R24,2
    04634 A79B      STD	Y+43,R25
    04635 A78A      STD	Y+42,R24
    04636 01FC      MOVW	R30,R24
    04637 9732      SBIW	R30,2
    04638 80E0      LD	R14,Z
    04639 80F1      LDD	R15,Z+1
    0463A 20EE      TST	R14
    0463B F431      BNE	0x4642
    0463C 20FF      TST	R15
    0463D F421      BNE	0x4642
    0463E EC8E      LDI	R24,0xCE
    0463F E090      LDI	R25,0
    04640 016C      MOVW	R12,R24
    04641 CF3A      RJMP	0x457C
    04642 8D88      LDD	R24,Y+24
    04643 8D99      LDD	R25,Y+25
    04644 3F8F      CPI	R24,0xFF
    04645 EFEF      LDI	R30,0xFF
    04646 079E      CPC	R25,R30
    04647 F421      BNE	0x464C
    04648 2400      CLR	R0
    04649 2411      CLR	R1
    0464A 8E19      STD	Y+25,R1
    0464B 8E08      STD	Y+24,R0
    0464C 880C      LDD	R0,Y+20
    0464D 881D      LDD	R1,Y+21
    0464E 2000      TST	R0
    0464F F411      BNE	0x4652
    04650 2011      TST	R1
    04651 F051      BEQ	0x465C
    04652 0187      MOVW	R16,R14
    04653 940E 4772 CALL	_strlen
    04655 0168      MOVW	R12,R16
    04656 882C      LDD	R2,Y+20
    04657 883D      LDD	R3,Y+21
    04658 1A20      SUB	R2,R16
    04659 0A31      SBC	R3,R17
    0465A 8A3D      STD	Y+21,R3
    0465B 8A2C      STD	Y+20,R2
    0465C 8C08      LDD	R0,Y+24
    0465D 8C19      LDD	R1,Y+25
    0465E 2000      TST	R0
    0465F F441      BNE	0x4668
    04660 2011      TST	R1
    04661 F431      BNE	0x4668
    04662 0187      MOVW	R16,R14
    04663 940E 4772 CALL	_strlen
    04665 0168      MOVW	R12,R16
    04666 8ED9      STD	Y+25,R13
    04667 8EC8      STD	Y+24,R12
    04668 880C      LDD	R0,Y+20
    04669 881D      LDD	R1,Y+21
    0466A 2000      TST	R0
    0466B F411      BNE	0x466E
    0466C 2011      TST	R1
    0466D F031      BEQ	0x4674
    0466E FEA3      SBRS	R10,3
    0466F C004      RJMP	0x4674
    04670 01C0      MOVW	R24,R0
    04671 9701      SBIW	R24,1
    04672 8B9D      STD	Y+21,R25
    04673 8B8C      STD	Y+20,R24
    04674 FEA4      SBRS	R10,4
    04675 C026      RJMP	0x469C
    04676 FEA3      SBRS	R10,3
    04677 C00A      RJMP	0x4682
    04678 2F06      MOV	R16,R22
    04679 A1EE      LDD	R30,Y+38
    0467A A1FF      LDD	R31,Y+39
    0467B 940E 4910 CALL	xicallx
    0467D 898E      LDD	R24,Y+22
    0467E 899F      LDD	R25,Y+23
    0467F 9601      ADIW	R24,1
    04680 8B9F      STD	Y+23,R25
    04681 8B8E      STD	Y+22,R24
    04682 FCA2      SBRC	R10,2
    04683 C04C      RJMP	0x46D0
    04684 C00F      RJMP	0x4694
    04685 E300      LDI	R16,0x30
    04686 A1EE      LDD	R30,Y+38
    04687 A1FF      LDD	R31,Y+39
    04688 940E 4910 CALL	xicallx
    0468A 898E      LDD	R24,Y+22
    0468B 899F      LDD	R25,Y+23
    0468C 9601      ADIW	R24,1
    0468D 8B9F      STD	Y+23,R25
    0468E 8B8E      STD	Y+22,R24
    0468F 898C      LDD	R24,Y+20
    04690 899D      LDD	R25,Y+21
    04691 9701      SBIW	R24,1
    04692 8B9D      STD	Y+21,R25
    04693 8B8C      STD	Y+20,R24
    04694 2422      CLR	R2
    04695 2433      CLR	R3
    04696 880C      LDD	R0,Y+20
    04697 881D      LDD	R1,Y+21
    04698 1420      CP	R2,R0
    04699 0431      CPC	R3,R1
    0469A F354      BLT	0x4685
    0469B C034      RJMP	0x46D0
    0469C FCA2      SBRC	R10,2
    0469D C017      RJMP	0x46B5
    0469E C00F      RJMP	0x46AE
    0469F E200      LDI	R16,0x20
    046A0 A1EE      LDD	R30,Y+38
    046A1 A1FF      LDD	R31,Y+39
    046A2 940E 4910 CALL	xicallx
    046A4 898E      LDD	R24,Y+22
    046A5 899F      LDD	R25,Y+23
    046A6 9601      ADIW	R24,1
    046A7 8B9F      STD	Y+23,R25
    046A8 8B8E      STD	Y+22,R24
    046A9 898C      LDD	R24,Y+20
    046AA 899D      LDD	R25,Y+21
    046AB 9701      SBIW	R24,1
    046AC 8B9D      STD	Y+21,R25
    046AD 8B8C      STD	Y+20,R24
    046AE 2422      CLR	R2
    046AF 2433      CLR	R3
    046B0 880C      LDD	R0,Y+20
    046B1 881D      LDD	R1,Y+21
    046B2 1420      CP	R2,R0
    046B3 0431      CPC	R3,R1
    046B4 F354      BLT	0x469F
    046B5 FEA3      SBRS	R10,3
    046B6 C019      RJMP	0x46D0
    046B7 2F06      MOV	R16,R22
    046B8 A1EE      LDD	R30,Y+38
    046B9 A1FF      LDD	R31,Y+39
    046BA 940E 4910 CALL	xicallx
    046BC 898E      LDD	R24,Y+22
    046BD 899F      LDD	R25,Y+23
    046BE 9601      ADIW	R24,1
    046BF 8B9F      STD	Y+23,R25
    046C0 8B8E      STD	Y+22,R24
    046C1 C00E      RJMP	0x46D0
    046C2 01F7      MOVW	R30,R14
    046C3 8100      LD	R16,Z
    046C4 A1EE      LDD	R30,Y+38
    046C5 A1FF      LDD	R31,Y+39
    046C6 940E 4910 CALL	xicallx
    046C8 898E      LDD	R24,Y+22
    046C9 899F      LDD	R25,Y+23
    046CA 9601      ADIW	R24,1
    046CB 8B9F      STD	Y+23,R25
    046CC 8B8E      STD	Y+22,R24
    046CD 01C7      MOVW	R24,R14
    046CE 9601      ADIW	R24,1
    046CF 017C      MOVW	R14,R24
    046D0 01F7      MOVW	R30,R14
    046D1 8020      LD	R2,Z
    046D2 2022      TST	R2
    046D3 F049      BEQ	0x46DD
    046D4 8D68      LDD	R22,Y+24
    046D5 8D79      LDD	R23,Y+25
    046D6 01CB      MOVW	R24,R22
    046D7 9701      SBIW	R24,1
    046D8 8F99      STD	Y+25,R25
    046D9 8F88      STD	Y+24,R24
    046DA 3060      CPI	R22,0
    046DB 0767      CPC	R22,R23
    046DC F729      BNE	0x46C2
    046DD FEA2      SBRS	R10,2
    046DE C069      RJMP	0x4748
    046DF C00F      RJMP	0x46EF
    046E0 E200      LDI	R16,0x20
    046E1 A1EE      LDD	R30,Y+38
    046E2 A1FF      LDD	R31,Y+39
    046E3 940E 4910 CALL	xicallx
    046E5 898E      LDD	R24,Y+22
    046E6 899F      LDD	R25,Y+23
    046E7 9601      ADIW	R24,1
    046E8 8B9F      STD	Y+23,R25
    046E9 8B8E      STD	Y+22,R24
    046EA 898C      LDD	R24,Y+20
    046EB 899D      LDD	R25,Y+21
    046EC 9701      SBIW	R24,1
    046ED 8B9D      STD	Y+21,R25
    046EE 8B8C      STD	Y+20,R24
    046EF 2422      CLR	R2
    046F0 2433      CLR	R3
    046F1 880C      LDD	R0,Y+20
    046F2 881D      LDD	R1,Y+21
    046F3 1420      CP	R2,R0
    046F4 0431      CPC	R3,R1
    046F5 F354      BLT	0x46E0
    046F6 C051      RJMP	0x4748
    046F7 E061      LDI	R22,1
    046F8 E070      LDI	R23,0
    046F9 C00B      RJMP	0x4705
    046FA E062      LDI	R22,2
    046FB E070      LDI	R23,0
    046FC C008      RJMP	0x4705
    046FD 2766      CLR	R22
    046FE 2777      CLR	R23
    046FF C005      RJMP	0x4705
    04700 E063      LDI	R22,3
    04701 E070      LDI	R23,0
    04702 C002      RJMP	0x4705
    04703 E064      LDI	R22,4
    04704 E070      LDI	R23,0
    04705 A58A      LDD	R24,Y+42
    04706 A59B      LDD	R25,Y+43
    04707 9604      ADIW	R24,4
    04708 A79B      STD	Y+43,R25
    04709 A78A      STD	Y+42,R24
    0470A 01FC      MOVW	R30,R24
    0470B 9734      SBIW	R30,4
    0470C 8020      LD	R2,Z
    0470D 8031      LDD	R3,Z+1
    0470E 8042      LDD	R4,Z+2
    0470F 8053      LDD	R5,Z+3
    04710 8A28      STD	Y+16,R2
    04711 8A39      STD	Y+17,R3
    04712 8A4A      STD	Y+18,R4
    04713 8A5B      STD	Y+19,R5
    04714 8D88      LDD	R24,Y+24
    04715 8D99      LDD	R25,Y+25
    04716 3F8F      CPI	R24,0xFF
    04717 EFEF      LDI	R30,0xFF
    04718 079E      CPC	R25,R30
    04719 F421      BNE	0x471E
    0471A E086      LDI	R24,6
    0471B E090      LDI	R25,0
    0471C 8F99      STD	Y+25,R25
    0471D 8F88      STD	Y+24,R24
    0471E 8C08      LDD	R0,Y+24
    0471F 8C19      LDD	R1,Y+25
    04720 8619      STD	Y+9,R1
    04721 8608      STD	Y+8,R0
    04722 880C      LDD	R0,Y+20
    04723 881D      LDD	R1,Y+21
    04724 821F      STD	Y+7,R1
    04725 820E      STD	Y+6,R0
    04726 82BD      STD	Y+5,R11
    04727 82AC      STD	Y+4,R10
    04728 8828      LDD	R2,Y+16
    04729 8839      LDD	R3,Y+17
    0472A 884A      LDD	R4,Y+18
    0472B 885B      LDD	R5,Y+19
    0472C 8228      ST	Y,R2
    0472D 8239      STD	Y+1,R3
    0472E 824A      STD	Y+2,R4
    0472F 825B      STD	Y+3,R5
    04730 019B      MOVW	R18,R22
    04731 EB0E      LDI	R16,0xBE
    04732 E018      LDI	R17,0x8
    04733 940E 5084 CALL	__FormatFP_1
    04735 01B8      MOVW	R22,R16
    04736 017B      MOVW	R14,R22
    04737 C00C      RJMP	0x4744
    04738 01F7      MOVW	R30,R14
    04739 9101      LD	R16,Z+
    0473A 017F      MOVW	R14,R30
    0473B A1EE      LDD	R30,Y+38
    0473C A1FF      LDD	R31,Y+39
    0473D 940E 4910 CALL	xicallx
    0473F 898E      LDD	R24,Y+22
    04740 899F      LDD	R25,Y+23
    04741 9601      ADIW	R24,1
    04742 8B9F      STD	Y+23,R25
    04743 8B8E      STD	Y+22,R24
    04744 01F7      MOVW	R30,R14
    04745 8020      LD	R2,Z
    04746 2022      TST	R2
    04747 F781      BNE	0x4738
    04748 A588      LDD	R24,Y+40
    04749 A599      LDD	R25,Y+41
    0474A 9601      ADIW	R24,1
    0474B A799      STD	Y+41,R25
    0474C A788      STD	Y+40,R24
    0474D A5E8      LDD	R30,Y+40
    0474E A5F9      LDD	R31,Y+41
    0474F 8020      LD	R2,Z
    04750 2022      TST	R2
    04751 F009      BEQ	0x4753
    04752 CBA4      RJMP	0x42F7
    04753 890E      LDD	R16,Y+22
    04754 891F      LDD	R17,Y+23
    04755 966C      ADIW	R28,0x1C
    04756 940E 48B8 CALL	pop_xgsetF0FC
    04758 9624      ADIW	R28,4
    04759 9508      RET
_memset:
    0475A 8188      LD	R24,Y
    0475B 8199      LDD	R25,Y+1
    0475C 3080      CPI	R24,0
    0475D 0789      CPC	R24,R25
    0475E F029      BEQ	0x4764
    0475F 2FE0      MOV	R30,R16
    04760 2FF1      MOV	R31,R17
    04761 9321      ST	Z+,R18
    04762 9701      SBIW	R24,1
    04763 F7E9      BNE	0x4761
    04764 9508      RET
_strcat:
    04765 2FA0      MOV	R26,R16
    04766 2FB1      MOV	R27,R17
    04767 2FE2      MOV	R30,R18
    04768 2FF3      MOV	R31,R19
    04769 912D      LD	R18,X+
    0476A 2322      TST	R18
    0476B F7E9      BNE	0x4769
    0476C 9711      SBIW	R26,1
    0476D 9121      LD	R18,Z+
    0476E 932D      ST	X+,R18
    0476F 2322      TST	R18
    04770 F7E1      BNE	0x476D
    04771 9508      RET
_strlen:
    04772 2FE0      MOV	R30,R16
    04773 2FF1      MOV	R31,R17
    04774 27AA      CLR	R26
    04775 27BB      CLR	R27
    04776 9001      LD	R0,Z+
    04777 2000      TST	R0
    04778 F011      BEQ	0x477B
    04779 9611      ADIW	R26,1
    0477A CFFB      RJMP	0x4776
    0477B 2F0A      MOV	R16,R26
    0477C 2F1B      MOV	R17,R27
    0477D 9508      RET
push_arg4:
    0477E 933A      ST	-Y,R19
    0477F 932A      ST	-Y,R18
push_arg2:
    04780 931A      ST	-Y,R17
    04781 930A      ST	-Y,R16
    04782 9508      RET
asr32:
    04783 920F      PUSH	R0
    04784 9009      LD	R0,Y+
    04785 2000      TST	R0
    04786 F031      BEQ	0x478D
    04787 9535      ASR	R19
    04788 9527      ROR	R18
    04789 9517      ROR	R17
    0478A 9507      ROR	R16
    0478B 940A      DEC	R0
    0478C CFF8      RJMP	0x4785
    0478D 900F      POP	R0
    0478E 9508      RET
mod16s:
    0478F 9468      BSET	6
    04790 92DA      ST	-Y,R13
    04791 2ED1      MOV	R13,R17
    04792 C004      RJMP	0x4797
div16s:
    04793 94E8      BCLR	6
    04794 92DA      ST	-Y,R13
    04795 2ED1      MOV	R13,R17
    04796 26D3      EOR	R13,R19
    04797 FF17      SBRS	R17,7
    04798 C004      RJMP	0x479D
    04799 9510      COM	R17
    0479A 9500      COM	R16
    0479B 5F0F      SUBI	R16,0xFF
    0479C 4F1F      SBCI	R17,0xFF
    0479D FF37      SBRS	R19,7
    0479E C004      RJMP	0x47A3
    0479F 9530      COM	R19
    047A0 9520      COM	R18
    047A1 5F2F      SUBI	R18,0xFF
    047A2 4F3F      SBCI	R19,0xFF
    047A3 940E 47B0 CALL	xdiv16u
    047A5 FED7      SBRS	R13,7
    047A6 C004      RJMP	0x47AB
    047A7 9510      COM	R17
    047A8 9500      COM	R16
    047A9 5F0F      SUBI	R16,0xFF
    047AA 4F1F      SBCI	R17,0xFF
    047AB 90D9      LD	R13,Y+
    047AC 9508      RET
mod16u:
    047AD 9468      BSET	6
    047AE C001      RJMP	xdiv16u
div16u:
    047AF 94E8      BCLR	6
xdiv16u:
    047B0 92EA      ST	-Y,R14
    047B1 92FA      ST	-Y,R15
    047B2 938A      ST	-Y,R24
    047B3 24EE      CLR	R14
    047B4 24FF      CLR	R15
    047B5 E180      LDI	R24,0x10
    047B6 0F00      LSL	R16
    047B7 1F11      ROL	R17
    047B8 1CEE      ROL	R14
    047B9 1CFF      ROL	R15
    047BA 16E2      CP	R14,R18
    047BB 06F3      CPC	R15,R19
    047BC F018      BCS	0x47C0
    047BD 1AE2      SUB	R14,R18
    047BE 0AF3      SBC	R15,R19
    047BF 9503      INC	R16
    047C0 958A      DEC	R24
    047C1 F7A1      BNE	0x47B6
    047C2 F416      BRTC	0x47C5
    047C3 2D0E      MOV	R16,R14
    047C4 2D1F      MOV	R17,R15
    047C5 9189      LD	R24,Y+
    047C6 90F9      LD	R15,Y+
    047C7 90E9      LD	R14,Y+
    047C8 9508      RET
div32u:
    047C9 94E8      BCLR	6
    047CA C001      RJMP	0x47CC
mod32u:
    047CB 9468      BSET	6
    047CC D030      RCALL	long_div_prolog
    047CD 24CC      CLR	R12
    047CE C009      RJMP	0x47D8
div32s:
    047CF 94E8      BCLR	6
    047D0 C001      RJMP	0x47D2
mod32s:
    047D1 9468      BSET	6
    047D2 D02A      RCALL	long_div_prolog
    047D3 FD37      SBRC	R19,7
    047D4 940E 4919 CALL	neg32
    047D6 FDB7      SBRC	R27,7
    047D7 D052      RCALL	neg_R24_R27
    047D8 2477      CLR	R7
    047D9 2488      CLR	R8
    047DA 2499      CLR	R9
    047DB 24AA      CLR	R10
    047DC 24BB      CLR	R11
    047DD D042      RCALL	tst_R16_R19
    047DE F0C1      BEQ	0x47F7
    047DF D045      RCALL	tst_R24_R27
    047E0 F0B1      BEQ	0x47F7
    047E1 E2E8      LDI	R30,0x28
    047E2 0F00      LSL	R16
    047E3 1F11      ROL	R17
    047E4 1F22      ROL	R18
    047E5 1F33      ROL	R19
    047E6 1C77      ROL	R7
    047E7 1C88      ROL	R8
    047E8 1C99      ROL	R9
    047E9 1CAA      ROL	R10
    047EA 1CBB      ROL	R11
    047EB 1688      CP	R8,R24
    047EC 0699      CPC	R9,R25
    047ED 06AA      CPC	R10,R26
    047EE 06BB      CPC	R11,R27
    047EF F028      BCS	0x47F5
    047F0 1A88      SUB	R8,R24
    047F1 0A99      SBC	R9,R25
    047F2 0AAA      SBC	R10,R26
    047F3 0ABB      SBC	R11,R27
    047F4 9503      INC	R16
    047F5 95EA      DEC	R30
    047F6 F759      BNE	0x47E2
    047F7 F426      BRTC	0x47FC
    047F8 2D08      MOV	R16,R8
    047F9 2D19      MOV	R17,R9
    047FA 2D2A      MOV	R18,R10
    047FB 2D3B      MOV	R19,R11
    047FC C013      RJMP	long_div_epilog
long_div_prolog:
    047FD 927A      ST	-Y,R7
    047FE 928A      ST	-Y,R8
    047FF 929A      ST	-Y,R9
    04800 92AA      ST	-Y,R10
    04801 92BA      ST	-Y,R11
    04802 92CA      ST	-Y,R12
    04803 93EA      ST	-Y,R30
    04804 938A      ST	-Y,R24
    04805 939A      ST	-Y,R25
    04806 93AA      ST	-Y,R26
    04807 93BA      ST	-Y,R27
    04808 858B      LDD	R24,Y+11
    04809 859C      LDD	R25,Y+12
    0480A 85AD      LDD	R26,Y+13
    0480B 85BE      LDD	R27,Y+14
    0480C 2EC3      MOV	R12,R19
    0480D F00E      BRTS	0x480F
    0480E 26CB      EOR	R12,R27
    0480F 9508      RET
long_div_epilog:
    04810 FCC7      SBRC	R12,7
    04811 940E 4919 CALL	neg32
    04813 91B9      LD	R27,Y+
    04814 91A9      LD	R26,Y+
    04815 9199      LD	R25,Y+
    04816 9189      LD	R24,Y+
    04817 91E9      LD	R30,Y+
    04818 90C9      LD	R12,Y+
    04819 90B9      LD	R11,Y+
    0481A 90A9      LD	R10,Y+
    0481B 9099      LD	R9,Y+
    0481C 9089      LD	R8,Y+
    0481D 9079      LD	R7,Y+
    0481E 9624      ADIW	R28,4
    0481F 9508      RET
tst_R16_R19:
    04820 2FE0      MOV	R30,R16
    04821 2BE1      OR	R30,R17
    04822 2BE2      OR	R30,R18
    04823 2BE3      OR	R30,R19
    04824 9508      RET
tst_R24_R27:
    04825 2FE8      MOV	R30,R24
    04826 2BE9      OR	R30,R25
    04827 2BEA      OR	R30,R26
    04828 2BEB      OR	R30,R27
    04829 9508      RET
neg_R24_R27:
    0482A 9580      COM	R24
    0482B 9590      COM	R25
    0482C 95A0      COM	R26
    0482D 95B0      COM	R27
    0482E 5F8F      SUBI	R24,0xFF
    0482F 4F9F      SBCI	R25,0xFF
    04830 4FAF      SBCI	R26,0xFF
    04831 4FBF      SBCI	R27,0xFF
    04832 9508      RET
mod8u:
    04833 9468      BSET	6
    04834 C001      RJMP	xdiv8u
div8u:
    04835 94E8      BCLR	6
xdiv8u:
    04836 932A      ST	-Y,R18
    04837 92FA      ST	-Y,R15
    04838 92EA      ST	-Y,R14
    04839 24FF      CLR	R15
    0483A 24EE      CLR	R14
    0483B E120      LDI	R18,0x10
    0483C 0F00      LSL	R16
    0483D 1CFF      ROL	R15
    0483E 1CEE      ROL	R14
    0483F 16E1      CP	R14,R17
    04840 F010      BCS	0x4843
    04841 1AE1      SUB	R14,R17
    04842 9503      INC	R16
    04843 952A      DEC	R18
    04844 F7B9      BNE	0x483C
    04845 F40E      BRTC	0x4847
    04846 2D0E      MOV	R16,R14
    04847 90E9      LD	R14,Y+
    04848 90F9      LD	R15,Y+
    04849 9129      LD	R18,Y+
    0484A 9508      RET
elpm32:
    0484B 93EA      ST	-Y,R30
    0484C 93FA      ST	-Y,R31
    0484D 920A      ST	-Y,R0
    0484E 2FE0      MOV	R30,R16
    0484F 2FF1      MOV	R31,R17
    04850 95D8      ELPM
    04851 2D00      MOV	R16,R0
    04852 9631      ADIW	R30,1
    04853 95D8      ELPM
    04854 2D10      MOV	R17,R0
    04855 9631      ADIW	R30,1
    04856 95D8      ELPM
    04857 2D20      MOV	R18,R0
    04858 9631      ADIW	R30,1
    04859 95D8      ELPM
    0485A 2D30      MOV	R19,R0
    0485B 9009      LD	R0,Y+
    0485C 91F9      LD	R31,Y+
    0485D 91E9      LD	R30,Y+
    0485E 9508      RET
empy16s:
    0485F 920A      ST	-Y,R0
    04860 921A      ST	-Y,R1
    04861 938A      ST	-Y,R24
    04862 939A      ST	-Y,R25
    04863 9F02      MUL	R16,R18
    04864 01C0      MOVW	R24,R0
    04865 9F12      MUL	R17,R18
    04866 0D90      ADD	R25,R0
    04867 9F03      MUL	R16,R19
    04868 0D90      ADD	R25,R0
    04869 018C      MOVW	R16,R24
    0486A 9199      LD	R25,Y+
    0486B 9189      LD	R24,Y+
    0486C 9019      LD	R1,Y+
    0486D 9009      LD	R0,Y+
    0486E 9508      RET
empy32u|empy32s:
    0486F 940E 4922 CALL	long_prolog
    04871 927A      ST	-Y,R7
    04872 940E 493B CALL	tstzero1
    04874 F159      BEQ	0x48A0
    04875 2477      CLR	R7
    04876 940E 4941 CALL	tstzero2
    04878 F419      BNE	0x487C
    04879 018C      MOVW	R16,R24
    0487A 019D      MOVW	R18,R26
    0487B C024      RJMP	0x48A0
    0487C 920A      ST	-Y,R0
    0487D 921A      ST	-Y,R1
    0487E 9F08      MUL	R16,R24
    0487F 2CB0      MOV	R11,R0
    04880 2CA1      MOV	R10,R1
    04881 9F28      MUL	R18,R24
    04882 2C90      MOV	R9,R0
    04883 2C81      MOV	R8,R1
    04884 9F18      MUL	R17,R24
    04885 0CA0      ADD	R10,R0
    04886 1C91      ADC	R9,R1
    04887 1C87      ADC	R8,R7
    04888 9F09      MUL	R16,R25
    04889 0CA0      ADD	R10,R0
    0488A 1C91      ADC	R9,R1
    0488B 1C87      ADC	R8,R7
    0488C 9F19      MUL	R17,R25
    0488D 0C90      ADD	R9,R0
    0488E 1C81      ADC	R8,R1
    0488F 9F0A      MUL	R16,R26
    04890 0C90      ADD	R9,R0
    04891 1C81      ADC	R8,R1
    04892 9F38      MUL	R19,R24
    04893 0C80      ADD	R8,R0
    04894 9F29      MUL	R18,R25
    04895 0C80      ADD	R8,R0
    04896 9F1A      MUL	R17,R26
    04897 0C80      ADD	R8,R0
    04898 9F0B      MUL	R16,R27
    04899 0C80      ADD	R8,R0
    0489A 9019      LD	R1,Y+
    0489B 9009      LD	R0,Y+
    0489C 2D0B      MOV	R16,R11
    0489D 2D1A      MOV	R17,R10
    0489E 2D29      MOV	R18,R9
    0489F 2D38      MOV	R19,R8
    048A0 9079      LD	R7,Y+
    048A1 940C 4930 JMP	long_epilog
pop_xgset003C:
    048A3 90A9      LD	R10,Y+
    048A4 90B9      LD	R11,Y+
    048A5 90C9      LD	R12,Y+
    048A6 90D9      LD	R13,Y+
    048A7 9508      RET
pop_xgset00FC:
    048A8 90A9      LD	R10,Y+
    048A9 90B9      LD	R11,Y+
    048AA 90C9      LD	R12,Y+
    048AB 90D9      LD	R13,Y+
    048AC 90E9      LD	R14,Y+
    048AD 90F9      LD	R15,Y+
    048AE 9508      RET
pop_xgset30FC:
    048AF 90A9      LD	R10,Y+
    048B0 90B9      LD	R11,Y+
    048B1 90C9      LD	R12,Y+
    048B2 90D9      LD	R13,Y+
    048B3 90E9      LD	R14,Y+
    048B4 90F9      LD	R15,Y+
    048B5 9149      LD	R20,Y+
    048B6 9159      LD	R21,Y+
    048B7 9508      RET
pop_xgsetF0FC:
    048B8 90A9      LD	R10,Y+
    048B9 90B9      LD	R11,Y+
    048BA 90C9      LD	R12,Y+
    048BB 90D9      LD	R13,Y+
    048BC 90E9      LD	R14,Y+
    048BD 90F9      LD	R15,Y+
    048BE 9149      LD	R20,Y+
    048BF 9159      LD	R21,Y+
    048C0 9169      LD	R22,Y+
    048C1 9179      LD	R23,Y+
    048C2 9508      RET
push_xgsetF0FC:
    048C3 937A      ST	-Y,R23
    048C4 936A      ST	-Y,R22
push_xgset30FC:
    048C5 935A      ST	-Y,R21
    048C6 934A      ST	-Y,R20
push_xgset00FC:
    048C7 92FA      ST	-Y,R15
    048C8 92EA      ST	-Y,R14
push_xgset003C:
    048C9 92DA      ST	-Y,R13
    048CA 92CA      ST	-Y,R12
    048CB 92BA      ST	-Y,R11
    048CC 92AA      ST	-Y,R10
    048CD 9508      RET
push_xgset300C:
    048CE 935A      ST	-Y,R21
    048CF 934A      ST	-Y,R20
    048D0 92BA      ST	-Y,R11
    048D1 92AA      ST	-Y,R10
    048D2 9508      RET
pop_xgset300C:
    048D3 90A9      LD	R10,Y+
    048D4 90B9      LD	R11,Y+
    048D5 9149      LD	R20,Y+
    048D6 9159      LD	R21,Y+
    048D7 9508      RET
push_xgsetF000:
    048D8 937A      ST	-Y,R23
    048D9 936A      ST	-Y,R22
    048DA 935A      ST	-Y,R21
    048DB 934A      ST	-Y,R20
    048DC 9508      RET
pop_xgsetF000:
    048DD 9149      LD	R20,Y+
    048DE 9159      LD	R21,Y+
    048DF 9169      LD	R22,Y+
    048E0 9179      LD	R23,Y+
    048E1 9508      RET
push_xgsetF00C:
    048E2 937A      ST	-Y,R23
    048E3 936A      ST	-Y,R22
    048E4 935A      ST	-Y,R21
    048E5 934A      ST	-Y,R20
    048E6 92BA      ST	-Y,R11
    048E7 92AA      ST	-Y,R10
    048E8 9508      RET
pop_xgsetF00C:
    048E9 90A9      LD	R10,Y+
    048EA 90B9      LD	R11,Y+
    048EB 9149      LD	R20,Y+
    048EC 9159      LD	R21,Y+
    048ED 9169      LD	R22,Y+
    048EE 9179      LD	R23,Y+
    048EF 9508      RET
push_xgset303C:
    048F0 935A      ST	-Y,R21
    048F1 934A      ST	-Y,R20
    048F2 92DA      ST	-Y,R13
    048F3 92CA      ST	-Y,R12
    048F4 92BA      ST	-Y,R11
    048F5 92AA      ST	-Y,R10
    048F6 9508      RET
pop_xgset303C:
    048F7 90A9      LD	R10,Y+
    048F8 90B9      LD	R11,Y+
    048F9 90C9      LD	R12,Y+
    048FA 90D9      LD	R13,Y+
    048FB 9149      LD	R20,Y+
    048FC 9159      LD	R21,Y+
    048FD 9508      RET
push_xgsetF03C:
    048FE 937A      ST	-Y,R23
    048FF 936A      ST	-Y,R22
    04900 935A      ST	-Y,R21
    04901 934A      ST	-Y,R20
    04902 92DA      ST	-Y,R13
    04903 92CA      ST	-Y,R12
    04904 92BA      ST	-Y,R11
    04905 92AA      ST	-Y,R10
    04906 9508      RET
pop_xgsetF03C:
    04907 90A9      LD	R10,Y+
    04908 90B9      LD	R11,Y+
    04909 90C9      LD	R12,Y+
    0490A 90D9      LD	R13,Y+
    0490B 9149      LD	R20,Y+
    0490C 9159      LD	R21,Y+
    0490D 9169      LD	R22,Y+
    0490E 9179      LD	R23,Y+
    0490F 9508      RET
xicallx:
    04910 920A      ST	-Y,R0
    04911 95D8      ELPM
    04912 920A      ST	-Y,R0
    04913 9631      ADIW	R30,1
    04914 95D8      ELPM
    04915 2DF0      MOV	R31,R0
    04916 91E9      LD	R30,Y+
    04917 9009      LD	R0,Y+
    04918 9409      IJMP
neg32:
    04919 9500      COM	R16
    0491A 9510      COM	R17
    0491B 9520      COM	R18
    0491C 9530      COM	R19
    0491D 5F0F      SUBI	R16,0xFF
    0491E 4F1F      SBCI	R17,0xFF
    0491F 4F2F      SBCI	R18,0xFF
    04920 4F3F      SBCI	R19,0xFF
    04921 9508      RET
long_prolog:
    04922 928A      ST	-Y,R8
    04923 929A      ST	-Y,R9
    04924 92AA      ST	-Y,R10
    04925 92BA      ST	-Y,R11
    04926 93EA      ST	-Y,R30
    04927 938A      ST	-Y,R24
    04928 939A      ST	-Y,R25
    04929 93AA      ST	-Y,R26
    0492A 93BA      ST	-Y,R27
    0492B 8589      LDD	R24,Y+9
    0492C 859A      LDD	R25,Y+10
    0492D 85AB      LDD	R26,Y+11
    0492E 85BC      LDD	R27,Y+12
    0492F 9508      RET
long_epilog:
    04930 91B9      LD	R27,Y+
    04931 91A9      LD	R26,Y+
    04932 9199      LD	R25,Y+
    04933 9189      LD	R24,Y+
    04934 91E9      LD	R30,Y+
    04935 90B9      LD	R11,Y+
    04936 90A9      LD	R10,Y+
    04937 9099      LD	R9,Y+
    04938 9089      LD	R8,Y+
    04939 9624      ADIW	R28,4
    0493A 9508      RET
tstzero1:
    0493B 27EE      CLR	R30
    0493C 2BE0      OR	R30,R16
    0493D 2BE1      OR	R30,R17
    0493E 2BE2      OR	R30,R18
    0493F 2BE3      OR	R30,R19
    04940 9508      RET
tstzero2:
    04941 27EE      CLR	R30
    04942 2BE8      OR	R30,R24
    04943 2BE9      OR	R30,R25
    04944 2BEA      OR	R30,R26
    04945 2BEB      OR	R30,R27
    04946 9508      RET
lsl16:
    04947 2322      TST	R18
    04948 F021      BEQ	0x494D
    04949 0F00      LSL	R16
    0494A 1F11      ROL	R17
    0494B 952A      DEC	R18
    0494C CFFA      RJMP	lsl16
    0494D 9508      RET
lsl32:
    0494E 920F      PUSH	R0
    0494F 9009      LD	R0,Y+
    04950 2000      TST	R0
    04951 F031      BEQ	0x4958
    04952 0F00      LSL	R16
    04953 1F11      ROL	R17
    04954 1F22      ROL	R18
    04955 1F33      ROL	R19
    04956 940A      DEC	R0
    04957 CFF8      RJMP	0x4950
    04958 900F      POP	R0
    04959 9508      RET
lsl8:
    0495A 2311      TST	R17
    0495B F019      BEQ	0x495F
    0495C 0F00      LSL	R16
    0495D 951A      DEC	R17
    0495E CFFB      RJMP	lsl8
    0495F 9508      RET
lsr16:
    04960 2322      TST	R18
    04961 F021      BEQ	0x4966
    04962 9516      LSR	R17
    04963 9507      ROR	R16
    04964 952A      DEC	R18
    04965 CFFA      RJMP	lsr16
    04966 9508      RET
lsr32:
    04967 920F      PUSH	R0
    04968 9009      LD	R0,Y+
    04969 2000      TST	R0
    0496A F031      BEQ	0x4971
    0496B 9536      LSR	R19
    0496C 9527      ROR	R18
    0496D 9517      ROR	R17
    0496E 9507      ROR	R16
    0496F 940A      DEC	R0
    04970 CFF8      RJMP	0x4969
    04971 900F      POP	R0
    04972 9508      RET
asgnblk:
    04973 93AA      ST	-Y,R26
    04974 93BA      ST	-Y,R27
    04975 93EA      ST	-Y,R30
    04976 93FA      ST	-Y,R31
    04977 920A      ST	-Y,R0
    04978 81AF      LDD	R26,Y+7
    04979 85B8      LDD	R27,Y+8
    0497A 81ED      LDD	R30,Y+5
    0497B 81FE      LDD	R31,Y+6
    0497C 3000      CPI	R16,0
    0497D 0701      CPC	R16,R17
    0497E F029      BEQ	0x4984
    0497F 9001      LD	R0,Z+
    04980 920D      ST	X+,R0
    04981 5001      SUBI	R16,1
    04982 4010      SBCI	R17,0
    04983 CFF8      RJMP	0x497C
    04984 9009      LD	R0,Y+
    04985 91F9      LD	R31,Y+
    04986 91E9      LD	R30,Y+
    04987 91B9      LD	R27,Y+
    04988 91A9      LD	R26,Y+
    04989 9624      ADIW	R28,4
    0498A 9508      RET
fpsub:
    0498B 9468      BSET	6
    0498C C001      RJMP	fpadd_alt
fpadd:
    0498D 94E8      BCLR	6
fpadd_alt:
    0498E 940E 4B98 CALL	saveFPRegs
    04990 940E 4B2A CALL	unpacks
    04992 F409      BNE	0x4994
    04993 C048      RJMP	0x49DC
    04994 2CE6      MOV	R14,R6
    04995 2CD5      MOV	R13,R5
    04996 2CC4      MOV	R12,R4
    04997 2EB3      MOV	R11,R19
    04998 2EA2      MOV	R10,R18
    04999 2E91      MOV	R9,R17
    0499A 2E80      MOV	R8,R16
    0499B 8100      LD	R16,Z
    0499C 8111      LDD	R17,Z+1
    0499D 8122      LDD	R18,Z+2
    0499E 8133      LDD	R19,Z+3
    0499F 940E 4B2A CALL	unpacks
    049A1 F409      BNE	0x49A3
    049A2 C044      RJMP	0x49E7
    049A3 2D84      MOV	R24,R4
    049A4 2D95      MOV	R25,R5
    049A5 198C      SUB	R24,R12
    049A6 099D      SBC	R25,R13
    049A7 F0B9      BEQ	0x49BF
    049A8 F472      BPL	0x49B7
    049A9 9590      COM	R25
    049AA 9580      COM	R24
    049AB 9601      ADIW	R24,1
    049AC 2C4C      MOV	R4,R12
    049AD 2C5D      MOV	R5,R13
    049AE 3188      CPI	R24,0x18
    049AF F5B8      BCC	0x49E7
    049B0 9535      ASR	R19
    049B1 9527      ROR	R18
    049B2 9517      ROR	R17
    049B3 9507      ROR	R16
    049B4 9701      SBIW	R24,1
    049B5 F7D1      BNE	0x49B0
    049B6 C008      RJMP	0x49BF
    049B7 3188      CPI	R24,0x18
    049B8 F518      BCC	0x49DC
    049B9 94B5      ASR	R11
    049BA 94A7      ROR	R10
    049BB 9497      ROR	R9
    049BC 9487      ROR	R8
    049BD 9701      SBIW	R24,1
    049BE F7D1      BNE	0x49B9
    049BF 2466      CLR	R6
    049C0 F02E      BRTS	0x49C6
    049C1 0D08      ADD	R16,R8
    049C2 1D19      ADC	R17,R9
    049C3 1D2A      ADC	R18,R10
    049C4 1D3B      ADC	R19,R11
    049C5 C009      RJMP	0x49CF
    049C6 1A80      SUB	R8,R16
    049C7 0A91      SBC	R9,R17
    049C8 0AA2      SBC	R10,R18
    049C9 0AB3      SBC	R11,R19
    049CA 2D08      MOV	R16,R8
    049CB 2D19      MOV	R17,R9
    049CC 2D2A      MOV	R18,R10
    049CD 2D3B      MOV	R19,R11
    049CE 2333      TST	R19
    049CF F422      BPL	0x49D4
    049D0 940E 4919 CALL	neg32
    049D2 E880      LDI	R24,0x80
    049D3 2E68      MOV	R6,R24
    049D4 940E 4B53 CALL	normalize_and_pack
    049D6 C002      RJMP	0x49D9
    049D7 940E 4B88 CALL	pack
    049D9 940E 4BA7 CALL	restoreFPRegs
    049DB 9508      RET
    049DC 8100      LD	R16,Z
    049DD 8111      LDD	R17,Z+1
    049DE 8122      LDD	R18,Z+2
    049DF 8133      LDD	R19,Z+3
    049E0 F7C6      BRTC	0x49D9
    049E1 940E 4B32 CALL	tstR16_R19
    049E3 F3A9      BEQ	0x49D9
    049E4 E880      LDI	R24,0x80
    049E5 2738      EOR	R19,R24
    049E6 CFF2      RJMP	0x49D9
    049E7 2D08      MOV	R16,R8
    049E8 2D19      MOV	R17,R9
    049E9 2D2A      MOV	R18,R10
    049EA 2D3B      MOV	R19,R11
    049EB 2C4C      MOV	R4,R12
    049EC 2C5D      MOV	R5,R13
    049ED 2C6E      MOV	R6,R14
    049EE 2333      TST	R19
    049EF F73A      BPL	0x49D7
    049F0 940E 4919 CALL	neg32
    049F2 E880      LDI	R24,0x80
    049F3 2E68      MOV	R6,R24
    049F4 CFE2      RJMP	0x49D7
fpadd1:
    049F5 93FA      ST	-Y,R31
    049F6 93EA      ST	-Y,R30
    049F7 81EA      LDD	R30,Y+2
    049F8 81FB      LDD	R31,Y+3
    049F9 940E 498D CALL	fpadd
    049FB 91E9      LD	R30,Y+
    049FC 91F9      LD	R31,Y+
    049FD 9622      ADIW	R28,2
    049FE 9508      RET
fpadd2:
    049FF 93FA      ST	-Y,R31
    04A00 93EA      ST	-Y,R30
    04A01 2FEC      MOV	R30,R28
    04A02 2FFD      MOV	R31,R29
    04A03 9632      ADIW	R30,2
    04A04 940E 498D CALL	fpadd
    04A06 91E9      LD	R30,Y+
    04A07 91F9      LD	R31,Y+
    04A08 9624      ADIW	R28,4
    04A09 9508      RET
fpsub1:
    04A0A 93FA      ST	-Y,R31
    04A0B 93EA      ST	-Y,R30
    04A0C 81EA      LDD	R30,Y+2
    04A0D 81FB      LDD	R31,Y+3
    04A0E 940E 498B CALL	fpsub
    04A10 91E9      LD	R30,Y+
    04A11 91F9      LD	R31,Y+
    04A12 9622      ADIW	R28,2
    04A13 9508      RET
fpsub2:
    04A14 93FA      ST	-Y,R31
    04A15 93EA      ST	-Y,R30
    04A16 2FEC      MOV	R30,R28
    04A17 2FFD      MOV	R31,R29
    04A18 9632      ADIW	R30,2
    04A19 940E 498B CALL	fpsub
    04A1B 91E9      LD	R30,Y+
    04A1C 91F9      LD	R31,Y+
    04A1D 9624      ADIW	R28,4
    04A1E 9508      RET
fpsub1x:
    04A1F 93FA      ST	-Y,R31
    04A20 93EA      ST	-Y,R30
    04A21 81EA      LDD	R30,Y+2
    04A22 81FB      LDD	R31,Y+3
    04A23 940E 498B CALL	fpsub
    04A25 91E9      LD	R30,Y+
    04A26 91F9      LD	R31,Y+
    04A27 8339      STD	Y+1,R19
    04A28 8328      ST	Y,R18
    04A29 931A      ST	-Y,R17
    04A2A 930A      ST	-Y,R16
    04A2B 9508      RET
fpsub2x:
    04A2C 93FA      ST	-Y,R31
    04A2D 93EA      ST	-Y,R30
    04A2E 2FEC      MOV	R30,R28
    04A2F 2FFD      MOV	R31,R29
    04A30 9632      ADIW	R30,2
    04A31 940E 498B CALL	fpsub
    04A33 91E9      LD	R30,Y+
    04A34 91F9      LD	R31,Y+
    04A35 833B      STD	Y+3,R19
    04A36 832A      STD	Y+2,R18
    04A37 8319      STD	Y+1,R17
    04A38 8308      ST	Y,R16
    04A39 9508      RET
fpint:
    04A3A 924A      ST	-Y,R4
    04A3B 925A      ST	-Y,R5
    04A3C 926A      ST	-Y,R6
    04A3D 938A      ST	-Y,R24
    04A3E 940E 4B3A CALL	unpacku
    04A40 F111      BEQ	0x4A63
    04A41 2055      TST	R5
    04A42 F0E2      BMI	0x4A5F
    04A43 E18F      LDI	R24,0x1F
    04A44 1648      CP	R4,R24
    04A45 F4C0      BCC	0x4A5E
    04A46 E187      LDI	R24,0x17
    04A47 1648      CP	R4,R24
    04A48 F0D1      BEQ	0x4A63
    04A49 F458      BCC	0x4A55
    04A4A 9441      NEG	R4
    04A4B EE89      LDI	R24,0xE9
    04A4C 1A48      SUB	R4,R24
    04A4D C005      RJMP	0x4A53
    04A4E 9535      ASR	R19
    04A4F 9527      ROR	R18
    04A50 9517      ROR	R17
    04A51 9507      ROR	R16
    04A52 944A      DEC	R4
    04A53 F7D1      BNE	0x4A4E
    04A54 C00E      RJMP	0x4A63
    04A55 E187      LDI	R24,0x17
    04A56 1A48      SUB	R4,R24
    04A57 0F00      LSL	R16
    04A58 1F11      ROL	R17
    04A59 1F22      ROL	R18
    04A5A 1F33      ROL	R19
    04A5B 944A      DEC	R4
    04A5C F7D1      BNE	0x4A57
    04A5D C005      RJMP	0x4A63
    04A5E E73F      LDI	R19,0x7F
    04A5F 2F23      MOV	R18,R19
    04A60 2F13      MOV	R17,R19
    04A61 2F03      MOV	R16,R19
    04A62 C004      RJMP	0x4A67
    04A63 2066      TST	R6
    04A64 F011      BEQ	0x4A67
    04A65 940E 4919 CALL	neg32
    04A67 9189      LD	R24,Y+
    04A68 9069      LD	R6,Y+
    04A69 9059      LD	R5,Y+
    04A6A 9049      LD	R4,Y+
    04A6B 9508      RET
uint2fp:
    04A6C 9468      BSET	6
    04A6D C001      RJMP	0x4A6F
int2fp:
    04A6E 94E8      BCLR	6
    04A6F 2722      CLR	R18
    04A70 2733      CLR	R19
    04A71 F046      BRTS	0x4A7A
    04A72 FD17      SBRC	R17,7
    04A73 9520      COM	R18
    04A74 FD17      SBRC	R17,7
    04A75 9530      COM	R19
    04A76 C003      RJMP	0x4A7A
ulong2fp:
    04A77 9468      BSET	6
    04A78 C001      RJMP	0x4A7A
long2fp:
    04A79 94E8      BCLR	6
    04A7A 924A      ST	-Y,R4
    04A7B 925A      ST	-Y,R5
    04A7C 926A      ST	-Y,R6
    04A7D 938A      ST	-Y,R24
    04A7E E187      LDI	R24,0x17
    04A7F 2E48      MOV	R4,R24
    04A80 2455      CLR	R5
    04A81 2466      CLR	R6
    04A82 F036      BRTS	0x4A89
    04A83 2333      TST	R19
    04A84 F422      BPL	0x4A89
    04A85 940E 4919 CALL	neg32
    04A87 E880      LDI	R24,0x80
    04A88 2E68      MOV	R6,R24
    04A89 940E 4B53 CALL	normalize_and_pack
    04A8B 9189      LD	R24,Y+
    04A8C 9069      LD	R6,Y+
    04A8D 9059      LD	R5,Y+
    04A8E 9049      LD	R4,Y+
    04A8F 9508      RET
fpdiv1:
    04A90 93FA      ST	-Y,R31
    04A91 93EA      ST	-Y,R30
    04A92 81EA      LDD	R30,Y+2
    04A93 81FB      LDD	R31,Y+3
    04A94 D027      RCALL	0x4ABC
    04A95 91E9      LD	R30,Y+
    04A96 91F9      LD	R31,Y+
    04A97 9622      ADIW	R28,2
    04A98 9508      RET
fpdiv2:
    04A99 93FA      ST	-Y,R31
    04A9A 93EA      ST	-Y,R30
    04A9B 2FEC      MOV	R30,R28
    04A9C 2FFD      MOV	R31,R29
    04A9D 9632      ADIW	R30,2
    04A9E D01D      RCALL	0x4ABC
    04A9F 91E9      LD	R30,Y+
    04AA0 91F9      LD	R31,Y+
    04AA1 9624      ADIW	R28,4
    04AA2 9508      RET
fpdiv1x:
    04AA3 93FA      ST	-Y,R31
    04AA4 93EA      ST	-Y,R30
    04AA5 81EA      LDD	R30,Y+2
    04AA6 81FB      LDD	R31,Y+3
    04AA7 D014      RCALL	0x4ABC
    04AA8 91E9      LD	R30,Y+
    04AA9 91F9      LD	R31,Y+
    04AAA 8339      STD	Y+1,R19
    04AAB 8328      ST	Y,R18
    04AAC 931A      ST	-Y,R17
    04AAD 930A      ST	-Y,R16
    04AAE 9508      RET
fpdiv2x:
    04AAF 93FA      ST	-Y,R31
    04AB0 93EA      ST	-Y,R30
    04AB1 2FEC      MOV	R30,R28
    04AB2 2FFD      MOV	R31,R29
    04AB3 9632      ADIW	R30,2
    04AB4 D007      RCALL	0x4ABC
    04AB5 91E9      LD	R30,Y+
    04AB6 91F9      LD	R31,Y+
    04AB7 833B      STD	Y+3,R19
    04AB8 832A      STD	Y+2,R18
    04AB9 8319      STD	Y+1,R17
    04ABA 8308      ST	Y,R16
    04ABB 9508      RET
    04ABC 920A      ST	-Y,R0
    04ABD 921A      ST	-Y,R1
    04ABE 922A      ST	-Y,R2
    04ABF 923A      ST	-Y,R3
    04AC0 940E 4B98 CALL	saveFPRegs
    04AC2 933A      ST	-Y,R19
    04AC3 932A      ST	-Y,R18
    04AC4 931A      ST	-Y,R17
    04AC5 930A      ST	-Y,R16
    04AC6 8100      LD	R16,Z
    04AC7 8111      LDD	R17,Z+1
    04AC8 8122      LDD	R18,Z+2
    04AC9 8133      LDD	R19,Z+3
    04ACA 940E 4B3A CALL	unpacku
    04ACC F409      BNE	0x4ACE
    04ACD C057      RJMP	0x4B25
    04ACE 2CE6      MOV	R14,R6
    04ACF 2CD5      MOV	R13,R5
    04AD0 2CC4      MOV	R12,R4
    04AD1 2EB3      MOV	R11,R19
    04AD2 2EA2      MOV	R10,R18
    04AD3 2E91      MOV	R9,R17
    04AD4 2E80      MOV	R8,R16
    04AD5 9109      LD	R16,Y+
    04AD6 9119      LD	R17,Y+
    04AD7 9129      LD	R18,Y+
    04AD8 9139      LD	R19,Y+
    04AD9 940E 4B3A CALL	unpacku
    04ADB F1A1      BEQ	0x4B10
    04ADC 246E      EOR	R6,R14
    04ADD 184C      SUB	R4,R12
    04ADE 085D      SBC	R5,R13
    04ADF E880      LDI	R24,0x80
    04AE0 1648      CP	R4,R24
    04AE1 0653      CPC	R5,R19
    04AE2 F00C      BLT	0x4AE4
    04AE3 C033      RJMP	0x4B17
    04AE4 E881      LDI	R24,0x81
    04AE5 1648      CP	R4,R24
    04AE6 EF8F      LDI	R24,0xFF
    04AE7 0658      CPC	R5,R24
    04AE8 F40C      BGE	0x4AEA
    04AE9 C036      RJMP	0x4B20
    04AEA E280      LDI	R24,0x20
    04AEB 2433      CLR	R3
    04AEC 2E23      MOV	R2,R19
    04AED 2E12      MOV	R1,R18
    04AEE 2E01      MOV	R0,R17
    04AEF 2F30      MOV	R19,R16
    04AF0 2722      CLR	R18
    04AF1 2711      CLR	R17
    04AF2 2700      CLR	R16
    04AF3 9426      LSR	R2
    04AF4 9417      ROR	R1
    04AF5 9407      ROR	R0
    04AF6 9537      ROR	R19
    04AF7 9527      ROR	R18
    04AF8 0F00      LSL	R16
    04AF9 1F11      ROL	R17
    04AFA 1F22      ROL	R18
    04AFB 1F33      ROL	R19
    04AFC 1C00      ROL	R0
    04AFD 1C11      ROL	R1
    04AFE 1C22      ROL	R2
    04AFF 1C33      ROL	R3
    04B00 F028      BCS	0x4B06
    04B01 1808      SUB	R0,R8
    04B02 0819      SBC	R1,R9
    04B03 082A      SBC	R2,R10
    04B04 083B      SBC	R3,R11
    04B05 C004      RJMP	0x4B0A
    04B06 0C08      ADD	R0,R8
    04B07 1C19      ADC	R1,R9
    04B08 1C2A      ADC	R2,R10
    04B09 1C3B      ADC	R3,R11
    04B0A F00A      BMI	0x4B0C
    04B0B 6001      ORI	R16,1
    04B0C 958A      DEC	R24
    04B0D F751      BNE	0x4AF8
    04B0E 940E 4B53 CALL	normalize_and_pack
    04B10 940E 4BA7 CALL	restoreFPRegs
    04B12 9039      LD	R3,Y+
    04B13 9029      LD	R2,Y+
    04B14 9019      LD	R1,Y+
    04B15 9009      LD	R0,Y+
    04B16 9508      RET
    04B17 EF0F      LDI	R16,0xFF
    04B18 2F10      MOV	R17,R16
    04B19 E72F      LDI	R18,0x7F
    04B1A E73F      LDI	R19,0x7F
    04B1B 2066      TST	R6
    04B1C F399      BEQ	0x4B10
    04B1D 940E 4919 CALL	neg32
    04B1F CFF0      RJMP	0x4B10
    04B20 2700      CLR	R16
    04B21 2F10      MOV	R17,R16
    04B22 2F20      MOV	R18,R16
    04B23 2F30      MOV	R19,R16
    04B24 CFEB      RJMP	0x4B10
    04B25 9109      LD	R16,Y+
    04B26 9119      LD	R17,Y+
    04B27 9129      LD	R18,Y+
    04B28 9139      LD	R19,Y+
    04B29 CFED      RJMP	0x4B17
unpacks:
    04B2A D00F      RCALL	unpacku
    04B2B F029      BEQ	0x4B31
    04B2C 2066      TST	R6
    04B2D F011      BEQ	0x4B30
    04B2E 940E 4919 CALL	neg32
    04B30 9498      BCLR	1
    04B31 9508      RET
tstR16_R19:
    04B32 2300      TST	R16
    04B33 F429      BNE	0x4B39
    04B34 2311      TST	R17
    04B35 F419      BNE	0x4B39
    04B36 2322      TST	R18
    04B37 F409      BNE	0x4B39
    04B38 2333      TST	R19
    04B39 9508      RET
unpacku:
    04B3A DFF7      RCALL	tstR16_R19
    04B3B F099      BEQ	0x4B4F
    04B3C 938A      ST	-Y,R24
    04B3D 2E63      MOV	R6,R19
    04B3E E880      LDI	R24,0x80
    04B3F 2268      AND	R6,R24
    04B40 0F22      LSL	R18
    04B41 1F33      ROL	R19
    04B42 2E43      MOV	R4,R19
    04B43 E78F      LDI	R24,0x7F
    04B44 1A48      SUB	R4,R24
    04B45 2455      CLR	R5
    04B46 2788      CLR	R24
    04B47 0A58      SBC	R5,R24
    04B48 9526      LSR	R18
    04B49 E830      LDI	R19,0x80
    04B4A 2B23      OR	R18,R19
    04B4B 2733      CLR	R19
    04B4C 9189      LD	R24,Y+
    04B4D 9498      BCLR	1
    04B4E 9508      RET
    04B4F 2444      CLR	R4
    04B50 2455      CLR	R5
    04B51 2466      CLR	R6
    04B52 9508      RET
normalize_and_pack:
    04B53 DFDE      RCALL	tstR16_R19
    04B54 F409      BNE	0x4B56
    04B55 9508      RET
    04B56 93AA      ST	-Y,R26
    04B57 93BA      ST	-Y,R27
    04B58 01D2      MOVW	R26,R4
    04B59 939A      ST	-Y,R25
    04B5A 938A      ST	-Y,R24
    04B5B E78E      LDI	R24,0x7E
    04B5C E090      LDI	R25,0
    04B5D 2333      TST	R19
    04B5E F049      BEQ	0x4B68
    04B5F 9536      LSR	R19
    04B60 9527      ROR	R18
    04B61 9517      ROR	R17
    04B62 9507      ROR	R16
    04B63 17A8      CP	R26,R24
    04B64 07B9      CPC	R27,R25
    04B65 F4CC      BGE	0x4B7F
    04B66 9611      ADIW	R26,1
    04B67 CFF5      RJMP	0x4B5D
    04B68 9580      COM	R24
    04B69 9590      COM	R25
    04B6A 9601      ADIW	R24,1
    04B6B 2322      TST	R18
    04B6C F0BA      BMI	0x4B84
    04B6D 0F00      LSL	R16
    04B6E 1F11      ROL	R17
    04B6F 1F22      ROL	R18
    04B70 17A8      CP	R26,R24
    04B71 07B9      CPC	R27,R25
    04B72 F014      BLT	0x4B75
    04B73 9711      SBIW	R26,1
    04B74 CFF6      RJMP	0x4B6B
    04B75 2700      CLR	R16
    04B76 2711      CLR	R17
    04B77 2722      CLR	R18
    04B78 2733      CLR	R19
    04B79 9189      LD	R24,Y+
    04B7A 9199      LD	R25,Y+
    04B7B 012D      MOVW	R4,R26
    04B7C 91B9      LD	R27,Y+
    04B7D 91A9      LD	R26,Y+
    04B7E 9508      RET
    04B7F 2733      CLR	R19
    04B80 EF0F      LDI	R16,0xFF
    04B81 2F10      MOV	R17,R16
    04B82 E72F      LDI	R18,0x7F
    04B83 2F32      MOV	R19,R18
    04B84 9189      LD	R24,Y+
    04B85 9199      LD	R25,Y+
    04B86 012D      MOVW	R4,R26
    04B87 C002      RJMP	0x4B8A
pack:
    04B88 93AA      ST	-Y,R26
    04B89 93BA      ST	-Y,R27
    04B8A DFA7      RCALL	tstR16_R19
    04B8B F049      BEQ	0x4B95
    04B8C 01D2      MOVW	R26,R4
    04B8D 58A1      SUBI	R26,0x81
    04B8E 4FBF      SBCI	R27,0xFF
    04B8F 012D      MOVW	R4,R26
    04B90 2D34      MOV	R19,R4
    04B91 0F22      LSL	R18
    04B92 9536      LSR	R19
    04B93 9527      ROR	R18
    04B94 2936      OR	R19,R6
    04B95 91B9      LD	R27,Y+
    04B96 91A9      LD	R26,Y+
    04B97 9508      RET
saveFPRegs:
    04B98 924A      ST	-Y,R4
    04B99 925A      ST	-Y,R5
    04B9A 926A      ST	-Y,R6
    04B9B 927A      ST	-Y,R7
    04B9C 928A      ST	-Y,R8
    04B9D 929A      ST	-Y,R9
    04B9E 92AA      ST	-Y,R10
    04B9F 92BA      ST	-Y,R11
    04BA0 92CA      ST	-Y,R12
    04BA1 92DA      ST	-Y,R13
    04BA2 92EA      ST	-Y,R14
    04BA3 92FA      ST	-Y,R15
    04BA4 938A      ST	-Y,R24
    04BA5 939A      ST	-Y,R25
    04BA6 9508      RET
restoreFPRegs:
    04BA7 9199      LD	R25,Y+
    04BA8 9189      LD	R24,Y+
    04BA9 90F9      LD	R15,Y+
    04BAA 90E9      LD	R14,Y+
    04BAB 90D9      LD	R13,Y+
    04BAC 90C9      LD	R12,Y+
    04BAD 90B9      LD	R11,Y+
    04BAE 90A9      LD	R10,Y+
    04BAF 9099      LD	R9,Y+
    04BB0 9089      LD	R8,Y+
    04BB1 9079      LD	R7,Y+
    04BB2 9069      LD	R6,Y+
    04BB3 9059      LD	R5,Y+
    04BB4 9049      LD	R4,Y+
    04BB5 9508      RET
fpmule:
    04BB6 940E 4B98 CALL	saveFPRegs
    04BB8 93AA      ST	-Y,R26
    04BB9 93BA      ST	-Y,R27
    04BBA 940E 4B3A CALL	unpacku
    04BBC F1E1      BEQ	0x4BF9
    04BBD 2CE6      MOV	R14,R6
    04BBE 2CD5      MOV	R13,R5
    04BBF 2CC4      MOV	R12,R4
    04BC0 2EB3      MOV	R11,R19
    04BC1 2EA2      MOV	R10,R18
    04BC2 2E91      MOV	R9,R17
    04BC3 2E80      MOV	R8,R16
    04BC4 8100      LD	R16,Z
    04BC5 8111      LDD	R17,Z+1
    04BC6 8122      LDD	R18,Z+2
    04BC7 8133      LDD	R19,Z+3
    04BC8 940E 4B3A CALL	unpacku
    04BCA F171      BEQ	0x4BF9
    04BCB 246E      EOR	R6,R14
    04BCC 0C4C      ADD	R4,R12
    04BCD 1C5D      ADC	R5,R13
    04BCE E880      LDI	R24,0x80
    04BCF 1648      CP	R4,R24
    04BD0 0653      CPC	R5,R19
    04BD1 F564      BGE	0x4BFE
    04BD2 E881      LDI	R24,0x81
    04BD3 1648      CP	R4,R24
    04BD4 EF8F      LDI	R24,0xFF
    04BD5 0658      CPC	R5,R24
    04BD6 F16C      BLT	0x4C04
    04BD7 9EA2      MUL	R10,R18
    04BD8 2DB1      MOV	R27,R1
    04BD9 2DA0      MOV	R26,R0
    04BDA 9E91      MUL	R9,R17
    04BDB 2D91      MOV	R25,R1
    04BDC 2D80      MOV	R24,R0
    04BDD 9EA0      MUL	R10,R16
    04BDE 0D80      ADD	R24,R0
    04BDF 1D91      ADC	R25,R1
    04BE0 1FA3      ADC	R26,R19
    04BE1 1FB3      ADC	R27,R19
    04BE2 9E82      MUL	R8,R18
    04BE3 0D80      ADD	R24,R0
    04BE4 1D91      ADC	R25,R1
    04BE5 1FA3      ADC	R26,R19
    04BE6 1FB3      ADC	R27,R19
    04BE7 9E92      MUL	R9,R18
    04BE8 0D90      ADD	R25,R0
    04BE9 1DA1      ADC	R26,R1
    04BEA 1FB3      ADC	R27,R19
    04BEB 9EA1      MUL	R10,R17
    04BEC 0D90      ADD	R25,R0
    04BED 1DA1      ADC	R26,R1
    04BEE 1FB3      ADC	R27,R19
    04BEF 2F2B      MOV	R18,R27
    04BF0 2F1A      MOV	R17,R26
    04BF1 2F09      MOV	R16,R25
    04BF2 0F88      LSL	R24
    04BF3 1F00      ROL	R16
    04BF4 1F11      ROL	R17
    04BF5 1F22      ROL	R18
    04BF6 1F33      ROL	R19
    04BF7 940E 4B53 CALL	normalize_and_pack
    04BF9 91B9      LD	R27,Y+
    04BFA 91A9      LD	R26,Y+
    04BFB 940E 4BA7 CALL	restoreFPRegs
    04BFD 9508      RET
    04BFE EF0F      LDI	R16,0xFF
    04BFF 2F10      MOV	R17,R16
    04C00 E72F      LDI	R18,0x7F
    04C01 E78F      LDI	R24,0x7F
    04C02 2E48      MOV	R4,R24
    04C03 CFF5      RJMP	0x4BF9
    04C04 2700      CLR	R16
    04C05 2F10      MOV	R17,R16
    04C06 2F20      MOV	R18,R16
    04C07 2F30      MOV	R19,R16
    04C08 CFF0      RJMP	0x4BF9
fpmule1:
    04C09 93FA      ST	-Y,R31
    04C0A 93EA      ST	-Y,R30
    04C0B 81EA      LDD	R30,Y+2
    04C0C 81FB      LDD	R31,Y+3
    04C0D 940E 4BB6 CALL	fpmule
    04C0F 91E9      LD	R30,Y+
    04C10 91F9      LD	R31,Y+
    04C11 9622      ADIW	R28,2
    04C12 9508      RET
fpmule2:
    04C13 93FA      ST	-Y,R31
    04C14 93EA      ST	-Y,R30
    04C15 2FEC      MOV	R30,R28
    04C16 2FFD      MOV	R31,R29
    04C17 9632      ADIW	R30,2
    04C18 940E 4BB6 CALL	fpmule
    04C1A 91E9      LD	R30,Y+
    04C1B 91F9      LD	R31,Y+
    04C1C 9624      ADIW	R28,4
    04C1D 9508      RET
fpmule1x:
    04C1E 93FA      ST	-Y,R31
    04C1F 93EA      ST	-Y,R30
    04C20 81EA      LDD	R30,Y+2
    04C21 81FB      LDD	R31,Y+3
    04C22 940E 4BB6 CALL	fpmule
    04C24 91E9      LD	R30,Y+
    04C25 91F9      LD	R31,Y+
    04C26 8339      STD	Y+1,R19
    04C27 8328      ST	Y,R18
    04C28 931A      ST	-Y,R17
    04C29 930A      ST	-Y,R16
    04C2A 9508      RET
fpcmp:
    04C2B 940E 498B CALL	fpsub
    04C2D 2333      TST	R19
    04C2E F03A      BMI	0x4C36
    04C2F 940E 4B32 CALL	tstR16_R19
    04C31 F011      BEQ	0x4C34
    04C32 E001      LDI	R16,1
    04C33 9508      RET
    04C34 2700      CLR	R16
    04C35 9508      RET
    04C36 EF0F      LDI	R16,0xFF
    04C37 9508      RET
fpcmp1:
    04C38 93FA      ST	-Y,R31
    04C39 93EA      ST	-Y,R30
    04C3A 81EA      LDD	R30,Y+2
    04C3B 81FB      LDD	R31,Y+3
    04C3C 940E 4C2B CALL	fpcmp
    04C3E 91E9      LD	R30,Y+
    04C3F 91F9      LD	R31,Y+
    04C40 9622      ADIW	R28,2
    04C41 2300      TST	R16
    04C42 9508      RET
fpcmp2:
    04C43 93FA      ST	-Y,R31
    04C44 93EA      ST	-Y,R30
    04C45 2FEC      MOV	R30,R28
    04C46 2FFD      MOV	R31,R29
    04C47 9632      ADIW	R30,2
    04C48 940E 4C2B CALL	fpcmp
    04C4A 91E9      LD	R30,Y+
    04C4B 91F9      LD	R31,Y+
    04C4C 9624      ADIW	R28,4
    04C4D 2300      TST	R16
    04C4E 9508      RET
_cstrcpy:
    04C4F 2FA0      MOV	R26,R16
    04C50 2FB1      MOV	R27,R17
    04C51 2FE2      MOV	R30,R18
    04C52 2FF3      MOV	R31,R19
    04C53 95C8      LPM
    04C54 9631      ADIW	R30,1
    04C55 920D      ST	X+,R0
    04C56 2000      TST	R0
    04C57 F7D9      BNE	0x4C53
    04C58 9508      RET
_cstrlen:
    04C59 2FE0      MOV	R30,R16
    04C5A 2FF1      MOV	R31,R17
    04C5B 27AA      CLR	R26
    04C5C 27BB      CLR	R27
    04C5D 95C8      LPM
    04C5E 2000      TST	R0
    04C5F F019      BEQ	0x4C63
    04C60 9631      ADIW	R30,1
    04C61 9611      ADIW	R26,1
    04C62 CFFA      RJMP	0x4C5D
    04C63 2F0A      MOV	R16,R26
    04C64 2F1B      MOV	R17,R27
    04C65 9508      RET
_atoi:
    04C66 940E 48E2 CALL	push_xgsetF00C
    04C68 0158      MOVW	R10,R16
    04C69 C003      RJMP	0x4C6D
    04C6A 01C5      MOVW	R24,R10
    04C6B 9601      ADIW	R24,1
    04C6C 015C      MOVW	R10,R24
    04C6D 01F5      MOVW	R30,R10
    04C6E 8100      LD	R16,Z
    04C6F 2711      CLR	R17
    04C70 940E 5019 CALL	_isspace
    04C72 3000      CPI	R16,0
    04C73 0701      CPC	R16,R17
    04C74 F7A9      BNE	0x4C6A
    04C75 2766      CLR	R22
    04C76 2777      CLR	R23
    04C77 01F5      MOVW	R30,R10
    04C78 8180      LD	R24,Z
    04C79 328D      CPI	R24,0x2D
    04C7A F429      BNE	0x4C80
    04C7B E061      LDI	R22,1
    04C7C 01CF      MOVW	R24,R30
    04C7D 9601      ADIW	R24,1
    04C7E 015C      MOVW	R10,R24
    04C7F C007      RJMP	0x4C87
    04C80 01F5      MOVW	R30,R10
    04C81 8180      LD	R24,Z
    04C82 328B      CPI	R24,0x2B
    04C83 F419      BNE	0x4C87
    04C84 01CF      MOVW	R24,R30
    04C85 9601      ADIW	R24,1
    04C86 015C      MOVW	R10,R24
    04C87 2744      CLR	R20
    04C88 2755      CLR	R21
    04C89 C00E      RJMP	0x4C98
    04C8A E00A      LDI	R16,0xA
    04C8B E010      LDI	R17,0
    04C8C 019A      MOVW	R18,R20
    04C8D 940E 485F CALL	empy16s
    04C8F 01A8      MOVW	R20,R16
    04C90 01F5      MOVW	R30,R10
    04C91 9021      LD	R2,Z+
    04C92 015F      MOVW	R10,R30
    04C93 2433      CLR	R3
    04C94 0D42      ADD	R20,R2
    04C95 1D53      ADC	R21,R3
    04C96 5340      SUBI	R20,0x30
    04C97 4050      SBCI	R21,0
    04C98 01F5      MOVW	R30,R10
    04C99 8100      LD	R16,Z
    04C9A 2711      CLR	R17
    04C9B 940E 5005 CALL	_isdigit
    04C9D 3000      CPI	R16,0
    04C9E 0701      CPC	R16,R17
    04C9F F751      BNE	0x4C8A
    04CA0 3060      CPI	R22,0
    04CA1 0767      CPC	R22,R23
    04CA2 F031      BEQ	0x4CA9
    04CA3 018A      MOVW	R16,R20
    04CA4 9500      COM	R16
    04CA5 9510      COM	R17
    04CA6 5F0F      SUBI	R16,0xFF
    04CA7 4F1F      SBCI	R17,0xFF
    04CA8 C001      RJMP	0x4CAA
    04CA9 018A      MOVW	R16,R20
    04CAA 940C 48E9 JMP	pop_xgsetF00C
_itoa:
    04CAC 940E 477E CALL	push_arg4
    04CAE 940E 48C3 CALL	push_xgsetF0FC
    04CB0 01A9      MOVW	R20,R18
    04CB1 84EE      LDD	R14,Y+14
    04CB2 84FF      LDD	R15,Y+15
    04CB3 015A      MOVW	R10,R20
    04CB4 20AA      TST	R10
    04CB5 F451      BNE	0x4CC0
    04CB6 20BB      TST	R11
    04CB7 F441      BNE	0x4CC0
    04CB8 E380      LDI	R24,0x30
    04CB9 85EA      LDD	R30,Y+10
    04CBA 85FB      LDD	R31,Y+11
    04CBB 8380      ST	Z,R24
    04CBC 2422      CLR	R2
    04CBD 8221      STD	Z+1,R2
    04CBE 018F      MOVW	R16,R30
    04CBF C053      RJMP	0x4D13
    04CC0 3040      CPI	R20,0
    04CC1 E0E0      LDI	R30,0
    04CC2 075E      CPC	R21,R30
    04CC3 F46C      BGE	0x4CD1
    04CC4 01C7      MOVW	R24,R14
    04CC5 308A      CPI	R24,0xA
    04CC6 E0E0      LDI	R30,0
    04CC7 079E      CPC	R25,R30
    04CC8 F441      BNE	0x4CD1
    04CC9 24CC      CLR	R12
    04CCA 94C3      INC	R12
    04CCB 01C5      MOVW	R24,R10
    04CCC 9580      COM	R24
    04CCD 9590      COM	R25
    04CCE 9601      ADIW	R24,1
    04CCF 015C      MOVW	R10,R24
    04CD0 C001      RJMP	0x4CD2
    04CD1 24CC      CLR	R12
    04CD2 856A      LDD	R22,Y+10
    04CD3 857B      LDD	R23,Y+11
    04CD4 0197      MOVW	R18,R14
    04CD5 0185      MOVW	R16,R10
    04CD6 940E 47AD CALL	mod16u
    04CD8 01A8      MOVW	R20,R16
    04CD9 E089      LDI	R24,0x9
    04CDA E090      LDI	R25,0
    04CDB 1780      CP	R24,R16
    04CDC 0791      CPC	R25,R17
    04CDD F034      BLT	0x4CE4
    04CDE 01CA      MOVW	R24,R20
    04CDF 96C0      ADIW	R24,0x30
    04CE0 01FB      MOVW	R30,R22
    04CE1 9381      ST	Z+,R24
    04CE2 01BF      MOVW	R22,R30
    04CE3 C006      RJMP	0x4CEA
    04CE4 01CA      MOVW	R24,R20
    04CE5 5A89      SUBI	R24,0xA9
    04CE6 4F9F      SBCI	R25,0xFF
    04CE7 01FB      MOVW	R30,R22
    04CE8 9381      ST	Z+,R24
    04CE9 01BF      MOVW	R22,R30
    04CEA 0197      MOVW	R18,R14
    04CEB 0185      MOVW	R16,R10
    04CEC 940E 47AF CALL	div16u
    04CEE 0158      MOVW	R10,R16
    04CEF 20AA      TST	R10
    04CF0 F719      BNE	0x4CD4
    04CF1 20BB      TST	R11
    04CF2 F709      BNE	0x4CD4
    04CF3 20CC      TST	R12
    04CF4 F021      BEQ	0x4CF9
    04CF5 E28D      LDI	R24,0x2D
    04CF6 01FB      MOVW	R30,R22
    04CF7 9381      ST	Z+,R24
    04CF8 01BF      MOVW	R22,R30
    04CF9 012B      MOVW	R4,R22
    04CFA 5061      SUBI	R22,1
    04CFB 4070      SBCI	R23,0
    04CFC 2422      CLR	R2
    04CFD 01F2      MOVW	R30,R4
    04CFE 8220      ST	Z,R2
    04CFF 84AA      LDD	R10,Y+10
    04D00 84BB      LDD	R11,Y+11
    04D01 C00C      RJMP	0x4D0E
    04D02 01F5      MOVW	R30,R10
    04D03 80C0      LD	R12,Z
    04D04 01FB      MOVW	R30,R22
    04D05 8020      LD	R2,Z
    04D06 01F5      MOVW	R30,R10
    04D07 9221      ST	Z+,R2
    04D08 015F      MOVW	R10,R30
    04D09 011B      MOVW	R2,R22
    04D0A 5061      SUBI	R22,1
    04D0B 4070      SBCI	R23,0
    04D0C 01F1      MOVW	R30,R2
    04D0D 82C0      ST	Z,R12
    04D0E 16A6      CP	R10,R22
    04D0F 06B7      CPC	R11,R23
    04D10 F388      BCS	0x4D02
    04D11 850A      LDD	R16,Y+10
    04D12 851B      LDD	R17,Y+11
    04D13 940E 48B8 CALL	pop_xgsetF0FC
    04D15 9624      ADIW	R28,4
    04D16 9508      RET
_ltoa:
    04D17 940E 477E CALL	push_arg4
    04D19 940E 48C3 CALL	push_xgsetF0FC
    04D1B 9724      SBIW	R28,4
    04D1C 8828      LDD	R2,Y+16
    04D1D 8839      LDD	R3,Y+17
    04D1E 884A      LDD	R4,Y+18
    04D1F 885B      LDD	R5,Y+19
    04D20 8228      ST	Y,R2
    04D21 8239      STD	Y+1,R3
    04D22 824A      STD	Y+2,R4
    04D23 825B      STD	Y+3,R5
    04D24 8828      LDD	R2,Y+16
    04D25 8839      LDD	R3,Y+17
    04D26 884A      LDD	R4,Y+18
    04D27 885B      LDD	R5,Y+19
    04D28 9488      BCLR	0
    04D29 2022      TST	R2
    04D2A 0432      CPC	R3,R2
    04D2B 0442      CPC	R4,R2
    04D2C 0452      CPC	R5,R2
    04D2D F441      BNE	0x4D36
    04D2E E380      LDI	R24,0x30
    04D2F 85EE      LDD	R30,Y+14
    04D30 85FF      LDD	R31,Y+15
    04D31 8380      ST	Z,R24
    04D32 2422      CLR	R2
    04D33 8221      STD	Z+1,R2
    04D34 018F      MOVW	R16,R30
    04D35 C094      RJMP	0x4DCA
    04D36 E040      LDI	R20,0
    04D37 E050      LDI	R21,0
    04D38 E060      LDI	R22,0
    04D39 E070      LDI	R23,0
    04D3A 8828      LDD	R2,Y+16
    04D3B 8839      LDD	R3,Y+17
    04D3C 884A      LDD	R4,Y+18
    04D3D 885B      LDD	R5,Y+19
    04D3E 1624      CP	R2,R20
    04D3F 0635      CPC	R3,R21
    04D40 0646      CPC	R4,R22
    04D41 0657      CPC	R5,R23
    04D42 F4EC      BGE	0x4D60
    04D43 898C      LDD	R24,Y+20
    04D44 899D      LDD	R25,Y+21
    04D45 308A      CPI	R24,0xA
    04D46 E0A0      LDI	R26,0
    04D47 079A      CPC	R25,R26
    04D48 F4B9      BNE	0x4D60
    04D49 24AA      CLR	R10
    04D4A 94A3      INC	R10
    04D4B E041      LDI	R20,1
    04D4C E050      LDI	R21,0
    04D4D E060      LDI	R22,0
    04D4E E070      LDI	R23,0
    04D4F 8028      LD	R2,Y
    04D50 8039      LDD	R3,Y+1
    04D51 804A      LDD	R4,Y+2
    04D52 805B      LDD	R5,Y+3
    04D53 9420      COM	R2
    04D54 9430      COM	R3
    04D55 9440      COM	R4
    04D56 9450      COM	R5
    04D57 0E24      ADD	R2,R20
    04D58 1E35      ADC	R3,R21
    04D59 1E46      ADC	R4,R22
    04D5A 1E57      ADC	R5,R23
    04D5B 8228      ST	Y,R2
    04D5C 8239      STD	Y+1,R3
    04D5D 824A      STD	Y+2,R4
    04D5E 825B      STD	Y+3,R5
    04D5F C001      RJMP	0x4D61
    04D60 24AA      CLR	R10
    04D61 84CE      LDD	R12,Y+14
    04D62 84DF      LDD	R13,Y+15
    04D63 882C      LDD	R2,Y+20
    04D64 883D      LDD	R3,Y+21
    04D65 2444      CLR	R4
    04D66 FC37      SBRC	R3,7
    04D67 9440      COM	R4
    04D68 2455      CLR	R5
    04D69 FC47      SBRC	R4,7
    04D6A 9450      COM	R5
    04D6B 8108      LD	R16,Y
    04D6C 8119      LDD	R17,Y+1
    04D6D 812A      LDD	R18,Y+2
    04D6E 813B      LDD	R19,Y+3
    04D6F 925A      ST	-Y,R5
    04D70 924A      ST	-Y,R4
    04D71 923A      ST	-Y,R3
    04D72 922A      ST	-Y,R2
    04D73 940E 47CB CALL	mod32u
    04D75 0178      MOVW	R14,R16
    04D76 E089      LDI	R24,0x9
    04D77 E090      LDI	R25,0
    04D78 1780      CP	R24,R16
    04D79 0791      CPC	R25,R17
    04D7A F034      BLT	0x4D81
    04D7B 01C7      MOVW	R24,R14
    04D7C 96C0      ADIW	R24,0x30
    04D7D 01F6      MOVW	R30,R12
    04D7E 9381      ST	Z+,R24
    04D7F 016F      MOVW	R12,R30
    04D80 C006      RJMP	0x4D87
    04D81 01C7      MOVW	R24,R14
    04D82 5A89      SUBI	R24,0xA9
    04D83 4F9F      SBCI	R25,0xFF
    04D84 01F6      MOVW	R30,R12
    04D85 9381      ST	Z+,R24
    04D86 016F      MOVW	R12,R30
    04D87 882C      LDD	R2,Y+20
    04D88 883D      LDD	R3,Y+21
    04D89 2444      CLR	R4
    04D8A FC37      SBRC	R3,7
    04D8B 9440      COM	R4
    04D8C 2455      CLR	R5
    04D8D FC47      SBRC	R4,7
    04D8E 9450      COM	R5
    04D8F 8108      LD	R16,Y
    04D90 8119      LDD	R17,Y+1
    04D91 812A      LDD	R18,Y+2
    04D92 813B      LDD	R19,Y+3
    04D93 925A      ST	-Y,R5
    04D94 924A      ST	-Y,R4
    04D95 923A      ST	-Y,R3
    04D96 922A      ST	-Y,R2
    04D97 940E 47C9 CALL	div32u
    04D99 8308      ST	Y,R16
    04D9A 8319      STD	Y+1,R17
    04D9B 832A      STD	Y+2,R18
    04D9C 833B      STD	Y+3,R19
    04D9D 8028      LD	R2,Y
    04D9E 8039      LDD	R3,Y+1
    04D9F 804A      LDD	R4,Y+2
    04DA0 805B      LDD	R5,Y+3
    04DA1 9488      BCLR	0
    04DA2 2022      TST	R2
    04DA3 0432      CPC	R3,R2
    04DA4 0442      CPC	R4,R2
    04DA5 0452      CPC	R5,R2
    04DA6 F009      BEQ	0x4DA8
    04DA7 CFBB      RJMP	0x4D63
    04DA8 20AA      TST	R10
    04DA9 F021      BEQ	0x4DAE
    04DAA E28D      LDI	R24,0x2D
    04DAB 01F6      MOVW	R30,R12
    04DAC 9381      ST	Z+,R24
    04DAD 016F      MOVW	R12,R30
    04DAE 0126      MOVW	R4,R12
    04DAF 01C2      MOVW	R24,R4
    04DB0 9701      SBIW	R24,1
    04DB1 016C      MOVW	R12,R24
    04DB2 2422      CLR	R2
    04DB3 01F2      MOVW	R30,R4
    04DB4 8220      ST	Z,R2
    04DB5 84EE      LDD	R14,Y+14
    04DB6 84FF      LDD	R15,Y+15
    04DB7 C00D      RJMP	0x4DC5
    04DB8 01F7      MOVW	R30,R14
    04DB9 80A0      LD	R10,Z
    04DBA 01F6      MOVW	R30,R12
    04DBB 8020      LD	R2,Z
    04DBC 01F7      MOVW	R30,R14
    04DBD 9221      ST	Z+,R2
    04DBE 017F      MOVW	R14,R30
    04DBF 0116      MOVW	R2,R12
    04DC0 01C1      MOVW	R24,R2
    04DC1 9701      SBIW	R24,1
    04DC2 016C      MOVW	R12,R24
    04DC3 01F1      MOVW	R30,R2
    04DC4 82A0      ST	Z,R10
    04DC5 14EC      CP	R14,R12
    04DC6 04FD      CPC	R15,R13
    04DC7 F380      BCS	0x4DB8
    04DC8 850E      LDD	R16,Y+14
    04DC9 851F      LDD	R17,Y+15
    04DCA 9624      ADIW	R28,4
    04DCB 940E 48B8 CALL	pop_xgsetF0FC
    04DCD 9624      ADIW	R28,4
    04DCE 9508      RET
_ultoa:
    04DCF 933A      ST	-Y,R19
    04DD0 932A      ST	-Y,R18
    04DD1 940E 48C3 CALL	push_xgsetF0FC
    04DD3 0158      MOVW	R10,R16
    04DD4 84CE      LDD	R12,Y+14
    04DD5 84DF      LDD	R13,Y+15
    04DD6 01A5      MOVW	R20,R10
    04DD7 0116      MOVW	R2,R12
    04DD8 2444      CLR	R4
    04DD9 FC37      SBRC	R3,7
    04DDA 9440      COM	R4
    04DDB 2455      CLR	R5
    04DDC FC47      SBRC	R4,7
    04DDD 9450      COM	R5
    04DDE 850A      LDD	R16,Y+10
    04DDF 851B      LDD	R17,Y+11
    04DE0 852C      LDD	R18,Y+12
    04DE1 853D      LDD	R19,Y+13
    04DE2 925A      ST	-Y,R5
    04DE3 924A      ST	-Y,R4
    04DE4 923A      ST	-Y,R3
    04DE5 922A      ST	-Y,R2
    04DE6 940E 47CB CALL	mod32u
    04DE8 01B8      MOVW	R22,R16
    04DE9 E089      LDI	R24,0x9
    04DEA E090      LDI	R25,0
    04DEB 1780      CP	R24,R16
    04DEC 0791      CPC	R25,R17
    04DED F034      BLT	0x4DF4
    04DEE 01CB      MOVW	R24,R22
    04DEF 96C0      ADIW	R24,0x30
    04DF0 01FA      MOVW	R30,R20
    04DF1 9381      ST	Z+,R24
    04DF2 01AF      MOVW	R20,R30
    04DF3 C006      RJMP	0x4DFA
    04DF4 01CB      MOVW	R24,R22
    04DF5 5A89      SUBI	R24,0xA9
    04DF6 4F9F      SBCI	R25,0xFF
    04DF7 01FA      MOVW	R30,R20
    04DF8 9381      ST	Z+,R24
    04DF9 01AF      MOVW	R20,R30
    04DFA 0116      MOVW	R2,R12
    04DFB 2444      CLR	R4
    04DFC FC37      SBRC	R3,7
    04DFD 9440      COM	R4
    04DFE 2455      CLR	R5
    04DFF FC47      SBRC	R4,7
    04E00 9450      COM	R5
    04E01 850A      LDD	R16,Y+10
    04E02 851B      LDD	R17,Y+11
    04E03 852C      LDD	R18,Y+12
    04E04 853D      LDD	R19,Y+13
    04E05 925A      ST	-Y,R5
    04E06 924A      ST	-Y,R4
    04E07 923A      ST	-Y,R3
    04E08 922A      ST	-Y,R2
    04E09 940E 47C9 CALL	div32u
    04E0B 870A      STD	Y+10,R16
    04E0C 871B      STD	Y+11,R17
    04E0D 872C      STD	Y+12,R18
    04E0E 873D      STD	Y+13,R19
    04E0F 842A      LDD	R2,Y+10
    04E10 843B      LDD	R3,Y+11
    04E11 844C      LDD	R4,Y+12
    04E12 845D      LDD	R5,Y+13
    04E13 9488      BCLR	0
    04E14 2022      TST	R2
    04E15 0432      CPC	R3,R2
    04E16 0442      CPC	R4,R2
    04E17 0452      CPC	R5,R2
    04E18 F009      BEQ	0x4E1A
    04E19 CFBD      RJMP	0x4DD7
    04E1A 012A      MOVW	R4,R20
    04E1B 5041      SUBI	R20,1
    04E1C 4050      SBCI	R21,0
    04E1D 2422      CLR	R2
    04E1E 01F2      MOVW	R30,R4
    04E1F 8220      ST	Z,R2
    04E20 0165      MOVW	R12,R10
    04E21 C00C      RJMP	0x4E2E
    04E22 01F6      MOVW	R30,R12
    04E23 80E0      LD	R14,Z
    04E24 01FA      MOVW	R30,R20
    04E25 8020      LD	R2,Z
    04E26 01F6      MOVW	R30,R12
    04E27 9221      ST	Z+,R2
    04E28 016F      MOVW	R12,R30
    04E29 011A      MOVW	R2,R20
    04E2A 5041      SUBI	R20,1
    04E2B 4050      SBCI	R21,0
    04E2C 01F1      MOVW	R30,R2
    04E2D 82E0      ST	Z,R14
    04E2E 16C4      CP	R12,R20
    04E2F 06D5      CPC	R13,R21
    04E30 F388      BCS	0x4E22
    04E31 0185      MOVW	R16,R10
    04E32 940E 48B8 CALL	pop_xgsetF0FC
    04E34 9622      ADIW	R28,2
    04E35 9508      RET
_utoa:
    04E36 940E 48C3 CALL	push_xgsetF0FC
    04E38 0169      MOVW	R12,R18
    04E39 0158      MOVW	R10,R16
    04E3A 84EA      LDD	R14,Y+10
    04E3B 84FB      LDD	R15,Y+11
    04E3C 01A5      MOVW	R20,R10
    04E3D 0197      MOVW	R18,R14
    04E3E 0186      MOVW	R16,R12
    04E3F 940E 47AD CALL	mod16u
    04E41 01B8      MOVW	R22,R16
    04E42 E089      LDI	R24,0x9
    04E43 E090      LDI	R25,0
    04E44 1780      CP	R24,R16
    04E45 0791      CPC	R25,R17
    04E46 F034      BLT	0x4E4D
    04E47 01CB      MOVW	R24,R22
    04E48 96C0      ADIW	R24,0x30
    04E49 01FA      MOVW	R30,R20
    04E4A 9381      ST	Z+,R24
    04E4B 01AF      MOVW	R20,R30
    04E4C C006      RJMP	0x4E53
    04E4D 01CB      MOVW	R24,R22
    04E4E 5A89      SUBI	R24,0xA9
    04E4F 4F9F      SBCI	R25,0xFF
    04E50 01FA      MOVW	R30,R20
    04E51 9381      ST	Z+,R24
    04E52 01AF      MOVW	R20,R30
    04E53 0197      MOVW	R18,R14
    04E54 0186      MOVW	R16,R12
    04E55 940E 47AF CALL	div16u
    04E57 0168      MOVW	R12,R16
    04E58 20CC      TST	R12
    04E59 F719      BNE	0x4E3D
    04E5A 20DD      TST	R13
    04E5B F709      BNE	0x4E3D
    04E5C 012A      MOVW	R4,R20
    04E5D 5041      SUBI	R20,1
    04E5E 4050      SBCI	R21,0
    04E5F 2422      CLR	R2
    04E60 01F2      MOVW	R30,R4
    04E61 8220      ST	Z,R2
    04E62 0165      MOVW	R12,R10
    04E63 C00C      RJMP	0x4E70
    04E64 01F6      MOVW	R30,R12
    04E65 80E0      LD	R14,Z
    04E66 01FA      MOVW	R30,R20
    04E67 8020      LD	R2,Z
    04E68 01F6      MOVW	R30,R12
    04E69 9221      ST	Z+,R2
    04E6A 016F      MOVW	R12,R30
    04E6B 011A      MOVW	R2,R20
    04E6C 5041      SUBI	R20,1
    04E6D 4050      SBCI	R21,0
    04E6E 01F1      MOVW	R30,R2
    04E6F 82E0      ST	Z,R14
    04E70 16C4      CP	R12,R20
    04E71 06D5      CPC	R13,R21
    04E72 F388      BCS	0x4E64
    04E73 0185      MOVW	R16,R10
    04E74 940C 48B8 JMP	pop_xgsetF0FC
_ftoa:
    04E76 940E 477E CALL	push_arg4
    04E78 940E 48C3 CALL	push_xgsetF0FC
    04E7A 9764      SBIW	R28,0x14
    04E7B A0CA      LDD	R12,Y+34
    04E7C A0DB      LDD	R13,Y+35
    04E7D 2422      CLR	R2
    04E7E 2433      CLR	R3
    04E7F 01F6      MOVW	R30,R12
    04E80 8231      STD	Z+1,R3
    04E81 8220      ST	Z,R2
    04E82 8C2E      LDD	R2,Y+30
    04E83 8C3F      LDD	R3,Y+31
    04E84 A048      LDD	R4,Y+32
    04E85 A059      LDD	R5,Y+33
    04E86 EE00      LDI	R16,0xE0
    04E87 E010      LDI	R17,0
    04E88 940E 484B CALL	elpm32
    04E8A 933A      ST	-Y,R19
    04E8B 932A      ST	-Y,R18
    04E8C 931A      ST	-Y,R17
    04E8D 930A      ST	-Y,R16
    04E8E 0181      MOVW	R16,R2
    04E8F 0192      MOVW	R18,R4
    04E90 940E 4C43 CALL	fpcmp2
    04E92 F479      BNE	0x4EA2
    04E93 E380      LDI	R24,0x30
    04E94 9380 08D7 STS	config+46,R24
    04E96 E28E      LDI	R24,0x2E
    04E97 9380 08D8 STS	config+47,R24
    04E99 E380      LDI	R24,0x30
    04E9A 9380 08D9 STS	config+48,R24
    04E9C 2422      CLR	R2
    04E9D 9220 08DA STS	config+49,R2
    04E9F ED07      LDI	R16,0xD7
    04EA0 E018      LDI	R17,0x8
    04EA1 C15E      RJMP	0x5000
    04EA2 8C2E      LDD	R2,Y+30
    04EA3 8C3F      LDD	R3,Y+31
    04EA4 A048      LDD	R4,Y+32
    04EA5 A059      LDD	R5,Y+33
    04EA6 8628      STD	Y+8,R2
    04EA7 8639      STD	Y+9,R3
    04EA8 864A      STD	Y+10,R4
    04EA9 865B      STD	Y+11,R5
    04EAA E187      LDI	R24,0x17
    04EAB E090      LDI	R25,0
    04EAC 8508      LDD	R16,Y+8
    04EAD 8519      LDD	R17,Y+9
    04EAE 852A      LDD	R18,Y+10
    04EAF 853B      LDD	R19,Y+11
    04EB0 938A      ST	-Y,R24
    04EB1 940E 4783 CALL	asr32
    04EB3 2F80      MOV	R24,R16
    04EB4 2799      CLR	R25
    04EB5 578F      SUBI	R24,0x7F
    04EB6 4090      SBCI	R25,0
    04EB7 015C      MOVW	R10,R24
    04EB8 EF4F      LDI	R20,0xFF
    04EB9 EF5F      LDI	R21,0xFF
    04EBA EF6F      LDI	R22,0xFF
    04EBB E070      LDI	R23,0
    04EBC 8428      LDD	R2,Y+8
    04EBD 8439      LDD	R3,Y+9
    04EBE 844A      LDD	R4,Y+10
    04EBF 845B      LDD	R5,Y+11
    04EC0 2224      AND	R2,R20
    04EC1 2235      AND	R3,R21
    04EC2 2246      AND	R4,R22
    04EC3 2257      AND	R5,R23
    04EC4 93EF      PUSH	R30
    04EC5 2DE4      MOV	R30,R4
    04EC6 68E0      ORI	R30,0x80
    04EC7 2E4E      MOV	R4,R30
    04EC8 91EF      POP	R30
    04EC9 8A28      STD	Y+16,R2
    04ECA 8A39      STD	Y+17,R3
    04ECB 8A4A      STD	Y+18,R4
    04ECC 8A5B      STD	Y+19,R5
    04ECD E080      LDI	R24,0
    04ECE 838C      STD	Y+4,R24
    04ECF 838D      STD	Y+5,R24
    04ED0 838E      STD	Y+6,R24
    04ED1 838F      STD	Y+7,R24
    04ED2 E080      LDI	R24,0
    04ED3 878C      STD	Y+12,R24
    04ED4 878D      STD	Y+13,R24
    04ED5 878E      STD	Y+14,R24
    04ED6 878F      STD	Y+15,R24
    04ED7 01C5      MOVW	R24,R10
    04ED8 318F      CPI	R24,0x1F
    04ED9 E0E0      LDI	R30,0
    04EDA 079E      CPC	R25,R30
    04EDB F044      BLT	0x4EE4
    04EDC EF8E      LDI	R24,0xFE
    04EDD EF9F      LDI	R25,0xFF
    04EDE 01F6      MOVW	R30,R12
    04EDF 8391      STD	Z+1,R25
    04EE0 8380      ST	Z,R24
    04EE1 2700      CLR	R16
    04EE2 2711      CLR	R17
    04EE3 C11C      RJMP	0x5000
    04EE4 01C5      MOVW	R24,R10
    04EE5 3E89      CPI	R24,0xE9
    04EE6 EFEF      LDI	R30,0xFF
    04EE7 079E      CPC	R25,R30
    04EE8 F444      BGE	0x4EF1
    04EE9 EF8F      LDI	R24,0xFF
    04EEA EF9F      LDI	R25,0xFF
    04EEB 01F6      MOVW	R30,R12
    04EEC 8391      STD	Z+1,R25
    04EED 8380      ST	Z,R24
    04EEE 2700      CLR	R16
    04EEF 2711      CLR	R17
    04EF0 C10F      RJMP	0x5000
    04EF1 01C5      MOVW	R24,R10
    04EF2 3187      CPI	R24,0x17
    04EF3 E0A0      LDI	R26,0
    04EF4 079A      CPC	R25,R26
    04EF5 F06C      BLT	0x4F03
    04EF6 9747      SBIW	R24,0x17
    04EF7 8908      LDD	R16,Y+16
    04EF8 8919      LDD	R17,Y+17
    04EF9 892A      LDD	R18,Y+18
    04EFA 893B      LDD	R19,Y+19
    04EFB 938A      ST	-Y,R24
    04EFC 940E 494E CALL	lsl32
    04EFE 870C      STD	Y+12,R16
    04EFF 871D      STD	Y+13,R17
    04F00 872E      STD	Y+14,R18
    04F01 873F      STD	Y+15,R19
    04F02 C045      RJMP	0x4F48
    04F03 01C5      MOVW	R24,R10
    04F04 3080      CPI	R24,0
    04F05 E0A0      LDI	R26,0
    04F06 079A      CPC	R25,R26
    04F07 F13C      BLT	0x4F2F
    04F08 E187      LDI	R24,0x17
    04F09 E090      LDI	R25,0
    04F0A 198A      SUB	R24,R10
    04F0B 099B      SBC	R25,R11
    04F0C 8908      LDD	R16,Y+16
    04F0D 8919      LDD	R17,Y+17
    04F0E 892A      LDD	R18,Y+18
    04F0F 893B      LDD	R19,Y+19
    04F10 938A      ST	-Y,R24
    04F11 940E 4783 CALL	asr32
    04F13 870C      STD	Y+12,R16
    04F14 871D      STD	Y+13,R17
    04F15 872E      STD	Y+14,R18
    04F16 873F      STD	Y+15,R19
    04F17 01C5      MOVW	R24,R10
    04F18 9601      ADIW	R24,1
    04F19 8908      LDD	R16,Y+16
    04F1A 8919      LDD	R17,Y+17
    04F1B 892A      LDD	R18,Y+18
    04F1C 893B      LDD	R19,Y+19
    04F1D 938A      ST	-Y,R24
    04F1E 940E 494E CALL	lsl32
    04F20 0118      MOVW	R2,R16
    04F21 0129      MOVW	R4,R18
    04F22 EF4F      LDI	R20,0xFF
    04F23 EF5F      LDI	R21,0xFF
    04F24 EF6F      LDI	R22,0xFF
    04F25 E070      LDI	R23,0
    04F26 2224      AND	R2,R20
    04F27 2235      AND	R3,R21
    04F28 2246      AND	R4,R22
    04F29 2257      AND	R5,R23
    04F2A 822C      STD	Y+4,R2
    04F2B 823D      STD	Y+5,R3
    04F2C 824E      STD	Y+6,R4
    04F2D 825F      STD	Y+7,R5
    04F2E C019      RJMP	0x4F48
    04F2F EF4F      LDI	R20,0xFF
    04F30 EF5F      LDI	R21,0xFF
    04F31 EF6F      LDI	R22,0xFF
    04F32 E070      LDI	R23,0
    04F33 8908      LDD	R16,Y+16
    04F34 8919      LDD	R17,Y+17
    04F35 892A      LDD	R18,Y+18
    04F36 893B      LDD	R19,Y+19
    04F37 2304      AND	R16,R20
    04F38 2315      AND	R17,R21
    04F39 2326      AND	R18,R22
    04F3A 2337      AND	R19,R23
    04F3B 01C5      MOVW	R24,R10
    04F3C 9601      ADIW	R24,1
    04F3D 9580      COM	R24
    04F3E 9590      COM	R25
    04F3F 5F8F      SUBI	R24,0xFF
    04F40 4F9F      SBCI	R25,0xFF
    04F41 938A      ST	-Y,R24
    04F42 940E 4783 CALL	asr32
    04F44 830C      STD	Y+4,R16
    04F45 831D      STD	Y+5,R17
    04F46 832E      STD	Y+6,R18
    04F47 833F      STD	Y+7,R19
    04F48 ED87      LDI	R24,0xD7
    04F49 E098      LDI	R25,0x8
    04F4A 015C      MOVW	R10,R24
    04F4B E040      LDI	R20,0
    04F4C E050      LDI	R21,0
    04F4D E060      LDI	R22,0
    04F4E E070      LDI	R23,0
    04F4F 8428      LDD	R2,Y+8
    04F50 8439      LDD	R3,Y+9
    04F51 844A      LDD	R4,Y+10
    04F52 845B      LDD	R5,Y+11
    04F53 1624      CP	R2,R20
    04F54 0635      CPC	R3,R21
    04F55 0646      CPC	R4,R22
    04F56 0657      CPC	R5,R23
    04F57 F424      BGE	0x4F5C
    04F58 E28D      LDI	R24,0x2D
    04F59 01F5      MOVW	R30,R10
    04F5A 9381      ST	Z+,R24
    04F5B 015F      MOVW	R10,R30
    04F5C 842C      LDD	R2,Y+12
    04F5D 843D      LDD	R3,Y+13
    04F5E 844E      LDD	R4,Y+14
    04F5F 845F      LDD	R5,Y+15
    04F60 9488      BCLR	0
    04F61 2022      TST	R2
    04F62 0432      CPC	R3,R2
    04F63 0442      CPC	R4,R2
    04F64 0452      CPC	R5,R2
    04F65 F429      BNE	0x4F6B
    04F66 E380      LDI	R24,0x30
    04F67 01F5      MOVW	R30,R10
    04F68 9381      ST	Z+,R24
    04F69 015F      MOVW	R10,R30
    04F6A C016      RJMP	0x4F81
    04F6B E08A      LDI	R24,0xA
    04F6C E090      LDI	R25,0
    04F6D 839B      STD	Y+3,R25
    04F6E 838A      STD	Y+2,R24
    04F6F 842C      LDD	R2,Y+12
    04F70 843D      LDD	R3,Y+13
    04F71 844E      LDD	R4,Y+14
    04F72 845F      LDD	R5,Y+15
    04F73 8248      ST	Y,R4
    04F74 8259      STD	Y+1,R5
    04F75 0191      MOVW	R18,R2
    04F76 0185      MOVW	R16,R10
    04F77 940E 4D17 CALL	_ltoa
    04F79 C003      RJMP	0x4F7D
    04F7A 01C5      MOVW	R24,R10
    04F7B 9601      ADIW	R24,1
    04F7C 015C      MOVW	R10,R24
    04F7D 01F5      MOVW	R30,R10
    04F7E 8020      LD	R2,Z
    04F7F 2022      TST	R2
    04F80 F7C9      BNE	0x4F7A
    04F81 E28E      LDI	R24,0x2E
    04F82 01F5      MOVW	R30,R10
    04F83 9381      ST	Z+,R24
    04F84 015F      MOVW	R10,R30
    04F85 802C      LDD	R2,Y+4
    04F86 803D      LDD	R3,Y+5
    04F87 804E      LDD	R4,Y+6
    04F88 805F      LDD	R5,Y+7
    04F89 9488      BCLR	0
    04F8A 2022      TST	R2
    04F8B 0432      CPC	R3,R2
    04F8C 0442      CPC	R4,R2
    04F8D 0452      CPC	R5,R2
    04F8E F421      BNE	0x4F93
    04F8F E380      LDI	R24,0x30
    04F90 9381      ST	Z+,R24
    04F91 015F      MOVW	R10,R30
    04F92 C068      RJMP	0x4FFB
    04F93 ED87      LDI	R24,0xD7
    04F94 E098      LDI	R25,0x8
    04F95 0115      MOVW	R2,R10
    04F96 1A28      SUB	R2,R24
    04F97 0A39      SBC	R3,R25
    04F98 E08F      LDI	R24,0xF
    04F99 E090      LDI	R25,0
    04F9A 1982      SUB	R24,R2
    04F9B 0993      SBC	R25,R3
    04F9C 9701      SBIW	R24,1
    04F9D 2EC8      MOV	R12,R24
    04F9E E087      LDI	R24,7
    04F9F 158C      CP	R24,R12
    04FA0 F408      BCC	0x4FA2
    04FA1 2EC8      MOV	R12,R24
    04FA2 24EE      CLR	R14
    04FA3 C042      RJMP	0x4FE6
    04FA4 E083      LDI	R24,3
    04FA5 E090      LDI	R25,0
    04FA6 810C      LDD	R16,Y+4
    04FA7 811D      LDD	R17,Y+5
    04FA8 812E      LDD	R18,Y+6
    04FA9 813F      LDD	R19,Y+7
    04FAA 938A      ST	-Y,R24
    04FAB 940E 494E CALL	lsl32
    04FAD 0118      MOVW	R2,R16
    04FAE 0129      MOVW	R4,R18
    04FAF 806C      LDD	R6,Y+4
    04FB0 807D      LDD	R7,Y+5
    04FB1 808E      LDD	R8,Y+6
    04FB2 809F      LDD	R9,Y+7
    04FB3 0C66      LSL	R6
    04FB4 1C77      ROL	R7
    04FB5 1C88      ROL	R8
    04FB6 1C99      ROL	R9
    04FB7 0C26      ADD	R2,R6
    04FB8 1C37      ADC	R3,R7
    04FB9 1C48      ADC	R4,R8
    04FBA 1C59      ADC	R5,R9
    04FBB 822C      STD	Y+4,R2
    04FBC 823D      STD	Y+5,R3
    04FBD 824E      STD	Y+6,R4
    04FBE 825F      STD	Y+7,R5
    04FBF E188      LDI	R24,0x18
    04FC0 E090      LDI	R25,0
    04FC1 810C      LDD	R16,Y+4
    04FC2 811D      LDD	R17,Y+5
    04FC3 812E      LDD	R18,Y+6
    04FC4 813F      LDD	R19,Y+7
    04FC5 938A      ST	-Y,R24
    04FC6 940E 4783 CALL	asr32
    04FC8 0118      MOVW	R2,R16
    04FC9 0129      MOVW	R4,R18
    04FCA E340      LDI	R20,0x30
    04FCB E050      LDI	R21,0
    04FCC E060      LDI	R22,0
    04FCD E070      LDI	R23,0
    04FCE 0E24      ADD	R2,R20
    04FCF 1E35      ADC	R3,R21
    04FD0 1E46      ADC	R4,R22
    04FD1 1E57      ADC	R5,R23
    04FD2 01F5      MOVW	R30,R10
    04FD3 9221      ST	Z+,R2
    04FD4 015F      MOVW	R10,R30
    04FD5 EF4F      LDI	R20,0xFF
    04FD6 EF5F      LDI	R21,0xFF
    04FD7 EF6F      LDI	R22,0xFF
    04FD8 E070      LDI	R23,0
    04FD9 802C      LDD	R2,Y+4
    04FDA 803D      LDD	R3,Y+5
    04FDB 804E      LDD	R4,Y+6
    04FDC 805F      LDD	R5,Y+7
    04FDD 2224      AND	R2,R20
    04FDE 2235      AND	R3,R21
    04FDF 2246      AND	R4,R22
    04FE0 2257      AND	R5,R23
    04FE1 822C      STD	Y+4,R2
    04FE2 823D      STD	Y+5,R3
    04FE3 824E      STD	Y+6,R4
    04FE4 825F      STD	Y+7,R5
    04FE5 94E3      INC	R14
    04FE6 14EC      CP	R14,R12
    04FE7 F408      BCC	0x4FE9
    04FE8 CFBB      RJMP	0x4FA4
    04FE9 01C5      MOVW	R24,R10
    04FEA 9701      SBIW	R24,1
    04FEB 015C      MOVW	R10,R24
    04FEC C003      RJMP	0x4FF0
    04FED 01C5      MOVW	R24,R10
    04FEE 9701      SBIW	R24,1
    04FEF 015C      MOVW	R10,R24
    04FF0 01F5      MOVW	R30,R10
    04FF1 8180      LD	R24,Z
    04FF2 3380      CPI	R24,0x30
    04FF3 F421      BNE	0x4FF8
    04FF4 9731      SBIW	R30,1
    04FF5 8180      LD	R24,Z
    04FF6 328E      CPI	R24,0x2E
    04FF7 F7A9      BNE	0x4FED
    04FF8 01C5      MOVW	R24,R10
    04FF9 9601      ADIW	R24,1
    04FFA 015C      MOVW	R10,R24
    04FFB 2422      CLR	R2
    04FFC 01F5      MOVW	R30,R10
    04FFD 8220      ST	Z,R2
    04FFE ED07      LDI	R16,0xD7
    04FFF E018      LDI	R17,0x8
    05000 9664      ADIW	R28,0x14
    05001 940E 48B8 CALL	pop_xgsetF0FC
    05003 9624      ADIW	R28,4
    05004 9508      RET
_isdigit:
    05005 EE85      LDI	R24,0xE5
    05006 E090      LDI	R25,0
    05007 01F8      MOVW	R30,R16
    05008 0FE8      ADD	R30,R24
    05009 1FF9      ADC	R31,R25
    0500A 9106      ELPM	R16,Z
    0500B 2711      CLR	R17
    0500C 7004      ANDI	R16,4
    0500D 7010      ANDI	R17,0
    0500E 9508      RET
_islower:
    0500F EE85      LDI	R24,0xE5
    05010 E090      LDI	R25,0
    05011 01F8      MOVW	R30,R16
    05012 0FE8      ADD	R30,R24
    05013 1FF9      ADC	R31,R25
    05014 9106      ELPM	R16,Z
    05015 2711      CLR	R17
    05016 7002      ANDI	R16,2
    05017 7010      ANDI	R17,0
    05018 9508      RET
_isspace:
    05019 EE85      LDI	R24,0xE5
    0501A E090      LDI	R25,0
    0501B 01F8      MOVW	R30,R16
    0501C 0FE8      ADD	R30,R24
    0501D 1FF9      ADC	R31,R25
    0501E 9106      ELPM	R16,Z
    0501F 2711      CLR	R17
    05020 7100      ANDI	R16,0x10
    05021 7010      ANDI	R17,0
    05022 9508      RET
_toupper:
    05023 934A      ST	-Y,R20
    05024 935A      ST	-Y,R21
    05025 01A8      MOVW	R20,R16
    05026 018A      MOVW	R16,R20
    05027 940E 500F CALL	_islower
    05029 3000      CPI	R16,0
    0502A 0701      CPC	R16,R17
    0502B F031      BEQ	0x5032
    0502C 018A      MOVW	R16,R20
    0502D 5601      SUBI	R16,0x61
    0502E 4010      SBCI	R17,0
    0502F 5B0F      SUBI	R16,0xBF
    05030 4F1F      SBCI	R17,0xFF
    05031 C001      RJMP	0x5033
    05032 018A      MOVW	R16,R20
    05033 9159      LD	R21,Y+
    05034 9149      LD	R20,Y+
    05035 9508      RET
__sdepi:
    05036 91E0 08E6 LDS	R30,config+61
    05038 91F0 08E7 LDS	R31,config+62
    0503A 9301      ST	Z+,R16
    0503B 93F0 08E7 STS	config+62,R31
    0503D 93E0 08E6 STS	config+61,R30
    0503F 9508      RET
_sprintf:
    05040 940E 477E CALL	push_arg4
    05042 92AA      ST	-Y,R10
    05043 92BA      ST	-Y,R11
    05044 9722      SBIW	R28,2
    05045 802C      LDD	R2,Y+4
    05046 803D      LDD	R3,Y+5
    05047 9230 08E7 STS	config+62,R3
    05049 9220 08E6 STS	config+61,R2
    0504B 01CE      MOVW	R24,R28
    0504C 9608      ADIW	R24,0x8
    0504D 015C      MOVW	R10,R24
    0504E 82B9      STD	Y+1,R11
    0504F 82A8      ST	Y,R10
    05050 812E      LDD	R18,Y+6
    05051 813F      LDD	R19,Y+7
    05052 E80C      LDI	R16,0x8C
    05053 E010      LDI	R17,0
    05054 940E 42ED CALL	__print
    05056 2422      CLR	R2
    05057 91E0 08E6 LDS	R30,config+61
    05059 91F0 08E7 LDS	R31,config+62
    0505B 8220      ST	Z,R2
    0505C 802C      LDD	R2,Y+4
    0505D 803D      LDD	R3,Y+5
    0505E 9100 08E6 LDS	R16,config+61
    05060 9110 08E7 LDS	R17,config+62
    05062 1902      SUB	R16,R2
    05063 0913      SBC	R17,R3
    05064 9622      ADIW	R28,2
    05065 90B9      LD	R11,Y+
    05066 90A9      LD	R10,Y+
    05067 9624      ADIW	R28,4
    05068 9508      RET
    05069 940E 48E2 CALL	push_xgsetF00C
    0506B 01B9      MOVW	R22,R18
    0506C 0158      MOVW	R10,R16
    0506D 3F6E      CPI	R22,0xFE
    0506E EFEF      LDI	R30,0xFF
    0506F 077E      CPC	R23,R30
    05070 F419      BNE	0x5074
    05071 EE45      LDI	R20,0xE5
    05072 E051      LDI	R21,1
    05073 C009      RJMP	0x507D
    05074 3F6F      CPI	R22,0xFF
    05075 EFEF      LDI	R30,0xFF
    05076 077E      CPC	R23,R30
    05077 F419      BNE	0x507B
    05078 E040      LDI	R20,0
    05079 E052      LDI	R21,2
    0507A C002      RJMP	0x507D
    0507B E14D      LDI	R20,0x1D
    0507C E052      LDI	R21,2
    0507D 019A      MOVW	R18,R20
    0507E 0185      MOVW	R16,R10
    0507F 940E 4C4F CALL	_cstrcpy
    05081 0185      MOVW	R16,R10
    05082 940C 48E9 JMP	pop_xgsetF00C
__FormatFP_1:
    05084 940E 477E CALL	push_arg4
    05086 940E 48C3 CALL	push_xgsetF0FC
    05088 01B9      MOVW	R22,R18
    05089 97A2      SBIW	R28,0x22
    0508A EF8F      LDI	R24,0xFF
    0508B EF9F      LDI	R25,0xFF
    0508C 015C      MOVW	R10,R24
    0508D 879F      STD	Y+15,R25
    0508E 878E      STD	Y+14,R24
    0508F 8B9B      STD	Y+19,R25
    05090 8B8A      STD	Y+18,R24
    05091 8B99      STD	Y+17,R25
    05092 8B88      STD	Y+16,R24
    05093 8F9E      STD	Y+30,R25
    05094 8F8D      STD	Y+29,R24
    05095 8B9E      STD	Y+22,R25
    05096 8B8D      STD	Y+21,R24
    05097 2400      CLR	R0
    05098 2411      CLR	R1
    05099 8E19      STD	Y+25,R1
    0509A 8E08      STD	Y+24,R0
    0509B 2799      CLR	R25
    0509C A398      STD	Y+32,R25
    0509D 8F8F      STD	Y+31,R24
    0509E 24EE      CLR	R14
    0509F 24FF      CLR	R15
    050A0 2744      CLR	R20
    050A1 2755      CLR	R21
    050A2 E280      LDI	R24,0x20
    050A3 8B8F      STD	Y+23,R24
    050A4 8F8C      STD	Y+28,R24
    050A5 E685      LDI	R24,0x65
    050A6 A389      STD	Y+33,R24
    050A7 E184      LDI	R24,0x14
    050A8 A80E      LDD	R0,Y+54
    050A9 A81F      LDD	R1,Y+55
    050AA 1580      CP	R24,R0
    050AB 0591      CPC	R25,R1
    050AC F414      BGE	0x50AF
    050AD AB9F      STD	Y+55,R25
    050AE AB8E      STD	Y+54,R24
    050AF E184      LDI	R24,0x14
    050B0 E090      LDI	R25,0
    050B1 AC08      LDD	R0,Y+56
    050B2 AC19      LDD	R1,Y+57
    050B3 1580      CP	R24,R0
    050B4 0591      CPC	R25,R1
    050B5 F414      BGE	0x50B8
    050B6 AF99      STD	Y+57,R25
    050B7 AF88      STD	Y+56,R24
    050B8 3060      CPI	R22,0
    050B9 0767      CPC	R22,R23
    050BA F409      BNE	0x50BC
    050BB C084      RJMP	0x5140
    050BC 3061      CPI	R22,1
    050BD E0E0      LDI	R30,0
    050BE 077E      CPC	R23,R30
    050BF F079      BEQ	0x50CF
    050C0 3062      CPI	R22,2
    050C1 E0E0      LDI	R30,0
    050C2 077E      CPC	R23,R30
    050C3 F049      BEQ	0x50CD
    050C4 3063      CPI	R22,3
    050C5 E0E0      LDI	R30,0
    050C6 077E      CPC	R23,R30
    050C7 F061      BEQ	0x50D4
    050C8 3064      CPI	R22,4
    050C9 E0E0      LDI	R30,0
    050CA 077E      CPC	R23,R30
    050CB F031      BEQ	0x50D2
    050CC C073      RJMP	0x5140
    050CD E485      LDI	R24,0x45
    050CE A389      STD	Y+33,R24
    050CF E041      LDI	R20,1
    050D0 E050      LDI	R21,0
    050D1 C06E      RJMP	0x5140
    050D2 E485      LDI	R24,0x45
    050D3 A389      STD	Y+33,R24
    050D4 A828      LDD	R2,Y+48
    050D5 A839      LDD	R3,Y+49
    050D6 A84A      LDD	R4,Y+50
    050D7 A85B      LDD	R5,Y+51
    050D8 8628      STD	Y+8,R2
    050D9 8639      STD	Y+9,R3
    050DA 864A      STD	Y+10,R4
    050DB 865B      STD	Y+11,R5
    050DC A828      LDD	R2,Y+48
    050DD A839      LDD	R3,Y+49
    050DE A84A      LDD	R4,Y+50
    050DF A85B      LDD	R5,Y+51
    050E0 E40E      LDI	R16,0x4E
    050E1 E012      LDI	R17,2
    050E2 940E 484B CALL	elpm32
    050E4 933A      ST	-Y,R19
    050E5 932A      ST	-Y,R18
    050E6 931A      ST	-Y,R17
    050E7 930A      ST	-Y,R16
    050E8 0181      MOVW	R16,R2
    050E9 0192      MOVW	R18,R4
    050EA 940E 4C43 CALL	fpcmp2
    050EC F474      BGE	0x50FB
    050ED E40A      LDI	R16,0x4A
    050EE E012      LDI	R17,2
    050EF 940E 484B CALL	elpm32
    050F1 01CE      MOVW	R24,R28
    050F2 96C0      ADIW	R24,0x30
    050F3 939A      ST	-Y,R25
    050F4 938A      ST	-Y,R24
    050F5 940E 4C09 CALL	fpmule1
    050F7 8708      STD	Y+8,R16
    050F8 8719      STD	Y+9,R17
    050F9 872A      STD	Y+10,R18
    050FA 873B      STD	Y+11,R19
    050FB E406      LDI	R16,0x46
    050FC E012      LDI	R17,2
    050FD 940E 484B CALL	elpm32
    050FF 830A      STD	Y+2,R16
    05100 831B      STD	Y+3,R17
    05101 832C      STD	Y+4,R18
    05102 833D      STD	Y+5,R19
    05103 2400      CLR	R0
    05104 2411      CLR	R1
    05105 861D      STD	Y+13,R1
    05106 860C      STD	Y+12,R0
    05107 C013      RJMP	0x511B
    05108 E402      LDI	R16,0x42
    05109 E012      LDI	R17,2
    0510A 940E 484B CALL	elpm32
    0510C 01CE      MOVW	R24,R28
    0510D 9602      ADIW	R24,2
    0510E 939A      ST	-Y,R25
    0510F 938A      ST	-Y,R24
    05110 940E 4C09 CALL	fpmule1
    05112 830A      STD	Y+2,R16
    05113 831B      STD	Y+3,R17
    05114 832C      STD	Y+4,R18
    05115 833D      STD	Y+5,R19
    05116 858C      LDD	R24,Y+12
    05117 859D      LDD	R25,Y+13
    05118 9601      ADIW	R24,1
    05119 879D      STD	Y+13,R25
    0511A 878C      STD	Y+12,R24
    0511B 840C      LDD	R0,Y+12
    0511C 841D      LDD	R1,Y+13
    0511D AD08      LDD	R16,Y+56
    0511E AD19      LDD	R17,Y+57
    0511F 1600      CP	R0,R16
    05120 0611      CPC	R1,R17
    05121 F334      BLT	0x5108
    05122 8428      LDD	R2,Y+8
    05123 8439      LDD	R3,Y+9
    05124 844A      LDD	R4,Y+10
    05125 845B      LDD	R5,Y+11
    05126 E30E      LDI	R16,0x3E
    05127 E012      LDI	R17,2
    05128 940E 484B CALL	elpm32
    0512A 933A      ST	-Y,R19
    0512B 932A      ST	-Y,R18
    0512C 931A      ST	-Y,R17
    0512D 930A      ST	-Y,R16
    0512E 0181      MOVW	R16,R2
    0512F 0192      MOVW	R18,R4
    05130 940E 4C43 CALL	fpcmp2
    05132 F05C      BLT	0x513E
    05133 01CE      MOVW	R24,R28
    05134 9608      ADIW	R24,0x8
    05135 810A      LDD	R16,Y+2
    05136 811B      LDD	R17,Y+3
    05137 812C      LDD	R18,Y+4
    05138 813D      LDD	R19,Y+5
    05139 939A      ST	-Y,R25
    0513A 938A      ST	-Y,R24
    0513B 940E 4C38 CALL	fpcmp1
    0513D F414      BGE	0x5140
    0513E E041      LDI	R20,1
    0513F E050      LDI	R21,0
    05140 A80C      LDD	R0,Y+52
    05141 A81D      LDD	R1,Y+53
    05142 FE04      SBRS	R0,4
    05143 C002      RJMP	0x5146
    05144 E380      LDI	R24,0x30
    05145 8B8F      STD	Y+23,R24
    05146 880F      LDD	R0,Y+23
    05147 8A0C      STD	Y+20,R0
    05148 A80C      LDD	R0,Y+52
    05149 A81D      LDD	R1,Y+53
    0514A FE03      SBRS	R0,3
    0514B C002      RJMP	0x514E
    0514C E28B      LDI	R24,0x2B
    0514D 8B8C      STD	Y+20,R24
    0514E 3040      CPI	R20,0
    0514F 0745      CPC	R20,R21
    05150 F061      BEQ	0x515D
    05151 01CE      MOVW	R24,R28
    05152 9606      ADIW	R24,6
    05153 8399      STD	Y+1,R25
    05154 8388      ST	Y,R24
    05155 A908      LDD	R16,Y+48
    05156 A919      LDD	R17,Y+49
    05157 A92A      LDD	R18,Y+50
    05158 A93B      LDD	R19,Y+51
    05159 940E 4E76 CALL	_ftoa
    0515B 01B8      MOVW	R22,R16
    0515C C062      RJMP	0x51BF
    0515D E30A      LDI	R16,0x3A
    0515E E012      LDI	R17,2
    0515F 940E 484B CALL	elpm32
    05161 830A      STD	Y+2,R16
    05162 831B      STD	Y+3,R17
    05163 832C      STD	Y+4,R18
    05164 833D      STD	Y+5,R19
    05165 2400      CLR	R0
    05166 2411      CLR	R1
    05167 861D      STD	Y+13,R1
    05168 860C      STD	Y+12,R0
    05169 C019      RJMP	0x5183
    0516A 802A      LDD	R2,Y+2
    0516B 803B      LDD	R3,Y+3
    0516C 804C      LDD	R4,Y+4
    0516D 805D      LDD	R5,Y+5
    0516E E402      LDI	R16,0x42
    0516F E012      LDI	R17,2
    05170 940E 484B CALL	elpm32
    05172 933A      ST	-Y,R19
    05173 932A      ST	-Y,R18
    05174 931A      ST	-Y,R17
    05175 930A      ST	-Y,R16
    05176 0181      MOVW	R16,R2
    05177 0192      MOVW	R18,R4
    05178 940E 4A99 CALL	fpdiv2
    0517A 830A      STD	Y+2,R16
    0517B 831B      STD	Y+3,R17
    0517C 832C      STD	Y+4,R18
    0517D 833D      STD	Y+5,R19
    0517E 858C      LDD	R24,Y+12
    0517F 859D      LDD	R25,Y+13
    05180 9601      ADIW	R24,1
    05181 879D      STD	Y+13,R25
    05182 878C      STD	Y+12,R24
    05183 840C      LDD	R0,Y+12
    05184 841D      LDD	R1,Y+13
    05185 AD08      LDD	R16,Y+56
    05186 AD19      LDD	R17,Y+57
    05187 1600      CP	R0,R16
    05188 0611      CPC	R1,R17
    05189 F304      BLT	0x516A
    0518A A828      LDD	R2,Y+48
    0518B A839      LDD	R3,Y+49
    0518C A84A      LDD	R4,Y+50
    0518D A85B      LDD	R5,Y+51
    0518E E40E      LDI	R16,0x4E
    0518F E012      LDI	R17,2
    05190 940E 484B CALL	elpm32
    05192 933A      ST	-Y,R19
    05193 932A      ST	-Y,R18
    05194 931A      ST	-Y,R17
    05195 930A      ST	-Y,R16
    05196 0181      MOVW	R16,R2
    05197 0192      MOVW	R18,R4
    05198 940E 4C43 CALL	fpcmp2
    0519A F494      BGE	0x51AD
    0519B 01CE      MOVW	R24,R28
    0519C 9606      ADIW	R24,6
    0519D 8399      STD	Y+1,R25
    0519E 8388      ST	Y,R24
    0519F A908      LDD	R16,Y+48
    051A0 A919      LDD	R17,Y+49
    051A1 A92A      LDD	R18,Y+50
    051A2 A93B      LDD	R19,Y+51
    051A3 01CE      MOVW	R24,R28
    051A4 9602      ADIW	R24,2
    051A5 939A      ST	-Y,R25
    051A6 938A      ST	-Y,R24
    051A7 940E 4A0A CALL	fpsub1
    051A9 940E 4E76 CALL	_ftoa
    051AB 01B8      MOVW	R22,R16
    051AC C012      RJMP	0x51BF
    051AD 01CE      MOVW	R24,R28
    051AE 9606      ADIW	R24,6
    051AF 8399      STD	Y+1,R25
    051B0 8388      ST	Y,R24
    051B1 A908      LDD	R16,Y+48
    051B2 A919      LDD	R17,Y+49
    051B3 A92A      LDD	R18,Y+50
    051B4 A93B      LDD	R19,Y+51
    051B5 01CE      MOVW	R24,R28
    051B6 9602      ADIW	R24,2
    051B7 939A      ST	-Y,R25
    051B8 938A      ST	-Y,R24
    051B9 940E 49F5 CALL	fpadd1
    051BB 940E 4E76 CALL	_ftoa
    051BD 0168      MOVW	R12,R16
    051BE 01B6      MOVW	R22,R12
    051BF 802E      LDD	R2,Y+6
    051C0 803F      LDD	R3,Y+7
    051C1 2022      TST	R2
    051C2 F411      BNE	0x51C5
    051C3 2033      TST	R3
    051C4 F031      BEQ	0x51CB
    051C5 0191      MOVW	R18,R2
    051C6 A50C      LDD	R16,Y+44
    051C7 A51D      LDD	R17,Y+45
    051C8 DEA0      RCALL	0x5069
    051C9 0168      MOVW	R12,R16
    051CA C39E      RJMP	0x5569
    051CB 2400      CLR	R0
    051CC 2411      CLR	R1
    051CD 861D      STD	Y+13,R1
    051CE 860C      STD	Y+12,R0
    051CF 3040      CPI	R20,0
    051D0 0745      CPC	R20,R21
    051D1 F481      BNE	0x51E2
    051D2 858E      LDD	R24,Y+14
    051D3 859F      LDD	R25,Y+15
    051D4 3080      CPI	R24,0
    051D5 E0E0      LDI	R30,0
    051D6 079E      CPC	R25,R30
    051D7 F054      BLT	0x51E2
    051D8 842C      LDD	R2,Y+12
    051D9 843D      LDD	R3,Y+13
    051DA 1A28      SUB	R2,R24
    051DB 0A39      SBC	R3,R25
    051DC AC08      LDD	R0,Y+56
    051DD AC19      LDD	R1,Y+57
    051DE 1402      CP	R0,R2
    051DF 0413      CPC	R1,R3
    051E0 F40C      BGE	0x51E2
    051E1 C060      RJMP	0x5242
    051E2 85EC      LDD	R30,Y+12
    051E3 85FD      LDD	R31,Y+13
    051E4 0FE6      ADD	R30,R22
    051E5 1FF7      ADC	R31,R23
    051E6 80C0      LD	R12,Z
    051E7 2D8C      MOV	R24,R12
    051E8 3380      CPI	R24,0x30
    051E9 F1E0      BCS	0x5226
    051EA E389      LDI	R24,0x39
    051EB 158C      CP	R24,R12
    051EC F1C8      BCS	0x5226
    051ED 84AC      LDD	R10,Y+12
    051EE 84BD      LDD	R11,Y+13
    051EF E380      LDI	R24,0x30
    051F0 158C      CP	R24,R12
    051F1 F448      BCC	0x51FB
    051F2 8D8D      LDD	R24,Y+29
    051F3 8D9E      LDD	R25,Y+30
    051F4 3080      CPI	R24,0
    051F5 E0E0      LDI	R30,0
    051F6 079E      CPC	R25,R30
    051F7 F41C      BGE	0x51FB
    051F8 0105      MOVW	R0,R10
    051F9 8E1E      STD	Y+30,R1
    051FA 8E0D      STD	Y+29,R0
    051FB 858E      LDD	R24,Y+14
    051FC 859F      LDD	R25,Y+15
    051FD 3080      CPI	R24,0
    051FE E0E0      LDI	R30,0
    051FF 079E      CPC	R25,R30
    05200 F4C4      BGE	0x5219
    05201 8988      LDD	R24,Y+16
    05202 8999      LDD	R25,Y+17
    05203 3080      CPI	R24,0
    05204 E0E0      LDI	R30,0
    05205 079E      CPC	R25,R30
    05206 F43C      BGE	0x520E
    05207 E380      LDI	R24,0x30
    05208 158C      CP	R24,R12
    05209 F420      BCC	0x520E
    0520A 840C      LDD	R0,Y+12
    0520B 841D      LDD	R1,Y+13
    0520C 8A19      STD	Y+17,R1
    0520D 8A08      STD	Y+16,R0
    0520E 8988      LDD	R24,Y+16
    0520F 8999      LDD	R25,Y+17
    05210 3080      CPI	R24,0
    05211 E0E0      LDI	R30,0
    05212 079E      CPC	R25,R30
    05213 F02C      BLT	0x5219
    05214 8D88      LDD	R24,Y+24
    05215 8D99      LDD	R25,Y+25
    05216 9601      ADIW	R24,1
    05217 8F99      STD	Y+25,R25
    05218 8F88      STD	Y+24,R24
    05219 858E      LDD	R24,Y+14
    0521A 859F      LDD	R25,Y+15
    0521B 3080      CPI	R24,0
    0521C E0E0      LDI	R30,0
    0521D 079E      CPC	R25,R30
    0521E F03C      BLT	0x5226
    0521F E380      LDI	R24,0x30
    05220 158C      CP	R24,R12
    05221 F420      BCC	0x5226
    05222 840C      LDD	R0,Y+12
    05223 841D      LDD	R1,Y+13
    05224 8A1E      STD	Y+22,R1
    05225 8A0D      STD	Y+21,R0
    05226 2D8C      MOV	R24,R12
    05227 328E      CPI	R24,0x2E
    05228 F421      BNE	0x522D
    05229 840C      LDD	R0,Y+12
    0522A 841D      LDD	R1,Y+13
    0522B 861F      STD	Y+15,R1
    0522C 860E      STD	Y+14,R0
    0522D 2D8C      MOV	R24,R12
    0522E 328D      CPI	R24,0x2D
    0522F F429      BNE	0x5235
    05230 E081      LDI	R24,1
    05231 E090      LDI	R25,0
    05232 017C      MOVW	R14,R24
    05233 E28D      LDI	R24,0x2D
    05234 8B8C      STD	Y+20,R24
    05235 20CC      TST	R12
    05236 F409      BNE	0x5238
    05237 C00A      RJMP	0x5242
    05238 858C      LDD	R24,Y+12
    05239 859D      LDD	R25,Y+13
    0523A 9601      ADIW	R24,1
    0523B 879D      STD	Y+13,R25
    0523C 878C      STD	Y+12,R24
    0523D 3184      CPI	R24,0x14
    0523E E0E0      LDI	R30,0
    0523F 079E      CPC	R25,R30
    05240 F40C      BGE	0x5242
    05241 CF8D      RJMP	0x51CF
    05242 858E      LDD	R24,Y+14
    05243 859F      LDD	R25,Y+15
    05244 3080      CPI	R24,0
    05245 E0E0      LDI	R30,0
    05246 079E      CPC	R25,R30
    05247 F43C      BGE	0x524F
    05248 01C5      MOVW	R24,R10
    05249 9601      ADIW	R24,1
    0524A 8B9B      STD	Y+19,R25
    0524B 8B8A      STD	Y+18,R24
    0524C 9601      ADIW	R24,1
    0524D 015C      MOVW	R10,R24
    0524E C012      RJMP	0x5261
    0524F 840E      LDD	R0,Y+14
    05250 841F      LDD	R1,Y+15
    05251 8A1B      STD	Y+19,R1
    05252 8A0A      STD	Y+18,R0
    05253 898D      LDD	R24,Y+21
    05254 899E      LDD	R25,Y+22
    05255 3080      CPI	R24,0
    05256 E0E0      LDI	R30,0
    05257 079E      CPC	R25,R30
    05258 F424      BGE	0x525D
    05259 01C0      MOVW	R24,R0
    0525A 9601      ADIW	R24,1
    0525B 015C      MOVW	R10,R24
    0525C C004      RJMP	0x5261
    0525D 898D      LDD	R24,Y+21
    0525E 899E      LDD	R25,Y+22
    0525F 9601      ADIW	R24,1
    05260 015C      MOVW	R10,R24
    05261 8988      LDD	R24,Y+16
    05262 8999      LDD	R25,Y+17
    05263 3080      CPI	R24,0
    05264 E0E0      LDI	R30,0
    05265 079E      CPC	R25,R30
    05266 F42C      BGE	0x526C
    05267 898A      LDD	R24,Y+18
    05268 899B      LDD	R25,Y+19
    05269 9701      SBIW	R24,1
    0526A 8B99      STD	Y+17,R25
    0526B 8B88      STD	Y+16,R24
    0526C 3040      CPI	R20,0
    0526D 0745      CPC	R20,R21
    0526E F409      BNE	0x5270
    0526F C1D2      RJMP	0x5442
    05270 2400      CLR	R0
    05271 2411      CLR	R1
    05272 861D      STD	Y+13,R1
    05273 860C      STD	Y+12,R0
    05274 880C      LDD	R0,Y+20
    05275 890F      LDD	R16,Y+23
    05276 1600      CP	R0,R16
    05277 F069      BEQ	0x5285
    05278 854C      LDD	R20,Y+12
    05279 855D      LDD	R21,Y+13
    0527A 01CA      MOVW	R24,R20
    0527B 9601      ADIW	R24,1
    0527C 879D      STD	Y+13,R25
    0527D 878C      STD	Y+12,R24
    0527E 01FA      MOVW	R30,R20
    0527F A40C      LDD	R0,Y+44
    05280 A41D      LDD	R1,Y+45
    05281 0DE0      ADD	R30,R0
    05282 1DF1      ADC	R31,R1
    05283 880C      LDD	R0,Y+20
    05284 8200      ST	Z,R0
    05285 854C      LDD	R20,Y+12
    05286 855D      LDD	R21,Y+13
    05287 01CA      MOVW	R24,R20
    05288 9601      ADIW	R24,1
    05289 879D      STD	Y+13,R25
    0528A 878C      STD	Y+12,R24
    0528B 8DED      LDD	R30,Y+29
    0528C 8DFE      LDD	R31,Y+30
    0528D 0FE6      ADD	R30,R22
    0528E 1FF7      ADC	R31,R23
    0528F 8020      LD	R2,Z
    05290 01FA      MOVW	R30,R20
    05291 A40C      LDD	R0,Y+44
    05292 A41D      LDD	R1,Y+45
    05293 0DE0      ADD	R30,R0
    05294 1DF1      ADC	R31,R1
    05295 8220      ST	Z,R2
    05296 01FC      MOVW	R30,R24
    05297 0DE0      ADD	R30,R0
    05298 1DF1      ADC	R31,R1
    05299 E28E      LDI	R24,0x2E
    0529A 8380      ST	Z,R24
    0529B 2422      CLR	R2
    0529C 2433      CLR	R3
    0529D AC08      LDD	R0,Y+56
    0529E AC19      LDD	R1,Y+57
    0529F 1420      CP	R2,R0
    052A0 0431      CPC	R3,R1
    052A1 F42C      BGE	0x52A7
    052A2 858C      LDD	R24,Y+12
    052A3 859D      LDD	R25,Y+13
    052A4 9601      ADIW	R24,1
    052A5 879D      STD	Y+13,R25
    052A6 878C      STD	Y+12,R24
    052A7 8D4D      LDD	R20,Y+29
    052A8 8D5E      LDD	R21,Y+30
    052A9 5F4F      SUBI	R20,0xFF
    052AA 4F5F      SBCI	R21,0xFF
    052AB 24CC      CLR	R12
    052AC 24DD      CLR	R13
    052AD C034      RJMP	0x52E2
    052AE 880A      LDD	R0,Y+18
    052AF 881B      LDD	R1,Y+19
    052B0 1540      CP	R20,R0
    052B1 0551      CPC	R21,R1
    052B2 F409      BNE	0x52B4
    052B3 C02C      RJMP	0x52E0
    052B4 154A      CP	R20,R10
    052B5 055B      CPC	R21,R11
    052B6 F48C      BGE	0x52C8
    052B7 84EC      LDD	R14,Y+12
    052B8 84FD      LDD	R15,Y+13
    052B9 01C7      MOVW	R24,R14
    052BA 9601      ADIW	R24,1
    052BB 879D      STD	Y+13,R25
    052BC 878C      STD	Y+12,R24
    052BD 01FA      MOVW	R30,R20
    052BE 0FE6      ADD	R30,R22
    052BF 1FF7      ADC	R31,R23
    052C0 8020      LD	R2,Z
    052C1 01F7      MOVW	R30,R14
    052C2 A40C      LDD	R0,Y+44
    052C3 A41D      LDD	R1,Y+45
    052C4 0DE0      ADD	R30,R0
    052C5 1DF1      ADC	R31,R1
    052C6 8220      ST	Z,R2
    052C7 C015      RJMP	0x52DD
    052C8 A80C      LDD	R0,Y+52
    052C9 A81D      LDD	R1,Y+53
    052CA FC00      SBRC	R0,0
    052CB C004      RJMP	0x52D0
    052CC 20CC      TST	R12
    052CD F501      BNE	0x52EE
    052CE 20DD      TST	R13
    052CF F4F1      BNE	0x52EE
    052D0 84EC      LDD	R14,Y+12
    052D1 84FD      LDD	R15,Y+13
    052D2 01C7      MOVW	R24,R14
    052D3 9601      ADIW	R24,1
    052D4 879D      STD	Y+13,R25
    052D5 878C      STD	Y+12,R24
    052D6 01F7      MOVW	R30,R14
    052D7 A40C      LDD	R0,Y+44
    052D8 A41D      LDD	R1,Y+45
    052D9 0DE0      ADD	R30,R0
    052DA 1DF1      ADC	R31,R1
    052DB E380      LDI	R24,0x30
    052DC 8380      ST	Z,R24
    052DD 01C6      MOVW	R24,R12
    052DE 9601      ADIW	R24,1
    052DF 016C      MOVW	R12,R24
    052E0 5F4F      SUBI	R20,0xFF
    052E1 4F5F      SBCI	R21,0xFF
    052E2 AC08      LDD	R0,Y+56
    052E3 AC19      LDD	R1,Y+57
    052E4 14C0      CP	R12,R0
    052E5 04D1      CPC	R13,R1
    052E6 F43C      BGE	0x52EE
    052E7 858C      LDD	R24,Y+12
    052E8 859D      LDD	R25,Y+13
    052E9 308E      CPI	R24,0xE
    052EA E0E0      LDI	R30,0
    052EB 079E      CPC	R25,R30
    052EC F40C      BGE	0x52EE
    052ED CFC0      RJMP	0x52AE
    052EE 858C      LDD	R24,Y+12
    052EF 859D      LDD	R25,Y+13
    052F0 9701      SBIW	R24,1
    052F1 016C      MOVW	R12,R24
    052F2 AC08      LDD	R0,Y+56
    052F3 AC19      LDD	R1,Y+57
    052F4 2000      TST	R0
    052F5 F421      BNE	0x52FA
    052F6 2011      TST	R1
    052F7 F411      BNE	0x52FA
    052F8 84CC      LDD	R12,Y+12
    052F9 84DD      LDD	R13,Y+13
    052FA 898A      LDD	R24,Y+18
    052FB 899B      LDD	R25,Y+19
    052FC 8C0D      LDD	R0,Y+29
    052FD 8C1E      LDD	R1,Y+30
    052FE 1980      SUB	R24,R0
    052FF 0991      SBC	R25,R1
    05300 9701      SBIW	R24,1
    05301 A398      STD	Y+32,R25
    05302 8F8F      STD	Y+31,R24
    05303 154A      CP	R20,R10
    05304 055B      CPC	R21,R11
    05305 F444      BGE	0x530E
    05306 01FA      MOVW	R30,R20
    05307 0FE6      ADD	R30,R22
    05308 1FF7      ADC	R31,R23
    05309 8180      LD	R24,Z
    0530A 328E      CPI	R24,0x2E
    0530B F411      BNE	0x530E
    0530C 5F4F      SUBI	R20,0xFF
    0530D 4F5F      SBCI	R21,0xFF
    0530E 154A      CP	R20,R10
    0530F 055B      CPC	R21,R11
    05310 F00C      BLT	0x5312
    05311 C06B      RJMP	0x537D
    05312 01FA      MOVW	R30,R20
    05313 0FE6      ADD	R30,R22
    05314 1FF7      ADC	R31,R23
    05315 80E0      LD	R14,Z
    05316 24FF      CLR	R15
    05317 2D8E      MOV	R24,R14
    05318 3385      CPI	R24,0x35
    05319 F408      BCC	0x531B
    0531A C062      RJMP	0x537D
    0531B E389      LDI	R24,0x39
    0531C 158E      CP	R24,R14
    0531D F408      BCC	0x531F
    0531E C05E      RJMP	0x537D
    0531F C057      RJMP	0x5377
    05320 01F6      MOVW	R30,R12
    05321 A40C      LDD	R0,Y+44
    05322 A41D      LDD	R1,Y+45
    05323 0DE0      ADD	R30,R0
    05324 1DF1      ADC	R31,R1
    05325 80E0      LD	R14,Z
    05326 24FF      CLR	R15
    05327 2D8E      MOV	R24,R14
    05328 3380      CPI	R24,0x30
    05329 F058      BCS	0x5335
    0532A E388      LDI	R24,0x38
    0532B 158E      CP	R24,R14
    0532C F040      BCS	0x5335
    0532D 0176      MOVW	R14,R12
    0532E 0CE0      ADD	R14,R0
    0532F 1CF1      ADC	R15,R1
    05330 01F7      MOVW	R30,R14
    05331 8180      LD	R24,Z
    05332 5F8F      SUBI	R24,0xFF
    05333 8380      ST	Z,R24
    05334 C048      RJMP	0x537D
    05335 01F6      MOVW	R30,R12
    05336 A40C      LDD	R0,Y+44
    05337 A41D      LDD	R1,Y+45
    05338 0DE0      ADD	R30,R0
    05339 1DF1      ADC	R31,R1
    0533A 8180      LD	R24,Z
    0533B 328E      CPI	R24,0x2E
    0533C F009      BEQ	0x533E
    0533D C029      RJMP	0x5367
    0533E 01C6      MOVW	R24,R12
    0533F 9701      SBIW	R24,1
    05340 016C      MOVW	R12,R24
    05341 01FC      MOVW	R30,R24
    05342 0DE0      ADD	R30,R0
    05343 1DF1      ADC	R31,R1
    05344 80E0      LD	R14,Z
    05345 24FF      CLR	R15
    05346 2D8E      MOV	R24,R14
    05347 3380      CPI	R24,0x30
    05348 F058      BCS	0x5354
    05349 E388      LDI	R24,0x38
    0534A 158E      CP	R24,R14
    0534B F040      BCS	0x5354
    0534C 0176      MOVW	R14,R12
    0534D 0CE0      ADD	R14,R0
    0534E 1CF1      ADC	R15,R1
    0534F 01F7      MOVW	R30,R14
    05350 8180      LD	R24,Z
    05351 5F8F      SUBI	R24,0xFF
    05352 8380      ST	Z,R24
    05353 C029      RJMP	0x537D
    05354 01F6      MOVW	R30,R12
    05355 A40C      LDD	R0,Y+44
    05356 A41D      LDD	R1,Y+45
    05357 0DE0      ADD	R30,R0
    05358 1DF1      ADC	R31,R1
    05359 8180      LD	R24,Z
    0535A 3389      CPI	R24,0x39
    0535B F459      BNE	0x5367
    0535C 01F6      MOVW	R30,R12
    0535D 0DE0      ADD	R30,R0
    0535E 1DF1      ADC	R31,R1
    0535F E381      LDI	R24,0x31
    05360 8380      ST	Z,R24
    05361 8D8F      LDD	R24,Y+31
    05362 A198      LDD	R25,Y+32
    05363 9601      ADIW	R24,1
    05364 A398      STD	Y+32,R25
    05365 8F8F      STD	Y+31,R24
    05366 C016      RJMP	0x537D
    05367 01F6      MOVW	R30,R12
    05368 A40C      LDD	R0,Y+44
    05369 A41D      LDD	R1,Y+45
    0536A 0DE0      ADD	R30,R0
    0536B 1DF1      ADC	R31,R1
    0536C 8180      LD	R24,Z
    0536D 3389      CPI	R24,0x39
    0536E F429      BNE	0x5374
    0536F 01F6      MOVW	R30,R12
    05370 0DE0      ADD	R30,R0
    05371 1DF1      ADC	R31,R1
    05372 E380      LDI	R24,0x30
    05373 8380      ST	Z,R24
    05374 01C6      MOVW	R24,R12
    05375 9701      SBIW	R24,1
    05376 016C      MOVW	R12,R24
    05377 01C6      MOVW	R24,R12
    05378 3080      CPI	R24,0
    05379 E0E0      LDI	R30,0
    0537A 079E      CPC	R25,R30
    0537B F00C      BLT	0x537D
    0537C CFA3      RJMP	0x5320
    0537D 84CC      LDD	R12,Y+12
    0537E 84DD      LDD	R13,Y+13
    0537F 01C6      MOVW	R24,R12
    05380 9601      ADIW	R24,1
    05381 879D      STD	Y+13,R25
    05382 878C      STD	Y+12,R24
    05383 01F6      MOVW	R30,R12
    05384 A40C      LDD	R0,Y+44
    05385 A41D      LDD	R1,Y+45
    05386 0DE0      ADD	R30,R0
    05387 1DF1      ADC	R31,R1
    05388 A009      LDD	R0,Y+33
    05389 8200      ST	Z,R0
    0538A 8D8F      LDD	R24,Y+31
    0538B A198      LDD	R25,Y+32
    0538C 3080      CPI	R24,0
    0538D E0E0      LDI	R30,0
    0538E 079E      CPC	R25,R30
    0538F F49C      BGE	0x53A3
    05390 84CC      LDD	R12,Y+12
    05391 84DD      LDD	R13,Y+13
    05392 01C6      MOVW	R24,R12
    05393 9601      ADIW	R24,1
    05394 879D      STD	Y+13,R25
    05395 878C      STD	Y+12,R24
    05396 01F6      MOVW	R30,R12
    05397 A40C      LDD	R0,Y+44
    05398 A41D      LDD	R1,Y+45
    05399 0DE0      ADD	R30,R0
    0539A 1DF1      ADC	R31,R1
    0539B E28D      LDI	R24,0x2D
    0539C 8380      ST	Z,R24
    0539D 8C0F      LDD	R0,Y+31
    0539E A018      LDD	R1,Y+32
    0539F 9400      COM	R0
    053A0 9410      COM	R1
    053A1 A218      STD	Y+32,R1
    053A2 8E0F      STD	Y+31,R0
    053A3 E08A      LDI	R24,0xA
    053A4 E090      LDI	R25,0
    053A5 8399      STD	Y+1,R25
    053A6 8388      ST	Y,R24
    053A7 8D2F      LDD	R18,Y+31
    053A8 A138      LDD	R19,Y+32
    053A9 850C      LDD	R16,Y+12
    053AA 851D      LDD	R17,Y+13
    053AB A40C      LDD	R0,Y+44
    053AC A41D      LDD	R1,Y+45
    053AD 0D00      ADD	R16,R0
    053AE 1D11      ADC	R17,R1
    053AF 940E 4CAC CALL	_itoa
    053B1 2400      CLR	R0
    053B2 2411      CLR	R1
    053B3 861D      STD	Y+13,R1
    053B4 860C      STD	Y+12,R0
    053B5 85EC      LDD	R30,Y+12
    053B6 85FD      LDD	R31,Y+13
    053B7 A40C      LDD	R0,Y+44
    053B8 A41D      LDD	R1,Y+45
    053B9 0DE0      ADD	R30,R0
    053BA 1DF1      ADC	R31,R1
    053BB 8020      LD	R2,Z
    053BC 2022      TST	R2
    053BD F429      BNE	0x53C3
    053BE 840C      LDD	R0,Y+12
    053BF 841D      LDD	R1,Y+13
    053C0 8E1B      STD	Y+27,R1
    053C1 8E0A      STD	Y+26,R0
    053C2 C009      RJMP	0x53CC
    053C3 858C      LDD	R24,Y+12
    053C4 859D      LDD	R25,Y+13
    053C5 9601      ADIW	R24,1
    053C6 879D      STD	Y+13,R25
    053C7 878C      STD	Y+12,R24
    053C8 3184      CPI	R24,0x14
    053C9 E0E0      LDI	R30,0
    053CA 079E      CPC	R25,R30
    053CB F34C      BLT	0x53B5
    053CC A80C      LDD	R0,Y+52
    053CD A81D      LDD	R1,Y+53
    053CE FE02      SBRS	R0,2
    053CF C021      RJMP	0x53F1
    053D0 8C0A      LDD	R0,Y+26
    053D1 8C1B      LDD	R1,Y+27
    053D2 A90E      LDD	R16,Y+54
    053D3 A91F      LDD	R17,Y+55
    053D4 1600      CP	R0,R16
    053D5 0611      CPC	R1,R17
    053D6 F00C      BLT	0x53D8
    053D7 C18F      RJMP	0x5567
    053D8 01A0      MOVW	R20,R0
    053D9 C009      RJMP	0x53E3
    053DA 01FA      MOVW	R30,R20
    053DB A40C      LDD	R0,Y+44
    053DC A41D      LDD	R1,Y+45
    053DD 0DE0      ADD	R30,R0
    053DE 1DF1      ADC	R31,R1
    053DF 8C0C      LDD	R0,Y+28
    053E0 8200      ST	Z,R0
    053E1 5F4F      SUBI	R20,0xFF
    053E2 4F5F      SBCI	R21,0xFF
    053E3 A80E      LDD	R0,Y+54
    053E4 A81F      LDD	R1,Y+55
    053E5 1540      CP	R20,R0
    053E6 0551      CPC	R21,R1
    053E7 F394      BLT	0x53DA
    053E8 01F0      MOVW	R30,R0
    053E9 9731      SBIW	R30,1
    053EA A40C      LDD	R0,Y+44
    053EB A41D      LDD	R1,Y+45
    053EC 0DE0      ADD	R30,R0
    053ED 1DF1      ADC	R31,R1
    053EE 2422      CLR	R2
    053EF 8220      ST	Z,R2
    053F0 C176      RJMP	0x5567
    053F1 8C0A      LDD	R0,Y+26
    053F2 8C1B      LDD	R1,Y+27
    053F3 A90E      LDD	R16,Y+54
    053F4 A91F      LDD	R17,Y+55
    053F5 1600      CP	R0,R16
    053F6 0611      CPC	R1,R17
    053F7 F00C      BLT	0x53F9
    053F8 C16E      RJMP	0x5567
    053F9 01A0      MOVW	R20,R0
    053FA C014      RJMP	0x540F
    053FB 01FA      MOVW	R30,R20
    053FC A80E      LDD	R0,Y+54
    053FD A81F      LDD	R1,Y+55
    053FE 0DE0      ADD	R30,R0
    053FF 1DF1      ADC	R31,R1
    05400 8C0A      LDD	R0,Y+26
    05401 8C1B      LDD	R1,Y+27
    05402 19E0      SUB	R30,R0
    05403 09F1      SBC	R31,R1
    05404 A40C      LDD	R0,Y+44
    05405 A41D      LDD	R1,Y+45
    05406 0DE0      ADD	R30,R0
    05407 1DF1      ADC	R31,R1
    05408 01DA      MOVW	R26,R20
    05409 0DA0      ADD	R26,R0
    0540A 1DB1      ADC	R27,R1
    0540B 902C      LD	R2,X
    0540C 8220      ST	Z,R2
    0540D 5041      SUBI	R20,1
    0540E 4050      SBCI	R21,0
    0540F 3040      CPI	R20,0
    05410 E0E0      LDI	R30,0
    05411 075E      CPC	R21,R30
    05412 F744      BGE	0x53FB
    05413 A94E      LDD	R20,Y+54
    05414 A95F      LDD	R21,Y+55
    05415 8C0A      LDD	R0,Y+26
    05416 8C1B      LDD	R1,Y+27
    05417 1940      SUB	R20,R0
    05418 0951      SBC	R21,R1
    05419 5041      SUBI	R20,1
    0541A 4050      SBCI	R21,0
    0541B C009      RJMP	0x5425
    0541C 01FA      MOVW	R30,R20
    0541D A40C      LDD	R0,Y+44
    0541E A41D      LDD	R1,Y+45
    0541F 0DE0      ADD	R30,R0
    05420 1DF1      ADC	R31,R1
    05421 880F      LDD	R0,Y+23
    05422 8200      ST	Z,R0
    05423 5041      SUBI	R20,1
    05424 4050      SBCI	R21,0
    05425 3040      CPI	R20,0
    05426 E0E0      LDI	R30,0
    05427 075E      CPC	R21,R30
    05428 F79C      BGE	0x541C
    05429 A80C      LDD	R0,Y+52
    0542A A81D      LDD	R1,Y+53
    0542B FE04      SBRS	R0,4
    0542C C13A      RJMP	0x5567
    0542D 880C      LDD	R0,Y+20
    0542E 890F      LDD	R16,Y+23
    0542F 1600      CP	R0,R16
    05430 F409      BNE	0x5432
    05431 C135      RJMP	0x5567
    05432 A5EC      LDD	R30,Y+44
    05433 A5FD      LDD	R31,Y+45
    05434 8200      ST	Z,R0
    05435 A9EE      LDD	R30,Y+54
    05436 A9FF      LDD	R31,Y+55
    05437 8C0A      LDD	R0,Y+26
    05438 8C1B      LDD	R1,Y+27
    05439 19E0      SUB	R30,R0
    0543A 09F1      SBC	R31,R1
    0543B A40C      LDD	R0,Y+44
    0543C A41D      LDD	R1,Y+45
    0543D 0DE0      ADD	R30,R0
    0543E 1DF1      ADC	R31,R1
    0543F 2E00      MOV	R0,R16
    05440 8200      ST	Z,R0
    05441 C125      RJMP	0x5567
    05442 A80C      LDD	R0,Y+52
    05443 A81D      LDD	R1,Y+53
    05444 FE00      SBRS	R0,0
    05445 C010      RJMP	0x5456
    05446 882A      LDD	R2,Y+18
    05447 883B      LDD	R3,Y+19
    05448 AC08      LDD	R0,Y+56
    05449 AC19      LDD	R1,Y+57
    0544A 0C20      ADD	R2,R0
    0544B 1C31      ADC	R3,R1
    0544C 142A      CP	R2,R10
    0544D 043B      CPC	R3,R11
    0544E F07C      BLT	0x545E
    0544F 898A      LDD	R24,Y+18
    05450 899B      LDD	R25,Y+19
    05451 0D80      ADD	R24,R0
    05452 1D91      ADC	R25,R1
    05453 9601      ADIW	R24,1
    05454 015C      MOVW	R10,R24
    05455 C008      RJMP	0x545E
    05456 898A      LDD	R24,Y+18
    05457 899B      LDD	R25,Y+19
    05458 9601      ADIW	R24,1
    05459 16A8      CP	R10,R24
    0545A 06B9      CPC	R11,R25
    0545B F411      BNE	0x545E
    0545C 88AA      LDD	R10,Y+18
    0545D 88BB      LDD	R11,Y+19
    0545E E184      LDI	R24,0x14
    0545F E090      LDI	R25,0
    05460 158A      CP	R24,R10
    05461 059B      CPC	R25,R11
    05462 F40C      BGE	0x5464
    05463 015C      MOVW	R10,R24
    05464 0115      MOVW	R2,R10
    05465 8808      LDD	R0,Y+16
    05466 8819      LDD	R1,Y+17
    05467 1820      SUB	R2,R0
    05468 0831      SBC	R3,R1
    05469 8E3B      STD	Y+27,R3
    0546A 8E2A      STD	Y+26,R2
    0546B 880C      LDD	R0,Y+20
    0546C 890F      LDD	R16,Y+23
    0546D 1600      CP	R0,R16
    0546E F021      BEQ	0x5473
    0546F 01C1      MOVW	R24,R2
    05470 9601      ADIW	R24,1
    05471 8F9B      STD	Y+27,R25
    05472 8F8A      STD	Y+26,R24
    05473 A80E      LDD	R0,Y+54
    05474 A81F      LDD	R1,Y+55
    05475 8D0A      LDD	R16,Y+26
    05476 8D1B      LDD	R17,Y+27
    05477 1600      CP	R0,R16
    05478 0611      CPC	R1,R17
    05479 F41C      BGE	0x547D
    0547A 0108      MOVW	R0,R16
    0547B AA1F      STD	Y+55,R1
    0547C AA0E      STD	Y+54,R0
    0547D E184      LDI	R24,0x14
    0547E E090      LDI	R25,0
    0547F A80E      LDD	R0,Y+54
    05480 A81F      LDD	R1,Y+55
    05481 1580      CP	R24,R0
    05482 0591      CPC	R25,R1
    05483 F414      BGE	0x5486
    05484 AB9F      STD	Y+55,R25
    05485 AB8E      STD	Y+54,R24
    05486 E184      LDI	R24,0x14
    05487 E090      LDI	R25,0
    05488 8C0A      LDD	R0,Y+26
    05489 8C1B      LDD	R1,Y+27
    0548A 1580      CP	R24,R0
    0548B 0591      CPC	R25,R1
    0548C F414      BGE	0x548F
    0548D 8F9B      STD	Y+27,R25
    0548E 8F8A      STD	Y+26,R24
    0548F A80C      LDD	R0,Y+52
    05490 A81D      LDD	R1,Y+53
    05491 FC02      SBRC	R0,2
    05492 C007      RJMP	0x549A
    05493 A80E      LDD	R0,Y+54
    05494 A81F      LDD	R1,Y+55
    05495 8D0A      LDD	R16,Y+26
    05496 8D1B      LDD	R17,Y+27
    05497 1600      CP	R0,R16
    05498 0611      CPC	R1,R17
    05499 F471      BNE	0x54A8
    0549A 24CC      CLR	R12
    0549B 24DD      CLR	R13
    0549C 880C      LDD	R0,Y+20
    0549D 890F      LDD	R16,Y+23
    0549E 1600      CP	R0,R16
    0549F F409      BNE	0x54A1
    054A0 C033      RJMP	0x54D4
    054A1 A5EC      LDD	R30,Y+44
    054A2 A5FD      LDD	R31,Y+45
    054A3 8200      ST	Z,R0
    054A4 E081      LDI	R24,1
    054A5 E090      LDI	R25,0
    054A6 016C      MOVW	R12,R24
    054A7 C02C      RJMP	0x54D4
    054A8 A8CE      LDD	R12,Y+54
    054A9 A8DF      LDD	R13,Y+55
    054AA 8C0A      LDD	R0,Y+26
    054AB 8C1B      LDD	R1,Y+27
    054AC 18C0      SUB	R12,R0
    054AD 08D1      SBC	R13,R1
    054AE 2744      CLR	R20
    054AF 2755      CLR	R21
    054B0 C009      RJMP	0x54BA
    054B1 01FA      MOVW	R30,R20
    054B2 A40C      LDD	R0,Y+44
    054B3 A41D      LDD	R1,Y+45
    054B4 0DE0      ADD	R30,R0
    054B5 1DF1      ADC	R31,R1
    054B6 880F      LDD	R0,Y+23
    054B7 8200      ST	Z,R0
    054B8 5F4F      SUBI	R20,0xFF
    054B9 4F5F      SBCI	R21,0xFF
    054BA 16C4      CP	R12,R20
    054BB 06D5      CPC	R13,R21
    054BC F7A4      BGE	0x54B1
    054BD 880C      LDD	R0,Y+20
    054BE 890F      LDD	R16,Y+23
    054BF 1600      CP	R0,R16
    054C0 F099      BEQ	0x54D4
    054C1 A80C      LDD	R0,Y+52
    054C2 A81D      LDD	R1,Y+53
    054C3 FE04      SBRS	R0,4
    054C4 C005      RJMP	0x54CA
    054C5 A5EC      LDD	R30,Y+44
    054C6 A5FD      LDD	R31,Y+45
    054C7 880C      LDD	R0,Y+20
    054C8 8200      ST	Z,R0
    054C9 C007      RJMP	0x54D1
    054CA 01F6      MOVW	R30,R12
    054CB A40C      LDD	R0,Y+44
    054CC A41D      LDD	R1,Y+45
    054CD 0DE0      ADD	R30,R0
    054CE 1DF1      ADC	R31,R1
    054CF 880C      LDD	R0,Y+20
    054D0 8200      ST	Z,R0
    054D1 01C6      MOVW	R24,R12
    054D2 9601      ADIW	R24,1
    054D3 016C      MOVW	R12,R24
    054D4 01A6      MOVW	R20,R12
    054D5 8C08      LDD	R0,Y+24
    054D6 8C19      LDD	R1,Y+25
    054D7 2000      TST	R0
    054D8 F459      BNE	0x54E4
    054D9 2011      TST	R1
    054DA F449      BNE	0x54E4
    054DB 01FA      MOVW	R30,R20
    054DC A40C      LDD	R0,Y+44
    054DD A41D      LDD	R1,Y+45
    054DE 0DE0      ADD	R30,R0
    054DF 1DF1      ADC	R31,R1
    054E0 E380      LDI	R24,0x30
    054E1 8380      ST	Z,R24
    054E2 5F4F      SUBI	R20,0xFF
    054E3 4F5F      SBCI	R21,0xFF
    054E4 2400      CLR	R0
    054E5 2411      CLR	R1
    054E6 861D      STD	Y+13,R1
    054E7 860C      STD	Y+12,R0
    054E8 C016      RJMP	0x54FF
    054E9 842C      LDD	R2,Y+12
    054EA 843D      LDD	R3,Y+13
    054EB 0E26      ADD	R2,R22
    054EC 1E37      ADC	R3,R23
    054ED 89E8      LDD	R30,Y+16
    054EE 89F9      LDD	R31,Y+17
    054EF 0DE2      ADD	R30,R2
    054F0 1DF3      ADC	R31,R3
    054F1 8020      LD	R2,Z
    054F2 01FA      MOVW	R30,R20
    054F3 A40C      LDD	R0,Y+44
    054F4 A41D      LDD	R1,Y+45
    054F5 0DE0      ADD	R30,R0
    054F6 1DF1      ADC	R31,R1
    054F7 8220      ST	Z,R2
    054F8 5F4F      SUBI	R20,0xFF
    054F9 4F5F      SBCI	R21,0xFF
    054FA 858C      LDD	R24,Y+12
    054FB 859D      LDD	R25,Y+13
    054FC 9601      ADIW	R24,1
    054FD 879D      STD	Y+13,R25
    054FE 878C      STD	Y+12,R24
    054FF 840C      LDD	R0,Y+12
    05500 841D      LDD	R1,Y+13
    05501 8D08      LDD	R16,Y+24
    05502 8D19      LDD	R17,Y+25
    05503 1600      CP	R0,R16
    05504 0611      CPC	R1,R17
    05505 F31C      BLT	0x54E9
    05506 880A      LDD	R0,Y+18
    05507 881B      LDD	R1,Y+19
    05508 140A      CP	R0,R10
    05509 041B      CPC	R1,R11
    0550A F44C      BGE	0x5514
    0550B 01FA      MOVW	R30,R20
    0550C A40C      LDD	R0,Y+44
    0550D A41D      LDD	R1,Y+45
    0550E 0DE0      ADD	R30,R0
    0550F 1DF1      ADC	R31,R1
    05510 E28E      LDI	R24,0x2E
    05511 8380      ST	Z,R24
    05512 5F4F      SUBI	R20,0xFF
    05513 4F5F      SBCI	R21,0xFF
    05514 2400      CLR	R0
    05515 2411      CLR	R1
    05516 861D      STD	Y+13,R1
    05517 860C      STD	Y+12,R0
    05518 C02C      RJMP	0x5545
    05519 882D      LDD	R2,Y+21
    0551A 883E      LDD	R3,Y+22
    0551B 840E      LDD	R0,Y+14
    0551C 841F      LDD	R1,Y+15
    0551D 1820      SUB	R2,R0
    0551E 0831      SBC	R3,R1
    0551F 840C      LDD	R0,Y+12
    05520 841D      LDD	R1,Y+13
    05521 1402      CP	R0,R2
    05522 0413      CPC	R1,R3
    05523 F47C      BGE	0x5533
    05524 0110      MOVW	R2,R0
    05525 0E26      ADD	R2,R22
    05526 1E37      ADC	R3,R23
    05527 85EE      LDD	R30,Y+14
    05528 85FF      LDD	R31,Y+15
    05529 0DE2      ADD	R30,R2
    0552A 1DF3      ADC	R31,R3
    0552B 8021      LDD	R2,Z+1
    0552C 01FA      MOVW	R30,R20
    0552D A40C      LDD	R0,Y+44
    0552E A41D      LDD	R1,Y+45
    0552F 0DE0      ADD	R30,R0
    05530 1DF1      ADC	R31,R1
    05531 8220      ST	Z,R2
    05532 C00B      RJMP	0x553E
    05533 A80C      LDD	R0,Y+52
    05534 A81D      LDD	R1,Y+53
    05535 FE00      SBRS	R0,0
    05536 C024      RJMP	0x555B
    05537 01FA      MOVW	R30,R20
    05538 A40C      LDD	R0,Y+44
    05539 A41D      LDD	R1,Y+45
    0553A 0DE0      ADD	R30,R0
    0553B 1DF1      ADC	R31,R1
    0553C E380      LDI	R24,0x30
    0553D 8380      ST	Z,R24
    0553E 5F4F      SUBI	R20,0xFF
    0553F 4F5F      SBCI	R21,0xFF
    05540 858C      LDD	R24,Y+12
    05541 859D      LDD	R25,Y+13
    05542 9601      ADIW	R24,1
    05543 879D      STD	Y+13,R25
    05544 878C      STD	Y+12,R24
    05545 840C      LDD	R0,Y+12
    05546 841D      LDD	R1,Y+13
    05547 AD08      LDD	R16,Y+56
    05548 AD19      LDD	R17,Y+57
    05549 1600      CP	R0,R16
    0554A 0611      CPC	R1,R17
    0554B F42C      BGE	0x5551
    0554C 3144      CPI	R20,0x14
    0554D E0E0      LDI	R30,0
    0554E 075E      CPC	R21,R30
    0554F F40C      BGE	0x5551
    05550 CFC8      RJMP	0x5519
    05551 C009      RJMP	0x555B
    05552 01FA      MOVW	R30,R20
    05553 A40C      LDD	R0,Y+44
    05554 A41D      LDD	R1,Y+45
    05555 0DE0      ADD	R30,R0
    05556 1DF1      ADC	R31,R1
    05557 8C0C      LDD	R0,Y+28
    05558 8200      ST	Z,R0
    05559 5F4F      SUBI	R20,0xFF
    0555A 4F5F      SBCI	R21,0xFF
    0555B A80E      LDD	R0,Y+54
    0555C A81F      LDD	R1,Y+55
    0555D 1540      CP	R20,R0
    0555E 0551      CPC	R21,R1
    0555F F394      BLT	0x5552
    05560 01FA      MOVW	R30,R20
    05561 A40C      LDD	R0,Y+44
    05562 A41D      LDD	R1,Y+45
    05563 0DE0      ADD	R30,R0
    05564 1DF1      ADC	R31,R1
    05565 2422      CLR	R2
    05566 8220      ST	Z,R2
    05567 A50C      LDD	R16,Y+44
    05568 A51D      LDD	R17,Y+45
    05569 96A2      ADIW	R28,0x22
    0556A 940E 48B8 CALL	pop_xgsetF0FC
    0556C 9624      ADIW	R28,4
    0556D 9508      RET
