Interrupt Vectors
    00000 940C 0374 JMP	__start|__text_start
    0003C 940C 3A2F JMP	_uart1_rx_isr

Program Code (text area)
__start|__text_start:
    00374 EFCF      LDI	R28,0xFF
    00375 E1D0      LDI	R29,0x10
    00376 BFCD      OUT	0x3D,R28
    00377 BFDE      OUT	0x3E,R29
    00378 50C0      SUBI	R28,0
    00379 40D1      SBCI	R29,1
    0037A EA0A      LDI	R16,0xAA
    0037B 8308      ST	Y,R16
    0037C 2400      CLR	R0
    0037D E8ED      LDI	R30,0x8D
    0037E E0F5      LDI	R31,5
    0037F E018      LDI	R17,0x8
    00380 39E1      CPI	R30,0x91
    00381 07F1      CPC	R31,R17
    00382 F011      BEQ	0x0385
    00383 9201      ST	Z+,R0
    00384 CFFB      RJMP	0x0380
    00385 8300      ST	Z,R16
    00386 E5EA      LDI	R30,0x5A
    00387 E0F2      LDI	R31,2
    00388 E0A0      LDI	R26,0
    00389 E0B1      LDI	R27,1
    0038A E016      LDI	R17,6
    0038B E000      LDI	R16,0
    0038C BF0B      OUT	0x3B,R16
    0038D 3EE7      CPI	R30,0xE7
    0038E 07F1      CPC	R31,R17
    0038F F021      BEQ	0x0394
    00390 95C8      LPM
    00391 9631      ADIW	R30,1
    00392 920D      ST	X+,R0
    00393 CFF9      RJMP	0x038D
    00394 940E 2565 CALL	_main
_exit:
    00396 CFFF      RJMP	_exit
_disk_initialize:
  state                --> R20
  drv                  --> R10
    00397 92AA      ST	-Y,R10
    00398 934A      ST	-Y,R20
    00399 2EA0      MOV	R10,R16
FILE: D:\LQD\software\software_src\diskio.c
(0001) 
(0002) 
(0003) /*-----------------------------------------------------------------------*/
(0004) /* Low level disk I/O module skeleton for FatFs     (C)ChaN, 2007        */
(0005) /*-----------------------------------------------------------------------*/
(0006) /* This is a stub disk I/O module that acts as front end of the existing */
(0007) /* disk I/O modules and attach it to FatFs module with common interface. */
(0008) /*-----------------------------------------------------------------------*/
(0009) 
(0010) #include "diskio.h"
(0011) #include "sd.h"
(0012) 
(0013) 
(0014) /*-----------------------------------------------------------------------*/
(0015) /* Correspondence between physical drive number and physical drive.      */
(0016) /* Note that Tiny-FatFs supports only single drive and always            */
(0017)                                       
(0018) 
(0019) ////////////////////////////
(0020) /*
(0021)    struct tm {
(0022)    	int tm_sec;   // 秒 seconds after the minute, 0 to 60
(0023)    	int tm_min;   // 分 minutes after the hour, 0 to 59
(0024) 	int tm_hour;  // 时 hours since midnight, 0 to 23*
(0025) 	int tm_mday;  // 日 day of the month, 1 to 31
(0026) 	int tm_mon;   // 月 months since January, 0 to 11
(0027) 	int tm_year;  // 年 years since 1900
(0028) 	int tm_wday;  // 星期 days since Sunday, 0 to 6
(0029) 	int tm_yday;  // 从元旦起的天数 days since January 1, 0 to 365
(0030)  	int tm_isdst; // 夏令时？？Daylight Savings Time flag
(0031)  	};
(0032) */
(0033) /*-----------------------------------------------------------------------*/
(0034) /* Inidialize a Drive                                                    */
(0035) 
(0036) DSTATUS disk_initialize ( 
(0037) BYTE drv				/* Physical drive nmuber (0..) */
(0038) )
(0039) {
(0040)     unsigned char state;
(0041) 
(0042)     if(drv)
    0039A 20AA      TST	R10
    0039B F011      BEQ	0x039E
(0043)     {
(0044)         return STA_NOINIT;  //仅支持磁盘0的操作
    0039C E001      LDI	R16,1
    0039D C00C      RJMP	0x03AA
(0045)     }
(0046) 
(0047)     state = SD_Init();
    0039E 940E 2D60 CALL	_SD_Init
    003A0 2F40      MOV	R20,R16
(0048)     if(state == STA_NODISK)
    003A1 3002      CPI	R16,2
    003A2 F411      BNE	0x03A5
(0049)     {
(0050)         return STA_NODISK;
    003A3 E002      LDI	R16,2
    003A4 C005      RJMP	0x03AA
(0051)     }
(0052)     else if(state != 0)
    003A5 2344      TST	R20
    003A6 F011      BEQ	0x03A9
(0053)     {
(0054)         return STA_NOINIT;  //其他错误：初始化失败
    003A7 E001      LDI	R16,1
    003A8 C001      RJMP	0x03AA
(0055)     }
(0056)     else
(0057)     {
(0058)         return 0;           //初始化成功
    003A9 2700      CLR	R16
    003AA 9149      LD	R20,Y+
    003AB 90A9      LD	R10,Y+
    003AC 9508      RET
(0059)     }
(0060) }
(0061) 
(0062) 
(0063) 
(0064) /*-----------------------------------------------------------------------*/
(0065) /* Return Disk Status                                                    */
(0066) 
(0067) DSTATUS disk_status (
(0068) 	BYTE drv		/* Physical drive nmuber (0..) */
(0069) )
(0070) {
(0071)     if(drv)
_disk_status:
  drv                  --> R16
    003AD 2300      TST	R16
    003AE F011      BEQ	0x03B1
(0072)     {
(0073)         return STA_NOINIT;  //仅支持磁盘0操作
    003AF E001      LDI	R16,1
    003B0 C001      RJMP	0x03B2
(0074)     }
(0075)     return 0;
    003B1 2700      CLR	R16
    003B2 9508      RET
_disk_read:
  res                  --> R10
  count                --> R20
  sector               --> Y,+10
  buff                 --> R12
  drv                  --> R14
    003B3 940E 4847 CALL	push_xgset30FC
    003B5 0169      MOVW	R12,R18
    003B6 2EE0      MOV	R14,R16
    003B7 9722      SBIW	R28,2
    003B8 854E      LDD	R20,Y+14
(0076) }
(0077) 
(0078) 
(0079) 
(0080) /*-----------------------------------------------------------------------*/
(0081) /* Read Sector(s)                                                        */
(0082) 
(0083) DRESULT disk_read (
(0084) 	BYTE drv,		/* Physical drive nmuber (0..) */
(0085) 	BYTE *buff,		/* Data buffer to store read data */
(0086) 	DWORD sector,	/* Sector address (LBA) */
(0087) 	BYTE count		/* Number of sectors to read (1..255) */
(0088) )
(0089) {
(0090) 	unsigned char res=0;
    003B9 24AA      CLR	R10
(0091)     if (drv || !count)
    003BA 20EE      TST	R14
    003BB F411      BNE	0x03BE
    003BC 2344      TST	R20
    003BD F411      BNE	0x03C0
(0092)     {    
(0093)         return RES_PARERR;  //仅支持单磁盘操作，count不能等于0，否则返回参数错误
    003BE E004      LDI	R16,4
    003BF C010      RJMP	0x03D0
(0094)     }
(0095) 
(0096)     if(count==1)            //1个sector的读操作      
    003C0 3041      CPI	R20,1
    003C1 F449      BNE	0x03CB
(0097)     {                                                
(0098)         res = SD_Read_Sector(sector, buff);      
    003C2 82D9      STD	Y+1,R13
    003C3 82C8      ST	Y,R12
    003C4 850A      LDD	R16,Y+10
    003C5 851B      LDD	R17,Y+11
    003C6 852C      LDD	R18,Y+12
    003C7 853D      LDD	R19,Y+13
    003C8 940E 2E46 CALL	_SD_Read_Sector
    003CA 2EA0      MOV	R10,R16
(0099)     }                                                                                                 
(0100) 
(0101)     //处理返回值，将SD_driver.c的返回值转成ff.c的返回值
(0102)     if(res == 0x00)
    003CB 20AA      TST	R10
    003CC F411      BNE	0x03CF
(0103)     {
(0104)         return RES_OK;
    003CD 2700      CLR	R16
    003CE C001      RJMP	0x03D0
(0105)     }
(0106)     else
(0107)     {
(0108)         return RES_ERROR;
    003CF E001      LDI	R16,1
    003D0 9622      ADIW	R28,2
    003D1 940C 4831 JMP	pop_xgset30FC
_disk_write:
  count                --> R12
  sector               --> Y,+8
  buff                 --> R10
  drv                  --> R14
    003D3 940E 4849 CALL	push_xgset00FC
    003D5 0159      MOVW	R10,R18
    003D6 2EE0      MOV	R14,R16
    003D7 9722      SBIW	R28,2
    003D8 84CC      LDD	R12,Y+12
(0109)     }
(0110) }
(0111) 
(0112) 
(0113) 
(0114) /*-----------------------------------------------------------------------*/
(0115) /* Write Sector(s)                                                       */
(0116) 
(0117) #if _READONLY == 0
(0118) DRESULT disk_write (
(0119) 	BYTE drv,			/* Physical drive nmuber (0..) */
(0120) 	BYTE *buff,	        /* Data to be written */
(0121) 	DWORD sector,		/* Sector address (LBA) */
(0122) 	BYTE count			/* Number of sectors to write (1..255) */
(0123) )
(0124) {
(0125)     if (drv || !count)
    003D9 20EE      TST	R14
    003DA F411      BNE	0x03DD
    003DB 20CC      TST	R12
    003DC F411      BNE	0x03DF
(0126)     {    
(0127)         return RES_PARERR;  //仅支持单磁盘操作，count不能等于0，否则返回参数错误
    003DD E004      LDI	R16,4
    003DE C009      RJMP	0x03E8
(0128)     }   
(0129)    // 读写操作
(0130)     SD_Write_Sector(sector,buff);
    003DF 82B9      STD	Y+1,R11
    003E0 82A8      ST	Y,R10
    003E1 8508      LDD	R16,Y+8
    003E2 8519      LDD	R17,Y+9
    003E3 852A      LDD	R18,Y+10
    003E4 853B      LDD	R19,Y+11
    003E5 940E 2DC0 CALL	_SD_Write_Sector
(0131) 	  
(0132)     return RES_OK;
    003E7 2700      CLR	R16
    003E8 9622      ADIW	R28,2
    003E9 940C 482A JMP	pop_xgset00FC
_disk_ioctl:
  buff                 --> Y,+4
  ctrl                 --> Y,+2
  drv                  --> Y,+0
    003EB 940E 4700 CALL	push_arg4
(0133) }
(0134) #endif /* _READONLY */
(0135) 
(0136) 
(0137) 
(0138) /*-----------------------------------------------------------------------*/
(0139) /* Miscellaneous Functions                                               */
(0140) DRESULT disk_ioctl (
(0141) 	BYTE drv,		/* Physical drive nmuber (0..) */
(0142) 	BYTE ctrl,		/* Control code */
(0143) 	void *buff		/* Buffer to send/receive control data */
(0144) )
(0145) {
(0146)  	drv=drv;
(0147) 	ctrl=ctrl;
(0148) 	buff=buff;
(0149) 	return 0;
    003ED 2700      CLR	R16
    003EE 9624      ADIW	R28,4
    003EF 9508      RET
(0150) }
(0151) DWORD get_fattime (void)
(0152) {
(0153) 
(0154)   return 1950466005;
_get_fattime:
    003F0 ED05      LDI	R16,0xD5
    003F1 EB1F      LDI	R17,0xBF
    003F2 E421      LDI	R18,0x41
    003F3 E734      LDI	R19,0x74
    003F4 9508      RET
ff.c:mem_cpy:
  s                    --> R12
  d                    --> R10
  cnt                  --> R20
  src                  --> R18
  dst                  --> R16
    003F5 940E 4872 CALL	push_xgset303C
    003F7 814E      LDD	R20,Y+6
    003F8 815F      LDD	R21,Y+7
FILE: D:\LQD\software\software_src\ff.c
(0001) /*----------------------------------------------------------------------------/
(0002) /  FatFs - FAT file system module  R0.09                  (C)ChaN, 2011
(0003) /-----------------------------------------------------------------------------/
(0004) / FatFs module is a generic FAT file system module for small embedded systems.
(0005) / This is a free software that opened for education, research and commercial
(0006) / developments under license policy of following terms.
(0007) /
(0008) /  Copyright (C) 2011, ChaN, all right reserved.
(0009) /
(0010) / * The FatFs module is a free software and there is NO WARRANTY.
(0011) / * No restriction on use. You can use, modify and redistribute it for
(0012) /   personal, non-profit or commercial products UNDER YOUR RESPONSIBILITY.
(0013) / * Redistributions of source code must retain the above copyright notice.
(0014) /
(0015) /-----------------------------------------------------------------------------/
(0016) / Feb 26,'06 R0.00  Prototype.
(0017) /
(0018) / Apr 29,'06 R0.01  First stable version.
(0019) /
(0020) / Jun 01,'06 R0.02  Added FAT12 support.
(0021) /                   Removed unbuffered mode.
(0022) /                   Fixed a problem on small (<32M) partition.
(0023) / Jun 10,'06 R0.02a Added a configuration option (_FS_MINIMUM).
(0024) /
(0025) / Sep 22,'06 R0.03  Added f_rename().
(0026) /                   Changed option _FS_MINIMUM to _FS_MINIMIZE.
(0027) / Dec 11,'06 R0.03a Improved cluster scan algorithm to write files fast.
(0028) /                   Fixed f_mkdir() creates incorrect directory on FAT32.
(0029) /
(0030) / Feb 04,'07 R0.04  Supported multiple drive system.
(0031) /                   Changed some interfaces for multiple drive system.
(0032) /                   Changed f_mountdrv() to f_mount().
(0033) /                   Added f_mkfs().
(0034) / Apr 01,'07 R0.04a Supported multiple partitions on a physical drive.
(0035) /                   Added a capability of extending file size to f_lseek().
(0036) /                   Added minimization level 3.
(0037) /                   Fixed an endian sensitive code in f_mkfs().
(0038) / May 05,'07 R0.04b Added a configuration option _USE_NTFLAG.
(0039) /                   Added FSInfo support.
(0040) /                   Fixed DBCS name can result FR_INVALID_NAME.
(0041) /                   Fixed short seek (<= csize) collapses the file object.
(0042) /
(0043) / Aug 25,'07 R0.05  Changed arguments of f_read(), f_write() and f_mkfs().
(0044) /                   Fixed f_mkfs() on FAT32 creates incorrect FSInfo.
(0045) /                   Fixed f_mkdir() on FAT32 creates incorrect directory.
(0046) / Feb 03,'08 R0.05a Added f_truncate() and f_utime().
(0047) /                   Fixed off by one error at FAT sub-type determination.
(0048) /                   Fixed btr in f_read() can be mistruncated.
(0049) /                   Fixed cached sector is not flushed when create and close without write.
(0050) /
(0051) / Apr 01,'08 R0.06  Added fputc(), fputs(), fprintf() and fgets().
(0052) /                   Improved performance of f_lseek() on moving to the same or following cluster.
(0053) /
(0054) / Apr 01,'09 R0.07  Merged Tiny-FatFs as a configuration option. (_FS_TINY)
(0055) /                   Added long file name feature.
(0056) /                   Added multiple code page feature.
(0057) /                   Added re-entrancy for multitask operation.
(0058) /                   Added auto cluster size selection to f_mkfs().
(0059) /                   Added rewind option to f_readdir().
(0060) /                   Changed result code of critical errors.
(0061) /                   Renamed string functions to avoid name collision.
(0062) / Apr 14,'09 R0.07a Separated out OS dependent code on reentrant cfg.
(0063) /                   Added multiple sector size feature.
(0064) / Jun 21,'09 R0.07c Fixed f_unlink() can return FR_OK on error.
(0065) /                   Fixed wrong cache control in f_lseek().
(0066) /                   Added relative path feature.
(0067) /                   Added f_chdir() and f_chdrive().
(0068) /                   Added proper case conversion to extended char.
(0069) / Nov 03,'09 R0.07e Separated out configuration options from ff.h to ffconf.h.
(0070) /                   Fixed f_unlink() fails to remove a sub-dir on _FS_RPATH.
(0071) /                   Fixed name matching error on the 13 char boundary.
(0072) /                   Added a configuration option, _LFN_UNICODE.
(0073) /                   Changed f_readdir() to return the SFN with always upper case on non-LFN cfg.
(0074) /
(0075) / May 15,'10 R0.08  Added a memory configuration option. (_USE_LFN = 3)
(0076) /                   Added file lock feature. (_FS_SHARE)
(0077) /                   Added fast seek feature. (_USE_FASTSEEK)
(0078) /                   Changed some types on the API, XCHAR->TCHAR.
(0079) /                   Changed fname member in the FILINFO structure on Unicode cfg.
(0080) /                   String functions support UTF-8 encoding files on Unicode cfg.
(0081) / Aug 16,'10 R0.08a Added f_getcwd(). (_FS_RPATH = 2)
(0082) /                   Added sector erase feature. (_USE_ERASE)
(0083) /                   Moved file lock semaphore table from fs object to the bss.
(0084) /                   Fixed a wrong directory entry is created on non-LFN cfg when the given name contains ';'.
(0085) /                   Fixed f_mkfs() creates wrong FAT32 volume.
(0086) / Jan 15,'11 R0.08b Fast seek feature is also applied to f_read() and f_write().
(0087) /                   f_lseek() reports required table size on creating CLMP.
(0088) /                   Extended format syntax of f_printf function.
(0089) /                   Ignores duplicated directory separators in given path names.
(0090) /
(0091) / Sep 06,'11 R0.09  f_mkfs() supports multiple partition to finish the multiple partition feature.
(0092) /                   Added f_fdisk(). (_MULTI_PARTITION = 2)
(0093) /---------------------------------------------------------------------------*/
(0094) 
(0095) #include "ff.h"			/* FatFs configurations and declarations */
(0096) #include "diskio.h"		/* Declarations of low level disk I/O functions */
(0097) #include <string.h>
(0098) 
(0099) /*--------------------------------------------------------------------------
(0100) 
(0101)    Module Private Definitions
(0102) 
(0103) ---------------------------------------------------------------------------*/
(0104) 
(0105) #if _FATFS != 6502	/* Revision ID */
(0106) #error Wrong include file (ff.h).
(0107) #endif
(0108) 
(0109) 
(0110) /* Definitions on sector size */
(0111) #if _MAX_SS != 512 && _MAX_SS != 1024 && _MAX_SS != 2048 && _MAX_SS != 4096
(0112) #error Wrong sector size.
(0113) #endif
(0114) #if _MAX_SS != 512
(0115) #define	SS(fs)	((fs)->ssize)	/* Variable sector size */
(0116) #else
(0117) #define	SS(fs)	512U			/* Fixed sector size */
(0118) #endif
(0119) 
(0120) 
(0121) /* Reentrancy related */
(0122) #if _FS_REENTRANT
(0123) #if _USE_LFN == 1
(0124) #error Static LFN work area must not be used in re-entrant configuration.
(0125) #endif
(0126) #define	ENTER_FF(fs)		{ if (!lock_fs(fs)) return FR_TIMEOUT; }
(0127) #define	LEAVE_FF(fs, res)	{ unlock_fs(fs, res); return res; }
(0128) #else
(0129) #define	ENTER_FF(fs)
(0130) #define LEAVE_FF(fs, res)	return res
(0131) #endif
(0132) 
(0133) #define	ABORT(fs, res)		{ fp->flag |= FA__ERROR; LEAVE_FF(fs, res); }
(0134) 
(0135) 
(0136) /* File shareing feature */
(0137) #if _FS_SHARE
(0138) #if _FS_READONLY
(0139) #error _FS_SHARE must be 0 on read-only cfg.
(0140) #endif
(0141) typedef struct {
(0142) 	FATFS *fs;				/* File ID 1, volume (NULL:blank entry) */
(0143) 	DWORD clu;				/* File ID 2, directory */
(0144) 	WORD idx;				/* File ID 3, directory index */
(0145) 	WORD ctr;				/* File open counter, 0:none, 0x01..0xFF:read open count, 0x100:write mode */
(0146) } FILESEM;
(0147) #endif
(0148) 
(0149) 
(0150) /* Misc definitions */
(0151) #define LD_CLUST(dir)	(((DWORD)LD_WORD(dir+DIR_FstClusHI)<<16) | LD_WORD(dir+DIR_FstClusLO))
(0152) #define ST_CLUST(dir,cl) {ST_WORD(dir+DIR_FstClusLO, cl); ST_WORD(dir+DIR_FstClusHI, (DWORD)cl>>16);}
(0153) 
(0154) 
(0155) /* DBCS code ranges and SBCS extend char conversion table */
(0156) 
(0157) #if _CODE_PAGE == 932	/* Japanese Shift-JIS */
(0158) #define _DF1S	0x81	/* DBC 1st byte range 1 start */
(0159) #define _DF1E	0x9F	/* DBC 1st byte range 1 end */
(0160) #define _DF2S	0xE0	/* DBC 1st byte range 2 start */
(0161) #define _DF2E	0xFC	/* DBC 1st byte range 2 end */
(0162) #define _DS1S	0x40	/* DBC 2nd byte range 1 start */
(0163) #define _DS1E	0x7E	/* DBC 2nd byte range 1 end */
(0164) #define _DS2S	0x80	/* DBC 2nd byte range 2 start */
(0165) #define _DS2E	0xFC	/* DBC 2nd byte range 2 end */
(0166) 
(0167) #elif _CODE_PAGE == 936	/* Simplified Chinese GBK */
(0168) #define _DF1S	0x81
(0169) #define _DF1E	0xFE
(0170) #define _DS1S	0x40
(0171) #define _DS1E	0x7E
(0172) #define _DS2S	0x80
(0173) #define _DS2E	0xFE
(0174) 
(0175) #elif _CODE_PAGE == 949	/* Korean */
(0176) #define _DF1S	0x81
(0177) #define _DF1E	0xFE
(0178) #define _DS1S	0x41
(0179) #define _DS1E	0x5A
(0180) #define _DS2S	0x61
(0181) #define _DS2E	0x7A
(0182) #define _DS3S	0x81
(0183) #define _DS3E	0xFE
(0184) 
(0185) #elif _CODE_PAGE == 950	/* Traditional Chinese Big5 */
(0186) #define _DF1S	0x81
(0187) #define _DF1E	0xFE
(0188) #define _DS1S	0x40
(0189) #define _DS1E	0x7E
(0190) #define _DS2S	0xA1
(0191) #define _DS2E	0xFE
(0192) 
(0193) #elif _CODE_PAGE == 437	/* U.S. (OEM) */
(0194) #define _DF1S	0
(0195) #define _EXCVT {0x80,0x9A,0x90,0x41,0x8E,0x41,0x8F,0x80,0x45,0x45,0x45,0x49,0x49,0x49,0x8E,0x8F,0x90,0x92,0x92,0x4F,0x99,0x4F,0x55,0x55,0x59,0x99,0x9A,0x9B,0x9C,0x9D,0x9E,0x9F, \
(0196) 				0x41,0x49,0x4F,0x55,0xA5,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0x21,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0197) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0198) 				0xE0,0xE1,0xE2,0xE3,0xE4,0xE5,0xE6,0xE7,0xE8,0xE9,0xEA,0xEB,0xEC,0xED,0xEE,0xEF,0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}
(0199) 
(0200) #elif _CODE_PAGE == 720	/* Arabic (OEM) */
(0201) #define _DF1S	0
(0202) #define _EXCVT {0x80,0x81,0x45,0x41,0x84,0x41,0x86,0x43,0x45,0x45,0x45,0x49,0x49,0x8D,0x8E,0x8F,0x90,0x92,0x92,0x93,0x94,0x95,0x49,0x49,0x98,0x99,0x9A,0x9B,0x9C,0x9D,0x9E,0x9F, \
(0203) 				0xA0,0xA1,0xA2,0xA3,0xA4,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0204) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0205) 				0xE0,0xE1,0xE2,0xE3,0xE4,0xE5,0xE6,0xE7,0xE8,0xE9,0xEA,0xEB,0xEC,0xED,0xEE,0xEF,0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}
(0206) 
(0207) #elif _CODE_PAGE == 737	/* Greek (OEM) */
(0208) #define _DF1S	0
(0209) #define _EXCVT {0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x92,0x92,0x93,0x94,0x95,0x96,0x97,0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87, \
(0210) 				0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x91,0xAA,0x92,0x93,0x94,0x95,0x96,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0211) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0212) 				0x97,0xEA,0xEB,0xEC,0xE4,0xED,0xEE,0xE7,0xE8,0xF1,0xEA,0xEB,0xEC,0xED,0xEE,0xEF,0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}
(0213) 
(0214) #elif _CODE_PAGE == 775	/* Baltic (OEM) */
(0215) #define _DF1S	0
(0216) #define _EXCVT {0x80,0x9A,0x91,0xA0,0x8E,0x95,0x8F,0x80,0xAD,0xED,0x8A,0x8A,0xA1,0x8D,0x8E,0x8F,0x90,0x92,0x92,0xE2,0x99,0x95,0x96,0x97,0x97,0x99,0x9A,0x9D,0x9C,0x9D,0x9E,0x9F, \
(0217) 				0xA0,0xA1,0xE0,0xA3,0xA3,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0218) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xB5,0xB6,0xB7,0xB8,0xBD,0xBE,0xC6,0xC7,0xA5,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0219) 				0xE0,0xE1,0xE2,0xE3,0xE5,0xE5,0xE6,0xE3,0xE8,0xE8,0xEA,0xEA,0xEE,0xED,0xEE,0xEF,0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}
(0220) 
(0221) #elif _CODE_PAGE == 850	/* Multilingual Latin 1 (OEM) */
(0222) #define _DF1S	0
(0223) #define _EXCVT {0x80,0x9A,0x90,0xB6,0x8E,0xB7,0x8F,0x80,0xD2,0xD3,0xD4,0xD8,0xD7,0xDE,0x8E,0x8F,0x90,0x92,0x92,0xE2,0x99,0xE3,0xEA,0xEB,0x59,0x99,0x9A,0x9D,0x9C,0x9D,0x9E,0x9F, \
(0224) 				0xB5,0xD6,0xE0,0xE9,0xA5,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0x21,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0225) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC7,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0226) 				0xE0,0xE1,0xE2,0xE3,0xE5,0xE5,0xE6,0xE7,0xE7,0xE9,0xEA,0xEB,0xED,0xED,0xEE,0xEF,0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}
(0227) 
(0228) #elif _CODE_PAGE == 852	/* Latin 2 (OEM) */
(0229) #define _DF1S	0
(0230) #define _EXCVT {0x80,0x9A,0x90,0xB6,0x8E,0xDE,0x8F,0x80,0x9D,0xD3,0x8A,0x8A,0xD7,0x8D,0x8E,0x8F,0x90,0x91,0x91,0xE2,0x99,0x95,0x95,0x97,0x97,0x99,0x9A,0x9B,0x9B,0x9D,0x9E,0x9F, \
(0231) 				0xB5,0xD6,0xE0,0xE9,0xA4,0xA4,0xA6,0xA6,0xA8,0xA8,0xAA,0x8D,0xAC,0xB8,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBD,0xBF, \
(0232) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC6,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD1,0xD1,0xD2,0xD3,0xD2,0xD5,0xD6,0xD7,0xB7,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0233) 				0xE0,0xE1,0xE2,0xE3,0xE3,0xD5,0xE6,0xE6,0xE8,0xE9,0xE8,0xEB,0xED,0xED,0xDD,0xEF,0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xEB,0xFC,0xFC,0xFE,0xFF}
(0234) 
(0235) #elif _CODE_PAGE == 855	/* Cyrillic (OEM) */
(0236) #define _DF1S	0
(0237) #define _EXCVT {0x81,0x81,0x83,0x83,0x85,0x85,0x87,0x87,0x89,0x89,0x8B,0x8B,0x8D,0x8D,0x8F,0x8F,0x91,0x91,0x93,0x93,0x95,0x95,0x97,0x97,0x99,0x99,0x9B,0x9B,0x9D,0x9D,0x9F,0x9F, \
(0238) 				0xA1,0xA1,0xA3,0xA3,0xA5,0xA5,0xA7,0xA7,0xA9,0xA9,0xAB,0xAB,0xAD,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB6,0xB6,0xB8,0xB8,0xB9,0xBA,0xBB,0xBC,0xBE,0xBE,0xBF, \
(0239) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC7,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD1,0xD1,0xD3,0xD3,0xD5,0xD5,0xD7,0xD7,0xDD,0xD9,0xDA,0xDB,0xDC,0xDD,0xE0,0xDF, \
(0240) 				0xE0,0xE2,0xE2,0xE4,0xE4,0xE6,0xE6,0xE8,0xE8,0xEA,0xEA,0xEC,0xEC,0xEE,0xEE,0xEF,0xF0,0xF2,0xF2,0xF4,0xF4,0xF6,0xF6,0xF8,0xF8,0xFA,0xFA,0xFC,0xFC,0xFD,0xFE,0xFF}
(0241) 
(0242) #elif _CODE_PAGE == 857	/* Turkish (OEM) */
(0243) #define _DF1S	0
(0244) #define _EXCVT {0x80,0x9A,0x90,0xB6,0x8E,0xB7,0x8F,0x80,0xD2,0xD3,0xD4,0xD8,0xD7,0x98,0x8E,0x8F,0x90,0x92,0x92,0xE2,0x99,0xE3,0xEA,0xEB,0x98,0x99,0x9A,0x9D,0x9C,0x9D,0x9E,0x9E, \
(0245) 				0xB5,0xD6,0xE0,0xE9,0xA5,0xA5,0xA6,0xA6,0xA8,0xA9,0xAA,0xAB,0xAC,0x21,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0246) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC7,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0247) 				0xE0,0xE1,0xE2,0xE3,0xE5,0xE5,0xE6,0xE7,0xE8,0xE9,0xEA,0xEB,0xDE,0x59,0xEE,0xEF,0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}
(0248) 
(0249) #elif _CODE_PAGE == 858	/* Multilingual Latin 1 + Euro (OEM) */
(0250) #define _DF1S	0
(0251) #define _EXCVT {0x80,0x9A,0x90,0xB6,0x8E,0xB7,0x8F,0x80,0xD2,0xD3,0xD4,0xD8,0xD7,0xDE,0x8E,0x8F,0x90,0x92,0x92,0xE2,0x99,0xE3,0xEA,0xEB,0x59,0x99,0x9A,0x9D,0x9C,0x9D,0x9E,0x9F, \
(0252) 				0xB5,0xD6,0xE0,0xE9,0xA5,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0x21,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0253) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC7,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD1,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0254) 				0xE0,0xE1,0xE2,0xE3,0xE5,0xE5,0xE6,0xE7,0xE7,0xE9,0xEA,0xEB,0xED,0xED,0xEE,0xEF,0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}
(0255) 
(0256) #elif _CODE_PAGE == 862	/* Hebrew (OEM) */
(0257) #define _DF1S	0
(0258) #define _EXCVT {0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x9A,0x9B,0x9C,0x9D,0x9E,0x9F, \
(0259) 				0x41,0x49,0x4F,0x55,0xA5,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0x21,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0260) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0261) 				0xE0,0xE1,0xE2,0xE3,0xE4,0xE5,0xE6,0xE7,0xE8,0xE9,0xEA,0xEB,0xEC,0xED,0xEE,0xEF,0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}
(0262) 
(0263) #elif _CODE_PAGE == 866	/* Russian (OEM) */
(0264) #define _DF1S	0
(0265) #define _EXCVT {0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x9A,0x9B,0x9C,0x9D,0x9E,0x9F, \
(0266) 				0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0267) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0268) 				0x90,0x91,0x92,0x93,0x9d,0x95,0x96,0x97,0x98,0x99,0x9A,0x9B,0x9C,0x9D,0x9E,0x9F,0xF0,0xF0,0xF2,0xF2,0xF4,0xF4,0xF6,0xF6,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}
(0269) 
(0270) #elif _CODE_PAGE == 874	/* Thai (OEM, Windows) */
(0271) #define _DF1S	0
(0272) #define _EXCVT {0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x9A,0x9B,0x9C,0x9D,0x9E,0x9F, \
(0273) 				0xA0,0xA1,0xA2,0xA3,0xA4,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0274) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0275) 				0xE0,0xE1,0xE2,0xE3,0xE4,0xE5,0xE6,0xE7,0xE8,0xE9,0xEA,0xEB,0xEC,0xED,0xEE,0xEF,0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}
(0276) 
(0277) #elif _CODE_PAGE == 1250 /* Central Europe (Windows) */
(0278) #define _DF1S	0
(0279) #define _EXCVT {0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x8A,0x9B,0x8C,0x8D,0x8E,0x8F, \
(0280) 				0xA0,0xA1,0xA2,0xA3,0xA4,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xA3,0xB4,0xB5,0xB6,0xB7,0xB8,0xA5,0xAA,0xBB,0xBC,0xBD,0xBC,0xAF, \
(0281) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0282) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xF7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xFF}
(0283) 
(0284) #elif _CODE_PAGE == 1251 /* Cyrillic (Windows) */
(0285) #define _DF1S	0
(0286) #define _EXCVT {0x80,0x81,0x82,0x82,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x80,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x8A,0x9B,0x8C,0x8D,0x8E,0x8F, \
(0287) 				0xA0,0xA2,0xA2,0xA3,0xA4,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xB2,0xA5,0xB5,0xB6,0xB7,0xA8,0xB9,0xAA,0xBB,0xA3,0xBD,0xBD,0xAF, \
(0288) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0289) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF}
(0290) 
(0291) #elif _CODE_PAGE == 1252 /* Latin 1 (Windows) */
(0292) #define _DF1S	0
(0293) #define _EXCVT {0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0xAd,0x9B,0x8C,0x9D,0xAE,0x9F, \
(0294) 				0xA0,0x21,0xA2,0xA3,0xA4,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0295) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0296) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xF7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0x9F}
(0297) 
(0298) #elif _CODE_PAGE == 1253 /* Greek (Windows) */
(0299) #define _DF1S	0
(0300) #define _EXCVT {0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x9A,0x9B,0x9C,0x9D,0x9E,0x9F, \
(0301) 				0xA0,0xA1,0xA2,0xA3,0xA4,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0302) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xA2,0xB8,0xB9,0xBA, \
(0303) 				0xE0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xF2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xFB,0xBC,0xFD,0xBF,0xFF}
(0304) 
(0305) #elif _CODE_PAGE == 1254 /* Turkish (Windows) */
(0306) #define _DF1S	0
(0307) #define _EXCVT {0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x8A,0x9B,0x8C,0x9D,0x9E,0x9F, \
(0308) 				0xA0,0x21,0xA2,0xA3,0xA4,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0309) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0310) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xF7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0x9F}
(0311) 
(0312) #elif _CODE_PAGE == 1255 /* Hebrew (Windows) */
(0313) #define _DF1S	0
(0314) #define _EXCVT {0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x9A,0x9B,0x9C,0x9D,0x9E,0x9F, \
(0315) 				0xA0,0x21,0xA2,0xA3,0xA4,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0316) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0317) 				0xE0,0xE1,0xE2,0xE3,0xE4,0xE5,0xE6,0xE7,0xE8,0xE9,0xEA,0xEB,0xEC,0xED,0xEE,0xEF,0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}
(0318) 
(0319) #elif _CODE_PAGE == 1256 /* Arabic (Windows) */
(0320) #define _DF1S	0
(0321) #define _EXCVT {0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x9A,0x9B,0x8C,0x9D,0x9E,0x9F, \
(0322) 				0xA0,0xA1,0xA2,0xA3,0xA4,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0323) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0324) 				0x41,0xE1,0x41,0xE3,0xE4,0xE5,0xE6,0x43,0x45,0x45,0x45,0x45,0xEC,0xED,0x49,0x49,0xF0,0xF1,0xF2,0xF3,0x4F,0xF5,0xF6,0xF7,0xF8,0x55,0xFA,0x55,0x55,0xFD,0xFE,0xFF}
(0325) 
(0326) #elif _CODE_PAGE == 1257 /* Baltic (Windows) */
(0327) #define _DF1S	0
(0328) #define _EXCVT {0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x9A,0x9B,0x9C,0x9D,0x9E,0x9F, \
(0329) 				0xA0,0xA1,0xA2,0xA3,0xA4,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xA8,0xB9,0xAA,0xBB,0xBC,0xBD,0xBE,0xAF, \
(0330) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0331) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xF7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xFF}
(0332) 
(0333) #elif _CODE_PAGE == 1258 /* Vietnam (OEM, Windows) */
(0334) #define _DF1S	0
(0335) #define _EXCVT {0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x9A,0x9B,0xAC,0x9D,0x9E,0x9F, \
(0336) 				0xA0,0x21,0xA2,0xA3,0xA4,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF, \
(0337) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF, \
(0338) 				0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xEC,0xCD,0xCE,0xCF,0xD0,0xD1,0xF2,0xD3,0xD4,0xD5,0xD6,0xF7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xFE,0x9F}
(0339) 
(0340) #elif _CODE_PAGE == 1	/* ASCII (for only non-LFN cfg) */
(0341) #if _USE_LFN
(0342) #error Cannot use LFN feature without valid code page.
(0343) #endif
(0344) #define _DF1S	0
(0345) 
(0346) #else
(0347) #error Unknown code page
(0348) 
(0349) #endif
(0350) 
(0351) 
(0352) /* Character code support macros */
(0353) #define IsUpper(c)	(((c)>='A')&&((c)<='Z'))
(0354) #define IsLower(c)	(((c)>='a')&&((c)<='z'))
(0355) #define IsDigit(c)	(((c)>='0')&&((c)<='9'))
(0356) 
(0357) #if _DF1S		/* Code page is DBCS */
(0358) 
(0359) #ifdef _DF2S	/* Two 1st byte areas */
(0360) #define IsDBCS1(c)	(((BYTE)(c) >= _DF1S && (BYTE)(c) <= _DF1E) || ((BYTE)(c) >= _DF2S && (BYTE)(c) <= _DF2E))
(0361) #else			/* One 1st byte area */
(0362) #define IsDBCS1(c)	((BYTE)(c) >= _DF1S && (BYTE)(c) <= _DF1E)
(0363) #endif
(0364) 
(0365) #ifdef _DS3S	/* Three 2nd byte areas */
(0366) #define IsDBCS2(c)	(((BYTE)(c) >= _DS1S && (BYTE)(c) <= _DS1E) || ((BYTE)(c) >= _DS2S && (BYTE)(c) <= _DS2E) || ((BYTE)(c) >= _DS3S && (BYTE)(c) <= _DS3E))
(0367) #else			/* Two 2nd byte areas */
(0368) #define IsDBCS2(c)	(((BYTE)(c) >= _DS1S && (BYTE)(c) <= _DS1E) || ((BYTE)(c) >= _DS2S && (BYTE)(c) <= _DS2E))
(0369) #endif
(0370) 
(0371) #else			/* Code page is SBCS */
(0372) 
(0373) #define IsDBCS1(c)	0
(0374) #define IsDBCS2(c)	0
(0375) 
(0376) #endif /* _DF1S */
(0377) 
(0378) 
(0379) /* Name status flags */
(0380) #define NS			11		/* Index of name status byte in fn[] */
(0381) #define NS_LOSS		0x01	/* Out of 8.3 format */
(0382) #define NS_LFN		0x02	/* Force to create LFN entry */
(0383) #define NS_LAST		0x04	/* Last segment */
(0384) #define NS_BODY		0x08	/* Lower case flag (body) */
(0385) #define NS_EXT		0x10	/* Lower case flag (ext) */
(0386) #define NS_DOT		0x20	/* Dot entry */
(0387) 
(0388) 
(0389) /* FAT sub-type boundaries */
(0390) /* Note that the FAT spec by Microsoft says 4085 but Windows works with 4087! */
(0391) #define MIN_FAT16	4086	/* Minimum number of clusters for FAT16 */
(0392) #define	MIN_FAT32	65526	/* Minimum number of clusters for FAT32 */
(0393) 
(0394) 
(0395) /* FatFs refers the members in the FAT structures as byte array instead of
(0396) / structure member because the structure is not binary compatible between
(0397) / different platforms */
(0398) 
(0399) #define BS_jmpBoot			0	/* Jump instruction (3) */
(0400) #define BS_OEMName			3	/* OEM name (8) */
(0401) #define BPB_BytsPerSec		11	/* Sector size [byte] (2) */
(0402) #define BPB_SecPerClus		13	/* Cluster size [sector] (1) */
(0403) #define BPB_RsvdSecCnt		14	/* Size of reserved area [sector] (2) */
(0404) #define BPB_NumFATs			16	/* Number of FAT copies (1) */
(0405) #define BPB_RootEntCnt		17	/* Number of root dir entries for FAT12/16 (2) */
(0406) #define BPB_TotSec16		19	/* Volume size [sector] (2) */
(0407) #define BPB_Media			21	/* Media descriptor (1) */
(0408) #define BPB_FATSz16			22	/* FAT size [sector] (2) */
(0409) #define BPB_SecPerTrk		24	/* Track size [sector] (2) */
(0410) #define BPB_NumHeads		26	/* Number of heads (2) */
(0411) #define BPB_HiddSec			28	/* Number of special hidden sectors (4) */
(0412) #define BPB_TotSec32		32	/* Volume size [sector] (4) */
(0413) #define BS_DrvNum			36	/* Physical drive number (2) */
(0414) #define BS_BootSig			38	/* Extended boot signature (1) */
(0415) #define BS_VolID			39	/* Volume serial number (4) */
(0416) #define BS_VolLab			43	/* Volume label (8) */
(0417) #define BS_FilSysType		54	/* File system type (1) */
(0418) #define BPB_FATSz32			36	/* FAT size [sector] (4) */
(0419) #define BPB_ExtFlags		40	/* Extended flags (2) */
(0420) #define BPB_FSVer			42	/* File system version (2) */
(0421) #define BPB_RootClus		44	/* Root dir first cluster (4) */
(0422) #define BPB_FSInfo			48	/* Offset of FSInfo sector (2) */
(0423) #define BPB_BkBootSec		50	/* Offset of backup boot sectot (2) */
(0424) #define BS_DrvNum32			64	/* Physical drive number (2) */
(0425) #define BS_BootSig32		66	/* Extended boot signature (1) */
(0426) #define BS_VolID32			67	/* Volume serial number (4) */
(0427) #define BS_VolLab32			71	/* Volume label (8) */
(0428) #define BS_FilSysType32		82	/* File system type (1) */
(0429) #define	FSI_LeadSig			0	/* FSI: Leading signature (4) */
(0430) #define	FSI_StrucSig		484	/* FSI: Structure signature (4) */
(0431) #define	FSI_Free_Count		488	/* FSI: Number of free clusters (4) */
(0432) #define	FSI_Nxt_Free		492	/* FSI: Last allocated cluster (4) */
(0433) #define MBR_Table			446	/* MBR: Partition table offset (2) */
(0434) #define	SZ_PTE				16	/* MBR: Size of a partition table entry */
(0435) #define BS_55AA				510	/* Boot sector signature (2) */
(0436) 
(0437) #define	DIR_Name			0	/* Short file name (11) */
(0438) #define	DIR_Attr			11	/* Attribute (1) */
(0439) #define	DIR_NTres			12	/* NT flag (1) */
(0440) #define	DIR_CrtTime			14	/* Created time (2) */
(0441) #define	DIR_CrtDate			16	/* Created date (2) */
(0442) #define	DIR_FstClusHI		20	/* Higher 16-bit of first cluster (2) */
(0443) #define	DIR_WrtTime			22	/* Modified time (2) */
(0444) #define	DIR_WrtDate			24	/* Modified date (2) */
(0445) #define	DIR_FstClusLO		26	/* Lower 16-bit of first cluster (2) */
(0446) #define	DIR_FileSize		28	/* File size (4) */
(0447) #define	LDIR_Ord			0	/* LFN entry order and LLE flag (1) */
(0448) #define	LDIR_Attr			11	/* LFN attribute (1) */
(0449) #define	LDIR_Type			12	/* LFN type (1) */
(0450) #define	LDIR_Chksum			13	/* Sum of corresponding SFN entry */
(0451) #define	LDIR_FstClusLO		26	/* Filled by zero (0) */
(0452) #define	SZ_DIR				32		/* Size of a directory entry */
(0453) #define	LLE					0x40	/* Last long entry flag in LDIR_Ord */
(0454) #define	DDE					0xE5	/* Deleted directory enrty mark in DIR_Name[0] */
(0455) #define	NDDE				0x05	/* Replacement of a character collides with DDE */
(0456) 
(0457) 
(0458) /*------------------------------------------------------------*/
(0459) /* Module private work area                                   */
(0460) /*------------------------------------------------------------*/
(0461) /* Note that uninitialized variables with static duration are
(0462) /  zeroed/nulled at start-up. If not, the compiler or start-up
(0463) /  routine is out of ANSI-C standard.
(0464) */
(0465) 
(0466) #if _VOLUMES
(0467) static
(0468) FATFS *FatFs[_VOLUMES];	/* Pointer to the file system objects (logical drives) */
(0469) #else
(0470) #error Number of volumes must not be 0.
(0471) #endif
(0472) 
(0473) static
(0474) WORD Fsid;				/* File system mount ID */
(0475) 
(0476) #if _FS_RPATH
(0477) static
(0478) BYTE CurrVol;			/* Current drive */
(0479) #endif
(0480) 
(0481) #if _FS_SHARE
(0482) static
(0483) FILESEM	Files[_FS_SHARE];	/* File lock semaphores */
(0484) #endif
(0485) 
(0486) #if _USE_LFN == 0			/* No LFN feature */
(0487) #define	DEF_NAMEBUF			BYTE sfn[12]
(0488) #define INIT_BUF(dobj)		(dobj).fn = sfn
(0489) #define	FREE_BUF()
(0490) 
(0491) #elif _USE_LFN == 1			/* LFN feature with static working buffer */
(0492) static WCHAR LfnBuf[_MAX_LFN+1];
(0493) #define	DEF_NAMEBUF			BYTE sfn[12]
(0494) #define INIT_BUF(dobj)		{ (dobj).fn = sfn; (dobj).lfn = LfnBuf; }
(0495) #define	FREE_BUF()
(0496) 
(0497) #elif _USE_LFN == 2 		/* LFN feature with dynamic working buffer on the stack */
(0498) #define	DEF_NAMEBUF			BYTE sfn[12]; WCHAR lbuf[_MAX_LFN+1]
(0499) #define INIT_BUF(dobj)		{ (dobj).fn = sfn; (dobj).lfn = lbuf; }
(0500) #define	FREE_BUF()
(0501) 
(0502) #elif _USE_LFN == 3 		/* LFN feature with dynamic working buffer on the heap */
(0503) #define	DEF_NAMEBUF			BYTE sfn[12]; WCHAR *lfn
(0504) #define INIT_BUF(dobj)		{ lfn = ff_memalloc((_MAX_LFN + 1) * 2); \
(0505) 							  if (!lfn) LEAVE_FF((dobj).fs, FR_NOT_ENOUGH_CORE); \
(0506) 							  (dobj).lfn = lfn;	(dobj).fn = sfn; }
(0507) #define	FREE_BUF()			ff_memfree(lfn)
(0508) 
(0509) #else
(0510) #error Wrong LFN configuration.
(0511) #endif
(0512) 
(0513) 
(0514) 
(0515) 
(0516) /*--------------------------------------------------------------------------
(0517) 
(0518)    Module Private Functions
(0519) 
(0520) ---------------------------------------------------------------------------*/
(0521) 
(0522) 
(0523) /*-----------------------------------------------------------------------*/
(0524) /* String functions                                                      */
(0525) /*-----------------------------------------------------------------------*/
(0526) 
(0527) /* Copy memory to memory */
(0528) static
(0529) void mem_cpy (void* dst, const void* src, UINT cnt) {
(0530) 	BYTE *d = (BYTE*)dst;
    003F9 0158      MOVW	R10,R16
(0531) 	const BYTE *s = (const BYTE*)src;
    003FA 0169      MOVW	R12,R18
    003FB C006      RJMP	0x0402
(0532) 
(0533) #if _WORD_ACCESS == 1
(0534) 	while (cnt >= sizeof(int)) {
(0535) 		*(int*)d = *(int*)s;
(0536) 		d += sizeof(int); s += sizeof(int);
(0537) 		cnt -= sizeof(int);
(0538) 	}
(0539) #endif
(0540) 	while (cnt--)
(0541) 		*d++ = *s++;
    003FC 01F6      MOVW	R30,R12
    003FD 01D5      MOVW	R26,R10
    003FE 9001      LD	R0,Z+
    003FF 016F      MOVW	R12,R30
    00400 920D      ST	X+,R0
    00401 015D      MOVW	R10,R26
    00402 011A      MOVW	R2,R20
    00403 5041      SUBI	R20,1
    00404 4050      SBCI	R21,0
    00405 2022      TST	R2
    00406 F7A9      BNE	0x03FC
    00407 2033      TST	R3
    00408 F799      BNE	0x03FC
    00409 940C 4879 JMP	pop_xgset303C
ff.c:mem_set:
  d                    --> R10
  cnt                  --> R20
  val                  --> R18
  dst                  --> R16
    0040B 940E 4850 CALL	push_xgset300C
    0040D 814C      LDD	R20,Y+4
    0040E 815D      LDD	R21,Y+5
(0542) }
(0543) 
(0544) /* Fill memory */
(0545) static
(0546) void mem_set (void* dst, int val, UINT cnt) {
(0547) 	BYTE *d = (BYTE*)dst;
    0040F 0158      MOVW	R10,R16
    00410 C003      RJMP	0x0414
(0548) 
(0549) 	while (cnt--)
(0550) 		*d++ = (BYTE)val;
    00411 01F5      MOVW	R30,R10
    00412 9321      ST	Z+,R18
    00413 015F      MOVW	R10,R30
    00414 011A      MOVW	R2,R20
    00415 5041      SUBI	R20,1
    00416 4050      SBCI	R21,0
    00417 2022      TST	R2
    00418 F7C1      BNE	0x0411
    00419 2033      TST	R3
    0041A F7B1      BNE	0x0411
    0041B 940C 4855 JMP	pop_xgset300C
ff.c:mem_cmp:
  s                    --> R14
  d                    --> R12
  r                    --> R10
  cnt                  --> R20
  src                  --> R18
  dst                  --> R16
    0041D 940E 4847 CALL	push_xgset30FC
    0041F 8548      LDD	R20,Y+8
    00420 8559      LDD	R21,Y+9
(0551) }
(0552) 
(0553) /* Compare memory to memory */
(0554) static
(0555) int mem_cmp (const void* dst, const void* src, UINT cnt) {
(0556) 	const BYTE *d = (const BYTE *)dst, *s = (const BYTE *)src;
    00421 0168      MOVW	R12,R16
    00422 0179      MOVW	R14,R18
(0557) 	int r = 0;
    00423 24AA      CLR	R10
    00424 24BB      CLR	R11
(0558) 
(0559) 	while (cnt-- && (r = *d++ - *s++) == 0) ;
    00425 011A      MOVW	R2,R20
    00426 5041      SUBI	R20,1
    00427 4050      SBCI	R21,0
    00428 2022      TST	R2
    00429 F411      BNE	0x042C
    0042A 2033      TST	R3
    0042B F079      BEQ	0x043B
    0042C 01F7      MOVW	R30,R14
    0042D 9021      LD	R2,Z+
    0042E 017F      MOVW	R14,R30
    0042F 2433      CLR	R3
    00430 01F6      MOVW	R30,R12
    00431 9041      LD	R4,Z+
    00432 016F      MOVW	R12,R30
    00433 2455      CLR	R5
    00434 1842      SUB	R4,R2
    00435 0853      SBC	R5,R3
    00436 0152      MOVW	R10,R4
    00437 20AA      TST	R10
    00438 F411      BNE	0x043B
    00439 20BB      TST	R11
    0043A F351      BEQ	0x0425
(0560) 	return r;
    0043B 0185      MOVW	R16,R10
    0043C 940C 4831 JMP	pop_xgset30FC
(0561) }
(0562) 
(0563) /* Check if chr is contained in the string */
(0564) static
(0565) int chk_chr (const char* str, int chr) {
ff.c:chk_chr:
  chr                  --> R18
  str                  --> R16
    0043E C002      RJMP	0x0441
(0566) 	while (*str && *str != chr) str++;
    0043F 5F0F      SUBI	R16,0xFF
    00440 4F1F      SBCI	R17,0xFF
    00441 01F8      MOVW	R30,R16
    00442 8020      LD	R2,Z
    00443 2433      CLR	R3
    00444 2022      TST	R2
    00445 F021      BEQ	0x044A
    00446 2433      CLR	R3
    00447 1622      CP	R2,R18
    00448 0633      CPC	R3,R19
    00449 F7A9      BNE	0x043F
(0567) 	return *str;
    0044A 01F8      MOVW	R30,R16
    0044B 8100      LD	R16,Z
    0044C 2711      CLR	R17
    0044D 9508      RET
ff.c:move_window:
  nf                   --> R10
  wsect                --> Y,+5
  sector               --> Y,+13
  fs                   --> R20
    0044E 933A      ST	-Y,R19
    0044F 932A      ST	-Y,R18
    00450 940E 4850 CALL	push_xgset300C
    00452 01A8      MOVW	R20,R16
    00453 9729      SBIW	R28,0x9
(0568) }
(0569) 
(0570) 
(0571) 
(0572) /*-----------------------------------------------------------------------*/
(0573) /* Request/Release grant to access the volume                            */
(0574) /*-----------------------------------------------------------------------*/
(0575) #if _FS_REENTRANT
(0576) 
(0577) static
(0578) int lock_fs (
(0579) 	FATFS *fs		/* File system object */
(0580) )
(0581) {
(0582) 	return ff_req_grant(fs->sobj);
(0583) }
(0584) 
(0585) 
(0586) static
(0587) void unlock_fs (
(0588) 	FATFS *fs,		/* File system object */
(0589) 	FRESULT res		/* Result code to be returned */
(0590) )
(0591) {
(0592) 	if (res != FR_NOT_ENABLED &&
(0593) 		res != FR_INVALID_DRIVE &&
(0594) 		res != FR_INVALID_OBJECT &&
(0595) 		res != FR_TIMEOUT) {
(0596) 		ff_rel_grant(fs->sobj);
(0597) 	}
(0598) }
(0599) #endif
(0600) 
(0601) 
(0602) 
(0603) /*-----------------------------------------------------------------------*/
(0604) /* File shareing control functions                                       */
(0605) /*-----------------------------------------------------------------------*/
(0606) #if _FS_SHARE
(0607) 
(0608) static
(0609) FRESULT chk_lock (	/* Check if the file can be accessed */
(0610) 	DIR* dj,		/* Directory object pointing the file to be checked */
(0611) 	int acc			/* Desired access (0:Read, 1:Write, 2:Delete/Rename) */
(0612) )
(0613) {
(0614) 	UINT i, be;
(0615) 
(0616) 	/* Search file semaphore table */
(0617) 	for (i = be = 0; i < _FS_SHARE; i++) {
(0618) 		if (Files[i].fs) {	/* Existing entry */
(0619) 			if (Files[i].fs == dj->fs &&	 	/* Check if the file matched with an open file */
(0620) 				Files[i].clu == dj->sclust &&
(0621) 				Files[i].idx == dj->index) break;
(0622) 		} else {			/* Blank entry */
(0623) 			be++;
(0624) 		}
(0625) 	}
(0626) 	if (i == _FS_SHARE)	/* The file is not opened */
(0627) 		return (be || acc == 2) ? FR_OK : FR_TOO_MANY_OPEN_FILES;	/* Is there a blank entry for new file? */
(0628) 
(0629) 	/* The file has been opened. Reject any open against writing file and all write mode open */
(0630) 	return (acc || Files[i].ctr == 0x100) ? FR_LOCKED : FR_OK;
(0631) }
(0632) 
(0633) 
(0634) static
(0635) int enq_lock (void)	/* Check if an entry is available for a new file */
(0636) {
(0637) 	UINT i;
(0638) 
(0639) 	for (i = 0; i < _FS_SHARE && Files[i].fs; i++) ;
(0640) 	return (i == _FS_SHARE) ? 0 : 1;
(0641) }
(0642) 
(0643) 
(0644) static
(0645) UINT inc_lock (	/* Increment file open counter and returns its index (0:int error) */
(0646) 	DIR* dj,	/* Directory object pointing the file to register or increment */
(0647) 	int acc		/* Desired access mode (0:Read, !0:Write) */
(0648) )
(0649) {
(0650) 	UINT i;
(0651) 
(0652) 
(0653) 	for (i = 0; i < _FS_SHARE; i++) {	/* Find the file */
(0654) 		if (Files[i].fs == dj->fs &&
(0655) 			Files[i].clu == dj->sclust &&
(0656) 			Files[i].idx == dj->index) break;
(0657) 	}
(0658) 
(0659) 	if (i == _FS_SHARE) {				/* Not opened. Register it as new. */
(0660) 		for (i = 0; i < _FS_SHARE && Files[i].fs; i++) ;
(0661) 		if (i == _FS_SHARE) return 0;	/* No space to register (int err) */
(0662) 		Files[i].fs = dj->fs;
(0663) 		Files[i].clu = dj->sclust;
(0664) 		Files[i].idx = dj->index;
(0665) 		Files[i].ctr = 0;
(0666) 	}
(0667) 
(0668) 	if (acc && Files[i].ctr) return 0;	/* Access violation (int err) */
(0669) 
(0670) 	Files[i].ctr = acc ? 0x100 : Files[i].ctr + 1;	/* Set semaphore value */
(0671) 
(0672) 	return i + 1;
(0673) }
(0674) 
(0675) 
(0676) static
(0677) FRESULT dec_lock (	/* Decrement file open counter */
(0678) 	UINT i			/* Semaphore index */
(0679) )
(0680) {
(0681) 	WORD n;
(0682) 	FRESULT res;
(0683) 
(0684) 
(0685) 	if (--i < _FS_SHARE) {
(0686) 		n = Files[i].ctr;
(0687) 		if (n == 0x100) n = 0;
(0688) 		if (n) n--;
(0689) 		Files[i].ctr = n;
(0690) 		if (!n) Files[i].fs = 0;
(0691) 		res = FR_OK;
(0692) 	} else {
(0693) 		res = FR_INT_ERR;
(0694) 	}
(0695) 	return res;
(0696) }
(0697) 
(0698) 
(0699) static
(0700) void clear_lock (	/* Clear lock entries of the volume */
(0701) 	FATFS *fs
(0702) )
(0703) {
(0704) 	UINT i;
(0705) 
(0706) 	for (i = 0; i < _FS_SHARE; i++) {
(0707) 		if (Files[i].fs == fs) Files[i].fs = 0;
(0708) 	}
(0709) }
(0710) #endif
(0711) 
(0712) 
(0713) 
(0714) /*-----------------------------------------------------------------------*/
(0715) /* Change window offset                                                  */
(0716) /*-----------------------------------------------------------------------*/
(0717) 
(0718) static
(0719) FRESULT move_window (
(0720) 	FATFS *fs,		/* File system object */
(0721) 	DWORD sector	/* Sector number to make appearance in the fs->win[] */
(0722) )					/* Move to zero only writes back dirty window */
(0723) {
(0724) 	DWORD wsect;
(0725) 
(0726) 
(0727) 	wsect = fs->winsect;
    00454 01FA      MOVW	R30,R20
    00455 96BA      ADIW	R30,0x2A
    00456 8020      LD	R2,Z
    00457 8031      LDD	R3,Z+1
    00458 8042      LDD	R4,Z+2
    00459 8053      LDD	R5,Z+3
    0045A 822D      STD	Y+5,R2
    0045B 823E      STD	Y+6,R3
    0045C 824F      STD	Y+7,R4
    0045D 8658      STD	Y+8,R5
(0728) 	if (wsect != sector) {	/* Changed current window */
    0045E 842D      LDD	R2,Y+13
    0045F 843E      LDD	R3,Y+14
    00460 844F      LDD	R4,Y+15
    00461 8858      LDD	R5,Y+16
    00462 806D      LDD	R6,Y+5
    00463 807E      LDD	R7,Y+6
    00464 808F      LDD	R8,Y+7
    00465 8498      LDD	R9,Y+8
    00466 1462      CP	R6,R2
    00467 0473      CPC	R7,R3
    00468 0484      CPC	R8,R4
    00469 0495      CPC	R9,R5
    0046A F409      BNE	0x046C
    0046B C07E      RJMP	0x04EA
(0729) #if !_FS_READONLY
(0730) 		if (fs->wflag) {	/* Write back dirty window if needed */
    0046C 01FA      MOVW	R30,R20
    0046D 8024      LDD	R2,Z+4
    0046E 2022      TST	R2
    0046F F409      BNE	0x0471
    00470 C055      RJMP	0x04C6
(0731) 			if (disk_write(fs->drv, fs->win, wsect, 1) != RES_OK)
    00471 E081      LDI	R24,1
    00472 838C      STD	Y+4,R24
    00473 0113      MOVW	R2,R6
    00474 0124      MOVW	R4,R8
    00475 8228      ST	Y,R2
    00476 8239      STD	Y+1,R3
    00477 824A      STD	Y+2,R4
    00478 825B      STD	Y+3,R5
    00479 019A      MOVW	R18,R20
    0047A 5D22      SUBI	R18,0xD2
    0047B 4F3F      SBCI	R19,0xFF
    0047C 8101      LDD	R16,Z+1
    0047D 940E 03D3 CALL	_disk_write
    0047F 2300      TST	R16
    00480 F011      BEQ	0x0483
(0732) 				return FR_DISK_ERR;
    00481 E001      LDI	R16,1
    00482 C068      RJMP	0x04EB
(0733) 			fs->wflag = 0;
    00483 2422      CLR	R2
    00484 01FA      MOVW	R30,R20
    00485 8224      STD	Z+4,R2
(0734) 			if (wsect < (fs->fatbase + fs->fsize)) {	/* In FAT area */
    00486 8C22      LDD	R2,Z+26
    00487 8C33      LDD	R3,Z+27
    00488 8C44      LDD	R4,Z+28
    00489 8C55      LDD	R5,Z+29
    0048A 967E      ADIW	R30,0x1E
    0048B 8060      LD	R6,Z
    0048C 8071      LDD	R7,Z+1
    0048D 8082      LDD	R8,Z+2
    0048E 8093      LDD	R9,Z+3
    0048F 0C62      ADD	R6,R2
    00490 1C73      ADC	R7,R3
    00491 1C84      ADC	R8,R4
    00492 1C95      ADC	R9,R5
    00493 802D      LDD	R2,Y+5
    00494 803E      LDD	R3,Y+6
    00495 804F      LDD	R4,Y+7
    00496 8458      LDD	R5,Y+8
    00497 1426      CP	R2,R6
    00498 0437      CPC	R3,R7
    00499 0448      CPC	R4,R8
    0049A 0459      CPC	R5,R9
    0049B F550      BCC	0x04C6
(0735) 				BYTE nf;
(0736) 				for (nf = fs->n_fats; nf > 1; nf--) {	/* Reflect the change to all FAT copies */
    0049C 01FA      MOVW	R30,R20
    0049D 80A3      LDD	R10,Z+3
    0049E C024      RJMP	0x04C3
(0737) 					wsect += fs->fsize;
    0049F 01FA      MOVW	R30,R20
    004A0 967A      ADIW	R30,0x1A
    004A1 8020      LD	R2,Z
    004A2 8031      LDD	R3,Z+1
    004A3 8042      LDD	R4,Z+2
    004A4 8053      LDD	R5,Z+3
    004A5 806D      LDD	R6,Y+5
    004A6 807E      LDD	R7,Y+6
    004A7 808F      LDD	R8,Y+7
    004A8 8498      LDD	R9,Y+8
    004A9 0C62      ADD	R6,R2
    004AA 1C73      ADC	R7,R3
    004AB 1C84      ADC	R8,R4
    004AC 1C95      ADC	R9,R5
    004AD 826D      STD	Y+5,R6
    004AE 827E      STD	Y+6,R7
    004AF 828F      STD	Y+7,R8
    004B0 8698      STD	Y+8,R9
(0738) 					disk_write(fs->drv, fs->win, wsect, 1);
    004B1 E081      LDI	R24,1
    004B2 838C      STD	Y+4,R24
    004B3 802D      LDD	R2,Y+5
    004B4 803E      LDD	R3,Y+6
    004B5 804F      LDD	R4,Y+7
    004B6 8458      LDD	R5,Y+8
    004B7 8228      ST	Y,R2
    004B8 8239      STD	Y+1,R3
    004B9 824A      STD	Y+2,R4
    004BA 825B      STD	Y+3,R5
    004BB 019A      MOVW	R18,R20
    004BC 5D22      SUBI	R18,0xD2
    004BD 4F3F      SBCI	R19,0xFF
    004BE 01FA      MOVW	R30,R20
    004BF 8101      LDD	R16,Z+1
    004C0 940E 03D3 CALL	_disk_write
    004C2 94AA      DEC	R10
    004C3 E081      LDI	R24,1
    004C4 158A      CP	R24,R10
    004C5 F2C8      BCS	0x049F
(0739) 				}
(0740) 			}
(0741) 		}
(0742) #endif
(0743) 		if (sector) {
    004C6 842D      LDD	R2,Y+13
    004C7 843E      LDD	R3,Y+14
    004C8 844F      LDD	R4,Y+15
    004C9 8858      LDD	R5,Y+16
    004CA 9488      BCLR	0
    004CB 2022      TST	R2
    004CC 0432      CPC	R3,R2
    004CD 0442      CPC	R4,R2
    004CE 0452      CPC	R5,R2
    004CF F0D1      BEQ	0x04EA
(0744) 			if (disk_read(fs->drv, fs->win, sector, 1) != RES_OK)
    004D0 E081      LDI	R24,1
    004D1 838C      STD	Y+4,R24
    004D2 8228      ST	Y,R2
    004D3 8239      STD	Y+1,R3
    004D4 824A      STD	Y+2,R4
    004D5 825B      STD	Y+3,R5
    004D6 019A      MOVW	R18,R20
    004D7 5D22      SUBI	R18,0xD2
    004D8 4F3F      SBCI	R19,0xFF
    004D9 01FA      MOVW	R30,R20
    004DA 8101      LDD	R16,Z+1
    004DB 940E 03B3 CALL	_disk_read
    004DD 2300      TST	R16
    004DE F011      BEQ	0x04E1
(0745) 				return FR_DISK_ERR;
    004DF E001      LDI	R16,1
    004E0 C00A      RJMP	0x04EB
(0746) 			fs->winsect = sector;
    004E1 842D      LDD	R2,Y+13
    004E2 843E      LDD	R3,Y+14
    004E3 844F      LDD	R4,Y+15
    004E4 8858      LDD	R5,Y+16
    004E5 01FA      MOVW	R30,R20
    004E6 A622      STD	Z+42,R2
    004E7 A633      STD	Z+43,R3
    004E8 A644      STD	Z+44,R4
    004E9 A655      STD	Z+45,R5
(0747) 		}
(0748) 	}
(0749) 
(0750) 	return FR_OK;
    004EA 2700      CLR	R16
    004EB 9629      ADIW	R28,0x9
    004EC 940E 4855 CALL	pop_xgset300C
    004EE 9622      ADIW	R28,2
    004EF 9508      RET
ff.c:sync:
  res                  --> R20
  fs                   --> R22
    004F0 940E 485A CALL	push_xgsetF000
    004F2 01B8      MOVW	R22,R16
    004F3 9725      SBIW	R28,5
(0751) }
(0752) 
(0753) 
(0754) 
(0755) 
(0756) /*-----------------------------------------------------------------------*/
(0757) /* Clean-up cached data                                                  */
(0758) /*-----------------------------------------------------------------------*/
(0759) #if !_FS_READONLY
(0760) static
(0761) FRESULT sync (	/* FR_OK: successful, FR_DISK_ERR: failed */
(0762) 	FATFS *fs	/* File system object */
(0763) )
(0764) {
(0765) 	FRESULT res;
(0766) 
(0767) 
(0768) 	res = move_window(fs, 0);
    004F4 E080      LDI	R24,0
    004F5 E090      LDI	R25,0
    004F6 E0A0      LDI	R26,0
    004F7 E0B0      LDI	R27,0
    004F8 83A8      ST	Y,R26
    004F9 83B9      STD	Y+1,R27
    004FA 019C      MOVW	R18,R24
    004FB 018B      MOVW	R16,R22
    004FC DF51      RCALL	ff.c:move_window
    004FD 2F40      MOV	R20,R16
(0769) 	if (res == FR_OK) {
    004FE 2300      TST	R16
    004FF F009      BEQ	0x0501
    00500 C0C0      RJMP	0x05C1
(0770) 		/* Update FSInfo sector if needed */
(0771) 		if (fs->fs_type == FS_FAT32 && fs->fsi_flag) {
    00501 01FB      MOVW	R30,R22
    00502 8180      LD	R24,Z
    00503 3083      CPI	R24,3
    00504 F009      BEQ	0x0506
    00505 C0AC      RJMP	0x05B2
    00506 8025      LDD	R2,Z+5
    00507 2022      TST	R2
    00508 F409      BNE	0x050A
    00509 C0A8      RJMP	0x05B2
(0772) 			fs->winsect = 0;
    0050A 96BA      ADIW	R30,0x2A
    0050B E080      LDI	R24,0
    0050C 8380      ST	Z,R24
    0050D 8381      STD	Z+1,R24
    0050E 8382      STD	Z+2,R24
    0050F 8383      STD	Z+3,R24
(0773) 			/* Create FSInfo structure */
(0774) 			mem_set(fs->win, 0, 512);
    00510 E080      LDI	R24,0
    00511 E092      LDI	R25,2
    00512 8399      STD	Y+1,R25
    00513 8388      ST	Y,R24
    00514 2722      CLR	R18
    00515 2733      CLR	R19
    00516 018B      MOVW	R16,R22
    00517 5D02      SUBI	R16,0xD2
    00518 4F1F      SBCI	R17,0xFF
    00519 DEF1      RCALL	ff.c:mem_set
(0775) 			ST_WORD(fs->win+BS_55AA, 0xAA55);
    0051A E585      LDI	R24,0x55
    0051B 01FB      MOVW	R30,R22
    0051C 5DE4      SUBI	R30,0xD4
    0051D 4FFD      SBCI	R31,0xFD
    0051E 8380      ST	Z,R24
    0051F 52EC      SUBI	R30,0x2C
    00520 40F2      SBCI	R31,2
    00521 EA8A      LDI	R24,0xAA
    00522 5DE3      SUBI	R30,0xD3
    00523 4FFD      SBCI	R31,0xFD
    00524 8380      ST	Z,R24
    00525 52ED      SUBI	R30,0x2D
    00526 40F2      SBCI	R31,2
(0776) 			ST_DWORD(fs->win+FSI_LeadSig, 0x41615252);
    00527 E582      LDI	R24,0x52
    00528 A786      STD	Z+46,R24
    00529 A787      STD	Z+47,R24
    0052A E681      LDI	R24,0x61
    0052B AB80      STD	Z+48,R24
    0052C E481      LDI	R24,0x41
    0052D AB81      STD	Z+49,R24
(0777) 			ST_DWORD(fs->win+FSI_StrucSig, 0x61417272);
    0052E E782      LDI	R24,0x72
    0052F 5EEE      SUBI	R30,0xEE
    00530 4FFD      SBCI	R31,0xFD
    00531 8380      ST	Z,R24
    00532 51E2      SUBI	R30,0x12
    00533 40F2      SBCI	R31,2
    00534 5EED      SUBI	R30,0xED
    00535 4FFD      SBCI	R31,0xFD
    00536 8380      ST	Z,R24
    00537 51E3      SUBI	R30,0x13
    00538 40F2      SBCI	R31,2
    00539 E481      LDI	R24,0x41
    0053A 5EEC      SUBI	R30,0xEC
    0053B 4FFD      SBCI	R31,0xFD
    0053C 8380      ST	Z,R24
    0053D 51E4      SUBI	R30,0x14
    0053E 40F2      SBCI	R31,2
    0053F E681      LDI	R24,0x61
    00540 5EEB      SUBI	R30,0xEB
    00541 4FFD      SBCI	R31,0xFD
    00542 8380      ST	Z,R24
    00543 51E5      SUBI	R30,0x15
    00544 40F2      SBCI	R31,2
(0778) 			ST_DWORD(fs->win+FSI_Free_Count, fs->free_clust);
    00545 8426      LDD	R2,Z+14
    00546 8437      LDD	R3,Z+15
    00547 8840      LDD	R4,Z+16
    00548 8851      LDD	R5,Z+17
    00549 5EEA      SUBI	R30,0xEA
    0054A 4FFD      SBCI	R31,0xFD
    0054B 8220      ST	Z,R2
    0054C 51E6      SUBI	R30,0x16
    0054D 40F2      SBCI	R31,2
    0054E 8426      LDD	R2,Z+14
    0054F 8437      LDD	R3,Z+15
    00550 2C23      MOV	R2,R3
    00551 2433      CLR	R3
    00552 5EE9      SUBI	R30,0xE9
    00553 4FFD      SBCI	R31,0xFD
    00554 8220      ST	Z,R2
    00555 51E7      SUBI	R30,0x17
    00556 40F2      SBCI	R31,2
    00557 8426      LDD	R2,Z+14
    00558 8437      LDD	R3,Z+15
    00559 8840      LDD	R4,Z+16
    0055A 8851      LDD	R5,Z+17
    0055B 0112      MOVW	R2,R4
    0055C 2444      CLR	R4
    0055D 2455      CLR	R5
    0055E 5EE8      SUBI	R30,0xE8
    0055F 4FFD      SBCI	R31,0xFD
    00560 8220      ST	Z,R2
    00561 51E8      SUBI	R30,0x18
    00562 40F2      SBCI	R31,2
    00563 E188      LDI	R24,0x18
    00564 E090      LDI	R25,0
    00565 8506      LDD	R16,Z+14
    00566 8517      LDD	R17,Z+15
    00567 8920      LDD	R18,Z+16
    00568 8931      LDD	R19,Z+17
    00569 938A      ST	-Y,R24
    0056A 940E 48E9 CALL	lsr32
    0056C 01FB      MOVW	R30,R22
    0056D 5EE7      SUBI	R30,0xE7
    0056E 4FFD      SBCI	R31,0xFD
    0056F 8300      ST	Z,R16
    00570 51E9      SUBI	R30,0x19
    00571 40F2      SBCI	R31,2
(0779) 			ST_DWORD(fs->win+FSI_Nxt_Free, fs->last_clust);
    00572 8422      LDD	R2,Z+10
    00573 8433      LDD	R3,Z+11
    00574 8444      LDD	R4,Z+12
    00575 8455      LDD	R5,Z+13
    00576 5EE6      SUBI	R30,0xE6
    00577 4FFD      SBCI	R31,0xFD
    00578 8220      ST	Z,R2
    00579 51EA      SUBI	R30,0x1A
    0057A 40F2      SBCI	R31,2
    0057B 8422      LDD	R2,Z+10
    0057C 8433      LDD	R3,Z+11
    0057D 2C23      MOV	R2,R3
    0057E 2433      CLR	R3
    0057F 5EE5      SUBI	R30,0xE5
    00580 4FFD      SBCI	R31,0xFD
    00581 8220      ST	Z,R2
    00582 51EB      SUBI	R30,0x1B
    00583 40F2      SBCI	R31,2
    00584 8422      LDD	R2,Z+10
    00585 8433      LDD	R3,Z+11
    00586 8444      LDD	R4,Z+12
    00587 8455      LDD	R5,Z+13
    00588 0112      MOVW	R2,R4
    00589 2444      CLR	R4
    0058A 2455      CLR	R5
    0058B 5EE4      SUBI	R30,0xE4
    0058C 4FFD      SBCI	R31,0xFD
    0058D 8220      ST	Z,R2
    0058E 51EC      SUBI	R30,0x1C
    0058F 40F2      SBCI	R31,2
    00590 E188      LDI	R24,0x18
    00591 E090      LDI	R25,0
    00592 8502      LDD	R16,Z+10
    00593 8513      LDD	R17,Z+11
    00594 8524      LDD	R18,Z+12
    00595 8535      LDD	R19,Z+13
    00596 938A      ST	-Y,R24
    00597 940E 48E9 CALL	lsr32
    00599 01FB      MOVW	R30,R22
    0059A 5EE3      SUBI	R30,0xE3
    0059B 4FFD      SBCI	R31,0xFD
    0059C 8300      ST	Z,R16
    0059D 51ED      SUBI	R30,0x1D
    0059E 40F2      SBCI	R31,2
(0780) 			/* Write it into the FSInfo sector */
(0781) 			disk_write(fs->drv, fs->win, fs->fsi_sector, 1);
    0059F E081      LDI	R24,1
    005A0 838C      STD	Y+4,R24
    005A1 8822      LDD	R2,Z+18
    005A2 8833      LDD	R3,Z+19
    005A3 8844      LDD	R4,Z+20
    005A4 8855      LDD	R5,Z+21
    005A5 8228      ST	Y,R2
    005A6 8239      STD	Y+1,R3
    005A7 824A      STD	Y+2,R4
    005A8 825B      STD	Y+3,R5
    005A9 019F      MOVW	R18,R30
    005AA 5D22      SUBI	R18,0xD2
    005AB 4F3F      SBCI	R19,0xFF
    005AC 8101      LDD	R16,Z+1
    005AD 940E 03D3 CALL	_disk_write
(0782) 			fs->fsi_flag = 0;
    005AF 2422      CLR	R2
    005B0 01FB      MOVW	R30,R22
    005B1 8225      STD	Z+5,R2
(0783) 		}
(0784) 		/* Make sure that no pending write process in the physical drive */
(0785) 		if (disk_ioctl(fs->drv, CTRL_SYNC, 0) != RES_OK)
    005B2 2422      CLR	R2
    005B3 2433      CLR	R3
    005B4 8239      STD	Y+1,R3
    005B5 8228      ST	Y,R2
    005B6 2722      CLR	R18
    005B7 2733      CLR	R19
    005B8 01FB      MOVW	R30,R22
    005B9 8101      LDD	R16,Z+1
    005BA 2711      CLR	R17
    005BB 940E 03EB CALL	_disk_ioctl
    005BD 3000      CPI	R16,0
    005BE 0701      CPC	R16,R17
    005BF F009      BEQ	0x05C1
(0786) 			res = FR_DISK_ERR;
    005C0 E041      LDI	R20,1
(0787) 	}
(0788) 
(0789) 	return res;
    005C1 2F04      MOV	R16,R20
    005C2 9625      ADIW	R28,5
    005C3 940C 485F JMP	pop_xgsetF000
_clust2sect:
  clst                 --> Y,+6
  fs                   --> R10
    005C5 933A      ST	-Y,R19
    005C6 932A      ST	-Y,R18
    005C7 940E 4864 CALL	push_xgsetF00C
    005C9 0158      MOVW	R10,R16
(0790) }
(0791) #endif
(0792) 
(0793) 
(0794) 
(0795) 
(0796) /*-----------------------------------------------------------------------*/
(0797) /* Get sector# from cluster#                                             */
(0798) /*-----------------------------------------------------------------------*/
(0799) 
(0800) 
(0801) DWORD clust2sect (	/* !=0: Sector number, 0: Failed - invalid cluster# */
(0802) 	FATFS *fs,		/* File system object */
(0803) 	DWORD clst		/* Cluster# to be converted */
(0804) )
(0805) {
(0806) 	clst -= 2;
    005CA E042      LDI	R20,2
    005CB E050      LDI	R21,0
    005CC E060      LDI	R22,0
    005CD E070      LDI	R23,0
    005CE 802E      LDD	R2,Y+6
    005CF 803F      LDD	R3,Y+7
    005D0 8448      LDD	R4,Y+8
    005D1 8459      LDD	R5,Y+9
    005D2 1A24      SUB	R2,R20
    005D3 0A35      SBC	R3,R21
    005D4 0A46      SBC	R4,R22
    005D5 0A57      SBC	R5,R23
    005D6 822E      STD	Y+6,R2
    005D7 823F      STD	Y+7,R3
    005D8 8648      STD	Y+8,R4
    005D9 8659      STD	Y+9,R5
(0807) 	if (clst >= (fs->n_fatent - 2)) return 0;		/* Invalid cluster# */
    005DA E042      LDI	R20,2
    005DB E050      LDI	R21,0
    005DC E060      LDI	R22,0
    005DD E070      LDI	R23,0
    005DE 01F5      MOVW	R30,R10
    005DF 9676      ADIW	R30,0x16
    005E0 8020      LD	R2,Z
    005E1 8031      LDD	R3,Z+1
    005E2 8042      LDD	R4,Z+2
    005E3 8053      LDD	R5,Z+3
    005E4 1A24      SUB	R2,R20
    005E5 0A35      SBC	R3,R21
    005E6 0A46      SBC	R4,R22
    005E7 0A57      SBC	R5,R23
    005E8 806E      LDD	R6,Y+6
    005E9 807F      LDD	R7,Y+7
    005EA 8488      LDD	R8,Y+8
    005EB 8499      LDD	R9,Y+9
    005EC 1462      CP	R6,R2
    005ED 0473      CPC	R7,R3
    005EE 0484      CPC	R8,R4
    005EF 0495      CPC	R9,R5
    005F0 F028      BCS	0x05F6
    005F1 E000      LDI	R16,0
    005F2 E010      LDI	R17,0
    005F3 E020      LDI	R18,0
    005F4 E030      LDI	R19,0
    005F5 C01D      RJMP	0x0613
(0808) 	return clst * fs->csize + fs->database;
    005F6 01F5      MOVW	R30,R10
    005F7 9632      ADIW	R30,2
    005F8 8020      LD	R2,Z
    005F9 2433      CLR	R3
    005FA 2444      CLR	R4
    005FB 2455      CLR	R5
    005FC 810E      LDD	R16,Y+6
    005FD 811F      LDD	R17,Y+7
    005FE 8528      LDD	R18,Y+8
    005FF 8539      LDD	R19,Y+9
    00600 925A      ST	-Y,R5
    00601 924A      ST	-Y,R4
    00602 923A      ST	-Y,R3
    00603 922A      ST	-Y,R2
    00604 940E 47F1 CALL	empy32s|empy32u
    00606 0118      MOVW	R2,R16
    00607 0129      MOVW	R4,R18
    00608 01F5      MOVW	R30,R10
    00609 A066      LDD	R6,Z+38
    0060A A077      LDD	R7,Z+39
    0060B A480      LDD	R8,Z+40
    0060C A491      LDD	R9,Z+41
    0060D 0C26      ADD	R2,R6
    0060E 1C37      ADC	R3,R7
    0060F 1C48      ADC	R4,R8
    00610 1C59      ADC	R5,R9
    00611 0181      MOVW	R16,R2
    00612 0192      MOVW	R18,R4
    00613 940E 486B CALL	pop_xgsetF00C
    00615 9622      ADIW	R28,2
    00616 9508      RET
_get_fat:
  wc                   --> R14
  p                    --> R10
  bc                   --> R10
  clst                 --> Y,+12
  fs                   --> R12
    00617 933A      ST	-Y,R19
    00618 932A      ST	-Y,R18
    00619 940E 4845 CALL	push_xgsetF0FC
    0061B 0168      MOVW	R12,R16
    0061C 9722      SBIW	R28,2
(0809) }
(0810) 
(0811) 
(0812) 
(0813) 
(0814) /*-----------------------------------------------------------------------*/
(0815) /* FAT access - Read value of a FAT entry                                */
(0816) /*-----------------------------------------------------------------------*/
(0817) 
(0818) 
(0819) DWORD get_fat (	/* 0xFFFFFFFF:Disk error, 1:Internal error, Else:Cluster status */
(0820) 	FATFS *fs,	/* File system object */
(0821) 	DWORD clst	/* Cluster# to get the link information */
(0822) )
(0823) {
(0824) 	UINT wc, bc;
(0825) 	BYTE *p;
(0826) 
(0827) 
(0828) 	if (clst < 2 || clst >= fs->n_fatent)	/* Chack range */
    0061D E042      LDI	R20,2
    0061E E050      LDI	R21,0
    0061F E060      LDI	R22,0
    00620 E070      LDI	R23,0
    00621 842C      LDD	R2,Y+12
    00622 843D      LDD	R3,Y+13
    00623 844E      LDD	R4,Y+14
    00624 845F      LDD	R5,Y+15
    00625 1624      CP	R2,R20
    00626 0635      CPC	R3,R21
    00627 0646      CPC	R4,R22
    00628 0657      CPC	R5,R23
    00629 F078      BCS	0x0639
    0062A 01F6      MOVW	R30,R12
    0062B 9676      ADIW	R30,0x16
    0062C 8020      LD	R2,Z
    0062D 8031      LDD	R3,Z+1
    0062E 8042      LDD	R4,Z+2
    0062F 8053      LDD	R5,Z+3
    00630 846C      LDD	R6,Y+12
    00631 847D      LDD	R7,Y+13
    00632 848E      LDD	R8,Y+14
    00633 849F      LDD	R9,Y+15
    00634 1462      CP	R6,R2
    00635 0473      CPC	R7,R3
    00636 0484      CPC	R8,R4
    00637 0495      CPC	R9,R5
    00638 F028      BCS	0x063E
(0829) 		return 1;
    00639 E001      LDI	R16,1
    0063A E010      LDI	R17,0
    0063B E020      LDI	R18,0
    0063C E030      LDI	R19,0
    0063D C124      RJMP	0x0762
(0830) 
(0831) 	switch (fs->fs_type) {
    0063E 01F6      MOVW	R30,R12
    0063F 80A0      LD	R10,Z
    00640 24BB      CLR	R11
    00641 01C5      MOVW	R24,R10
    00642 3081      CPI	R24,1
    00643 E0E0      LDI	R30,0
    00644 079E      CPC	R25,R30
    00645 F059      BEQ	0x0651
    00646 3082      CPI	R24,2
    00647 E0E0      LDI	R30,0
    00648 079E      CPC	R25,R30
    00649 F409      BNE	0x064B
    0064A C06F      RJMP	0x06BA
    0064B 3083      CPI	R24,3
    0064C E0E0      LDI	R30,0
    0064D 079E      CPC	R25,R30
    0064E F409      BNE	0x0650
    0064F C0A6      RJMP	0x06F6
    00650 C10D      RJMP	0x075E
(0832) 	case FS_FAT12 :
(0833) 		bc = (UINT)clst; bc += bc / 2;
    00651 84AC      LDD	R10,Y+12
    00652 84BD      LDD	R11,Y+13
    00653 0115      MOVW	R2,R10
    00654 9436      LSR	R3
    00655 9427      ROR	R2
    00656 0CA2      ADD	R10,R2
    00657 1CB3      ADC	R11,R3
(0834) 		if (move_window(fs, fs->fatbase + (bc / SS(fs)))) break;
    00658 E029      LDI	R18,0x9
    00659 E030      LDI	R19,0
    0065A 0185      MOVW	R16,R10
    0065B 940E 48E2 CALL	lsr16
    0065D 0118      MOVW	R2,R16
    0065E 2444      CLR	R4
    0065F 2455      CLR	R5
    00660 01F6      MOVW	R30,R12
    00661 8C66      LDD	R6,Z+30
    00662 8C77      LDD	R7,Z+31
    00663 A080      LDD	R8,Z+32
    00664 A091      LDD	R9,Z+33
    00665 0C62      ADD	R6,R2
    00666 1C73      ADC	R7,R3
    00667 1C84      ADC	R8,R4
    00668 1C95      ADC	R9,R5
    00669 8288      ST	Y,R8
    0066A 8299      STD	Y+1,R9
    0066B 0193      MOVW	R18,R6
    0066C 018F      MOVW	R16,R30
    0066D DDE0      RCALL	ff.c:move_window
    0066E 2300      TST	R16
    0066F F009      BEQ	0x0671
    00670 C0ED      RJMP	0x075E
(0835) 		wc = fs->win[bc % SS(fs)]; bc++;
    00671 01C6      MOVW	R24,R12
    00672 968E      ADIW	R24,0x2E
    00673 01F5      MOVW	R30,R10
    00674 70F1      ANDI	R31,1
    00675 0FE8      ADD	R30,R24
    00676 1FF9      ADC	R31,R25
    00677 80E0      LD	R14,Z
    00678 24FF      CLR	R15
    00679 01C5      MOVW	R24,R10
    0067A 9601      ADIW	R24,1
    0067B 015C      MOVW	R10,R24
(0836) 		if (move_window(fs, fs->fatbase + (bc / SS(fs)))) break;
    0067C E029      LDI	R18,0x9
    0067D E030      LDI	R19,0
    0067E 018C      MOVW	R16,R24
    0067F 940E 48E2 CALL	lsr16
    00681 0118      MOVW	R2,R16
    00682 2444      CLR	R4
    00683 2455      CLR	R5
    00684 01F6      MOVW	R30,R12
    00685 8C66      LDD	R6,Z+30
    00686 8C77      LDD	R7,Z+31
    00687 A080      LDD	R8,Z+32
    00688 A091      LDD	R9,Z+33
    00689 0C62      ADD	R6,R2
    0068A 1C73      ADC	R7,R3
    0068B 1C84      ADC	R8,R4
    0068C 1C95      ADC	R9,R5
    0068D 8288      ST	Y,R8
    0068E 8299      STD	Y+1,R9
    0068F 0193      MOVW	R18,R6
    00690 018F      MOVW	R16,R30
    00691 DDBC      RCALL	ff.c:move_window
    00692 2300      TST	R16
    00693 F009      BEQ	0x0695
    00694 C0C9      RJMP	0x075E
(0837) 		wc |= fs->win[bc % SS(fs)] << 8;
    00695 01C6      MOVW	R24,R12
    00696 968E      ADIW	R24,0x2E
    00697 01F5      MOVW	R30,R10
    00698 70F1      ANDI	R31,1
    00699 0FE8      ADD	R30,R24
    0069A 1FF9      ADC	R31,R25
    0069B 8020      LD	R2,Z
    0069C 2433      CLR	R3
    0069D 2C32      MOV	R3,R2
    0069E 2422      CLR	R2
    0069F 28E2      OR	R14,R2
    006A0 28F3      OR	R15,R3
(0838) 		return (clst & 1) ? (wc >> 4) : (wc & 0xFFF);
    006A1 842C      LDD	R2,Y+12
    006A2 843D      LDD	R3,Y+13
    006A3 844E      LDD	R4,Y+14
    006A4 845F      LDD	R5,Y+15
    006A5 2DE2      MOV	R30,R2
    006A6 70E1      ANDI	R30,1
    006A7 F051      BEQ	0x06B2
    006A8 0157      MOVW	R10,R14
    006A9 94B6      LSR	R11
    006AA 94A7      ROR	R10
    006AB 94B6      LSR	R11
    006AC 94A7      ROR	R10
    006AD 94B6      LSR	R11
    006AE 94A7      ROR	R10
    006AF 94B6      LSR	R11
    006B0 94A7      ROR	R10
    006B1 C003      RJMP	0x06B5
    006B2 01C7      MOVW	R24,R14
    006B3 709F      ANDI	R25,0xF
    006B4 015C      MOVW	R10,R24
    006B5 0185      MOVW	R16,R10
    006B6 0196      MOVW	R18,R12
    006B7 2722      CLR	R18
    006B8 2733      CLR	R19
    006B9 C0A8      RJMP	0x0762
(0839) 
(0840) 	case FS_FAT16 :
(0841) 		if (move_window(fs, fs->fatbase + (clst / (SS(fs) / 2)))) break;
    006BA E088      LDI	R24,0x8
    006BB E090      LDI	R25,0
    006BC 850C      LDD	R16,Y+12
    006BD 851D      LDD	R17,Y+13
    006BE 852E      LDD	R18,Y+14
    006BF 853F      LDD	R19,Y+15
    006C0 938A      ST	-Y,R24
    006C1 940E 48E9 CALL	lsr32
    006C3 01F6      MOVW	R30,R12
    006C4 8C26      LDD	R2,Z+30
    006C5 8C37      LDD	R3,Z+31
    006C6 A040      LDD	R4,Z+32
    006C7 A051      LDD	R5,Z+33
    006C8 0E20      ADD	R2,R16
    006C9 1E31      ADC	R3,R17
    006CA 1E42      ADC	R4,R18
    006CB 1E53      ADC	R5,R19
    006CC 8248      ST	Y,R4
    006CD 8259      STD	Y+1,R5
    006CE 0191      MOVW	R18,R2
    006CF 018F      MOVW	R16,R30
    006D0 DD7D      RCALL	ff.c:move_window
    006D1 2EA0      MOV	R10,R16
    006D2 2300      TST	R16
    006D3 F009      BEQ	0x06D5
    006D4 C089      RJMP	0x075E
(0842) 		p = &fs->win[clst * 2 % SS(fs)];
    006D5 EF4F      LDI	R20,0xFF
    006D6 E051      LDI	R21,1
    006D7 E060      LDI	R22,0
    006D8 E070      LDI	R23,0
    006D9 842C      LDD	R2,Y+12
    006DA 843D      LDD	R3,Y+13
    006DB 844E      LDD	R4,Y+14
    006DC 845F      LDD	R5,Y+15
    006DD 0C22      LSL	R2
    006DE 1C33      ROL	R3
    006DF 1C44      ROL	R4
    006E0 1C55      ROL	R5
    006E1 2224      AND	R2,R20
    006E2 2235      AND	R3,R21
    006E3 2246      AND	R4,R22
    006E4 2257      AND	R5,R23
    006E5 0151      MOVW	R10,R2
    006E6 01C6      MOVW	R24,R12
    006E7 968E      ADIW	R24,0x2E
    006E8 0EA8      ADD	R10,R24
    006E9 1EB9      ADC	R11,R25
(0843) 		return LD_WORD(p);
    006EA 01F5      MOVW	R30,R10
    006EB 8020      LD	R2,Z
    006EC 2433      CLR	R3
    006ED 8101      LDD	R16,Z+1
    006EE 2711      CLR	R17
    006EF 2F10      MOV	R17,R16
    006F0 2700      CLR	R16
    006F1 2902      OR	R16,R2
    006F2 2913      OR	R17,R3
    006F3 2722      CLR	R18
    006F4 2733      CLR	R19
    006F5 C06C      RJMP	0x0762
(0844) 
(0845) 	case FS_FAT32 :
(0846) 		if (move_window(fs, fs->fatbase + (clst / (SS(fs) / 4)))) break;
    006F6 E087      LDI	R24,7
    006F7 E090      LDI	R25,0
    006F8 850C      LDD	R16,Y+12
    006F9 851D      LDD	R17,Y+13
    006FA 852E      LDD	R18,Y+14
    006FB 853F      LDD	R19,Y+15
    006FC 938A      ST	-Y,R24
    006FD 940E 48E9 CALL	lsr32
    006FF 01F6      MOVW	R30,R12
    00700 8C26      LDD	R2,Z+30
    00701 8C37      LDD	R3,Z+31
    00702 A040      LDD	R4,Z+32
    00703 A051      LDD	R5,Z+33
    00704 0E20      ADD	R2,R16
    00705 1E31      ADC	R3,R17
    00706 1E42      ADC	R4,R18
    00707 1E53      ADC	R5,R19
    00708 8248      ST	Y,R4
    00709 8259      STD	Y+1,R5
    0070A 0191      MOVW	R18,R2
    0070B 018F      MOVW	R16,R30
    0070C DD41      RCALL	ff.c:move_window
    0070D 2EE0      MOV	R14,R16
    0070E 2300      TST	R16
    0070F F009      BEQ	0x0711
    00710 C04D      RJMP	0x075E
(0847) 		p = &fs->win[clst * 4 % SS(fs)];
    00711 E082      LDI	R24,2
    00712 E090      LDI	R25,0
    00713 850C      LDD	R16,Y+12
    00714 851D      LDD	R17,Y+13
    00715 852E      LDD	R18,Y+14
    00716 853F      LDD	R19,Y+15
    00717 938A      ST	-Y,R24
    00718 940E 48D0 CALL	lsl32
    0071A 0118      MOVW	R2,R16
    0071B 0129      MOVW	R4,R18
    0071C EF4F      LDI	R20,0xFF
    0071D E051      LDI	R21,1
    0071E E060      LDI	R22,0
    0071F E070      LDI	R23,0
    00720 2224      AND	R2,R20
    00721 2235      AND	R3,R21
    00722 2246      AND	R4,R22
    00723 2257      AND	R5,R23
    00724 0151      MOVW	R10,R2
    00725 01C6      MOVW	R24,R12
    00726 968E      ADIW	R24,0x2E
    00727 0EA8      ADD	R10,R24
    00728 1EB9      ADC	R11,R25
(0848) 		return LD_DWORD(p) & 0x0FFFFFFF;
    00729 E188      LDI	R24,0x18
    0072A E090      LDI	R25,0
    0072B 01F5      MOVW	R30,R10
    0072C 8103      LDD	R16,Z+3
    0072D 2711      CLR	R17
    0072E 2722      CLR	R18
    0072F 2733      CLR	R19
    00730 938A      ST	-Y,R24
    00731 940E 48D0 CALL	lsl32
    00733 0118      MOVW	R2,R16
    00734 0129      MOVW	R4,R18
    00735 01F5      MOVW	R30,R10
    00736 8062      LDD	R6,Z+2
    00737 2477      CLR	R7
    00738 2488      CLR	R8
    00739 2499      CLR	R9
    0073A 0143      MOVW	R8,R6
    0073B 2466      CLR	R6
    0073C 2477      CLR	R7
    0073D 2826      OR	R2,R6
    0073E 2837      OR	R3,R7
    0073F 2848      OR	R4,R8
    00740 2859      OR	R5,R9
    00741 8061      LDD	R6,Z+1
    00742 2477      CLR	R7
    00743 2C76      MOV	R7,R6
    00744 2466      CLR	R6
    00745 2488      CLR	R8
    00746 2499      CLR	R9
    00747 2826      OR	R2,R6
    00748 2837      OR	R3,R7
    00749 2848      OR	R4,R8
    0074A 2859      OR	R5,R9
    0074B 8060      LD	R6,Z
    0074C 2477      CLR	R7
    0074D 2488      CLR	R8
    0074E 2499      CLR	R9
    0074F 2826      OR	R2,R6
    00750 2837      OR	R3,R7
    00751 2848      OR	R4,R8
    00752 2859      OR	R5,R9
    00753 EF4F      LDI	R20,0xFF
    00754 EF5F      LDI	R21,0xFF
    00755 EF6F      LDI	R22,0xFF
    00756 E07F      LDI	R23,0xF
    00757 2224      AND	R2,R20
    00758 2235      AND	R3,R21
    00759 2246      AND	R4,R22
    0075A 2257      AND	R5,R23
    0075B 0181      MOVW	R16,R2
    0075C 0192      MOVW	R18,R4
    0075D C004      RJMP	0x0762
(0849) 	}
(0850) 
(0851) 	return 0xFFFFFFFF;	/* An error occurred at the disk I/O layer */
    0075E EF0F      LDI	R16,0xFF
    0075F EF1F      LDI	R17,0xFF
    00760 EF2F      LDI	R18,0xFF
    00761 EF3F      LDI	R19,0xFF
    00762 9622      ADIW	R28,2
    00763 940E 483A CALL	pop_xgsetF0FC
    00765 9622      ADIW	R28,2
    00766 9508      RET
_put_fat:
  bc                   --> R12
  p                    --> R14
  res                  --> Y,+2
  val                  --> Y,+19
  clst                 --> Y,+15
  fs                   --> Y,+13
    00767 940E 4700 CALL	push_arg4
    00769 940E 4845 CALL	push_xgsetF0FC
    0076B 9723      SBIW	R28,3
(0852) }
(0853) 
(0854) 
(0855) 
(0856) 
(0857) /*-----------------------------------------------------------------------*/
(0858) /* FAT access - Change value of a FAT entry                              */
(0859) /*-----------------------------------------------------------------------*/
(0860) #if !_FS_READONLY
(0861) 
(0862) FRESULT put_fat (
(0863) 	FATFS *fs,	/* File system object */
(0864) 	DWORD clst,	/* Cluster# to be changed in range of 2 to fs->n_fatent - 1 */
(0865) 	DWORD val	/* New value to mark the cluster */
(0866) )
(0867) {
(0868) 	UINT bc;
(0869) 	BYTE *p;
(0870) 	FRESULT res;
(0871) 
(0872) 
(0873) 	if (clst < 2 || clst >= fs->n_fatent) {	/* Check range */
    0076C E042      LDI	R20,2
    0076D E050      LDI	R21,0
    0076E E060      LDI	R22,0
    0076F E070      LDI	R23,0
    00770 842F      LDD	R2,Y+15
    00771 8838      LDD	R3,Y+16
    00772 8849      LDD	R4,Y+17
    00773 885A      LDD	R5,Y+18
    00774 1624      CP	R2,R20
    00775 0635      CPC	R3,R21
    00776 0646      CPC	R4,R22
    00777 0657      CPC	R5,R23
    00778 F080      BCS	0x0789
    00779 85ED      LDD	R30,Y+13
    0077A 85FE      LDD	R31,Y+14
    0077B 9676      ADIW	R30,0x16
    0077C 8020      LD	R2,Z
    0077D 8031      LDD	R3,Z+1
    0077E 8042      LDD	R4,Z+2
    0077F 8053      LDD	R5,Z+3
    00780 846F      LDD	R6,Y+15
    00781 8878      LDD	R7,Y+16
    00782 8889      LDD	R8,Y+17
    00783 889A      LDD	R9,Y+18
    00784 1462      CP	R6,R2
    00785 0473      CPC	R7,R3
    00786 0484      CPC	R8,R4
    00787 0495      CPC	R9,R5
    00788 F018      BCS	0x078C
(0874) 		res = FR_INT_ERR;
    00789 E082      LDI	R24,2
    0078A 838A      STD	Y+2,R24
(0875) 
(0876) 	} else {
    0078B C194      RJMP	0x0920
(0877) 		switch (fs->fs_type) {
    0078C 85ED      LDD	R30,Y+13
    0078D 85FE      LDD	R31,Y+14
    0078E 80A0      LD	R10,Z
    0078F 24BB      CLR	R11
    00790 01C5      MOVW	R24,R10
    00791 3081      CPI	R24,1
    00792 E0E0      LDI	R30,0
    00793 079E      CPC	R25,R30
    00794 F059      BEQ	0x07A0
    00795 3082      CPI	R24,2
    00796 E0E0      LDI	R30,0
    00797 079E      CPC	R25,R30
    00798 F409      BNE	0x079A
    00799 C0B0      RJMP	0x084A
    0079A 3083      CPI	R24,3
    0079B E0E0      LDI	R30,0
    0079C 079E      CPC	R25,R30
    0079D F409      BNE	0x079F
    0079E C0E7      RJMP	0x0886
    0079F C17A      RJMP	0x091A
(0878) 		case FS_FAT12 :
(0879) 			bc = clst; bc += bc / 2;
    007A0 84CF      LDD	R12,Y+15
    007A1 88D8      LDD	R13,Y+16
    007A2 0116      MOVW	R2,R12
    007A3 9436      LSR	R3
    007A4 9427      ROR	R2
    007A5 0CC2      ADD	R12,R2
    007A6 1CD3      ADC	R13,R3
(0880) 			res = move_window(fs, fs->fatbase + (bc / SS(fs)));
    007A7 E029      LDI	R18,0x9
    007A8 E030      LDI	R19,0
    007A9 0186      MOVW	R16,R12
    007AA 940E 48E2 CALL	lsr16
    007AC 0118      MOVW	R2,R16
    007AD 2444      CLR	R4
    007AE 2455      CLR	R5
    007AF 85ED      LDD	R30,Y+13
    007B0 85FE      LDD	R31,Y+14
    007B1 8C66      LDD	R6,Z+30
    007B2 8C77      LDD	R7,Z+31
    007B3 A080      LDD	R8,Z+32
    007B4 A091      LDD	R9,Z+33
    007B5 0C62      ADD	R6,R2
    007B6 1C73      ADC	R7,R3
    007B7 1C84      ADC	R8,R4
    007B8 1C95      ADC	R9,R5
    007B9 8288      ST	Y,R8
    007BA 8299      STD	Y+1,R9
    007BB 0193      MOVW	R18,R6
    007BC 018F      MOVW	R16,R30
    007BD DC90      RCALL	ff.c:move_window
    007BE 830A      STD	Y+2,R16
(0881) 			if (res != FR_OK) break;
    007BF 2E00      MOV	R0,R16
    007C0 2300      TST	R16
    007C1 F009      BEQ	0x07C3
    007C2 C159      RJMP	0x091C
(0882) 			p = &fs->win[bc % SS(fs)];
    007C3 858D      LDD	R24,Y+13
    007C4 859E      LDD	R25,Y+14
    007C5 968E      ADIW	R24,0x2E
    007C6 01F6      MOVW	R30,R12
    007C7 70F1      ANDI	R31,1
    007C8 017F      MOVW	R14,R30
    007C9 0EE8      ADD	R14,R24
    007CA 1EF9      ADC	R15,R25
(0883) 			*p = (clst & 1) ? ((*p & 0x0F) | ((BYTE)val << 4)) : (BYTE)val;
    007CB 842F      LDD	R2,Y+15
    007CC 8838      LDD	R3,Y+16
    007CD 8849      LDD	R4,Y+17
    007CE 885A      LDD	R5,Y+18
    007CF 93EF      PUSH	R30
    007D0 2DE2      MOV	R30,R2
    007D1 70E1      ANDI	R30,1
    007D2 91EF      POP	R30
    007D3 F0B1      BEQ	0x07EA
    007D4 882B      LDD	R2,Y+19
    007D5 883C      LDD	R3,Y+20
    007D6 884D      LDD	R4,Y+21
    007D7 885E      LDD	R5,Y+22
    007D8 2433      CLR	R3
    007D9 0C22      LSL	R2
    007DA 1C33      ROL	R3
    007DB 0C22      LSL	R2
    007DC 1C33      ROL	R3
    007DD 0C22      LSL	R2
    007DE 1C33      ROL	R3
    007DF 0C22      LSL	R2
    007E0 1C33      ROL	R3
    007E1 01F7      MOVW	R30,R14
    007E2 8180      LD	R24,Z
    007E3 2799      CLR	R25
    007E4 708F      ANDI	R24,0xF
    007E5 7090      ANDI	R25,0
    007E6 015C      MOVW	R10,R24
    007E7 28A2      OR	R10,R2
    007E8 28B3      OR	R11,R3
    007E9 C006      RJMP	0x07F0
    007EA 882B      LDD	R2,Y+19
    007EB 883C      LDD	R3,Y+20
    007EC 884D      LDD	R4,Y+21
    007ED 885E      LDD	R5,Y+22
    007EE 2CA2      MOV	R10,R2
    007EF 24BB      CLR	R11
    007F0 01F7      MOVW	R30,R14
    007F1 82A0      ST	Z,R10
(0884) 			bc++;
    007F2 01C6      MOVW	R24,R12
    007F3 9601      ADIW	R24,1
    007F4 016C      MOVW	R12,R24
(0885) 			fs->wflag = 1;
    007F5 E081      LDI	R24,1
    007F6 85ED      LDD	R30,Y+13
    007F7 85FE      LDD	R31,Y+14
    007F8 8384      STD	Z+4,R24
(0886) 			res = move_window(fs, fs->fatbase + (bc / SS(fs)));
    007F9 E029      LDI	R18,0x9
    007FA E030      LDI	R19,0
    007FB 0186      MOVW	R16,R12
    007FC 940E 48E2 CALL	lsr16
    007FE 0118      MOVW	R2,R16
    007FF 2444      CLR	R4
    00800 2455      CLR	R5
    00801 85ED      LDD	R30,Y+13
    00802 85FE      LDD	R31,Y+14
    00803 8C66      LDD	R6,Z+30
    00804 8C77      LDD	R7,Z+31
    00805 A080      LDD	R8,Z+32
    00806 A091      LDD	R9,Z+33
    00807 0C62      ADD	R6,R2
    00808 1C73      ADC	R7,R3
    00809 1C84      ADC	R8,R4
    0080A 1C95      ADC	R9,R5
    0080B 8288      ST	Y,R8
    0080C 8299      STD	Y+1,R9
    0080D 0193      MOVW	R18,R6
    0080E 018F      MOVW	R16,R30
    0080F DC3E      RCALL	ff.c:move_window
    00810 830A      STD	Y+2,R16
(0887) 			if (res != FR_OK) break;
    00811 2E00      MOV	R0,R16
    00812 2300      TST	R16
    00813 F009      BEQ	0x0815
    00814 C107      RJMP	0x091C
(0888) 			p = &fs->win[bc % SS(fs)];
    00815 858D      LDD	R24,Y+13
    00816 859E      LDD	R25,Y+14
    00817 968E      ADIW	R24,0x2E
    00818 01F6      MOVW	R30,R12
    00819 70F1      ANDI	R31,1
    0081A 017F      MOVW	R14,R30
    0081B 0EE8      ADD	R14,R24
    0081C 1EF9      ADC	R15,R25
(0889) 			*p = (clst & 1) ? (BYTE)(val >> 4) : ((*p & 0xF0) | ((BYTE)(val >> 8) & 0x0F));
    0081D 842F      LDD	R2,Y+15
    0081E 8838      LDD	R3,Y+16
    0081F 8849      LDD	R4,Y+17
    00820 885A      LDD	R5,Y+18
    00821 93EF      PUSH	R30
    00822 2DE2      MOV	R30,R2
    00823 70E1      ANDI	R30,1
    00824 91EF      POP	R30
    00825 F061      BEQ	0x0832
    00826 E084      LDI	R24,4
    00827 E090      LDI	R25,0
    00828 890B      LDD	R16,Y+19
    00829 891C      LDD	R17,Y+20
    0082A 892D      LDD	R18,Y+21
    0082B 893E      LDD	R19,Y+22
    0082C 938A      ST	-Y,R24
    0082D 940E 48E9 CALL	lsr32
    0082F 2EC0      MOV	R12,R16
    00830 24DD      CLR	R13
    00831 C015      RJMP	0x0847
    00832 E088      LDI	R24,0x8
    00833 E090      LDI	R25,0
    00834 890B      LDD	R16,Y+19
    00835 891C      LDD	R17,Y+20
    00836 892D      LDD	R18,Y+21
    00837 893E      LDD	R19,Y+22
    00838 938A      ST	-Y,R24
    00839 940E 48E9 CALL	lsr32
    0083B 2F80      MOV	R24,R16
    0083C 2799      CLR	R25
    0083D 708F      ANDI	R24,0xF
    0083E 7090      ANDI	R25,0
    0083F 01F7      MOVW	R30,R14
    00840 81E0      LD	R30,Z
    00841 27FF      CLR	R31
    00842 7FE0      ANDI	R30,0xF0
    00843 70F0      ANDI	R31,0
    00844 016F      MOVW	R12,R30
    00845 2AC8      OR	R12,R24
    00846 2AD9      OR	R13,R25
    00847 01F7      MOVW	R30,R14
    00848 82C0      ST	Z,R12
(0890) 			break;
    00849 C0D2      RJMP	0x091C
(0891) 
(0892) 		case FS_FAT16 :
(0893) 			res = move_window(fs, fs->fatbase + (clst / (SS(fs) / 2)));
    0084A E088      LDI	R24,0x8
    0084B E090      LDI	R25,0
    0084C 850F      LDD	R16,Y+15
    0084D 8918      LDD	R17,Y+16
    0084E 8929      LDD	R18,Y+17
    0084F 893A      LDD	R19,Y+18
    00850 938A      ST	-Y,R24
    00851 940E 48E9 CALL	lsr32
    00853 85ED      LDD	R30,Y+13
    00854 85FE      LDD	R31,Y+14
    00855 8C26      LDD	R2,Z+30
    00856 8C37      LDD	R3,Z+31
    00857 A040      LDD	R4,Z+32
    00858 A051      LDD	R5,Z+33
    00859 0E20      ADD	R2,R16
    0085A 1E31      ADC	R3,R17
    0085B 1E42      ADC	R4,R18
    0085C 1E53      ADC	R5,R19
    0085D 8248      ST	Y,R4
    0085E 8259      STD	Y+1,R5
    0085F 0191      MOVW	R18,R2
    00860 018F      MOVW	R16,R30
    00861 DBEC      RCALL	ff.c:move_window
    00862 2EC0      MOV	R12,R16
    00863 82CA      STD	Y+2,R12
(0894) 			if (res != FR_OK) break;
    00864 2C0C      MOV	R0,R12
    00865 2300      TST	R16
    00866 F009      BEQ	0x0868
    00867 C0B4      RJMP	0x091C
(0895) 			p = &fs->win[clst * 2 % SS(fs)];
    00868 EF4F      LDI	R20,0xFF
    00869 E051      LDI	R21,1
    0086A E060      LDI	R22,0
    0086B E070      LDI	R23,0
    0086C 842F      LDD	R2,Y+15
    0086D 8838      LDD	R3,Y+16
    0086E 8849      LDD	R4,Y+17
    0086F 885A      LDD	R5,Y+18
    00870 0C22      LSL	R2
    00871 1C33      ROL	R3
    00872 1C44      ROL	R4
    00873 1C55      ROL	R5
    00874 2224      AND	R2,R20
    00875 2235      AND	R3,R21
    00876 2246      AND	R4,R22
    00877 2257      AND	R5,R23
    00878 0171      MOVW	R14,R2
    00879 858D      LDD	R24,Y+13
    0087A 859E      LDD	R25,Y+14
    0087B 968E      ADIW	R24,0x2E
    0087C 0EE8      ADD	R14,R24
    0087D 1EF9      ADC	R15,R25
(0896) 			ST_WORD(p, (WORD)val);
    0087E 882B      LDD	R2,Y+19
    0087F 883C      LDD	R3,Y+20
    00880 01F7      MOVW	R30,R14
    00881 8220      ST	Z,R2
    00882 2C23      MOV	R2,R3
    00883 2433      CLR	R3
    00884 8221      STD	Z+1,R2
(0897) 			break;
    00885 C096      RJMP	0x091C
(0898) 
(0899) 		case FS_FAT32 :
(0900) 			res = move_window(fs, fs->fatbase + (clst / (SS(fs) / 4)));
    00886 E087      LDI	R24,7
    00887 E090      LDI	R25,0
    00888 850F      LDD	R16,Y+15
    00889 8918      LDD	R17,Y+16
    0088A 8929      LDD	R18,Y+17
    0088B 893A      LDD	R19,Y+18
    0088C 938A      ST	-Y,R24
    0088D 940E 48E9 CALL	lsr32
    0088F 85ED      LDD	R30,Y+13
    00890 85FE      LDD	R31,Y+14
    00891 8C26      LDD	R2,Z+30
    00892 8C37      LDD	R3,Z+31
    00893 A040      LDD	R4,Z+32
    00894 A051      LDD	R5,Z+33
    00895 0E20      ADD	R2,R16
    00896 1E31      ADC	R3,R17
    00897 1E42      ADC	R4,R18
    00898 1E53      ADC	R5,R19
    00899 8248      ST	Y,R4
    0089A 8259      STD	Y+1,R5
    0089B 0191      MOVW	R18,R2
    0089C 018F      MOVW	R16,R30
    0089D DBB0      RCALL	ff.c:move_window
    0089E 2EC0      MOV	R12,R16
    0089F 82CA      STD	Y+2,R12
(0901) 			if (res != FR_OK) break;
    008A0 2C0C      MOV	R0,R12
    008A1 2300      TST	R16
    008A2 F009      BEQ	0x08A4
    008A3 C078      RJMP	0x091C
(0902) 			p = &fs->win[clst * 4 % SS(fs)];
    008A4 E082      LDI	R24,2
    008A5 E090      LDI	R25,0
    008A6 850F      LDD	R16,Y+15
    008A7 8918      LDD	R17,Y+16
    008A8 8929      LDD	R18,Y+17
    008A9 893A      LDD	R19,Y+18
    008AA 938A      ST	-Y,R24
    008AB 940E 48D0 CALL	lsl32
    008AD 0118      MOVW	R2,R16
    008AE 0129      MOVW	R4,R18
    008AF EF4F      LDI	R20,0xFF
    008B0 E051      LDI	R21,1
    008B1 E060      LDI	R22,0
    008B2 E070      LDI	R23,0
    008B3 2224      AND	R2,R20
    008B4 2235      AND	R3,R21
    008B5 2246      AND	R4,R22
    008B6 2257      AND	R5,R23
    008B7 0171      MOVW	R14,R2
    008B8 858D      LDD	R24,Y+13
    008B9 859E      LDD	R25,Y+14
    008BA 968E      ADIW	R24,0x2E
    008BB 0EE8      ADD	R14,R24
    008BC 1EF9      ADC	R15,R25
(0903) 			val |= LD_DWORD(p) & 0xF0000000;
    008BD E188      LDI	R24,0x18
    008BE E090      LDI	R25,0
    008BF 01F7      MOVW	R30,R14
    008C0 8103      LDD	R16,Z+3
    008C1 2711      CLR	R17
    008C2 2722      CLR	R18
    008C3 2733      CLR	R19
    008C4 938A      ST	-Y,R24
    008C5 940E 48D0 CALL	lsl32
    008C7 0118      MOVW	R2,R16
    008C8 0129      MOVW	R4,R18
    008C9 01F7      MOVW	R30,R14
    008CA 8062      LDD	R6,Z+2
    008CB 2477      CLR	R7
    008CC 2488      CLR	R8
    008CD 2499      CLR	R9
    008CE 0143      MOVW	R8,R6
    008CF 2466      CLR	R6
    008D0 2477      CLR	R7
    008D1 2826      OR	R2,R6
    008D2 2837      OR	R3,R7
    008D3 2848      OR	R4,R8
    008D4 2859      OR	R5,R9
    008D5 8061      LDD	R6,Z+1
    008D6 2477      CLR	R7
    008D7 2C76      MOV	R7,R6
    008D8 2466      CLR	R6
    008D9 2488      CLR	R8
    008DA 2499      CLR	R9
    008DB 2826      OR	R2,R6
    008DC 2837      OR	R3,R7
    008DD 2848      OR	R4,R8
    008DE 2859      OR	R5,R9
    008DF 8060      LD	R6,Z
    008E0 2477      CLR	R7
    008E1 2488      CLR	R8
    008E2 2499      CLR	R9
    008E3 2826      OR	R2,R6
    008E4 2837      OR	R3,R7
    008E5 2848      OR	R4,R8
    008E6 2859      OR	R5,R9
    008E7 E040      LDI	R20,0
    008E8 E050      LDI	R21,0
    008E9 E060      LDI	R22,0
    008EA EF70      LDI	R23,0xF0
    008EB 2224      AND	R2,R20
    008EC 2235      AND	R3,R21
    008ED 2246      AND	R4,R22
    008EE 2257      AND	R5,R23
    008EF 886B      LDD	R6,Y+19
    008F0 887C      LDD	R7,Y+20
    008F1 888D      LDD	R8,Y+21
    008F2 889E      LDD	R9,Y+22
    008F3 2862      OR	R6,R2
    008F4 2873      OR	R7,R3
    008F5 2884      OR	R8,R4
    008F6 2895      OR	R9,R5
    008F7 8A6B      STD	Y+19,R6
    008F8 8A7C      STD	Y+20,R7
    008F9 8A8D      STD	Y+21,R8
    008FA 8A9E      STD	Y+22,R9
(0904) 			ST_DWORD(p, val);
    008FB 882B      LDD	R2,Y+19
    008FC 883C      LDD	R3,Y+20
    008FD 884D      LDD	R4,Y+21
    008FE 885E      LDD	R5,Y+22
    008FF 8220      ST	Z,R2
    00900 2C23      MOV	R2,R3
    00901 2433      CLR	R3
    00902 9631      ADIW	R30,1
    00903 8220      ST	Z,R2
    00904 882B      LDD	R2,Y+19
    00905 883C      LDD	R3,Y+20
    00906 884D      LDD	R4,Y+21
    00907 885E      LDD	R5,Y+22
    00908 0112      MOVW	R2,R4
    00909 2444      CLR	R4
    0090A 2455      CLR	R5
    0090B 01F7      MOVW	R30,R14
    0090C 9632      ADIW	R30,2
    0090D 8220      ST	Z,R2
    0090E E188      LDI	R24,0x18
    0090F E090      LDI	R25,0
    00910 890B      LDD	R16,Y+19
    00911 891C      LDD	R17,Y+20
    00912 892D      LDD	R18,Y+21
    00913 893E      LDD	R19,Y+22
    00914 938A      ST	-Y,R24
    00915 940E 48E9 CALL	lsr32
    00917 01F7      MOVW	R30,R14
    00918 8303      STD	Z+3,R16
(0905) 			break;
    00919 C002      RJMP	0x091C
(0906) 
(0907) 		default :
(0908) 			res = FR_INT_ERR;
    0091A E082      LDI	R24,2
    0091B 838A      STD	Y+2,R24
(0909) 		}
(0910) 		fs->wflag = 1;
    0091C E081      LDI	R24,1
    0091D 85ED      LDD	R30,Y+13
    0091E 85FE      LDD	R31,Y+14
    0091F 8384      STD	Z+4,R24
(0911) 	}
(0912) 
(0913) 	return res;
    00920 810A      LDD	R16,Y+2
    00921 9623      ADIW	R28,3
    00922 940E 483A CALL	pop_xgsetF0FC
    00924 9624      ADIW	R28,4
    00925 9508      RET
ff.c:remove_chain:
  res                  --> R10
  nxt                  --> Y,+6
  clst                 --> Y,+18
  fs                   --> R12
    00926 933A      ST	-Y,R19
    00927 932A      ST	-Y,R18
    00928 940E 4880 CALL	push_xgsetF03C
    0092A 0168      MOVW	R12,R16
    0092B 972A      SBIW	R28,0xA
(0914) }
(0915) #endif /* !_FS_READONLY */
(0916) 
(0917) 
(0918) 
(0919) 
(0920) /*-----------------------------------------------------------------------*/
(0921) /* FAT handling - Remove a cluster chain                                 */
(0922) /*-----------------------------------------------------------------------*/
(0923) #if !_FS_READONLY
(0924) static
(0925) FRESULT remove_chain (
(0926) 	FATFS *fs,			/* File system object */
(0927) 	DWORD clst			/* Cluster# to remove a chain from */
(0928) )
(0929) {
(0930) 	FRESULT res;
(0931) 	DWORD nxt;
(0932) #if _USE_ERASE
(0933) 	DWORD scl = clst, ecl = clst, resion[2];
(0934) #endif
(0935) 
(0936) 	if (clst < 2 || clst >= fs->n_fatent) {	/* Check range */
    0092C E042      LDI	R20,2
    0092D E050      LDI	R21,0
    0092E E060      LDI	R22,0
    0092F E070      LDI	R23,0
    00930 882A      LDD	R2,Y+18
    00931 883B      LDD	R3,Y+19
    00932 884C      LDD	R4,Y+20
    00933 885D      LDD	R5,Y+21
    00934 1624      CP	R2,R20
    00935 0635      CPC	R3,R21
    00936 0646      CPC	R4,R22
    00937 0657      CPC	R5,R23
    00938 F078      BCS	0x0948
    00939 01F6      MOVW	R30,R12
    0093A 9676      ADIW	R30,0x16
    0093B 8020      LD	R2,Z
    0093C 8031      LDD	R3,Z+1
    0093D 8042      LDD	R4,Z+2
    0093E 8053      LDD	R5,Z+3
    0093F 886A      LDD	R6,Y+18
    00940 887B      LDD	R7,Y+19
    00941 888C      LDD	R8,Y+20
    00942 889D      LDD	R9,Y+21
    00943 1462      CP	R6,R2
    00944 0473      CPC	R7,R3
    00945 0484      CPC	R8,R4
    00946 0495      CPC	R9,R5
    00947 F018      BCS	0x094B
(0937) 		res = FR_INT_ERR;
    00948 E082      LDI	R24,2
    00949 2EA8      MOV	R10,R24
(0938) 
(0939) 	} else {
    0094A C088      RJMP	0x09D3
(0940) 		res = FR_OK;
    0094B 24AA      CLR	R10
    0094C C076      RJMP	0x09C3
(0941) 		while (clst < fs->n_fatent) {			/* Not a last link? */
(0942) 			nxt = get_fat(fs, clst);			/* Get cluster status */
    0094D 882A      LDD	R2,Y+18
    0094E 883B      LDD	R3,Y+19
    0094F 884C      LDD	R4,Y+20
    00950 885D      LDD	R5,Y+21
    00951 8248      ST	Y,R4
    00952 8259      STD	Y+1,R5
    00953 0191      MOVW	R18,R2
    00954 0186      MOVW	R16,R12
    00955 DCC1      RCALL	_get_fat
    00956 830E      STD	Y+6,R16
    00957 831F      STD	Y+7,R17
    00958 8728      STD	Y+8,R18
    00959 8739      STD	Y+9,R19
(0943) 			if (nxt == 0) break;				/* Empty cluster? */
    0095A 802E      LDD	R2,Y+6
    0095B 803F      LDD	R3,Y+7
    0095C 8448      LDD	R4,Y+8
    0095D 8459      LDD	R5,Y+9
    0095E 9488      BCLR	0
    0095F 2022      TST	R2
    00960 0432      CPC	R3,R2
    00961 0442      CPC	R4,R2
    00962 0452      CPC	R5,R2
    00963 F409      BNE	0x0965
    00964 C06E      RJMP	0x09D3
(0944) 			if (nxt == 1) { res = FR_INT_ERR; break; }	/* Internal error? */
    00965 E041      LDI	R20,1
    00966 E050      LDI	R21,0
    00967 E060      LDI	R22,0
    00968 E070      LDI	R23,0
    00969 802E      LDD	R2,Y+6
    0096A 803F      LDD	R3,Y+7
    0096B 8448      LDD	R4,Y+8
    0096C 8459      LDD	R5,Y+9
    0096D 1624      CP	R2,R20
    0096E 0635      CPC	R3,R21
    0096F 0646      CPC	R4,R22
    00970 0657      CPC	R5,R23
    00971 F419      BNE	0x0975
    00972 E082      LDI	R24,2
    00973 2EA8      MOV	R10,R24
    00974 C05E      RJMP	0x09D3
(0945) 			if (nxt == 0xFFFFFFFF) { res = FR_DISK_ERR; break; }	/* Disk error? */
    00975 EF4F      LDI	R20,0xFF
    00976 EF5F      LDI	R21,0xFF
    00977 EF6F      LDI	R22,0xFF
    00978 EF7F      LDI	R23,0xFF
    00979 802E      LDD	R2,Y+6
    0097A 803F      LDD	R3,Y+7
    0097B 8448      LDD	R4,Y+8
    0097C 8459      LDD	R5,Y+9
    0097D 1624      CP	R2,R20
    0097E 0635      CPC	R3,R21
    0097F 0646      CPC	R4,R22
    00980 0657      CPC	R5,R23
    00981 F419      BNE	0x0985
    00982 24AA      CLR	R10
    00983 94A3      INC	R10
    00984 C04E      RJMP	0x09D3
(0946) 			res = put_fat(fs, clst, 0);			/* Mark the cluster "empty" */
    00985 E080      LDI	R24,0
    00986 838A      STD	Y+2,R24
    00987 838B      STD	Y+3,R24
    00988 838C      STD	Y+4,R24
    00989 838D      STD	Y+5,R24
    0098A 882A      LDD	R2,Y+18
    0098B 883B      LDD	R3,Y+19
    0098C 884C      LDD	R4,Y+20
    0098D 885D      LDD	R5,Y+21
    0098E 8248      ST	Y,R4
    0098F 8259      STD	Y+1,R5
    00990 0191      MOVW	R18,R2
    00991 0186      MOVW	R16,R12
    00992 DDD4      RCALL	_put_fat
    00993 2EA0      MOV	R10,R16
(0947) 			if (res != FR_OK) break;
    00994 2300      TST	R16
    00995 F009      BEQ	0x0997
    00996 C03C      RJMP	0x09D3
(0948) 			if (fs->free_clust != 0xFFFFFFFF) {	/* Update FSInfo */
    00997 EF4F      LDI	R20,0xFF
    00998 EF5F      LDI	R21,0xFF
    00999 EF6F      LDI	R22,0xFF
    0099A EF7F      LDI	R23,0xFF
    0099B 01F6      MOVW	R30,R12
    0099C 8426      LDD	R2,Z+14
    0099D 8437      LDD	R3,Z+15
    0099E 8840      LDD	R4,Z+16
    0099F 8851      LDD	R5,Z+17
    009A0 1624      CP	R2,R20
    009A1 0635      CPC	R3,R21
    009A2 0646      CPC	R4,R22
    009A3 0657      CPC	R5,R23
    009A4 F0B1      BEQ	0x09BB
(0949) 				fs->free_clust++;
    009A5 01CF      MOVW	R24,R30
    009A6 960E      ADIW	R24,0xE
    009A7 E041      LDI	R20,1
    009A8 E050      LDI	R21,0
    009A9 E060      LDI	R22,0
    009AA E070      LDI	R23,0
    009AB 01FC      MOVW	R30,R24
    009AC 8020      LD	R2,Z
    009AD 8031      LDD	R3,Z+1
    009AE 8042      LDD	R4,Z+2
    009AF 8053      LDD	R5,Z+3
    009B0 0E24      ADD	R2,R20
    009B1 1E35      ADC	R3,R21
    009B2 1E46      ADC	R4,R22
    009B3 1E57      ADC	R5,R23
    009B4 8220      ST	Z,R2
    009B5 8231      STD	Z+1,R3
    009B6 8242      STD	Z+2,R4
    009B7 8253      STD	Z+3,R5
(0950) 				fs->fsi_flag = 1;
    009B8 E081      LDI	R24,1
    009B9 01F6      MOVW	R30,R12
    009BA 8385      STD	Z+5,R24
(0951) 			}
(0952) #if _USE_ERASE
(0953) 			if (ecl + 1 == nxt) {	/* Next cluster is contiguous */
(0954) 				ecl = nxt;
(0955) 			} else {				/* End of contiguous clusters */ 
(0956) 				resion[0] = clust2sect(fs, scl);					/* Start sector */
(0957) 				resion[1] = clust2sect(fs, ecl) + fs->csize - 1;	/* End sector */
(0958) 				disk_ioctl(fs->drv, CTRL_ERASE_SECTOR, resion);		/* Erase the block */
(0959) 				scl = ecl = nxt;
(0960) 			}
(0961) #endif
(0962) 			clst = nxt;	/* Next cluster */
    009BB 802E      LDD	R2,Y+6
    009BC 803F      LDD	R3,Y+7
    009BD 8448      LDD	R4,Y+8
    009BE 8459      LDD	R5,Y+9
    009BF 8A2A      STD	Y+18,R2
    009C0 8A3B      STD	Y+19,R3
    009C1 8A4C      STD	Y+20,R4
    009C2 8A5D      STD	Y+21,R5
    009C3 01F6      MOVW	R30,R12
    009C4 9676      ADIW	R30,0x16
    009C5 8020      LD	R2,Z
    009C6 8031      LDD	R3,Z+1
    009C7 8042      LDD	R4,Z+2
    009C8 8053      LDD	R5,Z+3
    009C9 886A      LDD	R6,Y+18
    009CA 887B      LDD	R7,Y+19
    009CB 888C      LDD	R8,Y+20
    009CC 889D      LDD	R9,Y+21
    009CD 1462      CP	R6,R2
    009CE 0473      CPC	R7,R3
    009CF 0484      CPC	R8,R4
    009D0 0495      CPC	R9,R5
    009D1 F408      BCC	0x09D3
    009D2 CF7A      RJMP	0x094D
(0963) 		}
(0964) 	}
(0965) 
(0966) 	return res;
    009D3 2D0A      MOV	R16,R10
    009D4 962A      ADIW	R28,0xA
    009D5 940E 4889 CALL	pop_xgsetF03C
    009D7 9622      ADIW	R28,2
    009D8 9508      RET
ff.c:create_chain:
  res                  --> R10
  scl                  --> Y,+14
  cs                   --> Y,+10
  ncl                  --> Y,+6
  clst                 --> Y,+32
  fs                   --> R12
    009D9 933A      ST	-Y,R19
    009DA 932A      ST	-Y,R18
    009DB 940E 4845 CALL	push_xgsetF0FC
    009DD 0168      MOVW	R12,R16
    009DE 9766      SBIW	R28,0x16
(0967) }
(0968) #endif
(0969) 
(0970) 
(0971) 
(0972) 
(0973) /*-----------------------------------------------------------------------*/
(0974) /* FAT handling - Stretch or Create a cluster chain                      */
(0975) /*-----------------------------------------------------------------------*/
(0976) #if !_FS_READONLY
(0977) static
(0978) DWORD create_chain (	/* 0:No free cluster, 1:Internal error, 0xFFFFFFFF:Disk error, >=2:New cluster# */
(0979) 	FATFS *fs,			/* File system object */
(0980) 	DWORD clst			/* Cluster# to stretch. 0 means create a new chain. */
(0981) )
(0982) {
(0983) 	DWORD cs, ncl, scl;
(0984) 	FRESULT res;
(0985) 
(0986) 
(0987) 	if (clst == 0) {		/* Create a new chain */
    009DF A028      LDD	R2,Y+32
    009E0 A039      LDD	R3,Y+33
    009E1 A04A      LDD	R4,Y+34
    009E2 A05B      LDD	R5,Y+35
    009E3 9488      BCLR	0
    009E4 2022      TST	R2
    009E5 0432      CPC	R3,R2
    009E6 0442      CPC	R4,R2
    009E7 0452      CPC	R5,R2
    009E8 F559      BNE	0x0A14
(0988) 		scl = fs->last_clust;			/* Get suggested start point */
    009E9 01F6      MOVW	R30,R12
    009EA 963A      ADIW	R30,0xA
    009EB 8020      LD	R2,Z
    009EC 8031      LDD	R3,Z+1
    009ED 8042      LDD	R4,Z+2
    009EE 8053      LDD	R5,Z+3
    009EF 862E      STD	Y+14,R2
    009F0 863F      STD	Y+15,R3
    009F1 8A48      STD	Y+16,R4
    009F2 8A59      STD	Y+17,R5
(0989) 		if (!scl || scl >= fs->n_fatent) scl = 1;
    009F3 842E      LDD	R2,Y+14
    009F4 843F      LDD	R3,Y+15
    009F5 8848      LDD	R4,Y+16
    009F6 8859      LDD	R5,Y+17
    009F7 9488      BCLR	0
    009F8 2022      TST	R2
    009F9 0432      CPC	R3,R2
    009FA 0442      CPC	R4,R2
    009FB 0452      CPC	R5,R2
    009FC F081      BEQ	0x0A0D
    009FD 01F6      MOVW	R30,R12
    009FE 9676      ADIW	R30,0x16
    009FF 8020      LD	R2,Z
    00A00 8031      LDD	R3,Z+1
    00A01 8042      LDD	R4,Z+2
    00A02 8053      LDD	R5,Z+3
    00A03 846E      LDD	R6,Y+14
    00A04 847F      LDD	R7,Y+15
    00A05 8888      LDD	R8,Y+16
    00A06 8899      LDD	R9,Y+17
    00A07 1462      CP	R6,R2
    00A08 0473      CPC	R7,R3
    00A09 0484      CPC	R8,R4
    00A0A 0495      CPC	R9,R5
    00A0B F408      BCC	0x0A0D
    00A0C C040      RJMP	0x0A4D
    00A0D E081      LDI	R24,1
    00A0E 878E      STD	Y+14,R24
    00A0F E080      LDI	R24,0
    00A10 878F      STD	Y+15,R24
    00A11 8B88      STD	Y+16,R24
    00A12 8B89      STD	Y+17,R24
(0990) 	}
    00A13 C039      RJMP	0x0A4D
(0991) 	else {					/* Stretch the current chain */
(0992) 		cs = get_fat(fs, clst);			/* Check the cluster status */
    00A14 A028      LDD	R2,Y+32
    00A15 A039      LDD	R3,Y+33
    00A16 A04A      LDD	R4,Y+34
    00A17 A05B      LDD	R5,Y+35
    00A18 8248      ST	Y,R4
    00A19 8259      STD	Y+1,R5
    00A1A 0191      MOVW	R18,R2
    00A1B 0186      MOVW	R16,R12
    00A1C DBFA      RCALL	_get_fat
    00A1D 870A      STD	Y+10,R16
    00A1E 871B      STD	Y+11,R17
    00A1F 872C      STD	Y+12,R18
    00A20 873D      STD	Y+13,R19
(0993) 		if (cs < 2) return 1;			/* It is an invalid cluster */
    00A21 E042      LDI	R20,2
    00A22 E050      LDI	R21,0
    00A23 E060      LDI	R22,0
    00A24 E070      LDI	R23,0
    00A25 842A      LDD	R2,Y+10
    00A26 843B      LDD	R3,Y+11
    00A27 844C      LDD	R4,Y+12
    00A28 845D      LDD	R5,Y+13
    00A29 1624      CP	R2,R20
    00A2A 0635      CPC	R3,R21
    00A2B 0646      CPC	R4,R22
    00A2C 0657      CPC	R5,R23
    00A2D F428      BCC	0x0A33
    00A2E E001      LDI	R16,1
    00A2F E010      LDI	R17,0
    00A30 E020      LDI	R18,0
    00A31 E030      LDI	R19,0
    00A32 C119      RJMP	0x0B4C
(0994) 		if (cs < fs->n_fatent) return cs;	/* It is already followed by next cluster */
    00A33 01F6      MOVW	R30,R12
    00A34 9676      ADIW	R30,0x16
    00A35 8020      LD	R2,Z
    00A36 8031      LDD	R3,Z+1
    00A37 8042      LDD	R4,Z+2
    00A38 8053      LDD	R5,Z+3
    00A39 846A      LDD	R6,Y+10
    00A3A 847B      LDD	R7,Y+11
    00A3B 848C      LDD	R8,Y+12
    00A3C 849D      LDD	R9,Y+13
    00A3D 1462      CP	R6,R2
    00A3E 0473      CPC	R7,R3
    00A3F 0484      CPC	R8,R4
    00A40 0495      CPC	R9,R5
    00A41 F418      BCC	0x0A45
    00A42 0183      MOVW	R16,R6
    00A43 0194      MOVW	R18,R8
    00A44 C107      RJMP	0x0B4C
(0995) 		scl = clst;
    00A45 A028      LDD	R2,Y+32
    00A46 A039      LDD	R3,Y+33
    00A47 A04A      LDD	R4,Y+34
    00A48 A05B      LDD	R5,Y+35
    00A49 862E      STD	Y+14,R2
    00A4A 863F      STD	Y+15,R3
    00A4B 8A48      STD	Y+16,R4
    00A4C 8A59      STD	Y+17,R5
(0996) 	}
(0997) 
(0998) 	ncl = scl;				/* Start cluster */
    00A4D 842E      LDD	R2,Y+14
    00A4E 843F      LDD	R3,Y+15
    00A4F 8848      LDD	R4,Y+16
    00A50 8859      LDD	R5,Y+17
    00A51 822E      STD	Y+6,R2
    00A52 823F      STD	Y+7,R3
    00A53 8648      STD	Y+8,R4
    00A54 8659      STD	Y+9,R5
(0999) 	for (;;) {
(1000) 		ncl++;							/* Next cluster */
    00A55 E041      LDI	R20,1
    00A56 E050      LDI	R21,0
    00A57 E060      LDI	R22,0
    00A58 E070      LDI	R23,0
    00A59 802E      LDD	R2,Y+6
    00A5A 803F      LDD	R3,Y+7
    00A5B 8448      LDD	R4,Y+8
    00A5C 8459      LDD	R5,Y+9
    00A5D 0E24      ADD	R2,R20
    00A5E 1E35      ADC	R3,R21
    00A5F 1E46      ADC	R4,R22
    00A60 1E57      ADC	R5,R23
    00A61 822E      STD	Y+6,R2
    00A62 823F      STD	Y+7,R3
    00A63 8648      STD	Y+8,R4
    00A64 8659      STD	Y+9,R5
(1001) 		if (ncl >= fs->n_fatent) {		/* Wrap around */
    00A65 01F6      MOVW	R30,R12
    00A66 9676      ADIW	R30,0x16
    00A67 8020      LD	R2,Z
    00A68 8031      LDD	R3,Z+1
    00A69 8042      LDD	R4,Z+2
    00A6A 8053      LDD	R5,Z+3
    00A6B 806E      LDD	R6,Y+6
    00A6C 807F      LDD	R7,Y+7
    00A6D 8488      LDD	R8,Y+8
    00A6E 8499      LDD	R9,Y+9
    00A6F 1462      CP	R6,R2
    00A70 0473      CPC	R7,R3
    00A71 0484      CPC	R8,R4
    00A72 0495      CPC	R9,R5
    00A73 F0C0      BCS	0x0A8C
(1002) 			ncl = 2;
    00A74 E082      LDI	R24,2
    00A75 838E      STD	Y+6,R24
    00A76 E080      LDI	R24,0
    00A77 838F      STD	Y+7,R24
    00A78 8788      STD	Y+8,R24
    00A79 8789      STD	Y+9,R24
(1003) 			if (ncl > scl) return 0;	/* No free cluster */
    00A7A 842E      LDD	R2,Y+14
    00A7B 843F      LDD	R3,Y+15
    00A7C 8848      LDD	R4,Y+16
    00A7D 8859      LDD	R5,Y+17
    00A7E 806E      LDD	R6,Y+6
    00A7F 807F      LDD	R7,Y+7
    00A80 8488      LDD	R8,Y+8
    00A81 8499      LDD	R9,Y+9
    00A82 1426      CP	R2,R6
    00A83 0437      CPC	R3,R7
    00A84 0448      CPC	R4,R8
    00A85 0459      CPC	R5,R9
    00A86 F428      BCC	0x0A8C
    00A87 E000      LDI	R16,0
    00A88 E010      LDI	R17,0
    00A89 E020      LDI	R18,0
    00A8A E030      LDI	R19,0
    00A8B C0C0      RJMP	0x0B4C
(1004) 		}
(1005) 		cs = get_fat(fs, ncl);			/* Get the cluster status */
    00A8C 802E      LDD	R2,Y+6
    00A8D 803F      LDD	R3,Y+7
    00A8E 8448      LDD	R4,Y+8
    00A8F 8459      LDD	R5,Y+9
    00A90 8248      ST	Y,R4
    00A91 8259      STD	Y+1,R5
    00A92 0191      MOVW	R18,R2
    00A93 0186      MOVW	R16,R12
    00A94 DB82      RCALL	_get_fat
    00A95 870A      STD	Y+10,R16
    00A96 871B      STD	Y+11,R17
    00A97 872C      STD	Y+12,R18
    00A98 873D      STD	Y+13,R19
(1006) 		if (cs == 0) break;				/* Found a free cluster */
    00A99 842A      LDD	R2,Y+10
    00A9A 843B      LDD	R3,Y+11
    00A9B 844C      LDD	R4,Y+12
    00A9C 845D      LDD	R5,Y+13
    00A9D 9488      BCLR	0
    00A9E 2022      TST	R2
    00A9F 0432      CPC	R3,R2
    00AA0 0442      CPC	R4,R2
    00AA1 0452      CPC	R5,R2
    00AA2 F409      BNE	0x0AA4
    00AA3 C02E      RJMP	0x0AD2
(1007) 		if (cs == 0xFFFFFFFF || cs == 1)/* An error occurred */
    00AA4 EF4F      LDI	R20,0xFF
    00AA5 EF5F      LDI	R21,0xFF
    00AA6 EF6F      LDI	R22,0xFF
    00AA7 EF7F      LDI	R23,0xFF
    00AA8 842A      LDD	R2,Y+10
    00AA9 843B      LDD	R3,Y+11
    00AAA 844C      LDD	R4,Y+12
    00AAB 845D      LDD	R5,Y+13
    00AAC 1624      CP	R2,R20
    00AAD 0635      CPC	R3,R21
    00AAE 0646      CPC	R4,R22
    00AAF 0657      CPC	R5,R23
    00AB0 F049      BEQ	0x0ABA
    00AB1 E041      LDI	R20,1
    00AB2 E050      LDI	R21,0
    00AB3 E060      LDI	R22,0
    00AB4 E070      LDI	R23,0
    00AB5 1624      CP	R2,R20
    00AB6 0635      CPC	R3,R21
    00AB7 0646      CPC	R4,R22
    00AB8 0657      CPC	R5,R23
    00AB9 F429      BNE	0x0ABF
(1008) 			return cs;
    00ABA 850A      LDD	R16,Y+10
    00ABB 851B      LDD	R17,Y+11
    00ABC 852C      LDD	R18,Y+12
    00ABD 853D      LDD	R19,Y+13
    00ABE C08D      RJMP	0x0B4C
(1009) 		if (ncl == scl) return 0;		/* No free cluster */
    00ABF 842E      LDD	R2,Y+14
    00AC0 843F      LDD	R3,Y+15
    00AC1 8848      LDD	R4,Y+16
    00AC2 8859      LDD	R5,Y+17
    00AC3 806E      LDD	R6,Y+6
    00AC4 807F      LDD	R7,Y+7
    00AC5 8488      LDD	R8,Y+8
    00AC6 8499      LDD	R9,Y+9
    00AC7 1462      CP	R6,R2
    00AC8 0473      CPC	R7,R3
    00AC9 0484      CPC	R8,R4
    00ACA 0495      CPC	R9,R5
    00ACB F009      BEQ	0x0ACD
    00ACC CF88      RJMP	0x0A55
    00ACD E000      LDI	R16,0
    00ACE E010      LDI	R17,0
    00ACF E020      LDI	R18,0
    00AD0 E030      LDI	R19,0
    00AD1 C07A      RJMP	0x0B4C
(1010) 	}
(1011) 
(1012) 	res = put_fat(fs, ncl, 0x0FFFFFFF);	/* Mark the new cluster "last link" */
    00AD2 EF8F      LDI	R24,0xFF
    00AD3 838A      STD	Y+2,R24
    00AD4 838B      STD	Y+3,R24
    00AD5 838C      STD	Y+4,R24
    00AD6 E08F      LDI	R24,0xF
    00AD7 838D      STD	Y+5,R24
    00AD8 802E      LDD	R2,Y+6
    00AD9 803F      LDD	R3,Y+7
    00ADA 8448      LDD	R4,Y+8
    00ADB 8459      LDD	R5,Y+9
    00ADC 8248      ST	Y,R4
    00ADD 8259      STD	Y+1,R5
    00ADE 0191      MOVW	R18,R2
    00ADF 0186      MOVW	R16,R12
    00AE0 DC86      RCALL	_put_fat
    00AE1 2EA0      MOV	R10,R16
(1013) 	if (res == FR_OK && clst != 0) {
    00AE2 2300      TST	R16
    00AE3 F4E1      BNE	0x0B00
    00AE4 A028      LDD	R2,Y+32
    00AE5 A039      LDD	R3,Y+33
    00AE6 A04A      LDD	R4,Y+34
    00AE7 A05B      LDD	R5,Y+35
    00AE8 9488      BCLR	0
    00AE9 2022      TST	R2
    00AEA 0432      CPC	R3,R2
    00AEB 0442      CPC	R4,R2
    00AEC 0452      CPC	R5,R2
    00AED F091      BEQ	0x0B00
(1014) 		res = put_fat(fs, clst, ncl);	/* Link it to the previous one if needed */
    00AEE 802E      LDD	R2,Y+6
    00AEF 803F      LDD	R3,Y+7
    00AF0 8448      LDD	R4,Y+8
    00AF1 8459      LDD	R5,Y+9
    00AF2 822A      STD	Y+2,R2
    00AF3 823B      STD	Y+3,R3
    00AF4 824C      STD	Y+4,R4
    00AF5 825D      STD	Y+5,R5
    00AF6 A028      LDD	R2,Y+32
    00AF7 A039      LDD	R3,Y+33
    00AF8 A04A      LDD	R4,Y+34
    00AF9 A05B      LDD	R5,Y+35
    00AFA 8248      ST	Y,R4
    00AFB 8259      STD	Y+1,R5
    00AFC 0191      MOVW	R18,R2
    00AFD 0186      MOVW	R16,R12
    00AFE DC68      RCALL	_put_fat
    00AFF 2EA0      MOV	R10,R16
(1015) 	}
(1016) 	if (res == FR_OK) {
    00B00 20AA      TST	R10
    00B01 F009      BEQ	0x0B03
    00B02 C02E      RJMP	0x0B31
(1017) 		fs->last_clust = ncl;			/* Update FSINFO */
    00B03 802E      LDD	R2,Y+6
    00B04 803F      LDD	R3,Y+7
    00B05 8448      LDD	R4,Y+8
    00B06 8459      LDD	R5,Y+9
    00B07 01F6      MOVW	R30,R12
    00B08 8622      STD	Z+10,R2
    00B09 8633      STD	Z+11,R3
    00B0A 8644      STD	Z+12,R4
    00B0B 8655      STD	Z+13,R5
(1018) 		if (fs->free_clust != 0xFFFFFFFF) {
    00B0C EF4F      LDI	R20,0xFF
    00B0D EF5F      LDI	R21,0xFF
    00B0E EF6F      LDI	R22,0xFF
    00B0F EF7F      LDI	R23,0xFF
    00B10 8426      LDD	R2,Z+14
    00B11 8437      LDD	R3,Z+15
    00B12 8840      LDD	R4,Z+16
    00B13 8851      LDD	R5,Z+17
    00B14 1624      CP	R2,R20
    00B15 0635      CPC	R3,R21
    00B16 0646      CPC	R4,R22
    00B17 0657      CPC	R5,R23
    00B18 F179      BEQ	0x0B48
(1019) 			fs->free_clust--;
    00B19 01CF      MOVW	R24,R30
    00B1A 960E      ADIW	R24,0xE
    00B1B 017C      MOVW	R14,R24
    00B1C E041      LDI	R20,1
    00B1D E050      LDI	R21,0
    00B1E E060      LDI	R22,0
    00B1F E070      LDI	R23,0
    00B20 01FC      MOVW	R30,R24
    00B21 8020      LD	R2,Z
    00B22 8031      LDD	R3,Z+1
    00B23 8042      LDD	R4,Z+2
    00B24 8053      LDD	R5,Z+3
    00B25 1A24      SUB	R2,R20
    00B26 0A35      SBC	R3,R21
    00B27 0A46      SBC	R4,R22
    00B28 0A57      SBC	R5,R23
    00B29 8220      ST	Z,R2
    00B2A 8231      STD	Z+1,R3
    00B2B 8242      STD	Z+2,R4
    00B2C 8253      STD	Z+3,R5
(1020) 			fs->fsi_flag = 1;
    00B2D E081      LDI	R24,1
    00B2E 01F6      MOVW	R30,R12
    00B2F 8385      STD	Z+5,R24
(1021) 		}
(1022) 	} else {
    00B30 C017      RJMP	0x0B48
(1023) 		ncl = (res == FR_DISK_ERR) ? 0xFFFFFFFF : 1;
    00B31 2D8A      MOV	R24,R10
    00B32 3081      CPI	R24,1
    00B33 F431      BNE	0x0B3A
    00B34 EF8F      LDI	R24,0xFF
    00B35 8B8A      STD	Y+18,R24
    00B36 8B8B      STD	Y+19,R24
    00B37 8B8C      STD	Y+20,R24
    00B38 8B8D      STD	Y+21,R24
    00B39 C006      RJMP	0x0B40
    00B3A E081      LDI	R24,1
    00B3B 8B8A      STD	Y+18,R24
    00B3C E080      LDI	R24,0
    00B3D 8B8B      STD	Y+19,R24
    00B3E 8B8C      STD	Y+20,R24
    00B3F 8B8D      STD	Y+21,R24
    00B40 882A      LDD	R2,Y+18
    00B41 883B      LDD	R3,Y+19
    00B42 884C      LDD	R4,Y+20
    00B43 885D      LDD	R5,Y+21
    00B44 822E      STD	Y+6,R2
    00B45 823F      STD	Y+7,R3
    00B46 8648      STD	Y+8,R4
    00B47 8659      STD	Y+9,R5
(1024) 	}
(1025) 
(1026) 	return ncl;		/* Return new cluster number or error code */
    00B48 810E      LDD	R16,Y+6
    00B49 811F      LDD	R17,Y+7
    00B4A 8528      LDD	R18,Y+8
    00B4B 8539      LDD	R19,Y+9
    00B4C 9666      ADIW	R28,0x16
    00B4D 940E 483A CALL	pop_xgsetF0FC
    00B4F 9622      ADIW	R28,2
    00B50 9508      RET
ff.c:clmt_clust:
  tbl                  --> R10
  cl                   --> Y,+4
  ncl                  --> Y,+0
  ofs                  --> Y,+12
  fp                   --> R12
    00B51 933A      ST	-Y,R19
    00B52 932A      ST	-Y,R18
    00B53 940E 484B CALL	push_xgset003C
    00B55 0168      MOVW	R12,R16
    00B56 9728      SBIW	R28,0x8
(1027) }
(1028) #endif /* !_FS_READONLY */
(1029) 
(1030) 
(1031) 
(1032) /*-----------------------------------------------------------------------*/
(1033) /* FAT handling - Convert offset into cluster with link map table        */
(1034) /*-----------------------------------------------------------------------*/
(1035) 
(1036) #if _USE_FASTSEEK
(1037) static
(1038) DWORD clmt_clust (	/* <2:Error, >=2:Cluster number */
(1039) 	FIL* fp,		/* Pointer to the file object */
(1040) 	DWORD ofs		/* File offset to be converted to cluster# */
(1041) )
(1042) {
(1043) 	DWORD cl, ncl, *tbl;
(1044) 
(1045) 
(1046) 	tbl = fp->cltbl + 1;	/* Top of CLMT */
    00B57 01F6      MOVW	R30,R12
    00B58 96B0      ADIW	R30,0x20
    00B59 8180      LD	R24,Z
    00B5A 8191      LDD	R25,Z+1
    00B5B 9604      ADIW	R24,4
    00B5C 015C      MOVW	R10,R24
(1047) 	cl = ofs / SS(fp->fs) / fp->fs->csize;	/* Cluster order from top of the file */
    00B5D E089      LDI	R24,0x9
    00B5E E090      LDI	R25,0
    00B5F 850C      LDD	R16,Y+12
    00B60 851D      LDD	R17,Y+13
    00B61 852E      LDD	R18,Y+14
    00B62 853F      LDD	R19,Y+15
    00B63 938A      ST	-Y,R24
    00B64 940E 48E9 CALL	lsr32
    00B66 01F6      MOVW	R30,R12
    00B67 93AF      PUSH	R26
    00B68 93BF      PUSH	R27
    00B69 81A0      LD	R26,Z
    00B6A 81B1      LDD	R27,Z+1
    00B6B 01FD      MOVW	R30,R26
    00B6C 91BF      POP	R27
    00B6D 91AF      POP	R26
    00B6E 9632      ADIW	R30,2
    00B6F 8020      LD	R2,Z
    00B70 2433      CLR	R3
    00B71 2444      CLR	R4
    00B72 2455      CLR	R5
    00B73 925A      ST	-Y,R5
    00B74 924A      ST	-Y,R4
    00B75 923A      ST	-Y,R3
    00B76 922A      ST	-Y,R2
    00B77 940E 474B CALL	div32u
    00B79 830C      STD	Y+4,R16
    00B7A 831D      STD	Y+5,R17
    00B7B 832E      STD	Y+6,R18
    00B7C 833F      STD	Y+7,R19
(1048) 	for (;;) {
(1049) 		ncl = *tbl++;			/* Number of cluters in the fragment */
    00B7D 01F5      MOVW	R30,R10
    00B7E 9021      LD	R2,Z+
    00B7F 9031      LD	R3,Z+
    00B80 9041      LD	R4,Z+
    00B81 9051      LD	R5,Z+
    00B82 015F      MOVW	R10,R30
    00B83 8228      ST	Y,R2
    00B84 8239      STD	Y+1,R3
    00B85 824A      STD	Y+2,R4
    00B86 825B      STD	Y+3,R5
(1050) 		if (!ncl) return 0;		/* End of table? (error) */
    00B87 8028      LD	R2,Y
    00B88 8039      LDD	R3,Y+1
    00B89 804A      LDD	R4,Y+2
    00B8A 805B      LDD	R5,Y+3
    00B8B 9488      BCLR	0
    00B8C 2022      TST	R2
    00B8D 0432      CPC	R3,R2
    00B8E 0442      CPC	R4,R2
    00B8F 0452      CPC	R5,R2
    00B90 F429      BNE	0x0B96
    00B91 E000      LDI	R16,0
    00B92 E010      LDI	R17,0
    00B93 E020      LDI	R18,0
    00B94 E030      LDI	R19,0
    00B95 C02F      RJMP	0x0BC5
(1051) 		if (cl < ncl) break;	/* In this fragment? */
    00B96 8028      LD	R2,Y
    00B97 8039      LDD	R3,Y+1
    00B98 804A      LDD	R4,Y+2
    00B99 805B      LDD	R5,Y+3
    00B9A 806C      LDD	R6,Y+4
    00B9B 807D      LDD	R7,Y+5
    00B9C 808E      LDD	R8,Y+6
    00B9D 809F      LDD	R9,Y+7
    00B9E 1462      CP	R6,R2
    00B9F 0473      CPC	R7,R3
    00BA0 0484      CPC	R8,R4
    00BA1 0495      CPC	R9,R5
    00BA2 F408      BCC	0x0BA4
    00BA3 C014      RJMP	0x0BB8
(1052) 		cl -= ncl; tbl++;		/* Next fragment */
    00BA4 8028      LD	R2,Y
    00BA5 8039      LDD	R3,Y+1
    00BA6 804A      LDD	R4,Y+2
    00BA7 805B      LDD	R5,Y+3
    00BA8 806C      LDD	R6,Y+4
    00BA9 807D      LDD	R7,Y+5
    00BAA 808E      LDD	R8,Y+6
    00BAB 809F      LDD	R9,Y+7
    00BAC 1862      SUB	R6,R2
    00BAD 0873      SBC	R7,R3
    00BAE 0884      SBC	R8,R4
    00BAF 0895      SBC	R9,R5
    00BB0 826C      STD	Y+4,R6
    00BB1 827D      STD	Y+5,R7
    00BB2 828E      STD	Y+6,R8
    00BB3 829F      STD	Y+7,R9
    00BB4 01C5      MOVW	R24,R10
    00BB5 9604      ADIW	R24,4
    00BB6 015C      MOVW	R10,R24
    00BB7 CFC5      RJMP	0x0B7D
(1053) 	}
(1054) 	return cl + *tbl;	/* Return the cluster number */
    00BB8 01F5      MOVW	R30,R10
    00BB9 8020      LD	R2,Z
    00BBA 8031      LDD	R3,Z+1
    00BBB 8042      LDD	R4,Z+2
    00BBC 8053      LDD	R5,Z+3
    00BBD 810C      LDD	R16,Y+4
    00BBE 811D      LDD	R17,Y+5
    00BBF 812E      LDD	R18,Y+6
    00BC0 813F      LDD	R19,Y+7
    00BC1 0D02      ADD	R16,R2
    00BC2 1D13      ADC	R17,R3
    00BC3 1D24      ADC	R18,R4
    00BC4 1D35      ADC	R19,R5
    00BC5 9628      ADIW	R28,0x8
    00BC6 940E 4825 CALL	pop_xgset003C
    00BC8 9622      ADIW	R28,2
    00BC9 9508      RET
ff.c:dir_sdi:
  ic                   --> R14
  clst                 --> Y,+2
  idx                  --> R12
  dj                   --> R10
    00BCA 940E 4845 CALL	push_xgsetF0FC
    00BCC 0169      MOVW	R12,R18
    00BCD 0158      MOVW	R10,R16
    00BCE 9726      SBIW	R28,6
(1055) }
(1056) #endif	/* _USE_FASTSEEK */
(1057) 
(1058) 
(1059) 
(1060) /*-----------------------------------------------------------------------*/
(1061) /* Directory handling - Set directory index                              */
(1062) /*-----------------------------------------------------------------------*/
(1063) 
(1064) static
(1065) FRESULT dir_sdi (
(1066) 	DIR *dj,		/* Pointer to directory object */
(1067) 	WORD idx		/* Directory index number */
(1068) )
(1069) {
(1070) 	DWORD clst;
(1071) 	WORD ic;
(1072) 
(1073) 
(1074) 	dj->index = idx;
    00BCF 01F5      MOVW	R30,R10
    00BD0 82D5      STD	Z+5,R13
    00BD1 82C4      STD	Z+4,R12
(1075) 	clst = dj->sclust;
    00BD2 9636      ADIW	R30,6
    00BD3 8020      LD	R2,Z
    00BD4 8031      LDD	R3,Z+1
    00BD5 8042      LDD	R4,Z+2
    00BD6 8053      LDD	R5,Z+3
    00BD7 822A      STD	Y+2,R2
    00BD8 823B      STD	Y+3,R3
    00BD9 824C      STD	Y+4,R4
    00BDA 825D      STD	Y+5,R5
(1076) 	if (clst == 1 || clst >= dj->fs->n_fatent)	/* Check start cluster range */
    00BDB E041      LDI	R20,1
    00BDC E050      LDI	R21,0
    00BDD E060      LDI	R22,0
    00BDE E070      LDI	R23,0
    00BDF 802A      LDD	R2,Y+2
    00BE0 803B      LDD	R3,Y+3
    00BE1 804C      LDD	R4,Y+4
    00BE2 805D      LDD	R5,Y+5
    00BE3 1624      CP	R2,R20
    00BE4 0635      CPC	R3,R21
    00BE5 0646      CPC	R4,R22
    00BE6 0657      CPC	R5,R23
    00BE7 F089      BEQ	0x0BF9
    00BE8 01F5      MOVW	R30,R10
    00BE9 81A0      LD	R26,Z
    00BEA 81B1      LDD	R27,Z+1
    00BEB 9656      ADIW	R26,0x16
    00BEC 902D      LD	R2,X+
    00BED 903D      LD	R3,X+
    00BEE 904D      LD	R4,X+
    00BEF 905C      LD	R5,X
    00BF0 806A      LDD	R6,Y+2
    00BF1 807B      LDD	R7,Y+3
    00BF2 808C      LDD	R8,Y+4
    00BF3 809D      LDD	R9,Y+5
    00BF4 1462      CP	R6,R2
    00BF5 0473      CPC	R7,R3
    00BF6 0484      CPC	R8,R4
    00BF7 0495      CPC	R9,R5
    00BF8 F010      BCS	0x0BFB
(1077) 		return FR_INT_ERR;
    00BF9 E002      LDI	R16,2
    00BFA C0D6      RJMP	0x0CD1
(1078) 	if (!clst && dj->fs->fs_type == FS_FAT32)	/* Replace cluster# 0 with root cluster# if in FAT32 */
    00BFB 802A      LDD	R2,Y+2
    00BFC 803B      LDD	R3,Y+3
    00BFD 804C      LDD	R4,Y+4
    00BFE 805D      LDD	R5,Y+5
    00BFF 9488      BCLR	0
    00C00 2022      TST	R2
    00C01 0432      CPC	R3,R2
    00C02 0442      CPC	R4,R2
    00C03 0452      CPC	R5,R2
    00C04 F479      BNE	0x0C14
    00C05 01F5      MOVW	R30,R10
    00C06 81A0      LD	R26,Z
    00C07 81B1      LDD	R27,Z+1
    00C08 918C      LD	R24,X
    00C09 3083      CPI	R24,3
    00C0A F449      BNE	0x0C14
(1079) 		clst = dj->fs->dirbase;
    00C0B 9692      ADIW	R26,0x22
    00C0C 902D      LD	R2,X+
    00C0D 903D      LD	R3,X+
    00C0E 904D      LD	R4,X+
    00C0F 905C      LD	R5,X
    00C10 822A      STD	Y+2,R2
    00C11 823B      STD	Y+3,R3
    00C12 824C      STD	Y+4,R4
    00C13 825D      STD	Y+5,R5
(1080) 
(1081) 	if (clst == 0) {	/* Static table (root-dir in FAT12/16) */
    00C14 802A      LDD	R2,Y+2
    00C15 803B      LDD	R3,Y+3
    00C16 804C      LDD	R4,Y+4
    00C17 805D      LDD	R5,Y+5
    00C18 9488      BCLR	0
    00C19 2022      TST	R2
    00C1A 0432      CPC	R3,R2
    00C1B 0442      CPC	R4,R2
    00C1C 0452      CPC	R5,R2
    00C1D F009      BEQ	0x0C1F
    00C1E C02B      RJMP	0x0C4A
(1082) 		dj->clust = clst;
    00C1F 01F5      MOVW	R30,R10
    00C20 8622      STD	Z+10,R2
    00C21 8633      STD	Z+11,R3
    00C22 8644      STD	Z+12,R4
    00C23 8655      STD	Z+13,R5
(1083) 		if (idx >= dj->fs->n_rootdir)		/* Index is out of range */
    00C24 81A0      LD	R26,Z
    00C25 81B1      LDD	R27,Z+1
    00C26 9618      ADIW	R26,0x8
    00C27 902D      LD	R2,X+
    00C28 903C      LD	R3,X
    00C29 14C2      CP	R12,R2
    00C2A 04D3      CPC	R13,R3
    00C2B F010      BCS	0x0C2E
(1084) 			return FR_INT_ERR;
    00C2C E002      LDI	R16,2
    00C2D C0A3      RJMP	0x0CD1
(1085) 		dj->sect = dj->fs->dirbase + idx / (SS(dj->fs) / SZ_DIR);	/* Sector# */
    00C2E 0116      MOVW	R2,R12
    00C2F 9436      LSR	R3
    00C30 9427      ROR	R2
    00C31 9436      LSR	R3
    00C32 9427      ROR	R2
    00C33 9436      LSR	R3
    00C34 9427      ROR	R2
    00C35 9436      LSR	R3
    00C36 9427      ROR	R2
    00C37 2444      CLR	R4
    00C38 2455      CLR	R5
    00C39 01F5      MOVW	R30,R10
    00C3A 81A0      LD	R26,Z
    00C3B 81B1      LDD	R27,Z+1
    00C3C 9692      ADIW	R26,0x22
    00C3D 906D      LD	R6,X+
    00C3E 907D      LD	R7,X+
    00C3F 908D      LD	R8,X+
    00C40 909C      LD	R9,X
    00C41 0C62      ADD	R6,R2
    00C42 1C73      ADC	R7,R3
    00C43 1C84      ADC	R8,R4
    00C44 1C95      ADC	R9,R5
    00C45 8666      STD	Z+14,R6
    00C46 8677      STD	Z+15,R7
    00C47 8A80      STD	Z+16,R8
    00C48 8A91      STD	Z+17,R9
(1086) 	}
    00C49 C076      RJMP	0x0CC0
(1087) 	else {				/* Dynamic table (sub-dirs or root-dir in FAT32) */
(1088) 		ic = SS(dj->fs) / SZ_DIR * dj->fs->csize;	/* Entries per cluster */
    00C4A 01F5      MOVW	R30,R10
    00C4B 93AF      PUSH	R26
    00C4C 93BF      PUSH	R27
    00C4D 81A0      LD	R26,Z
    00C4E 81B1      LDD	R27,Z+1
    00C4F 01FD      MOVW	R30,R26
    00C50 91BF      POP	R27
    00C51 91AF      POP	R26
    00C52 8022      LDD	R2,Z+2
    00C53 E180      LDI	R24,0x10
    00C54 9D82      MUL	R24,R2
    00C55 0170      MOVW	R14,R0
    00C56 C040      RJMP	0x0C97
(1089) 		while (idx >= ic) {	/* Follow cluster chain */
(1090) 			clst = get_fat(dj->fs, clst);				/* Get next cluster */
    00C57 802A      LDD	R2,Y+2
    00C58 803B      LDD	R3,Y+3
    00C59 804C      LDD	R4,Y+4
    00C5A 805D      LDD	R5,Y+5
    00C5B 8248      ST	Y,R4
    00C5C 8259      STD	Y+1,R5
    00C5D 0191      MOVW	R18,R2
    00C5E 01F5      MOVW	R30,R10
    00C5F 8100      LD	R16,Z
    00C60 8111      LDD	R17,Z+1
    00C61 D9B5      RCALL	_get_fat
    00C62 830A      STD	Y+2,R16
    00C63 831B      STD	Y+3,R17
    00C64 832C      STD	Y+4,R18
    00C65 833D      STD	Y+5,R19
(1091) 			if (clst == 0xFFFFFFFF) return FR_DISK_ERR;	/* Disk error */
    00C66 EF4F      LDI	R20,0xFF
    00C67 EF5F      LDI	R21,0xFF
    00C68 EF6F      LDI	R22,0xFF
    00C69 EF7F      LDI	R23,0xFF
    00C6A 802A      LDD	R2,Y+2
    00C6B 803B      LDD	R3,Y+3
    00C6C 804C      LDD	R4,Y+4
    00C6D 805D      LDD	R5,Y+5
    00C6E 1624      CP	R2,R20
    00C6F 0635      CPC	R3,R21
    00C70 0646      CPC	R4,R22
    00C71 0657      CPC	R5,R23
    00C72 F411      BNE	0x0C75
    00C73 E001      LDI	R16,1
    00C74 C05C      RJMP	0x0CD1
(1092) 			if (clst < 2 || clst >= dj->fs->n_fatent)	/* Reached to end of table or int error */
    00C75 E042      LDI	R20,2
    00C76 E050      LDI	R21,0
    00C77 E060      LDI	R22,0
    00C78 E070      LDI	R23,0
    00C79 802A      LDD	R2,Y+2
    00C7A 803B      LDD	R3,Y+3
    00C7B 804C      LDD	R4,Y+4
    00C7C 805D      LDD	R5,Y+5
    00C7D 1624      CP	R2,R20
    00C7E 0635      CPC	R3,R21
    00C7F 0646      CPC	R4,R22
    00C80 0657      CPC	R5,R23
    00C81 F088      BCS	0x0C93
    00C82 01F5      MOVW	R30,R10
    00C83 81A0      LD	R26,Z
    00C84 81B1      LDD	R27,Z+1
    00C85 9656      ADIW	R26,0x16
    00C86 902D      LD	R2,X+
    00C87 903D      LD	R3,X+
    00C88 904D      LD	R4,X+
    00C89 905C      LD	R5,X
    00C8A 806A      LDD	R6,Y+2
    00C8B 807B      LDD	R7,Y+3
    00C8C 808C      LDD	R8,Y+4
    00C8D 809D      LDD	R9,Y+5
    00C8E 1462      CP	R6,R2
    00C8F 0473      CPC	R7,R3
    00C90 0484      CPC	R8,R4
    00C91 0495      CPC	R9,R5
    00C92 F010      BCS	0x0C95
(1093) 				return FR_INT_ERR;
    00C93 E002      LDI	R16,2
    00C94 C03C      RJMP	0x0CD1
(1094) 			idx -= ic;
    00C95 18CE      SUB	R12,R14
    00C96 08DF      SBC	R13,R15
    00C97 14CE      CP	R12,R14
    00C98 04DF      CPC	R13,R15
    00C99 F008      BCS	0x0C9B
    00C9A CFBC      RJMP	0x0C57
(1095) 		}
(1096) 		dj->clust = clst;
    00C9B 802A      LDD	R2,Y+2
    00C9C 803B      LDD	R3,Y+3
    00C9D 804C      LDD	R4,Y+4
    00C9E 805D      LDD	R5,Y+5
    00C9F 01F5      MOVW	R30,R10
    00CA0 8622      STD	Z+10,R2
    00CA1 8633      STD	Z+11,R3
    00CA2 8644      STD	Z+12,R4
    00CA3 8655      STD	Z+13,R5
(1097) 		dj->sect = clust2sect(dj->fs, clst) + idx / (SS(dj->fs) / SZ_DIR);	/* Sector# */
    00CA4 8248      ST	Y,R4
    00CA5 8259      STD	Y+1,R5
    00CA6 0191      MOVW	R18,R2
    00CA7 8100      LD	R16,Z
    00CA8 8111      LDD	R17,Z+1
    00CA9 D91B      RCALL	_clust2sect
    00CAA 0116      MOVW	R2,R12
    00CAB 9436      LSR	R3
    00CAC 9427      ROR	R2
    00CAD 9436      LSR	R3
    00CAE 9427      ROR	R2
    00CAF 9436      LSR	R3
    00CB0 9427      ROR	R2
    00CB1 9436      LSR	R3
    00CB2 9427      ROR	R2
    00CB3 2444      CLR	R4
    00CB4 2455      CLR	R5
    00CB5 0138      MOVW	R6,R16
    00CB6 0149      MOVW	R8,R18
    00CB7 0C62      ADD	R6,R2
    00CB8 1C73      ADC	R7,R3
    00CB9 1C84      ADC	R8,R4
    00CBA 1C95      ADC	R9,R5
    00CBB 01F5      MOVW	R30,R10
    00CBC 8666      STD	Z+14,R6
    00CBD 8677      STD	Z+15,R7
    00CBE 8A80      STD	Z+16,R8
    00CBF 8A91      STD	Z+17,R9
(1098) 	}
(1099) 
(1100) 	dj->dir = dj->fs->win + (idx % (SS(dj->fs) / SZ_DIR)) * SZ_DIR;	/* Ptr to the entry in the sector */
    00CC0 0196      MOVW	R18,R12
    00CC1 702F      ANDI	R18,0xF
    00CC2 7030      ANDI	R19,0
    00CC3 E200      LDI	R16,0x20
    00CC4 E010      LDI	R17,0
    00CC5 940E 47E1 CALL	empy16s
    00CC7 0118      MOVW	R2,R16
    00CC8 01F5      MOVW	R30,R10
    00CC9 8180      LD	R24,Z
    00CCA 8191      LDD	R25,Z+1
    00CCB 968E      ADIW	R24,0x2E
    00CCC 0E28      ADD	R2,R24
    00CCD 1E39      ADC	R3,R25
    00CCE 8A33      STD	Z+19,R3
    00CCF 8A22      STD	Z+18,R2
(1101) 
(1102) 	return FR_OK;	/* Seek succeeded */
    00CD0 2700      CLR	R16
    00CD1 9626      ADIW	R28,6
    00CD2 940C 483A JMP	pop_xgsetF0FC
ff.c:dir_next:
  c                    --> R10
  clst                 --> Y,+2
  i                    --> R12
  stretch              --> R10
  dj                   --> Y,+16
    00CD4 940E 4700 CALL	push_arg4
    00CD6 940E 4845 CALL	push_xgsetF0FC
    00CD8 0159      MOVW	R10,R18
    00CD9 9726      SBIW	R28,6
(1103) }
(1104) 
(1105) 
(1106) 
(1107) 
(1108) /*-----------------------------------------------------------------------*/
(1109) /* Directory handling - Move directory index next                        */
(1110) /*-----------------------------------------------------------------------*/
(1111) 
(1112) static
(1113) FRESULT dir_next (	/* FR_OK:Succeeded, FR_NO_FILE:End of table, FR_DENIED:EOT and could not stretch */
(1114) 	DIR *dj,		/* Pointer to directory object */
(1115) 	int stretch		/* 0: Do not stretch table, 1: Stretch table if needed */
(1116) )
(1117) {
(1118) 	DWORD clst;
(1119) 	WORD i;
(1120) 
(1121) 
(1122) 	stretch = stretch;		/* To suppress warning on read-only cfg. */
(1123) 	i = dj->index + 1;
    00CDA 89E8      LDD	R30,Y+16
    00CDB 89F9      LDD	R31,Y+17
    00CDC 8184      LDD	R24,Z+4
    00CDD 8195      LDD	R25,Z+5
    00CDE 9601      ADIW	R24,1
    00CDF 016C      MOVW	R12,R24
(1124) 	if (!i || !dj->sect)	/* Report EOT when index has reached 65535 */
    00CE0 3080      CPI	R24,0
    00CE1 0789      CPC	R24,R25
    00CE2 F059      BEQ	0x0CEE
    00CE3 963E      ADIW	R30,0xE
    00CE4 8020      LD	R2,Z
    00CE5 8031      LDD	R3,Z+1
    00CE6 8042      LDD	R4,Z+2
    00CE7 8053      LDD	R5,Z+3
    00CE8 9488      BCLR	0
    00CE9 2022      TST	R2
    00CEA 0432      CPC	R3,R2
    00CEB 0442      CPC	R4,R2
    00CEC 0452      CPC	R5,R2
    00CED F411      BNE	0x0CF0
(1125) 		return FR_NO_FILE;
    00CEE E004      LDI	R16,4
    00CEF C18D      RJMP	0x0E7D
(1126) 
(1127) 	if (!(i % (SS(dj->fs) / SZ_DIR))) {	/* Sector changed? */
    00CF0 01C6      MOVW	R24,R12
    00CF1 708F      ANDI	R24,0xF
    00CF2 7090      ANDI	R25,0
    00CF3 3080      CPI	R24,0
    00CF4 0789      CPC	R24,R25
    00CF5 F009      BEQ	0x0CF7
    00CF6 C170      RJMP	0x0E67
(1128) 		dj->sect++;					/* Next sector */
    00CF7 8988      LDD	R24,Y+16
    00CF8 8999      LDD	R25,Y+17
    00CF9 960E      ADIW	R24,0xE
    00CFA E041      LDI	R20,1
    00CFB E050      LDI	R21,0
    00CFC E060      LDI	R22,0
    00CFD E070      LDI	R23,0
    00CFE 01FC      MOVW	R30,R24
    00CFF 8020      LD	R2,Z
    00D00 8031      LDD	R3,Z+1
    00D01 8042      LDD	R4,Z+2
    00D02 8053      LDD	R5,Z+3
    00D03 0E24      ADD	R2,R20
    00D04 1E35      ADC	R3,R21
    00D05 1E46      ADC	R4,R22
    00D06 1E57      ADC	R5,R23
    00D07 8220      ST	Z,R2
    00D08 8231      STD	Z+1,R3
    00D09 8242      STD	Z+2,R4
    00D0A 8253      STD	Z+3,R5
(1129) 
(1130) 		if (dj->clust == 0) {	/* Static table */
    00D0B 89E8      LDD	R30,Y+16
    00D0C 89F9      LDD	R31,Y+17
    00D0D 963A      ADIW	R30,0xA
    00D0E 8020      LD	R2,Z
    00D0F 8031      LDD	R3,Z+1
    00D10 8042      LDD	R4,Z+2
    00D11 8053      LDD	R5,Z+3
    00D12 9488      BCLR	0
    00D13 2022      TST	R2
    00D14 0432      CPC	R3,R2
    00D15 0442      CPC	R4,R2
    00D16 0452      CPC	R5,R2
    00D17 F469      BNE	0x0D25
(1131) 			if (i >= dj->fs->n_rootdir)	/* Report EOT when end of table */
    00D18 89E8      LDD	R30,Y+16
    00D19 89F9      LDD	R31,Y+17
    00D1A 81A0      LD	R26,Z
    00D1B 81B1      LDD	R27,Z+1
    00D1C 9618      ADIW	R26,0x8
    00D1D 902D      LD	R2,X+
    00D1E 903C      LD	R3,X
    00D1F 14C2      CP	R12,R2
    00D20 04D3      CPC	R13,R3
    00D21 F408      BCC	0x0D23
    00D22 C144      RJMP	0x0E67
(1132) 				return FR_NO_FILE;
    00D23 E004      LDI	R16,4
    00D24 C158      RJMP	0x0E7D
(1133) 		}
(1134) 		else {					/* Dynamic table */
(1135) 			if (((i / (SS(dj->fs) / SZ_DIR)) & (dj->fs->csize - 1)) == 0) {	/* Cluster changed? */
    00D25 89E8      LDD	R30,Y+16
    00D26 89F9      LDD	R31,Y+17
    00D27 93AF      PUSH	R26
    00D28 93BF      PUSH	R27
    00D29 81A0      LD	R26,Z
    00D2A 81B1      LDD	R27,Z+1
    00D2B 01FD      MOVW	R30,R26
    00D2C 91BF      POP	R27
    00D2D 91AF      POP	R26
    00D2E 8182      LDD	R24,Z+2
    00D2F 2799      CLR	R25
    00D30 9701      SBIW	R24,1
    00D31 0116      MOVW	R2,R12
    00D32 9436      LSR	R3
    00D33 9427      ROR	R2
    00D34 9436      LSR	R3
    00D35 9427      ROR	R2
    00D36 9436      LSR	R3
    00D37 9427      ROR	R2
    00D38 9436      LSR	R3
    00D39 9427      ROR	R2
    00D3A 2228      AND	R2,R24
    00D3B 2239      AND	R3,R25
    00D3C 2022      TST	R2
    00D3D F009      BEQ	0x0D3F
    00D3E C128      RJMP	0x0E67
    00D3F 2033      TST	R3
    00D40 F009      BEQ	0x0D42
    00D41 C125      RJMP	0x0E67
(1136) 				clst = get_fat(dj->fs, dj->clust);				/* Get next cluster */
    00D42 89E8      LDD	R30,Y+16
    00D43 89F9      LDD	R31,Y+17
    00D44 8422      LDD	R2,Z+10
    00D45 8433      LDD	R3,Z+11
    00D46 8444      LDD	R4,Z+12
    00D47 8455      LDD	R5,Z+13
    00D48 8248      ST	Y,R4
    00D49 8259      STD	Y+1,R5
    00D4A 0191      MOVW	R18,R2
    00D4B 8100      LD	R16,Z
    00D4C 8111      LDD	R17,Z+1
    00D4D D8C9      RCALL	_get_fat
    00D4E 830A      STD	Y+2,R16
    00D4F 831B      STD	Y+3,R17
    00D50 832C      STD	Y+4,R18
    00D51 833D      STD	Y+5,R19
(1137) 				if (clst <= 1) return FR_INT_ERR;
    00D52 E041      LDI	R20,1
    00D53 E050      LDI	R21,0
    00D54 E060      LDI	R22,0
    00D55 E070      LDI	R23,0
    00D56 802A      LDD	R2,Y+2
    00D57 803B      LDD	R3,Y+3
    00D58 804C      LDD	R4,Y+4
    00D59 805D      LDD	R5,Y+5
    00D5A 1542      CP	R20,R2
    00D5B 0553      CPC	R21,R3
    00D5C 0564      CPC	R22,R4
    00D5D 0575      CPC	R23,R5
    00D5E F010      BCS	0x0D61
    00D5F E002      LDI	R16,2
    00D60 C11C      RJMP	0x0E7D
(1138) 				if (clst == 0xFFFFFFFF) return FR_DISK_ERR;
    00D61 EF4F      LDI	R20,0xFF
    00D62 EF5F      LDI	R21,0xFF
    00D63 EF6F      LDI	R22,0xFF
    00D64 EF7F      LDI	R23,0xFF
    00D65 802A      LDD	R2,Y+2
    00D66 803B      LDD	R3,Y+3
    00D67 804C      LDD	R4,Y+4
    00D68 805D      LDD	R5,Y+5
    00D69 1624      CP	R2,R20
    00D6A 0635      CPC	R3,R21
    00D6B 0646      CPC	R4,R22
    00D6C 0657      CPC	R5,R23
    00D6D F411      BNE	0x0D70
    00D6E E001      LDI	R16,1
    00D6F C10D      RJMP	0x0E7D
(1139) 				if (clst >= dj->fs->n_fatent) {					/* When it reached end of dynamic table */
    00D70 89E8      LDD	R30,Y+16
    00D71 89F9      LDD	R31,Y+17
    00D72 81A0      LD	R26,Z
    00D73 81B1      LDD	R27,Z+1
    00D74 9656      ADIW	R26,0x16
    00D75 902D      LD	R2,X+
    00D76 903D      LD	R3,X+
    00D77 904D      LD	R4,X+
    00D78 905C      LD	R5,X
    00D79 806A      LDD	R6,Y+2
    00D7A 807B      LDD	R7,Y+3
    00D7B 808C      LDD	R8,Y+4
    00D7C 809D      LDD	R9,Y+5
    00D7D 1462      CP	R6,R2
    00D7E 0473      CPC	R7,R3
    00D7F 0484      CPC	R8,R4
    00D80 0495      CPC	R9,R5
    00D81 F408      BCC	0x0D83
    00D82 C0CD      RJMP	0x0E50
(1140) #if !_FS_READONLY
(1141) 					BYTE c;
(1142) 					if (!stretch) return FR_NO_FILE;			/* When do not stretch, report EOT */
    00D83 20AA      TST	R10
    00D84 F421      BNE	0x0D89
    00D85 20BB      TST	R11
    00D86 F411      BNE	0x0D89
    00D87 E004      LDI	R16,4
    00D88 C0F4      RJMP	0x0E7D
(1143) 					clst = create_chain(dj->fs, dj->clust);		/* Stretch cluster chain */
    00D89 89E8      LDD	R30,Y+16
    00D8A 89F9      LDD	R31,Y+17
    00D8B 8422      LDD	R2,Z+10
    00D8C 8433      LDD	R3,Z+11
    00D8D 8444      LDD	R4,Z+12
    00D8E 8455      LDD	R5,Z+13
    00D8F 8248      ST	Y,R4
    00D90 8259      STD	Y+1,R5
    00D91 0191      MOVW	R18,R2
    00D92 8100      LD	R16,Z
    00D93 8111      LDD	R17,Z+1
    00D94 DC44      RCALL	ff.c:create_chain
    00D95 830A      STD	Y+2,R16
    00D96 831B      STD	Y+3,R17
    00D97 832C      STD	Y+4,R18
    00D98 833D      STD	Y+5,R19
(1144) 					if (clst == 0) return FR_DENIED;			/* No free cluster */
    00D99 802A      LDD	R2,Y+2
    00D9A 803B      LDD	R3,Y+3
    00D9B 804C      LDD	R4,Y+4
    00D9C 805D      LDD	R5,Y+5
    00D9D 9488      BCLR	0
    00D9E 2022      TST	R2
    00D9F 0432      CPC	R3,R2
    00DA0 0442      CPC	R4,R2
    00DA1 0452      CPC	R5,R2
    00DA2 F411      BNE	0x0DA5
    00DA3 E007      LDI	R16,7
    00DA4 C0D8      RJMP	0x0E7D
(1145) 					if (clst == 1) return FR_INT_ERR;
    00DA5 E041      LDI	R20,1
    00DA6 E050      LDI	R21,0
    00DA7 E060      LDI	R22,0
    00DA8 E070      LDI	R23,0
    00DA9 802A      LDD	R2,Y+2
    00DAA 803B      LDD	R3,Y+3
    00DAB 804C      LDD	R4,Y+4
    00DAC 805D      LDD	R5,Y+5
    00DAD 1624      CP	R2,R20
    00DAE 0635      CPC	R3,R21
    00DAF 0646      CPC	R4,R22
    00DB0 0657      CPC	R5,R23
    00DB1 F411      BNE	0x0DB4
    00DB2 E002      LDI	R16,2
    00DB3 C0C9      RJMP	0x0E7D
(1146) 					if (clst == 0xFFFFFFFF) return FR_DISK_ERR;
    00DB4 EF4F      LDI	R20,0xFF
    00DB5 EF5F      LDI	R21,0xFF
    00DB6 EF6F      LDI	R22,0xFF
    00DB7 EF7F      LDI	R23,0xFF
    00DB8 802A      LDD	R2,Y+2
    00DB9 803B      LDD	R3,Y+3
    00DBA 804C      LDD	R4,Y+4
    00DBB 805D      LDD	R5,Y+5
    00DBC 1624      CP	R2,R20
    00DBD 0635      CPC	R3,R21
    00DBE 0646      CPC	R4,R22
    00DBF 0657      CPC	R5,R23
    00DC0 F411      BNE	0x0DC3
    00DC1 E001      LDI	R16,1
    00DC2 C0BA      RJMP	0x0E7D
(1147) 					/* Clean-up stretched table */
(1148) 					if (move_window(dj->fs, 0)) return FR_DISK_ERR;	/* Flush active window */
    00DC3 E040      LDI	R20,0
    00DC4 E050      LDI	R21,0
    00DC5 E060      LDI	R22,0
    00DC6 E070      LDI	R23,0
    00DC7 8368      ST	Y,R22
    00DC8 8379      STD	Y+1,R23
    00DC9 019A      MOVW	R18,R20
    00DCA 89E8      LDD	R30,Y+16
    00DCB 89F9      LDD	R31,Y+17
    00DCC 8100      LD	R16,Z
    00DCD 8111      LDD	R17,Z+1
    00DCE 940E 044E CALL	ff.c:move_window
    00DD0 2300      TST	R16
    00DD1 F011      BEQ	0x0DD4
    00DD2 E001      LDI	R16,1
    00DD3 C0A9      RJMP	0x0E7D
(1149) 					mem_set(dj->fs->win, 0, SS(dj->fs));			/* Clear window buffer */
    00DD4 E080      LDI	R24,0
    00DD5 E092      LDI	R25,2
    00DD6 8399      STD	Y+1,R25
    00DD7 8388      ST	Y,R24
    00DD8 2722      CLR	R18
    00DD9 2733      CLR	R19
    00DDA 89E8      LDD	R30,Y+16
    00DDB 89F9      LDD	R31,Y+17
    00DDC 8100      LD	R16,Z
    00DDD 8111      LDD	R17,Z+1
    00DDE 5D02      SUBI	R16,0xD2
    00DDF 4F1F      SBCI	R17,0xFF
    00DE0 940E 040B CALL	ff.c:mem_set
(1150) 					dj->fs->winsect = clust2sect(dj->fs, clst);	/* Cluster start sector */
    00DE2 802A      LDD	R2,Y+2
    00DE3 803B      LDD	R3,Y+3
    00DE4 804C      LDD	R4,Y+4
    00DE5 805D      LDD	R5,Y+5
    00DE6 8248      ST	Y,R4
    00DE7 8259      STD	Y+1,R5
    00DE8 0191      MOVW	R18,R2
    00DE9 89E8      LDD	R30,Y+16
    00DEA 89F9      LDD	R31,Y+17
    00DEB 80A0      LD	R10,Z
    00DEC 80B1      LDD	R11,Z+1
    00DED 0185      MOVW	R16,R10
    00DEE 940E 05C5 CALL	_clust2sect
    00DF0 01F5      MOVW	R30,R10
    00DF1 A702      STD	Z+42,R16
    00DF2 A713      STD	Z+43,R17
    00DF3 A724      STD	Z+44,R18
    00DF4 A735      STD	Z+45,R19
(1151) 					for (c = 0; c < dj->fs->csize; c++) {		/* Fill the new cluster with 0 */
    00DF5 24AA      CLR	R10
    00DF6 C035      RJMP	0x0E2C
(1152) 						dj->fs->wflag = 1;
    00DF7 E081      LDI	R24,1
    00DF8 89E8      LDD	R30,Y+16
    00DF9 89F9      LDD	R31,Y+17
    00DFA 93AF      PUSH	R26
    00DFB 93BF      PUSH	R27
    00DFC 81A0      LD	R26,Z
    00DFD 81B1      LDD	R27,Z+1
    00DFE 01FD      MOVW	R30,R26
    00DFF 91BF      POP	R27
    00E00 91AF      POP	R26
    00E01 8384      STD	Z+4,R24
(1153) 						if (move_window(dj->fs, 0)) return FR_DISK_ERR;
    00E02 E040      LDI	R20,0
    00E03 E050      LDI	R21,0
    00E04 E060      LDI	R22,0
    00E05 E070      LDI	R23,0
    00E06 8368      ST	Y,R22
    00E07 8379      STD	Y+1,R23
    00E08 019A      MOVW	R18,R20
    00E09 89E8      LDD	R30,Y+16
    00E0A 89F9      LDD	R31,Y+17
    00E0B 8100      LD	R16,Z
    00E0C 8111      LDD	R17,Z+1
    00E0D 940E 044E CALL	ff.c:move_window
    00E0F 2EE0      MOV	R14,R16
    00E10 2300      TST	R16
    00E11 F011      BEQ	0x0E14
    00E12 E001      LDI	R16,1
    00E13 C069      RJMP	0x0E7D
(1154) 						dj->fs->winsect++;
    00E14 89E8      LDD	R30,Y+16
    00E15 89F9      LDD	R31,Y+17
    00E16 8180      LD	R24,Z
    00E17 8191      LDD	R25,Z+1
    00E18 968A      ADIW	R24,0x2A
    00E19 017C      MOVW	R14,R24
    00E1A E041      LDI	R20,1
    00E1B E050      LDI	R21,0
    00E1C E060      LDI	R22,0
    00E1D E070      LDI	R23,0
    00E1E 01FC      MOVW	R30,R24
    00E1F 8020      LD	R2,Z
    00E20 8031      LDD	R3,Z+1
    00E21 8042      LDD	R4,Z+2
    00E22 8053      LDD	R5,Z+3
    00E23 0E24      ADD	R2,R20
    00E24 1E35      ADC	R3,R21
    00E25 1E46      ADC	R4,R22
    00E26 1E57      ADC	R5,R23
    00E27 8220      ST	Z,R2
    00E28 8231      STD	Z+1,R3
    00E29 8242      STD	Z+2,R4
    00E2A 8253      STD	Z+3,R5
    00E2B 94A3      INC	R10
    00E2C 89E8      LDD	R30,Y+16
    00E2D 89F9      LDD	R31,Y+17
    00E2E 93AF      PUSH	R26
    00E2F 93BF      PUSH	R27
    00E30 81A0      LD	R26,Z
    00E31 81B1      LDD	R27,Z+1
    00E32 01FD      MOVW	R30,R26
    00E33 91BF      POP	R27
    00E34 91AF      POP	R26
    00E35 8022      LDD	R2,Z+2
    00E36 14A2      CP	R10,R2
    00E37 F408      BCC	0x0E39
    00E38 CFBE      RJMP	0x0DF7
(1155) 					}
(1156) 					dj->fs->winsect -= c;						/* Rewind window address */
    00E39 89E8      LDD	R30,Y+16
    00E3A 89F9      LDD	R31,Y+17
    00E3B 8180      LD	R24,Z
    00E3C 8191      LDD	R25,Z+1
    00E3D 968A      ADIW	R24,0x2A
    00E3E 017C      MOVW	R14,R24
    00E3F 2C2A      MOV	R2,R10
    00E40 2433      CLR	R3
    00E41 2444      CLR	R4
    00E42 2455      CLR	R5
    00E43 01FC      MOVW	R30,R24
    00E44 8060      LD	R6,Z
    00E45 8071      LDD	R7,Z+1
    00E46 8082      LDD	R8,Z+2
    00E47 8093      LDD	R9,Z+3
    00E48 1862      SUB	R6,R2
    00E49 0873      SBC	R7,R3
    00E4A 0884      SBC	R8,R4
    00E4B 0895      SBC	R9,R5
    00E4C 8260      ST	Z,R6
    00E4D 8271      STD	Z+1,R7
    00E4E 8282      STD	Z+2,R8
    00E4F 8293      STD	Z+3,R9
(1157) #else
(1158) 					return FR_NO_FILE;			/* Report EOT */
(1159) #endif
(1160) 				}
(1161) 				dj->clust = clst;				/* Initialize data for new cluster */
    00E50 802A      LDD	R2,Y+2
    00E51 803B      LDD	R3,Y+3
    00E52 804C      LDD	R4,Y+4
    00E53 805D      LDD	R5,Y+5
    00E54 89E8      LDD	R30,Y+16
    00E55 89F9      LDD	R31,Y+17
    00E56 8622      STD	Z+10,R2
    00E57 8633      STD	Z+11,R3
    00E58 8644      STD	Z+12,R4
    00E59 8655      STD	Z+13,R5
(1162) 				dj->sect = clust2sect(dj->fs, clst);
    00E5A 8248      ST	Y,R4
    00E5B 8259      STD	Y+1,R5
    00E5C 0191      MOVW	R18,R2
    00E5D 8100      LD	R16,Z
    00E5E 8111      LDD	R17,Z+1
    00E5F 940E 05C5 CALL	_clust2sect
    00E61 89E8      LDD	R30,Y+16
    00E62 89F9      LDD	R31,Y+17
    00E63 8706      STD	Z+14,R16
    00E64 8717      STD	Z+15,R17
    00E65 8B20      STD	Z+16,R18
    00E66 8B31      STD	Z+17,R19
(1163) 			}
(1164) 		}
(1165) 	}
(1166) 
(1167) 	dj->index = i;
    00E67 89E8      LDD	R30,Y+16
    00E68 89F9      LDD	R31,Y+17
    00E69 82D5      STD	Z+5,R13
    00E6A 82C4      STD	Z+4,R12
(1168) 	dj->dir = dj->fs->win + (i % (SS(dj->fs) / SZ_DIR)) * SZ_DIR;
    00E6B 0196      MOVW	R18,R12
    00E6C 702F      ANDI	R18,0xF
    00E6D 7030      ANDI	R19,0
    00E6E E200      LDI	R16,0x20
    00E6F E010      LDI	R17,0
    00E70 940E 47E1 CALL	empy16s
    00E72 0118      MOVW	R2,R16
    00E73 89E8      LDD	R30,Y+16
    00E74 89F9      LDD	R31,Y+17
    00E75 8180      LD	R24,Z
    00E76 8191      LDD	R25,Z+1
    00E77 968E      ADIW	R24,0x2E
    00E78 0E28      ADD	R2,R24
    00E79 1E39      ADC	R3,R25
    00E7A 8A33      STD	Z+19,R3
    00E7B 8A22      STD	Z+18,R2
(1169) 
(1170) 	return FR_OK;
    00E7C 2700      CLR	R16
    00E7D 9626      ADIW	R28,6
    00E7E 940E 483A CALL	pop_xgsetF0FC
    00E80 9624      ADIW	R28,4
    00E81 9508      RET
ff.c:dir_find:
  c                    --> R12
  dir                  --> R10
  res                  --> R20
  dj                   --> R22
    00E82 940E 4880 CALL	push_xgsetF03C
    00E84 01B8      MOVW	R22,R16
    00E85 9722      SBIW	R28,2
(1171) }
(1172) 
(1173) 
(1174) 
(1175) 
(1176) /*-----------------------------------------------------------------------*/
(1177) /* LFN handling - Test/Pick/Fit an LFN segment from/to directory entry   */
(1178) /*-----------------------------------------------------------------------*/
(1179) #if _USE_LFN
(1180) static
(1181) const BYTE LfnOfs[] = {1,3,5,7,9,14,16,18,20,22,24,28,30};	/* Offset of LFN chars in the directory entry */
(1182) 
(1183) 
(1184) static
(1185) int cmp_lfn (			/* 1:Matched, 0:Not matched */
(1186) 	WCHAR *lfnbuf,		/* Pointer to the LFN to be compared */
(1187) 	BYTE *dir			/* Pointer to the directory entry containing a part of LFN */
(1188) )
(1189) {
(1190) 	UINT i, s;
(1191) 	WCHAR wc, uc;
(1192) 
(1193) 
(1194) 	i = ((dir[LDIR_Ord] & ~LLE) - 1) * 13;	/* Get offset in the LFN buffer */
(1195) 	s = 0; wc = 1;
(1196) 	do {
(1197) 		uc = LD_WORD(dir+LfnOfs[s]);	/* Pick an LFN character from the entry */
(1198) 		if (wc) {	/* Last char has not been processed */
(1199) 			wc = ff_wtoupper(uc);		/* Convert it to upper case */
(1200) 			if (i >= _MAX_LFN || wc != ff_wtoupper(lfnbuf[i++]))	/* Compare it */
(1201) 				return 0;				/* Not matched */
(1202) 		} else {
(1203) 			if (uc != 0xFFFF) return 0;	/* Check filler */
(1204) 		}
(1205) 	} while (++s < 13);				/* Repeat until all chars in the entry are checked */
(1206) 
(1207) 	if ((dir[LDIR_Ord] & LLE) && wc && lfnbuf[i])	/* Last segment matched but different length */
(1208) 		return 0;
(1209) 
(1210) 	return 1;						/* The part of LFN matched */
(1211) }
(1212) 
(1213) 
(1214) 
(1215) static
(1216) int pick_lfn (			/* 1:Succeeded, 0:Buffer overflow */
(1217) 	WCHAR *lfnbuf,		/* Pointer to the Unicode-LFN buffer */
(1218) 	BYTE *dir			/* Pointer to the directory entry */
(1219) )
(1220) {
(1221) 	UINT i, s;
(1222) 	WCHAR wc, uc;
(1223) 
(1224) 
(1225) 	i = ((dir[LDIR_Ord] & 0x3F) - 1) * 13;	/* Offset in the LFN buffer */
(1226) 
(1227) 	s = 0; wc = 1;
(1228) 	do {
(1229) 		uc = LD_WORD(dir+LfnOfs[s]);		/* Pick an LFN character from the entry */
(1230) 		if (wc) {	/* Last char has not been processed */
(1231) 			if (i >= _MAX_LFN) return 0;	/* Buffer overflow? */
(1232) 			lfnbuf[i++] = wc = uc;			/* Store it */
(1233) 		} else {
(1234) 			if (uc != 0xFFFF) return 0;		/* Check filler */
(1235) 		}
(1236) 	} while (++s < 13);						/* Read all character in the entry */
(1237) 
(1238) 	if (dir[LDIR_Ord] & LLE) {				/* Put terminator if it is the last LFN part */
(1239) 		if (i >= _MAX_LFN) return 0;		/* Buffer overflow? */
(1240) 		lfnbuf[i] = 0;
(1241) 	}
(1242) 
(1243) 	return 1;
(1244) }
(1245) 
(1246) 
(1247) #if !_FS_READONLY
(1248) static
(1249) void fit_lfn (
(1250) 	const WCHAR *lfnbuf,	/* Pointer to the LFN buffer */
(1251) 	BYTE *dir,				/* Pointer to the directory entry */
(1252) 	BYTE ord,				/* LFN order (1-20) */
(1253) 	BYTE sum				/* SFN sum */
(1254) )
(1255) {
(1256) 	UINT i, s;
(1257) 	WCHAR wc;
(1258) 
(1259) 
(1260) 	dir[LDIR_Chksum] = sum;			/* Set check sum */
(1261) 	dir[LDIR_Attr] = AM_LFN;		/* Set attribute. LFN entry */
(1262) 	dir[LDIR_Type] = 0;
(1263) 	ST_WORD(dir+LDIR_FstClusLO, 0);
(1264) 
(1265) 	i = (ord - 1) * 13;				/* Get offset in the LFN buffer */
(1266) 	s = wc = 0;
(1267) 	do {
(1268) 		if (wc != 0xFFFF) wc = lfnbuf[i++];	/* Get an effective char */
(1269) 		ST_WORD(dir+LfnOfs[s], wc);	/* Put it */
(1270) 		if (!wc) wc = 0xFFFF;		/* Padding chars following last char */
(1271) 	} while (++s < 13);
(1272) 	if (wc == 0xFFFF || !lfnbuf[i]) ord |= LLE;	/* Bottom LFN part is the start of LFN sequence */
(1273) 	dir[LDIR_Ord] = ord;			/* Set the LFN order */
(1274) }
(1275) 
(1276) #endif
(1277) #endif
(1278) 
(1279) 
(1280) 
(1281) /*-----------------------------------------------------------------------*/
(1282) /* Create numbered name                                                  */
(1283) /*-----------------------------------------------------------------------*/
(1284) #if _USE_LFN
(1285) void gen_numname (
(1286) 	BYTE *dst,			/* Pointer to generated SFN */
(1287) 	const BYTE *src,	/* Pointer to source SFN to be modified */
(1288) 	const WCHAR *lfn,	/* Pointer to LFN */
(1289) 	WORD seq			/* Sequence number */
(1290) )
(1291) {
(1292) 	BYTE ns[8], c;
(1293) 	UINT i, j;
(1294) 
(1295) 
(1296) 	mem_cpy(dst, src, 11);
(1297) 
(1298) 	if (seq > 5) {	/* On many collisions, generate a hash number instead of sequential number */
(1299) 		do seq = (seq >> 1) + (seq << 15) + (WORD)*lfn++; while (*lfn);
(1300) 	}
(1301) 
(1302) 	/* itoa (hexdecimal) */
(1303) 	i = 7;
(1304) 	do {
(1305) 		c = (seq % 16) + '0';
(1306) 		if (c > '9') c += 7;
(1307) 		ns[i--] = c;
(1308) 		seq /= 16;
(1309) 	} while (seq);
(1310) 	ns[i] = '~';
(1311) 
(1312) 	/* Append the number */
(1313) 	for (j = 0; j < i && dst[j] != ' '; j++) {
(1314) 		if (IsDBCS1(dst[j])) {
(1315) 			if (j == i - 1) break;
(1316) 			j++;
(1317) 		}
(1318) 	}
(1319) 	do {
(1320) 		dst[j++] = (i < 8) ? ns[i++] : ' ';
(1321) 	} while (j < 8);
(1322) }
(1323) #endif
(1324) 
(1325) 
(1326) 
(1327) 
(1328) /*-----------------------------------------------------------------------*/
(1329) /* Calculate sum of an SFN                                               */
(1330) /*-----------------------------------------------------------------------*/
(1331) #if _USE_LFN
(1332) static
(1333) BYTE sum_sfn (
(1334) 	const BYTE *dir		/* Ptr to directory entry */
(1335) )
(1336) {
(1337) 	BYTE sum = 0;
(1338) 	UINT n = 11;
(1339) 
(1340) 	do sum = (sum >> 1) + (sum << 7) + *dir++; while (--n);
(1341) 	return sum;
(1342) }
(1343) #endif
(1344) 
(1345) 
(1346) 
(1347) 
(1348) /*-----------------------------------------------------------------------*/
(1349) /* Directory handling - Find an object in the directory                  */
(1350) /*-----------------------------------------------------------------------*/
(1351) 
(1352) static
(1353) FRESULT dir_find (
(1354) 	DIR *dj			/* Pointer to the directory object linked to the file name */
(1355) )
(1356) {
(1357) 	FRESULT res;
(1358) 	BYTE c, *dir;
(1359) #if _USE_LFN
(1360) 	BYTE a, ord, sum;
(1361) #endif
(1362) 
(1363) 	res = dir_sdi(dj, 0);			/* Rewind directory object */
    00E86 2722      CLR	R18
    00E87 2733      CLR	R19
    00E88 018B      MOVW	R16,R22
    00E89 DD40      RCALL	ff.c:dir_sdi
    00E8A 2F40      MOV	R20,R16
(1364) 	if (res != FR_OK) return res;
    00E8B 2300      TST	R16
    00E8C F009      BEQ	0x0E8E
    00E8D C036      RJMP	0x0EC4
(1365) 
(1366) #if _USE_LFN
(1367) 	ord = sum = 0xFF;
(1368) #endif
(1369) 	do {
(1370) 		res = move_window(dj->fs, dj->sect);
    00E8E 01FB      MOVW	R30,R22
    00E8F 8426      LDD	R2,Z+14
    00E90 8437      LDD	R3,Z+15
    00E91 8840      LDD	R4,Z+16
    00E92 8851      LDD	R5,Z+17
    00E93 8248      ST	Y,R4
    00E94 8259      STD	Y+1,R5
    00E95 0191      MOVW	R18,R2
    00E96 8100      LD	R16,Z
    00E97 8111      LDD	R17,Z+1
    00E98 940E 044E CALL	ff.c:move_window
    00E9A 2F40      MOV	R20,R16
(1371) 		if (res != FR_OK) break;
    00E9B 2300      TST	R16
    00E9C F009      BEQ	0x0E9E
    00E9D C025      RJMP	0x0EC3
(1372) 		dir = dj->dir;					/* Ptr to the directory entry of current index */
    00E9E 01FB      MOVW	R30,R22
    00E9F 88A2      LDD	R10,Z+18
    00EA0 88B3      LDD	R11,Z+19
(1373) 		c = dir[DIR_Name];
    00EA1 01F5      MOVW	R30,R10
    00EA2 80C0      LD	R12,Z
(1374) 		if (c == 0) { res = FR_NO_FILE; break; }	/* Reached to end of table */
    00EA3 20CC      TST	R12
    00EA4 F411      BNE	0x0EA7
    00EA5 E044      LDI	R20,4
    00EA6 C01C      RJMP	0x0EC3
(1375) #if _USE_LFN	/* LFN configuration */
(1376) 		a = dir[DIR_Attr] & AM_MASK;
(1377) 		if (c == DDE || ((a & AM_VOL) && a != AM_LFN)) {	/* An entry without valid data */
(1378) 			ord = 0xFF;
(1379) 		} else {
(1380) 			if (a == AM_LFN) {			/* An LFN entry is found */
(1381) 				if (dj->lfn) {
(1382) 					if (c & LLE) {		/* Is it start of LFN sequence? */
(1383) 						sum = dir[LDIR_Chksum];
(1384) 						c &= ~LLE; ord = c;	/* LFN start order */
(1385) 						dj->lfn_idx = dj->index;
(1386) 					}
(1387) 					/* Check validity of the LFN entry and compare it with given name */
(1388) 					ord = (c == ord && sum == dir[LDIR_Chksum] && cmp_lfn(dj->lfn, dir)) ? ord - 1 : 0xFF;
(1389) 				}
(1390) 			} else {					/* An SFN entry is found */
(1391) 				if (!ord && sum == sum_sfn(dir)) break;	/* LFN matched? */
(1392) 				ord = 0xFF; dj->lfn_idx = 0xFFFF;	/* Reset LFN sequence */
(1393) 				if (!(dj->fn[NS] & NS_LOSS) && !mem_cmp(dir, dj->fn, 11)) break;	/* SFN matched? */
(1394) 			}
(1395) 		}
(1396) #else		/* Non LFN configuration */
(1397) 		if (!(dir[DIR_Attr] & AM_VOL) && !mem_cmp(dir, dj->fn, 11)) /* Is it a valid entry? */
    00EA7 01F5      MOVW	R30,R10
    00EA8 8423      LDD	R2,Z+11
    00EA9 FC23      SBRC	R2,3
    00EAA C00F      RJMP	0x0EBA
    00EAB E08B      LDI	R24,0xB
    00EAC E090      LDI	R25,0
    00EAD 8399      STD	Y+1,R25
    00EAE 8388      ST	Y,R24
    00EAF 01FB      MOVW	R30,R22
    00EB0 8924      LDD	R18,Z+20
    00EB1 8935      LDD	R19,Z+21
    00EB2 0185      MOVW	R16,R10
    00EB3 940E 041D CALL	ff.c:mem_cmp
    00EB5 0158      MOVW	R10,R16
    00EB6 3000      CPI	R16,0
    00EB7 0701      CPC	R16,R17
    00EB8 F409      BNE	0x0EBA
(1398) 			break;
    00EB9 C009      RJMP	0x0EC3
(1399) #endif
(1400) 		res = dir_next(dj, 0);		/* Next entry */
    00EBA 2722      CLR	R18
    00EBB 2733      CLR	R19
    00EBC 018B      MOVW	R16,R22
    00EBD DE16      RCALL	ff.c:dir_next
    00EBE 2EA0      MOV	R10,R16
    00EBF 2D4A      MOV	R20,R10
(1401) 	} while (res == FR_OK);
    00EC0 2344      TST	R20
    00EC1 F409      BNE	0x0EC3
    00EC2 CFCB      RJMP	0x0E8E
(1402) 
(1403) 	return res;
    00EC3 2F04      MOV	R16,R20
    00EC4 9622      ADIW	R28,2
    00EC5 940C 4889 JMP	pop_xgsetF03C
ff.c:dir_read:
  dir                  --> R10
  c                    --> R12
  res                  --> R20
  dj                   --> R22
    00EC7 940E 4880 CALL	push_xgsetF03C
    00EC9 01B8      MOVW	R22,R16
    00ECA 9722      SBIW	R28,2
(1404) }
(1405) 
(1406) 
(1407) 
(1408) 
(1409) /*-----------------------------------------------------------------------*/
(1410) /* Read an object from the directory                                     */
(1411) /*-----------------------------------------------------------------------*/
(1412) #if _FS_MINIMIZE <= 1
(1413) static
(1414) FRESULT dir_read (
(1415) 	DIR *dj			/* Pointer to the directory object that pointing the entry to be read */
(1416) )
(1417) {
(1418) 	FRESULT res;
(1419) 	BYTE c, *dir;
(1420) #if _USE_LFN
(1421) 	BYTE a, ord = 0xFF, sum = 0xFF;
(1422) #endif
(1423) 
(1424) 	res = FR_NO_FILE;
    00ECB E044      LDI	R20,4
    00ECC C02B      RJMP	0x0EF8
(1425) 	while (dj->sect) {
(1426) 		res = move_window(dj->fs, dj->sect);
    00ECD 01FB      MOVW	R30,R22
    00ECE 8426      LDD	R2,Z+14
    00ECF 8437      LDD	R3,Z+15
    00ED0 8840      LDD	R4,Z+16
    00ED1 8851      LDD	R5,Z+17
    00ED2 8248      ST	Y,R4
    00ED3 8259      STD	Y+1,R5
    00ED4 0191      MOVW	R18,R2
    00ED5 8100      LD	R16,Z
    00ED6 8111      LDD	R17,Z+1
    00ED7 940E 044E CALL	ff.c:move_window
    00ED9 2F40      MOV	R20,R16
(1427) 		if (res != FR_OK) break;
    00EDA 2300      TST	R16
    00EDB F009      BEQ	0x0EDD
    00EDC C028      RJMP	0x0F05
(1428) 		dir = dj->dir;					/* Ptr to the directory entry of current index */
    00EDD 01FB      MOVW	R30,R22
    00EDE 88A2      LDD	R10,Z+18
    00EDF 88B3      LDD	R11,Z+19
(1429) 		c = dir[DIR_Name];
    00EE0 01F5      MOVW	R30,R10
    00EE1 80C0      LD	R12,Z
(1430) 		if (c == 0) { res = FR_NO_FILE; break; }	/* Reached to end of table */
    00EE2 20CC      TST	R12
    00EE3 F411      BNE	0x0EE6
    00EE4 E044      LDI	R20,4
    00EE5 C01F      RJMP	0x0F05
(1431) #if _USE_LFN	/* LFN configuration */
(1432) 		a = dir[DIR_Attr] & AM_MASK;
(1433) 		if (c == DDE || (!_FS_RPATH && c == '.') || ((a & AM_VOL) && a != AM_LFN)) {	/* An entry without valid data */
(1434) 			ord = 0xFF;
(1435) 		} else {
(1436) 			if (a == AM_LFN) {			/* An LFN entry is found */
(1437) 				if (c & LLE) {			/* Is it start of LFN sequence? */
(1438) 					sum = dir[LDIR_Chksum];
(1439) 					c &= ~LLE; ord = c;
(1440) 					dj->lfn_idx = dj->index;
(1441) 				}
(1442) 				/* Check LFN validity and capture it */
(1443) 				ord = (c == ord && sum == dir[LDIR_Chksum] && pick_lfn(dj->lfn, dir)) ? ord - 1 : 0xFF;
(1444) 			} else {					/* An SFN entry is found */
(1445) 				if (ord || sum != sum_sfn(dir))	/* Is there a valid LFN? */
(1446) 					dj->lfn_idx = 0xFFFF;		/* It has no LFN. */
(1447) 				break;
(1448) 			}
(1449) 		}
(1450) #else		/* Non LFN configuration */
(1451) 		if (c != DDE && (_FS_RPATH || c != '.') && !(dir[DIR_Attr] & AM_VOL))	/* Is it a valid entry? */
    00EE6 2D8C      MOV	R24,R12
    00EE7 3E85      CPI	R24,0xE5
    00EE8 F039      BEQ	0x0EF0
    00EE9 328E      CPI	R24,0x2E
    00EEA F029      BEQ	0x0EF0
    00EEB 01F5      MOVW	R30,R10
    00EEC 8423      LDD	R2,Z+11
    00EED FC23      SBRC	R2,3
    00EEE C001      RJMP	0x0EF0
(1452) 			break;
    00EEF C015      RJMP	0x0F05
(1453) #endif
(1454) 		res = dir_next(dj, 0);				/* Next entry */
    00EF0 2722      CLR	R18
    00EF1 2733      CLR	R19
    00EF2 018B      MOVW	R16,R22
    00EF3 DDE0      RCALL	ff.c:dir_next
    00EF4 2F40      MOV	R20,R16
(1455) 		if (res != FR_OK) break;
    00EF5 2300      TST	R16
    00EF6 F009      BEQ	0x0EF8
    00EF7 C00D      RJMP	0x0F05
    00EF8 01FB      MOVW	R30,R22
    00EF9 963E      ADIW	R30,0xE
    00EFA 8020      LD	R2,Z
    00EFB 8031      LDD	R3,Z+1
    00EFC 8042      LDD	R4,Z+2
    00EFD 8053      LDD	R5,Z+3
    00EFE 9488      BCLR	0
    00EFF 2022      TST	R2
    00F00 0432      CPC	R3,R2
    00F01 0442      CPC	R4,R2
    00F02 0452      CPC	R5,R2
    00F03 F009      BEQ	0x0F05
    00F04 CFC8      RJMP	0x0ECD
(1456) 	}
(1457) 
(1458) 	if (res != FR_OK) dj->sect = 0;
    00F05 2344      TST	R20
    00F06 F039      BEQ	0x0F0E
    00F07 01FB      MOVW	R30,R22
    00F08 963E      ADIW	R30,0xE
    00F09 E080      LDI	R24,0
    00F0A 8380      ST	Z,R24
    00F0B 8381      STD	Z+1,R24
    00F0C 8382      STD	Z+2,R24
    00F0D 8383      STD	Z+3,R24
(1459) 
(1460) 	return res;
    00F0E 2F04      MOV	R16,R20
    00F0F 9622      ADIW	R28,2
    00F10 940C 4889 JMP	pop_xgsetF03C
ff.c:dir_register:
  dir                  --> R12
  c                    --> R22
  res                  --> R10
  dj                   --> R20
    00F12 940E 4880 CALL	push_xgsetF03C
    00F14 01A8      MOVW	R20,R16
    00F15 9722      SBIW	R28,2
(1461) }
(1462) #endif
(1463) 
(1464) 
(1465) 
(1466) /*-----------------------------------------------------------------------*/
(1467) /* Register an object to the directory                                   */
(1468) /*-----------------------------------------------------------------------*/
(1469) #if !_FS_READONLY
(1470) static
(1471) FRESULT dir_register (	/* FR_OK:Successful, FR_DENIED:No free entry or too many SFN collision, FR_DISK_ERR:Disk error */
(1472) 	DIR *dj				/* Target directory with object name to be created */
(1473) )
(1474) {
(1475) 	FRESULT res;
(1476) 	BYTE c, *dir;
(1477) #if _USE_LFN	/* LFN configuration */
(1478) 	WORD n, ne, is;
(1479) 	BYTE sn[12], *fn, sum;
(1480) 	WCHAR *lfn;
(1481) 
(1482) 
(1483) 	fn = dj->fn; lfn = dj->lfn;
(1484) 	mem_cpy(sn, fn, 12);
(1485) 
(1486) 	if (_FS_RPATH && (sn[NS] & NS_DOT))		/* Cannot create dot entry */
(1487) 		return FR_INVALID_NAME;
(1488) 
(1489) 	if (sn[NS] & NS_LOSS) {			/* When LFN is out of 8.3 format, generate a numbered name */
(1490) 		fn[NS] = 0; dj->lfn = 0;			/* Find only SFN */
(1491) 		for (n = 1; n < 100; n++) {
(1492) 			gen_numname(fn, sn, lfn, n);	/* Generate a numbered name */
(1493) 			res = dir_find(dj);				/* Check if the name collides with existing SFN */
(1494) 			if (res != FR_OK) break;
(1495) 		}
(1496) 		if (n == 100) return FR_DENIED;		/* Abort if too many collisions */
(1497) 		if (res != FR_NO_FILE) return res;	/* Abort if the result is other than 'not collided' */
(1498) 		fn[NS] = sn[NS]; dj->lfn = lfn;
(1499) 	}
(1500) 
(1501) 	if (sn[NS] & NS_LFN) {			/* When LFN is to be created, reserve an SFN + LFN entries. */
(1502) 		for (ne = 0; lfn[ne]; ne++) ;
(1503) 		ne = (ne + 25) / 13;
(1504) 	} else {						/* Otherwise reserve only an SFN entry. */
(1505) 		ne = 1;
(1506) 	}
(1507) 
(1508) 	/* Reserve contiguous entries */
(1509) 	res = dir_sdi(dj, 0);
(1510) 	if (res != FR_OK) return res;
(1511) 	n = is = 0;
(1512) 	do {
(1513) 		res = move_window(dj->fs, dj->sect);
(1514) 		if (res != FR_OK) break;
(1515) 		c = *dj->dir;				/* Check the entry status */
(1516) 		if (c == DDE || c == 0) {	/* Is it a blank entry? */
(1517) 			if (n == 0) is = dj->index;	/* First index of the contiguous entry */
(1518) 			if (++n == ne) break;	/* A contiguous entry that required count is found */
(1519) 		} else {
(1520) 			n = 0;					/* Not a blank entry. Restart to search */
(1521) 		}
(1522) 		res = dir_next(dj, 1);		/* Next entry with table stretch */
(1523) 	} while (res == FR_OK);
(1524) 
(1525) 	if (res == FR_OK && ne > 1) {	/* Initialize LFN entry if needed */
(1526) 		res = dir_sdi(dj, is);
(1527) 		if (res == FR_OK) {
(1528) 			sum = sum_sfn(dj->fn);	/* Sum of the SFN tied to the LFN */
(1529) 			ne--;
(1530) 			do {					/* Store LFN entries in bottom first */
(1531) 				res = move_window(dj->fs, dj->sect);
(1532) 				if (res != FR_OK) break;
(1533) 				fit_lfn(dj->lfn, dj->dir, (BYTE)ne, sum);
(1534) 				dj->fs->wflag = 1;
(1535) 				res = dir_next(dj, 0);	/* Next entry */
(1536) 			} while (res == FR_OK && --ne);
(1537) 		}
(1538) 	}
(1539) 
(1540) #else	/* Non LFN configuration */
(1541) 	res = dir_sdi(dj, 0);
    00F16 2722      CLR	R18
    00F17 2733      CLR	R19
    00F18 018A      MOVW	R16,R20
    00F19 DCB0      RCALL	ff.c:dir_sdi
    00F1A 2EA0      MOV	R10,R16
(1542) 	if (res == FR_OK) {
    00F1B 2300      TST	R16
    00F1C F509      BNE	0x0F3E
(1543) 		do {	/* Find a blank entry for the SFN */
(1544) 			res = move_window(dj->fs, dj->sect);
    00F1D 01FA      MOVW	R30,R20
    00F1E 8426      LDD	R2,Z+14
    00F1F 8437      LDD	R3,Z+15
    00F20 8840      LDD	R4,Z+16
    00F21 8851      LDD	R5,Z+17
    00F22 8248      ST	Y,R4
    00F23 8259      STD	Y+1,R5
    00F24 0191      MOVW	R18,R2
    00F25 8100      LD	R16,Z
    00F26 8111      LDD	R17,Z+1
    00F27 940E 044E CALL	ff.c:move_window
    00F29 2EA0      MOV	R10,R16
(1545) 			if (res != FR_OK) break;
    00F2A 2300      TST	R16
    00F2B F009      BEQ	0x0F2D
    00F2C C011      RJMP	0x0F3E
(1546) 			c = *dj->dir;
    00F2D 01FA      MOVW	R30,R20
    00F2E 89A2      LDD	R26,Z+18
    00F2F 89B3      LDD	R27,Z+19
    00F30 916C      LD	R22,X
(1547) 			if (c == DDE || c == 0) break;	/* Is it a blank entry? */
    00F31 3E65      CPI	R22,0xE5
    00F32 F011      BEQ	0x0F35
    00F33 2366      TST	R22
    00F34 F409      BNE	0x0F36
    00F35 C008      RJMP	0x0F3E
(1548) 			res = dir_next(dj, 1);			/* Next entry with table stretch */
    00F36 E021      LDI	R18,1
    00F37 E030      LDI	R19,0
    00F38 018A      MOVW	R16,R20
    00F39 DD9A      RCALL	ff.c:dir_next
    00F3A 2EC0      MOV	R12,R16
    00F3B 2CAC      MOV	R10,R12
(1549) 		} while (res == FR_OK);
    00F3C 20AA      TST	R10
    00F3D F2F9      BEQ	0x0F1D
(1550) 	}
(1551) #endif
(1552) 
(1553) 	if (res == FR_OK) {		/* Initialize the SFN entry */
    00F3E 20AA      TST	R10
    00F3F F009      BEQ	0x0F41
    00F40 C030      RJMP	0x0F71
(1554) 		res = move_window(dj->fs, dj->sect);
    00F41 01FA      MOVW	R30,R20
    00F42 8426      LDD	R2,Z+14
    00F43 8437      LDD	R3,Z+15
    00F44 8840      LDD	R4,Z+16
    00F45 8851      LDD	R5,Z+17
    00F46 8248      ST	Y,R4
    00F47 8259      STD	Y+1,R5
    00F48 0191      MOVW	R18,R2
    00F49 8100      LD	R16,Z
    00F4A 8111      LDD	R17,Z+1
    00F4B 940E 044E CALL	ff.c:move_window
    00F4D 2EC0      MOV	R12,R16
    00F4E 2CAC      MOV	R10,R12
(1555) 		if (res == FR_OK) {
    00F4F 2300      TST	R16
    00F50 F501      BNE	0x0F71
(1556) 			dir = dj->dir;
    00F51 01FA      MOVW	R30,R20
    00F52 88C2      LDD	R12,Z+18
    00F53 88D3      LDD	R13,Z+19
(1557) 			mem_set(dir, 0, SZ_DIR);	/* Clean the entry */
    00F54 E280      LDI	R24,0x20
    00F55 E090      LDI	R25,0
    00F56 8399      STD	Y+1,R25
    00F57 8388      ST	Y,R24
    00F58 2722      CLR	R18
    00F59 2733      CLR	R19
    00F5A 0186      MOVW	R16,R12
    00F5B 940E 040B CALL	ff.c:mem_set
(1558) 			mem_cpy(dir, dj->fn, 11);	/* Put SFN */
    00F5D E08B      LDI	R24,0xB
    00F5E E090      LDI	R25,0
    00F5F 8399      STD	Y+1,R25
    00F60 8388      ST	Y,R24
    00F61 01FA      MOVW	R30,R20
    00F62 8924      LDD	R18,Z+20
    00F63 8935      LDD	R19,Z+21
    00F64 0186      MOVW	R16,R12
    00F65 940E 03F5 CALL	ff.c:mem_cpy
(1559) #if _USE_LFN
(1560) 			dir[DIR_NTres] = *(dj->fn+NS) & (NS_BODY | NS_EXT);	/* Put NT flag */
(1561) #endif
(1562) 			dj->fs->wflag = 1;
    00F67 E081      LDI	R24,1
    00F68 01FA      MOVW	R30,R20
    00F69 93AF      PUSH	R26
    00F6A 93BF      PUSH	R27
    00F6B 81A0      LD	R26,Z
    00F6C 81B1      LDD	R27,Z+1
    00F6D 01FD      MOVW	R30,R26
    00F6E 91BF      POP	R27
    00F6F 91AF      POP	R26
    00F70 8384      STD	Z+4,R24
(1563) 		}
(1564) 	}
(1565) 
(1566) 	return res;
    00F71 2D0A      MOV	R16,R10
    00F72 9622      ADIW	R28,2
    00F73 940C 4889 JMP	pop_xgsetF03C
ff.c:create_name:
  si                   --> R22
  b                    --> Y,+8
  sfn                  --> Y,+6
  ni                   --> R12
  d                    --> R10
  i                    --> Y,+4
  p                    --> Y,+2
  c                    --> R20
  path                 --> Y,+19
  dj                   --> R20
    00F75 933A      ST	-Y,R19
    00F76 932A      ST	-Y,R18
    00F77 940E 4845 CALL	push_xgsetF0FC
    00F79 01A8      MOVW	R20,R16
    00F7A 9729      SBIW	R28,0x9
(1567) }
(1568) #endif /* !_FS_READONLY */
(1569) 
(1570) 
(1571) 
(1572) 
(1573) /*-----------------------------------------------------------------------*/
(1574) /* Remove an object from the directory                                   */
(1575) /*-----------------------------------------------------------------------*/
(1576) #if !_FS_READONLY && !_FS_MINIMIZE
(1577) static
(1578) FRESULT dir_remove (	/* FR_OK: Successful, FR_DISK_ERR: A disk error */
(1579) 	DIR *dj				/* Directory object pointing the entry to be removed */
(1580) )
(1581) {
(1582) 	FRESULT res;
(1583) #if _USE_LFN	/* LFN configuration */
(1584) 	WORD i;
(1585) 
(1586) 	i = dj->index;	/* SFN index */
(1587) 	res = dir_sdi(dj, (WORD)((dj->lfn_idx == 0xFFFF) ? i : dj->lfn_idx));	/* Goto the SFN or top of the LFN entries */
(1588) 	if (res == FR_OK) {
(1589) 		do {
(1590) 			res = move_window(dj->fs, dj->sect);
(1591) 			if (res != FR_OK) break;
(1592) 			*dj->dir = DDE;			/* Mark the entry "deleted" */
(1593) 			dj->fs->wflag = 1;
(1594) 			if (dj->index >= i) break;	/* When reached SFN, all entries of the object has been deleted. */
(1595) 			res = dir_next(dj, 0);		/* Next entry */
(1596) 		} while (res == FR_OK);
(1597) 		if (res == FR_NO_FILE) res = FR_INT_ERR;
(1598) 	}
(1599) 
(1600) #else			/* Non LFN configuration */
(1601) 	res = dir_sdi(dj, dj->index);
(1602) 	if (res == FR_OK) {
(1603) 		res = move_window(dj->fs, dj->sect);
(1604) 		if (res == FR_OK) {
(1605) 			*dj->dir = DDE;			/* Mark the entry "deleted" */
(1606) 			dj->fs->wflag = 1;
(1607) 		}
(1608) 	}
(1609) #endif
(1610) 
(1611) 	return res;
(1612) }
(1613) #endif /* !_FS_READONLY */
(1614) 
(1615) 
(1616) 
(1617) 
(1618) /*-----------------------------------------------------------------------*/
(1619) /* Pick a segment and create the object name in directory form           */
(1620) /*-----------------------------------------------------------------------*/
(1621) 
(1622) static
(1623) FRESULT create_name (
(1624) 	DIR *dj,			/* Pointer to the directory object */
(1625) 	const TCHAR **path	/* Pointer to pointer to the segment in the path string */
(1626) )
(1627) {
(1628) #ifdef _EXCVT
(1629) 	static const BYTE excvt[] = _EXCVT;	/* Upper conversion table for extended chars */
(1630) #endif
(1631) 
(1632) #if _USE_LFN	/* LFN configuration */
(1633) 	BYTE b, cf;
(1634) 	WCHAR w, *lfn;
(1635) 	UINT i, ni, si, di;
(1636) 	const TCHAR *p;
(1637) 
(1638) 	/* Create LFN in Unicode */
(1639) 	for (p = *path; *p == '/' || *p == '\\'; p++) ;	/* Strip duplicated separator */
(1640) 	lfn = dj->lfn;
(1641) 	si = di = 0;
(1642) 	for (;;) {
(1643) 		w = p[si++];					/* Get a character */
(1644) 		if (w < ' ' || w == '/' || w == '\\') break;	/* Break on end of segment */
(1645) 		if (di >= _MAX_LFN)				/* Reject too long name */
(1646) 			return FR_INVALID_NAME;
(1647) #if !_LFN_UNICODE
(1648) 		w &= 0xFF;
(1649) 		if (IsDBCS1(w)) {				/* Check if it is a DBC 1st byte (always false on SBCS cfg) */
(1650) 			b = (BYTE)p[si++];			/* Get 2nd byte */
(1651) 			if (!IsDBCS2(b))
(1652) 				return FR_INVALID_NAME;	/* Reject invalid sequence */
(1653) 			w = (w << 8) + b;			/* Create a DBC */
(1654) 		}
(1655) 		w = ff_convert(w, 1);			/* Convert ANSI/OEM to Unicode */
(1656) 		if (!w) return FR_INVALID_NAME;	/* Reject invalid code */
(1657) #endif
(1658) 		if (w < 0x80 && chk_chr("\"*:<>\?|\x7F", w)) /* Reject illegal chars for LFN */
(1659) 			return FR_INVALID_NAME;
(1660) 		lfn[di++] = w;					/* Store the Unicode char */
(1661) 	}
(1662) 	*path = &p[si];						/* Return pointer to the next segment */
(1663) 	cf = (w < ' ') ? NS_LAST : 0;		/* Set last segment flag if end of path */
(1664) #if _FS_RPATH
(1665) 	if ((di == 1 && lfn[di-1] == '.') || /* Is this a dot entry? */
(1666) 		(di == 2 && lfn[di-1] == '.' && lfn[di-2] == '.')) {
(1667) 		lfn[di] = 0;
(1668) 		for (i = 0; i < 11; i++)
(1669) 			dj->fn[i] = (i < di) ? '.' : ' ';
(1670) 		dj->fn[i] = cf | NS_DOT;		/* This is a dot entry */
(1671) 		return FR_OK;
(1672) 	}
(1673) #endif
(1674) 	while (di) {						/* Strip trailing spaces and dots */
(1675) 		w = lfn[di-1];
(1676) 		if (w != ' ' && w != '.') break;
(1677) 		di--;
(1678) 	}
(1679) 	if (!di) return FR_INVALID_NAME;	/* Reject nul string */
(1680) 
(1681) 	lfn[di] = 0;						/* LFN is created */
(1682) 
(1683) 	/* Create SFN in directory form */
(1684) 	mem_set(dj->fn, ' ', 11);
(1685) 	for (si = 0; lfn[si] == ' ' || lfn[si] == '.'; si++) ;	/* Strip leading spaces and dots */
(1686) 	if (si) cf |= NS_LOSS | NS_LFN;
(1687) 	while (di && lfn[di - 1] != '.') di--;	/* Find extension (di<=si: no extension) */
(1688) 
(1689) 	b = i = 0; ni = 8;
(1690) 	for (;;) {
(1691) 		w = lfn[si++];					/* Get an LFN char */
(1692) 		if (!w) break;					/* Break on end of the LFN */
(1693) 		if (w == ' ' || (w == '.' && si != di)) {	/* Remove spaces and dots */
(1694) 			cf |= NS_LOSS | NS_LFN; continue;
(1695) 		}
(1696) 
(1697) 		if (i >= ni || si == di) {		/* Extension or end of SFN */
(1698) 			if (ni == 11) {				/* Long extension */
(1699) 				cf |= NS_LOSS | NS_LFN; break;
(1700) 			}
(1701) 			if (si != di) cf |= NS_LOSS | NS_LFN;	/* Out of 8.3 format */
(1702) 			if (si > di) break;			/* No extension */
(1703) 			si = di; i = 8; ni = 11;	/* Enter extension section */
(1704) 			b <<= 2; continue;
(1705) 		}
(1706) 
(1707) 		if (w >= 0x80) {				/* Non ASCII char */
(1708) #ifdef _EXCVT
(1709) 			w = ff_convert(w, 0);		/* Unicode -> OEM code */
(1710) 			if (w) w = excvt[w - 0x80];	/* Convert extended char to upper (SBCS) */
(1711) #else
(1712) 			w = ff_convert(ff_wtoupper(w), 0);	/* Upper converted Unicode -> OEM code */
(1713) #endif
(1714) 			cf |= NS_LFN;				/* Force create LFN entry */
(1715) 		}
(1716) 
(1717) 		if (_DF1S && w >= 0x100) {		/* Double byte char (always false on SBCS cfg) */
(1718) 			if (i >= ni - 1) {
(1719) 				cf |= NS_LOSS | NS_LFN; i = ni; continue;
(1720) 			}
(1721) 			dj->fn[i++] = (BYTE)(w >> 8);
(1722) 		} else {						/* Single byte char */
(1723) 			if (!w || chk_chr("+,;=[]", w)) {	/* Replace illegal chars for SFN */
(1724) 				w = '_'; cf |= NS_LOSS | NS_LFN;/* Lossy conversion */
(1725) 			} else {
(1726) 				if (IsUpper(w)) {		/* ASCII large capital */
(1727) 					b |= 2;
(1728) 				} else {
(1729) 					if (IsLower(w)) {	/* ASCII small capital */
(1730) 						b |= 1; w -= 0x20;
(1731) 					}
(1732) 				}
(1733) 			}
(1734) 		}
(1735) 		dj->fn[i++] = (BYTE)w;
(1736) 	}
(1737) 
(1738) 	if (dj->fn[0] == DDE) dj->fn[0] = NDDE;	/* If the first char collides with deleted mark, replace it with 0x05 */
(1739) 
(1740) 	if (ni == 8) b <<= 2;
(1741) 	if ((b & 0x0C) == 0x0C || (b & 0x03) == 0x03)	/* Create LFN entry when there are composite capitals */
(1742) 		cf |= NS_LFN;
(1743) 	if (!(cf & NS_LFN)) {						/* When LFN is in 8.3 format without extended char, NT flags are created */
(1744) 		if ((b & 0x03) == 0x01) cf |= NS_EXT;	/* NT flag (Extension has only small capital) */
(1745) 		if ((b & 0x0C) == 0x04) cf |= NS_BODY;	/* NT flag (Filename has only small capital) */
(1746) 	}
(1747) 
(1748) 	dj->fn[NS] = cf;	/* SFN is created */
(1749) 
(1750) 	return FR_OK;
(1751) 
(1752) 
(1753) #else	/* Non-LFN configuration */
(1754) 	BYTE b, c, d, *sfn;
(1755) 	UINT ni, si, i;
(1756) 	const char *p;
(1757) 
(1758) 	/* Create file name in directory form */
(1759) 	for (p = *path; *p == '/' || *p == '\\'; p++) ;	/* Strip duplicated separator */
    00F7B 89EB      LDD	R30,Y+19
    00F7C 89FC      LDD	R31,Y+20
    00F7D 8020      LD	R2,Z
    00F7E 8031      LDD	R3,Z+1
    00F7F 823B      STD	Y+3,R3
    00F80 822A      STD	Y+2,R2
    00F81 C005      RJMP	0x0F87
    00F82 818A      LDD	R24,Y+2
    00F83 819B      LDD	R25,Y+3
    00F84 9601      ADIW	R24,1
    00F85 839B      STD	Y+3,R25
    00F86 838A      STD	Y+2,R24
    00F87 81EA      LDD	R30,Y+2
    00F88 81FB      LDD	R31,Y+3
    00F89 8020      LD	R2,Z
    00F8A 2433      CLR	R3
    00F8B 2D82      MOV	R24,R2
    00F8C 328F      CPI	R24,0x2F
    00F8D F3A1      BEQ	0x0F82
    00F8E 358C      CPI	R24,0x5C
    00F8F F391      BEQ	0x0F82
(1760) 	sfn = dj->fn;
    00F90 01FA      MOVW	R30,R20
    00F91 8824      LDD	R2,Z+20
    00F92 8835      LDD	R3,Z+21
    00F93 823F      STD	Y+7,R3
    00F94 822E      STD	Y+6,R2
(1761) 	mem_set(sfn, ' ', 11);
    00F95 E08B      LDI	R24,0xB
    00F96 E090      LDI	R25,0
    00F97 8399      STD	Y+1,R25
    00F98 8388      ST	Y,R24
    00F99 E220      LDI	R18,0x20
    00F9A E030      LDI	R19,0
    00F9B 0181      MOVW	R16,R2
    00F9C 940E 040B CALL	ff.c:mem_set
(1762) 	si = i = b = 0; ni = 8;
    00F9E 2400      CLR	R0
    00F9F 8608      STD	Y+8,R0
    00FA0 2422      CLR	R2
    00FA1 2433      CLR	R3
    00FA2 823D      STD	Y+5,R3
    00FA3 822C      STD	Y+4,R2
    00FA4 01B1      MOVW	R22,R2
    00FA5 E088      LDI	R24,0x8
    00FA6 E090      LDI	R25,0
    00FA7 016C      MOVW	R12,R24
(1763) #if _FS_RPATH
(1764) 	if (p[si] == '.') { /* Is this a dot entry? */
(1765) 		for (;;) {
(1766) 			c = (BYTE)p[si++];
(1767) 			if (c != '.' || si >= 3) break;
(1768) 			sfn[i++] = c;
(1769) 		}
(1770) 		if (c != '/' && c != '\\' && c > ' ') return FR_INVALID_NAME;
(1771) 		*path = &p[si];									/* Return pointer to the next segment */
(1772) 		sfn[NS] = (c <= ' ') ? NS_LAST | NS_DOT : NS_DOT;	/* Set last segment flag if end of path */
(1773) 		return FR_OK;
(1774) 	}
(1775) #endif
(1776) 	for (;;) {
(1777) 		c = (BYTE)p[si++];
    00FA8 01AB      MOVW	R20,R22
    00FA9 5F6F      SUBI	R22,0xFF
    00FAA 4F7F      SBCI	R23,0xFF
    00FAB 01FA      MOVW	R30,R20
    00FAC 800A      LDD	R0,Y+2
    00FAD 801B      LDD	R1,Y+3
    00FAE 0DE0      ADD	R30,R0
    00FAF 1DF1      ADC	R31,R1
    00FB0 8140      LD	R20,Z
(1778) 		if (c <= ' ' || c == '/' || c == '\\') break;	/* Break on end of segment */
    00FB1 E280      LDI	R24,0x20
    00FB2 1784      CP	R24,R20
    00FB3 F420      BCC	0x0FB8
    00FB4 324F      CPI	R20,0x2F
    00FB5 F011      BEQ	0x0FB8
    00FB6 354C      CPI	R20,0x5C
    00FB7 F409      BNE	0x0FB9
    00FB8 C087      RJMP	0x1040
(1779) 		if (c == '.' || i >= ni) {
    00FB9 324E      CPI	R20,0x2E
    00FBA F029      BEQ	0x0FC0
    00FBB 800C      LDD	R0,Y+4
    00FBC 801D      LDD	R1,Y+5
    00FBD 140C      CP	R0,R12
    00FBE 041D      CPC	R1,R13
    00FBF F0A0      BCS	0x0FD4
(1780) 			if (ni != 8 || c != '.') return FR_INVALID_NAME;
    00FC0 01C6      MOVW	R24,R12
    00FC1 3088      CPI	R24,0x8
    00FC2 E0E0      LDI	R30,0
    00FC3 079E      CPC	R25,R30
    00FC4 F411      BNE	0x0FC7
    00FC5 324E      CPI	R20,0x2E
    00FC6 F011      BEQ	0x0FC9
    00FC7 E006      LDI	R16,6
    00FC8 C0AF      RJMP	0x1078
(1781) 			i = 8; ni = 11;
    00FC9 E088      LDI	R24,0x8
    00FCA E090      LDI	R25,0
    00FCB 839D      STD	Y+5,R25
    00FCC 838C      STD	Y+4,R24
    00FCD E08B      LDI	R24,0xB
    00FCE 016C      MOVW	R12,R24
(1782) 			b <<= 2; continue;
    00FCF 8408      LDD	R0,Y+8
    00FD0 0C00      LSL	R0
    00FD1 0C00      LSL	R0
    00FD2 8608      STD	Y+8,R0
    00FD3 CFD4      RJMP	0x0FA8
(1783) 		}
(1784) 		if (c >= 0x80) {				/* Extended char? */
    00FD4 3840      CPI	R20,0x80
    00FD5 F018      BCS	0x0FD9
(1785) 			b |= 3;						/* Eliminate NT flag */
    00FD6 8588      LDD	R24,Y+8
    00FD7 6083      ORI	R24,3
    00FD8 8788      STD	Y+8,R24
(1786) #ifdef _EXCVT
(1787) 			c = excvt[c-0x80];			/* Upper conversion (SBCS) */
(1788) #else
(1789) #if !_DF1S	/* ASCII only cfg */
(1790) 			return FR_INVALID_NAME;
(1791) #endif
(1792) #endif
(1793) 		}
(1794) 		if (IsDBCS1(c)) {				/* Check if it is a DBC 1st byte (always false on SBCS cfg) */
    00FD9 3841      CPI	R20,0x81
    00FDA F408      BCC	0x0FDC
    00FDB C039      RJMP	0x1015
    00FDC EF8E      LDI	R24,0xFE
    00FDD 1784      CP	R24,R20
    00FDE F408      BCC	0x0FE0
    00FDF C035      RJMP	0x1015
(1795) 			d = (BYTE)p[si++];			/* Get 2nd byte */
    00FE0 015B      MOVW	R10,R22
    00FE1 5F6F      SUBI	R22,0xFF
    00FE2 4F7F      SBCI	R23,0xFF
    00FE3 01F5      MOVW	R30,R10
    00FE4 800A      LDD	R0,Y+2
    00FE5 801B      LDD	R1,Y+3
    00FE6 0DE0      ADD	R30,R0
    00FE7 1DF1      ADC	R31,R1
    00FE8 80A0      LD	R10,Z
(1796) 			if (!IsDBCS2(d) || i >= ni - 1)	/* Reject invalid DBC */
    00FE9 2D8A      MOV	R24,R10
    00FEA 3480      CPI	R24,0x40
    00FEB F018      BCS	0x0FEF
    00FEC E78E      LDI	R24,0x7E
    00FED 158A      CP	R24,R10
    00FEE F430      BCC	0x0FF5
    00FEF 2D8A      MOV	R24,R10
    00FF0 3880      CPI	R24,0x80
    00FF1 F050      BCS	0x0FFC
    00FF2 EF8E      LDI	R24,0xFE
    00FF3 158A      CP	R24,R10
    00FF4 F038      BCS	0x0FFC
    00FF5 01C6      MOVW	R24,R12
    00FF6 9701      SBIW	R24,1
    00FF7 800C      LDD	R0,Y+4
    00FF8 801D      LDD	R1,Y+5
    00FF9 1608      CP	R0,R24
    00FFA 0619      CPC	R1,R25
    00FFB F010      BCS	0x0FFE
(1797) 				return FR_INVALID_NAME;
    00FFC E006      LDI	R16,6
    00FFD C07A      RJMP	0x1078
(1798) 			sfn[i++] = c;
    00FFE 80EC      LDD	R14,Y+4
    00FFF 80FD      LDD	R15,Y+5
    01000 01C7      MOVW	R24,R14
    01001 9601      ADIW	R24,1
    01002 839D      STD	Y+5,R25
    01003 838C      STD	Y+4,R24
    01004 01F7      MOVW	R30,R14
    01005 800E      LDD	R0,Y+6
    01006 801F      LDD	R1,Y+7
    01007 0DE0      ADD	R30,R0
    01008 1DF1      ADC	R31,R1
    01009 8340      ST	Z,R20
(1799) 			sfn[i++] = d;
    0100A 017C      MOVW	R14,R24
    0100B 9601      ADIW	R24,1
    0100C 839D      STD	Y+5,R25
    0100D 838C      STD	Y+4,R24
    0100E 01F7      MOVW	R30,R14
    0100F 800E      LDD	R0,Y+6
    01010 801F      LDD	R1,Y+7
    01011 0DE0      ADD	R30,R0
    01012 1DF1      ADC	R31,R1
    01013 82A0      ST	Z,R10
(1800) 		} else {						/* Single byte code */
    01014 CF93      RJMP	0x0FA8
(1801) 			if (chk_chr("\"*+,:;<=>\?[]|\x7F", c))	/* Reject illegal chrs for SFN */
    01015 2F24      MOV	R18,R20
    01016 2733      CLR	R19
    01017 E000      LDI	R16,0
    01018 E011      LDI	R17,1
    01019 940E 043E CALL	ff.c:chk_chr
    0101B 0158      MOVW	R10,R16
    0101C 3000      CPI	R16,0
    0101D 0701      CPC	R16,R17
    0101E F011      BEQ	0x1021
(1802) 				return FR_INVALID_NAME;
    0101F E006      LDI	R16,6
    01020 C057      RJMP	0x1078
(1803) 			if (IsUpper(c)) {			/* ASCII large capital? */
    01021 3441      CPI	R20,0x41
    01022 F038      BCS	0x102A
    01023 E58A      LDI	R24,0x5A
    01024 1784      CP	R24,R20
    01025 F020      BCS	0x102A
(1804) 				b |= 2;
    01026 8588      LDD	R24,Y+8
    01027 6082      ORI	R24,2
    01028 8788      STD	Y+8,R24
(1805) 			} else {
    01029 C009      RJMP	0x1033
(1806) 				if (IsLower(c)) {		/* ASCII small capital? */
    0102A 3641      CPI	R20,0x61
    0102B F038      BCS	0x1033
    0102C E78A      LDI	R24,0x7A
    0102D 1784      CP	R24,R20
    0102E F020      BCS	0x1033
(1807) 					b |= 1; c -= 0x20;
    0102F 8588      LDD	R24,Y+8
    01030 6081      ORI	R24,1
    01031 8788      STD	Y+8,R24
    01032 5240      SUBI	R20,0x20
(1808) 				}
(1809) 			}
(1810) 			sfn[i++] = c;
    01033 80AC      LDD	R10,Y+4
    01034 80BD      LDD	R11,Y+5
    01035 01C5      MOVW	R24,R10
    01036 9601      ADIW	R24,1
    01037 839D      STD	Y+5,R25
    01038 838C      STD	Y+4,R24
    01039 01F5      MOVW	R30,R10
    0103A 800E      LDD	R0,Y+6
    0103B 801F      LDD	R1,Y+7
    0103C 0DE0      ADD	R30,R0
    0103D 1DF1      ADC	R31,R1
    0103E 8340      ST	Z,R20
    0103F CF68      RJMP	0x0FA8
(1811) 		}
(1812) 	}
(1813) 	*path = &p[si];						/* Return pointer to the next segment */
    01040 011B      MOVW	R2,R22
    01041 800A      LDD	R0,Y+2
    01042 801B      LDD	R1,Y+3
    01043 0C20      ADD	R2,R0
    01044 1C31      ADC	R3,R1
    01045 89EB      LDD	R30,Y+19
    01046 89FC      LDD	R31,Y+20
    01047 8231      STD	Z+1,R3
    01048 8220      ST	Z,R2
(1814) 	c = (c <= ' ') ? NS_LAST : 0;		/* Set last segment flag if end of path */
    01049 E280      LDI	R24,0x20
    0104A 1784      CP	R24,R20
    0104B F018      BCS	0x104F
    0104C E064      LDI	R22,4
    0104D E070      LDI	R23,0
    0104E C002      RJMP	0x1051
    0104F 2766      CLR	R22
    01050 2777      CLR	R23
    01051 2F46      MOV	R20,R22
(1815) 
(1816) 	if (!i) return FR_INVALID_NAME;		/* Reject nul string */
    01052 800C      LDD	R0,Y+4
    01053 801D      LDD	R1,Y+5
    01054 2000      TST	R0
    01055 F421      BNE	0x105A
    01056 2011      TST	R1
    01057 F411      BNE	0x105A
    01058 E006      LDI	R16,6
    01059 C01E      RJMP	0x1078
(1817) 	if (sfn[0] == DDE) sfn[0] = NDDE;	/* When first char collides with DDE, replace it with 0x05 */
    0105A 81EE      LDD	R30,Y+6
    0105B 81FF      LDD	R31,Y+7
    0105C 8180      LD	R24,Z
    0105D 3E85      CPI	R24,0xE5
    0105E F411      BNE	0x1061
    0105F E085      LDI	R24,5
    01060 8380      ST	Z,R24
(1818) 
(1819) 	if (ni == 8) b <<= 2;
    01061 01C6      MOVW	R24,R12
    01062 3088      CPI	R24,0x8
    01063 E0E0      LDI	R30,0
    01064 079E      CPC	R25,R30
    01065 F421      BNE	0x106A
    01066 8408      LDD	R0,Y+8
    01067 0C00      LSL	R0
    01068 0C00      LSL	R0
    01069 8608      STD	Y+8,R0
(1820) 	if ((b & 0x03) == 0x01) c |= NS_EXT;	/* NT flag (Name extension has only small capital) */
    0106A 8588      LDD	R24,Y+8
    0106B 7083      ANDI	R24,3
    0106C 3081      CPI	R24,1
    0106D F409      BNE	0x106F
    0106E 6140      ORI	R20,0x10
(1821) 	if ((b & 0x0C) == 0x04) c |= NS_BODY;	/* NT flag (Name body has only small capital) */
    0106F 8588      LDD	R24,Y+8
    01070 708C      ANDI	R24,0xC
    01071 3084      CPI	R24,4
    01072 F409      BNE	0x1074
    01073 6048      ORI	R20,0x8
(1822) 
(1823) 	sfn[NS] = c;		/* Store NT flag, File name is created */
    01074 81EE      LDD	R30,Y+6
    01075 81FF      LDD	R31,Y+7
    01076 8743      STD	Z+11,R20
(1824) 
(1825) 	return FR_OK;
    01077 2700      CLR	R16
    01078 9629      ADIW	R28,0x9
    01079 940E 483A CALL	pop_xgsetF0FC
    0107B 9622      ADIW	R28,2
    0107C 9508      RET
ff.c:get_fileinfo:
  nt                   --> R12
  p                    --> R20
  dir                  --> R10
  i                    --> R12
  c                    --> R14
  fno                  --> R22
  dj                   --> R10
    0107D 940E 4845 CALL	push_xgsetF0FC
    0107F 01B9      MOVW	R22,R18
    01080 0158      MOVW	R10,R16
(1826) #endif
(1827) }
(1828) 
(1829) 
(1830) 
(1831) 
(1832) /*-----------------------------------------------------------------------*/
(1833) /* Get file information from directory entry                             */
(1834) /*-----------------------------------------------------------------------*/
(1835) #if _FS_MINIMIZE <= 1
(1836) static
(1837) void get_fileinfo (		/* No return code */
(1838) 	DIR *dj,			/* Pointer to the directory object */
(1839) 	FILINFO *fno	 	/* Pointer to the file information to be filled */
(1840) )
(1841) {
(1842) 	UINT i;
(1843) 	BYTE nt, *dir;
(1844) 	TCHAR *p, c;
(1845) 
(1846) 
(1847) 	p = fno->fname;
    01081 01AB      MOVW	R20,R22
    01082 5F47      SUBI	R20,0xF7
    01083 4F5F      SBCI	R21,0xFF
(1848) 	if (dj->sect) {
    01084 01F5      MOVW	R30,R10
    01085 963E      ADIW	R30,0xE
    01086 8020      LD	R2,Z
    01087 8031      LDD	R3,Z+1
    01088 8042      LDD	R4,Z+2
    01089 8053      LDD	R5,Z+3
    0108A 9488      BCLR	0
    0108B 2022      TST	R2
    0108C 0432      CPC	R3,R2
    0108D 0442      CPC	R4,R2
    0108E 0452      CPC	R5,R2
    0108F F409      BNE	0x1091
    01090 C08A      RJMP	0x111B
(1849) 		dir = dj->dir;
    01091 01F5      MOVW	R30,R10
    01092 88A2      LDD	R10,Z+18
    01093 88B3      LDD	R11,Z+19
(1850) 		nt = dir[DIR_NTres];		/* NT flag */
(1851) 		for (i = 0; i < 8; i++) {	/* Copy name body */
    01094 24CC      CLR	R12
    01095 24DD      CLR	R13
    01096 C014      RJMP	0x10AB
(1852) 			c = dir[i];
    01097 01F6      MOVW	R30,R12
    01098 0DEA      ADD	R30,R10
    01099 1DFB      ADC	R31,R11
    0109A 80E0      LD	R14,Z
(1853) 			if (c == ' ') break;
    0109B 2D8E      MOV	R24,R14
    0109C 3280      CPI	R24,0x20
    0109D F409      BNE	0x109F
    0109E C011      RJMP	0x10B0
(1854) 			if (c == NDDE) c = (TCHAR)DDE;
    0109F 2D8E      MOV	R24,R14
    010A0 3085      CPI	R24,5
    010A1 F411      BNE	0x10A4
    010A2 EE85      LDI	R24,0xE5
    010A3 2EE8      MOV	R14,R24
(1855) 			if (_USE_LFN && (nt & NS_BODY) && IsUpper(c)) c += 0x20;
    010A4 C000      RJMP	0x10A5
(1856) #if _LFN_UNICODE
(1857) 			if (IsDBCS1(c) && i < 7 && IsDBCS2(dir[i+1]))
(1858) 				c = (c << 8) | dir[++i];
(1859) 			c = ff_convert(c, 1);
(1860) 			if (!c) c = '?';
(1861) #endif
(1862) 			*p++ = c;
    010A5 01FA      MOVW	R30,R20
    010A6 92E1      ST	Z+,R14
    010A7 01AF      MOVW	R20,R30
    010A8 01C6      MOVW	R24,R12
    010A9 9601      ADIW	R24,1
    010AA 016C      MOVW	R12,R24
    010AB 01C6      MOVW	R24,R12
    010AC 3088      CPI	R24,0x8
    010AD E0E0      LDI	R30,0
    010AE 079E      CPC	R25,R30
    010AF F338      BCS	0x1097
(1863) 		}
(1864) 		if (dir[8] != ' ') {		/* Copy name extension */
    010B0 01F5      MOVW	R30,R10
    010B1 8580      LDD	R24,Z+8
    010B2 3280      CPI	R24,0x20
    010B3 F0E1      BEQ	0x10D0
(1865) 			*p++ = '.';
    010B4 E28E      LDI	R24,0x2E
    010B5 01FA      MOVW	R30,R20
    010B6 9381      ST	Z+,R24
    010B7 01AF      MOVW	R20,R30
(1866) 			for (i = 8; i < 11; i++) {
    010B8 E088      LDI	R24,0x8
    010B9 E090      LDI	R25,0
    010BA 016C      MOVW	R12,R24
    010BB C00F      RJMP	0x10CB
(1867) 				c = dir[i];
    010BC 01F6      MOVW	R30,R12
    010BD 0DEA      ADD	R30,R10
    010BE 1DFB      ADC	R31,R11
    010BF 80E0      LD	R14,Z
(1868) 				if (c == ' ') break;
    010C0 2D8E      MOV	R24,R14
    010C1 3280      CPI	R24,0x20
    010C2 F409      BNE	0x10C4
    010C3 C00C      RJMP	0x10D0
(1869) 				if (_USE_LFN && (nt & NS_EXT) && IsUpper(c)) c += 0x20;
    010C4 C000      RJMP	0x10C5
(1870) #if _LFN_UNICODE
(1871) 				if (IsDBCS1(c) && i < 10 && IsDBCS2(dir[i+1]))
(1872) 					c = (c << 8) | dir[++i];
(1873) 				c = ff_convert(c, 1);
(1874) 				if (!c) c = '?';
(1875) #endif
(1876) 				*p++ = c;
    010C5 01FA      MOVW	R30,R20
    010C6 92E1      ST	Z+,R14
    010C7 01AF      MOVW	R20,R30
    010C8 01C6      MOVW	R24,R12
    010C9 9601      ADIW	R24,1
    010CA 016C      MOVW	R12,R24
    010CB 01C6      MOVW	R24,R12
    010CC 308B      CPI	R24,0xB
    010CD E0E0      LDI	R30,0
    010CE 079E      CPC	R25,R30
    010CF F360      BCS	0x10BC
(1877) 			}
(1878) 		}
(1879) 		fno->fattrib = dir[DIR_Attr];				/* Attribute */
    010D0 01F5      MOVW	R30,R10
    010D1 8423      LDD	R2,Z+11
    010D2 01FB      MOVW	R30,R22
    010D3 8620      STD	Z+8,R2
(1880) 		fno->fsize = LD_DWORD(dir+DIR_FileSize);	/* Size */
    010D4 E188      LDI	R24,0x18
    010D5 E090      LDI	R25,0
    010D6 01F5      MOVW	R30,R10
    010D7 8D07      LDD	R16,Z+31
    010D8 2711      CLR	R17
    010D9 2722      CLR	R18
    010DA 2733      CLR	R19
    010DB 938A      ST	-Y,R24
    010DC 940E 48D0 CALL	lsl32
    010DE 0118      MOVW	R2,R16
    010DF 0129      MOVW	R4,R18
    010E0 01F5      MOVW	R30,R10
    010E1 8C66      LDD	R6,Z+30
    010E2 2477      CLR	R7
    010E3 2488      CLR	R8
    010E4 2499      CLR	R9
    010E5 0143      MOVW	R8,R6
    010E6 2466      CLR	R6
    010E7 2477      CLR	R7
    010E8 2826      OR	R2,R6
    010E9 2837      OR	R3,R7
    010EA 2848      OR	R4,R8
    010EB 2859      OR	R5,R9
    010EC 8C65      LDD	R6,Z+29
    010ED 2477      CLR	R7
    010EE 2C76      MOV	R7,R6
    010EF 2466      CLR	R6
    010F0 2488      CLR	R8
    010F1 2499      CLR	R9
    010F2 2826      OR	R2,R6
    010F3 2837      OR	R3,R7
    010F4 2848      OR	R4,R8
    010F5 2859      OR	R5,R9
    010F6 8C64      LDD	R6,Z+28
    010F7 2477      CLR	R7
    010F8 2488      CLR	R8
    010F9 2499      CLR	R9
    010FA 2826      OR	R2,R6
    010FB 2837      OR	R3,R7
    010FC 2848      OR	R4,R8
    010FD 2859      OR	R5,R9
    010FE 01FB      MOVW	R30,R22
    010FF 8220      ST	Z,R2
    01100 8231      STD	Z+1,R3
    01101 8242      STD	Z+2,R4
    01102 8253      STD	Z+3,R5
(1881) 		fno->fdate = LD_WORD(dir+DIR_WrtDate);		/* Date */
    01103 01F5      MOVW	R30,R10
    01104 8C20      LDD	R2,Z+24
    01105 2433      CLR	R3
    01106 8C41      LDD	R4,Z+25
    01107 2455      CLR	R5
    01108 2C54      MOV	R5,R4
    01109 2444      CLR	R4
    0110A 2842      OR	R4,R2
    0110B 2853      OR	R5,R3
    0110C 01FB      MOVW	R30,R22
    0110D 8255      STD	Z+5,R5
    0110E 8244      STD	Z+4,R4
(1882) 		fno->ftime = LD_WORD(dir+DIR_WrtTime);		/* Time */
    0110F 01F5      MOVW	R30,R10
    01110 8826      LDD	R2,Z+22
    01111 2433      CLR	R3
    01112 8847      LDD	R4,Z+23
    01113 2455      CLR	R5
    01114 2C54      MOV	R5,R4
    01115 2444      CLR	R4
    01116 2842      OR	R4,R2
    01117 2853      OR	R5,R3
    01118 01FB      MOVW	R30,R22
    01119 8257      STD	Z+7,R5
    0111A 8246      STD	Z+6,R4
(1883) 	}
(1884) 	*p = 0;		/* Terminate SFN str by a \0 */
    0111B 2422      CLR	R2
    0111C 01FA      MOVW	R30,R20
    0111D 8220      ST	Z,R2
    0111E 940C 483A JMP	pop_xgsetF0FC
ff.c:follow_path:
  ns                   --> R10
  res                  --> R20
  dir                  --> R10
  path                 --> Y,+6
  dj                   --> R22
    01120 933A      ST	-Y,R19
    01121 932A      ST	-Y,R18
    01122 940E 4864 CALL	push_xgsetF00C
    01124 01B8      MOVW	R22,R16
(1885) 
(1886) #if _USE_LFN
(1887) 	if (fno->lfname && fno->lfsize) {
(1888) 		TCHAR *tp = fno->lfname;
(1889) 		WCHAR w, *lfn;
(1890) 
(1891) 		i = 0;
(1892) 		if (dj->sect && dj->lfn_idx != 0xFFFF) {/* Get LFN if available */
(1893) 			lfn = dj->lfn;
(1894) 			while ((w = *lfn++) != 0) {			/* Get an LFN char */
(1895) #if !_LFN_UNICODE
(1896) 				w = ff_convert(w, 0);			/* Unicode -> OEM conversion */
(1897) 				if (!w) { i = 0; break; }		/* Could not convert, no LFN */
(1898) 				if (_DF1S && w >= 0x100)		/* Put 1st byte if it is a DBC (always false on SBCS cfg) */
(1899) 					tp[i++] = (TCHAR)(w >> 8);
(1900) #endif
(1901) 				if (i >= fno->lfsize - 1) { i = 0; break; }	/* Buffer overflow, no LFN */
(1902) 				tp[i++] = (TCHAR)w;
(1903) 			}
(1904) 		}
(1905) 		tp[i] = 0;	/* Terminate the LFN str by a \0 */
(1906) 	}
(1907) #endif
(1908) }
(1909) #endif /* _FS_MINIMIZE <= 1 */
(1910) 
(1911) 
(1912) 
(1913) 
(1914) /*-----------------------------------------------------------------------*/
(1915) /* Follow a file path                                                    */
(1916) /*-----------------------------------------------------------------------*/
(1917) 
(1918) static
(1919) FRESULT follow_path (	/* FR_OK(0): successful, !=0: error code */
(1920) 	DIR *dj,			/* Directory object to return last directory and found object */
(1921) 	const TCHAR *path	/* Full-path string to find a file or directory */
(1922) )
(1923) {
(1924) 	FRESULT res;
(1925) 	BYTE *dir, ns;
(1926) 
(1927) 
(1928) #if _FS_RPATH
(1929) 	if (*path == '/' || *path == '\\') { /* There is a heading separator */
(1930) 		path++;	dj->sclust = 0;		/* Strip it and start from the root dir */
(1931) 	} else {							/* No heading separator */
(1932) 		dj->sclust = dj->fs->cdir;	/* Start from the current dir */
(1933) 	}
(1934) #else
(1935) 	if (*path == '/' || *path == '\\')	/* Strip heading separator if exist */
    01125 81EE      LDD	R30,Y+6
    01126 81FF      LDD	R31,Y+7
    01127 8020      LD	R2,Z
    01128 2433      CLR	R3
    01129 2D82      MOV	R24,R2
    0112A 328F      CPI	R24,0x2F
    0112B F011      BEQ	0x112E
    0112C 358C      CPI	R24,0x5C
    0112D F429      BNE	0x1133
(1936) 		path++;
    0112E 818E      LDD	R24,Y+6
    0112F 819F      LDD	R25,Y+7
    01130 9601      ADIW	R24,1
    01131 839F      STD	Y+7,R25
    01132 838E      STD	Y+6,R24
(1937) 	dj->sclust = 0;						/* Start from the root dir */
    01133 01FB      MOVW	R30,R22
    01134 9636      ADIW	R30,6
    01135 E080      LDI	R24,0
    01136 8380      ST	Z,R24
    01137 8381      STD	Z+1,R24
    01138 8382      STD	Z+2,R24
    01139 8383      STD	Z+3,R24
(1938) #endif
(1939) 
(1940) 	if ((UINT)*path < ' ') {			/* Nul path means the start directory itself */
    0113A 81EE      LDD	R30,Y+6
    0113B 81FF      LDD	R31,Y+7
    0113C 8180      LD	R24,Z
    0113D 2799      CLR	R25
    0113E 3280      CPI	R24,0x20
    0113F E0E0      LDI	R30,0
    01140 079E      CPC	R25,R30
    01141 F458      BCC	0x114D
(1941) 		res = dir_sdi(dj, 0);
    01142 2722      CLR	R18
    01143 2733      CLR	R19
    01144 018B      MOVW	R16,R22
    01145 DA84      RCALL	ff.c:dir_sdi
    01146 2F40      MOV	R20,R16
(1942) 		dj->dir = 0;
    01147 2422      CLR	R2
    01148 2433      CLR	R3
    01149 01FB      MOVW	R30,R22
    0114A 8A33      STD	Z+19,R3
    0114B 8A22      STD	Z+18,R2
(1943) 
(1944) 	} else {							/* Follow path */
    0114C C052      RJMP	0x119F
(1945) 		for (;;) {
(1946) 			res = create_name(dj, &path);	/* Get a segment */
    0114D 019E      MOVW	R18,R28
    0114E 5F2A      SUBI	R18,0xFA
    0114F 4F3F      SBCI	R19,0xFF
    01150 018B      MOVW	R16,R22
    01151 DE23      RCALL	ff.c:create_name
    01152 2EA0      MOV	R10,R16
    01153 2D4A      MOV	R20,R10
(1947) 			if (res != FR_OK) break;
    01154 2300      TST	R16
    01155 F009      BEQ	0x1157
    01156 C048      RJMP	0x119F
(1948) 			res = dir_find(dj);				/* Find it */
    01157 018B      MOVW	R16,R22
    01158 DD29      RCALL	ff.c:dir_find
    01159 2EA0      MOV	R10,R16
    0115A 2D4A      MOV	R20,R10
(1949) 			ns = *(dj->fn+NS);
    0115B 01FB      MOVW	R30,R22
    0115C 93AF      PUSH	R26
    0115D 93BF      PUSH	R27
    0115E 89A4      LDD	R26,Z+20
    0115F 89B5      LDD	R27,Z+21
    01160 01FD      MOVW	R30,R26
    01161 91BF      POP	R27
    01162 91AF      POP	R26
    01163 84A3      LDD	R10,Z+11
(1950) 			if (res != FR_OK) {				/* Failed to find the object */
    01164 2300      TST	R16
    01165 F049      BEQ	0x116F
(1951) 				if (res != FR_NO_FILE) break;	/* Abort if any hard error occured */
    01166 3004      CPI	R16,4
    01167 F009      BEQ	0x1169
    01168 C036      RJMP	0x119F
(1952) 				/* Object not found */
(1953) 				if (_FS_RPATH && (ns & NS_DOT)) {	/* If dot entry is not exit */
    01169 C001      RJMP	0x116B
(1954) 					dj->sclust = 0; dj->dir = 0;	/* It is the root dir */
(1955) 					res = FR_OK;
(1956) 					if (!(ns & NS_LAST)) continue;
    0116A CFE2      RJMP	0x114D
(1957) 				} else {							/* Could not find the object */
(1958) 					if (!(ns & NS_LAST)) res = FR_NO_PATH;
    0116B FCA2      SBRC	R10,2
    0116C C032      RJMP	0x119F
    0116D E045      LDI	R20,5
(1959) 				}
(1960) 				break;
    0116E C030      RJMP	0x119F
(1961) 			}
(1962) 			if (ns & NS_LAST) break;			/* Last segment match. Function completed. */
    0116F FEA2      SBRS	R10,2
    01170 C001      RJMP	0x1172
    01171 C02D      RJMP	0x119F
(1963) 			dir = dj->dir;						/* There is next segment. Follow the sub directory */
    01172 01FB      MOVW	R30,R22
    01173 88A2      LDD	R10,Z+18
    01174 88B3      LDD	R11,Z+19
(1964) 			if (!(dir[DIR_Attr] & AM_DIR)) {	/* Cannot follow because it is a file */
    01175 01F5      MOVW	R30,R10
    01176 8423      LDD	R2,Z+11
    01177 FC24      SBRC	R2,4
    01178 C002      RJMP	0x117B
(1965) 				res = FR_NO_PATH; break;
    01179 E045      LDI	R20,5
    0117A C024      RJMP	0x119F
(1966) 			}
(1967) 			dj->sclust = LD_CLUST(dir);
    0117B 01F5      MOVW	R30,R10
    0117C 8C22      LDD	R2,Z+26
    0117D 2433      CLR	R3
    0117E 8C43      LDD	R4,Z+27
    0117F 2455      CLR	R5
    01180 2C54      MOV	R5,R4
    01181 2444      CLR	R4
    01182 2842      OR	R4,R2
    01183 2853      OR	R5,R3
    01184 0112      MOVW	R2,R4
    01185 2444      CLR	R4
    01186 2455      CLR	R5
    01187 8864      LDD	R6,Z+20
    01188 2477      CLR	R7
    01189 8885      LDD	R8,Z+21
    0118A 2499      CLR	R9
    0118B 2C98      MOV	R9,R8
    0118C 2488      CLR	R8
    0118D 2886      OR	R8,R6
    0118E 2897      OR	R9,R7
    0118F 0134      MOVW	R6,R8
    01190 2488      CLR	R8
    01191 2499      CLR	R9
    01192 0143      MOVW	R8,R6
    01193 2466      CLR	R6
    01194 2477      CLR	R7
    01195 2862      OR	R6,R2
    01196 2873      OR	R7,R3
    01197 2884      OR	R8,R4
    01198 2895      OR	R9,R5
    01199 01FB      MOVW	R30,R22
    0119A 8266      STD	Z+6,R6
    0119B 8277      STD	Z+7,R7
    0119C 8680      STD	Z+8,R8
    0119D 8691      STD	Z+9,R9
    0119E CFAE      RJMP	0x114D
(1968) 		}
(1969) 	}
(1970) 
(1971) 	return res;
    0119F 2F04      MOV	R16,R20
    011A0 940E 486B CALL	pop_xgsetF00C
    011A2 9622      ADIW	R28,2
    011A3 9508      RET
ff.c:check_fs:
  sect                 --> Y,+11
  fs                   --> R10
    011A4 933A      ST	-Y,R19
    011A5 932A      ST	-Y,R18
    011A6 940E 4864 CALL	push_xgsetF00C
    011A8 0158      MOVW	R10,R16
    011A9 9725      SBIW	R28,5
(1972) }
(1973) 
(1974) 
(1975) 
(1976) 
(1977) /*-----------------------------------------------------------------------*/
(1978) /* Load a sector and check if it is an FAT Volume Boot Record            */
(1979) /*-----------------------------------------------------------------------*/
(1980) 
(1981) static
(1982) BYTE check_fs (	/* 0:FAT-VBR, 1:Valid BR but not FAT, 2:Not a BR, 3:Disk error */
(1983) 	FATFS *fs,	/* File system object */
(1984) 	DWORD sect	/* Sector# (lba) to check if it is an FAT boot record or not */
(1985) )
(1986) {
(1987) 	if (disk_read(fs->drv, fs->win, sect, 1) != RES_OK)	/* Load boot record */
    011AA E081      LDI	R24,1
    011AB 838C      STD	Y+4,R24
    011AC 842B      LDD	R2,Y+11
    011AD 843C      LDD	R3,Y+12
    011AE 844D      LDD	R4,Y+13
    011AF 845E      LDD	R5,Y+14
    011B0 8228      ST	Y,R2
    011B1 8239      STD	Y+1,R3
    011B2 824A      STD	Y+2,R4
    011B3 825B      STD	Y+3,R5
    011B4 0195      MOVW	R18,R10
    011B5 5D22      SUBI	R18,0xD2
    011B6 4F3F      SBCI	R19,0xFF
    011B7 01F5      MOVW	R30,R10
    011B8 8101      LDD	R16,Z+1
    011B9 940E 03B3 CALL	_disk_read
    011BB 2300      TST	R16
    011BC F011      BEQ	0x11BF
(1988) 		return 3;
    011BD E003      LDI	R16,3
    011BE C0A8      RJMP	0x1267
(1989) 	if (LD_WORD(&fs->win[BS_55AA]) != 0xAA55)		/* Check record signature (always placed at offset 510 even if the sector size is >512) */
    011BF 01F5      MOVW	R30,R10
    011C0 5DE4      SUBI	R30,0xD4
    011C1 4FFD      SBCI	R31,0xFD
    011C2 8020      LD	R2,Z
    011C3 52EC      SUBI	R30,0x2C
    011C4 40F2      SBCI	R31,2
    011C5 2433      CLR	R3
    011C6 5DE3      SUBI	R30,0xD3
    011C7 4FFD      SBCI	R31,0xFD
    011C8 8180      LD	R24,Z
    011C9 2799      CLR	R25
    011CA 2F98      MOV	R25,R24
    011CB 2788      CLR	R24
    011CC 2982      OR	R24,R2
    011CD 2993      OR	R25,R3
    011CE 3585      CPI	R24,0x55
    011CF EAEA      LDI	R30,0xAA
    011D0 079E      CPC	R25,R30
    011D1 F011      BEQ	0x11D4
(1990) 		return 2;
    011D2 E002      LDI	R16,2
    011D3 C093      RJMP	0x1267
(1991) 
(1992) 	if ((LD_DWORD(&fs->win[BS_FilSysType]) & 0xFFFFFF) == 0x544146)	/* Check "FAT" string */
    011D4 E188      LDI	R24,0x18
    011D5 E090      LDI	R25,0
    011D6 01F5      MOVW	R30,R10
    011D7 59E9      SUBI	R30,0x99
    011D8 4FFF      SBCI	R31,0xFF
    011D9 8100      LD	R16,Z
    011DA 2711      CLR	R17
    011DB 2722      CLR	R18
    011DC 2733      CLR	R19
    011DD 938A      ST	-Y,R24
    011DE 940E 48D0 CALL	lsl32
    011E0 0118      MOVW	R2,R16
    011E1 0129      MOVW	R4,R18
    011E2 01F5      MOVW	R30,R10
    011E3 59EA      SUBI	R30,0x9A
    011E4 4FFF      SBCI	R31,0xFF
    011E5 8060      LD	R6,Z
    011E6 56E6      SUBI	R30,0x66
    011E7 40F0      SBCI	R31,0
    011E8 2477      CLR	R7
    011E9 2488      CLR	R8
    011EA 2499      CLR	R9
    011EB 0143      MOVW	R8,R6
    011EC 2466      CLR	R6
    011ED 2477      CLR	R7
    011EE 2826      OR	R2,R6
    011EF 2837      OR	R3,R7
    011F0 2848      OR	R4,R8
    011F1 2859      OR	R5,R9
    011F2 59EB      SUBI	R30,0x9B
    011F3 4FFF      SBCI	R31,0xFF
    011F4 8060      LD	R6,Z
    011F5 56E5      SUBI	R30,0x65
    011F6 40F0      SBCI	R31,0
    011F7 2477      CLR	R7
    011F8 2C76      MOV	R7,R6
    011F9 2466      CLR	R6
    011FA 2488      CLR	R8
    011FB 2499      CLR	R9
    011FC 2826      OR	R2,R6
    011FD 2837      OR	R3,R7
    011FE 2848      OR	R4,R8
    011FF 2859      OR	R5,R9
    01200 59EC      SUBI	R30,0x9C
    01201 4FFF      SBCI	R31,0xFF
    01202 8060      LD	R6,Z
    01203 2477      CLR	R7
    01204 2488      CLR	R8
    01205 2499      CLR	R9
    01206 2826      OR	R2,R6
    01207 2837      OR	R3,R7
    01208 2848      OR	R4,R8
    01209 2859      OR	R5,R9
    0120A EF4F      LDI	R20,0xFF
    0120B EF5F      LDI	R21,0xFF
    0120C EF6F      LDI	R22,0xFF
    0120D E070      LDI	R23,0
    0120E 2224      AND	R2,R20
    0120F 2235      AND	R3,R21
    01210 2246      AND	R4,R22
    01211 2257      AND	R5,R23
    01212 E446      LDI	R20,0x46
    01213 E451      LDI	R21,0x41
    01214 E564      LDI	R22,0x54
    01215 E070      LDI	R23,0
    01216 1624      CP	R2,R20
    01217 0635      CPC	R3,R21
    01218 0646      CPC	R4,R22
    01219 0657      CPC	R5,R23
    0121A F411      BNE	0x121D
(1993) 		return 0;
    0121B 2700      CLR	R16
    0121C C04A      RJMP	0x1267
(1994) 	if ((LD_DWORD(&fs->win[BS_FilSysType32]) & 0xFFFFFF) == 0x544146)
    0121D E188      LDI	R24,0x18
    0121E E090      LDI	R25,0
    0121F 01F5      MOVW	R30,R10
    01220 57ED      SUBI	R30,0x7D
    01221 4FFF      SBCI	R31,0xFF
    01222 8100      LD	R16,Z
    01223 2711      CLR	R17
    01224 2722      CLR	R18
    01225 2733      CLR	R19
    01226 938A      ST	-Y,R24
    01227 940E 48D0 CALL	lsl32
    01229 0118      MOVW	R2,R16
    0122A 0129      MOVW	R4,R18
    0122B 01F5      MOVW	R30,R10
    0122C 57EE      SUBI	R30,0x7E
    0122D 4FFF      SBCI	R31,0xFF
    0122E 8060      LD	R6,Z
    0122F 58E2      SUBI	R30,0x82
    01230 40F0      SBCI	R31,0
    01231 2477      CLR	R7
    01232 2488      CLR	R8
    01233 2499      CLR	R9
    01234 0143      MOVW	R8,R6
    01235 2466      CLR	R6
    01236 2477      CLR	R7
    01237 2826      OR	R2,R6
    01238 2837      OR	R3,R7
    01239 2848      OR	R4,R8
    0123A 2859      OR	R5,R9
    0123B 57EF      SUBI	R30,0x7F
    0123C 4FFF      SBCI	R31,0xFF
    0123D 8060      LD	R6,Z
    0123E 58E1      SUBI	R30,0x81
    0123F 40F0      SBCI	R31,0
    01240 2477      CLR	R7
    01241 2C76      MOV	R7,R6
    01242 2466      CLR	R6
    01243 2488      CLR	R8
    01244 2499      CLR	R9
    01245 2826      OR	R2,R6
    01246 2837      OR	R3,R7
    01247 2848      OR	R4,R8
    01248 2859      OR	R5,R9
    01249 58E0      SUBI	R30,0x80
    0124A 4FFF      SBCI	R31,0xFF
    0124B 8060      LD	R6,Z
    0124C 2477      CLR	R7
    0124D 2488      CLR	R8
    0124E 2499      CLR	R9
    0124F 2826      OR	R2,R6
    01250 2837      OR	R3,R7
    01251 2848      OR	R4,R8
    01252 2859      OR	R5,R9
    01253 EF4F      LDI	R20,0xFF
    01254 EF5F      LDI	R21,0xFF
    01255 EF6F      LDI	R22,0xFF
    01256 E070      LDI	R23,0
    01257 2224      AND	R2,R20
    01258 2235      AND	R3,R21
    01259 2246      AND	R4,R22
    0125A 2257      AND	R5,R23
    0125B E446      LDI	R20,0x46
    0125C E451      LDI	R21,0x41
    0125D E564      LDI	R22,0x54
    0125E E070      LDI	R23,0
    0125F 1624      CP	R2,R20
    01260 0635      CPC	R3,R21
    01261 0646      CPC	R4,R22
    01262 0657      CPC	R5,R23
    01263 F411      BNE	0x1266
(1995) 		return 0;
    01264 2700      CLR	R16
    01265 C001      RJMP	0x1267
(1996) 
(1997) 	return 1;
    01266 E001      LDI	R16,1
    01267 9625      ADIW	R28,5
    01268 940E 486B CALL	pop_xgsetF00C
    0126A 9622      ADIW	R28,2
    0126B 9508      RET
ff.c:chk_mounted:
  pi                   --> R10
  szbfat               --> Y,+25
  tbl                  --> R10
  p                    --> R10
  nrsv                 --> R14
  sysect               --> Y,+21
  bsect                --> Y,+17
  stat                 --> R10
  tsect                --> Y,+13
  nclst                --> Y,+9
  vol                  --> R14
  fasize               --> Y,+5
  b                    --> R14
  fmt                  --> R12
  fs                   --> Y,+37
  chk_wp               --> Y,+51
  rfs                  --> Y,+49
  path                 --> R12
    0126C 933A      ST	-Y,R19
    0126D 932A      ST	-Y,R18
    0126E 940E 4845 CALL	push_xgsetF0FC
    01270 0168      MOVW	R12,R16
    01271 97A7      SBIW	R28,0x27
(1998) }
(1999) 
(2000) 
(2001) 
(2002) 
(2003) /*-----------------------------------------------------------------------*/
(2004) /* Check if the file system object is valid or not                       */
(2005) /*-----------------------------------------------------------------------*/
(2006) 
(2007) static
(2008) FRESULT chk_mounted (	/* FR_OK(0): successful, !=0: any error occurred */
(2009) 	const TCHAR **path,	/* Pointer to pointer to the path name (drive number) */
(2010) 	FATFS **rfs,		/* Pointer to pointer to the found file system object */
(2011) 	BYTE chk_wp			/* !=0: Check media write protection for write access */
(2012) )
(2013) {
(2014) 	BYTE fmt, b, pi, *tbl;
(2015) 	UINT vol;
(2016) 	DSTATUS stat;
(2017) 	DWORD bsect, fasize, tsect, sysect, nclst, szbfat;
(2018) 	WORD nrsv;
(2019) 	const TCHAR *p = *path;
    01272 01F6      MOVW	R30,R12
    01273 80A0      LD	R10,Z
    01274 80B1      LDD	R11,Z+1
(2020) 	FATFS *fs;
(2021) 
(2022) 	/* Get logical drive number from the path name */
(2023) 	vol = p[0] - '0';					/* Is there a drive number? */
    01275 01F5      MOVW	R30,R10
    01276 8180      LD	R24,Z
    01277 2799      CLR	R25
    01278 97C0      SBIW	R24,0x30
    01279 017C      MOVW	R14,R24
(2024) 	if (vol <= 9 && p[1] == ':') {		/* Found a drive number, get and strip it */
    0127A E089      LDI	R24,0x9
    0127B E090      LDI	R25,0
    0127C 158E      CP	R24,R14
    0127D 059F      CPC	R25,R15
    0127E F050      BCS	0x1289
    0127F 8181      LDD	R24,Z+1
    01280 338A      CPI	R24,0x3A
    01281 F439      BNE	0x1289
(2025) 		p += 2; *path = p;				/* Return pointer to the path name */
    01282 01CF      MOVW	R24,R30
    01283 9602      ADIW	R24,2
    01284 015C      MOVW	R10,R24
    01285 01F6      MOVW	R30,R12
    01286 82B1      STD	Z+1,R11
    01287 82A0      ST	Z,R10
(2026) 	} else {							/* No drive number is given */
    01288 C002      RJMP	0x128B
(2027) #if _FS_RPATH
(2028) 		vol = CurrVol;					/* Use current drive */
(2029) #else
(2030) 		vol = 0;						/* Use drive 0 */
    01289 24EE      CLR	R14
    0128A 24FF      CLR	R15
(2031) #endif
(2032) 	}
(2033) 
(2034) 	/* Check if the file system object is valid or not */
(2035) 	if (vol >= _VOLUMES) 				/* Is the drive number valid? */
    0128B 01C7      MOVW	R24,R14
    0128C 3081      CPI	R24,1
    0128D E0E0      LDI	R30,0
    0128E 079E      CPC	R25,R30
    0128F F010      BCS	0x1292
(2036) 		return FR_INVALID_DRIVE;
    01290 E00B      LDI	R16,0xB
    01291 C4CF      RJMP	0x1761
(2037) 	*rfs = fs = FatFs[vol];				/* Return pointer to the corresponding file system object */
    01292 E88F      LDI	R24,0x8F
    01293 E095      LDI	R25,5
    01294 01F7      MOVW	R30,R14
    01295 0FEE      LSL	R30
    01296 1FFF      ROL	R31
    01297 0FE8      ADD	R30,R24
    01298 1FF9      ADC	R31,R25
    01299 8020      LD	R2,Z
    0129A 8031      LDD	R3,Z+1
    0129B A23E      STD	Y+38,R3
    0129C A22D      STD	Y+37,R2
    0129D A9E9      LDD	R30,Y+49
    0129E A9FA      LDD	R31,Y+50
    0129F 8231      STD	Z+1,R3
    012A0 8220      ST	Z,R2
(2038) 	if (!fs) return FR_NOT_ENABLED;		/* Is the file system object available? */
    012A1 0101      MOVW	R0,R2
    012A2 2022      TST	R2
    012A3 F421      BNE	0x12A8
    012A4 2033      TST	R3
    012A5 F411      BNE	0x12A8
    012A6 E00C      LDI	R16,0xC
    012A7 C4B9      RJMP	0x1761
(2039) 
(2040) 	ENTER_FF(fs);						/* Lock file system */
(2041) 
(2042) 	if (fs->fs_type) {					/* If the logical drive has been mounted */
    012A8 A1ED      LDD	R30,Y+37
    012A9 A1FE      LDD	R31,Y+38
    012AA 8020      LD	R2,Z
    012AB 2022      TST	R2
    012AC F079      BEQ	0x12BC
(2043) 		stat = disk_status(fs->drv);
    012AD 8101      LDD	R16,Z+1
    012AE 940E 03AD CALL	_disk_status
    012B0 2EA0      MOV	R10,R16
(2044) 		if (!(stat & STA_NOINIT)) {		/* and the physical drive is kept initialized (has not been changed), */
    012B1 FD00      SBRC	R16,0
    012B2 C009      RJMP	0x12BC
(2045) 			if (!_FS_READONLY && chk_wp && (stat & STA_PROTECT))	/* Check write protection if needed */
    012B3 A80B      LDD	R0,Y+51
    012B4 2000      TST	R0
    012B5 F021      BEQ	0x12BA
    012B6 FF02      SBRS	R16,2
    012B7 C002      RJMP	0x12BA
(2046) 				return FR_WRITE_PROTECTED;
    012B8 E00A      LDI	R16,0xA
    012B9 C4A7      RJMP	0x1761
(2047) 			return FR_OK;				/* The file system object is valid */
    012BA 2700      CLR	R16
    012BB C4A5      RJMP	0x1761
(2048) 		}
(2049) 	}
(2050) 
(2051) 	/* The file system object is not valid. */
(2052) 	/* Following code attempts to mount the volume. (analyze BPB and initialize the fs object) */
(2053) 
(2054) 	fs->fs_type = 0;					/* Clear the file system object */
    012BC 2422      CLR	R2
    012BD A1ED      LDD	R30,Y+37
    012BE A1FE      LDD	R31,Y+38
    012BF 8220      ST	Z,R2
(2055) 	fs->drv = LD2PD(vol);				/* Bind the logical drive and a physical drive */
    012C0 82E1      STD	Z+1,R14
(2056) 	stat = disk_initialize(fs->drv);	/* Initialize low level disk I/O layer */
    012C1 8101      LDD	R16,Z+1
    012C2 940E 0397 CALL	_disk_initialize
    012C4 2EE0      MOV	R14,R16
    012C5 2CAE      MOV	R10,R14
(2057) 	if (stat & STA_NOINIT)				/* Check if the initialization succeeded */
    012C6 FF00      SBRS	R16,0
    012C7 C002      RJMP	0x12CA
(2058) 		return FR_NOT_READY;			/* Failed to initialize due to no media or hard error */
    012C8 E003      LDI	R16,3
    012C9 C497      RJMP	0x1761
(2059) 	if (!_FS_READONLY && chk_wp && (stat & STA_PROTECT))	/* Check disk write protection if needed */
    012CA A80B      LDD	R0,Y+51
    012CB 2000      TST	R0
    012CC F021      BEQ	0x12D1
    012CD FEA2      SBRS	R10,2
    012CE C002      RJMP	0x12D1
(2060) 		return FR_WRITE_PROTECTED;
    012CF E00A      LDI	R16,0xA
    012D0 C490      RJMP	0x1761
(2061) #if _MAX_SS != 512						/* Get disk sector size (variable sector size cfg only) */
(2062) 	if (disk_ioctl(fs->drv, GET_SECTOR_SIZE, &fs->ssize) != RES_OK)
(2063) 		return FR_DISK_ERR;
(2064) #endif
(2065) 	/* Search FAT partition on the drive. Supports only generic partitionings, FDISK and SFD. */
(2066) 	fmt = check_fs(fs, bsect = 0);		/* Load sector 0 and check if it is an FAT-VBR (in SFD) */
    012D1 E080      LDI	R24,0
    012D2 8B89      STD	Y+17,R24
    012D3 8B8A      STD	Y+18,R24
    012D4 8B8B      STD	Y+19,R24
    012D5 8B8C      STD	Y+20,R24
    012D6 E040      LDI	R20,0
    012D7 E050      LDI	R21,0
    012D8 E060      LDI	R22,0
    012D9 E070      LDI	R23,0
    012DA 8368      ST	Y,R22
    012DB 8379      STD	Y+1,R23
    012DC 019A      MOVW	R18,R20
    012DD A10D      LDD	R16,Y+37
    012DE A11E      LDD	R17,Y+38
    012DF DEC4      RCALL	ff.c:check_fs
    012E0 2EA0      MOV	R10,R16
    012E1 2CCA      MOV	R12,R10
(2067) 	if (LD2PT(vol) && !fmt) fmt = 1;	/* Force non-SFD if the volume is forced partition */
    012E2 C000      RJMP	0x12E3
(2068) 	if (fmt == 1) {						/* Not an FAT-VBR, the physical drive can be partitioned */
    012E3 2D8C      MOV	R24,R12
    012E4 3081      CPI	R24,1
    012E5 F009      BEQ	0x12E7
    012E6 C04C      RJMP	0x1333
(2069) 		/* Check the partition listed in the partition table */
(2070) 		pi = LD2PT(vol);
    012E7 24AA      CLR	R10
(2071) 		if (pi) pi--;
    012E8 F009      BEQ	0x12EA
    012E9 94AA      DEC	R10
(2072) 		tbl = &fs->win[MBR_Table + pi * SZ_PTE];/* Partition table */
    012EA E100      LDI	R16,0x10
    012EB 2D1A      MOV	R17,R10
    012EC 0301      MULSU	R16,R17
    012ED 0150      MOVW	R10,R0
    012EE A18D      LDD	R24,Y+37
    012EF A19E      LDD	R25,Y+38
    012F0 5184      SUBI	R24,0x14
    012F1 4F9E      SBCI	R25,0xFE
    012F2 0EA8      ADD	R10,R24
    012F3 1EB9      ADC	R11,R25
(2073) 		if (tbl[4]) {						/* Is the partition existing? */
    012F4 01F5      MOVW	R30,R10
    012F5 8024      LDD	R2,Z+4
    012F6 2022      TST	R2
    012F7 F409      BNE	0x12F9
    012F8 C03A      RJMP	0x1333
(2074) 			bsect = LD_DWORD(&tbl[8]);		/* Partition offset in LBA */
    012F9 E188      LDI	R24,0x18
    012FA E090      LDI	R25,0
    012FB 8503      LDD	R16,Z+11
    012FC 2711      CLR	R17
    012FD 2722      CLR	R18
    012FE 2733      CLR	R19
    012FF 938A      ST	-Y,R24
    01300 940E 48D0 CALL	lsl32
    01302 0118      MOVW	R2,R16
    01303 0129      MOVW	R4,R18
    01304 01F5      MOVW	R30,R10
    01305 8462      LDD	R6,Z+10
    01306 2477      CLR	R7
    01307 2488      CLR	R8
    01308 2499      CLR	R9
    01309 0143      MOVW	R8,R6
    0130A 2466      CLR	R6
    0130B 2477      CLR	R7
    0130C 2826      OR	R2,R6
    0130D 2837      OR	R3,R7
    0130E 2848      OR	R4,R8
    0130F 2859      OR	R5,R9
    01310 8461      LDD	R6,Z+9
    01311 2477      CLR	R7
    01312 2C76      MOV	R7,R6
    01313 2466      CLR	R6
    01314 2488      CLR	R8
    01315 2499      CLR	R9
    01316 2826      OR	R2,R6
    01317 2837      OR	R3,R7
    01318 2848      OR	R4,R8
    01319 2859      OR	R5,R9
    0131A 9638      ADIW	R30,0x8
    0131B 8060      LD	R6,Z
    0131C 2477      CLR	R7
    0131D 2488      CLR	R8
    0131E 2499      CLR	R9
    0131F 2826      OR	R2,R6
    01320 2837      OR	R3,R7
    01321 2848      OR	R4,R8
    01322 2859      OR	R5,R9
    01323 8A29      STD	Y+17,R2
    01324 8A3A      STD	Y+18,R3
    01325 8A4B      STD	Y+19,R4
    01326 8A5C      STD	Y+20,R5
(2075) 			fmt = check_fs(fs, bsect);		/* Check the partition */
    01327 8829      LDD	R2,Y+17
    01328 883A      LDD	R3,Y+18
    01329 884B      LDD	R4,Y+19
    0132A 885C      LDD	R5,Y+20
    0132B 8248      ST	Y,R4
    0132C 8259      STD	Y+1,R5
    0132D 0191      MOVW	R18,R2
    0132E A10D      LDD	R16,Y+37
    0132F A11E      LDD	R17,Y+38
    01330 DE73      RCALL	ff.c:check_fs
    01331 2EA0      MOV	R10,R16
    01332 2CCA      MOV	R12,R10
(2076) 		}
(2077) 	}
(2078) 	if (fmt == 3) return FR_DISK_ERR;
    01333 2D8C      MOV	R24,R12
    01334 3083      CPI	R24,3
    01335 F411      BNE	0x1338
    01336 E001      LDI	R16,1
    01337 C429      RJMP	0x1761
(2079) 	if (fmt) return FR_NO_FILESYSTEM;		/* No FAT volume is found */
    01338 20CC      TST	R12
    01339 F011      BEQ	0x133C
    0133A E00D      LDI	R16,0xD
    0133B C425      RJMP	0x1761
(2080) 
(2081) 	/* An FAT volume is found. Following code initializes the file system object */
(2082) 
(2083) 	if (LD_WORD(fs->win+BPB_BytsPerSec) != SS(fs))		/* (BPB_BytsPerSec must be equal to the physical sector size) */
    0133C A1ED      LDD	R30,Y+37
    0133D A1FE      LDD	R31,Y+38
    0133E AC21      LDD	R2,Z+57
    0133F 2433      CLR	R3
    01340 AD82      LDD	R24,Z+58
    01341 2799      CLR	R25
    01342 2F98      MOV	R25,R24
    01343 2788      CLR	R24
    01344 2982      OR	R24,R2
    01345 2993      OR	R25,R3
    01346 3080      CPI	R24,0
    01347 E0E2      LDI	R30,2
    01348 079E      CPC	R25,R30
    01349 F011      BEQ	0x134C
(2084) 		return FR_NO_FILESYSTEM;
    0134A E00D      LDI	R16,0xD
    0134B C415      RJMP	0x1761
(2085) 
(2086) 	fasize = LD_WORD(fs->win+BPB_FATSz16);				/* Number of sectors per FAT */
    0134C A1ED      LDD	R30,Y+37
    0134D A1FE      LDD	R31,Y+38
    0134E 5BEC      SUBI	R30,0xBC
    0134F 4FFF      SBCI	R31,0xFF
    01350 8020      LD	R2,Z
    01351 54E4      SUBI	R30,0x44
    01352 40F0      SBCI	R31,0
    01353 2433      CLR	R3
    01354 5BEB      SUBI	R30,0xBB
    01355 4FFF      SBCI	R31,0xFF
    01356 8040      LD	R4,Z
    01357 2455      CLR	R5
    01358 2C54      MOV	R5,R4
    01359 2444      CLR	R4
    0135A 2842      OR	R4,R2
    0135B 2853      OR	R5,R3
    0135C 0112      MOVW	R2,R4
    0135D 2444      CLR	R4
    0135E 2455      CLR	R5
    0135F 822D      STD	Y+5,R2
    01360 823E      STD	Y+6,R3
    01361 824F      STD	Y+7,R4
    01362 8658      STD	Y+8,R5
(2087) 	if (!fasize) fasize = LD_DWORD(fs->win+BPB_FATSz32);
    01363 802D      LDD	R2,Y+5
    01364 803E      LDD	R3,Y+6
    01365 804F      LDD	R4,Y+7
    01366 8458      LDD	R5,Y+8
    01367 9488      BCLR	0
    01368 2022      TST	R2
    01369 0432      CPC	R3,R2
    0136A 0442      CPC	R4,R2
    0136B 0452      CPC	R5,R2
    0136C F009      BEQ	0x136E
    0136D C03C      RJMP	0x13AA
    0136E E188      LDI	R24,0x18
    0136F E090      LDI	R25,0
    01370 A1ED      LDD	R30,Y+37
    01371 A1FE      LDD	R31,Y+38
    01372 5AEB      SUBI	R30,0xAB
    01373 4FFF      SBCI	R31,0xFF
    01374 8100      LD	R16,Z
    01375 2711      CLR	R17
    01376 2722      CLR	R18
    01377 2733      CLR	R19
    01378 938A      ST	-Y,R24
    01379 940E 48D0 CALL	lsl32
    0137B 0118      MOVW	R2,R16
    0137C 0129      MOVW	R4,R18
    0137D A1ED      LDD	R30,Y+37
    0137E A1FE      LDD	R31,Y+38
    0137F 5AEC      SUBI	R30,0xAC
    01380 4FFF      SBCI	R31,0xFF
    01381 8060      LD	R6,Z
    01382 55E4      SUBI	R30,0x54
    01383 40F0      SBCI	R31,0
    01384 2477      CLR	R7
    01385 2488      CLR	R8
    01386 2499      CLR	R9
    01387 0143      MOVW	R8,R6
    01388 2466      CLR	R6
    01389 2477      CLR	R7
    0138A 2826      OR	R2,R6
    0138B 2837      OR	R3,R7
    0138C 2848      OR	R4,R8
    0138D 2859      OR	R5,R9
    0138E 5AED      SUBI	R30,0xAD
    0138F 4FFF      SBCI	R31,0xFF
    01390 8060      LD	R6,Z
    01391 55E3      SUBI	R30,0x53
    01392 40F0      SBCI	R31,0
    01393 2477      CLR	R7
    01394 2C76      MOV	R7,R6
    01395 2466      CLR	R6
    01396 2488      CLR	R8
    01397 2499      CLR	R9
    01398 2826      OR	R2,R6
    01399 2837      OR	R3,R7
    0139A 2848      OR	R4,R8
    0139B 2859      OR	R5,R9
    0139C 5AEE      SUBI	R30,0xAE
    0139D 4FFF      SBCI	R31,0xFF
    0139E 8060      LD	R6,Z
    0139F 2477      CLR	R7
    013A0 2488      CLR	R8
    013A1 2499      CLR	R9
    013A2 2826      OR	R2,R6
    013A3 2837      OR	R3,R7
    013A4 2848      OR	R4,R8
    013A5 2859      OR	R5,R9
    013A6 822D      STD	Y+5,R2
    013A7 823E      STD	Y+6,R3
    013A8 824F      STD	Y+7,R4
    013A9 8658      STD	Y+8,R5
(2088) 	fs->fsize = fasize;
    013AA 802D      LDD	R2,Y+5
    013AB 803E      LDD	R3,Y+6
    013AC 804F      LDD	R4,Y+7
    013AD 8458      LDD	R5,Y+8
    013AE A1ED      LDD	R30,Y+37
    013AF A1FE      LDD	R31,Y+38
    013B0 8E22      STD	Z+26,R2
    013B1 8E33      STD	Z+27,R3
    013B2 8E44      STD	Z+28,R4
    013B3 8E55      STD	Z+29,R5
(2089) 
(2090) 	fs->n_fats = b = fs->win[BPB_NumFATs];				/* Number of FAT copies */
    013B4 ACA6      LDD	R10,Z+62
    013B5 2CEA      MOV	R14,R10
    013B6 82A3      STD	Z+3,R10
(2091) 	if (b != 1 && b != 2) return FR_NO_FILESYSTEM;		/* (Must be 1 or 2) */
    013B7 2D8E      MOV	R24,R14
    013B8 3081      CPI	R24,1
    013B9 F021      BEQ	0x13BE
    013BA 3082      CPI	R24,2
    013BB F011      BEQ	0x13BE
    013BC E00D      LDI	R16,0xD
    013BD C3A3      RJMP	0x1761
(2092) 	fasize *= b;										/* Number of sectors for FAT area */
    013BE 2C2E      MOV	R2,R14
    013BF 2433      CLR	R3
    013C0 2444      CLR	R4
    013C1 2455      CLR	R5
    013C2 810D      LDD	R16,Y+5
    013C3 811E      LDD	R17,Y+6
    013C4 812F      LDD	R18,Y+7
    013C5 8538      LDD	R19,Y+8
    013C6 925A      ST	-Y,R5
    013C7 924A      ST	-Y,R4
    013C8 923A      ST	-Y,R3
    013C9 922A      ST	-Y,R2
    013CA 940E 47F1 CALL	empy32s|empy32u
    013CC 830D      STD	Y+5,R16
    013CD 831E      STD	Y+6,R17
    013CE 832F      STD	Y+7,R18
    013CF 8738      STD	Y+8,R19
(2093) 
(2094) 	fs->csize = b = fs->win[BPB_SecPerClus];			/* Number of sectors per cluster */
    013D0 A1ED      LDD	R30,Y+37
    013D1 A1FE      LDD	R31,Y+38
    013D2 ACA3      LDD	R10,Z+59
    013D3 2CEA      MOV	R14,R10
    013D4 82A2      STD	Z+2,R10
(2095) 	if (!b || (b & (b - 1))) return FR_NO_FILESYSTEM;	/* (Must be power of 2) */
    013D5 20AA      TST	R10
    013D6 F029      BEQ	0x13DC
    013D7 2D8E      MOV	R24,R14
    013D8 5081      SUBI	R24,1
    013D9 2C2E      MOV	R2,R14
    013DA 2228      AND	R2,R24
    013DB F011      BEQ	0x13DE
    013DC E00D      LDI	R16,0xD
    013DD C383      RJMP	0x1761
(2096) 
(2097) 	fs->n_rootdir = LD_WORD(fs->win+BPB_RootEntCnt);	/* Number of root directory entries */
    013DE A1ED      LDD	R30,Y+37
    013DF A1FE      LDD	R31,Y+38
    013E0 AC27      LDD	R2,Z+63
    013E1 2433      CLR	R3
    013E2 5CE0      SUBI	R30,0xC0
    013E3 4FFF      SBCI	R31,0xFF
    013E4 8040      LD	R4,Z
    013E5 54E0      SUBI	R30,0x40
    013E6 40F0      SBCI	R31,0
    013E7 2455      CLR	R5
    013E8 2C54      MOV	R5,R4
    013E9 2444      CLR	R4
    013EA 2842      OR	R4,R2
    013EB 2853      OR	R5,R3
    013EC 8651      STD	Z+9,R5
    013ED 8640      STD	Z+8,R4
(2098) 	if (fs->n_rootdir % (SS(fs) / SZ_DIR)) return FR_NO_FILESYSTEM;	/* (BPB_RootEntCnt must be sector aligned) */
    013EE 8580      LDD	R24,Z+8
    013EF 8591      LDD	R25,Z+9
    013F0 708F      ANDI	R24,0xF
    013F1 7090      ANDI	R25,0
    013F2 3080      CPI	R24,0
    013F3 0789      CPC	R24,R25
    013F4 F011      BEQ	0x13F7
    013F5 E00D      LDI	R16,0xD
    013F6 C36A      RJMP	0x1761
(2099) 
(2100) 	tsect = LD_WORD(fs->win+BPB_TotSec16);				/* Number of sectors on the volume */
    013F7 A1ED      LDD	R30,Y+37
    013F8 A1FE      LDD	R31,Y+38
    013F9 5BEF      SUBI	R30,0xBF
    013FA 4FFF      SBCI	R31,0xFF
    013FB 8020      LD	R2,Z
    013FC 54E1      SUBI	R30,0x41
    013FD 40F0      SBCI	R31,0
    013FE 2433      CLR	R3
    013FF 5BEE      SUBI	R30,0xBE
    01400 4FFF      SBCI	R31,0xFF
    01401 8040      LD	R4,Z
    01402 2455      CLR	R5
    01403 2C54      MOV	R5,R4
    01404 2444      CLR	R4
    01405 2842      OR	R4,R2
    01406 2853      OR	R5,R3
    01407 0112      MOVW	R2,R4
    01408 2444      CLR	R4
    01409 2455      CLR	R5
    0140A 862D      STD	Y+13,R2
    0140B 863E      STD	Y+14,R3
    0140C 864F      STD	Y+15,R4
    0140D 8A58      STD	Y+16,R5
(2101) 	if (!tsect) tsect = LD_DWORD(fs->win+BPB_TotSec32);
    0140E 842D      LDD	R2,Y+13
    0140F 843E      LDD	R3,Y+14
    01410 844F      LDD	R4,Y+15
    01411 8858      LDD	R5,Y+16
    01412 9488      BCLR	0
    01413 2022      TST	R2
    01414 0432      CPC	R3,R2
    01415 0442      CPC	R4,R2
    01416 0452      CPC	R5,R2
    01417 F009      BEQ	0x1419
    01418 C03C      RJMP	0x1455
    01419 E188      LDI	R24,0x18
    0141A E090      LDI	R25,0
    0141B A1ED      LDD	R30,Y+37
    0141C A1FE      LDD	R31,Y+38
    0141D 5AEF      SUBI	R30,0xAF
    0141E 4FFF      SBCI	R31,0xFF
    0141F 8100      LD	R16,Z
    01420 2711      CLR	R17
    01421 2722      CLR	R18
    01422 2733      CLR	R19
    01423 938A      ST	-Y,R24
    01424 940E 48D0 CALL	lsl32
    01426 0118      MOVW	R2,R16
    01427 0129      MOVW	R4,R18
    01428 A1ED      LDD	R30,Y+37
    01429 A1FE      LDD	R31,Y+38
    0142A 5BE0      SUBI	R30,0xB0
    0142B 4FFF      SBCI	R31,0xFF
    0142C 8060      LD	R6,Z
    0142D 55E0      SUBI	R30,0x50
    0142E 40F0      SBCI	R31,0
    0142F 2477      CLR	R7
    01430 2488      CLR	R8
    01431 2499      CLR	R9
    01432 0143      MOVW	R8,R6
    01433 2466      CLR	R6
    01434 2477      CLR	R7
    01435 2826      OR	R2,R6
    01436 2837      OR	R3,R7
    01437 2848      OR	R4,R8
    01438 2859      OR	R5,R9
    01439 5BE1      SUBI	R30,0xB1
    0143A 4FFF      SBCI	R31,0xFF
    0143B 8060      LD	R6,Z
    0143C 54EF      SUBI	R30,0x4F
    0143D 40F0      SBCI	R31,0
    0143E 2477      CLR	R7
    0143F 2C76      MOV	R7,R6
    01440 2466      CLR	R6
    01441 2488      CLR	R8
    01442 2499      CLR	R9
    01443 2826      OR	R2,R6
    01444 2837      OR	R3,R7
    01445 2848      OR	R4,R8
    01446 2859      OR	R5,R9
    01447 5BE2      SUBI	R30,0xB2
    01448 4FFF      SBCI	R31,0xFF
    01449 8060      LD	R6,Z
    0144A 2477      CLR	R7
    0144B 2488      CLR	R8
    0144C 2499      CLR	R9
    0144D 2826      OR	R2,R6
    0144E 2837      OR	R3,R7
    0144F 2848      OR	R4,R8
    01450 2859      OR	R5,R9
    01451 862D      STD	Y+13,R2
    01452 863E      STD	Y+14,R3
    01453 864F      STD	Y+15,R4
    01454 8A58      STD	Y+16,R5
(2102) 
(2103) 	nrsv = LD_WORD(fs->win+BPB_RsvdSecCnt);				/* Number of reserved sectors */
    01455 A1ED      LDD	R30,Y+37
    01456 A1FE      LDD	R31,Y+38
    01457 AC24      LDD	R2,Z+60
    01458 2433      CLR	R3
    01459 ACE5      LDD	R14,Z+61
    0145A 24FF      CLR	R15
    0145B 2CFE      MOV	R15,R14
    0145C 24EE      CLR	R14
    0145D 28E2      OR	R14,R2
    0145E 28F3      OR	R15,R3
(2104) 	if (!nrsv) return FR_NO_FILESYSTEM;					/* (BPB_RsvdSecCnt must not be 0) */
    0145F 20EE      TST	R14
    01460 F421      BNE	0x1465
    01461 20FF      TST	R15
    01462 F411      BNE	0x1465
    01463 E00D      LDI	R16,0xD
    01464 C2FC      RJMP	0x1761
(2105) 
(2106) 	/* Determine the FAT sub type */
(2107) 	sysect = nrsv + fasize + fs->n_rootdir / (SS(fs) / SZ_DIR);	/* RSV+FAT+DIR */
    01465 802D      LDD	R2,Y+5
    01466 803E      LDD	R3,Y+6
    01467 804F      LDD	R4,Y+7
    01468 8458      LDD	R5,Y+8
    01469 0137      MOVW	R6,R14
    0146A 2488      CLR	R8
    0146B 2499      CLR	R9
    0146C 0C62      ADD	R6,R2
    0146D 1C73      ADC	R7,R3
    0146E 1C84      ADC	R8,R4
    0146F 1C95      ADC	R9,R5
    01470 A1ED      LDD	R30,Y+37
    01471 A1FE      LDD	R31,Y+38
    01472 9638      ADIW	R30,0x8
    01473 8020      LD	R2,Z
    01474 8031      LDD	R3,Z+1
    01475 9436      LSR	R3
    01476 9427      ROR	R2
    01477 9436      LSR	R3
    01478 9427      ROR	R2
    01479 9436      LSR	R3
    0147A 9427      ROR	R2
    0147B 9436      LSR	R3
    0147C 9427      ROR	R2
    0147D 2444      CLR	R4
    0147E 2455      CLR	R5
    0147F 0C62      ADD	R6,R2
    01480 1C73      ADC	R7,R3
    01481 1C84      ADC	R8,R4
    01482 1C95      ADC	R9,R5
    01483 8A6D      STD	Y+21,R6
    01484 8A7E      STD	Y+22,R7
    01485 8A8F      STD	Y+23,R8
    01486 8E98      STD	Y+24,R9
(2108) 	if (tsect < sysect) return FR_NO_FILESYSTEM;		/* (Invalid volume size) */
    01487 882D      LDD	R2,Y+21
    01488 883E      LDD	R3,Y+22
    01489 884F      LDD	R4,Y+23
    0148A 8C58      LDD	R5,Y+24
    0148B 846D      LDD	R6,Y+13
    0148C 847E      LDD	R7,Y+14
    0148D 848F      LDD	R8,Y+15
    0148E 8898      LDD	R9,Y+16
    0148F 1462      CP	R6,R2
    01490 0473      CPC	R7,R3
    01491 0484      CPC	R8,R4
    01492 0495      CPC	R9,R5
    01493 F410      BCC	0x1496
    01494 E00D      LDI	R16,0xD
    01495 C2CB      RJMP	0x1761
(2109) 	nclst = (tsect - sysect) / fs->csize;				/* Number of clusters */
    01496 882D      LDD	R2,Y+21
    01497 883E      LDD	R3,Y+22
    01498 884F      LDD	R4,Y+23
    01499 8C58      LDD	R5,Y+24
    0149A 850D      LDD	R16,Y+13
    0149B 851E      LDD	R17,Y+14
    0149C 852F      LDD	R18,Y+15
    0149D 8938      LDD	R19,Y+16
    0149E 1902      SUB	R16,R2
    0149F 0913      SBC	R17,R3
    014A0 0924      SBC	R18,R4
    014A1 0935      SBC	R19,R5
    014A2 A1ED      LDD	R30,Y+37
    014A3 A1FE      LDD	R31,Y+38
    014A4 9632      ADIW	R30,2
    014A5 8020      LD	R2,Z
    014A6 2433      CLR	R3
    014A7 2444      CLR	R4
    014A8 2455      CLR	R5
    014A9 925A      ST	-Y,R5
    014AA 924A      ST	-Y,R4
    014AB 923A      ST	-Y,R3
    014AC 922A      ST	-Y,R2
    014AD 940E 474B CALL	div32u
    014AF 8709      STD	Y+9,R16
    014B0 871A      STD	Y+10,R17
    014B1 872B      STD	Y+11,R18
    014B2 873C      STD	Y+12,R19
(2110) 	if (!nclst) return FR_NO_FILESYSTEM;				/* (Invalid volume size) */
    014B3 8429      LDD	R2,Y+9
    014B4 843A      LDD	R3,Y+10
    014B5 844B      LDD	R4,Y+11
    014B6 845C      LDD	R5,Y+12
    014B7 9488      BCLR	0
    014B8 2022      TST	R2
    014B9 0432      CPC	R3,R2
    014BA 0442      CPC	R4,R2
    014BB 0452      CPC	R5,R2
    014BC F411      BNE	0x14BF
    014BD E00D      LDI	R16,0xD
    014BE C2A2      RJMP	0x1761
(2111) 	fmt = FS_FAT12;
    014BF 24CC      CLR	R12
    014C0 94C3      INC	R12
(2112) 	if (nclst >= MIN_FAT16) fmt = FS_FAT16;
    014C1 EF46      LDI	R20,0xF6
    014C2 E05F      LDI	R21,0xF
    014C3 E060      LDI	R22,0
    014C4 E070      LDI	R23,0
    014C5 8429      LDD	R2,Y+9
    014C6 843A      LDD	R3,Y+10
    014C7 844B      LDD	R4,Y+11
    014C8 845C      LDD	R5,Y+12
    014C9 1624      CP	R2,R20
    014CA 0635      CPC	R3,R21
    014CB 0646      CPC	R4,R22
    014CC 0657      CPC	R5,R23
    014CD F010      BCS	0x14D0
    014CE E082      LDI	R24,2
    014CF 2EC8      MOV	R12,R24
(2113) 	if (nclst >= MIN_FAT32) fmt = FS_FAT32;
    014D0 EF46      LDI	R20,0xF6
    014D1 EF5F      LDI	R21,0xFF
    014D2 E060      LDI	R22,0
    014D3 E070      LDI	R23,0
    014D4 8429      LDD	R2,Y+9
    014D5 843A      LDD	R3,Y+10
    014D6 844B      LDD	R4,Y+11
    014D7 845C      LDD	R5,Y+12
    014D8 1624      CP	R2,R20
    014D9 0635      CPC	R3,R21
    014DA 0646      CPC	R4,R22
    014DB 0657      CPC	R5,R23
    014DC F010      BCS	0x14DF
    014DD E083      LDI	R24,3
    014DE 2EC8      MOV	R12,R24
(2114) 
(2115) 	/* Boundaries and Limits */
(2116) 	fs->n_fatent = nclst + 2;							/* Number of FAT entries */
    014DF E042      LDI	R20,2
    014E0 E050      LDI	R21,0
    014E1 E060      LDI	R22,0
    014E2 E070      LDI	R23,0
    014E3 8429      LDD	R2,Y+9
    014E4 843A      LDD	R3,Y+10
    014E5 844B      LDD	R4,Y+11
    014E6 845C      LDD	R5,Y+12
    014E7 0E24      ADD	R2,R20
    014E8 1E35      ADC	R3,R21
    014E9 1E46      ADC	R4,R22
    014EA 1E57      ADC	R5,R23
    014EB A1ED      LDD	R30,Y+37
    014EC A1FE      LDD	R31,Y+38
    014ED 9676      ADIW	R30,0x16
    014EE 8220      ST	Z,R2
    014EF 8231      STD	Z+1,R3
    014F0 8242      STD	Z+2,R4
    014F1 8253      STD	Z+3,R5
(2117) 	fs->database = bsect + sysect;						/* Data start sector */
    014F2 882D      LDD	R2,Y+21
    014F3 883E      LDD	R3,Y+22
    014F4 884F      LDD	R4,Y+23
    014F5 8C58      LDD	R5,Y+24
    014F6 8869      LDD	R6,Y+17
    014F7 887A      LDD	R7,Y+18
    014F8 888B      LDD	R8,Y+19
    014F9 889C      LDD	R9,Y+20
    014FA 0C62      ADD	R6,R2
    014FB 1C73      ADC	R7,R3
    014FC 1C84      ADC	R8,R4
    014FD 1C95      ADC	R9,R5
    014FE A1ED      LDD	R30,Y+37
    014FF A1FE      LDD	R31,Y+38
    01500 96B6      ADIW	R30,0x26
    01501 8260      ST	Z,R6
    01502 8271      STD	Z+1,R7
    01503 8282      STD	Z+2,R8
    01504 8293      STD	Z+3,R9
(2118) 	fs->fatbase = bsect + nrsv; 						/* FAT start sector */
    01505 0117      MOVW	R2,R14
    01506 2444      CLR	R4
    01507 2455      CLR	R5
    01508 8869      LDD	R6,Y+17
    01509 887A      LDD	R7,Y+18
    0150A 888B      LDD	R8,Y+19
    0150B 889C      LDD	R9,Y+20
    0150C 0C62      ADD	R6,R2
    0150D 1C73      ADC	R7,R3
    0150E 1C84      ADC	R8,R4
    0150F 1C95      ADC	R9,R5
    01510 A1ED      LDD	R30,Y+37
    01511 A1FE      LDD	R31,Y+38
    01512 8E66      STD	Z+30,R6
    01513 8E77      STD	Z+31,R7
    01514 A280      STD	Z+32,R8
    01515 A291      STD	Z+33,R9
(2119) 	if (fmt == FS_FAT32) {
    01516 2D8C      MOV	R24,R12
    01517 3083      CPI	R24,3
    01518 F009      BEQ	0x151A
    01519 C055      RJMP	0x156F
(2120) 		if (fs->n_rootdir) return FR_NO_FILESYSTEM;		/* (BPB_RootEntCnt must be 0) */
    0151A 8420      LDD	R2,Z+8
    0151B 8431      LDD	R3,Z+9
    0151C 2022      TST	R2
    0151D F411      BNE	0x1520
    0151E 2033      TST	R3
    0151F F011      BEQ	0x1522
    01520 E00D      LDI	R16,0xD
    01521 C23F      RJMP	0x1761
(2121) 		fs->dirbase = LD_DWORD(fs->win+BPB_RootClus);	/* Root directory start cluster */
    01522 E188      LDI	R24,0x18
    01523 E090      LDI	R25,0
    01524 A1ED      LDD	R30,Y+37
    01525 A1FE      LDD	R31,Y+38
    01526 5AE3      SUBI	R30,0xA3
    01527 4FFF      SBCI	R31,0xFF
    01528 8100      LD	R16,Z
    01529 2711      CLR	R17
    0152A 2722      CLR	R18
    0152B 2733      CLR	R19
    0152C 938A      ST	-Y,R24
    0152D 940E 48D0 CALL	lsl32
    0152F 0118      MOVW	R2,R16
    01530 0129      MOVW	R4,R18
    01531 A1ED      LDD	R30,Y+37
    01532 A1FE      LDD	R31,Y+38
    01533 5AE4      SUBI	R30,0xA4
    01534 4FFF      SBCI	R31,0xFF
    01535 8060      LD	R6,Z
    01536 55EC      SUBI	R30,0x5C
    01537 40F0      SBCI	R31,0
    01538 2477      CLR	R7
    01539 2488      CLR	R8
    0153A 2499      CLR	R9
    0153B 0143      MOVW	R8,R6
    0153C 2466      CLR	R6
    0153D 2477      CLR	R7
    0153E 2826      OR	R2,R6
    0153F 2837      OR	R3,R7
    01540 2848      OR	R4,R8
    01541 2859      OR	R5,R9
    01542 5AE5      SUBI	R30,0xA5
    01543 4FFF      SBCI	R31,0xFF
    01544 8060      LD	R6,Z
    01545 55EB      SUBI	R30,0x5B
    01546 40F0      SBCI	R31,0
    01547 2477      CLR	R7
    01548 2C76      MOV	R7,R6
    01549 2466      CLR	R6
    0154A 2488      CLR	R8
    0154B 2499      CLR	R9
    0154C 2826      OR	R2,R6
    0154D 2837      OR	R3,R7
    0154E 2848      OR	R4,R8
    0154F 2859      OR	R5,R9
    01550 5AE6      SUBI	R30,0xA6
    01551 4FFF      SBCI	R31,0xFF
    01552 8060      LD	R6,Z
    01553 55EA      SUBI	R30,0x5A
    01554 40F0      SBCI	R31,0
    01555 2477      CLR	R7
    01556 2488      CLR	R8
    01557 2499      CLR	R9
    01558 2826      OR	R2,R6
    01559 2837      OR	R3,R7
    0155A 2848      OR	R4,R8
    0155B 2859      OR	R5,R9
    0155C A222      STD	Z+34,R2
    0155D A233      STD	Z+35,R3
    0155E A244      STD	Z+36,R4
    0155F A255      STD	Z+37,R5
(2122) 		szbfat = fs->n_fatent * 4;						/* (Required FAT size) */
    01560 E082      LDI	R24,2
    01561 E090      LDI	R25,0
    01562 9676      ADIW	R30,0x16
    01563 8100      LD	R16,Z
    01564 8111      LDD	R17,Z+1
    01565 8122      LDD	R18,Z+2
    01566 8133      LDD	R19,Z+3
    01567 938A      ST	-Y,R24
    01568 940E 48D0 CALL	lsl32
    0156A 8F09      STD	Y+25,R16
    0156B 8F1A      STD	Y+26,R17
    0156C 8F2B      STD	Y+27,R18
    0156D 8F3C      STD	Y+28,R19
(2123) 	} else {
    0156E C06A      RJMP	0x15D9
(2124) 		if (!fs->n_rootdir)	return FR_NO_FILESYSTEM;	/* (BPB_RootEntCnt must not be 0) */
    0156F A1ED      LDD	R30,Y+37
    01570 A1FE      LDD	R31,Y+38
    01571 8420      LDD	R2,Z+8
    01572 8431      LDD	R3,Z+9
    01573 2022      TST	R2
    01574 F421      BNE	0x1579
    01575 2033      TST	R3
    01576 F411      BNE	0x1579
    01577 E00D      LDI	R16,0xD
    01578 C1E8      RJMP	0x1761
(2125) 		fs->dirbase = fs->fatbase + fasize;				/* Root directory start sector */
    01579 802D      LDD	R2,Y+5
    0157A 803E      LDD	R3,Y+6
    0157B 804F      LDD	R4,Y+7
    0157C 8458      LDD	R5,Y+8
    0157D A1ED      LDD	R30,Y+37
    0157E A1FE      LDD	R31,Y+38
    0157F 8C66      LDD	R6,Z+30
    01580 8C77      LDD	R7,Z+31
    01581 A080      LDD	R8,Z+32
    01582 A091      LDD	R9,Z+33
    01583 0C62      ADD	R6,R2
    01584 1C73      ADC	R7,R3
    01585 1C84      ADC	R8,R4
    01586 1C95      ADC	R9,R5
    01587 A262      STD	Z+34,R6
    01588 A273      STD	Z+35,R7
    01589 A284      STD	Z+36,R8
    0158A A295      STD	Z+37,R9
(2126) 		szbfat = (fmt == FS_FAT16) ?					/* (Required FAT size) */
    0158B 2D8C      MOV	R24,R12
    0158C 3082      CPI	R24,2
    0158D F471      BNE	0x159C
    0158E 9676      ADIW	R30,0x16
    0158F 8020      LD	R2,Z
    01590 8031      LDD	R3,Z+1
    01591 8042      LDD	R4,Z+2
    01592 8053      LDD	R5,Z+3
    01593 0C22      LSL	R2
    01594 1C33      ROL	R3
    01595 1C44      ROL	R4
    01596 1C55      ROL	R5
    01597 8E2D      STD	Y+29,R2
    01598 8E3E      STD	Y+30,R3
    01599 8E4F      STD	Y+31,R4
    0159A A258      STD	Y+32,R5
    0159B C035      RJMP	0x15D1
    0159C A1ED      LDD	R30,Y+37
    0159D A1FE      LDD	R31,Y+38
    0159E 9676      ADIW	R30,0x16
    0159F 8020      LD	R2,Z
    015A0 8031      LDD	R3,Z+1
    015A1 8042      LDD	R4,Z+2
    015A2 8053      LDD	R5,Z+3
    015A3 A229      STD	Y+33,R2
    015A4 A23A      STD	Y+34,R3
    015A5 A24B      STD	Y+35,R4
    015A6 A25C      STD	Y+36,R5
    015A7 E041      LDI	R20,1
    015A8 E050      LDI	R21,0
    015A9 E060      LDI	R22,0
    015AA E070      LDI	R23,0
    015AB A029      LDD	R2,Y+33
    015AC A03A      LDD	R3,Y+34
    015AD A04B      LDD	R4,Y+35
    015AE A05C      LDD	R5,Y+36
    015AF 2224      AND	R2,R20
    015B0 2235      AND	R3,R21
    015B1 2246      AND	R4,R22
    015B2 2257      AND	R5,R23
    015B3 A069      LDD	R6,Y+33
    015B4 A07A      LDD	R7,Y+34
    015B5 A08B      LDD	R8,Y+35
    015B6 A09C      LDD	R9,Y+36
    015B7 E043      LDI	R20,3
    015B8 E050      LDI	R21,0
    015B9 E060      LDI	R22,0
    015BA E070      LDI	R23,0
    015BB 929A      ST	-Y,R9
    015BC 928A      ST	-Y,R8
    015BD 927A      ST	-Y,R7
    015BE 926A      ST	-Y,R6
    015BF 018A      MOVW	R16,R20
    015C0 019B      MOVW	R18,R22
    015C1 940E 47F1 CALL	empy32s|empy32u
    015C3 0138      MOVW	R6,R16
    015C4 0149      MOVW	R8,R18
    015C5 9496      LSR	R9
    015C6 9487      ROR	R8
    015C7 9477      ROR	R7
    015C8 9467      ROR	R6
    015C9 0C62      ADD	R6,R2
    015CA 1C73      ADC	R7,R3
    015CB 1C84      ADC	R8,R4
    015CC 1C95      ADC	R9,R5
    015CD 8E6D      STD	Y+29,R6
    015CE 8E7E      STD	Y+30,R7
    015CF 8E8F      STD	Y+31,R8
    015D0 A298      STD	Y+32,R9
    015D1 8C2D      LDD	R2,Y+29
    015D2 8C3E      LDD	R3,Y+30
    015D3 8C4F      LDD	R4,Y+31
    015D4 A058      LDD	R5,Y+32
    015D5 8E29      STD	Y+25,R2
    015D6 8E3A      STD	Y+26,R3
    015D7 8E4B      STD	Y+27,R4
    015D8 8E5C      STD	Y+28,R5
(2127) 			fs->n_fatent * 2 : fs->n_fatent * 3 / 2 + (fs->n_fatent & 1);
(2128) 	}
(2129) 	if (fs->fsize < (szbfat + (SS(fs) - 1)) / SS(fs))	/* (BPB_FATSz must not be less than required) */
    015D9 EF4F      LDI	R20,0xFF
    015DA E051      LDI	R21,1
    015DB E060      LDI	R22,0
    015DC E070      LDI	R23,0
    015DD 8D09      LDD	R16,Y+25
    015DE 8D1A      LDD	R17,Y+26
    015DF 8D2B      LDD	R18,Y+27
    015E0 8D3C      LDD	R19,Y+28
    015E1 0F04      ADD	R16,R20
    015E2 1F15      ADC	R17,R21
    015E3 1F26      ADC	R18,R22
    015E4 1F37      ADC	R19,R23
    015E5 E089      LDI	R24,0x9
    015E6 E090      LDI	R25,0
    015E7 938A      ST	-Y,R24
    015E8 940E 48E9 CALL	lsr32
    015EA A1ED      LDD	R30,Y+37
    015EB A1FE      LDD	R31,Y+38
    015EC 8C22      LDD	R2,Z+26
    015ED 8C33      LDD	R3,Z+27
    015EE 8C44      LDD	R4,Z+28
    015EF 8C55      LDD	R5,Z+29
    015F0 1620      CP	R2,R16
    015F1 0631      CPC	R3,R17
    015F2 0642      CPC	R4,R18
    015F3 0653      CPC	R5,R19
    015F4 F410      BCC	0x15F7
(2130) 		return FR_NO_FILESYSTEM;
    015F5 E00D      LDI	R16,0xD
    015F6 C16A      RJMP	0x1761
(2131) 
(2132) #if !_FS_READONLY
(2133) 	/* Initialize cluster allocation information */
(2134) 	fs->free_clust = 0xFFFFFFFF;
    015F7 A1ED      LDD	R30,Y+37
    015F8 A1FE      LDD	R31,Y+38
    015F9 963E      ADIW	R30,0xE
    015FA EF8F      LDI	R24,0xFF
    015FB 8380      ST	Z,R24
    015FC 8381      STD	Z+1,R24
    015FD 8382      STD	Z+2,R24
    015FE 8383      STD	Z+3,R24
(2135) 	fs->last_clust = 0;
    015FF A1ED      LDD	R30,Y+37
    01600 A1FE      LDD	R31,Y+38
    01601 963A      ADIW	R30,0xA
    01602 E080      LDI	R24,0
    01603 8380      ST	Z,R24
    01604 8381      STD	Z+1,R24
    01605 8382      STD	Z+2,R24
    01606 8383      STD	Z+3,R24
(2136) 
(2137) 	/* Get fsinfo if available */
(2138) 	if (fmt == FS_FAT32) {
    01607 2D8C      MOV	R24,R12
    01608 3083      CPI	R24,3
    01609 F009      BEQ	0x160B
    0160A C13C      RJMP	0x1747
(2139) 	 	fs->fsi_flag = 0;
    0160B 2422      CLR	R2
    0160C A1ED      LDD	R30,Y+37
    0160D A1FE      LDD	R31,Y+38
    0160E 8225      STD	Z+5,R2
(2140) 		fs->fsi_sector = bsect + LD_WORD(fs->win+BPB_FSInfo);
    0160F 5AE2      SUBI	R30,0xA2
    01610 4FFF      SBCI	R31,0xFF
    01611 8020      LD	R2,Z
    01612 55EE      SUBI	R30,0x5E
    01613 40F0      SBCI	R31,0
    01614 2433      CLR	R3
    01615 5AE1      SUBI	R30,0xA1
    01616 4FFF      SBCI	R31,0xFF
    01617 8040      LD	R4,Z
    01618 2455      CLR	R5
    01619 2C54      MOV	R5,R4
    0161A 2444      CLR	R4
    0161B 2842      OR	R4,R2
    0161C 2853      OR	R5,R3
    0161D 0112      MOVW	R2,R4
    0161E 2444      CLR	R4
    0161F 2455      CLR	R5
    01620 8869      LDD	R6,Y+17
    01621 887A      LDD	R7,Y+18
    01622 888B      LDD	R8,Y+19
    01623 889C      LDD	R9,Y+20
    01624 0C62      ADD	R6,R2
    01625 1C73      ADC	R7,R3
    01626 1C84      ADC	R8,R4
    01627 1C95      ADC	R9,R5
    01628 A1ED      LDD	R30,Y+37
    01629 A1FE      LDD	R31,Y+38
    0162A 8A62      STD	Z+18,R6
    0162B 8A73      STD	Z+19,R7
    0162C 8A84      STD	Z+20,R8
    0162D 8A95      STD	Z+21,R9
(2141) 		if (disk_read(fs->drv, fs->win, fs->fsi_sector, 1) == RES_OK &&
    0162E E081      LDI	R24,1
    0162F 838C      STD	Y+4,R24
    01630 8822      LDD	R2,Z+18
    01631 8833      LDD	R3,Z+19
    01632 8844      LDD	R4,Z+20
    01633 8855      LDD	R5,Z+21
    01634 8228      ST	Y,R2
    01635 8239      STD	Y+1,R3
    01636 824A      STD	Y+2,R4
    01637 825B      STD	Y+3,R5
    01638 019F      MOVW	R18,R30
    01639 5D22      SUBI	R18,0xD2
    0163A 4F3F      SBCI	R19,0xFF
    0163B 8101      LDD	R16,Z+1
    0163C 940E 03B3 CALL	_disk_read
    0163E 2EE0      MOV	R14,R16
    0163F 2300      TST	R16
    01640 F009      BEQ	0x1642
    01641 C105      RJMP	0x1747
    01642 A1ED      LDD	R30,Y+37
    01643 A1FE      LDD	R31,Y+38
    01644 5DE4      SUBI	R30,0xD4
    01645 4FFD      SBCI	R31,0xFD
    01646 8020      LD	R2,Z
    01647 52EC      SUBI	R30,0x2C
    01648 40F2      SBCI	R31,2
    01649 2433      CLR	R3
    0164A 5DE3      SUBI	R30,0xD3
    0164B 4FFD      SBCI	R31,0xFD
    0164C 8180      LD	R24,Z
    0164D 52ED      SUBI	R30,0x2D
    0164E 40F2      SBCI	R31,2
    0164F 2799      CLR	R25
    01650 2F98      MOV	R25,R24
    01651 2788      CLR	R24
    01652 2982      OR	R24,R2
    01653 2993      OR	R25,R3
    01654 3585      CPI	R24,0x55
    01655 EAAA      LDI	R26,0xAA
    01656 079A      CPC	R25,R26
    01657 F009      BEQ	0x1659
    01658 C0EE      RJMP	0x1747
    01659 E188      LDI	R24,0x18
    0165A E090      LDI	R25,0
    0165B A901      LDD	R16,Z+49
    0165C 2711      CLR	R17
    0165D 2722      CLR	R18
    0165E 2733      CLR	R19
    0165F 938A      ST	-Y,R24
    01660 940E 48D0 CALL	lsl32
    01662 0118      MOVW	R2,R16
    01663 0129      MOVW	R4,R18
    01664 A1ED      LDD	R30,Y+37
    01665 A1FE      LDD	R31,Y+38
    01666 A860      LDD	R6,Z+48
    01667 2477      CLR	R7
    01668 2488      CLR	R8
    01669 2499      CLR	R9
    0166A 0143      MOVW	R8,R6
    0166B 2466      CLR	R6
    0166C 2477      CLR	R7
    0166D 2826      OR	R2,R6
    0166E 2837      OR	R3,R7
    0166F 2848      OR	R4,R8
    01670 2859      OR	R5,R9
    01671 A467      LDD	R6,Z+47
    01672 2477      CLR	R7
    01673 2C76      MOV	R7,R6
    01674 2466      CLR	R6
    01675 2488      CLR	R8
    01676 2499      CLR	R9
    01677 2826      OR	R2,R6
    01678 2837      OR	R3,R7
    01679 2848      OR	R4,R8
    0167A 2859      OR	R5,R9
    0167B A466      LDD	R6,Z+46
    0167C 2477      CLR	R7
    0167D 2488      CLR	R8
    0167E 2499      CLR	R9
    0167F 2826      OR	R2,R6
    01680 2837      OR	R3,R7
    01681 2848      OR	R4,R8
    01682 2859      OR	R5,R9
    01683 E542      LDI	R20,0x52
    01684 E552      LDI	R21,0x52
    01685 E661      LDI	R22,0x61
    01686 E471      LDI	R23,0x41
    01687 1624      CP	R2,R20
    01688 0635      CPC	R3,R21
    01689 0646      CPC	R4,R22
    0168A 0657      CPC	R5,R23
    0168B F009      BEQ	0x168D
    0168C C0BA      RJMP	0x1747
    0168D E188      LDI	R24,0x18
    0168E E090      LDI	R25,0
    0168F 5EEB      SUBI	R30,0xEB
    01690 4FFD      SBCI	R31,0xFD
    01691 8100      LD	R16,Z
    01692 2711      CLR	R17
    01693 2722      CLR	R18
    01694 2733      CLR	R19
    01695 938A      ST	-Y,R24
    01696 940E 48D0 CALL	lsl32
    01698 0118      MOVW	R2,R16
    01699 0129      MOVW	R4,R18
    0169A A1ED      LDD	R30,Y+37
    0169B A1FE      LDD	R31,Y+38
    0169C 5EEC      SUBI	R30,0xEC
    0169D 4FFD      SBCI	R31,0xFD
    0169E 8060      LD	R6,Z
    0169F 51E4      SUBI	R30,0x14
    016A0 40F2      SBCI	R31,2
    016A1 2477      CLR	R7
    016A2 2488      CLR	R8
    016A3 2499      CLR	R9
    016A4 0143      MOVW	R8,R6
    016A5 2466      CLR	R6
    016A6 2477      CLR	R7
    016A7 2826      OR	R2,R6
    016A8 2837      OR	R3,R7
    016A9 2848      OR	R4,R8
    016AA 2859      OR	R5,R9
    016AB 5EED      SUBI	R30,0xED
    016AC 4FFD      SBCI	R31,0xFD
    016AD 8060      LD	R6,Z
    016AE 51E3      SUBI	R30,0x13
    016AF 40F2      SBCI	R31,2
    016B0 2477      CLR	R7
    016B1 2C76      MOV	R7,R6
    016B2 2466      CLR	R6
    016B3 2488      CLR	R8
    016B4 2499      CLR	R9
    016B5 2826      OR	R2,R6
    016B6 2837      OR	R3,R7
    016B7 2848      OR	R4,R8
    016B8 2859      OR	R5,R9
    016B9 5EEE      SUBI	R30,0xEE
    016BA 4FFD      SBCI	R31,0xFD
    016BB 8060      LD	R6,Z
    016BC 51E2      SUBI	R30,0x12
    016BD 40F2      SBCI	R31,2
    016BE 2477      CLR	R7
    016BF 2488      CLR	R8
    016C0 2499      CLR	R9
    016C1 2826      OR	R2,R6
    016C2 2837      OR	R3,R7
    016C3 2848      OR	R4,R8
    016C4 2859      OR	R5,R9
    016C5 E742      LDI	R20,0x72
    016C6 E752      LDI	R21,0x72
    016C7 E461      LDI	R22,0x41
    016C8 E671      LDI	R23,0x61
    016C9 1624      CP	R2,R20
    016CA 0635      CPC	R3,R21
    016CB 0646      CPC	R4,R22
    016CC 0657      CPC	R5,R23
    016CD F009      BEQ	0x16CF
    016CE C078      RJMP	0x1747
(2142) 			LD_WORD(fs->win+BS_55AA) == 0xAA55 &&
(2143) 			LD_DWORD(fs->win+FSI_LeadSig) == 0x41615252 &&
(2144) 			LD_DWORD(fs->win+FSI_StrucSig) == 0x61417272) {
(2145) 				fs->last_clust = LD_DWORD(fs->win+FSI_Nxt_Free);
    016CF E188      LDI	R24,0x18
    016D0 E090      LDI	R25,0
    016D1 5EE3      SUBI	R30,0xE3
    016D2 4FFD      SBCI	R31,0xFD
    016D3 8100      LD	R16,Z
    016D4 2711      CLR	R17
    016D5 2722      CLR	R18
    016D6 2733      CLR	R19
    016D7 938A      ST	-Y,R24
    016D8 940E 48D0 CALL	lsl32
    016DA 0118      MOVW	R2,R16
    016DB 0129      MOVW	R4,R18
    016DC A1ED      LDD	R30,Y+37
    016DD A1FE      LDD	R31,Y+38
    016DE 5EE4      SUBI	R30,0xE4
    016DF 4FFD      SBCI	R31,0xFD
    016E0 8060      LD	R6,Z
    016E1 51EC      SUBI	R30,0x1C
    016E2 40F2      SBCI	R31,2
    016E3 2477      CLR	R7
    016E4 2488      CLR	R8
    016E5 2499      CLR	R9
    016E6 0143      MOVW	R8,R6
    016E7 2466      CLR	R6
    016E8 2477      CLR	R7
    016E9 2826      OR	R2,R6
    016EA 2837      OR	R3,R7
    016EB 2848      OR	R4,R8
    016EC 2859      OR	R5,R9
    016ED 5EE5      SUBI	R30,0xE5
    016EE 4FFD      SBCI	R31,0xFD
    016EF 8060      LD	R6,Z
    016F0 51EB      SUBI	R30,0x1B
    016F1 40F2      SBCI	R31,2
    016F2 2477      CLR	R7
    016F3 2C76      MOV	R7,R6
    016F4 2466      CLR	R6
    016F5 2488      CLR	R8
    016F6 2499      CLR	R9
    016F7 2826      OR	R2,R6
    016F8 2837      OR	R3,R7
    016F9 2848      OR	R4,R8
    016FA 2859      OR	R5,R9
    016FB 5EE6      SUBI	R30,0xE6
    016FC 4FFD      SBCI	R31,0xFD
    016FD 8060      LD	R6,Z
    016FE 51EA      SUBI	R30,0x1A
    016FF 40F2      SBCI	R31,2
    01700 2477      CLR	R7
    01701 2488      CLR	R8
    01702 2499      CLR	R9
    01703 2826      OR	R2,R6
    01704 2837      OR	R3,R7
    01705 2848      OR	R4,R8
    01706 2859      OR	R5,R9
    01707 8622      STD	Z+10,R2
    01708 8633      STD	Z+11,R3
    01709 8644      STD	Z+12,R4
    0170A 8655      STD	Z+13,R5
(2146) 				fs->free_clust = LD_DWORD(fs->win+FSI_Free_Count);
    0170B E188      LDI	R24,0x18
    0170C E090      LDI	R25,0
    0170D 5EE7      SUBI	R30,0xE7
    0170E 4FFD      SBCI	R31,0xFD
    0170F 8100      LD	R16,Z
    01710 2711      CLR	R17
    01711 2722      CLR	R18
    01712 2733      CLR	R19
    01713 938A      ST	-Y,R24
    01714 940E 48D0 CALL	lsl32
    01716 0118      MOVW	R2,R16
    01717 0129      MOVW	R4,R18
    01718 A1ED      LDD	R30,Y+37
    01719 A1FE      LDD	R31,Y+38
    0171A 5EE8      SUBI	R30,0xE8
    0171B 4FFD      SBCI	R31,0xFD
    0171C 8060      LD	R6,Z
    0171D 51E8      SUBI	R30,0x18
    0171E 40F2      SBCI	R31,2
    0171F 2477      CLR	R7
    01720 2488      CLR	R8
    01721 2499      CLR	R9
    01722 0143      MOVW	R8,R6
    01723 2466      CLR	R6
    01724 2477      CLR	R7
    01725 2826      OR	R2,R6
    01726 2837      OR	R3,R7
    01727 2848      OR	R4,R8
    01728 2859      OR	R5,R9
    01729 5EE9      SUBI	R30,0xE9
    0172A 4FFD      SBCI	R31,0xFD
    0172B 8060      LD	R6,Z
    0172C 51E7      SUBI	R30,0x17
    0172D 40F2      SBCI	R31,2
    0172E 2477      CLR	R7
    0172F 2C76      MOV	R7,R6
    01730 2466      CLR	R6
    01731 2488      CLR	R8
    01732 2499      CLR	R9
    01733 2826      OR	R2,R6
    01734 2837      OR	R3,R7
    01735 2848      OR	R4,R8
    01736 2859      OR	R5,R9
    01737 5EEA      SUBI	R30,0xEA
    01738 4FFD      SBCI	R31,0xFD
    01739 8060      LD	R6,Z
    0173A 51E6      SUBI	R30,0x16
    0173B 40F2      SBCI	R31,2
    0173C 2477      CLR	R7
    0173D 2488      CLR	R8
    0173E 2499      CLR	R9
    0173F 2826      OR	R2,R6
    01740 2837      OR	R3,R7
    01741 2848      OR	R4,R8
    01742 2859      OR	R5,R9
    01743 8626      STD	Z+14,R2
    01744 8637      STD	Z+15,R3
    01745 8A40      STD	Z+16,R4
    01746 8A51      STD	Z+17,R5
(2147) 		}
(2148) 	}
(2149) #endif
(2150) 	fs->fs_type = fmt;		/* FAT sub-type */
    01747 A1ED      LDD	R30,Y+37
    01748 A1FE      LDD	R31,Y+38
    01749 82C0      ST	Z,R12
(2151) 	fs->id = ++Fsid;		/* File system mount ID */
    0174A 9180 058D LDS	R24,ff.c:Fsid
    0174C 9190 058E LDS	R25,ff.c:Fsid+1
    0174E 9601      ADIW	R24,1
    0174F 016C      MOVW	R12,R24
    01750 92D0 058E STS	ff.c:Fsid+1,R13
    01752 92C0 058D STS	ff.c:Fsid,R12
    01754 82D7      STD	Z+7,R13
    01755 82C6      STD	Z+6,R12
(2152) 	fs->winsect = 0;		/* Invalidate sector cache */
    01756 96BA      ADIW	R30,0x2A
    01757 E080      LDI	R24,0
    01758 8380      ST	Z,R24
    01759 8381      STD	Z+1,R24
    0175A 8382      STD	Z+2,R24
    0175B 8383      STD	Z+3,R24
(2153) 	fs->wflag = 0;
    0175C 2422      CLR	R2
    0175D A1ED      LDD	R30,Y+37
    0175E A1FE      LDD	R31,Y+38
    0175F 8224      STD	Z+4,R2
(2154) #if _FS_RPATH
(2155) 	fs->cdir = 0;			/* Current directory (root dir) */
(2156) #endif
(2157) #if _FS_SHARE				/* Clear file lock semaphores */
(2158) 	clear_lock(fs);
(2159) #endif
(2160) 
(2161) 	return FR_OK;
    01760 2700      CLR	R16
    01761 96A7      ADIW	R28,0x27
    01762 940E 483A CALL	pop_xgsetF0FC
    01764 9622      ADIW	R28,2
    01765 9508      RET
ff.c:validate:
  id                   --> R10
  fs                   --> R20
    01766 940E 4850 CALL	push_xgset300C
    01768 0159      MOVW	R10,R18
    01769 01A8      MOVW	R20,R16
(2162) }
(2163) 
(2164) 
(2165) 
(2166) 
(2167) /*-----------------------------------------------------------------------*/
(2168) /* Check if the file/dir object is valid or not                          */
(2169) /*-----------------------------------------------------------------------*/
(2170) 
(2171) static
(2172) FRESULT validate (	/* FR_OK(0): The object is valid, !=0: Invalid */
(2173) 	FATFS *fs,		/* Pointer to the file system object */
(2174) 	WORD id			/* Member id of the target object to be checked */
(2175) )
(2176) {
(2177) 	if (!fs || !fs->fs_type || fs->id != id)
    0176A 3040      CPI	R20,0
    0176B 0745      CPC	R20,R21
    0176C F049      BEQ	0x1776
    0176D 01FA      MOVW	R30,R20
    0176E 8020      LD	R2,Z
    0176F 2022      TST	R2
    01770 F029      BEQ	0x1776
    01771 8026      LDD	R2,Z+6
    01772 8037      LDD	R3,Z+7
    01773 142A      CP	R2,R10
    01774 043B      CPC	R3,R11
    01775 F011      BEQ	0x1778
(2178) 		return FR_INVALID_OBJECT;
    01776 E009      LDI	R16,0x9
    01777 C009      RJMP	0x1781
(2179) 
(2180) 	ENTER_FF(fs);		/* Lock file system */
(2181) 
(2182) 	if (disk_status(fs->drv) & STA_NOINIT)
    01778 01FA      MOVW	R30,R20
    01779 8101      LDD	R16,Z+1
    0177A 940E 03AD CALL	_disk_status
    0177C FF00      SBRS	R16,0
    0177D C002      RJMP	0x1780
(2183) 		return FR_NOT_READY;
    0177E E003      LDI	R16,3
    0177F C001      RJMP	0x1781
(2184) 
(2185) 	return FR_OK;
    01780 2700      CLR	R16
    01781 940C 4855 JMP	pop_xgset300C
_f_mount:
  rfs                  --> R10
  fs                   --> R18
  vol                  --> R16
    01783 92AA      ST	-Y,R10
    01784 92BA      ST	-Y,R11
(2186) }
(2187) 
(2188) 
(2189) 
(2190) 
(2191) /*--------------------------------------------------------------------------
(2192) 
(2193)    Public Functions
(2194) 
(2195) --------------------------------------------------------------------------*/
(2196) 
(2197) 
(2198) 
(2199) /*-----------------------------------------------------------------------*/
(2200) /* Mount/Unmount a Logical Drive                                         */
(2201) /*-----------------------------------------------------------------------*/
(2202) 
(2203) FRESULT f_mount (
(2204) 	BYTE vol,		/* Logical drive number to be mounted/unmounted */
(2205) 	FATFS *fs		/* Pointer to new file system object (NULL for unmount)*/
(2206) )
(2207) {
(2208) 	FATFS *rfs;
(2209) 
(2210) 
(2211) 	if (vol >= _VOLUMES)		/* Check if the drive number is valid */
    01785 3001      CPI	R16,1
    01786 F010      BCS	0x1789
(2212) 		return FR_INVALID_DRIVE;
    01787 E00B      LDI	R16,0xB
    01788 C022      RJMP	0x17AB
(2213) 	rfs = FatFs[vol];			/* Get current fs object */
    01789 E88F      LDI	R24,0x8F
    0178A E095      LDI	R25,5
    0178B 2FE0      MOV	R30,R16
    0178C 27FF      CLR	R31
    0178D 0FEE      LSL	R30
    0178E 1FFF      ROL	R31
    0178F 0FE8      ADD	R30,R24
    01790 1FF9      ADC	R31,R25
    01791 80A0      LD	R10,Z
    01792 80B1      LDD	R11,Z+1
(2214) 
(2215) 	if (rfs) {
    01793 20AA      TST	R10
    01794 F411      BNE	0x1797
    01795 20BB      TST	R11
    01796 F019      BEQ	0x179A
(2216) #if _FS_SHARE
(2217) 		clear_lock(rfs);
(2218) #endif
(2219) #if _FS_REENTRANT				/* Discard sync object of the current volume */
(2220) 		if (!ff_del_syncobj(rfs->sobj)) return FR_INT_ERR;
(2221) #endif
(2222) 		rfs->fs_type = 0;		/* Clear old fs object */
    01797 2422      CLR	R2
    01798 01F5      MOVW	R30,R10
    01799 8220      ST	Z,R2
(2223) 	}
(2224) 
(2225) 	if (fs) {
    0179A 3020      CPI	R18,0
    0179B 0723      CPC	R18,R19
    0179C F019      BEQ	0x17A0
(2226) 		fs->fs_type = 0;		/* Clear new fs object */
    0179D 2422      CLR	R2
    0179E 01F9      MOVW	R30,R18
    0179F 8220      ST	Z,R2
(2227) #if _FS_REENTRANT				/* Create sync object for the new volume */
(2228) 		if (!ff_cre_syncobj(vol, &fs->sobj)) return FR_INT_ERR;
(2229) #endif
(2230) 	}
(2231) 	FatFs[vol] = fs;			/* Register new fs object */
    017A0 E88F      LDI	R24,0x8F
    017A1 E095      LDI	R25,5
    017A2 2FE0      MOV	R30,R16
    017A3 27FF      CLR	R31
    017A4 0FEE      LSL	R30
    017A5 1FFF      ROL	R31
    017A6 0FE8      ADD	R30,R24
    017A7 1FF9      ADC	R31,R25
    017A8 8331      STD	Z+1,R19
    017A9 8320      ST	Z,R18
(2232) 
(2233) 	return FR_OK;
    017AA 2700      CLR	R16
    017AB 90B9      LD	R11,Y+
    017AC 90A9      LD	R10,Y+
    017AD 9508      RET
_f_open:
  cl                   --> Y,+40
  dw                   --> Y,+36
  sfn                  --> Y,+24
  dj                   --> Y,+2
  res                  --> R10
  dir                  --> R14
  mode                 --> Y,+58
  path                 --> Y,+56
  fp                   --> Y,+54
    017AE 940E 4700 CALL	push_arg4
    017B0 940E 4845 CALL	push_xgsetF0FC
    017B2 97AC      SBIW	R28,0x2C
(2234) }
(2235) 
(2236) 
(2237) 
(2238) 
(2239) /*-----------------------------------------------------------------------*/
(2240) /* Open or Create a File                                                 */
(2241) /*-----------------------------------------------------------------------*/
(2242) 
(2243) FRESULT f_open (
(2244) 	FIL *fp,			/* Pointer to the blank file object */
(2245) 	const TCHAR *path,	/* Pointer to the file name */
(2246) 	BYTE mode			/* Access mode and file open mode flags */
(2247) )
(2248) {
(2249) 	FRESULT res;
(2250) 	DIR dj;
(2251) 	BYTE *dir;
(2252) 	DEF_NAMEBUF;
(2253) 
(2254) 
(2255) 	fp->fs = 0;			/* Clear file object */
    017B3 2422      CLR	R2
    017B4 2433      CLR	R3
    017B5 A9EE      LDD	R30,Y+54
    017B6 A9FF      LDD	R31,Y+55
    017B7 8231      STD	Z+1,R3
    017B8 8220      ST	Z,R2
(2256) 
(2257) #if !_FS_READONLY
(2258) 	mode &= FA_READ | FA_WRITE | FA_CREATE_ALWAYS | FA_OPEN_ALWAYS | FA_CREATE_NEW;
    017B9 AD8A      LDD	R24,Y+58
    017BA 718F      ANDI	R24,0x1F
    017BB AF8A      STD	Y+58,R24
(2259) 	res = chk_mounted(&path, &dj.fs, (BYTE)(mode & ~FA_READ));
    017BC 2799      CLR	R25
    017BD 7F8E      ANDI	R24,0xFE
    017BE 8388      ST	Y,R24
    017BF 019E      MOVW	R18,R28
    017C0 5F2E      SUBI	R18,0xFE
    017C1 4F3F      SBCI	R19,0xFF
    017C2 018E      MOVW	R16,R28
    017C3 5C08      SUBI	R16,0xC8
    017C4 4F1F      SBCI	R17,0xFF
    017C5 DAA6      RCALL	ff.c:chk_mounted
    017C6 2EA0      MOV	R10,R16
(2260) #else
(2261) 	mode &= FA_READ;
(2262) 	res = chk_mounted(&path, &dj.fs, 0);
(2263) #endif
(2264) 	INIT_BUF(dj);
    017C7 01CE      MOVW	R24,R28
    017C8 9648      ADIW	R24,0x18
    017C9 8B9F      STD	Y+23,R25
    017CA 8B8E      STD	Y+22,R24
(2265) 	if (res == FR_OK)
    017CB 2300      TST	R16
    017CC F439      BNE	0x17D4
(2266) 		res = follow_path(&dj, path);	/* Follow the file path */
    017CD AD28      LDD	R18,Y+56
    017CE AD39      LDD	R19,Y+57
    017CF 018E      MOVW	R16,R28
    017D0 5F0E      SUBI	R16,0xFE
    017D1 4F1F      SBCI	R17,0xFF
    017D2 D94D      RCALL	ff.c:follow_path
    017D3 2EA0      MOV	R10,R16
(2267) 	dir = dj.dir;
    017D4 88EC      LDD	R14,Y+20
    017D5 88FD      LDD	R15,Y+21
(2268) 
(2269) #if !_FS_READONLY	/* R/W configuration */
(2270) 	if (res == FR_OK) {
    017D6 20AA      TST	R10
    017D7 F431      BNE	0x17DE
(2271) 		if (!dir)	/* Current dir itself */
    017D8 20EE      TST	R14
    017D9 F421      BNE	0x17DE
    017DA 20FF      TST	R15
    017DB F411      BNE	0x17DE
(2272) 			res = FR_INVALID_NAME;
    017DC E086      LDI	R24,6
    017DD 2EA8      MOV	R10,R24
(2273) #if _FS_SHARE
(2274) 		else
(2275) 			res = chk_lock(&dj, (mode & ~FA_READ) ? 1 : 0);
(2276) #endif
(2277) 	}
(2278) 	/* Create or Open a file */
(2279) 	if (mode & (FA_CREATE_ALWAYS | FA_OPEN_ALWAYS | FA_CREATE_NEW)) {
    017DE AD8A      LDD	R24,Y+58
    017DF 718C      ANDI	R24,0x1C
    017E0 F409      BNE	0x17E2
    017E1 C0C0      RJMP	0x18A2
(2280) 		DWORD dw, cl;
(2281) 
(2282) 		if (res != FR_OK) {					/* No file, create new */
    017E2 20AA      TST	R10
    017E3 F081      BEQ	0x17F4
(2283) 			if (res == FR_NO_FILE)			/* There is no file to open, create a new entry */
    017E4 2D8A      MOV	R24,R10
    017E5 3084      CPI	R24,4
    017E6 F439      BNE	0x17EE
(2284) #if _FS_SHARE
(2285) 				res = enq_lock() ? dir_register(&dj) : FR_TOO_MANY_OPEN_FILES;
(2286) #else
(2287) 				res = dir_register(&dj);
    017E7 018E      MOVW	R16,R28
    017E8 5F0E      SUBI	R16,0xFE
    017E9 4F1F      SBCI	R17,0xFF
    017EA 940E 0F12 CALL	ff.c:dir_register
    017EC 2EC0      MOV	R12,R16
    017ED 2CAC      MOV	R10,R12
(2288) #endif
(2289) 			mode |= FA_CREATE_ALWAYS;		/* File is created */
    017EE AD8A      LDD	R24,Y+58
    017EF 6088      ORI	R24,0x8
    017F0 AF8A      STD	Y+58,R24
(2290) 			dir = dj.dir;					/* New entry */
    017F1 88EC      LDD	R14,Y+20
    017F2 88FD      LDD	R15,Y+21
(2291) 		}
    017F3 C00C      RJMP	0x1800
(2292) 		else {								/* Any object is already existing */
(2293) 			if (dir[DIR_Attr] & (AM_RDO | AM_DIR)) {	/* Cannot overwrite it (R/O or DIR) */
    017F4 01F7      MOVW	R30,R14
    017F5 8583      LDD	R24,Z+11
    017F6 7181      ANDI	R24,0x11
    017F7 F019      BEQ	0x17FB
(2294) 				res = FR_DENIED;
    017F8 E087      LDI	R24,7
    017F9 2EA8      MOV	R10,R24
(2295) 			} else {
    017FA C005      RJMP	0x1800
(2296) 				if (mode & FA_CREATE_NEW)	/* Cannot create as new file */
    017FB AC0A      LDD	R0,Y+58
    017FC FE02      SBRS	R0,2
    017FD C002      RJMP	0x1800
(2297) 					res = FR_EXIST;
    017FE E088      LDI	R24,0x8
    017FF 2EA8      MOV	R10,R24
(2298) 			}
(2299) 		}
(2300) 		if (res == FR_OK && (mode & FA_CREATE_ALWAYS)) {	/* Truncate it if overwrite mode */
    01800 20AA      TST	R10
    01801 F009      BEQ	0x1803
    01802 C0B1      RJMP	0x18B4
    01803 AC0A      LDD	R0,Y+58
    01804 FE03      SBRS	R0,3
    01805 C0AE      RJMP	0x18B4
(2301) 			dw = get_fattime();					/* Created time */
    01806 940E 03F0 CALL	_get_fattime
    01808 A30C      STD	Y+36,R16
    01809 A31D      STD	Y+37,R17
    0180A A32E      STD	Y+38,R18
    0180B A33F      STD	Y+39,R19
(2302) 			ST_DWORD(dir+DIR_CrtTime, dw);
    0180C A02C      LDD	R2,Y+36
    0180D A03D      LDD	R3,Y+37
    0180E A04E      LDD	R4,Y+38
    0180F A05F      LDD	R5,Y+39
    01810 01F7      MOVW	R30,R14
    01811 8626      STD	Z+14,R2
    01812 2C23      MOV	R2,R3
    01813 2433      CLR	R3
    01814 963F      ADIW	R30,0xF
    01815 8220      ST	Z,R2
    01816 A02C      LDD	R2,Y+36
    01817 A03D      LDD	R3,Y+37
    01818 A04E      LDD	R4,Y+38
    01819 A05F      LDD	R5,Y+39
    0181A 0112      MOVW	R2,R4
    0181B 2444      CLR	R4
    0181C 2455      CLR	R5
    0181D 01F7      MOVW	R30,R14
    0181E 9670      ADIW	R30,0x10
    0181F 8220      ST	Z,R2
    01820 E188      LDI	R24,0x18
    01821 E090      LDI	R25,0
    01822 A10C      LDD	R16,Y+36
    01823 A11D      LDD	R17,Y+37
    01824 A12E      LDD	R18,Y+38
    01825 A13F      LDD	R19,Y+39
    01826 938A      ST	-Y,R24
    01827 940E 48E9 CALL	lsr32
    01829 01F7      MOVW	R30,R14
    0182A 8B01      STD	Z+17,R16
(2303) 			dir[DIR_Attr] = 0;					/* Reset attribute */
    0182B 2422      CLR	R2
    0182C 8623      STD	Z+11,R2
(2304) 			ST_DWORD(dir+DIR_FileSize, 0);		/* size = 0 */
    0182D 8E24      STD	Z+28,R2
    0182E 8E25      STD	Z+29,R2
    0182F 8E26      STD	Z+30,R2
    01830 8E27      STD	Z+31,R2
(2305) 			cl = LD_CLUST(dir);					/* Get start cluster */
    01831 8C22      LDD	R2,Z+26
    01832 2433      CLR	R3
    01833 8C43      LDD	R4,Z+27
    01834 2455      CLR	R5
    01835 2C54      MOV	R5,R4
    01836 2444      CLR	R4
    01837 2842      OR	R4,R2
    01838 2853      OR	R5,R3
    01839 0112      MOVW	R2,R4
    0183A 2444      CLR	R4
    0183B 2455      CLR	R5
    0183C 8864      LDD	R6,Z+20
    0183D 2477      CLR	R7
    0183E 9675      ADIW	R30,0x15
    0183F 8080      LD	R8,Z
    01840 2499      CLR	R9
    01841 2C98      MOV	R9,R8
    01842 2488      CLR	R8
    01843 2886      OR	R8,R6
    01844 2897      OR	R9,R7
    01845 0134      MOVW	R6,R8
    01846 2488      CLR	R8
    01847 2499      CLR	R9
    01848 0143      MOVW	R8,R6
    01849 2466      CLR	R6
    0184A 2477      CLR	R7
    0184B 2862      OR	R6,R2
    0184C 2873      OR	R7,R3
    0184D 2884      OR	R8,R4
    0184E 2895      OR	R9,R5
    0184F A668      STD	Y+40,R6
    01850 A679      STD	Y+41,R7
    01851 A68A      STD	Y+42,R8
    01852 A69B      STD	Y+43,R9
(2306) 			ST_CLUST(dir, 0);					/* cluster = 0 */
    01853 2422      CLR	R2
    01854 01F7      MOVW	R30,R14
    01855 8E22      STD	Z+26,R2
    01856 8E23      STD	Z+27,R2
    01857 8A24      STD	Z+20,R2
    01858 8A25      STD	Z+21,R2
(2307) 			dj.fs->wflag = 1;
    01859 E081      LDI	R24,1
    0185A 81EA      LDD	R30,Y+2
    0185B 81FB      LDD	R31,Y+3
    0185C 9634      ADIW	R30,4
    0185D 8380      ST	Z,R24
(2308) 			if (cl) {							/* Remove the cluster chain if exist */
    0185E A428      LDD	R2,Y+40
    0185F A439      LDD	R3,Y+41
    01860 A44A      LDD	R4,Y+42
    01861 A45B      LDD	R5,Y+43
    01862 9488      BCLR	0
    01863 2022      TST	R2
    01864 0432      CPC	R3,R2
    01865 0442      CPC	R4,R2
    01866 0452      CPC	R5,R2
    01867 F409      BNE	0x1869
    01868 C04B      RJMP	0x18B4
(2309) 				dw = dj.fs->winsect;
    01869 81EA      LDD	R30,Y+2
    0186A 81FB      LDD	R31,Y+3
    0186B A422      LDD	R2,Z+42
    0186C A433      LDD	R3,Z+43
    0186D A444      LDD	R4,Z+44
    0186E A455      LDD	R5,Z+45
    0186F A22C      STD	Y+36,R2
    01870 A23D      STD	Y+37,R3
    01871 A24E      STD	Y+38,R4
    01872 A25F      STD	Y+39,R5
(2310) 				res = remove_chain(dj.fs, cl);
    01873 A428      LDD	R2,Y+40
    01874 A439      LDD	R3,Y+41
    01875 A44A      LDD	R4,Y+42
    01876 A45B      LDD	R5,Y+43
    01877 8248      ST	Y,R4
    01878 8259      STD	Y+1,R5
    01879 0191      MOVW	R18,R2
    0187A 810A      LDD	R16,Y+2
    0187B 811B      LDD	R17,Y+3
    0187C 940E 0926 CALL	ff.c:remove_chain
    0187E 2EC0      MOV	R12,R16
    0187F 2CAC      MOV	R10,R12
(2311) 				if (res == FR_OK) {
    01880 2300      TST	R16
    01881 F591      BNE	0x18B4
(2312) 					dj.fs->last_clust = cl - 1;	/* Reuse the cluster hole */
    01882 E041      LDI	R20,1
    01883 E050      LDI	R21,0
    01884 E060      LDI	R22,0
    01885 E070      LDI	R23,0
    01886 A428      LDD	R2,Y+40
    01887 A439      LDD	R3,Y+41
    01888 A44A      LDD	R4,Y+42
    01889 A45B      LDD	R5,Y+43
    0188A 1A24      SUB	R2,R20
    0188B 0A35      SBC	R3,R21
    0188C 0A46      SBC	R4,R22
    0188D 0A57      SBC	R5,R23
    0188E 81EA      LDD	R30,Y+2
    0188F 81FB      LDD	R31,Y+3
    01890 8622      STD	Z+10,R2
    01891 8633      STD	Z+11,R3
    01892 8644      STD	Z+12,R4
    01893 8655      STD	Z+13,R5
(2313) 					res = move_window(dj.fs, dw);
    01894 A02C      LDD	R2,Y+36
    01895 A03D      LDD	R3,Y+37
    01896 A04E      LDD	R4,Y+38
    01897 A05F      LDD	R5,Y+39
    01898 8248      ST	Y,R4
    01899 8259      STD	Y+1,R5
    0189A 0191      MOVW	R18,R2
    0189B 810A      LDD	R16,Y+2
    0189C 811B      LDD	R17,Y+3
    0189D 940E 044E CALL	ff.c:move_window
    0189F 2EC0      MOV	R12,R16
    018A0 2CAC      MOV	R10,R12
(2314) 				}
(2315) 			}
(2316) 		}
(2317) 	}
    018A1 C012      RJMP	0x18B4
(2318) 	else {	/* Open an existing file */
(2319) 		if (res == FR_OK) {						/* Follow succeeded */
    018A2 20AA      TST	R10
    018A3 F481      BNE	0x18B4
(2320) 			if (dir[DIR_Attr] & AM_DIR) {		/* It is a directory */
    018A4 01F7      MOVW	R30,R14
    018A5 8423      LDD	R2,Z+11
    018A6 FE24      SBRS	R2,4
    018A7 C003      RJMP	0x18AB
(2321) 				res = FR_NO_FILE;
    018A8 E084      LDI	R24,4
    018A9 2EA8      MOV	R10,R24
(2322) 			} else {
    018AA C009      RJMP	0x18B4
(2323) 				if ((mode & FA_WRITE) && (dir[DIR_Attr] & AM_RDO)) /* R/O violation */
    018AB AC0A      LDD	R0,Y+58
    018AC FE01      SBRS	R0,1
    018AD C006      RJMP	0x18B4
    018AE 01F7      MOVW	R30,R14
    018AF 8423      LDD	R2,Z+11
    018B0 FE20      SBRS	R2,0
    018B1 C002      RJMP	0x18B4
(2324) 					res = FR_DENIED;
    018B2 E087      LDI	R24,7
    018B3 2EA8      MOV	R10,R24
(2325) 			}
(2326) 		}
(2327) 	}
(2328) 	if (res == FR_OK) {
    018B4 20AA      TST	R10
    018B5 F4A1      BNE	0x18CA
(2329) 		if (mode & FA_CREATE_ALWAYS)			/* Set file change flag if created or overwritten */
    018B6 AC0A      LDD	R0,Y+58
    018B7 FE03      SBRS	R0,3
    018B8 C003      RJMP	0x18BC
(2330) 			mode |= FA__WRITTEN;
    018B9 2D80      MOV	R24,R0
    018BA 6280      ORI	R24,0x20
    018BB AF8A      STD	Y+58,R24
(2331) 		fp->dir_sect = dj.fs->winsect;			/* Pointer to the directory entry */
    018BC 81EA      LDD	R30,Y+2
    018BD 81FB      LDD	R31,Y+3
    018BE A422      LDD	R2,Z+42
    018BF A433      LDD	R3,Z+43
    018C0 A444      LDD	R4,Z+44
    018C1 A455      LDD	R5,Z+45
    018C2 A9EE      LDD	R30,Y+54
    018C3 A9FF      LDD	R31,Y+55
    018C4 8E22      STD	Z+26,R2
    018C5 8E33      STD	Z+27,R3
    018C6 8E44      STD	Z+28,R4
    018C7 8E55      STD	Z+29,R5
(2332) 		fp->dir_ptr = dir;
    018C8 8EF7      STD	Z+31,R15
    018C9 8EE6      STD	Z+30,R14
(2333) #if _FS_SHARE
(2334) 		fp->lockid = inc_lock(&dj, (mode & ~FA_READ) ? 1 : 0);
(2335) 		if (!fp->lockid) res = FR_INT_ERR;
(2336) #endif
(2337) 	}
(2338) 
(2339) #else				/* R/O configuration */
(2340) 	if (res == FR_OK) {					/* Follow succeeded */
(2341) 		if (!dir) {						/* Current dir itself */
(2342) 			res = FR_INVALID_NAME;
(2343) 		} else {
(2344) 			if (dir[DIR_Attr] & AM_DIR)	/* It is a directory */
(2345) 				res = FR_NO_FILE;
(2346) 		}
(2347) 	}
(2348) #endif
(2349) 	FREE_BUF();
(2350) 
(2351) 	if (res == FR_OK) {
    018CA 20AA      TST	R10
    018CB F009      BEQ	0x18CD
    018CC C077      RJMP	0x1944
(2352) 		fp->flag = mode;					/* File access mode */
    018CD A9EE      LDD	R30,Y+54
    018CE A9FF      LDD	R31,Y+55
    018CF AC0A      LDD	R0,Y+58
    018D0 8204      STD	Z+4,R0
(2353) 		fp->sclust = LD_CLUST(dir);			/* File start cluster */
    018D1 01F7      MOVW	R30,R14
    018D2 8C22      LDD	R2,Z+26
    018D3 2433      CLR	R3
    018D4 8C43      LDD	R4,Z+27
    018D5 2455      CLR	R5
    018D6 2C54      MOV	R5,R4
    018D7 2444      CLR	R4
    018D8 2842      OR	R4,R2
    018D9 2853      OR	R5,R3
    018DA 0112      MOVW	R2,R4
    018DB 2444      CLR	R4
    018DC 2455      CLR	R5
    018DD 8864      LDD	R6,Z+20
    018DE 2477      CLR	R7
    018DF 8885      LDD	R8,Z+21
    018E0 2499      CLR	R9
    018E1 2C98      MOV	R9,R8
    018E2 2488      CLR	R8
    018E3 2886      OR	R8,R6
    018E4 2897      OR	R9,R7
    018E5 0134      MOVW	R6,R8
    018E6 2488      CLR	R8
    018E7 2499      CLR	R9
    018E8 0143      MOVW	R8,R6
    018E9 2466      CLR	R6
    018EA 2477      CLR	R7
    018EB 2862      OR	R6,R2
    018EC 2873      OR	R7,R3
    018ED 2884      OR	R8,R4
    018EE 2895      OR	R9,R5
    018EF A9EE      LDD	R30,Y+54
    018F0 A9FF      LDD	R31,Y+55
    018F1 8666      STD	Z+14,R6
    018F2 8677      STD	Z+15,R7
    018F3 8A80      STD	Z+16,R8
    018F4 8A91      STD	Z+17,R9
(2354) 		fp->fsize = LD_DWORD(dir+DIR_FileSize);	/* File size */
    018F5 E188      LDI	R24,0x18
    018F6 E090      LDI	R25,0
    018F7 01F7      MOVW	R30,R14
    018F8 8D07      LDD	R16,Z+31
    018F9 2711      CLR	R17
    018FA 2722      CLR	R18
    018FB 2733      CLR	R19
    018FC 938A      ST	-Y,R24
    018FD 940E 48D0 CALL	lsl32
    018FF 0118      MOVW	R2,R16
    01900 0129      MOVW	R4,R18
    01901 01F7      MOVW	R30,R14
    01902 8C66      LDD	R6,Z+30
    01903 2477      CLR	R7
    01904 2488      CLR	R8
    01905 2499      CLR	R9
    01906 0143      MOVW	R8,R6
    01907 2466      CLR	R6
    01908 2477      CLR	R7
    01909 2826      OR	R2,R6
    0190A 2837      OR	R3,R7
    0190B 2848      OR	R4,R8
    0190C 2859      OR	R5,R9
    0190D 8C65      LDD	R6,Z+29
    0190E 2477      CLR	R7
    0190F 2C76      MOV	R7,R6
    01910 2466      CLR	R6
    01911 2488      CLR	R8
    01912 2499      CLR	R9
    01913 2826      OR	R2,R6
    01914 2837      OR	R3,R7
    01915 2848      OR	R4,R8
    01916 2859      OR	R5,R9
    01917 8C64      LDD	R6,Z+28
    01918 2477      CLR	R7
    01919 2488      CLR	R8
    0191A 2499      CLR	R9
    0191B 2826      OR	R2,R6
    0191C 2837      OR	R3,R7
    0191D 2848      OR	R4,R8
    0191E 2859      OR	R5,R9
    0191F A9EE      LDD	R30,Y+54
    01920 A9FF      LDD	R31,Y+55
    01921 8622      STD	Z+10,R2
    01922 8633      STD	Z+11,R3
    01923 8644      STD	Z+12,R4
    01924 8655      STD	Z+13,R5
(2355) 		fp->fptr = 0;						/* File pointer */
    01925 9636      ADIW	R30,6
    01926 E080      LDI	R24,0
    01927 8380      ST	Z,R24
    01928 8381      STD	Z+1,R24
    01929 8382      STD	Z+2,R24
    0192A 8383      STD	Z+3,R24
(2356) 		fp->dsect = 0;
    0192B A9EE      LDD	R30,Y+54
    0192C A9FF      LDD	R31,Y+55
    0192D 9676      ADIW	R30,0x16
    0192E E080      LDI	R24,0
    0192F 8380      ST	Z,R24
    01930 8381      STD	Z+1,R24
    01931 8382      STD	Z+2,R24
    01932 8383      STD	Z+3,R24
(2357) #if _USE_FASTSEEK
(2358) 		fp->cltbl = 0;						/* Normal seek mode */
    01933 2422      CLR	R2
    01934 2433      CLR	R3
    01935 A9EE      LDD	R30,Y+54
    01936 A9FF      LDD	R31,Y+55
    01937 A231      STD	Z+33,R3
    01938 A220      STD	Z+32,R2
(2359) #endif
(2360) 		fp->fs = dj.fs; fp->id = dj.fs->id;	/* Validate file object */
    01939 802A      LDD	R2,Y+2
    0193A 803B      LDD	R3,Y+3
    0193B 8231      STD	Z+1,R3
    0193C 8220      ST	Z,R2
    0193D 01F1      MOVW	R30,R2
    0193E 8026      LDD	R2,Z+6
    0193F 8037      LDD	R3,Z+7
    01940 A9EE      LDD	R30,Y+54
    01941 A9FF      LDD	R31,Y+55
    01942 8233      STD	Z+3,R3
    01943 8222      STD	Z+2,R2
(2361) 	}
(2362) 
(2363) 	LEAVE_FF(dj.fs, res);
    01944 2D0A      MOV	R16,R10
    01945 96AC      ADIW	R28,0x2C
    01946 940E 483A CALL	pop_xgsetF0FC
    01948 9624      ADIW	R28,4
    01949 9508      RET
_f_read:
  remain               --> Y,+13
  res                  --> R10
  clst                 --> Y,+9
  csect                --> R12
  cc                   --> R10
  rbuff                --> R14
  sect                 --> Y,+5
  rcnt                 --> R12
  br                   --> Y,+33
  btr                  --> Y,+31
  buff                 --> R10
  fp                   --> Y,+27
    0194A 940E 4700 CALL	push_arg4
    0194C 940E 4845 CALL	push_xgsetF0FC
    0194E 0159      MOVW	R10,R18
    0194F 9761      SBIW	R28,0x11
(2364) }
(2365) 
(2366) 
(2367) 
(2368) 
(2369) /*-----------------------------------------------------------------------*/
(2370) /* Read File                                                             */
(2371) /*-----------------------------------------------------------------------*/
(2372) 
(2373) FRESULT f_read (
(2374) 	FIL *fp, 		/* Pointer to the file object */
(2375) 	void *buff,		/* Pointer to data buffer */
(2376) 	UINT btr,		/* Number of bytes to read */
(2377) 	UINT *br		/* Pointer to number of bytes read */
(2378) )
(2379) {
(2380) 	FRESULT res;
(2381) 	DWORD clst, sect, remain;
(2382) 	UINT rcnt, cc;
(2383) 	BYTE csect, *rbuff = buff;
    01950 0175      MOVW	R14,R10
(2384) 
(2385) 	memset(buff,0,512);
    01951 E080      LDI	R24,0
    01952 E092      LDI	R25,2
    01953 8399      STD	Y+1,R25
    01954 8388      ST	Y,R24
    01955 2722      CLR	R18
    01956 2733      CLR	R19
    01957 0185      MOVW	R16,R10
    01958 940E 46DC CALL	_memset
(2386) 
(2387) 	*br = 0;	/* Initialize byte counter */
    0195A 2422      CLR	R2
    0195B 2433      CLR	R3
    0195C A1E9      LDD	R30,Y+33
    0195D A1FA      LDD	R31,Y+34
    0195E 8231      STD	Z+1,R3
    0195F 8220      ST	Z,R2
(2388) 
(2389) 	res = validate(fp->fs, fp->id);				/* Check validity */
    01960 8DEB      LDD	R30,Y+27
    01961 8DFC      LDD	R31,Y+28
    01962 8122      LDD	R18,Z+2
    01963 8133      LDD	R19,Z+3
    01964 8100      LD	R16,Z
    01965 8111      LDD	R17,Z+1
    01966 DDFF      RCALL	ff.c:validate
    01967 2EA0      MOV	R10,R16
(2390) 	if (res != FR_OK) LEAVE_FF(fp->fs, res);
    01968 2300      TST	R16
    01969 F009      BEQ	0x196B
    0196A C245      RJMP	0x1BB0
(2391) 	if (fp->flag & FA__ERROR)					/* Aborted file? */
    0196B 8DEB      LDD	R30,Y+27
    0196C 8DFC      LDD	R31,Y+28
    0196D 8024      LDD	R2,Z+4
    0196E FE27      SBRS	R2,7
    0196F C002      RJMP	0x1972
(2392) 		LEAVE_FF(fp->fs, FR_INT_ERR);
    01970 E002      LDI	R16,2
    01971 C23E      RJMP	0x1BB0
(2393) 	if (!(fp->flag & FA_READ)) 					/* Check access mode */
    01972 8DEB      LDD	R30,Y+27
    01973 8DFC      LDD	R31,Y+28
    01974 8024      LDD	R2,Z+4
    01975 FC20      SBRC	R2,0
    01976 C002      RJMP	0x1979
(2394) 		LEAVE_FF(fp->fs, FR_DENIED);
    01977 E007      LDI	R16,7
    01978 C237      RJMP	0x1BB0
(2395) 	remain = fp->fsize - fp->fptr;
    01979 8DEB      LDD	R30,Y+27
    0197A 8DFC      LDD	R31,Y+28
    0197B 8026      LDD	R2,Z+6
    0197C 8037      LDD	R3,Z+7
    0197D 8440      LDD	R4,Z+8
    0197E 8451      LDD	R5,Z+9
    0197F 963A      ADIW	R30,0xA
    01980 8060      LD	R6,Z
    01981 8071      LDD	R7,Z+1
    01982 8082      LDD	R8,Z+2
    01983 8093      LDD	R9,Z+3
    01984 1862      SUB	R6,R2
    01985 0873      SBC	R7,R3
    01986 0884      SBC	R8,R4
    01987 0895      SBC	R9,R5
    01988 866D      STD	Y+13,R6
    01989 867E      STD	Y+14,R7
    0198A 868F      STD	Y+15,R8
    0198B 8A98      STD	Y+16,R9
(2396) 	if (btr > remain) btr = (UINT)remain;		/* Truncate btr by remaining bytes */
    0198C 842D      LDD	R2,Y+13
    0198D 843E      LDD	R3,Y+14
    0198E 844F      LDD	R4,Y+15
    0198F 8858      LDD	R5,Y+16
    01990 8C6F      LDD	R6,Y+31
    01991 A078      LDD	R7,Y+32
    01992 2488      CLR	R8
    01993 2499      CLR	R9
    01994 1426      CP	R2,R6
    01995 0437      CPC	R3,R7
    01996 0448      CPC	R4,R8
    01997 0459      CPC	R5,R9
    01998 F008      BCS	0x199A
    01999 C20D      RJMP	0x1BA7
    0199A A238      STD	Y+32,R3
    0199B 8E2F      STD	Y+31,R2
(2397) 
(2398) 	for ( ;  btr;								/* Repeat until all data read */
    0199C C20A      RJMP	0x1BA7
(2399) 		rbuff += rcnt, fp->fptr += rcnt, *br += rcnt, btr -= rcnt) {
(2400) 		if ((fp->fptr % SS(fp->fs)) == 0) {		/* On the sector boundary? */
    0199D EF4F      LDI	R20,0xFF
    0199E E051      LDI	R21,1
    0199F E060      LDI	R22,0
    019A0 E070      LDI	R23,0
    019A1 8DEB      LDD	R30,Y+27
    019A2 8DFC      LDD	R31,Y+28
    019A3 9636      ADIW	R30,6
    019A4 8020      LD	R2,Z
    019A5 8031      LDD	R3,Z+1
    019A6 8042      LDD	R4,Z+2
    019A7 8053      LDD	R5,Z+3
    019A8 2224      AND	R2,R20
    019A9 2235      AND	R3,R21
    019AA 2246      AND	R4,R22
    019AB 2257      AND	R5,R23
    019AC 9488      BCLR	0
    019AD 2022      TST	R2
    019AE 0432      CPC	R3,R2
    019AF 0442      CPC	R4,R2
    019B0 0452      CPC	R5,R2
    019B1 F009      BEQ	0x19B3
    019B2 C180      RJMP	0x1B33
(2401) 			csect = (BYTE)(fp->fptr / SS(fp->fs) & (fp->fs->csize - 1));	/* Sector offset in the cluster */
    019B3 E089      LDI	R24,0x9
    019B4 E090      LDI	R25,0
    019B5 8DEB      LDD	R30,Y+27
    019B6 8DFC      LDD	R31,Y+28
    019B7 8106      LDD	R16,Z+6
    019B8 8117      LDD	R17,Z+7
    019B9 8520      LDD	R18,Z+8
    019BA 8531      LDD	R19,Z+9
    019BB 938A      ST	-Y,R24
    019BC 940E 48E9 CALL	lsr32
    019BE 0118      MOVW	R2,R16
    019BF 0129      MOVW	R4,R18
    019C0 8DEB      LDD	R30,Y+27
    019C1 8DFC      LDD	R31,Y+28
    019C2 93AF      PUSH	R26
    019C3 93BF      PUSH	R27
    019C4 81A0      LD	R26,Z
    019C5 81B1      LDD	R27,Z+1
    019C6 01FD      MOVW	R30,R26
    019C7 91BF      POP	R27
    019C8 91AF      POP	R26
    019C9 8182      LDD	R24,Z+2
    019CA 2799      CLR	R25
    019CB 9701      SBIW	R24,1
    019CC 013C      MOVW	R6,R24
    019CD 2488      CLR	R8
    019CE FC77      SBRC	R7,7
    019CF 9480      COM	R8
    019D0 2499      CLR	R9
    019D1 FC87      SBRC	R8,7
    019D2 9490      COM	R9
    019D3 2026      AND	R2,R6
    019D4 2037      AND	R3,R7
    019D5 2048      AND	R4,R8
    019D6 2059      AND	R5,R9
    019D7 2CC2      MOV	R12,R2
(2402) 			if (!csect) {						/* On the cluster boundary? */
    019D8 2022      TST	R2
    019D9 F009      BEQ	0x19DB
    019DA C078      RJMP	0x1A53
(2403) 				if (fp->fptr == 0) {			/* On the top of the file? */
    019DB 8DEB      LDD	R30,Y+27
    019DC 8DFC      LDD	R31,Y+28
    019DD 9636      ADIW	R30,6
    019DE 8020      LD	R2,Z
    019DF 8031      LDD	R3,Z+1
    019E0 8042      LDD	R4,Z+2
    019E1 8053      LDD	R5,Z+3
    019E2 9488      BCLR	0
    019E3 2022      TST	R2
    019E4 0432      CPC	R3,R2
    019E5 0442      CPC	R4,R2
    019E6 0452      CPC	R5,R2
    019E7 F461      BNE	0x19F4
(2404) 					clst = fp->sclust;			/* Follow from the origin */
    019E8 8DEB      LDD	R30,Y+27
    019E9 8DFC      LDD	R31,Y+28
    019EA 963E      ADIW	R30,0xE
    019EB 8020      LD	R2,Z
    019EC 8031      LDD	R3,Z+1
    019ED 8042      LDD	R4,Z+2
    019EE 8053      LDD	R5,Z+3
    019EF 8629      STD	Y+9,R2
    019F0 863A      STD	Y+10,R3
    019F1 864B      STD	Y+11,R4
    019F2 865C      STD	Y+12,R5
(2405) 				} else {						/* Middle or end of the file */
    019F3 C028      RJMP	0x1A1C
(2406) #if _USE_FASTSEEK
(2407) 					if (fp->cltbl)
    019F4 8DEB      LDD	R30,Y+27
    019F5 8DFC      LDD	R31,Y+28
    019F6 A020      LDD	R2,Z+32
    019F7 A031      LDD	R3,Z+33
    019F8 2022      TST	R2
    019F9 F411      BNE	0x19FC
    019FA 2033      TST	R3
    019FB F079      BEQ	0x1A0B
(2408) 						clst = clmt_clust(fp, fp->fptr);	/* Get cluster# from the CLMT */
    019FC 8026      LDD	R2,Z+6
    019FD 8037      LDD	R3,Z+7
    019FE 8440      LDD	R4,Z+8
    019FF 8451      LDD	R5,Z+9
    01A00 8248      ST	Y,R4
    01A01 8259      STD	Y+1,R5
    01A02 0191      MOVW	R18,R2
    01A03 018F      MOVW	R16,R30
    01A04 940E 0B51 CALL	ff.c:clmt_clust
    01A06 8709      STD	Y+9,R16
    01A07 871A      STD	Y+10,R17
    01A08 872B      STD	Y+11,R18
    01A09 873C      STD	Y+12,R19
    01A0A C011      RJMP	0x1A1C
(2409) 					else
(2410) #endif
(2411) 						clst = get_fat(fp->fs, fp->clust);	/* Follow cluster chain on the FAT */
    01A0B 8DEB      LDD	R30,Y+27
    01A0C 8DFC      LDD	R31,Y+28
    01A0D 8822      LDD	R2,Z+18
    01A0E 8833      LDD	R3,Z+19
    01A0F 8844      LDD	R4,Z+20
    01A10 8855      LDD	R5,Z+21
    01A11 8248      ST	Y,R4
    01A12 8259      STD	Y+1,R5
    01A13 0191      MOVW	R18,R2
    01A14 8100      LD	R16,Z
    01A15 8111      LDD	R17,Z+1
    01A16 940E 0617 CALL	_get_fat
    01A18 8709      STD	Y+9,R16
    01A19 871A      STD	Y+10,R17
    01A1A 872B      STD	Y+11,R18
    01A1B 873C      STD	Y+12,R19
(2412) 				}
(2413) 				if (clst < 2) ABORT(fp->fs, FR_INT_ERR);
    01A1C E042      LDI	R20,2
    01A1D E050      LDI	R21,0
    01A1E E060      LDI	R22,0
    01A1F E070      LDI	R23,0
    01A20 8429      LDD	R2,Y+9
    01A21 843A      LDD	R3,Y+10
    01A22 844B      LDD	R4,Y+11
    01A23 845C      LDD	R5,Y+12
    01A24 1624      CP	R2,R20
    01A25 0635      CPC	R3,R21
    01A26 0646      CPC	R4,R22
    01A27 0657      CPC	R5,R23
    01A28 F448      BCC	0x1A32
    01A29 8D8B      LDD	R24,Y+27
    01A2A 8D9C      LDD	R25,Y+28
    01A2B 9604      ADIW	R24,4
    01A2C 01FC      MOVW	R30,R24
    01A2D 8180      LD	R24,Z
    01A2E 6880      ORI	R24,0x80
    01A2F 8380      ST	Z,R24
    01A30 E002      LDI	R16,2
    01A31 C17E      RJMP	0x1BB0
(2414) 				if (clst == 0xFFFFFFFF) ABORT(fp->fs, FR_DISK_ERR);
    01A32 EF4F      LDI	R20,0xFF
    01A33 EF5F      LDI	R21,0xFF
    01A34 EF6F      LDI	R22,0xFF
    01A35 EF7F      LDI	R23,0xFF
    01A36 8429      LDD	R2,Y+9
    01A37 843A      LDD	R3,Y+10
    01A38 844B      LDD	R4,Y+11
    01A39 845C      LDD	R5,Y+12
    01A3A 1624      CP	R2,R20
    01A3B 0635      CPC	R3,R21
    01A3C 0646      CPC	R4,R22
    01A3D 0657      CPC	R5,R23
    01A3E F451      BNE	0x1A49
    01A3F 8D8B      LDD	R24,Y+27
    01A40 8D9C      LDD	R25,Y+28
    01A41 9604      ADIW	R24,4
    01A42 015C      MOVW	R10,R24
    01A43 01FC      MOVW	R30,R24
    01A44 8180      LD	R24,Z
    01A45 6880      ORI	R24,0x80
    01A46 8380      ST	Z,R24
    01A47 E001      LDI	R16,1
    01A48 C167      RJMP	0x1BB0
(2415) 				fp->clust = clst;				/* Update current cluster */
    01A49 8429      LDD	R2,Y+9
    01A4A 843A      LDD	R3,Y+10
    01A4B 844B      LDD	R4,Y+11
    01A4C 845C      LDD	R5,Y+12
    01A4D 8DEB      LDD	R30,Y+27
    01A4E 8DFC      LDD	R31,Y+28
    01A4F 8A22      STD	Z+18,R2
    01A50 8A33      STD	Z+19,R3
    01A51 8A44      STD	Z+20,R4
    01A52 8A55      STD	Z+21,R5
(2416) 			}
(2417) 			sect = clust2sect(fp->fs, fp->clust);	/* Get current sector */
    01A53 8DEB      LDD	R30,Y+27
    01A54 8DFC      LDD	R31,Y+28
    01A55 8822      LDD	R2,Z+18
    01A56 8833      LDD	R3,Z+19
    01A57 8844      LDD	R4,Z+20
    01A58 8855      LDD	R5,Z+21
    01A59 8248      ST	Y,R4
    01A5A 8259      STD	Y+1,R5
    01A5B 0191      MOVW	R18,R2
    01A5C 8100      LD	R16,Z
    01A5D 8111      LDD	R17,Z+1
    01A5E 940E 05C5 CALL	_clust2sect
    01A60 830D      STD	Y+5,R16
    01A61 831E      STD	Y+6,R17
    01A62 832F      STD	Y+7,R18
    01A63 8738      STD	Y+8,R19
(2418) 			if (!sect) ABORT(fp->fs, FR_INT_ERR);
    01A64 802D      LDD	R2,Y+5
    01A65 803E      LDD	R3,Y+6
    01A66 804F      LDD	R4,Y+7
    01A67 8458      LDD	R5,Y+8
    01A68 9488      BCLR	0
    01A69 2022      TST	R2
    01A6A 0432      CPC	R3,R2
    01A6B 0442      CPC	R4,R2
    01A6C 0452      CPC	R5,R2
    01A6D F451      BNE	0x1A78
    01A6E 8D8B      LDD	R24,Y+27
    01A6F 8D9C      LDD	R25,Y+28
    01A70 9604      ADIW	R24,4
    01A71 015C      MOVW	R10,R24
    01A72 01FC      MOVW	R30,R24
    01A73 8180      LD	R24,Z
    01A74 6880      ORI	R24,0x80
    01A75 8380      ST	Z,R24
    01A76 E002      LDI	R16,2
    01A77 C138      RJMP	0x1BB0
(2419) 			sect += csect;
    01A78 2C2C      MOV	R2,R12
    01A79 2433      CLR	R3
    01A7A 2444      CLR	R4
    01A7B 2455      CLR	R5
    01A7C 806D      LDD	R6,Y+5
    01A7D 807E      LDD	R7,Y+6
    01A7E 808F      LDD	R8,Y+7
    01A7F 8498      LDD	R9,Y+8
    01A80 0C62      ADD	R6,R2
    01A81 1C73      ADC	R7,R3
    01A82 1C84      ADC	R8,R4
    01A83 1C95      ADC	R9,R5
    01A84 826D      STD	Y+5,R6
    01A85 827E      STD	Y+6,R7
    01A86 828F      STD	Y+7,R8
    01A87 8698      STD	Y+8,R9
(2420) 			cc = btr / SS(fp->fs);				/* When remaining bytes >= sector size, */
    01A88 E029      LDI	R18,0x9
    01A89 E030      LDI	R19,0
    01A8A 8D0F      LDD	R16,Y+31
    01A8B A118      LDD	R17,Y+32
    01A8C 940E 48E2 CALL	lsr16
    01A8E 0158      MOVW	R10,R16
(2421) 			if (cc) {							/* Read maximum contiguous sectors directly */
    01A8F 3000      CPI	R16,0
    01A90 0701      CPC	R16,R17
    01A91 F409      BNE	0x1A93
    01A92 C096      RJMP	0x1B29
(2422) 				if (csect + cc > fp->fs->csize)	/* Clip at cluster boundary */
    01A93 2C2C      MOV	R2,R12
    01A94 2433      CLR	R3
    01A95 0E20      ADD	R2,R16
    01A96 1E31      ADC	R3,R17
    01A97 8DEB      LDD	R30,Y+27
    01A98 8DFC      LDD	R31,Y+28
    01A99 93AF      PUSH	R26
    01A9A 93BF      PUSH	R27
    01A9B 81A0      LD	R26,Z
    01A9C 81B1      LDD	R27,Z+1
    01A9D 01FD      MOVW	R30,R26
    01A9E 91BF      POP	R27
    01A9F 91AF      POP	R26
    01AA0 8042      LDD	R4,Z+2
    01AA1 2455      CLR	R5
    01AA2 1442      CP	R4,R2
    01AA3 0453      CPC	R5,R3
    01AA4 F478      BCC	0x1AB4
(2423) 					cc = fp->fs->csize - csect;
    01AA5 2C2C      MOV	R2,R12
    01AA6 2433      CLR	R3
    01AA7 8DEB      LDD	R30,Y+27
    01AA8 8DFC      LDD	R31,Y+28
    01AA9 93AF      PUSH	R26
    01AAA 93BF      PUSH	R27
    01AAB 81A0      LD	R26,Z
    01AAC 81B1      LDD	R27,Z+1
    01AAD 01FD      MOVW	R30,R26
    01AAE 91BF      POP	R27
    01AAF 91AF      POP	R26
    01AB0 80A2      LDD	R10,Z+2
    01AB1 24BB      CLR	R11
    01AB2 18A2      SUB	R10,R2
    01AB3 08B3      SBC	R11,R3
(2424) 				if (disk_read(fp->fs->drv, rbuff, sect, (BYTE)cc) != RES_OK)
    01AB4 82AC      STD	Y+4,R10
    01AB5 802D      LDD	R2,Y+5
    01AB6 803E      LDD	R3,Y+6
    01AB7 804F      LDD	R4,Y+7
    01AB8 8458      LDD	R5,Y+8
    01AB9 8228      ST	Y,R2
    01ABA 8239      STD	Y+1,R3
    01ABB 824A      STD	Y+2,R4
    01ABC 825B      STD	Y+3,R5
    01ABD 0197      MOVW	R18,R14
    01ABE 8DEB      LDD	R30,Y+27
    01ABF 8DFC      LDD	R31,Y+28
    01AC0 93AF      PUSH	R26
    01AC1 93BF      PUSH	R27
    01AC2 81A0      LD	R26,Z
    01AC3 81B1      LDD	R27,Z+1
    01AC4 01FD      MOVW	R30,R26
    01AC5 91BF      POP	R27
    01AC6 91AF      POP	R26
    01AC7 8101      LDD	R16,Z+1
    01AC8 940E 03B3 CALL	_disk_read
    01ACA 2EC0      MOV	R12,R16
    01ACB 2300      TST	R16
    01ACC F051      BEQ	0x1AD7
(2425) 					ABORT(fp->fs, FR_DISK_ERR);
    01ACD 8D8B      LDD	R24,Y+27
    01ACE 8D9C      LDD	R25,Y+28
    01ACF 9604      ADIW	R24,4
    01AD0 016C      MOVW	R12,R24
    01AD1 01FC      MOVW	R30,R24
    01AD2 8180      LD	R24,Z
    01AD3 6880      ORI	R24,0x80
    01AD4 8380      ST	Z,R24
    01AD5 E001      LDI	R16,1
    01AD6 C0D9      RJMP	0x1BB0
(2426) #if !_FS_READONLY && _FS_MINIMIZE <= 2			/* Replace one of the read sectors with cached data if it contains a dirty sector */
(2427) #if _FS_TINY
(2428) 				if (fp->fs->wflag && fp->fs->winsect - sect < cc)
    01AD7 8DEB      LDD	R30,Y+27
    01AD8 8DFC      LDD	R31,Y+28
    01AD9 80C0      LD	R12,Z
    01ADA 80D1      LDD	R13,Z+1
    01ADB 01F6      MOVW	R30,R12
    01ADC 9634      ADIW	R30,4
    01ADD 8020      LD	R2,Z
    01ADE 2022      TST	R2
    01ADF F409      BNE	0x1AE1
    01AE0 C041      RJMP	0x1B22
    01AE1 802D      LDD	R2,Y+5
    01AE2 803E      LDD	R3,Y+6
    01AE3 804F      LDD	R4,Y+7
    01AE4 8458      LDD	R5,Y+8
    01AE5 01F6      MOVW	R30,R12
    01AE6 A462      LDD	R6,Z+42
    01AE7 A473      LDD	R7,Z+43
    01AE8 A484      LDD	R8,Z+44
    01AE9 A495      LDD	R9,Z+45
    01AEA 1862      SUB	R6,R2
    01AEB 0873      SBC	R7,R3
    01AEC 0884      SBC	R8,R4
    01AED 0895      SBC	R9,R5
    01AEE 0115      MOVW	R2,R10
    01AEF 2444      CLR	R4
    01AF0 2455      CLR	R5
    01AF1 1462      CP	R6,R2
    01AF2 0473      CPC	R7,R3
    01AF3 0484      CPC	R8,R4
    01AF4 0495      CPC	R9,R5
    01AF5 F560      BCC	0x1B22
(2429) 					mem_cpy(rbuff + ((fp->fs->winsect - sect) * SS(fp->fs)), fp->fs->win, SS(fp->fs));
    01AF6 E080      LDI	R24,0
    01AF7 E092      LDI	R25,2
    01AF8 8399      STD	Y+1,R25
    01AF9 8388      ST	Y,R24
    01AFA 8DEB      LDD	R30,Y+27
    01AFB 8DFC      LDD	R31,Y+28
    01AFC 80C0      LD	R12,Z
    01AFD 80D1      LDD	R13,Z+1
    01AFE 0196      MOVW	R18,R12
    01AFF 5D22      SUBI	R18,0xD2
    01B00 4F3F      SBCI	R19,0xFF
    01B01 802D      LDD	R2,Y+5
    01B02 803E      LDD	R3,Y+6
    01B03 804F      LDD	R4,Y+7
    01B04 8458      LDD	R5,Y+8
    01B05 01F6      MOVW	R30,R12
    01B06 A462      LDD	R6,Z+42
    01B07 A473      LDD	R7,Z+43
    01B08 A484      LDD	R8,Z+44
    01B09 A495      LDD	R9,Z+45
    01B0A 1862      SUB	R6,R2
    01B0B 0873      SBC	R7,R3
    01B0C 0884      SBC	R8,R4
    01B0D 0895      SBC	R9,R5
    01B0E E040      LDI	R20,0
    01B0F E052      LDI	R21,2
    01B10 E060      LDI	R22,0
    01B11 E070      LDI	R23,0
    01B12 932F      PUSH	R18
    01B13 933F      PUSH	R19
    01B14 929A      ST	-Y,R9
    01B15 928A      ST	-Y,R8
    01B16 927A      ST	-Y,R7
    01B17 926A      ST	-Y,R6
    01B18 018A      MOVW	R16,R20
    01B19 019B      MOVW	R18,R22
    01B1A 940E 47F1 CALL	empy32s|empy32u
    01B1C 913F      POP	R19
    01B1D 912F      POP	R18
    01B1E 0D0E      ADD	R16,R14
    01B1F 1D1F      ADC	R17,R15
    01B20 940E 03F5 CALL	ff.c:mem_cpy
(2430) #else
(2431) 				if ((fp->flag & FA__DIRTY) && fp->dsect - sect < cc)
(2432) 					mem_cpy(rbuff + ((fp->dsect - sect) * SS(fp->fs)), fp->buf, SS(fp->fs));
(2433) #endif
(2434) #endif
(2435) 				rcnt = SS(fp->fs) * cc;			/* Number of bytes transferred */
    01B22 E000      LDI	R16,0
    01B23 E012      LDI	R17,2
    01B24 0195      MOVW	R18,R10
    01B25 940E 47E1 CALL	empy16s
    01B27 0168      MOVW	R12,R16
(2436) 				continue;
    01B28 C05A      RJMP	0x1B83
(2437) 			}
(2438) #if !_FS_TINY
(2439) 			if (fp->dsect != sect) {			/* Load data sector if not in cache */
(2440) #if !_FS_READONLY
(2441) 				if (fp->flag & FA__DIRTY) {		/* Write-back dirty sector cache */
(2442) 					if (disk_write(fp->fs->drv, fp->buf, fp->dsect, 1) != RES_OK)
(2443) 						ABORT(fp->fs, FR_DISK_ERR);
(2444) 					fp->flag &= ~FA__DIRTY;
(2445) 				}
(2446) #endif
(2447) 				if (disk_read(fp->fs->drv, fp->buf, sect, 1) != RES_OK)	/* Fill sector cache */
(2448) 					ABORT(fp->fs, FR_DISK_ERR);
(2449) 			}
(2450) #endif
(2451) 			fp->dsect = sect;
    01B29 802D      LDD	R2,Y+5
    01B2A 803E      LDD	R3,Y+6
    01B2B 804F      LDD	R4,Y+7
    01B2C 8458      LDD	R5,Y+8
    01B2D 8DEB      LDD	R30,Y+27
    01B2E 8DFC      LDD	R31,Y+28
    01B2F 8A26      STD	Z+22,R2
    01B30 8A37      STD	Z+23,R3
    01B31 8E40      STD	Z+24,R4
    01B32 8E51      STD	Z+25,R5
(2452) 		}
(2453) 		rcnt = SS(fp->fs) - (fp->fptr % SS(fp->fs));	/* Get partial sector data from sector buffer */
    01B33 EF4F      LDI	R20,0xFF
    01B34 E051      LDI	R21,1
    01B35 E060      LDI	R22,0
    01B36 E070      LDI	R23,0
    01B37 8DEB      LDD	R30,Y+27
    01B38 8DFC      LDD	R31,Y+28
    01B39 8026      LDD	R2,Z+6
    01B3A 8037      LDD	R3,Z+7
    01B3B 8440      LDD	R4,Z+8
    01B3C 8451      LDD	R5,Z+9
    01B3D 2224      AND	R2,R20
    01B3E 2235      AND	R3,R21
    01B3F 2246      AND	R4,R22
    01B40 2257      AND	R5,R23
    01B41 E040      LDI	R20,0
    01B42 E052      LDI	R21,2
    01B43 E060      LDI	R22,0
    01B44 E070      LDI	R23,0
    01B45 1942      SUB	R20,R2
    01B46 0953      SBC	R21,R3
    01B47 0964      SBC	R22,R4
    01B48 0975      SBC	R23,R5
    01B49 016A      MOVW	R12,R20
(2454) 		if (rcnt > btr) rcnt = btr;
    01B4A 8C0F      LDD	R0,Y+31
    01B4B A018      LDD	R1,Y+32
    01B4C 1604      CP	R0,R20
    01B4D 0615      CPC	R1,R21
    01B4E F408      BCC	0x1B50
    01B4F 0160      MOVW	R12,R0
(2455) #if _FS_TINY
(2456) 		if (move_window(fp->fs, fp->dsect))		/* Move sector window */
    01B50 8DEB      LDD	R30,Y+27
    01B51 8DFC      LDD	R31,Y+28
    01B52 8826      LDD	R2,Z+22
    01B53 8837      LDD	R3,Z+23
    01B54 8C40      LDD	R4,Z+24
    01B55 8C51      LDD	R5,Z+25
    01B56 8248      ST	Y,R4
    01B57 8259      STD	Y+1,R5
    01B58 0191      MOVW	R18,R2
    01B59 8100      LD	R16,Z
    01B5A 8111      LDD	R17,Z+1
    01B5B 940E 044E CALL	ff.c:move_window
    01B5D 2EA0      MOV	R10,R16
    01B5E 2300      TST	R16
    01B5F F051      BEQ	0x1B6A
(2457) 			ABORT(fp->fs, FR_DISK_ERR);
    01B60 8D8B      LDD	R24,Y+27
    01B61 8D9C      LDD	R25,Y+28
    01B62 9604      ADIW	R24,4
    01B63 015C      MOVW	R10,R24
    01B64 01FC      MOVW	R30,R24
    01B65 8180      LD	R24,Z
    01B66 6880      ORI	R24,0x80
    01B67 8380      ST	Z,R24
    01B68 E001      LDI	R16,1
    01B69 C046      RJMP	0x1BB0
(2458) 		mem_cpy(rbuff, &fp->fs->win[fp->fptr % SS(fp->fs)], rcnt);	/* Pick partial sector */
    01B6A 82D9      STD	Y+1,R13
    01B6B 82C8      ST	Y,R12
    01B6C EF4F      LDI	R20,0xFF
    01B6D E051      LDI	R21,1
    01B6E E060      LDI	R22,0
    01B6F E070      LDI	R23,0
    01B70 8DEB      LDD	R30,Y+27
    01B71 8DFC      LDD	R31,Y+28
    01B72 8026      LDD	R2,Z+6
    01B73 8037      LDD	R3,Z+7
    01B74 8440      LDD	R4,Z+8
    01B75 8451      LDD	R5,Z+9
    01B76 2224      AND	R2,R20
    01B77 2235      AND	R3,R21
    01B78 2246      AND	R4,R22
    01B79 2257      AND	R5,R23
    01B7A 0191      MOVW	R18,R2
    01B7B 8180      LD	R24,Z
    01B7C 8191      LDD	R25,Z+1
    01B7D 968E      ADIW	R24,0x2E
    01B7E 0F28      ADD	R18,R24
    01B7F 1F39      ADC	R19,R25
    01B80 0187      MOVW	R16,R14
    01B81 940E 03F5 CALL	ff.c:mem_cpy
    01B83 0CEC      ADD	R14,R12
    01B84 1CFD      ADC	R15,R13
    01B85 8D8B      LDD	R24,Y+27
    01B86 8D9C      LDD	R25,Y+28
    01B87 9606      ADIW	R24,6
    01B88 015C      MOVW	R10,R24
    01B89 0116      MOVW	R2,R12
    01B8A 2444      CLR	R4
    01B8B 2455      CLR	R5
    01B8C 01FC      MOVW	R30,R24
    01B8D 8060      LD	R6,Z
    01B8E 8071      LDD	R7,Z+1
    01B8F 8082      LDD	R8,Z+2
    01B90 8093      LDD	R9,Z+3
    01B91 0C62      ADD	R6,R2
    01B92 1C73      ADC	R7,R3
    01B93 1C84      ADC	R8,R4
    01B94 1C95      ADC	R9,R5
    01B95 8260      ST	Z,R6
    01B96 8271      STD	Z+1,R7
    01B97 8282      STD	Z+2,R8
    01B98 8293      STD	Z+3,R9
    01B99 A1E9      LDD	R30,Y+33
    01B9A A1FA      LDD	R31,Y+34
    01B9B 8020      LD	R2,Z
    01B9C 8031      LDD	R3,Z+1
    01B9D 0C2C      ADD	R2,R12
    01B9E 1C3D      ADC	R3,R13
    01B9F 8231      STD	Z+1,R3
    01BA0 8220      ST	Z,R2
    01BA1 8C0F      LDD	R0,Y+31
    01BA2 A018      LDD	R1,Y+32
    01BA3 180C      SUB	R0,R12
    01BA4 081D      SBC	R1,R13
    01BA5 A218      STD	Y+32,R1
    01BA6 8E0F      STD	Y+31,R0
    01BA7 8C0F      LDD	R0,Y+31
    01BA8 A018      LDD	R1,Y+32
    01BA9 2000      TST	R0
    01BAA F009      BEQ	0x1BAC
    01BAB CDF1      RJMP	0x199D
    01BAC 2011      TST	R1
    01BAD F009      BEQ	0x1BAF
    01BAE CDEE      RJMP	0x199D
(2459) #else
(2460) 		mem_cpy(rbuff, &fp->buf[fp->fptr % SS(fp->fs)], rcnt);	/* Pick partial sector */
(2461) #endif
(2462) 	}
(2463) 
(2464) 	LEAVE_FF(fp->fs, FR_OK);
    01BAF 2700      CLR	R16
    01BB0 9661      ADIW	R28,0x11
    01BB1 940E 483A CALL	pop_xgsetF0FC
    01BB3 9624      ADIW	R28,4
    01BB4 9508      RET
_f_write:
  res                  --> R10
  clst                 --> Y,+9
  csect                --> R12
  cc                   --> R10
  wbuff                --> R14
  sect                 --> Y,+5
  wcnt                 --> R12
  bw                   --> Y,+33
  btw                  --> Y,+31
  buff                 --> R10
  fp                   --> Y,+27
    01BB5 940E 4700 CALL	push_arg4
    01BB7 940E 4845 CALL	push_xgsetF0FC
    01BB9 0159      MOVW	R10,R18
    01BBA 9761      SBIW	R28,0x11
(2465) }
(2466) 
(2467) 
(2468) 
(2469) 
(2470) #if !_FS_READONLY
(2471) /*-----------------------------------------------------------------------*/
(2472) /* Write File                                                            */
(2473) /*-----------------------------------------------------------------------*/
(2474) 
(2475) FRESULT f_write (
(2476) 	FIL *fp,			/* Pointer to the file object */
(2477) 	const void *buff,	/* Pointer to the data to be written */
(2478) 	UINT btw,			/* Number of bytes to write */
(2479) 	UINT *bw			/* Pointer to number of bytes written */
(2480) )
(2481) {
(2482) 	FRESULT res;
(2483) 	DWORD clst, sect;
(2484) 	UINT wcnt, cc;
(2485) 	const BYTE *wbuff = buff;
    01BBB 0175      MOVW	R14,R10
(2486) 	BYTE csect;
(2487) 
(2488) 
(2489) 	*bw = 0;	/* Initialize byte counter */
    01BBC 2422      CLR	R2
    01BBD 2433      CLR	R3
    01BBE A1E9      LDD	R30,Y+33
    01BBF A1FA      LDD	R31,Y+34
    01BC0 8231      STD	Z+1,R3
    01BC1 8220      ST	Z,R2
(2490) 
(2491) 	res = validate(fp->fs, fp->id);			/* Check validity */
    01BC2 8DEB      LDD	R30,Y+27
    01BC3 8DFC      LDD	R31,Y+28
    01BC4 8122      LDD	R18,Z+2
    01BC5 8133      LDD	R19,Z+3
    01BC6 8100      LD	R16,Z
    01BC7 8111      LDD	R17,Z+1
    01BC8 DB9D      RCALL	ff.c:validate
    01BC9 2EA0      MOV	R10,R16
(2492) 	if (res != FR_OK) LEAVE_FF(fp->fs, res);
    01BCA 2300      TST	R16
    01BCB F009      BEQ	0x1BCD
    01BCC C2FC      RJMP	0x1EC9
(2493) 	if (fp->flag & FA__ERROR)				/* Aborted file? */
    01BCD 8DEB      LDD	R30,Y+27
    01BCE 8DFC      LDD	R31,Y+28
    01BCF 8024      LDD	R2,Z+4
    01BD0 FE27      SBRS	R2,7
    01BD1 C002      RJMP	0x1BD4
(2494) 		LEAVE_FF(fp->fs, FR_INT_ERR);
    01BD2 E002      LDI	R16,2
    01BD3 C2F5      RJMP	0x1EC9
(2495) 	if (!(fp->flag & FA_WRITE))				/* Check access mode */
    01BD4 8DEB      LDD	R30,Y+27
    01BD5 8DFC      LDD	R31,Y+28
    01BD6 8024      LDD	R2,Z+4
    01BD7 FC21      SBRC	R2,1
    01BD8 C002      RJMP	0x1BDB
(2496) 		LEAVE_FF(fp->fs, FR_DENIED);
    01BD9 E007      LDI	R16,7
    01BDA C2EE      RJMP	0x1EC9
(2497) 	if ((DWORD)(fp->fsize + btw) < fp->fsize) btw = 0;	/* File size cannot reach 4GB */
    01BDB 8DEB      LDD	R30,Y+27
    01BDC 8DFC      LDD	R31,Y+28
    01BDD 963A      ADIW	R30,0xA
    01BDE 8020      LD	R2,Z
    01BDF 8031      LDD	R3,Z+1
    01BE0 8042      LDD	R4,Z+2
    01BE1 8053      LDD	R5,Z+3
    01BE2 862D      STD	Y+13,R2
    01BE3 863E      STD	Y+14,R3
    01BE4 864F      STD	Y+15,R4
    01BE5 8A58      STD	Y+16,R5
    01BE6 8C2F      LDD	R2,Y+31
    01BE7 A038      LDD	R3,Y+32
    01BE8 2444      CLR	R4
    01BE9 2455      CLR	R5
    01BEA 846D      LDD	R6,Y+13
    01BEB 847E      LDD	R7,Y+14
    01BEC 848F      LDD	R8,Y+15
    01BED 8898      LDD	R9,Y+16
    01BEE 0C62      ADD	R6,R2
    01BEF 1C73      ADC	R7,R3
    01BF0 1C84      ADC	R8,R4
    01BF1 1C95      ADC	R9,R5
    01BF2 842D      LDD	R2,Y+13
    01BF3 843E      LDD	R3,Y+14
    01BF4 844F      LDD	R4,Y+15
    01BF5 8858      LDD	R5,Y+16
    01BF6 1462      CP	R6,R2
    01BF7 0473      CPC	R7,R3
    01BF8 0484      CPC	R8,R4
    01BF9 0495      CPC	R9,R5
    01BFA F008      BCS	0x1BFC
    01BFB C2A5      RJMP	0x1EA1
    01BFC 2400      CLR	R0
    01BFD 2411      CLR	R1
    01BFE A218      STD	Y+32,R1
    01BFF 8E0F      STD	Y+31,R0
(2498) 
(2499) 	for ( ;  btw;							/* Repeat until all data written */
    01C00 C2A0      RJMP	0x1EA1
(2500) 		wbuff += wcnt, fp->fptr += wcnt, *bw += wcnt, btw -= wcnt) {
(2501) 		if ((fp->fptr % SS(fp->fs)) == 0) {	/* On the sector boundary? */
    01C01 EF4F      LDI	R20,0xFF
    01C02 E051      LDI	R21,1
    01C03 E060      LDI	R22,0
    01C04 E070      LDI	R23,0
    01C05 8DEB      LDD	R30,Y+27
    01C06 8DFC      LDD	R31,Y+28
    01C07 9636      ADIW	R30,6
    01C08 8020      LD	R2,Z
    01C09 8031      LDD	R3,Z+1
    01C0A 8042      LDD	R4,Z+2
    01C0B 8053      LDD	R5,Z+3
    01C0C 2224      AND	R2,R20
    01C0D 2235      AND	R3,R21
    01C0E 2246      AND	R4,R22
    01C0F 2257      AND	R5,R23
    01C10 9488      BCLR	0
    01C11 2022      TST	R2
    01C12 0432      CPC	R3,R2
    01C13 0442      CPC	R4,R2
    01C14 0452      CPC	R5,R2
    01C15 F009      BEQ	0x1C17
    01C16 C20B      RJMP	0x1E22
(2502) 			csect = (BYTE)(fp->fptr / SS(fp->fs) & (fp->fs->csize - 1));	/* Sector offset in the cluster */
    01C17 E089      LDI	R24,0x9
    01C18 E090      LDI	R25,0
    01C19 8DEB      LDD	R30,Y+27
    01C1A 8DFC      LDD	R31,Y+28
    01C1B 8106      LDD	R16,Z+6
    01C1C 8117      LDD	R17,Z+7
    01C1D 8520      LDD	R18,Z+8
    01C1E 8531      LDD	R19,Z+9
    01C1F 938A      ST	-Y,R24
    01C20 940E 48E9 CALL	lsr32
    01C22 0118      MOVW	R2,R16
    01C23 0129      MOVW	R4,R18
    01C24 8DEB      LDD	R30,Y+27
    01C25 8DFC      LDD	R31,Y+28
    01C26 93AF      PUSH	R26
    01C27 93BF      PUSH	R27
    01C28 81A0      LD	R26,Z
    01C29 81B1      LDD	R27,Z+1
    01C2A 01FD      MOVW	R30,R26
    01C2B 91BF      POP	R27
    01C2C 91AF      POP	R26
    01C2D 8182      LDD	R24,Z+2
    01C2E 2799      CLR	R25
    01C2F 9701      SBIW	R24,1
    01C30 013C      MOVW	R6,R24
    01C31 2488      CLR	R8
    01C32 FC77      SBRC	R7,7
    01C33 9480      COM	R8
    01C34 2499      CLR	R9
    01C35 FC87      SBRC	R8,7
    01C36 9490      COM	R9
    01C37 2026      AND	R2,R6
    01C38 2037      AND	R3,R7
    01C39 2048      AND	R4,R8
    01C3A 2059      AND	R5,R9
    01C3B 2CC2      MOV	R12,R2
(2503) 			if (!csect) {					/* On the cluster boundary? */
    01C3C 2022      TST	R2
    01C3D F009      BEQ	0x1C3F
    01C3E C0A5      RJMP	0x1CE4
(2504) 				if (fp->fptr == 0) {		/* On the top of the file? */
    01C3F 8DEB      LDD	R30,Y+27
    01C40 8DFC      LDD	R31,Y+28
    01C41 9636      ADIW	R30,6
    01C42 8020      LD	R2,Z
    01C43 8031      LDD	R3,Z+1
    01C44 8042      LDD	R4,Z+2
    01C45 8053      LDD	R5,Z+3
    01C46 9488      BCLR	0
    01C47 2022      TST	R2
    01C48 0432      CPC	R3,R2
    01C49 0442      CPC	R4,R2
    01C4A 0452      CPC	R5,R2
    01C4B F571      BNE	0x1C7A
(2505) 					clst = fp->sclust;		/* Follow from the origin */
    01C4C 8DEB      LDD	R30,Y+27
    01C4D 8DFC      LDD	R31,Y+28
    01C4E 963E      ADIW	R30,0xE
    01C4F 8020      LD	R2,Z
    01C50 8031      LDD	R3,Z+1
    01C51 8042      LDD	R4,Z+2
    01C52 8053      LDD	R5,Z+3
    01C53 8629      STD	Y+9,R2
    01C54 863A      STD	Y+10,R3
    01C55 864B      STD	Y+11,R4
    01C56 865C      STD	Y+12,R5
(2506) 					if (clst == 0)			/* When no cluster is allocated, */
    01C57 8429      LDD	R2,Y+9
    01C58 843A      LDD	R3,Y+10
    01C59 844B      LDD	R4,Y+11
    01C5A 845C      LDD	R5,Y+12
    01C5B 9488      BCLR	0
    01C5C 2022      TST	R2
    01C5D 0432      CPC	R3,R2
    01C5E 0442      CPC	R4,R2
    01C5F 0452      CPC	R5,R2
    01C60 F009      BEQ	0x1C62
    01C61 C040      RJMP	0x1CA2
(2507) 						fp->sclust = clst = create_chain(fp->fs, 0);	/* Create a new cluster chain */
    01C62 E040      LDI	R20,0
    01C63 E050      LDI	R21,0
    01C64 E060      LDI	R22,0
    01C65 E070      LDI	R23,0
    01C66 8368      ST	Y,R22
    01C67 8379      STD	Y+1,R23
    01C68 019A      MOVW	R18,R20
    01C69 8DEB      LDD	R30,Y+27
    01C6A 8DFC      LDD	R31,Y+28
    01C6B 8100      LD	R16,Z
    01C6C 8111      LDD	R17,Z+1
    01C6D 940E 09D9 CALL	ff.c:create_chain
    01C6F 8709      STD	Y+9,R16
    01C70 871A      STD	Y+10,R17
    01C71 872B      STD	Y+11,R18
    01C72 873C      STD	Y+12,R19
    01C73 8DEB      LDD	R30,Y+27
    01C74 8DFC      LDD	R31,Y+28
    01C75 8706      STD	Z+14,R16
    01C76 8717      STD	Z+15,R17
    01C77 8B20      STD	Z+16,R18
    01C78 8B31      STD	Z+17,R19
(2508) 				} else {					/* Middle or end of the file */
    01C79 C028      RJMP	0x1CA2
(2509) #if _USE_FASTSEEK
(2510) 					if (fp->cltbl)
    01C7A 8DEB      LDD	R30,Y+27
    01C7B 8DFC      LDD	R31,Y+28
    01C7C A020      LDD	R2,Z+32
    01C7D A031      LDD	R3,Z+33
    01C7E 2022      TST	R2
    01C7F F411      BNE	0x1C82
    01C80 2033      TST	R3
    01C81 F079      BEQ	0x1C91
(2511) 						clst = clmt_clust(fp, fp->fptr);	/* Get cluster# from the CLMT */
    01C82 8026      LDD	R2,Z+6
    01C83 8037      LDD	R3,Z+7
    01C84 8440      LDD	R4,Z+8
    01C85 8451      LDD	R5,Z+9
    01C86 8248      ST	Y,R4
    01C87 8259      STD	Y+1,R5
    01C88 0191      MOVW	R18,R2
    01C89 018F      MOVW	R16,R30
    01C8A 940E 0B51 CALL	ff.c:clmt_clust
    01C8C 8709      STD	Y+9,R16
    01C8D 871A      STD	Y+10,R17
    01C8E 872B      STD	Y+11,R18
    01C8F 873C      STD	Y+12,R19
    01C90 C011      RJMP	0x1CA2
(2512) 					else
(2513) #endif
(2514) 						clst = create_chain(fp->fs, fp->clust);	/* Follow or stretch cluster chain on the FAT */
    01C91 8DEB      LDD	R30,Y+27
    01C92 8DFC      LDD	R31,Y+28
    01C93 8822      LDD	R2,Z+18
    01C94 8833      LDD	R3,Z+19
    01C95 8844      LDD	R4,Z+20
    01C96 8855      LDD	R5,Z+21
    01C97 8248      ST	Y,R4
    01C98 8259      STD	Y+1,R5
    01C99 0191      MOVW	R18,R2
    01C9A 8100      LD	R16,Z
    01C9B 8111      LDD	R17,Z+1
    01C9C 940E 09D9 CALL	ff.c:create_chain
    01C9E 8709      STD	Y+9,R16
    01C9F 871A      STD	Y+10,R17
    01CA0 872B      STD	Y+11,R18
    01CA1 873C      STD	Y+12,R19
(2515) 				}
(2516) 				if (clst == 0) break;		/* Could not allocate a new cluster (disk full) */
    01CA2 8429      LDD	R2,Y+9
    01CA3 843A      LDD	R3,Y+10
    01CA4 844B      LDD	R4,Y+11
    01CA5 845C      LDD	R5,Y+12
    01CA6 9488      BCLR	0
    01CA7 2022      TST	R2
    01CA8 0432      CPC	R3,R2
    01CA9 0442      CPC	R4,R2
    01CAA 0452      CPC	R5,R2
    01CAB F409      BNE	0x1CAD
    01CAC C1FC      RJMP	0x1EA9
(2517) 				if (clst == 1) ABORT(fp->fs, FR_INT_ERR);
    01CAD E041      LDI	R20,1
    01CAE E050      LDI	R21,0
    01CAF E060      LDI	R22,0
    01CB0 E070      LDI	R23,0
    01CB1 8429      LDD	R2,Y+9
    01CB2 843A      LDD	R3,Y+10
    01CB3 844B      LDD	R4,Y+11
    01CB4 845C      LDD	R5,Y+12
    01CB5 1624      CP	R2,R20
    01CB6 0635      CPC	R3,R21
    01CB7 0646      CPC	R4,R22
    01CB8 0657      CPC	R5,R23
    01CB9 F449      BNE	0x1CC3
    01CBA 8D8B      LDD	R24,Y+27
    01CBB 8D9C      LDD	R25,Y+28
    01CBC 9604      ADIW	R24,4
    01CBD 01FC      MOVW	R30,R24
    01CBE 8180      LD	R24,Z
    01CBF 6880      ORI	R24,0x80
    01CC0 8380      ST	Z,R24
    01CC1 E002      LDI	R16,2
    01CC2 C206      RJMP	0x1EC9
(2518) 				if (clst == 0xFFFFFFFF) ABORT(fp->fs, FR_DISK_ERR);
    01CC3 EF4F      LDI	R20,0xFF
    01CC4 EF5F      LDI	R21,0xFF
    01CC5 EF6F      LDI	R22,0xFF
    01CC6 EF7F      LDI	R23,0xFF
    01CC7 8429      LDD	R2,Y+9
    01CC8 843A      LDD	R3,Y+10
    01CC9 844B      LDD	R4,Y+11
    01CCA 845C      LDD	R5,Y+12
    01CCB 1624      CP	R2,R20
    01CCC 0635      CPC	R3,R21
    01CCD 0646      CPC	R4,R22
    01CCE 0657      CPC	R5,R23
    01CCF F451      BNE	0x1CDA
    01CD0 8D8B      LDD	R24,Y+27
    01CD1 8D9C      LDD	R25,Y+28
    01CD2 9604      ADIW	R24,4
    01CD3 015C      MOVW	R10,R24
    01CD4 01FC      MOVW	R30,R24
    01CD5 8180      LD	R24,Z
    01CD6 6880      ORI	R24,0x80
    01CD7 8380      ST	Z,R24
    01CD8 E001      LDI	R16,1
    01CD9 C1EF      RJMP	0x1EC9
(2519) 				fp->clust = clst;			/* Update current cluster */
    01CDA 8429      LDD	R2,Y+9
    01CDB 843A      LDD	R3,Y+10
    01CDC 844B      LDD	R4,Y+11
    01CDD 845C      LDD	R5,Y+12
    01CDE 8DEB      LDD	R30,Y+27
    01CDF 8DFC      LDD	R31,Y+28
    01CE0 8A22      STD	Z+18,R2
    01CE1 8A33      STD	Z+19,R3
    01CE2 8A44      STD	Z+20,R4
    01CE3 8A55      STD	Z+21,R5
(2520) 			}
(2521) #if _FS_TINY
(2522) 			if (fp->fs->winsect == fp->dsect && move_window(fp->fs, 0))	/* Write-back sector cache */
    01CE4 8DEB      LDD	R30,Y+27
    01CE5 8DFC      LDD	R31,Y+28
    01CE6 80A0      LD	R10,Z
    01CE7 80B1      LDD	R11,Z+1
    01CE8 8826      LDD	R2,Z+22
    01CE9 8837      LDD	R3,Z+23
    01CEA 8C40      LDD	R4,Z+24
    01CEB 8C51      LDD	R5,Z+25
    01CEC 01F5      MOVW	R30,R10
    01CED A462      LDD	R6,Z+42
    01CEE A473      LDD	R7,Z+43
    01CEF A484      LDD	R8,Z+44
    01CF0 A495      LDD	R9,Z+45
    01CF1 1462      CP	R6,R2
    01CF2 0473      CPC	R7,R3
    01CF3 0484      CPC	R8,R4
    01CF4 0495      CPC	R9,R5
    01CF5 F4B9      BNE	0x1D0D
    01CF6 E040      LDI	R20,0
    01CF7 E050      LDI	R21,0
    01CF8 E060      LDI	R22,0
    01CF9 E070      LDI	R23,0
    01CFA 8368      ST	Y,R22
    01CFB 8379      STD	Y+1,R23
    01CFC 019A      MOVW	R18,R20
    01CFD 018F      MOVW	R16,R30
    01CFE 940E 044E CALL	ff.c:move_window
    01D00 2EA0      MOV	R10,R16
    01D01 2300      TST	R16
    01D02 F051      BEQ	0x1D0D
(2523) 				ABORT(fp->fs, FR_DISK_ERR);
    01D03 8D8B      LDD	R24,Y+27
    01D04 8D9C      LDD	R25,Y+28
    01D05 9604      ADIW	R24,4
    01D06 015C      MOVW	R10,R24
    01D07 01FC      MOVW	R30,R24
    01D08 8180      LD	R24,Z
    01D09 6880      ORI	R24,0x80
    01D0A 8380      ST	Z,R24
    01D0B E001      LDI	R16,1
    01D0C C1BC      RJMP	0x1EC9
(2524) #else
(2525) 			if (fp->flag & FA__DIRTY) {		/* Write-back sector cache */
(2526) 				if (disk_write(fp->fs->drv, fp->buf, fp->dsect, 1) != RES_OK)
(2527) 					ABORT(fp->fs, FR_DISK_ERR);
(2528) 				fp->flag &= ~FA__DIRTY;
(2529) 			}
(2530) #endif
(2531) 			sect = clust2sect(fp->fs, fp->clust);	/* Get current sector */
    01D0D 8DEB      LDD	R30,Y+27
    01D0E 8DFC      LDD	R31,Y+28
    01D0F 8822      LDD	R2,Z+18
    01D10 8833      LDD	R3,Z+19
    01D11 8844      LDD	R4,Z+20
    01D12 8855      LDD	R5,Z+21
    01D13 8248      ST	Y,R4
    01D14 8259      STD	Y+1,R5
    01D15 0191      MOVW	R18,R2
    01D16 8100      LD	R16,Z
    01D17 8111      LDD	R17,Z+1
    01D18 940E 05C5 CALL	_clust2sect
    01D1A 830D      STD	Y+5,R16
    01D1B 831E      STD	Y+6,R17
    01D1C 832F      STD	Y+7,R18
    01D1D 8738      STD	Y+8,R19
(2532) 			if (!sect) ABORT(fp->fs, FR_INT_ERR);
    01D1E 802D      LDD	R2,Y+5
    01D1F 803E      LDD	R3,Y+6
    01D20 804F      LDD	R4,Y+7
    01D21 8458      LDD	R5,Y+8
    01D22 9488      BCLR	0
    01D23 2022      TST	R2
    01D24 0432      CPC	R3,R2
    01D25 0442      CPC	R4,R2
    01D26 0452      CPC	R5,R2
    01D27 F451      BNE	0x1D32
    01D28 8D8B      LDD	R24,Y+27
    01D29 8D9C      LDD	R25,Y+28
    01D2A 9604      ADIW	R24,4
    01D2B 015C      MOVW	R10,R24
    01D2C 01FC      MOVW	R30,R24
    01D2D 8180      LD	R24,Z
    01D2E 6880      ORI	R24,0x80
    01D2F 8380      ST	Z,R24
    01D30 E002      LDI	R16,2
    01D31 C197      RJMP	0x1EC9
(2533) 			sect += csect;
    01D32 2C2C      MOV	R2,R12
    01D33 2433      CLR	R3
    01D34 2444      CLR	R4
    01D35 2455      CLR	R5
    01D36 806D      LDD	R6,Y+5
    01D37 807E      LDD	R7,Y+6
    01D38 808F      LDD	R8,Y+7
    01D39 8498      LDD	R9,Y+8
    01D3A 0C62      ADD	R6,R2
    01D3B 1C73      ADC	R7,R3
    01D3C 1C84      ADC	R8,R4
    01D3D 1C95      ADC	R9,R5
    01D3E 826D      STD	Y+5,R6
    01D3F 827E      STD	Y+6,R7
    01D40 828F      STD	Y+7,R8
    01D41 8698      STD	Y+8,R9
(2534) 			cc = btw / SS(fp->fs);			/* When remaining bytes >= sector size, */
    01D42 E029      LDI	R18,0x9
    01D43 E030      LDI	R19,0
    01D44 8D0F      LDD	R16,Y+31
    01D45 A118      LDD	R17,Y+32
    01D46 940E 48E2 CALL	lsr16
    01D48 0158      MOVW	R10,R16
(2535) 			if (cc) {						/* Write maximum contiguous sectors directly */
    01D49 3000      CPI	R16,0
    01D4A 0701      CPC	R16,R17
    01D4B F409      BNE	0x1D4D
    01D4C C097      RJMP	0x1DE4
(2536) 				if (csect + cc > fp->fs->csize)	/* Clip at cluster boundary */
    01D4D 2C2C      MOV	R2,R12
    01D4E 2433      CLR	R3
    01D4F 0E20      ADD	R2,R16
    01D50 1E31      ADC	R3,R17
    01D51 8DEB      LDD	R30,Y+27
    01D52 8DFC      LDD	R31,Y+28
    01D53 93AF      PUSH	R26
    01D54 93BF      PUSH	R27
    01D55 81A0      LD	R26,Z
    01D56 81B1      LDD	R27,Z+1
    01D57 01FD      MOVW	R30,R26
    01D58 91BF      POP	R27
    01D59 91AF      POP	R26
    01D5A 8042      LDD	R4,Z+2
    01D5B 2455      CLR	R5
    01D5C 1442      CP	R4,R2
    01D5D 0453      CPC	R5,R3
    01D5E F478      BCC	0x1D6E
(2537) 					cc = fp->fs->csize - csect;
    01D5F 2C2C      MOV	R2,R12
    01D60 2433      CLR	R3
    01D61 8DEB      LDD	R30,Y+27
    01D62 8DFC      LDD	R31,Y+28
    01D63 93AF      PUSH	R26
    01D64 93BF      PUSH	R27
    01D65 81A0      LD	R26,Z
    01D66 81B1      LDD	R27,Z+1
    01D67 01FD      MOVW	R30,R26
    01D68 91BF      POP	R27
    01D69 91AF      POP	R26
    01D6A 80A2      LDD	R10,Z+2
    01D6B 24BB      CLR	R11
    01D6C 18A2      SUB	R10,R2
    01D6D 08B3      SBC	R11,R3
(2538) 				if (disk_write(fp->fs->drv,(char*)wbuff, sect, (BYTE)cc) != RES_OK)
    01D6E 82AC      STD	Y+4,R10
    01D6F 802D      LDD	R2,Y+5
    01D70 803E      LDD	R3,Y+6
    01D71 804F      LDD	R4,Y+7
    01D72 8458      LDD	R5,Y+8
    01D73 8228      ST	Y,R2
    01D74 8239      STD	Y+1,R3
    01D75 824A      STD	Y+2,R4
    01D76 825B      STD	Y+3,R5
    01D77 0197      MOVW	R18,R14
    01D78 8DEB      LDD	R30,Y+27
    01D79 8DFC      LDD	R31,Y+28
    01D7A 93AF      PUSH	R26
    01D7B 93BF      PUSH	R27
    01D7C 81A0      LD	R26,Z
    01D7D 81B1      LDD	R27,Z+1
    01D7E 01FD      MOVW	R30,R26
    01D7F 91BF      POP	R27
    01D80 91AF      POP	R26
    01D81 8101      LDD	R16,Z+1
    01D82 940E 03D3 CALL	_disk_write
    01D84 2EC0      MOV	R12,R16
    01D85 2300      TST	R16
    01D86 F051      BEQ	0x1D91
(2539) 					ABORT(fp->fs, FR_DISK_ERR);
    01D87 8D8B      LDD	R24,Y+27
    01D88 8D9C      LDD	R25,Y+28
    01D89 9604      ADIW	R24,4
    01D8A 016C      MOVW	R12,R24
    01D8B 01FC      MOVW	R30,R24
    01D8C 8180      LD	R24,Z
    01D8D 6880      ORI	R24,0x80
    01D8E 8380      ST	Z,R24
    01D8F E001      LDI	R16,1
    01D90 C138      RJMP	0x1EC9
(2540) #if _FS_TINY
(2541) 				if (fp->fs->winsect - sect < cc) {	/* Refill sector cache if it gets invalidated by the direct write */
    01D91 802D      LDD	R2,Y+5
    01D92 803E      LDD	R3,Y+6
    01D93 804F      LDD	R4,Y+7
    01D94 8458      LDD	R5,Y+8
    01D95 8DEB      LDD	R30,Y+27
    01D96 8DFC      LDD	R31,Y+28
    01D97 81A0      LD	R26,Z
    01D98 81B1      LDD	R27,Z+1
    01D99 969A      ADIW	R26,0x2A
    01D9A 906D      LD	R6,X+
    01D9B 907D      LD	R7,X+
    01D9C 908D      LD	R8,X+
    01D9D 909C      LD	R9,X
    01D9E 1862      SUB	R6,R2
    01D9F 0873      SBC	R7,R3
    01DA0 0884      SBC	R8,R4
    01DA1 0895      SBC	R9,R5
    01DA2 0115      MOVW	R2,R10
    01DA3 2444      CLR	R4
    01DA4 2455      CLR	R5
    01DA5 1462      CP	R6,R2
    01DA6 0473      CPC	R7,R3
    01DA7 0484      CPC	R8,R4
    01DA8 0495      CPC	R9,R5
    01DA9 F008      BCS	0x1DAB
    01DAA C032      RJMP	0x1DDD
(2542) 					mem_cpy(fp->fs->win, wbuff + ((fp->fs->winsect - sect) * SS(fp->fs)), SS(fp->fs));
    01DAB E080      LDI	R24,0
    01DAC E092      LDI	R25,2
    01DAD 8399      STD	Y+1,R25
    01DAE 8388      ST	Y,R24
    01DAF 80C0      LD	R12,Z
    01DB0 80D1      LDD	R13,Z+1
    01DB1 802D      LDD	R2,Y+5
    01DB2 803E      LDD	R3,Y+6
    01DB3 804F      LDD	R4,Y+7
    01DB4 8458      LDD	R5,Y+8
    01DB5 01F6      MOVW	R30,R12
    01DB6 A462      LDD	R6,Z+42
    01DB7 A473      LDD	R7,Z+43
    01DB8 A484      LDD	R8,Z+44
    01DB9 A495      LDD	R9,Z+45
    01DBA 1862      SUB	R6,R2
    01DBB 0873      SBC	R7,R3
    01DBC 0884      SBC	R8,R4
    01DBD 0895      SBC	R9,R5
    01DBE E040      LDI	R20,0
    01DBF E052      LDI	R21,2
    01DC0 E060      LDI	R22,0
    01DC1 E070      LDI	R23,0
    01DC2 929A      ST	-Y,R9
    01DC3 928A      ST	-Y,R8
    01DC4 927A      ST	-Y,R7
    01DC5 926A      ST	-Y,R6
    01DC6 018A      MOVW	R16,R20
    01DC7 019B      MOVW	R18,R22
    01DC8 940E 47F1 CALL	empy32s|empy32u
    01DCA 0198      MOVW	R18,R16
    01DCB 0D2E      ADD	R18,R14
    01DCC 1D3F      ADC	R19,R15
    01DCD 0186      MOVW	R16,R12
    01DCE 5D02      SUBI	R16,0xD2
    01DCF 4F1F      SBCI	R17,0xFF
    01DD0 940E 03F5 CALL	ff.c:mem_cpy
(2543) 					fp->fs->wflag = 0;
    01DD2 2422      CLR	R2
    01DD3 8DEB      LDD	R30,Y+27
    01DD4 8DFC      LDD	R31,Y+28
    01DD5 93AF      PUSH	R26
    01DD6 93BF      PUSH	R27
    01DD7 81A0      LD	R26,Z
    01DD8 81B1      LDD	R27,Z+1
    01DD9 01FD      MOVW	R30,R26
    01DDA 91BF      POP	R27
    01DDB 91AF      POP	R26
    01DDC 8224      STD	Z+4,R2
(2544) 				}
(2545) #else
(2546) 				if (fp->dsect - sect < cc) { /* Refill sector cache if it gets invalidated by the direct write */
(2547) 					mem_cpy(fp->buf, wbuff + ((fp->dsect - sect) * SS(fp->fs)), SS(fp->fs));
(2548) 					fp->flag &= ~FA__DIRTY;
(2549) 				}
(2550) #endif
(2551) 				wcnt = SS(fp->fs) * cc;		/* Number of bytes transferred */
    01DDD E000      LDI	R16,0
    01DDE E012      LDI	R17,2
    01DDF 0195      MOVW	R18,R10
    01DE0 940E 47E1 CALL	empy16s
    01DE2 0168      MOVW	R12,R16
(2552) 				continue;
    01DE3 C099      RJMP	0x1E7D
(2553) 			}
(2554) #if _FS_TINY
(2555) 			if (fp->fptr >= fp->fsize) {	/* Avoid silly cache filling at growing edge */
    01DE4 8DEB      LDD	R30,Y+27
    01DE5 8DFC      LDD	R31,Y+28
    01DE6 8422      LDD	R2,Z+10
    01DE7 8433      LDD	R3,Z+11
    01DE8 8444      LDD	R4,Z+12
    01DE9 8455      LDD	R5,Z+13
    01DEA 8066      LDD	R6,Z+6
    01DEB 8077      LDD	R7,Z+7
    01DEC 8480      LDD	R8,Z+8
    01DED 8491      LDD	R9,Z+9
    01DEE 1462      CP	R6,R2
    01DEF 0473      CPC	R7,R3
    01DF0 0484      CPC	R8,R4
    01DF1 0495      CPC	R9,R5
    01DF2 F128      BCS	0x1E18
(2556) 				if (move_window(fp->fs, 0)) ABORT(fp->fs, FR_DISK_ERR);
    01DF3 E040      LDI	R20,0
    01DF4 E050      LDI	R21,0
    01DF5 E060      LDI	R22,0
    01DF6 E070      LDI	R23,0
    01DF7 8368      ST	Y,R22
    01DF8 8379      STD	Y+1,R23
    01DF9 019A      MOVW	R18,R20
    01DFA 8100      LD	R16,Z
    01DFB 8111      LDD	R17,Z+1
    01DFC 940E 044E CALL	ff.c:move_window
    01DFE 2EA0      MOV	R10,R16
    01DFF 2300      TST	R16
    01E00 F051      BEQ	0x1E0B
    01E01 8D8B      LDD	R24,Y+27
    01E02 8D9C      LDD	R25,Y+28
    01E03 9604      ADIW	R24,4
    01E04 015C      MOVW	R10,R24
    01E05 01FC      MOVW	R30,R24
    01E06 8180      LD	R24,Z
    01E07 6880      ORI	R24,0x80
    01E08 8380      ST	Z,R24
    01E09 E001      LDI	R16,1
    01E0A C0BE      RJMP	0x1EC9
(2557) 				fp->fs->winsect = sect;
    01E0B 802D      LDD	R2,Y+5
    01E0C 803E      LDD	R3,Y+6
    01E0D 804F      LDD	R4,Y+7
    01E0E 8458      LDD	R5,Y+8
    01E0F 8DEB      LDD	R30,Y+27
    01E10 8DFC      LDD	R31,Y+28
    01E11 81A0      LD	R26,Z
    01E12 81B1      LDD	R27,Z+1
    01E13 969A      ADIW	R26,0x2A
    01E14 922D      ST	X+,R2
    01E15 923D      ST	X+,R3
    01E16 924D      ST	X+,R4
    01E17 925C      ST	X,R5
(2558) 			}
(2559) #else
(2560) 			if (fp->dsect != sect) {		/* Fill sector cache with file data */
(2561) 				if (fp->fptr < fp->fsize &&
(2562) 					disk_read(fp->fs->drv, fp->buf, sect, 1) != RES_OK)
(2563) 						ABORT(fp->fs, FR_DISK_ERR);
(2564) 			}
(2565) #endif
(2566) 			fp->dsect = sect;
    01E18 802D      LDD	R2,Y+5
    01E19 803E      LDD	R3,Y+6
    01E1A 804F      LDD	R4,Y+7
    01E1B 8458      LDD	R5,Y+8
    01E1C 8DEB      LDD	R30,Y+27
    01E1D 8DFC      LDD	R31,Y+28
    01E1E 8A26      STD	Z+22,R2
    01E1F 8A37      STD	Z+23,R3
    01E20 8E40      STD	Z+24,R4
    01E21 8E51      STD	Z+25,R5
(2567) 		}
(2568) 		wcnt = SS(fp->fs) - (fp->fptr % SS(fp->fs));/* Put partial sector into file I/O buffer */
    01E22 EF4F      LDI	R20,0xFF
    01E23 E051      LDI	R21,1
    01E24 E060      LDI	R22,0
    01E25 E070      LDI	R23,0
    01E26 8DEB      LDD	R30,Y+27
    01E27 8DFC      LDD	R31,Y+28
    01E28 8026      LDD	R2,Z+6
    01E29 8037      LDD	R3,Z+7
    01E2A 8440      LDD	R4,Z+8
    01E2B 8451      LDD	R5,Z+9
    01E2C 2224      AND	R2,R20
    01E2D 2235      AND	R3,R21
    01E2E 2246      AND	R4,R22
    01E2F 2257      AND	R5,R23
    01E30 E040      LDI	R20,0
    01E31 E052      LDI	R21,2
    01E32 E060      LDI	R22,0
    01E33 E070      LDI	R23,0
    01E34 1942      SUB	R20,R2
    01E35 0953      SBC	R21,R3
    01E36 0964      SBC	R22,R4
    01E37 0975      SBC	R23,R5
    01E38 016A      MOVW	R12,R20
(2569) 		if (wcnt > btw) wcnt = btw;
    01E39 8C0F      LDD	R0,Y+31
    01E3A A018      LDD	R1,Y+32
    01E3B 1604      CP	R0,R20
    01E3C 0615      CPC	R1,R21
    01E3D F408      BCC	0x1E3F
    01E3E 0160      MOVW	R12,R0
(2570) #if _FS_TINY
(2571) 		if (move_window(fp->fs, fp->dsect))	/* Move sector window */
    01E3F 8DEB      LDD	R30,Y+27
    01E40 8DFC      LDD	R31,Y+28
    01E41 8826      LDD	R2,Z+22
    01E42 8837      LDD	R3,Z+23
    01E43 8C40      LDD	R4,Z+24
    01E44 8C51      LDD	R5,Z+25
    01E45 8248      ST	Y,R4
    01E46 8259      STD	Y+1,R5
    01E47 0191      MOVW	R18,R2
    01E48 8100      LD	R16,Z
    01E49 8111      LDD	R17,Z+1
    01E4A 940E 044E CALL	ff.c:move_window
    01E4C 2EA0      MOV	R10,R16
    01E4D 2300      TST	R16
    01E4E F051      BEQ	0x1E59
(2572) 			ABORT(fp->fs, FR_DISK_ERR);
    01E4F 8D8B      LDD	R24,Y+27
    01E50 8D9C      LDD	R25,Y+28
    01E51 9604      ADIW	R24,4
    01E52 015C      MOVW	R10,R24
    01E53 01FC      MOVW	R30,R24
    01E54 8180      LD	R24,Z
    01E55 6880      ORI	R24,0x80
    01E56 8380      ST	Z,R24
    01E57 E001      LDI	R16,1
    01E58 C070      RJMP	0x1EC9
(2573) 		mem_cpy(&fp->fs->win[fp->fptr % SS(fp->fs)], wbuff, wcnt);	/* Fit partial sector */
    01E59 82D9      STD	Y+1,R13
    01E5A 82C8      ST	Y,R12
    01E5B 0197      MOVW	R18,R14
    01E5C EF4F      LDI	R20,0xFF
    01E5D E051      LDI	R21,1
    01E5E E060      LDI	R22,0
    01E5F E070      LDI	R23,0
    01E60 8DEB      LDD	R30,Y+27
    01E61 8DFC      LDD	R31,Y+28
    01E62 8026      LDD	R2,Z+6
    01E63 8037      LDD	R3,Z+7
    01E64 8440      LDD	R4,Z+8
    01E65 8451      LDD	R5,Z+9
    01E66 2224      AND	R2,R20
    01E67 2235      AND	R3,R21
    01E68 2246      AND	R4,R22
    01E69 2257      AND	R5,R23
    01E6A 0181      MOVW	R16,R2
    01E6B 8180      LD	R24,Z
    01E6C 8191      LDD	R25,Z+1
    01E6D 968E      ADIW	R24,0x2E
    01E6E 0F08      ADD	R16,R24
    01E6F 1F19      ADC	R17,R25
    01E70 940E 03F5 CALL	ff.c:mem_cpy
(2574) 		fp->fs->wflag = 1;
    01E72 E081      LDI	R24,1
    01E73 8DEB      LDD	R30,Y+27
    01E74 8DFC      LDD	R31,Y+28
    01E75 93AF      PUSH	R26
    01E76 93BF      PUSH	R27
    01E77 81A0      LD	R26,Z
    01E78 81B1      LDD	R27,Z+1
    01E79 01FD      MOVW	R30,R26
    01E7A 91BF      POP	R27
    01E7B 91AF      POP	R26
    01E7C 8384      STD	Z+4,R24
    01E7D 0CEC      ADD	R14,R12
    01E7E 1CFD      ADC	R15,R13
    01E7F 8D8B      LDD	R24,Y+27
    01E80 8D9C      LDD	R25,Y+28
    01E81 9606      ADIW	R24,6
    01E82 015C      MOVW	R10,R24
    01E83 0116      MOVW	R2,R12
    01E84 2444      CLR	R4
    01E85 2455      CLR	R5
    01E86 01FC      MOVW	R30,R24
    01E87 8060      LD	R6,Z
    01E88 8071      LDD	R7,Z+1
    01E89 8082      LDD	R8,Z+2
    01E8A 8093      LDD	R9,Z+3
    01E8B 0C62      ADD	R6,R2
    01E8C 1C73      ADC	R7,R3
    01E8D 1C84      ADC	R8,R4
    01E8E 1C95      ADC	R9,R5
    01E8F 8260      ST	Z,R6
    01E90 8271      STD	Z+1,R7
    01E91 8282      STD	Z+2,R8
    01E92 8293      STD	Z+3,R9
    01E93 A1E9      LDD	R30,Y+33
    01E94 A1FA      LDD	R31,Y+34
    01E95 8020      LD	R2,Z
    01E96 8031      LDD	R3,Z+1
    01E97 0C2C      ADD	R2,R12
    01E98 1C3D      ADC	R3,R13
    01E99 8231      STD	Z+1,R3
    01E9A 8220      ST	Z,R2
    01E9B 8C0F      LDD	R0,Y+31
    01E9C A018      LDD	R1,Y+32
    01E9D 180C      SUB	R0,R12
    01E9E 081D      SBC	R1,R13
    01E9F A218      STD	Y+32,R1
    01EA0 8E0F      STD	Y+31,R0
    01EA1 8C0F      LDD	R0,Y+31
    01EA2 A018      LDD	R1,Y+32
    01EA3 2000      TST	R0
    01EA4 F009      BEQ	0x1EA6
    01EA5 CD5B      RJMP	0x1C01
    01EA6 2011      TST	R1
    01EA7 F009      BEQ	0x1EA9
    01EA8 CD58      RJMP	0x1C01
(2575) #else
(2576) 		mem_cpy(&fp->buf[fp->fptr % SS(fp->fs)], wbuff, wcnt);	/* Fit partial sector */
(2577) 		fp->flag |= FA__DIRTY;
(2578) #endif
(2579) 	}
(2580) 
(2581) 	if (fp->fptr > fp->fsize) fp->fsize = fp->fptr;	/* Update file size if needed */
    01EA9 8DEB      LDD	R30,Y+27
    01EAA 8DFC      LDD	R31,Y+28
    01EAB 8422      LDD	R2,Z+10
    01EAC 8433      LDD	R3,Z+11
    01EAD 8444      LDD	R4,Z+12
    01EAE 8455      LDD	R5,Z+13
    01EAF 8066      LDD	R6,Z+6
    01EB0 8077      LDD	R7,Z+7
    01EB1 8480      LDD	R8,Z+8
    01EB2 8491      LDD	R9,Z+9
    01EB3 1426      CP	R2,R6
    01EB4 0437      CPC	R3,R7
    01EB5 0448      CPC	R4,R8
    01EB6 0459      CPC	R5,R9
    01EB7 F440      BCC	0x1EC0
    01EB8 8026      LDD	R2,Z+6
    01EB9 8037      LDD	R3,Z+7
    01EBA 8440      LDD	R4,Z+8
    01EBB 8451      LDD	R5,Z+9
    01EBC 8622      STD	Z+10,R2
    01EBD 8633      STD	Z+11,R3
    01EBE 8644      STD	Z+12,R4
    01EBF 8655      STD	Z+13,R5
(2582) 	fp->flag |= FA__WRITTEN;						/* Set file change flag */
    01EC0 8D8B      LDD	R24,Y+27
    01EC1 8D9C      LDD	R25,Y+28
    01EC2 9604      ADIW	R24,4
    01EC3 015C      MOVW	R10,R24
    01EC4 01FC      MOVW	R30,R24
    01EC5 8180      LD	R24,Z
    01EC6 6280      ORI	R24,0x20
    01EC7 8380      ST	Z,R24
(2583) 
(2584) 	LEAVE_FF(fp->fs, FR_OK);
    01EC8 2700      CLR	R16
    01EC9 9661      ADIW	R28,0x11
    01ECA 940E 483A CALL	pop_xgsetF0FC
    01ECC 9624      ADIW	R28,4
    01ECD 9508      RET
_f_sync:
  tim                  --> Y,+2
  dir                  --> R22
  res                  --> R10
  fp                   --> R20
    01ECE 940E 4880 CALL	push_xgsetF03C
    01ED0 01A8      MOVW	R20,R16
    01ED1 9726      SBIW	R28,6
(2585) }
(2586) 
(2587) 
(2588) 
(2589) 
(2590) /*-----------------------------------------------------------------------*/
(2591) /* Synchronize the File Object                                           */
(2592) /*-----------------------------------------------------------------------*/
(2593) 
(2594) FRESULT f_sync (
(2595) 	FIL *fp		/* Pointer to the file object */
(2596) )
(2597) {
(2598) 	FRESULT res;
(2599) 	DWORD tim;
(2600) 	BYTE *dir;
(2601) 
(2602) 
(2603) 	res = validate(fp->fs, fp->id);		/* Check validity of the object */
    01ED2 01FA      MOVW	R30,R20
    01ED3 8122      LDD	R18,Z+2
    01ED4 8133      LDD	R19,Z+3
    01ED5 8100      LD	R16,Z
    01ED6 8111      LDD	R17,Z+1
    01ED7 D88E      RCALL	ff.c:validate
    01ED8 2EA0      MOV	R10,R16
(2604) 	if (res == FR_OK) {
    01ED9 2300      TST	R16
    01EDA F009      BEQ	0x1EDC
    01EDB C09F      RJMP	0x1F7B
(2605) 		if (fp->flag & FA__WRITTEN) {	/* Has the file been written? */
    01EDC 01FA      MOVW	R30,R20
    01EDD 8024      LDD	R2,Z+4
    01EDE FE25      SBRS	R2,5
    01EDF C09B      RJMP	0x1F7B
(2606) #if !_FS_TINY	/* Write-back dirty buffer */
(2607) 			if (fp->flag & FA__DIRTY) {
(2608) 				if (disk_write(fp->fs->drv, fp->buf, fp->dsect, 1) != RES_OK)
(2609) 					LEAVE_FF(fp->fs, FR_DISK_ERR);
(2610) 				fp->flag &= ~FA__DIRTY;
(2611) 			}
(2612) #endif
(2613) 			/* Update the directory entry */
(2614) 			res = move_window(fp->fs, fp->dir_sect);
    01EE0 8C22      LDD	R2,Z+26
    01EE1 8C33      LDD	R3,Z+27
    01EE2 8C44      LDD	R4,Z+28
    01EE3 8C55      LDD	R5,Z+29
    01EE4 8248      ST	Y,R4
    01EE5 8259      STD	Y+1,R5
    01EE6 0191      MOVW	R18,R2
    01EE7 8100      LD	R16,Z
    01EE8 8111      LDD	R17,Z+1
    01EE9 940E 044E CALL	ff.c:move_window
    01EEB 2EA0      MOV	R10,R16
(2615) 			if (res == FR_OK) {
    01EEC 2300      TST	R16
    01EED F009      BEQ	0x1EEF
    01EEE C08C      RJMP	0x1F7B
(2616) 				dir = fp->dir_ptr;
    01EEF 01FA      MOVW	R30,R20
    01EF0 8D66      LDD	R22,Z+30
    01EF1 8D77      LDD	R23,Z+31
(2617) 				dir[DIR_Attr] |= AM_ARC;					/* Set archive bit */
    01EF2 01CB      MOVW	R24,R22
    01EF3 960B      ADIW	R24,0xB
    01EF4 01FC      MOVW	R30,R24
    01EF5 8180      LD	R24,Z
    01EF6 6280      ORI	R24,0x20
    01EF7 8380      ST	Z,R24
(2618) 				ST_DWORD(dir+DIR_FileSize, fp->fsize);		/* Update file size */
    01EF8 01FA      MOVW	R30,R20
    01EF9 8422      LDD	R2,Z+10
    01EFA 8433      LDD	R3,Z+11
    01EFB 8444      LDD	R4,Z+12
    01EFC 8455      LDD	R5,Z+13
    01EFD 01FB      MOVW	R30,R22
    01EFE 8E24      STD	Z+28,R2
    01EFF 01FA      MOVW	R30,R20
    01F00 8422      LDD	R2,Z+10
    01F01 8433      LDD	R3,Z+11
    01F02 2C23      MOV	R2,R3
    01F03 2433      CLR	R3
    01F04 01FB      MOVW	R30,R22
    01F05 8E25      STD	Z+29,R2
    01F06 01FA      MOVW	R30,R20
    01F07 8422      LDD	R2,Z+10
    01F08 8433      LDD	R3,Z+11
    01F09 8444      LDD	R4,Z+12
    01F0A 8455      LDD	R5,Z+13
    01F0B 0112      MOVW	R2,R4
    01F0C 2444      CLR	R4
    01F0D 2455      CLR	R5
    01F0E 01FB      MOVW	R30,R22
    01F0F 8E26      STD	Z+30,R2
    01F10 E188      LDI	R24,0x18
    01F11 E090      LDI	R25,0
    01F12 01FA      MOVW	R30,R20
    01F13 8502      LDD	R16,Z+10
    01F14 8513      LDD	R17,Z+11
    01F15 8524      LDD	R18,Z+12
    01F16 8535      LDD	R19,Z+13
    01F17 938A      ST	-Y,R24
    01F18 940E 48E9 CALL	lsr32
    01F1A 01FB      MOVW	R30,R22
    01F1B 8F07      STD	Z+31,R16
(2619) 				ST_CLUST(dir, fp->sclust);					/* Update start cluster */
    01F1C 01FA      MOVW	R30,R20
    01F1D 8426      LDD	R2,Z+14
    01F1E 8437      LDD	R3,Z+15
    01F1F 8840      LDD	R4,Z+16
    01F20 8851      LDD	R5,Z+17
    01F21 01FB      MOVW	R30,R22
    01F22 8E22      STD	Z+26,R2
    01F23 01FA      MOVW	R30,R20
    01F24 8426      LDD	R2,Z+14
    01F25 8437      LDD	R3,Z+15
    01F26 2C23      MOV	R2,R3
    01F27 2433      CLR	R3
    01F28 01FB      MOVW	R30,R22
    01F29 8E23      STD	Z+27,R2
    01F2A 01FA      MOVW	R30,R20
    01F2B 8426      LDD	R2,Z+14
    01F2C 8437      LDD	R3,Z+15
    01F2D 8840      LDD	R4,Z+16
    01F2E 8851      LDD	R5,Z+17
    01F2F 0112      MOVW	R2,R4
    01F30 2444      CLR	R4
    01F31 2455      CLR	R5
    01F32 01FB      MOVW	R30,R22
    01F33 8A24      STD	Z+20,R2
    01F34 01FA      MOVW	R30,R20
    01F35 8426      LDD	R2,Z+14
    01F36 8437      LDD	R3,Z+15
    01F37 8840      LDD	R4,Z+16
    01F38 8851      LDD	R5,Z+17
    01F39 0112      MOVW	R2,R4
    01F3A 2C23      MOV	R2,R3
    01F3B 2433      CLR	R3
    01F3C 01FB      MOVW	R30,R22
    01F3D 8A25      STD	Z+21,R2
(2620) 				tim = get_fattime();						/* Update updated time */
    01F3E 940E 03F0 CALL	_get_fattime
    01F40 830A      STD	Y+2,R16
    01F41 831B      STD	Y+3,R17
    01F42 832C      STD	Y+4,R18
    01F43 833D      STD	Y+5,R19
(2621) 				ST_DWORD(dir+DIR_WrtTime, tim);
    01F44 802A      LDD	R2,Y+2
    01F45 803B      LDD	R3,Y+3
    01F46 804C      LDD	R4,Y+4
    01F47 805D      LDD	R5,Y+5
    01F48 01FB      MOVW	R30,R22
    01F49 8A26      STD	Z+22,R2
    01F4A 2C23      MOV	R2,R3
    01F4B 2433      CLR	R3
    01F4C 9677      ADIW	R30,0x17
    01F4D 8220      ST	Z,R2
    01F4E 802A      LDD	R2,Y+2
    01F4F 803B      LDD	R3,Y+3
    01F50 804C      LDD	R4,Y+4
    01F51 805D      LDD	R5,Y+5
    01F52 0112      MOVW	R2,R4
    01F53 2444      CLR	R4
    01F54 2455      CLR	R5
    01F55 01FB      MOVW	R30,R22
    01F56 9678      ADIW	R30,0x18
    01F57 8220      ST	Z,R2
    01F58 E188      LDI	R24,0x18
    01F59 E090      LDI	R25,0
    01F5A 810A      LDD	R16,Y+2
    01F5B 811B      LDD	R17,Y+3
    01F5C 812C      LDD	R18,Y+4
    01F5D 813D      LDD	R19,Y+5
    01F5E 938A      ST	-Y,R24
    01F5F 940E 48E9 CALL	lsr32
    01F61 01FB      MOVW	R30,R22
    01F62 8F01      STD	Z+25,R16
(2622) 				fp->flag &= ~FA__WRITTEN;
    01F63 01BA      MOVW	R22,R20
    01F64 5F6C      SUBI	R22,0xFC
    01F65 4F7F      SBCI	R23,0xFF
    01F66 01FB      MOVW	R30,R22
    01F67 8180      LD	R24,Z
    01F68 7D8F      ANDI	R24,0xDF
    01F69 8380      ST	Z,R24
(2623) 				fp->fs->wflag = 1;
    01F6A E081      LDI	R24,1
    01F6B 01FA      MOVW	R30,R20
    01F6C 93AF      PUSH	R26
    01F6D 93BF      PUSH	R27
    01F6E 81A0      LD	R26,Z
    01F6F 81B1      LDD	R27,Z+1
    01F70 01FD      MOVW	R30,R26
    01F71 91BF      POP	R27
    01F72 91AF      POP	R26
    01F73 8384      STD	Z+4,R24
(2624) 				res = sync(fp->fs);
    01F74 01FA      MOVW	R30,R20
    01F75 8100      LD	R16,Z
    01F76 8111      LDD	R17,Z+1
    01F77 940E 04F0 CALL	ff.c:sync
    01F79 2EC0      MOV	R12,R16
    01F7A 2CAC      MOV	R10,R12
(2625) 			}
(2626) 		}
(2627) 	}
(2628) 
(2629) 	LEAVE_FF(fp->fs, res);
    01F7B 2D0A      MOV	R16,R10
    01F7C 9626      ADIW	R28,6
    01F7D 940C 4889 JMP	pop_xgsetF03C
_f_close:
  res                  --> R10
  fp                   --> R12
    01F7F 940E 484B CALL	push_xgset003C
    01F81 0168      MOVW	R12,R16
(2630) }
(2631) 
(2632) #endif /* !_FS_READONLY */
(2633) 
(2634) 
(2635) 
(2636) 
(2637) /*-----------------------------------------------------------------------*/
(2638) /* Close File                                                            */
(2639) /*-----------------------------------------------------------------------*/
(2640) 
(2641) FRESULT f_close (
(2642) 	FIL *fp		/* Pointer to the file object to be closed */
(2643) )
(2644) {
(2645) 	FRESULT res;
(2646) 
(2647) #if _FS_READONLY
(2648) 	FATFS *fs = fp->fs;
(2649) 	res = validate(fs, fp->id);
(2650) 	if (res == FR_OK) fp->fs = 0;	/* Discard file object */
(2651) 	LEAVE_FF(fs, res);
(2652) 
(2653) #else
(2654) 	res = f_sync(fp);		/* Flush cached data */
    01F82 0186      MOVW	R16,R12
    01F83 DF4A      RCALL	_f_sync
    01F84 2EA0      MOV	R10,R16
(2655) #if _FS_SHARE
(2656) 	if (res == FR_OK) {		/* Decrement open counter */
(2657) #if _FS_REENTRANT
(2658) 		res = validate(fp->fs, fp->id);
(2659) 		if (res == FR_OK) {
(2660) 			res = dec_lock(fp->lockid);	
(2661) 			unlock_fs(fp->fs, FR_OK);
(2662) 		}
(2663) #else
(2664) 		res = dec_lock(fp->lockid);
(2665) #endif
(2666) 	}
(2667) #endif
(2668) 	if (res == FR_OK) fp->fs = 0;	/* Discard file object */
    01F85 2300      TST	R16
    01F86 F429      BNE	0x1F8C
    01F87 2422      CLR	R2
    01F88 2433      CLR	R3
    01F89 01F6      MOVW	R30,R12
    01F8A 8231      STD	Z+1,R3
    01F8B 8220      ST	Z,R2
(2669) 	return res;
    01F8C 2D0A      MOV	R16,R10
    01F8D 940C 4825 JMP	pop_xgset003C
_f_lseek:
  ifptr                --> Y,+14
  nsect                --> Y,+10
  bcs                  --> Y,+6
  clst                 --> Y,+2
  dsc                  --> Y,+26
  tlen                 --> Y,+22
  tbl                  --> R14
  tcl                  --> Y,+18
  ulen                 --> Y,+14
  ncl                  --> Y,+10
  pcl                  --> Y,+6
  cl                   --> Y,+2
  res                  --> R10
  ofs                  --> Y,+42
  fp                   --> Y,+40
    01F8F 940E 4700 CALL	push_arg4
    01F91 940E 4845 CALL	push_xgsetF0FC
    01F93 976E      SBIW	R28,0x1E
(2670) #endif
(2671) }
(2672) 
(2673) 
(2674) 
(2675) 
(2676) /*-----------------------------------------------------------------------*/
(2677) /* Current Drive/Directory Handlings                                     */
(2678) /*-----------------------------------------------------------------------*/
(2679) 
(2680) #if _FS_RPATH >= 1
(2681) 
(2682) FRESULT f_chdrive (
(2683) 	BYTE drv		/* Drive number */
(2684) )
(2685) {
(2686) 	if (drv >= _VOLUMES) return FR_INVALID_DRIVE;
(2687) 
(2688) 	CurrVol = drv;
(2689) 
(2690) 	return FR_OK;
(2691) }
(2692) 
(2693) 
(2694) 
(2695) FRESULT f_chdir (
(2696) 	const TCHAR *path	/* Pointer to the directory path */
(2697) )
(2698) {
(2699) 	FRESULT res;
(2700) 	DIR dj;
(2701) 	DEF_NAMEBUF;
(2702) 
(2703) 
(2704) 	res = chk_mounted(&path, &dj.fs, 0);
(2705) 	if (res == FR_OK) {
(2706) 		INIT_BUF(dj);
(2707) 		res = follow_path(&dj, path);		/* Follow the path */
(2708) 		FREE_BUF();
(2709) 		if (res == FR_OK) {					/* Follow completed */
(2710) 			if (!dj.dir) {
(2711) 				dj.fs->cdir = dj.sclust;	/* Start directory itself */
(2712) 			} else {
(2713) 				if (dj.dir[DIR_Attr] & AM_DIR)	/* Reached to the directory */
(2714) 					dj.fs->cdir = LD_CLUST(dj.dir);
(2715) 				else
(2716) 					res = FR_NO_PATH;		/* Reached but a file */
(2717) 			}
(2718) 		}
(2719) 		if (res == FR_NO_FILE) res = FR_NO_PATH;
(2720) 	}
(2721) 
(2722) 	LEAVE_FF(dj.fs, res);
(2723) }
(2724) 
(2725) 
(2726) #if _FS_RPATH >= 2
(2727) FRESULT f_getcwd (
(2728) 	TCHAR *path,	/* Pointer to the directory path */
(2729) 	UINT sz_path	/* Size of path */
(2730) )
(2731) {
(2732) 	FRESULT res;
(2733) 	DIR dj;
(2734) 	UINT i, n;
(2735) 	DWORD ccl;
(2736) 	TCHAR *tp;
(2737) 	FILINFO fno;
(2738) 	DEF_NAMEBUF;
(2739) 
(2740) 
(2741) 	*path = 0;
(2742) 	res = chk_mounted((const TCHAR**)&path, &dj.fs, 0);	/* Get current volume */
(2743) 	if (res == FR_OK) {
(2744) 		INIT_BUF(dj);
(2745) 		i = sz_path;		/* Bottom of buffer (dir stack base) */
(2746) 		dj.sclust = dj.fs->cdir;			/* Start to follow upper dir from current dir */
(2747) 		while ((ccl = dj.sclust) != 0) {	/* Repeat while current dir is a sub-dir */
(2748) 			res = dir_sdi(&dj, 1);			/* Get parent dir */
(2749) 			if (res != FR_OK) break;
(2750) 			res = dir_read(&dj);
(2751) 			if (res != FR_OK) break;
(2752) 			dj.sclust = LD_CLUST(dj.dir);	/* Goto parent dir */
(2753) 			res = dir_sdi(&dj, 0);
(2754) 			if (res != FR_OK) break;
(2755) 			do {							/* Find the entry links to the child dir */
(2756) 				res = dir_read(&dj);
(2757) 				if (res != FR_OK) break;
(2758) 				if (ccl == LD_CLUST(dj.dir)) break;	/* Found the entry */
(2759) 				res = dir_next(&dj, 0);	
(2760) 			} while (res == FR_OK);
(2761) 			if (res == FR_NO_FILE) res = FR_INT_ERR;/* It cannot be 'not found'. */
(2762) 			if (res != FR_OK) break;
(2763) #if _USE_LFN
(2764) 			fno.lfname = path;
(2765) 			fno.lfsize = i;
(2766) #endif
(2767) 			get_fileinfo(&dj, &fno);		/* Get the dir name and push it to the buffer */
(2768) 			tp = fno.fname;
(2769) 			if (_USE_LFN && *path) tp = path;
(2770) 			for (n = 0; tp[n]; n++) ;
(2771) 			if (i < n + 3) {
(2772) 				res = FR_NOT_ENOUGH_CORE; break;
(2773) 			}
(2774) 			while (n) path[--i] = tp[--n];
(2775) 			path[--i] = '/';
(2776) 		}
(2777) 		tp = path;
(2778) 		if (res == FR_OK) {
(2779) 			*tp++ = '0' + CurrVol;			/* Put drive number */
(2780) 			*tp++ = ':';
(2781) 			if (i == sz_path) {				/* Root-dir */
(2782) 				*tp++ = '/';
(2783) 			} else {						/* Sub-dir */
(2784) 				do		/* Add stacked path str */
(2785) 					*tp++ = path[i++];
(2786) 				while (i < sz_path);
(2787) 			}
(2788) 		}
(2789) 		*tp = 0;
(2790) 		FREE_BUF();
(2791) 	}
(2792) 
(2793) 	LEAVE_FF(dj.fs, res);
(2794) }
(2795) #endif /* _FS_RPATH >= 2 */
(2796) #endif /* _FS_RPATH >= 1 */
(2797) 
(2798) 
(2799) 
(2800) #if _FS_MINIMIZE <= 2
(2801) /*-----------------------------------------------------------------------*/
(2802) /* Seek File R/W Pointer                                                 */
(2803) /*-----------------------------------------------------------------------*/
(2804) 
(2805) FRESULT f_lseek (
(2806) 	FIL *fp,		/* Pointer to the file object */
(2807) 	DWORD ofs		/* File pointer from top of file */
(2808) )
(2809) {
(2810) 	FRESULT res;
(2811) 
(2812) 
(2813) 	res = validate(fp->fs, fp->id);		/* Check validity of the object */
    01F94 A5E8      LDD	R30,Y+40
    01F95 A5F9      LDD	R31,Y+41
    01F96 8122      LDD	R18,Z+2
    01F97 8133      LDD	R19,Z+3
    01F98 8100      LD	R16,Z
    01F99 8111      LDD	R17,Z+1
    01F9A 940E 1766 CALL	ff.c:validate
    01F9C 2EA0      MOV	R10,R16
(2814) 	if (res != FR_OK) LEAVE_FF(fp->fs, res);
    01F9D 2300      TST	R16
    01F9E F009      BEQ	0x1FA0
    01F9F C4A7      RJMP	0x2447
(2815) 	if (fp->flag & FA__ERROR)			/* Check abort flag */
    01FA0 A5E8      LDD	R30,Y+40
    01FA1 A5F9      LDD	R31,Y+41
    01FA2 8024      LDD	R2,Z+4
    01FA3 FE27      SBRS	R2,7
    01FA4 C002      RJMP	0x1FA7
(2816) 		LEAVE_FF(fp->fs, FR_INT_ERR);
    01FA5 E002      LDI	R16,2
    01FA6 C4A0      RJMP	0x2447
(2817) 
(2818) #if _USE_FASTSEEK
(2819) 	if (fp->cltbl) {	/* Fast seek */
    01FA7 A5E8      LDD	R30,Y+40
    01FA8 A5F9      LDD	R31,Y+41
    01FA9 96B0      ADIW	R30,0x20
    01FAA 8020      LD	R2,Z
    01FAB 8031      LDD	R3,Z+1
    01FAC 2022      TST	R2
    01FAD F419      BNE	0x1FB1
    01FAE 2033      TST	R3
    01FAF F409      BNE	0x1FB1
    01FB0 C1E3      RJMP	0x2194
(2820) 		DWORD cl, pcl, ncl, tcl, dsc, tlen, ulen, *tbl;
(2821) 
(2822) 		if (ofs == CREATE_LINKMAP) {	/* Create CLMT */
    01FB1 EF4F      LDI	R20,0xFF
    01FB2 EF5F      LDI	R21,0xFF
    01FB3 EF6F      LDI	R22,0xFF
    01FB4 EF7F      LDI	R23,0xFF
    01FB5 A42A      LDD	R2,Y+42
    01FB6 A43B      LDD	R3,Y+43
    01FB7 A44C      LDD	R4,Y+44
    01FB8 A45D      LDD	R5,Y+45
    01FB9 1624      CP	R2,R20
    01FBA 0635      CPC	R3,R21
    01FBB 0646      CPC	R4,R22
    01FBC 0657      CPC	R5,R23
    01FBD F009      BEQ	0x1FBF
    01FBE C109      RJMP	0x20C8
(2823) 			tbl = fp->cltbl;
    01FBF A5E8      LDD	R30,Y+40
    01FC0 A5F9      LDD	R31,Y+41
    01FC1 A0E0      LDD	R14,Z+32
    01FC2 A0F1      LDD	R15,Z+33
(2824) 			tlen = *tbl++; ulen = 2;	/* Given table size and required table size */
    01FC3 01F7      MOVW	R30,R14
    01FC4 9021      LD	R2,Z+
    01FC5 9031      LD	R3,Z+
    01FC6 9041      LD	R4,Z+
    01FC7 9051      LD	R5,Z+
    01FC8 017F      MOVW	R14,R30
    01FC9 8A2E      STD	Y+22,R2
    01FCA 8A3F      STD	Y+23,R3
    01FCB 8E48      STD	Y+24,R4
    01FCC 8E59      STD	Y+25,R5
    01FCD E082      LDI	R24,2
    01FCE 878E      STD	Y+14,R24
    01FCF E080      LDI	R24,0
    01FD0 878F      STD	Y+15,R24
    01FD1 8B88      STD	Y+16,R24
    01FD2 8B89      STD	Y+17,R24
(2825) 			cl = fp->sclust;			/* Top of the chain */
    01FD3 A5E8      LDD	R30,Y+40
    01FD4 A5F9      LDD	R31,Y+41
    01FD5 963E      ADIW	R30,0xE
    01FD6 8020      LD	R2,Z
    01FD7 8031      LDD	R3,Z+1
    01FD8 8042      LDD	R4,Z+2
    01FD9 8053      LDD	R5,Z+3
    01FDA 822A      STD	Y+2,R2
    01FDB 823B      STD	Y+3,R3
    01FDC 824C      STD	Y+4,R4
    01FDD 825D      STD	Y+5,R5
(2826) 			if (cl) {
    01FDE 802A      LDD	R2,Y+2
    01FDF 803B      LDD	R3,Y+3
    01FE0 804C      LDD	R4,Y+4
    01FE1 805D      LDD	R5,Y+5
    01FE2 9488      BCLR	0
    01FE3 2022      TST	R2
    01FE4 0432      CPC	R3,R2
    01FE5 0442      CPC	R4,R2
    01FE6 0452      CPC	R5,R2
    01FE7 F409      BNE	0x1FE9
    01FE8 C0BB      RJMP	0x20A4
(2827) 				do {
(2828) 					/* Get a fragment */
(2829) 					tcl = cl; ncl = 0; ulen += 2;	/* Top, length and used items */
    01FE9 802A      LDD	R2,Y+2
    01FEA 803B      LDD	R3,Y+3
    01FEB 804C      LDD	R4,Y+4
    01FEC 805D      LDD	R5,Y+5
    01FED 8A2A      STD	Y+18,R2
    01FEE 8A3B      STD	Y+19,R3
    01FEF 8A4C      STD	Y+20,R4
    01FF0 8A5D      STD	Y+21,R5
    01FF1 E080      LDI	R24,0
    01FF2 878A      STD	Y+10,R24
    01FF3 878B      STD	Y+11,R24
    01FF4 878C      STD	Y+12,R24
    01FF5 878D      STD	Y+13,R24
    01FF6 E042      LDI	R20,2
    01FF7 E050      LDI	R21,0
    01FF8 E060      LDI	R22,0
    01FF9 E070      LDI	R23,0
    01FFA 842E      LDD	R2,Y+14
    01FFB 843F      LDD	R3,Y+15
    01FFC 8848      LDD	R4,Y+16
    01FFD 8859      LDD	R5,Y+17
    01FFE 0E24      ADD	R2,R20
    01FFF 1E35      ADC	R3,R21
    02000 1E46      ADC	R4,R22
    02001 1E57      ADC	R5,R23
    02002 862E      STD	Y+14,R2
    02003 863F      STD	Y+15,R3
    02004 8A48      STD	Y+16,R4
    02005 8A59      STD	Y+17,R5
(2830) 					do {
(2831) 						pcl = cl; ncl++;
    02006 802A      LDD	R2,Y+2
    02007 803B      LDD	R3,Y+3
    02008 804C      LDD	R4,Y+4
    02009 805D      LDD	R5,Y+5
    0200A 822E      STD	Y+6,R2
    0200B 823F      STD	Y+7,R3
    0200C 8648      STD	Y+8,R4
    0200D 8659      STD	Y+9,R5
    0200E E041      LDI	R20,1
    0200F E050      LDI	R21,0
    02010 E060      LDI	R22,0
    02011 E070      LDI	R23,0
    02012 842A      LDD	R2,Y+10
    02013 843B      LDD	R3,Y+11
    02014 844C      LDD	R4,Y+12
    02015 845D      LDD	R5,Y+13
    02016 0E24      ADD	R2,R20
    02017 1E35      ADC	R3,R21
    02018 1E46      ADC	R4,R22
    02019 1E57      ADC	R5,R23
    0201A 862A      STD	Y+10,R2
    0201B 863B      STD	Y+11,R3
    0201C 864C      STD	Y+12,R4
    0201D 865D      STD	Y+13,R5
(2832) 						cl = get_fat(fp->fs, cl);
    0201E 802A      LDD	R2,Y+2
    0201F 803B      LDD	R3,Y+3
    02020 804C      LDD	R4,Y+4
    02021 805D      LDD	R5,Y+5
    02022 8248      ST	Y,R4
    02023 8259      STD	Y+1,R5
    02024 0191      MOVW	R18,R2
    02025 A5E8      LDD	R30,Y+40
    02026 A5F9      LDD	R31,Y+41
    02027 8100      LD	R16,Z
    02028 8111      LDD	R17,Z+1
    02029 940E 0617 CALL	_get_fat
    0202B 830A      STD	Y+2,R16
    0202C 831B      STD	Y+3,R17
    0202D 832C      STD	Y+4,R18
    0202E 833D      STD	Y+5,R19
(2833) 						if (cl <= 1) ABORT(fp->fs, FR_INT_ERR);
    0202F E041      LDI	R20,1
    02030 E050      LDI	R21,0
    02031 E060      LDI	R22,0
    02032 E070      LDI	R23,0
    02033 802A      LDD	R2,Y+2
    02034 803B      LDD	R3,Y+3
    02035 804C      LDD	R4,Y+4
    02036 805D      LDD	R5,Y+5
    02037 1542      CP	R20,R2
    02038 0553      CPC	R21,R3
    02039 0564      CPC	R22,R4
    0203A 0575      CPC	R23,R5
    0203B F048      BCS	0x2045
    0203C A588      LDD	R24,Y+40
    0203D A599      LDD	R25,Y+41
    0203E 9604      ADIW	R24,4
    0203F 01FC      MOVW	R30,R24
    02040 8180      LD	R24,Z
    02041 6880      ORI	R24,0x80
    02042 8380      ST	Z,R24
    02043 E002      LDI	R16,2
    02044 C402      RJMP	0x2447
(2834) 						if (cl == 0xFFFFFFFF) ABORT(fp->fs, FR_DISK_ERR);
    02045 EF4F      LDI	R20,0xFF
    02046 EF5F      LDI	R21,0xFF
    02047 EF6F      LDI	R22,0xFF
    02048 EF7F      LDI	R23,0xFF
    02049 802A      LDD	R2,Y+2
    0204A 803B      LDD	R3,Y+3
    0204B 804C      LDD	R4,Y+4
    0204C 805D      LDD	R5,Y+5
    0204D 1624      CP	R2,R20
    0204E 0635      CPC	R3,R21
    0204F 0646      CPC	R4,R22
    02050 0657      CPC	R5,R23
    02051 F451      BNE	0x205C
    02052 A588      LDD	R24,Y+40
    02053 A599      LDD	R25,Y+41
    02054 9604      ADIW	R24,4
    02055 016C      MOVW	R12,R24
    02056 01FC      MOVW	R30,R24
    02057 8180      LD	R24,Z
    02058 6880      ORI	R24,0x80
    02059 8380      ST	Z,R24
    0205A E001      LDI	R16,1
    0205B C3EB      RJMP	0x2447
(2835) 					} while (cl == pcl + 1);
    0205C E041      LDI	R20,1
    0205D E050      LDI	R21,0
    0205E E060      LDI	R22,0
    0205F E070      LDI	R23,0
    02060 802E      LDD	R2,Y+6
    02061 803F      LDD	R3,Y+7
    02062 8448      LDD	R4,Y+8
    02063 8459      LDD	R5,Y+9
    02064 0E24      ADD	R2,R20
    02065 1E35      ADC	R3,R21
    02066 1E46      ADC	R4,R22
    02067 1E57      ADC	R5,R23
    02068 806A      LDD	R6,Y+2
    02069 807B      LDD	R7,Y+3
    0206A 808C      LDD	R8,Y+4
    0206B 809D      LDD	R9,Y+5
    0206C 1462      CP	R6,R2
    0206D 0473      CPC	R7,R3
    0206E 0484      CPC	R8,R4
    0206F 0495      CPC	R9,R5
    02070 F409      BNE	0x2072
    02071 CF94      RJMP	0x2006
(2836) 					if (ulen <= tlen) {		/* Store the length and top of the fragment */
    02072 882E      LDD	R2,Y+22
    02073 883F      LDD	R3,Y+23
    02074 8C48      LDD	R4,Y+24
    02075 8C59      LDD	R5,Y+25
    02076 846E      LDD	R6,Y+14
    02077 847F      LDD	R7,Y+15
    02078 8888      LDD	R8,Y+16
    02079 8899      LDD	R9,Y+17
    0207A 1426      CP	R2,R6
    0207B 0437      CPC	R3,R7
    0207C 0448      CPC	R4,R8
    0207D 0459      CPC	R5,R9
    0207E F090      BCS	0x2091
(2837) 						*tbl++ = ncl; *tbl++ = tcl;
    0207F 842A      LDD	R2,Y+10
    02080 843B      LDD	R3,Y+11
    02081 844C      LDD	R4,Y+12
    02082 845D      LDD	R5,Y+13
    02083 01F7      MOVW	R30,R14
    02084 9221      ST	Z+,R2
    02085 9231      ST	Z+,R3
    02086 9241      ST	Z+,R4
    02087 9251      ST	Z+,R5
    02088 882A      LDD	R2,Y+18
    02089 883B      LDD	R3,Y+19
    0208A 884C      LDD	R4,Y+20
    0208B 885D      LDD	R5,Y+21
    0208C 9221      ST	Z+,R2
    0208D 9231      ST	Z+,R3
    0208E 9241      ST	Z+,R4
    0208F 9251      ST	Z+,R5
    02090 017F      MOVW	R14,R30
(2838) 					}
(2839) 				} while (cl < fp->fs->n_fatent);	/* Repeat until end of chain */
    02091 A5E8      LDD	R30,Y+40
    02092 A5F9      LDD	R31,Y+41
    02093 81A0      LD	R26,Z
    02094 81B1      LDD	R27,Z+1
    02095 9656      ADIW	R26,0x16
    02096 902D      LD	R2,X+
    02097 903D      LD	R3,X+
    02098 904D      LD	R4,X+
    02099 905C      LD	R5,X
    0209A 806A      LDD	R6,Y+2
    0209B 807B      LDD	R7,Y+3
    0209C 808C      LDD	R8,Y+4
    0209D 809D      LDD	R9,Y+5
    0209E 1462      CP	R6,R2
    0209F 0473      CPC	R7,R3
    020A0 0484      CPC	R8,R4
    020A1 0495      CPC	R9,R5
    020A2 F408      BCC	0x20A4
    020A3 CF45      RJMP	0x1FE9
(2840) 			}
(2841) 			*fp->cltbl = ulen;	/* Number of items used */
    020A4 842E      LDD	R2,Y+14
    020A5 843F      LDD	R3,Y+15
    020A6 8848      LDD	R4,Y+16
    020A7 8859      LDD	R5,Y+17
    020A8 A5E8      LDD	R30,Y+40
    020A9 A5F9      LDD	R31,Y+41
    020AA 96B0      ADIW	R30,0x20
    020AB 81A0      LD	R26,Z
    020AC 81B1      LDD	R27,Z+1
    020AD 922D      ST	X+,R2
    020AE 923D      ST	X+,R3
    020AF 924D      ST	X+,R4
    020B0 925C      ST	X,R5
(2842) 			if (ulen <= tlen)
    020B1 882E      LDD	R2,Y+22
    020B2 883F      LDD	R3,Y+23
    020B3 8C48      LDD	R4,Y+24
    020B4 8C59      LDD	R5,Y+25
    020B5 846E      LDD	R6,Y+14
    020B6 847F      LDD	R7,Y+15
    020B7 8888      LDD	R8,Y+16
    020B8 8899      LDD	R9,Y+17
    020B9 1426      CP	R2,R6
    020BA 0437      CPC	R3,R7
    020BB 0448      CPC	R4,R8
    020BC 0459      CPC	R5,R9
    020BD F038      BCS	0x20C5
(2843) 				*tbl = 0;		/* Terminate table */
    020BE 01F7      MOVW	R30,R14
    020BF E080      LDI	R24,0
    020C0 8380      ST	Z,R24
    020C1 8381      STD	Z+1,R24
    020C2 8382      STD	Z+2,R24
    020C3 8383      STD	Z+3,R24
    020C4 C381      RJMP	0x2446
(2844) 			else
(2845) 				res = FR_NOT_ENOUGH_CORE;	/* Given table size is smaller than required */
    020C5 E181      LDI	R24,0x11
    020C6 2EA8      MOV	R10,R24
(2846) 
(2847) 		} else {						/* Fast seek */
    020C7 C37E      RJMP	0x2446
(2848) 			if (ofs > fp->fsize)		/* Clip offset at the file size */
    020C8 A5E8      LDD	R30,Y+40
    020C9 A5F9      LDD	R31,Y+41
    020CA 963A      ADIW	R30,0xA
    020CB 8020      LD	R2,Z
    020CC 8031      LDD	R3,Z+1
    020CD 8042      LDD	R4,Z+2
    020CE 8053      LDD	R5,Z+3
    020CF A46A      LDD	R6,Y+42
    020D0 A47B      LDD	R7,Y+43
    020D1 A48C      LDD	R8,Y+44
    020D2 A49D      LDD	R9,Y+45
    020D3 1426      CP	R2,R6
    020D4 0437      CPC	R3,R7
    020D5 0448      CPC	R4,R8
    020D6 0459      CPC	R5,R9
    020D7 F458      BCC	0x20E3
(2849) 				ofs = fp->fsize;
    020D8 A5E8      LDD	R30,Y+40
    020D9 A5F9      LDD	R31,Y+41
    020DA 963A      ADIW	R30,0xA
    020DB 8020      LD	R2,Z
    020DC 8031      LDD	R3,Z+1
    020DD 8042      LDD	R4,Z+2
    020DE 8053      LDD	R5,Z+3
    020DF A62A      STD	Y+42,R2
    020E0 A63B      STD	Y+43,R3
    020E1 A64C      STD	Y+44,R4
    020E2 A65D      STD	Y+45,R5
(2850) 			fp->fptr = ofs;				/* Set file pointer */
    020E3 A42A      LDD	R2,Y+42
    020E4 A43B      LDD	R3,Y+43
    020E5 A44C      LDD	R4,Y+44
    020E6 A45D      LDD	R5,Y+45
    020E7 A5E8      LDD	R30,Y+40
    020E8 A5F9      LDD	R31,Y+41
    020E9 9636      ADIW	R30,6
    020EA 8220      ST	Z,R2
    020EB 8231      STD	Z+1,R3
    020EC 8242      STD	Z+2,R4
    020ED 8253      STD	Z+3,R5
(2851) 			if (ofs) {
    020EE 9488      BCLR	0
    020EF 2022      TST	R2
    020F0 0432      CPC	R3,R2
    020F1 0442      CPC	R4,R2
    020F2 0452      CPC	R5,R2
    020F3 F409      BNE	0x20F5
    020F4 C351      RJMP	0x2446
(2852) 				fp->clust = clmt_clust(fp, ofs - 1);
    020F5 E041      LDI	R20,1
    020F6 E050      LDI	R21,0
    020F7 E060      LDI	R22,0
    020F8 E070      LDI	R23,0
    020F9 1A24      SUB	R2,R20
    020FA 0A35      SBC	R3,R21
    020FB 0A46      SBC	R4,R22
    020FC 0A57      SBC	R5,R23
    020FD 8248      ST	Y,R4
    020FE 8259      STD	Y+1,R5
    020FF 0191      MOVW	R18,R2
    02100 A508      LDD	R16,Y+40
    02101 A519      LDD	R17,Y+41
    02102 940E 0B51 CALL	ff.c:clmt_clust
    02104 A5E8      LDD	R30,Y+40
    02105 A5F9      LDD	R31,Y+41
    02106 8B02      STD	Z+18,R16
    02107 8B13      STD	Z+19,R17
    02108 8B24      STD	Z+20,R18
    02109 8B35      STD	Z+21,R19
(2853) 				dsc = clust2sect(fp->fs, fp->clust);
    0210A 8822      LDD	R2,Z+18
    0210B 8833      LDD	R3,Z+19
    0210C 8844      LDD	R4,Z+20
    0210D 8855      LDD	R5,Z+21
    0210E 8248      ST	Y,R4
    0210F 8259      STD	Y+1,R5
    02110 0191      MOVW	R18,R2
    02111 8100      LD	R16,Z
    02112 8111      LDD	R17,Z+1
    02113 940E 05C5 CALL	_clust2sect
    02115 8F0A      STD	Y+26,R16
    02116 8F1B      STD	Y+27,R17
    02117 8F2C      STD	Y+28,R18
    02118 8F3D      STD	Y+29,R19
(2854) 				if (!dsc) ABORT(fp->fs, FR_INT_ERR);
    02119 8C2A      LDD	R2,Y+26
    0211A 8C3B      LDD	R3,Y+27
    0211B 8C4C      LDD	R4,Y+28
    0211C 8C5D      LDD	R5,Y+29
    0211D 9488      BCLR	0
    0211E 2022      TST	R2
    0211F 0432      CPC	R3,R2
    02120 0442      CPC	R4,R2
    02121 0452      CPC	R5,R2
    02122 F451      BNE	0x212D
    02123 A588      LDD	R24,Y+40
    02124 A599      LDD	R25,Y+41
    02125 9604      ADIW	R24,4
    02126 017C      MOVW	R14,R24
    02127 01FC      MOVW	R30,R24
    02128 8180      LD	R24,Z
    02129 6880      ORI	R24,0x80
    0212A 8380      ST	Z,R24
    0212B E002      LDI	R16,2
    0212C C31A      RJMP	0x2447
(2855) 				dsc += (ofs - 1) / SS(fp->fs) & (fp->fs->csize - 1);
    0212D E041      LDI	R20,1
    0212E E050      LDI	R21,0
    0212F E060      LDI	R22,0
    02130 E070      LDI	R23,0
    02131 A50A      LDD	R16,Y+42
    02132 A51B      LDD	R17,Y+43
    02133 A52C      LDD	R18,Y+44
    02134 A53D      LDD	R19,Y+45
    02135 1B04      SUB	R16,R20
    02136 0B15      SBC	R17,R21
    02137 0B26      SBC	R18,R22
    02138 0B37      SBC	R19,R23
    02139 E089      LDI	R24,0x9
    0213A E090      LDI	R25,0
    0213B 938A      ST	-Y,R24
    0213C 940E 48E9 CALL	lsr32
    0213E 0118      MOVW	R2,R16
    0213F 0129      MOVW	R4,R18
    02140 A5E8      LDD	R30,Y+40
    02141 A5F9      LDD	R31,Y+41
    02142 93AF      PUSH	R26
    02143 93BF      PUSH	R27
    02144 81A0      LD	R26,Z
    02145 81B1      LDD	R27,Z+1
    02146 01FD      MOVW	R30,R26
    02147 91BF      POP	R27
    02148 91AF      POP	R26
    02149 9632      ADIW	R30,2
    0214A 8180      LD	R24,Z
    0214B 2799      CLR	R25
    0214C 9701      SBIW	R24,1
    0214D 013C      MOVW	R6,R24
    0214E 2488      CLR	R8
    0214F FC77      SBRC	R7,7
    02150 9480      COM	R8
    02151 2499      CLR	R9
    02152 FC87      SBRC	R8,7
    02153 9490      COM	R9
    02154 2026      AND	R2,R6
    02155 2037      AND	R3,R7
    02156 2048      AND	R4,R8
    02157 2059      AND	R5,R9
    02158 8C6A      LDD	R6,Y+26
    02159 8C7B      LDD	R7,Y+27
    0215A 8C8C      LDD	R8,Y+28
    0215B 8C9D      LDD	R9,Y+29
    0215C 0C62      ADD	R6,R2
    0215D 1C73      ADC	R7,R3
    0215E 1C84      ADC	R8,R4
    0215F 1C95      ADC	R9,R5
    02160 8E6A      STD	Y+26,R6
    02161 8E7B      STD	Y+27,R7
    02162 8E8C      STD	Y+28,R8
    02163 8E9D      STD	Y+29,R9
(2856) 				if (fp->fptr % SS(fp->fs) && dsc != fp->dsect) {	/* Refill sector cache if needed */
    02164 EF4F      LDI	R20,0xFF
    02165 E051      LDI	R21,1
    02166 E060      LDI	R22,0
    02167 E070      LDI	R23,0
    02168 A5E8      LDD	R30,Y+40
    02169 A5F9      LDD	R31,Y+41
    0216A 9636      ADIW	R30,6
    0216B 8020      LD	R2,Z
    0216C 8031      LDD	R3,Z+1
    0216D 8042      LDD	R4,Z+2
    0216E 8053      LDD	R5,Z+3
    0216F 2224      AND	R2,R20
    02170 2235      AND	R3,R21
    02171 2246      AND	R4,R22
    02172 2257      AND	R5,R23
    02173 9488      BCLR	0
    02174 2022      TST	R2
    02175 0432      CPC	R3,R2
    02176 0442      CPC	R4,R2
    02177 0452      CPC	R5,R2
    02178 F409      BNE	0x217A
    02179 C2CC      RJMP	0x2446
    0217A A5E8      LDD	R30,Y+40
    0217B A5F9      LDD	R31,Y+41
    0217C 9676      ADIW	R30,0x16
    0217D 8020      LD	R2,Z
    0217E 8031      LDD	R3,Z+1
    0217F 8042      LDD	R4,Z+2
    02180 8053      LDD	R5,Z+3
    02181 8C6A      LDD	R6,Y+26
    02182 8C7B      LDD	R7,Y+27
    02183 8C8C      LDD	R8,Y+28
    02184 8C9D      LDD	R9,Y+29
    02185 1462      CP	R6,R2
    02186 0473      CPC	R7,R3
    02187 0484      CPC	R8,R4
    02188 0495      CPC	R9,R5
    02189 F409      BNE	0x218B
    0218A C2BB      RJMP	0x2446
(2857) #if !_FS_TINY
(2858) #if !_FS_READONLY
(2859) 					if (fp->flag & FA__DIRTY) {		/* Write-back dirty sector cache */
(2860) 						if (disk_write(fp->fs->drv, fp->buf, fp->dsect, 1) != RES_OK)
(2861) 							ABORT(fp->fs, FR_DISK_ERR);
(2862) 						fp->flag &= ~FA__DIRTY;
(2863) 					}
(2864) #endif
(2865) 					if (disk_read(fp->fs->drv, fp->buf, dsc, 1) != RES_OK)	/* Load current sector */
(2866) 						ABORT(fp->fs, FR_DISK_ERR);
(2867) #endif
(2868) 					fp->dsect = dsc;
    0218B 0113      MOVW	R2,R6
    0218C 0124      MOVW	R4,R8
    0218D A5E8      LDD	R30,Y+40
    0218E A5F9      LDD	R31,Y+41
    0218F 8A26      STD	Z+22,R2
    02190 8A37      STD	Z+23,R3
    02191 8E40      STD	Z+24,R4
    02192 8E51      STD	Z+25,R5
(2869) 				}
(2870) 			}
(2871) 		}
(2872) 	} else
    02193 C2B2      RJMP	0x2446
(2873) #endif
(2874) 
(2875) 	/* Normal Seek */
(2876) 	{
(2877) 		DWORD clst, bcs, nsect, ifptr;
(2878) 
(2879) 		if (ofs > fp->fsize					/* In read-only mode, clip offset with the file size */
    02194 A5E8      LDD	R30,Y+40
    02195 A5F9      LDD	R31,Y+41
    02196 963A      ADIW	R30,0xA
    02197 8020      LD	R2,Z
    02198 8031      LDD	R3,Z+1
    02199 8042      LDD	R4,Z+2
    0219A 8053      LDD	R5,Z+3
    0219B A46A      LDD	R6,Y+42
    0219C A47B      LDD	R7,Y+43
    0219D A48C      LDD	R8,Y+44
    0219E A49D      LDD	R9,Y+45
    0219F 1426      CP	R2,R6
    021A0 0437      CPC	R3,R7
    021A1 0448      CPC	R4,R8
    021A2 0459      CPC	R5,R9
    021A3 F470      BCC	0x21B2
    021A4 A5E8      LDD	R30,Y+40
    021A5 A5F9      LDD	R31,Y+41
    021A6 8024      LDD	R2,Z+4
    021A7 FC21      SBRC	R2,1
    021A8 C009      RJMP	0x21B2
(2880) #if !_FS_READONLY
(2881) 			 && !(fp->flag & FA_WRITE)
(2882) #endif
(2883) 			) ofs = fp->fsize;
    021A9 963A      ADIW	R30,0xA
    021AA 8020      LD	R2,Z
    021AB 8031      LDD	R3,Z+1
    021AC 8042      LDD	R4,Z+2
    021AD 8053      LDD	R5,Z+3
    021AE A62A      STD	Y+42,R2
    021AF A63B      STD	Y+43,R3
    021B0 A64C      STD	Y+44,R4
    021B1 A65D      STD	Y+45,R5
(2884) 
(2885) 		ifptr = fp->fptr;
    021B2 A5E8      LDD	R30,Y+40
    021B3 A5F9      LDD	R31,Y+41
    021B4 9636      ADIW	R30,6
    021B5 8020      LD	R2,Z
    021B6 8031      LDD	R3,Z+1
    021B7 8042      LDD	R4,Z+2
    021B8 8053      LDD	R5,Z+3
    021B9 862E      STD	Y+14,R2
    021BA 863F      STD	Y+15,R3
    021BB 8A48      STD	Y+16,R4
    021BC 8A59      STD	Y+17,R5
(2886) 		fp->fptr = nsect = 0;
    021BD E080      LDI	R24,0
    021BE 878A      STD	Y+10,R24
    021BF 878B      STD	Y+11,R24
    021C0 878C      STD	Y+12,R24
    021C1 878D      STD	Y+13,R24
    021C2 A5E8      LDD	R30,Y+40
    021C3 A5F9      LDD	R31,Y+41
    021C4 9636      ADIW	R30,6
    021C5 E080      LDI	R24,0
    021C6 8380      ST	Z,R24
    021C7 8381      STD	Z+1,R24
    021C8 8382      STD	Z+2,R24
    021C9 8383      STD	Z+3,R24
(2887) 		if (ofs) {
    021CA A42A      LDD	R2,Y+42
    021CB A43B      LDD	R3,Y+43
    021CC A44C      LDD	R4,Y+44
    021CD A45D      LDD	R5,Y+45
    021CE 9488      BCLR	0
    021CF 2022      TST	R2
    021D0 0432      CPC	R3,R2
    021D1 0442      CPC	R4,R2
    021D2 0452      CPC	R5,R2
    021D3 F409      BNE	0x21D5
    021D4 C226      RJMP	0x23FB
(2888) 			bcs = (DWORD)fp->fs->csize * SS(fp->fs);	/* Cluster size (byte) */
    021D5 A5E8      LDD	R30,Y+40
    021D6 A5F9      LDD	R31,Y+41
    021D7 93AF      PUSH	R26
    021D8 93BF      PUSH	R27
    021D9 81A0      LD	R26,Z
    021DA 81B1      LDD	R27,Z+1
    021DB 01FD      MOVW	R30,R26
    021DC 91BF      POP	R27
    021DD 91AF      POP	R26
    021DE 9632      ADIW	R30,2
    021DF 8020      LD	R2,Z
    021E0 2433      CLR	R3
    021E1 2444      CLR	R4
    021E2 2455      CLR	R5
    021E3 E040      LDI	R20,0
    021E4 E052      LDI	R21,2
    021E5 E060      LDI	R22,0
    021E6 E070      LDI	R23,0
    021E7 925A      ST	-Y,R5
    021E8 924A      ST	-Y,R4
    021E9 923A      ST	-Y,R3
    021EA 922A      ST	-Y,R2
    021EB 018A      MOVW	R16,R20
    021EC 019B      MOVW	R18,R22
    021ED 940E 47F1 CALL	empy32s|empy32u
    021EF 830E      STD	Y+6,R16
    021F0 831F      STD	Y+7,R17
    021F1 8728      STD	Y+8,R18
    021F2 8739      STD	Y+9,R19
(2889) 			if (ifptr > 0 &&
    021F3 842E      LDD	R2,Y+14
    021F4 843F      LDD	R3,Y+15
    021F5 8848      LDD	R4,Y+16
    021F6 8859      LDD	R5,Y+17
    021F7 9488      BCLR	0
    021F8 2022      TST	R2
    021F9 0432      CPC	R3,R2
    021FA 0442      CPC	R4,R2
    021FB 0452      CPC	R5,R2
    021FC F409      BNE	0x21FE
    021FD C075      RJMP	0x2273
    021FE E041      LDI	R20,1
    021FF E050      LDI	R21,0
    02200 E060      LDI	R22,0
    02201 E070      LDI	R23,0
    02202 0181      MOVW	R16,R2
    02203 0192      MOVW	R18,R4
    02204 1B04      SUB	R16,R20
    02205 0B15      SBC	R17,R21
    02206 0B26      SBC	R18,R22
    02207 0B37      SBC	R19,R23
    02208 802E      LDD	R2,Y+6
    02209 803F      LDD	R3,Y+7
    0220A 8448      LDD	R4,Y+8
    0220B 8459      LDD	R5,Y+9
    0220C 925A      ST	-Y,R5
    0220D 924A      ST	-Y,R4
    0220E 923A      ST	-Y,R3
    0220F 922A      ST	-Y,R2
    02210 940E 474B CALL	div32u
    02212 0118      MOVW	R2,R16
    02213 0129      MOVW	R4,R18
    02214 E041      LDI	R20,1
    02215 E050      LDI	R21,0
    02216 E060      LDI	R22,0
    02217 E070      LDI	R23,0
    02218 A50A      LDD	R16,Y+42
    02219 A51B      LDD	R17,Y+43
    0221A A52C      LDD	R18,Y+44
    0221B A53D      LDD	R19,Y+45
    0221C 1B04      SUB	R16,R20
    0221D 0B15      SBC	R17,R21
    0221E 0B26      SBC	R18,R22
    0221F 0B37      SBC	R19,R23
    02220 806E      LDD	R6,Y+6
    02221 807F      LDD	R7,Y+7
    02222 8488      LDD	R8,Y+8
    02223 8499      LDD	R9,Y+9
    02224 929A      ST	-Y,R9
    02225 928A      ST	-Y,R8
    02226 927A      ST	-Y,R7
    02227 926A      ST	-Y,R6
    02228 940E 474B CALL	div32u
    0222A 1502      CP	R16,R2
    0222B 0513      CPC	R17,R3
    0222C 0524      CPC	R18,R4
    0222D 0535      CPC	R19,R5
    0222E F408      BCC	0x2230
    0222F C043      RJMP	0x2273
(2890) 				(ofs - 1) / bcs >= (ifptr - 1) / bcs) {	/* When seek to same or following cluster, */
(2891) 				fp->fptr = (ifptr - 1) & ~(bcs - 1);	/* start from the current cluster */
    02230 E041      LDI	R20,1
    02231 E050      LDI	R21,0
    02232 E060      LDI	R22,0
    02233 E070      LDI	R23,0
    02234 802E      LDD	R2,Y+6
    02235 803F      LDD	R3,Y+7
    02236 8448      LDD	R4,Y+8
    02237 8459      LDD	R5,Y+9
    02238 1A24      SUB	R2,R20
    02239 0A35      SBC	R3,R21
    0223A 0A46      SBC	R4,R22
    0223B 0A57      SBC	R5,R23
    0223C 9420      COM	R2
    0223D 9430      COM	R3
    0223E 9440      COM	R4
    0223F 9450      COM	R5
    02240 E041      LDI	R20,1
    02241 E050      LDI	R21,0
    02242 E060      LDI	R22,0
    02243 E070      LDI	R23,0
    02244 846E      LDD	R6,Y+14
    02245 847F      LDD	R7,Y+15
    02246 8888      LDD	R8,Y+16
    02247 8899      LDD	R9,Y+17
    02248 1A64      SUB	R6,R20
    02249 0A75      SBC	R7,R21
    0224A 0A86      SBC	R8,R22
    0224B 0A97      SBC	R9,R23
    0224C 2062      AND	R6,R2
    0224D 2073      AND	R7,R3
    0224E 2084      AND	R8,R4
    0224F 2095      AND	R9,R5
    02250 A5E8      LDD	R30,Y+40
    02251 A5F9      LDD	R31,Y+41
    02252 8266      STD	Z+6,R6
    02253 8277      STD	Z+7,R7
    02254 8680      STD	Z+8,R8
    02255 8691      STD	Z+9,R9
(2892) 				ofs -= fp->fptr;
    02256 9636      ADIW	R30,6
    02257 8020      LD	R2,Z
    02258 8031      LDD	R3,Z+1
    02259 8042      LDD	R4,Z+2
    0225A 8053      LDD	R5,Z+3
    0225B A46A      LDD	R6,Y+42
    0225C A47B      LDD	R7,Y+43
    0225D A48C      LDD	R8,Y+44
    0225E A49D      LDD	R9,Y+45
    0225F 1862      SUB	R6,R2
    02260 0873      SBC	R7,R3
    02261 0884      SBC	R8,R4
    02262 0895      SBC	R9,R5
    02263 A66A      STD	Y+42,R6
    02264 A67B      STD	Y+43,R7
    02265 A68C      STD	Y+44,R8
    02266 A69D      STD	Y+45,R9
(2893) 				clst = fp->clust;
    02267 A5E8      LDD	R30,Y+40
    02268 A5F9      LDD	R31,Y+41
    02269 9672      ADIW	R30,0x12
    0226A 8020      LD	R2,Z
    0226B 8031      LDD	R3,Z+1
    0226C 8042      LDD	R4,Z+2
    0226D 8053      LDD	R5,Z+3
    0226E 822A      STD	Y+2,R2
    0226F 823B      STD	Y+3,R3
    02270 824C      STD	Y+4,R4
    02271 825D      STD	Y+5,R5
(2894) 			} else {									/* When seek to back cluster, */
    02272 C069      RJMP	0x22DC
(2895) 				clst = fp->sclust;						/* start from the first cluster */
    02273 A5E8      LDD	R30,Y+40
    02274 A5F9      LDD	R31,Y+41
    02275 963E      ADIW	R30,0xE
    02276 8020      LD	R2,Z
    02277 8031      LDD	R3,Z+1
    02278 8042      LDD	R4,Z+2
    02279 8053      LDD	R5,Z+3
    0227A 822A      STD	Y+2,R2
    0227B 823B      STD	Y+3,R3
    0227C 824C      STD	Y+4,R4
    0227D 825D      STD	Y+5,R5
(2896) #if !_FS_READONLY
(2897) 				if (clst == 0) {						/* If no cluster chain, create a new chain */
    0227E 802A      LDD	R2,Y+2
    0227F 803B      LDD	R3,Y+3
    02280 804C      LDD	R4,Y+4
    02281 805D      LDD	R5,Y+5
    02282 9488      BCLR	0
    02283 2022      TST	R2
    02284 0432      CPC	R3,R2
    02285 0442      CPC	R4,R2
    02286 0452      CPC	R5,R2
    02287 F009      BEQ	0x2289
    02288 C049      RJMP	0x22D2
(2898) 					clst = create_chain(fp->fs, 0);
    02289 E040      LDI	R20,0
    0228A E050      LDI	R21,0
    0228B E060      LDI	R22,0
    0228C E070      LDI	R23,0
    0228D 8368      ST	Y,R22
    0228E 8379      STD	Y+1,R23
    0228F 019A      MOVW	R18,R20
    02290 A5E8      LDD	R30,Y+40
    02291 A5F9      LDD	R31,Y+41
    02292 8100      LD	R16,Z
    02293 8111      LDD	R17,Z+1
    02294 940E 09D9 CALL	ff.c:create_chain
    02296 830A      STD	Y+2,R16
    02297 831B      STD	Y+3,R17
    02298 832C      STD	Y+4,R18
    02299 833D      STD	Y+5,R19
(2899) 					if (clst == 1) ABORT(fp->fs, FR_INT_ERR);
    0229A E041      LDI	R20,1
    0229B E050      LDI	R21,0
    0229C E060      LDI	R22,0
    0229D E070      LDI	R23,0
    0229E 802A      LDD	R2,Y+2
    0229F 803B      LDD	R3,Y+3
    022A0 804C      LDD	R4,Y+4
    022A1 805D      LDD	R5,Y+5
    022A2 1624      CP	R2,R20
    022A3 0635      CPC	R3,R21
    022A4 0646      CPC	R4,R22
    022A5 0657      CPC	R5,R23
    022A6 F451      BNE	0x22B1
    022A7 A588      LDD	R24,Y+40
    022A8 A599      LDD	R25,Y+41
    022A9 9604      ADIW	R24,4
    022AA 017C      MOVW	R14,R24
    022AB 01FC      MOVW	R30,R24
    022AC 8180      LD	R24,Z
    022AD 6880      ORI	R24,0x80
    022AE 8380      ST	Z,R24
    022AF E002      LDI	R16,2
    022B0 C196      RJMP	0x2447
(2900) 					if (clst == 0xFFFFFFFF) ABORT(fp->fs, FR_DISK_ERR);
    022B1 EF4F      LDI	R20,0xFF
    022B2 EF5F      LDI	R21,0xFF
    022B3 EF6F      LDI	R22,0xFF
    022B4 EF7F      LDI	R23,0xFF
    022B5 802A      LDD	R2,Y+2
    022B6 803B      LDD	R3,Y+3
    022B7 804C      LDD	R4,Y+4
    022B8 805D      LDD	R5,Y+5
    022B9 1624      CP	R2,R20
    022BA 0635      CPC	R3,R21
    022BB 0646      CPC	R4,R22
    022BC 0657      CPC	R5,R23
    022BD F451      BNE	0x22C8
    022BE A588      LDD	R24,Y+40
    022BF A599      LDD	R25,Y+41
    022C0 9604      ADIW	R24,4
    022C1 017C      MOVW	R14,R24
    022C2 01FC      MOVW	R30,R24
    022C3 8180      LD	R24,Z
    022C4 6880      ORI	R24,0x80
    022C5 8380      ST	Z,R24
    022C6 E001      LDI	R16,1
    022C7 C17F      RJMP	0x2447
(2901) 					fp->sclust = clst;
    022C8 802A      LDD	R2,Y+2
    022C9 803B      LDD	R3,Y+3
    022CA 804C      LDD	R4,Y+4
    022CB 805D      LDD	R5,Y+5
    022CC A5E8      LDD	R30,Y+40
    022CD A5F9      LDD	R31,Y+41
    022CE 8626      STD	Z+14,R2
    022CF 8637      STD	Z+15,R3
    022D0 8A40      STD	Z+16,R4
    022D1 8A51      STD	Z+17,R5
(2902) 				}
(2903) #endif
(2904) 				fp->clust = clst;
    022D2 802A      LDD	R2,Y+2
    022D3 803B      LDD	R3,Y+3
    022D4 804C      LDD	R4,Y+4
    022D5 805D      LDD	R5,Y+5
    022D6 A5E8      LDD	R30,Y+40
    022D7 A5F9      LDD	R31,Y+41
    022D8 8A22      STD	Z+18,R2
    022D9 8A33      STD	Z+19,R3
    022DA 8A44      STD	Z+20,R4
    022DB 8A55      STD	Z+21,R5
(2905) 			}
(2906) 			if (clst != 0) {
    022DC 802A      LDD	R2,Y+2
    022DD 803B      LDD	R3,Y+3
    022DE 804C      LDD	R4,Y+4
    022DF 805D      LDD	R5,Y+5
    022E0 9488      BCLR	0
    022E1 2022      TST	R2
    022E2 0432      CPC	R3,R2
    022E3 0442      CPC	R4,R2
    022E4 0452      CPC	R5,R2
    022E5 F409      BNE	0x22E7
    022E6 C114      RJMP	0x23FB
    022E7 C0A7      RJMP	0x238F
(2907) 				while (ofs > bcs) {						/* Cluster following loop */
(2908) #if !_FS_READONLY
(2909) 					if (fp->flag & FA_WRITE) {			/* Check if in write mode or not */
    022E8 A5E8      LDD	R30,Y+40
    022E9 A5F9      LDD	R31,Y+41
    022EA 9634      ADIW	R30,4
    022EB 8020      LD	R2,Z
    022EC FE21      SBRS	R2,1
    022ED C024      RJMP	0x2312
(2910) 						clst = create_chain(fp->fs, clst);	/* Force stretch if in write mode */
    022EE 802A      LDD	R2,Y+2
    022EF 803B      LDD	R3,Y+3
    022F0 804C      LDD	R4,Y+4
    022F1 805D      LDD	R5,Y+5
    022F2 8248      ST	Y,R4
    022F3 8259      STD	Y+1,R5
    022F4 0191      MOVW	R18,R2
    022F5 A5E8      LDD	R30,Y+40
    022F6 A5F9      LDD	R31,Y+41
    022F7 8100      LD	R16,Z
    022F8 8111      LDD	R17,Z+1
    022F9 940E 09D9 CALL	ff.c:create_chain
    022FB 830A      STD	Y+2,R16
    022FC 831B      STD	Y+3,R17
    022FD 832C      STD	Y+4,R18
    022FE 833D      STD	Y+5,R19
(2911) 						if (clst == 0) {				/* When disk gets full, clip file size */
    022FF 802A      LDD	R2,Y+2
    02300 803B      LDD	R3,Y+3
    02301 804C      LDD	R4,Y+4
    02302 805D      LDD	R5,Y+5
    02303 9488      BCLR	0
    02304 2022      TST	R2
    02305 0432      CPC	R3,R2
    02306 0442      CPC	R4,R2
    02307 0452      CPC	R5,R2
    02308 F4D1      BNE	0x2323
(2912) 							ofs = bcs; break;
    02309 802E      LDD	R2,Y+6
    0230A 803F      LDD	R3,Y+7
    0230B 8448      LDD	R4,Y+8
    0230C 8459      LDD	R5,Y+9
    0230D A62A      STD	Y+42,R2
    0230E A63B      STD	Y+43,R3
    0230F A64C      STD	Y+44,R4
    02310 A65D      STD	Y+45,R5
    02311 C08B      RJMP	0x239D
(2913) 						}
(2914) 					} else
(2915) #endif
(2916) 						clst = get_fat(fp->fs, clst);	/* Follow cluster chain if not in write mode */
    02312 802A      LDD	R2,Y+2
    02313 803B      LDD	R3,Y+3
    02314 804C      LDD	R4,Y+4
    02315 805D      LDD	R5,Y+5
    02316 8248      ST	Y,R4
    02317 8259      STD	Y+1,R5
    02318 0191      MOVW	R18,R2
    02319 A5E8      LDD	R30,Y+40
    0231A A5F9      LDD	R31,Y+41
    0231B 8100      LD	R16,Z
    0231C 8111      LDD	R17,Z+1
    0231D 940E 0617 CALL	_get_fat
    0231F 830A      STD	Y+2,R16
    02320 831B      STD	Y+3,R17
    02321 832C      STD	Y+4,R18
    02322 833D      STD	Y+5,R19
(2917) 					if (clst == 0xFFFFFFFF) ABORT(fp->fs, FR_DISK_ERR);
    02323 EF4F      LDI	R20,0xFF
    02324 EF5F      LDI	R21,0xFF
    02325 EF6F      LDI	R22,0xFF
    02326 EF7F      LDI	R23,0xFF
    02327 802A      LDD	R2,Y+2
    02328 803B      LDD	R3,Y+3
    02329 804C      LDD	R4,Y+4
    0232A 805D      LDD	R5,Y+5
    0232B 1624      CP	R2,R20
    0232C 0635      CPC	R3,R21
    0232D 0646      CPC	R4,R22
    0232E 0657      CPC	R5,R23
    0232F F451      BNE	0x233A
    02330 A588      LDD	R24,Y+40
    02331 A599      LDD	R25,Y+41
    02332 9604      ADIW	R24,4
    02333 017C      MOVW	R14,R24
    02334 01FC      MOVW	R30,R24
    02335 8180      LD	R24,Z
    02336 6880      ORI	R24,0x80
    02337 8380      ST	Z,R24
    02338 E001      LDI	R16,1
    02339 C10D      RJMP	0x2447
(2918) 					if (clst <= 1 || clst >= fp->fs->n_fatent) ABORT(fp->fs, FR_INT_ERR);
    0233A E041      LDI	R20,1
    0233B E050      LDI	R21,0
    0233C E060      LDI	R22,0
    0233D E070      LDI	R23,0
    0233E 802A      LDD	R2,Y+2
    0233F 803B      LDD	R3,Y+3
    02340 804C      LDD	R4,Y+4
    02341 805D      LDD	R5,Y+5
    02342 1542      CP	R20,R2
    02343 0553      CPC	R21,R3
    02344 0564      CPC	R22,R4
    02345 0575      CPC	R23,R5
    02346 F490      BCC	0x2359
    02347 A5E8      LDD	R30,Y+40
    02348 A5F9      LDD	R31,Y+41
    02349 81A0      LD	R26,Z
    0234A 81B1      LDD	R27,Z+1
    0234B 9656      ADIW	R26,0x16
    0234C 902D      LD	R2,X+
    0234D 903D      LD	R3,X+
    0234E 904D      LD	R4,X+
    0234F 905C      LD	R5,X
    02350 806A      LDD	R6,Y+2
    02351 807B      LDD	R7,Y+3
    02352 808C      LDD	R8,Y+4
    02353 809D      LDD	R9,Y+5
    02354 1462      CP	R6,R2
    02355 0473      CPC	R7,R3
    02356 0484      CPC	R8,R4
    02357 0495      CPC	R9,R5
    02358 F050      BCS	0x2363
    02359 A588      LDD	R24,Y+40
    0235A A599      LDD	R25,Y+41
    0235B 9604      ADIW	R24,4
    0235C 017C      MOVW	R14,R24
    0235D 01FC      MOVW	R30,R24
    0235E 8180      LD	R24,Z
    0235F 6880      ORI	R24,0x80
    02360 8380      ST	Z,R24
    02361 E002      LDI	R16,2
    02362 C0E4      RJMP	0x2447
(2919) 					fp->clust = clst;
    02363 802A      LDD	R2,Y+2
    02364 803B      LDD	R3,Y+3
    02365 804C      LDD	R4,Y+4
    02366 805D      LDD	R5,Y+5
    02367 A5E8      LDD	R30,Y+40
    02368 A5F9      LDD	R31,Y+41
    02369 9672      ADIW	R30,0x12
    0236A 8220      ST	Z,R2
    0236B 8231      STD	Z+1,R3
    0236C 8242      STD	Z+2,R4
    0236D 8253      STD	Z+3,R5
(2920) 					fp->fptr += bcs;
    0236E A588      LDD	R24,Y+40
    0236F A599      LDD	R25,Y+41
    02370 9606      ADIW	R24,6
    02371 017C      MOVW	R14,R24
    02372 802E      LDD	R2,Y+6
    02373 803F      LDD	R3,Y+7
    02374 8448      LDD	R4,Y+8
    02375 8459      LDD	R5,Y+9
    02376 01FC      MOVW	R30,R24
    02377 8060      LD	R6,Z
    02378 8071      LDD	R7,Z+1
    02379 8082      LDD	R8,Z+2
    0237A 8093      LDD	R9,Z+3
    0237B 0C62      ADD	R6,R2
    0237C 1C73      ADC	R7,R3
    0237D 1C84      ADC	R8,R4
    0237E 1C95      ADC	R9,R5
    0237F 8260      ST	Z,R6
    02380 8271      STD	Z+1,R7
    02381 8282      STD	Z+2,R8
    02382 8293      STD	Z+3,R9
(2921) 					ofs -= bcs;
    02383 A46A      LDD	R6,Y+42
    02384 A47B      LDD	R7,Y+43
    02385 A48C      LDD	R8,Y+44
    02386 A49D      LDD	R9,Y+45
    02387 1862      SUB	R6,R2
    02388 0873      SBC	R7,R3
    02389 0884      SBC	R8,R4
    0238A 0895      SBC	R9,R5
    0238B A66A      STD	Y+42,R6
    0238C A67B      STD	Y+43,R7
    0238D A68C      STD	Y+44,R8
    0238E A69D      STD	Y+45,R9
    0238F 802E      LDD	R2,Y+6
    02390 803F      LDD	R3,Y+7
    02391 8448      LDD	R4,Y+8
    02392 8459      LDD	R5,Y+9
    02393 A46A      LDD	R6,Y+42
    02394 A47B      LDD	R7,Y+43
    02395 A48C      LDD	R8,Y+44
    02396 A49D      LDD	R9,Y+45
    02397 1426      CP	R2,R6
    02398 0437      CPC	R3,R7
    02399 0448      CPC	R4,R8
    0239A 0459      CPC	R5,R9
    0239B F408      BCC	0x239D
    0239C CF4B      RJMP	0x22E8
(2922) 				}
(2923) 				fp->fptr += ofs;
    0239D A588      LDD	R24,Y+40
    0239E A599      LDD	R25,Y+41
    0239F 9606      ADIW	R24,6
    023A0 017C      MOVW	R14,R24
    023A1 A42A      LDD	R2,Y+42
    023A2 A43B      LDD	R3,Y+43
    023A3 A44C      LDD	R4,Y+44
    023A4 A45D      LDD	R5,Y+45
    023A5 01FC      MOVW	R30,R24
    023A6 8060      LD	R6,Z
    023A7 8071      LDD	R7,Z+1
    023A8 8082      LDD	R8,Z+2
    023A9 8093      LDD	R9,Z+3
    023AA 0C62      ADD	R6,R2
    023AB 1C73      ADC	R7,R3
    023AC 1C84      ADC	R8,R4
    023AD 1C95      ADC	R9,R5
    023AE 8260      ST	Z,R6
    023AF 8271      STD	Z+1,R7
    023B0 8282      STD	Z+2,R8
    023B1 8293      STD	Z+3,R9
(2924) 				if (ofs % SS(fp->fs)) {
    023B2 EF4F      LDI	R20,0xFF
    023B3 E051      LDI	R21,1
    023B4 E060      LDI	R22,0
    023B5 E070      LDI	R23,0
    023B6 2224      AND	R2,R20
    023B7 2235      AND	R3,R21
    023B8 2246      AND	R4,R22
    023B9 2257      AND	R5,R23
    023BA 9488      BCLR	0
    023BB 2022      TST	R2
    023BC 0432      CPC	R3,R2
    023BD 0442      CPC	R4,R2
    023BE 0452      CPC	R5,R2
    023BF F409      BNE	0x23C1
    023C0 C03A      RJMP	0x23FB
(2925) 					nsect = clust2sect(fp->fs, clst);	/* Current sector */
    023C1 802A      LDD	R2,Y+2
    023C2 803B      LDD	R3,Y+3
    023C3 804C      LDD	R4,Y+4
    023C4 805D      LDD	R5,Y+5
    023C5 8248      ST	Y,R4
    023C6 8259      STD	Y+1,R5
    023C7 0191      MOVW	R18,R2
    023C8 A5E8      LDD	R30,Y+40
    023C9 A5F9      LDD	R31,Y+41
    023CA 8100      LD	R16,Z
    023CB 8111      LDD	R17,Z+1
    023CC 940E 05C5 CALL	_clust2sect
    023CE 870A      STD	Y+10,R16
    023CF 871B      STD	Y+11,R17
    023D0 872C      STD	Y+12,R18
    023D1 873D      STD	Y+13,R19
(2926) 					if (!nsect) ABORT(fp->fs, FR_INT_ERR);
    023D2 842A      LDD	R2,Y+10
    023D3 843B      LDD	R3,Y+11
    023D4 844C      LDD	R4,Y+12
    023D5 845D      LDD	R5,Y+13
    023D6 9488      BCLR	0
    023D7 2022      TST	R2
    023D8 0432      CPC	R3,R2
    023D9 0442      CPC	R4,R2
    023DA 0452      CPC	R5,R2
    023DB F451      BNE	0x23E6
    023DC A588      LDD	R24,Y+40
    023DD A599      LDD	R25,Y+41
    023DE 9604      ADIW	R24,4
    023DF 017C      MOVW	R14,R24
    023E0 01FC      MOVW	R30,R24
    023E1 8180      LD	R24,Z
    023E2 6880      ORI	R24,0x80
    023E3 8380      ST	Z,R24
    023E4 E002      LDI	R16,2
    023E5 C061      RJMP	0x2447
(2927) 					nsect += ofs / SS(fp->fs);
    023E6 E089      LDI	R24,0x9
    023E7 E090      LDI	R25,0
    023E8 A50A      LDD	R16,Y+42
    023E9 A51B      LDD	R17,Y+43
    023EA A52C      LDD	R18,Y+44
    023EB A53D      LDD	R19,Y+45
    023EC 938A      ST	-Y,R24
    023ED 940E 48E9 CALL	lsr32
    023EF 842A      LDD	R2,Y+10
    023F0 843B      LDD	R3,Y+11
    023F1 844C      LDD	R4,Y+12
    023F2 845D      LDD	R5,Y+13
    023F3 0E20      ADD	R2,R16
    023F4 1E31      ADC	R3,R17
    023F5 1E42      ADC	R4,R18
    023F6 1E53      ADC	R5,R19
    023F7 862A      STD	Y+10,R2
    023F8 863B      STD	Y+11,R3
    023F9 864C      STD	Y+12,R4
    023FA 865D      STD	Y+13,R5
(2928) 				}
(2929) 			}
(2930) 		}
(2931) 		if (fp->fptr % SS(fp->fs) && nsect != fp->dsect) {	/* Fill sector cache if needed */
    023FB EF4F      LDI	R20,0xFF
    023FC E051      LDI	R21,1
    023FD E060      LDI	R22,0
    023FE E070      LDI	R23,0
    023FF A5E8      LDD	R30,Y+40
    02400 A5F9      LDD	R31,Y+41
    02401 9636      ADIW	R30,6
    02402 8020      LD	R2,Z
    02403 8031      LDD	R3,Z+1
    02404 8042      LDD	R4,Z+2
    02405 8053      LDD	R5,Z+3
    02406 2224      AND	R2,R20
    02407 2235      AND	R3,R21
    02408 2246      AND	R4,R22
    02409 2257      AND	R5,R23
    0240A 9488      BCLR	0
    0240B 2022      TST	R2
    0240C 0432      CPC	R3,R2
    0240D 0442      CPC	R4,R2
    0240E 0452      CPC	R5,R2
    0240F F0C1      BEQ	0x2428
    02410 A5E8      LDD	R30,Y+40
    02411 A5F9      LDD	R31,Y+41
    02412 9676      ADIW	R30,0x16
    02413 8020      LD	R2,Z
    02414 8031      LDD	R3,Z+1
    02415 8042      LDD	R4,Z+2
    02416 8053      LDD	R5,Z+3
    02417 846A      LDD	R6,Y+10
    02418 847B      LDD	R7,Y+11
    02419 848C      LDD	R8,Y+12
    0241A 849D      LDD	R9,Y+13
    0241B 1462      CP	R6,R2
    0241C 0473      CPC	R7,R3
    0241D 0484      CPC	R8,R4
    0241E 0495      CPC	R9,R5
    0241F F041      BEQ	0x2428
(2932) #if !_FS_TINY
(2933) #if !_FS_READONLY
(2934) 			if (fp->flag & FA__DIRTY) {			/* Write-back dirty sector cache */
(2935) 				if (disk_write(fp->fs->drv, fp->buf, fp->dsect, 1) != RES_OK)
(2936) 					ABORT(fp->fs, FR_DISK_ERR);
(2937) 				fp->flag &= ~FA__DIRTY;
(2938) 			}
(2939) #endif
(2940) 			if (disk_read(fp->fs->drv, fp->buf, nsect, 1) != RES_OK)	/* Fill sector cache */
(2941) 				ABORT(fp->fs, FR_DISK_ERR);
(2942) #endif
(2943) 			fp->dsect = nsect;
    02420 0113      MOVW	R2,R6
    02421 0124      MOVW	R4,R8
    02422 A5E8      LDD	R30,Y+40
    02423 A5F9      LDD	R31,Y+41
    02424 8A26      STD	Z+22,R2
    02425 8A37      STD	Z+23,R3
    02426 8E40      STD	Z+24,R4
    02427 8E51      STD	Z+25,R5
(2944) 		}
(2945) #if !_FS_READONLY
(2946) 		if (fp->fptr > fp->fsize) {			/* Set file change flag if the file size is extended */
    02428 A5E8      LDD	R30,Y+40
    02429 A5F9      LDD	R31,Y+41
    0242A 8422      LDD	R2,Z+10
    0242B 8433      LDD	R3,Z+11
    0242C 8444      LDD	R4,Z+12
    0242D 8455      LDD	R5,Z+13
    0242E 8066      LDD	R6,Z+6
    0242F 8077      LDD	R7,Z+7
    02430 8480      LDD	R8,Z+8
    02431 8491      LDD	R9,Z+9
    02432 1426      CP	R2,R6
    02433 0437      CPC	R3,R7
    02434 0448      CPC	R4,R8
    02435 0459      CPC	R5,R9
    02436 F478      BCC	0x2446
(2947) 			fp->fsize = fp->fptr;
    02437 8026      LDD	R2,Z+6
    02438 8037      LDD	R3,Z+7
    02439 8440      LDD	R4,Z+8
    0243A 8451      LDD	R5,Z+9
    0243B 8622      STD	Z+10,R2
    0243C 8633      STD	Z+11,R3
    0243D 8644      STD	Z+12,R4
    0243E 8655      STD	Z+13,R5
(2948) 			fp->flag |= FA__WRITTEN;
    0243F 01CF      MOVW	R24,R30
    02440 9604      ADIW	R24,4
    02441 016C      MOVW	R12,R24
    02442 01FC      MOVW	R30,R24
    02443 8180      LD	R24,Z
    02444 6280      ORI	R24,0x20
    02445 8380      ST	Z,R24
(2949) 		}
(2950) #endif
(2951) 	}
(2952) 
(2953) 	LEAVE_FF(fp->fs, res);
    02446 2D0A      MOV	R16,R10
    02447 966E      ADIW	R28,0x1E
    02448 940E 483A CALL	pop_xgsetF0FC
    0244A 9624      ADIW	R28,4
    0244B 9508      RET
_f_opendir:
  sfn                  --> Y,+1
  res                  --> R20
  path                 --> Y,+19
  dj                   --> R22
    0244C 933A      ST	-Y,R19
    0244D 932A      ST	-Y,R18
    0244E 940E 4864 CALL	push_xgsetF00C
    02450 01B8      MOVW	R22,R16
    02451 972D      SBIW	R28,0xD
(2954) }
(2955) 
(2956) 
(2957) 
(2958) #if _FS_MINIMIZE <= 1
(2959) /*-----------------------------------------------------------------------*/
(2960) /* Create a Directroy Object                                             */
(2961) /*-----------------------------------------------------------------------*/
(2962) 
(2963) FRESULT f_opendir (
(2964) 	DIR *dj,			/* Pointer to directory object to create */
(2965) 	const TCHAR *path	/* Pointer to the directory path */
(2966) )
(2967) {
(2968) 	FRESULT res;
(2969) 	DEF_NAMEBUF;
(2970) 
(2971) 
(2972) 	res = chk_mounted(&path, &dj->fs, 0);
    02452 2422      CLR	R2
    02453 8228      ST	Y,R2
    02454 019B      MOVW	R18,R22
    02455 018E      MOVW	R16,R28
    02456 5E0D      SUBI	R16,0xED
    02457 4F1F      SBCI	R17,0xFF
    02458 940E 126C CALL	ff.c:chk_mounted
    0245A 2F40      MOV	R20,R16
(2973) 	if (res == FR_OK) {
    0245B 2300      TST	R16
    0245C F009      BEQ	0x245E
    0245D C05C      RJMP	0x24BA
(2974) 		INIT_BUF(*dj);
    0245E 01CE      MOVW	R24,R28
    0245F 9601      ADIW	R24,1
    02460 01FB      MOVW	R30,R22
    02461 8B95      STD	Z+21,R25
    02462 8B84      STD	Z+20,R24
(2975) 		res = follow_path(dj, path);			/* Follow the path to the directory */
    02463 892B      LDD	R18,Y+19
    02464 893C      LDD	R19,Y+20
    02465 018F      MOVW	R16,R30
    02466 940E 1120 CALL	ff.c:follow_path
    02468 2F40      MOV	R20,R16
(2976) 		FREE_BUF();
(2977) 		if (res == FR_OK) {						/* Follow completed */
    02469 2300      TST	R16
    0246A F009      BEQ	0x246C
    0246B C04B      RJMP	0x24B7
(2978) 			if (dj->dir) {						/* It is not the root dir */
    0246C 01FB      MOVW	R30,R22
    0246D 8822      LDD	R2,Z+18
    0246E 8833      LDD	R3,Z+19
    0246F 2022      TST	R2
    02470 F419      BNE	0x2474
    02471 2033      TST	R3
    02472 F409      BNE	0x2474
    02473 C032      RJMP	0x24A6
(2979) 				if (dj->dir[DIR_Attr] & AM_DIR) {	/* The object is a directory */
    02474 93AF      PUSH	R26
    02475 93BF      PUSH	R27
    02476 89A2      LDD	R26,Z+18
    02477 89B3      LDD	R27,Z+19
    02478 01FD      MOVW	R30,R26
    02479 91BF      POP	R27
    0247A 91AF      POP	R26
    0247B 8423      LDD	R2,Z+11
    0247C FE24      SBRS	R2,4
    0247D C027      RJMP	0x24A5
(2980) 					dj->sclust = LD_CLUST(dj->dir);
    0247E 01FB      MOVW	R30,R22
    0247F 88A2      LDD	R10,Z+18
    02480 88B3      LDD	R11,Z+19
    02481 01F5      MOVW	R30,R10
    02482 8C22      LDD	R2,Z+26
    02483 2433      CLR	R3
    02484 8C43      LDD	R4,Z+27
    02485 2455      CLR	R5
    02486 2C54      MOV	R5,R4
    02487 2444      CLR	R4
    02488 2842      OR	R4,R2
    02489 2853      OR	R5,R3
    0248A 0112      MOVW	R2,R4
    0248B 2444      CLR	R4
    0248C 2455      CLR	R5
    0248D 8864      LDD	R6,Z+20
    0248E 2477      CLR	R7
    0248F 8885      LDD	R8,Z+21
    02490 2499      CLR	R9
    02491 2C98      MOV	R9,R8
    02492 2488      CLR	R8
    02493 2886      OR	R8,R6
    02494 2897      OR	R9,R7
    02495 0134      MOVW	R6,R8
    02496 2488      CLR	R8
    02497 2499      CLR	R9
    02498 0143      MOVW	R8,R6
    02499 2466      CLR	R6
    0249A 2477      CLR	R7
    0249B 2862      OR	R6,R2
    0249C 2873      OR	R7,R3
    0249D 2884      OR	R8,R4
    0249E 2895      OR	R9,R5
    0249F 01FB      MOVW	R30,R22
    024A0 8266      STD	Z+6,R6
    024A1 8277      STD	Z+7,R7
    024A2 8680      STD	Z+8,R8
    024A3 8691      STD	Z+9,R9
(2981) 				} else {						/* The object is not a directory */
    024A4 C001      RJMP	0x24A6
(2982) 					res = FR_NO_PATH;
    024A5 E045      LDI	R20,5
(2983) 				}
(2984) 			}
(2985) 			if (res == FR_OK) {
    024A6 2344      TST	R20
    024A7 F479      BNE	0x24B7
(2986) 				dj->id = dj->fs->id;
    024A8 01FB      MOVW	R30,R22
    024A9 81A0      LD	R26,Z
    024AA 81B1      LDD	R27,Z+1
    024AB 9616      ADIW	R26,6
    024AC 902D      LD	R2,X+
    024AD 903C      LD	R3,X
    024AE 8233      STD	Z+3,R3
    024AF 8222      STD	Z+2,R2
(2987) 				res = dir_sdi(dj, 0);			/* Rewind dir */
    024B0 2722      CLR	R18
    024B1 2733      CLR	R19
    024B2 018F      MOVW	R16,R30
    024B3 940E 0BCA CALL	ff.c:dir_sdi
    024B5 2EA0      MOV	R10,R16
    024B6 2D4A      MOV	R20,R10
(2988) 			}
(2989) 		}
(2990) 		if (res == FR_NO_FILE) res = FR_NO_PATH;
    024B7 3044      CPI	R20,4
    024B8 F409      BNE	0x24BA
    024B9 E045      LDI	R20,5
(2991) 	}
(2992) 
(2993) 	LEAVE_FF(dj->fs, res);
    024BA 2F04      MOV	R16,R20
    024BB 962D      ADIW	R28,0xD
    024BC 940E 486B CALL	pop_xgsetF00C
    024BE 9622      ADIW	R28,2
    024BF 9508      RET
_f_readdir:
  sfn                  --> Y,+0
  res                  --> R20
  fno                  --> R10
  dj                   --> R22
    024C0 940E 4880 CALL	push_xgsetF03C
    024C2 0159      MOVW	R10,R18
    024C3 01B8      MOVW	R22,R16
    024C4 972C      SBIW	R28,0xC
(2994) }
(2995) 
(2996) 
(2997) 
(2998) 
(2999) /*-----------------------------------------------------------------------*/
(3000) /* Read Directory Entry in Sequense                                      */
(3001) /*-----------------------------------------------------------------------*/
(3002) 
(3003) FRESULT f_readdir (
(3004) 	DIR *dj,			/* Pointer to the open directory object */
(3005) 	FILINFO *fno		/* Pointer to file information to return */
(3006) )
(3007) {
(3008) 	FRESULT res;
(3009) 	DEF_NAMEBUF;
(3010) 
(3011) 
(3012) 	res = validate(dj->fs, dj->id);			/* Check validity of the object */
    024C5 01FB      MOVW	R30,R22
    024C6 8122      LDD	R18,Z+2
    024C7 8133      LDD	R19,Z+3
    024C8 8100      LD	R16,Z
    024C9 8111      LDD	R17,Z+1
    024CA 940E 1766 CALL	ff.c:validate
    024CC 2F40      MOV	R20,R16
(3013) 	if (res == FR_OK) {
    024CD 2300      TST	R16
    024CE F009      BEQ	0x24D0
    024CF C035      RJMP	0x2505
(3014) 		if (!fno) {
    024D0 20AA      TST	R10
    024D1 F449      BNE	0x24DB
    024D2 20BB      TST	R11
    024D3 F439      BNE	0x24DB
(3015) 			res = dir_sdi(dj, 0);			/* Rewind the directory object */
    024D4 2722      CLR	R18
    024D5 2733      CLR	R19
    024D6 018B      MOVW	R16,R22
    024D7 940E 0BCA CALL	ff.c:dir_sdi
    024D9 2F40      MOV	R20,R16
(3016) 		} else {
    024DA C02A      RJMP	0x2505
(3017) 			INIT_BUF(*dj);
    024DB 01CE      MOVW	R24,R28
    024DC 01FB      MOVW	R30,R22
    024DD 8B95      STD	Z+21,R25
    024DE 8B84      STD	Z+20,R24
(3018) 			res = dir_read(dj);				/* Read an directory item */
    024DF 018F      MOVW	R16,R30
    024E0 940E 0EC7 CALL	ff.c:dir_read
    024E2 2EC0      MOV	R12,R16
    024E3 2D4C      MOV	R20,R12
(3019) 			if (res == FR_NO_FILE) {		/* Reached end of dir */
    024E4 3004      CPI	R16,4
    024E5 F441      BNE	0x24EE
(3020) 				dj->sect = 0;
    024E6 01FB      MOVW	R30,R22
    024E7 963E      ADIW	R30,0xE
    024E8 E080      LDI	R24,0
    024E9 8380      ST	Z,R24
    024EA 8381      STD	Z+1,R24
    024EB 8382      STD	Z+2,R24
    024EC 8383      STD	Z+3,R24
(3021) 				res = FR_OK;
    024ED 2744      CLR	R20
(3022) 			}
(3023) 			if (res == FR_OK) {				/* A valid entry is found */
    024EE 2344      TST	R20
    024EF F4A9      BNE	0x2505
(3024) 				get_fileinfo(dj, fno);		/* Get the object information */
    024F0 0195      MOVW	R18,R10
    024F1 018B      MOVW	R16,R22
    024F2 940E 107D CALL	ff.c:get_fileinfo
(3025) 				res = dir_next(dj, 0);		/* Increment index for next */
    024F4 2722      CLR	R18
    024F5 2733      CLR	R19
    024F6 018B      MOVW	R16,R22
    024F7 940E 0CD4 CALL	ff.c:dir_next
    024F9 2EA0      MOV	R10,R16
    024FA 2D4A      MOV	R20,R10
(3026) 				if (res == FR_NO_FILE) {
    024FB 3004      CPI	R16,4
    024FC F441      BNE	0x2505
(3027) 					dj->sect = 0;
    024FD 01FB      MOVW	R30,R22
    024FE 963E      ADIW	R30,0xE
    024FF E080      LDI	R24,0
    02500 8380      ST	Z,R24
    02501 8381      STD	Z+1,R24
    02502 8382      STD	Z+2,R24
    02503 8383      STD	Z+3,R24
(3028) 					res = FR_OK;
    02504 2744      CLR	R20
(3029) 				}
(3030) 			}
(3031) 			FREE_BUF();
(3032) 		}
(3033) 	}
(3034) 
(3035) 	LEAVE_FF(dj->fs, res);
    02505 2F04      MOV	R16,R20
    02506 962C      ADIW	R28,0xC
    02507 940C 4889 JMP	pop_xgsetF03C
FILE: D:\LQD\software\software_src\delay.c
(0001) /*******************************
(0002)  function ：延时函数
(0003) Clock F  :7.3728M 
(0004) Software : ICCAVR7.14C
(0005) ********************************/
(0006) /*---------------------------------------------------------------------------------
(0007)      延时程序计算方法
(0008)      计数个数j = 延时时间/6*晶振频率 - 1
(0009) ---------------------------------------------------------------------------------*/
(0010) void delayus(unsigned int tttt)   // 1.2us 延时子函数   
(0011) { 
(0012)    do
(0013)    {
(0014)        tttt--;
_delayus:
  tttt                 --> R16
    02509 5001      SUBI	R16,1
    0250A 4010      SBCI	R17,0
(0015)    }
(0016)    while(tttt>1);
    0250B E081      LDI	R24,1
    0250C E090      LDI	R25,0
    0250D 1780      CP	R24,R16
    0250E 0791      CPC	R25,R17
    0250F F3C8      BCS	0x2509
    02510 9508      RET
_delayms:
  j                    --> R20
  i                    --> R16
    02511 934A      ST	-Y,R20
    02512 935A      ST	-Y,R21
(0017) }
(0018) void delayms(unsigned int i)                 //1ms延时
(0019)    {
    02513 C00A      RJMP	0x251E
(0020)     while(i--)
(0021)     {                          
(0022) 	    unsigned int j;                
(0023)         for(j=1;j<=1227;j++)   
    02514 E041      LDI	R20,1
    02515 E050      LDI	R21,0
    02516 C002      RJMP	0x2519
    02517 5F4F      SUBI	R20,0xFF
    02518 4F5F      SBCI	R21,0xFF
    02519 EC8B      LDI	R24,0xCB
    0251A E094      LDI	R25,4
    0251B 1784      CP	R24,R20
    0251C 0795      CPC	R25,R21
    0251D F7C8      BCC	0x2517
    0251E 0118      MOVW	R2,R16
    0251F 5001      SUBI	R16,1
    02520 4010      SBCI	R17,0
    02521 2022      TST	R2
    02522 F789      BNE	0x2514
    02523 2033      TST	R3
    02524 F779      BNE	0x2514
    02525 9159      LD	R21,Y+
    02526 9149      LD	R20,Y+
    02527 9508      RET
FILE: D:\LQD\software\software_src\main.c
(0001) #include "config.h"
(0002) #define  N_per_Second  (2.72*60)
(0003) const char tab[]="\t\0";
(0004) const char enter[]="\n\0";
(0005) char buffer[512];
(0006) char TempChar[80]; //存放临时字串
(0007) struct DATA Result;
(0008) struct tm t;
(0009) unsigned long now =0; 
(0010) void debug(UINT8 *str,UINT8 val);
(0011) void WriteSDFile(void);
(0012) struct CONFIG config;
(0013) void initDevices(void){
(0014)      CLI();
_initDevices:
    02528 94F8      BCLR	7
(0015) 	 DDRA=0XFF;
    02529 EF8F      LDI	R24,0xFF
    0252A BB8A      OUT	0x1A,R24
(0016) 	 PORTA=0XFF;
    0252B BB8B      OUT	0x1B,R24
(0017) 	 DDRB=0XFF;
    0252C BB87      OUT	0x17,R24
(0018) 	 PORTB=0XFF; 	 
    0252D BB88      OUT	0x18,R24
(0019) 	 DDRC=0XFF;
    0252E BB84      OUT	0x14,R24
(0020) 	 PORTC=0XFF;
    0252F BB85      OUT	0x15,R24
(0021) 	 DDRG=0XFF;
    02530 9380 0064 STS	0x64,R24
(0022) 	 PORTG=0XFF;	 
    02532 9380 0065 STS	0x65,R24
(0023) 	 SPI_IO_Init(); 
    02534 940E 3BF4 CALL	_SPI_IO_Init
(0024) 	 SD_Init();
    02536 940E 2D60 CALL	_SD_Init
(0025) 	 uart1_init();
    02538 940E 3A1E CALL	_uart1_init
(0026) 	 LCD_INT();delayms(50);LCD_INT();
    0253A 940E 3C12 CALL	_LCD_INT
    0253C E302      LDI	R16,0x32
    0253D E010      LDI	R17,0
    0253E 940E 2511 CALL	_delayms
    02540 940E 3C12 CALL	_LCD_INT
(0027) 	 LCD_SW(1);
    02542 E001      LDI	R16,1
    02543 940E 3C08 CALL	_LCD_SW
(0028) 	 config.THRESHOLD_delta_sec=5; //一次检测用时
    02545 E085      LDI	R24,5
    02546 9380 0857 STS	config+4,R24
    02548 E080      LDI	R24,0
    02549 9380 0858 STS	config+5,R24
    0254B 9380 0859 STS	config+6,R24
    0254D 9380 085A STS	config+7,R24
(0029) 	 config.autocheck=1;        //自动检测开关
    0254F E081      LDI	R24,1
    02550 9380 0863 STS	config+16,R24
(0030) 	 config.checkDeltaTime=3;  //自动检测模式 时间间隔
    02552 E083      LDI	R24,3
    02553 E090      LDI	R25,0
    02554 9390 0865 STS	config+18,R25
    02556 9380 0864 STS	config+17,R24
(0031) 	 config.readMode = 0;      //读数据模式
    02558 2422      CLR	R2
    02559 9220 0866 STS	config+19,R2
(0032) 	 SEI();
    0255B 9478      BSET	7
    0255C 9508      RET
(0033) }
(0034) void timer1_init(void)
(0035) {
(0036)  TCCR1B = 0x00; //stop
_timer1_init:
    0255D 2422      CLR	R2
    0255E BC2E      OUT	0x2E,R2
(0037)  TCNT1H = 0x00 /*INVALID SETTING*/; //setup
    0255F BC2D      OUT	0x2D,R2
(0038)  TCNT1L = 0x00 /*INVALID SETTING*/;
    02560 BC2C      OUT	0x2C,R2
(0039)  TCCR1A = 0x00;
    02561 BC2F      OUT	0x2F,R2
(0040)  TCCR1B = 0x46; //start Timer
    02562 E486      LDI	R24,0x46
    02563 BD8E      OUT	0x2E,R24
    02564 9508      RET
_main:
  keycode              --> Y,+1
  i                    --> R10
  filename             --> Y,+513
  buf512               --> Y,+0
  tmp                  --> R14
    02565 97EF      SBIW	R28,0x3F
    02566 97EF      SBIW	R28,0x3F
    02567 97EF      SBIW	R28,0x3F
    02568 97EF      SBIW	R28,0x3F
    02569 97EF      SBIW	R28,0x3F
    0256A 97EF      SBIW	R28,0x3F
    0256B 97EF      SBIW	R28,0x3F
    0256C 97EF      SBIW	R28,0x3F
    0256D 9767      SBIW	R28,0x17
(0041) }
(0042) ////////////////////////////////////////////////////////////////
(0043) void main(void){
(0044) 	 UINT8 tmp,keycode;
(0045) 	 UINT8 buf512[513];
(0046) 	 char filename[]="201301.xls\0\0\0";
    0256E E189      LDI	R24,0x19
    0256F E091      LDI	R25,1
    02570 01FE      MOVW	R30,R28
    02571 5FEF      SUBI	R30,0xFF
    02572 4FFD      SBCI	R31,0xFD
    02573 E00E      LDI	R16,0xE
    02574 E010      LDI	R17,0
    02575 93FA      ST	-Y,R31
    02576 93EA      ST	-Y,R30
    02577 939A      ST	-Y,R25
    02578 938A      ST	-Y,R24
    02579 940E 48F5 CALL	asgnblk
(0047) 	 int i=0;
    0257B 24AA      CLR	R10
    0257C 24BB      CLR	R11
(0048) 	 initDevices();
    0257D DFAA      RCALL	_initDevices
(0049) 	 dateRefresh(1);
    0257E E001      LDI	R16,1
    0257F 940E 38D5 CALL	_dateRefresh
(0050) 	 WriteFileHead();
    02581 D11C      RCALL	_WriteFileHead
(0051)      Result.Index=findIndex(get_name(filename),buf512);
    02582 018E      MOVW	R16,R28
    02583 5F0F      SUBI	R16,0xFF
    02584 4F1D      SBCI	R17,0xFD
    02585 D6BD      RCALL	_get_name
    02586 019E      MOVW	R18,R28
    02587 D2A5      RCALL	_findIndex
    02588 0118      MOVW	R2,R16
    02589 2444      CLR	R4
    0258A 2455      CLR	R5
    0258B 9230 05EE STS	Result+11,R3
    0258D 9220 05ED STS	Result+10,R2
    0258F 9250 05F0 STS	Result+13,R5
    02591 9240 05EF STS	Result+12,R4
    02593 C01F      RJMP	0x25B3
(0052) 	 while(1){
(0053) 	  		dateRefresh(1);
    02594 E001      LDI	R16,1
    02595 940E 38D5 CALL	_dateRefresh
(0054) 	 		check();
    02597 D43C      RCALL	_check
(0055) 			StructToChar(); //转成字符串
    02598 D5FC      RCALL	_StructToChar
(0056) 			WriteFileHead();//重写文件头
    02599 D104      RCALL	_WriteFileHead
(0057) 			WriteSDFile();  //写入sd卡
    0259A D17E      RCALL	_WriteSDFile
(0058) 			//zigbee_send(); //发送
(0059) 			Result.Index++; //索引自增一
    0259B E081      LDI	R24,1
    0259C E090      LDI	R25,0
    0259D E0A0      LDI	R26,0
    0259E E0B0      LDI	R27,0
    0259F 9040 05EF LDS	R4,Result+12
    025A1 9050 05F0 LDS	R5,Result+13
    025A3 9020 05ED LDS	R2,Result+10
    025A5 9030 05EE LDS	R3,Result+11
    025A7 0E28      ADD	R2,R24
    025A8 1E39      ADC	R3,R25
    025A9 1E4A      ADC	R4,R26
    025AA 1E5B      ADC	R5,R27
    025AB 9230 05EE STS	Result+11,R3
    025AD 9220 05ED STS	Result+10,R2
    025AF 9250 05F0 STS	Result+13,R5
    025B1 9240 05EF STS	Result+12,R4
    025B3 CFE0      RJMP	0x2594
(0060) 	 }
(0061) 	 #ifdef _DBG_RD_
(0062) 	 	 while(1){
(0063) 		     GUI_readback(buf512);
(0064) 	     }
(0065) 	 #endif
(0066) 	 //selfTest();
(0067) 	 GUI_welcome();
(0068) 	 while(1){
(0069) 	    tmp=GUI_mainmeu();
    025B4 940E 2F39 CALL	_GUI_mainmeu
    025B6 2EC0      MOV	R12,R16
    025B7 2CEC      MOV	R14,R12
(0070) 		switch(tmp){
    025B8 2D4E      MOV	R20,R14
    025B9 2755      CLR	R21
    025BA 3043      CPI	R20,3
    025BB E0E0      LDI	R30,0
    025BC 075E      CPC	R21,R30
    025BD F069      BEQ	0x25CB
    025BE 3044      CPI	R20,4
    025BF E0E0      LDI	R30,0
    025C0 075E      CPC	R21,R30
    025C1 F061      BEQ	0x25CE
    025C2 3045      CPI	R20,5
    025C3 E0E0      LDI	R30,0
    025C4 075E      CPC	R21,R30
    025C5 F059      BEQ	0x25D1
    025C6 3047      CPI	R20,7
    025C7 E0E0      LDI	R30,0
    025C8 075E      CPC	R21,R30
    025C9 F059      BEQ	0x25D5
    025CA C00B      RJMP	0x25D6
(0071) 		    case 3 : GUI_check(); break; 
    025CB 940E 3028 CALL	_GUI_check
    025CD C008      RJMP	0x25D6
(0072) 			case 4 : GUI_set_time(); break ;
    025CE 940E 34D6 CALL	_GUI_set_time
    025D0 C005      RJMP	0x25D6
(0073) 			case 5 : GUI_readback(buf512); break;
    025D1 018E      MOVW	R16,R28
    025D2 940E 3727 CALL	_GUI_readback
    025D4 C001      RJMP	0x25D6
(0074) 			//case 6 : GUI_send_date();
(0075) 			case 7 : selfTest(); break ;
    025D5 D00F      RCALL	_selfTest
(0076) 			default : break;
(0077) 	   }
(0078) 	   delayms(100);
    025D6 E604      LDI	R16,0x64
    025D7 E010      LDI	R17,0
    025D8 940E 2511 CALL	_delayms
    025DA CFD9      RJMP	0x25B4
    025DB 96EF      ADIW	R28,0x3F
    025DC 96EF      ADIW	R28,0x3F
    025DD 96EF      ADIW	R28,0x3F
    025DE 96EF      ADIW	R28,0x3F
    025DF 96EF      ADIW	R28,0x3F
    025E0 96EF      ADIW	R28,0x3F
    025E1 96EF      ADIW	R28,0x3F
    025E2 96EF      ADIW	R28,0x3F
    025E3 9667      ADIW	R28,0x17
    025E4 9508      RET
_selfTest:
  str2                 --> Y,+12
  str1                 --> Y,+6
  tmp                  --> Y,+2
    025E5 9762      SBIW	R28,0x12
(0079) 	 }
(0080) 
(0081) }
(0082) void selfTest(void){
(0083) 	float tmp=0;                                                                
    025E6 EB0E      LDI	R16,0xBE
    025E7 E010      LDI	R17,0
    025E8 940E 47CD CALL	elpm32
    025EA 830A      STD	Y+2,R16
    025EB 831B      STD	Y+3,R17
    025EC 832C      STD	Y+4,R18
    025ED 833D      STD	Y+5,R19
(0084) 	char str1[6],str2[6];
(0085) 	
(0086) 	 //自检程序
(0087) 	lp("自检程序");delayms(500);
    025EE E608      LDI	R16,0x68
    025EF E012      LDI	R17,2
    025F0 940E 3F41 CALL	_lp
    025F2 EF04      LDI	R16,0xF4
    025F3 E011      LDI	R17,1
    025F4 940E 2511 CALL	_delayms
(0088) 	lp("外部温度 ");
    025F6 E50E      LDI	R16,0x5E
    025F7 E012      LDI	R17,2
    025F8 940E 3F41 CALL	_lp
(0089) 	tmp=read_T_NUM(0);
    025FA 2700      CLR	R16
    025FB 940E 416F CALL	_read_T_NUM
    025FD 830A      STD	Y+2,R16
    025FE 831B      STD	Y+3,R17
    025FF 832C      STD	Y+4,R18
    02600 833D      STD	Y+5,R19
(0090) 	ftochr(tmp,str1);
    02601 01CE      MOVW	R24,R28
    02602 9606      ADIW	R24,6
    02603 8399      STD	Y+1,R25
    02604 8388      ST	Y,R24
    02605 810A      LDD	R16,Y+2
    02606 811B      LDD	R17,Y+3
    02607 812C      LDD	R18,Y+4
    02608 813D      LDD	R19,Y+5
    02609 D53A      RCALL	_ftochr
(0091) 	str1[6]=0;
    0260A 2422      CLR	R2
    0260B 862C      STD	Y+12,R2
(0092) 	lp(str1);
    0260C 018E      MOVW	R16,R28
    0260D 5F0A      SUBI	R16,0xFA
    0260E 4F1F      SBCI	R17,0xFF
    0260F 940E 3F41 CALL	_lp
(0093) 	delayms(500);
    02611 EF04      LDI	R16,0xF4
    02612 E011      LDI	R17,1
    02613 940E 2511 CALL	_delayms
(0094) 	lp("内部温度");
    02615 E505      LDI	R16,0x55
    02616 E012      LDI	R17,2
    02617 940E 3F41 CALL	_lp
(0095) 	tmp=read_T_NUM(1);
    02619 E001      LDI	R16,1
    0261A 940E 416F CALL	_read_T_NUM
    0261C 830A      STD	Y+2,R16
    0261D 831B      STD	Y+3,R17
    0261E 832C      STD	Y+4,R18
    0261F 833D      STD	Y+5,R19
(0096) 	ftochr(tmp,str2);
    02620 01CE      MOVW	R24,R28
    02621 960C      ADIW	R24,0xC
    02622 8399      STD	Y+1,R25
    02623 8388      ST	Y,R24
    02624 810A      LDD	R16,Y+2
    02625 811B      LDD	R17,Y+3
    02626 812C      LDD	R18,Y+4
    02627 813D      LDD	R19,Y+5
    02628 D51B      RCALL	_ftochr
(0097) 	str2[6]=0;
    02629 2422      CLR	R2
    0262A 8A2A      STD	Y+18,R2
(0098) 	lp(str2);
    0262B 018E      MOVW	R16,R28
    0262C 5F04      SUBI	R16,0xF4
    0262D 4F1F      SBCI	R17,0xFF
    0262E 940E 3F41 CALL	_lp
(0099) 	delayms(500);
    02630 EF04      LDI	R16,0xF4
    02631 E011      LDI	R17,1
    02632 940E 2511 CALL	_delayms
(0100) 	lp("风速脉冲：");delayms(500);
    02634 E40A      LDI	R16,0x4A
    02635 E012      LDI	R17,2
    02636 940E 3F41 CALL	_lp
    02638 EF04      LDI	R16,0xF4
    02639 E011      LDI	R17,1
    0263A 940E 2511 CALL	_delayms
(0101) 	lp("蜂鸣器"); beep(2,2);delayms(500);
    0263C E403      LDI	R16,0x43
    0263D E012      LDI	R17,2
    0263E 940E 3F41 CALL	_lp
    02640 E022      LDI	R18,2
    02641 E002      LDI	R16,2
    02642 940E 3FB7 CALL	_beep
    02644 EF04      LDI	R16,0xF4
    02645 E011      LDI	R17,1
    02646 940E 2511 CALL	_delayms
(0102) 	lp("power 指示灯");
    02648 E306      LDI	R16,0x36
    02649 E012      LDI	R17,2
    0264A 940E 3F41 CALL	_lp
(0103) 	LED_OFF();delayms(100);LED_ON();delayms(100);
    0264C 9AA7      SBI	0x14,7
    0264D 98AF      CBI	0x15,7
    0264E E604      LDI	R16,0x64
    0264F E010      LDI	R17,0
    02650 940E 2511 CALL	_delayms
    02652 9AA7      SBI	0x14,7
    02653 9AAF      SBI	0x15,7
    02654 E604      LDI	R16,0x64
    02655 E010      LDI	R17,0
    02656 940E 2511 CALL	_delayms
(0104) 	LED_OFF();delayms(100);LED_ON();delayms(100);
    02658 9AA7      SBI	0x14,7
    02659 98AF      CBI	0x15,7
    0265A E604      LDI	R16,0x64
    0265B E010      LDI	R17,0
    0265C 940E 2511 CALL	_delayms
    0265E 9AA7      SBI	0x14,7
    0265F 9AAF      SBI	0x15,7
    02660 E604      LDI	R16,0x64
    02661 E010      LDI	R17,0
    02662 940E 2511 CALL	_delayms
(0105) 	LED_OFF();delayms(100);LED_ON();delayms(100);
    02664 9AA7      SBI	0x14,7
    02665 98AF      CBI	0x15,7
    02666 E604      LDI	R16,0x64
    02667 E010      LDI	R17,0
    02668 940E 2511 CALL	_delayms
    0266A 9AA7      SBI	0x14,7
    0266B 9AAF      SBI	0x15,7
    0266C E604      LDI	R16,0x64
    0266D E010      LDI	R17,0
    0266E 940E 2511 CALL	_delayms
(0106) 	delayms(500);
    02670 EF04      LDI	R16,0xF4
    02671 E011      LDI	R17,1
    02672 940E 2511 CALL	_delayms
(0107) 	lp("加热开关");
    02674 E20D      LDI	R16,0x2D
    02675 E012      LDI	R17,2
    02676 940E 3F41 CALL	_lp
(0108) 	RELAY_ON();delayms(100);  
    02678 9AAD      SBI	0x15,5
    02679 E604      LDI	R16,0x64
    0267A E010      LDI	R17,0
    0267B 940E 2511 CALL	_delayms
(0109) 	RELAY_OFF();delayms(100);
    0267D 98AD      CBI	0x15,5
    0267E E604      LDI	R16,0x64
    0267F E010      LDI	R17,0
    02680 940E 2511 CALL	_delayms
(0110) 	RELAY_ON();delayms(100);
    02682 9AAD      SBI	0x15,5
    02683 E604      LDI	R16,0x64
    02684 E010      LDI	R17,0
    02685 940E 2511 CALL	_delayms
(0111) 	RELAY_OFF();delayms(100);
    02687 98AD      CBI	0x15,5
    02688 E604      LDI	R16,0x64
    02689 E010      LDI	R17,0
    0268A 940E 2511 CALL	_delayms
(0112) 	lp("  ");delayms(500);
    0268C E20A      LDI	R16,0x2A
    0268D E012      LDI	R17,2
    0268E 940E 3F41 CALL	_lp
    02690 EF04      LDI	R16,0xF4
    02691 E011      LDI	R17,1
    02692 940E 2511 CALL	_delayms
(0113) 	lp("完成自检");delayms(500);
    02694 E201      LDI	R16,0x21
    02695 E012      LDI	R17,2
    02696 940E 3F41 CALL	_lp
    02698 EF04      LDI	R16,0xF4
    02699 E011      LDI	R17,1
    0269A 940E 2511 CALL	_delayms
    0269C 9662      ADIW	R28,0x12
    0269D 9508      RET
_WriteFileHead:
  fs                   --> Y,+177
  bw                   --> Y,+175
  itam                 --> Y,+52
  fnamep               --> Y,+38
  file                 --> Y,+4
  res                  --> R10
    0269E 940E 484B CALL	push_xgset003C
    026A0 97EF      SBIW	R28,0x3F
    026A1 97EF      SBIW	R28,0x3F
    026A2 97EF      SBIW	R28,0x3F
    026A3 97EF      SBIW	R28,0x3F
    026A4 97EF      SBIW	R28,0x3F
    026A5 97EF      SBIW	R28,0x3F
    026A6 97EF      SBIW	R28,0x3F
    026A7 97EF      SBIW	R28,0x3F
    026A8 97EF      SBIW	R28,0x3F
    026A9 97EF      SBIW	R28,0x3F
    026AA 97EF      SBIW	R28,0x3F
    026AB 97AA      SBIW	R28,0x2A
(0114) 	  
(0115) }
(0116) 
(0117) void WriteFileHead(void)   
(0118) {
(0119)  	 unsigned int bw;
(0120) 	 FRESULT res;
(0121) 	 FATFS fs;
(0122) 	 FIL file;
(0123) 	 char fnamep[]="201201.xls\0\0\0"; 
    026AC E287      LDI	R24,0x27
    026AD E091      LDI	R25,1
    026AE 01FE      MOVW	R30,R28
    026AF 96B6      ADIW	R30,0x26
    026B0 E00E      LDI	R16,0xE
    026B1 E010      LDI	R17,0
    026B2 93FA      ST	-Y,R31
    026B3 93EA      ST	-Y,R30
    026B4 939A      ST	-Y,R25
    026B5 938A      ST	-Y,R24
    026B6 940E 48F5 CALL	asgnblk
(0124) 	 UINT8 itam[]="DEV000001\t\t\t\t\t\t\t\t\t\t\r\n序号\t日期\t时分\t温度\t风速\t风冷指数\t等价制冷温度\t相当温度\t冻伤危害性\t安静作业\t中等强度作业\t高强度作业\n\0";
    026B8 E385      LDI	R24,0x35
    026B9 E091      LDI	R25,1
    026BA 01FE      MOVW	R30,R28
    026BB 96F4      ADIW	R30,0x34
    026BC E70B      LDI	R16,0x7B
    026BD E010      LDI	R17,0
    026BE 93FA      ST	-Y,R31
    026BF 93EA      ST	-Y,R30
    026C0 939A      ST	-Y,R25
    026C1 938A      ST	-Y,R24
    026C2 940E 48F5 CALL	asgnblk
(0125) 	 res=disk_initialize(0);
    026C4 2700      CLR	R16
    026C5 940E 0397 CALL	_disk_initialize
    026C7 2EA0      MOV	R10,R16
(0126) 	 #ifdef _DEBUG
(0127) 	 debug("dinit",res);
    026C8 2D2A      MOV	R18,R10
    026C9 E10B      LDI	R16,0x1B
    026CA E012      LDI	R17,2
    026CB D652      RCALL	_debug
(0128) 	 #endif
(0129) 	 res = f_mount(0, &fs);
    026CC 019E      MOVW	R18,R28
    026CD 542F      SUBI	R18,0x4F
    026CE 4F3F      SBCI	R19,0xFF
    026CF 2700      CLR	R16
    026D0 940E 1783 CALL	_f_mount
    026D2 2EA0      MOV	R10,R16
(0130) 	 #ifdef _DEBUG
(0131)  	 debug("dmnt",res);
    026D3 2D2A      MOV	R18,R10
    026D4 E106      LDI	R16,0x16
    026D5 E012      LDI	R17,2
    026D6 D647      RCALL	_debug
(0132) 	 #endif
(0133) 	 //get_name(fnamep)
(0134) 	 res = f_open(&file, get_name(fnamep) , FA_OPEN_ALWAYS | FA_WRITE );  //创建一个新的文件
    026D7 018E      MOVW	R16,R28
    026D8 5D0A      SUBI	R16,0xDA
    026D9 4F1F      SBCI	R17,0xFF
    026DA D568      RCALL	_get_name
    026DB 0168      MOVW	R12,R16
    026DC E182      LDI	R24,0x12
    026DD 8388      ST	Y,R24
    026DE 0196      MOVW	R18,R12
    026DF 018E      MOVW	R16,R28
    026E0 5F0C      SUBI	R16,0xFC
    026E1 4F1F      SBCI	R17,0xFF
    026E2 940E 17AE CALL	_f_open
    026E4 2EC0      MOV	R12,R16
    026E5 2CAC      MOV	R10,R12
(0135) 	 #ifdef _DEBUG
(0136) 	 debug("fopen",res);
    026E6 2D2A      MOV	R18,R10
    026E7 E100      LDI	R16,0x10
    026E8 E012      LDI	R17,2
    026E9 D634      RCALL	_debug
(0137) 	 #endif
(0138) 	 res = f_write(&file,itam,128,&bw);   //bw 已写入字节数
    026EA 01CE      MOVW	R24,R28
    026EB 5581      SUBI	R24,0x51
    026EC 4F9F      SBCI	R25,0xFF
    026ED 839B      STD	Y+3,R25
    026EE 838A      STD	Y+2,R24
    026EF E880      LDI	R24,0x80
    026F0 E090      LDI	R25,0
    026F1 8399      STD	Y+1,R25
    026F2 8388      ST	Y,R24
    026F3 019E      MOVW	R18,R28
    026F4 5C2C      SUBI	R18,0xCC
    026F5 4F3F      SBCI	R19,0xFF
    026F6 018E      MOVW	R16,R28
    026F7 5F0C      SUBI	R16,0xFC
    026F8 4F1F      SBCI	R17,0xFF
    026F9 940E 1BB5 CALL	_f_write
    026FB 2EC0      MOV	R12,R16
    026FC 2CAC      MOV	R10,R12
(0139) 	 #ifdef _DEBUG
(0140) 	 debug("fwrite",res);
    026FD 2D2A      MOV	R18,R10
    026FE E009      LDI	R16,0x9
    026FF E012      LDI	R17,2
    02700 D61D      RCALL	_debug
(0141) 	 #endif
(0142) 	 f_close(&file);
    02701 018E      MOVW	R16,R28
    02702 5F0C      SUBI	R16,0xFC
    02703 4F1F      SBCI	R17,0xFF
    02704 940E 1F7F CALL	_f_close
(0143) 	 f_mount(0, NULL);
    02706 2722      CLR	R18
    02707 2733      CLR	R19
    02708 2700      CLR	R16
    02709 940E 1783 CALL	_f_mount
    0270B 96EF      ADIW	R28,0x3F
    0270C 96EF      ADIW	R28,0x3F
    0270D 96EF      ADIW	R28,0x3F
    0270E 96EF      ADIW	R28,0x3F
    0270F 96EF      ADIW	R28,0x3F
    02710 96EF      ADIW	R28,0x3F
    02711 96EF      ADIW	R28,0x3F
    02712 96EF      ADIW	R28,0x3F
    02713 96EF      ADIW	R28,0x3F
    02714 96EF      ADIW	R28,0x3F
    02715 96EF      ADIW	R28,0x3F
    02716 96AA      ADIW	R28,0x2A
    02717 940C 4825 JMP	pop_xgset003C
_WriteSDFile:
  fnamep               --> Y,+602
  fs                   --> Y,+44
  bw                   --> Y,+42
  lenth                --> Y,+38
  res                  --> R10
  file                 --> Y,+4
    02719 92AA      ST	-Y,R10
    0271A 92CA      ST	-Y,R12
    0271B 97EF      SBIW	R28,0x3F
    0271C 97EF      SBIW	R28,0x3F
    0271D 97EF      SBIW	R28,0x3F
    0271E 97EF      SBIW	R28,0x3F
    0271F 97EF      SBIW	R28,0x3F
    02720 97EF      SBIW	R28,0x3F
    02721 97EF      SBIW	R28,0x3F
    02722 97EF      SBIW	R28,0x3F
    02723 97EF      SBIW	R28,0x3F
    02724 97E0      SBIW	R28,0x30
(0144) } /////////////////////////////////////////////////
(0145) //       写入文件函数 
(0146) //(创建)打开文件 
(0147) // data 指向欲写入的的字符串 64byt 
(0148) //////////////////////////////////////////////// 
(0149) void WriteSDFile(void)   
(0150) {
(0151)     unsigned int bw;
(0152) 	FRESULT res;
(0153) 	FATFS fs;
(0154)     FIL file;
(0155) 	char fnamep[13];
(0156) 	long lenth=0;
    02725 E080      LDI	R24,0
    02726 A38E      STD	Y+38,R24
    02727 A38F      STD	Y+39,R24
    02728 A788      STD	Y+40,R24
    02729 A789      STD	Y+41,R24
(0157) 	disk_initialize(0);
    0272A 2700      CLR	R16
    0272B 940E 0397 CALL	_disk_initialize
(0158) 	res = f_mount(0, &fs);
    0272D 019E      MOVW	R18,R28
    0272E 5D24      SUBI	R18,0xD4
    0272F 4F3F      SBCI	R19,0xFF
    02730 2700      CLR	R16
    02731 940E 1783 CALL	_f_mount
(0159) 	res = f_open(&file,get_name(fnamep), FA_OPEN_ALWAYS | FA_WRITE );  //创建一个新的文件
    02733 018E      MOVW	R16,R28
    02734 5A06      SUBI	R16,0xA6
    02735 4F1D      SBCI	R17,0xFD
    02736 D50C      RCALL	_get_name
    02737 E182      LDI	R24,0x12
    02738 8388      ST	Y,R24
    02739 0198      MOVW	R18,R16
    0273A 018E      MOVW	R16,R28
    0273B 5F0C      SUBI	R16,0xFC
    0273C 4F1F      SBCI	R17,0xFF
    0273D 940E 17AE CALL	_f_open
(0160) 	lenth=file.fsize;   
    0273F 842E      LDD	R2,Y+14
    02740 843F      LDD	R3,Y+15
    02741 8848      LDD	R4,Y+16
    02742 8859      LDD	R5,Y+17
    02743 A22E      STD	Y+38,R2
    02744 A23F      STD	Y+39,R3
    02745 A648      STD	Y+40,R4
    02746 A659      STD	Y+41,R5
(0161) 	res = f_lseek (&file,lenth);	 
    02747 A02E      LDD	R2,Y+38
    02748 A03F      LDD	R3,Y+39
    02749 A448      LDD	R4,Y+40
    0274A A459      LDD	R5,Y+41
    0274B 8248      ST	Y,R4
    0274C 8259      STD	Y+1,R5
    0274D 0191      MOVW	R18,R2
    0274E 018E      MOVW	R16,R28
    0274F 5F0C      SUBI	R16,0xFC
    02750 4F1F      SBCI	R17,0xFF
    02751 940E 1F8F CALL	_f_lseek
(0162) 	res = f_write(&file,TempChar,SINGLE_ITEM_SIZE,&bw);   //bw 已写入字节数
    02753 01CE      MOVW	R24,R28
    02754 968A      ADIW	R24,0x2A
    02755 839B      STD	Y+3,R25
    02756 838A      STD	Y+2,R24
    02757 E480      LDI	R24,0x40
    02758 E090      LDI	R25,0
    02759 8399      STD	Y+1,R25
    0275A 8388      ST	Y,R24
    0275B E923      LDI	R18,0x93
    0275C E035      LDI	R19,5
    0275D 018E      MOVW	R16,R28
    0275E 5F0C      SUBI	R16,0xFC
    0275F 4F1F      SBCI	R17,0xFF
    02760 940E 1BB5 CALL	_f_write
    02762 2EC0      MOV	R12,R16
    02763 2CAC      MOV	R10,R12
(0163) 	f_close(&file);
    02764 018E      MOVW	R16,R28
    02765 5F0C      SUBI	R16,0xFC
    02766 4F1F      SBCI	R17,0xFF
    02767 940E 1F7F CALL	_f_close
(0164) 	f_mount(0, NULL);
    02769 2722      CLR	R18
    0276A 2733      CLR	R19
    0276B 2700      CLR	R16
    0276C 940E 1783 CALL	_f_mount
    0276E 96EF      ADIW	R28,0x3F
    0276F 96EF      ADIW	R28,0x3F
    02770 96EF      ADIW	R28,0x3F
    02771 96EF      ADIW	R28,0x3F
    02772 96EF      ADIW	R28,0x3F
    02773 96EF      ADIW	R28,0x3F
    02774 96EF      ADIW	R28,0x3F
    02775 96EF      ADIW	R28,0x3F
    02776 96EF      ADIW	R28,0x3F
    02777 96E0      ADIW	R28,0x30
    02778 90C9      LD	R12,Y+
    02779 90A9      LD	R10,Y+
    0277A 9508      RET
_ReadSDFile:
  fs                   --> Y,+40
  bw                   --> Y,+38
  max                  --> R12
  file                 --> Y,+4
  res                  --> R20
  mode                 --> R22
  data                 --> R10
  index                --> R14
  fnamep               --> R12
    0277B 940E 4845 CALL	push_xgsetF0FC
    0277D 0179      MOVW	R14,R18
    0277E 0168      MOVW	R12,R16
    0277F 97EF      SBIW	R28,0x3F
    02780 97EF      SBIW	R28,0x3F
    02781 97EF      SBIW	R28,0x3F
    02782 97EF      SBIW	R28,0x3F
    02783 97EF      SBIW	R28,0x3F
    02784 97EF      SBIW	R28,0x3F
    02785 97EF      SBIW	R28,0x3F
    02786 97EF      SBIW	R28,0x3F
    02787 97EF      SBIW	R28,0x3F
    02788 976F      SBIW	R28,0x1F
    02789 01FE      MOVW	R30,R28
    0278A 5AE0      SUBI	R30,0xA0
    0278B 4FFD      SBCI	R31,0xFD
    0278C 80A0      LD	R10,Z
    0278D 80B1      LDD	R11,Z+1
    0278E 01FE      MOVW	R30,R28
    0278F 59EE      SUBI	R30,0x9E
    02790 4FFD      SBCI	R31,0xFD
    02791 8160      LD	R22,Z
(0165) }
(0166) /////////////////////////////////////////////////
(0167) //       读取文件函数
(0168) //以64byte为一块 读取
(0169) //index数据偏移量   data读出后存放地
(0170) //////////////////////////////////////////////// 
(0171) char ReadSDFile(char *fnamep,int index, char *data, char mode)
(0172) {
(0173)  	unsigned int bw;
(0174) 	char res;
(0175) 	FATFS fs;
(0176)     FIL file;
(0177) 	static int indexoffset;
(0178) 	unsigned int max;
(0179) 	disk_initialize(0);
    02792 2700      CLR	R16
    02793 940E 0397 CALL	_disk_initialize
(0180)     res = f_mount(0, &fs);
    02795 019E      MOVW	R18,R28
    02796 5D28      SUBI	R18,0xD8
    02797 4F3F      SBCI	R19,0xFF
    02798 2700      CLR	R16
    02799 940E 1783 CALL	_f_mount
(0181)     res = f_open(&file,fnamep,FA_READ);  
    0279B E081      LDI	R24,1
    0279C 8388      ST	Y,R24
    0279D 0196      MOVW	R18,R12
    0279E 018E      MOVW	R16,R28
    0279F 5F0C      SUBI	R16,0xFC
    027A0 4F1F      SBCI	R17,0xFF
    027A1 940E 17AE CALL	_f_open
    027A3 2F40      MOV	R20,R16
(0182)     if(res==FR_NO_FILE) {
    027A4 3004      CPI	R16,4
    027A5 F419      BNE	0x27A9
(0183) 	data=NULL;
    027A6 24AA      CLR	R10
    027A7 24BB      CLR	R11
(0184)     #if _debug >= 1 
(0185)     debug_out("now file",255);
(0186) 	debug_out(filename,res);
(0187) 	debug_out("file is no exist....",255);
(0188)     #endif 
(0189)     return res;
    027A8 C078      RJMP	0x2821
(0190)     }   
(0191)     max = (file.fsize-128)/SINGLE_ITEM_SIZE;
    027A9 E880      LDI	R24,0x80
    027AA E090      LDI	R25,0
    027AB E0A0      LDI	R26,0
    027AC E0B0      LDI	R27,0
    027AD 850E      LDD	R16,Y+14
    027AE 851F      LDD	R17,Y+15
    027AF 8928      LDD	R18,Y+16
    027B0 8939      LDD	R19,Y+17
    027B1 1B08      SUB	R16,R24
    027B2 0B19      SBC	R17,R25
    027B3 0B2A      SBC	R18,R26
    027B4 0B3B      SBC	R19,R27
    027B5 E086      LDI	R24,6
    027B6 E090      LDI	R25,0
    027B7 938A      ST	-Y,R24
    027B8 940E 48E9 CALL	lsr32
    027BA 0168      MOVW	R12,R16
(0192) 	if(mode == 0){ //绝对位置模式
    027BB 2366      TST	R22
    027BC F429      BNE	0x27C2
(0193) 		indexoffset = index;
    027BD 92F0 0592 STS	main.c:indexoffset+1,R15
    027BF 92E0 0591 STS	main.c:indexoffset,R14
(0194) 	}
    027C1 C00C      RJMP	0x27CE
(0195) 	else if(mode == 1){ //位置偏移模式
    027C2 3061      CPI	R22,1
    027C3 F451      BNE	0x27CE
(0196) 		indexoffset+=index;
    027C4 9020 0591 LDS	R2,main.c:indexoffset
    027C6 9030 0592 LDS	R3,main.c:indexoffset+1
    027C8 0C2E      ADD	R2,R14
    027C9 1C3F      ADC	R3,R15
    027CA 9230 0592 STS	main.c:indexoffset+1,R3
    027CC 9220 0591 STS	main.c:indexoffset,R2
(0197) 	}
(0198) 	if(indexoffset >max){
    027CE 9020 0591 LDS	R2,main.c:indexoffset
    027D0 9030 0592 LDS	R3,main.c:indexoffset+1
    027D2 14C2      CP	R12,R2
    027D3 04D3      CPC	R13,R3
    027D4 F428      BCC	0x27DA
(0199) 	    indexoffset = max;
    027D5 92D0 0592 STS	main.c:indexoffset+1,R13
    027D7 92C0 0591 STS	main.c:indexoffset,R12
(0200) 	}
    027D9 C00F      RJMP	0x27E9
(0201) 	else if(indexoffset <=0){
    027DA 2422      CLR	R2
    027DB 2433      CLR	R3
    027DC 9040 0591 LDS	R4,main.c:indexoffset
    027DE 9050 0592 LDS	R5,main.c:indexoffset+1
    027E0 1424      CP	R2,R4
    027E1 0435      CPC	R3,R5
    027E2 F034      BLT	0x27E9
(0202) 		indexoffset = 1;
    027E3 E081      LDI	R24,1
    027E4 E090      LDI	R25,0
    027E5 9390 0592 STS	main.c:indexoffset+1,R25
    027E7 9380 0591 STS	main.c:indexoffset,R24
(0203) 	}
(0204) 	res = f_lseek (&file,(indexoffset-1)*SINGLE_ITEM_SIZE+128);	 //前两个字节数据为文件头空间 所以从第三块读/写起
    027E9 9120 0591 LDS	R18,main.c:indexoffset
    027EB 9130 0592 LDS	R19,main.c:indexoffset+1
    027ED E400      LDI	R16,0x40
    027EE E010      LDI	R17,0
    027EF 940E 47E1 CALL	empy16s
    027F1 01C8      MOVW	R24,R16
    027F2 5480      SUBI	R24,0x40
    027F3 4090      SBCI	R25,0
    027F4 5880      SUBI	R24,0x80
    027F5 4F9F      SBCI	R25,0xFF
    027F6 011C      MOVW	R2,R24
    027F7 2444      CLR	R4
    027F8 FC37      SBRC	R3,7
    027F9 9440      COM	R4
    027FA 2455      CLR	R5
    027FB FC47      SBRC	R4,7
    027FC 9450      COM	R5
    027FD 8248      ST	Y,R4
    027FE 8259      STD	Y+1,R5
    027FF 0191      MOVW	R18,R2
    02800 018E      MOVW	R16,R28
    02801 5F0C      SUBI	R16,0xFC
    02802 4F1F      SBCI	R17,0xFF
    02803 940E 1F8F CALL	_f_lseek
    02805 2EC0      MOV	R12,R16
(0205)     res = f_read(&file,data,SINGLE_ITEM_SIZE,&bw);
    02806 01CE      MOVW	R24,R28
    02807 9686      ADIW	R24,0x26
    02808 839B      STD	Y+3,R25
    02809 838A      STD	Y+2,R24
    0280A E480      LDI	R24,0x40
    0280B E090      LDI	R25,0
    0280C 8399      STD	Y+1,R25
    0280D 8388      ST	Y,R24
    0280E 0195      MOVW	R18,R10
    0280F 018E      MOVW	R16,R28
    02810 5F0C      SUBI	R16,0xFC
    02811 4F1F      SBCI	R17,0xFF
    02812 940E 194A CALL	_f_read
    02814 2EA0      MOV	R10,R16
    02815 2D4A      MOV	R20,R10
(0206)     f_close(&file);
    02816 018E      MOVW	R16,R28
    02817 5F0C      SUBI	R16,0xFC
    02818 4F1F      SBCI	R17,0xFF
    02819 940E 1F7F CALL	_f_close
(0207) 	f_mount(0, NULL);
    0281B 2722      CLR	R18
    0281C 2733      CLR	R19
    0281D 2700      CLR	R16
    0281E 940E 1783 CALL	_f_mount
(0208) 	return res;
    02820 2F04      MOV	R16,R20
    02821 96EF      ADIW	R28,0x3F
    02822 96EF      ADIW	R28,0x3F
    02823 96EF      ADIW	R28,0x3F
    02824 96EF      ADIW	R28,0x3F
    02825 96EF      ADIW	R28,0x3F
    02826 96EF      ADIW	R28,0x3F
    02827 96EF      ADIW	R28,0x3F
    02828 96EF      ADIW	R28,0x3F
    02829 96EF      ADIW	R28,0x3F
    0282A 966F      ADIW	R28,0x1F
    0282B 940C 483A JMP	pop_xgsetF0FC
_findIndex:
  fs                   --> Y,+48
  bw                   --> Y,+46
  fnamep               --> R14
  readsize             --> R10
  res                  --> R12
  file                 --> Y,+12
  lenth                --> Y,+8
  index                --> Y,+4
  is_first_end         --> Y,+606
  tmp                  --> R10
  buf                  --> Y,+617
  filename             --> R10
    0282D 933A      ST	-Y,R19
    0282E 932A      ST	-Y,R18
    0282F 940E 4845 CALL	push_xgsetF0FC
    02831 0158      MOVW	R10,R16
    02832 97EF      SBIW	R28,0x3F
    02833 97EF      SBIW	R28,0x3F
    02834 97EF      SBIW	R28,0x3F
    02835 97EF      SBIW	R28,0x3F
    02836 97EF      SBIW	R28,0x3F
    02837 97EF      SBIW	R28,0x3F
    02838 97EF      SBIW	R28,0x3F
    02839 97EF      SBIW	R28,0x3F
    0283A 97EF      SBIW	R28,0x3F
    0283B 97A8      SBIW	R28,0x28
(0209) } 
(0210) //////////////////////////////////
(0211) //   find index
(0212) // 检查当前文件尺寸，根据倒数第二个
(0213) //'\n'及其后面的index确定当前index值
(0214) //////////////////////////////////
(0215) unsigned int findIndex(char *filename,char *buf){
(0216)     unsigned int bw,tmp;
(0217) 	long index =0;
    0283C E080      LDI	R24,0
    0283D 838C      STD	Y+4,R24
    0283E 838D      STD	Y+5,R24
    0283F 838E      STD	Y+6,R24
    02840 838F      STD	Y+7,R24
(0218) 	unsigned char is_first_end=0;
    02841 2400      CLR	R0
    02842 01DE      MOVW	R26,R28
    02843 5AA2      SUBI	R26,0xA2
    02844 4FBD      SBCI	R27,0xFD
    02845 920C      ST	X,R0
(0219) 	char *fnamep=filename;
    02846 0175      MOVW	R14,R10
(0220) 	FRESULT res;
(0221) 	FATFS fs;
(0222) 	FIL file;
(0223) 	long lenth=0;
    02847 E080      LDI	R24,0
    02848 8788      STD	Y+8,R24
    02849 8789      STD	Y+9,R24
    0284A 878A      STD	Y+10,R24
    0284B 878B      STD	Y+11,R24
(0224) 	int readsize=0;
    0284C 24AA      CLR	R10
    0284D 24BB      CLR	R11
(0225) 	//PrintString_n(fnamep);
(0226) 	res = f_mount(0, &fs);
    0284E 019E      MOVW	R18,R28
    0284F 5D20      SUBI	R18,0xD0
    02850 4F3F      SBCI	R19,0xFF
    02851 2700      CLR	R16
    02852 940E 1783 CALL	_f_mount
(0227) 	res = f_open(&file,fnamep, FA_OPEN_ALWAYS | FA_READ );  //创建一个新的文件
    02854 E181      LDI	R24,0x11
    02855 8388      ST	Y,R24
    02856 0197      MOVW	R18,R14
    02857 018E      MOVW	R16,R28
    02858 5F04      SUBI	R16,0xF4
    02859 4F1F      SBCI	R17,0xFF
    0285A 940E 17AE CALL	_f_open
    0285C 2EC0      MOV	R12,R16
(0228) 	if(res !=  FR_OK){ //openerror
    0285D 2300      TST	R16
    0285E F011      BEQ	0x2861
(0229) 	    return res;}
    0285F 2711      CLR	R17
    02860 C11E      RJMP	0x297F
(0230) 	lenth=file.fsize;   //文件尾部为 file.size 
    02861 882E      LDD	R2,Y+22
    02862 883F      LDD	R3,Y+23
    02863 8C48      LDD	R4,Y+24
    02864 8C59      LDD	R5,Y+25
    02865 8628      STD	Y+8,R2
    02866 8639      STD	Y+9,R3
    02867 864A      STD	Y+10,R4
    02868 865B      STD	Y+11,R5
(0231) 	//debug("size=",0xff);
(0232) 	//PrintLong(lenth);
(0233) 	if(lenth > 512) {
    02869 E040      LDI	R20,0
    0286A E052      LDI	R21,2
    0286B E060      LDI	R22,0
    0286C E070      LDI	R23,0
    0286D 8428      LDD	R2,Y+8
    0286E 8439      LDD	R3,Y+9
    0286F 844A      LDD	R4,Y+10
    02870 845B      LDD	R5,Y+11
    02871 1542      CP	R20,R2
    02872 0553      CPC	R21,R3
    02873 0564      CPC	R22,R4
    02874 0575      CPC	R23,R5
    02875 F464      BGE	0x2882
(0234) 	    readsize=512;
    02876 E080      LDI	R24,0
    02877 E092      LDI	R25,2
    02878 015C      MOVW	R10,R24
(0235) 		lenth=file.fsize;
    02879 882E      LDD	R2,Y+22
    0287A 883F      LDD	R3,Y+23
    0287B 8C48      LDD	R4,Y+24
    0287C 8C59      LDD	R5,Y+25
    0287D 8628      STD	Y+8,R2
    0287E 8639      STD	Y+9,R3
    0287F 864A      STD	Y+10,R4
    02880 865B      STD	Y+11,R5
(0236) 	}
    02881 C007      RJMP	0x2889
(0237) 	else {
(0238) 	    readsize =file.fsize;
    02882 88AE      LDD	R10,Y+22
    02883 88BF      LDD	R11,Y+23
(0239) 		lenth=0;
    02884 E080      LDI	R24,0
    02885 8788      STD	Y+8,R24
    02886 8789      STD	Y+9,R24
    02887 878A      STD	Y+10,R24
    02888 878B      STD	Y+11,R24
(0240) 	}
(0241) 	res = f_lseek (&file,file.fsize-readsize);
    02889 0115      MOVW	R2,R10
    0288A 2444      CLR	R4
    0288B FC37      SBRC	R3,7
    0288C 9440      COM	R4
    0288D 2455      CLR	R5
    0288E FC47      SBRC	R4,7
    0288F 9450      COM	R5
    02890 886E      LDD	R6,Y+22
    02891 887F      LDD	R7,Y+23
    02892 8C88      LDD	R8,Y+24
    02893 8C99      LDD	R9,Y+25
    02894 1862      SUB	R6,R2
    02895 0873      SBC	R7,R3
    02896 0884      SBC	R8,R4
    02897 0895      SBC	R9,R5
    02898 8288      ST	Y,R8
    02899 8299      STD	Y+1,R9
    0289A 0193      MOVW	R18,R6
    0289B 018E      MOVW	R16,R28
    0289C 5F04      SUBI	R16,0xF4
    0289D 4F1F      SBCI	R17,0xFF
    0289E 940E 1F8F CALL	_f_lseek
(0242) 	//debug("readSIZE=",0x00);
(0243) 	//PrintLong((file.fsize-readsize));
(0244) 	res = f_read(&file,buf,readsize,&bw);
    028A0 01CE      MOVW	R24,R28
    028A1 968E      ADIW	R24,0x2E
    028A2 839B      STD	Y+3,R25
    028A3 838A      STD	Y+2,R24
    028A4 82B9      STD	Y+1,R11
    028A5 82A8      ST	Y,R10
    028A6 01FE      MOVW	R30,R28
    028A7 59E7      SUBI	R30,0x97
    028A8 4FFD      SBCI	R31,0xFD
    028A9 8120      LD	R18,Z
    028AA 8131      LDD	R19,Z+1
    028AB 018E      MOVW	R16,R28
    028AC 5F04      SUBI	R16,0xF4
    028AD 4F1F      SBCI	R17,0xFF
    028AE 940E 194A CALL	_f_read
    028B0 2EE0      MOV	R14,R16
    028B1 2CCE      MOV	R12,R14
(0245) 	f_close(&file);
    028B2 018E      MOVW	R16,R28
    028B3 5F04      SUBI	R16,0xF4
    028B4 4F1F      SBCI	R17,0xFF
    028B5 940E 1F7F CALL	_f_close
(0246) 	//debug("readRES=",res);
(0247) 	//debug("readbw=",0X00);
(0248) 	//PrintLong(bw);
(0249) 	//PrintString_n(buf);
(0250) 	for(tmp=readsize;tmp>0;tmp--){
    028B7 C04E      RJMP	0x2906
(0251) 		//debug("buf index",buf[tmp]);
(0252) 		//PrintLong(tmp);
(0253) 		if(buf[tmp] == '\n') Usart_Transmit('@');						  
    028B8 01F5      MOVW	R30,R10
    028B9 01DE      MOVW	R26,R28
    028BA 59A7      SUBI	R26,0x97
    028BB 4FBD      SBCI	R27,0xFD
    028BC 900D      LD	R0,X+
    028BD 901C      LD	R1,X
    028BE 0DE0      ADD	R30,R0
    028BF 1DF1      ADC	R31,R1
    028C0 8180      LD	R24,Z
    028C1 308A      CPI	R24,0xA
    028C2 F419      BNE	0x28C6
    028C3 E400      LDI	R16,0x40
    028C4 940E 3A38 CALL	_Usart_Transmit
(0254) 		if(buf[tmp] == '\n' && is_first_end== 0){
    028C6 01F5      MOVW	R30,R10
    028C7 01DE      MOVW	R26,R28
    028C8 59A7      SUBI	R26,0x97
    028C9 4FBD      SBCI	R27,0xFD
    028CA 900D      LD	R0,X+
    028CB 901C      LD	R1,X
    028CC 0DE0      ADD	R30,R0
    028CD 1DF1      ADC	R31,R1
    028CE 8180      LD	R24,Z
    028CF 308A      CPI	R24,0xA
    028D0 F469      BNE	0x28DE
    028D1 01FE      MOVW	R30,R28
    028D2 5AE2      SUBI	R30,0xA2
    028D3 4FFD      SBCI	R31,0xFD
    028D4 8000      LD	R0,Z
    028D5 2000      TST	R0
    028D6 F439      BNE	0x28DE
(0255) 		    is_first_end=1; 	
    028D7 2400      CLR	R0
    028D8 9403      INC	R0
    028D9 01FE      MOVW	R30,R28
    028DA 5AE2      SUBI	R30,0xA2
    028DB 4FFD      SBCI	R31,0xFD
    028DC 8200      ST	Z,R0
(0256) 			//debug("first=",0xf0);					      
(0257) 		}
    028DD C025      RJMP	0x2903
(0258) 		else if(buf[tmp] == '\n' && is_first_end== 1){
    028DE 01F5      MOVW	R30,R10
    028DF 01DE      MOVW	R26,R28
    028E0 59A7      SUBI	R26,0x97
    028E1 4FBD      SBCI	R27,0xFD
    028E2 900D      LD	R0,X+
    028E3 901C      LD	R1,X
    028E4 0DE0      ADD	R30,R0
    028E5 1DF1      ADC	R31,R1
    028E6 8180      LD	R24,Z
    028E7 308A      CPI	R24,0xA
    028E8 F4D1      BNE	0x2903
    028E9 01DE      MOVW	R26,R28
    028EA 5AA2      SUBI	R26,0xA2
    028EB 4FBD      SBCI	R27,0xFD
    028EC 918C      LD	R24,X
    028ED 3081      CPI	R24,1
    028EE F4A1      BNE	0x2903
(0259) 		    lenth -= (512-tmp);
    028EF E080      LDI	R24,0
    028F0 E092      LDI	R25,2
    028F1 011C      MOVW	R2,R24
    028F2 182A      SUB	R2,R10
    028F3 083B      SBC	R3,R11
    028F4 2444      CLR	R4
    028F5 2455      CLR	R5
    028F6 8468      LDD	R6,Y+8
    028F7 8479      LDD	R7,Y+9
    028F8 848A      LDD	R8,Y+10
    028F9 849B      LDD	R9,Y+11
    028FA 1862      SUB	R6,R2
    028FB 0873      SBC	R7,R3
    028FC 0884      SBC	R8,R4
    028FD 0895      SBC	R9,R5
    028FE 8668      STD	Y+8,R6
    028FF 8679      STD	Y+9,R7
    02900 868A      STD	Y+10,R8
    02901 869B      STD	Y+11,R9
(0260) 			break;
    02902 C009      RJMP	0x290C
    02903 01C5      MOVW	R24,R10
    02904 9701      SBIW	R24,1
    02905 015C      MOVW	R10,R24
    02906 20AA      TST	R10
    02907 F009      BEQ	0x2909
    02908 CFAF      RJMP	0x28B8
    02909 20BB      TST	R11
    0290A F009      BEQ	0x290C
    0290B CFAC      RJMP	0x28B8
(0261) 		} 						
(0262) 	}
(0263) 	//debug("start=",0X00); PrintLong(lenth);
(0264) 	if(lenth < 118 ){ 
    0290C E746      LDI	R20,0x76
    0290D E050      LDI	R21,0
    0290E E060      LDI	R22,0
    0290F E070      LDI	R23,0
    02910 8428      LDD	R2,Y+8
    02911 8439      LDD	R3,Y+9
    02912 844A      LDD	R4,Y+10
    02913 845B      LDD	R5,Y+11
    02914 1624      CP	R2,R20
    02915 0635      CPC	R3,R21
    02916 0646      CPC	R4,R22
    02917 0657      CPC	R5,R23
    02918 F434      BGE	0x291F
(0265)  		return 1;
    02919 E001      LDI	R16,1
    0291A E010      LDI	R17,0
    0291B C063      RJMP	0x297F
(0266) 	}
(0267) 	else {
(0268) 		 //debug(">128 ",0X00);
(0269) 		 while(buf[tmp] <= '0' || buf[tmp] >= '9') tmp++;
    0291C 01C5      MOVW	R24,R10
    0291D 9601      ADIW	R24,1
    0291E 015C      MOVW	R10,R24
    0291F 01F5      MOVW	R30,R10
    02920 01DE      MOVW	R26,R28
    02921 59A7      SUBI	R26,0x97
    02922 4FBD      SBCI	R27,0xFD
    02923 900D      LD	R0,X+
    02924 901C      LD	R1,X
    02925 0DE0      ADD	R30,R0
    02926 1DF1      ADC	R31,R1
    02927 80E0      LD	R14,Z
    02928 24FF      CLR	R15
    02929 E380      LDI	R24,0x30
    0292A 158E      CP	R24,R14
    0292B F780      BCC	0x291C
    0292C 2D8E      MOV	R24,R14
    0292D 3389      CPI	R24,0x39
    0292E F768      BCC	0x291C
    0292F C02F      RJMP	0x295F
(0270) 		 //debug("nozero ",bw); PrintLong(tmp);
(0271) 		 while(buf[tmp] != 't' && buf[tmp] >= '0' && buf[tmp] <= '9'){
(0272) 		     index=index*10+(buf[tmp]-'0');
    02930 01F5      MOVW	R30,R10
    02931 01DE      MOVW	R26,R28
    02932 59A7      SUBI	R26,0x97
    02933 4FBD      SBCI	R27,0xFD
    02934 900D      LD	R0,X+
    02935 901C      LD	R1,X
    02936 0DE0      ADD	R30,R0
    02937 1DF1      ADC	R31,R1
    02938 8180      LD	R24,Z
    02939 2799      CLR	R25
    0293A 97C0      SBIW	R24,0x30
    0293B 011C      MOVW	R2,R24
    0293C 2444      CLR	R4
    0293D FC37      SBRC	R3,7
    0293E 9440      COM	R4
    0293F 2455      CLR	R5
    02940 FC47      SBRC	R4,7
    02941 9450      COM	R5
    02942 806C      LDD	R6,Y+4
    02943 807D      LDD	R7,Y+5
    02944 808E      LDD	R8,Y+6
    02945 809F      LDD	R9,Y+7
    02946 E04A      LDI	R20,0xA
    02947 E050      LDI	R21,0
    02948 E060      LDI	R22,0
    02949 E070      LDI	R23,0
    0294A 929A      ST	-Y,R9
    0294B 928A      ST	-Y,R8
    0294C 927A      ST	-Y,R7
    0294D 926A      ST	-Y,R6
    0294E 018A      MOVW	R16,R20
    0294F 019B      MOVW	R18,R22
    02950 940E 47F1 CALL	empy32s|empy32u
    02952 0138      MOVW	R6,R16
    02953 0149      MOVW	R8,R18
    02954 0C62      ADD	R6,R2
    02955 1C73      ADC	R7,R3
    02956 1C84      ADC	R8,R4
    02957 1C95      ADC	R9,R5
    02958 826C      STD	Y+4,R6
    02959 827D      STD	Y+5,R7
    0295A 828E      STD	Y+6,R8
    0295B 829F      STD	Y+7,R9
(0273) 		 	 //Usart_Transmit(buf[tmp]);	
(0274) 		 	 tmp++;
    0295C 01C5      MOVW	R24,R10
    0295D 9601      ADIW	R24,1
    0295E 015C      MOVW	R10,R24
    0295F 01F5      MOVW	R30,R10
    02960 01DE      MOVW	R26,R28
    02961 59A7      SUBI	R26,0x97
    02962 4FBD      SBCI	R27,0xFD
    02963 900D      LD	R0,X+
    02964 901C      LD	R1,X
    02965 0DE0      ADD	R30,R0
    02966 1DF1      ADC	R31,R1
    02967 80E0      LD	R14,Z
    02968 24FF      CLR	R15
    02969 2D8E      MOV	R24,R14
    0296A 3784      CPI	R24,0x74
    0296B F031      BEQ	0x2972
    0296C 3380      CPI	R24,0x30
    0296D F020      BCS	0x2972
    0296E E389      LDI	R24,0x39
    0296F 158E      CP	R24,R14
    02970 F008      BCS	0x2972
    02971 CFBE      RJMP	0x2930
(0275) 		 }
(0276) 	}
(0277) 	//debug("index=",0X00);
(0278) 	//PrintLong(index+1);
(0279) 	return index+1;
    02972 E041      LDI	R20,1
    02973 E050      LDI	R21,0
    02974 E060      LDI	R22,0
    02975 E070      LDI	R23,0
    02976 802C      LDD	R2,Y+4
    02977 803D      LDD	R3,Y+5
    02978 804E      LDD	R4,Y+6
    02979 805F      LDD	R5,Y+7
    0297A 0E24      ADD	R2,R20
    0297B 1E35      ADC	R3,R21
    0297C 1E46      ADC	R4,R22
    0297D 1E57      ADC	R5,R23
    0297E 0181      MOVW	R16,R2
    0297F 96EF      ADIW	R28,0x3F
    02980 96EF      ADIW	R28,0x3F
    02981 96EF      ADIW	R28,0x3F
    02982 96EF      ADIW	R28,0x3F
    02983 96EF      ADIW	R28,0x3F
    02984 96EF      ADIW	R28,0x3F
    02985 96EF      ADIW	R28,0x3F
    02986 96EF      ADIW	R28,0x3F
    02987 96EF      ADIW	R28,0x3F
    02988 96A8      ADIW	R28,0x28
    02989 940E 483A CALL	pop_xgsetF0FC
    0298B 9622      ADIW	R28,2
    0298C 9508      RET
_scan_files:
  i                    --> R14
  dir                  --> Y,+22
  fn                   --> R14
  res                  --> R10
  fno                  --> Y,+0
  path                 --> R12
    0298D 940E 4849 CALL	push_xgset00FC
    0298F 0168      MOVW	R12,R16
    02990 97AC      SBIW	R28,0x2C
(0280) }
(0281) ////////////////////////////////////////////////
(0282) //			文件查找函数
(0283) //
(0284) ////////////////////////////////////////////////
(0285) char scan_files (char* path)
(0286) {
(0287)     FRESULT res;
(0288)     FILINFO fno;
(0289)     DIR dir;
(0290)     int i;
(0291)     char *fn;
(0292) #if _USE_LFN   //长文件名支持
(0293)     static char lfn[_MAX_LFN * (_DF1S ? 2 : 1) + 1];
(0294)     fno.lfname = lfn;
(0295)     fno.lfsize = sizeof(lfn);
(0296) #endif
(0297)     res = f_opendir(&dir, path); //打开文件夹
    02991 0196      MOVW	R18,R12
    02992 018E      MOVW	R16,R28
    02993 5E0A      SUBI	R16,0xEA
    02994 4F1F      SBCI	R17,0xFF
    02995 940E 244C CALL	_f_opendir
    02997 2EA0      MOV	R10,R16
(0298)     if (res == FR_OK) {PrintString_n("opendir ok");
    02998 2300      TST	R16
    02999 F009      BEQ	0x299B
    0299A C035      RJMP	0x29D0
    0299B EF0E      LDI	R16,0xFE
    0299C E011      LDI	R17,1
    0299D 940E 3A79 CALL	_PrintString_n
(0299)         i = strlen(path);
    0299F 0186      MOVW	R16,R12
    029A0 940E 46F4 CALL	_strlen
(0300)         for (;;) {
(0301)             res = f_readdir(&dir, &fno);
    029A2 019E      MOVW	R18,R28
    029A3 018E      MOVW	R16,R28
    029A4 5E0A      SUBI	R16,0xEA
    029A5 4F1F      SBCI	R17,0xFF
    029A6 940E 24C0 CALL	_f_readdir
    029A8 2EE0      MOV	R14,R16
    029A9 2CAE      MOV	R10,R14
(0302) 			debug("read addr",res);debug(fno.fname,255);
    029AA 2D2A      MOV	R18,R10
    029AB EF04      LDI	R16,0xF4
    029AC E011      LDI	R17,1
    029AD D370      RCALL	_debug
    029AE EF2F      LDI	R18,0xFF
    029AF 018E      MOVW	R16,R28
    029B0 5F07      SUBI	R16,0xF7
    029B1 4F1F      SBCI	R17,0xFF
    029B2 D36B      RCALL	_debug
(0303)             if (res != FR_OK || fno.fname[0] == 0){ debug("break",255);break; }
    029B3 20EE      TST	R14
    029B4 F419      BNE	0x29B8
    029B5 8429      LDD	R2,Y+9
    029B6 2022      TST	R2
    029B7 F429      BNE	0x29BD
    029B8 EF2F      LDI	R18,0xFF
    029B9 EE0E      LDI	R16,0xEE
    029BA E011      LDI	R17,1
    029BB D362      RCALL	_debug
    029BC C013      RJMP	0x29D0
(0304) #if _USE_LFN
(0305)             fn = *fno.lfname ? fno.lfname : fno.fname;
(0306) #else
(0307)             fn = fno.fname;
    029BD 01CE      MOVW	R24,R28
    029BE 9609      ADIW	R24,0x9
    029BF 017C      MOVW	R14,R24
(0308) #endif
(0309) 	  		PrintString_n("aaa");
    029C0 EE0A      LDI	R16,0xEA
    029C1 E011      LDI	R17,1
    029C2 940E 3A79 CALL	_PrintString_n
(0310)             if (*fn == '.') continue;
    029C4 01F7      MOVW	R30,R14
    029C5 8180      LD	R24,Z
    029C6 328E      CPI	R24,0x2E
    029C7 F409      BNE	0x29C9
    029C8 CFD9      RJMP	0x29A2
(0311)            /* if (fno.fattrib & AM_DIR) {
(0312)                 sprintf(&path[i], "/%s", fn);PrintString_n(fn);
(0313)                 res = scan_files(path);
(0314)                 if (res != FR_OK) break;
(0315)                 path[i] = 0;
(0316)             } else {
(0317)                 PrintString_n(path);
(0318) 				PrintString_n(fn);
(0319)             }
(0320) 			*/
(0321) 			PrintString_n(path);
    029C9 0186      MOVW	R16,R12
    029CA 940E 3A79 CALL	_PrintString_n
(0322) 			PrintString_n(fn);
    029CC 0187      MOVW	R16,R14
    029CD 940E 3A79 CALL	_PrintString_n
    029CF CFD2      RJMP	0x29A2
(0323)         }
(0324)     }
(0325) 
(0326)     return res;
    029D0 2D0A      MOV	R16,R10
    029D1 96AC      ADIW	R28,0x2C
    029D2 940C 482A JMP	pop_xgset00FC
_check:
  WScounter            --> R10
  tmp                  --> R12
    029D4 940E 484B CALL	push_xgset003C
    029D6 9724      SBIW	R28,4
(0327) }
(0328) void check( void )
(0329) {
(0330)  unsigned char tmp;
(0331)  unsigned int WScounter;
(0332)  //检测风速
(0333)  //读计数器1 此步需严格按手册进行。
(0334)  tmp=SREG;
    029D7 B6CF      IN	R12,0x3F
(0335)  CLI();
    029D8 94F8      BCLR	7
(0336)  WScounter=TCNT1H*256+TCNT1L;
    029D9 B52D      IN	R18,0x2D
    029DA 2733      CLR	R19
    029DB E000      LDI	R16,0
    029DC E011      LDI	R17,1
    029DD 940E 47E1 CALL	empy16s
    029DF 0158      MOVW	R10,R16
    029E0 B42C      IN	R2,0x2C
    029E1 2433      CLR	R3
    029E2 0CA2      ADD	R10,R2
    029E3 1CB3      ADC	R11,R3
(0337)  SREG=tmp;
    029E4 BECF      OUT	0x3F,R12
(0338)  SEI();
    029E5 9478      BSET	7
(0339)  //计算风速
(0340)  Result.WindSpeed=WScounter/N_per_Second;
    029E6 0185      MOVW	R16,R10
    029E7 940E 49BC CALL	uint2fp
    029E9 0118      MOVW	R2,R16
    029EA 0129      MOVW	R4,R18
    029EB EB0A      LDI	R16,0xBA
    029EC E010      LDI	R17,0
    029ED 940E 47CD CALL	elpm32
    029EF 933A      ST	-Y,R19
    029F0 932A      ST	-Y,R18
    029F1 931A      ST	-Y,R17
    029F2 930A      ST	-Y,R16
    029F3 0181      MOVW	R16,R2
    029F4 0192      MOVW	R18,R4
    029F5 940E 49E9 CALL	fpdiv2
    029F7 9310 0617 STS	Result+52,R17
    029F9 9300 0616 STS	Result+51,R16
    029FB 9330 0619 STS	Result+54,R19
    029FD 9320 0618 STS	Result+53,R18
(0341)   Result.WindSpeed=1.1;
    029FF EB06      LDI	R16,0xB6
    02A00 E010      LDI	R17,0
    02A01 940E 47CD CALL	elpm32
    02A03 9310 0617 STS	Result+52,R17
    02A05 9300 0616 STS	Result+51,R16
    02A07 9330 0619 STS	Result+54,R19
    02A09 9320 0618 STS	Result+53,R18
(0342)  //温度
(0343)  Result.Temperature=read_T_NUM(1); //读两次 避免出错
    02A0B E001      LDI	R16,1
    02A0C 940E 416F CALL	_read_T_NUM
    02A0E 9310 060D STS	Result+42,R17
    02A10 9300 060C STS	Result+41,R16
    02A12 9330 060F STS	Result+44,R19
    02A14 9320 060E STS	Result+43,R18
(0344)  Result.Temperature=read_T_NUM(1);
    02A16 E001      LDI	R16,1
    02A17 940E 416F CALL	_read_T_NUM
    02A19 9310 060D STS	Result+42,R17
    02A1B 9300 060C STS	Result+41,R16
    02A1D 9330 060F STS	Result+44,R19
    02A1F 9320 060E STS	Result+43,R18
(0345)   Result.Temperature=-24.1;
    02A21 EB02      LDI	R16,0xB2
    02A22 E010      LDI	R17,0
    02A23 940E 47CD CALL	elpm32
    02A25 9310 060D STS	Result+42,R17
    02A27 9300 060C STS	Result+41,R16
    02A29 9330 060F STS	Result+44,R19
    02A2B 9320 060E STS	Result+43,R18
(0346)  //WCI风冷指数
(0347)   Result.WCI = 4.18 *(10*SquareRootFloat(Result.WindSpeed) + 10.45 -  Result.WindSpeed  ) *( 33 - Result.Temperature );
    02A2D 9120 0618 LDS	R18,Result+53
    02A2F 9130 0619 LDS	R19,Result+54
    02A31 9100 0616 LDS	R16,Result+51
    02A33 9110 0617 LDS	R17,Result+52
    02A35 D24C      RCALL	_SquareRootFloat
    02A36 0118      MOVW	R2,R16
    02A37 0129      MOVW	R4,R18
    02A38 EA0E      LDI	R16,0xAE
    02A39 E010      LDI	R17,0
    02A3A 940E 47CD CALL	elpm32
    02A3C 0138      MOVW	R6,R16
    02A3D 0149      MOVW	R8,R18
    02A3E EA0A      LDI	R16,0xAA
    02A3F E010      LDI	R17,0
    02A40 940E 47CD CALL	elpm32
    02A42 925A      ST	-Y,R5
    02A43 924A      ST	-Y,R4
    02A44 923A      ST	-Y,R3
    02A45 922A      ST	-Y,R2
    02A46 940E 4B63 CALL	fpmule2
    02A48 0118      MOVW	R2,R16
    02A49 0129      MOVW	R4,R18
    02A4A EA06      LDI	R16,0xA6
    02A4B E010      LDI	R17,0
    02A4C 940E 47CD CALL	elpm32
    02A4E 933A      ST	-Y,R19
    02A4F 932A      ST	-Y,R18
    02A50 931A      ST	-Y,R17
    02A51 930A      ST	-Y,R16
    02A52 0181      MOVW	R16,R2
    02A53 0192      MOVW	R18,R4
    02A54 940E 4981 CALL	fpadd2
    02A56 E186      LDI	R24,0x16
    02A57 E096      LDI	R25,6
    02A58 939A      ST	-Y,R25
    02A59 938A      ST	-Y,R24
    02A5A 940E 49A1 CALL	fpsub1x
    02A5C 0183      MOVW	R16,R6
    02A5D 0194      MOVW	R18,R8
    02A5E 940E 4B63 CALL	fpmule2
    02A60 0118      MOVW	R2,R16
    02A61 0129      MOVW	R4,R18
    02A62 EA02      LDI	R16,0xA2
    02A63 E010      LDI	R17,0
    02A64 940E 47CD CALL	elpm32
    02A66 E08C      LDI	R24,0xC
    02A67 E096      LDI	R25,6
    02A68 939A      ST	-Y,R25
    02A69 938A      ST	-Y,R24
    02A6A 940E 49A1 CALL	fpsub1x
    02A6C 0181      MOVW	R16,R2
    02A6D 0192      MOVW	R18,R4
    02A6E 940E 4B63 CALL	fpmule2
    02A70 9310 0620 STS	Result+61,R17
    02A72 9300 061F STS	Result+60,R16
    02A74 9330 0622 STS	Result+63,R19
    02A76 9320 0621 STS	Result+62,R18
(0348)  //ECT等价制冷温度
(0349)  Result.ECT = 33 - 0.01085 * Result.WCI;
    02A78 E90E      LDI	R16,0x9E
    02A79 E010      LDI	R17,0
    02A7A 940E 47CD CALL	elpm32
    02A7C 0118      MOVW	R2,R16
    02A7D 0129      MOVW	R4,R18
    02A7E E90A      LDI	R16,0x9A
    02A7F E010      LDI	R17,0
    02A80 940E 47CD CALL	elpm32
    02A82 E18F      LDI	R24,0x1F
    02A83 E096      LDI	R25,6
    02A84 939A      ST	-Y,R25
    02A85 938A      ST	-Y,R24
    02A86 940E 4B6E CALL	fpmule1x
    02A88 0181      MOVW	R16,R2
    02A89 0192      MOVW	R18,R4
    02A8A 940E 4996 CALL	fpsub2
    02A8C 9310 062A STS	Result+71,R17
    02A8E 9300 0629 STS	Result+70,R16
    02A90 9330 062C STS	Result+73,R19
    02A92 9320 062B STS	Result+72,R18
(0350)  //TEQ 相当温度
(0351)  Result.Teq = Result.Temperature +( (Result.Temperature -36)/10 ) * Result.WindSpeed ;
    02A94 9040 060E LDS	R4,Result+43
    02A96 9050 060F LDS	R5,Result+44
    02A98 9020 060C LDS	R2,Result+41
    02A9A 9030 060D LDS	R3,Result+42
    02A9C 0131      MOVW	R6,R2
    02A9D 0142      MOVW	R8,R4
    02A9E E906      LDI	R16,0x96
    02A9F E010      LDI	R17,0
    02AA0 940E 47CD CALL	elpm32
    02AA2 933A      ST	-Y,R19
    02AA3 932A      ST	-Y,R18
    02AA4 931A      ST	-Y,R17
    02AA5 930A      ST	-Y,R16
    02AA6 0183      MOVW	R16,R6
    02AA7 0194      MOVW	R18,R8
    02AA8 940E 4996 CALL	fpsub2
    02AAA 0138      MOVW	R6,R16
    02AAB 0149      MOVW	R8,R18
    02AAC EA0A      LDI	R16,0xAA
    02AAD E010      LDI	R17,0
    02AAE 940E 47CD CALL	elpm32
    02AB0 933A      ST	-Y,R19
    02AB1 932A      ST	-Y,R18
    02AB2 931A      ST	-Y,R17
    02AB3 930A      ST	-Y,R16
    02AB4 0183      MOVW	R16,R6
    02AB5 0194      MOVW	R18,R8
    02AB6 940E 49E9 CALL	fpdiv2
    02AB8 E186      LDI	R24,0x16
    02AB9 E096      LDI	R25,6
    02ABA 939A      ST	-Y,R25
    02ABB 938A      ST	-Y,R24
    02ABC 940E 4B6E CALL	fpmule1x
    02ABE 0181      MOVW	R16,R2
    02ABF 0192      MOVW	R18,R4
    02AC0 940E 4981 CALL	fpadd2
    02AC2 9310 0634 STS	Result+81,R17
    02AC4 9300 0633 STS	Result+80,R16
    02AC6 9330 0636 STS	Result+83,R19
    02AC8 9320 0635 STS	Result+82,R18
(0352) //将数据转换成字符串
(0353) /* 
(0354) ftochr(Result.WindSpeed,Result.WSChar);
(0355) ftochr(Result.Temperature,Result.TempChar);//PrintString_n(Result.TempChar);
(0356) ftochr(Result.WCI,Result.WCIChar);
(0357) ftochr(Result.ECT,Result.ECTChar);
(0358) ftochr(Result.Teq,Result.TeqChar);
(0359) itoa(Result.IndexChar,Result.Index,10);
(0360) */
(0361) sprintf(Result.WSChar, "%f", Result.WindSpeed);
    02ACA 9040 0618 LDS	R4,Result+53
    02ACC 9050 0619 LDS	R5,Result+54
    02ACE 9020 0616 LDS	R2,Result+51
    02AD0 9030 0617 LDS	R3,Result+52
    02AD2 8228      ST	Y,R2
    02AD3 8239      STD	Y+1,R3
    02AD4 824A      STD	Y+2,R4
    02AD5 825B      STD	Y+3,R5
    02AD6 EE27      LDI	R18,0xE7
    02AD7 E031      LDI	R19,1
    02AD8 E10A      LDI	R16,0x1A
    02AD9 E016      LDI	R17,6
    02ADA 940E 4F90 CALL	_sprintf
(0362) sprintf(Result.TempChar, "%f", Result.Temperature);//PrintString_n(Result.TempChar);
    02ADC 9040 060E LDS	R4,Result+43
    02ADE 9050 060F LDS	R5,Result+44
    02AE0 9020 060C LDS	R2,Result+41
    02AE2 9030 060D LDS	R3,Result+42
    02AE4 8228      ST	Y,R2
    02AE5 8239      STD	Y+1,R3
    02AE6 824A      STD	Y+2,R4
    02AE7 825B      STD	Y+3,R5
    02AE8 EE27      LDI	R18,0xE7
    02AE9 E031      LDI	R19,1
    02AEA E100      LDI	R16,0x10
    02AEB E016      LDI	R17,6
    02AEC 940E 4F90 CALL	_sprintf
(0363) sprintf(Result.WCIChar, "%f",  Result.WCI);
    02AEE 9040 0621 LDS	R4,Result+62
    02AF0 9050 0622 LDS	R5,Result+63
    02AF2 9020 061F LDS	R2,Result+60
    02AF4 9030 0620 LDS	R3,Result+61
    02AF6 8228      ST	Y,R2
    02AF7 8239      STD	Y+1,R3
    02AF8 824A      STD	Y+2,R4
    02AF9 825B      STD	Y+3,R5
    02AFA EE27      LDI	R18,0xE7
    02AFB E031      LDI	R19,1
    02AFC E203      LDI	R16,0x23
    02AFD E016      LDI	R17,6
    02AFE 940E 4F90 CALL	_sprintf
(0364) sprintf(Result.ECTChar, "%0.1f", Result.ECT);
    02B00 9040 062B LDS	R4,Result+72
    02B02 9050 062C LDS	R5,Result+73
    02B04 9020 0629 LDS	R2,Result+70
    02B06 9030 062A LDS	R3,Result+71
    02B08 8228      ST	Y,R2
    02B09 8239      STD	Y+1,R3
    02B0A 824A      STD	Y+2,R4
    02B0B 825B      STD	Y+3,R5
    02B0C EE21      LDI	R18,0xE1
    02B0D E031      LDI	R19,1
    02B0E E20D      LDI	R16,0x2D
    02B0F E016      LDI	R17,6
    02B10 940E 4F90 CALL	_sprintf
(0365) sprintf(Result.TeqChar, "%0.1f", Result.Teq);
    02B12 9040 0635 LDS	R4,Result+82
    02B14 9050 0636 LDS	R5,Result+83
    02B16 9020 0633 LDS	R2,Result+80
    02B18 9030 0634 LDS	R3,Result+81
    02B1A 8228      ST	Y,R2
    02B1B 8239      STD	Y+1,R3
    02B1C 824A      STD	Y+2,R4
    02B1D 825B      STD	Y+3,R5
    02B1E EE21      LDI	R18,0xE1
    02B1F E031      LDI	R19,1
    02B20 E307      LDI	R16,0x37
    02B21 E016      LDI	R17,6
    02B22 940E 4F90 CALL	_sprintf
(0366) sprintf(Result.IndexChar, "%d", Result.Index);
    02B24 9040 05EF LDS	R4,Result+12
    02B26 9050 05F0 LDS	R5,Result+13
    02B28 9020 05ED LDS	R2,Result+10
    02B2A 9030 05EE LDS	R3,Result+11
    02B2C 8228      ST	Y,R2
    02B2D 8239      STD	Y+1,R3
    02B2E 824A      STD	Y+2,R4
    02B2F 825B      STD	Y+3,R5
    02B30 ED2E      LDI	R18,0xDE
    02B31 E031      LDI	R19,1
    02B32 EF01      LDI	R16,0xF1
    02B33 E015      LDI	R17,5
    02B34 940E 4F90 CALL	_sprintf
(0367) Result.TempChar[6]='\0';
    02B36 2422      CLR	R2
    02B37 9220 0616 STS	Result+51,R2
(0368) Result.WSChar[5]='\0';
    02B39 9220 061F STS	Result+60,R2
(0369) Result.WCIChar[6]='\0';
    02B3B 9220 0629 STS	Result+70,R2
(0370) Result.ECTChar[6]='\0';
    02B3D 9220 0633 STS	Result+80,R2
(0371) Result.TeqChar[6]='\0';
    02B3F 9220 063D STS	Result+90,R2
(0372)  return ;
    02B41 9624      ADIW	R28,4
    02B42 940C 4825 JMP	pop_xgset003C
_ftochr:
  status               --> Y,+2
  j                    --> R12
  lenth                --> R20
  res                  --> R12
  i                    --> R10
  dest                 --> R14
  a                    --> Y,+12
    02B44 940E 4700 CALL	push_arg4
    02B46 940E 4847 CALL	push_xgset30FC
    02B48 9724      SBIW	R28,4
    02B49 88E8      LDD	R14,Y+16
    02B4A 88F9      LDD	R15,Y+17
(0373) }
(0374) ////////////////////////////////////////////
(0375) //				字符串转换函数
(0376) //   浮点 到  字符串
(0377) ////////////////////////////////////////////
(0378) void ftochr(float a,char * dest){//float
(0379) char i=0,j=0,lenth;
(0380) int status;
(0381) char *res;
(0382)  res=ftoa(a,&status);  //float to ascii
    02B4B 01CE      MOVW	R24,R28
    02B4C 9602      ADIW	R24,2
    02B4D 8399      STD	Y+1,R25
    02B4E 8388      ST	Y,R24
    02B4F 850C      LDD	R16,Y+12
    02B50 851D      LDD	R17,Y+13
    02B51 852E      LDD	R18,Y+14
    02B52 853F      LDD	R19,Y+15
    02B53 940E 4DC6 CALL	_ftoa
    02B55 0168      MOVW	R12,R16
(0383) lenth=strlen(res);
    02B56 940E 46F4 CALL	_strlen
    02B58 2F40      MOV	R20,R16
(0384) 
(0385) for(i=0;i <lenth;i++) 
    02B59 24AA      CLR	R10
    02B5A C023      RJMP	0x2B7E
(0386)        {
(0387) 	   	dest[i]=res[i];
    02B5B 2DEA      MOV	R30,R10
    02B5C 27FF      CLR	R31
    02B5D 0DEC      ADD	R30,R12
    02B5E 1DFD      ADC	R31,R13
    02B5F 8020      LD	R2,Z
    02B60 2DEA      MOV	R30,R10
    02B61 27FF      CLR	R31
    02B62 0DEE      ADD	R30,R14
    02B63 1DFF      ADC	R31,R15
    02B64 8220      ST	Z,R2
(0388) 
(0389) 		if( res[i]=='.'  ) 
    02B65 2DEA      MOV	R30,R10
    02B66 27FF      CLR	R31
    02B67 0DEC      ADD	R30,R12
    02B68 1DFD      ADC	R31,R13
    02B69 8180      LD	R24,Z
    02B6A 328E      CPI	R24,0x2E
    02B6B F489      BNE	0x2B7D
(0390) 			{
(0391) 				dest[i+1]=res[i+1];
    02B6C 2DEA      MOV	R30,R10
    02B6D 27FF      CLR	R31
    02B6E 0DEC      ADD	R30,R12
    02B6F 1DFD      ADC	R31,R13
    02B70 8021      LDD	R2,Z+1
    02B71 2DEA      MOV	R30,R10
    02B72 27FF      CLR	R31
    02B73 0DEE      ADD	R30,R14
    02B74 1DFF      ADC	R31,R15
    02B75 8221      STD	Z+1,R2
(0392) 					dest[i+2]='\0';
    02B76 2DEA      MOV	R30,R10
    02B77 27FF      CLR	R31
    02B78 0DEE      ADD	R30,R14
    02B79 1DFF      ADC	R31,R15
    02B7A 2422      CLR	R2
    02B7B 8222      STD	Z+2,R2
(0393) 						return ;    
    02B7C C003      RJMP	0x2B80
    02B7D 94A3      INC	R10
    02B7E 16A4      CP	R10,R20
    02B7F F2D8      BCS	0x2B5B
    02B80 9624      ADIW	R28,4
    02B81 940E 4831 CALL	pop_xgset30FC
    02B83 9624      ADIW	R28,4
    02B84 9508      RET
_itochr:
  dest                 --> R10
  a                    --> R12
    02B85 940E 484B CALL	push_xgset003C
    02B87 0159      MOVW	R10,R18
    02B88 0168      MOVW	R12,R16
    02B89 9722      SBIW	R28,2
(0394) 		    }
(0395)  
(0396)  		}
(0397) }
(0398) //////////////////////////////////////////////////////
(0399) //              整型数据变字符串
(0400) //    a  到  dest
(0401) ///////////////////////////////////////////////////////
(0402) void itochr(int a,char * dest){ //int to ascii
(0403) 	 itoa(dest,a,10); 
    02B8A E08A      LDI	R24,0xA
    02B8B E090      LDI	R25,0
    02B8C 8399      STD	Y+1,R25
    02B8D 8388      ST	Y,R24
    02B8E 0196      MOVW	R18,R12
    02B8F 0185      MOVW	R16,R10
    02B90 940E 4BFC CALL	_itoa
    02B92 9622      ADIW	R28,2
    02B93 940C 4825 JMP	pop_xgset003C
_StructToChar:
  otherbyte            --> Y,+16
  ary                  --> Y,+0
  i                    --> R10
    02B95 92AA      ST	-Y,R10
    02B96 9768      SBIW	R28,0x18
(0404) }
(0405) //////////////////////////////////////////////////////
(0406) //                  结构体 变字符串
(0407) // 将目前存于结构体的数据转换到Temp_Char中。
(0408) ///////////////////////////////////////////////////////
(0409) void  StructToChar(void)
(0410) { 
(0411)   unsigned char i;
(0412)   char otherbyte[]="0\t0\t0\t0";
    02B97 EB80      LDI	R24,0xB0
    02B98 E091      LDI	R25,1
    02B99 01FE      MOVW	R30,R28
    02B9A 9670      ADIW	R30,0x10
    02B9B E008      LDI	R16,0x8
    02B9C E010      LDI	R17,0
    02B9D 93FA      ST	-Y,R31
    02B9E 93EA      ST	-Y,R30
    02B9F 939A      ST	-Y,R25
    02BA0 938A      ST	-Y,R24
    02BA1 940E 48F5 CALL	asgnblk
(0413)   char *(ary[])={Result.IndexChar,Result.Date,Result.Time,
    02BA3 EB88      LDI	R24,0xB8
    02BA4 E091      LDI	R25,1
    02BA5 01FE      MOVW	R30,R28
    02BA6 E100      LDI	R16,0x10
    02BA7 E010      LDI	R17,0
    02BA8 93FA      ST	-Y,R31
    02BA9 93EA      ST	-Y,R30
    02BAA 939A      ST	-Y,R25
    02BAB 938A      ST	-Y,R24
    02BAC 940E 48F5 CALL	asgnblk
(0414)  	  			Result.TempChar,Result.WSChar,Result.WCIChar,Result.ECTChar,
(0415) 				Result.TeqChar
(0416) 			   };  //指向数组首地址的指针
(0417)   //strcat(Temp_Char,Result.Name);
(0418)   for(i=0;i<=80;i++) TempChar[i]='\0';  //清空数组
    02BAE 24AA      CLR	R10
    02BAF C009      RJMP	0x2BB9
    02BB0 E983      LDI	R24,0x93
    02BB1 E095      LDI	R25,5
    02BB2 2DEA      MOV	R30,R10
    02BB3 27FF      CLR	R31
    02BB4 0FE8      ADD	R30,R24
    02BB5 1FF9      ADC	R31,R25
    02BB6 2422      CLR	R2
    02BB7 8220      ST	Z,R2
    02BB8 94A3      INC	R10
    02BB9 E580      LDI	R24,0x50
    02BBA 158A      CP	R24,R10
    02BBB F7A0      BCC	0x2BB0
(0419)     for(i=0;i<=7;i++){
    02BBC 24AA      CLR	R10
    02BBD C014      RJMP	0x2BD2
(0420) 		strcat(TempChar,ary[i]);  // 按顺序复制字符串
    02BBE 01CE      MOVW	R24,R28
    02BBF 2DEA      MOV	R30,R10
    02BC0 27FF      CLR	R31
    02BC1 0FEE      LSL	R30
    02BC2 1FFF      ROL	R31
    02BC3 0FE8      ADD	R30,R24
    02BC4 1FF9      ADC	R31,R25
    02BC5 8120      LD	R18,Z
    02BC6 8131      LDD	R19,Z+1
    02BC7 E903      LDI	R16,0x93
    02BC8 E015      LDI	R17,5
    02BC9 940E 46E7 CALL	_strcat
(0421) 		strcat(TempChar,tab);     // 字串结尾加上制表符
    02BCB E02F      LDI	R18,0xF
    02BCC E031      LDI	R19,1
    02BCD E903      LDI	R16,0x93
    02BCE E015      LDI	R17,5
    02BCF 940E 46E7 CALL	_strcat
    02BD1 94A3      INC	R10
    02BD2 E087      LDI	R24,7
    02BD3 158A      CP	R24,R10
    02BD4 F748      BCC	0x2BBE
(0422)     }
(0423) 				 
(0424) 				 otherbyte[0]=otherbyte[0]+Result.WeiHai;
    02BD5 9020 063D LDS	R2,Result+90
    02BD7 8838      LDD	R3,Y+16
    02BD8 0C32      ADD	R3,R2
    02BD9 8A38      STD	Y+16,R3
(0425) 				 otherbyte[2]=otherbyte[0]+Result.LowLabor;
    02BDA 9020 063E LDS	R2,Result+91
    02BDC 0C32      ADD	R3,R2
    02BDD 8A3A      STD	Y+18,R3
(0426) 				 otherbyte[4]=otherbyte[0]+Result.MidLabor;
    02BDE 9020 063F LDS	R2,Result+92
    02BE0 8838      LDD	R3,Y+16
    02BE1 0C32      ADD	R3,R2
    02BE2 8A3C      STD	Y+20,R3
(0427) 				 otherbyte[6]=otherbyte[0]+Result.HighLabor;
    02BE3 9020 0640 LDS	R2,Result+93
    02BE5 8838      LDD	R3,Y+16
    02BE6 0C32      ADD	R3,R2
    02BE7 8A3E      STD	Y+22,R3
(0428)  
(0429)   strcat(TempChar,otherbyte);  
    02BE8 019E      MOVW	R18,R28
    02BE9 5F20      SUBI	R18,0xF0
    02BEA 4F3F      SBCI	R19,0xFF
    02BEB E903      LDI	R16,0x93
    02BEC E015      LDI	R17,5
    02BED 940E 46E7 CALL	_strcat
(0430)   strcat(TempChar,enter);  
    02BEF E122      LDI	R18,0x12
    02BF0 E031      LDI	R19,1
    02BF1 E903      LDI	R16,0x93
    02BF2 E015      LDI	R17,5
    02BF3 940E 46E7 CALL	_strcat
(0431)   strcat(TempChar,"\0");
    02BF5 ED2C      LDI	R18,0xDC
    02BF6 E031      LDI	R19,1
    02BF7 E903      LDI	R16,0x93
    02BF8 E015      LDI	R17,5
    02BF9 940E 46E7 CALL	_strcat
    02BFB 9668      ADIW	R28,0x18
    02BFC 90A9      LD	R10,Y+
    02BFD 9508      RET
_CharToStruct:
  ary                  --> Y,+0
  j                    --> R12
  p                    --> R10
  q                    --> R20
  buf                  --> R14
    02BFE 940E 4847 CALL	push_xgset30FC
    02C00 0178      MOVW	R14,R16
    02C01 9760      SBIW	R28,0x10
(0432) }
(0433) 
(0434) //////////////////////////////////////////////////////
(0435) //               字符串  变  结构体
(0436) // 
(0437) ///////////////////////////////////////////////////////
(0438) void CharToStruct(char *buf)
(0439) {
(0440)   unsigned char j=0;
    02C02 24CC      CLR	R12
(0441)   unsigned char *p,*q;
(0442)   char *(ary[])={Result.IndexChar,Result.Date,Result.Time,
    02C03 EC88      LDI	R24,0xC8
    02C04 E091      LDI	R25,1
    02C05 01FE      MOVW	R30,R28
    02C06 E100      LDI	R16,0x10
    02C07 E010      LDI	R17,0
    02C08 93FA      ST	-Y,R31
    02C09 93EA      ST	-Y,R30
    02C0A 939A      ST	-Y,R25
    02C0B 938A      ST	-Y,R24
    02C0C 940E 48F5 CALL	asgnblk
(0443)  	  			Result.TempChar,Result.WSChar,Result.WCIChar,Result.ECTChar,
(0444) 				Result.TeqChar
(0445) 			   };  //指向数组首地址的指针
(0446)     p=ary[j];
    02C0E 01CE      MOVW	R24,R28
    02C0F 2DEC      MOV	R30,R12
    02C10 27FF      CLR	R31
    02C11 0FEE      LSL	R30
    02C12 1FFF      ROL	R31
    02C13 0FE8      ADD	R30,R24
    02C14 1FF9      ADC	R31,R25
    02C15 80A0      LD	R10,Z
    02C16 80B1      LDD	R11,Z+1
(0447) 	q=buf;
    02C17 01A7      MOVW	R20,R14
    02C18 C026      RJMP	0x2C3F
(0448) 	
(0449) 	while(1){
(0450)     if(*q =='\n') {*p='\0'; return;} ;
    02C19 01FA      MOVW	R30,R20
    02C1A 8180      LD	R24,Z
    02C1B 308A      CPI	R24,0xA
    02C1C F421      BNE	0x2C21
    02C1D 2422      CLR	R2
    02C1E 01F5      MOVW	R30,R10
    02C1F 8220      ST	Z,R2
    02C20 C01F      RJMP	0x2C40
(0451) 	if(*q =='\t') {
    02C21 01FA      MOVW	R30,R20
    02C22 8180      LD	R24,Z
    02C23 3089      CPI	R24,0x9
    02C24 F4A1      BNE	0x2C39
(0452) 		*p='\0';
    02C25 2422      CLR	R2
    02C26 01F5      MOVW	R30,R10
    02C27 8220      ST	Z,R2
(0453) 		q++;
    02C28 5F4F      SUBI	R20,0xFF
    02C29 4F5F      SBCI	R21,0xFF
(0454) 	    if(j>7) break ;
    02C2A E087      LDI	R24,7
    02C2B 158C      CP	R24,R12
    02C2C F408      BCC	0x2C2E
    02C2D C012      RJMP	0x2C40
(0455) 		j++;
    02C2E 94C3      INC	R12
(0456) 		p=ary[j];
    02C2F 01CE      MOVW	R24,R28
    02C30 2DEC      MOV	R30,R12
    02C31 27FF      CLR	R31
    02C32 0FEE      LSL	R30
    02C33 1FFF      ROL	R31
    02C34 0FE8      ADD	R30,R24
    02C35 1FF9      ADC	R31,R25
    02C36 80A0      LD	R10,Z
    02C37 80B1      LDD	R11,Z+1
(0457) 		continue ;
    02C38 C006      RJMP	0x2C3F
(0458) 	}
(0459) 	//Usart_Transmit('-');
(0460) 	//Usart_Transmit(*q);
(0461) 	//Usart_Transmit(']');
(0462) 	//PrintChar(*q);
(0463) 	//Usart_Transmit('+');
(0464)     *p++=*q++;
    02C39 01FA      MOVW	R30,R20
    02C3A 01D5      MOVW	R26,R10
    02C3B 9001      LD	R0,Z+
    02C3C 01AF      MOVW	R20,R30
    02C3D 920D      ST	X+,R0
    02C3E 015D      MOVW	R10,R26
    02C3F CFD9      RJMP	0x2C19
    02C40 9660      ADIW	R28,0x10
    02C41 940C 4831 JMP	pop_xgset30FC
_get_name:
  i                    --> R20
  filenamep            --> R16
    02C43 940E 485A CALL	push_xgsetF000
(0465) 	}
(0466) 	/* for debug
(0467) 	PrintString_n(Result.IndexChar);
(0468) 	PrintString_n(Result.Date);
(0469) 	PrintString_n(Result.Time);
(0470) 	PrintString_n(Result.TempChar);
(0471) 	PrintString_n(Result.WSChar);
(0472) 	PrintString_n(Result.WCIChar);
(0473) 	PrintString_n(Result.ECTChar);
(0474) 	PrintString_n(Result.TeqChar);
(0475) 	Result.WeiHai=*(q+1)-0x30;
(0476) 	Result.LowLabor=*(q+3)-0x30;
(0477) 	Result.MidLabor=*(q+5)-0x30;
(0478) 	Result.HighLabor=*(q+7)-0x30;
(0479) 	*/
(0480) 	return ;
(0481) }
(0482)  
(0483)  ////////////////////////////////////////////
(0484) //				根据当前日期获取文件名
(0485) //   
(0486) ////////////////////////////////////////////
(0487) char *get_name( char filenamep[] ){     
(0488) 	  unsigned char i=0;
(0489)  	  for(i=0;i<6;i++) {
    02C45 2744      CLR	R20
    02C46 C00D      RJMP	0x2C54
(0490) 	  				    *(filenamep+i)=Result.Date[i];
    02C47 EF89      LDI	R24,0xF9
    02C48 E095      LDI	R25,5
    02C49 2FE4      MOV	R30,R20
    02C4A 27FF      CLR	R31
    02C4B 0FE8      ADD	R30,R24
    02C4C 1FF9      ADC	R31,R25
    02C4D 8020      LD	R2,Z
    02C4E 2FE4      MOV	R30,R20
    02C4F 27FF      CLR	R31
    02C50 0FE0      ADD	R30,R16
    02C51 1FF1      ADC	R31,R17
    02C52 8220      ST	Z,R2
    02C53 9543      INC	R20
    02C54 3046      CPI	R20,6
    02C55 F388      BCS	0x2C47
(0491) 	  				   } 
(0492) 	 	*(filenamep+(i++))='.';
    02C56 2E24      MOV	R2,R20
    02C57 2433      CLR	R3
    02C58 5F4F      SUBI	R20,0xFF
    02C59 2DE2      MOV	R30,R2
    02C5A 27FF      CLR	R31
    02C5B 0FE0      ADD	R30,R16
    02C5C 1FF1      ADC	R31,R17
    02C5D E28E      LDI	R24,0x2E
    02C5E 8380      ST	Z,R24
(0493) 		*(filenamep+(i++))='x';
    02C5F 2E24      MOV	R2,R20
    02C60 2433      CLR	R3
    02C61 5F4F      SUBI	R20,0xFF
    02C62 2DE2      MOV	R30,R2
    02C63 27FF      CLR	R31
    02C64 0FE0      ADD	R30,R16
    02C65 1FF1      ADC	R31,R17
    02C66 E788      LDI	R24,0x78
    02C67 8380      ST	Z,R24
(0494) 		*(filenamep+(i++))='l';
    02C68 2F64      MOV	R22,R20
    02C69 2777      CLR	R23
    02C6A 5F4F      SUBI	R20,0xFF
    02C6B 2FE6      MOV	R30,R22
    02C6C 27FF      CLR	R31
    02C6D 0FE0      ADD	R30,R16
    02C6E 1FF1      ADC	R31,R17
    02C6F E68C      LDI	R24,0x6C
    02C70 8380      ST	Z,R24
(0495) 		*(filenamep+(i++))='s';
    02C71 2F64      MOV	R22,R20
    02C72 2777      CLR	R23
    02C73 5F4F      SUBI	R20,0xFF
    02C74 2FE6      MOV	R30,R22
    02C75 27FF      CLR	R31
    02C76 0FE0      ADD	R30,R16
    02C77 1FF1      ADC	R31,R17
    02C78 E783      LDI	R24,0x73
    02C79 8380      ST	Z,R24
(0496) 		*(filenamep+(i))='\0';
    02C7A 2FE4      MOV	R30,R20
    02C7B 27FF      CLR	R31
    02C7C 0FE0      ADD	R30,R16
    02C7D 1FF1      ADC	R31,R17
    02C7E 2422      CLR	R2
    02C7F 8220      ST	Z,R2
(0497) 					   
(0498)       return filenamep;
    02C80 940C 485F JMP	pop_xgsetF000
_SquareRootFloat:
  f                    --> Y,+12
  x                    --> Y,+8
  i                    --> Y,+4
  y                    --> Y,+0
  number               --> Y,+20
    02C82 940E 4700 CALL	push_arg4
    02C84 940E 485A CALL	push_xgsetF000
    02C86 9760      SBIW	R28,0x10
(0499) } 
(0500) float SquareRootFloat(float number)
(0501) {
(0502)     long i;
(0503)     float x, y;
(0504)     const float f = 1.5F;
    02C87 E902      LDI	R16,0x92
    02C88 E010      LDI	R17,0
    02C89 940E 47CD CALL	elpm32
    02C8B 870C      STD	Y+12,R16
    02C8C 871D      STD	Y+13,R17
    02C8D 872E      STD	Y+14,R18
    02C8E 873F      STD	Y+15,R19
(0505)     x = number * 0.5F;
    02C8F E80E      LDI	R16,0x8E
    02C90 E010      LDI	R17,0
    02C91 940E 47CD CALL	elpm32
    02C93 01CE      MOVW	R24,R28
    02C94 9644      ADIW	R24,0x14
    02C95 939A      ST	-Y,R25
    02C96 938A      ST	-Y,R24
    02C97 940E 4B59 CALL	fpmule1
    02C99 8708      STD	Y+8,R16
    02C9A 8719      STD	Y+9,R17
    02C9B 872A      STD	Y+10,R18
    02C9C 873B      STD	Y+11,R19
(0506)     y  = number;
    02C9D 882C      LDD	R2,Y+20
    02C9E 883D      LDD	R3,Y+21
    02C9F 884E      LDD	R4,Y+22
    02CA0 885F      LDD	R5,Y+23
    02CA1 8228      ST	Y,R2
    02CA2 8239      STD	Y+1,R3
    02CA3 824A      STD	Y+2,R4
    02CA4 825B      STD	Y+3,R5
(0507)     i  = * ( long * ) &y;
    02CA5 01FE      MOVW	R30,R28
    02CA6 8020      LD	R2,Z
    02CA7 8031      LDD	R3,Z+1
    02CA8 8042      LDD	R4,Z+2
    02CA9 8053      LDD	R5,Z+3
    02CAA 822C      STD	Y+4,R2
    02CAB 823D      STD	Y+5,R3
    02CAC 824E      STD	Y+6,R4
    02CAD 825F      STD	Y+7,R5
(0508)     i  = 0x5f3759df - ( i >> 1 );  //卡马克
    02CAE 802C      LDD	R2,Y+4
    02CAF 803D      LDD	R3,Y+5
    02CB0 804E      LDD	R4,Y+6
    02CB1 805F      LDD	R5,Y+7
    02CB2 9455      ASR	R5
    02CB3 9447      ROR	R4
    02CB4 9437      ROR	R3
    02CB5 9427      ROR	R2
    02CB6 ED4F      LDI	R20,0xDF
    02CB7 E559      LDI	R21,0x59
    02CB8 E367      LDI	R22,0x37
    02CB9 E57F      LDI	R23,0x5F
    02CBA 1942      SUB	R20,R2
    02CBB 0953      SBC	R21,R3
    02CBC 0964      SBC	R22,R4
    02CBD 0975      SBC	R23,R5
    02CBE 834C      STD	Y+4,R20
    02CBF 835D      STD	Y+5,R21
    02CC0 836E      STD	Y+6,R22
    02CC1 837F      STD	Y+7,R23
(0509)   //i  = 0x5f375a86 - ( i >> 1 );  //Lomont
(0510)     y  = * ( float * ) &i;
    02CC2 01FE      MOVW	R30,R28
    02CC3 9634      ADIW	R30,4
    02CC4 8020      LD	R2,Z
    02CC5 8031      LDD	R3,Z+1
    02CC6 8042      LDD	R4,Z+2
    02CC7 8053      LDD	R5,Z+3
    02CC8 8228      ST	Y,R2
    02CC9 8239      STD	Y+1,R3
    02CCA 824A      STD	Y+2,R4
    02CCB 825B      STD	Y+3,R5
(0511)     y  = y * ( f - ( x * y * y ) );
    02CCC 8028      LD	R2,Y
    02CCD 8039      LDD	R3,Y+1
    02CCE 804A      LDD	R4,Y+2
    02CCF 805B      LDD	R5,Y+3
    02CD0 846C      LDD	R6,Y+12
    02CD1 847D      LDD	R7,Y+13
    02CD2 848E      LDD	R8,Y+14
    02CD3 849F      LDD	R9,Y+15
    02CD4 8508      LDD	R16,Y+8
    02CD5 8519      LDD	R17,Y+9
    02CD6 852A      LDD	R18,Y+10
    02CD7 853B      LDD	R19,Y+11
    02CD8 01CE      MOVW	R24,R28
    02CD9 939A      ST	-Y,R25
    02CDA 938A      ST	-Y,R24
    02CDB 940E 4B59 CALL	fpmule1
    02CDD 01CE      MOVW	R24,R28
    02CDE 939A      ST	-Y,R25
    02CDF 938A      ST	-Y,R24
    02CE0 940E 4B6E CALL	fpmule1x
    02CE2 0183      MOVW	R16,R6
    02CE3 0194      MOVW	R18,R8
    02CE4 940E 49AE CALL	fpsub2x
    02CE6 0181      MOVW	R16,R2
    02CE7 0192      MOVW	R18,R4
    02CE8 940E 4B63 CALL	fpmule2
    02CEA 8308      ST	Y,R16
    02CEB 8319      STD	Y+1,R17
    02CEC 832A      STD	Y+2,R18
    02CED 833B      STD	Y+3,R19
(0512)     y  = y * ( f - ( x * y * y ) );
    02CEE 8028      LD	R2,Y
    02CEF 8039      LDD	R3,Y+1
    02CF0 804A      LDD	R4,Y+2
    02CF1 805B      LDD	R5,Y+3
    02CF2 846C      LDD	R6,Y+12
    02CF3 847D      LDD	R7,Y+13
    02CF4 848E      LDD	R8,Y+14
    02CF5 849F      LDD	R9,Y+15
    02CF6 8508      LDD	R16,Y+8
    02CF7 8519      LDD	R17,Y+9
    02CF8 852A      LDD	R18,Y+10
    02CF9 853B      LDD	R19,Y+11
    02CFA 01CE      MOVW	R24,R28
    02CFB 939A      ST	-Y,R25
    02CFC 938A      ST	-Y,R24
    02CFD 940E 4B59 CALL	fpmule1
    02CFF 01CE      MOVW	R24,R28
    02D00 939A      ST	-Y,R25
    02D01 938A      ST	-Y,R24
    02D02 940E 4B6E CALL	fpmule1x
    02D04 0183      MOVW	R16,R6
    02D05 0194      MOVW	R18,R8
    02D06 940E 49AE CALL	fpsub2x
    02D08 0181      MOVW	R16,R2
    02D09 0192      MOVW	R18,R4
    02D0A 940E 4B63 CALL	fpmule2
    02D0C 8308      ST	Y,R16
    02D0D 8319      STD	Y+1,R17
    02D0E 832A      STD	Y+2,R18
    02D0F 833B      STD	Y+3,R19
(0513)     return number * y;
    02D10 890C      LDD	R16,Y+20
    02D11 891D      LDD	R17,Y+21
    02D12 892E      LDD	R18,Y+22
    02D13 893F      LDD	R19,Y+23
    02D14 01CE      MOVW	R24,R28
    02D15 939A      ST	-Y,R25
    02D16 938A      ST	-Y,R24
    02D17 940E 4B59 CALL	fpmule1
    02D19 9660      ADIW	R28,0x10
    02D1A 940E 485F CALL	pop_xgsetF000
    02D1C 9624      ADIW	R28,4
    02D1D 9508      RET
_debug:
  str2                 --> Y,+0
  val                  --> Y,+6
  str                  --> Y,+4
    02D1E 940E 4700 CALL	push_arg4
    02D20 9724      SBIW	R28,4
(0514) } 
(0515) //
(0516) //###############################################################//
(0517) //debug
(0518) void debug(UINT8 *str,UINT8 val)
(0519) {
(0520)  UINT8 str2[4]={0,0,0,0};
    02D21 ED88      LDI	R24,0xD8
    02D22 E091      LDI	R25,1
    02D23 01FE      MOVW	R30,R28
    02D24 E004      LDI	R16,4
    02D25 E010      LDI	R17,0
    02D26 93FA      ST	-Y,R31
    02D27 93EA      ST	-Y,R30
    02D28 939A      ST	-Y,R25
    02D29 938A      ST	-Y,R24
    02D2A 940E 48F5 CALL	asgnblk
(0521)  str=str;
(0522)  val=val;
    02D2C 9628      ADIW	R28,0x8
    02D2D 9508      RET
_SD_Write_cmd:
  k                    --> R22
  temp                 --> R20
  p                    --> R20
    02D2E 940E 485A CALL	push_xgsetF000
    02D30 01A8      MOVW	R20,R16
FILE: D:\LQD\software\software_src\sd.c
(0001) //*****************************************************************************//
(0002) //*								数码相框
(0003) //*控制芯片：ATmgea128
(0004) //*开发环境：AVR Studio+GCC
(0005) //*隶属模块：SD卡控制
(0006) //*修改者：  桃子
(0007) //*****************************************************************************//
(0008) #include "sd.h"
(0009) 
(0010) //****************************************************************
(0011) //*隶属模块：SD卡控制
(0012) //*函数功能：写6字节数据
(0013) //****************************************************************
(0014) UINT8 SD_Write_cmd(UINT8 *p)
(0015) {	
(0016) 	UINT16 temp,k=0;
    02D31 2766      CLR	R22
    02D32 2777      CLR	R23
(0017) 	SD_CS_DIS();//禁止SPI
    02D33 9AC0      SBI	0x18,0
(0018) 	SPI_Read();//空读一字节
    02D34 940E 3C02 CALL	_SPI_Read
(0019) 	SD_CS_EN();//使能SPI
    02D36 98C0      CBI	0x18,0
(0020) 
(0021) 	SPI_Write(p[0]);
    02D37 01FA      MOVW	R30,R20
    02D38 8100      LD	R16,Z
    02D39 940E 3BFE CALL	_SPI_Write
(0022) 	SPI_Write(p[1]);
    02D3B 01FA      MOVW	R30,R20
    02D3C 8101      LDD	R16,Z+1
    02D3D 940E 3BFE CALL	_SPI_Write
(0023) 	SPI_Write(p[2]);
    02D3F 01FA      MOVW	R30,R20
    02D40 8102      LDD	R16,Z+2
    02D41 940E 3BFE CALL	_SPI_Write
(0024) 	SPI_Write(p[3]);
    02D43 01FA      MOVW	R30,R20
    02D44 8103      LDD	R16,Z+3
    02D45 940E 3BFE CALL	_SPI_Write
(0025) 	SPI_Write(p[4]);
    02D47 01FA      MOVW	R30,R20
    02D48 8104      LDD	R16,Z+4
    02D49 940E 3BFE CALL	_SPI_Write
(0026) 	SPI_Write(p[5]);
    02D4B 01FA      MOVW	R30,R20
    02D4C 8105      LDD	R16,Z+5
    02D4D 940E 3BFE CALL	_SPI_Write
(0027) 
(0028) 	do 
(0029)  	{  
(0030)   		temp = SPI_Read();//一直读，直到读到的不是0xff或超时
    02D4F 940E 3C02 CALL	_SPI_Read
    02D51 2F40      MOV	R20,R16
    02D52 2755      CLR	R21
(0031)  		k++;
    02D53 5F6F      SUBI	R22,0xFF
    02D54 4F7F      SBCI	R23,0xFF
(0032)  	}while((temp==0xff)&&(k<TRY_TIME)); 
    02D55 3F4F      CPI	R20,0xFF
    02D56 E0E0      LDI	R30,0
    02D57 075E      CPC	R21,R30
    02D58 F421      BNE	0x2D5D
    02D59 3164      CPI	R22,0x14
    02D5A E0E0      LDI	R30,0
    02D5B 077E      CPC	R23,R30
    02D5C F390      BCS	0x2D4F
(0033) 
(0034) 	return temp;
    02D5D 2F04      MOV	R16,R20
    02D5E 940C 485F JMP	pop_xgsetF000
_SD_Init:
  pcmd                 --> Y,+0
  temp                 --> R22
  time                 --> R20
    02D60 940E 4864 CALL	push_xgsetF00C
    02D62 9726      SBIW	R28,6
(0035) }
(0036) //****************************************************************
(0037) //*隶属模块：SD卡控制
(0038) //*函数功能：初始化
(0039) //****************************************************************
(0040) UINT8 SD_Init(void)	
(0041) {  
(0042) 	UINT8 time=0,temp=0;
    02D63 2744      CLR	R20
    02D64 2766      CLR	R22
(0043) 	UINT8 pcmd[] = {0x40,0x00,0x00,0x00,0x00,0x95}; //命令0的字节序列
    02D65 E781      LDI	R24,0x71
    02D66 E092      LDI	R25,2
    02D67 01FE      MOVW	R30,R28
    02D68 E006      LDI	R16,6
    02D69 E010      LDI	R17,0
    02D6A 93FA      ST	-Y,R31
    02D6B 93EA      ST	-Y,R30
    02D6C 939A      ST	-Y,R25
    02D6D 938A      ST	-Y,R24
    02D6E 940E 48F5 CALL	asgnblk
(0044) 	if(SD_DET()==0) return 0x02; //no disk
    02D70 B181      IN	R24,0x01
    02D71 9586      LSR	R24
    02D72 9586      LSR	R24
    02D73 9586      LSR	R24
    02D74 9586      LSR	R24
    02D75 9586      LSR	R24
    02D76 7081      ANDI	R24,1
    02D77 F421      BNE	0x2D7C
    02D78 E081      LDI	R24,1
    02D79 E090      LDI	R25,0
    02D7A 015C      MOVW	R10,R24
    02D7B C002      RJMP	0x2D7E
    02D7C 24AA      CLR	R10
    02D7D 24BB      CLR	R11
    02D7E 20AA      TST	R10
    02D7F F421      BNE	0x2D84
    02D80 20BB      TST	R11
    02D81 F411      BNE	0x2D84
    02D82 E002      LDI	R16,2
    02D83 C039      RJMP	0x2DBD
(0045) 	SD_PORT |= (1<<SD_CS);
    02D84 9AC0      SBI	0x18,0
(0046) 	SD_DDR |= (1<<SD_CS);
    02D85 9AB8      SBI	0x17,0
(0047) 
(0048) 	SPI_IO_Init();
    02D86 940E 3BF4 CALL	_SPI_IO_Init
(0049) 	SPI_Low();
    02D88 E582      LDI	R24,0x52
    02D89 B98D      OUT	0x0D,R24
    02D8A B18E      IN	R24,0x0E
    02D8B 7F8F      ANDI	R24,0xFF
    02D8C B98E      OUT	0x0E,R24
(0050) 
(0051) 	SD_CS_DIS();  //关闭片选 
    02D8D 9AC0      SBI	0x18,0
(0052) 	for(time=0;time<10;time++) //初始时，首先要发送最少74个时钟信号，这是必须的！！！
    02D8E 2744      CLR	R20
    02D8F C003      RJMP	0x2D93
(0053) 	{
(0054)   		SPI_Read(); 
    02D90 940E 3C02 CALL	_SPI_Read
    02D92 9543      INC	R20
    02D93 304A      CPI	R20,0xA
    02D94 F3D8      BCS	0x2D90
(0055) 	}
(0056) 	SD_CS_EN(); //打开片选
    02D95 98C0      CBI	0x18,0
(0057) 	time = 0;
    02D96 2744      CLR	R20
(0058) 	do
(0059) 	{ 
(0060) 		temp=SD_Write_cmd(pcmd);//写入CMD0
    02D97 018E      MOVW	R16,R28
    02D98 DF95      RCALL	_SD_Write_cmd
    02D99 2F60      MOV	R22,R16
(0061) 	 	time++;
    02D9A 9543      INC	R20
(0062) 	 	if(time==TRY_TIME) 
    02D9B 3144      CPI	R20,0x14
    02D9C F419      BNE	0x2DA0
(0063) 	 	{ 
(0064) 	  		SD_CS_DIS(); //关闭片选
    02D9D 9AC0      SBI	0x18,0
(0065) 	  		return(INIT_CMD0_ERROR);//CMD0写入失败
    02D9E E001      LDI	R16,1
    02D9F C01D      RJMP	0x2DBD
(0066) 	 	}
(0067) 	 }while(temp!=0x01);
    02DA0 3061      CPI	R22,1
    02DA1 F7A9      BNE	0x2D97
(0068) 
(0069) 	SD_CS_DIS(); //关闭片选
    02DA2 9AC0      SBI	0x18,0
(0070) 	SPI_Read(); //按照SD卡的操作时序在这里补8个时钟 
    02DA3 940E 3C02 CALL	_SPI_Read
(0071) 	SD_CS_EN(); //打开片选
    02DA5 98C0      CBI	0x18,0
(0072) 
(0073) 	pcmd[0]=0x41,pcmd[5]=0xff;
    02DA6 E481      LDI	R24,0x41
    02DA7 8388      ST	Y,R24
    02DA8 EF8F      LDI	R24,0xFF
    02DA9 838D      STD	Y+5,R24
(0074) 	time = 0;
    02DAA 2744      CLR	R20
(0075) 	do
(0076) 	{ 
(0077) 		temp=SD_Write_cmd(pcmd);
    02DAB 018E      MOVW	R16,R28
    02DAC DF81      RCALL	_SD_Write_cmd
    02DAD 2F60      MOV	R22,R16
(0078) 		time++;
    02DAE 9543      INC	R20
(0079) 		if(time==TRY_TIME) 
    02DAF 3144      CPI	R20,0x14
    02DB0 F419      BNE	0x2DB4
(0080) 		{ 
(0081) 		 	SD_CS_DIS(); //关闭片选
    02DB1 9AC0      SBI	0x18,0
(0082) 			 return(INIT_CMD1_ERROR);//CMD1写入失败
    02DB2 E002      LDI	R16,2
    02DB3 C009      RJMP	0x2DBD
(0083) 		 }
(0084) 	 }while(temp!=0);
    02DB4 2366      TST	R22
    02DB5 F7A9      BNE	0x2DAB
(0085)   
(0086) 	 SPI_High();  
    02DB6 E580      LDI	R24,0x50
    02DB7 B98D      OUT	0x0D,R24
    02DB8 9A70      SBI	0x0E,0
(0087) 	 SD_CS_DIS();  //关闭片选 
    02DB9 9AC0      SBI	0x18,0
(0088) 	 SPI_Read(); //按照SD卡的操作时序在这里补8个时钟
    02DBA 940E 3C02 CALL	_SPI_Read
(0089) 	 return SD_TURE; //返回0,说明初始化操作成功
    02DBC 2700      CLR	R16
    02DBD 9626      ADIW	R28,6
    02DBE 940C 486B JMP	pop_xgsetF00C
_SD_Write_Sector:
  pcmd                 --> Y,+0
  time                 --> R12
  temp                 --> R20
  i                    --> R22
  buffer               --> R10
  addr                 --> Y,+14
    02DC0 940E 4700 CALL	push_arg4
    02DC2 940E 4880 CALL	push_xgsetF03C
    02DC4 9726      SBIW	R28,6
    02DC5 88AA      LDD	R10,Y+18
    02DC6 88BB      LDD	R11,Y+19
(0090) } 
(0091) //****************************************************************
(0092) //*隶属模块：SD卡控制
(0093) //*函数功能：写512字节数据（一扇区字节）
(0094) //****************************************************************
(0095) UINT16 SD_Write_Sector(UINT32 addr,UINT8 *buffer)
(0096) {  
(0097) 	UINT8 temp=0,time=0;
    02DC7 2744      CLR	R20
    02DC8 24CC      CLR	R12
(0098) 	UINT16 i=0;
    02DC9 2766      CLR	R22
    02DCA 2777      CLR	R23
(0099) 	UINT8 pcmd[] = {0x58,0x00,0x00,0x00,0x00,0xff}; //向SD卡中单个块（512字节，一个扇区）写入数据，用CMD24
    02DCB E787      LDI	R24,0x77
    02DCC E092      LDI	R25,2
    02DCD 01FE      MOVW	R30,R28
    02DCE E006      LDI	R16,6
    02DCF E010      LDI	R17,0
    02DD0 93FA      ST	-Y,R31
    02DD1 93EA      ST	-Y,R30
    02DD2 939A      ST	-Y,R25
    02DD3 938A      ST	-Y,R24
    02DD4 940E 48F5 CALL	asgnblk
(0100) 
(0101) 	 addr<<=9; //将块地址（扇区地址）转为字节地址 ［这里就限制了SD卡的最大容量为4G］
    02DD6 E089      LDI	R24,0x9
    02DD7 E090      LDI	R25,0
    02DD8 850E      LDD	R16,Y+14
    02DD9 851F      LDD	R17,Y+15
    02DDA 8928      LDD	R18,Y+16
    02DDB 8939      LDD	R19,Y+17
    02DDC 938A      ST	-Y,R24
    02DDD 940E 48D0 CALL	lsl32
    02DDF 870E      STD	Y+14,R16
    02DE0 871F      STD	Y+15,R17
    02DE1 8B28      STD	Y+16,R18
    02DE2 8B39      STD	Y+17,R19
(0102) 
(0103) 	 pcmd[1]=(addr>>24); //将字节地址写入到CMD24字节序列中
    02DE3 E188      LDI	R24,0x18
    02DE4 E090      LDI	R25,0
    02DE5 850E      LDD	R16,Y+14
    02DE6 851F      LDD	R17,Y+15
    02DE7 8928      LDD	R18,Y+16
    02DE8 8939      LDD	R19,Y+17
    02DE9 938A      ST	-Y,R24
    02DEA 940E 48E9 CALL	lsr32
    02DEC 8309      STD	Y+1,R16
(0104) 	 pcmd[2]=(addr>>16);
    02DED 842E      LDD	R2,Y+14
    02DEE 843F      LDD	R3,Y+15
    02DEF 8848      LDD	R4,Y+16
    02DF0 8859      LDD	R5,Y+17
    02DF1 0112      MOVW	R2,R4
    02DF2 2444      CLR	R4
    02DF3 2455      CLR	R5
    02DF4 822A      STD	Y+2,R2
(0105) 	 pcmd[3]=(addr>>8);
    02DF5 E088      LDI	R24,0x8
    02DF6 E090      LDI	R25,0
    02DF7 850E      LDD	R16,Y+14
    02DF8 851F      LDD	R17,Y+15
    02DF9 8928      LDD	R18,Y+16
    02DFA 8939      LDD	R19,Y+17
    02DFB 938A      ST	-Y,R24
    02DFC 940E 48E9 CALL	lsr32
    02DFE 830B      STD	Y+3,R16
(0106) 	// pcmd[4]=offset;	
(0107) 	 SD_CS_EN();//打开SD卡片选
    02DFF 98C0      CBI	0x18,0
(0108) 
(0109) 	 do
(0110) 	 {  
(0111) 		temp=SD_Write_cmd(pcmd);
    02E00 018E      MOVW	R16,R28
    02E01 DF2C      RCALL	_SD_Write_cmd
    02E02 2F40      MOV	R20,R16
(0112)   		time++;
    02E03 94C3      INC	R12
(0113)   		if(time==TRY_TIME) 
    02E04 2D8C      MOV	R24,R12
    02E05 3184      CPI	R24,0x14
    02E06 F419      BNE	0x2E0A
(0114)   		{ 
(0115)    			SD_CS_DIS(); //关闭片选
    02E07 9AC0      SBI	0x18,0
(0116)    			return(temp); //命令写入失败
    02E08 2711      CLR	R17
    02E09 C037      RJMP	0x2E41
(0117)   		}
(0118) 	}while(temp!=0); 
    02E0A 2344      TST	R20
    02E0B F7A1      BNE	0x2E00
(0119) 
(0120) 	for(i=0;i<100;i++) //这里要插入若干时钟信号
    02E0C 2766      CLR	R22
    02E0D 2777      CLR	R23
    02E0E C004      RJMP	0x2E13
(0121)   		SPI_Read();
    02E0F 940E 3C02 CALL	_SPI_Read
    02E11 5F6F      SUBI	R22,0xFF
    02E12 4F7F      SBCI	R23,0xFF
    02E13 3664      CPI	R22,0x64
    02E14 E0E0      LDI	R30,0
    02E15 077E      CPC	R23,R30
    02E16 F3C0      BCS	0x2E0F
(0122) 	
(0123) 	SPI_Write(0xfe);//写入开始字节 0xfe，后面就是要写入的512个字节的数据	
    02E17 EF0E      LDI	R16,0xFE
    02E18 940E 3BFE CALL	_SPI_Write
(0124) 	
(0125) 	for(i=0;i<512;i++) //将缓冲区中要写入的512个字节写入SD卡
    02E1A 2766      CLR	R22
    02E1B 2777      CLR	R23
    02E1C C007      RJMP	0x2E24
(0126) 		SPI_Write(*buffer++);
    02E1D 01F5      MOVW	R30,R10
    02E1E 9101      LD	R16,Z+
    02E1F 015F      MOVW	R10,R30
    02E20 940E 3BFE CALL	_SPI_Write
    02E22 5F6F      SUBI	R22,0xFF
    02E23 4F7F      SBCI	R23,0xFF
    02E24 3060      CPI	R22,0
    02E25 E0E2      LDI	R30,2
    02E26 077E      CPC	R23,R30
    02E27 F3A8      BCS	0x2E1D
(0127)   
(0128) 	SPI_Read(); 
    02E28 940E 3C02 CALL	_SPI_Read
(0129) 	SPI_Read(); //两个字节的CRC校验码，不用关心
    02E2A 940E 3C02 CALL	_SPI_Read
(0130)    
(0131)     
(0132) 	temp=SPI_Read();   //读取返回值
    02E2C 940E 3C02 CALL	_SPI_Read
    02E2E 2F40      MOV	R20,R16
(0133) 	if((temp&0x1F)!=0x05) //如果返回值是 XXX00101说明数据已经被SD卡接受了
    02E2F 2F84      MOV	R24,R20
    02E30 718F      ANDI	R24,0x1F
    02E31 3085      CPI	R24,5
    02E32 F021      BEQ	0x2E37
(0134) 	{
(0135)  		SD_CS_DIS();
    02E33 9AC0      SBI	0x18,0
(0136)  		return(WRITE_BLOCK_ERROR); //写块数据失败
    02E34 E003      LDI	R16,3
    02E35 E010      LDI	R17,0
    02E36 C00A      RJMP	0x2E41
(0137) 	}
(0138)  
(0139) 	while(SPI_Read()!=0xff);//等到SD卡不忙（数据被接受以后，SD卡要将这些数据写入到自身的FLASH中，需要一个时间）
    02E37 940E 3C02 CALL	_SPI_Read
    02E39 2F40      MOV	R20,R16
    02E3A 3F0F      CPI	R16,0xFF
    02E3B F7D9      BNE	0x2E37
(0140) 						    //忙时，读回来的值为0x00,不忙时，为0xff
(0141) 
(0142) 	SD_CS_DIS(); //关闭片选
    02E3C 9AC0      SBI	0x18,0
(0143) 
(0144) 	SPI_Read();//按照SD卡的操作时序在这里补8个时钟
    02E3D 940E 3C02 CALL	_SPI_Read
(0145) 	return SD_TURE;		 //返回0,说明写扇区操作成功
    02E3F 2700      CLR	R16
    02E40 2711      CLR	R17
    02E41 9626      ADIW	R28,6
    02E42 940E 4889 CALL	pop_xgsetF03C
    02E44 9624      ADIW	R28,4
    02E45 9508      RET
_SD_Read_Sector:
  pcmd                 --> Y,+0
  temp                 --> R12
  time                 --> R22
  j                    --> R20
  buffer               --> R10
  addr                 --> Y,+14
    02E46 940E 4700 CALL	push_arg4
    02E48 940E 4880 CALL	push_xgsetF03C
    02E4A 9726      SBIW	R28,6
    02E4B 88AA      LDD	R10,Y+18
    02E4C 88BB      LDD	R11,Y+19
(0146) } 
(0147) //****************************************************************
(0148) //*隶属模块：SD卡控制
(0149) //*函数功能：读512字节数据（一扇区字节）
(0150) //****************************************************************
(0151) UINT16 SD_Read_Sector(UINT32 addr,UINT8 *buffer)//从SD卡的指定扇区中读出512个字节，使用CMD17（17号命令）
(0152) {
(0153) 
(0154) 	 UINT16 j=0;
    02E4D 2744      CLR	R20
    02E4E 2755      CLR	R21
(0155) 	 UINT8 time=0,temp=0;
    02E4F 2766      CLR	R22
    02E50 24CC      CLR	R12
(0156) 	 UINT8 pcmd[]={0x51,0x00,0x00,0x00,0x00,0xff}; //CMD17的字节序列
    02E51 E78D      LDI	R24,0x7D
    02E52 E092      LDI	R25,2
    02E53 01FE      MOVW	R30,R28
    02E54 E006      LDI	R16,6
    02E55 E010      LDI	R17,0
    02E56 93FA      ST	-Y,R31
    02E57 93EA      ST	-Y,R30
    02E58 939A      ST	-Y,R25
    02E59 938A      ST	-Y,R24
    02E5A 940E 48F5 CALL	asgnblk
(0157) 
(0158) 	 addr <<= 9; //将块地址（扇区地址）转为字节地址
    02E5C E089      LDI	R24,0x9
    02E5D E090      LDI	R25,0
    02E5E 850E      LDD	R16,Y+14
    02E5F 851F      LDD	R17,Y+15
    02E60 8928      LDD	R18,Y+16
    02E61 8939      LDD	R19,Y+17
    02E62 938A      ST	-Y,R24
    02E63 940E 48D0 CALL	lsl32
    02E65 870E      STD	Y+14,R16
    02E66 871F      STD	Y+15,R17
    02E67 8B28      STD	Y+16,R18
    02E68 8B39      STD	Y+17,R19
(0159) 
(0160) 	 pcmd[1] = (addr>>24);//将字节地址写入到CMD17字节序列中
    02E69 E188      LDI	R24,0x18
    02E6A E090      LDI	R25,0
    02E6B 850E      LDD	R16,Y+14
    02E6C 851F      LDD	R17,Y+15
    02E6D 8928      LDD	R18,Y+16
    02E6E 8939      LDD	R19,Y+17
    02E6F 938A      ST	-Y,R24
    02E70 940E 48E9 CALL	lsr32
    02E72 8309      STD	Y+1,R16
(0161) 	 pcmd[2] = (addr>>16);
    02E73 842E      LDD	R2,Y+14
    02E74 843F      LDD	R3,Y+15
    02E75 8848      LDD	R4,Y+16
    02E76 8859      LDD	R5,Y+17
    02E77 0112      MOVW	R2,R4
    02E78 2444      CLR	R4
    02E79 2455      CLR	R5
    02E7A 822A      STD	Y+2,R2
(0162) 	 pcmd[3] =(addr>>8);
    02E7B E088      LDI	R24,0x8
    02E7C E090      LDI	R25,0
    02E7D 850E      LDD	R16,Y+14
    02E7E 851F      LDD	R17,Y+15
    02E7F 8928      LDD	R18,Y+16
    02E80 8939      LDD	R19,Y+17
    02E81 938A      ST	-Y,R24
    02E82 940E 48E9 CALL	lsr32
    02E84 830B      STD	Y+3,R16
(0163) 	// pcmd[4] = offset;
(0164) 
(0165) 	 SD_CS_EN();//打开片选 
    02E85 98C0      CBI	0x18,0
(0166) 
(0167) 	 do
(0168) 	 {  
(0169) 		  temp=SD_Write_cmd(pcmd); //写入CMD17
    02E86 018E      MOVW	R16,R28
    02E87 DEA6      RCALL	_SD_Write_cmd
    02E88 2EC0      MOV	R12,R16
(0170) 		  time++;
    02E89 9563      INC	R22
(0171) 		  if(time==TRY_TIME) 
    02E8A 3164      CPI	R22,0x14
    02E8B F421      BNE	0x2E90
(0172) 		  {
(0173) 		   SD_CS_DIS();
    02E8C 9AC0      SBI	0x18,0
(0174) 		   return(READ_BLOCK_ERROR); //读块失败
    02E8D E004      LDI	R16,4
    02E8E E010      LDI	R17,0
    02E8F C01F      RJMP	0x2EAF
(0175) 		  }
(0176) 	 }while(temp!=0); 
    02E90 20CC      TST	R12
    02E91 F7A1      BNE	0x2E86
(0177)    			
(0178) 	 while(SPI_Read()!= 0xfe); //一直读，当读到0xfe时，说明后面的是512字节的数据了
    02E92 940E 3C02 CALL	_SPI_Read
    02E94 3F0E      CPI	R16,0xFE
    02E95 F7E1      BNE	0x2E92
(0179)  		   	   	
(0180) 	 for(j=0;j<512;j++)	 //将数据写入到数据缓冲区中
    02E96 2744      CLR	R20
    02E97 2755      CLR	R21
    02E98 C009      RJMP	0x2EA2
(0181) 	 {	
(0182) 	    buffer[j]=SPI_Read();
    02E99 940E 3C02 CALL	_SPI_Read
    02E9B 2EC0      MOV	R12,R16
    02E9C 01FA      MOVW	R30,R20
    02E9D 0DEA      ADD	R30,R10
    02E9E 1DFB      ADC	R31,R11
    02E9F 82C0      ST	Z,R12
    02EA0 5F4F      SUBI	R20,0xFF
    02EA1 4F5F      SBCI	R21,0xFF
    02EA2 3040      CPI	R20,0
    02EA3 E0E2      LDI	R30,2
    02EA4 075E      CPC	R21,R30
    02EA5 F398      BCS	0x2E99
(0183) 	 }
(0184) 
(0185) 	 SPI_Read();//读取两个字节的CRC校验码，不用关心它们
    02EA6 940E 3C02 CALL	_SPI_Read
(0186) 	 SPI_Read();
    02EA8 940E 3C02 CALL	_SPI_Read
(0187) 
(0188) 	 SD_CS_DIS();  //SD卡关闭片选 
    02EAA 9AC0      SBI	0x18,0
(0189) 
(0190) 	 SPI_Read();//按照SD卡的操作时序在这里补8个时钟
    02EAB 940E 3C02 CALL	_SPI_Read
(0191) 
(0192) 	 return SD_TURE;
    02EAD 2700      CLR	R16
    02EAE 2711      CLR	R17
    02EAF 9626      ADIW	R28,6
    02EB0 940E 4889 CALL	pop_xgsetF03C
    02EB2 9624      ADIW	R28,4
    02EB3 9508      RET
_SD_Read_Sector_ndata:
  pcmd                 --> Y,+0
  temp                 --> R12
  time                 --> R22
  j                    --> R20
  len                  --> R14
  offset               --> R10
  buffer               --> Y,+20
  addr                 --> Y,+16
    02EB4 940E 4700 CALL	push_arg4
    02EB6 940E 4845 CALL	push_xgsetF0FC
    02EB8 9726      SBIW	R28,6
    02EB9 88AE      LDD	R10,Y+22
    02EBA 88BF      LDD	R11,Y+23
    02EBB 8CE8      LDD	R14,Y+24
    02EBC 8CF9      LDD	R15,Y+25
(0193) }
(0194) //****************************************************************
(0195) //*隶属模块：SD卡控制
(0196) //*函数功能：写多扇区数据（多扇区字节）
(0197) //****************************************************************
(0198) UINT16 SD_Read_Sector_ndata(UINT32 addr,UINT8 *buffer,UINT16 offset,UINT16 len)//从SD卡的指定扇区中读出512个字节，使用CMD17（17号命令）
(0199) {
(0200) 
(0201) 	 UINT16 j=0;
    02EBD 2744      CLR	R20
    02EBE 2755      CLR	R21
(0202) 	 UINT8 time=0,temp=0;
    02EBF 2766      CLR	R22
    02EC0 24CC      CLR	R12
(0203) 	 UINT8 pcmd[]={0x51,0x00,0x00,0x00,0x00,0xff}; //CMD17的字节序列
    02EC1 E883      LDI	R24,0x83
    02EC2 E092      LDI	R25,2
    02EC3 01FE      MOVW	R30,R28
    02EC4 E006      LDI	R16,6
    02EC5 E010      LDI	R17,0
    02EC6 93FA      ST	-Y,R31
    02EC7 93EA      ST	-Y,R30
    02EC8 939A      ST	-Y,R25
    02EC9 938A      ST	-Y,R24
    02ECA 940E 48F5 CALL	asgnblk
(0204) 
(0205) 	 addr <<= 9; //将块地址（扇区地址）转为字节地址
    02ECC E089      LDI	R24,0x9
    02ECD E090      LDI	R25,0
    02ECE 8908      LDD	R16,Y+16
    02ECF 8919      LDD	R17,Y+17
    02ED0 892A      LDD	R18,Y+18
    02ED1 893B      LDD	R19,Y+19
    02ED2 938A      ST	-Y,R24
    02ED3 940E 48D0 CALL	lsl32
    02ED5 8B08      STD	Y+16,R16
    02ED6 8B19      STD	Y+17,R17
    02ED7 8B2A      STD	Y+18,R18
    02ED8 8B3B      STD	Y+19,R19
(0206) 
(0207) 	 pcmd[1] = (addr>>24);//将字节地址写入到CMD17字节序列中
    02ED9 E188      LDI	R24,0x18
    02EDA E090      LDI	R25,0
    02EDB 8908      LDD	R16,Y+16
    02EDC 8919      LDD	R17,Y+17
    02EDD 892A      LDD	R18,Y+18
    02EDE 893B      LDD	R19,Y+19
    02EDF 938A      ST	-Y,R24
    02EE0 940E 48E9 CALL	lsr32
    02EE2 8309      STD	Y+1,R16
(0208) 	 pcmd[2] = (addr>>16);
    02EE3 8828      LDD	R2,Y+16
    02EE4 8839      LDD	R3,Y+17
    02EE5 884A      LDD	R4,Y+18
    02EE6 885B      LDD	R5,Y+19
    02EE7 0112      MOVW	R2,R4
    02EE8 2444      CLR	R4
    02EE9 2455      CLR	R5
    02EEA 822A      STD	Y+2,R2
(0209) 	 pcmd[3] =(addr>>8);
    02EEB E088      LDI	R24,0x8
    02EEC E090      LDI	R25,0
    02EED 8908      LDD	R16,Y+16
    02EEE 8919      LDD	R17,Y+17
    02EEF 892A      LDD	R18,Y+18
    02EF0 893B      LDD	R19,Y+19
    02EF1 938A      ST	-Y,R24
    02EF2 940E 48E9 CALL	lsr32
    02EF4 830B      STD	Y+3,R16
(0210) 	// pcmd[4] = offset;
(0211) 
(0212) 	 SD_CS_EN();//打开片选 
    02EF5 98C0      CBI	0x18,0
(0213) 
(0214) 	 do
(0215) 	 {  
(0216) 		  temp=SD_Write_cmd(pcmd); //写入CMD17
    02EF6 018E      MOVW	R16,R28
    02EF7 DE36      RCALL	_SD_Write_cmd
    02EF8 2EC0      MOV	R12,R16
(0217) 		  time++;
    02EF9 9563      INC	R22
(0218) 		  if(time==TRY_TIME) 
    02EFA 3164      CPI	R22,0x14
    02EFB F421      BNE	0x2F00
(0219) 		  {
(0220) 		   SD_CS_DIS();
    02EFC 9AC0      SBI	0x18,0
(0221) 		   return(READ_BLOCK_ERROR); //读块失败
    02EFD E004      LDI	R16,4
    02EFE E010      LDI	R17,0
    02EFF C034      RJMP	0x2F34
(0222) 		  }
(0223) 	 }while(temp!=0); 
    02F00 20CC      TST	R12
    02F01 F7A1      BNE	0x2EF6
(0224)    			
(0225) 	 while(SPI_Read()!= 0xfe); //一直读，当读到0xfe时，说明后面的是512字节的数据了
    02F02 940E 3C02 CALL	_SPI_Read
    02F04 3F0E      CPI	R16,0xFE
    02F05 F7E1      BNE	0x2F02
(0226)  		   	   	
(0227) 	 for(j=0;j<offset;j++)	 //将数据写入到数据缓冲区中
    02F06 2744      CLR	R20
    02F07 2755      CLR	R21
    02F08 C004      RJMP	0x2F0D
(0228) 	    SPI_Read();
    02F09 940E 3C02 CALL	_SPI_Read
    02F0B 5F4F      SUBI	R20,0xFF
    02F0C 4F5F      SBCI	R21,0xFF
    02F0D 154A      CP	R20,R10
    02F0E 055B      CPC	R21,R11
    02F0F F3C8      BCS	0x2F09
(0229) 	 for(;j<offset+len;j++)	 
    02F10 C00B      RJMP	0x2F1C
(0230) 		buffer[j]=SPI_Read();
    02F11 940E 3C02 CALL	_SPI_Read
    02F13 2F60      MOV	R22,R16
    02F14 01FA      MOVW	R30,R20
    02F15 880C      LDD	R0,Y+20
    02F16 881D      LDD	R1,Y+21
    02F17 0DE0      ADD	R30,R0
    02F18 1DF1      ADC	R31,R1
    02F19 8360      ST	Z,R22
    02F1A 5F4F      SUBI	R20,0xFF
    02F1B 4F5F      SBCI	R21,0xFF
    02F1C 0115      MOVW	R2,R10
    02F1D 0C2E      ADD	R2,R14
    02F1E 1C3F      ADC	R3,R15
    02F1F 1542      CP	R20,R2
    02F20 0553      CPC	R21,R3
    02F21 F378      BCS	0x2F11
(0231) 	 for(;j<512;j++)	 
    02F22 C004      RJMP	0x2F27
(0232) 		SPI_Read();
    02F23 940E 3C02 CALL	_SPI_Read
    02F25 5F4F      SUBI	R20,0xFF
    02F26 4F5F      SBCI	R21,0xFF
    02F27 3040      CPI	R20,0
    02F28 E0E2      LDI	R30,2
    02F29 075E      CPC	R21,R30
    02F2A F3C0      BCS	0x2F23
(0233) 
(0234) 	 SPI_Read();//读取两个字节的CRC校验码，不用关心它们
    02F2B 940E 3C02 CALL	_SPI_Read
(0235) 	 SPI_Read();
    02F2D 940E 3C02 CALL	_SPI_Read
(0236) 
(0237) 	 SD_CS_DIS();  //SD卡关闭片选 
    02F2F 9AC0      SBI	0x18,0
(0238) 
(0239) 	 SPI_Read();//按照SD卡的操作时序在这里补8个时钟
    02F30 940E 3C02 CALL	_SPI_Read
(0240) 
(0241) 	 return SD_TURE;
    02F32 2700      CLR	R16
    02F33 2711      CLR	R17
    02F34 9626      ADIW	R28,6
    02F35 940E 483A CALL	pop_xgsetF0FC
    02F37 9624      ADIW	R28,4
    02F38 9508      RET
_GUI_mainmeu:
  key                  --> R22
  select               --> R20
    02F39 940E 4864 CALL	push_xgsetF00C
    02F3B 9723      SBIW	R28,3
FILE: D:\LQD\software\software_src\gui.c
(0001) #include "config.h"
(0002) const char labelH[]="高强度作业：\0";
(0003) const char labelM[]="中等强度作业：\0";
(0004) const char labelL[]="低强度作业：\0";
(0005) const char H01[]="加强劳动监督；\0";
(0006) const char H02[]="增加饮水;\0" ;
(0007) const char H03[]="保持干燥禁裸露。\0";
(0008) #define M01 H01
(0009) #define M02 H03
(0010) const char M03[]="戴面罩。\0";
(0011) const char M04[]="禁油彩。\0";
(0012) #define L01 M03
(0013) #define L02 M04
(0014) const char L03[]="缩短作业时间。";
(0015) //-----//
(0016) #define H11 M04
(0017) #define H12 H03
(0018) const char H13[]="休息注意保暖。\0";
(0019) #define M11 H01
(0020) const char M12[]="减少非必须作业；\0";
(0021) const char M13[]="劳动时间<30min。\0";
(0022) const char L11[]="取消非必须的作业\0";
(0023) const char L12[]="劳动时间<15min；\0";
(0024) #define L13 H03
(0025) //-----//
(0026) #define H21 L11
(0027) #define H22 L12
(0028) #define H23 H03
(0029) const char M21[]="取消户外作业。"; 
(0030) #define L21 M21
(0031) 
(0032) //#define LEDON   PORTC&=~(1<<7)					   
(0033) //#define LEDOFF  PINC|=(1<<7)
(0034) char GUI_date[17]="09月19日18:00:00\0";
(0035) 
(0036) // 主菜单
(0037) unsigned char GUI_mainmeu( void ){
(0038)  	unsigned char key=0; //init= nokey
    02F3C 2766      CLR	R22
(0039) 	unsigned char select=3;
    02F3D E043      LDI	R20,3
(0040) 	LCD_CLR();
    02F3E 940E 3CE2 CALL	_LCD_CLR
(0041) 	
(0042)  	Set_White(1,1,8,1);
    02F40 E081      LDI	R24,1
    02F41 838A      STD	Y+2,R24
    02F42 E088      LDI	R24,0x8
    02F43 8388      ST	Y,R24
    02F44 E021      LDI	R18,1
    02F45 E001      LDI	R16,1
    02F46 940E 3D6C CALL	_Set_White
(0043) 	Set_White(1,2,8,1);
    02F48 E081      LDI	R24,1
    02F49 838A      STD	Y+2,R24
    02F4A E088      LDI	R24,0x8
    02F4B 8388      ST	Y,R24
    02F4C E022      LDI	R18,2
    02F4D E001      LDI	R16,1
    02F4E 940E 3D6C CALL	_Set_White
(0044) 	Set_White(1,3,8,1);
    02F50 E081      LDI	R24,1
    02F51 838A      STD	Y+2,R24
    02F52 E088      LDI	R24,0x8
    02F53 8388      ST	Y,R24
    02F54 E023      LDI	R18,3
    02F55 E001      LDI	R16,1
    02F56 940E 3D6C CALL	_Set_White
(0045) 	Set_White(1,4,8,1);
    02F58 E081      LDI	R24,1
    02F59 838A      STD	Y+2,R24
    02F5A E088      LDI	R24,0x8
    02F5B 8388      ST	Y,R24
    02F5C E024      LDI	R18,4
    02F5D E001      LDI	R16,1
    02F5E 940E 3D6C CALL	_Set_White
(0046) 	dateRefresh(1); //更新系统时间
    02F60 E001      LDI	R16,1
    02F61 940E 38D5 CALL	_dateRefresh
(0047) 	LCD_const_disp(1,1,GUI_get_date()); //显示时间
    02F63 D544      RCALL	_GUI_get_date
    02F64 8319      STD	Y+1,R17
    02F65 8308      ST	Y,R16
    02F66 E021      LDI	R18,1
    02F67 E001      LDI	R16,1
    02F68 940E 3C3C CALL	_LCD_const_disp
(0048) 	LCD_const_disp(2,1,"  检测  时钟调整");
    02F6A E588      LDI	R24,0x58
    02F6B E095      LDI	R25,5
    02F6C 8399      STD	Y+1,R25
    02F6D 8388      ST	Y,R24
    02F6E E021      LDI	R18,1
    02F6F E002      LDI	R16,2
    02F70 940E 3C3C CALL	_LCD_const_disp
(0049) 	LCD_const_disp(3,1,"  查询  数据传输");
    02F72 E487      LDI	R24,0x47
    02F73 E095      LDI	R25,5
    02F74 8399      STD	Y+1,R25
    02F75 8388      ST	Y,R24
    02F76 E021      LDI	R18,1
    02F77 E003      LDI	R16,3
    02F78 940E 3C3C CALL	_LCD_const_disp
(0050) 	LCD_const_disp(4,1,"  初始化");
    02F7A E38E      LDI	R24,0x3E
    02F7B E095      LDI	R25,5
    02F7C 8399      STD	Y+1,R25
    02F7D 8388      ST	Y,R24
    02F7E E021      LDI	R18,1
    02F7F E004      LDI	R16,4
    02F80 940E 3C3C CALL	_LCD_const_disp
(0051) 	Set_White(1,1,8,1);
    02F82 E081      LDI	R24,1
    02F83 838A      STD	Y+2,R24
    02F84 E088      LDI	R24,0x8
    02F85 8388      ST	Y,R24
    02F86 E021      LDI	R18,1
    02F87 E001      LDI	R16,1
    02F88 940E 3D6C CALL	_Set_White
(0052) 	Set_White(1,2,8,1);
    02F8A E081      LDI	R24,1
    02F8B 838A      STD	Y+2,R24
    02F8C E088      LDI	R24,0x8
    02F8D 8388      ST	Y,R24
    02F8E E022      LDI	R18,2
    02F8F E001      LDI	R16,1
    02F90 940E 3D6C CALL	_Set_White
(0053) 	Set_White(1,3,8,1);
    02F92 E081      LDI	R24,1
    02F93 838A      STD	Y+2,R24
    02F94 E088      LDI	R24,0x8
    02F95 8388      ST	Y,R24
    02F96 E023      LDI	R18,3
    02F97 E001      LDI	R16,1
    02F98 940E 3D6C CALL	_Set_White
(0054) 	Set_White(1,4,8,1);
    02F9A E081      LDI	R24,1
    02F9B 838A      STD	Y+2,R24
    02F9C E088      LDI	R24,0x8
    02F9D 8388      ST	Y,R24
    02F9E E024      LDI	R18,4
    02F9F E001      LDI	R16,1
    02FA0 940E 3D6C CALL	_Set_White
(0055) 	set_white_n(select,0);
    02FA2 2722      CLR	R18
    02FA3 2F04      MOV	R16,R20
    02FA4 940E 3DFE CALL	_set_white_n
    02FA6 C07D      RJMP	0x3024
(0056) 	while(1)
(0057) 	{
(0058) 	 	key=kbscan();
    02FA7 940E 4226 CALL	_kbscan
    02FA9 2F60      MOV	R22,R16
(0059) 		dateRefresh(1); //更新系统时间
    02FAA E001      LDI	R16,1
    02FAB 940E 38D5 CALL	_dateRefresh
(0060) 		LCD_const_disp(1,1,GUI_get_date()); //显示时间
    02FAD D4FA      RCALL	_GUI_get_date
    02FAE 0158      MOVW	R10,R16
    02FAF 82B9      STD	Y+1,R11
    02FB0 82A8      ST	Y,R10
    02FB1 E021      LDI	R18,1
    02FB2 E001      LDI	R16,1
    02FB3 940E 3C3C CALL	_LCD_const_disp
(0061) 		if((select>3) && ( key==up ) ){
    02FB5 E083      LDI	R24,3
    02FB6 1784      CP	R24,R20
    02FB7 F4F8      BCC	0x2FD7
    02FB8 316E      CPI	R22,0x1E
    02FB9 F4E9      BNE	0x2FD7
(0062) 		 Set_White(1,2,8,1);
    02FBA E081      LDI	R24,1
    02FBB 838A      STD	Y+2,R24
    02FBC E088      LDI	R24,0x8
    02FBD 8388      ST	Y,R24
    02FBE E022      LDI	R18,2
    02FBF E001      LDI	R16,1
    02FC0 940E 3D6C CALL	_Set_White
(0063) 		 Set_White(1,3,8,1);
    02FC2 E081      LDI	R24,1
    02FC3 838A      STD	Y+2,R24
    02FC4 E088      LDI	R24,0x8
    02FC5 8388      ST	Y,R24
    02FC6 E023      LDI	R18,3
    02FC7 E001      LDI	R16,1
    02FC8 940E 3D6C CALL	_Set_White
(0064) 		 Set_White(1,4,8,1);
    02FCA E081      LDI	R24,1
    02FCB 838A      STD	Y+2,R24
    02FCC E088      LDI	R24,0x8
    02FCD 8388      ST	Y,R24
    02FCE E024      LDI	R18,4
    02FCF E001      LDI	R16,1
    02FD0 940E 3D6C CALL	_Set_White
(0065) 		 select--;
    02FD2 954A      DEC	R20
(0066) 		 set_white_n(select,0);
    02FD3 2722      CLR	R18
    02FD4 2F04      MOV	R16,R20
    02FD5 940E 3DFE CALL	_set_white_n
(0067) 		}
(0068) 		if((select<7) && ( key==down ) ){
    02FD7 3047      CPI	R20,7
    02FD8 F538      BCC	0x3000
    02FD9 316D      CPI	R22,0x1D
    02FDA F529      BNE	0x3000
(0069) 		 Set_White(1,1,8,1);
    02FDB E081      LDI	R24,1
    02FDC 838A      STD	Y+2,R24
    02FDD E088      LDI	R24,0x8
    02FDE 8388      ST	Y,R24
    02FDF E021      LDI	R18,1
    02FE0 E001      LDI	R16,1
    02FE1 940E 3D6C CALL	_Set_White
(0070) 		 Set_White(1,2,8,1);
    02FE3 E081      LDI	R24,1
    02FE4 838A      STD	Y+2,R24
    02FE5 E088      LDI	R24,0x8
    02FE6 8388      ST	Y,R24
    02FE7 E022      LDI	R18,2
    02FE8 E001      LDI	R16,1
    02FE9 940E 3D6C CALL	_Set_White
(0071) 		 Set_White(1,3,8,1);
    02FEB E081      LDI	R24,1
    02FEC 838A      STD	Y+2,R24
    02FED E088      LDI	R24,0x8
    02FEE 8388      ST	Y,R24
    02FEF E023      LDI	R18,3
    02FF0 E001      LDI	R16,1
    02FF1 940E 3D6C CALL	_Set_White
(0072) 		 Set_White(1,4,8,1);
    02FF3 E081      LDI	R24,1
    02FF4 838A      STD	Y+2,R24
    02FF5 E088      LDI	R24,0x8
    02FF6 8388      ST	Y,R24
    02FF7 E024      LDI	R18,4
    02FF8 E001      LDI	R16,1
    02FF9 940E 3D6C CALL	_Set_White
(0073) 		 select++;
    02FFB 9543      INC	R20
(0074) 		 set_white_n(select,0);
    02FFC 2722      CLR	R18
    02FFD 2F04      MOV	R16,R20
    02FFE 940E 3DFE CALL	_set_white_n
(0075) 		}
(0076) 		if(key == left ){
    03000 316B      CPI	R22,0x1B
    03001 F511      BNE	0x3024
(0077) 		 Set_White(1,1,8,1);
    03002 E081      LDI	R24,1
    03003 838A      STD	Y+2,R24
    03004 E088      LDI	R24,0x8
    03005 8388      ST	Y,R24
    03006 E021      LDI	R18,1
    03007 E001      LDI	R16,1
    03008 940E 3D6C CALL	_Set_White
(0078) 		 Set_White(1,2,8,1);
    0300A E081      LDI	R24,1
    0300B 838A      STD	Y+2,R24
    0300C E088      LDI	R24,0x8
    0300D 8388      ST	Y,R24
    0300E E022      LDI	R18,2
    0300F E001      LDI	R16,1
    03010 940E 3D6C CALL	_Set_White
(0079) 		 Set_White(1,3,8,1);
    03012 E081      LDI	R24,1
    03013 838A      STD	Y+2,R24
    03014 E088      LDI	R24,0x8
    03015 8388      ST	Y,R24
    03016 E023      LDI	R18,3
    03017 E001      LDI	R16,1
    03018 940E 3D6C CALL	_Set_White
(0080) 		 Set_White(1,4,8,1);
    0301A E081      LDI	R24,1
    0301B 838A      STD	Y+2,R24
    0301C E088      LDI	R24,0x8
    0301D 8388      ST	Y,R24
    0301E E024      LDI	R18,4
    0301F E001      LDI	R16,1
    03020 940E 3D6C CALL	_Set_White
(0081) 		 //beep(3,select);
(0082) 		 return select;
    03022 2F04      MOV	R16,R20
    03023 C001      RJMP	0x3025
    03024 CF82      RJMP	0x2FA7
    03025 9623      ADIW	R28,3
    03026 940C 486B JMP	pop_xgsetF00C
_GUI_check:
  windcounter          --> R10
  next_step_time       --> Y,+3
  selectCheckMode      --> R14
  is_on                --> Y,+8
  page                 --> Y,+7
  key                  --> R12
    03028 940E 4845 CALL	push_xgsetF0FC
    0302A 9729      SBIW	R28,0x9
(0083) 		}
(0084)     }
(0085) 	return 0xff; //error
(0086) 	
(0087) }
(0088) 
(0089) //”检测 “菜单
(0090) void GUI_check(void){
(0091)     char key;
(0092) 	char page=0,is_on=0;
    0302B 2400      CLR	R0
    0302C 820F      STD	Y+7,R0
    0302D 8608      STD	Y+8,R0
(0093) 	char windcounter=0;
    0302E 24AA      CLR	R10
(0094) 	unsigned long next_step_time=0;
    0302F E080      LDI	R24,0
    03030 838B      STD	Y+3,R24
    03031 838C      STD	Y+4,R24
    03032 838D      STD	Y+5,R24
    03033 838E      STD	Y+6,R24
(0095) 	char selectCheckMode=config.autocheck; //自动检测开关
    03034 90E0 0863 LDS	R14,config+16
(0096) RE_IN:
(0097) 	key=0;
    03036 24CC      CLR	R12
(0098) 	page=0;
    03037 2400      CLR	R0
    03038 820F      STD	Y+7,R0
(0099) 	is_on=0;
    03039 8608      STD	Y+8,R0
(0100) 	windcounter=0;
    0303A 24AA      CLR	R10
(0101) 	next_step_time=0;
    0303B E080      LDI	R24,0
    0303C 838B      STD	Y+3,R24
    0303D 838C      STD	Y+4,R24
    0303E 838D      STD	Y+5,R24
    0303F 838E      STD	Y+6,R24
(0102) 	
(0103) 	dateRefresh(1);
    03040 E001      LDI	R16,1
    03041 940E 38D5 CALL	_dateRefresh
(0104) 	LCD_CLR();
    03043 940E 3CE2 CALL	_LCD_CLR
(0105) 	LCD_const_disp(1,1,"菜单/ 检测");
    03045 E383      LDI	R24,0x33
    03046 E095      LDI	R25,5
    03047 8399      STD	Y+1,R25
    03048 8388      ST	Y,R24
    03049 E021      LDI	R18,1
    0304A E001      LDI	R16,1
    0304B 940E 3C3C CALL	_LCD_const_disp
(0106) 	LCD_const_disp(2,3,"自动");		 
    0304D E28E      LDI	R24,0x2E
    0304E E095      LDI	R25,5
    0304F 8399      STD	Y+1,R25
    03050 8388      ST	Y,R24
    03051 E023      LDI	R18,3
    03052 E002      LDI	R16,2
    03053 940E 3C3C CALL	_LCD_const_disp
(0107) 	LCD_const_disp(3,3,"手动");
    03055 E289      LDI	R24,0x29
    03056 E095      LDI	R25,5
    03057 8399      STD	Y+1,R25
    03058 8388      ST	Y,R24
    03059 E023      LDI	R18,3
    0305A E003      LDI	R16,3
    0305B 940E 3C3C CALL	_LCD_const_disp
(0108) 	if(selectCheckMode==1) {
    0305D 2D8E      MOV	R24,R14
    0305E 3081      CPI	R24,1
    0305F F489      BNE	0x3071
(0109) 	    Set_White(1,2,8,0);
    03060 2422      CLR	R2
    03061 822A      STD	Y+2,R2
    03062 E088      LDI	R24,0x8
    03063 8388      ST	Y,R24
    03064 E022      LDI	R18,2
    03065 E001      LDI	R16,1
    03066 940E 3D6C CALL	_Set_White
(0110) 		Set_White(1,3,8,1);
    03068 E081      LDI	R24,1
    03069 838A      STD	Y+2,R24
    0306A E088      LDI	R24,0x8
    0306B 8388      ST	Y,R24
    0306C E023      LDI	R18,3
    0306D E001      LDI	R16,1
    0306E 940E 3D6C CALL	_Set_White
(0111) 	}
    03070 C05B      RJMP	0x30CC
(0112) 	else {
(0113) 		 Set_White(1,2,8,1);
    03071 E081      LDI	R24,1
    03072 838A      STD	Y+2,R24
    03073 E088      LDI	R24,0x8
    03074 8388      ST	Y,R24
    03075 E022      LDI	R18,2
    03076 E001      LDI	R16,1
    03077 940E 3D6C CALL	_Set_White
(0114) 		 Set_White(1,3,8,0);
    03079 2422      CLR	R2
    0307A 822A      STD	Y+2,R2
    0307B E088      LDI	R24,0x8
    0307C 8388      ST	Y,R24
    0307D E023      LDI	R18,3
    0307E E001      LDI	R16,1
    0307F 940E 3D6C CALL	_Set_White
(0115) 	}
    03081 C04A      RJMP	0x30CC
(0116) 	
(0117) //<<菜单/检测/手（自）动>>
(0118) 	while(1){
(0119) 	 	key=kbscan();
    03082 940E 4226 CALL	_kbscan
    03084 2EC0      MOV	R12,R16
(0120) 		//上键短按 选择
(0121) 		if(key==up || key ==down){
    03085 2D8C      MOV	R24,R12
    03086 310E      CPI	R16,0x1E
    03087 F011      BEQ	0x308A
    03088 310D      CPI	R16,0x1D
    03089 F539      BNE	0x30B1
(0122) 		    if(selectCheckMode >0){
    0308A E080      LDI	R24,0
    0308B 158E      CP	R24,R14
    0308C F490      BCC	0x309F
(0123) 			    selectCheckMode=0;
    0308D 24EE      CLR	R14
(0124) 				Set_White(1,2,8,1);
    0308E E081      LDI	R24,1
    0308F 838A      STD	Y+2,R24
    03090 E088      LDI	R24,0x8
    03091 8388      ST	Y,R24
    03092 E022      LDI	R18,2
    03093 E001      LDI	R16,1
    03094 940E 3D6C CALL	_Set_White
(0125) 	 			Set_White(1,3,8,0);
    03096 2422      CLR	R2
    03097 822A      STD	Y+2,R2
    03098 E088      LDI	R24,0x8
    03099 8388      ST	Y,R24
    0309A E023      LDI	R18,3
    0309B E001      LDI	R16,1
    0309C 940E 3D6C CALL	_Set_White
(0126) 			}
    0309E C012      RJMP	0x30B1
(0127) 			else {
(0128) 			    selectCheckMode=1;
    0309F 24EE      CLR	R14
    030A0 94E3      INC	R14
(0129) 				Set_White(1,2,8,0);
    030A1 2422      CLR	R2
    030A2 822A      STD	Y+2,R2
    030A3 E088      LDI	R24,0x8
    030A4 8388      ST	Y,R24
    030A5 E022      LDI	R18,2
    030A6 E001      LDI	R16,1
    030A7 940E 3D6C CALL	_Set_White
(0130) 	 			Set_White(1,3,8,1);
    030A9 E081      LDI	R24,1
    030AA 838A      STD	Y+2,R24
    030AB E088      LDI	R24,0x8
    030AC 8388      ST	Y,R24
    030AD E023      LDI	R18,3
    030AE E001      LDI	R16,1
    030AF 940E 3D6C CALL	_Set_White
(0131) 			}
(0132) 			
(0133) 		}
(0134) 		//左键短按  进入
(0135) 		if(key == left) {
    030B1 2D8C      MOV	R24,R12
    030B2 318B      CPI	R24,0x1B
    030B3 F499      BNE	0x30C7
(0136) 			config.autocheck=selectCheckMode; 
    030B4 92E0 0863 STS	config+16,R14
(0137) 			Set_White(1,2,8,1);
    030B6 E081      LDI	R24,1
    030B7 838A      STD	Y+2,R24
    030B8 E088      LDI	R24,0x8
    030B9 8388      ST	Y,R24
    030BA E022      LDI	R18,2
    030BB E001      LDI	R16,1
    030BC 940E 3D6C CALL	_Set_White
(0138) 	 		Set_White(1,3,8,1); 
    030BE E081      LDI	R24,1
    030BF 838A      STD	Y+2,R24
    030C0 E088      LDI	R24,0x8
    030C1 8388      ST	Y,R24
    030C2 E023      LDI	R18,3
    030C3 E001      LDI	R16,1
    030C4 940E 3D6C CALL	_Set_White
(0139) 			break ;		
    030C6 C006      RJMP	0x30CD
(0140) 		}
(0141) 		//右键短按  返回
(0142) 		if(key == right) {
    030C7 2D8C      MOV	R24,R12
    030C8 3187      CPI	R24,0x17
    030C9 F409      BNE	0x30CB
(0143) 			return ;		
    030CA C1CE      RJMP	0x3299
(0144) 		}
(0145) 		key=0;
    030CB 24CC      CLR	R12
    030CC CFB5      RJMP	0x3082
(0146) 	} //end of while
(0147)     //自动开启检测
(0148) 	dateRefresh(0);
    030CD 2700      CLR	R16
    030CE 940E 38D5 CALL	_dateRefresh
(0149) 	is_on =1 ;
    030D0 2400      CLR	R0
    030D1 9403      INC	R0
    030D2 8608      STD	Y+8,R0
(0150) 	config.time1=config.now+config.THRESHOLD_delta_sec;
    030D3 9040 0859 LDS	R4,config+6
    030D5 9050 085A LDS	R5,config+7
    030D7 9020 0857 LDS	R2,config+4
    030D9 9030 0858 LDS	R3,config+5
    030DB 9080 0861 LDS	R8,config+14
    030DD 9090 0862 LDS	R9,config+15
    030DF 9060 085F LDS	R6,config+12
    030E1 9070 0860 LDS	R7,config+13
    030E3 0C62      ADD	R6,R2
    030E4 1C73      ADC	R7,R3
    030E5 1C84      ADC	R8,R4
    030E6 1C95      ADC	R9,R5
    030E7 9270 085C STS	config+9,R7
    030E9 9260 085B STS	config+8,R6
    030EB 9290 085E STS	config+11,R9
    030ED 9280 085D STS	config+10,R8
(0151) 	Result.TempChar[0]=0; //清除上次结果
    030EF 2422      CLR	R2
    030F0 9220 0610 STS	Result+45,R2
(0152) 	Result.WSChar[0]=0;
    030F2 9220 061A STS	Result+55,R2
    030F4 C1A3      RJMP	0x3298
(0153) 	while(1){
(0154) 		key=kbscan();
    030F5 940E 4226 CALL	_kbscan
    030F7 2EC0      MOV	R12,R16
(0155) 		if(key != 0) beep(0,1);
    030F8 2300      TST	R16
    030F9 F021      BEQ	0x30FE
    030FA E021      LDI	R18,1
    030FB 2700      CLR	R16
    030FC 940E 3FB7 CALL	_beep
(0156) 		if(key==right){	//右键 退出
    030FE 2D8C      MOV	R24,R12
    030FF 3187      CPI	R24,0x17
    03100 F569      BNE	0x312E
(0157) 		    is_on=0;
    03101 2400      CLR	R0
    03102 8608      STD	Y+8,R0
(0158) 			LCD_CLR();
    03103 940E 3CE2 CALL	_LCD_CLR
(0159) 		 	LCD_Init();	  
    03105 940E 3CB0 CALL	_LCD_Init
(0160) 	 	 	LCD_const_disp(4,5,"退出    "); 
    03107 E280      LDI	R24,0x20
    03108 E095      LDI	R25,5
    03109 8399      STD	Y+1,R25
    0310A 8388      ST	Y,R24
    0310B E025      LDI	R18,5
    0310C E004      LDI	R16,4
    0310D 940E 3C3C CALL	_LCD_const_disp
(0161) 		 	delayms(200);
    0310F EC08      LDI	R16,0xC8
    03110 E010      LDI	R17,0
    03111 940E 2511 CALL	_delayms
(0162) 		 	LCD_const_disp(4,7,".."); 
    03113 E18D      LDI	R24,0x1D
    03114 E095      LDI	R25,5
    03115 8399      STD	Y+1,R25
    03116 8388      ST	Y,R24
    03117 E027      LDI	R18,7
    03118 E004      LDI	R16,4
    03119 940E 3C3C CALL	_LCD_const_disp
(0163) 		 	delayms(200);
    0311B EC08      LDI	R16,0xC8
    0311C E010      LDI	R17,0
    0311D 940E 2511 CALL	_delayms
(0164) 		 	LCD_const_disp(4,8,".."); 	
    0311F E18D      LDI	R24,0x1D
    03120 E095      LDI	R25,5
    03121 8399      STD	Y+1,R25
    03122 8388      ST	Y,R24
    03123 E028      LDI	R18,0x8
    03124 E004      LDI	R16,4
    03125 940E 3C3C CALL	_LCD_const_disp
(0165) 		 	delayms(500);
    03127 EF04      LDI	R16,0xF4
    03128 E011      LDI	R17,1
    03129 940E 2511 CALL	_delayms
(0166) 		 	LCD_CLR();
    0312B 940E 3CE2 CALL	_LCD_CLR
(0167) 		 	goto RE_IN;
    0312D CF08      RJMP	0x3036
(0168) 		}
(0169) 		if(is_on==1){ 
    0312E 8588      LDD	R24,Y+8
    0312F 3081      CPI	R24,1
    03130 F009      BEQ	0x3132
    03131 C08B      RJMP	0x31BD
(0170) 			dateRefresh(1); 
    03132 E001      LDI	R16,1
    03133 D7A1      RCALL	_dateRefresh
(0171) 		    _GUI_datashow(page); //更新时间
    03134 810F      LDD	R16,Y+7
    03135 D166      RCALL	__GUI_datashow
(0172) 		    if(config.now < config.time1) {
    03136 9040 085D LDS	R4,config+10
    03138 9050 085E LDS	R5,config+11
    0313A 9020 085B LDS	R2,config+8
    0313C 9030 085C LDS	R3,config+9
    0313E 9080 0861 LDS	R8,config+14
    03140 9090 0862 LDS	R9,config+15
    03142 9060 085F LDS	R6,config+12
    03144 9070 0860 LDS	R7,config+13
    03146 1462      CP	R6,R2
    03147 0473      CPC	R7,R3
    03148 0484      CPC	R8,R4
    03149 0495      CPC	R9,R5
    0314A F598      BCC	0x317E
(0173) 				//时间更新 开启风速检测 等待检测 不支持翻页
(0174) 				if(windcounter==0){
    0314B 20AA      TST	R10
    0314C F421      BNE	0x3151
(0175) 				    windcounter=1; //清零开启风速计数器
    0314D 24AA      CLR	R10
    0314E 94A3      INC	R10
(0176) 					timer1_init(); //开启风速传感器技术
    0314F 940E 255D CALL	_timer1_init
(0177) 				}
(0178) 				if(page == 0 ){
    03151 800F      LDD	R0,Y+7
    03152 2000      TST	R0
    03153 F009      BEQ	0x3155
    03154 C13F      RJMP	0x3294
(0179) 				
(0180) 				    LCD_const_disp(4,1,"正在检测");
    03155 E184      LDI	R24,0x14
    03156 E095      LDI	R25,5
    03157 8399      STD	Y+1,R25
    03158 8388      ST	Y,R24
    03159 E021      LDI	R18,1
    0315A E004      LDI	R16,4
    0315B 940E 3C3C CALL	_LCD_const_disp
(0181) 					LCD_print4num(4,5,config.time1-config.now);
    0315D 9020 085F LDS	R2,config+12
    0315F 9030 0860 LDS	R3,config+13
    03161 9040 085B LDS	R4,config+8
    03163 9050 085C LDS	R5,config+9
    03165 1842      SUB	R4,R2
    03166 0853      SBC	R5,R3
    03167 8259      STD	Y+1,R5
    03168 8248      ST	Y,R4
    03169 E025      LDI	R18,5
    0316A E004      LDI	R16,4
    0316B 940E 3EFE CALL	_LCD_print4num
(0182) 					LCD_const_disp(2,6,"      ");
    0316D E08D      LDI	R24,0xD
    0316E E095      LDI	R25,5
    0316F 8399      STD	Y+1,R25
    03170 8388      ST	Y,R24
    03171 E026      LDI	R18,6
    03172 E002      LDI	R16,2
    03173 940E 3C3C CALL	_LCD_const_disp
(0183) 					LCD_const_disp(3,6,"      ");
    03175 E08D      LDI	R24,0xD
    03176 E095      LDI	R25,5
    03177 8399      STD	Y+1,R25
    03178 8388      ST	Y,R24
    03179 E026      LDI	R18,6
    0317A E003      LDI	R16,3
    0317B 940E 3C3C CALL	_LCD_const_disp
(0184) 				}
(0185) 			} 
    0317D C116      RJMP	0x3294
(0186) 			else {
(0187) 			   //检测完成 获得数据 转换数据 存储数据 切换到非检测状态
(0188) 			    windcounter =0 ; //关闭风速传感器计数器
    0317E 24AA      CLR	R10
(0189) 				check();
    0317F 940E 29D4 CALL	_check
(0190) 				StructToChar(); //转成字符串
    03181 940E 2B95 CALL	_StructToChar
(0191) 				WriteFileHead();//重写文件头
    03183 940E 269E CALL	_WriteFileHead
(0192) 				WriteSDFile();  //写入sd卡
    03185 940E 2719 CALL	_WriteSDFile
(0193) 				//zigbee_send(); //发送
(0194) 				Result.Index++; //索引自增一
    03187 E041      LDI	R20,1
    03188 E050      LDI	R21,0
    03189 E060      LDI	R22,0
    0318A E070      LDI	R23,0
    0318B 9040 05EF LDS	R4,Result+12
    0318D 9050 05F0 LDS	R5,Result+13
    0318F 9020 05ED LDS	R2,Result+10
    03191 9030 05EE LDS	R3,Result+11
    03193 0E24      ADD	R2,R20
    03194 1E35      ADC	R3,R21
    03195 1E46      ADC	R4,R22
    03196 1E57      ADC	R5,R23
    03197 9230 05EE STS	Result+11,R3
    03199 9220 05ED STS	Result+10,R2
    0319B 9250 05F0 STS	Result+13,R5
    0319D 9240 05EF STS	Result+12,R4
(0195) 				is_on=0; //切换到非检测状态
    0319F 2400      CLR	R0
    031A0 8608      STD	Y+8,R0
(0196) 				next_step_time=config.now+config.checkDeltaTime;//自动翻页时间更新
    031A1 9020 0864 LDS	R2,config+17
    031A3 9030 0865 LDS	R3,config+18
    031A5 2444      CLR	R4
    031A6 FC37      SBRC	R3,7
    031A7 9440      COM	R4
    031A8 2455      CLR	R5
    031A9 FC47      SBRC	R4,7
    031AA 9450      COM	R5
    031AB 9080 0861 LDS	R8,config+14
    031AD 9090 0862 LDS	R9,config+15
    031AF 9060 085F LDS	R6,config+12
    031B1 9070 0860 LDS	R7,config+13
    031B3 0C62      ADD	R6,R2
    031B4 1C73      ADC	R7,R3
    031B5 1C84      ADC	R8,R4
    031B6 1C95      ADC	R9,R5
    031B7 826B      STD	Y+3,R6
    031B8 827C      STD	Y+4,R7
    031B9 828D      STD	Y+5,R8
    031BA 829E      STD	Y+6,R9
(0197) 				page=0;
    031BB 820F      STD	Y+7,R0
(0198) 		   }
(0199) 		}
    031BC C0D7      RJMP	0x3294
(0200) 		else { //is_on == 0 非检测状态 手动翻页/自动翻页
(0201) 		    dateRefresh(0);//不更新时间
    031BD 2700      CLR	R16
    031BE D716      RCALL	_dateRefresh
(0202) 			_GUI_datashow(page); 
    031BF 810F      LDD	R16,Y+7
    031C0 D0DB      RCALL	__GUI_datashow
(0203) 			if(page == 0 ){
    031C1 800F      LDD	R0,Y+7
    031C2 2000      TST	R0
    031C3 F4E9      BNE	0x31E1
(0204) 				
(0205) 				    LCD_const_disp(4,1,"完成检测        ");
    031C4 EF8C      LDI	R24,0xFC
    031C5 E094      LDI	R25,4
    031C6 8399      STD	Y+1,R25
    031C7 8388      ST	Y,R24
    031C8 E021      LDI	R18,1
    031C9 E004      LDI	R16,4
    031CA 940E 3C3C CALL	_LCD_const_disp
(0206) 					if(config.autocheck == 1){
    031CC 9180 0863 LDS	R24,config+16
    031CE 3081      CPI	R24,1
    031CF F449      BNE	0x31D9
(0207) 					    LCD_const_disp(4,7,"自动");
    031D0 E28E      LDI	R24,0x2E
    031D1 E095      LDI	R25,5
    031D2 8399      STD	Y+1,R25
    031D3 8388      ST	Y,R24
    031D4 E027      LDI	R18,7
    031D5 E004      LDI	R16,4
    031D6 940E 3C3C CALL	_LCD_const_disp
(0208) 					}
    031D8 C008      RJMP	0x31E1
(0209) 					else {
(0210) 					    LCD_const_disp(4,7,"手动");
    031D9 E289      LDI	R24,0x29
    031DA E095      LDI	R25,5
    031DB 8399      STD	Y+1,R25
    031DC 8388      ST	Y,R24
    031DD E027      LDI	R18,7
    031DE E004      LDI	R16,4
    031DF 940E 3C3C CALL	_LCD_const_disp
(0211) 					}
(0212) 					
(0213) 				}
(0214) 						//手动翻页 
(0215) 			if(key==up){ //上键 : 页面减 
    031E1 2D8C      MOV	R24,R12
    031E2 318E      CPI	R24,0x1E
    031E3 F539      BNE	0x320B
(0216) 		        if(page>0) page--;
    031E4 E080      LDI	R24,0
    031E5 800F      LDD	R0,Y+7
    031E6 1580      CP	R24,R0
    031E7 F418      BCC	0x31EB
    031E8 940A      DEC	R0
    031E9 820F      STD	Y+7,R0
    031EA C01C      RJMP	0x3207
(0217) 				else{
(0218) 				page =5;
    031EB E085      LDI	R24,5
    031EC 838F      STD	Y+7,R24
(0219) 				next_step_time = config.now + config.checkDeltaTime;
    031ED 9020 0864 LDS	R2,config+17
    031EF 9030 0865 LDS	R3,config+18
    031F1 2444      CLR	R4
    031F2 FC37      SBRC	R3,7
    031F3 9440      COM	R4
    031F4 2455      CLR	R5
    031F5 FC47      SBRC	R4,7
    031F6 9450      COM	R5
    031F7 9080 0861 LDS	R8,config+14
    031F9 9090 0862 LDS	R9,config+15
    031FB 9060 085F LDS	R6,config+12
    031FD 9070 0860 LDS	R7,config+13
    031FF 0C62      ADD	R6,R2
    03200 1C73      ADC	R7,R3
    03201 1C84      ADC	R8,R4
    03202 1C95      ADC	R9,R5
    03203 826B      STD	Y+3,R6
    03204 827C      STD	Y+4,R7
    03205 828D      STD	Y+5,R8
    03206 829E      STD	Y+6,R9
(0220) 				}
(0221) 		    	LCD_CLR();
    03207 940E 3CE2 CALL	_LCD_CLR
(0222) 		    	LCD_Init();
    03209 940E 3CB0 CALL	_LCD_Init
(0223) 			}
(0224) 			if(key==down){//下键 ： 页面加
    0320B 2D8C      MOV	R24,R12
    0320C 318D      CPI	R24,0x1D
    0320D F509      BNE	0x322F
(0225) 		        page++;
    0320E 800F      LDD	R0,Y+7
    0320F 9403      INC	R0
    03210 820F      STD	Y+7,R0
(0226) 				next_step_time = config.now + config.checkDeltaTime;
    03211 9020 0864 LDS	R2,config+17
    03213 9030 0865 LDS	R3,config+18
    03215 2444      CLR	R4
    03216 FC37      SBRC	R3,7
    03217 9440      COM	R4
    03218 2455      CLR	R5
    03219 FC47      SBRC	R4,7
    0321A 9450      COM	R5
    0321B 9080 0861 LDS	R8,config+14
    0321D 9090 0862 LDS	R9,config+15
    0321F 9060 085F LDS	R6,config+12
    03221 9070 0860 LDS	R7,config+13
    03223 0C62      ADD	R6,R2
    03224 1C73      ADC	R7,R3
    03225 1C84      ADC	R8,R4
    03226 1C95      ADC	R9,R5
    03227 826B      STD	Y+3,R6
    03228 827C      STD	Y+4,R7
    03229 828D      STD	Y+5,R8
    0322A 829E      STD	Y+6,R9
(0227) 		  		LCD_CLR();
    0322B 940E 3CE2 CALL	_LCD_CLR
(0228) 		    	LCD_Init();
    0322D 940E 3CB0 CALL	_LCD_Init
(0229) 			} 	
(0230) 			//LCD_print2num(4,1,page);
(0231) 			//LCD_print4num(4,3,config.now);
(0232) 			//LCD_print4num(4,6,next_step_time);
(0233) 			if( config.autocheck == 1 ){  //如果开启自动翻页
    0322F 9180 0863 LDS	R24,config+16
    03231 3081      CPI	R24,1
    03232 F009      BEQ	0x3234
    03233 C060      RJMP	0x3294
(0234) 			      if(config.now >= next_step_time || page >=6 )	{
    03234 802B      LDD	R2,Y+3
    03235 803C      LDD	R3,Y+4
    03236 804D      LDD	R4,Y+5
    03237 805E      LDD	R5,Y+6
    03238 9080 0861 LDS	R8,config+14
    0323A 9090 0862 LDS	R9,config+15
    0323C 9060 085F LDS	R6,config+12
    0323E 9070 0860 LDS	R7,config+13
    03240 1462      CP	R6,R2
    03241 0473      CPC	R7,R3
    03242 0484      CPC	R8,R4
    03243 0495      CPC	R9,R5
    03244 F420      BCC	0x3249
    03245 818F      LDD	R24,Y+7
    03246 3086      CPI	R24,6
    03247 F408      BCC	0x3249
    03248 C04B      RJMP	0x3294
(0235) 				      next_step_time = config.now + config.checkDeltaTime;
    03249 9020 0864 LDS	R2,config+17
    0324B 9030 0865 LDS	R3,config+18
    0324D 2444      CLR	R4
    0324E FC37      SBRC	R3,7
    0324F 9440      COM	R4
    03250 2455      CLR	R5
    03251 FC47      SBRC	R4,7
    03252 9450      COM	R5
    03253 9080 0861 LDS	R8,config+14
    03255 9090 0862 LDS	R9,config+15
    03257 9060 085F LDS	R6,config+12
    03259 9070 0860 LDS	R7,config+13
    0325B 0C62      ADD	R6,R2
    0325C 1C73      ADC	R7,R3
    0325D 1C84      ADC	R8,R4
    0325E 1C95      ADC	R9,R5
    0325F 826B      STD	Y+3,R6
    03260 827C      STD	Y+4,R7
    03261 828D      STD	Y+5,R8
    03262 829E      STD	Y+6,R9
(0236) 					  page++;
    03263 800F      LDD	R0,Y+7
    03264 9403      INC	R0
    03265 820F      STD	Y+7,R0
(0237) 					  if( page>=6 ){
    03266 2D80      MOV	R24,R0
    03267 3086      CPI	R24,6
    03268 F140      BCS	0x3291
(0238) 					      //自动翻到最后页，页面清零开启下次检测
(0239) 					      page = 0;
    03269 2400      CLR	R0
    0326A 820F      STD	Y+7,R0
(0240) 						  dateRefresh(1); //刷新时间
    0326B E001      LDI	R16,1
    0326C D668      RCALL	_dateRefresh
(0241) 						  is_on =1 ; //开启检测
    0326D 2400      CLR	R0
    0326E 9403      INC	R0
    0326F 8608      STD	Y+8,R0
(0242) 						  config.time1=config.now+config.THRESHOLD_delta_sec; //更新下次检测时间
    03270 9040 0859 LDS	R4,config+6
    03272 9050 085A LDS	R5,config+7
    03274 9020 0857 LDS	R2,config+4
    03276 9030 0858 LDS	R3,config+5
    03278 9080 0861 LDS	R8,config+14
    0327A 9090 0862 LDS	R9,config+15
    0327C 9060 085F LDS	R6,config+12
    0327E 9070 0860 LDS	R7,config+13
    03280 0C62      ADD	R6,R2
    03281 1C73      ADC	R7,R3
    03282 1C84      ADC	R8,R4
    03283 1C95      ADC	R9,R5
    03284 9270 085C STS	config+9,R7
    03286 9260 085B STS	config+8,R6
    03288 9290 085E STS	config+11,R9
    0328A 9280 085D STS	config+10,R8
(0243) 						  Result.TempChar[0]=0; //清除上次结果
    0328C 2422      CLR	R2
    0328D 9220 0610 STS	Result+45,R2
(0244) 						  Result.WSChar[0]=0;
    0328F 9220 061A STS	Result+55,R2
(0245) 					  }
(0246) 				      LCD_CLR();      
    03291 940E 3CE2 CALL	_LCD_CLR
(0247) 					  key=0;
    03293 24CC      CLR	R12
(0248) 				  }  
(0249) 			}
(0250) 
(0251) 			
(0252) 
(0253) 			 
(0254) 		} 
(0255) 	    delayms(10); 
    03294 E00A      LDI	R16,0xA
    03295 E010      LDI	R17,0
    03296 940E 2511 CALL	_delayms
    03298 CE5C      RJMP	0x30F5
    03299 9629      ADIW	R28,0x9
    0329A 940C 483A JMP	pop_xgsetF0FC
__GUI_datashow:
  page                 --> R20
    0329C 940E 4864 CALL	push_xgsetF00C
    0329E 2F40      MOV	R20,R16
    0329F 9722      SBIW	R28,2
(0256) 	}//end while
(0257) }//end function
(0258) void _GUI_datashow(char page){
(0259) 	if(page == 0){
    032A0 2344      TST	R20
    032A1 F539      BNE	0x32C9
(0260)  	//显示日期时间
(0261) 	    LCD_var_disp(1,1,GUI_get_date());
    032A2 D205      RCALL	_GUI_get_date
    032A3 8319      STD	Y+1,R17
    032A4 8308      ST	Y,R16
    032A5 E021      LDI	R18,1
    032A6 E001      LDI	R16,1
    032A7 940E 3C69 CALL	_LCD_var_disp
(0262) 	//显示温度
(0263) 	 	LCD_const_disp(2,1,"温度 (℃):      ");
    032A9 EE8B      LDI	R24,0xEB
    032AA E094      LDI	R25,4
    032AB 8399      STD	Y+1,R25
    032AC 8388      ST	Y,R24
    032AD E021      LDI	R18,1
    032AE E002      LDI	R16,2
    032AF 940E 3C3C CALL	_LCD_const_disp
(0264) 	 	LCD_var_disp(2,6,Result.TempChar);
    032B1 E180      LDI	R24,0x10
    032B2 E096      LDI	R25,6
    032B3 8399      STD	Y+1,R25
    032B4 8388      ST	Y,R24
    032B5 E026      LDI	R18,6
    032B6 E002      LDI	R16,2
    032B7 940E 3C69 CALL	_LCD_var_disp
(0265) 	//显示风速
(0266) 	    LCD_const_disp(3,1,"风速(m/s):      ");
    032B9 ED8A      LDI	R24,0xDA
    032BA E094      LDI	R25,4
    032BB 8399      STD	Y+1,R25
    032BC 8388      ST	Y,R24
    032BD E021      LDI	R18,1
    032BE E003      LDI	R16,3
    032BF 940E 3C3C CALL	_LCD_const_disp
(0267) 	 	LCD_const_disp(3,6,Result.WSChar);
    032C1 E18A      LDI	R24,0x1A
    032C2 E096      LDI	R25,6
    032C3 8399      STD	Y+1,R25
    032C4 8388      ST	Y,R24
    032C5 E026      LDI	R18,6
    032C6 E003      LDI	R16,3
    032C7 940E 3C3C CALL	_LCD_const_disp
(0268) 
(0269) 	 } 
(0270) 	 if(page == 1){
    032C9 3041      CPI	R20,1
    032CA F5B9      BNE	0x3302
(0271) 	     LCD_var_disp(1,1,GUI_get_date());
    032CB D1DC      RCALL	_GUI_get_date
    032CC 8319      STD	Y+1,R17
    032CD 8308      ST	Y,R16
    032CE E021      LDI	R18,1
    032CF E001      LDI	R16,1
    032D0 940E 3C69 CALL	_LCD_var_disp
(0272) 		 LCD_const_disp(2,1,"风冷指数: ");
    032D2 EC8F      LDI	R24,0xCF
    032D3 E094      LDI	R25,4
    032D4 8399      STD	Y+1,R25
    032D5 8388      ST	Y,R24
    032D6 E021      LDI	R18,1
    032D7 E002      LDI	R16,2
    032D8 940E 3C3C CALL	_LCD_const_disp
(0273) 		 LCD_var_disp(2,6,Result.WCIChar);						
    032DA E283      LDI	R24,0x23
    032DB E096      LDI	R25,6
    032DC 8399      STD	Y+1,R25
    032DD 8388      ST	Y,R24
    032DE E026      LDI	R18,6
    032DF E002      LDI	R16,2
    032E0 940E 3C69 CALL	_LCD_var_disp
(0274) 		 LCD_const_disp(3,1,"等价温度: ");
    032E2 EC84      LDI	R24,0xC4
    032E3 E094      LDI	R25,4
    032E4 8399      STD	Y+1,R25
    032E5 8388      ST	Y,R24
    032E6 E021      LDI	R18,1
    032E7 E003      LDI	R16,3
    032E8 940E 3C3C CALL	_LCD_const_disp
(0275) 		 LCD_var_disp(3,6,Result.ECTChar);	 
    032EA E28D      LDI	R24,0x2D
    032EB E096      LDI	R25,6
    032EC 8399      STD	Y+1,R25
    032ED 8388      ST	Y,R24
    032EE E026      LDI	R18,6
    032EF E003      LDI	R16,3
    032F0 940E 3C69 CALL	_LCD_var_disp
(0276) 		 LCD_const_disp(4,1,"相当温度: ");
    032F2 EB89      LDI	R24,0xB9
    032F3 E094      LDI	R25,4
    032F4 8399      STD	Y+1,R25
    032F5 8388      ST	Y,R24
    032F6 E021      LDI	R18,1
    032F7 E004      LDI	R16,4
    032F8 940E 3C3C CALL	_LCD_const_disp
(0277) 		 LCD_var_disp(4,6,Result.TeqChar);	
    032FA E387      LDI	R24,0x37
    032FB E096      LDI	R25,6
    032FC 8399      STD	Y+1,R25
    032FD 8388      ST	Y,R24
    032FE E026      LDI	R18,6
    032FF E004      LDI	R16,4
    03300 940E 3C69 CALL	_LCD_var_disp
(0278) 	 }
(0279) 	 if(page == 2){
    03302 3042      CPI	R20,2
    03303 F009      BEQ	0x3305
    03304 C03F      RJMP	0x3344
(0280) 	     LCD_var_disp(1,1,GUI_get_date());
    03305 D1A2      RCALL	_GUI_get_date
    03306 0158      MOVW	R10,R16
    03307 82B9      STD	Y+1,R11
    03308 82A8      ST	Y,R10
    03309 E021      LDI	R18,1
    0330A E001      LDI	R16,1
    0330B 940E 3C69 CALL	_LCD_var_disp
(0281) 		 LCD_const_disp(2,1,"冻伤危害性:");
    0330D EA8D      LDI	R24,0xAD
    0330E E094      LDI	R25,4
    0330F 8399      STD	Y+1,R25
    03310 8388      ST	Y,R24
    03311 E021      LDI	R18,1
    03312 E002      LDI	R16,2
    03313 940E 3C3C CALL	_LCD_const_disp
(0282) 	 if(Result.WeiHai==0){LCD_const_disp(3,1,"  冻伤危害性小");			 }
    03315 9020 063D LDS	R2,Result+90
    03317 2022      TST	R2
    03318 F449      BNE	0x3322
    03319 E98E      LDI	R24,0x9E
    0331A E094      LDI	R25,4
    0331B 8399      STD	Y+1,R25
    0331C 8388      ST	Y,R24
    0331D E021      LDI	R18,1
    0331E E003      LDI	R16,3
    0331F 940E 3C3C CALL	_LCD_const_disp
    03321 C022      RJMP	0x3344
(0283) 	 else if(Result.WeiHai==1){	LCD_const_disp(3,1,"  冻伤危害性较大");	 }
    03322 9180 063D LDS	R24,Result+90
    03324 3081      CPI	R24,1
    03325 F449      BNE	0x332F
    03326 E88D      LDI	R24,0x8D
    03327 E094      LDI	R25,4
    03328 8399      STD	Y+1,R25
    03329 8388      ST	Y,R24
    0332A E021      LDI	R18,1
    0332B E003      LDI	R16,3
    0332C 940E 3C3C CALL	_LCD_const_disp
    0332E C015      RJMP	0x3344
(0284) 	 else if(Result.WeiHai==2){	LCD_const_disp(3,1,"  冻伤危害性很大");	 }
    0332F 9180 063D LDS	R24,Result+90
    03331 3082      CPI	R24,2
    03332 F449      BNE	0x333C
    03333 E78C      LDI	R24,0x7C
    03334 E094      LDI	R25,4
    03335 8399      STD	Y+1,R25
    03336 8388      ST	Y,R24
    03337 E021      LDI	R18,1
    03338 E003      LDI	R16,3
    03339 940E 3C3C CALL	_LCD_const_disp
    0333B C008      RJMP	0x3344
(0285) 	 else LCD_const_disp(3,1,"冻伤危害性小。");
    0333C E68D      LDI	R24,0x6D
    0333D E094      LDI	R25,4
    0333E 8399      STD	Y+1,R25
    0333F 8388      ST	Y,R24
    03340 E021      LDI	R18,1
    03341 E003      LDI	R16,3
    03342 940E 3C3C CALL	_LCD_const_disp
(0286) 	 }	  
(0287) 	 if(page==3){
    03344 3043      CPI	R20,3
    03345 F009      BEQ	0x3347
    03346 C061      RJMP	0x33A8
(0288) 	     LCD_const_disp(1,1,labelH);		
    03347 E889      LDI	R24,0x89
    03348 E092      LDI	R25,2
    03349 8399      STD	Y+1,R25
    0334A 8388      ST	Y,R24
    0334B E021      LDI	R18,1
    0334C E001      LDI	R16,1
    0334D 940E 3C3C CALL	_LCD_const_disp
(0289) 	 	 switch( Result.WeiHai ){
    0334F 9160 063D LDS	R22,Result+90
    03351 2777      CLR	R23
    03352 3060      CPI	R22,0
    03353 0767      CPC	R22,R23
    03354 F049      BEQ	0x335E
    03355 3061      CPI	R22,1
    03356 E0E0      LDI	R30,0
    03357 077E      CPC	R23,R30
    03358 F0F1      BEQ	0x3377
    03359 3062      CPI	R22,2
    0335A E0E0      LDI	R30,0
    0335B 077E      CPC	R23,R30
    0335C F199      BEQ	0x3390
    0335D C04A      RJMP	0x33A8
(0290) 			case 0 :
(0291) 			LCD_const_disp(2,1,H01);
    0335E EB85      LDI	R24,0xB5
    0335F E092      LDI	R25,2
    03360 8399      STD	Y+1,R25
    03361 8388      ST	Y,R24
    03362 E021      LDI	R18,1
    03363 E002      LDI	R16,2
    03364 940E 3C3C CALL	_LCD_const_disp
(0292) 			LCD_const_disp(3,1,H02);
    03366 EC85      LDI	R24,0xC5
    03367 E092      LDI	R25,2
    03368 8399      STD	Y+1,R25
    03369 8388      ST	Y,R24
    0336A E021      LDI	R18,1
    0336B E003      LDI	R16,3
    0336C 940E 3C3C CALL	_LCD_const_disp
(0293) 			LCD_const_disp(4,1,H03);
    0336E ED80      LDI	R24,0xD0
    0336F E092      LDI	R25,2
    03370 8399      STD	Y+1,R25
    03371 8388      ST	Y,R24
    03372 E021      LDI	R18,1
    03373 E004      LDI	R16,4
    03374 940E 3C3C CALL	_LCD_const_disp
(0294) 			break;
    03376 C031      RJMP	0x33A8
(0295) 			case 1 : 
(0296) 			LCD_const_disp(2,1,H11);
    03377 EE8C      LDI	R24,0xEC
    03378 E092      LDI	R25,2
    03379 8399      STD	Y+1,R25
    0337A 8388      ST	Y,R24
    0337B E021      LDI	R18,1
    0337C E002      LDI	R16,2
    0337D 940E 3C3C CALL	_LCD_const_disp
(0297) 			LCD_const_disp(3,1,H12);
    0337F ED80      LDI	R24,0xD0
    03380 E092      LDI	R25,2
    03381 8399      STD	Y+1,R25
    03382 8388      ST	Y,R24
    03383 E021      LDI	R18,1
    03384 E003      LDI	R16,3
    03385 940E 3C3C CALL	_LCD_const_disp
(0298) 			LCD_const_disp(4,1,H13);
    03387 E085      LDI	R24,5
    03388 E093      LDI	R25,3
    03389 8399      STD	Y+1,R25
    0338A 8388      ST	Y,R24
    0338B E021      LDI	R18,1
    0338C E004      LDI	R16,4
    0338D 940E 3C3C CALL	_LCD_const_disp
(0299) 			break ;	
    0338F C018      RJMP	0x33A8
(0300) 			case 2 :
(0301) 			LCD_const_disp(2,1,H21);
    03390 E389      LDI	R24,0x39
    03391 E093      LDI	R25,3
    03392 8399      STD	Y+1,R25
    03393 8388      ST	Y,R24
    03394 E021      LDI	R18,1
    03395 E002      LDI	R16,2
    03396 940E 3C3C CALL	_LCD_const_disp
(0302) 			LCD_const_disp(3,1,H22);
    03398 E48B      LDI	R24,0x4B
    03399 E093      LDI	R25,3
    0339A 8399      STD	Y+1,R25
    0339B 8388      ST	Y,R24
    0339C E021      LDI	R18,1
    0339D E003      LDI	R16,3
    0339E 940E 3C3C CALL	_LCD_const_disp
(0303) 			LCD_const_disp(4,1,H23);
    033A0 ED80      LDI	R24,0xD0
    033A1 E092      LDI	R25,2
    033A2 8399      STD	Y+1,R25
    033A3 8388      ST	Y,R24
    033A4 E021      LDI	R18,1
    033A5 E004      LDI	R16,4
    033A6 940E 3C3C CALL	_LCD_const_disp
(0304) 			break;
(0305) 			default : ;
(0306) 		}
(0307) 	 } 
(0308) 	 if(page==4){
    033A8 3044      CPI	R20,4
    033A9 F009      BEQ	0x33AB
    033AA C086      RJMP	0x3431
(0309) 	 		LCD_const_disp(1,1,labelM);		
    033AB E987      LDI	R24,0x97
    033AC E092      LDI	R25,2
    033AD 8399      STD	Y+1,R25
    033AE 8388      ST	Y,R24
    033AF E021      LDI	R18,1
    033B0 E001      LDI	R16,1
    033B1 940E 3C3C CALL	_LCD_const_disp
(0310) 	 		switch( Result.WeiHai ){
    033B3 9160 063D LDS	R22,Result+90
    033B5 2777      CLR	R23
    033B6 3060      CPI	R22,0
    033B7 0767      CPC	R22,R23
    033B8 F059      BEQ	0x33C4
    033B9 3061      CPI	R22,1
    033BA E0E0      LDI	R30,0
    033BB 077E      CPC	R23,R30
    033BC F409      BNE	0x33BE
    033BD C052      RJMP	0x3410
    033BE 3062      CPI	R22,2
    033BF E0E0      LDI	R30,0
    033C0 077E      CPC	R23,R30
    033C1 F409      BNE	0x33C3
    033C2 C066      RJMP	0x3429
    033C3 C06D      RJMP	0x3431
(0311) 	 			case 0 :
(0312) 				LCD_const_disp(2,1,M01);
    033C4 EB85      LDI	R24,0xB5
    033C5 E092      LDI	R25,2
    033C6 8399      STD	Y+1,R25
    033C7 8388      ST	Y,R24
    033C8 E021      LDI	R18,1
    033C9 E002      LDI	R16,2
    033CA 940E 3C3C CALL	_LCD_const_disp
(0313) 				LCD_const_disp(3,1,M02);
    033CC ED80      LDI	R24,0xD0
    033CD E092      LDI	R25,2
    033CE 8399      STD	Y+1,R25
    033CF 8388      ST	Y,R24
    033D0 E021      LDI	R18,1
    033D1 E003      LDI	R16,3
    033D2 940E 3C3C CALL	_LCD_const_disp
(0314) 				if(Result.Temperature < 17.7){
    033D4 9040 060E LDS	R4,Result+43
    033D6 9050 060F LDS	R5,Result+44
    033D8 9020 060C LDS	R2,Result+41
    033DA 9030 060D LDS	R3,Result+42
    033DC EC0A      LDI	R16,0xCA
    033DD E010      LDI	R17,0
    033DE 940E 47CD CALL	elpm32
    033E0 933A      ST	-Y,R19
    033E1 932A      ST	-Y,R18
    033E2 931A      ST	-Y,R17
    033E3 930A      ST	-Y,R16
    033E4 0181      MOVW	R16,R2
    033E5 0192      MOVW	R18,R4
    033E6 940E 4B93 CALL	fpcmp2
    033E8 F44C      BGE	0x33F2
(0315) 				    LCD_const_disp(4,1,"戴面罩；禁油彩。");
    033E9 E58C      LDI	R24,0x5C
    033EA E094      LDI	R25,4
    033EB 8399      STD	Y+1,R25
    033EC 8388      ST	Y,R24
    033ED E021      LDI	R18,1
    033EE E004      LDI	R16,4
    033EF 940E 3C3C CALL	_LCD_const_disp
(0316) 				}
    033F1 C03F      RJMP	0x3431
(0317) 				else if(Result.Temperature < 12){
    033F2 9040 060E LDS	R4,Result+43
    033F4 9050 060F LDS	R5,Result+44
    033F6 9020 060C LDS	R2,Result+41
    033F8 9030 060D LDS	R3,Result+42
    033FA EC06      LDI	R16,0xC6
    033FB E010      LDI	R17,0
    033FC 940E 47CD CALL	elpm32
    033FE 933A      ST	-Y,R19
    033FF 932A      ST	-Y,R18
    03400 931A      ST	-Y,R17
    03401 930A      ST	-Y,R16
    03402 0181      MOVW	R16,R2
    03403 0192      MOVW	R18,R4
    03404 940E 4B93 CALL	fpcmp2
    03406 F554      BGE	0x3431
(0318) 				    LCD_const_disp(4,1,"禁油彩。        \0");
    03407 E48A      LDI	R24,0x4A
    03408 E094      LDI	R25,4
    03409 8399      STD	Y+1,R25
    0340A 8388      ST	Y,R24
    0340B E021      LDI	R18,1
    0340C E004      LDI	R16,4
    0340D 940E 3C3C CALL	_LCD_const_disp
(0319) 				}
(0320) 				break;
    0340F C021      RJMP	0x3431
(0321) 				case 1 : 
(0322) 			    LCD_const_disp(2,1,M11);
    03410 EB85      LDI	R24,0xB5
    03411 E092      LDI	R25,2
    03412 8399      STD	Y+1,R25
    03413 8388      ST	Y,R24
    03414 E021      LDI	R18,1
    03415 E002      LDI	R16,2
    03416 940E 3C3C CALL	_LCD_const_disp
(0323) 				LCD_const_disp(3,1,M12);
    03418 E185      LDI	R24,0x15
    03419 E093      LDI	R25,3
    0341A 8399      STD	Y+1,R25
    0341B 8388      ST	Y,R24
    0341C E021      LDI	R18,1
    0341D E003      LDI	R16,3
    0341E 940E 3C3C CALL	_LCD_const_disp
(0324) 				LCD_const_disp(4,1,M13);
    03420 E287      LDI	R24,0x27
    03421 E093      LDI	R25,3
    03422 8399      STD	Y+1,R25
    03423 8388      ST	Y,R24
    03424 E021      LDI	R18,1
    03425 E004      LDI	R16,4
    03426 940E 3C3C CALL	_LCD_const_disp
(0325) 				break ;
    03428 C008      RJMP	0x3431
(0326) 				case 2 :
(0327) 				LCD_const_disp(2,1,M21);
    03429 E58D      LDI	R24,0x5D
    0342A E093      LDI	R25,3
    0342B 8399      STD	Y+1,R25
    0342C 8388      ST	Y,R24
    0342D E021      LDI	R18,1
    0342E E002      LDI	R16,2
    0342F 940E 3C3C CALL	_LCD_const_disp
(0328) 				break ;
(0329) 				default :;
(0330) 	 		}
(0331) 	 }
(0332) 	 if(page==5){
    03431 3045      CPI	R20,5
    03432 F009      BEQ	0x3434
    03433 C071      RJMP	0x34A5
(0333) 	     LCD_const_disp(1,1,labelL);		
    03434 EA87      LDI	R24,0xA7
    03435 E092      LDI	R25,2
    03436 8399      STD	Y+1,R25
    03437 8388      ST	Y,R24
    03438 E021      LDI	R18,1
    03439 E001      LDI	R16,1
    0343A 940E 3C3C CALL	_LCD_const_disp
(0334) 	 	 switch( Result.WeiHai ){	
    0343C 9140 063D LDS	R20,Result+90
    0343E 2755      CLR	R21
    0343F 3040      CPI	R20,0
    03440 0745      CPC	R20,R21
    03441 F059      BEQ	0x344D
    03442 3041      CPI	R20,1
    03443 E0E0      LDI	R30,0
    03444 075E      CPC	R21,R30
    03445 F409      BNE	0x3447
    03446 C03D      RJMP	0x3484
    03447 3042      CPI	R20,2
    03448 E0E0      LDI	R30,0
    03449 075E      CPC	R21,R30
    0344A F409      BNE	0x344C
    0344B C051      RJMP	0x349D
    0344C C058      RJMP	0x34A5
(0335) 		     case 0 :
(0336) 			 LCD_const_disp(2,1,L01);
    0344D EE82      LDI	R24,0xE2
    0344E E092      LDI	R25,2
    0344F 8399      STD	Y+1,R25
    03450 8388      ST	Y,R24
    03451 E021      LDI	R18,1
    03452 E002      LDI	R16,2
    03453 940E 3C3C CALL	_LCD_const_disp
(0337) 			 if(Result.Temperature < -12) {
    03455 9040 060E LDS	R4,Result+43
    03457 9050 060F LDS	R5,Result+44
    03459 9020 060C LDS	R2,Result+41
    0345B 9030 060D LDS	R3,Result+42
    0345D EC02      LDI	R16,0xC2
    0345E E010      LDI	R17,0
    0345F 940E 47CD CALL	elpm32
    03461 933A      ST	-Y,R19
    03462 932A      ST	-Y,R18
    03463 931A      ST	-Y,R17
    03464 930A      ST	-Y,R16
    03465 0181      MOVW	R16,R2
    03466 0192      MOVW	R18,R4
    03467 940E 4B93 CALL	fpcmp2
    03469 F48C      BGE	0x347B
(0338) 			 LCD_const_disp(3,1,L02);
    0346A EE8C      LDI	R24,0xEC
    0346B E092      LDI	R25,2
    0346C 8399      STD	Y+1,R25
    0346D 8388      ST	Y,R24
    0346E E021      LDI	R18,1
    0346F E003      LDI	R16,3
    03470 940E 3C3C CALL	_LCD_const_disp
(0339) 			 LCD_const_disp(4,1,L03);
    03472 EF86      LDI	R24,0xF6
    03473 E092      LDI	R25,2
    03474 8399      STD	Y+1,R25
    03475 8388      ST	Y,R24
    03476 E021      LDI	R18,1
    03477 E004      LDI	R16,4
    03478 940E 3C3C CALL	_LCD_const_disp
(0340) 			 } 
    0347A C02A      RJMP	0x34A5
(0341) 			 else {
(0342) 			 LCD_const_disp(3,1,L03);
    0347B EF86      LDI	R24,0xF6
    0347C E092      LDI	R25,2
    0347D 8399      STD	Y+1,R25
    0347E 8388      ST	Y,R24
    0347F E021      LDI	R18,1
    03480 E003      LDI	R16,3
    03481 940E 3C3C CALL	_LCD_const_disp
(0343) 			 }
(0344) 			 break;
    03483 C021      RJMP	0x34A5
(0345) 			 case 1: 
(0346) 			 LCD_const_disp(2,1,L11);
    03484 E389      LDI	R24,0x39
    03485 E093      LDI	R25,3
    03486 8399      STD	Y+1,R25
    03487 8388      ST	Y,R24
    03488 E021      LDI	R18,1
    03489 E002      LDI	R16,2
    0348A 940E 3C3C CALL	_LCD_const_disp
(0347) 			 LCD_const_disp(3,1,L12);
    0348C E48B      LDI	R24,0x4B
    0348D E093      LDI	R25,3
    0348E 8399      STD	Y+1,R25
    0348F 8388      ST	Y,R24
    03490 E021      LDI	R18,1
    03491 E003      LDI	R16,3
    03492 940E 3C3C CALL	_LCD_const_disp
(0348) 			 LCD_const_disp(3,1,L13);
    03494 ED80      LDI	R24,0xD0
    03495 E092      LDI	R25,2
    03496 8399      STD	Y+1,R25
    03497 8388      ST	Y,R24
    03498 E021      LDI	R18,1
    03499 E003      LDI	R16,3
    0349A 940E 3C3C CALL	_LCD_const_disp
(0349) 			 break ;
    0349C C008      RJMP	0x34A5
(0350) 			 case 2 :
(0351) 			 LCD_const_disp(2,1,L21);
    0349D E58D      LDI	R24,0x5D
    0349E E093      LDI	R25,3
    0349F 8399      STD	Y+1,R25
    034A0 8388      ST	Y,R24
    034A1 E021      LDI	R18,1
    034A2 E002      LDI	R16,2
    034A3 940E 3C3C CALL	_LCD_const_disp
(0352) 			 break;
(0353) 			 default : ;
(0354) 		} //end switch
(0355) 	}  //end if
    034A5 9622      ADIW	R28,2
    034A6 940C 486B JMP	pop_xgsetF00C
(0356) }
(0357) char * GUI_get_date(void) {  
(0358)   //格式:12月11日19:00:00
(0359)     GUI_date[0]=Result.Date[4]; 
_GUI_get_date:
    034A8 9020 05FD LDS	R2,Result+26
    034AA 9220 036C STS	GUI_date,R2
(0360)     GUI_date[1]=Result.Date[5];
    034AC 9020 05FE LDS	R2,Result+27
    034AE 9220 036D STS	GUI_date+1,R2
(0361)     GUI_date[4]=Result.Date[6];
    034B0 9020 05FF LDS	R2,Result+28
    034B2 9220 0370 STS	GUI_date+4,R2
(0362)     GUI_date[5]=Result.Date[7];
    034B4 9020 0600 LDS	R2,Result+29
    034B6 9220 0371 STS	GUI_date+5,R2
(0363)     GUI_date[8]=Result.Time[0];
    034B8 9020 0602 LDS	R2,Result+31
    034BA 9220 0374 STS	GUI_date+8,R2
(0364)     GUI_date[9]=Result.Time[1];
    034BC 9020 0603 LDS	R2,Result+32
    034BE 9220 0375 STS	GUI_date+9,R2
(0365)     GUI_date[11]=Result.Time[3];
    034C0 9020 0605 LDS	R2,Result+34
    034C2 9220 0377 STS	GUI_date+11,R2
(0366)     GUI_date[12]=Result.Time[4];
    034C4 9020 0606 LDS	R2,Result+35
    034C6 9220 0378 STS	GUI_date+12,R2
(0367)     GUI_date[14]=Result.Time[6];
    034C8 9020 0608 LDS	R2,Result+37
    034CA 9220 037A STS	GUI_date+14,R2
(0368)     GUI_date[15]=Result.Time[7];
    034CC 9020 0609 LDS	R2,Result+38
    034CE 9220 037B STS	GUI_date+15,R2
(0369)     GUI_date[16]='\0';
    034D0 2422      CLR	R2
    034D1 9220 037C STS	GUI_date+16,R2
(0370)     return GUI_date;
    034D3 E60C      LDI	R16,0x6C
    034D4 E013      LDI	R17,3
    034D5 9508      RET
_GUI_set_time:
  GUI_down             --> Y,+5
  GUI_up               --> Y,+2
  ary                  --> R12
  p                    --> Y,+10
  i                    --> R14
  keyc                 --> R20
  pT                   --> R10
  pD                   --> Y,+8
    034D6 940E 4845 CALL	push_xgsetF0FC
    034D8 972B      SBIW	R28,0xB
(0371) }
(0372) //设置时间 菜单 
(0373) void GUI_set_time(void){
(0374)     unsigned char p=2;
    034D9 E082      LDI	R24,2
    034DA 878A      STD	Y+10,R24
(0375) 	char GUI_up[]= "↑";
    034DB E78D      LDI	R24,0x7D
    034DC E093      LDI	R25,3
    034DD 01FE      MOVW	R30,R28
    034DE 9632      ADIW	R30,2
    034DF E003      LDI	R16,3
    034E0 E010      LDI	R17,0
    034E1 93FA      ST	-Y,R31
    034E2 93EA      ST	-Y,R30
    034E3 939A      ST	-Y,R25
    034E4 938A      ST	-Y,R24
    034E5 940E 48F5 CALL	asgnblk
(0376) 	char GUI_down[]= "↓";
    034E7 E880      LDI	R24,0x80
    034E8 E093      LDI	R25,3
    034E9 01FE      MOVW	R30,R28
    034EA 9635      ADIW	R30,5
    034EB E003      LDI	R16,3
    034EC E010      LDI	R17,0
    034ED 93FA      ST	-Y,R31
    034EE 93EA      ST	-Y,R30
    034EF 939A      ST	-Y,R25
    034F0 938A      ST	-Y,R24
    034F1 940E 48F5 CALL	asgnblk
(0377) 	char *pD=NULL,*pT=NULL;
    034F3 2400      CLR	R0
    034F4 2411      CLR	R1
    034F5 8619      STD	Y+9,R1
    034F6 8608      STD	Y+8,R0
(0378) 	char *ary=GUI_up;
    034F7 01CE      MOVW	R24,R28
    034F8 9602      ADIW	R24,2
    034F9 016C      MOVW	R12,R24
(0379) 	unsigned char i=0,keyc=NO_KEY;
    034FA 24EE      CLR	R14
    034FB 2744      CLR	R20
(0380) 	LCD_CLR(); //清屏
    034FC 940E 3CE2 CALL	_LCD_CLR
(0381) 	pD="2012年12月31日\0";
    034FE E38A      LDI	R24,0x3A
    034FF E094      LDI	R25,4
    03500 8799      STD	Y+9,R25
    03501 8788      STD	Y+8,R24
(0382) 	pT="12: 30: 59\0";
    03502 E28E      LDI	R24,0x2E
    03503 E094      LDI	R25,4
    03504 015C      MOVW	R10,R24
(0383) 	LCD_const_disp(1,1,"时间设置:       ");
    03505 E18D      LDI	R24,0x1D
    03506 E094      LDI	R25,4
    03507 8399      STD	Y+1,R25
    03508 8388      ST	Y,R24
    03509 E021      LDI	R18,1
    0350A E001      LDI	R16,1
    0350B 940E 3C3C CALL	_LCD_const_disp
(0384) 	LCD_const_disp(4,7,"保存");
    0350D E188      LDI	R24,0x18
    0350E E094      LDI	R25,4
    0350F 8399      STD	Y+1,R25
    03510 8388      ST	Y,R24
    03511 E027      LDI	R18,7
    03512 E004      LDI	R16,4
    03513 940E 3C3C CALL	_LCD_const_disp
(0385) 	LCD_var_disp(3,p,ary);
    03515 82D9      STD	Y+1,R13
    03516 82C8      ST	Y,R12
    03517 852A      LDD	R18,Y+10
    03518 E003      LDI	R16,3
    03519 940E 3C69 CALL	_LCD_var_disp
(0386) 	LCD_var_disp(2,1,pD);
    0351B 8408      LDD	R0,Y+8
    0351C 8419      LDD	R1,Y+9
    0351D 8219      STD	Y+1,R1
    0351E 8208      ST	Y,R0
    0351F E021      LDI	R18,1
    03520 E002      LDI	R16,2
    03521 940E 3C69 CALL	_LCD_var_disp
(0387) 	LCD_var_disp(4,1,pT);
    03523 82B9      STD	Y+1,R11
    03524 82A8      ST	Y,R10
    03525 E021      LDI	R18,1
    03526 E004      LDI	R16,4
    03527 940E 3C69 CALL	_LCD_var_disp
(0388) 	delayms(250);
    03529 EF0A      LDI	R16,0xFA
    0352A E010      LDI	R17,0
    0352B 940E 2511 CALL	_delayms
    0352D C1F5      RJMP	0x3723
(0389) 	while(1){
(0390) 	    keyc=kbscan();
    0352E 940E 4226 CALL	_kbscan
    03530 2F40      MOV	R20,R16
(0391) 		pD[2]=Result.Date[2];
    03531 9020 05FB LDS	R2,Result+24
    03533 85E8      LDD	R30,Y+8
    03534 85F9      LDD	R31,Y+9
    03535 8222      STD	Z+2,R2
(0392) 		pD[3]=Result.Date[3];
    03536 9020 05FC LDS	R2,Result+25
    03538 8223      STD	Z+3,R2
(0393) 		pD[6]=Result.Date[4];
    03539 9020 05FD LDS	R2,Result+26
    0353B 8226      STD	Z+6,R2
(0394) 		pD[7]=Result.Date[5];
    0353C 9020 05FE LDS	R2,Result+27
    0353E 8227      STD	Z+7,R2
(0395) 		pD[10]=Result.Date[6];
    0353F 9020 05FF LDS	R2,Result+28
    03541 8622      STD	Z+10,R2
(0396) 		pD[11]=Result.Date[7];  
    03542 9020 0600 LDS	R2,Result+29
    03544 8623      STD	Z+11,R2
(0397) 		pT[0] = Result.Time[0];
    03545 9020 0602 LDS	R2,Result+31
    03547 01F5      MOVW	R30,R10
    03548 8220      ST	Z,R2
(0398) 		pT[1] = Result.Time[1];
    03549 9020 0603 LDS	R2,Result+32
    0354B 8221      STD	Z+1,R2
(0399) 		pT[4] = Result.Time[3];
    0354C 9020 0605 LDS	R2,Result+34
    0354E 8224      STD	Z+4,R2
(0400) 		pT[5] = Result.Time[4];
    0354F 9020 0606 LDS	R2,Result+35
    03551 8225      STD	Z+5,R2
(0401) 		pT[8] = Result.Time[6];
    03552 9020 0608 LDS	R2,Result+37
    03554 8620      STD	Z+8,R2
(0402) 		pT[9] = Result.Time[7];
    03555 9020 0609 LDS	R2,Result+38
    03557 8621      STD	Z+9,R2
(0403) 		
(0404) 		switch(i){
    03558 2D6E      MOV	R22,R14
    03559 2777      CLR	R23
    0355A 3060      CPI	R22,0
    0355B 0767      CPC	R22,R23
    0355C F0D1      BEQ	0x3577
    0355D 3061      CPI	R22,1
    0355E E0E0      LDI	R30,0
    0355F 077E      CPC	R23,R30
    03560 F409      BNE	0x3562
    03561 C04A      RJMP	0x35AC
    03562 3062      CPI	R22,2
    03563 E0E0      LDI	R30,0
    03564 077E      CPC	R23,R30
    03565 F409      BNE	0x3567
    03566 C07C      RJMP	0x35E3
    03567 3063      CPI	R22,3
    03568 E0E0      LDI	R30,0
    03569 077E      CPC	R23,R30
    0356A F409      BNE	0x356C
    0356B C0BE      RJMP	0x362A
    0356C 3064      CPI	R22,4
    0356D E0E0      LDI	R30,0
    0356E 077E      CPC	R23,R30
    0356F F409      BNE	0x3571
    03570 C0F1      RJMP	0x3662
    03571 3065      CPI	R22,5
    03572 E0E0      LDI	R30,0
    03573 077E      CPC	R23,R30
    03574 F409      BNE	0x3576
    03575 C123      RJMP	0x3699
    03576 C15C      RJMP	0x36D3
(0405)             case 0: p=2;ary=GUI_up;  //年
    03577 E082      LDI	R24,2
    03578 878A      STD	Y+10,R24
    03579 01CE      MOVW	R24,R28
    0357A 9602      ADIW	R24,2
    0357B 016C      MOVW	R12,R24
(0406) 		 	  	 if(keyc==up){
    0357C 314E      CPI	R20,0x1E
    0357D F491      BNE	0x3590
(0407) 				     if(time_buf[1]<0x99){ 
    0357E 9180 0586 LDS	R24,time_buf+1
    03580 3989      CPI	R24,0x99
    03581 F008      BCS	0x3583
    03582 C150      RJMP	0x36D3
(0408) 					     time_buf[1]++;
    03583 5F8F      SUBI	R24,0xFF
    03584 9380 0586 STS	time_buf+1,R24
(0409) 						 if((time_buf[1]&0x0f)==0x0a) 
    03586 708F      ANDI	R24,0xF
    03587 308A      CPI	R24,0xA
    03588 F009      BEQ	0x358A
    03589 C149      RJMP	0x36D3
(0410) 						     time_buf[1]=time_buf[1]+6;
    0358A 9180 0586 LDS	R24,time_buf+1
    0358C 5F8A      SUBI	R24,0xFA
    0358D 9380 0586 STS	time_buf+1,R24
(0411) 					 }
(0412) 												     
(0413) 				}				  
    0358F C143      RJMP	0x36D3
(0414)  					        
(0415) 			    else if(keyc==down){ 
    03590 314D      CPI	R20,0x1D
    03591 F4A1      BNE	0x35A6
(0416) 				    if(time_buf[1]>0x00){
    03592 E080      LDI	R24,0
    03593 9020 0586 LDS	R2,time_buf+1
    03595 1582      CP	R24,R2
    03596 F008      BCS	0x3598
    03597 C13B      RJMP	0x36D3
(0417) 				        time_buf[1]--;
    03598 2D82      MOV	R24,R2
    03599 5081      SUBI	R24,1
    0359A 9380 0586 STS	time_buf+1,R24
(0418) 						if((time_buf[1]&0x0f)==0x0f) 
    0359C 708F      ANDI	R24,0xF
    0359D 308F      CPI	R24,0xF
    0359E F009      BEQ	0x35A0
    0359F C133      RJMP	0x36D3
(0419) 						    time_buf[1]=time_buf[1]-6;
    035A0 9180 0586 LDS	R24,time_buf+1
    035A2 5086      SUBI	R24,6
    035A3 9380 0586 STS	time_buf+1,R24
(0420) 		 	  	 		 }
(0421) 												   
(0422) 					}			   		
    035A5 C12D      RJMP	0x36D3
(0423) 				else if(keyc==left) {i=1;}
    035A6 314B      CPI	R20,0x1B
    035A7 F009      BEQ	0x35A9
    035A8 C12A      RJMP	0x36D3
    035A9 24EE      CLR	R14
    035AA 94E3      INC	R14
(0424) 				break;
    035AB C127      RJMP	0x36D3
(0425) 		 case 1:p=4;ary=GUI_up;  //月
    035AC E084      LDI	R24,4
    035AD 878A      STD	Y+10,R24
    035AE 01CE      MOVW	R24,R28
    035AF 9602      ADIW	R24,2
    035B0 016C      MOVW	R12,R24
(0426) 		  	  	if(keyc==up){
    035B1 314E      CPI	R20,0x1E
    035B2 F499      BNE	0x35C6
(0427) 				    if(time_buf[2]<0x12){  
    035B3 9180 0587 LDS	R24,time_buf+2
    035B5 3182      CPI	R24,0x12
    035B6 F460      BCC	0x35C3
(0428) 					    time_buf[2]++;	
    035B7 5F8F      SUBI	R24,0xFF
    035B8 9380 0587 STS	time_buf+2,R24
(0429) 						if((time_buf[2]&0x0f)==0x0a) time_buf[2]+=6;
    035BA 708F      ANDI	R24,0xF
    035BB 308A      CPI	R24,0xA
    035BC F449      BNE	0x35C6
    035BD 9180 0587 LDS	R24,time_buf+2
    035BF 5F8A      SUBI	R24,0xFA
    035C0 9380 0587 STS	time_buf+2,R24
(0430) 					}
    035C2 C003      RJMP	0x35C6
(0431) 					else 
(0432) 					    time_buf[2]=0x01;
    035C3 E081      LDI	R24,1
    035C4 9380 0587 STS	time_buf+2,R24
(0433) 				}						 
(0434) 				if(keyc==down){ 
    035C6 314D      CPI	R20,0x1D
    035C7 F4A9      BNE	0x35DD
(0435) 				    if(time_buf[2]>0x01){  
    035C8 E081      LDI	R24,1
    035C9 9020 0587 LDS	R2,time_buf+2
    035CB 1582      CP	R24,R2
    035CC F468      BCC	0x35DA
(0436) 					    time_buf[2]--;	
    035CD 2D82      MOV	R24,R2
    035CE 5081      SUBI	R24,1
    035CF 9380 0587 STS	time_buf+2,R24
(0437) 						if((time_buf[2]&0x0f)==0x0f) 
    035D1 708F      ANDI	R24,0xF
    035D2 308F      CPI	R24,0xF
    035D3 F449      BNE	0x35DD
(0438) 						    time_buf[2]-=6;
    035D4 9180 0587 LDS	R24,time_buf+2
    035D6 5086      SUBI	R24,6
    035D7 9380 0587 STS	time_buf+2,R24
(0439) 			  		}
    035D9 C003      RJMP	0x35DD
(0440) 				    else 
(0441) 					    time_buf[2]=0x12;						
    035DA E182      LDI	R24,0x12
    035DB 9380 0587 STS	time_buf+2,R24
(0442) 				}						 							
(0443)  								
(0444) 				if(keyc==left){
    035DD 314B      CPI	R20,0x1B
    035DE F009      BEQ	0x35E0
    035DF C0F3      RJMP	0x36D3
(0445) 				    i=2;   
    035E0 E082      LDI	R24,2
    035E1 2EE8      MOV	R14,R24
(0446) 				}  
(0447) 				break;
    035E2 C0F0      RJMP	0x36D3
(0448) 	 	 case 2: p=6;ary=GUI_up;
    035E3 E086      LDI	R24,6
    035E4 878A      STD	Y+10,R24
    035E5 01CE      MOVW	R24,R28
    035E6 9602      ADIW	R24,2
    035E7 016C      MOVW	R12,R24
(0449) 		 	  	 if(keyc==up){ 
    035E8 314E      CPI	R20,0x1E
    035E9 F519      BNE	0x360D
(0450) 				     if(time_buf[3]<0x31){ 
    035EA 9180 0588 LDS	R24,time_buf+3
    035EC 3381      CPI	R24,0x31
    035ED F5B0      BCC	0x3624
(0451) 				         time_buf[3]++;
    035EE 5F8F      SUBI	R24,0xFF
    035EF 9380 0588 STS	time_buf+3,R24
(0452) 						 if ((time_buf[3]&0x0f)==0x0a) time_buf[3]=time_buf[3]+6;
    035F1 708F      ANDI	R24,0xF
    035F2 308A      CPI	R24,0xA
    035F3 F429      BNE	0x35F9
    035F4 9180 0588 LDS	R24,time_buf+3
    035F6 5F8A      SUBI	R24,0xFA
    035F7 9380 0588 STS	time_buf+3,R24
(0453) 						 if(  //2 4 6 9 11 月最大30天
(0454) 						  ( ((time_buf[2]==0x02) || (time_buf[2]==0x04)|| (time_buf[2]==0x06)||
    035F9 9180 0587 LDS	R24,time_buf+2
    035FB 3082      CPI	R24,2
    035FC F041      BEQ	0x3605
    035FD 3084      CPI	R24,4
    035FE F031      BEQ	0x3605
    035FF 3086      CPI	R24,6
    03600 F021      BEQ	0x3605
    03601 3089      CPI	R24,0x9
    03602 F011      BEQ	0x3605
    03603 3181      CPI	R24,0x11
    03604 F4F9      BNE	0x3624
    03605 9180 0588 LDS	R24,time_buf+3
    03607 3381      CPI	R24,0x31
    03608 F4D9      BNE	0x3624
(0455) 						  (time_buf[2]==0x09)||(time_buf[2]==0x11))&&(time_buf[3]==0x31))){
(0456) 						      time_buf[3]=0x30;
    03609 E380      LDI	R24,0x30
    0360A 9380 0588 STS	time_buf+3,R24
(0457) 						}
(0458) 				     }
(0459)  									  
(0460)  				 }
    0360C C017      RJMP	0x3624
(0461) 			     else if(keyc==down){ 
    0360D 314D      CPI	R20,0x1D
    0360E F4A9      BNE	0x3624
(0462) 				      if(time_buf[3]>0x01){  
    0360F E081      LDI	R24,1
    03610 9020 0588 LDS	R2,time_buf+3
    03612 1582      CP	R24,R2
    03613 F468      BCC	0x3621
(0463) 					     time_buf[3]--;
    03614 2D82      MOV	R24,R2
    03615 5081      SUBI	R24,1
    03616 9380 0588 STS	time_buf+3,R24
(0464) 				 	  	 if((time_buf[3]&0x0f)==0x0f) time_buf[3]=time_buf[3]-6;
    03618 708F      ANDI	R24,0xF
    03619 308F      CPI	R24,0xF
    0361A F449      BNE	0x3624
    0361B 9180 0588 LDS	R24,time_buf+3
    0361D 5086      SUBI	R24,6
    0361E 9380 0588 STS	time_buf+3,R24
(0465) 		 	  	 	 }
    03620 C003      RJMP	0x3624
(0466) 					 else time_buf[3]=0x31;						
    03621 E381      LDI	R24,0x31
    03622 9380 0588 STS	time_buf+3,R24
(0467) 											   
(0468) 				}
(0469) 				if(keyc==left) {i=3;  }						 			   		
    03624 314B      CPI	R20,0x1B
    03625 F009      BEQ	0x3627
    03626 C0AC      RJMP	0x36D3
    03627 E083      LDI	R24,3
    03628 2EE8      MOV	R14,R24
(0470) 				break;
    03629 C0A9      RJMP	0x36D3
(0471) 		case 3:p=1;ary=GUI_down;
    0362A 2400      CLR	R0
    0362B 9403      INC	R0
    0362C 860A      STD	Y+10,R0
    0362D 01CE      MOVW	R24,R28
    0362E 9605      ADIW	R24,5
    0362F 016C      MOVW	R12,R24
(0472)  	  	if(keyc==up){ if(time_buf[4]<0x23){  time_buf[4]++;	
    03630 314E      CPI	R20,0x1E
    03631 F499      BNE	0x3645
    03632 9180 0589 LDS	R24,time_buf+4
    03634 3283      CPI	R24,0x23
    03635 F460      BCC	0x3642
    03636 5F8F      SUBI	R24,0xFF
    03637 9380 0589 STS	time_buf+4,R24
(0473) 													if((time_buf[4]&0x0f)==0x0a) time_buf[4]+=6;
    03639 708F      ANDI	R24,0xF
    0363A 308A      CPI	R24,0xA
    0363B F449      BNE	0x3645
    0363C 9180 0589 LDS	R24,time_buf+4
    0363E 5F8A      SUBI	R24,0xFA
    0363F 9380 0589 STS	time_buf+4,R24
(0474) 													 
(0475) 													
(0476) 												 }
    03641 C003      RJMP	0x3645
(0477) 							else time_buf[4]=0x00;
    03642 2422      CLR	R2
    03643 9220 0589 STS	time_buf+4,R2
(0478) 						  }						 
(0479) 				if(keyc==down){ if(time_buf[4]>0x00){  time_buf[4]--;	
    03645 314D      CPI	R20,0x1D
    03646 F4A9      BNE	0x365C
    03647 E080      LDI	R24,0
    03648 9020 0589 LDS	R2,time_buf+4
    0364A 1582      CP	R24,R2
    0364B F468      BCC	0x3659
    0364C 2D82      MOV	R24,R2
    0364D 5081      SUBI	R24,1
    0364E 9380 0589 STS	time_buf+4,R24
(0480) 													if((time_buf[4]&0x0f)==0x0f) time_buf[4]-=6;
    03650 708F      ANDI	R24,0xF
    03651 308F      CPI	R24,0xF
    03652 F449      BNE	0x365C
    03653 9180 0589 LDS	R24,time_buf+4
    03655 5086      SUBI	R24,6
    03656 9380 0589 STS	time_buf+4,R24
(0481) 													
(0482) 												 }
    03658 C003      RJMP	0x365C
(0483) 							 else time_buf[4]=0x23;						
    03659 E283      LDI	R24,0x23
    0365A 9380 0589 STS	time_buf+4,R24
(0484) 						  }	
(0485) 		if(keyc==left) {i=4;    } 
    0365C 314B      CPI	R20,0x1B
    0365D F009      BEQ	0x365F
    0365E C074      RJMP	0x36D3
    0365F E084      LDI	R24,4
    03660 2EE8      MOV	R14,R24
(0486) 		break;						  					 			
    03661 C071      RJMP	0x36D3
(0487)  case 4:p=3;ary=GUI_down;
    03662 E083      LDI	R24,3
    03663 878A      STD	Y+10,R24
    03664 01CE      MOVW	R24,R28
    03665 9605      ADIW	R24,5
    03666 016C      MOVW	R12,R24
(0488)  	  	if(keyc==up){ if(time_buf[5]<0x59){  time_buf[5]++;	
    03667 314E      CPI	R20,0x1E
    03668 F499      BNE	0x367C
    03669 9180 058A LDS	R24,time_buf+5
    0366B 3589      CPI	R24,0x59
    0366C F460      BCC	0x3679
    0366D 5F8F      SUBI	R24,0xFF
    0366E 9380 058A STS	time_buf+5,R24
(0489) 											 if((time_buf[5]&0x0f)==0x0a) time_buf[5]+=6;
    03670 708F      ANDI	R24,0xF
    03671 308A      CPI	R24,0xA
    03672 F449      BNE	0x367C
    03673 9180 058A LDS	R24,time_buf+5
    03675 5F8A      SUBI	R24,0xFA
    03676 9380 058A STS	time_buf+5,R24
(0490) 										  }
    03678 C003      RJMP	0x367C
(0491) 					  else time_buf[5]=0x00;
    03679 2422      CLR	R2
    0367A 9220 058A STS	time_buf+5,R2
(0492) 					}						 
(0493) 		if(keyc==down){ if(time_buf[5]>0x00){  time_buf[5]--;	
    0367C 314D      CPI	R20,0x1D
    0367D F4A9      BNE	0x3693
    0367E E080      LDI	R24,0
    0367F 9020 058A LDS	R2,time_buf+5
    03681 1582      CP	R24,R2
    03682 F468      BCC	0x3690
    03683 2D82      MOV	R24,R2
    03684 5081      SUBI	R24,1
    03685 9380 058A STS	time_buf+5,R24
(0494) 												if((time_buf[5]&0x0f)==0x0f) time_buf[5]-=6;
    03687 708F      ANDI	R24,0xF
    03688 308F      CPI	R24,0xF
    03689 F449      BNE	0x3693
    0368A 9180 058A LDS	R24,time_buf+5
    0368C 5086      SUBI	R24,6
    0368D 9380 058A STS	time_buf+5,R24
(0495) 											}
    0368F C003      RJMP	0x3693
(0496) 						else time_buf[5]=0x59;						
    03690 E589      LDI	R24,0x59
    03691 9380 058A STS	time_buf+5,R24
(0497) 					  }
(0498) 		if(keyc==left ) {i=5;    } 		  						 								  			
    03693 314B      CPI	R20,0x1B
    03694 F009      BEQ	0x3696
    03695 C03D      RJMP	0x36D3
    03696 E085      LDI	R24,5
    03697 2EE8      MOV	R14,R24
(0499) 		break;			   
    03698 C03A      RJMP	0x36D3
(0500)  case 5:p=5;ary=GUI_down;
    03699 E085      LDI	R24,5
    0369A 878A      STD	Y+10,R24
    0369B 01CE      MOVW	R24,R28
    0369C 9605      ADIW	R24,5
    0369D 016C      MOVW	R12,R24
(0501)  	  	if(keyc==up){ if(time_buf[6]<0x59){  time_buf[6]++;	
    0369E 314E      CPI	R20,0x1E
    0369F F499      BNE	0x36B3
    036A0 9180 058B LDS	R24,time_buf+6
    036A2 3589      CPI	R24,0x59
    036A3 F460      BCC	0x36B0
    036A4 5F8F      SUBI	R24,0xFF
    036A5 9380 058B STS	time_buf+6,R24
(0502) 											 if((time_buf[6]&0x0f)==0x0a) time_buf[6]+=6;
    036A7 708F      ANDI	R24,0xF
    036A8 308A      CPI	R24,0xA
    036A9 F449      BNE	0x36B3
    036AA 9180 058B LDS	R24,time_buf+6
    036AC 5F8A      SUBI	R24,0xFA
    036AD 9380 058B STS	time_buf+6,R24
(0503) 										 }
    036AF C003      RJMP	0x36B3
(0504) 					  else time_buf[6]=0x00;
    036B0 2422      CLR	R2
    036B1 9220 058B STS	time_buf+6,R2
(0505) 					}						 
(0506) 		if(keyc==down){ if(time_buf[6]>0x00){  time_buf[6]--;	
    036B3 314D      CPI	R20,0x1D
    036B4 F4A9      BNE	0x36CA
    036B5 E080      LDI	R24,0
    036B6 9020 058B LDS	R2,time_buf+6
    036B8 1582      CP	R24,R2
    036B9 F468      BCC	0x36C7
    036BA 2D82      MOV	R24,R2
    036BB 5081      SUBI	R24,1
    036BC 9380 058B STS	time_buf+6,R24
(0507) 						if((time_buf[6]&0x0f)==0x0f) time_buf[6]-=6;
    036BE 708F      ANDI	R24,0xF
    036BF 308F      CPI	R24,0xF
    036C0 F449      BNE	0x36CA
    036C1 9180 058B LDS	R24,time_buf+6
    036C3 5086      SUBI	R24,6
    036C4 9380 058B STS	time_buf+6,R24
(0508) 					  }
    036C6 C003      RJMP	0x36CA
(0509) 		else time_buf[6]=0x59;		}				
    036C7 E589      LDI	R24,0x59
    036C8 9380 058B STS	time_buf+6,R24
(0510) 		if(keyc==left) {i=6;p=1;ary=NULL;}  
    036CA 314B      CPI	R20,0x1B
    036CB F439      BNE	0x36D3
    036CC E086      LDI	R24,6
    036CD 2EE8      MOV	R14,R24
    036CE 2400      CLR	R0
    036CF 9403      INC	R0
    036D0 860A      STD	Y+10,R0
    036D1 24CC      CLR	R12
    036D2 24DD      CLR	R13
(0511) 		break;           
(0512) 							 
(0513) 		 }//endcase
(0514)  		 dateRefresh(88); //set clock mode
    036D3 E508      LDI	R16,0x58
    036D4 D200      RCALL	_dateRefresh
(0515) 		 
(0516) 		 LCD_const_disp(3,1,"                "); //清空箭头 
    036D5 E087      LDI	R24,7
    036D6 E094      LDI	R25,4
    036D7 8399      STD	Y+1,R25
    036D8 8388      ST	Y,R24
    036D9 E021      LDI	R18,1
    036DA E003      LDI	R16,3
    036DB 940E 3C3C CALL	_LCD_const_disp
(0517)  		 LCD_var_disp(3,p,ary); //显示箭头 
    036DD 82D9      STD	Y+1,R13
    036DE 82C8      ST	Y,R12
    036DF 852A      LDD	R18,Y+10
    036E0 E003      LDI	R16,3
    036E1 940E 3C69 CALL	_LCD_var_disp
(0518)  		 LCD_var_disp(2,1,pD);  //显示日期
    036E3 8408      LDD	R0,Y+8
    036E4 8419      LDD	R1,Y+9
    036E5 8219      STD	Y+1,R1
    036E6 8208      ST	Y,R0
    036E7 E021      LDI	R18,1
    036E8 E002      LDI	R16,2
    036E9 940E 3C69 CALL	_LCD_var_disp
(0519)  		 LCD_var_disp(4,1,pT);  //显示时间
    036EB 82B9      STD	Y+1,R11
    036EC 82A8      ST	Y,R10
    036ED E021      LDI	R18,1
    036EE E004      LDI	R16,4
    036EF 940E 3C69 CALL	_LCD_var_disp
(0520)  if(keyc==right) {		  
    036F1 3147      CPI	R20,0x17
    036F2 F479      BNE	0x3702
(0521)  		  LCD_const_disp(3,1,"        放弃修改"); 
    036F3 EF86      LDI	R24,0xF6
    036F4 E093      LDI	R25,3
    036F5 8399      STD	Y+1,R25
    036F6 8388      ST	Y,R24
    036F7 E021      LDI	R18,1
    036F8 E003      LDI	R16,3
    036F9 940E 3C3C CALL	_LCD_const_disp
(0522) 		  delayms(500);
    036FB EF04      LDI	R16,0xF4
    036FC E011      LDI	R17,1
    036FD 940E 2511 CALL	_delayms
(0523) 		  LCD_CLR(); //清屏
    036FF 940E 3CE2 CALL	_LCD_CLR
(0524) 		  return ;} 
    03701 C022      RJMP	0x3724
(0525)  keyc=NO_KEY;
    03702 2744      CLR	R20
(0526)  if(i==6){    //各值改变完成后 显示已保存 清屏 返回
    03703 2D8E      MOV	R24,R14
    03704 3086      CPI	R24,6
    03705 F4C9      BNE	0x371F
(0527) 		  ds1302_write_time(); 
    03706 940E 41D9 CALL	_ds1302_write_time
(0528)           LCD_const_disp(4,7,"    ");		  
    03708 EF81      LDI	R24,0xF1
    03709 E093      LDI	R25,3
    0370A 8399      STD	Y+1,R25
    0370B 8388      ST	Y,R24
    0370C E027      LDI	R18,7
    0370D E004      LDI	R16,4
    0370E 940E 3C3C CALL	_LCD_const_disp
(0529) 		  LCD_const_disp(3,1,"          已保存"); 
    03710 EE80      LDI	R24,0xE0
    03711 E093      LDI	R25,3
    03712 8399      STD	Y+1,R25
    03713 8388      ST	Y,R24
    03714 E021      LDI	R18,1
    03715 E003      LDI	R16,3
    03716 940E 3C3C CALL	_LCD_const_disp
(0530) 		  delayms(300);
    03718 E20C      LDI	R16,0x2C
    03719 E011      LDI	R17,1
    0371A 940E 2511 CALL	_delayms
(0531) 		  LCD_CLR(); //清屏
    0371C 940E 3CE2 CALL	_LCD_CLR
(0532) 		  return ;
    0371E C005      RJMP	0x3724
(0533) 		  }
(0534)  delayms(2);	  
    0371F E002      LDI	R16,2
    03720 E010      LDI	R17,0
    03721 940E 2511 CALL	_delayms
    03723 CE0A      RJMP	0x352E
    03724 962B      ADIW	R28,0xB
    03725 940C 483A JMP	pop_xgsetF0FC
_GUI_readback:
  res                  --> R12
  file_buf             --> Y,+3
  page                 --> R20
  key                  --> R22
  buf                  --> R10
    03727 940E 4845 CALL	push_xgsetF0FC
    03729 0158      MOVW	R10,R16
    0372A 9760      SBIW	R28,0x10
(0535) }//endwhile(1)
(0536) }
(0537) void GUI_readback(char *buf){
(0538)     char key=0;
    0372B 2766      CLR	R22
(0539) 	char page=0;
    0372C 2744      CLR	R20
(0540) 	char res=0;
    0372D 24CC      CLR	R12
(0541) 	char file_buf[]="201201.xls\0\0";
    0372E E883      LDI	R24,0x83
    0372F E093      LDI	R25,3
    03730 01FE      MOVW	R30,R28
    03731 9633      ADIW	R30,3
    03732 E00D      LDI	R16,0xD
    03733 E010      LDI	R17,0
    03734 93FA      ST	-Y,R31
    03735 93EA      ST	-Y,R30
    03736 939A      ST	-Y,R25
    03737 938A      ST	-Y,R24
    03738 940E 48F5 CALL	asgnblk
(0542) 	LCD_CLR(); //清屏
    0373A 940E 3CE2 CALL	_LCD_CLR
(0543) 	//1 检测SD状态
(0544) 		//无SD卡 显示无卡 退出
(0545) 	if((SD_DET()==0)) {
    0373C B181      IN	R24,0x01
    0373D 9586      LSR	R24
    0373E 9586      LSR	R24
    0373F 9586      LSR	R24
    03740 9586      LSR	R24
    03741 9586      LSR	R24
    03742 7081      ANDI	R24,1
    03743 F421      BNE	0x3748
    03744 E081      LDI	R24,1
    03745 E090      LDI	R25,0
    03746 017C      MOVW	R14,R24
    03747 C002      RJMP	0x374A
    03748 24EE      CLR	R14
    03749 24FF      CLR	R15
    0374A 20EE      TST	R14
    0374B F479      BNE	0x375B
    0374C 20FF      TST	R15
    0374D F469      BNE	0x375B
(0546) 		LCD_const_disp(2,1,"未检测到SD卡..");
    0374E ED81      LDI	R24,0xD1
    0374F E093      LDI	R25,3
    03750 8399      STD	Y+1,R25
    03751 8388      ST	Y,R24
    03752 E021      LDI	R18,1
    03753 E002      LDI	R16,2
    03754 940E 3C3C CALL	_LCD_const_disp
(0547) 			#ifdef _DBG_RD_
(0548) 		   PrintString_n("not find sd");
(0549) 		   #endif
(0550) 		delayms(500);
    03756 EF04      LDI	R16,0xF4
    03757 E011      LDI	R17,1
    03758 940E 2511 CALL	_delayms
(0551) 		return ;
    0375A C15A      RJMP	0x38B5
(0552) 	}
(0553) 	//2 显示当前月份
(0554) 	get_name(file_buf);
    0375B 018E      MOVW	R16,R28
    0375C 5F0D      SUBI	R16,0xFD
    0375D 4F1F      SBCI	R17,0xFF
    0375E 940E 2C43 CALL	_get_name
(0555) 	LCD_const_disp(1,1,"查找数据:");
    03760 EC87      LDI	R24,0xC7
    03761 E093      LDI	R25,3
    03762 8399      STD	Y+1,R25
    03763 8388      ST	Y,R24
    03764 E021      LDI	R18,1
    03765 E001      LDI	R16,1
    03766 940E 3C3C CALL	_LCD_const_disp
(0556) 	LCD_const_disp(2,2,file_buf);
    03768 01CE      MOVW	R24,R28
    03769 9603      ADIW	R24,3
    0376A 8399      STD	Y+1,R25
    0376B 8388      ST	Y,R24
    0376C E022      LDI	R18,2
    0376D E002      LDI	R16,2
    0376E 940E 3C3C CALL	_LCD_const_disp
(0557) 	#ifdef _DBG_RD_
(0558) 		   PrintString_n(file_buf);
(0559) 	#endif
(0560) 	//3 查找文件是否存在
(0561) 		//存在-> 进入读取顺序的选择
(0562) 		//不存在 -> 询问查找上月
(0563) 	//4 选择 查询顺序
(0564) 		//计算总条数
(0565) 		//顺序 增量为1， 查询第一条 
(0566) 		//逆序 增量为-1，查询最后一条
(0567) 	//5 读取	
(0568) 	//6 显示
(0569) 	//7 上一条 下一条  退出
(0570) 		//设置条数 判断边界 进入5
(0571) 		//退出 返回主程序	
(0572) 	//!!res=checkFile(file_buf);
(0573) 	LCD_CLR(); //清屏
    03770 940E 3CE2 CALL	_LCD_CLR
(0574) 	if(res == 0){ //找到并已经确认文件
    03772 20CC      TST	R12
    03773 F009      BEQ	0x3775
    03774 C140      RJMP	0x38B5
(0575) 		   LCD_const_disp(1,1,"菜单/ 检测");
    03775 E383      LDI	R24,0x33
    03776 E095      LDI	R25,5
    03777 8399      STD	Y+1,R25
    03778 8388      ST	Y,R24
    03779 E021      LDI	R18,1
    0377A E001      LDI	R16,1
    0377B 940E 3C3C CALL	_LCD_const_disp
(0576)    		   LCD_const_disp(2,3,"按顺序");
    0377D EC80      LDI	R24,0xC0
    0377E E093      LDI	R25,3
    0377F 8399      STD	Y+1,R25
    03780 8388      ST	Y,R24
    03781 E023      LDI	R18,3
    03782 E002      LDI	R16,2
    03783 940E 3C3C CALL	_LCD_const_disp
(0577) 		   LCD_const_disp(3,3,"最后一次");		 
    03785 EB87      LDI	R24,0xB7
    03786 E093      LDI	R25,3
    03787 8399      STD	Y+1,R25
    03788 8388      ST	Y,R24
    03789 E023      LDI	R18,3
    0378A E003      LDI	R16,3
    0378B 940E 3C3C CALL	_LCD_const_disp
(0578) 	       if(config.readMode == READ_MODE_LAST){
    0378D 9020 0866 LDS	R2,config+19
    0378F 2022      TST	R2
    03790 F4A1      BNE	0x37A5
(0579) 		       config.readMode=READ_MODE_FIRST;
    03791 E081      LDI	R24,1
    03792 9380 0866 STS	config+19,R24
(0580) 			   Set_White(1,2,8,0);
    03794 2422      CLR	R2
    03795 822A      STD	Y+2,R2
    03796 E088      LDI	R24,0x8
    03797 8388      ST	Y,R24
    03798 E022      LDI	R18,2
    03799 E001      LDI	R16,1
    0379A 940E 3D6C CALL	_Set_White
(0581)  			   Set_White(1,3,8,1);
    0379C E081      LDI	R24,1
    0379D 838A      STD	Y+2,R24
    0379E E088      LDI	R24,0x8
    0379F 8388      ST	Y,R24
    037A0 E023      LDI	R18,3
    037A1 E001      LDI	R16,1
    037A2 940E 3D6C CALL	_Set_White
(0582) 		  }
    037A4 C061      RJMP	0x3806
(0583) 		  else {
(0584) 		       config.readMode=READ_MODE_LAST;
    037A5 2422      CLR	R2
    037A6 9220 0866 STS	config+19,R2
(0585) 			   Set_White(1,2,8,1);
    037A8 E081      LDI	R24,1
    037A9 838A      STD	Y+2,R24
    037AA E088      LDI	R24,0x8
    037AB 8388      ST	Y,R24
    037AC E022      LDI	R18,2
    037AD E001      LDI	R16,1
    037AE 940E 3D6C CALL	_Set_White
(0586)  			   Set_White(1,3,8,0);
    037B0 2422      CLR	R2
    037B1 822A      STD	Y+2,R2
    037B2 E088      LDI	R24,0x8
    037B3 8388      ST	Y,R24
    037B4 E023      LDI	R18,3
    037B5 E001      LDI	R16,1
    037B6 940E 3D6C CALL	_Set_White
(0587) 		 }
    037B8 C04D      RJMP	0x3806
(0588) 		   //<<菜单/检测/手（自）动>>
(0589) 		   while(1){
(0590)  		       key=kbscan();
    037B9 940E 4226 CALL	_kbscan
    037BB 2F60      MOV	R22,R16
(0591) 			   //上键短按 选择
(0592) 			   if(key==up || key ==down){
    037BC 310E      CPI	R16,0x1E
    037BD F011      BEQ	0x37C0
    037BE 310D      CPI	R16,0x1D
    037BF F559      BNE	0x37EB
(0593) 	    	       if(config.readMode == READ_MODE_LAST){
    037C0 9020 0866 LDS	R2,config+19
    037C2 2022      TST	R2
    037C3 F4A1      BNE	0x37D8
(0594) 		    	       config.readMode=READ_MODE_FIRST;
    037C4 E081      LDI	R24,1
    037C5 9380 0866 STS	config+19,R24
(0595) 					   Set_White(1,2,8,0);
    037C7 2422      CLR	R2
    037C8 822A      STD	Y+2,R2
    037C9 E088      LDI	R24,0x8
    037CA 8388      ST	Y,R24
    037CB E022      LDI	R18,2
    037CC E001      LDI	R16,1
    037CD 940E 3D6C CALL	_Set_White
(0596)  					   Set_White(1,3,8,1);
    037CF E081      LDI	R24,1
    037D0 838A      STD	Y+2,R24
    037D1 E088      LDI	R24,0x8
    037D2 8388      ST	Y,R24
    037D3 E023      LDI	R18,3
    037D4 E001      LDI	R16,1
    037D5 940E 3D6C CALL	_Set_White
(0597) 				   }
    037D7 C013      RJMP	0x37EB
(0598) 				   else {
(0599) 		    	       config.readMode=READ_MODE_LAST;
    037D8 2422      CLR	R2
    037D9 9220 0866 STS	config+19,R2
(0600) 					   Set_White(1,2,8,1);
    037DB E081      LDI	R24,1
    037DC 838A      STD	Y+2,R24
    037DD E088      LDI	R24,0x8
    037DE 8388      ST	Y,R24
    037DF E022      LDI	R18,2
    037E0 E001      LDI	R16,1
    037E1 940E 3D6C CALL	_Set_White
(0601)  					   Set_White(1,3,8,0);
    037E3 2422      CLR	R2
    037E4 822A      STD	Y+2,R2
    037E5 E088      LDI	R24,0x8
    037E6 8388      ST	Y,R24
    037E7 E023      LDI	R18,3
    037E8 E001      LDI	R16,1
    037E9 940E 3D6C CALL	_Set_White
(0602) 				   }
(0603) 				}      
(0604) 				//左键短按  进入
(0605) 				if(key == left) {
    037EB 316B      CPI	R22,0x1B
    037EC F4A9      BNE	0x3802
(0606) 				Set_White(1,2,8,1);
    037ED E081      LDI	R24,1
    037EE 838A      STD	Y+2,R24
    037EF E088      LDI	R24,0x8
    037F0 8388      ST	Y,R24
    037F1 E022      LDI	R18,2
    037F2 E001      LDI	R16,1
    037F3 940E 3D6C CALL	_Set_White
(0607)  				Set_White(1,3,8,1);
    037F5 E081      LDI	R24,1
    037F6 838A      STD	Y+2,R24
    037F7 E088      LDI	R24,0x8
    037F8 8388      ST	Y,R24
    037F9 E023      LDI	R18,3
    037FA E001      LDI	R16,1
    037FB 940E 3D6C CALL	_Set_White
(0608) 				delayms(100);
    037FD E604      LDI	R16,0x64
    037FE E010      LDI	R17,0
    037FF 940E 2511 CALL	_delayms
(0609) 				break ;		
    03801 C005      RJMP	0x3807
(0610) 				}
(0611) 				//右键短按  返回
(0612) 				if(key == right) {
    03802 3167      CPI	R22,0x17
    03803 F409      BNE	0x3805
(0613) 				return ;		
    03804 C0B0      RJMP	0x38B5
(0614) 				}
(0615) 				key=0;
    03805 2766      CLR	R22
    03806 CFB2      RJMP	0x37B9
(0616) 		    } //end of while
(0617) 			if(config.readMode==READ_MODE_LAST){
    03807 9020 0866 LDS	R2,config+19
    03809 2022      TST	R2
    0380A F461      BNE	0x3817
(0618) 			    ReadSDFile(file_buf,65535,buf,0); //最后一条
    0380B 2422      CLR	R2
    0380C 822A      STD	Y+2,R2
    0380D 82B9      STD	Y+1,R11
    0380E 82A8      ST	Y,R10
    0380F EF2F      LDI	R18,0xFF
    03810 EF3F      LDI	R19,0xFF
    03811 018E      MOVW	R16,R28
    03812 5F0D      SUBI	R16,0xFD
    03813 4F1F      SBCI	R17,0xFF
    03814 940E 277B CALL	_ReadSDFile
(0619) 			}
    03816 C00B      RJMP	0x3822
(0620) 			else {
(0621) 			    ReadSDFile(file_buf,1,buf,0); //读第一条
    03817 2422      CLR	R2
    03818 822A      STD	Y+2,R2
    03819 82B9      STD	Y+1,R11
    0381A 82A8      ST	Y,R10
    0381B E021      LDI	R18,1
    0381C E030      LDI	R19,0
    0381D 018E      MOVW	R16,R28
    0381E 5F0D      SUBI	R16,0xFD
    0381F 4F1F      SBCI	R17,0xFF
    03820 940E 277B CALL	_ReadSDFile
(0622) 			}
(0623) 			CharToStruct(buf);      //转换
    03822 0185      MOVW	R16,R10
    03823 940E 2BFE CALL	_CharToStruct
    03825 C08E      RJMP	0x38B4
(0624) 			while(1){
(0625) 			    key=kbscan();     //键盘扫描
    03826 940E 4226 CALL	_kbscan
    03828 2F60      MOV	R22,R16
(0626) 				if(key != 0) beep(0,1);
    03829 2300      TST	R16
    0382A F021      BEQ	0x382F
    0382B E021      LDI	R18,1
    0382C 2700      CLR	R16
    0382D 940E 3FB7 CALL	_beep
(0627) 				//dateRefresh(0);  //刷新
(0628) 				_GUI_datashow(page); //显示
    0382F 2F04      MOV	R16,R20
    03830 DA6B      RCALL	__GUI_datashow
(0629) 				if( key==left ){ //按left键下一条
    03831 316B      CPI	R22,0x1B
    03832 F481      BNE	0x3843
(0630) 					next_item:  //下一条
(0631) 				    ReadSDFile(file_buf,1,buf,1); //偏移到下一条
    03833 E081      LDI	R24,1
    03834 838A      STD	Y+2,R24
    03835 82B9      STD	Y+1,R11
    03836 82A8      ST	Y,R10
    03837 E021      LDI	R18,1
    03838 E030      LDI	R19,0
    03839 018E      MOVW	R16,R28
    0383A 5F0D      SUBI	R16,0xFD
    0383B 4F1F      SBCI	R17,0xFF
    0383C 940E 277B CALL	_ReadSDFile
(0632) 					CharToStruct(buf);
    0383E 0185      MOVW	R16,R10
    0383F 940E 2BFE CALL	_CharToStruct
(0633) 					page = 0;
    03841 2744      CLR	R20
(0634) 					key=0;
    03842 2766      CLR	R22
(0635) 				}
(0636) 				if( key==lleft ){ //长按按left键上一条
    03843 396B      CPI	R22,0x9B
    03844 F481      BNE	0x3855
(0637) 		    	    pre_item: //上一条
(0638) 					ReadSDFile(file_buf,-1,buf,1); //偏移到上一条
    03845 E081      LDI	R24,1
    03846 838A      STD	Y+2,R24
    03847 82B9      STD	Y+1,R11
    03848 82A8      ST	Y,R10
    03849 EF2F      LDI	R18,0xFF
    0384A EF3F      LDI	R19,0xFF
    0384B 018E      MOVW	R16,R28
    0384C 5F0D      SUBI	R16,0xFD
    0384D 4F1F      SBCI	R17,0xFF
    0384E 940E 277B CALL	_ReadSDFile
(0639) 					CharToStruct(buf);
    03850 0185      MOVW	R16,R10
    03851 940E 2BFE CALL	_CharToStruct
(0640) 					page = 0;
    03853 2744      CLR	R20
(0641) 					key=0;
    03854 2766      CLR	R22
(0642) 				}
(0643) 				if(key==up){ //上键 : 页面减 
    03855 316E      CPI	R22,0x1E
    03856 F441      BNE	0x385F
(0644) 	    		     if(page>0) page--;
    03857 E080      LDI	R24,0
    03858 1784      CP	R24,R20
    03859 F758      BCC	0x3845
    0385A 954A      DEC	R20
(0645) 	    			 else goto pre_item;
(0646) 					 LCD_CLR();
    0385B 940E 3CE2 CALL	_LCD_CLR
(0647) 	    			 LCD_Init();
    0385D 940E 3CB0 CALL	_LCD_Init
(0648)     			}
(0649) 				if(key==lup){ //长按上键 : -10 条 
    0385F 396E      CPI	R22,0x9E
    03860 F4A1      BNE	0x3875
(0650) 	    		     ReadSDFile(file_buf,-10,buf,1); //偏移到下10条
    03861 E081      LDI	R24,1
    03862 838A      STD	Y+2,R24
    03863 82B9      STD	Y+1,R11
    03864 82A8      ST	Y,R10
    03865 EF26      LDI	R18,0xF6
    03866 EF3F      LDI	R19,0xFF
    03867 018E      MOVW	R16,R28
    03868 5F0D      SUBI	R16,0xFD
    03869 4F1F      SBCI	R17,0xFF
    0386A 940E 277B CALL	_ReadSDFile
(0651) 					 CharToStruct(buf);
    0386C 0185      MOVW	R16,R10
    0386D 940E 2BFE CALL	_CharToStruct
(0652) 					 page = 0;
    0386F 2744      CLR	R20
(0653) 					 key=0;
    03870 2766      CLR	R22
(0654) 					 LCD_CLR();
    03871 940E 3CE2 CALL	_LCD_CLR
(0655) 	    			 LCD_Init();
    03873 940E 3CB0 CALL	_LCD_Init
(0656)     			}
(0657) 				if(key==down){ //下键 ： 页面加
    03875 316D      CPI	R22,0x1D
    03876 F441      BNE	0x387F
(0658) 	    		    if(page<5) page++;
    03877 3045      CPI	R20,5
    03878 F008      BCS	0x387A
    03879 CFB9      RJMP	0x3833
    0387A 9543      INC	R20
(0659) 	  				else goto next_item;
(0660) 	    			LCD_CLR();
    0387B 940E 3CE2 CALL	_LCD_CLR
(0661) 	    			LCD_Init();
    0387D 940E 3CB0 CALL	_LCD_Init
(0662) 				}
(0663) 				if(key==ldown){ //长按下键 ： 页面加10条
    0387F 396D      CPI	R22,0x9D
    03880 F4A1      BNE	0x3895
(0664) 	    		    ReadSDFile(file_buf,10,buf,1); //偏移到下10条
    03881 E081      LDI	R24,1
    03882 838A      STD	Y+2,R24
    03883 82B9      STD	Y+1,R11
    03884 82A8      ST	Y,R10
    03885 E02A      LDI	R18,0xA
    03886 E030      LDI	R19,0
    03887 018E      MOVW	R16,R28
    03888 5F0D      SUBI	R16,0xFD
    03889 4F1F      SBCI	R17,0xFF
    0388A 940E 277B CALL	_ReadSDFile
(0665) 					CharToStruct(buf);
    0388C 0185      MOVW	R16,R10
    0388D 940E 2BFE CALL	_CharToStruct
(0666) 					page = 0;
    0388F 2744      CLR	R20
(0667) 					key = 0;
    03890 2766      CLR	R22
(0668) 	    			LCD_CLR();
    03891 940E 3CE2 CALL	_LCD_CLR
(0669) 	    			LCD_Init();
    03893 940E 3CB0 CALL	_LCD_Init
(0670) 				}
(0671) 				if(key==right){	//右键 退出
    03895 3167      CPI	R22,0x17
    03896 F439      BNE	0x389E
(0672) 	    		    beep(0,1); 
    03897 E021      LDI	R18,1
    03898 2700      CLR	R16
    03899 940E 3FB7 CALL	_beep
(0673) 	 				LCD_CLR();
    0389B 940E 3CE2 CALL	_LCD_CLR
(0674) 	 				return ;
    0389D C017      RJMP	0x38B5
(0675) 				}
(0676) 				if(page == 0 ){
    0389E 2344      TST	R20
    0389F F481      BNE	0x38B0
(0677) 				    LCD_const_disp(4,1,"ID:         ");
    038A0 EA8A      LDI	R24,0xAA
    038A1 E093      LDI	R25,3
    038A2 8399      STD	Y+1,R25
    038A3 8388      ST	Y,R24
    038A4 E021      LDI	R18,1
    038A5 E004      LDI	R16,4
    038A6 940E 3C3C CALL	_LCD_const_disp
(0678) 					LCD_const_disp(4,3,Result.IndexChar);
    038A8 EF81      LDI	R24,0xF1
    038A9 E095      LDI	R25,5
    038AA 8399      STD	Y+1,R25
    038AB 8388      ST	Y,R24
    038AC E023      LDI	R18,3
    038AD E004      LDI	R16,4
    038AE 940E 3C3C CALL	_LCD_const_disp
(0679) 				}
(0680)     			delayms(30); 
    038B0 E10E      LDI	R16,0x1E
    038B1 E010      LDI	R17,0
    038B2 940E 2511 CALL	_delayms
    038B4 CF71      RJMP	0x3826
(0681) 		 }//end while
(0682) 		   
(0683) 	}
(0684) 	else { //未找到或未确认文件
(0685) 		 //逆序查找文件，直到月份小于 200001.xls
(0686) 		 //或是手工确认的方式
(0687) 	}
    038B5 9660      ADIW	R28,0x10
    038B6 940C 483A JMP	pop_xgsetF0FC
_GUI_welcome:
    038B8 9722      SBIW	R28,2
(0688) 
(0689) }
(0690) void GUI_welcome(void){
(0691)     LCD_CLR(); //清屏
    038B9 940E 3CE2 CALL	_LCD_CLR
(0692) 	LCD_const_disp(2,3,"欢迎使用");
    038BB EA81      LDI	R24,0xA1
    038BC E093      LDI	R25,3
    038BD 8399      STD	Y+1,R25
    038BE 8388      ST	Y,R24
    038BF E023      LDI	R18,3
    038C0 E002      LDI	R16,2
    038C1 940E 3C3C CALL	_LCD_const_disp
(0693) 	LCD_const_disp(3,1,"环境冷强度检测仪");
    038C3 E980      LDI	R24,0x90
    038C4 E093      LDI	R25,3
    038C5 8399      STD	Y+1,R25
    038C6 8388      ST	Y,R24
    038C7 E021      LDI	R18,1
    038C8 E003      LDI	R16,3
    038C9 940E 3C3C CALL	_LCD_const_disp
(0694) 	delayms(800);
    038CB E200      LDI	R16,0x20
    038CC E013      LDI	R17,3
    038CD 940E 2511 CALL	_delayms
(0695) 	beep(0,1);
    038CF E021      LDI	R18,1
    038D0 2700      CLR	R16
    038D1 940E 3FB7 CALL	_beep
    038D3 9622      ADIW	R28,2
    038D4 9508      RET
_dateRefresh:
  readhardware         --> R20
    038D5 934A      ST	-Y,R20
    038D6 2F40      MOV	R20,R16
(0696) 	
(0697) }
(0698) 
(0699) ////////////////////////////////////
(0700) //  函数作用
(0701) //   将ds1302中缓存的时钟数据转换进结构体中
(0702) ////////////////////////////////////
(0703) void dateRefresh(unsigned char readhardware)
(0704) {	//readhardware = 0 not refresh, =1 refresh
(0705) 
(0706)  if( readhardware!=88 )	ds1302_read_time();
    038D7 3548      CPI	R20,0x58
    038D8 F011      BEQ	0x38DB
    038D9 940E 41FE CALL	_ds1302_read_time
(0707) 	t.tm_sec=(((time_buf[6]&0x70)>>4)*10)+(time_buf[6]&0x0f);
    038DB 9110 058B LDS	R17,time_buf+6
    038DD 7710      ANDI	R17,0x70
    038DE 9512      SWAP	R17
    038DF 701F      ANDI	R17,0xF
    038E0 E00A      LDI	R16,0xA
    038E1 0301      MULSU	R16,R17
    038E2 0110      MOVW	R2,R0
    038E3 9180 058B LDS	R24,time_buf+6
    038E5 2799      CLR	R25
    038E6 708F      ANDI	R24,0xF
    038E7 7090      ANDI	R25,0
    038E8 0E28      ADD	R2,R24
    038E9 1E39      ADC	R3,R25
    038EA 9230 0842 STS	t+1,R3
    038EC 9220 0841 STS	t,R2
(0708) 	t.tm_min=  (((time_buf[5]&0x70)>>4)*10)+(time_buf[5]&0x0f);
    038EE 9110 058A LDS	R17,time_buf+5
    038F0 7710      ANDI	R17,0x70
    038F1 9512      SWAP	R17
    038F2 701F      ANDI	R17,0xF
    038F3 0301      MULSU	R16,R17
    038F4 0110      MOVW	R2,R0
    038F5 9180 058A LDS	R24,time_buf+5
    038F7 2799      CLR	R25
    038F8 708F      ANDI	R24,0xF
    038F9 7090      ANDI	R25,0
    038FA 0E28      ADD	R2,R24
    038FB 1E39      ADC	R3,R25
    038FC 9230 0844 STS	t+3,R3
    038FE 9220 0843 STS	t+2,R2
(0709) 	t.tm_hour=  (((time_buf[4]&0x70)>>4)*10)+(time_buf[4]&0x0f);
    03900 9110 0589 LDS	R17,time_buf+4
    03902 7710      ANDI	R17,0x70
    03903 9512      SWAP	R17
    03904 701F      ANDI	R17,0xF
    03905 0301      MULSU	R16,R17
    03906 0110      MOVW	R2,R0
    03907 9180 0589 LDS	R24,time_buf+4
    03909 2799      CLR	R25
    0390A 708F      ANDI	R24,0xF
    0390B 7090      ANDI	R25,0
    0390C 0E28      ADD	R2,R24
    0390D 1E39      ADC	R3,R25
    0390E 9230 0846 STS	t+5,R3
    03910 9220 0845 STS	t+4,R2
(0710) 	t.tm_mday=	(((time_buf[3]&0x70)>>4)*10)+(time_buf[3]&0x0f);
    03912 9110 0588 LDS	R17,time_buf+3
    03914 7710      ANDI	R17,0x70
    03915 9512      SWAP	R17
    03916 701F      ANDI	R17,0xF
    03917 0301      MULSU	R16,R17
    03918 0110      MOVW	R2,R0
    03919 9180 0588 LDS	R24,time_buf+3
    0391B 2799      CLR	R25
    0391C 708F      ANDI	R24,0xF
    0391D 7090      ANDI	R25,0
    0391E 0E28      ADD	R2,R24
    0391F 1E39      ADC	R3,R25
    03920 9230 0848 STS	t+7,R3
    03922 9220 0847 STS	t+6,R2
(0711) 	t.tm_mon= (((time_buf[2]&0x70)>>4)*10)+(time_buf[2]&0x0f);
    03924 9110 0587 LDS	R17,time_buf+2
    03926 7710      ANDI	R17,0x70
    03927 9512      SWAP	R17
    03928 701F      ANDI	R17,0xF
    03929 0301      MULSU	R16,R17
    0392A 0110      MOVW	R2,R0
    0392B 9180 0587 LDS	R24,time_buf+2
    0392D 2799      CLR	R25
    0392E 708F      ANDI	R24,0xF
    0392F 7090      ANDI	R25,0
    03930 0E28      ADD	R2,R24
    03931 1E39      ADC	R3,R25
    03932 9230 084A STS	t+9,R3
    03934 9220 0849 STS	t+8,R2
(0712) 	t.tm_wday=	(time_buf[7]&0x0f);
    03936 9180 058C LDS	R24,time_buf+7
    03938 2799      CLR	R25
    03939 708F      ANDI	R24,0xF
    0393A 7090      ANDI	R25,0
    0393B 9390 084E STS	t+13,R25
    0393D 9380 084D STS	t+12,R24
(0713)     t.tm_year=	(((time_buf[1]&0x70)>>4)*10)+(time_buf[1]&0x0f);
    0393F 9110 0586 LDS	R17,time_buf+1
    03941 7710      ANDI	R17,0x70
    03942 9512      SWAP	R17
    03943 701F      ANDI	R17,0xF
    03944 0301      MULSU	R16,R17
    03945 0110      MOVW	R2,R0
    03946 9180 0586 LDS	R24,time_buf+1
    03948 2799      CLR	R25
    03949 708F      ANDI	R24,0xF
    0394A 7090      ANDI	R25,0
    0394B 0E28      ADD	R2,R24
    0394C 1E39      ADC	R3,R25
    0394D 9230 084C STS	t+11,R3
    0394F 9220 084B STS	t+10,R2
(0714) 	if(readhardware != 0){
    03951 2344      TST	R20
    03952 F409      BNE	0x3954
    03953 C09F      RJMP	0x39F3
(0715) 	Result.Date[0]='2';
    03954 E382      LDI	R24,0x32
    03955 9380 05F9 STS	Result+22,R24
(0716) 	Result.Date[1]='0';
    03957 E380      LDI	R24,0x30
    03958 9380 05FA STS	Result+23,R24
(0717) 	Result.Date[2]=t.tm_year/10+'0';
    0395A E02A      LDI	R18,0xA
    0395B E030      LDI	R19,0
    0395C 0181      MOVW	R16,R2
    0395D 940E 4715 CALL	div16s
    0395F 01C8      MOVW	R24,R16
    03960 96C0      ADIW	R24,0x30
    03961 9380 05FB STS	Result+24,R24
(0718) 	Result.Date[3]=t.tm_year%10+'0';
    03963 E02A      LDI	R18,0xA
    03964 E030      LDI	R19,0
    03965 9100 084B LDS	R16,t+10
    03967 9110 084C LDS	R17,t+11
    03969 940E 4711 CALL	mod16s
    0396B 01C8      MOVW	R24,R16
    0396C 96C0      ADIW	R24,0x30
    0396D 9380 05FC STS	Result+25,R24
(0719) 	Result.Date[4]=t.tm_mon/10+'0';
    0396F E02A      LDI	R18,0xA
    03970 E030      LDI	R19,0
    03971 9100 0849 LDS	R16,t+8
    03973 9110 084A LDS	R17,t+9
    03975 940E 4715 CALL	div16s
    03977 01C8      MOVW	R24,R16
    03978 96C0      ADIW	R24,0x30
    03979 9380 05FD STS	Result+26,R24
(0720) 	Result.Date[5]=t.tm_mon%10+'0';
    0397B E02A      LDI	R18,0xA
    0397C E030      LDI	R19,0
    0397D 9100 0849 LDS	R16,t+8
    0397F 9110 084A LDS	R17,t+9
    03981 940E 4711 CALL	mod16s
    03983 01C8      MOVW	R24,R16
    03984 96C0      ADIW	R24,0x30
    03985 9380 05FE STS	Result+27,R24
(0721) 	Result.Date[6]=t.tm_mday/10+'0';
    03987 E02A      LDI	R18,0xA
    03988 E030      LDI	R19,0
    03989 9100 0847 LDS	R16,t+6
    0398B 9110 0848 LDS	R17,t+7
    0398D 940E 4715 CALL	div16s
    0398F 01C8      MOVW	R24,R16
    03990 96C0      ADIW	R24,0x30
    03991 9380 05FF STS	Result+28,R24
(0722) 	Result.Date[7]=t.tm_mday%10+'0';
    03993 E02A      LDI	R18,0xA
    03994 E030      LDI	R19,0
    03995 9100 0847 LDS	R16,t+6
    03997 9110 0848 LDS	R17,t+7
    03999 940E 4711 CALL	mod16s
    0399B 01C8      MOVW	R24,R16
    0399C 96C0      ADIW	R24,0x30
    0399D 9380 0600 STS	Result+29,R24
(0723)     Result.Date[8]='\0';
    0399F 2422      CLR	R2
    039A0 9220 0601 STS	Result+30,R2
(0724) 
(0725) 	Result.Time[0]=t.tm_hour/10+'0';
    039A2 E02A      LDI	R18,0xA
    039A3 E030      LDI	R19,0
    039A4 9100 0845 LDS	R16,t+4
    039A6 9110 0846 LDS	R17,t+5
    039A8 940E 4715 CALL	div16s
    039AA 01C8      MOVW	R24,R16
    039AB 96C0      ADIW	R24,0x30
    039AC 9380 0602 STS	Result+31,R24
(0726) 	Result.Time[1]=t.tm_hour%10+'0';
    039AE E02A      LDI	R18,0xA
    039AF E030      LDI	R19,0
    039B0 9100 0845 LDS	R16,t+4
    039B2 9110 0846 LDS	R17,t+5
    039B4 940E 4711 CALL	mod16s
    039B6 01C8      MOVW	R24,R16
    039B7 96C0      ADIW	R24,0x30
    039B8 9380 0603 STS	Result+32,R24
(0727) 	Result.Time[2]=':';
    039BA E38A      LDI	R24,0x3A
    039BB 9380 0604 STS	Result+33,R24
(0728) 	//Result.Time[3]=' ';
(0729) 	Result.Time[3]=t.tm_min/10+'0';
    039BD E02A      LDI	R18,0xA
    039BE E030      LDI	R19,0
    039BF 9100 0843 LDS	R16,t+2
    039C1 9110 0844 LDS	R17,t+3
    039C3 940E 4715 CALL	div16s
    039C5 01C8      MOVW	R24,R16
    039C6 96C0      ADIW	R24,0x30
    039C7 9380 0605 STS	Result+34,R24
(0730) 	Result.Time[4]=t.tm_min%10+'0';
    039C9 E02A      LDI	R18,0xA
    039CA E030      LDI	R19,0
    039CB 9100 0843 LDS	R16,t+2
    039CD 9110 0844 LDS	R17,t+3
    039CF 940E 4711 CALL	mod16s
    039D1 01C8      MOVW	R24,R16
    039D2 96C0      ADIW	R24,0x30
    039D3 9380 0606 STS	Result+35,R24
(0731) 	Result.Time[5]=':';
    039D5 E38A      LDI	R24,0x3A
    039D6 9380 0607 STS	Result+36,R24
(0732) 	//Result.Time[7]=' ';
(0733) 	Result.Time[6]=t.tm_sec/10+'0';
    039D8 E02A      LDI	R18,0xA
    039D9 E030      LDI	R19,0
    039DA 9100 0841 LDS	R16,t
    039DC 9110 0842 LDS	R17,t+1
    039DE 940E 4715 CALL	div16s
    039E0 01C8      MOVW	R24,R16
    039E1 96C0      ADIW	R24,0x30
    039E2 9380 0608 STS	Result+37,R24
(0734) 	Result.Time[7]=t.tm_sec%10+'0';
    039E4 E02A      LDI	R18,0xA
    039E5 E030      LDI	R19,0
    039E6 9100 0841 LDS	R16,t
    039E8 9110 0842 LDS	R17,t+1
    039EA 940E 4711 CALL	mod16s
    039EC 01C8      MOVW	R24,R16
    039ED 96C0      ADIW	R24,0x30
    039EE 9380 0609 STS	Result+38,R24
(0735) 	Result.Time[8]='\0'; 
    039F0 2422      CLR	R2
    039F1 9220 060A STS	Result+39,R2
(0736) 	}
(0737)     config.now =t.tm_hour*3600 + t.tm_min*60 + t.tm_sec; //更新系统心跳
    039F3 9120 0843 LDS	R18,t+2
    039F5 9130 0844 LDS	R19,t+3
    039F7 E30C      LDI	R16,0x3C
    039F8 E010      LDI	R17,0
    039F9 940E 47E1 CALL	empy16s
    039FB 0118      MOVW	R2,R16
    039FC 9120 0845 LDS	R18,t+4
    039FE 9130 0846 LDS	R19,t+5
    03A00 E100      LDI	R16,0x10
    03A01 E01E      LDI	R17,0xE
    03A02 940E 47E1 CALL	empy16s
    03A04 0128      MOVW	R4,R16
    03A05 0C42      ADD	R4,R2
    03A06 1C53      ADC	R5,R3
    03A07 9020 0841 LDS	R2,t
    03A09 9030 0842 LDS	R3,t+1
    03A0B 0C42      ADD	R4,R2
    03A0C 1C53      ADC	R5,R3
    03A0D 0112      MOVW	R2,R4
    03A0E 2444      CLR	R4
    03A0F FC37      SBRC	R3,7
    03A10 9440      COM	R4
    03A11 2455      CLR	R5
    03A12 FC47      SBRC	R4,7
    03A13 9450      COM	R5
    03A14 9230 0860 STS	config+13,R3
    03A16 9220 085F STS	config+12,R2
    03A18 9250 0862 STS	config+15,R5
    03A1A 9240 0861 STS	config+14,R4
    03A1C 9149      LD	R20,Y+
    03A1D 9508      RET
FILE: D:\LQD\software\software_src\usart.c
(0001) #include "config.h"
(0002) 
(0003) 
(0004) #define fosc 7372800UL //晶振7.3728MHZ
(0005) #define baud 38400  //波特率
(0006) //串口通信初始化  MEGA128
(0007) //UART1 initialize
(0008) // desired baud rate:38400
(0009) // actual baud rate:38400 (0.0%)
(0010) // char size: 8 bit
(0011) // parity: Disabled
(0012) void uart1_init(void)
(0013) {
(0014)  	 UCSR1B = 0x00; //disable while setting baud rate
_uart1_init:
    03A1E 2422      CLR	R2
    03A1F 9220 009A STS	0x9A,R2
(0015)      UCSR1A = 0x00;
    03A21 9220 009B STS	0x9B,R2
(0016)      UCSR1C = (1<<UCSZ11)|(1<<UCSZ10);//8bit+1bit stop
    03A23 E086      LDI	R24,6
    03A24 9380 009D STS	0x9D,R24
(0017)      UBRR1L=(fosc/16/(baud+1))%256;
    03A26 E08B      LDI	R24,0xB
    03A27 9380 0099 STS	0x99,R24
(0018)      UBRR1H=(fosc/16/(baud+1))/256;
    03A29 9220 0098 STS	0x98,R2
(0019)      UCSR1B =(1<<RXEN1)|(1<<TXEN1);//RXCEN TXCEN
    03A2B E188      LDI	R24,0x18
    03A2C 9380 009A STS	0x9A,R24
    03A2E 9508      RET
_uart1_rx_isr:
  tmp                  --> R16
    03A2F 930A      ST	-Y,R16
    03A30 B70F      IN	R16,0x3F
    03A31 930A      ST	-Y,R16
(0020) }
(0021) 
(0022) #pragma interrupt_handler uart1_rx_isr:iv_USART1_RXC
(0023) void uart1_rx_isr(void){   
(0024) 	 char tmp;
(0025) 	 tmp=UDR1;
    03A32 9100 009C LDS	R16,0x9C
    03A34 9109      LD	R16,Y+
    03A35 BF0F      OUT	0x3F,R16
    03A36 9109      LD	R16,Y+
    03A37 9518      RETI
(0026) }
(0027) 
(0028) void Usart_Transmit(char c)
(0029) {
(0030)  	 while (!(UCSR1A&(1<<UDRE1)));//表明发送器一准备就绪
_Usart_Transmit:
  c                    --> R16
    03A38 9020 009B LDS	R2,0x9B
    03A3A FE25      SBRS	R2,5
    03A3B CFFC      RJMP	_Usart_Transmit
(0031) 	 UDR1=c;
    03A3C 9300 009C STS	0x9C,R16
    03A3E 9508      RET
_Puts:
  s                    --> R20
    03A3F 934A      ST	-Y,R20
    03A40 935A      ST	-Y,R21
    03A41 01A8      MOVW	R20,R16
(0032) }
(0033) 
(0034) //串口输出字符串
(0035) void Puts( unsigned char *s)
(0036) { 
    03A42 C00B      RJMP	0x3A4E
(0037) 	 while (*s) 
(0038)       { 
(0039) 	  //为数据间的隔断创造一个串口能显示的隔断字符 即'/t'  ->  ' '
(0040) 	  if(*s==0x09)  
    03A43 01FA      MOVW	R30,R20
    03A44 8180      LD	R24,Z
    03A45 3089      CPI	R24,0x9
    03A46 F411      BNE	0x3A49
(0041) 	  {   Usart_Transmit(' ');    }
    03A47 E200      LDI	R16,0x20
    03A48 DFEF      RCALL	_Usart_Transmit
(0042) 	 Usart_Transmit(*s);
    03A49 01FA      MOVW	R30,R20
    03A4A 8100      LD	R16,Z
    03A4B DFEC      RCALL	_Usart_Transmit
(0043) 	 s++;
    03A4C 5F4F      SUBI	R20,0xFF
    03A4D 4F5F      SBCI	R21,0xFF
    03A4E 01FA      MOVW	R30,R20
    03A4F 8020      LD	R2,Z
    03A50 2022      TST	R2
    03A51 F789      BNE	0x3A43
    03A52 9159      LD	R21,Y+
    03A53 9149      LD	R20,Y+
    03A54 9508      RET
_Send_nByte:
  i                    --> R20
  len                  --> R10
  p                    --> R12
    03A55 940E 4872 CALL	push_xgset303C
    03A57 2EA2      MOV	R10,R18
    03A58 0168      MOVW	R12,R16
(0044) 	
(0045) 	
(0046)       }
(0047) }
(0048) 
(0049) 
(0050) 
(0051) void Send_nByte(unsigned char *p, unsigned char len)
(0052) { 
(0053)   int i = 0;
(0054)   for(i=0;i<len;i++)
    03A59 2744      CLR	R20
    03A5A 2755      CLR	R21
    03A5B C007      RJMP	0x3A63
(0055)   {
(0056)    	Usart_Transmit(*(p+i));
    03A5C 01FA      MOVW	R30,R20
    03A5D 0DEC      ADD	R30,R12
    03A5E 1DFD      ADC	R31,R13
    03A5F 8100      LD	R16,Z
    03A60 DFD7      RCALL	_Usart_Transmit
    03A61 5F4F      SUBI	R20,0xFF
    03A62 4F5F      SBCI	R21,0xFF
    03A63 2C2A      MOV	R2,R10
    03A64 2433      CLR	R3
    03A65 1542      CP	R20,R2
    03A66 0553      CPC	R21,R3
    03A67 F3A4      BLT	0x3A5C
    03A68 940C 4879 JMP	pop_xgset303C
_PrintString:
  str                  --> R10
    03A6A 92AA      ST	-Y,R10
    03A6B 92BA      ST	-Y,R11
    03A6C 0158      MOVW	R10,R16
(0057)   }
(0058) }
(0059) 
(0060) void  PrintString(const unsigned char *str)
(0061) {    
    03A6D C004      RJMP	0x3A72
(0062) 	while(*str!=0)	Usart_Transmit(*str++);
    03A6E 01F5      MOVW	R30,R10
    03A6F 9101      LD	R16,Z+
    03A70 015F      MOVW	R10,R30
    03A71 DFC6      RCALL	_Usart_Transmit
    03A72 01F5      MOVW	R30,R10
    03A73 8020      LD	R2,Z
    03A74 2022      TST	R2
    03A75 F7C1      BNE	0x3A6E
    03A76 90B9      LD	R11,Y+
    03A77 90A9      LD	R10,Y+
    03A78 9508      RET
_PrintString_n:
  str                  --> R10
    03A79 92AA      ST	-Y,R10
    03A7A 92BA      ST	-Y,R11
    03A7B 0158      MOVW	R10,R16
(0063) }
(0064) void  PrintString_n(const unsigned char *str)
(0065) {   
(0066) 	Usart_Transmit('\r');
    03A7C E00D      LDI	R16,0xD
    03A7D DFBA      RCALL	_Usart_Transmit
(0067) 	Usart_Transmit('\n'); 
    03A7E E00A      LDI	R16,0xA
    03A7F DFB8      RCALL	_Usart_Transmit
    03A80 C004      RJMP	0x3A85
(0068) 	while(*str!=0)	Usart_Transmit(*str++);
    03A81 01F5      MOVW	R30,R10
    03A82 9101      LD	R16,Z+
    03A83 015F      MOVW	R10,R30
    03A84 DFB3      RCALL	_Usart_Transmit
    03A85 01F5      MOVW	R30,R10
    03A86 8020      LD	R2,Z
    03A87 2022      TST	R2
    03A88 F7C1      BNE	0x3A81
    03A89 90B9      LD	R11,Y+
    03A8A 90A9      LD	R10,Y+
    03A8B 9508      RET
_PrintLong:
  i                    --> R20
  da                   --> Y,+0
  data                 --> Y,+9
    03A8C 940E 4700 CALL	push_arg4
    03A8E 934A      ST	-Y,R20
    03A8F 9728      SBIW	R28,0x8
(0069) 
(0070) } 
(0071)  
(0072) void PrintLong(unsigned long data)
(0073) {
(0074)  
(0075) 	unsigned char da[8];
(0076) 	unsigned char i;
(0077) 	for(i=0;i<8;i++)	da[i]=0;
    03A90 2744      CLR	R20
    03A91 C008      RJMP	0x3A9A
    03A92 01CE      MOVW	R24,R28
    03A93 2FE4      MOV	R30,R20
    03A94 27FF      CLR	R31
    03A95 0FE8      ADD	R30,R24
    03A96 1FF9      ADC	R31,R25
    03A97 2422      CLR	R2
    03A98 8220      ST	Z,R2
    03A99 9543      INC	R20
    03A9A 3048      CPI	R20,0x8
    03A9B F3B0      BCS	0x3A92
    03A9C C013      RJMP	0x3AB0
(0078) 	while(data>=10000000L){ ++da[7];data-=10000000L;}
    03A9D 818F      LDD	R24,Y+7
    03A9E 5F8F      SUBI	R24,0xFF
    03A9F 838F      STD	Y+7,R24
    03AA0 E880      LDI	R24,0x80
    03AA1 E996      LDI	R25,0x96
    03AA2 E9A8      LDI	R26,0x98
    03AA3 E0B0      LDI	R27,0
    03AA4 8429      LDD	R2,Y+9
    03AA5 843A      LDD	R3,Y+10
    03AA6 844B      LDD	R4,Y+11
    03AA7 845C      LDD	R5,Y+12
    03AA8 1A28      SUB	R2,R24
    03AA9 0A39      SBC	R3,R25
    03AAA 0A4A      SBC	R4,R26
    03AAB 0A5B      SBC	R5,R27
    03AAC 8629      STD	Y+9,R2
    03AAD 863A      STD	Y+10,R3
    03AAE 864B      STD	Y+11,R4
    03AAF 865C      STD	Y+12,R5
    03AB0 E880      LDI	R24,0x80
    03AB1 E996      LDI	R25,0x96
    03AB2 E9A8      LDI	R26,0x98
    03AB3 E0B0      LDI	R27,0
    03AB4 8429      LDD	R2,Y+9
    03AB5 843A      LDD	R3,Y+10
    03AB6 844B      LDD	R4,Y+11
    03AB7 845C      LDD	R5,Y+12
    03AB8 1628      CP	R2,R24
    03AB9 0639      CPC	R3,R25
    03ABA 064A      CPC	R4,R26
    03ABB 065B      CPC	R5,R27
    03ABC F700      BCC	0x3A9D
(0079) 	if(da[7])	i=0;
    03ABD 802F      LDD	R2,Y+7
    03ABE 2022      TST	R2
    03ABF F009      BEQ	0x3AC1
    03AC0 2744      CLR	R20
(0080) 	if(i==0)	Usart_Transmit('0'+da[7]);
    03AC1 2344      TST	R20
    03AC2 F4B9      BNE	0x3ADA
    03AC3 810F      LDD	R16,Y+7
    03AC4 5D00      SUBI	R16,0xD0
    03AC5 DF72      RCALL	_Usart_Transmit
    03AC6 C013      RJMP	0x3ADA
(0081) 	while(data>=1000000L) { ++da[6];data-=1000000L;}
    03AC7 818E      LDD	R24,Y+6
    03AC8 5F8F      SUBI	R24,0xFF
    03AC9 838E      STD	Y+6,R24
    03ACA E480      LDI	R24,0x40
    03ACB E492      LDI	R25,0x42
    03ACC E0AF      LDI	R26,0xF
    03ACD E0B0      LDI	R27,0
    03ACE 8429      LDD	R2,Y+9
    03ACF 843A      LDD	R3,Y+10
    03AD0 844B      LDD	R4,Y+11
    03AD1 845C      LDD	R5,Y+12
    03AD2 1A28      SUB	R2,R24
    03AD3 0A39      SBC	R3,R25
    03AD4 0A4A      SBC	R4,R26
    03AD5 0A5B      SBC	R5,R27
    03AD6 8629      STD	Y+9,R2
    03AD7 863A      STD	Y+10,R3
    03AD8 864B      STD	Y+11,R4
    03AD9 865C      STD	Y+12,R5
    03ADA E480      LDI	R24,0x40
    03ADB E492      LDI	R25,0x42
    03ADC E0AF      LDI	R26,0xF
    03ADD E0B0      LDI	R27,0
    03ADE 8429      LDD	R2,Y+9
    03ADF 843A      LDD	R3,Y+10
    03AE0 844B      LDD	R4,Y+11
    03AE1 845C      LDD	R5,Y+12
    03AE2 1628      CP	R2,R24
    03AE3 0639      CPC	R3,R25
    03AE4 064A      CPC	R4,R26
    03AE5 065B      CPC	R5,R27
    03AE6 F700      BCC	0x3AC7
(0082) 	if(da[6])	i=0;
    03AE7 802E      LDD	R2,Y+6
    03AE8 2022      TST	R2
    03AE9 F009      BEQ	0x3AEB
    03AEA 2744      CLR	R20
(0083) 	if(i==0)	Usart_Transmit('0'+da[6]);
    03AEB 2344      TST	R20
    03AEC F4B9      BNE	0x3B04
    03AED 810E      LDD	R16,Y+6
    03AEE 5D00      SUBI	R16,0xD0
    03AEF DF48      RCALL	_Usart_Transmit
    03AF0 C013      RJMP	0x3B04
(0084) 	while(data>=100000L)  { ++da[5];data-=100000L;}
    03AF1 818D      LDD	R24,Y+5
    03AF2 5F8F      SUBI	R24,0xFF
    03AF3 838D      STD	Y+5,R24
    03AF4 EA80      LDI	R24,0xA0
    03AF5 E896      LDI	R25,0x86
    03AF6 E0A1      LDI	R26,1
    03AF7 E0B0      LDI	R27,0
    03AF8 8429      LDD	R2,Y+9
    03AF9 843A      LDD	R3,Y+10
    03AFA 844B      LDD	R4,Y+11
    03AFB 845C      LDD	R5,Y+12
    03AFC 1A28      SUB	R2,R24
    03AFD 0A39      SBC	R3,R25
    03AFE 0A4A      SBC	R4,R26
    03AFF 0A5B      SBC	R5,R27
    03B00 8629      STD	Y+9,R2
    03B01 863A      STD	Y+10,R3
    03B02 864B      STD	Y+11,R4
    03B03 865C      STD	Y+12,R5
    03B04 EA80      LDI	R24,0xA0
    03B05 E896      LDI	R25,0x86
    03B06 E0A1      LDI	R26,1
    03B07 E0B0      LDI	R27,0
    03B08 8429      LDD	R2,Y+9
    03B09 843A      LDD	R3,Y+10
    03B0A 844B      LDD	R4,Y+11
    03B0B 845C      LDD	R5,Y+12
    03B0C 1628      CP	R2,R24
    03B0D 0639      CPC	R3,R25
    03B0E 064A      CPC	R4,R26
    03B0F 065B      CPC	R5,R27
    03B10 F700      BCC	0x3AF1
(0085) 	if(da[5])	i=0;
    03B11 802D      LDD	R2,Y+5
    03B12 2022      TST	R2
    03B13 F009      BEQ	0x3B15
    03B14 2744      CLR	R20
(0086) 	if(i==0)	Usart_Transmit('0'+da[5]);
    03B15 2344      TST	R20
    03B16 F4B9      BNE	0x3B2E
    03B17 810D      LDD	R16,Y+5
    03B18 5D00      SUBI	R16,0xD0
    03B19 DF1E      RCALL	_Usart_Transmit
    03B1A C013      RJMP	0x3B2E
(0087) 	while(data>=10000L)   { ++da[4];data-=10000L;}
    03B1B 818C      LDD	R24,Y+4
    03B1C 5F8F      SUBI	R24,0xFF
    03B1D 838C      STD	Y+4,R24
    03B1E E180      LDI	R24,0x10
    03B1F E297      LDI	R25,0x27
    03B20 E0A0      LDI	R26,0
    03B21 E0B0      LDI	R27,0
    03B22 8429      LDD	R2,Y+9
    03B23 843A      LDD	R3,Y+10
    03B24 844B      LDD	R4,Y+11
    03B25 845C      LDD	R5,Y+12
    03B26 1A28      SUB	R2,R24
    03B27 0A39      SBC	R3,R25
    03B28 0A4A      SBC	R4,R26
    03B29 0A5B      SBC	R5,R27
    03B2A 8629      STD	Y+9,R2
    03B2B 863A      STD	Y+10,R3
    03B2C 864B      STD	Y+11,R4
    03B2D 865C      STD	Y+12,R5
    03B2E E180      LDI	R24,0x10
    03B2F E297      LDI	R25,0x27
    03B30 E0A0      LDI	R26,0
    03B31 E0B0      LDI	R27,0
    03B32 8429      LDD	R2,Y+9
    03B33 843A      LDD	R3,Y+10
    03B34 844B      LDD	R4,Y+11
    03B35 845C      LDD	R5,Y+12
    03B36 1628      CP	R2,R24
    03B37 0639      CPC	R3,R25
    03B38 064A      CPC	R4,R26
    03B39 065B      CPC	R5,R27
    03B3A F700      BCC	0x3B1B
(0088) 	if(da[4])	i=0;
    03B3B 802C      LDD	R2,Y+4
    03B3C 2022      TST	R2
    03B3D F009      BEQ	0x3B3F
    03B3E 2744      CLR	R20
(0089) 	if(i==0)	Usart_Transmit('0'+da[4]);
    03B3F 2344      TST	R20
    03B40 F4B9      BNE	0x3B58
    03B41 810C      LDD	R16,Y+4
    03B42 5D00      SUBI	R16,0xD0
    03B43 DEF4      RCALL	_Usart_Transmit
    03B44 C013      RJMP	0x3B58
(0090) 	while(data>=1000L)    { ++da[3];data-=1000L;}
    03B45 818B      LDD	R24,Y+3
    03B46 5F8F      SUBI	R24,0xFF
    03B47 838B      STD	Y+3,R24
    03B48 EE88      LDI	R24,0xE8
    03B49 E093      LDI	R25,3
    03B4A E0A0      LDI	R26,0
    03B4B E0B0      LDI	R27,0
    03B4C 8429      LDD	R2,Y+9
    03B4D 843A      LDD	R3,Y+10
    03B4E 844B      LDD	R4,Y+11
    03B4F 845C      LDD	R5,Y+12
    03B50 1A28      SUB	R2,R24
    03B51 0A39      SBC	R3,R25
    03B52 0A4A      SBC	R4,R26
    03B53 0A5B      SBC	R5,R27
    03B54 8629      STD	Y+9,R2
    03B55 863A      STD	Y+10,R3
    03B56 864B      STD	Y+11,R4
    03B57 865C      STD	Y+12,R5
    03B58 EE88      LDI	R24,0xE8
    03B59 E093      LDI	R25,3
    03B5A E0A0      LDI	R26,0
    03B5B E0B0      LDI	R27,0
    03B5C 8429      LDD	R2,Y+9
    03B5D 843A      LDD	R3,Y+10
    03B5E 844B      LDD	R4,Y+11
    03B5F 845C      LDD	R5,Y+12
    03B60 1628      CP	R2,R24
    03B61 0639      CPC	R3,R25
    03B62 064A      CPC	R4,R26
    03B63 065B      CPC	R5,R27
    03B64 F700      BCC	0x3B45
(0091) 	if(da[3])	i=0;
    03B65 802B      LDD	R2,Y+3
    03B66 2022      TST	R2
    03B67 F009      BEQ	0x3B69
    03B68 2744      CLR	R20
(0092) 	if(i==0)	Usart_Transmit('0'+da[3]);
    03B69 2344      TST	R20
    03B6A F4B9      BNE	0x3B82
    03B6B 810B      LDD	R16,Y+3
    03B6C 5D00      SUBI	R16,0xD0
    03B6D DECA      RCALL	_Usart_Transmit
    03B6E C013      RJMP	0x3B82
(0093) 	while(data>=100L)     { ++da[2];data-=100L;}
    03B6F 818A      LDD	R24,Y+2
    03B70 5F8F      SUBI	R24,0xFF
    03B71 838A      STD	Y+2,R24
    03B72 E684      LDI	R24,0x64
    03B73 E090      LDI	R25,0
    03B74 E0A0      LDI	R26,0
    03B75 E0B0      LDI	R27,0
    03B76 8429      LDD	R2,Y+9
    03B77 843A      LDD	R3,Y+10
    03B78 844B      LDD	R4,Y+11
    03B79 845C      LDD	R5,Y+12
    03B7A 1A28      SUB	R2,R24
    03B7B 0A39      SBC	R3,R25
    03B7C 0A4A      SBC	R4,R26
    03B7D 0A5B      SBC	R5,R27
    03B7E 8629      STD	Y+9,R2
    03B7F 863A      STD	Y+10,R3
    03B80 864B      STD	Y+11,R4
    03B81 865C      STD	Y+12,R5
    03B82 E684      LDI	R24,0x64
    03B83 E090      LDI	R25,0
    03B84 E0A0      LDI	R26,0
    03B85 E0B0      LDI	R27,0
    03B86 8429      LDD	R2,Y+9
    03B87 843A      LDD	R3,Y+10
    03B88 844B      LDD	R4,Y+11
    03B89 845C      LDD	R5,Y+12
    03B8A 1628      CP	R2,R24
    03B8B 0639      CPC	R3,R25
    03B8C 064A      CPC	R4,R26
    03B8D 065B      CPC	R5,R27
    03B8E F700      BCC	0x3B6F
(0094) 	if(da[2])	i=0;
    03B8F 802A      LDD	R2,Y+2
    03B90 2022      TST	R2
    03B91 F009      BEQ	0x3B93
    03B92 2744      CLR	R20
(0095) 	if(i==0)	Usart_Transmit('0'+da[2]);
    03B93 2344      TST	R20
    03B94 F4B9      BNE	0x3BAC
    03B95 810A      LDD	R16,Y+2
    03B96 5D00      SUBI	R16,0xD0
    03B97 DEA0      RCALL	_Usart_Transmit
    03B98 C013      RJMP	0x3BAC
(0096) 	while(data>=10L)      { ++da[1];data-=10L;}
    03B99 8189      LDD	R24,Y+1
    03B9A 5F8F      SUBI	R24,0xFF
    03B9B 8389      STD	Y+1,R24
    03B9C E08A      LDI	R24,0xA
    03B9D E090      LDI	R25,0
    03B9E E0A0      LDI	R26,0
    03B9F E0B0      LDI	R27,0
    03BA0 8429      LDD	R2,Y+9
    03BA1 843A      LDD	R3,Y+10
    03BA2 844B      LDD	R4,Y+11
    03BA3 845C      LDD	R5,Y+12
    03BA4 1A28      SUB	R2,R24
    03BA5 0A39      SBC	R3,R25
    03BA6 0A4A      SBC	R4,R26
    03BA7 0A5B      SBC	R5,R27
    03BA8 8629      STD	Y+9,R2
    03BA9 863A      STD	Y+10,R3
    03BAA 864B      STD	Y+11,R4
    03BAB 865C      STD	Y+12,R5
    03BAC E08A      LDI	R24,0xA
    03BAD E090      LDI	R25,0
    03BAE E0A0      LDI	R26,0
    03BAF E0B0      LDI	R27,0
    03BB0 8429      LDD	R2,Y+9
    03BB1 843A      LDD	R3,Y+10
    03BB2 844B      LDD	R4,Y+11
    03BB3 845C      LDD	R5,Y+12
    03BB4 1628      CP	R2,R24
    03BB5 0639      CPC	R3,R25
    03BB6 064A      CPC	R4,R26
    03BB7 065B      CPC	R5,R27
    03BB8 F700      BCC	0x3B99
(0097) 	if(da[1])	i=0;
    03BB9 8029      LDD	R2,Y+1
    03BBA 2022      TST	R2
    03BBB F009      BEQ	0x3BBD
    03BBC 2744      CLR	R20
(0098) 	if(i==0)	Usart_Transmit('0'+da[1]);
    03BBD 2344      TST	R20
    03BBE F419      BNE	0x3BC2
    03BBF 8109      LDD	R16,Y+1
    03BC0 5D00      SUBI	R16,0xD0
    03BC1 DE76      RCALL	_Usart_Transmit
(0099) 	Usart_Transmit('0'+data);
    03BC2 E380      LDI	R24,0x30
    03BC3 E090      LDI	R25,0
    03BC4 E0A0      LDI	R26,0
    03BC5 E0B0      LDI	R27,0
    03BC6 8429      LDD	R2,Y+9
    03BC7 843A      LDD	R3,Y+10
    03BC8 844B      LDD	R4,Y+11
    03BC9 845C      LDD	R5,Y+12
    03BCA 0E28      ADD	R2,R24
    03BCB 1E39      ADC	R3,R25
    03BCC 1E4A      ADC	R4,R26
    03BCD 1E5B      ADC	R5,R27
    03BCE 2D02      MOV	R16,R2
    03BCF DE68      RCALL	_Usart_Transmit
    03BD0 9628      ADIW	R28,0x8
    03BD1 9149      LD	R20,Y+
    03BD2 9624      ADIW	R28,4
    03BD3 9508      RET
_PrintChar:
  h                    --> R20
  d                    --> R22
    03BD4 934A      ST	-Y,R20
    03BD5 936A      ST	-Y,R22
    03BD6 2F60      MOV	R22,R16
(0100)  
(0101) }
(0102)  
(0103) void PrintChar(unsigned char d)
(0104) {
(0105) 	unsigned char h=(d&0xF0)>>4;
    03BD7 2F46      MOV	R20,R22
    03BD8 7F40      ANDI	R20,0xF0
    03BD9 9542      SWAP	R20
    03BDA 704F      ANDI	R20,0xF
(0106) 	if(h<10)	Usart_Transmit('0'+h);
    03BDB 304A      CPI	R20,0xA
    03BDC F420      BCC	0x3BE1
    03BDD 2F04      MOV	R16,R20
    03BDE 5D00      SUBI	R16,0xD0
    03BDF DE58      RCALL	_Usart_Transmit
    03BE0 C003      RJMP	0x3BE4
(0107) 	else		Usart_Transmit('A'-10+h);
    03BE1 2F04      MOV	R16,R20
    03BE2 5C09      SUBI	R16,0xC9
    03BE3 DE54      RCALL	_Usart_Transmit
(0108) 	h=d&0x0f;
    03BE4 2F46      MOV	R20,R22
    03BE5 704F      ANDI	R20,0xF
(0109) 	if(h<10)	Usart_Transmit('0'+h);
    03BE6 304A      CPI	R20,0xA
    03BE7 F420      BCC	0x3BEC
    03BE8 2F04      MOV	R16,R20
    03BE9 5D00      SUBI	R16,0xD0
    03BEA DE4D      RCALL	_Usart_Transmit
    03BEB C003      RJMP	0x3BEF
(0110) 	else		Usart_Transmit('A'-10+h);
    03BEC 2F04      MOV	R16,R20
    03BED 5C09      SUBI	R16,0xC9
    03BEE DE49      RCALL	_Usart_Transmit
(0111) 	Usart_Transmit(' ');
    03BEF E200      LDI	R16,0x20
    03BF0 DE47      RCALL	_Usart_Transmit
    03BF1 9169      LD	R22,Y+
    03BF2 9149      LD	R20,Y+
    03BF3 9508      RET
FILE: D:\LQD\software\software_src\SPI.c
(0001) //*****************************************************************************//
(0002) //*								 
(0003) //*控制芯片：ATmgea128
(0004) //*开发环境：AVR Studio+GCC
(0005) //*隶属模块：SPI接口控制
(0006) //*****************************************************************************//
(0007) #include "SPI.h"
(0008) 
(0009) /******************************************************************
(0010) SPI接口函数初始化
(0011) ******************************************************************/
(0012) void SPI_IO_Init(void)
(0013) {
(0014) 	SPI_PORT |= (1<<SS);////拉高CS
_SPI_IO_Init:
    03BF4 9AC0      SBI	0x18,0
(0015) 	SPI_DDR |= (1<<SCLK)|(1<<MOSI)|(1<<SS);////CS,CLK,MOSI设为输出
    03BF5 B387      IN	R24,0x17
    03BF6 6087      ORI	R24,7
    03BF7 BB87      OUT	0x17,R24
(0016) 	SPI_DDR &=~(1<<MISO);//MISO设为输入
    03BF8 98BB      CBI	0x17,3
(0017) 	SPI_PORT |= (1<<SCLK);//拉高CLK
    03BF9 9AC1      SBI	0x18,1
(0018) 	SPI_High();//SPI高通
    03BFA E580      LDI	R24,0x50
    03BFB B98D      OUT	0x0D,R24
    03BFC 9A70      SBI	0x0E,0
    03BFD 9508      RET
(0019) }
(0020) /******************************************************************
(0021) SPI写一个字节
(0022) ******************************************************************/
(0023) void SPI_Write(UINT8 data)
(0024) {
(0025) 	SPDR = data;
_SPI_Write:
  data                 --> R16
    03BFE B90F      OUT	0x0F,R16
(0026) 	while ((SPSR&(1<<SPIF))==0);
    03BFF 9B77      SBIS	0x0E,7
    03C00 CFFE      RJMP	0x3BFF
    03C01 9508      RET
(0027) 	//loop_until_bit_is_set(SPSR,SPIF);
(0028) }
(0029) /******************************************************************
(0030) SPI读一个字节
(0031) ******************************************************************/
(0032) unsigned char SPI_Read(void)
(0033) {
(0034) 	SPDR = 0xFF;//写0xFF启动SPI
_SPI_Read:
    03C02 EF8F      LDI	R24,0xFF
    03C03 B98F      OUT	0x0F,R24
(0035) 	while ((SPSR&(1<<SPIF))==0);
    03C04 9B77      SBIS	0x0E,7
    03C05 CFFE      RJMP	0x3C04
(0036) 	//loop_until_bit_is_set(SPSR,SPIF);//等待SPIF为高电平
(0037) 	return  SPDR;//返回读取值
    03C06 B10F      IN	R16,0x0F
    03C07 9508      RET
FILE: D:\LQD\software\software_src\lcd.c
(0001) #include "config.h"
(0002) 
(0003) //此硬件引脚适合冷强度检测仪第2版电路  mega128
(0004) #define LCD_PIN_CS   4
(0005) #define LCD_PIN_SID  3
(0006) #define LCD_PIN_SCLK 2
(0007) #define LCD_PIN_RST  1
(0008) #define LCD_BACKLIGHT_SW		0
(0009) #define LCD_PORT PORTC
(0010) #define LCD_PIN_DDR DDRC
(0011) #define Set_CS()     LCD_PIN_DDR |= (1<<LCD_PIN_CS)  ;LCD_PORT |= (1<<LCD_PIN_CS) 
(0012) #define Set_SID()    LCD_PIN_DDR |= (1<<LCD_PIN_SID) ;LCD_PORT |= (1<<LCD_PIN_SID) 
(0013) #define Set_SCLK()   LCD_PIN_DDR |= (1<<LCD_PIN_SCLK);LCD_PORT |= (1<<LCD_PIN_SCLK) 
(0014) #define LCD_LIGHT_ON()   LCD_PIN_DDR |= (1<<LCD_BACKLIGHT_SW);LCD_PORT |= (1<<LCD_BACKLIGHT_SW) 
(0015) #define Set_RST()   LCD_PIN_DDR |= (1<<LCD_PIN_RST);LCD_PORT |= (1<<LCD_PIN_RST) 
(0016) 
(0017) #define Clr_CS()     LCD_PIN_DDR |= (1<<LCD_PIN_CS)  ;LCD_PORT &=~(1<<LCD_PIN_CS) 
(0018) #define Clr_SID()    LCD_PIN_DDR |= (1<<LCD_PIN_SID) ;LCD_PORT &=~(1<<LCD_PIN_SID) 
(0019) #define Clr_SCLK()   LCD_PIN_DDR |= (1<<LCD_PIN_SCLK);LCD_PORT &=~(1<<LCD_PIN_SCLK) 
(0020) #define LCD_LIGHT_OFF()   LCD_PIN_DDR |= (1<<LCD_BACKLIGHT_SW);LCD_PORT &=~(1<<LCD_BACKLIGHT_SW) 
(0021) #define Clr_RST()   LCD_PIN_DDR |= (1<<LCD_PIN_RST);LCD_PORT &=~(1<<LCD_PIN_RST) 
(0022)  
(0023) void W_1byte(unsigned char RW, unsigned char RS, unsigned char W_data); 
(0024) void Write_8bits(unsigned int W_bits); 
(0025) void LCD_Init(void); 
(0026) unsigned char LCD_INT(void); 
(0027) 
(0028) unsigned char LCD_SW(unsigned char i)
(0029) {
(0030)  if(i==0){
_LCD_SW:
  i                    --> R16
    03C08 2300      TST	R16
    03C09 F421      BNE	0x3C0E
(0031)  LCD_LIGHT_OFF();
    03C0A 9AA0      SBI	0x14,0
    03C0B 98A8      CBI	0x15,0
(0032)  return 0;
    03C0C 2700      CLR	R16
    03C0D C003      RJMP	0x3C11
(0033)  }
(0034)  else{
(0035)  LCD_LIGHT_ON();
    03C0E 9AA0      SBI	0x14,0
    03C0F 9AA8      SBI	0x15,0
(0036)  return 1;
    03C10 E001      LDI	R16,1
    03C11 9508      RET
(0037)  }
(0038)  
(0039) }
(0040)  
(0041) unsigned char LCD_INT(void) 
(0042) { 
(0043)   Clr_CS(); 
_LCD_INT:
    03C12 9AA4      SBI	0x14,4
    03C13 98AC      CBI	0x15,4
(0044)   Clr_SID(); 
    03C14 9AA3      SBI	0x14,3
    03C15 98AB      CBI	0x15,3
(0045)   Clr_SCLK(); 
    03C16 9AA2      SBI	0x14,2
    03C17 98AA      CBI	0x15,2
(0046)   LCD_Init(); 
    03C18 D097      RCALL	_LCD_Init
(0047)   return (0);
    03C19 2700      CLR	R16
    03C1A 9508      RET
_address:
  a                    --> R20
  y                    --> R18
  x                    --> R16
    03C1B 940E 485A CALL	push_xgsetF000
(0048) } 
(0049)   
(0050) /******************************************************************** 
(0051) 函数 名：address
(0052) 入口参数：地址转换
(0053) 出口参数：无 
(0054) 函数作用： 
(0055) 说        明： 
(0056) ********************************************************************/ 
(0057) unsigned char address(unsigned char x,unsigned char y)
(0058) {  
(0059)  unsigned char a;
(0060) 
(0061) switch(x) 
    03C1D 2F60      MOV	R22,R16
    03C1E 2777      CLR	R23
    03C1F 3061      CPI	R22,1
    03C20 E0E0      LDI	R30,0
    03C21 077E      CPC	R23,R30
    03C22 F069      BEQ	0x3C30
    03C23 3062      CPI	R22,2
    03C24 E0E0      LDI	R30,0
    03C25 077E      CPC	R23,R30
    03C26 F059      BEQ	0x3C32
    03C27 3063      CPI	R22,3
    03C28 E0E0      LDI	R30,0
    03C29 077E      CPC	R23,R30
    03C2A F049      BEQ	0x3C34
    03C2B 3064      CPI	R22,4
    03C2C E0E0      LDI	R30,0
    03C2D 077E      CPC	R23,R30
    03C2E F039      BEQ	0x3C36
    03C2F C007      RJMP	0x3C37
(0062) { 
(0063) case 1: 
(0064) {a=0x80;break;} 
    03C30 E840      LDI	R20,0x80
    03C31 C005      RJMP	0x3C37
(0065) case 2: 
(0066) {a=0x90;break;} 
    03C32 E940      LDI	R20,0x90
    03C33 C003      RJMP	0x3C37
(0067)   case 3: 
(0068) {a=0x88;break;} 
    03C34 E848      LDI	R20,0x88
    03C35 C001      RJMP	0x3C37
(0069)   case 4: 
(0070) {a=0x98;break;} 
    03C36 E948      LDI	R20,0x98
(0071) } 
(0072) a=a+y-1;
    03C37 0F42      ADD	R20,R18
    03C38 5041      SUBI	R20,1
(0073) 
(0074) return a;
    03C39 2F04      MOV	R16,R20
    03C3A 940C 485F JMP	pop_xgsetF000
_LCD_const_disp:
  a                    --> R12
  i                    --> R20
  single_data          --> R10
  y                    --> R14
  x                    --> R12
    03C3C 940E 4847 CALL	push_xgset30FC
    03C3E 2EE2      MOV	R14,R18
    03C3F 2EC0      MOV	R12,R16
    03C40 9721      SBIW	R28,1
    03C41 84A9      LDD	R10,Y+9
    03C42 84BA      LDD	R11,Y+10
(0075) }
(0076)  
(0077) //////////////////////////////////////////////////////////////
(0078) 
(0079) /******************************************************************** 
(0080) 函数 名：LCD_const_disp
(0081) 入口参数：x y  *single_data
(0082) 出口参数：无 
(0083) 函数作用：负责 显示一串常量
(0084) 说        明： 
(0085) ********************************************************************/ 
(0086) void LCD_const_disp(unsigned char x, unsigned char y, const unsigned char *single_data) 
(0087) { 
(0088) unsigned char  a,i; 
(0089) a=address(x,y);
    03C43 2D2E      MOV	R18,R14
    03C44 2D0C      MOV	R16,R12
    03C45 DFD5      RCALL	_address
    03C46 2EC0      MOV	R12,R16
(0090) W_1byte(0,0,a);     //显示的地址 
    03C47 82C8      ST	Y,R12
    03C48 2722      CLR	R18
    03C49 2700      CLR	R16
    03C4A D0B7      RCALL	_W_1byte
(0091)    for(i=0; single_data[i]!='\0';i++) 
    03C4B 2744      CLR	R20
    03C4C C00D      RJMP	0x3C5A
(0092)    {
(0093)     if(i>=16) break; 
    03C4D 3140      CPI	R20,0x10
    03C4E F008      BCS	0x3C50
    03C4F C011      RJMP	0x3C61
(0094)     W_1byte(0,1,single_data[i]); 
    03C50 2FE4      MOV	R30,R20
    03C51 27FF      CLR	R31
    03C52 0DEA      ADD	R30,R10
    03C53 1DFB      ADC	R31,R11
    03C54 8020      LD	R2,Z
    03C55 8228      ST	Y,R2
    03C56 E021      LDI	R18,1
    03C57 2700      CLR	R16
    03C58 D0A9      RCALL	_W_1byte
    03C59 9543      INC	R20
    03C5A 2FE4      MOV	R30,R20
    03C5B 27FF      CLR	R31
    03C5C 0DEA      ADD	R30,R10
    03C5D 1DFB      ADC	R31,R11
    03C5E 8020      LD	R2,Z
    03C5F 2022      TST	R2
    03C60 F761      BNE	0x3C4D
(0095)     
(0096)    } 
(0097)    W_1byte(0,0,0XFF); // 移走地址指针 防止下一输入内容的干扰
    03C61 EF8F      LDI	R24,0xFF
    03C62 8388      ST	Y,R24
    03C63 2722      CLR	R18
    03C64 2700      CLR	R16
    03C65 D09C      RCALL	_W_1byte
    03C66 9621      ADIW	R28,1
    03C67 940C 4831 JMP	pop_xgset30FC
_LCD_var_disp:
  a                    --> R12
  i                    --> R20
  single_data          --> R10
  y                    --> R14
  x                    --> R12
    03C69 940E 4847 CALL	push_xgset30FC
    03C6B 2EE2      MOV	R14,R18
    03C6C 2EC0      MOV	R12,R16
    03C6D 9721      SBIW	R28,1
    03C6E 84A9      LDD	R10,Y+9
    03C6F 84BA      LDD	R11,Y+10
(0098)  
(0099) } 
(0100) 
(0101) /******************************************************************** 
(0102) 函数 名：LCD_var_disp
(0103) 入口参数：single_row single_line  *single_data
(0104) 出口参数：无 
(0105) 函数作用：负责 显示一串变量
(0106) 说        明： 
(0107) ********************************************************************/ 
(0108) 
(0109) void LCD_var_disp(unsigned char x, unsigned char y, unsigned char *single_data) 
(0110) { 
(0111) unsigned char  a,i; 
(0112) 
(0113) #if _debug == 1 
(0114) 	PrintString_n(single_data);
(0115) #endif 
(0116) 
(0117) a=address( x,y);
    03C70 2D2E      MOV	R18,R14
    03C71 2D0C      MOV	R16,R12
    03C72 DFA8      RCALL	_address
    03C73 2EC0      MOV	R12,R16
(0118) W_1byte(0,0,a);     //显示的地址0x88 
    03C74 82C8      ST	Y,R12
    03C75 2722      CLR	R18
    03C76 2700      CLR	R16
    03C77 D08A      RCALL	_W_1byte
(0119) 
(0120) for(i=0; single_data[i]!='\0';i++) 
    03C78 2744      CLR	R20
    03C79 C00D      RJMP	0x3C87
(0121)    { 
(0122)     if(i>=16) break;
    03C7A 3140      CPI	R20,0x10
    03C7B F008      BCS	0x3C7D
    03C7C C011      RJMP	0x3C8E
(0123)     W_1byte(0,1,single_data[i]); 
    03C7D 2FE4      MOV	R30,R20
    03C7E 27FF      CLR	R31
    03C7F 0DEA      ADD	R30,R10
    03C80 1DFB      ADC	R31,R11
    03C81 8020      LD	R2,Z
    03C82 8228      ST	Y,R2
    03C83 E021      LDI	R18,1
    03C84 2700      CLR	R16
    03C85 D07C      RCALL	_W_1byte
    03C86 9543      INC	R20
    03C87 2FE4      MOV	R30,R20
    03C88 27FF      CLR	R31
    03C89 0DEA      ADD	R30,R10
    03C8A 1DFB      ADC	R31,R11
    03C8B 8020      LD	R2,Z
    03C8C 2022      TST	R2
    03C8D F761      BNE	0x3C7A
(0124) 	} 
(0125)   W_1byte(0,0,0XFF); // 移走地址指针 防止下一输入内容的干扰
    03C8E EF8F      LDI	R24,0xFF
    03C8F 8388      ST	Y,R24
    03C90 2722      CLR	R18
    03C91 2700      CLR	R16
    03C92 D06F      RCALL	_W_1byte
    03C93 9621      ADIW	R28,1
    03C94 940C 4831 JMP	pop_xgset30FC
_LCD_char_disp:
  a                    --> R12
  data                 --> R10
  y                    --> R14
  x                    --> R12
    03C96 940E 4849 CALL	push_xgset00FC
    03C98 2EE2      MOV	R14,R18
    03C99 2EC0      MOV	R12,R16
    03C9A 9721      SBIW	R28,1
    03C9B 80AF      LDD	R10,Y+7
(0126) } 
(0127) /******************************************************************** 
(0128) 函数 名：LCD_char_disp
(0129) 入口参数：single_row single_line  data
(0130) 出口参数：无 
(0131) 函数作用：负责 显示一个 变量
(0132) 说        明： 
(0133) ********************************************************************/ 
(0134) 
(0135) void LCD_char_disp(unsigned char x, unsigned char y, unsigned char data) 
(0136) { 
(0137) unsigned char a; 
(0138) a=address(x,y);
    03C9C 2D2E      MOV	R18,R14
    03C9D 2D0C      MOV	R16,R12
    03C9E DF7C      RCALL	_address
    03C9F 2EC0      MOV	R12,R16
(0139) W_1byte(0,0,a);     //显示的地址 
    03CA0 82C8      ST	Y,R12
    03CA1 2722      CLR	R18
    03CA2 2700      CLR	R16
    03CA3 D05E      RCALL	_W_1byte
(0140) W_1byte(0,1,data);  //显示内容
    03CA4 82A8      ST	Y,R10
    03CA5 E021      LDI	R18,1
    03CA6 2700      CLR	R16
    03CA7 D05A      RCALL	_W_1byte
(0141)  
(0142)   W_1byte(0,0,0XFF); // 移走地址指针 防止下一输入内容的干扰
    03CA8 EF8F      LDI	R24,0xFF
    03CA9 8388      ST	Y,R24
    03CAA 2722      CLR	R18
    03CAB 2700      CLR	R16
    03CAC D055      RCALL	_W_1byte
    03CAD 9621      ADIW	R28,1
    03CAE 940C 482A JMP	pop_xgset00FC
_LCD_Init:
  cmd                  --> R20
    03CB0 934A      ST	-Y,R20
    03CB1 9721      SBIW	R28,1
(0143) } 
(0144) 
(0145) /******************************************************************** 
(0146) 函数 名：LCD_Init
(0147) 入口参数：无
(0148) 出口参数：unsigned char  0/1
(0149) 函数作用：负责 清空液晶显示
(0150) 说        明： 
(0151) ********************************************************************/ 
(0152) void LCD_Init(void) 
(0153) { 
(0154)    unsigned char cmd; 
(0155)    cmd=0x30;      //功能设置 8 位数据，基本指令 
    03CB2 E340      LDI	R20,0x30
(0156)   W_1byte(0,0,cmd); 
    03CB3 8348      ST	Y,R20
    03CB4 2722      CLR	R18
    03CB5 2700      CLR	R16
    03CB6 D04B      RCALL	_W_1byte
(0157)   delayms(2); 
    03CB7 E002      LDI	R16,2
    03CB8 E010      LDI	R17,0
    03CB9 940E 2511 CALL	_delayms
(0158)   cmd=0x0C;      //显示状态 ON，游标OFF，反白OFF 
    03CBB E04C      LDI	R20,0xC
(0159)   W_1byte(0,0,cmd); //写指令 
    03CBC 8348      ST	Y,R20
    03CBD 2722      CLR	R18
    03CBE 2700      CLR	R16
    03CBF D042      RCALL	_W_1byte
(0160)   delayms(2); 
    03CC0 E002      LDI	R16,2
    03CC1 E010      LDI	R17,0
    03CC2 940E 2511 CALL	_delayms
(0161)   cmd=0x01;      //清除显示 
    03CC4 E041      LDI	R20,1
(0162)   W_1byte(0,0,cmd); //写指令 
    03CC5 8348      ST	Y,R20
    03CC6 2722      CLR	R18
    03CC7 2700      CLR	R16
    03CC8 D039      RCALL	_W_1byte
(0163)   delayms(2); 
    03CC9 E002      LDI	R16,2
    03CCA E010      LDI	R17,0
    03CCB 940E 2511 CALL	_delayms
(0164)   cmd=0x02;      //地址归位 
    03CCD E042      LDI	R20,2
(0165)   W_1byte(0,0,cmd); //写指令 
    03CCE 8348      ST	Y,R20
    03CCF 2722      CLR	R18
    03CD0 2700      CLR	R16
    03CD1 D030      RCALL	_W_1byte
(0166)   delayms(2); 
    03CD2 E002      LDI	R16,2
    03CD3 E010      LDI	R17,0
    03CD4 940E 2511 CALL	_delayms
(0167)   cmd=0x80;      //设置DDRAM 地址 
    03CD6 E840      LDI	R20,0x80
(0168)   W_1byte(0,0,cmd); //写指令 
    03CD7 8348      ST	Y,R20
    03CD8 2722      CLR	R18
    03CD9 2700      CLR	R16
    03CDA D027      RCALL	_W_1byte
(0169)   delayms(2);     //延时 
    03CDB E002      LDI	R16,2
    03CDC E010      LDI	R17,0
    03CDD 940E 2511 CALL	_delayms
    03CDF 9621      ADIW	R28,1
    03CE0 9149      LD	R20,Y+
    03CE1 9508      RET
_LCD_CLR:
  cmd                  --> R20
    03CE2 934A      ST	-Y,R20
    03CE3 9721      SBIW	R28,1
(0170) } 
(0171) 
(0172) void LCD_CLR(void)
(0173) {
(0174) unsigned char cmd;
(0175)   cmd=0x01;      //清除显示 
    03CE4 E041      LDI	R20,1
(0176)   W_1byte(0,0,cmd); //写指令 
    03CE5 8348      ST	Y,R20
    03CE6 2722      CLR	R18
    03CE7 2700      CLR	R16
    03CE8 D019      RCALL	_W_1byte
(0177)   delayms(1); 
    03CE9 E001      LDI	R16,1
    03CEA E010      LDI	R17,0
    03CEB 940E 2511 CALL	_delayms
(0178)   cmd=0x02;      //地址归位 
    03CED E042      LDI	R20,2
(0179)   W_1byte(0,0,cmd); //写指令 
    03CEE 8348      ST	Y,R20
    03CEF 2722      CLR	R18
    03CF0 2700      CLR	R16
    03CF1 D010      RCALL	_W_1byte
(0180)   delayms(1); 
    03CF2 E001      LDI	R16,1
    03CF3 E010      LDI	R17,0
    03CF4 940E 2511 CALL	_delayms
(0181)   cmd=0x80;      //设置DDRAM 地址 
    03CF6 E840      LDI	R20,0x80
(0182)   W_1byte(0,0,cmd); //写指令 
    03CF7 8348      ST	Y,R20
    03CF8 2722      CLR	R18
    03CF9 2700      CLR	R16
    03CFA D007      RCALL	_W_1byte
(0183)   delayms(1);     //延时
    03CFB E001      LDI	R16,1
    03CFC E010      LDI	R17,0
    03CFD 940E 2511 CALL	_delayms
    03CFF 9621      ADIW	R28,1
    03D00 9149      LD	R20,Y+
    03D01 9508      RET
_W_1byte:
  H_data               --> R22
  S_ID                 --> R10
  L_data               --> R20
  W_data               --> R12
  RS                   --> R14
  RW                   --> R20
    03D02 940E 4845 CALL	push_xgsetF0FC
    03D04 2EE2      MOV	R14,R18
    03D05 2F40      MOV	R20,R16
    03D06 84CA      LDD	R12,Y+10
(0184) 
(0185) }
(0186)  
(0187) /*******************************************************************
(0188) 函 数 名：W_1byte
(0189) 入口参数：RW、RS、W_data
(0190) 出口参数：无
(0191) 建立日期：2007年3月3日
(0192) 修改日期：
(0193) 函数作用：写一个字节的数据到12864液晶，包括指令和数据
(0194) 说    明：RW=1，从液晶读数据到MCU；RW=0，写一个数据到液晶；
(0195) 		 （一般RW都设为0，即只向液晶写数据，不读数据）
(0196)           RS=1，写入的是数据；RS=0，写入的是指令；
(0197) 		  一般模式：RW=0，RS=1;写数据
(0198) 		  			RW=0，RS=0;写指令
(0199) ********************************************************************/
(0200) void W_1byte(unsigned char RW, unsigned char RS, unsigned char W_data)
(0201) {
(0202) 	unsigned int H_data,L_data,S_ID = 0xf8;	 //11111RWRS0
    03D07 EF88      LDI	R24,0xF8
    03D08 E090      LDI	R25,0
    03D09 015C      MOVW	R10,R24
(0203) 	if(RW == 0)
    03D0A 2344      TST	R20
    03D0B F419      BNE	0x3D0F
(0204) 	{
(0205) 	 	S_ID &=~ 0x04;
    03D0C 7F8B      ANDI	R24,0xFB
    03D0D 015C      MOVW	R10,R24
(0206) 	}
    03D0E C003      RJMP	0x3D12
(0207) 	else					//if(RW==1)
(0208) 	{
(0209) 	 	S_ID |= 0X04;
    03D0F 01C5      MOVW	R24,R10
    03D10 6084      ORI	R24,4
    03D11 015C      MOVW	R10,R24
(0210) 	}
(0211) 	if(RS == 0)
    03D12 20EE      TST	R14
    03D13 F421      BNE	0x3D18
(0212) 	{
(0213) 	 	S_ID &=~ 0x02;
    03D14 01C5      MOVW	R24,R10
    03D15 7F8D      ANDI	R24,0xFD
    03D16 015C      MOVW	R10,R24
(0214) 	}
    03D17 C003      RJMP	0x3D1B
(0215) 	else					//if(RS==1)
(0216) 	{
(0217) 	 	S_ID |= 0X02;
    03D18 01C5      MOVW	R24,R10
    03D19 6082      ORI	R24,2
    03D1A 015C      MOVW	R10,R24
(0218) 	}
(0219) 	H_data = W_data;
    03D1B 2D6C      MOV	R22,R12
    03D1C 2777      CLR	R23
(0220) 	H_data &= 0xf0;			//屏蔽低4位的数据
    03D1D 7F60      ANDI	R22,0xF0
    03D1E 7070      ANDI	R23,0
(0221) 	L_data = W_data;	   	//xxxx0000格式
    03D1F 2D4C      MOV	R20,R12
    03D20 2755      CLR	R21
(0222) 	L_data &= 0x0f;			//屏蔽高4位的数据
    03D21 704F      ANDI	R20,0xF
    03D22 7050      ANDI	R21,0
(0223) 	L_data <<= 4;			//xxxx0000格式
    03D23 0F44      LSL	R20
    03D24 1F55      ROL	R21
    03D25 0F44      LSL	R20
    03D26 1F55      ROL	R21
    03D27 0F44      LSL	R20
    03D28 1F55      ROL	R21
    03D29 0F44      LSL	R20
    03D2A 1F55      ROL	R21
(0224) 	Set_CS();
    03D2B 9AA4      SBI	0x14,4
    03D2C 9AAC      SBI	0x15,4
(0225) 	Write_8bits(S_ID); 		//发送S_ID
    03D2D 0185      MOVW	R16,R10
    03D2E D00C      RCALL	_Write_8bits
(0226) 	Write_8bits(H_data);	//发送H_data
    03D2F 018B      MOVW	R16,R22
    03D30 D00A      RCALL	_Write_8bits
(0227) 	Write_8bits(L_data);	//发送L_data
    03D31 018A      MOVW	R16,R20
    03D32 D008      RCALL	_Write_8bits
(0228) 	Clr_CS();	Clr_CS();	Clr_CS();	
    03D33 9AA4      SBI	0x14,4
    03D34 98AC      CBI	0x15,4
    03D35 9AA4      SBI	0x14,4
    03D36 98AC      CBI	0x15,4
    03D37 9AA4      SBI	0x14,4
    03D38 98AC      CBI	0x15,4
    03D39 940C 483A JMP	pop_xgsetF0FC
_Write_8bits:
  Temp_data            --> R12
  i                    --> R20
  W_bits               --> R10
    03D3B 940E 4872 CALL	push_xgset303C
    03D3D 0158      MOVW	R10,R16
(0229) 	 
(0230) 
(0231) }
(0232) /********************************************************************
(0233) 函 数 名：Write_8bits
(0234) 入口参数：W_bits
(0235) 出口参数：无
(0236) 建立日期：2007年3月3日
(0237) 修改日期：
(0238) 函数作用：负责串行输出8个bit位
(0239) 说    明：
(0240) ********************************************************************/
(0241) void Write_8bits(unsigned int W_bits)
(0242) {
(0243) 	unsigned int i,Temp_data;
(0244) 	for(i=0; i<8; i++)
    03D3E 2744      CLR	R20
    03D3F 2755      CLR	R21
    03D40 C019      RJMP	0x3D5A
(0245) 	{
(0246) 		Temp_data = W_bits;
    03D41 0165      MOVW	R12,R10
(0247) 		Temp_data <<= i;
    03D42 019A      MOVW	R18,R20
    03D43 0186      MOVW	R16,R12
    03D44 940E 48C9 CALL	lsl16
    03D46 0168      MOVW	R12,R16
(0248) 		if((Temp_data&0x80)==0) 
    03D47 FD07      SBRC	R16,7
    03D48 C003      RJMP	0x3D4C
(0249) 		{
(0250) 		 	Clr_SID();
    03D49 9AA3      SBI	0x14,3
    03D4A 98AB      CBI	0x15,3
(0251) 		}
    03D4B C002      RJMP	0x3D4E
(0252) 		else
(0253) 		{
(0254) 		 	Set_SID();
    03D4C 9AA3      SBI	0x14,3
    03D4D 9AAB      SBI	0x15,3
(0255) 		} 
(0256) 		NOP();
    03D4E 0000      NOP
(0257) 		Set_SCLK();
    03D4F 9AA2      SBI	0x14,2
    03D50 9AAA      SBI	0x15,2
(0258) 		NOP();
    03D51 0000      NOP
(0259) 		NOP();
    03D52 0000      NOP
(0260) 		Clr_SCLK();
    03D53 9AA2      SBI	0x14,2
    03D54 98AA      CBI	0x15,2
(0261) 		NOP();
    03D55 0000      NOP
(0262) 		Clr_SID();
    03D56 9AA3      SBI	0x14,3
    03D57 98AB      CBI	0x15,3
    03D58 5F4F      SUBI	R20,0xFF
    03D59 4F5F      SBCI	R21,0xFF
    03D5A 3048      CPI	R20,0x8
    03D5B E0E0      LDI	R30,0
    03D5C 075E      CPC	R21,R30
    03D5D F318      BCS	0x3D41
    03D5E 940C 4879 JMP	pop_xgset303C
_Set_Draw:
    03D60 9721      SBIW	R28,1
(0263) 	}
(0264) }
(0265)  
(0266) /********************************************************************
(0267) 函 数 名：Set_Draw(
(0268) 入口参数：无
(0269) 出口参数：无
(0270) 函数作用：设置为绘图模式
(0271) 说    明：
(0272) ********************************************************************/
(0273) void Set_Draw(void)
(0274) {  	
(0275) 	//W_1byte(0,0,0x34);			//8BIT控制界面，扩充指令集,，绘图显示OFF
(0276) 	W_1byte(0,0,0x36);
    03D61 E386      LDI	R24,0x36
    03D62 8388      ST	Y,R24
    03D63 2722      CLR	R18
    03D64 2700      CLR	R16
    03D65 DF9C      RCALL	_W_1byte
(0277) 	delayms(1);					//延时
    03D66 E001      LDI	R16,1
    03D67 E010      LDI	R17,0
    03D68 940E 2511 CALL	_delayms
    03D6A 9621      ADIW	R28,1
    03D6B 9508      RET
_Set_White:
  clr_y                --> R10
  clr_x                --> R20
  white_y              --> Y,+2
  white_x              --> Y,+1
  i                    --> R22
  white_end_x          --> R12
  j                    --> R14
  clear                --> Y,+15
  end_x                --> R12
  y                    --> R14
  x                    --> R22
    03D6C 940E 4845 CALL	push_xgsetF0FC
    03D6E 2EE2      MOV	R14,R18
    03D6F 2F60      MOV	R22,R16
    03D70 9723      SBIW	R28,3
    03D71 84CD      LDD	R12,Y+13
(0278) } 
(0279)  
(0280) 
(0281) /******************************************************************** 
(0282) 函数 名：Set_White 
(0283) 入口参数：  x,   y,  end_x,  clear
(0284) 出口参数：无 
(0285) 函数作用： 设置反显
(0286) 说        明： 
(0287) ********************************************************************/ 
(0288) void Set_White(unsigned char x,unsigned char y,unsigned char end_x,unsigned char clear)
(0289) {
(0290)  
(0291) 	unsigned char i, j, white_x, white_y,white_end_x,clr_x,clr_y ;		//
(0292)   
(0293) 	W_1byte(0,0,0x36);	  //8BIT控制界面，扩充指令集,，绘图显示ON
    03D72 E386      LDI	R24,0x36
    03D73 8388      ST	Y,R24
    03D74 2722      CLR	R18
    03D75 2700      CLR	R16
    03D76 DF8B      RCALL	_W_1byte
(0294) 	delayus(20);					//延时
    03D77 E104      LDI	R16,0x14
    03D78 E010      LDI	R17,0
    03D79 940E 2509 CALL	_delayus
(0295)  
(0296) 	white_end_x = (end_x-x+1);
    03D7B 2D8C      MOV	R24,R12
    03D7C 1B86      SUB	R24,R22
    03D7D 5F8F      SUBI	R24,0xFF
    03D7E 2EC8      MOV	R12,R24
(0297) 	white_end_x <<= 1;
    03D7F 0CCC      LSL	R12
(0298) 	if(y==1)   //x,1  a=80+x-1                   
    03D80 2D8E      MOV	R24,R14
    03D81 3081      CPI	R24,1
    03D82 F449      BNE	0x3D8C
(0299) 	{
(0300) 	 	white_x = (0x80+x-1); 
    03D83 2F86      MOV	R24,R22
    03D84 5880      SUBI	R24,0x80
    03D85 5081      SUBI	R24,1
    03D86 8389      STD	Y+1,R24
(0301) 		white_y = 0x80;
    03D87 E880      LDI	R24,0x80
    03D88 838A      STD	Y+2,R24
(0302) 		clr_x = 0x80;
    03D89 E840      LDI	R20,0x80
(0303) 		clr_y = 0x80;
    03D8A 2EA8      MOV	R10,R24
(0304) 	}
    03D8B C023      RJMP	0x3DAF
(0305) 	else if(y==2)
    03D8C 2D8E      MOV	R24,R14
    03D8D 3082      CPI	R24,2
    03D8E F449      BNE	0x3D98
(0306) 	{
(0307) 	 	white_x = (0x80+x-1);
    03D8F 2F86      MOV	R24,R22
    03D90 5880      SUBI	R24,0x80
    03D91 5081      SUBI	R24,1
    03D92 8389      STD	Y+1,R24
(0308) 		white_y = 0x90;
    03D93 E980      LDI	R24,0x90
    03D94 838A      STD	Y+2,R24
(0309) 		clr_x = 0x80;
    03D95 E840      LDI	R20,0x80
(0310) 		clr_y = 0x90;
    03D96 2EA8      MOV	R10,R24
(0311) 	}
    03D97 C017      RJMP	0x3DAF
(0312) 	else if(y==3)
    03D98 2D8E      MOV	R24,R14
    03D99 3083      CPI	R24,3
    03D9A F449      BNE	0x3DA4
(0313) 	{
(0314) 	 	white_x = (0x88+x-1);
    03D9B 2F86      MOV	R24,R22
    03D9C 5788      SUBI	R24,0x78
    03D9D 5081      SUBI	R24,1
    03D9E 8389      STD	Y+1,R24
(0315) 		white_y = 0x80;
    03D9F E880      LDI	R24,0x80
    03DA0 838A      STD	Y+2,R24
(0316) 		clr_x = 0x88;
    03DA1 E848      LDI	R20,0x88
(0317) 		clr_y = 0x80;
    03DA2 2EA8      MOV	R10,R24
(0318) 	}
    03DA3 C00B      RJMP	0x3DAF
(0319) 	else if(y==4)
    03DA4 2D8E      MOV	R24,R14
    03DA5 3084      CPI	R24,4
    03DA6 F441      BNE	0x3DAF
(0320) 	{
(0321) 	 	white_x = (0x88+x-1);
    03DA7 2F86      MOV	R24,R22
    03DA8 5788      SUBI	R24,0x78
    03DA9 5081      SUBI	R24,1
    03DAA 8389      STD	Y+1,R24
(0322) 		white_y = 0x90;
    03DAB E980      LDI	R24,0x90
    03DAC 838A      STD	Y+2,R24
(0323) 		clr_x = 0x88;
    03DAD E848      LDI	R20,0x88
(0324) 		clr_y = 0x90;
    03DAE 2EA8      MOV	R10,R24
(0325) 	}
(0326)   if(clear==0)//要反白时，先将整行的液晶全部清成不反白（此处行指y）
    03DAF 840F      LDD	R0,Y+15
    03DB0 2000      TST	R0
    03DB1 F4E9      BNE	0x3DCF
(0327) 	{
(0328) 	 	for(i=0;i<16;i++ )			//16行
    03DB2 2766      CLR	R22
    03DB3 C019      RJMP	0x3DCD
(0329) 		{
(0330) 		 	W_1byte(0,0,clr_y++);	//设置绘图区的Y地址坐标0
    03DB4 2C2A      MOV	R2,R10
    03DB5 2D82      MOV	R24,R2
    03DB6 5F8F      SUBI	R24,0xFF
    03DB7 2EA8      MOV	R10,R24
    03DB8 8228      ST	Y,R2
    03DB9 2722      CLR	R18
    03DBA 2700      CLR	R16
    03DBB DF46      RCALL	_W_1byte
(0331) 			W_1byte(0,0,clr_x);		//设置绘图区的X地址坐标0
    03DBC 8348      ST	Y,R20
    03DBD 2722      CLR	R18
    03DBE 2700      CLR	R16
    03DBF DF42      RCALL	_W_1byte
(0332) 			for(j=0;j<16;j++)		//
    03DC0 24EE      CLR	R14
    03DC1 C007      RJMP	0x3DC9
(0333) 			{
(0334) 			 	W_1byte(0,1,0x00);	//清成不反白
    03DC2 2422      CLR	R2
    03DC3 8228      ST	Y,R2
    03DC4 E021      LDI	R18,1
    03DC5 2700      CLR	R16
    03DC6 DF3B      RCALL	_W_1byte
(0335) 			 	nop();
    03DC7 0000      NOP
    03DC8 94E3      INC	R14
    03DC9 2D8E      MOV	R24,R14
    03DCA 3180      CPI	R24,0x10
    03DCB F3B0      BCS	0x3DC2
    03DCC 9563      INC	R22
    03DCD 3160      CPI	R22,0x10
    03DCE F328      BCS	0x3DB4
(0336) 			}
(0337) 		}
(0338) 	}
(0339) 	nop();
    03DCF 0000      NOP
(0340) //	
(0341) 	for(i=0;i<16;i++ )				//16行，因为是16*16汉字
    03DD0 2766      CLR	R22
    03DD1 C022      RJMP	0x3DF4
(0342) 	{
(0343) 		W_1byte(0,0,white_y++);		//设置绘图区的Y地址坐标0
    03DD2 802A      LDD	R2,Y+2
    03DD3 2D82      MOV	R24,R2
    03DD4 5F8F      SUBI	R24,0xFF
    03DD5 838A      STD	Y+2,R24
    03DD6 8228      ST	Y,R2
    03DD7 2722      CLR	R18
    03DD8 2700      CLR	R16
    03DD9 DF28      RCALL	_W_1byte
(0344) 		W_1byte(0,0,white_x);		//设置绘图区的X地址坐标0
    03DDA 8009      LDD	R0,Y+1
    03DDB 8208      ST	Y,R0
    03DDC 2722      CLR	R18
    03DDD 2700      CLR	R16
    03DDE DF23      RCALL	_W_1byte
(0345) 		for(j=0;j<white_end_x;j++)	//
    03DDF 24EE      CLR	R14
    03DE0 C010      RJMP	0x3DF1
(0346) 		{
(0347) 			 if(clear==1)
    03DE1 858F      LDD	R24,Y+15
    03DE2 3081      CPI	R24,1
    03DE3 F431      BNE	0x3DEA
(0348) 			 {
(0349) 			  	W_1byte(0,1,0x00); //取消这一行的8个点的反白，液晶地址自动加1
    03DE4 2422      CLR	R2
    03DE5 8228      ST	Y,R2
    03DE6 E021      LDI	R18,1
    03DE7 2700      CLR	R16
    03DE8 DF19      RCALL	_W_1byte
(0350) 								   //（此处行指一个一个液晶点所组成的行）
(0351) 			 }
    03DE9 C005      RJMP	0x3DEF
(0352) 			 else
(0353) 			 {
(0354) 				W_1byte(0,1,0xff); //反白这一行的8个点，液晶地址自动加1
    03DEA EF8F      LDI	R24,0xFF
    03DEB 8388      ST	Y,R24
    03DEC E021      LDI	R18,1
    03DED 2700      CLR	R16
    03DEE DF13      RCALL	_W_1byte
(0355) 								   //（此处行指一个一个液晶点所组成的行）
(0356) 			 }
(0357) 			nop();
    03DEF 0000      NOP
    03DF0 94E3      INC	R14
    03DF1 14EC      CP	R14,R12
    03DF2 F370      BCS	0x3DE1
    03DF3 9563      INC	R22
    03DF4 3160      CPI	R22,0x10
    03DF5 F2E0      BCS	0x3DD2
(0358) 		}
(0359) 	}
(0360) 	W_1byte(0,0,0x30);		//基本指令集,，绘图显示OFF
    03DF6 E380      LDI	R24,0x30
    03DF7 8388      ST	Y,R24
    03DF8 2722      CLR	R18
    03DF9 2700      CLR	R16
    03DFA DF07      RCALL	_W_1byte
    03DFB 9623      ADIW	R28,3
    03DFC 940C 483A JMP	pop_xgsetF0FC
_set_white_n:
  tempendx             --> R10
  tempy                --> R22
  tempx                --> R20
  clear                --> R12
  n                    --> R14
    03DFE 940E 4845 CALL	push_xgsetF0FC
    03E00 2EC2      MOV	R12,R18
    03E01 2EE0      MOV	R14,R16
    03E02 9723      SBIW	R28,3
(0361)  }
(0362) 
(0363) /******************************************************************** 
(0364) 函数 名：set_white_n
(0365) 入口参数： n ,  clear
(0366) 出口参数：无 
(0367) 函数作用：   将四行分成八个位置。n代表位置1-8。本函数用于反显或取消反显
(0368)           某一位置的文字。
(0369) 说        明： 例如 set_white_n(1,0); 表示反显第一行前四个字
(0370) ********************************************************************/ 
(0371) void set_white_n(unsigned char n,unsigned char clear)
(0372) {
(0373) unsigned char tempx,tempy,tempendx;
(0374) if(n==1) {tempx=1;tempy=1;tempendx=4;}
    03E03 2D8E      MOV	R24,R14
    03E04 3081      CPI	R24,1
    03E05 F429      BNE	0x3E0B
    03E06 E041      LDI	R20,1
    03E07 E061      LDI	R22,1
    03E08 E084      LDI	R24,4
    03E09 2EA8      MOV	R10,R24
    03E0A C037      RJMP	0x3E42
(0375) else if(n==2) {tempx=5;tempy=1;tempendx=8;}
    03E0B 2D8E      MOV	R24,R14
    03E0C 3082      CPI	R24,2
    03E0D F429      BNE	0x3E13
    03E0E E045      LDI	R20,5
    03E0F E061      LDI	R22,1
    03E10 E088      LDI	R24,0x8
    03E11 2EA8      MOV	R10,R24
    03E12 C02F      RJMP	0x3E42
(0376) else if(n==3) {tempx=1;tempy=2;tempendx=4;}
    03E13 2D8E      MOV	R24,R14
    03E14 3083      CPI	R24,3
    03E15 F429      BNE	0x3E1B
    03E16 E041      LDI	R20,1
    03E17 E062      LDI	R22,2
    03E18 E084      LDI	R24,4
    03E19 2EA8      MOV	R10,R24
    03E1A C027      RJMP	0x3E42
(0377) else if(n==4) {tempx=5;tempy=2;tempendx=8;}
    03E1B 2D8E      MOV	R24,R14
    03E1C 3084      CPI	R24,4
    03E1D F429      BNE	0x3E23
    03E1E E045      LDI	R20,5
    03E1F E062      LDI	R22,2
    03E20 E088      LDI	R24,0x8
    03E21 2EA8      MOV	R10,R24
    03E22 C01F      RJMP	0x3E42
(0378) else if(n==5) {tempx=1;tempy=3;tempendx=4;}
    03E23 2D8E      MOV	R24,R14
    03E24 3085      CPI	R24,5
    03E25 F429      BNE	0x3E2B
    03E26 E041      LDI	R20,1
    03E27 E063      LDI	R22,3
    03E28 E084      LDI	R24,4
    03E29 2EA8      MOV	R10,R24
    03E2A C017      RJMP	0x3E42
(0379) else if(n==6) {tempx=5;tempy=3;tempendx=8;}
    03E2B 2D8E      MOV	R24,R14
    03E2C 3086      CPI	R24,6
    03E2D F429      BNE	0x3E33
    03E2E E045      LDI	R20,5
    03E2F E063      LDI	R22,3
    03E30 E088      LDI	R24,0x8
    03E31 2EA8      MOV	R10,R24
    03E32 C00F      RJMP	0x3E42
(0380) else if(n==7) {tempx=1;tempy=4;tempendx=4;}
    03E33 2D8E      MOV	R24,R14
    03E34 3087      CPI	R24,7
    03E35 F429      BNE	0x3E3B
    03E36 E041      LDI	R20,1
    03E37 E064      LDI	R22,4
    03E38 E084      LDI	R24,4
    03E39 2EA8      MOV	R10,R24
    03E3A C007      RJMP	0x3E42
(0381) else if(n==8) {tempx=5;tempy=4;tempendx=8;}
    03E3B 2D8E      MOV	R24,R14
    03E3C 3088      CPI	R24,0x8
    03E3D F421      BNE	0x3E42
    03E3E E045      LDI	R20,5
    03E3F E064      LDI	R22,4
    03E40 E088      LDI	R24,0x8
    03E41 2EA8      MOV	R10,R24
(0382) Set_White(tempx,tempy,tempendx,clear);
    03E42 82CA      STD	Y+2,R12
    03E43 82A8      ST	Y,R10
    03E44 2F26      MOV	R18,R22
    03E45 2F04      MOV	R16,R20
    03E46 DF25      RCALL	_Set_White
    03E47 9623      ADIW	R28,3
    03E48 940C 483A JMP	pop_xgsetF0FC
_clr_white:
  clr_x                --> R10
  clr_y                --> R20
  i                    --> R22
  j                    --> R12
    03E4A 940E 4845 CALL	push_xgsetF0FC
    03E4C 9721      SBIW	R28,1
(0383) 
(0384) }
(0385)  
(0386) /******************************************************************** 
(0387) 函数 名：clr_white
(0388) 入口参数： 清所有 反白
(0389) 出口参数：无 
(0390) 函数作用： 
(0391) 说        明： 
(0392) ********************************************************************/ 
(0393) void clr_white(void)
(0394) {      unsigned char i,j;
(0395) 
(0396)        unsigned char  clr_y=0x80;
    03E4D E840      LDI	R20,0x80
(0397) 	   unsigned char  clr_x=0x80;
    03E4E E880      LDI	R24,0x80
    03E4F 2EA8      MOV	R10,R24
(0398) 	   W_1byte(0,0,0x36);	  //8BIT控制界面，扩充指令集,，绘图显示ON
    03E50 E386      LDI	R24,0x36
    03E51 8388      ST	Y,R24
    03E52 2722      CLR	R18
    03E53 2700      CLR	R16
    03E54 DEAD      RCALL	_W_1byte
(0399) 	 	for(i=0;i<16;i++ )			//16行
    03E55 2766      CLR	R22
    03E56 C017      RJMP	0x3E6E
(0400) 		{
(0401) 		 	W_1byte(0,0,clr_y++);	//设置绘图区的Y地址坐标0
    03E57 2E24      MOV	R2,R20
    03E58 5F4F      SUBI	R20,0xFF
    03E59 8228      ST	Y,R2
    03E5A 2722      CLR	R18
    03E5B 2700      CLR	R16
    03E5C DEA5      RCALL	_W_1byte
(0402) 			W_1byte(0,0,clr_x);		//设置绘图区的X地址坐标0
    03E5D 82A8      ST	Y,R10
    03E5E 2722      CLR	R18
    03E5F 2700      CLR	R16
    03E60 DEA1      RCALL	_W_1byte
(0403) 			for(j=0;j<16;j++)		//
    03E61 24CC      CLR	R12
    03E62 C007      RJMP	0x3E6A
(0404) 			{
(0405) 			 	W_1byte(0,1,0x00);	//清成不反白
    03E63 2422      CLR	R2
    03E64 8228      ST	Y,R2
    03E65 E021      LDI	R18,1
    03E66 2700      CLR	R16
    03E67 DE9A      RCALL	_W_1byte
(0406) 			 	nop();
    03E68 0000      NOP
    03E69 94C3      INC	R12
    03E6A 2D8C      MOV	R24,R12
    03E6B 3180      CPI	R24,0x10
    03E6C F3B0      BCS	0x3E63
    03E6D 9563      INC	R22
    03E6E 3160      CPI	R22,0x10
    03E6F F338      BCS	0x3E57
(0407) 			}
(0408) 		}
(0409) 	
(0410) 	    clr_y=0x80;
    03E70 E840      LDI	R20,0x80
(0411) 	    clr_x=0x90;
    03E71 E980      LDI	R24,0x90
    03E72 2EA8      MOV	R10,R24
(0412) 		 	for(i=0;i<16;i++ )			//16行
    03E73 2766      CLR	R22
    03E74 C017      RJMP	0x3E8C
(0413) 		{
(0414) 		 	W_1byte(0,0,clr_y++);	//设置绘图区的Y地址坐标0
    03E75 2E24      MOV	R2,R20
    03E76 5F4F      SUBI	R20,0xFF
    03E77 8228      ST	Y,R2
    03E78 2722      CLR	R18
    03E79 2700      CLR	R16
    03E7A DE87      RCALL	_W_1byte
(0415) 			W_1byte(0,0,clr_x);		//设置绘图区的X地址坐标0
    03E7B 82A8      ST	Y,R10
    03E7C 2722      CLR	R18
    03E7D 2700      CLR	R16
    03E7E DE83      RCALL	_W_1byte
(0416) 			for(j=0;j<16;j++)		//
    03E7F 24CC      CLR	R12
    03E80 C007      RJMP	0x3E88
(0417) 			{
(0418) 			 	W_1byte(0,1,0x00);	//清成不反白
    03E81 2422      CLR	R2
    03E82 8228      ST	Y,R2
    03E83 E021      LDI	R18,1
    03E84 2700      CLR	R16
    03E85 DE7C      RCALL	_W_1byte
(0419) 			 	nop();
    03E86 0000      NOP
    03E87 94C3      INC	R12
    03E88 2D8C      MOV	R24,R12
    03E89 3180      CPI	R24,0x10
    03E8A F3B0      BCS	0x3E81
    03E8B 9563      INC	R22
    03E8C 3160      CPI	R22,0x10
    03E8D F338      BCS	0x3E75
(0420) 			}
(0421) 		}   
(0422) 	   
(0423) 	     clr_y=0x88;
    03E8E E848      LDI	R20,0x88
(0424) 	     clr_x=0x80;
    03E8F E880      LDI	R24,0x80
    03E90 2EA8      MOV	R10,R24
(0425) 		 	for(i=0;i<16;i++ )			//16行
    03E91 2766      CLR	R22
    03E92 C017      RJMP	0x3EAA
(0426) 		{
(0427) 		 	W_1byte(0,0,clr_y++);	//设置绘图区的Y地址坐标0
    03E93 2EE4      MOV	R14,R20
    03E94 5F4F      SUBI	R20,0xFF
    03E95 82E8      ST	Y,R14
    03E96 2722      CLR	R18
    03E97 2700      CLR	R16
    03E98 DE69      RCALL	_W_1byte
(0428) 			W_1byte(0,0,clr_x);		//设置绘图区的X地址坐标0
    03E99 82A8      ST	Y,R10
    03E9A 2722      CLR	R18
    03E9B 2700      CLR	R16
    03E9C DE65      RCALL	_W_1byte
(0429) 			for(j=0;j<16;j++)		//
    03E9D 24CC      CLR	R12
    03E9E C007      RJMP	0x3EA6
(0430) 			{
(0431) 			 	W_1byte(0,1,0x00);	//清成不反白
    03E9F 2422      CLR	R2
    03EA0 8228      ST	Y,R2
    03EA1 E021      LDI	R18,1
    03EA2 2700      CLR	R16
    03EA3 DE5E      RCALL	_W_1byte
(0432) 			 	nop();
    03EA4 0000      NOP
    03EA5 94C3      INC	R12
    03EA6 2D8C      MOV	R24,R12
    03EA7 3180      CPI	R24,0x10
    03EA8 F3B0      BCS	0x3E9F
    03EA9 9563      INC	R22
    03EAA 3160      CPI	R22,0x10
    03EAB F338      BCS	0x3E93
(0433) 			}
(0434) 		} 
(0435) 	     clr_y=0x88;
    03EAC E848      LDI	R20,0x88
(0436) 	     clr_x=0x90;
    03EAD E980      LDI	R24,0x90
    03EAE 2EA8      MOV	R10,R24
(0437) 		 	for(i=0;i<16;i++ )			//16行
    03EAF 2766      CLR	R22
    03EB0 C017      RJMP	0x3EC8
(0438) 		{
(0439) 		 	W_1byte(0,0,clr_y++);	//设置绘图区的Y地址坐标0
    03EB1 2EE4      MOV	R14,R20
    03EB2 5F4F      SUBI	R20,0xFF
    03EB3 82E8      ST	Y,R14
    03EB4 2722      CLR	R18
    03EB5 2700      CLR	R16
    03EB6 DE4B      RCALL	_W_1byte
(0440) 			W_1byte(0,0,clr_x);		//设置绘图区的X地址坐标0
    03EB7 82A8      ST	Y,R10
    03EB8 2722      CLR	R18
    03EB9 2700      CLR	R16
    03EBA DE47      RCALL	_W_1byte
(0441) 			for(j=0;j<16;j++)		//
    03EBB 24CC      CLR	R12
    03EBC C007      RJMP	0x3EC4
(0442) 			{
(0443) 			 	W_1byte(0,1,0x00);	//清成不反白
    03EBD 2422      CLR	R2
    03EBE 8228      ST	Y,R2
    03EBF E021      LDI	R18,1
    03EC0 2700      CLR	R16
    03EC1 DE40      RCALL	_W_1byte
(0444) 			 	nop();
    03EC2 0000      NOP
    03EC3 94C3      INC	R12
    03EC4 2D8C      MOV	R24,R12
    03EC5 3180      CPI	R24,0x10
    03EC6 F3B0      BCS	0x3EBD
    03EC7 9563      INC	R22
    03EC8 3160      CPI	R22,0x10
    03EC9 F338      BCS	0x3EB1
(0445) 			}
(0446) 		} 		
(0447)   W_1byte(0,0,0x30);	  //8BIT控制界面，扩充指令集,，绘图显示ON
    03ECA E380      LDI	R24,0x30
    03ECB 8388      ST	Y,R24
    03ECC 2722      CLR	R18
    03ECD 2700      CLR	R16
    03ECE DE33      RCALL	_W_1byte
    03ECF 9621      ADIW	R28,1
    03ED0 940C 483A JMP	pop_xgsetF0FC
_LCD_print2num:
  a                    --> R12
  tem                  --> R20
  num                  --> R10
  y                    --> R14
  x                    --> R12
    03ED2 940E 4847 CALL	push_xgset30FC
    03ED4 2EE2      MOV	R14,R18
    03ED5 2EC0      MOV	R12,R16
    03ED6 9721      SBIW	R28,1
    03ED7 84A9      LDD	R10,Y+9
(0448) 	}
(0449) /******************************************************************** 
(0450) 函数 名：LCD_print2num
(0451) 入口参数： 显示2数字
(0452) 出口参数：无 
(0453) 函数作用： 
(0454) 说        明： 
(0455) ********************************************************************/ 
(0456) void LCD_print2num(unsigned char x,unsigned char y,unsigned char num){
(0457) unsigned char tem;
(0458) unsigned char a; 
(0459) 
(0460) a=address(x,y);
    03ED8 2D2E      MOV	R18,R14
    03ED9 2D0C      MOV	R16,R12
    03EDA DD40      RCALL	_address
    03EDB 2EC0      MOV	R12,R16
(0461) W_1byte(0,0,a);     //显示的地址 
    03EDC 82C8      ST	Y,R12
    03EDD 2722      CLR	R18
    03EDE 2700      CLR	R16
    03EDF DE22      RCALL	_W_1byte
(0462) tem=num/10;
    03EE0 E01A      LDI	R17,0xA
    03EE1 2D0A      MOV	R16,R10
    03EE2 940E 47B7 CALL	div8u
    03EE4 2F40      MOV	R20,R16
(0463) W_1byte(0,1,tem+0x30);
    03EE5 2F84      MOV	R24,R20
    03EE6 5D80      SUBI	R24,0xD0
    03EE7 8388      ST	Y,R24
    03EE8 E021      LDI	R18,1
    03EE9 2700      CLR	R16
    03EEA DE17      RCALL	_W_1byte
(0464) tem=num%10;
    03EEB E01A      LDI	R17,0xA
    03EEC 2D0A      MOV	R16,R10
    03EED 940E 47B5 CALL	mod8u
    03EEF 2F40      MOV	R20,R16
(0465) W_1byte(0,1,tem+0x30); 
    03EF0 2F84      MOV	R24,R20
    03EF1 5D80      SUBI	R24,0xD0
    03EF2 8388      ST	Y,R24
    03EF3 E021      LDI	R18,1
    03EF4 2700      CLR	R16
    03EF5 DE0C      RCALL	_W_1byte
(0466) W_1byte(0,0,0XFF); // 移走地址指针 防止下一输入内容的干扰
    03EF6 EF8F      LDI	R24,0xFF
    03EF7 8388      ST	Y,R24
    03EF8 2722      CLR	R18
    03EF9 2700      CLR	R16
    03EFA DE07      RCALL	_W_1byte
    03EFB 9621      ADIW	R28,1
    03EFC 940C 4831 JMP	pop_xgset30FC
_LCD_print4num:
  tem                  --> R12
  num                  --> R14
  y                    --> R20
  x                    --> R10
    03EFE 940E 4847 CALL	push_xgset30FC
    03F00 2F42      MOV	R20,R18
    03F01 2EA0      MOV	R10,R16
    03F02 9721      SBIW	R28,1
    03F03 84E9      LDD	R14,Y+9
    03F04 84FA      LDD	R15,Y+10
(0467) }
(0468)  
(0469) /******************************************************************** 
(0470) 函数 名：LCD_print4num
(0471) 入口参数： 显示4数字
(0472) 出口参数：无 
(0473) 函数作用： 
(0474) 说        明： 
(0475) ********************************************************************/ 
(0476) void LCD_print4num(unsigned char x,unsigned char y,unsigned int num){
(0477) unsigned char tem;
(0478) tem=num/100;
    03F05 E624      LDI	R18,0x64
    03F06 E030      LDI	R19,0
    03F07 0187      MOVW	R16,R14
    03F08 940E 4731 CALL	div16u
    03F0A 2EC0      MOV	R12,R16
(0479) LCD_print2num(x,y,tem);
    03F0B 82C8      ST	Y,R12
    03F0C 2F24      MOV	R18,R20
    03F0D 2D0A      MOV	R16,R10
    03F0E DFC3      RCALL	_LCD_print2num
(0480) 
(0481) tem=num%100;   
    03F0F E624      LDI	R18,0x64
    03F10 E030      LDI	R19,0
    03F11 0187      MOVW	R16,R14
    03F12 940E 472F CALL	mod16u
    03F14 2EC0      MOV	R12,R16
(0482) LCD_print2num(x,y+1,tem);
    03F15 82C8      ST	Y,R12
    03F16 2F24      MOV	R18,R20
    03F17 5F2F      SUBI	R18,0xFF
    03F18 2D0A      MOV	R16,R10
    03F19 DFB8      RCALL	_LCD_print2num
(0483) 
(0484) 
(0485)   W_1byte(0,0,0XFF); // 移走地址指针 防止下一输入内容的干扰
    03F1A EF8F      LDI	R24,0xFF
    03F1B 8388      ST	Y,R24
    03F1C 2722      CLR	R18
    03F1D 2700      CLR	R16
    03F1E DDE3      RCALL	_W_1byte
    03F1F 9621      ADIW	R28,1
    03F20 940C 4831 JMP	pop_xgset30FC
_LCD_print:
  a                    --> R12
  ch                   --> R10
  y                    --> R14
  x                    --> R12
    03F22 940E 4849 CALL	push_xgset00FC
    03F24 2EE2      MOV	R14,R18
    03F25 2EC0      MOV	R12,R16
    03F26 9721      SBIW	R28,1
    03F27 80AF      LDD	R10,Y+7
(0486) }
(0487)  
(0488) //////////////////////////////////////////////////////////////
(0489) 
(0490) /******************************************************************** 
(0491) 函数 名：LCD_print 
(0492) 入口参数： 显示1 ascii
(0493) 出口参数：无 
(0494) 函数作用： 
(0495) 说        明： 
(0496) ********************************************************************/ 
(0497) void LCD_print(unsigned char x,unsigned char y,unsigned char ch)
(0498) {  
(0499) unsigned char a; 
(0500) a=address(x,y);
    03F28 2D2E      MOV	R18,R14
    03F29 2D0C      MOV	R16,R12
    03F2A DCF0      RCALL	_address
    03F2B 2EC0      MOV	R12,R16
(0501) W_1byte(0,0,a);     //显示的地址 
    03F2C 82C8      ST	Y,R12
    03F2D 2722      CLR	R18
    03F2E 2700      CLR	R16
    03F2F DDD2      RCALL	_W_1byte
(0502) W_1byte(0,1,ch); 
    03F30 82A8      ST	Y,R10
    03F31 E021      LDI	R18,1
    03F32 2700      CLR	R16
    03F33 DDCE      RCALL	_W_1byte
    03F34 9621      ADIW	R28,1
    03F35 940C 482A JMP	pop_xgset00FC
_LCD_print1:
  ch                   --> R10
    03F37 92AA      ST	-Y,R10
    03F38 2EA0      MOV	R10,R16
    03F39 9721      SBIW	R28,1
(0503) 
(0504) 
(0505) 
(0506) }
(0507) /******************************************************************** 
(0508) 函数 名：LCD_print1 
(0509) 入口参数： 显示1 ascii
(0510) 出口参数：无 
(0511) 函数作用：接着上文地址显示，不重设地址 
(0512) 说        明： 
(0513) ********************************************************************/ 
(0514) void LCD_print1(char ch)
(0515) {  
(0516) W_1byte(0,1,ch); 
    03F3A 82A8      ST	Y,R10
    03F3B E021      LDI	R18,1
    03F3C 2700      CLR	R16
    03F3D DDC4      RCALL	_W_1byte
    03F3E 9621      ADIW	R28,1
    03F3F 90A9      LD	R10,Y+
    03F40 9508      RET
_lp:
  p                    --> R10
    03F41 92AA      ST	-Y,R10
    03F42 92BA      ST	-Y,R11
    03F43 0158      MOVW	R10,R16
    03F44 9722      SBIW	R28,2
(0517) }
(0518) //////////////////////////////////////////////////////////////
(0519) 
(0520) 
(0521) 
(0522)  void lp(unsigned char *p)
(0523)  {
(0524)  static unsigned char *p1=" ",*p2=" ",*p3=" ",*p4=" ";
(0525)  p4=p3;
    03F45 9020 056D LDS	R2,lcd.c:p3
    03F47 9030 056E LDS	R3,lcd.c:p3+1
    03F49 9230 0570 STS	lcd.c:p4+1,R3
    03F4B 9220 056F STS	lcd.c:p4,R2
(0526)  p3=p2;
    03F4D 9020 056B LDS	R2,lcd.c:p2
    03F4F 9030 056C LDS	R3,lcd.c:p2+1
    03F51 9230 056E STS	lcd.c:p3+1,R3
    03F53 9220 056D STS	lcd.c:p3,R2
(0527)  p2=p1;
    03F55 9020 0569 LDS	R2,lcd.c:p1
    03F57 9030 056A LDS	R3,lcd.c:p1+1
    03F59 9230 056C STS	lcd.c:p2+1,R3
    03F5B 9220 056B STS	lcd.c:p2,R2
(0528)  p1=p;
    03F5D 92B0 056A STS	lcd.c:p1+1,R11
    03F5F 92A0 0569 STS	lcd.c:p1,R10
(0529)   LCD_const_disp(1,1,"                ");
    03F61 E781      LDI	R24,0x71
    03F62 E095      LDI	R25,5
    03F63 8399      STD	Y+1,R25
    03F64 8388      ST	Y,R24
    03F65 E021      LDI	R18,1
    03F66 E001      LDI	R16,1
    03F67 DCD4      RCALL	_LCD_const_disp
(0530)   LCD_const_disp(2,1,"                ");
    03F68 E781      LDI	R24,0x71
    03F69 E095      LDI	R25,5
    03F6A 8399      STD	Y+1,R25
    03F6B 8388      ST	Y,R24
    03F6C E021      LDI	R18,1
    03F6D E002      LDI	R16,2
    03F6E DCCD      RCALL	_LCD_const_disp
(0531)   LCD_const_disp(3,1,"                ");
    03F6F E781      LDI	R24,0x71
    03F70 E095      LDI	R25,5
    03F71 8399      STD	Y+1,R25
    03F72 8388      ST	Y,R24
    03F73 E021      LDI	R18,1
    03F74 E003      LDI	R16,3
    03F75 DCC6      RCALL	_LCD_const_disp
(0532)   LCD_const_disp(4,1,"                ");
    03F76 E781      LDI	R24,0x71
    03F77 E095      LDI	R25,5
    03F78 8399      STD	Y+1,R25
    03F79 8388      ST	Y,R24
    03F7A E021      LDI	R18,1
    03F7B E004      LDI	R16,4
    03F7C DCBF      RCALL	_LCD_const_disp
(0533)   LCD_var_disp(1,1,p4);
    03F7D 9020 056F LDS	R2,lcd.c:p4
    03F7F 9030 0570 LDS	R3,lcd.c:p4+1
    03F81 8239      STD	Y+1,R3
    03F82 8228      ST	Y,R2
    03F83 E021      LDI	R18,1
    03F84 E001      LDI	R16,1
    03F85 DCE3      RCALL	_LCD_var_disp
(0534)   LCD_var_disp(2,1,p3);
    03F86 9020 056D LDS	R2,lcd.c:p3
    03F88 9030 056E LDS	R3,lcd.c:p3+1
    03F8A 8239      STD	Y+1,R3
    03F8B 8228      ST	Y,R2
    03F8C E021      LDI	R18,1
    03F8D E002      LDI	R16,2
    03F8E DCDA      RCALL	_LCD_var_disp
(0535)   LCD_var_disp(3,1,p2);
    03F8F 9020 056B LDS	R2,lcd.c:p2
    03F91 9030 056C LDS	R3,lcd.c:p2+1
    03F93 8239      STD	Y+1,R3
    03F94 8228      ST	Y,R2
    03F95 E021      LDI	R18,1
    03F96 E003      LDI	R16,3
    03F97 DCD1      RCALL	_LCD_var_disp
(0536)   LCD_var_disp(4,1,p1);
    03F98 9020 0569 LDS	R2,lcd.c:p1
    03F9A 9030 056A LDS	R3,lcd.c:p1+1
    03F9C 8239      STD	Y+1,R3
    03F9D 8228      ST	Y,R2
    03F9E E021      LDI	R18,1
    03F9F E004      LDI	R16,4
    03FA0 DCC8      RCALL	_LCD_var_disp
(0537)   delayms(300);
    03FA1 E20C      LDI	R16,0x2C
    03FA2 E011      LDI	R17,1
    03FA3 940E 2511 CALL	_delayms
    03FA5 9622      ADIW	R28,2
    03FA6 90B9      LD	R11,Y+
    03FA7 90A9      LD	R10,Y+
    03FA8 9508      RET
FILE: D:\LQD\software\software_src\relay.c
(0001) #include "config.h"
(0002) /*继电器初始化
(0003) *设置端口
(0004) *初始化关闭
(0005) */
(0006) void relay_init(void){
(0007) 	
(0008) 		RELAY_DDR_SET() ;
_relay_init:
    03FA9 9AA5      SBI	0x14,5
(0009) 		RELAY_OFF();
    03FAA 98AD      CBI	0x15,5
    03FAB 9508      RET
(0010) 		//state.Relay = 0;
(0011) 	}	
(0012) 
(0013) /*继电器控制
(0014) *传入 ： 温度
(0015) *传出 ： 当前继电器状态
(0016) *
(0017) */
(0018) unsigned char  relay(int temp)
(0019) {
(0020) 	if(temp<HEAT_THRESHOLD)
_relay:
  temp                 --> R16
    03FAC 3005      CPI	R16,5
    03FAD E0E0      LDI	R30,0
    03FAE 071E      CPC	R17,R30
    03FAF F41C      BGE	0x3FB3
(0021) 	{
(0022) 	 		RELAY_DDR_SET();
    03FB0 9AA5      SBI	0x14,5
(0023) 			RELAY_ON();
    03FB1 9AAD      SBI	0x15,5
(0024) 			//state.Relay = 1 ;
(0025) 	}
    03FB2 C002      RJMP	0x3FB5
(0026) 	else
(0027) 	{
(0028) 	 	RELAY_DDR_SET();
    03FB3 9AA5      SBI	0x14,5
(0029) 		RELAY_OFF();
    03FB4 98AD      CBI	0x15,5
(0030) 		//state.Relay = 0 ;
(0031) 	}		
(0032) 	//return state.Relay;
(0033) 	return 0;
    03FB5 2700      CLR	R16
    03FB6 9508      RET
_beep:
  i                    --> R10
  short_beep           --> R12
  long_beep            --> R14
    03FB7 940E 4849 CALL	push_xgset00FC
    03FB9 2EC2      MOV	R12,R18
    03FBA 2EE0      MOV	R14,R16
FILE: D:\LQD\software\software_src\beep.c
(0001) #include "config.h"
(0002) 
(0003) #define BEEP_PORT	PORTC
(0004) #define BEEP_PIN	6
(0005) #define BEEP_OFF() BEEP_PORT|=(1<<BEEP_PIN)
(0006) #define BEEP_ON()  BEEP_PORT&=~(1<<BEEP_PIN)
(0007) //楦ｅ
(0008) void beep(unsigned char long_beep,unsigned char short_beep)
(0009) { 
(0010) unsigned char i;
(0011) DDRB|=(1<<0);
    03FBB 9AB8      SBI	0x17,0
(0012) for(i=0;i<long_beep;i++)
    03FBC 24AA      CLR	R10
    03FBD C00B      RJMP	0x3FC9
(0013) {
(0014) BEEP_ON();  delayms(200);
    03FBE 98AE      CBI	0x15,6
    03FBF EC08      LDI	R16,0xC8
    03FC0 E010      LDI	R17,0
    03FC1 940E 2511 CALL	_delayms
(0015) BEEP_OFF(); delayms(50);
    03FC3 9AAE      SBI	0x15,6
    03FC4 E302      LDI	R16,0x32
    03FC5 E010      LDI	R17,0
    03FC6 940E 2511 CALL	_delayms
    03FC8 94A3      INC	R10
    03FC9 14AE      CP	R10,R14
    03FCA F398      BCS	0x3FBE
(0016) }
(0017) delayms(100);
    03FCB E604      LDI	R16,0x64
    03FCC E010      LDI	R17,0
    03FCD 940E 2511 CALL	_delayms
(0018) for(i=0;i<short_beep;i++)
    03FCF 24AA      CLR	R10
    03FD0 C00B      RJMP	0x3FDC
(0019) {
(0020) BEEP_ON();  delayms(80);
    03FD1 98AE      CBI	0x15,6
    03FD2 E500      LDI	R16,0x50
    03FD3 E010      LDI	R17,0
    03FD4 940E 2511 CALL	_delayms
(0021) BEEP_OFF(); delayms(50);
    03FD6 9AAE      SBI	0x15,6
    03FD7 E302      LDI	R16,0x32
    03FD8 E010      LDI	R17,0
    03FD9 940E 2511 CALL	_delayms
    03FDB 94A3      INC	R10
    03FDC 14AC      CP	R10,R12
    03FDD F398      BCS	0x3FD1
    03FDE 940C 482A JMP	pop_xgset00FC
_Delay_nus:
  i                    --> R20
  n                    --> R16
    03FE0 934A      ST	-Y,R20
    03FE1 935A      ST	-Y,R21
FILE: D:\LQD\software\software_src\DS18B20_driver.c
(0001) //------------------------------------------------------------------------------
(0002) // 文件名：DS18B20_driver.c
(0003) // 说明：  DS18B20驱动头文件
(0004) // 功能：  实现1-wire器件的读写
(0005) // 使用方法：   void Delay_nus(unsigned int n);             //延时n微秒函数
(0006) //              unsigned char reset_18B20(void);            //18B20复位
(0007) //              void write_bit_18B20(char bitval);          //写一位到18B20
(0008) //              unsigned char read_bit_18B20(void);         //读一位从18B20
(0009) //              void write_byte_18B20(unsigned char data);  //写一字节到18B20
(0010) //              unsigned char read_18B20(void);             //读一字节到18B20
(0011) //
(0012) // 运行平台：   AVR 8bit (M16已验证)
(0013) // 依存关系：   DS18B20_driver.h    DS18B20基本驱动头文件（函数声明）
(0014) // 移植人：     
(0015) // 最后修改：   
(0016) //------------------------------------------------------------------------------
(0017) 
(0018) #include "config.h"
(0019) #define DS18B20_PORT PORTG
(0020) #define DS18B20_PIN  PING
(0021) #define DS18B20_DDR  DDRG
(0022) #define CL_DQ   DS18B20_PORT&=~(1<<T_NUM)					   
(0023) #define SET_DQ  DS18B20_PORT|=(1<<T_NUM)			   
(0024) #define SET_OUT DS18B20_DDR|=(1<<T_NUM)				   
(0025) #define SET_IN  DS18B20_DDR&=~(1<<T_NUM)			   
(0026) #define IN_DQ   DS18B20_PIN&(1<<T_NUM)				  
(0027) unsigned char T_NUM=0;
(0028) 
(0029) 
(0030) //------------------------------------------------------------------------------
(0031) // 延时N微秒程序 供控制读写DS18B20时序使用
(0032) //------------------------------------------------------------------------------
(0033) void Delay_nus(unsigned int n)   
(0034) {  unsigned int i;
(0035) 	  for (i=0;i<n;i++) 
    03FE2 2744      CLR	R20
    03FE3 2755      CLR	R21
    03FE4 C005      RJMP	0x3FEA
(0036) 	  		{NOP();
    03FE5 0000      NOP
(0037) 						NOP();
    03FE6 0000      NOP
(0038) 						NOP();				        //20--300//比较接近
    03FE7 0000      NOP
    03FE8 5F4F      SUBI	R20,0xFF
    03FE9 4F5F      SBCI	R21,0xFF
    03FEA 1740      CP	R20,R16
    03FEB 0751      CPC	R21,R17
    03FEC F3C0      BCS	0x3FE5
    03FED 9159      LD	R21,Y+
    03FEE 9149      LD	R20,Y+
    03FEF 9508      RET
_reset_18B20:
  bus_flag             --> R10
    03FF0 92AA      ST	-Y,R10
(0039) 					}
(0040) }
(0041) 
(0042) 
(0043) //------------------------------------------------------------------------------
(0044) // 1-wire总线复位
(0045) //------------------------------------------------------------------------------
(0046) unsigned char reset_18B20(void)
(0047) {
(0048) 	char bus_flag;
(0049) 	CLI();
    03FF1 94F8      BCLR	7
(0050) 	SET_DQ;
    03FF2 9110 0584 LDS	R17,T_NUM
    03FF4 E001      LDI	R16,1
    03FF5 940E 48DC CALL	lsl8
    03FF7 9020 0065 LDS	R2,0x65
    03FF9 2A20      OR	R2,R16
    03FFA 9220 0065 STS	0x65,R2
(0051) 	SET_OUT;
    03FFC 9110 0584 LDS	R17,T_NUM
    03FFE E001      LDI	R16,1
    03FFF 940E 48DC CALL	lsl8
    04001 9020 0064 LDS	R2,0x64
    04003 2A20      OR	R2,R16
    04004 9220 0064 STS	0x64,R2
(0052)  	
(0053)   	Delay_nus(1);
    04006 E001      LDI	R16,1
    04007 E010      LDI	R17,0
    04008 DFD7      RCALL	_Delay_nus
(0054)   	CL_DQ;
    04009 9110 0584 LDS	R17,T_NUM
    0400B E001      LDI	R16,1
    0400C 940E 48DC CALL	lsl8
    0400E 2E20      MOV	R2,R16
    0400F 9420      COM	R2
    04010 9030 0065 LDS	R3,0x65
    04012 2032      AND	R3,R2
    04013 9230 0065 STS	0x65,R3
(0055)   	Delay_nus(550);		//拉低至少480us时间
    04015 E206      LDI	R16,0x26
    04016 E012      LDI	R17,2
    04017 DFC8      RCALL	_Delay_nus
(0056)   	SET_DQ;				//释放
    04018 9110 0584 LDS	R17,T_NUM
    0401A E001      LDI	R16,1
    0401B 940E 48DC CALL	lsl8
    0401D 9020 0065 LDS	R2,0x65
    0401F 2A20      OR	R2,R16
    04020 9220 0065 STS	0x65,R2
(0057) 					NOP();
    04022 0000      NOP
(0058) 					NOP();
    04023 0000      NOP
(0059)   	SET_IN;				//输入
    04024 9110 0584 LDS	R17,T_NUM
    04026 E001      LDI	R16,1
    04027 940E 48DC CALL	lsl8
    04029 2E20      MOV	R2,R16
    0402A 9420      COM	R2
    0402B 9030 0064 LDS	R3,0x64
    0402D 2032      AND	R3,R2
    0402E 9230 0064 STS	0x64,R3
(0060)   	Delay_nus(60);
    04030 E30C      LDI	R16,0x3C
    04031 E010      LDI	R17,0
    04032 DFAD      RCALL	_Delay_nus
(0061)   	
(0062) 						//等待回复
(0063)   	bus_flag = IN_DQ;
    04033 9110 0584 LDS	R17,T_NUM
    04035 E001      LDI	R16,1
    04036 940E 48DC CALL	lsl8
    04038 90A0 0063 LDS	R10,0x63
    0403A 22A0      AND	R10,R16
(0064)   	
(0065)   	Delay_nus(240);		//回复的低电平在60到240US
    0403B EF00      LDI	R16,0xF0
    0403C E010      LDI	R17,0
    0403D DFA2      RCALL	_Delay_nus
(0066)   	SET_OUT;
    0403E 9110 0584 LDS	R17,T_NUM
    04040 E001      LDI	R16,1
    04041 940E 48DC CALL	lsl8
    04043 9020 0064 LDS	R2,0x64
    04045 2A20      OR	R2,R16
    04046 9220 0064 STS	0x64,R2
(0067) 					NOP();
    04048 0000      NOP
(0068) 					NOP();
    04049 0000      NOP
(0069)   	SET_DQ;				//回到初始DQ=1；
    0404A 9110 0584 LDS	R17,T_NUM
    0404C E001      LDI	R16,1
    0404D 940E 48DC CALL	lsl8
    0404F 9020 0065 LDS	R2,0x65
    04051 2A20      OR	R2,R16
    04052 9220 0065 STS	0x65,R2
(0070) 
(0071)   	SEI();
    04054 9478      BSET	7
(0072) 	if(bus_flag){
    04055 20AA      TST	R10
    04056 F011      BEQ	0x4059
(0073) 		return FALSE;
    04057 2700      CLR	R16
    04058 C001      RJMP	0x405A
(0074) 	}else{
(0075) 		return TRUE;
    04059 E001      LDI	R16,1
    0405A 90A9      LD	R10,Y+
    0405B 9508      RET
_write_bit_18B20:
  bitval               --> R10
    0405C 92AA      ST	-Y,R10
    0405D 2EA0      MOV	R10,R16
(0076) 	}
(0077) 
(0078) }
(0079) 
(0080) //------------------------------------------------------------------------------
(0081) // 写一位到总线
(0082) //------------------------------------------------------------------------------
(0083) void write_bit_18B20(char bitval)
(0084) {
(0085)     SET_OUT;
    0405E 9110 0584 LDS	R17,T_NUM
    04060 E001      LDI	R16,1
    04061 940E 48DC CALL	lsl8
    04063 9020 0064 LDS	R2,0x64
    04065 2A20      OR	R2,R16
    04066 9220 0064 STS	0x64,R2
(0086) 					NOP();
    04068 0000      NOP
(0087) 					NOP();
    04069 0000      NOP
(0088) 			 CL_DQ;
    0406A 9110 0584 LDS	R17,T_NUM
    0406C E001      LDI	R16,1
    0406D 940E 48DC CALL	lsl8
    0406F 2E20      MOV	R2,R16
    04070 9420      COM	R2
    04071 9030 0065 LDS	R3,0x65
    04073 2032      AND	R3,R2
    04074 9230 0065 STS	0x65,R3
(0089) 	   Delay_nus(1);
    04076 E001      LDI	R16,1
    04077 E010      LDI	R17,0
    04078 DF67      RCALL	_Delay_nus
(0090) 	   if(bitval){    //写数据，从低位开始
    04079 20AA      TST	R10
    0407A F059      BEQ	0x4086
(0091) 		     SET_DQ;
    0407B 9110 0584 LDS	R17,T_NUM
    0407D E001      LDI	R16,1
    0407E 940E 48DC CALL	lsl8
    04080 9020 0065 LDS	R2,0x65
    04082 2A20      OR	R2,R16
    04083 9220 0065 STS	0x65,R2
(0092) 	  }else{
    04085 C00C      RJMP	0x4092
(0093) 		     CL_DQ;
    04086 9110 0584 LDS	R17,T_NUM
    04088 E001      LDI	R16,1
    04089 940E 48DC CALL	lsl8
    0408B 2E20      MOV	R2,R16
    0408C 9420      COM	R2
    0408D 9030 0065 LDS	R3,0x65
    0408F 2032      AND	R3,R2
    04090 9230 0065 STS	0x65,R3
(0094) 	  }
(0095) 	Delay_nus(40);		//15~60us
    04092 E208      LDI	R16,0x28
    04093 E010      LDI	R17,0
    04094 DF4B      RCALL	_Delay_nus
(0096) 	SET_DQ;
    04095 9110 0584 LDS	R17,T_NUM
    04097 E001      LDI	R16,1
    04098 940E 48DC CALL	lsl8
    0409A 9020 0065 LDS	R2,0x65
    0409C 2A20      OR	R2,R16
    0409D 9220 0065 STS	0x65,R2
(0097) 	Delay_nus(10);
    0409F E00A      LDI	R16,0xA
    040A0 E010      LDI	R17,0
    040A1 DF3E      RCALL	_Delay_nus
    040A2 90A9      LD	R10,Y+
    040A3 9508      RET
_read_bit_18B20:
  k                    --> R10
    040A4 92AA      ST	-Y,R10
(0098) }
(0099) 
(0100) //------------------------------------------------------------------------------
(0101) // 读一位从总线
(0102) //------------------------------------------------------------------------------
(0103) unsigned char read_bit_18B20(void)
(0104) {
(0105) 	unsigned char k;
(0106) 	SET_OUT;
    040A5 9110 0584 LDS	R17,T_NUM
    040A7 E001      LDI	R16,1
    040A8 940E 48DC CALL	lsl8
    040AA 9020 0064 LDS	R2,0x64
    040AC 2A20      OR	R2,R16
    040AD 9220 0064 STS	0x64,R2
(0107) 	CL_DQ;			//读时间片开始，拉低总线至少1us
    040AF 9110 0584 LDS	R17,T_NUM
    040B1 E001      LDI	R16,1
    040B2 940E 48DC CALL	lsl8
    040B4 2E20      MOV	R2,R16
    040B5 9420      COM	R2
    040B6 9030 0065 LDS	R3,0x65
    040B8 2032      AND	R3,R2
    040B9 9230 0065 STS	0x65,R3
(0108) 	Delay_nus(1);
    040BB E001      LDI	R16,1
    040BC E010      LDI	R17,0
    040BD DF22      RCALL	_Delay_nus
(0109) 	
(0110) 					//SET_DQ;	
(0111) 	SET_IN;
    040BE 9110 0584 LDS	R17,T_NUM
    040C0 E001      LDI	R16,1
    040C1 940E 48DC CALL	lsl8
    040C3 2E20      MOV	R2,R16
    040C4 9420      COM	R2
    040C5 9030 0064 LDS	R3,0x64
    040C7 2032      AND	R3,R2
    040C8 9230 0064 STS	0x64,R3
(0112) 	Delay_nus(4);
    040CA E004      LDI	R16,4
    040CB E010      LDI	R17,0
    040CC DF13      RCALL	_Delay_nus
(0113) 	k=IN_DQ;    	//读数据,从低位开始
    040CD 9110 0584 LDS	R17,T_NUM
    040CF E001      LDI	R16,1
    040D0 940E 48DC CALL	lsl8
    040D2 90A0 0063 LDS	R10,0x63
    040D4 22A0      AND	R10,R16
(0114) 	Delay_nus(10);
    040D5 E00A      LDI	R16,0xA
    040D6 E010      LDI	R17,0
    040D7 DF08      RCALL	_Delay_nus
(0115) 	SET_DQ;	
    040D8 9110 0584 LDS	R17,T_NUM
    040DA E001      LDI	R16,1
    040DB 940E 48DC CALL	lsl8
    040DD 9020 0065 LDS	R2,0x65
    040DF 2A20      OR	R2,R16
    040E0 9220 0065 STS	0x65,R2
(0116) 				NOP();
    040E2 0000      NOP
(0117) 				NOP();
    040E3 0000      NOP
(0118) 	SET_OUT;
    040E4 9110 0584 LDS	R17,T_NUM
    040E6 E001      LDI	R16,1
    040E7 940E 48DC CALL	lsl8
    040E9 9020 0064 LDS	R2,0x64
    040EB 2A20      OR	R2,R16
    040EC 9220 0064 STS	0x64,R2
(0119) 	    NOP();
    040EE 0000      NOP
(0120) 					NOP();
    040EF 0000      NOP
(0121) 	if(k){
    040F0 20AA      TST	R10
    040F1 F011      BEQ	0x40F4
(0122) 	    return 1;
    040F2 E001      LDI	R16,1
    040F3 C001      RJMP	0x40F5
(0123) 	}else{
(0124) 	    return 0;
    040F4 2700      CLR	R16
    040F5 90A9      LD	R10,Y+
    040F6 9508      RET
_write_byte_18B20:
  i                    --> R20
  data                 --> R10
    040F7 92AA      ST	-Y,R10
    040F8 934A      ST	-Y,R20
    040F9 2EA0      MOV	R10,R16
(0125) 	}
(0126) 	
(0127) }
(0128) 
(0129) //------------------------------------------------------------------------------
(0130) // 写一个字节到总线
(0131) //------------------------------------------------------------------------------
(0132) void write_byte_18B20(unsigned char data)
(0133) {
(0134) 	unsigned char i;
(0135)    CLI();
    040FA 94F8      BCLR	7
(0136)     for(i=0;i<8;i++)
    040FB 2744      CLR	R20
    040FC C009      RJMP	0x4106
(0137)     {
(0138)         write_bit_18B20(data&(1<<i));
    040FD E001      LDI	R16,1
    040FE 2F14      MOV	R17,R20
    040FF 940E 48DC CALL	lsl8
    04101 2E20      MOV	R2,R16
    04102 2D0A      MOV	R16,R10
    04103 2102      AND	R16,R2
    04104 DF57      RCALL	_write_bit_18B20
    04105 9543      INC	R20
    04106 3048      CPI	R20,0x8
    04107 F3A8      BCS	0x40FD
(0139)         
(0140)     }
(0141)     SET_DQ;
    04108 9110 0584 LDS	R17,T_NUM
    0410A E001      LDI	R16,1
    0410B 940E 48DC CALL	lsl8
    0410D 9020 0065 LDS	R2,0x65
    0410F 2A20      OR	R2,R16
    04110 9220 0065 STS	0x65,R2
(0142) 				  NOP();
    04112 0000      NOP
(0143) 					 NOP();
    04113 0000      NOP
(0144)     SEI();
    04114 9478      BSET	7
    04115 9149      LD	R20,Y+
    04116 90A9      LD	R10,Y+
    04117 9508      RET
_read_byte_18B20:
  temp                 --> R10
  n                    --> R20
    04118 92AA      ST	-Y,R10
    04119 934A      ST	-Y,R20
(0145)     
(0146)     //return;
(0147) }
(0148) 
(0149) //------------------------------------------------------------------------------
(0150) // 读一个字节
(0151) //------------------------------------------------------------------------------
(0152) unsigned char read_byte_18B20(void)
(0153) {
(0154) 	unsigned char temp,n;
(0155)     CLI();
    0411A 94F8      BCLR	7
(0156)   	temp=0;
    0411B 24AA      CLR	R10
(0157)     for(n=0;n<8;n++)
    0411C 2744      CLR	R20
    0411D C014      RJMP	0x4132
(0158)     {
(0159)       	if(read_bit_18B20()){
    0411E DF85      RCALL	_read_bit_18B20
    0411F 2300      TST	R16
    04120 F031      BEQ	0x4127
(0160)       		temp|=(1<<n);
    04121 E001      LDI	R16,1
    04122 2F14      MOV	R17,R20
    04123 940E 48DC CALL	lsl8
    04125 2AA0      OR	R10,R16
(0161)       	}else{
    04126 C007      RJMP	0x412E
(0162)       		temp&=~(1<<n);
    04127 E001      LDI	R16,1
    04128 2F14      MOV	R17,R20
    04129 940E 48DC CALL	lsl8
    0412B 2E20      MOV	R2,R16
    0412C 9420      COM	R2
    0412D 20A2      AND	R10,R2
(0163)       	}
(0164)       	Delay_nus(70); //60~120us
    0412E E406      LDI	R16,0x46
    0412F E010      LDI	R17,0
    04130 DEAF      RCALL	_Delay_nus
    04131 9543      INC	R20
    04132 3048      CPI	R20,0x8
    04133 F350      BCS	0x411E
(0165)       	
(0166)    }
(0167)    SEI();
    04134 9478      BSET	7
(0168) 
(0169)    return temp;
    04135 2D0A      MOV	R16,R10
    04136 9149      LD	R20,Y+
    04137 90A9      LD	R10,Y+
    04138 9508      RET
(0170) }
(0171) 
(0172) 
(0173) 
(0174) //------------------------------------------------------------------------------
(0175) // 应用函数部分！ 供外部调用
(0176) //------------------------------------------------------------------------------
(0177) //------------------------------------------------------------------------------
(0178) // 单器件/多器件：开始转换
(0179) //------------------------------------------------------------------------------
(0180) void convert_T(void)
(0181) {
(0182) 					if(reset_18B20()){
_convert_T:
    04139 DEB6      RCALL	_reset_18B20
    0413A 2300      TST	R16
    0413B F021      BEQ	0x4140
(0183) 					write_byte_18B20(0xcc);
    0413C EC0C      LDI	R16,0xCC
    0413D DFB9      RCALL	_write_byte_18B20
(0184) 					write_byte_18B20(0x44);
    0413E E404      LDI	R16,0x44
    0413F DFB7      RCALL	_write_byte_18B20
(0185) 					}
    04140 9508      RET
_read_T:
  tmp                  --> Y,+0
  tl                   --> R12
  th                   --> R10
    04141 940E 4849 CALL	push_xgset00FC
    04143 9724      SBIW	R28,4
(0186) }
(0187) 
(0188) //------------------------------------------------------------------------------
(0189) // 单器件：读温度，返回INIT8U型温度数据（原始数据）
(0190) //------------------------------------------------------------------------------
(0191) float read_T(void)
(0192) {
(0193)     unsigned char th=0,tl=0;
    04144 24AA      CLR	R10
    04145 24CC      CLR	R12
(0194) 	float tmp;
(0195)     if(reset_18B20()){
    04146 DEA9      RCALL	_reset_18B20
    04147 2300      TST	R16
    04148 F021      BEQ	0x414D
(0196)     	write_byte_18B20(0xcc);
    04149 EC0C      LDI	R16,0xCC
    0414A DFAC      RCALL	_write_byte_18B20
(0197)     	write_byte_18B20(0xbe);
    0414B EB0E      LDI	R16,0xBE
    0414C DFAA      RCALL	_write_byte_18B20
(0198)     }
(0199)     
(0200)     tl = read_byte_18B20();
    0414D DFCA      RCALL	_read_byte_18B20
    0414E 2EC0      MOV	R12,R16
(0201)     th = read_byte_18B20();
    0414F DFC8      RCALL	_read_byte_18B20
    04150 2EE0      MOV	R14,R16
    04151 2CAE      MOV	R10,R14
(0202)  	tmp= ((float)(th<<8|tl))*0.0625;
    04152 ED02      LDI	R16,0xD2
    04153 E010      LDI	R17,0
    04154 940E 47CD CALL	elpm32
    04156 0118      MOVW	R2,R16
    04157 0129      MOVW	R4,R18
    04158 2D1A      MOV	R17,R10
    04159 2D0C      MOV	R16,R12
    0415A 940E 49BE CALL	int2fp
    0415C 933A      ST	-Y,R19
    0415D 932A      ST	-Y,R18
    0415E 931A      ST	-Y,R17
    0415F 930A      ST	-Y,R16
    04160 0181      MOVW	R16,R2
    04161 0192      MOVW	R18,R4
    04162 940E 4B63 CALL	fpmule2
    04164 8308      ST	Y,R16
    04165 8319      STD	Y+1,R17
    04166 832A      STD	Y+2,R18
    04167 833B      STD	Y+3,R19
(0203)     return( tmp);
    04168 8108      LD	R16,Y
    04169 8119      LDD	R17,Y+1
    0416A 812A      LDD	R18,Y+2
    0416B 813B      LDD	R19,Y+3
    0416C 9624      ADIW	R28,4
    0416D 940C 482A JMP	pop_xgset00FC
_read_T_NUM:
  ttemp                --> Y,+0
  NUM                  --> R10
    0416F 92AA      ST	-Y,R10
    04170 2EA0      MOV	R10,R16
    04171 9724      SBIW	R28,4
(0204) }
(0205) 
(0206) float read_T_NUM(unsigned char NUM){
(0207) float ttemp;
(0208) if ( NUM >1) return 123.45;
    04172 E081      LDI	R24,1
    04173 158A      CP	R24,R10
    04174 F428      BCC	0x417A
    04175 EC0E      LDI	R16,0xCE
    04176 E010      LDI	R17,0
    04177 940E 47CD CALL	elpm32
    04179 C010      RJMP	0x418A
(0209) T_NUM=NUM;//设置访问器件
    0417A 92A0 0584 STS	T_NUM,R10
(0210) convert_T();//温度转换
    0417C DFBC      RCALL	_convert_T
(0211) delayms(800);
    0417D E200      LDI	R16,0x20
    0417E E013      LDI	R17,3
    0417F 940E 2511 CALL	_delayms
(0212) ttemp=read_T();
    04181 DFBF      RCALL	_read_T
    04182 8308      ST	Y,R16
    04183 8319      STD	Y+1,R17
    04184 832A      STD	Y+2,R18
    04185 833B      STD	Y+3,R19
(0213) return ttemp;
    04186 8108      LD	R16,Y
    04187 8119      LDD	R17,Y+1
    04188 812A      LDD	R18,Y+2
    04189 813B      LDD	R19,Y+3
    0418A 9624      ADIW	R28,4
    0418B 90A9      LD	R10,Y+
    0418C 9508      RET
FILE: D:\LQD\software\software_src\ds1302.c
(0001) #include "config.h"
(0002) 
(0003) #define TPORT PORTB
(0004) #define TDDR DDRB
(0005) #define TPIN PINB
(0006) #define PIN_RST	 4
(0007) #define PIN_IO	 5
(0008) #define PIN_SCK	 6
(0009) /******************复位脚*********************/
(0010) #define RST_CLR	TPORT &= ~(1 << PIN_RST)   /*电平置低*/
(0011) #define RST_SET	TPORT |= (1 << PIN_RST)    /*电平置高*/
(0012) #define RST_IN	TDDR &= ~(1 << PIN_RST)    /*方向输入*/
(0013) #define RST_OUT	TDDR |= (1 << PIN_RST)     /*方向输出*/
(0014) 
(0015) /*****************双向数据********************/
(0016) #define IO_CLR	TPORT &= ~(1 << PIN_IO)  /*电平置低*/
(0017) #define IO_SET	TPORT |= (1 << PIN_IO)   /*电平置高*/
(0018) #define IO_R	TPIN & (1 << PIN_IO)     /*电平读取*/
(0019) #define IO_IN	TDDR &= ~(1 << PIN_IO)   /*方向输入*/
(0020) #define IO_OUT	TDDR |= (1 << PIN_IO)    /*方向输出*/
(0021) 
(0022) /*****************时钟信号*******************/
(0023) #define SCK_CLR	TPORT &= ~(1 << PIN_SCK)  /*时钟信号*/
(0024) #define SCK_SET	TPORT |= (1 << PIN_SCK)   /*电平置高*/
(0025) #define SCK_IN	TDDR &= ~(1 << PIN_SCK)   /*方向输入*/
(0026) #define SCK_OUT	TDDR |= (1 << PIN_SCK)    /*方向输出*/
(0027) 
(0028) #define ds1302_sec_add			0x80		//秒数据地址
(0029) #define ds1302_min_add			0x82		//分数据地址
(0030) #define ds1302_hr_add			0x84		//时数据地址
(0031) #define ds1302_date_add			0x86		//日数据地址
(0032) #define ds1302_month_add		0x88		//月数据地址
(0033) #define ds1302_day_add			0x8a		//星期数据地址
(0034) #define ds1302_year_add			0x8c		//年数据地址
(0035) #define ds1302_control_add		0x8e		//控制数据地址
(0036) #define ds1302_charger_add		0x90 					 
(0037) #define ds1302_clkburst_add		0xbe
(0038) 
(0039) unsigned char time_buf[8] = {0x20,0x0c,0x0A,0x1c,0x22,0x46,0x00,0x06};
(0040) /*
(0041)  struct tm {
(0042)    	int tm_sec;   // 秒 seconds after the minute, 0 to 60
(0043)    	int tm_min;   // 分 minutes after the hour, 0 to 59
(0044) 	int tm_hour;  // 时 hours since midnight, 0 to 23*
(0045) 	int tm_mday;  // 日 day of the month, 1 to 31
(0046) 	int tm_mon;   // 月 months since January, 0 to 11
(0047) 	int tm_year;  // 年 years since 1900
(0048) 	int tm_wday;  // 星期 days since Sunday, 0 to 6
(0049) 	int tm_yday;  // 从元旦起的天数 days since January 1, 0 to 365
(0050)  	int tm_isdst; // 夏令时？？Daylight Savings Time flag
(0051)  	};	
(0052) 	*/
(0053) 
(0054) //DS1302初始化函数
(0055) void ds1302_init(void) 
(0056) {
(0057) 	RST_CLR;			/*RST脚置低*/
_ds1302_init:
    0418D 98C4      CBI	0x18,4
(0058) 	SCK_CLR;			/*SCK脚置低*/
    0418E 98C6      CBI	0x18,6
(0059) 	RST_OUT;			/*RST脚设置为输出*/
    0418F 9ABC      SBI	0x17,4
(0060) 	SCK_OUT;			/*SCK脚设置为输出*/
    04190 9ABE      SBI	0x17,6
    04191 9508      RET
_ds1302_write_byte:
  i                    --> R20
  d                    --> R18
  addr                 --> R16
    04192 934A      ST	-Y,R20
(0061) }
(0062) 
(0063) //向DS1302写入一字节数据
(0064) void ds1302_write_byte(unsigned char addr, unsigned char d) {
(0065) 
(0066) 	unsigned char i;
(0067) 	RST_SET;					/*启动DS1302总线*/
    04193 9AC4      SBI	0x18,4
(0068) 	
(0069) 	/*写入目标地址：addr*/
(0070) 	IO_OUT;
    04194 9ABD      SBI	0x17,5
(0071) 	addr = addr & 0xFE;   //最低位置零，寄存器0位为0时写，为1时读
    04195 7F0E      ANDI	R16,0xFE
(0072) 	for (i = 0; i < 8; i ++) {
    04196 2744      CLR	R20
    04197 C009      RJMP	0x41A1
(0073) 		if (addr & 0x01) {
    04198 FF00      SBRS	R16,0
    04199 C002      RJMP	0x419C
(0074) 			IO_SET;
    0419A 9AC5      SBI	0x18,5
(0075) 			}
    0419B C001      RJMP	0x419D
(0076) 		else {
(0077) 			IO_CLR;
    0419C 98C5      CBI	0x18,5
(0078) 			}
(0079) 		SCK_SET;      //产生时钟
    0419D 9AC6      SBI	0x18,6
(0080) 		SCK_CLR;
    0419E 98C6      CBI	0x18,6
(0081) 		addr = addr >> 1;
    0419F 9506      LSR	R16
    041A0 9543      INC	R20
    041A1 3048      CPI	R20,0x8
    041A2 F3A8      BCS	0x4198
(0082) 		}
(0083) 	
(0084) 	/*写入数据：d*/
(0085) 	IO_OUT;
    041A3 9ABD      SBI	0x17,5
(0086) 	for (i = 0; i < 8; i ++) {
    041A4 2744      CLR	R20
    041A5 C009      RJMP	0x41AF
(0087) 		if (d & 0x01) {
    041A6 FF20      SBRS	R18,0
    041A7 C002      RJMP	0x41AA
(0088) 			IO_SET;
    041A8 9AC5      SBI	0x18,5
(0089) 			}
    041A9 C001      RJMP	0x41AB
(0090) 		else {
(0091) 			IO_CLR;
    041AA 98C5      CBI	0x18,5
(0092) 			}
(0093) 		SCK_SET;    //产生时钟
    041AB 9AC6      SBI	0x18,6
(0094) 		SCK_CLR;
    041AC 98C6      CBI	0x18,6
(0095) 		d = d >> 1;
    041AD 9526      LSR	R18
    041AE 9543      INC	R20
    041AF 3048      CPI	R20,0x8
    041B0 F3A8      BCS	0x41A6
(0096) 		}
(0097) 	RST_CLR;		//停止DS1302总线
    041B1 98C4      CBI	0x18,4
    041B2 9149      LD	R20,Y+
    041B3 9508      RET
_ds1302_read_byte:
  temp                 --> R20
  i                    --> R22
  addr                 --> R16
    041B4 934A      ST	-Y,R20
    041B5 936A      ST	-Y,R22
(0098) 	
(0099) }
(0100) 
(0101) //从DS1302读出一字节数据
(0102) unsigned char ds1302_read_byte(unsigned char addr) {
(0103) 
(0104) 	unsigned char i;
(0105) 	unsigned char temp;
(0106) 	RST_SET;					/*启动DS1302总线*/
    041B6 9AC4      SBI	0x18,4
(0107) 
(0108) 	/*写入目标地址：addr*/
(0109) 	IO_OUT;
    041B7 9ABD      SBI	0x17,5
(0110) 	addr = addr | 0x01;    //最低位置高，寄存器0位为0时写，为1时读
    041B8 6001      ORI	R16,1
(0111) 	for (i = 0; i < 8; i ++) {
    041B9 2766      CLR	R22
    041BA C009      RJMP	0x41C4
(0112) 		if (addr & 0x01) {
    041BB FF00      SBRS	R16,0
    041BC C002      RJMP	0x41BF
(0113) 			IO_SET;
    041BD 9AC5      SBI	0x18,5
(0114) 			}
    041BE C001      RJMP	0x41C0
(0115) 		else {
(0116) 			IO_CLR;
    041BF 98C5      CBI	0x18,5
(0117) 			}
(0118) 		SCK_SET;
    041C0 9AC6      SBI	0x18,6
(0119) 		SCK_CLR;
    041C1 98C6      CBI	0x18,6
(0120) 		addr = addr >> 1;
    041C2 9506      LSR	R16
    041C3 9563      INC	R22
    041C4 3068      CPI	R22,0x8
    041C5 F3A8      BCS	0x41BB
(0121) 		}
(0122) 	
(0123) 	/*输出数据：temp*/
(0124) 	IO_IN;
    041C6 98BD      CBI	0x17,5
(0125) 	for (i = 0; i < 8; i ++) {
    041C7 2766      CLR	R22
    041C8 C009      RJMP	0x41D2
(0126) 		temp = temp >> 1;
    041C9 9546      LSR	R20
(0127) 		if (IO_R) {
    041CA 9BB5      SBIS	0x16,5
    041CB C002      RJMP	0x41CE
(0128) 			temp |= 0x80;
    041CC 6840      ORI	R20,0x80
(0129) 			}
    041CD C001      RJMP	0x41CF
(0130) 		else {
(0131) 			temp &= 0x7F;
    041CE 774F      ANDI	R20,0x7F
(0132) 			}
(0133) 		SCK_SET;
    041CF 9AC6      SBI	0x18,6
(0134) 		SCK_CLR;
    041D0 98C6      CBI	0x18,6
    041D1 9563      INC	R22
    041D2 3068      CPI	R22,0x8
    041D3 F3A8      BCS	0x41C9
(0135) 		}
(0136) 	
(0137) 	RST_CLR;					/*停止DS1302总线*/
    041D4 98C4      CBI	0x18,4
(0138) 	return temp;
    041D5 2F04      MOV	R16,R20
    041D6 9169      LD	R22,Y+
    041D7 9149      LD	R20,Y+
    041D8 9508      RET
(0139) }
(0140) 
(0141) //向DS302写入时钟数据
(0142) void ds1302_write_time(void) {
(0143) 
(0144) 	ds1302_write_byte(ds1302_control_add,0x00);			//关闭写保护 
_ds1302_write_time:
    041D9 2722      CLR	R18
    041DA E80E      LDI	R16,0x8E
    041DB DFB6      RCALL	_ds1302_write_byte
(0145) 	ds1302_write_byte(ds1302_sec_add,0x80);				//暂停时钟 
    041DC E820      LDI	R18,0x80
    041DD E800      LDI	R16,0x80
    041DE DFB3      RCALL	_ds1302_write_byte
(0146) 	//ds1302_write_byte(ds1302_charger_add,0xa9);	    //涓流充电 
(0147) 	ds1302_write_byte(ds1302_year_add,time_buf[1]);		//年 
    041DF 9120 0586 LDS	R18,time_buf+1
    041E1 E80C      LDI	R16,0x8C
    041E2 DFAF      RCALL	_ds1302_write_byte
(0148) 	ds1302_write_byte(ds1302_month_add,time_buf[2]);	//月 
    041E3 9120 0587 LDS	R18,time_buf+2
    041E5 E808      LDI	R16,0x88
    041E6 DFAB      RCALL	_ds1302_write_byte
(0149) 	ds1302_write_byte(ds1302_date_add,time_buf[3]);		//日 
    041E7 9120 0588 LDS	R18,time_buf+3
    041E9 E806      LDI	R16,0x86
    041EA DFA7      RCALL	_ds1302_write_byte
(0150) 	ds1302_write_byte(ds1302_hr_add,time_buf[4]);		//时 
    041EB 9120 0589 LDS	R18,time_buf+4
    041ED E804      LDI	R16,0x84
    041EE DFA3      RCALL	_ds1302_write_byte
(0151) 	ds1302_write_byte(ds1302_min_add,time_buf[5]);		//分
    041EF 9120 058A LDS	R18,time_buf+5
    041F1 E802      LDI	R16,0x82
    041F2 DF9F      RCALL	_ds1302_write_byte
(0152) 	ds1302_write_byte(ds1302_sec_add,time_buf[6]);		//秒
    041F3 9120 058B LDS	R18,time_buf+6
    041F5 E800      LDI	R16,0x80
    041F6 DF9B      RCALL	_ds1302_write_byte
(0153) 	ds1302_write_byte(ds1302_day_add,time_buf[7]);		//周 
    041F7 9120 058C LDS	R18,time_buf+7
    041F9 E80A      LDI	R16,0x8A
    041FA DF97      RCALL	_ds1302_write_byte
(0154) 	ds1302_write_byte(ds1302_control_add,0x80);			//打开写保护 
    041FB E820      LDI	R18,0x80
    041FC E80E      LDI	R16,0x8E
    041FD CF94      RJMP	_ds1302_write_byte
_ds1302_read_time:
    041FE 92AA      ST	-Y,R10
    041FF 934A      ST	-Y,R20
(0155) }
(0156) 
(0157) //从DS302读出时钟数据
(0158) void ds1302_read_time(void)  { 
(0159) 	time_buf[1]=ds1302_read_byte(ds1302_year_add);		//年 
    04200 E80C      LDI	R16,0x8C
    04201 DFB2      RCALL	_ds1302_read_byte
    04202 9300 0586 STS	time_buf+1,R16
(0160) 	time_buf[2]=ds1302_read_byte(ds1302_month_add);		//月 
    04204 E808      LDI	R16,0x88
    04205 DFAE      RCALL	_ds1302_read_byte
    04206 9300 0587 STS	time_buf+2,R16
(0161) 	time_buf[3]=ds1302_read_byte(ds1302_date_add);		//日 
    04208 E806      LDI	R16,0x86
    04209 DFAA      RCALL	_ds1302_read_byte
    0420A 2EA0      MOV	R10,R16
    0420B 92A0 0588 STS	time_buf+3,R10
(0162) 	time_buf[4]=ds1302_read_byte(ds1302_hr_add);		//时 
    0420D E804      LDI	R16,0x84
    0420E DFA5      RCALL	_ds1302_read_byte
    0420F 2EA0      MOV	R10,R16
    04210 92A0 0589 STS	time_buf+4,R10
(0163) 	time_buf[5]=ds1302_read_byte(ds1302_min_add);		//分 
    04212 E802      LDI	R16,0x82
    04213 DFA0      RCALL	_ds1302_read_byte
    04214 2EA0      MOV	R10,R16
    04215 92A0 058A STS	time_buf+5,R10
(0164) 	time_buf[6]=(ds1302_read_byte(ds1302_sec_add))&0x7F;//秒，屏蔽秒的第7位，避免超出59
    04217 E800      LDI	R16,0x80
    04218 DF9B      RCALL	_ds1302_read_byte
    04219 2F40      MOV	R20,R16
    0421A 2F84      MOV	R24,R20
    0421B 778F      ANDI	R24,0x7F
    0421C 9380 058B STS	time_buf+6,R24
(0165) 	time_buf[7]=ds1302_read_byte(ds1302_day_add);		//周 
    0421E E80A      LDI	R16,0x8A
    0421F DF94      RCALL	_ds1302_read_byte
    04220 2EA0      MOV	R10,R16
    04221 92A0 058C STS	time_buf+7,R10
    04223 9149      LD	R20,Y+
    04224 90A9      LD	R10,Y+
    04225 9508      RET
_kbscan:
  key                  --> R20
  temp                 --> Y,+0
    04226 934A      ST	-Y,R20
    04227 9724      SBIW	R28,4
FILE: D:\LQD\software\software_src\key.c
(0001) #include "config.h"
(0002) //键盘扫描函数
(0003) unsigned char kbscan(void)
(0004)   {
(0005)    unsigned char key;
(0006)    unsigned long temp=0;
    04228 E080      LDI	R24,0
    04229 8388      ST	Y,R24
    0422A 8389      STD	Y+1,R24
    0422B 838A      STD	Y+2,R24
    0422C 838B      STD	Y+3,R24
(0007)    DDR_SET;
    0422D B38A      IN	R24,0x1A
    0422E 7087      ANDI	R24,7
    0422F BB8A      OUT	0x1A,R24
(0008)    
(0009)    if((KEY_PIN) != KEY_MASK)         //检测A口按键引脚电平，如果全是高电平则退出
    04230 B389      IN	R24,0x19
    04231 718F      ANDI	R24,0x1F
    04232 318F      CPI	R24,0x1F
    04233 F1A9      BEQ	0x4269
(0010)     {
(0011)      delayms(20);           //防抖
    04234 E104      LDI	R16,0x14
    04235 E010      LDI	R17,0
    04236 940E 2511 CALL	_delayms
(0012)      if((KEY_PIN) != KEY_MASK )      //再次检测A口电平，如果不全是高电平则继续执行程序
    04238 B389      IN	R24,0x19
    04239 718F      ANDI	R24,0x1F
    0423A 318F      CPI	R24,0x1F
    0423B F179      BEQ	0x426B
(0013)       {
(0014)        key = KEY_PIN ;          //读取PINA，将其存放在key中
    0423C B349      IN	R20,0x19
    0423D 714F      ANDI	R20,0x1F
    0423E C024      RJMP	0x4263
(0015)         while((KEY_PIN) != KEY_MASK)
(0016) 		{
(0017) 		 temp++ ;
    0423F E081      LDI	R24,1
    04240 E090      LDI	R25,0
    04241 E0A0      LDI	R26,0
    04242 E0B0      LDI	R27,0
    04243 8028      LD	R2,Y
    04244 8039      LDD	R3,Y+1
    04245 804A      LDD	R4,Y+2
    04246 805B      LDD	R5,Y+3
    04247 0E28      ADD	R2,R24
    04248 1E39      ADC	R3,R25
    04249 1E4A      ADC	R4,R26
    0424A 1E5B      ADC	R5,R27
    0424B 8228      ST	Y,R2
    0424C 8239      STD	Y+1,R3
    0424D 824A      STD	Y+2,R4
    0424E 825B      STD	Y+3,R5
(0018) 		 if(temp>LONGKEY) {  
    0424F E880      LDI	R24,0x80
    04250 E398      LDI	R25,0x38
    04251 E0A1      LDI	R26,1
    04252 E0B0      LDI	R27,0
    04253 8028      LD	R2,Y
    04254 8039      LDD	R3,Y+1
    04255 804A      LDD	R4,Y+2
    04256 805B      LDD	R5,Y+3
    04257 1582      CP	R24,R2
    04258 0593      CPC	R25,R3
    04259 05A4      CPC	R26,R4
    0425A 05B5      CPC	R27,R5
    0425B F438      BCC	0x4263
(0019) 		     delayms(30);
    0425C E10E      LDI	R16,0x1E
    0425D E010      LDI	R17,0
    0425E 940E 2511 CALL	_delayms
(0020) 			 return key+0x80;  
    04260 2F04      MOV	R16,R20
    04261 5800      SUBI	R16,0x80
    04262 C009      RJMP	0x426C
    04263 B389      IN	R24,0x19
    04264 718F      ANDI	R24,0x1F
    04265 318F      CPI	R24,0x1F
    04266 F6C1      BNE	0x423F
(0021) 		 };
(0022) 		}
(0023) 		; //当前有按键处于按下状态，再按其他按键时程序维持当前状态 
(0024)       	
(0025) 		return key;
    04267 2F04      MOV	R16,R20
    04268 C003      RJMP	0x426C
(0026) 	  
(0027) 	  }
(0028)     }
(0029) 	else return NO_KEY;
    04269 2700      CLR	R16
    0426A C001      RJMP	0x426C
(0030) 	
(0031) 	return NO_KEY;
FILE: <library>
    0426B 2700      CLR	R16
    0426C 9624      ADIW	R28,4
    0426D 9149      LD	R20,Y+
    0426E 9508      RET
__print:
    0426F 940E 4700 CALL	push_arg4
    04271 940E 4845 CALL	push_xgsetF0FC
    04273 976C      SBIW	R28,0x1C
    04274 2400      CLR	R0
    04275 2411      CLR	R1
    04276 8A1F      STD	Y+23,R1
    04277 8A0E      STD	Y+22,R0
    04278 C456      RJMP	0x46CF
    04279 A5E8      LDD	R30,Y+40
    0427A A5F9      LDD	R31,Y+41
    0427B 8180      LD	R24,Z
    0427C 3285      CPI	R24,0x25
    0427D F059      BEQ	0x4289
    0427E 8100      LD	R16,Z
    0427F A1EE      LDD	R30,Y+38
    04280 A1FF      LDD	R31,Y+39
    04281 940E 4892 CALL	xicallx
    04283 898E      LDD	R24,Y+22
    04284 899F      LDD	R25,Y+23
    04285 9601      ADIW	R24,1
    04286 8B9F      STD	Y+23,R25
    04287 8B8E      STD	Y+22,R24
    04288 C441      RJMP	0x46CA
    04289 2400      CLR	R0
    0428A 2411      CLR	R1
    0428B 8A1D      STD	Y+21,R1
    0428C 8A0C      STD	Y+20,R0
    0428D EF8F      LDI	R24,0xFF
    0428E EF9F      LDI	R25,0xFF
    0428F 8F99      STD	Y+25,R25
    04290 8F88      STD	Y+24,R24
    04291 24AA      CLR	R10
    04292 24BB      CLR	R11
    04293 E647      LDI	R20,0x67
    04294 E058      LDI	R21,0x8
    04295 E260      LDI	R22,0x20
    04296 A588      LDD	R24,Y+40
    04297 A599      LDD	R25,Y+41
    04298 9601      ADIW	R24,1
    04299 A799      STD	Y+41,R25
    0429A A788      STD	Y+40,R24
    0429B 24CC      CLR	R12
    0429C 24DD      CLR	R13
    0429D A5E8      LDD	R30,Y+40
    0429E A5F9      LDD	R31,Y+41
    0429F 80E0      LD	R14,Z
    042A0 24FF      CLR	R15
    042A1 01C7      MOVW	R24,R14
    042A2 3280      CPI	R24,0x20
    042A3 E0E0      LDI	R30,0
    042A4 079E      CPC	R25,R30
    042A5 F119      BEQ	0x42C9
    042A6 3283      CPI	R24,0x23
    042A7 E0E0      LDI	R30,0
    042A8 079E      CPC	R25,R30
    042A9 F091      BEQ	0x42BC
    042AA 3280      CPI	R24,0x20
    042AB E0E0      LDI	R30,0
    042AC 079E      CPC	R25,R30
    042AD F124      BLT	0x42D2
    042AE 01C7      MOVW	R24,R14
    042AF 328B      CPI	R24,0x2B
    042B0 E0E0      LDI	R30,0
    042B1 079E      CPC	R25,R30
    042B2 F089      BEQ	0x42C4
    042B3 328D      CPI	R24,0x2D
    042B4 E0E0      LDI	R30,0
    042B5 079E      CPC	R25,R30
    042B6 F049      BEQ	0x42C0
    042B7 3380      CPI	R24,0x30
    042B8 E0E0      LDI	R30,0
    042B9 079E      CPC	R25,R30
    042BA F099      BEQ	0x42CE
    042BB C016      RJMP	0x42D2
    042BC 01C5      MOVW	R24,R10
    042BD 6081      ORI	R24,1
    042BE 015C      MOVW	R10,R24
    042BF C015      RJMP	0x42D5
    042C0 01C5      MOVW	R24,R10
    042C1 6084      ORI	R24,4
    042C2 015C      MOVW	R10,R24
    042C3 C011      RJMP	0x42D5
    042C4 01C5      MOVW	R24,R10
    042C5 6088      ORI	R24,0x8
    042C6 015C      MOVW	R10,R24
    042C7 E26B      LDI	R22,0x2B
    042C8 C00C      RJMP	0x42D5
    042C9 01C5      MOVW	R24,R10
    042CA 6088      ORI	R24,0x8
    042CB 015C      MOVW	R10,R24
    042CC E260      LDI	R22,0x20
    042CD C007      RJMP	0x42D5
    042CE 01C5      MOVW	R24,R10
    042CF 6180      ORI	R24,0x10
    042D0 015C      MOVW	R10,R24
    042D1 C003      RJMP	0x42D5
    042D2 E081      LDI	R24,1
    042D3 E090      LDI	R25,0
    042D4 016C      MOVW	R12,R24
    042D5 20CC      TST	R12
    042D6 F411      BNE	0x42D9
    042D7 20DD      TST	R13
    042D8 F009      BEQ	0x42DA
    042D9 C006      RJMP	0x42E0
    042DA A588      LDD	R24,Y+40
    042DB A599      LDD	R25,Y+41
    042DC 9601      ADIW	R24,1
    042DD A799      STD	Y+41,R25
    042DE A788      STD	Y+40,R24
    042DF CFBD      RJMP	0x429D
    042E0 A5E8      LDD	R30,Y+40
    042E1 A5F9      LDD	R31,Y+41
    042E2 8100      LD	R16,Z
    042E3 2711      CLR	R17
    042E4 940E 4F55 CALL	_isdigit
    042E6 3000      CPI	R16,0
    042E7 0701      CPC	R16,R17
    042E8 F0B9      BEQ	0x4300
    042E9 A508      LDD	R16,Y+40
    042EA A519      LDD	R17,Y+41
    042EB 940E 4BB6 CALL	_atoi
    042ED 8B1D      STD	Y+21,R17
    042EE 8B0C      STD	Y+20,R16
    042EF C005      RJMP	0x42F5
    042F0 A588      LDD	R24,Y+40
    042F1 A599      LDD	R25,Y+41
    042F2 9601      ADIW	R24,1
    042F3 A799      STD	Y+41,R25
    042F4 A788      STD	Y+40,R24
    042F5 A5E8      LDD	R30,Y+40
    042F6 A5F9      LDD	R31,Y+41
    042F7 8100      LD	R16,Z
    042F8 2711      CLR	R17
    042F9 940E 4F55 CALL	_isdigit
    042FB 0168      MOVW	R12,R16
    042FC 3000      CPI	R16,0
    042FD 0701      CPC	R16,R17
    042FE F789      BNE	0x42F0
    042FF C015      RJMP	0x4315
    04300 A5E8      LDD	R30,Y+40
    04301 A5F9      LDD	R31,Y+41
    04302 8180      LD	R24,Z
    04303 328A      CPI	R24,0x2A
    04304 F481      BNE	0x4315
    04305 A58A      LDD	R24,Y+42
    04306 A59B      LDD	R25,Y+43
    04307 9602      ADIW	R24,2
    04308 A79B      STD	Y+43,R25
    04309 A78A      STD	Y+42,R24
    0430A 01FC      MOVW	R30,R24
    0430B 9732      SBIW	R30,2
    0430C 8020      LD	R2,Z
    0430D 8031      LDD	R3,Z+1
    0430E 8A3D      STD	Y+21,R3
    0430F 8A2C      STD	Y+20,R2
    04310 A588      LDD	R24,Y+40
    04311 A599      LDD	R25,Y+41
    04312 9601      ADIW	R24,1
    04313 A799      STD	Y+41,R25
    04314 A788      STD	Y+40,R24
    04315 A5E8      LDD	R30,Y+40
    04316 A5F9      LDD	R31,Y+41
    04317 8180      LD	R24,Z
    04318 328E      CPI	R24,0x2E
    04319 F009      BEQ	0x431B
    0431A C03A      RJMP	0x4355
    0431B 01CF      MOVW	R24,R30
    0431C 9601      ADIW	R24,1
    0431D A799      STD	Y+41,R25
    0431E A788      STD	Y+40,R24
    0431F 01FC      MOVW	R30,R24
    04320 8100      LD	R16,Z
    04321 2711      CLR	R17
    04322 940E 4F55 CALL	_isdigit
    04324 0168      MOVW	R12,R16
    04325 3000      CPI	R16,0
    04326 0701      CPC	R16,R17
    04327 F0C1      BEQ	0x4340
    04328 A508      LDD	R16,Y+40
    04329 A519      LDD	R17,Y+41
    0432A 940E 4BB6 CALL	_atoi
    0432C 0168      MOVW	R12,R16
    0432D 8ED9      STD	Y+25,R13
    0432E 8EC8      STD	Y+24,R12
    0432F C005      RJMP	0x4335
    04330 A588      LDD	R24,Y+40
    04331 A599      LDD	R25,Y+41
    04332 9601      ADIW	R24,1
    04333 A799      STD	Y+41,R25
    04334 A788      STD	Y+40,R24
    04335 A5E8      LDD	R30,Y+40
    04336 A5F9      LDD	R31,Y+41
    04337 8100      LD	R16,Z
    04338 2711      CLR	R17
    04339 940E 4F55 CALL	_isdigit
    0433B 0168      MOVW	R12,R16
    0433C 3000      CPI	R16,0
    0433D 0701      CPC	R16,R17
    0433E F789      BNE	0x4330
    0433F C015      RJMP	0x4355
    04340 A5E8      LDD	R30,Y+40
    04341 A5F9      LDD	R31,Y+41
    04342 8180      LD	R24,Z
    04343 328A      CPI	R24,0x2A
    04344 F481      BNE	0x4355
    04345 A58A      LDD	R24,Y+42
    04346 A59B      LDD	R25,Y+43
    04347 9602      ADIW	R24,2
    04348 A79B      STD	Y+43,R25
    04349 A78A      STD	Y+42,R24
    0434A 01FC      MOVW	R30,R24
    0434B 9732      SBIW	R30,2
    0434C 8020      LD	R2,Z
    0434D 8031      LDD	R3,Z+1
    0434E 8E39      STD	Y+25,R3
    0434F 8E28      STD	Y+24,R2
    04350 A588      LDD	R24,Y+40
    04351 A599      LDD	R25,Y+41
    04352 9601      ADIW	R24,1
    04353 A799      STD	Y+41,R25
    04354 A788      STD	Y+40,R24
    04355 A5E8      LDD	R30,Y+40
    04356 A5F9      LDD	R31,Y+41
    04357 8180      LD	R24,Z
    04358 368C      CPI	R24,0x6C
    04359 F439      BNE	0x4361
    0435A 01CF      MOVW	R24,R30
    0435B 9601      ADIW	R24,1
    0435C A799      STD	Y+41,R25
    0435D A788      STD	Y+40,R24
    0435E 01C5      MOVW	R24,R10
    0435F 6082      ORI	R24,2
    04360 015C      MOVW	R10,R24
    04361 A5E8      LDD	R30,Y+40
    04362 A5F9      LDD	R31,Y+41
    04363 80C0      LD	R12,Z
    04364 24DD      CLR	R13
    04365 01C6      MOVW	R24,R12
    04366 3583      CPI	R24,0x53
    04367 E0E0      LDI	R30,0
    04368 079E      CPC	R25,R30
    04369 F409      BNE	0x436B
    0436A C18A      RJMP	0x44F5
    0436B E583      LDI	R24,0x53
    0436C 158C      CP	R24,R12
    0436D 059D      CPC	R25,R13
    0436E F064      BLT	0x437B
    0436F 01C6      MOVW	R24,R12
    04370 3485      CPI	R24,0x45
    04371 E0E0      LDI	R30,0
    04372 079E      CPC	R25,R30
    04373 F409      BNE	0x4375
    04374 C307      RJMP	0x467C
    04375 3487      CPI	R24,0x47
    04376 E0E0      LDI	R30,0
    04377 079E      CPC	R25,R30
    04378 F409      BNE	0x437A
    04379 C30B      RJMP	0x4685
    0437A C043      RJMP	0x43BE
    0437B 01C6      MOVW	R24,R12
    0437C 3588      CPI	R24,0x58
    0437D E0E0      LDI	R30,0
    0437E 079E      CPC	R25,R30
    0437F F409      BNE	0x4381
    04380 C07E      RJMP	0x43FF
    04381 3588      CPI	R24,0x58
    04382 E0E0      LDI	R30,0
    04383 079E      CPC	R25,R30
    04384 F40C      BGE	0x4386
    04385 C038      RJMP	0x43BE
    04386 01C6      MOVW	R24,R12
    04387 3683      CPI	R24,0x63
    04388 E0E0      LDI	R30,0
    04389 079E      CPC	R25,R30
    0438A F409      BNE	0x438C
    0438B C145      RJMP	0x44D1
    0438C 3684      CPI	R24,0x64
    0438D E0E0      LDI	R30,0
    0438E 079E      CPC	R25,R30
    0438F F409      BNE	0x4391
    04390 C03A      RJMP	0x43CB
    04391 3685      CPI	R24,0x65
    04392 E0E0      LDI	R30,0
    04393 079E      CPC	R25,R30
    04394 F409      BNE	0x4396
    04395 C2E3      RJMP	0x4679
    04396 3686      CPI	R24,0x66
    04397 E0E0      LDI	R30,0
    04398 079E      CPC	R25,R30
    04399 F409      BNE	0x439B
    0439A C2E4      RJMP	0x467F
    0439B 3687      CPI	R24,0x67
    0439C E0E0      LDI	R30,0
    0439D 079E      CPC	R25,R30
    0439E F409      BNE	0x43A0
    0439F C2E2      RJMP	0x4682
    043A0 3689      CPI	R24,0x69
    043A1 E0E0      LDI	R30,0
    043A2 079E      CPC	R25,R30
    043A3 F139      BEQ	0x43CB
    043A4 368F      CPI	R24,0x6F
    043A5 E0E0      LDI	R30,0
    043A6 079E      CPC	R25,R30
    043A7 F409      BNE	0x43A9
    043A8 C056      RJMP	0x43FF
    043A9 3780      CPI	R24,0x70
    043AA E0E0      LDI	R30,0
    043AB 079E      CPC	R25,R30
    043AC F409      BNE	0x43AE
    043AD C051      RJMP	0x43FF
    043AE 3783      CPI	R24,0x73
    043AF E0E0      LDI	R30,0
    043B0 079E      CPC	R25,R30
    043B1 F409      BNE	0x43B3
    043B2 C200      RJMP	0x45B3
    043B3 3785      CPI	R24,0x75
    043B4 E0E0      LDI	R30,0
    043B5 079E      CPC	R25,R30
    043B6 F409      BNE	0x43B8
    043B7 C047      RJMP	0x43FF
    043B8 3788      CPI	R24,0x78
    043B9 E0E0      LDI	R30,0
    043BA 079E      CPC	R25,R30
    043BB F409      BNE	0x43BD
    043BC C042      RJMP	0x43FF
    043BD C000      RJMP	0x43BE
    043BE A5E8      LDD	R30,Y+40
    043BF A5F9      LDD	R31,Y+41
    043C0 8100      LD	R16,Z
    043C1 A1EE      LDD	R30,Y+38
    043C2 A1FF      LDD	R31,Y+39
    043C3 940E 4892 CALL	xicallx
    043C5 898E      LDD	R24,Y+22
    043C6 899F      LDD	R25,Y+23
    043C7 9601      ADIW	R24,1
    043C8 8B9F      STD	Y+23,R25
    043C9 8B8E      STD	Y+22,R24
    043CA C2FF      RJMP	0x46CA
    043CB FEA1      SBRS	R10,1
    043CC C01E      RJMP	0x43EB
    043CD A58A      LDD	R24,Y+42
    043CE A59B      LDD	R25,Y+43
    043CF 9604      ADIW	R24,4
    043D0 A79B      STD	Y+43,R25
    043D1 A78A      STD	Y+42,R24
    043D2 01FC      MOVW	R30,R24
    043D3 9734      SBIW	R30,4
    043D4 8020      LD	R2,Z
    043D5 8031      LDD	R3,Z+1
    043D6 8042      LDD	R4,Z+2
    043D7 8053      LDD	R5,Z+3
    043D8 862C      STD	Y+12,R2
    043D9 863D      STD	Y+13,R3
    043DA 864E      STD	Y+14,R4
    043DB 865F      STD	Y+15,R5
    043DC E08A      LDI	R24,0xA
    043DD E090      LDI	R25,0
    043DE 839B      STD	Y+3,R25
    043DF 838A      STD	Y+2,R24
    043E0 842C      LDD	R2,Y+12
    043E1 843D      LDD	R3,Y+13
    043E2 844E      LDD	R4,Y+14
    043E3 845F      LDD	R5,Y+15
    043E4 8248      ST	Y,R4
    043E5 8259      STD	Y+1,R5
    043E6 0191      MOVW	R18,R2
    043E7 018A      MOVW	R16,R20
    043E8 940E 4C67 CALL	_ltoa
    043EA C0C1      RJMP	0x44AC
    043EB A58A      LDD	R24,Y+42
    043EC A59B      LDD	R25,Y+43
    043ED 9602      ADIW	R24,2
    043EE A79B      STD	Y+43,R25
    043EF A78A      STD	Y+42,R24
    043F0 01FC      MOVW	R30,R24
    043F1 9732      SBIW	R30,2
    043F2 8020      LD	R2,Z
    043F3 8031      LDD	R3,Z+1
    043F4 8E3B      STD	Y+27,R3
    043F5 8E2A      STD	Y+26,R2
    043F6 E08A      LDI	R24,0xA
    043F7 E090      LDI	R25,0
    043F8 8399      STD	Y+1,R25
    043F9 8388      ST	Y,R24
    043FA 0191      MOVW	R18,R2
    043FB 018A      MOVW	R16,R20
    043FC 940E 4BFC CALL	_itoa
    043FE C0AD      RJMP	0x44AC
    043FF FEA1      SBRS	R10,1
    04400 C010      RJMP	0x4411
    04401 A58A      LDD	R24,Y+42
    04402 A59B      LDD	R25,Y+43
    04403 9604      ADIW	R24,4
    04404 A79B      STD	Y+43,R25
    04405 A78A      STD	Y+42,R24
    04406 01FC      MOVW	R30,R24
    04407 9734      SBIW	R30,4
    04408 8020      LD	R2,Z
    04409 8031      LDD	R3,Z+1
    0440A 8042      LDD	R4,Z+2
    0440B 8053      LDD	R5,Z+3
    0440C 862C      STD	Y+12,R2
    0440D 863D      STD	Y+13,R3
    0440E 864E      STD	Y+14,R4
    0440F 865F      STD	Y+15,R5
    04410 C00B      RJMP	0x441C
    04411 A58A      LDD	R24,Y+42
    04412 A59B      LDD	R25,Y+43
    04413 9602      ADIW	R24,2
    04414 A79B      STD	Y+43,R25
    04415 A78A      STD	Y+42,R24
    04416 01FC      MOVW	R30,R24
    04417 9732      SBIW	R30,2
    04418 8020      LD	R2,Z
    04419 8031      LDD	R3,Z+1
    0441A 8E3B      STD	Y+27,R3
    0441B 8E2A      STD	Y+26,R2
    0441C A5E8      LDD	R30,Y+40
    0441D A5F9      LDD	R31,Y+41
    0441E 8180      LD	R24,Z
    0441F 3785      CPI	R24,0x75
    04420 F4D9      BNE	0x443C
    04421 FEA1      SBRS	R10,1
    04422 C00F      RJMP	0x4432
    04423 E08A      LDI	R24,0xA
    04424 E090      LDI	R25,0
    04425 839B      STD	Y+3,R25
    04426 838A      STD	Y+2,R24
    04427 842C      LDD	R2,Y+12
    04428 843D      LDD	R3,Y+13
    04429 844E      LDD	R4,Y+14
    0442A 845F      LDD	R5,Y+15
    0442B 8248      ST	Y,R4
    0442C 8259      STD	Y+1,R5
    0442D 0191      MOVW	R18,R2
    0442E 018A      MOVW	R16,R20
    0442F 940E 4D1F CALL	_ultoa
    04431 C07A      RJMP	0x44AC
    04432 E08A      LDI	R24,0xA
    04433 E090      LDI	R25,0
    04434 8399      STD	Y+1,R25
    04435 8388      ST	Y,R24
    04436 8D2A      LDD	R18,Y+26
    04437 8D3B      LDD	R19,Y+27
    04438 018A      MOVW	R16,R20
    04439 940E 4D86 CALL	_utoa
    0443B C070      RJMP	0x44AC
    0443C A5E8      LDD	R30,Y+40
    0443D A5F9      LDD	R31,Y+41
    0443E 8180      LD	R24,Z
    0443F 368F      CPI	R24,0x6F
    04440 F509      BNE	0x4462
    04441 FEA0      SBRS	R10,0
    04442 C004      RJMP	0x4447
    04443 E380      LDI	R24,0x30
    04444 01FA      MOVW	R30,R20
    04445 9381      ST	Z+,R24
    04446 01AF      MOVW	R20,R30
    04447 FEA1      SBRS	R10,1
    04448 C00F      RJMP	0x4458
    04449 E088      LDI	R24,0x8
    0444A E090      LDI	R25,0
    0444B 839B      STD	Y+3,R25
    0444C 838A      STD	Y+2,R24
    0444D 842C      LDD	R2,Y+12
    0444E 843D      LDD	R3,Y+13
    0444F 844E      LDD	R4,Y+14
    04450 845F      LDD	R5,Y+15
    04451 8248      ST	Y,R4
    04452 8259      STD	Y+1,R5
    04453 0191      MOVW	R18,R2
    04454 018A      MOVW	R16,R20
    04455 940E 4D1F CALL	_ultoa
    04457 C054      RJMP	0x44AC
    04458 E088      LDI	R24,0x8
    04459 E090      LDI	R25,0
    0445A 8399      STD	Y+1,R25
    0445B 8388      ST	Y,R24
    0445C 8D2A      LDD	R18,Y+26
    0445D 8D3B      LDD	R19,Y+27
    0445E 018A      MOVW	R16,R20
    0445F 940E 4D86 CALL	_utoa
    04461 C04A      RJMP	0x44AC
    04462 A5E8      LDD	R30,Y+40
    04463 A5F9      LDD	R31,Y+41
    04464 8180      LD	R24,Z
    04465 3780      CPI	R24,0x70
    04466 F439      BNE	0x446E
    04467 E380      LDI	R24,0x30
    04468 01FA      MOVW	R30,R20
    04469 9381      ST	Z+,R24
    0446A E788      LDI	R24,0x78
    0446B 9381      ST	Z+,R24
    0446C 01AF      MOVW	R20,R30
    0446D C00C      RJMP	0x447A
    0446E FEA0      SBRS	R10,0
    0446F C00A      RJMP	0x447A
    04470 E380      LDI	R24,0x30
    04471 01FA      MOVW	R30,R20
    04472 9381      ST	Z+,R24
    04473 01AF      MOVW	R20,R30
    04474 A5E8      LDD	R30,Y+40
    04475 A5F9      LDD	R31,Y+41
    04476 8020      LD	R2,Z
    04477 01FA      MOVW	R30,R20
    04478 9221      ST	Z+,R2
    04479 01AF      MOVW	R20,R30
    0447A FEA1      SBRS	R10,1
    0447B C00F      RJMP	0x448B
    0447C E180      LDI	R24,0x10
    0447D E090      LDI	R25,0
    0447E 839B      STD	Y+3,R25
    0447F 838A      STD	Y+2,R24
    04480 842C      LDD	R2,Y+12
    04481 843D      LDD	R3,Y+13
    04482 844E      LDD	R4,Y+14
    04483 845F      LDD	R5,Y+15
    04484 8248      ST	Y,R4
    04485 8259      STD	Y+1,R5
    04486 0191      MOVW	R18,R2
    04487 018A      MOVW	R16,R20
    04488 940E 4D1F CALL	_ultoa
    0448A C009      RJMP	0x4494
    0448B E180      LDI	R24,0x10
    0448C E090      LDI	R25,0
    0448D 8399      STD	Y+1,R25
    0448E 8388      ST	Y,R24
    0448F 8D2A      LDD	R18,Y+26
    04490 8D3B      LDD	R19,Y+27
    04491 018A      MOVW	R16,R20
    04492 940E 4D86 CALL	_utoa
    04494 A5E8      LDD	R30,Y+40
    04495 A5F9      LDD	R31,Y+41
    04496 8180      LD	R24,Z
    04497 3588      CPI	R24,0x58
    04498 F499      BNE	0x44AC
    04499 E687      LDI	R24,0x67
    0449A E098      LDI	R25,0x8
    0449B 017C      MOVW	R14,R24
    0449C C00B      RJMP	0x44A8
    0449D 01F7      MOVW	R30,R14
    0449E 8100      LD	R16,Z
    0449F 2711      CLR	R17
    044A0 940E 4F73 CALL	_toupper
    044A2 0168      MOVW	R12,R16
    044A3 01F7      MOVW	R30,R14
    044A4 82C0      ST	Z,R12
    044A5 01C7      MOVW	R24,R14
    044A6 9601      ADIW	R24,1
    044A7 017C      MOVW	R14,R24
    044A8 01F7      MOVW	R30,R14
    044A9 8020      LD	R2,Z
    044AA 2022      TST	R2
    044AB F789      BNE	0x449D
    044AC E687      LDI	R24,0x67
    044AD E098      LDI	R25,0x8
    044AE 017C      MOVW	R14,R24
    044AF 8D88      LDD	R24,Y+24
    044B0 8D99      LDD	R25,Y+25
    044B1 3F8F      CPI	R24,0xFF
    044B2 EFEF      LDI	R30,0xFF
    044B3 079E      CPC	R25,R30
    044B4 F421      BNE	0x44B9
    044B5 2400      CLR	R0
    044B6 2411      CLR	R1
    044B7 8E19      STD	Y+25,R1
    044B8 8E08      STD	Y+24,R0
    044B9 8C08      LDD	R0,Y+24
    044BA 8C19      LDD	R1,Y+25
    044BB 2000      TST	R0
    044BC F419      BNE	0x44C0
    044BD 2011      TST	R1
    044BE F409      BNE	0x44C0
    044BF C104      RJMP	0x45C4
    044C0 E607      LDI	R16,0x67
    044C1 E018      LDI	R17,0x8
    044C2 940E 46F4 CALL	_strlen
    044C4 0168      MOVW	R12,R16
    044C5 8EDB      STD	Y+27,R13
    044C6 8ECA      STD	Y+26,R12
    044C7 8C08      LDD	R0,Y+24
    044C8 8C19      LDD	R1,Y+25
    044C9 140C      CP	R0,R12
    044CA 041D      CPC	R1,R13
    044CB F00C      BLT	0x44CD
    044CC C0F7      RJMP	0x45C4
    044CD 0106      MOVW	R0,R12
    044CE 8E19      STD	Y+25,R1
    044CF 8E08      STD	Y+24,R0
    044D0 C0F3      RJMP	0x45C4
    044D1 A58A      LDD	R24,Y+42
    044D2 A59B      LDD	R25,Y+43
    044D3 9602      ADIW	R24,2
    044D4 A79B      STD	Y+43,R25
    044D5 A78A      STD	Y+42,R24
    044D6 01FC      MOVW	R30,R24
    044D7 9732      SBIW	R30,2
    044D8 8020      LD	R2,Z
    044D9 8031      LDD	R3,Z+1
    044DA 862A      STD	Y+10,R2
    044DB E081      LDI	R24,1
    044DC E090      LDI	R25,0
    044DD 880C      LDD	R0,Y+20
    044DE 881D      LDD	R1,Y+21
    044DF 1580      CP	R24,R0
    044E0 0591      CPC	R25,R1
    044E1 F444      BGE	0x44EA
    044E2 8E19      STD	Y+25,R1
    044E3 8E08      STD	Y+24,R0
    044E4 2422      CLR	R2
    044E5 862B      STD	Y+11,R2
    044E6 01CE      MOVW	R24,R28
    044E7 960A      ADIW	R24,0xA
    044E8 017C      MOVW	R14,R24
    044E9 C0DA      RJMP	0x45C4
    044EA 850A      LDD	R16,Y+10
    044EB A1EE      LDD	R30,Y+38
    044EC A1FF      LDD	R31,Y+39
    044ED 940E 4892 CALL	xicallx
    044EF 898E      LDD	R24,Y+22
    044F0 899F      LDD	R25,Y+23
    044F1 9601      ADIW	R24,1
    044F2 8B9F      STD	Y+23,R25
    044F3 8B8E      STD	Y+22,R24
    044F4 C1D5      RJMP	0x46CA
    044F5 A58A      LDD	R24,Y+42
    044F6 A59B      LDD	R25,Y+43
    044F7 9602      ADIW	R24,2
    044F8 A79B      STD	Y+43,R25
    044F9 A78A      STD	Y+42,R24
    044FA 01FC      MOVW	R30,R24
    044FB 9732      SBIW	R30,2
    044FC 80C0      LD	R12,Z
    044FD 80D1      LDD	R13,Z+1
    044FE 8D88      LDD	R24,Y+24
    044FF 8D99      LDD	R25,Y+25
    04500 3F8F      CPI	R24,0xFF
    04501 EFEF      LDI	R30,0xFF
    04502 079E      CPC	R25,R30
    04503 F421      BNE	0x4508
    04504 2400      CLR	R0
    04505 2411      CLR	R1
    04506 8E19      STD	Y+25,R1
    04507 8E08      STD	Y+24,R0
    04508 880C      LDD	R0,Y+20
    04509 881D      LDD	R1,Y+21
    0450A 2000      TST	R0
    0450B F411      BNE	0x450E
    0450C 2011      TST	R1
    0450D F051      BEQ	0x4518
    0450E 0186      MOVW	R16,R12
    0450F 940E 4BA9 CALL	_cstrlen
    04511 01A8      MOVW	R20,R16
    04512 882C      LDD	R2,Y+20
    04513 883D      LDD	R3,Y+21
    04514 1A20      SUB	R2,R16
    04515 0A31      SBC	R3,R17
    04516 8A3D      STD	Y+21,R3
    04517 8A2C      STD	Y+20,R2
    04518 8C08      LDD	R0,Y+24
    04519 8C19      LDD	R1,Y+25
    0451A 2000      TST	R0
    0451B F441      BNE	0x4524
    0451C 2011      TST	R1
    0451D F431      BNE	0x4524
    0451E 0186      MOVW	R16,R12
    0451F 940E 4BA9 CALL	_cstrlen
    04521 01A8      MOVW	R20,R16
    04522 8F59      STD	Y+25,R21
    04523 8F48      STD	Y+24,R20
    04524 880C      LDD	R0,Y+20
    04525 881D      LDD	R1,Y+21
    04526 2000      TST	R0
    04527 F411      BNE	0x452A
    04528 2011      TST	R1
    04529 F031      BEQ	0x4530
    0452A FEA3      SBRS	R10,3
    0452B C004      RJMP	0x4530
    0452C 01C0      MOVW	R24,R0
    0452D 9701      SBIW	R24,1
    0452E 8B9D      STD	Y+21,R25
    0452F 8B8C      STD	Y+20,R24
    04530 FEA4      SBRS	R10,4
    04531 C026      RJMP	0x4558
    04532 FEA3      SBRS	R10,3
    04533 C00A      RJMP	0x453E
    04534 2F06      MOV	R16,R22
    04535 A1EE      LDD	R30,Y+38
    04536 A1FF      LDD	R31,Y+39
    04537 940E 4892 CALL	xicallx
    04539 898E      LDD	R24,Y+22
    0453A 899F      LDD	R25,Y+23
    0453B 9601      ADIW	R24,1
    0453C 8B9F      STD	Y+23,R25
    0453D 8B8E      STD	Y+22,R24
    0453E FCA2      SBRC	R10,2
    0453F C04C      RJMP	0x458C
    04540 C00F      RJMP	0x4550
    04541 E300      LDI	R16,0x30
    04542 A1EE      LDD	R30,Y+38
    04543 A1FF      LDD	R31,Y+39
    04544 940E 4892 CALL	xicallx
    04546 898E      LDD	R24,Y+22
    04547 899F      LDD	R25,Y+23
    04548 9601      ADIW	R24,1
    04549 8B9F      STD	Y+23,R25
    0454A 8B8E      STD	Y+22,R24
    0454B 898C      LDD	R24,Y+20
    0454C 899D      LDD	R25,Y+21
    0454D 9701      SBIW	R24,1
    0454E 8B9D      STD	Y+21,R25
    0454F 8B8C      STD	Y+20,R24
    04550 2422      CLR	R2
    04551 2433      CLR	R3
    04552 880C      LDD	R0,Y+20
    04553 881D      LDD	R1,Y+21
    04554 1420      CP	R2,R0
    04555 0431      CPC	R3,R1
    04556 F354      BLT	0x4541
    04557 C034      RJMP	0x458C
    04558 FCA2      SBRC	R10,2
    04559 C017      RJMP	0x4571
    0455A C00F      RJMP	0x456A
    0455B E200      LDI	R16,0x20
    0455C A1EE      LDD	R30,Y+38
    0455D A1FF      LDD	R31,Y+39
    0455E 940E 4892 CALL	xicallx
    04560 898E      LDD	R24,Y+22
    04561 899F      LDD	R25,Y+23
    04562 9601      ADIW	R24,1
    04563 8B9F      STD	Y+23,R25
    04564 8B8E      STD	Y+22,R24
    04565 898C      LDD	R24,Y+20
    04566 899D      LDD	R25,Y+21
    04567 9701      SBIW	R24,1
    04568 8B9D      STD	Y+21,R25
    04569 8B8C      STD	Y+20,R24
    0456A 2422      CLR	R2
    0456B 2433      CLR	R3
    0456C 880C      LDD	R0,Y+20
    0456D 881D      LDD	R1,Y+21
    0456E 1420      CP	R2,R0
    0456F 0431      CPC	R3,R1
    04570 F354      BLT	0x455B
    04571 FEA3      SBRS	R10,3
    04572 C019      RJMP	0x458C
    04573 2F06      MOV	R16,R22
    04574 A1EE      LDD	R30,Y+38
    04575 A1FF      LDD	R31,Y+39
    04576 940E 4892 CALL	xicallx
    04578 898E      LDD	R24,Y+22
    04579 899F      LDD	R25,Y+23
    0457A 9601      ADIW	R24,1
    0457B 8B9F      STD	Y+23,R25
    0457C 8B8E      STD	Y+22,R24
    0457D C00E      RJMP	0x458C
    0457E 01F6      MOVW	R30,R12
    0457F 9106      ELPM	R16,Z
    04580 A1EE      LDD	R30,Y+38
    04581 A1FF      LDD	R31,Y+39
    04582 940E 4892 CALL	xicallx
    04584 898E      LDD	R24,Y+22
    04585 899F      LDD	R25,Y+23
    04586 9601      ADIW	R24,1
    04587 8B9F      STD	Y+23,R25
    04588 8B8E      STD	Y+22,R24
    04589 01C6      MOVW	R24,R12
    0458A 9601      ADIW	R24,1
    0458B 016C      MOVW	R12,R24
    0458C 01F6      MOVW	R30,R12
    0458D 9026      ELPM	R2,Z
    0458E 2022      TST	R2
    0458F F049      BEQ	0x4599
    04590 8D48      LDD	R20,Y+24
    04591 8D59      LDD	R21,Y+25
    04592 01CA      MOVW	R24,R20
    04593 9701      SBIW	R24,1
    04594 8F99      STD	Y+25,R25
    04595 8F88      STD	Y+24,R24
    04596 3040      CPI	R20,0
    04597 0745      CPC	R20,R21
    04598 F729      BNE	0x457E
    04599 FEA2      SBRS	R10,2
    0459A C12F      RJMP	0x46CA
    0459B C00F      RJMP	0x45AB
    0459C E200      LDI	R16,0x20
    0459D A1EE      LDD	R30,Y+38
    0459E A1FF      LDD	R31,Y+39
    0459F 940E 4892 CALL	xicallx
    045A1 898E      LDD	R24,Y+22
    045A2 899F      LDD	R25,Y+23
    045A3 9601      ADIW	R24,1
    045A4 8B9F      STD	Y+23,R25
    045A5 8B8E      STD	Y+22,R24
    045A6 898C      LDD	R24,Y+20
    045A7 899D      LDD	R25,Y+21
    045A8 9701      SBIW	R24,1
    045A9 8B9D      STD	Y+21,R25
    045AA 8B8C      STD	Y+20,R24
    045AB 2422      CLR	R2
    045AC 2433      CLR	R3
    045AD 880C      LDD	R0,Y+20
    045AE 881D      LDD	R1,Y+21
    045AF 1420      CP	R2,R0
    045B0 0431      CPC	R3,R1
    045B1 F354      BLT	0x459C
    045B2 C117      RJMP	0x46CA
    045B3 A58A      LDD	R24,Y+42
    045B4 A59B      LDD	R25,Y+43
    045B5 9602      ADIW	R24,2
    045B6 A79B      STD	Y+43,R25
    045B7 A78A      STD	Y+42,R24
    045B8 01FC      MOVW	R30,R24
    045B9 9732      SBIW	R30,2
    045BA 80E0      LD	R14,Z
    045BB 80F1      LDD	R15,Z+1
    045BC 20EE      TST	R14
    045BD F431      BNE	0x45C4
    045BE 20FF      TST	R15
    045BF F421      BNE	0x45C4
    045C0 ED86      LDI	R24,0xD6
    045C1 E090      LDI	R25,0
    045C2 016C      MOVW	R12,R24
    045C3 CF3A      RJMP	0x44FE
    045C4 8D88      LDD	R24,Y+24
    045C5 8D99      LDD	R25,Y+25
    045C6 3F8F      CPI	R24,0xFF
    045C7 EFEF      LDI	R30,0xFF
    045C8 079E      CPC	R25,R30
    045C9 F421      BNE	0x45CE
    045CA 2400      CLR	R0
    045CB 2411      CLR	R1
    045CC 8E19      STD	Y+25,R1
    045CD 8E08      STD	Y+24,R0
    045CE 880C      LDD	R0,Y+20
    045CF 881D      LDD	R1,Y+21
    045D0 2000      TST	R0
    045D1 F411      BNE	0x45D4
    045D2 2011      TST	R1
    045D3 F051      BEQ	0x45DE
    045D4 0187      MOVW	R16,R14
    045D5 940E 46F4 CALL	_strlen
    045D7 0168      MOVW	R12,R16
    045D8 882C      LDD	R2,Y+20
    045D9 883D      LDD	R3,Y+21
    045DA 1A20      SUB	R2,R16
    045DB 0A31      SBC	R3,R17
    045DC 8A3D      STD	Y+21,R3
    045DD 8A2C      STD	Y+20,R2
    045DE 8C08      LDD	R0,Y+24
    045DF 8C19      LDD	R1,Y+25
    045E0 2000      TST	R0
    045E1 F441      BNE	0x45EA
    045E2 2011      TST	R1
    045E3 F431      BNE	0x45EA
    045E4 0187      MOVW	R16,R14
    045E5 940E 46F4 CALL	_strlen
    045E7 0168      MOVW	R12,R16
    045E8 8ED9      STD	Y+25,R13
    045E9 8EC8      STD	Y+24,R12
    045EA 880C      LDD	R0,Y+20
    045EB 881D      LDD	R1,Y+21
    045EC 2000      TST	R0
    045ED F411      BNE	0x45F0
    045EE 2011      TST	R1
    045EF F031      BEQ	0x45F6
    045F0 FEA3      SBRS	R10,3
    045F1 C004      RJMP	0x45F6
    045F2 01C0      MOVW	R24,R0
    045F3 9701      SBIW	R24,1
    045F4 8B9D      STD	Y+21,R25
    045F5 8B8C      STD	Y+20,R24
    045F6 FEA4      SBRS	R10,4
    045F7 C026      RJMP	0x461E
    045F8 FEA3      SBRS	R10,3
    045F9 C00A      RJMP	0x4604
    045FA 2F06      MOV	R16,R22
    045FB A1EE      LDD	R30,Y+38
    045FC A1FF      LDD	R31,Y+39
    045FD 940E 4892 CALL	xicallx
    045FF 898E      LDD	R24,Y+22
    04600 899F      LDD	R25,Y+23
    04601 9601      ADIW	R24,1
    04602 8B9F      STD	Y+23,R25
    04603 8B8E      STD	Y+22,R24
    04604 FCA2      SBRC	R10,2
    04605 C04C      RJMP	0x4652
    04606 C00F      RJMP	0x4616
    04607 E300      LDI	R16,0x30
    04608 A1EE      LDD	R30,Y+38
    04609 A1FF      LDD	R31,Y+39
    0460A 940E 4892 CALL	xicallx
    0460C 898E      LDD	R24,Y+22
    0460D 899F      LDD	R25,Y+23
    0460E 9601      ADIW	R24,1
    0460F 8B9F      STD	Y+23,R25
    04610 8B8E      STD	Y+22,R24
    04611 898C      LDD	R24,Y+20
    04612 899D      LDD	R25,Y+21
    04613 9701      SBIW	R24,1
    04614 8B9D      STD	Y+21,R25
    04615 8B8C      STD	Y+20,R24
    04616 2422      CLR	R2
    04617 2433      CLR	R3
    04618 880C      LDD	R0,Y+20
    04619 881D      LDD	R1,Y+21
    0461A 1420      CP	R2,R0
    0461B 0431      CPC	R3,R1
    0461C F354      BLT	0x4607
    0461D C034      RJMP	0x4652
    0461E FCA2      SBRC	R10,2
    0461F C017      RJMP	0x4637
    04620 C00F      RJMP	0x4630
    04621 E200      LDI	R16,0x20
    04622 A1EE      LDD	R30,Y+38
    04623 A1FF      LDD	R31,Y+39
    04624 940E 4892 CALL	xicallx
    04626 898E      LDD	R24,Y+22
    04627 899F      LDD	R25,Y+23
    04628 9601      ADIW	R24,1
    04629 8B9F      STD	Y+23,R25
    0462A 8B8E      STD	Y+22,R24
    0462B 898C      LDD	R24,Y+20
    0462C 899D      LDD	R25,Y+21
    0462D 9701      SBIW	R24,1
    0462E 8B9D      STD	Y+21,R25
    0462F 8B8C      STD	Y+20,R24
    04630 2422      CLR	R2
    04631 2433      CLR	R3
    04632 880C      LDD	R0,Y+20
    04633 881D      LDD	R1,Y+21
    04634 1420      CP	R2,R0
    04635 0431      CPC	R3,R1
    04636 F354      BLT	0x4621
    04637 FEA3      SBRS	R10,3
    04638 C019      RJMP	0x4652
    04639 2F06      MOV	R16,R22
    0463A A1EE      LDD	R30,Y+38
    0463B A1FF      LDD	R31,Y+39
    0463C 940E 4892 CALL	xicallx
    0463E 898E      LDD	R24,Y+22
    0463F 899F      LDD	R25,Y+23
    04640 9601      ADIW	R24,1
    04641 8B9F      STD	Y+23,R25
    04642 8B8E      STD	Y+22,R24
    04643 C00E      RJMP	0x4652
    04644 01F7      MOVW	R30,R14
    04645 8100      LD	R16,Z
    04646 A1EE      LDD	R30,Y+38
    04647 A1FF      LDD	R31,Y+39
    04648 940E 4892 CALL	xicallx
    0464A 898E      LDD	R24,Y+22
    0464B 899F      LDD	R25,Y+23
    0464C 9601      ADIW	R24,1
    0464D 8B9F      STD	Y+23,R25
    0464E 8B8E      STD	Y+22,R24
    0464F 01C7      MOVW	R24,R14
    04650 9601      ADIW	R24,1
    04651 017C      MOVW	R14,R24
    04652 01F7      MOVW	R30,R14
    04653 8020      LD	R2,Z
    04654 2022      TST	R2
    04655 F049      BEQ	0x465F
    04656 8D68      LDD	R22,Y+24
    04657 8D79      LDD	R23,Y+25
    04658 01CB      MOVW	R24,R22
    04659 9701      SBIW	R24,1
    0465A 8F99      STD	Y+25,R25
    0465B 8F88      STD	Y+24,R24
    0465C 3060      CPI	R22,0
    0465D 0767      CPC	R22,R23
    0465E F729      BNE	0x4644
    0465F FEA2      SBRS	R10,2
    04660 C069      RJMP	0x46CA
    04661 C00F      RJMP	0x4671
    04662 E200      LDI	R16,0x20
    04663 A1EE      LDD	R30,Y+38
    04664 A1FF      LDD	R31,Y+39
    04665 940E 4892 CALL	xicallx
    04667 898E      LDD	R24,Y+22
    04668 899F      LDD	R25,Y+23
    04669 9601      ADIW	R24,1
    0466A 8B9F      STD	Y+23,R25
    0466B 8B8E      STD	Y+22,R24
    0466C 898C      LDD	R24,Y+20
    0466D 899D      LDD	R25,Y+21
    0466E 9701      SBIW	R24,1
    0466F 8B9D      STD	Y+21,R25
    04670 8B8C      STD	Y+20,R24
    04671 2422      CLR	R2
    04672 2433      CLR	R3
    04673 880C      LDD	R0,Y+20
    04674 881D      LDD	R1,Y+21
    04675 1420      CP	R2,R0
    04676 0431      CPC	R3,R1
    04677 F354      BLT	0x4662
    04678 C051      RJMP	0x46CA
    04679 E061      LDI	R22,1
    0467A E070      LDI	R23,0
    0467B C00B      RJMP	0x4687
    0467C E062      LDI	R22,2
    0467D E070      LDI	R23,0
    0467E C008      RJMP	0x4687
    0467F 2766      CLR	R22
    04680 2777      CLR	R23
    04681 C005      RJMP	0x4687
    04682 E063      LDI	R22,3
    04683 E070      LDI	R23,0
    04684 C002      RJMP	0x4687
    04685 E064      LDI	R22,4
    04686 E070      LDI	R23,0
    04687 A58A      LDD	R24,Y+42
    04688 A59B      LDD	R25,Y+43
    04689 9604      ADIW	R24,4
    0468A A79B      STD	Y+43,R25
    0468B A78A      STD	Y+42,R24
    0468C 01FC      MOVW	R30,R24
    0468D 9734      SBIW	R30,4
    0468E 8020      LD	R2,Z
    0468F 8031      LDD	R3,Z+1
    04690 8042      LDD	R4,Z+2
    04691 8053      LDD	R5,Z+3
    04692 8A28      STD	Y+16,R2
    04693 8A39      STD	Y+17,R3
    04694 8A4A      STD	Y+18,R4
    04695 8A5B      STD	Y+19,R5
    04696 8D88      LDD	R24,Y+24
    04697 8D99      LDD	R25,Y+25
    04698 3F8F      CPI	R24,0xFF
    04699 EFEF      LDI	R30,0xFF
    0469A 079E      CPC	R25,R30
    0469B F421      BNE	0x46A0
    0469C E086      LDI	R24,6
    0469D E090      LDI	R25,0
    0469E 8F99      STD	Y+25,R25
    0469F 8F88      STD	Y+24,R24
    046A0 8C08      LDD	R0,Y+24
    046A1 8C19      LDD	R1,Y+25
    046A2 8619      STD	Y+9,R1
    046A3 8608      STD	Y+8,R0
    046A4 880C      LDD	R0,Y+20
    046A5 881D      LDD	R1,Y+21
    046A6 821F      STD	Y+7,R1
    046A7 820E      STD	Y+6,R0
    046A8 82BD      STD	Y+5,R11
    046A9 82AC      STD	Y+4,R10
    046AA 8828      LDD	R2,Y+16
    046AB 8839      LDD	R3,Y+17
    046AC 884A      LDD	R4,Y+18
    046AD 885B      LDD	R5,Y+19
    046AE 8228      ST	Y,R2
    046AF 8239      STD	Y+1,R3
    046B0 824A      STD	Y+2,R4
    046B1 825B      STD	Y+3,R5
    046B2 019B      MOVW	R18,R22
    046B3 E607      LDI	R16,0x67
    046B4 E018      LDI	R17,0x8
    046B5 940E 4FD4 CALL	__FormatFP_1
    046B7 01B8      MOVW	R22,R16
    046B8 017B      MOVW	R14,R22
    046B9 C00C      RJMP	0x46C6
    046BA 01F7      MOVW	R30,R14
    046BB 9101      LD	R16,Z+
    046BC 017F      MOVW	R14,R30
    046BD A1EE      LDD	R30,Y+38
    046BE A1FF      LDD	R31,Y+39
    046BF 940E 4892 CALL	xicallx
    046C1 898E      LDD	R24,Y+22
    046C2 899F      LDD	R25,Y+23
    046C3 9601      ADIW	R24,1
    046C4 8B9F      STD	Y+23,R25
    046C5 8B8E      STD	Y+22,R24
    046C6 01F7      MOVW	R30,R14
    046C7 8020      LD	R2,Z
    046C8 2022      TST	R2
    046C9 F781      BNE	0x46BA
    046CA A588      LDD	R24,Y+40
    046CB A599      LDD	R25,Y+41
    046CC 9601      ADIW	R24,1
    046CD A799      STD	Y+41,R25
    046CE A788      STD	Y+40,R24
    046CF A5E8      LDD	R30,Y+40
    046D0 A5F9      LDD	R31,Y+41
    046D1 8020      LD	R2,Z
    046D2 2022      TST	R2
    046D3 F009      BEQ	0x46D5
    046D4 CBA4      RJMP	0x4279
    046D5 890E      LDD	R16,Y+22
    046D6 891F      LDD	R17,Y+23
    046D7 966C      ADIW	R28,0x1C
    046D8 940E 483A CALL	pop_xgsetF0FC
    046DA 9624      ADIW	R28,4
    046DB 9508      RET
_memset:
    046DC 8188      LD	R24,Y
    046DD 8199      LDD	R25,Y+1
    046DE 3080      CPI	R24,0
    046DF 0789      CPC	R24,R25
    046E0 F029      BEQ	0x46E6
    046E1 2FE0      MOV	R30,R16
    046E2 2FF1      MOV	R31,R17
    046E3 9321      ST	Z+,R18
    046E4 9701      SBIW	R24,1
    046E5 F7E9      BNE	0x46E3
    046E6 9508      RET
_strcat:
    046E7 2FA0      MOV	R26,R16
    046E8 2FB1      MOV	R27,R17
    046E9 2FE2      MOV	R30,R18
    046EA 2FF3      MOV	R31,R19
    046EB 912D      LD	R18,X+
    046EC 2322      TST	R18
    046ED F7E9      BNE	0x46EB
    046EE 9711      SBIW	R26,1
    046EF 9121      LD	R18,Z+
    046F0 932D      ST	X+,R18
    046F1 2322      TST	R18
    046F2 F7E1      BNE	0x46EF
    046F3 9508      RET
_strlen:
    046F4 2FE0      MOV	R30,R16
    046F5 2FF1      MOV	R31,R17
    046F6 27AA      CLR	R26
    046F7 27BB      CLR	R27
    046F8 9001      LD	R0,Z+
    046F9 2000      TST	R0
    046FA F011      BEQ	0x46FD
    046FB 9611      ADIW	R26,1
    046FC CFFB      RJMP	0x46F8
    046FD 2F0A      MOV	R16,R26
    046FE 2F1B      MOV	R17,R27
    046FF 9508      RET
push_arg4:
    04700 933A      ST	-Y,R19
    04701 932A      ST	-Y,R18
push_arg2:
    04702 931A      ST	-Y,R17
    04703 930A      ST	-Y,R16
    04704 9508      RET
asr32:
    04705 920F      PUSH	R0
    04706 9009      LD	R0,Y+
    04707 2000      TST	R0
    04708 F031      BEQ	0x470F
    04709 9535      ASR	R19
    0470A 9527      ROR	R18
    0470B 9517      ROR	R17
    0470C 9507      ROR	R16
    0470D 940A      DEC	R0
    0470E CFF8      RJMP	0x4707
    0470F 900F      POP	R0
    04710 9508      RET
mod16s:
    04711 9468      BSET	6
    04712 92DA      ST	-Y,R13
    04713 2ED1      MOV	R13,R17
    04714 C004      RJMP	0x4719
div16s:
    04715 94E8      BCLR	6
    04716 92DA      ST	-Y,R13
    04717 2ED1      MOV	R13,R17
    04718 26D3      EOR	R13,R19
    04719 FF17      SBRS	R17,7
    0471A C004      RJMP	0x471F
    0471B 9510      COM	R17
    0471C 9500      COM	R16
    0471D 5F0F      SUBI	R16,0xFF
    0471E 4F1F      SBCI	R17,0xFF
    0471F FF37      SBRS	R19,7
    04720 C004      RJMP	0x4725
    04721 9530      COM	R19
    04722 9520      COM	R18
    04723 5F2F      SUBI	R18,0xFF
    04724 4F3F      SBCI	R19,0xFF
    04725 940E 4732 CALL	xdiv16u
    04727 FED7      SBRS	R13,7
    04728 C004      RJMP	0x472D
    04729 9510      COM	R17
    0472A 9500      COM	R16
    0472B 5F0F      SUBI	R16,0xFF
    0472C 4F1F      SBCI	R17,0xFF
    0472D 90D9      LD	R13,Y+
    0472E 9508      RET
mod16u:
    0472F 9468      BSET	6
    04730 C001      RJMP	xdiv16u
div16u:
    04731 94E8      BCLR	6
xdiv16u:
    04732 92EA      ST	-Y,R14
    04733 92FA      ST	-Y,R15
    04734 938A      ST	-Y,R24
    04735 24EE      CLR	R14
    04736 24FF      CLR	R15
    04737 E180      LDI	R24,0x10
    04738 0F00      LSL	R16
    04739 1F11      ROL	R17
    0473A 1CEE      ROL	R14
    0473B 1CFF      ROL	R15
    0473C 16E2      CP	R14,R18
    0473D 06F3      CPC	R15,R19
    0473E F018      BCS	0x4742
    0473F 1AE2      SUB	R14,R18
    04740 0AF3      SBC	R15,R19
    04741 9503      INC	R16
    04742 958A      DEC	R24
    04743 F7A1      BNE	0x4738
    04744 F416      BRTC	0x4747
    04745 2D0E      MOV	R16,R14
    04746 2D1F      MOV	R17,R15
    04747 9189      LD	R24,Y+
    04748 90F9      LD	R15,Y+
    04749 90E9      LD	R14,Y+
    0474A 9508      RET
div32u:
    0474B 94E8      BCLR	6
    0474C C001      RJMP	0x474E
mod32u:
    0474D 9468      BSET	6
    0474E D030      RCALL	long_div_prolog
    0474F 24CC      CLR	R12
    04750 C009      RJMP	0x475A
div32s:
    04751 94E8      BCLR	6
    04752 C001      RJMP	0x4754
mod32s:
    04753 9468      BSET	6
    04754 D02A      RCALL	long_div_prolog
    04755 FD37      SBRC	R19,7
    04756 940E 489B CALL	neg32
    04758 FDB7      SBRC	R27,7
    04759 D052      RCALL	neg_R24_R27
    0475A 2477      CLR	R7
    0475B 2488      CLR	R8
    0475C 2499      CLR	R9
    0475D 24AA      CLR	R10
    0475E 24BB      CLR	R11
    0475F D042      RCALL	tst_R16_R19
    04760 F0C1      BEQ	0x4779
    04761 D045      RCALL	tst_R24_R27
    04762 F0B1      BEQ	0x4779
    04763 E2E8      LDI	R30,0x28
    04764 0F00      LSL	R16
    04765 1F11      ROL	R17
    04766 1F22      ROL	R18
    04767 1F33      ROL	R19
    04768 1C77      ROL	R7
    04769 1C88      ROL	R8
    0476A 1C99      ROL	R9
    0476B 1CAA      ROL	R10
    0476C 1CBB      ROL	R11
    0476D 1688      CP	R8,R24
    0476E 0699      CPC	R9,R25
    0476F 06AA      CPC	R10,R26
    04770 06BB      CPC	R11,R27
    04771 F028      BCS	0x4777
    04772 1A88      SUB	R8,R24
    04773 0A99      SBC	R9,R25
    04774 0AAA      SBC	R10,R26
    04775 0ABB      SBC	R11,R27
    04776 9503      INC	R16
    04777 95EA      DEC	R30
    04778 F759      BNE	0x4764
    04779 F426      BRTC	0x477E
    0477A 2D08      MOV	R16,R8
    0477B 2D19      MOV	R17,R9
    0477C 2D2A      MOV	R18,R10
    0477D 2D3B      MOV	R19,R11
    0477E C013      RJMP	long_div_epilog
long_div_prolog:
    0477F 927A      ST	-Y,R7
    04780 928A      ST	-Y,R8
    04781 929A      ST	-Y,R9
    04782 92AA      ST	-Y,R10
    04783 92BA      ST	-Y,R11
    04784 92CA      ST	-Y,R12
    04785 93EA      ST	-Y,R30
    04786 938A      ST	-Y,R24
    04787 939A      ST	-Y,R25
    04788 93AA      ST	-Y,R26
    04789 93BA      ST	-Y,R27
    0478A 858B      LDD	R24,Y+11
    0478B 859C      LDD	R25,Y+12
    0478C 85AD      LDD	R26,Y+13
    0478D 85BE      LDD	R27,Y+14
    0478E 2EC3      MOV	R12,R19
    0478F F00E      BRTS	0x4791
    04790 26CB      EOR	R12,R27
    04791 9508      RET
long_div_epilog:
    04792 FCC7      SBRC	R12,7
    04793 940E 489B CALL	neg32
    04795 91B9      LD	R27,Y+
    04796 91A9      LD	R26,Y+
    04797 9199      LD	R25,Y+
    04798 9189      LD	R24,Y+
    04799 91E9      LD	R30,Y+
    0479A 90C9      LD	R12,Y+
    0479B 90B9      LD	R11,Y+
    0479C 90A9      LD	R10,Y+
    0479D 9099      LD	R9,Y+
    0479E 9089      LD	R8,Y+
    0479F 9079      LD	R7,Y+
    047A0 9624      ADIW	R28,4
    047A1 9508      RET
tst_R16_R19:
    047A2 2FE0      MOV	R30,R16
    047A3 2BE1      OR	R30,R17
    047A4 2BE2      OR	R30,R18
    047A5 2BE3      OR	R30,R19
    047A6 9508      RET
tst_R24_R27:
    047A7 2FE8      MOV	R30,R24
    047A8 2BE9      OR	R30,R25
    047A9 2BEA      OR	R30,R26
    047AA 2BEB      OR	R30,R27
    047AB 9508      RET
neg_R24_R27:
    047AC 9580      COM	R24
    047AD 9590      COM	R25
    047AE 95A0      COM	R26
    047AF 95B0      COM	R27
    047B0 5F8F      SUBI	R24,0xFF
    047B1 4F9F      SBCI	R25,0xFF
    047B2 4FAF      SBCI	R26,0xFF
    047B3 4FBF      SBCI	R27,0xFF
    047B4 9508      RET
mod8u:
    047B5 9468      BSET	6
    047B6 C001      RJMP	xdiv8u
div8u:
    047B7 94E8      BCLR	6
xdiv8u:
    047B8 932A      ST	-Y,R18
    047B9 92FA      ST	-Y,R15
    047BA 92EA      ST	-Y,R14
    047BB 24FF      CLR	R15
    047BC 24EE      CLR	R14
    047BD E120      LDI	R18,0x10
    047BE 0F00      LSL	R16
    047BF 1CFF      ROL	R15
    047C0 1CEE      ROL	R14
    047C1 16E1      CP	R14,R17
    047C2 F010      BCS	0x47C5
    047C3 1AE1      SUB	R14,R17
    047C4 9503      INC	R16
    047C5 952A      DEC	R18
    047C6 F7B9      BNE	0x47BE
    047C7 F40E      BRTC	0x47C9
    047C8 2D0E      MOV	R16,R14
    047C9 90E9      LD	R14,Y+
    047CA 90F9      LD	R15,Y+
    047CB 9129      LD	R18,Y+
    047CC 9508      RET
elpm32:
    047CD 93EA      ST	-Y,R30
    047CE 93FA      ST	-Y,R31
    047CF 920A      ST	-Y,R0
    047D0 2FE0      MOV	R30,R16
    047D1 2FF1      MOV	R31,R17
    047D2 95D8      ELPM
    047D3 2D00      MOV	R16,R0
    047D4 9631      ADIW	R30,1
    047D5 95D8      ELPM
    047D6 2D10      MOV	R17,R0
    047D7 9631      ADIW	R30,1
    047D8 95D8      ELPM
    047D9 2D20      MOV	R18,R0
    047DA 9631      ADIW	R30,1
    047DB 95D8      ELPM
    047DC 2D30      MOV	R19,R0
    047DD 9009      LD	R0,Y+
    047DE 91F9      LD	R31,Y+
    047DF 91E9      LD	R30,Y+
    047E0 9508      RET
empy16s:
    047E1 920A      ST	-Y,R0
    047E2 921A      ST	-Y,R1
    047E3 938A      ST	-Y,R24
    047E4 939A      ST	-Y,R25
    047E5 9F02      MUL	R16,R18
    047E6 01C0      MOVW	R24,R0
    047E7 9F12      MUL	R17,R18
    047E8 0D90      ADD	R25,R0
    047E9 9F03      MUL	R16,R19
    047EA 0D90      ADD	R25,R0
    047EB 018C      MOVW	R16,R24
    047EC 9199      LD	R25,Y+
    047ED 9189      LD	R24,Y+
    047EE 9019      LD	R1,Y+
    047EF 9009      LD	R0,Y+
    047F0 9508      RET
empy32s|empy32u:
    047F1 940E 48A4 CALL	long_prolog
    047F3 927A      ST	-Y,R7
    047F4 940E 48BD CALL	tstzero1
    047F6 F159      BEQ	0x4822
    047F7 2477      CLR	R7
    047F8 940E 48C3 CALL	tstzero2
    047FA F419      BNE	0x47FE
    047FB 018C      MOVW	R16,R24
    047FC 019D      MOVW	R18,R26
    047FD C024      RJMP	0x4822
    047FE 920A      ST	-Y,R0
    047FF 921A      ST	-Y,R1
    04800 9F08      MUL	R16,R24
    04801 2CB0      MOV	R11,R0
    04802 2CA1      MOV	R10,R1
    04803 9F28      MUL	R18,R24
    04804 2C90      MOV	R9,R0
    04805 2C81      MOV	R8,R1
    04806 9F18      MUL	R17,R24
    04807 0CA0      ADD	R10,R0
    04808 1C91      ADC	R9,R1
    04809 1C87      ADC	R8,R7
    0480A 9F09      MUL	R16,R25
    0480B 0CA0      ADD	R10,R0
    0480C 1C91      ADC	R9,R1
    0480D 1C87      ADC	R8,R7
    0480E 9F19      MUL	R17,R25
    0480F 0C90      ADD	R9,R0
    04810 1C81      ADC	R8,R1
    04811 9F0A      MUL	R16,R26
    04812 0C90      ADD	R9,R0
    04813 1C81      ADC	R8,R1
    04814 9F38      MUL	R19,R24
    04815 0C80      ADD	R8,R0
    04816 9F29      MUL	R18,R25
    04817 0C80      ADD	R8,R0
    04818 9F1A      MUL	R17,R26
    04819 0C80      ADD	R8,R0
    0481A 9F0B      MUL	R16,R27
    0481B 0C80      ADD	R8,R0
    0481C 9019      LD	R1,Y+
    0481D 9009      LD	R0,Y+
    0481E 2D0B      MOV	R16,R11
    0481F 2D1A      MOV	R17,R10
    04820 2D29      MOV	R18,R9
    04821 2D38      MOV	R19,R8
    04822 9079      LD	R7,Y+
    04823 940C 48B2 JMP	long_epilog
pop_xgset003C:
    04825 90A9      LD	R10,Y+
    04826 90B9      LD	R11,Y+
    04827 90C9      LD	R12,Y+
    04828 90D9      LD	R13,Y+
    04829 9508      RET
pop_xgset00FC:
    0482A 90A9      LD	R10,Y+
    0482B 90B9      LD	R11,Y+
    0482C 90C9      LD	R12,Y+
    0482D 90D9      LD	R13,Y+
    0482E 90E9      LD	R14,Y+
    0482F 90F9      LD	R15,Y+
    04830 9508      RET
pop_xgset30FC:
    04831 90A9      LD	R10,Y+
    04832 90B9      LD	R11,Y+
    04833 90C9      LD	R12,Y+
    04834 90D9      LD	R13,Y+
    04835 90E9      LD	R14,Y+
    04836 90F9      LD	R15,Y+
    04837 9149      LD	R20,Y+
    04838 9159      LD	R21,Y+
    04839 9508      RET
pop_xgsetF0FC:
    0483A 90A9      LD	R10,Y+
    0483B 90B9      LD	R11,Y+
    0483C 90C9      LD	R12,Y+
    0483D 90D9      LD	R13,Y+
    0483E 90E9      LD	R14,Y+
    0483F 90F9      LD	R15,Y+
    04840 9149      LD	R20,Y+
    04841 9159      LD	R21,Y+
    04842 9169      LD	R22,Y+
    04843 9179      LD	R23,Y+
    04844 9508      RET
push_xgsetF0FC:
    04845 937A      ST	-Y,R23
    04846 936A      ST	-Y,R22
push_xgset30FC:
    04847 935A      ST	-Y,R21
    04848 934A      ST	-Y,R20
push_xgset00FC:
    04849 92FA      ST	-Y,R15
    0484A 92EA      ST	-Y,R14
push_xgset003C:
    0484B 92DA      ST	-Y,R13
    0484C 92CA      ST	-Y,R12
    0484D 92BA      ST	-Y,R11
    0484E 92AA      ST	-Y,R10
    0484F 9508      RET
push_xgset300C:
    04850 935A      ST	-Y,R21
    04851 934A      ST	-Y,R20
    04852 92BA      ST	-Y,R11
    04853 92AA      ST	-Y,R10
    04854 9508      RET
pop_xgset300C:
    04855 90A9      LD	R10,Y+
    04856 90B9      LD	R11,Y+
    04857 9149      LD	R20,Y+
    04858 9159      LD	R21,Y+
    04859 9508      RET
push_xgsetF000:
    0485A 937A      ST	-Y,R23
    0485B 936A      ST	-Y,R22
    0485C 935A      ST	-Y,R21
    0485D 934A      ST	-Y,R20
    0485E 9508      RET
pop_xgsetF000:
    0485F 9149      LD	R20,Y+
    04860 9159      LD	R21,Y+
    04861 9169      LD	R22,Y+
    04862 9179      LD	R23,Y+
    04863 9508      RET
push_xgsetF00C:
    04864 937A      ST	-Y,R23
    04865 936A      ST	-Y,R22
    04866 935A      ST	-Y,R21
    04867 934A      ST	-Y,R20
    04868 92BA      ST	-Y,R11
    04869 92AA      ST	-Y,R10
    0486A 9508      RET
pop_xgsetF00C:
    0486B 90A9      LD	R10,Y+
    0486C 90B9      LD	R11,Y+
    0486D 9149      LD	R20,Y+
    0486E 9159      LD	R21,Y+
    0486F 9169      LD	R22,Y+
    04870 9179      LD	R23,Y+
    04871 9508      RET
push_xgset303C:
    04872 935A      ST	-Y,R21
    04873 934A      ST	-Y,R20
    04874 92DA      ST	-Y,R13
    04875 92CA      ST	-Y,R12
    04876 92BA      ST	-Y,R11
    04877 92AA      ST	-Y,R10
    04878 9508      RET
pop_xgset303C:
    04879 90A9      LD	R10,Y+
    0487A 90B9      LD	R11,Y+
    0487B 90C9      LD	R12,Y+
    0487C 90D9      LD	R13,Y+
    0487D 9149      LD	R20,Y+
    0487E 9159      LD	R21,Y+
    0487F 9508      RET
push_xgsetF03C:
    04880 937A      ST	-Y,R23
    04881 936A      ST	-Y,R22
    04882 935A      ST	-Y,R21
    04883 934A      ST	-Y,R20
    04884 92DA      ST	-Y,R13
    04885 92CA      ST	-Y,R12
    04886 92BA      ST	-Y,R11
    04887 92AA      ST	-Y,R10
    04888 9508      RET
pop_xgsetF03C:
    04889 90A9      LD	R10,Y+
    0488A 90B9      LD	R11,Y+
    0488B 90C9      LD	R12,Y+
    0488C 90D9      LD	R13,Y+
    0488D 9149      LD	R20,Y+
    0488E 9159      LD	R21,Y+
    0488F 9169      LD	R22,Y+
    04890 9179      LD	R23,Y+
    04891 9508      RET
xicallx:
    04892 920A      ST	-Y,R0
    04893 95D8      ELPM
    04894 920A      ST	-Y,R0
    04895 9631      ADIW	R30,1
    04896 95D8      ELPM
    04897 2DF0      MOV	R31,R0
    04898 91E9      LD	R30,Y+
    04899 9009      LD	R0,Y+
    0489A 9409      IJMP
neg32:
    0489B 9500      COM	R16
    0489C 9510      COM	R17
    0489D 9520      COM	R18
    0489E 9530      COM	R19
    0489F 5F0F      SUBI	R16,0xFF
    048A0 4F1F      SBCI	R17,0xFF
    048A1 4F2F      SBCI	R18,0xFF
    048A2 4F3F      SBCI	R19,0xFF
    048A3 9508      RET
long_prolog:
    048A4 928A      ST	-Y,R8
    048A5 929A      ST	-Y,R9
    048A6 92AA      ST	-Y,R10
    048A7 92BA      ST	-Y,R11
    048A8 93EA      ST	-Y,R30
    048A9 938A      ST	-Y,R24
    048AA 939A      ST	-Y,R25
    048AB 93AA      ST	-Y,R26
    048AC 93BA      ST	-Y,R27
    048AD 8589      LDD	R24,Y+9
    048AE 859A      LDD	R25,Y+10
    048AF 85AB      LDD	R26,Y+11
    048B0 85BC      LDD	R27,Y+12
    048B1 9508      RET
long_epilog:
    048B2 91B9      LD	R27,Y+
    048B3 91A9      LD	R26,Y+
    048B4 9199      LD	R25,Y+
    048B5 9189      LD	R24,Y+
    048B6 91E9      LD	R30,Y+
    048B7 90B9      LD	R11,Y+
    048B8 90A9      LD	R10,Y+
    048B9 9099      LD	R9,Y+
    048BA 9089      LD	R8,Y+
    048BB 9624      ADIW	R28,4
    048BC 9508      RET
tstzero1:
    048BD 27EE      CLR	R30
    048BE 2BE0      OR	R30,R16
    048BF 2BE1      OR	R30,R17
    048C0 2BE2      OR	R30,R18
    048C1 2BE3      OR	R30,R19
    048C2 9508      RET
tstzero2:
    048C3 27EE      CLR	R30
    048C4 2BE8      OR	R30,R24
    048C5 2BE9      OR	R30,R25
    048C6 2BEA      OR	R30,R26
    048C7 2BEB      OR	R30,R27
    048C8 9508      RET
lsl16:
    048C9 2322      TST	R18
    048CA F021      BEQ	0x48CF
    048CB 0F00      LSL	R16
    048CC 1F11      ROL	R17
    048CD 952A      DEC	R18
    048CE CFFA      RJMP	lsl16
    048CF 9508      RET
lsl32:
    048D0 920F      PUSH	R0
    048D1 9009      LD	R0,Y+
    048D2 2000      TST	R0
    048D3 F031      BEQ	0x48DA
    048D4 0F00      LSL	R16
    048D5 1F11      ROL	R17
    048D6 1F22      ROL	R18
    048D7 1F33      ROL	R19
    048D8 940A      DEC	R0
    048D9 CFF8      RJMP	0x48D2
    048DA 900F      POP	R0
    048DB 9508      RET
lsl8:
    048DC 2311      TST	R17
    048DD F019      BEQ	0x48E1
    048DE 0F00      LSL	R16
    048DF 951A      DEC	R17
    048E0 CFFB      RJMP	lsl8
    048E1 9508      RET
lsr16:
    048E2 2322      TST	R18
    048E3 F021      BEQ	0x48E8
    048E4 9516      LSR	R17
    048E5 9507      ROR	R16
    048E6 952A      DEC	R18
    048E7 CFFA      RJMP	lsr16
    048E8 9508      RET
lsr32:
    048E9 920F      PUSH	R0
    048EA 9009      LD	R0,Y+
    048EB 2000      TST	R0
    048EC F031      BEQ	0x48F3
    048ED 9536      LSR	R19
    048EE 9527      ROR	R18
    048EF 9517      ROR	R17
    048F0 9507      ROR	R16
    048F1 940A      DEC	R0
    048F2 CFF8      RJMP	0x48EB
    048F3 900F      POP	R0
    048F4 9508      RET
asgnblk:
    048F5 93AA      ST	-Y,R26
    048F6 93BA      ST	-Y,R27
    048F7 93EA      ST	-Y,R30
    048F8 93FA      ST	-Y,R31
    048F9 920A      ST	-Y,R0
    048FA 81AF      LDD	R26,Y+7
    048FB 85B8      LDD	R27,Y+8
    048FC 81ED      LDD	R30,Y+5
    048FD 81FE      LDD	R31,Y+6
    048FE 3000      CPI	R16,0
    048FF 0701      CPC	R16,R17
    04900 F029      BEQ	0x4906
    04901 9001      LD	R0,Z+
    04902 920D      ST	X+,R0
    04903 5001      SUBI	R16,1
    04904 4010      SBCI	R17,0
    04905 CFF8      RJMP	0x48FE
    04906 9009      LD	R0,Y+
    04907 91F9      LD	R31,Y+
    04908 91E9      LD	R30,Y+
    04909 91B9      LD	R27,Y+
    0490A 91A9      LD	R26,Y+
    0490B 9624      ADIW	R28,4
    0490C 9508      RET
fpsub:
    0490D 9468      BSET	6
    0490E C001      RJMP	fpadd_alt
fpadd:
    0490F 94E8      BCLR	6
fpadd_alt:
    04910 940E 4AE8 CALL	saveFPRegs
    04912 940E 4A7A CALL	unpacks
    04914 F409      BNE	0x4916
    04915 C048      RJMP	0x495E
    04916 2CE6      MOV	R14,R6
    04917 2CD5      MOV	R13,R5
    04918 2CC4      MOV	R12,R4
    04919 2EB3      MOV	R11,R19
    0491A 2EA2      MOV	R10,R18
    0491B 2E91      MOV	R9,R17
    0491C 2E80      MOV	R8,R16
    0491D 8100      LD	R16,Z
    0491E 8111      LDD	R17,Z+1
    0491F 8122      LDD	R18,Z+2
    04920 8133      LDD	R19,Z+3
    04921 940E 4A7A CALL	unpacks
    04923 F409      BNE	0x4925
    04924 C044      RJMP	0x4969
    04925 2D84      MOV	R24,R4
    04926 2D95      MOV	R25,R5
    04927 198C      SUB	R24,R12
    04928 099D      SBC	R25,R13
    04929 F0B9      BEQ	0x4941
    0492A F472      BPL	0x4939
    0492B 9590      COM	R25
    0492C 9580      COM	R24
    0492D 9601      ADIW	R24,1
    0492E 2C4C      MOV	R4,R12
    0492F 2C5D      MOV	R5,R13
    04930 3188      CPI	R24,0x18
    04931 F5B8      BCC	0x4969
    04932 9535      ASR	R19
    04933 9527      ROR	R18
    04934 9517      ROR	R17
    04935 9507      ROR	R16
    04936 9701      SBIW	R24,1
    04937 F7D1      BNE	0x4932
    04938 C008      RJMP	0x4941
    04939 3188      CPI	R24,0x18
    0493A F518      BCC	0x495E
    0493B 94B5      ASR	R11
    0493C 94A7      ROR	R10
    0493D 9497      ROR	R9
    0493E 9487      ROR	R8
    0493F 9701      SBIW	R24,1
    04940 F7D1      BNE	0x493B
    04941 2466      CLR	R6
    04942 F02E      BRTS	0x4948
    04943 0D08      ADD	R16,R8
    04944 1D19      ADC	R17,R9
    04945 1D2A      ADC	R18,R10
    04946 1D3B      ADC	R19,R11
    04947 C009      RJMP	0x4951
    04948 1A80      SUB	R8,R16
    04949 0A91      SBC	R9,R17
    0494A 0AA2      SBC	R10,R18
    0494B 0AB3      SBC	R11,R19
    0494C 2D08      MOV	R16,R8
    0494D 2D19      MOV	R17,R9
    0494E 2D2A      MOV	R18,R10
    0494F 2D3B      MOV	R19,R11
    04950 2333      TST	R19
    04951 F422      BPL	0x4956
    04952 940E 489B CALL	neg32
    04954 E880      LDI	R24,0x80
    04955 2E68      MOV	R6,R24
    04956 940E 4AA3 CALL	normalize_and_pack
    04958 C002      RJMP	0x495B
    04959 940E 4AD8 CALL	pack
    0495B 940E 4AF7 CALL	restoreFPRegs
    0495D 9508      RET
    0495E 8100      LD	R16,Z
    0495F 8111      LDD	R17,Z+1
    04960 8122      LDD	R18,Z+2
    04961 8133      LDD	R19,Z+3
    04962 F7C6      BRTC	0x495B
    04963 940E 4A82 CALL	tstR16_R19
    04965 F3A9      BEQ	0x495B
    04966 E880      LDI	R24,0x80
    04967 2738      EOR	R19,R24
    04968 CFF2      RJMP	0x495B
    04969 2D08      MOV	R16,R8
    0496A 2D19      MOV	R17,R9
    0496B 2D2A      MOV	R18,R10
    0496C 2D3B      MOV	R19,R11
    0496D 2C4C      MOV	R4,R12
    0496E 2C5D      MOV	R5,R13
    0496F 2C6E      MOV	R6,R14
    04970 2333      TST	R19
    04971 F73A      BPL	0x4959
    04972 940E 489B CALL	neg32
    04974 E880      LDI	R24,0x80
    04975 2E68      MOV	R6,R24
    04976 CFE2      RJMP	0x4959
fpadd1:
    04977 93FA      ST	-Y,R31
    04978 93EA      ST	-Y,R30
    04979 81EA      LDD	R30,Y+2
    0497A 81FB      LDD	R31,Y+3
    0497B 940E 490F CALL	fpadd
    0497D 91E9      LD	R30,Y+
    0497E 91F9      LD	R31,Y+
    0497F 9622      ADIW	R28,2
    04980 9508      RET
fpadd2:
    04981 93FA      ST	-Y,R31
    04982 93EA      ST	-Y,R30
    04983 2FEC      MOV	R30,R28
    04984 2FFD      MOV	R31,R29
    04985 9632      ADIW	R30,2
    04986 940E 490F CALL	fpadd
    04988 91E9      LD	R30,Y+
    04989 91F9      LD	R31,Y+
    0498A 9624      ADIW	R28,4
    0498B 9508      RET
fpsub1:
    0498C 93FA      ST	-Y,R31
    0498D 93EA      ST	-Y,R30
    0498E 81EA      LDD	R30,Y+2
    0498F 81FB      LDD	R31,Y+3
    04990 940E 490D CALL	fpsub
    04992 91E9      LD	R30,Y+
    04993 91F9      LD	R31,Y+
    04994 9622      ADIW	R28,2
    04995 9508      RET
fpsub2:
    04996 93FA      ST	-Y,R31
    04997 93EA      ST	-Y,R30
    04998 2FEC      MOV	R30,R28
    04999 2FFD      MOV	R31,R29
    0499A 9632      ADIW	R30,2
    0499B 940E 490D CALL	fpsub
    0499D 91E9      LD	R30,Y+
    0499E 91F9      LD	R31,Y+
    0499F 9624      ADIW	R28,4
    049A0 9508      RET
fpsub1x:
    049A1 93FA      ST	-Y,R31
    049A2 93EA      ST	-Y,R30
    049A3 81EA      LDD	R30,Y+2
    049A4 81FB      LDD	R31,Y+3
    049A5 940E 490D CALL	fpsub
    049A7 91E9      LD	R30,Y+
    049A8 91F9      LD	R31,Y+
    049A9 8339      STD	Y+1,R19
    049AA 8328      ST	Y,R18
    049AB 931A      ST	-Y,R17
    049AC 930A      ST	-Y,R16
    049AD 9508      RET
fpsub2x:
    049AE 93FA      ST	-Y,R31
    049AF 93EA      ST	-Y,R30
    049B0 2FEC      MOV	R30,R28
    049B1 2FFD      MOV	R31,R29
    049B2 9632      ADIW	R30,2
    049B3 940E 490D CALL	fpsub
    049B5 91E9      LD	R30,Y+
    049B6 91F9      LD	R31,Y+
    049B7 833B      STD	Y+3,R19
    049B8 832A      STD	Y+2,R18
    049B9 8319      STD	Y+1,R17
    049BA 8308      ST	Y,R16
    049BB 9508      RET
uint2fp:
    049BC 9468      BSET	6
    049BD C001      RJMP	0x49BF
int2fp:
    049BE 94E8      BCLR	6
    049BF 2722      CLR	R18
    049C0 2733      CLR	R19
    049C1 F046      BRTS	0x49CA
    049C2 FD17      SBRC	R17,7
    049C3 9520      COM	R18
    049C4 FD17      SBRC	R17,7
    049C5 9530      COM	R19
    049C6 C003      RJMP	0x49CA
ulong2fp:
    049C7 9468      BSET	6
    049C8 C001      RJMP	0x49CA
long2fp:
    049C9 94E8      BCLR	6
    049CA 924A      ST	-Y,R4
    049CB 925A      ST	-Y,R5
    049CC 926A      ST	-Y,R6
    049CD 938A      ST	-Y,R24
    049CE E187      LDI	R24,0x17
    049CF 2E48      MOV	R4,R24
    049D0 2455      CLR	R5
    049D1 2466      CLR	R6
    049D2 F036      BRTS	0x49D9
    049D3 2333      TST	R19
    049D4 F422      BPL	0x49D9
    049D5 940E 489B CALL	neg32
    049D7 E880      LDI	R24,0x80
    049D8 2E68      MOV	R6,R24
    049D9 940E 4AA3 CALL	normalize_and_pack
    049DB 9189      LD	R24,Y+
    049DC 9069      LD	R6,Y+
    049DD 9059      LD	R5,Y+
    049DE 9049      LD	R4,Y+
    049DF 9508      RET
fpdiv1:
    049E0 93FA      ST	-Y,R31
    049E1 93EA      ST	-Y,R30
    049E2 81EA      LDD	R30,Y+2
    049E3 81FB      LDD	R31,Y+3
    049E4 D027      RCALL	0x4A0C
    049E5 91E9      LD	R30,Y+
    049E6 91F9      LD	R31,Y+
    049E7 9622      ADIW	R28,2
    049E8 9508      RET
fpdiv2:
    049E9 93FA      ST	-Y,R31
    049EA 93EA      ST	-Y,R30
    049EB 2FEC      MOV	R30,R28
    049EC 2FFD      MOV	R31,R29
    049ED 9632      ADIW	R30,2
    049EE D01D      RCALL	0x4A0C
    049EF 91E9      LD	R30,Y+
    049F0 91F9      LD	R31,Y+
    049F1 9624      ADIW	R28,4
    049F2 9508      RET
fpdiv1x:
    049F3 93FA      ST	-Y,R31
    049F4 93EA      ST	-Y,R30
    049F5 81EA      LDD	R30,Y+2
    049F6 81FB      LDD	R31,Y+3
    049F7 D014      RCALL	0x4A0C
    049F8 91E9      LD	R30,Y+
    049F9 91F9      LD	R31,Y+
    049FA 8339      STD	Y+1,R19
    049FB 8328      ST	Y,R18
    049FC 931A      ST	-Y,R17
    049FD 930A      ST	-Y,R16
    049FE 9508      RET
fpdiv2x:
    049FF 93FA      ST	-Y,R31
    04A00 93EA      ST	-Y,R30
    04A01 2FEC      MOV	R30,R28
    04A02 2FFD      MOV	R31,R29
    04A03 9632      ADIW	R30,2
    04A04 D007      RCALL	0x4A0C
    04A05 91E9      LD	R30,Y+
    04A06 91F9      LD	R31,Y+
    04A07 833B      STD	Y+3,R19
    04A08 832A      STD	Y+2,R18
    04A09 8319      STD	Y+1,R17
    04A0A 8308      ST	Y,R16
    04A0B 9508      RET
    04A0C 920A      ST	-Y,R0
    04A0D 921A      ST	-Y,R1
    04A0E 922A      ST	-Y,R2
    04A0F 923A      ST	-Y,R3
    04A10 940E 4AE8 CALL	saveFPRegs
    04A12 933A      ST	-Y,R19
    04A13 932A      ST	-Y,R18
    04A14 931A      ST	-Y,R17
    04A15 930A      ST	-Y,R16
    04A16 8100      LD	R16,Z
    04A17 8111      LDD	R17,Z+1
    04A18 8122      LDD	R18,Z+2
    04A19 8133      LDD	R19,Z+3
    04A1A 940E 4A8A CALL	unpacku
    04A1C F409      BNE	0x4A1E
    04A1D C057      RJMP	0x4A75
    04A1E 2CE6      MOV	R14,R6
    04A1F 2CD5      MOV	R13,R5
    04A20 2CC4      MOV	R12,R4
    04A21 2EB3      MOV	R11,R19
    04A22 2EA2      MOV	R10,R18
    04A23 2E91      MOV	R9,R17
    04A24 2E80      MOV	R8,R16
    04A25 9109      LD	R16,Y+
    04A26 9119      LD	R17,Y+
    04A27 9129      LD	R18,Y+
    04A28 9139      LD	R19,Y+
    04A29 940E 4A8A CALL	unpacku
    04A2B F1A1      BEQ	0x4A60
    04A2C 246E      EOR	R6,R14
    04A2D 184C      SUB	R4,R12
    04A2E 085D      SBC	R5,R13
    04A2F E880      LDI	R24,0x80
    04A30 1648      CP	R4,R24
    04A31 0653      CPC	R5,R19
    04A32 F00C      BLT	0x4A34
    04A33 C033      RJMP	0x4A67
    04A34 E881      LDI	R24,0x81
    04A35 1648      CP	R4,R24
    04A36 EF8F      LDI	R24,0xFF
    04A37 0658      CPC	R5,R24
    04A38 F40C      BGE	0x4A3A
    04A39 C036      RJMP	0x4A70
    04A3A E280      LDI	R24,0x20
    04A3B 2433      CLR	R3
    04A3C 2E23      MOV	R2,R19
    04A3D 2E12      MOV	R1,R18
    04A3E 2E01      MOV	R0,R17
    04A3F 2F30      MOV	R19,R16
    04A40 2722      CLR	R18
    04A41 2711      CLR	R17
    04A42 2700      CLR	R16
    04A43 9426      LSR	R2
    04A44 9417      ROR	R1
    04A45 9407      ROR	R0
    04A46 9537      ROR	R19
    04A47 9527      ROR	R18
    04A48 0F00      LSL	R16
    04A49 1F11      ROL	R17
    04A4A 1F22      ROL	R18
    04A4B 1F33      ROL	R19
    04A4C 1C00      ROL	R0
    04A4D 1C11      ROL	R1
    04A4E 1C22      ROL	R2
    04A4F 1C33      ROL	R3
    04A50 F028      BCS	0x4A56
    04A51 1808      SUB	R0,R8
    04A52 0819      SBC	R1,R9
    04A53 082A      SBC	R2,R10
    04A54 083B      SBC	R3,R11
    04A55 C004      RJMP	0x4A5A
    04A56 0C08      ADD	R0,R8
    04A57 1C19      ADC	R1,R9
    04A58 1C2A      ADC	R2,R10
    04A59 1C3B      ADC	R3,R11
    04A5A F00A      BMI	0x4A5C
    04A5B 6001      ORI	R16,1
    04A5C 958A      DEC	R24
    04A5D F751      BNE	0x4A48
    04A5E 940E 4AA3 CALL	normalize_and_pack
    04A60 940E 4AF7 CALL	restoreFPRegs
    04A62 9039      LD	R3,Y+
    04A63 9029      LD	R2,Y+
    04A64 9019      LD	R1,Y+
    04A65 9009      LD	R0,Y+
    04A66 9508      RET
    04A67 EF0F      LDI	R16,0xFF
    04A68 2F10      MOV	R17,R16
    04A69 E72F      LDI	R18,0x7F
    04A6A E73F      LDI	R19,0x7F
    04A6B 2066      TST	R6
    04A6C F399      BEQ	0x4A60
    04A6D 940E 489B CALL	neg32
    04A6F CFF0      RJMP	0x4A60
    04A70 2700      CLR	R16
    04A71 2F10      MOV	R17,R16
    04A72 2F20      MOV	R18,R16
    04A73 2F30      MOV	R19,R16
    04A74 CFEB      RJMP	0x4A60
    04A75 9109      LD	R16,Y+
    04A76 9119      LD	R17,Y+
    04A77 9129      LD	R18,Y+
    04A78 9139      LD	R19,Y+
    04A79 CFED      RJMP	0x4A67
unpacks:
    04A7A D00F      RCALL	unpacku
    04A7B F029      BEQ	0x4A81
    04A7C 2066      TST	R6
    04A7D F011      BEQ	0x4A80
    04A7E 940E 489B CALL	neg32
    04A80 9498      BCLR	1
    04A81 9508      RET
tstR16_R19:
    04A82 2300      TST	R16
    04A83 F429      BNE	0x4A89
    04A84 2311      TST	R17
    04A85 F419      BNE	0x4A89
    04A86 2322      TST	R18
    04A87 F409      BNE	0x4A89
    04A88 2333      TST	R19
    04A89 9508      RET
unpacku:
    04A8A DFF7      RCALL	tstR16_R19
    04A8B F099      BEQ	0x4A9F
    04A8C 938A      ST	-Y,R24
    04A8D 2E63      MOV	R6,R19
    04A8E E880      LDI	R24,0x80
    04A8F 2268      AND	R6,R24
    04A90 0F22      LSL	R18
    04A91 1F33      ROL	R19
    04A92 2E43      MOV	R4,R19
    04A93 E78F      LDI	R24,0x7F
    04A94 1A48      SUB	R4,R24
    04A95 2455      CLR	R5
    04A96 2788      CLR	R24
    04A97 0A58      SBC	R5,R24
    04A98 9526      LSR	R18
    04A99 E830      LDI	R19,0x80
    04A9A 2B23      OR	R18,R19
    04A9B 2733      CLR	R19
    04A9C 9189      LD	R24,Y+
    04A9D 9498      BCLR	1
    04A9E 9508      RET
    04A9F 2444      CLR	R4
    04AA0 2455      CLR	R5
    04AA1 2466      CLR	R6
    04AA2 9508      RET
normalize_and_pack:
    04AA3 DFDE      RCALL	tstR16_R19
    04AA4 F409      BNE	0x4AA6
    04AA5 9508      RET
    04AA6 93AA      ST	-Y,R26
    04AA7 93BA      ST	-Y,R27
    04AA8 01D2      MOVW	R26,R4
    04AA9 939A      ST	-Y,R25
    04AAA 938A      ST	-Y,R24
    04AAB E78E      LDI	R24,0x7E
    04AAC E090      LDI	R25,0
    04AAD 2333      TST	R19
    04AAE F049      BEQ	0x4AB8
    04AAF 9536      LSR	R19
    04AB0 9527      ROR	R18
    04AB1 9517      ROR	R17
    04AB2 9507      ROR	R16
    04AB3 17A8      CP	R26,R24
    04AB4 07B9      CPC	R27,R25
    04AB5 F4CC      BGE	0x4ACF
    04AB6 9611      ADIW	R26,1
    04AB7 CFF5      RJMP	0x4AAD
    04AB8 9580      COM	R24
    04AB9 9590      COM	R25
    04ABA 9601      ADIW	R24,1
    04ABB 2322      TST	R18
    04ABC F0BA      BMI	0x4AD4
    04ABD 0F00      LSL	R16
    04ABE 1F11      ROL	R17
    04ABF 1F22      ROL	R18
    04AC0 17A8      CP	R26,R24
    04AC1 07B9      CPC	R27,R25
    04AC2 F014      BLT	0x4AC5
    04AC3 9711      SBIW	R26,1
    04AC4 CFF6      RJMP	0x4ABB
    04AC5 2700      CLR	R16
    04AC6 2711      CLR	R17
    04AC7 2722      CLR	R18
    04AC8 2733      CLR	R19
    04AC9 9189      LD	R24,Y+
    04ACA 9199      LD	R25,Y+
    04ACB 012D      MOVW	R4,R26
    04ACC 91B9      LD	R27,Y+
    04ACD 91A9      LD	R26,Y+
    04ACE 9508      RET
    04ACF 2733      CLR	R19
    04AD0 EF0F      LDI	R16,0xFF
    04AD1 2F10      MOV	R17,R16
    04AD2 E72F      LDI	R18,0x7F
    04AD3 2F32      MOV	R19,R18
    04AD4 9189      LD	R24,Y+
    04AD5 9199      LD	R25,Y+
    04AD6 012D      MOVW	R4,R26
    04AD7 C002      RJMP	0x4ADA
pack:
    04AD8 93AA      ST	-Y,R26
    04AD9 93BA      ST	-Y,R27
    04ADA DFA7      RCALL	tstR16_R19
    04ADB F049      BEQ	0x4AE5
    04ADC 01D2      MOVW	R26,R4
    04ADD 58A1      SUBI	R26,0x81
    04ADE 4FBF      SBCI	R27,0xFF
    04ADF 012D      MOVW	R4,R26
    04AE0 2D34      MOV	R19,R4
    04AE1 0F22      LSL	R18
    04AE2 9536      LSR	R19
    04AE3 9527      ROR	R18
    04AE4 2936      OR	R19,R6
    04AE5 91B9      LD	R27,Y+
    04AE6 91A9      LD	R26,Y+
    04AE7 9508      RET
saveFPRegs:
    04AE8 924A      ST	-Y,R4
    04AE9 925A      ST	-Y,R5
    04AEA 926A      ST	-Y,R6
    04AEB 927A      ST	-Y,R7
    04AEC 928A      ST	-Y,R8
    04AED 929A      ST	-Y,R9
    04AEE 92AA      ST	-Y,R10
    04AEF 92BA      ST	-Y,R11
    04AF0 92CA      ST	-Y,R12
    04AF1 92DA      ST	-Y,R13
    04AF2 92EA      ST	-Y,R14
    04AF3 92FA      ST	-Y,R15
    04AF4 938A      ST	-Y,R24
    04AF5 939A      ST	-Y,R25
    04AF6 9508      RET
restoreFPRegs:
    04AF7 9199      LD	R25,Y+
    04AF8 9189      LD	R24,Y+
    04AF9 90F9      LD	R15,Y+
    04AFA 90E9      LD	R14,Y+
    04AFB 90D9      LD	R13,Y+
    04AFC 90C9      LD	R12,Y+
    04AFD 90B9      LD	R11,Y+
    04AFE 90A9      LD	R10,Y+
    04AFF 9099      LD	R9,Y+
    04B00 9089      LD	R8,Y+
    04B01 9079      LD	R7,Y+
    04B02 9069      LD	R6,Y+
    04B03 9059      LD	R5,Y+
    04B04 9049      LD	R4,Y+
    04B05 9508      RET
fpmule:
    04B06 940E 4AE8 CALL	saveFPRegs
    04B08 93AA      ST	-Y,R26
    04B09 93BA      ST	-Y,R27
    04B0A 940E 4A8A CALL	unpacku
    04B0C F1E1      BEQ	0x4B49
    04B0D 2CE6      MOV	R14,R6
    04B0E 2CD5      MOV	R13,R5
    04B0F 2CC4      MOV	R12,R4
    04B10 2EB3      MOV	R11,R19
    04B11 2EA2      MOV	R10,R18
    04B12 2E91      MOV	R9,R17
    04B13 2E80      MOV	R8,R16
    04B14 8100      LD	R16,Z
    04B15 8111      LDD	R17,Z+1
    04B16 8122      LDD	R18,Z+2
    04B17 8133      LDD	R19,Z+3
    04B18 940E 4A8A CALL	unpacku
    04B1A F171      BEQ	0x4B49
    04B1B 246E      EOR	R6,R14
    04B1C 0C4C      ADD	R4,R12
    04B1D 1C5D      ADC	R5,R13
    04B1E E880      LDI	R24,0x80
    04B1F 1648      CP	R4,R24
    04B20 0653      CPC	R5,R19
    04B21 F564      BGE	0x4B4E
    04B22 E881      LDI	R24,0x81
    04B23 1648      CP	R4,R24
    04B24 EF8F      LDI	R24,0xFF
    04B25 0658      CPC	R5,R24
    04B26 F16C      BLT	0x4B54
    04B27 9EA2      MUL	R10,R18
    04B28 2DB1      MOV	R27,R1
    04B29 2DA0      MOV	R26,R0
    04B2A 9E91      MUL	R9,R17
    04B2B 2D91      MOV	R25,R1
    04B2C 2D80      MOV	R24,R0
    04B2D 9EA0      MUL	R10,R16
    04B2E 0D80      ADD	R24,R0
    04B2F 1D91      ADC	R25,R1
    04B30 1FA3      ADC	R26,R19
    04B31 1FB3      ADC	R27,R19
    04B32 9E82      MUL	R8,R18
    04B33 0D80      ADD	R24,R0
    04B34 1D91      ADC	R25,R1
    04B35 1FA3      ADC	R26,R19
    04B36 1FB3      ADC	R27,R19
    04B37 9E92      MUL	R9,R18
    04B38 0D90      ADD	R25,R0
    04B39 1DA1      ADC	R26,R1
    04B3A 1FB3      ADC	R27,R19
    04B3B 9EA1      MUL	R10,R17
    04B3C 0D90      ADD	R25,R0
    04B3D 1DA1      ADC	R26,R1
    04B3E 1FB3      ADC	R27,R19
    04B3F 2F2B      MOV	R18,R27
    04B40 2F1A      MOV	R17,R26
    04B41 2F09      MOV	R16,R25
    04B42 0F88      LSL	R24
    04B43 1F00      ROL	R16
    04B44 1F11      ROL	R17
    04B45 1F22      ROL	R18
    04B46 1F33      ROL	R19
    04B47 940E 4AA3 CALL	normalize_and_pack
    04B49 91B9      LD	R27,Y+
    04B4A 91A9      LD	R26,Y+
    04B4B 940E 4AF7 CALL	restoreFPRegs
    04B4D 9508      RET
    04B4E EF0F      LDI	R16,0xFF
    04B4F 2F10      MOV	R17,R16
    04B50 E72F      LDI	R18,0x7F
    04B51 E78F      LDI	R24,0x7F
    04B52 2E48      MOV	R4,R24
    04B53 CFF5      RJMP	0x4B49
    04B54 2700      CLR	R16
    04B55 2F10      MOV	R17,R16
    04B56 2F20      MOV	R18,R16
    04B57 2F30      MOV	R19,R16
    04B58 CFF0      RJMP	0x4B49
fpmule1:
    04B59 93FA      ST	-Y,R31
    04B5A 93EA      ST	-Y,R30
    04B5B 81EA      LDD	R30,Y+2
    04B5C 81FB      LDD	R31,Y+3
    04B5D 940E 4B06 CALL	fpmule
    04B5F 91E9      LD	R30,Y+
    04B60 91F9      LD	R31,Y+
    04B61 9622      ADIW	R28,2
    04B62 9508      RET
fpmule2:
    04B63 93FA      ST	-Y,R31
    04B64 93EA      ST	-Y,R30
    04B65 2FEC      MOV	R30,R28
    04B66 2FFD      MOV	R31,R29
    04B67 9632      ADIW	R30,2
    04B68 940E 4B06 CALL	fpmule
    04B6A 91E9      LD	R30,Y+
    04B6B 91F9      LD	R31,Y+
    04B6C 9624      ADIW	R28,4
    04B6D 9508      RET
fpmule1x:
    04B6E 93FA      ST	-Y,R31
    04B6F 93EA      ST	-Y,R30
    04B70 81EA      LDD	R30,Y+2
    04B71 81FB      LDD	R31,Y+3
    04B72 940E 4B06 CALL	fpmule
    04B74 91E9      LD	R30,Y+
    04B75 91F9      LD	R31,Y+
    04B76 8339      STD	Y+1,R19
    04B77 8328      ST	Y,R18
    04B78 931A      ST	-Y,R17
    04B79 930A      ST	-Y,R16
    04B7A 9508      RET
fpcmp:
    04B7B 940E 490D CALL	fpsub
    04B7D 2333      TST	R19
    04B7E F03A      BMI	0x4B86
    04B7F 940E 4A82 CALL	tstR16_R19
    04B81 F011      BEQ	0x4B84
    04B82 E001      LDI	R16,1
    04B83 9508      RET
    04B84 2700      CLR	R16
    04B85 9508      RET
    04B86 EF0F      LDI	R16,0xFF
    04B87 9508      RET
fpcmp1:
    04B88 93FA      ST	-Y,R31
    04B89 93EA      ST	-Y,R30
    04B8A 81EA      LDD	R30,Y+2
    04B8B 81FB      LDD	R31,Y+3
    04B8C 940E 4B7B CALL	fpcmp
    04B8E 91E9      LD	R30,Y+
    04B8F 91F9      LD	R31,Y+
    04B90 9622      ADIW	R28,2
    04B91 2300      TST	R16
    04B92 9508      RET
fpcmp2:
    04B93 93FA      ST	-Y,R31
    04B94 93EA      ST	-Y,R30
    04B95 2FEC      MOV	R30,R28
    04B96 2FFD      MOV	R31,R29
    04B97 9632      ADIW	R30,2
    04B98 940E 4B7B CALL	fpcmp
    04B9A 91E9      LD	R30,Y+
    04B9B 91F9      LD	R31,Y+
    04B9C 9624      ADIW	R28,4
    04B9D 2300      TST	R16
    04B9E 9508      RET
_cstrcpy:
    04B9F 2FA0      MOV	R26,R16
    04BA0 2FB1      MOV	R27,R17
    04BA1 2FE2      MOV	R30,R18
    04BA2 2FF3      MOV	R31,R19
    04BA3 95C8      LPM
    04BA4 9631      ADIW	R30,1
    04BA5 920D      ST	X+,R0
    04BA6 2000      TST	R0
    04BA7 F7D9      BNE	0x4BA3
    04BA8 9508      RET
_cstrlen:
    04BA9 2FE0      MOV	R30,R16
    04BAA 2FF1      MOV	R31,R17
    04BAB 27AA      CLR	R26
    04BAC 27BB      CLR	R27
    04BAD 95C8      LPM
    04BAE 2000      TST	R0
    04BAF F019      BEQ	0x4BB3
    04BB0 9631      ADIW	R30,1
    04BB1 9611      ADIW	R26,1
    04BB2 CFFA      RJMP	0x4BAD
    04BB3 2F0A      MOV	R16,R26
    04BB4 2F1B      MOV	R17,R27
    04BB5 9508      RET
_atoi:
    04BB6 940E 4864 CALL	push_xgsetF00C
    04BB8 0158      MOVW	R10,R16
    04BB9 C003      RJMP	0x4BBD
    04BBA 01C5      MOVW	R24,R10
    04BBB 9601      ADIW	R24,1
    04BBC 015C      MOVW	R10,R24
    04BBD 01F5      MOVW	R30,R10
    04BBE 8100      LD	R16,Z
    04BBF 2711      CLR	R17
    04BC0 940E 4F69 CALL	_isspace
    04BC2 3000      CPI	R16,0
    04BC3 0701      CPC	R16,R17
    04BC4 F7A9      BNE	0x4BBA
    04BC5 2766      CLR	R22
    04BC6 2777      CLR	R23
    04BC7 01F5      MOVW	R30,R10
    04BC8 8180      LD	R24,Z
    04BC9 328D      CPI	R24,0x2D
    04BCA F429      BNE	0x4BD0
    04BCB E061      LDI	R22,1
    04BCC 01CF      MOVW	R24,R30
    04BCD 9601      ADIW	R24,1
    04BCE 015C      MOVW	R10,R24
    04BCF C007      RJMP	0x4BD7
    04BD0 01F5      MOVW	R30,R10
    04BD1 8180      LD	R24,Z
    04BD2 328B      CPI	R24,0x2B
    04BD3 F419      BNE	0x4BD7
    04BD4 01CF      MOVW	R24,R30
    04BD5 9601      ADIW	R24,1
    04BD6 015C      MOVW	R10,R24
    04BD7 2744      CLR	R20
    04BD8 2755      CLR	R21
    04BD9 C00E      RJMP	0x4BE8
    04BDA E00A      LDI	R16,0xA
    04BDB E010      LDI	R17,0
    04BDC 019A      MOVW	R18,R20
    04BDD 940E 47E1 CALL	empy16s
    04BDF 01A8      MOVW	R20,R16
    04BE0 01F5      MOVW	R30,R10
    04BE1 9021      LD	R2,Z+
    04BE2 015F      MOVW	R10,R30
    04BE3 2433      CLR	R3
    04BE4 0D42      ADD	R20,R2
    04BE5 1D53      ADC	R21,R3
    04BE6 5340      SUBI	R20,0x30
    04BE7 4050      SBCI	R21,0
    04BE8 01F5      MOVW	R30,R10
    04BE9 8100      LD	R16,Z
    04BEA 2711      CLR	R17
    04BEB 940E 4F55 CALL	_isdigit
    04BED 3000      CPI	R16,0
    04BEE 0701      CPC	R16,R17
    04BEF F751      BNE	0x4BDA
    04BF0 3060      CPI	R22,0
    04BF1 0767      CPC	R22,R23
    04BF2 F031      BEQ	0x4BF9
    04BF3 018A      MOVW	R16,R20
    04BF4 9500      COM	R16
    04BF5 9510      COM	R17
    04BF6 5F0F      SUBI	R16,0xFF
    04BF7 4F1F      SBCI	R17,0xFF
    04BF8 C001      RJMP	0x4BFA
    04BF9 018A      MOVW	R16,R20
    04BFA 940C 486B JMP	pop_xgsetF00C
_itoa:
    04BFC 940E 4700 CALL	push_arg4
    04BFE 940E 4845 CALL	push_xgsetF0FC
    04C00 01A9      MOVW	R20,R18
    04C01 84EE      LDD	R14,Y+14
    04C02 84FF      LDD	R15,Y+15
    04C03 015A      MOVW	R10,R20
    04C04 20AA      TST	R10
    04C05 F451      BNE	0x4C10
    04C06 20BB      TST	R11
    04C07 F441      BNE	0x4C10
    04C08 E380      LDI	R24,0x30
    04C09 85EA      LDD	R30,Y+10
    04C0A 85FB      LDD	R31,Y+11
    04C0B 8380      ST	Z,R24
    04C0C 2422      CLR	R2
    04C0D 8221      STD	Z+1,R2
    04C0E 018F      MOVW	R16,R30
    04C0F C053      RJMP	0x4C63
    04C10 3040      CPI	R20,0
    04C11 E0E0      LDI	R30,0
    04C12 075E      CPC	R21,R30
    04C13 F46C      BGE	0x4C21
    04C14 01C7      MOVW	R24,R14
    04C15 308A      CPI	R24,0xA
    04C16 E0E0      LDI	R30,0
    04C17 079E      CPC	R25,R30
    04C18 F441      BNE	0x4C21
    04C19 24CC      CLR	R12
    04C1A 94C3      INC	R12
    04C1B 01C5      MOVW	R24,R10
    04C1C 9580      COM	R24
    04C1D 9590      COM	R25
    04C1E 9601      ADIW	R24,1
    04C1F 015C      MOVW	R10,R24
    04C20 C001      RJMP	0x4C22
    04C21 24CC      CLR	R12
    04C22 856A      LDD	R22,Y+10
    04C23 857B      LDD	R23,Y+11
    04C24 0197      MOVW	R18,R14
    04C25 0185      MOVW	R16,R10
    04C26 940E 472F CALL	mod16u
    04C28 01A8      MOVW	R20,R16
    04C29 E089      LDI	R24,0x9
    04C2A E090      LDI	R25,0
    04C2B 1780      CP	R24,R16
    04C2C 0791      CPC	R25,R17
    04C2D F034      BLT	0x4C34
    04C2E 01CA      MOVW	R24,R20
    04C2F 96C0      ADIW	R24,0x30
    04C30 01FB      MOVW	R30,R22
    04C31 9381      ST	Z+,R24
    04C32 01BF      MOVW	R22,R30
    04C33 C006      RJMP	0x4C3A
    04C34 01CA      MOVW	R24,R20
    04C35 5A89      SUBI	R24,0xA9
    04C36 4F9F      SBCI	R25,0xFF
    04C37 01FB      MOVW	R30,R22
    04C38 9381      ST	Z+,R24
    04C39 01BF      MOVW	R22,R30
    04C3A 0197      MOVW	R18,R14
    04C3B 0185      MOVW	R16,R10
    04C3C 940E 4731 CALL	div16u
    04C3E 0158      MOVW	R10,R16
    04C3F 20AA      TST	R10
    04C40 F719      BNE	0x4C24
    04C41 20BB      TST	R11
    04C42 F709      BNE	0x4C24
    04C43 20CC      TST	R12
    04C44 F021      BEQ	0x4C49
    04C45 E28D      LDI	R24,0x2D
    04C46 01FB      MOVW	R30,R22
    04C47 9381      ST	Z+,R24
    04C48 01BF      MOVW	R22,R30
    04C49 012B      MOVW	R4,R22
    04C4A 5061      SUBI	R22,1
    04C4B 4070      SBCI	R23,0
    04C4C 2422      CLR	R2
    04C4D 01F2      MOVW	R30,R4
    04C4E 8220      ST	Z,R2
    04C4F 84AA      LDD	R10,Y+10
    04C50 84BB      LDD	R11,Y+11
    04C51 C00C      RJMP	0x4C5E
    04C52 01F5      MOVW	R30,R10
    04C53 80C0      LD	R12,Z
    04C54 01FB      MOVW	R30,R22
    04C55 8020      LD	R2,Z
    04C56 01F5      MOVW	R30,R10
    04C57 9221      ST	Z+,R2
    04C58 015F      MOVW	R10,R30
    04C59 011B      MOVW	R2,R22
    04C5A 5061      SUBI	R22,1
    04C5B 4070      SBCI	R23,0
    04C5C 01F1      MOVW	R30,R2
    04C5D 82C0      ST	Z,R12
    04C5E 16A6      CP	R10,R22
    04C5F 06B7      CPC	R11,R23
    04C60 F388      BCS	0x4C52
    04C61 850A      LDD	R16,Y+10
    04C62 851B      LDD	R17,Y+11
    04C63 940E 483A CALL	pop_xgsetF0FC
    04C65 9624      ADIW	R28,4
    04C66 9508      RET
_ltoa:
    04C67 940E 4700 CALL	push_arg4
    04C69 940E 4845 CALL	push_xgsetF0FC
    04C6B 9724      SBIW	R28,4
    04C6C 8828      LDD	R2,Y+16
    04C6D 8839      LDD	R3,Y+17
    04C6E 884A      LDD	R4,Y+18
    04C6F 885B      LDD	R5,Y+19
    04C70 8228      ST	Y,R2
    04C71 8239      STD	Y+1,R3
    04C72 824A      STD	Y+2,R4
    04C73 825B      STD	Y+3,R5
    04C74 8828      LDD	R2,Y+16
    04C75 8839      LDD	R3,Y+17
    04C76 884A      LDD	R4,Y+18
    04C77 885B      LDD	R5,Y+19
    04C78 9488      BCLR	0
    04C79 2022      TST	R2
    04C7A 0432      CPC	R3,R2
    04C7B 0442      CPC	R4,R2
    04C7C 0452      CPC	R5,R2
    04C7D F441      BNE	0x4C86
    04C7E E380      LDI	R24,0x30
    04C7F 85EE      LDD	R30,Y+14
    04C80 85FF      LDD	R31,Y+15
    04C81 8380      ST	Z,R24
    04C82 2422      CLR	R2
    04C83 8221      STD	Z+1,R2
    04C84 018F      MOVW	R16,R30
    04C85 C094      RJMP	0x4D1A
    04C86 E040      LDI	R20,0
    04C87 E050      LDI	R21,0
    04C88 E060      LDI	R22,0
    04C89 E070      LDI	R23,0
    04C8A 8828      LDD	R2,Y+16
    04C8B 8839      LDD	R3,Y+17
    04C8C 884A      LDD	R4,Y+18
    04C8D 885B      LDD	R5,Y+19
    04C8E 1624      CP	R2,R20
    04C8F 0635      CPC	R3,R21
    04C90 0646      CPC	R4,R22
    04C91 0657      CPC	R5,R23
    04C92 F4EC      BGE	0x4CB0
    04C93 898C      LDD	R24,Y+20
    04C94 899D      LDD	R25,Y+21
    04C95 308A      CPI	R24,0xA
    04C96 E0A0      LDI	R26,0
    04C97 079A      CPC	R25,R26
    04C98 F4B9      BNE	0x4CB0
    04C99 24AA      CLR	R10
    04C9A 94A3      INC	R10
    04C9B E041      LDI	R20,1
    04C9C E050      LDI	R21,0
    04C9D E060      LDI	R22,0
    04C9E E070      LDI	R23,0
    04C9F 8028      LD	R2,Y
    04CA0 8039      LDD	R3,Y+1
    04CA1 804A      LDD	R4,Y+2
    04CA2 805B      LDD	R5,Y+3
    04CA3 9420      COM	R2
    04CA4 9430      COM	R3
    04CA5 9440      COM	R4
    04CA6 9450      COM	R5
    04CA7 0E24      ADD	R2,R20
    04CA8 1E35      ADC	R3,R21
    04CA9 1E46      ADC	R4,R22
    04CAA 1E57      ADC	R5,R23
    04CAB 8228      ST	Y,R2
    04CAC 8239      STD	Y+1,R3
    04CAD 824A      STD	Y+2,R4
    04CAE 825B      STD	Y+3,R5
    04CAF C001      RJMP	0x4CB1
    04CB0 24AA      CLR	R10
    04CB1 84CE      LDD	R12,Y+14
    04CB2 84DF      LDD	R13,Y+15
    04CB3 882C      LDD	R2,Y+20
    04CB4 883D      LDD	R3,Y+21
    04CB5 2444      CLR	R4
    04CB6 FC37      SBRC	R3,7
    04CB7 9440      COM	R4
    04CB8 2455      CLR	R5
    04CB9 FC47      SBRC	R4,7
    04CBA 9450      COM	R5
    04CBB 8108      LD	R16,Y
    04CBC 8119      LDD	R17,Y+1
    04CBD 812A      LDD	R18,Y+2
    04CBE 813B      LDD	R19,Y+3
    04CBF 925A      ST	-Y,R5
    04CC0 924A      ST	-Y,R4
    04CC1 923A      ST	-Y,R3
    04CC2 922A      ST	-Y,R2
    04CC3 940E 474D CALL	mod32u
    04CC5 0178      MOVW	R14,R16
    04CC6 E089      LDI	R24,0x9
    04CC7 E090      LDI	R25,0
    04CC8 1780      CP	R24,R16
    04CC9 0791      CPC	R25,R17
    04CCA F034      BLT	0x4CD1
    04CCB 01C7      MOVW	R24,R14
    04CCC 96C0      ADIW	R24,0x30
    04CCD 01F6      MOVW	R30,R12
    04CCE 9381      ST	Z+,R24
    04CCF 016F      MOVW	R12,R30
    04CD0 C006      RJMP	0x4CD7
    04CD1 01C7      MOVW	R24,R14
    04CD2 5A89      SUBI	R24,0xA9
    04CD3 4F9F      SBCI	R25,0xFF
    04CD4 01F6      MOVW	R30,R12
    04CD5 9381      ST	Z+,R24
    04CD6 016F      MOVW	R12,R30
    04CD7 882C      LDD	R2,Y+20
    04CD8 883D      LDD	R3,Y+21
    04CD9 2444      CLR	R4
    04CDA FC37      SBRC	R3,7
    04CDB 9440      COM	R4
    04CDC 2455      CLR	R5
    04CDD FC47      SBRC	R4,7
    04CDE 9450      COM	R5
    04CDF 8108      LD	R16,Y
    04CE0 8119      LDD	R17,Y+1
    04CE1 812A      LDD	R18,Y+2
    04CE2 813B      LDD	R19,Y+3
    04CE3 925A      ST	-Y,R5
    04CE4 924A      ST	-Y,R4
    04CE5 923A      ST	-Y,R3
    04CE6 922A      ST	-Y,R2
    04CE7 940E 474B CALL	div32u
    04CE9 8308      ST	Y,R16
    04CEA 8319      STD	Y+1,R17
    04CEB 832A      STD	Y+2,R18
    04CEC 833B      STD	Y+3,R19
    04CED 8028      LD	R2,Y
    04CEE 8039      LDD	R3,Y+1
    04CEF 804A      LDD	R4,Y+2
    04CF0 805B      LDD	R5,Y+3
    04CF1 9488      BCLR	0
    04CF2 2022      TST	R2
    04CF3 0432      CPC	R3,R2
    04CF4 0442      CPC	R4,R2
    04CF5 0452      CPC	R5,R2
    04CF6 F009      BEQ	0x4CF8
    04CF7 CFBB      RJMP	0x4CB3
    04CF8 20AA      TST	R10
    04CF9 F021      BEQ	0x4CFE
    04CFA E28D      LDI	R24,0x2D
    04CFB 01F6      MOVW	R30,R12
    04CFC 9381      ST	Z+,R24
    04CFD 016F      MOVW	R12,R30
    04CFE 0126      MOVW	R4,R12
    04CFF 01C2      MOVW	R24,R4
    04D00 9701      SBIW	R24,1
    04D01 016C      MOVW	R12,R24
    04D02 2422      CLR	R2
    04D03 01F2      MOVW	R30,R4
    04D04 8220      ST	Z,R2
    04D05 84EE      LDD	R14,Y+14
    04D06 84FF      LDD	R15,Y+15
    04D07 C00D      RJMP	0x4D15
    04D08 01F7      MOVW	R30,R14
    04D09 80A0      LD	R10,Z
    04D0A 01F6      MOVW	R30,R12
    04D0B 8020      LD	R2,Z
    04D0C 01F7      MOVW	R30,R14
    04D0D 9221      ST	Z+,R2
    04D0E 017F      MOVW	R14,R30
    04D0F 0116      MOVW	R2,R12
    04D10 01C1      MOVW	R24,R2
    04D11 9701      SBIW	R24,1
    04D12 016C      MOVW	R12,R24
    04D13 01F1      MOVW	R30,R2
    04D14 82A0      ST	Z,R10
    04D15 14EC      CP	R14,R12
    04D16 04FD      CPC	R15,R13
    04D17 F380      BCS	0x4D08
    04D18 850E      LDD	R16,Y+14
    04D19 851F      LDD	R17,Y+15
    04D1A 9624      ADIW	R28,4
    04D1B 940E 483A CALL	pop_xgsetF0FC
    04D1D 9624      ADIW	R28,4
    04D1E 9508      RET
_ultoa:
    04D1F 933A      ST	-Y,R19
    04D20 932A      ST	-Y,R18
    04D21 940E 4845 CALL	push_xgsetF0FC
    04D23 0158      MOVW	R10,R16
    04D24 84CE      LDD	R12,Y+14
    04D25 84DF      LDD	R13,Y+15
    04D26 01A5      MOVW	R20,R10
    04D27 0116      MOVW	R2,R12
    04D28 2444      CLR	R4
    04D29 FC37      SBRC	R3,7
    04D2A 9440      COM	R4
    04D2B 2455      CLR	R5
    04D2C FC47      SBRC	R4,7
    04D2D 9450      COM	R5
    04D2E 850A      LDD	R16,Y+10
    04D2F 851B      LDD	R17,Y+11
    04D30 852C      LDD	R18,Y+12
    04D31 853D      LDD	R19,Y+13
    04D32 925A      ST	-Y,R5
    04D33 924A      ST	-Y,R4
    04D34 923A      ST	-Y,R3
    04D35 922A      ST	-Y,R2
    04D36 940E 474D CALL	mod32u
    04D38 01B8      MOVW	R22,R16
    04D39 E089      LDI	R24,0x9
    04D3A E090      LDI	R25,0
    04D3B 1780      CP	R24,R16
    04D3C 0791      CPC	R25,R17
    04D3D F034      BLT	0x4D44
    04D3E 01CB      MOVW	R24,R22
    04D3F 96C0      ADIW	R24,0x30
    04D40 01FA      MOVW	R30,R20
    04D41 9381      ST	Z+,R24
    04D42 01AF      MOVW	R20,R30
    04D43 C006      RJMP	0x4D4A
    04D44 01CB      MOVW	R24,R22
    04D45 5A89      SUBI	R24,0xA9
    04D46 4F9F      SBCI	R25,0xFF
    04D47 01FA      MOVW	R30,R20
    04D48 9381      ST	Z+,R24
    04D49 01AF      MOVW	R20,R30
    04D4A 0116      MOVW	R2,R12
    04D4B 2444      CLR	R4
    04D4C FC37      SBRC	R3,7
    04D4D 9440      COM	R4
    04D4E 2455      CLR	R5
    04D4F FC47      SBRC	R4,7
    04D50 9450      COM	R5
    04D51 850A      LDD	R16,Y+10
    04D52 851B      LDD	R17,Y+11
    04D53 852C      LDD	R18,Y+12
    04D54 853D      LDD	R19,Y+13
    04D55 925A      ST	-Y,R5
    04D56 924A      ST	-Y,R4
    04D57 923A      ST	-Y,R3
    04D58 922A      ST	-Y,R2
    04D59 940E 474B CALL	div32u
    04D5B 870A      STD	Y+10,R16
    04D5C 871B      STD	Y+11,R17
    04D5D 872C      STD	Y+12,R18
    04D5E 873D      STD	Y+13,R19
    04D5F 842A      LDD	R2,Y+10
    04D60 843B      LDD	R3,Y+11
    04D61 844C      LDD	R4,Y+12
    04D62 845D      LDD	R5,Y+13
    04D63 9488      BCLR	0
    04D64 2022      TST	R2
    04D65 0432      CPC	R3,R2
    04D66 0442      CPC	R4,R2
    04D67 0452      CPC	R5,R2
    04D68 F009      BEQ	0x4D6A
    04D69 CFBD      RJMP	0x4D27
    04D6A 012A      MOVW	R4,R20
    04D6B 5041      SUBI	R20,1
    04D6C 4050      SBCI	R21,0
    04D6D 2422      CLR	R2
    04D6E 01F2      MOVW	R30,R4
    04D6F 8220      ST	Z,R2
    04D70 0165      MOVW	R12,R10
    04D71 C00C      RJMP	0x4D7E
    04D72 01F6      MOVW	R30,R12
    04D73 80E0      LD	R14,Z
    04D74 01FA      MOVW	R30,R20
    04D75 8020      LD	R2,Z
    04D76 01F6      MOVW	R30,R12
    04D77 9221      ST	Z+,R2
    04D78 016F      MOVW	R12,R30
    04D79 011A      MOVW	R2,R20
    04D7A 5041      SUBI	R20,1
    04D7B 4050      SBCI	R21,0
    04D7C 01F1      MOVW	R30,R2
    04D7D 82E0      ST	Z,R14
    04D7E 16C4      CP	R12,R20
    04D7F 06D5      CPC	R13,R21
    04D80 F388      BCS	0x4D72
    04D81 0185      MOVW	R16,R10
    04D82 940E 483A CALL	pop_xgsetF0FC
    04D84 9622      ADIW	R28,2
    04D85 9508      RET
_utoa:
    04D86 940E 4845 CALL	push_xgsetF0FC
    04D88 0169      MOVW	R12,R18
    04D89 0158      MOVW	R10,R16
    04D8A 84EA      LDD	R14,Y+10
    04D8B 84FB      LDD	R15,Y+11
    04D8C 01A5      MOVW	R20,R10
    04D8D 0197      MOVW	R18,R14
    04D8E 0186      MOVW	R16,R12
    04D8F 940E 472F CALL	mod16u
    04D91 01B8      MOVW	R22,R16
    04D92 E089      LDI	R24,0x9
    04D93 E090      LDI	R25,0
    04D94 1780      CP	R24,R16
    04D95 0791      CPC	R25,R17
    04D96 F034      BLT	0x4D9D
    04D97 01CB      MOVW	R24,R22
    04D98 96C0      ADIW	R24,0x30
    04D99 01FA      MOVW	R30,R20
    04D9A 9381      ST	Z+,R24
    04D9B 01AF      MOVW	R20,R30
    04D9C C006      RJMP	0x4DA3
    04D9D 01CB      MOVW	R24,R22
    04D9E 5A89      SUBI	R24,0xA9
    04D9F 4F9F      SBCI	R25,0xFF
    04DA0 01FA      MOVW	R30,R20
    04DA1 9381      ST	Z+,R24
    04DA2 01AF      MOVW	R20,R30
    04DA3 0197      MOVW	R18,R14
    04DA4 0186      MOVW	R16,R12
    04DA5 940E 4731 CALL	div16u
    04DA7 0168      MOVW	R12,R16
    04DA8 20CC      TST	R12
    04DA9 F719      BNE	0x4D8D
    04DAA 20DD      TST	R13
    04DAB F709      BNE	0x4D8D
    04DAC 012A      MOVW	R4,R20
    04DAD 5041      SUBI	R20,1
    04DAE 4050      SBCI	R21,0
    04DAF 2422      CLR	R2
    04DB0 01F2      MOVW	R30,R4
    04DB1 8220      ST	Z,R2
    04DB2 0165      MOVW	R12,R10
    04DB3 C00C      RJMP	0x4DC0
    04DB4 01F6      MOVW	R30,R12
    04DB5 80E0      LD	R14,Z
    04DB6 01FA      MOVW	R30,R20
    04DB7 8020      LD	R2,Z
    04DB8 01F6      MOVW	R30,R12
    04DB9 9221      ST	Z+,R2
    04DBA 016F      MOVW	R12,R30
    04DBB 011A      MOVW	R2,R20
    04DBC 5041      SUBI	R20,1
    04DBD 4050      SBCI	R21,0
    04DBE 01F1      MOVW	R30,R2
    04DBF 82E0      ST	Z,R14
    04DC0 16C4      CP	R12,R20
    04DC1 06D5      CPC	R13,R21
    04DC2 F388      BCS	0x4DB4
    04DC3 0185      MOVW	R16,R10
    04DC4 940C 483A JMP	pop_xgsetF0FC
_ftoa:
    04DC6 940E 4700 CALL	push_arg4
    04DC8 940E 4845 CALL	push_xgsetF0FC
    04DCA 9764      SBIW	R28,0x14
    04DCB A0CA      LDD	R12,Y+34
    04DCC A0DB      LDD	R13,Y+35
    04DCD 2422      CLR	R2
    04DCE 2433      CLR	R3
    04DCF 01F6      MOVW	R30,R12
    04DD0 8231      STD	Z+1,R3
    04DD1 8220      ST	Z,R2
    04DD2 8C2E      LDD	R2,Y+30
    04DD3 8C3F      LDD	R3,Y+31
    04DD4 A048      LDD	R4,Y+32
    04DD5 A059      LDD	R5,Y+33
    04DD6 EE08      LDI	R16,0xE8
    04DD7 E010      LDI	R17,0
    04DD8 940E 47CD CALL	elpm32
    04DDA 933A      ST	-Y,R19
    04DDB 932A      ST	-Y,R18
    04DDC 931A      ST	-Y,R17
    04DDD 930A      ST	-Y,R16
    04DDE 0181      MOVW	R16,R2
    04DDF 0192      MOVW	R18,R4
    04DE0 940E 4B93 CALL	fpcmp2
    04DE2 F479      BNE	0x4DF2
    04DE3 E380      LDI	R24,0x30
    04DE4 9380 0880 STS	config+45,R24
    04DE6 E28E      LDI	R24,0x2E
    04DE7 9380 0881 STS	config+46,R24
    04DE9 E380      LDI	R24,0x30
    04DEA 9380 0882 STS	config+47,R24
    04DEC 2422      CLR	R2
    04DED 9220 0883 STS	config+48,R2
    04DEF E800      LDI	R16,0x80
    04DF0 E018      LDI	R17,0x8
    04DF1 C15E      RJMP	0x4F50
    04DF2 8C2E      LDD	R2,Y+30
    04DF3 8C3F      LDD	R3,Y+31
    04DF4 A048      LDD	R4,Y+32
    04DF5 A059      LDD	R5,Y+33
    04DF6 8628      STD	Y+8,R2
    04DF7 8639      STD	Y+9,R3
    04DF8 864A      STD	Y+10,R4
    04DF9 865B      STD	Y+11,R5
    04DFA E187      LDI	R24,0x17
    04DFB E090      LDI	R25,0
    04DFC 8508      LDD	R16,Y+8
    04DFD 8519      LDD	R17,Y+9
    04DFE 852A      LDD	R18,Y+10
    04DFF 853B      LDD	R19,Y+11
    04E00 938A      ST	-Y,R24
    04E01 940E 4705 CALL	asr32
    04E03 2F80      MOV	R24,R16
    04E04 2799      CLR	R25
    04E05 578F      SUBI	R24,0x7F
    04E06 4090      SBCI	R25,0
    04E07 015C      MOVW	R10,R24
    04E08 EF4F      LDI	R20,0xFF
    04E09 EF5F      LDI	R21,0xFF
    04E0A EF6F      LDI	R22,0xFF
    04E0B E070      LDI	R23,0
    04E0C 8428      LDD	R2,Y+8
    04E0D 8439      LDD	R3,Y+9
    04E0E 844A      LDD	R4,Y+10
    04E0F 845B      LDD	R5,Y+11
    04E10 2224      AND	R2,R20
    04E11 2235      AND	R3,R21
    04E12 2246      AND	R4,R22
    04E13 2257      AND	R5,R23
    04E14 93EF      PUSH	R30
    04E15 2DE4      MOV	R30,R4
    04E16 68E0      ORI	R30,0x80
    04E17 2E4E      MOV	R4,R30
    04E18 91EF      POP	R30
    04E19 8A28      STD	Y+16,R2
    04E1A 8A39      STD	Y+17,R3
    04E1B 8A4A      STD	Y+18,R4
    04E1C 8A5B      STD	Y+19,R5
    04E1D E080      LDI	R24,0
    04E1E 838C      STD	Y+4,R24
    04E1F 838D      STD	Y+5,R24
    04E20 838E      STD	Y+6,R24
    04E21 838F      STD	Y+7,R24
    04E22 E080      LDI	R24,0
    04E23 878C      STD	Y+12,R24
    04E24 878D      STD	Y+13,R24
    04E25 878E      STD	Y+14,R24
    04E26 878F      STD	Y+15,R24
    04E27 01C5      MOVW	R24,R10
    04E28 318F      CPI	R24,0x1F
    04E29 E0E0      LDI	R30,0
    04E2A 079E      CPC	R25,R30
    04E2B F044      BLT	0x4E34
    04E2C EF8E      LDI	R24,0xFE
    04E2D EF9F      LDI	R25,0xFF
    04E2E 01F6      MOVW	R30,R12
    04E2F 8391      STD	Z+1,R25
    04E30 8380      ST	Z,R24
    04E31 2700      CLR	R16
    04E32 2711      CLR	R17
    04E33 C11C      RJMP	0x4F50
    04E34 01C5      MOVW	R24,R10
    04E35 3E89      CPI	R24,0xE9
    04E36 EFEF      LDI	R30,0xFF
    04E37 079E      CPC	R25,R30
    04E38 F444      BGE	0x4E41
    04E39 EF8F      LDI	R24,0xFF
    04E3A EF9F      LDI	R25,0xFF
    04E3B 01F6      MOVW	R30,R12
    04E3C 8391      STD	Z+1,R25
    04E3D 8380      ST	Z,R24
    04E3E 2700      CLR	R16
    04E3F 2711      CLR	R17
    04E40 C10F      RJMP	0x4F50
    04E41 01C5      MOVW	R24,R10
    04E42 3187      CPI	R24,0x17
    04E43 E0A0      LDI	R26,0
    04E44 079A      CPC	R25,R26
    04E45 F06C      BLT	0x4E53
    04E46 9747      SBIW	R24,0x17
    04E47 8908      LDD	R16,Y+16
    04E48 8919      LDD	R17,Y+17
    04E49 892A      LDD	R18,Y+18
    04E4A 893B      LDD	R19,Y+19
    04E4B 938A      ST	-Y,R24
    04E4C 940E 48D0 CALL	lsl32
    04E4E 870C      STD	Y+12,R16
    04E4F 871D      STD	Y+13,R17
    04E50 872E      STD	Y+14,R18
    04E51 873F      STD	Y+15,R19
    04E52 C045      RJMP	0x4E98
    04E53 01C5      MOVW	R24,R10
    04E54 3080      CPI	R24,0
    04E55 E0A0      LDI	R26,0
    04E56 079A      CPC	R25,R26
    04E57 F13C      BLT	0x4E7F
    04E58 E187      LDI	R24,0x17
    04E59 E090      LDI	R25,0
    04E5A 198A      SUB	R24,R10
    04E5B 099B      SBC	R25,R11
    04E5C 8908      LDD	R16,Y+16
    04E5D 8919      LDD	R17,Y+17
    04E5E 892A      LDD	R18,Y+18
    04E5F 893B      LDD	R19,Y+19
    04E60 938A      ST	-Y,R24
    04E61 940E 4705 CALL	asr32
    04E63 870C      STD	Y+12,R16
    04E64 871D      STD	Y+13,R17
    04E65 872E      STD	Y+14,R18
    04E66 873F      STD	Y+15,R19
    04E67 01C5      MOVW	R24,R10
    04E68 9601      ADIW	R24,1
    04E69 8908      LDD	R16,Y+16
    04E6A 8919      LDD	R17,Y+17
    04E6B 892A      LDD	R18,Y+18
    04E6C 893B      LDD	R19,Y+19
    04E6D 938A      ST	-Y,R24
    04E6E 940E 48D0 CALL	lsl32
    04E70 0118      MOVW	R2,R16
    04E71 0129      MOVW	R4,R18
    04E72 EF4F      LDI	R20,0xFF
    04E73 EF5F      LDI	R21,0xFF
    04E74 EF6F      LDI	R22,0xFF
    04E75 E070      LDI	R23,0
    04E76 2224      AND	R2,R20
    04E77 2235      AND	R3,R21
    04E78 2246      AND	R4,R22
    04E79 2257      AND	R5,R23
    04E7A 822C      STD	Y+4,R2
    04E7B 823D      STD	Y+5,R3
    04E7C 824E      STD	Y+6,R4
    04E7D 825F      STD	Y+7,R5
    04E7E C019      RJMP	0x4E98
    04E7F EF4F      LDI	R20,0xFF
    04E80 EF5F      LDI	R21,0xFF
    04E81 EF6F      LDI	R22,0xFF
    04E82 E070      LDI	R23,0
    04E83 8908      LDD	R16,Y+16
    04E84 8919      LDD	R17,Y+17
    04E85 892A      LDD	R18,Y+18
    04E86 893B      LDD	R19,Y+19
    04E87 2304      AND	R16,R20
    04E88 2315      AND	R17,R21
    04E89 2326      AND	R18,R22
    04E8A 2337      AND	R19,R23
    04E8B 01C5      MOVW	R24,R10
    04E8C 9601      ADIW	R24,1
    04E8D 9580      COM	R24
    04E8E 9590      COM	R25
    04E8F 5F8F      SUBI	R24,0xFF
    04E90 4F9F      SBCI	R25,0xFF
    04E91 938A      ST	-Y,R24
    04E92 940E 4705 CALL	asr32
    04E94 830C      STD	Y+4,R16
    04E95 831D      STD	Y+5,R17
    04E96 832E      STD	Y+6,R18
    04E97 833F      STD	Y+7,R19
    04E98 E880      LDI	R24,0x80
    04E99 E098      LDI	R25,0x8
    04E9A 015C      MOVW	R10,R24
    04E9B E040      LDI	R20,0
    04E9C E050      LDI	R21,0
    04E9D E060      LDI	R22,0
    04E9E E070      LDI	R23,0
    04E9F 8428      LDD	R2,Y+8
    04EA0 8439      LDD	R3,Y+9
    04EA1 844A      LDD	R4,Y+10
    04EA2 845B      LDD	R5,Y+11
    04EA3 1624      CP	R2,R20
    04EA4 0635      CPC	R3,R21
    04EA5 0646      CPC	R4,R22
    04EA6 0657      CPC	R5,R23
    04EA7 F424      BGE	0x4EAC
    04EA8 E28D      LDI	R24,0x2D
    04EA9 01F5      MOVW	R30,R10
    04EAA 9381      ST	Z+,R24
    04EAB 015F      MOVW	R10,R30
    04EAC 842C      LDD	R2,Y+12
    04EAD 843D      LDD	R3,Y+13
    04EAE 844E      LDD	R4,Y+14
    04EAF 845F      LDD	R5,Y+15
    04EB0 9488      BCLR	0
    04EB1 2022      TST	R2
    04EB2 0432      CPC	R3,R2
    04EB3 0442      CPC	R4,R2
    04EB4 0452      CPC	R5,R2
    04EB5 F429      BNE	0x4EBB
    04EB6 E380      LDI	R24,0x30
    04EB7 01F5      MOVW	R30,R10
    04EB8 9381      ST	Z+,R24
    04EB9 015F      MOVW	R10,R30
    04EBA C016      RJMP	0x4ED1
    04EBB E08A      LDI	R24,0xA
    04EBC E090      LDI	R25,0
    04EBD 839B      STD	Y+3,R25
    04EBE 838A      STD	Y+2,R24
    04EBF 842C      LDD	R2,Y+12
    04EC0 843D      LDD	R3,Y+13
    04EC1 844E      LDD	R4,Y+14
    04EC2 845F      LDD	R5,Y+15
    04EC3 8248      ST	Y,R4
    04EC4 8259      STD	Y+1,R5
    04EC5 0191      MOVW	R18,R2
    04EC6 0185      MOVW	R16,R10
    04EC7 940E 4C67 CALL	_ltoa
    04EC9 C003      RJMP	0x4ECD
    04ECA 01C5      MOVW	R24,R10
    04ECB 9601      ADIW	R24,1
    04ECC 015C      MOVW	R10,R24
    04ECD 01F5      MOVW	R30,R10
    04ECE 8020      LD	R2,Z
    04ECF 2022      TST	R2
    04ED0 F7C9      BNE	0x4ECA
    04ED1 E28E      LDI	R24,0x2E
    04ED2 01F5      MOVW	R30,R10
    04ED3 9381      ST	Z+,R24
    04ED4 015F      MOVW	R10,R30
    04ED5 802C      LDD	R2,Y+4
    04ED6 803D      LDD	R3,Y+5
    04ED7 804E      LDD	R4,Y+6
    04ED8 805F      LDD	R5,Y+7
    04ED9 9488      BCLR	0
    04EDA 2022      TST	R2
    04EDB 0432      CPC	R3,R2
    04EDC 0442      CPC	R4,R2
    04EDD 0452      CPC	R5,R2
    04EDE F421      BNE	0x4EE3
    04EDF E380      LDI	R24,0x30
    04EE0 9381      ST	Z+,R24
    04EE1 015F      MOVW	R10,R30
    04EE2 C068      RJMP	0x4F4B
    04EE3 E880      LDI	R24,0x80
    04EE4 E098      LDI	R25,0x8
    04EE5 0115      MOVW	R2,R10
    04EE6 1A28      SUB	R2,R24
    04EE7 0A39      SBC	R3,R25
    04EE8 E08F      LDI	R24,0xF
    04EE9 E090      LDI	R25,0
    04EEA 1982      SUB	R24,R2
    04EEB 0993      SBC	R25,R3
    04EEC 9701      SBIW	R24,1
    04EED 2EC8      MOV	R12,R24
    04EEE E087      LDI	R24,7
    04EEF 158C      CP	R24,R12
    04EF0 F408      BCC	0x4EF2
    04EF1 2EC8      MOV	R12,R24
    04EF2 24EE      CLR	R14
    04EF3 C042      RJMP	0x4F36
    04EF4 E083      LDI	R24,3
    04EF5 E090      LDI	R25,0
    04EF6 810C      LDD	R16,Y+4
    04EF7 811D      LDD	R17,Y+5
    04EF8 812E      LDD	R18,Y+6
    04EF9 813F      LDD	R19,Y+7
    04EFA 938A      ST	-Y,R24
    04EFB 940E 48D0 CALL	lsl32
    04EFD 0118      MOVW	R2,R16
    04EFE 0129      MOVW	R4,R18
    04EFF 806C      LDD	R6,Y+4
    04F00 807D      LDD	R7,Y+5
    04F01 808E      LDD	R8,Y+6
    04F02 809F      LDD	R9,Y+7
    04F03 0C66      LSL	R6
    04F04 1C77      ROL	R7
    04F05 1C88      ROL	R8
    04F06 1C99      ROL	R9
    04F07 0C26      ADD	R2,R6
    04F08 1C37      ADC	R3,R7
    04F09 1C48      ADC	R4,R8
    04F0A 1C59      ADC	R5,R9
    04F0B 822C      STD	Y+4,R2
    04F0C 823D      STD	Y+5,R3
    04F0D 824E      STD	Y+6,R4
    04F0E 825F      STD	Y+7,R5
    04F0F E188      LDI	R24,0x18
    04F10 E090      LDI	R25,0
    04F11 810C      LDD	R16,Y+4
    04F12 811D      LDD	R17,Y+5
    04F13 812E      LDD	R18,Y+6
    04F14 813F      LDD	R19,Y+7
    04F15 938A      ST	-Y,R24
    04F16 940E 4705 CALL	asr32
    04F18 0118      MOVW	R2,R16
    04F19 0129      MOVW	R4,R18
    04F1A E340      LDI	R20,0x30
    04F1B E050      LDI	R21,0
    04F1C E060      LDI	R22,0
    04F1D E070      LDI	R23,0
    04F1E 0E24      ADD	R2,R20
    04F1F 1E35      ADC	R3,R21
    04F20 1E46      ADC	R4,R22
    04F21 1E57      ADC	R5,R23
    04F22 01F5      MOVW	R30,R10
    04F23 9221      ST	Z+,R2
    04F24 015F      MOVW	R10,R30
    04F25 EF4F      LDI	R20,0xFF
    04F26 EF5F      LDI	R21,0xFF
    04F27 EF6F      LDI	R22,0xFF
    04F28 E070      LDI	R23,0
    04F29 802C      LDD	R2,Y+4
    04F2A 803D      LDD	R3,Y+5
    04F2B 804E      LDD	R4,Y+6
    04F2C 805F      LDD	R5,Y+7
    04F2D 2224      AND	R2,R20
    04F2E 2235      AND	R3,R21
    04F2F 2246      AND	R4,R22
    04F30 2257      AND	R5,R23
    04F31 822C      STD	Y+4,R2
    04F32 823D      STD	Y+5,R3
    04F33 824E      STD	Y+6,R4
    04F34 825F      STD	Y+7,R5
    04F35 94E3      INC	R14
    04F36 14EC      CP	R14,R12
    04F37 F408      BCC	0x4F39
    04F38 CFBB      RJMP	0x4EF4
    04F39 01C5      MOVW	R24,R10
    04F3A 9701      SBIW	R24,1
    04F3B 015C      MOVW	R10,R24
    04F3C C003      RJMP	0x4F40
    04F3D 01C5      MOVW	R24,R10
    04F3E 9701      SBIW	R24,1
    04F3F 015C      MOVW	R10,R24
    04F40 01F5      MOVW	R30,R10
    04F41 8180      LD	R24,Z
    04F42 3380      CPI	R24,0x30
    04F43 F421      BNE	0x4F48
    04F44 9731      SBIW	R30,1
    04F45 8180      LD	R24,Z
    04F46 328E      CPI	R24,0x2E
    04F47 F7A9      BNE	0x4F3D
    04F48 01C5      MOVW	R24,R10
    04F49 9601      ADIW	R24,1
    04F4A 015C      MOVW	R10,R24
    04F4B 2422      CLR	R2
    04F4C 01F5      MOVW	R30,R10
    04F4D 8220      ST	Z,R2
    04F4E E800      LDI	R16,0x80
    04F4F E018      LDI	R17,0x8
    04F50 9664      ADIW	R28,0x14
    04F51 940E 483A CALL	pop_xgsetF0FC
    04F53 9624      ADIW	R28,4
    04F54 9508      RET
_isdigit:
    04F55 EE8D      LDI	R24,0xED
    04F56 E090      LDI	R25,0
    04F57 01F8      MOVW	R30,R16
    04F58 0FE8      ADD	R30,R24
    04F59 1FF9      ADC	R31,R25
    04F5A 9106      ELPM	R16,Z
    04F5B 2711      CLR	R17
    04F5C 7004      ANDI	R16,4
    04F5D 7010      ANDI	R17,0
    04F5E 9508      RET
_islower:
    04F5F EE8D      LDI	R24,0xED
    04F60 E090      LDI	R25,0
    04F61 01F8      MOVW	R30,R16
    04F62 0FE8      ADD	R30,R24
    04F63 1FF9      ADC	R31,R25
    04F64 9106      ELPM	R16,Z
    04F65 2711      CLR	R17
    04F66 7002      ANDI	R16,2
    04F67 7010      ANDI	R17,0
    04F68 9508      RET
_isspace:
    04F69 EE8D      LDI	R24,0xED
    04F6A E090      LDI	R25,0
    04F6B 01F8      MOVW	R30,R16
    04F6C 0FE8      ADD	R30,R24
    04F6D 1FF9      ADC	R31,R25
    04F6E 9106      ELPM	R16,Z
    04F6F 2711      CLR	R17
    04F70 7100      ANDI	R16,0x10
    04F71 7010      ANDI	R17,0
    04F72 9508      RET
_toupper:
    04F73 934A      ST	-Y,R20
    04F74 935A      ST	-Y,R21
    04F75 01A8      MOVW	R20,R16
    04F76 018A      MOVW	R16,R20
    04F77 940E 4F5F CALL	_islower
    04F79 3000      CPI	R16,0
    04F7A 0701      CPC	R16,R17
    04F7B F031      BEQ	0x4F82
    04F7C 018A      MOVW	R16,R20
    04F7D 5601      SUBI	R16,0x61
    04F7E 4010      SBCI	R17,0
    04F7F 5B0F      SUBI	R16,0xBF
    04F80 4F1F      SBCI	R17,0xFF
    04F81 C001      RJMP	0x4F83
    04F82 018A      MOVW	R16,R20
    04F83 9159      LD	R21,Y+
    04F84 9149      LD	R20,Y+
    04F85 9508      RET
__sdepi:
    04F86 91E0 088F LDS	R30,config+60
    04F88 91F0 0890 LDS	R31,config+61
    04F8A 9301      ST	Z+,R16
    04F8B 93F0 0890 STS	config+61,R31
    04F8D 93E0 088F STS	config+60,R30
    04F8F 9508      RET
_sprintf:
    04F90 940E 4700 CALL	push_arg4
    04F92 92AA      ST	-Y,R10
    04F93 92BA      ST	-Y,R11
    04F94 9722      SBIW	R28,2
    04F95 802C      LDD	R2,Y+4
    04F96 803D      LDD	R3,Y+5
    04F97 9230 0890 STS	config+61,R3
    04F99 9220 088F STS	config+60,R2
    04F9B 01CE      MOVW	R24,R28
    04F9C 9608      ADIW	R24,0x8
    04F9D 015C      MOVW	R10,R24
    04F9E 82B9      STD	Y+1,R11
    04F9F 82A8      ST	Y,R10
    04FA0 812E      LDD	R18,Y+6
    04FA1 813F      LDD	R19,Y+7
    04FA2 E80C      LDI	R16,0x8C
    04FA3 E010      LDI	R17,0
    04FA4 940E 426F CALL	__print
    04FA6 2422      CLR	R2
    04FA7 91E0 088F LDS	R30,config+60
    04FA9 91F0 0890 LDS	R31,config+61
    04FAB 8220      ST	Z,R2
    04FAC 802C      LDD	R2,Y+4
    04FAD 803D      LDD	R3,Y+5
    04FAE 9100 088F LDS	R16,config+60
    04FB0 9110 0890 LDS	R17,config+61
    04FB2 1902      SUB	R16,R2
    04FB3 0913      SBC	R17,R3
    04FB4 9622      ADIW	R28,2
    04FB5 90B9      LD	R11,Y+
    04FB6 90A9      LD	R10,Y+
    04FB7 9624      ADIW	R28,4
    04FB8 9508      RET
    04FB9 940E 4864 CALL	push_xgsetF00C
    04FBB 01B9      MOVW	R22,R18
    04FBC 0158      MOVW	R10,R16
    04FBD 3F6E      CPI	R22,0xFE
    04FBE EFEF      LDI	R30,0xFF
    04FBF 077E      CPC	R23,R30
    04FC0 F419      BNE	0x4FC4
    04FC1 EE4D      LDI	R20,0xED
    04FC2 E051      LDI	R21,1
    04FC3 C009      RJMP	0x4FCD
    04FC4 3F6F      CPI	R22,0xFF
    04FC5 EFEF      LDI	R30,0xFF
    04FC6 077E      CPC	R23,R30
    04FC7 F419      BNE	0x4FCB
    04FC8 E048      LDI	R20,0x8
    04FC9 E052      LDI	R21,2
    04FCA C002      RJMP	0x4FCD
    04FCB E245      LDI	R20,0x25
    04FCC E052      LDI	R21,2
    04FCD 019A      MOVW	R18,R20
    04FCE 0185      MOVW	R16,R10
    04FCF 940E 4B9F CALL	_cstrcpy
    04FD1 0185      MOVW	R16,R10
    04FD2 940C 486B JMP	pop_xgsetF00C
__FormatFP_1:
    04FD4 940E 4700 CALL	push_arg4
    04FD6 940E 4845 CALL	push_xgsetF0FC
    04FD8 01B9      MOVW	R22,R18
    04FD9 97A2      SBIW	R28,0x22
    04FDA EF8F      LDI	R24,0xFF
    04FDB EF9F      LDI	R25,0xFF
    04FDC 015C      MOVW	R10,R24
    04FDD 879F      STD	Y+15,R25
    04FDE 878E      STD	Y+14,R24
    04FDF 8B9B      STD	Y+19,R25
    04FE0 8B8A      STD	Y+18,R24
    04FE1 8B99      STD	Y+17,R25
    04FE2 8B88      STD	Y+16,R24
    04FE3 8F9E      STD	Y+30,R25
    04FE4 8F8D      STD	Y+29,R24
    04FE5 8B9E      STD	Y+22,R25
    04FE6 8B8D      STD	Y+21,R24
    04FE7 2400      CLR	R0
    04FE8 2411      CLR	R1
    04FE9 8E19      STD	Y+25,R1
    04FEA 8E08      STD	Y+24,R0
    04FEB 2799      CLR	R25
    04FEC A398      STD	Y+32,R25
    04FED 8F8F      STD	Y+31,R24
    04FEE 24EE      CLR	R14
    04FEF 24FF      CLR	R15
    04FF0 2744      CLR	R20
    04FF1 2755      CLR	R21
    04FF2 E280      LDI	R24,0x20
    04FF3 8B8F      STD	Y+23,R24
    04FF4 8F8C      STD	Y+28,R24
    04FF5 E685      LDI	R24,0x65
    04FF6 A389      STD	Y+33,R24
    04FF7 E184      LDI	R24,0x14
    04FF8 A80E      LDD	R0,Y+54
    04FF9 A81F      LDD	R1,Y+55
    04FFA 1580      CP	R24,R0
    04FFB 0591      CPC	R25,R1
    04FFC F414      BGE	0x4FFF
    04FFD AB9F      STD	Y+55,R25
    04FFE AB8E      STD	Y+54,R24
    04FFF E184      LDI	R24,0x14
    05000 E090      LDI	R25,0
    05001 AC08      LDD	R0,Y+56
    05002 AC19      LDD	R1,Y+57
    05003 1580      CP	R24,R0
    05004 0591      CPC	R25,R1
    05005 F414      BGE	0x5008
    05006 AF99      STD	Y+57,R25
    05007 AF88      STD	Y+56,R24
    05008 3060      CPI	R22,0
    05009 0767      CPC	R22,R23
    0500A F409      BNE	0x500C
    0500B C084      RJMP	0x5090
    0500C 3061      CPI	R22,1
    0500D E0E0      LDI	R30,0
    0500E 077E      CPC	R23,R30
    0500F F079      BEQ	0x501F
    05010 3062      CPI	R22,2
    05011 E0E0      LDI	R30,0
    05012 077E      CPC	R23,R30
    05013 F049      BEQ	0x501D
    05014 3063      CPI	R22,3
    05015 E0E0      LDI	R30,0
    05016 077E      CPC	R23,R30
    05017 F061      BEQ	0x5024
    05018 3064      CPI	R22,4
    05019 E0E0      LDI	R30,0
    0501A 077E      CPC	R23,R30
    0501B F031      BEQ	0x5022
    0501C C073      RJMP	0x5090
    0501D E485      LDI	R24,0x45
    0501E A389      STD	Y+33,R24
    0501F E041      LDI	R20,1
    05020 E050      LDI	R21,0
    05021 C06E      RJMP	0x5090
    05022 E485      LDI	R24,0x45
    05023 A389      STD	Y+33,R24
    05024 A828      LDD	R2,Y+48
    05025 A839      LDD	R3,Y+49
    05026 A84A      LDD	R4,Y+50
    05027 A85B      LDD	R5,Y+51
    05028 8628      STD	Y+8,R2
    05029 8639      STD	Y+9,R3
    0502A 864A      STD	Y+10,R4
    0502B 865B      STD	Y+11,R5
    0502C A828      LDD	R2,Y+48
    0502D A839      LDD	R3,Y+49
    0502E A84A      LDD	R4,Y+50
    0502F A85B      LDD	R5,Y+51
    05030 E506      LDI	R16,0x56
    05031 E012      LDI	R17,2
    05032 940E 47CD CALL	elpm32
    05034 933A      ST	-Y,R19
    05035 932A      ST	-Y,R18
    05036 931A      ST	-Y,R17
    05037 930A      ST	-Y,R16
    05038 0181      MOVW	R16,R2
    05039 0192      MOVW	R18,R4
    0503A 940E 4B93 CALL	fpcmp2
    0503C F474      BGE	0x504B
    0503D E502      LDI	R16,0x52
    0503E E012      LDI	R17,2
    0503F 940E 47CD CALL	elpm32
    05041 01CE      MOVW	R24,R28
    05042 96C0      ADIW	R24,0x30
    05043 939A      ST	-Y,R25
    05044 938A      ST	-Y,R24
    05045 940E 4B59 CALL	fpmule1
    05047 8708      STD	Y+8,R16
    05048 8719      STD	Y+9,R17
    05049 872A      STD	Y+10,R18
    0504A 873B      STD	Y+11,R19
    0504B E40E      LDI	R16,0x4E
    0504C E012      LDI	R17,2
    0504D 940E 47CD CALL	elpm32
    0504F 830A      STD	Y+2,R16
    05050 831B      STD	Y+3,R17
    05051 832C      STD	Y+4,R18
    05052 833D      STD	Y+5,R19
    05053 2400      CLR	R0
    05054 2411      CLR	R1
    05055 861D      STD	Y+13,R1
    05056 860C      STD	Y+12,R0
    05057 C013      RJMP	0x506B
    05058 E40A      LDI	R16,0x4A
    05059 E012      LDI	R17,2
    0505A 940E 47CD CALL	elpm32
    0505C 01CE      MOVW	R24,R28
    0505D 9602      ADIW	R24,2
    0505E 939A      ST	-Y,R25
    0505F 938A      ST	-Y,R24
    05060 940E 4B59 CALL	fpmule1
    05062 830A      STD	Y+2,R16
    05063 831B      STD	Y+3,R17
    05064 832C      STD	Y+4,R18
    05065 833D      STD	Y+5,R19
    05066 858C      LDD	R24,Y+12
    05067 859D      LDD	R25,Y+13
    05068 9601      ADIW	R24,1
    05069 879D      STD	Y+13,R25
    0506A 878C      STD	Y+12,R24
    0506B 840C      LDD	R0,Y+12
    0506C 841D      LDD	R1,Y+13
    0506D AD08      LDD	R16,Y+56
    0506E AD19      LDD	R17,Y+57
    0506F 1600      CP	R0,R16
    05070 0611      CPC	R1,R17
    05071 F334      BLT	0x5058
    05072 8428      LDD	R2,Y+8
    05073 8439      LDD	R3,Y+9
    05074 844A      LDD	R4,Y+10
    05075 845B      LDD	R5,Y+11
    05076 E406      LDI	R16,0x46
    05077 E012      LDI	R17,2
    05078 940E 47CD CALL	elpm32
    0507A 933A      ST	-Y,R19
    0507B 932A      ST	-Y,R18
    0507C 931A      ST	-Y,R17
    0507D 930A      ST	-Y,R16
    0507E 0181      MOVW	R16,R2
    0507F 0192      MOVW	R18,R4
    05080 940E 4B93 CALL	fpcmp2
    05082 F05C      BLT	0x508E
    05083 01CE      MOVW	R24,R28
    05084 9608      ADIW	R24,0x8
    05085 810A      LDD	R16,Y+2
    05086 811B      LDD	R17,Y+3
    05087 812C      LDD	R18,Y+4
    05088 813D      LDD	R19,Y+5
    05089 939A      ST	-Y,R25
    0508A 938A      ST	-Y,R24
    0508B 940E 4B88 CALL	fpcmp1
    0508D F414      BGE	0x5090
    0508E E041      LDI	R20,1
    0508F E050      LDI	R21,0
    05090 A80C      LDD	R0,Y+52
    05091 A81D      LDD	R1,Y+53
    05092 FE04      SBRS	R0,4
    05093 C002      RJMP	0x5096
    05094 E380      LDI	R24,0x30
    05095 8B8F      STD	Y+23,R24
    05096 880F      LDD	R0,Y+23
    05097 8A0C      STD	Y+20,R0
    05098 A80C      LDD	R0,Y+52
    05099 A81D      LDD	R1,Y+53
    0509A FE03      SBRS	R0,3
    0509B C002      RJMP	0x509E
    0509C E28B      LDI	R24,0x2B
    0509D 8B8C      STD	Y+20,R24
    0509E 3040      CPI	R20,0
    0509F 0745      CPC	R20,R21
    050A0 F061      BEQ	0x50AD
    050A1 01CE      MOVW	R24,R28
    050A2 9606      ADIW	R24,6
    050A3 8399      STD	Y+1,R25
    050A4 8388      ST	Y,R24
    050A5 A908      LDD	R16,Y+48
    050A6 A919      LDD	R17,Y+49
    050A7 A92A      LDD	R18,Y+50
    050A8 A93B      LDD	R19,Y+51
    050A9 940E 4DC6 CALL	_ftoa
    050AB 01B8      MOVW	R22,R16
    050AC C062      RJMP	0x510F
    050AD E402      LDI	R16,0x42
    050AE E012      LDI	R17,2
    050AF 940E 47CD CALL	elpm32
    050B1 830A      STD	Y+2,R16
    050B2 831B      STD	Y+3,R17
    050B3 832C      STD	Y+4,R18
    050B4 833D      STD	Y+5,R19
    050B5 2400      CLR	R0
    050B6 2411      CLR	R1
    050B7 861D      STD	Y+13,R1
    050B8 860C      STD	Y+12,R0
    050B9 C019      RJMP	0x50D3
    050BA 802A      LDD	R2,Y+2
    050BB 803B      LDD	R3,Y+3
    050BC 804C      LDD	R4,Y+4
    050BD 805D      LDD	R5,Y+5
    050BE E40A      LDI	R16,0x4A
    050BF E012      LDI	R17,2
    050C0 940E 47CD CALL	elpm32
    050C2 933A      ST	-Y,R19
    050C3 932A      ST	-Y,R18
    050C4 931A      ST	-Y,R17
    050C5 930A      ST	-Y,R16
    050C6 0181      MOVW	R16,R2
    050C7 0192      MOVW	R18,R4
    050C8 940E 49E9 CALL	fpdiv2
    050CA 830A      STD	Y+2,R16
    050CB 831B      STD	Y+3,R17
    050CC 832C      STD	Y+4,R18
    050CD 833D      STD	Y+5,R19
    050CE 858C      LDD	R24,Y+12
    050CF 859D      LDD	R25,Y+13
    050D0 9601      ADIW	R24,1
    050D1 879D      STD	Y+13,R25
    050D2 878C      STD	Y+12,R24
    050D3 840C      LDD	R0,Y+12
    050D4 841D      LDD	R1,Y+13
    050D5 AD08      LDD	R16,Y+56
    050D6 AD19      LDD	R17,Y+57
    050D7 1600      CP	R0,R16
    050D8 0611      CPC	R1,R17
    050D9 F304      BLT	0x50BA
    050DA A828      LDD	R2,Y+48
    050DB A839      LDD	R3,Y+49
    050DC A84A      LDD	R4,Y+50
    050DD A85B      LDD	R5,Y+51
    050DE E506      LDI	R16,0x56
    050DF E012      LDI	R17,2
    050E0 940E 47CD CALL	elpm32
    050E2 933A      ST	-Y,R19
    050E3 932A      ST	-Y,R18
    050E4 931A      ST	-Y,R17
    050E5 930A      ST	-Y,R16
    050E6 0181      MOVW	R16,R2
    050E7 0192      MOVW	R18,R4
    050E8 940E 4B93 CALL	fpcmp2
    050EA F494      BGE	0x50FD
    050EB 01CE      MOVW	R24,R28
    050EC 9606      ADIW	R24,6
    050ED 8399      STD	Y+1,R25
    050EE 8388      ST	Y,R24
    050EF A908      LDD	R16,Y+48
    050F0 A919      LDD	R17,Y+49
    050F1 A92A      LDD	R18,Y+50
    050F2 A93B      LDD	R19,Y+51
    050F3 01CE      MOVW	R24,R28
    050F4 9602      ADIW	R24,2
    050F5 939A      ST	-Y,R25
    050F6 938A      ST	-Y,R24
    050F7 940E 498C CALL	fpsub1
    050F9 940E 4DC6 CALL	_ftoa
    050FB 01B8      MOVW	R22,R16
    050FC C012      RJMP	0x510F
    050FD 01CE      MOVW	R24,R28
    050FE 9606      ADIW	R24,6
    050FF 8399      STD	Y+1,R25
    05100 8388      ST	Y,R24
    05101 A908      LDD	R16,Y+48
    05102 A919      LDD	R17,Y+49
    05103 A92A      LDD	R18,Y+50
    05104 A93B      LDD	R19,Y+51
    05105 01CE      MOVW	R24,R28
    05106 9602      ADIW	R24,2
    05107 939A      ST	-Y,R25
    05108 938A      ST	-Y,R24
    05109 940E 4977 CALL	fpadd1
    0510B 940E 4DC6 CALL	_ftoa
    0510D 0168      MOVW	R12,R16
    0510E 01B6      MOVW	R22,R12
    0510F 802E      LDD	R2,Y+6
    05110 803F      LDD	R3,Y+7
    05111 2022      TST	R2
    05112 F411      BNE	0x5115
    05113 2033      TST	R3
    05114 F031      BEQ	0x511B
    05115 0191      MOVW	R18,R2
    05116 A50C      LDD	R16,Y+44
    05117 A51D      LDD	R17,Y+45
    05118 DEA0      RCALL	0x4FB9
    05119 0168      MOVW	R12,R16
    0511A C39E      RJMP	0x54B9
    0511B 2400      CLR	R0
    0511C 2411      CLR	R1
    0511D 861D      STD	Y+13,R1
    0511E 860C      STD	Y+12,R0
    0511F 3040      CPI	R20,0
    05120 0745      CPC	R20,R21
    05121 F481      BNE	0x5132
    05122 858E      LDD	R24,Y+14
    05123 859F      LDD	R25,Y+15
    05124 3080      CPI	R24,0
    05125 E0E0      LDI	R30,0
    05126 079E      CPC	R25,R30
    05127 F054      BLT	0x5132
    05128 842C      LDD	R2,Y+12
    05129 843D      LDD	R3,Y+13
    0512A 1A28      SUB	R2,R24
    0512B 0A39      SBC	R3,R25
    0512C AC08      LDD	R0,Y+56
    0512D AC19      LDD	R1,Y+57
    0512E 1402      CP	R0,R2
    0512F 0413      CPC	R1,R3
    05130 F40C      BGE	0x5132
    05131 C060      RJMP	0x5192
    05132 85EC      LDD	R30,Y+12
    05133 85FD      LDD	R31,Y+13
    05134 0FE6      ADD	R30,R22
    05135 1FF7      ADC	R31,R23
    05136 80C0      LD	R12,Z
    05137 2D8C      MOV	R24,R12
    05138 3380      CPI	R24,0x30
    05139 F1E0      BCS	0x5176
    0513A E389      LDI	R24,0x39
    0513B 158C      CP	R24,R12
    0513C F1C8      BCS	0x5176
    0513D 84AC      LDD	R10,Y+12
    0513E 84BD      LDD	R11,Y+13
    0513F E380      LDI	R24,0x30
    05140 158C      CP	R24,R12
    05141 F448      BCC	0x514B
    05142 8D8D      LDD	R24,Y+29
    05143 8D9E      LDD	R25,Y+30
    05144 3080      CPI	R24,0
    05145 E0E0      LDI	R30,0
    05146 079E      CPC	R25,R30
    05147 F41C      BGE	0x514B
    05148 0105      MOVW	R0,R10
    05149 8E1E      STD	Y+30,R1
    0514A 8E0D      STD	Y+29,R0
    0514B 858E      LDD	R24,Y+14
    0514C 859F      LDD	R25,Y+15
    0514D 3080      CPI	R24,0
    0514E E0E0      LDI	R30,0
    0514F 079E      CPC	R25,R30
    05150 F4C4      BGE	0x5169
    05151 8988      LDD	R24,Y+16
    05152 8999      LDD	R25,Y+17
    05153 3080      CPI	R24,0
    05154 E0E0      LDI	R30,0
    05155 079E      CPC	R25,R30
    05156 F43C      BGE	0x515E
    05157 E380      LDI	R24,0x30
    05158 158C      CP	R24,R12
    05159 F420      BCC	0x515E
    0515A 840C      LDD	R0,Y+12
    0515B 841D      LDD	R1,Y+13
    0515C 8A19      STD	Y+17,R1
    0515D 8A08      STD	Y+16,R0
    0515E 8988      LDD	R24,Y+16
    0515F 8999      LDD	R25,Y+17
    05160 3080      CPI	R24,0
    05161 E0E0      LDI	R30,0
    05162 079E      CPC	R25,R30
    05163 F02C      BLT	0x5169
    05164 8D88      LDD	R24,Y+24
    05165 8D99      LDD	R25,Y+25
    05166 9601      ADIW	R24,1
    05167 8F99      STD	Y+25,R25
    05168 8F88      STD	Y+24,R24
    05169 858E      LDD	R24,Y+14
    0516A 859F      LDD	R25,Y+15
    0516B 3080      CPI	R24,0
    0516C E0E0      LDI	R30,0
    0516D 079E      CPC	R25,R30
    0516E F03C      BLT	0x5176
    0516F E380      LDI	R24,0x30
    05170 158C      CP	R24,R12
    05171 F420      BCC	0x5176
    05172 840C      LDD	R0,Y+12
    05173 841D      LDD	R1,Y+13
    05174 8A1E      STD	Y+22,R1
    05175 8A0D      STD	Y+21,R0
    05176 2D8C      MOV	R24,R12
    05177 328E      CPI	R24,0x2E
    05178 F421      BNE	0x517D
    05179 840C      LDD	R0,Y+12
    0517A 841D      LDD	R1,Y+13
    0517B 861F      STD	Y+15,R1
    0517C 860E      STD	Y+14,R0
    0517D 2D8C      MOV	R24,R12
    0517E 328D      CPI	R24,0x2D
    0517F F429      BNE	0x5185
    05180 E081      LDI	R24,1
    05181 E090      LDI	R25,0
    05182 017C      MOVW	R14,R24
    05183 E28D      LDI	R24,0x2D
    05184 8B8C      STD	Y+20,R24
    05185 20CC      TST	R12
    05186 F409      BNE	0x5188
    05187 C00A      RJMP	0x5192
    05188 858C      LDD	R24,Y+12
    05189 859D      LDD	R25,Y+13
    0518A 9601      ADIW	R24,1
    0518B 879D      STD	Y+13,R25
    0518C 878C      STD	Y+12,R24
    0518D 3184      CPI	R24,0x14
    0518E E0E0      LDI	R30,0
    0518F 079E      CPC	R25,R30
    05190 F40C      BGE	0x5192
    05191 CF8D      RJMP	0x511F
    05192 858E      LDD	R24,Y+14
    05193 859F      LDD	R25,Y+15
    05194 3080      CPI	R24,0
    05195 E0E0      LDI	R30,0
    05196 079E      CPC	R25,R30
    05197 F43C      BGE	0x519F
    05198 01C5      MOVW	R24,R10
    05199 9601      ADIW	R24,1
    0519A 8B9B      STD	Y+19,R25
    0519B 8B8A      STD	Y+18,R24
    0519C 9601      ADIW	R24,1
    0519D 015C      MOVW	R10,R24
    0519E C012      RJMP	0x51B1
    0519F 840E      LDD	R0,Y+14
    051A0 841F      LDD	R1,Y+15
    051A1 8A1B      STD	Y+19,R1
    051A2 8A0A      STD	Y+18,R0
    051A3 898D      LDD	R24,Y+21
    051A4 899E      LDD	R25,Y+22
    051A5 3080      CPI	R24,0
    051A6 E0E0      LDI	R30,0
    051A7 079E      CPC	R25,R30
    051A8 F424      BGE	0x51AD
    051A9 01C0      MOVW	R24,R0
    051AA 9601      ADIW	R24,1
    051AB 015C      MOVW	R10,R24
    051AC C004      RJMP	0x51B1
    051AD 898D      LDD	R24,Y+21
    051AE 899E      LDD	R25,Y+22
    051AF 9601      ADIW	R24,1
    051B0 015C      MOVW	R10,R24
    051B1 8988      LDD	R24,Y+16
    051B2 8999      LDD	R25,Y+17
    051B3 3080      CPI	R24,0
    051B4 E0E0      LDI	R30,0
    051B5 079E      CPC	R25,R30
    051B6 F42C      BGE	0x51BC
    051B7 898A      LDD	R24,Y+18
    051B8 899B      LDD	R25,Y+19
    051B9 9701      SBIW	R24,1
    051BA 8B99      STD	Y+17,R25
    051BB 8B88      STD	Y+16,R24
    051BC 3040      CPI	R20,0
    051BD 0745      CPC	R20,R21
    051BE F409      BNE	0x51C0
    051BF C1D2      RJMP	0x5392
    051C0 2400      CLR	R0
    051C1 2411      CLR	R1
    051C2 861D      STD	Y+13,R1
    051C3 860C      STD	Y+12,R0
    051C4 880C      LDD	R0,Y+20
    051C5 890F      LDD	R16,Y+23
    051C6 1600      CP	R0,R16
    051C7 F069      BEQ	0x51D5
    051C8 854C      LDD	R20,Y+12
    051C9 855D      LDD	R21,Y+13
    051CA 01CA      MOVW	R24,R20
    051CB 9601      ADIW	R24,1
    051CC 879D      STD	Y+13,R25
    051CD 878C      STD	Y+12,R24
    051CE 01FA      MOVW	R30,R20
    051CF A40C      LDD	R0,Y+44
    051D0 A41D      LDD	R1,Y+45
    051D1 0DE0      ADD	R30,R0
    051D2 1DF1      ADC	R31,R1
    051D3 880C      LDD	R0,Y+20
    051D4 8200      ST	Z,R0
    051D5 854C      LDD	R20,Y+12
    051D6 855D      LDD	R21,Y+13
    051D7 01CA      MOVW	R24,R20
    051D8 9601      ADIW	R24,1
    051D9 879D      STD	Y+13,R25
    051DA 878C      STD	Y+12,R24
    051DB 8DED      LDD	R30,Y+29
    051DC 8DFE      LDD	R31,Y+30
    051DD 0FE6      ADD	R30,R22
    051DE 1FF7      ADC	R31,R23
    051DF 8020      LD	R2,Z
    051E0 01FA      MOVW	R30,R20
    051E1 A40C      LDD	R0,Y+44
    051E2 A41D      LDD	R1,Y+45
    051E3 0DE0      ADD	R30,R0
    051E4 1DF1      ADC	R31,R1
    051E5 8220      ST	Z,R2
    051E6 01FC      MOVW	R30,R24
    051E7 0DE0      ADD	R30,R0
    051E8 1DF1      ADC	R31,R1
    051E9 E28E      LDI	R24,0x2E
    051EA 8380      ST	Z,R24
    051EB 2422      CLR	R2
    051EC 2433      CLR	R3
    051ED AC08      LDD	R0,Y+56
    051EE AC19      LDD	R1,Y+57
    051EF 1420      CP	R2,R0
    051F0 0431      CPC	R3,R1
    051F1 F42C      BGE	0x51F7
    051F2 858C      LDD	R24,Y+12
    051F3 859D      LDD	R25,Y+13
    051F4 9601      ADIW	R24,1
    051F5 879D      STD	Y+13,R25
    051F6 878C      STD	Y+12,R24
    051F7 8D4D      LDD	R20,Y+29
    051F8 8D5E      LDD	R21,Y+30
    051F9 5F4F      SUBI	R20,0xFF
    051FA 4F5F      SBCI	R21,0xFF
    051FB 24CC      CLR	R12
    051FC 24DD      CLR	R13
    051FD C034      RJMP	0x5232
    051FE 880A      LDD	R0,Y+18
    051FF 881B      LDD	R1,Y+19
    05200 1540      CP	R20,R0
    05201 0551      CPC	R21,R1
    05202 F409      BNE	0x5204
    05203 C02C      RJMP	0x5230
    05204 154A      CP	R20,R10
    05205 055B      CPC	R21,R11
    05206 F48C      BGE	0x5218
    05207 84EC      LDD	R14,Y+12
    05208 84FD      LDD	R15,Y+13
    05209 01C7      MOVW	R24,R14
    0520A 9601      ADIW	R24,1
    0520B 879D      STD	Y+13,R25
    0520C 878C      STD	Y+12,R24
    0520D 01FA      MOVW	R30,R20
    0520E 0FE6      ADD	R30,R22
    0520F 1FF7      ADC	R31,R23
    05210 8020      LD	R2,Z
    05211 01F7      MOVW	R30,R14
    05212 A40C      LDD	R0,Y+44
    05213 A41D      LDD	R1,Y+45
    05214 0DE0      ADD	R30,R0
    05215 1DF1      ADC	R31,R1
    05216 8220      ST	Z,R2
    05217 C015      RJMP	0x522D
    05218 A80C      LDD	R0,Y+52
    05219 A81D      LDD	R1,Y+53
    0521A FC00      SBRC	R0,0
    0521B C004      RJMP	0x5220
    0521C 20CC      TST	R12
    0521D F501      BNE	0x523E
    0521E 20DD      TST	R13
    0521F F4F1      BNE	0x523E
    05220 84EC      LDD	R14,Y+12
    05221 84FD      LDD	R15,Y+13
    05222 01C7      MOVW	R24,R14
    05223 9601      ADIW	R24,1
    05224 879D      STD	Y+13,R25
    05225 878C      STD	Y+12,R24
    05226 01F7      MOVW	R30,R14
    05227 A40C      LDD	R0,Y+44
    05228 A41D      LDD	R1,Y+45
    05229 0DE0      ADD	R30,R0
    0522A 1DF1      ADC	R31,R1
    0522B E380      LDI	R24,0x30
    0522C 8380      ST	Z,R24
    0522D 01C6      MOVW	R24,R12
    0522E 9601      ADIW	R24,1
    0522F 016C      MOVW	R12,R24
    05230 5F4F      SUBI	R20,0xFF
    05231 4F5F      SBCI	R21,0xFF
    05232 AC08      LDD	R0,Y+56
    05233 AC19      LDD	R1,Y+57
    05234 14C0      CP	R12,R0
    05235 04D1      CPC	R13,R1
    05236 F43C      BGE	0x523E
    05237 858C      LDD	R24,Y+12
    05238 859D      LDD	R25,Y+13
    05239 308E      CPI	R24,0xE
    0523A E0E0      LDI	R30,0
    0523B 079E      CPC	R25,R30
    0523C F40C      BGE	0x523E
    0523D CFC0      RJMP	0x51FE
    0523E 858C      LDD	R24,Y+12
    0523F 859D      LDD	R25,Y+13
    05240 9701      SBIW	R24,1
    05241 016C      MOVW	R12,R24
    05242 AC08      LDD	R0,Y+56
    05243 AC19      LDD	R1,Y+57
    05244 2000      TST	R0
    05245 F421      BNE	0x524A
    05246 2011      TST	R1
    05247 F411      BNE	0x524A
    05248 84CC      LDD	R12,Y+12
    05249 84DD      LDD	R13,Y+13
    0524A 898A      LDD	R24,Y+18
    0524B 899B      LDD	R25,Y+19
    0524C 8C0D      LDD	R0,Y+29
    0524D 8C1E      LDD	R1,Y+30
    0524E 1980      SUB	R24,R0
    0524F 0991      SBC	R25,R1
    05250 9701      SBIW	R24,1
    05251 A398      STD	Y+32,R25
    05252 8F8F      STD	Y+31,R24
    05253 154A      CP	R20,R10
    05254 055B      CPC	R21,R11
    05255 F444      BGE	0x525E
    05256 01FA      MOVW	R30,R20
    05257 0FE6      ADD	R30,R22
    05258 1FF7      ADC	R31,R23
    05259 8180      LD	R24,Z
    0525A 328E      CPI	R24,0x2E
    0525B F411      BNE	0x525E
    0525C 5F4F      SUBI	R20,0xFF
    0525D 4F5F      SBCI	R21,0xFF
    0525E 154A      CP	R20,R10
    0525F 055B      CPC	R21,R11
    05260 F00C      BLT	0x5262
    05261 C06B      RJMP	0x52CD
    05262 01FA      MOVW	R30,R20
    05263 0FE6      ADD	R30,R22
    05264 1FF7      ADC	R31,R23
    05265 80E0      LD	R14,Z
    05266 24FF      CLR	R15
    05267 2D8E      MOV	R24,R14
    05268 3385      CPI	R24,0x35
    05269 F408      BCC	0x526B
    0526A C062      RJMP	0x52CD
    0526B E389      LDI	R24,0x39
    0526C 158E      CP	R24,R14
    0526D F408      BCC	0x526F
    0526E C05E      RJMP	0x52CD
    0526F C057      RJMP	0x52C7
    05270 01F6      MOVW	R30,R12
    05271 A40C      LDD	R0,Y+44
    05272 A41D      LDD	R1,Y+45
    05273 0DE0      ADD	R30,R0
    05274 1DF1      ADC	R31,R1
    05275 80E0      LD	R14,Z
    05276 24FF      CLR	R15
    05277 2D8E      MOV	R24,R14
    05278 3380      CPI	R24,0x30
    05279 F058      BCS	0x5285
    0527A E388      LDI	R24,0x38
    0527B 158E      CP	R24,R14
    0527C F040      BCS	0x5285
    0527D 0176      MOVW	R14,R12
    0527E 0CE0      ADD	R14,R0
    0527F 1CF1      ADC	R15,R1
    05280 01F7      MOVW	R30,R14
    05281 8180      LD	R24,Z
    05282 5F8F      SUBI	R24,0xFF
    05283 8380      ST	Z,R24
    05284 C048      RJMP	0x52CD
    05285 01F6      MOVW	R30,R12
    05286 A40C      LDD	R0,Y+44
    05287 A41D      LDD	R1,Y+45
    05288 0DE0      ADD	R30,R0
    05289 1DF1      ADC	R31,R1
    0528A 8180      LD	R24,Z
    0528B 328E      CPI	R24,0x2E
    0528C F009      BEQ	0x528E
    0528D C029      RJMP	0x52B7
    0528E 01C6      MOVW	R24,R12
    0528F 9701      SBIW	R24,1
    05290 016C      MOVW	R12,R24
    05291 01FC      MOVW	R30,R24
    05292 0DE0      ADD	R30,R0
    05293 1DF1      ADC	R31,R1
    05294 80E0      LD	R14,Z
    05295 24FF      CLR	R15
    05296 2D8E      MOV	R24,R14
    05297 3380      CPI	R24,0x30
    05298 F058      BCS	0x52A4
    05299 E388      LDI	R24,0x38
    0529A 158E      CP	R24,R14
    0529B F040      BCS	0x52A4
    0529C 0176      MOVW	R14,R12
    0529D 0CE0      ADD	R14,R0
    0529E 1CF1      ADC	R15,R1
    0529F 01F7      MOVW	R30,R14
    052A0 8180      LD	R24,Z
    052A1 5F8F      SUBI	R24,0xFF
    052A2 8380      ST	Z,R24
    052A3 C029      RJMP	0x52CD
    052A4 01F6      MOVW	R30,R12
    052A5 A40C      LDD	R0,Y+44
    052A6 A41D      LDD	R1,Y+45
    052A7 0DE0      ADD	R30,R0
    052A8 1DF1      ADC	R31,R1
    052A9 8180      LD	R24,Z
    052AA 3389      CPI	R24,0x39
    052AB F459      BNE	0x52B7
    052AC 01F6      MOVW	R30,R12
    052AD 0DE0      ADD	R30,R0
    052AE 1DF1      ADC	R31,R1
    052AF E381      LDI	R24,0x31
    052B0 8380      ST	Z,R24
    052B1 8D8F      LDD	R24,Y+31
    052B2 A198      LDD	R25,Y+32
    052B3 9601      ADIW	R24,1
    052B4 A398      STD	Y+32,R25
    052B5 8F8F      STD	Y+31,R24
    052B6 C016      RJMP	0x52CD
    052B7 01F6      MOVW	R30,R12
    052B8 A40C      LDD	R0,Y+44
    052B9 A41D      LDD	R1,Y+45
    052BA 0DE0      ADD	R30,R0
    052BB 1DF1      ADC	R31,R1
    052BC 8180      LD	R24,Z
    052BD 3389      CPI	R24,0x39
    052BE F429      BNE	0x52C4
    052BF 01F6      MOVW	R30,R12
    052C0 0DE0      ADD	R30,R0
    052C1 1DF1      ADC	R31,R1
    052C2 E380      LDI	R24,0x30
    052C3 8380      ST	Z,R24
    052C4 01C6      MOVW	R24,R12
    052C5 9701      SBIW	R24,1
    052C6 016C      MOVW	R12,R24
    052C7 01C6      MOVW	R24,R12
    052C8 3080      CPI	R24,0
    052C9 E0E0      LDI	R30,0
    052CA 079E      CPC	R25,R30
    052CB F00C      BLT	0x52CD
    052CC CFA3      RJMP	0x5270
    052CD 84CC      LDD	R12,Y+12
    052CE 84DD      LDD	R13,Y+13
    052CF 01C6      MOVW	R24,R12
    052D0 9601      ADIW	R24,1
    052D1 879D      STD	Y+13,R25
    052D2 878C      STD	Y+12,R24
    052D3 01F6      MOVW	R30,R12
    052D4 A40C      LDD	R0,Y+44
    052D5 A41D      LDD	R1,Y+45
    052D6 0DE0      ADD	R30,R0
    052D7 1DF1      ADC	R31,R1
    052D8 A009      LDD	R0,Y+33
    052D9 8200      ST	Z,R0
    052DA 8D8F      LDD	R24,Y+31
    052DB A198      LDD	R25,Y+32
    052DC 3080      CPI	R24,0
    052DD E0E0      LDI	R30,0
    052DE 079E      CPC	R25,R30
    052DF F49C      BGE	0x52F3
    052E0 84CC      LDD	R12,Y+12
    052E1 84DD      LDD	R13,Y+13
    052E2 01C6      MOVW	R24,R12
    052E3 9601      ADIW	R24,1
    052E4 879D      STD	Y+13,R25
    052E5 878C      STD	Y+12,R24
    052E6 01F6      MOVW	R30,R12
    052E7 A40C      LDD	R0,Y+44
    052E8 A41D      LDD	R1,Y+45
    052E9 0DE0      ADD	R30,R0
    052EA 1DF1      ADC	R31,R1
    052EB E28D      LDI	R24,0x2D
    052EC 8380      ST	Z,R24
    052ED 8C0F      LDD	R0,Y+31
    052EE A018      LDD	R1,Y+32
    052EF 9400      COM	R0
    052F0 9410      COM	R1
    052F1 A218      STD	Y+32,R1
    052F2 8E0F      STD	Y+31,R0
    052F3 E08A      LDI	R24,0xA
    052F4 E090      LDI	R25,0
    052F5 8399      STD	Y+1,R25
    052F6 8388      ST	Y,R24
    052F7 8D2F      LDD	R18,Y+31
    052F8 A138      LDD	R19,Y+32
    052F9 850C      LDD	R16,Y+12
    052FA 851D      LDD	R17,Y+13
    052FB A40C      LDD	R0,Y+44
    052FC A41D      LDD	R1,Y+45
    052FD 0D00      ADD	R16,R0
    052FE 1D11      ADC	R17,R1
    052FF 940E 4BFC CALL	_itoa
    05301 2400      CLR	R0
    05302 2411      CLR	R1
    05303 861D      STD	Y+13,R1
    05304 860C      STD	Y+12,R0
    05305 85EC      LDD	R30,Y+12
    05306 85FD      LDD	R31,Y+13
    05307 A40C      LDD	R0,Y+44
    05308 A41D      LDD	R1,Y+45
    05309 0DE0      ADD	R30,R0
    0530A 1DF1      ADC	R31,R1
    0530B 8020      LD	R2,Z
    0530C 2022      TST	R2
    0530D F429      BNE	0x5313
    0530E 840C      LDD	R0,Y+12
    0530F 841D      LDD	R1,Y+13
    05310 8E1B      STD	Y+27,R1
    05311 8E0A      STD	Y+26,R0
    05312 C009      RJMP	0x531C
    05313 858C      LDD	R24,Y+12
    05314 859D      LDD	R25,Y+13
    05315 9601      ADIW	R24,1
    05316 879D      STD	Y+13,R25
    05317 878C      STD	Y+12,R24
    05318 3184      CPI	R24,0x14
    05319 E0E0      LDI	R30,0
    0531A 079E      CPC	R25,R30
    0531B F34C      BLT	0x5305
    0531C A80C      LDD	R0,Y+52
    0531D A81D      LDD	R1,Y+53
    0531E FE02      SBRS	R0,2
    0531F C021      RJMP	0x5341
    05320 8C0A      LDD	R0,Y+26
    05321 8C1B      LDD	R1,Y+27
    05322 A90E      LDD	R16,Y+54
    05323 A91F      LDD	R17,Y+55
    05324 1600      CP	R0,R16
    05325 0611      CPC	R1,R17
    05326 F00C      BLT	0x5328
    05327 C18F      RJMP	0x54B7
    05328 01A0      MOVW	R20,R0
    05329 C009      RJMP	0x5333
    0532A 01FA      MOVW	R30,R20
    0532B A40C      LDD	R0,Y+44
    0532C A41D      LDD	R1,Y+45
    0532D 0DE0      ADD	R30,R0
    0532E 1DF1      ADC	R31,R1
    0532F 8C0C      LDD	R0,Y+28
    05330 8200      ST	Z,R0
    05331 5F4F      SUBI	R20,0xFF
    05332 4F5F      SBCI	R21,0xFF
    05333 A80E      LDD	R0,Y+54
    05334 A81F      LDD	R1,Y+55
    05335 1540      CP	R20,R0
    05336 0551      CPC	R21,R1
    05337 F394      BLT	0x532A
    05338 01F0      MOVW	R30,R0
    05339 9731      SBIW	R30,1
    0533A A40C      LDD	R0,Y+44
    0533B A41D      LDD	R1,Y+45
    0533C 0DE0      ADD	R30,R0
    0533D 1DF1      ADC	R31,R1
    0533E 2422      CLR	R2
    0533F 8220      ST	Z,R2
    05340 C176      RJMP	0x54B7
    05341 8C0A      LDD	R0,Y+26
    05342 8C1B      LDD	R1,Y+27
    05343 A90E      LDD	R16,Y+54
    05344 A91F      LDD	R17,Y+55
    05345 1600      CP	R0,R16
    05346 0611      CPC	R1,R17
    05347 F00C      BLT	0x5349
    05348 C16E      RJMP	0x54B7
    05349 01A0      MOVW	R20,R0
    0534A C014      RJMP	0x535F
    0534B 01FA      MOVW	R30,R20
    0534C A80E      LDD	R0,Y+54
    0534D A81F      LDD	R1,Y+55
    0534E 0DE0      ADD	R30,R0
    0534F 1DF1      ADC	R31,R1
    05350 8C0A      LDD	R0,Y+26
    05351 8C1B      LDD	R1,Y+27
    05352 19E0      SUB	R30,R0
    05353 09F1      SBC	R31,R1
    05354 A40C      LDD	R0,Y+44
    05355 A41D      LDD	R1,Y+45
    05356 0DE0      ADD	R30,R0
    05357 1DF1      ADC	R31,R1
    05358 01DA      MOVW	R26,R20
    05359 0DA0      ADD	R26,R0
    0535A 1DB1      ADC	R27,R1
    0535B 902C      LD	R2,X
    0535C 8220      ST	Z,R2
    0535D 5041      SUBI	R20,1
    0535E 4050      SBCI	R21,0
    0535F 3040      CPI	R20,0
    05360 E0E0      LDI	R30,0
    05361 075E      CPC	R21,R30
    05362 F744      BGE	0x534B
    05363 A94E      LDD	R20,Y+54
    05364 A95F      LDD	R21,Y+55
    05365 8C0A      LDD	R0,Y+26
    05366 8C1B      LDD	R1,Y+27
    05367 1940      SUB	R20,R0
    05368 0951      SBC	R21,R1
    05369 5041      SUBI	R20,1
    0536A 4050      SBCI	R21,0
    0536B C009      RJMP	0x5375
    0536C 01FA      MOVW	R30,R20
    0536D A40C      LDD	R0,Y+44
    0536E A41D      LDD	R1,Y+45
    0536F 0DE0      ADD	R30,R0
    05370 1DF1      ADC	R31,R1
    05371 880F      LDD	R0,Y+23
    05372 8200      ST	Z,R0
    05373 5041      SUBI	R20,1
    05374 4050      SBCI	R21,0
    05375 3040      CPI	R20,0
    05376 E0E0      LDI	R30,0
    05377 075E      CPC	R21,R30
    05378 F79C      BGE	0x536C
    05379 A80C      LDD	R0,Y+52
    0537A A81D      LDD	R1,Y+53
    0537B FE04      SBRS	R0,4
    0537C C13A      RJMP	0x54B7
    0537D 880C      LDD	R0,Y+20
    0537E 890F      LDD	R16,Y+23
    0537F 1600      CP	R0,R16
    05380 F409      BNE	0x5382
    05381 C135      RJMP	0x54B7
    05382 A5EC      LDD	R30,Y+44
    05383 A5FD      LDD	R31,Y+45
    05384 8200      ST	Z,R0
    05385 A9EE      LDD	R30,Y+54
    05386 A9FF      LDD	R31,Y+55
    05387 8C0A      LDD	R0,Y+26
    05388 8C1B      LDD	R1,Y+27
    05389 19E0      SUB	R30,R0
    0538A 09F1      SBC	R31,R1
    0538B A40C      LDD	R0,Y+44
    0538C A41D      LDD	R1,Y+45
    0538D 0DE0      ADD	R30,R0
    0538E 1DF1      ADC	R31,R1
    0538F 2E00      MOV	R0,R16
    05390 8200      ST	Z,R0
    05391 C125      RJMP	0x54B7
    05392 A80C      LDD	R0,Y+52
    05393 A81D      LDD	R1,Y+53
    05394 FE00      SBRS	R0,0
    05395 C010      RJMP	0x53A6
    05396 882A      LDD	R2,Y+18
    05397 883B      LDD	R3,Y+19
    05398 AC08      LDD	R0,Y+56
    05399 AC19      LDD	R1,Y+57
    0539A 0C20      ADD	R2,R0
    0539B 1C31      ADC	R3,R1
    0539C 142A      CP	R2,R10
    0539D 043B      CPC	R3,R11
    0539E F07C      BLT	0x53AE
    0539F 898A      LDD	R24,Y+18
    053A0 899B      LDD	R25,Y+19
    053A1 0D80      ADD	R24,R0
    053A2 1D91      ADC	R25,R1
    053A3 9601      ADIW	R24,1
    053A4 015C      MOVW	R10,R24
    053A5 C008      RJMP	0x53AE
    053A6 898A      LDD	R24,Y+18
    053A7 899B      LDD	R25,Y+19
    053A8 9601      ADIW	R24,1
    053A9 16A8      CP	R10,R24
    053AA 06B9      CPC	R11,R25
    053AB F411      BNE	0x53AE
    053AC 88AA      LDD	R10,Y+18
    053AD 88BB      LDD	R11,Y+19
    053AE E184      LDI	R24,0x14
    053AF E090      LDI	R25,0
    053B0 158A      CP	R24,R10
    053B1 059B      CPC	R25,R11
    053B2 F40C      BGE	0x53B4
    053B3 015C      MOVW	R10,R24
    053B4 0115      MOVW	R2,R10
    053B5 8808      LDD	R0,Y+16
    053B6 8819      LDD	R1,Y+17
    053B7 1820      SUB	R2,R0
    053B8 0831      SBC	R3,R1
    053B9 8E3B      STD	Y+27,R3
    053BA 8E2A      STD	Y+26,R2
    053BB 880C      LDD	R0,Y+20
    053BC 890F      LDD	R16,Y+23
    053BD 1600      CP	R0,R16
    053BE F021      BEQ	0x53C3
    053BF 01C1      MOVW	R24,R2
    053C0 9601      ADIW	R24,1
    053C1 8F9B      STD	Y+27,R25
    053C2 8F8A      STD	Y+26,R24
    053C3 A80E      LDD	R0,Y+54
    053C4 A81F      LDD	R1,Y+55
    053C5 8D0A      LDD	R16,Y+26
    053C6 8D1B      LDD	R17,Y+27
    053C7 1600      CP	R0,R16
    053C8 0611      CPC	R1,R17
    053C9 F41C      BGE	0x53CD
    053CA 0108      MOVW	R0,R16
    053CB AA1F      STD	Y+55,R1
    053CC AA0E      STD	Y+54,R0
    053CD E184      LDI	R24,0x14
    053CE E090      LDI	R25,0
    053CF A80E      LDD	R0,Y+54
    053D0 A81F      LDD	R1,Y+55
    053D1 1580      CP	R24,R0
    053D2 0591      CPC	R25,R1
    053D3 F414      BGE	0x53D6
    053D4 AB9F      STD	Y+55,R25
    053D5 AB8E      STD	Y+54,R24
    053D6 E184      LDI	R24,0x14
    053D7 E090      LDI	R25,0
    053D8 8C0A      LDD	R0,Y+26
    053D9 8C1B      LDD	R1,Y+27
    053DA 1580      CP	R24,R0
    053DB 0591      CPC	R25,R1
    053DC F414      BGE	0x53DF
    053DD 8F9B      STD	Y+27,R25
    053DE 8F8A      STD	Y+26,R24
    053DF A80C      LDD	R0,Y+52
    053E0 A81D      LDD	R1,Y+53
    053E1 FC02      SBRC	R0,2
    053E2 C007      RJMP	0x53EA
    053E3 A80E      LDD	R0,Y+54
    053E4 A81F      LDD	R1,Y+55
    053E5 8D0A      LDD	R16,Y+26
    053E6 8D1B      LDD	R17,Y+27
    053E7 1600      CP	R0,R16
    053E8 0611      CPC	R1,R17
    053E9 F471      BNE	0x53F8
    053EA 24CC      CLR	R12
    053EB 24DD      CLR	R13
    053EC 880C      LDD	R0,Y+20
    053ED 890F      LDD	R16,Y+23
    053EE 1600      CP	R0,R16
    053EF F409      BNE	0x53F1
    053F0 C033      RJMP	0x5424
    053F1 A5EC      LDD	R30,Y+44
    053F2 A5FD      LDD	R31,Y+45
    053F3 8200      ST	Z,R0
    053F4 E081      LDI	R24,1
    053F5 E090      LDI	R25,0
    053F6 016C      MOVW	R12,R24
    053F7 C02C      RJMP	0x5424
    053F8 A8CE      LDD	R12,Y+54
    053F9 A8DF      LDD	R13,Y+55
    053FA 8C0A      LDD	R0,Y+26
    053FB 8C1B      LDD	R1,Y+27
    053FC 18C0      SUB	R12,R0
    053FD 08D1      SBC	R13,R1
    053FE 2744      CLR	R20
    053FF 2755      CLR	R21
    05400 C009      RJMP	0x540A
    05401 01FA      MOVW	R30,R20
    05402 A40C      LDD	R0,Y+44
    05403 A41D      LDD	R1,Y+45
    05404 0DE0      ADD	R30,R0
    05405 1DF1      ADC	R31,R1
    05406 880F      LDD	R0,Y+23
    05407 8200      ST	Z,R0
    05408 5F4F      SUBI	R20,0xFF
    05409 4F5F      SBCI	R21,0xFF
    0540A 16C4      CP	R12,R20
    0540B 06D5      CPC	R13,R21
    0540C F7A4      BGE	0x5401
    0540D 880C      LDD	R0,Y+20
    0540E 890F      LDD	R16,Y+23
    0540F 1600      CP	R0,R16
    05410 F099      BEQ	0x5424
    05411 A80C      LDD	R0,Y+52
    05412 A81D      LDD	R1,Y+53
    05413 FE04      SBRS	R0,4
    05414 C005      RJMP	0x541A
    05415 A5EC      LDD	R30,Y+44
    05416 A5FD      LDD	R31,Y+45
    05417 880C      LDD	R0,Y+20
    05418 8200      ST	Z,R0
    05419 C007      RJMP	0x5421
    0541A 01F6      MOVW	R30,R12
    0541B A40C      LDD	R0,Y+44
    0541C A41D      LDD	R1,Y+45
    0541D 0DE0      ADD	R30,R0
    0541E 1DF1      ADC	R31,R1
    0541F 880C      LDD	R0,Y+20
    05420 8200      ST	Z,R0
    05421 01C6      MOVW	R24,R12
    05422 9601      ADIW	R24,1
    05423 016C      MOVW	R12,R24
    05424 01A6      MOVW	R20,R12
    05425 8C08      LDD	R0,Y+24
    05426 8C19      LDD	R1,Y+25
    05427 2000      TST	R0
    05428 F459      BNE	0x5434
    05429 2011      TST	R1
    0542A F449      BNE	0x5434
    0542B 01FA      MOVW	R30,R20
    0542C A40C      LDD	R0,Y+44
    0542D A41D      LDD	R1,Y+45
    0542E 0DE0      ADD	R30,R0
    0542F 1DF1      ADC	R31,R1
    05430 E380      LDI	R24,0x30
    05431 8380      ST	Z,R24
    05432 5F4F      SUBI	R20,0xFF
    05433 4F5F      SBCI	R21,0xFF
    05434 2400      CLR	R0
    05435 2411      CLR	R1
    05436 861D      STD	Y+13,R1
    05437 860C      STD	Y+12,R0
    05438 C016      RJMP	0x544F
    05439 842C      LDD	R2,Y+12
    0543A 843D      LDD	R3,Y+13
    0543B 0E26      ADD	R2,R22
    0543C 1E37      ADC	R3,R23
    0543D 89E8      LDD	R30,Y+16
    0543E 89F9      LDD	R31,Y+17
    0543F 0DE2      ADD	R30,R2
    05440 1DF3      ADC	R31,R3
    05441 8020      LD	R2,Z
    05442 01FA      MOVW	R30,R20
    05443 A40C      LDD	R0,Y+44
    05444 A41D      LDD	R1,Y+45
    05445 0DE0      ADD	R30,R0
    05446 1DF1      ADC	R31,R1
    05447 8220      ST	Z,R2
    05448 5F4F      SUBI	R20,0xFF
    05449 4F5F      SBCI	R21,0xFF
    0544A 858C      LDD	R24,Y+12
    0544B 859D      LDD	R25,Y+13
    0544C 9601      ADIW	R24,1
    0544D 879D      STD	Y+13,R25
    0544E 878C      STD	Y+12,R24
    0544F 840C      LDD	R0,Y+12
    05450 841D      LDD	R1,Y+13
    05451 8D08      LDD	R16,Y+24
    05452 8D19      LDD	R17,Y+25
    05453 1600      CP	R0,R16
    05454 0611      CPC	R1,R17
    05455 F31C      BLT	0x5439
    05456 880A      LDD	R0,Y+18
    05457 881B      LDD	R1,Y+19
    05458 140A      CP	R0,R10
    05459 041B      CPC	R1,R11
    0545A F44C      BGE	0x5464
    0545B 01FA      MOVW	R30,R20
    0545C A40C      LDD	R0,Y+44
    0545D A41D      LDD	R1,Y+45
    0545E 0DE0      ADD	R30,R0
    0545F 1DF1      ADC	R31,R1
    05460 E28E      LDI	R24,0x2E
    05461 8380      ST	Z,R24
    05462 5F4F      SUBI	R20,0xFF
    05463 4F5F      SBCI	R21,0xFF
    05464 2400      CLR	R0
    05465 2411      CLR	R1
    05466 861D      STD	Y+13,R1
    05467 860C      STD	Y+12,R0
    05468 C02C      RJMP	0x5495
    05469 882D      LDD	R2,Y+21
    0546A 883E      LDD	R3,Y+22
    0546B 840E      LDD	R0,Y+14
    0546C 841F      LDD	R1,Y+15
    0546D 1820      SUB	R2,R0
    0546E 0831      SBC	R3,R1
    0546F 840C      LDD	R0,Y+12
    05470 841D      LDD	R1,Y+13
    05471 1402      CP	R0,R2
    05472 0413      CPC	R1,R3
    05473 F47C      BGE	0x5483
    05474 0110      MOVW	R2,R0
    05475 0E26      ADD	R2,R22
    05476 1E37      ADC	R3,R23
    05477 85EE      LDD	R30,Y+14
    05478 85FF      LDD	R31,Y+15
    05479 0DE2      ADD	R30,R2
    0547A 1DF3      ADC	R31,R3
    0547B 8021      LDD	R2,Z+1
    0547C 01FA      MOVW	R30,R20
    0547D A40C      LDD	R0,Y+44
    0547E A41D      LDD	R1,Y+45
    0547F 0DE0      ADD	R30,R0
    05480 1DF1      ADC	R31,R1
    05481 8220      ST	Z,R2
    05482 C00B      RJMP	0x548E
    05483 A80C      LDD	R0,Y+52
    05484 A81D      LDD	R1,Y+53
    05485 FE00      SBRS	R0,0
    05486 C024      RJMP	0x54AB
    05487 01FA      MOVW	R30,R20
    05488 A40C      LDD	R0,Y+44
    05489 A41D      LDD	R1,Y+45
    0548A 0DE0      ADD	R30,R0
    0548B 1DF1      ADC	R31,R1
    0548C E380      LDI	R24,0x30
    0548D 8380      ST	Z,R24
    0548E 5F4F      SUBI	R20,0xFF
    0548F 4F5F      SBCI	R21,0xFF
    05490 858C      LDD	R24,Y+12
    05491 859D      LDD	R25,Y+13
    05492 9601      ADIW	R24,1
    05493 879D      STD	Y+13,R25
    05494 878C      STD	Y+12,R24
    05495 840C      LDD	R0,Y+12
    05496 841D      LDD	R1,Y+13
    05497 AD08      LDD	R16,Y+56
    05498 AD19      LDD	R17,Y+57
    05499 1600      CP	R0,R16
    0549A 0611      CPC	R1,R17
    0549B F42C      BGE	0x54A1
    0549C 3144      CPI	R20,0x14
    0549D E0E0      LDI	R30,0
    0549E 075E      CPC	R21,R30
    0549F F40C      BGE	0x54A1
    054A0 CFC8      RJMP	0x5469
    054A1 C009      RJMP	0x54AB
    054A2 01FA      MOVW	R30,R20
    054A3 A40C      LDD	R0,Y+44
    054A4 A41D      LDD	R1,Y+45
    054A5 0DE0      ADD	R30,R0
    054A6 1DF1      ADC	R31,R1
    054A7 8C0C      LDD	R0,Y+28
    054A8 8200      ST	Z,R0
    054A9 5F4F      SUBI	R20,0xFF
    054AA 4F5F      SBCI	R21,0xFF
    054AB A80E      LDD	R0,Y+54
    054AC A81F      LDD	R1,Y+55
    054AD 1540      CP	R20,R0
    054AE 0551      CPC	R21,R1
    054AF F394      BLT	0x54A2
    054B0 01FA      MOVW	R30,R20
    054B1 A40C      LDD	R0,Y+44
    054B2 A41D      LDD	R1,Y+45
    054B3 0DE0      ADD	R30,R0
    054B4 1DF1      ADC	R31,R1
    054B5 2422      CLR	R2
    054B6 8220      ST	Z,R2
    054B7 A50C      LDD	R16,Y+44
    054B8 A51D      LDD	R17,Y+45
    054B9 96A2      ADIW	R28,0x22
    054BA 940E 483A CALL	pop_xgsetF0FC
    054BC 9624      ADIW	R28,4
    054BD 9508      RET
